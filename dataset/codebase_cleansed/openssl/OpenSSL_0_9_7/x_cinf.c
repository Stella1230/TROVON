int i2d_X509_CINF(X509_CINF *a, unsigned char **pp)\r\n{\r\nint v1=0,v2=0;\r\nM_ASN1_I2D_vars(a);\r\nM_ASN1_I2D_len_EXP_opt(a->version,i2d_ASN1_INTEGER,0,v1);\r\nM_ASN1_I2D_len(a->serialNumber, i2d_ASN1_INTEGER);\r\nM_ASN1_I2D_len(a->signature, i2d_X509_ALGOR);\r\nM_ASN1_I2D_len(a->issuer, i2d_X509_NAME);\r\nM_ASN1_I2D_len(a->validity, i2d_X509_VAL);\r\nM_ASN1_I2D_len(a->subject, i2d_X509_NAME);\r\nM_ASN1_I2D_len(a->key, i2d_X509_PUBKEY);\r\nM_ASN1_I2D_len_IMP_opt(a->issuerUID, i2d_ASN1_BIT_STRING);\r\nM_ASN1_I2D_len_IMP_opt(a->subjectUID, i2d_ASN1_BIT_STRING);\r\nM_ASN1_I2D_len_EXP_SEQUENCE_opt_type(X509_EXTENSION,a->extensions,\r\ni2d_X509_EXTENSION,3,\r\nV_ASN1_SEQUENCE,v2);\r\nM_ASN1_I2D_seq_total();\r\nM_ASN1_I2D_put_EXP_opt(a->version,i2d_ASN1_INTEGER,0,v1);\r\nM_ASN1_I2D_put(a->serialNumber, i2d_ASN1_INTEGER);\r\nM_ASN1_I2D_put(a->signature, i2d_X509_ALGOR);\r\nM_ASN1_I2D_put(a->issuer, i2d_X509_NAME);\r\nM_ASN1_I2D_put(a->validity, i2d_X509_VAL);\r\nM_ASN1_I2D_put(a->subject, i2d_X509_NAME);\r\nM_ASN1_I2D_put(a->key, i2d_X509_PUBKEY);\r\nM_ASN1_I2D_put_IMP_opt(a->issuerUID, i2d_ASN1_BIT_STRING,1);\r\nM_ASN1_I2D_put_IMP_opt(a->subjectUID, i2d_ASN1_BIT_STRING,2);\r\nM_ASN1_I2D_put_EXP_SEQUENCE_opt_type(X509_EXTENSION,a->extensions,\r\ni2d_X509_EXTENSION,3,\r\nV_ASN1_SEQUENCE,v2);\r\nM_ASN1_I2D_finish();\r\n}\r\nX509_CINF *d2i_X509_CINF(X509_CINF **a, unsigned char **pp, long length)\r\n{\r\nint ver=0;\r\nM_ASN1_D2I_vars(a,X509_CINF *,X509_CINF_new);\r\nM_ASN1_D2I_Init();\r\nM_ASN1_D2I_start_sequence();\r\nif (M_ASN1_next == (V_ASN1_CONTEXT_SPECIFIC | V_ASN1_CONSTRUCTED | 0))\r\n{\r\nM_ASN1_D2I_get_EXP_opt(ret->version,d2i_ASN1_INTEGER,0);\r\nif (ret->version->data != NULL)\r\nver=ret->version->data[0];\r\n}\r\nelse\r\n{\r\nif (ret->version != NULL)\r\n{\r\nM_ASN1_INTEGER_free(ret->version);\r\nret->version=NULL;\r\n}\r\n}\r\nM_ASN1_D2I_get(ret->serialNumber,d2i_ASN1_INTEGER);\r\nM_ASN1_D2I_get(ret->signature,d2i_X509_ALGOR);\r\nM_ASN1_D2I_get(ret->issuer,d2i_X509_NAME);\r\nM_ASN1_D2I_get(ret->validity,d2i_X509_VAL);\r\nM_ASN1_D2I_get(ret->subject,d2i_X509_NAME);\r\nM_ASN1_D2I_get(ret->key,d2i_X509_PUBKEY);\r\nif (ver >= 1)\r\n{\r\nif (ret->issuerUID != NULL)\r\n{\r\nM_ASN1_BIT_STRING_free(ret->issuerUID);\r\nret->issuerUID=NULL;\r\n}\r\nif (ret->subjectUID != NULL)\r\n{\r\nM_ASN1_BIT_STRING_free(ret->subjectUID);\r\nret->subjectUID=NULL;\r\n}\r\nM_ASN1_D2I_get_IMP_opt(ret->issuerUID,d2i_ASN1_BIT_STRING, 1,\r\nV_ASN1_BIT_STRING);\r\nM_ASN1_D2I_get_IMP_opt(ret->subjectUID,d2i_ASN1_BIT_STRING, 2,\r\nV_ASN1_BIT_STRING);\r\n}\r\n#ifdef VERSION_EXT_CHECK\r\nif (ver >= 2)\r\n#endif\r\n{\r\nif (ret->extensions != NULL)\r\nwhile (sk_X509_EXTENSION_num(ret->extensions))\r\nX509_EXTENSION_free(\r\nsk_X509_EXTENSION_pop(ret->extensions));\r\nM_ASN1_D2I_get_EXP_set_opt_type(X509_EXTENSION,ret->extensions,\r\nd2i_X509_EXTENSION,\r\nX509_EXTENSION_free,3,\r\nV_ASN1_SEQUENCE);\r\n}\r\nM_ASN1_D2I_Finish(a,X509_CINF_free,ASN1_F_D2I_X509_CINF);\r\n}\r\nX509_CINF *X509_CINF_new(void)\r\n{\r\nX509_CINF *ret=NULL;\r\nASN1_CTX c;\r\nM_ASN1_New_Malloc(ret,X509_CINF);\r\nret->version=NULL;\r\nM_ASN1_New(ret->serialNumber,M_ASN1_INTEGER_new);\r\nM_ASN1_New(ret->signature,X509_ALGOR_new);\r\nM_ASN1_New(ret->issuer,X509_NAME_new);\r\nM_ASN1_New(ret->validity,X509_VAL_new);\r\nM_ASN1_New(ret->subject,X509_NAME_new);\r\nM_ASN1_New(ret->key,X509_PUBKEY_new);\r\nret->issuerUID=NULL;\r\nret->subjectUID=NULL;\r\nret->extensions=NULL;\r\nreturn(ret);\r\nM_ASN1_New_Error(ASN1_F_X509_CINF_NEW);\r\n}\r\nvoid X509_CINF_free(X509_CINF *a)\r\n{\r\nif (a == NULL) return;\r\nM_ASN1_INTEGER_free(a->version);\r\nM_ASN1_INTEGER_free(a->serialNumber);\r\nX509_ALGOR_free(a->signature);\r\nX509_NAME_free(a->issuer);\r\nX509_VAL_free(a->validity);\r\nX509_NAME_free(a->subject);\r\nX509_PUBKEY_free(a->key);\r\nM_ASN1_BIT_STRING_free(a->issuerUID);\r\nM_ASN1_BIT_STRING_free(a->subjectUID);\r\nsk_X509_EXTENSION_pop_free(a->extensions,X509_EXTENSION_free);\r\nOPENSSL_free(a);\r\n}
