const char *RC4_options(void)\r\n{\r\n#ifdef RC4_INDEX\r\nif (sizeof(RC4_INT) == 1)\r\nreturn("rc4(idx,char)");\r\nelse\r\nreturn("rc4(idx,int)");\r\n#else\r\nif (sizeof(RC4_INT) == 1)\r\nreturn("rc4(ptr,char)");\r\nelse\r\nreturn("rc4(ptr,int)");\r\n#endif\r\n}\r\nvoid RC4_set_key(RC4_KEY *key, int len, const unsigned char *data)\r\n{\r\nregister RC4_INT tmp;\r\nregister int id1,id2;\r\nregister RC4_INT *d;\r\nunsigned int i;\r\nd= &(key->data[0]);\r\nfor (i=0; i<256; i++)\r\nd[i]=i;\r\nkey->x = 0;\r\nkey->y = 0;\r\nid1=id2=0;\r\n#define SK_LOOP(n) { \\r\ntmp=d[(n)]; \\r\nid2 = (data[id1] + tmp + id2) & 0xff; \\r\nif (++id1 == len) id1=0; \\r\nd[(n)]=d[id2]; \\r\nd[id2]=tmp; }\r\nfor (i=0; i < 256; i+=4)\r\n{\r\nSK_LOOP(i+0);\r\nSK_LOOP(i+1);\r\nSK_LOOP(i+2);\r\nSK_LOOP(i+3);\r\n}\r\n}
