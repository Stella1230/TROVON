int BIO_dump(BIO *bio, const char *s, int len)\r\n{\r\nreturn BIO_dump_indent(bio, s, len, 0);\r\n}\r\nint BIO_dump_indent(BIO *bio, const char *s, int len, int indent)\r\n{\r\nint ret=0;\r\nchar buf[288+1],tmp[20],str[128+1];\r\nint i,j,rows,trunc;\r\nunsigned char ch;\r\nint dump_width;\r\ntrunc=0;\r\n#ifdef TRUNCATE\r\nfor(; (len > 0) && ((s[len-1] == ' ') || (s[len-1] == '\0')); len--)\r\ntrunc++;\r\n#endif\r\nif (indent < 0)\r\nindent = 0;\r\nif (indent)\r\n{\r\nif (indent > 128) indent=128;\r\nmemset(str,' ',indent);\r\n}\r\nstr[indent]='\0';\r\ndump_width=DUMP_WIDTH_LESS_INDENT(indent);\r\nrows=(len/dump_width);\r\nif ((rows*dump_width)<len)\r\nrows++;\r\nfor(i=0;i<rows;i++)\r\n{\r\nbuf[0]='\0';\r\nstrcpy(buf,str);\r\nsprintf(tmp,"%04x - ",i*dump_width);\r\nstrcat(buf,tmp);\r\nfor(j=0;j<dump_width;j++)\r\n{\r\nif (((i*dump_width)+j)>=len)\r\n{\r\nstrcat(buf," ");\r\n}\r\nelse\r\n{\r\nch=((unsigned char)*(s+i*dump_width+j)) & 0xff;\r\nsprintf(tmp,"%02x%c",ch,j==7?'-':' ');\r\nstrcat(buf,tmp);\r\n}\r\n}\r\nstrcat(buf," ");\r\nfor(j=0;j<dump_width;j++)\r\n{\r\nif (((i*dump_width)+j)>=len)\r\nbreak;\r\nch=((unsigned char)*(s+i*dump_width+j)) & 0xff;\r\n#ifndef CHARSET_EBCDIC\r\nsprintf(tmp,"%c",((ch>=' ')&&(ch<='~'))?ch:'.');\r\n#else\r\nsprintf(tmp,"%c",((ch>=os_toascii[' '])&&(ch<=os_toascii['~']))\r\n? os_toebcdic[ch]\r\n: '.');\r\n#endif\r\nstrcat(buf,tmp);\r\n}\r\nstrcat(buf,"\n");\r\nret+=BIO_write(bio,(char *)buf,strlen(buf));\r\n}\r\n#ifdef TRUNCATE\r\nif (trunc > 0)\r\n{\r\nsprintf(buf,"%s%04x - <SPACES/NULS>\n",str,len+trunc);\r\nret+=BIO_write(bio,(char *)buf,strlen(buf));\r\n}\r\n#endif\r\nreturn(ret);\r\n}
