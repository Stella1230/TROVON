int RAND_load_file(const char *file, long bytes)\r\n{\r\nMS_STATIC unsigned char buf[BUFSIZE];\r\nstruct stat sb;\r\nint i,ret=0,n;\r\nFILE *in;\r\nif (file == NULL) return(0);\r\ni=stat(file,&sb);\r\nRAND_seed(&sb,sizeof(sb));\r\nret+=sizeof(sb);\r\nif (i < 0) return(0);\r\nif (bytes <= 0) return(ret);\r\nin=fopen(file,"rb");\r\nif (in == NULL) goto err;\r\nfor (;;)\r\n{\r\nn=(bytes < BUFSIZE)?(int)bytes:BUFSIZE;\r\ni=fread(buf,1,n,in);\r\nif (i <= 0) break;\r\nRAND_seed(buf,n);\r\nret+=i;\r\nbytes-=n;\r\nif (bytes <= 0) break;\r\n}\r\nfclose(in);\r\nmemset(buf,0,BUFSIZE);\r\nerr:\r\nreturn(ret);\r\n}\r\nint RAND_write_file(const char *file)\r\n{\r\nunsigned char buf[BUFSIZE];\r\nint i,ret=0;\r\nFILE *out;\r\nint n;\r\nout=fopen(file,"rb+");\r\nif (out == NULL && errno == ENOENT)\r\n{\r\nerrno = 0;\r\nout=fopen(file,"wb");\r\n}\r\nif (out == NULL) goto err;\r\nchmod(file,0600);\r\nn=RAND_DATA;\r\nfor (;;)\r\n{\r\ni=(n > BUFSIZE)?BUFSIZE:n;\r\nn-=BUFSIZE;\r\nRAND_bytes(buf,i);\r\ni=fwrite(buf,1,i,out);\r\nif (i <= 0)\r\n{\r\nret=0;\r\nbreak;\r\n}\r\nret+=i;\r\nif (n <= 0) break;\r\n}\r\nfclose(out);\r\nmemset(buf,0,BUFSIZE);\r\nerr:\r\nreturn(ret);\r\n}\r\nchar *RAND_file_name(char *buf, int size)\r\n{\r\nchar *s;\r\nchar *ret=NULL;\r\ns=getenv("RANDFILE");\r\nif (s != NULL)\r\n{\r\nstrncpy(buf,s,size-1);\r\nbuf[size-1]='\0';\r\nret=buf;\r\n}\r\nelse\r\n{\r\ns=getenv("HOME");\r\nif (s == NULL) return(RFILE);\r\nif (((int)(strlen(s)+strlen(RFILE)+2)) > size)\r\nreturn(RFILE);\r\nstrcpy(buf,s);\r\n#ifndef VMS\r\nstrcat(buf,"/");\r\n#endif\r\nstrcat(buf,RFILE);\r\nret=buf;\r\n}\r\nreturn(ret);\r\n}
