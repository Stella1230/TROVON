int MAIN(int argc, char **argv)\r\n{\r\nint ret=1,i;\r\nint verbose=0;\r\nchar **pp;\r\nconst char *p;\r\nint badops=0;\r\nSSL_CTX *ctx=NULL;\r\nSSL *ssl=NULL;\r\nchar *ciphers=NULL;\r\nSSL_METHOD *meth=NULL;\r\nSTACK_OF(SSL_CIPHER) *sk;\r\nchar buf[512];\r\nBIO *STDout=NULL;\r\n#if !defined(NO_SSL2) && !defined(NO_SSL3)\r\nmeth=SSLv23_server_method();\r\n#elif !defined(NO_SSL3)\r\nmeth=SSLv3_server_method();\r\n#elif !defined(NO_SSL2)\r\nmeth=SSLv2_server_method();\r\n#endif\r\napps_startup();\r\nif (bio_err == NULL)\r\nbio_err=BIO_new_fp(stderr,BIO_NOCLOSE);\r\nSTDout=BIO_new_fp(stdout,BIO_NOCLOSE);\r\nargc--;\r\nargv++;\r\nwhile (argc >= 1)\r\n{\r\nif (strcmp(*argv,"-v") == 0)\r\nverbose=1;\r\n#ifndef NO_SSL2\r\nelse if (strcmp(*argv,"-ssl2") == 0)\r\nmeth=SSLv2_client_method();\r\n#endif\r\n#ifndef NO_SSL3\r\nelse if (strcmp(*argv,"-ssl3") == 0)\r\nmeth=SSLv3_client_method();\r\n#endif\r\nelse if ((strncmp(*argv,"-h",2) == 0) ||\r\n(strcmp(*argv,"-?") == 0))\r\n{\r\nbadops=1;\r\nbreak;\r\n}\r\nelse\r\n{\r\nciphers= *argv;\r\n}\r\nargc--;\r\nargv++;\r\n}\r\nif (badops)\r\n{\r\nfor (pp=ciphers_usage; (*pp != NULL); pp++)\r\nBIO_printf(bio_err,*pp);\r\ngoto end;\r\n}\r\nSSLeay_add_ssl_algorithms();\r\nctx=SSL_CTX_new(meth);\r\nif (ctx == NULL) goto err;\r\nif (ciphers != NULL)\r\nSSL_CTX_set_cipher_list(ctx,ciphers);\r\nssl=SSL_new(ctx);\r\nif (ssl == NULL) goto err;\r\nif (!verbose)\r\n{\r\nfor (i=0; ; i++)\r\n{\r\np=SSL_get_cipher_list(ssl,i);\r\nif (p == NULL) break;\r\nif (i != 0) BIO_printf(STDout,":");\r\nBIO_printf(STDout,"%s",p);\r\n}\r\nBIO_printf(STDout,"\n");\r\n}\r\nelse\r\n{\r\nsk=SSL_get_ciphers(ssl);\r\nfor (i=0; i<sk_SSL_CIPHER_num(sk); i++)\r\n{\r\nBIO_puts(STDout,SSL_CIPHER_description(\r\nsk_SSL_CIPHER_value(sk,i),\r\nbuf,512));\r\n}\r\n}\r\nret=0;\r\nif (0)\r\n{\r\nerr:\r\nSSL_load_error_strings();\r\nERR_print_errors(bio_err);\r\n}\r\nend:\r\nif (ctx != NULL) SSL_CTX_free(ctx);\r\nif (ssl != NULL) SSL_free(ssl);\r\nif (STDout != NULL) BIO_free(STDout);\r\nEXIT(ret);\r\n}
