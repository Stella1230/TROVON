char *ASN1_dup(int (*i2d)(), char *(*d2i)(), char *x)\r\n{\r\nunsigned char *b,*p;\r\nlong i;\r\nchar *ret;\r\nif (x == NULL) return(NULL);\r\ni=(long)i2d(x,NULL);\r\nb=(unsigned char *)Malloc((unsigned int)i+10);\r\nif (b == NULL)\r\n{ ASN1err(ASN1_F_ASN1_DUP,ERR_R_MALLOC_FAILURE); return(NULL); }\r\np= b;\r\ni=i2d(x,&p);\r\np= b;\r\nret=d2i(NULL,&p,i);\r\nFree((char *)b);\r\nreturn(ret);\r\n}
