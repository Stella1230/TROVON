int ssl23_write_bytes(SSL *s)\r\n{\r\nint i,num,tot;\r\nchar *buf;\r\nbuf=s->init_buf->data;\r\ntot=s->init_off;\r\nnum=s->init_num;\r\nfor (;;)\r\n{\r\ns->rwstate=SSL_WRITING;\r\ni=BIO_write(s->wbio,&(buf[tot]),num);\r\nif (i <= 0)\r\n{\r\ns->init_off=tot;\r\ns->init_num=num;\r\nreturn(i);\r\n}\r\ns->rwstate=SSL_NOTHING;\r\nif (i == num) return(tot+i);\r\nnum-=i;\r\ntot+=i;\r\n}\r\n}\r\nint ssl23_read_bytes(SSL *s, int n)\r\n{\r\nunsigned char *p;\r\nint j;\r\nif (s->packet_length < (unsigned int)n)\r\n{\r\np=s->packet;\r\nfor (;;)\r\n{\r\ns->rwstate=SSL_READING;\r\nj=BIO_read(s->rbio,(char *)&(p[s->packet_length]),\r\nn-s->packet_length);\r\nif (j <= 0)\r\nreturn(j);\r\ns->rwstate=SSL_NOTHING;\r\ns->packet_length+=j;\r\nif (s->packet_length >= (unsigned int)n)\r\nreturn(s->packet_length);\r\n}\r\n}\r\nreturn(n);\r\n}
