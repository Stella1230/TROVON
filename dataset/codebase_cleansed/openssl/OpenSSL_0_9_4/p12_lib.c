int i2d_PKCS12(PKCS12 *a, unsigned char **pp)\r\n{\r\nM_ASN1_I2D_vars(a);\r\nM_ASN1_I2D_len (a->version, i2d_ASN1_INTEGER);\r\nM_ASN1_I2D_len (a->authsafes, i2d_PKCS7);\r\nM_ASN1_I2D_len (a->mac, i2d_PKCS12_MAC_DATA);\r\nM_ASN1_I2D_seq_total();\r\nM_ASN1_I2D_put (a->version, i2d_ASN1_INTEGER);\r\nM_ASN1_I2D_put (a->authsafes, i2d_PKCS7);\r\nM_ASN1_I2D_put (a->mac, i2d_PKCS12_MAC_DATA);\r\nM_ASN1_I2D_finish();\r\n}\r\nPKCS12 *d2i_PKCS12(PKCS12 **a, unsigned char **pp, long length)\r\n{\r\nM_ASN1_D2I_vars(a,PKCS12 *,PKCS12_new);\r\nM_ASN1_D2I_Init();\r\nM_ASN1_D2I_start_sequence();\r\nM_ASN1_D2I_get (ret->version, d2i_ASN1_INTEGER);\r\nM_ASN1_D2I_get (ret->authsafes, d2i_PKCS7);\r\nM_ASN1_D2I_get_opt (ret->mac, d2i_PKCS12_MAC_DATA, V_ASN1_SEQUENCE);\r\nM_ASN1_D2I_Finish(a, PKCS12_free, ASN1_F_D2I_PKCS12);\r\n}\r\nPKCS12 *PKCS12_new(void)\r\n{\r\nPKCS12 *ret=NULL;\r\nASN1_CTX c;\r\nM_ASN1_New_Malloc(ret, PKCS12);\r\nret->version=NULL;\r\nret->mac=NULL;\r\nret->authsafes=NULL;\r\nreturn (ret);\r\nM_ASN1_New_Error(ASN1_F_PKCS12_NEW);\r\n}\r\nvoid PKCS12_free (PKCS12 *a)\r\n{\r\nif (a == NULL) return;\r\nASN1_INTEGER_free (a->version);\r\nPKCS12_MAC_DATA_free (a->mac);\r\nPKCS7_free (a->authsafes);\r\nFree ((char *)a);\r\n}
