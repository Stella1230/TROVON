int EVP_SealInit(EVP_CIPHER_CTX *ctx, EVP_CIPHER *type, unsigned char **ek,\r\nint *ekl, unsigned char *iv, EVP_PKEY **pubk, int npubk)\r\n{\r\nunsigned char key[EVP_MAX_KEY_LENGTH];\r\nint i;\r\nif (npubk <= 0) return(0);\r\nRAND_bytes(key,EVP_MAX_KEY_LENGTH);\r\nif (type->iv_len > 0)\r\nRAND_bytes(iv,type->iv_len);\r\nEVP_CIPHER_CTX_init(ctx);\r\nEVP_EncryptInit(ctx,type,key,iv);\r\nfor (i=0; i<npubk; i++)\r\n{\r\nekl[i]=EVP_PKEY_encrypt(ek[i],key,EVP_CIPHER_key_length(type),\r\npubk[i]);\r\nif (ekl[i] <= 0) return(-1);\r\n}\r\nreturn(npubk);\r\n}\r\nvoid EVP_SealFinal(EVP_CIPHER_CTX *ctx, unsigned char *out, int *outl)\r\n{\r\nEVP_EncryptFinal(ctx,out,outl);\r\nEVP_EncryptInit(ctx,NULL,NULL,NULL);\r\n}
