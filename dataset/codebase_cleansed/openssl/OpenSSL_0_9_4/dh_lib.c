DH *DH_new(void)\r\n{\r\nDH *ret;\r\nret=(DH *)Malloc(sizeof(DH));\r\nif (ret == NULL)\r\n{\r\nDHerr(DH_F_DH_NEW,ERR_R_MALLOC_FAILURE);\r\nreturn(NULL);\r\n}\r\nret->pad=0;\r\nret->version=0;\r\nret->p=NULL;\r\nret->g=NULL;\r\nret->length=0;\r\nret->pub_key=NULL;\r\nret->priv_key=NULL;\r\nret->flags=DH_FLAG_CACHE_MONT_P;\r\nret->method_mont_p=NULL;\r\nreturn(ret);\r\n}\r\nvoid DH_free(DH *r)\r\n{\r\nif(r == NULL) return;\r\nif (r->p != NULL) BN_clear_free(r->p);\r\nif (r->g != NULL) BN_clear_free(r->g);\r\nif (r->pub_key != NULL) BN_clear_free(r->pub_key);\r\nif (r->priv_key != NULL) BN_clear_free(r->priv_key);\r\nif (r->method_mont_p != NULL)\r\nBN_MONT_CTX_free((BN_MONT_CTX *)r->method_mont_p);\r\nFree(r);\r\n}\r\nint DH_size(DH *dh)\r\n{\r\nreturn(BN_num_bytes(dh->p));\r\n}
