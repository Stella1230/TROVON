EVP_CIPHER *EVP_des_ede_cfb(void)\r\n{\r\nreturn(&d_ede_cfb_cipher2);\r\n}\r\nEVP_CIPHER *EVP_des_ede3_cfb(void)\r\n{\r\nreturn(&d_ede3_cfb_cipher3);\r\n}\r\nstatic void des_ede_cfb_init_key(EVP_CIPHER_CTX *ctx, unsigned char *key,\r\nunsigned char *iv, int enc)\r\n{\r\ndes_cblock *deskey = (des_cblock *)key;\r\nctx->num=0;\r\nif (iv != NULL)\r\nmemcpy(&(ctx->oiv[0]),iv,8);\r\nmemcpy(&(ctx->iv[0]),&(ctx->oiv[0]),8);\r\nif (deskey != NULL)\r\n{\r\ndes_set_key(&deskey[0],ctx->c.des_ede.ks1);\r\ndes_set_key(&deskey[1],ctx->c.des_ede.ks2);\r\nmemcpy( (char *)ctx->c.des_ede.ks3,\r\n(char *)ctx->c.des_ede.ks1,\r\nsizeof(ctx->c.des_ede.ks1));\r\n}\r\n}\r\nstatic void des_ede3_cfb_init_key(EVP_CIPHER_CTX *ctx, unsigned char *key,\r\nunsigned char *iv, int enc)\r\n{\r\ndes_cblock *deskey = (des_cblock *)key;\r\nctx->num=0;\r\nif (iv != NULL)\r\nmemcpy(&(ctx->oiv[0]),iv,8);\r\nmemcpy(&(ctx->iv[0]),&(ctx->oiv[0]),8);\r\nif (deskey != NULL)\r\n{\r\ndes_set_key(&deskey[0],ctx->c.des_ede.ks1);\r\ndes_set_key(&deskey[1],ctx->c.des_ede.ks2);\r\ndes_set_key(&deskey[2],ctx->c.des_ede.ks3);\r\n}\r\n}\r\nstatic void des_ede_cfb_cipher(EVP_CIPHER_CTX *ctx, unsigned char *out,\r\nunsigned char *in, unsigned int inl)\r\n{\r\ndes_ede3_cfb64_encrypt(in,out,(long)inl,\r\nctx->c.des_ede.ks1,\r\nctx->c.des_ede.ks2,\r\nctx->c.des_ede.ks3,\r\n(des_cblock*)&(ctx->iv[0]),\r\n&ctx->num,ctx->encrypt);\r\n}
