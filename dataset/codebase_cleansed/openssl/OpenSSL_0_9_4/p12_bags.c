int i2d_PKCS12_BAGS(PKCS12_BAGS *a, unsigned char **pp)\r\n{\r\nint bagnid, v = 0;\r\nM_ASN1_I2D_vars(a);\r\nbagnid = OBJ_obj2nid (a->type);\r\nM_ASN1_I2D_len (a->type, i2d_ASN1_OBJECT);\r\nswitch (bagnid) {\r\ncase NID_x509Certificate:\r\nM_ASN1_I2D_len_EXP_opt (a->value.x509cert,\r\ni2d_ASN1_OCTET_STRING, 0, v);\r\nbreak;\r\ncase NID_x509Crl:\r\nM_ASN1_I2D_len_EXP_opt (a->value.x509crl,\r\ni2d_ASN1_OCTET_STRING, 0, v);\r\nbreak;\r\ncase NID_sdsiCertificate:\r\nM_ASN1_I2D_len_EXP_opt (a->value.sdsicert,\r\ni2d_ASN1_IA5STRING, 0, v);\r\nbreak;\r\ndefault:\r\nM_ASN1_I2D_len_EXP_opt (a->value.other,\r\ni2d_ASN1_TYPE, 0, v);\r\nbreak;\r\n}\r\nM_ASN1_I2D_seq_total ();\r\nM_ASN1_I2D_put (a->type, i2d_ASN1_OBJECT);\r\nswitch (bagnid) {\r\ncase NID_x509Certificate:\r\nM_ASN1_I2D_put_EXP_opt (a->value.x509cert,\r\ni2d_ASN1_OCTET_STRING, 0, v);\r\nbreak;\r\ncase NID_x509Crl:\r\nM_ASN1_I2D_put_EXP_opt (a->value.x509crl,\r\ni2d_ASN1_OCTET_STRING, 0, v);\r\nbreak;\r\ncase NID_sdsiCertificate:\r\nM_ASN1_I2D_put_EXP_opt (a->value.sdsicert,\r\ni2d_ASN1_IA5STRING, 0, v);\r\nbreak;\r\ndefault:\r\nM_ASN1_I2D_put_EXP_opt (a->value.other, i2d_ASN1_TYPE, 0, v);\r\nbreak;\r\n}\r\nM_ASN1_I2D_finish();\r\n}\r\nPKCS12_BAGS *PKCS12_BAGS_new(void)\r\n{\r\nPKCS12_BAGS *ret=NULL;\r\nASN1_CTX c;\r\nM_ASN1_New_Malloc(ret, PKCS12_BAGS);\r\nret->type=NULL;\r\nret->value.other=NULL;\r\nreturn (ret);\r\nM_ASN1_New_Error(ASN1_F_PKCS12_BAGS_NEW);\r\n}\r\nPKCS12_BAGS *d2i_PKCS12_BAGS(PKCS12_BAGS **a, unsigned char **pp,\r\nlong length)\r\n{\r\nint bagnid;\r\nM_ASN1_D2I_vars(a,PKCS12_BAGS *,PKCS12_BAGS_new);\r\nM_ASN1_D2I_Init();\r\nM_ASN1_D2I_start_sequence();\r\nM_ASN1_D2I_get (ret->type, d2i_ASN1_OBJECT);\r\nbagnid = OBJ_obj2nid (ret->type);\r\nswitch (bagnid) {\r\ncase NID_x509Certificate:\r\nM_ASN1_D2I_get_EXP_opt (ret->value.x509cert,\r\nd2i_ASN1_OCTET_STRING, 0);\r\nbreak;\r\ncase NID_x509Crl:\r\nM_ASN1_D2I_get_EXP_opt (ret->value.x509crl,\r\nd2i_ASN1_OCTET_STRING, 0);\r\nbreak;\r\ncase NID_sdsiCertificate:\r\nM_ASN1_D2I_get_EXP_opt (ret->value.sdsicert,\r\nd2i_ASN1_IA5STRING, 0);\r\nbreak;\r\ndefault:\r\nM_ASN1_D2I_get_EXP_opt (ret->value.other,\r\nd2i_ASN1_TYPE, 0);\r\nbreak;\r\n}\r\nM_ASN1_D2I_Finish(a, PKCS12_BAGS_free, ASN1_F_D2I_PKCS12_BAGS);\r\n}\r\nvoid PKCS12_BAGS_free (PKCS12_BAGS *a)\r\n{\r\nif (a == NULL) return;\r\nswitch (OBJ_obj2nid(a->type)) {\r\ncase NID_x509Certificate:\r\nASN1_OCTET_STRING_free (a->value.x509cert);\r\nbreak;\r\ncase NID_x509Crl:\r\nASN1_OCTET_STRING_free (a->value.x509crl);\r\nbreak;\r\ncase NID_sdsiCertificate:\r\nASN1_IA5STRING_free (a->value.sdsicert);\r\nbreak;\r\ndefault:\r\nASN1_TYPE_free (a->value.other);\r\nbreak;\r\n}\r\nASN1_OBJECT_free (a->type);\r\nFree ((char *)a);\r\n}
