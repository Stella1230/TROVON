X509_INFO *X509_INFO_new(void)\r\n{\r\nX509_INFO *ret=NULL;\r\nret=(X509_INFO *)Malloc(sizeof(X509_INFO));\r\nif (ret == NULL)\r\n{\r\nASN1err(ASN1_F_X509_INFO_NEW,ERR_R_MALLOC_FAILURE);\r\nreturn(NULL);\r\n}\r\nret->enc_cipher.cipher=NULL;\r\nret->enc_len=0;\r\nret->enc_data=NULL;\r\nret->references=1;\r\nret->x509=NULL;\r\nret->crl=NULL;\r\nret->x_pkey=NULL;\r\nreturn(ret);\r\n}\r\nvoid X509_INFO_free(X509_INFO *x)\r\n{\r\nint i;\r\nif (x == NULL) return;\r\ni=CRYPTO_add(&x->references,-1,CRYPTO_LOCK_X509_INFO);\r\n#ifdef REF_PRINT\r\nREF_PRINT("X509_INFO",x);\r\n#endif\r\nif (i > 0) return;\r\n#ifdef REF_CHECK\r\nif (i < 0)\r\n{\r\nfprintf(stderr,"X509_INFO_free, bad reference count\n");\r\nabort();\r\n}\r\n#endif\r\nif (x->x509 != NULL) X509_free(x->x509);\r\nif (x->crl != NULL) X509_CRL_free(x->crl);\r\nif (x->x_pkey != NULL) X509_PKEY_free(x->x_pkey);\r\nFree((char *)x);\r\n}
