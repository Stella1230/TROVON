PKCS12 *PKCS12_init (int mode)\r\n{\r\nPKCS12 *pkcs12;\r\nif (!(pkcs12 = PKCS12_new())) {\r\nPKCS12err(PKCS12_F_PKCS12_INIT,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nif (!(pkcs12->version = ASN1_INTEGER_new ())) {\r\nPKCS12err(PKCS12_F_PKCS12_INIT,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nASN1_INTEGER_set (pkcs12->version, 3);\r\nif (!(pkcs12->authsafes = PKCS7_new())) {\r\nPKCS12err(PKCS12_F_PKCS12_INIT,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\npkcs12->authsafes->type = OBJ_nid2obj(mode);\r\nswitch (mode) {\r\ncase NID_pkcs7_data:\r\nif (!(pkcs12->authsafes->d.data =\r\nASN1_OCTET_STRING_new())) {\r\nPKCS12err(PKCS12_F_PKCS12_INIT,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nbreak;\r\ndefault:\r\nPKCS12err(PKCS12_F_PKCS12_INIT,PKCS12_R_UNSUPPORTED_PKCS12_MODE);\r\nPKCS12_free(pkcs12);\r\nreturn NULL;\r\nbreak;\r\n}\r\nreturn pkcs12;\r\n}
