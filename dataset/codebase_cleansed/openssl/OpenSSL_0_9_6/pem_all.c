static RSA *pkey_get_rsa(EVP_PKEY *key, RSA **rsa)\r\n{\r\nRSA *rtmp;\r\nif(!key) return NULL;\r\nrtmp = EVP_PKEY_get1_RSA(key);\r\nEVP_PKEY_free(key);\r\nif(!rtmp) return NULL;\r\nif(rsa) {\r\nRSA_free(*rsa);\r\n*rsa = rtmp;\r\n}\r\nreturn rtmp;\r\n}\r\nRSA *PEM_read_bio_RSAPrivateKey(BIO *bp, RSA **rsa, pem_password_cb *cb,\r\nvoid *u)\r\n{\r\nEVP_PKEY *pktmp;\r\npktmp = PEM_read_bio_PrivateKey(bp, NULL, cb, u);\r\nreturn pkey_get_rsa(pktmp, rsa);\r\n}\r\nRSA *PEM_read_RSAPrivateKey(FILE *fp, RSA **rsa, pem_password_cb *cb,\r\nvoid *u)\r\n{\r\nEVP_PKEY *pktmp;\r\npktmp = PEM_read_PrivateKey(fp, NULL, cb, u);\r\nreturn pkey_get_rsa(pktmp, rsa);\r\n}\r\nstatic DSA *pkey_get_dsa(EVP_PKEY *key, DSA **dsa)\r\n{\r\nDSA *dtmp;\r\nif(!key) return NULL;\r\ndtmp = EVP_PKEY_get1_DSA(key);\r\nEVP_PKEY_free(key);\r\nif(!dtmp) return NULL;\r\nif(dsa) {\r\nDSA_free(*dsa);\r\n*dsa = dtmp;\r\n}\r\nreturn dtmp;\r\n}\r\nDSA *PEM_read_bio_DSAPrivateKey(BIO *bp, DSA **dsa, pem_password_cb *cb,\r\nvoid *u)\r\n{\r\nEVP_PKEY *pktmp;\r\npktmp = PEM_read_bio_PrivateKey(bp, NULL, cb, u);\r\nreturn pkey_get_dsa(pktmp, dsa);\r\n}\r\nDSA *PEM_read_DSAPrivateKey(FILE *fp, DSA **dsa, pem_password_cb *cb,\r\nvoid *u)\r\n{\r\nEVP_PKEY *pktmp;\r\npktmp = PEM_read_PrivateKey(fp, NULL, cb, u);\r\nreturn pkey_get_dsa(pktmp, dsa);\r\n}
