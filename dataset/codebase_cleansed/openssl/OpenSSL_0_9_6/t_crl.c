int X509_CRL_print_fp(FILE *fp, X509_CRL *x)\r\n{\r\nBIO *b;\r\nint ret;\r\nif ((b=BIO_new(BIO_s_file())) == NULL)\r\n{\r\nX509err(X509_F_X509_PRINT_FP,ERR_R_BUF_LIB);\r\nreturn(0);\r\n}\r\nBIO_set_fp(b,fp,BIO_NOCLOSE);\r\nret=X509_CRL_print(b, x);\r\nBIO_free(b);\r\nreturn(ret);\r\n}\r\nint X509_CRL_print(BIO *out, X509_CRL *x)\r\n{\r\nchar buf[256];\r\nunsigned char *s;\r\nSTACK_OF(X509_REVOKED) *rev;\r\nX509_REVOKED *r;\r\nlong l;\r\nint i, j, n;\r\nBIO_printf(out, "Certificate Revocation List (CRL):\n");\r\nl = X509_CRL_get_version(x);\r\nBIO_printf(out, "%8sVersion %lu (0x%lx)\n", "", l+1, l);\r\ni = OBJ_obj2nid(x->sig_alg->algorithm);\r\nBIO_printf(out, "%8sSignature Algorithm: %s\n", "",\r\n(i == NID_undef) ? "NONE" : OBJ_nid2ln(i));\r\nX509_NAME_oneline(X509_CRL_get_issuer(x),buf,256);\r\nBIO_printf(out,"%8sIssuer: %s\n","",buf);\r\nBIO_printf(out,"%8sLast Update: ","");\r\nASN1_TIME_print(out,X509_CRL_get_lastUpdate(x));\r\nBIO_printf(out,"\n%8sNext Update: ","");\r\nif (X509_CRL_get_nextUpdate(x))\r\nASN1_TIME_print(out,X509_CRL_get_nextUpdate(x));\r\nelse BIO_printf(out,"NONE");\r\nBIO_printf(out,"\n");\r\nn=X509_CRL_get_ext_count(x);\r\nif (n > 0) {\r\nBIO_printf(out,"%8sCRL extensions:\n","");\r\nfor (i=0; i<n; i++) ext_print(out, X509_CRL_get_ext(x, i));\r\n}\r\nrev = X509_CRL_get_REVOKED(x);\r\nif(sk_X509_REVOKED_num(rev))\r\nBIO_printf(out, "Revoked Certificates:\n");\r\nelse BIO_printf(out, "No Revoked Certificates.\n");\r\nfor(i = 0; i < sk_X509_REVOKED_num(rev); i++) {\r\nr = sk_X509_REVOKED_value(rev, i);\r\nBIO_printf(out," Serial Number: ");\r\ni2a_ASN1_INTEGER(out,r->serialNumber);\r\nBIO_printf(out,"\n Revocation Date: ","");\r\nASN1_TIME_print(out,r->revocationDate);\r\nBIO_printf(out,"\n");\r\nfor(j = 0; j < X509_REVOKED_get_ext_count(r); j++)\r\next_print(out, X509_REVOKED_get_ext(r, j));\r\n}\r\ni=OBJ_obj2nid(x->sig_alg->algorithm);\r\nBIO_printf(out," Signature Algorithm: %s",\r\n(i == NID_undef)?"UNKNOWN":OBJ_nid2ln(i));\r\ns = x->signature->data;\r\nn = x->signature->length;\r\nfor (i=0; i<n; i++, s++)\r\n{\r\nif ((i%18) == 0) BIO_write(out,"\n ",9);\r\nBIO_printf(out,"%02x%s",*s, ((i+1) == n)?"":":");\r\n}\r\nBIO_write(out,"\n",1);\r\nreturn 1;\r\n}\r\nstatic void ext_print(BIO *out, X509_EXTENSION *ex)\r\n{\r\nASN1_OBJECT *obj;\r\nint j;\r\nBIO_printf(out,"%12s","");\r\nobj=X509_EXTENSION_get_object(ex);\r\ni2a_ASN1_OBJECT(out,obj);\r\nj=X509_EXTENSION_get_critical(ex);\r\nBIO_printf(out, ": %s\n", j ? "critical":"","");\r\nif(!X509V3_EXT_print(out, ex, 0, 16)) {\r\nBIO_printf(out, "%16s", "");\r\nM_ASN1_OCTET_STRING_print(out,ex->value);\r\n}\r\nBIO_write(out,"\n",1);\r\n}
