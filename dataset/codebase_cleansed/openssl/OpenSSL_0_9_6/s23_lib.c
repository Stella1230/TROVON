static long ssl23_default_timeout(void)\r\n{\r\nreturn(300);\r\n}\r\nSSL_METHOD *sslv23_base_method(void)\r\n{\r\nreturn(&SSLv23_data);\r\n}\r\nstatic int ssl23_num_ciphers(void)\r\n{\r\nreturn(ssl3_num_ciphers()\r\n#ifndef NO_SSL2\r\n+ ssl2_num_ciphers()\r\n#endif\r\n);\r\n}\r\nstatic SSL_CIPHER *ssl23_get_cipher(unsigned int u)\r\n{\r\nunsigned int uu=ssl3_num_ciphers();\r\nif (u < uu)\r\nreturn(ssl3_get_cipher(u));\r\nelse\r\n#ifndef NO_SSL2\r\nreturn(ssl2_get_cipher(u-uu));\r\n#else\r\nreturn(NULL);\r\n#endif\r\n}\r\nstatic SSL_CIPHER *ssl23_get_cipher_by_char(const unsigned char *p)\r\n{\r\nSSL_CIPHER c,*cp;\r\nunsigned long id;\r\nint n;\r\nn=ssl3_num_ciphers();\r\nid=0x03000000|((unsigned long)p[0]<<16L)|\r\n((unsigned long)p[1]<<8L)|(unsigned long)p[2];\r\nc.id=id;\r\ncp=ssl3_get_cipher_by_char(p);\r\n#ifndef NO_SSL2\r\nif (cp == NULL)\r\ncp=ssl2_get_cipher_by_char(p);\r\n#endif\r\nreturn(cp);\r\n}\r\nstatic int ssl23_put_cipher_by_char(const SSL_CIPHER *c, unsigned char *p)\r\n{\r\nlong l;\r\nif (p != NULL)\r\n{\r\nl=c->id;\r\np[0]=((unsigned char)(l>>16L))&0xFF;\r\np[1]=((unsigned char)(l>> 8L))&0xFF;\r\np[2]=((unsigned char)(l ))&0xFF;\r\n}\r\nreturn(3);\r\n}\r\nstatic int ssl23_read(SSL *s, void *buf, int len)\r\n{\r\nint n;\r\n#if 0\r\nif (s->shutdown & SSL_RECEIVED_SHUTDOWN)\r\n{\r\ns->rwstate=SSL_NOTHING;\r\nreturn(0);\r\n}\r\n#endif\r\nclear_sys_error();\r\nif (SSL_in_init(s) && (!s->in_handshake))\r\n{\r\nn=s->handshake_func(s);\r\nif (n < 0) return(n);\r\nif (n == 0)\r\n{\r\nSSLerr(SSL_F_SSL23_READ,SSL_R_SSL_HANDSHAKE_FAILURE);\r\nreturn(-1);\r\n}\r\nreturn(SSL_read(s,buf,len));\r\n}\r\nelse\r\n{\r\nssl_undefined_function(s);\r\nreturn(-1);\r\n}\r\n}\r\nstatic int ssl23_write(SSL *s, const void *buf, int len)\r\n{\r\nint n;\r\n#if 0\r\nif (s->shutdown & SSL_SENT_SHUTDOWN)\r\n{\r\ns->rwstate=SSL_NOTHING;\r\nreturn(0);\r\n}\r\n#endif\r\nclear_sys_error();\r\nif (SSL_in_init(s) && (!s->in_handshake))\r\n{\r\nn=s->handshake_func(s);\r\nif (n < 0) return(n);\r\nif (n == 0)\r\n{\r\nSSLerr(SSL_F_SSL23_WRITE,SSL_R_SSL_HANDSHAKE_FAILURE);\r\nreturn(-1);\r\n}\r\nreturn(SSL_write(s,buf,len));\r\n}\r\nelse\r\n{\r\nssl_undefined_function(s);\r\nreturn(-1);\r\n}\r\n}
