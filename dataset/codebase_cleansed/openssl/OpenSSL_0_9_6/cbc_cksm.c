DES_LONG des_cbc_cksum(const unsigned char *in, des_cblock *output,\r\nlong length,\r\ndes_key_schedule schedule, const_des_cblock *ivec)\r\n{\r\nregister DES_LONG tout0,tout1,tin0,tin1;\r\nregister long l=length;\r\nDES_LONG tin[2];\r\nunsigned char *out = &(*output)[0];\r\nconst unsigned char *iv = &(*ivec)[0];\r\nc2l(iv,tout0);\r\nc2l(iv,tout1);\r\nfor (; l>0; l-=8)\r\n{\r\nif (l >= 8)\r\n{\r\nc2l(in,tin0);\r\nc2l(in,tin1);\r\n}\r\nelse\r\nc2ln(in,tin0,tin1,l);\r\ntin0^=tout0; tin[0]=tin0;\r\ntin1^=tout1; tin[1]=tin1;\r\ndes_encrypt((DES_LONG *)tin,schedule,DES_ENCRYPT);\r\ntout0=tin[0];\r\ntout1=tin[1];\r\n}\r\nif (out != NULL)\r\n{\r\nl2c(tout0,out);\r\nl2c(tout1,out);\r\n}\r\ntout0=tin0=tin1=tin[0]=tin[1]=0;\r\nreturn(tout1);\r\n}
