main(argc,argv)\r\nint argc;\r\nchar *argv[];\r\n{\r\nBN_CTX ctx;\r\nBIGNUM a,b,c,r,rr,t,l;\r\nint j,i,size=SIZE,num=NUM,mod=MOD;\r\nchar *start,*end;\r\nBN_MONT_CTX mont;\r\ndouble d,md;\r\nBN_MONT_CTX_init(&mont);\r\nBN_CTX_init(&ctx);\r\nBN_init(&a);\r\nBN_init(&b);\r\nBN_init(&c);\r\nBN_init(&r);\r\nstart=ms_time_new();\r\nend=ms_time_new();\r\nwhile (size <= 1024*8)\r\n{\r\nBN_rand(&a,size,0,0);\r\nBN_rand(&b,size,1,0);\r\nBN_rand(&c,size,0,1);\r\nBN_mod(&a,&a,&c,&ctx);\r\nms_time_get(start);\r\nfor (i=0; i<10; i++)\r\nBN_MONT_CTX_set(&mont,&c,&ctx);\r\nms_time_get(end);\r\nmd=ms_time_diff(start,end);\r\nms_time_get(start);\r\nfor (i=0; i<num; i++)\r\n{\r\nBN_mod_exp_mont(&r,&a,&b,&c,&ctx,&mont);\r\n}\r\nms_time_get(end);\r\nd=ms_time_diff(start,end);\r\nprintf("%5d bit:%6.2f %6d %6.4f %4d m_set(%5.4f)\n",size,\r\nd,num,d/num,(int)((d/num)*mod),md/10.0);\r\nnum/=8;\r\nmod/=8;\r\nif (num <= 0) num=1;\r\nsize*=2;\r\n}\r\n}
