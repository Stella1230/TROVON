int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,\r\nPSTR cmdline, int iCmdShow)\r\n{\r\nstatic char appname[] = "OpenSSL";\r\nHWND hwnd;\r\nMSG msg;\r\nWNDCLASSEX wndclass;\r\nchar buffer[200];\r\nif (cmdline[0] == '\0')\r\nfilename = RAND_file_name(buffer, sizeof buffer);\r\nelse\r\nfilename = cmdline;\r\nRAND_load_file(filename, -1);\r\nwndclass.cbSize = sizeof(wndclass);\r\nwndclass.style = CS_HREDRAW | CS_VREDRAW;\r\nwndclass.lpfnWndProc = WndProc;\r\nwndclass.cbClsExtra = 0;\r\nwndclass.cbWndExtra = 0;\r\nwndclass.hInstance = hInstance;\r\nwndclass.hIcon = LoadIcon(NULL, IDI_APPLICATION);\r\nwndclass.hCursor = LoadCursor(NULL, IDC_ARROW);\r\nwndclass.hbrBackground = (HBRUSH) GetStockObject(WHITE_BRUSH);\r\nwndclass.lpszMenuName = NULL;\r\nwndclass.lpszClassName = appname;\r\nwndclass.hIconSm = LoadIcon(NULL, IDI_APPLICATION);\r\nRegisterClassEx(&wndclass);\r\nhwnd = CreateWindow(appname, OPENSSL_VERSION_TEXT,\r\nWS_OVERLAPPEDWINDOW, CW_USEDEFAULT, CW_USEDEFAULT,\r\nCW_USEDEFAULT, CW_USEDEFAULT, NULL, NULL, hInstance, NULL);\r\nShowWindow(hwnd, iCmdShow);\r\nUpdateWindow(hwnd);\r\nwhile (GetMessage(&msg, NULL, 0, 0))\r\n{\r\nTranslateMessage(&msg);\r\nDispatchMessage(&msg);\r\n}\r\nreturn msg.wParam;\r\n}\r\nLRESULT CALLBACK WndProc(HWND hwnd, UINT iMsg, WPARAM wParam, LPARAM lParam)\r\n{\r\nHDC hdc;\r\nPAINTSTRUCT ps;\r\nRECT rect;\r\nstatic int seeded = 0;\r\nswitch (iMsg)\r\n{\r\ncase WM_PAINT:\r\nhdc = BeginPaint(hwnd, &ps);\r\nGetClientRect(hwnd, &rect);\r\nDrawText(hdc, "Seeding the PRNG. Please move the mouse!", -1,\r\n&rect, DT_SINGLELINE | DT_CENTER | DT_VCENTER);\r\nEndPaint(hwnd, &ps);\r\nreturn 0;\r\ncase WM_DESTROY:\r\nPostQuitMessage(0);\r\nreturn 0;\r\n}\r\nif (RAND_event(iMsg, wParam, lParam) == 1 && seeded == 0)\r\n{\r\nseeded = 1;\r\nif (RAND_write_file(filename) <= 0)\r\nMessageBox(hwnd, "Couldn't write random file!",\r\n"OpenSSL", MB_OK | MB_ICONERROR);\r\nPostQuitMessage(0);\r\n}\r\nreturn DefWindowProc(hwnd, iMsg, wParam, lParam);\r\n}
