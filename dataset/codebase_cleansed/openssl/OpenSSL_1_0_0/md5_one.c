unsigned char *MD5(const unsigned char *d, size_t n, unsigned char *md)\r\n{\r\nMD5_CTX c;\r\nstatic unsigned char m[MD5_DIGEST_LENGTH];\r\nif (md == NULL) md=m;\r\nif (!MD5_Init(&c))\r\nreturn NULL;\r\n#ifndef CHARSET_EBCDIC\r\nMD5_Update(&c,d,n);\r\n#else\r\n{\r\nchar temp[1024];\r\nunsigned long chunk;\r\nwhile (n > 0)\r\n{\r\nchunk = (n > sizeof(temp)) ? sizeof(temp) : n;\r\nebcdic2ascii(temp, d, chunk);\r\nMD5_Update(&c,temp,chunk);\r\nn -= chunk;\r\nd += chunk;\r\n}\r\n}\r\n#endif\r\nMD5_Final(md,&c);\r\nOPENSSL_cleanse(&c,sizeof(c));\r\nreturn(md);\r\n}
