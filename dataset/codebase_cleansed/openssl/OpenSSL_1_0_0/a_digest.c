int ASN1_digest(i2d_of_void *i2d, const EVP_MD *type, char *data,\r\nunsigned char *md, unsigned int *len)\r\n{\r\nint i;\r\nunsigned char *str,*p;\r\ni=i2d(data,NULL);\r\nif ((str=(unsigned char *)OPENSSL_malloc(i)) == NULL)\r\n{\r\nASN1err(ASN1_F_ASN1_DIGEST,ERR_R_MALLOC_FAILURE);\r\nreturn(0);\r\n}\r\np=str;\r\ni2d(data,&p);\r\nEVP_Digest(str, i, md, len, type, NULL);\r\nOPENSSL_free(str);\r\nreturn(1);\r\n}\r\nint ASN1_item_digest(const ASN1_ITEM *it, const EVP_MD *type, void *asn,\r\nunsigned char *md, unsigned int *len)\r\n{\r\nint i;\r\nunsigned char *str = NULL;\r\ni=ASN1_item_i2d(asn,&str, it);\r\nif (!str) return(0);\r\nEVP_Digest(str, i, md, len, type, NULL);\r\nOPENSSL_free(str);\r\nreturn(1);\r\n}
