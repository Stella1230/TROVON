const char *LP_find_file(LP_DIR_CTX **ctx, const char *directory)\r\n{\r\nstruct dirent *direntry = NULL;\r\nif (ctx == NULL || directory == NULL)\r\n{\r\nerrno = EINVAL;\r\nreturn 0;\r\n}\r\nerrno = 0;\r\nif (*ctx == NULL)\r\n{\r\n*ctx = (LP_DIR_CTX *)malloc(sizeof(LP_DIR_CTX));\r\nif (*ctx == NULL)\r\n{\r\nerrno = ENOMEM;\r\nreturn 0;\r\n}\r\nmemset(*ctx, '\0', sizeof(LP_DIR_CTX));\r\n(*ctx)->dir = opendir(directory);\r\nif ((*ctx)->dir == NULL)\r\n{\r\nint save_errno = errno;\r\nfree(*ctx);\r\n*ctx = NULL;\r\nerrno = save_errno;\r\nreturn 0;\r\n}\r\n}\r\ndirentry = readdir((*ctx)->dir);\r\nif (direntry == NULL)\r\n{\r\nreturn 0;\r\n}\r\nstrncpy((*ctx)->entry_name, direntry->d_name, sizeof((*ctx)->entry_name) - 1);\r\n(*ctx)->entry_name[sizeof((*ctx)->entry_name) - 1] = '\0';\r\nreturn (*ctx)->entry_name;\r\n}\r\nint LP_find_file_end(LP_DIR_CTX **ctx)\r\n{\r\nif (ctx != NULL && *ctx != NULL)\r\n{\r\nint ret = closedir((*ctx)->dir);\r\nfree(*ctx);\r\nswitch (ret)\r\n{\r\ncase 0:\r\nreturn 1;\r\ncase -1:\r\nreturn 0;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nerrno = EINVAL;\r\nreturn 0;\r\n}
