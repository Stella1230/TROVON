int RAND_poll(void)\r\n{\r\nlong pid, iosb[2];\r\nint status = 0;\r\nstruct\r\n{\r\nshort length, code;\r\nlong *buffer;\r\nint *retlen;\r\n} item[32], *pitem;\r\nunsigned char data_buffer[256];\r\nshort total_length = 0;\r\nstruct items_data_st *pitems_data;\r\npitems_data = items_data;\r\npitem = item;\r\nwhile (pitems_data->length\r\n&& (total_length + pitems_data->length <= 256))\r\n{\r\npitem->length = pitems_data->length;\r\npitem->code = pitems_data->code;\r\npitem->buffer = (long *)&data_buffer[total_length];\r\npitem->retlen = 0;\r\ntotal_length += pitems_data->length;\r\npitems_data++;\r\npitem++;\r\n}\r\npitem->length = pitem->code = 0;\r\npid = -1;\r\nwhile ((status = sys$getjpiw(0, &pid, 0, item, iosb, 0, 0))\r\n!= SS$_NOMOREPROC)\r\n{\r\nif (status == SS$_NORMAL)\r\n{\r\nRAND_add(data_buffer, total_length, total_length/2);\r\n}\r\n}\r\nsys$gettim(iosb);\r\nRAND_add((unsigned char *)iosb, sizeof(iosb), sizeof(iosb)/2);\r\nreturn 1;\r\n}
