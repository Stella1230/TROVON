int RAND_set_rand_method(const RAND_METHOD *meth)\r\n{\r\n#ifndef OPENSSL_NO_ENGINE\r\nif(funct_ref)\r\n{\r\nENGINE_finish(funct_ref);\r\nfunct_ref = NULL;\r\n}\r\n#endif\r\ndefault_RAND_meth = meth;\r\nreturn 1;\r\n}\r\nconst RAND_METHOD *RAND_get_rand_method(void)\r\n{\r\nif (!default_RAND_meth)\r\n{\r\n#ifndef OPENSSL_NO_ENGINE\r\nENGINE *e = ENGINE_get_default_RAND();\r\nif(e)\r\n{\r\ndefault_RAND_meth = ENGINE_get_RAND(e);\r\nif(!default_RAND_meth)\r\n{\r\nENGINE_finish(e);\r\ne = NULL;\r\n}\r\n}\r\nif(e)\r\nfunct_ref = e;\r\nelse\r\n#endif\r\ndefault_RAND_meth = RAND_SSLeay();\r\n}\r\nreturn default_RAND_meth;\r\n}\r\nint RAND_set_rand_engine(ENGINE *engine)\r\n{\r\nconst RAND_METHOD *tmp_meth = NULL;\r\nif(engine)\r\n{\r\nif(!ENGINE_init(engine))\r\nreturn 0;\r\ntmp_meth = ENGINE_get_RAND(engine);\r\nif(!tmp_meth)\r\n{\r\nENGINE_finish(engine);\r\nreturn 0;\r\n}\r\n}\r\nRAND_set_rand_method(tmp_meth);\r\nfunct_ref = engine;\r\nreturn 1;\r\n}\r\nvoid RAND_cleanup(void)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->cleanup)\r\nmeth->cleanup();\r\nRAND_set_rand_method(NULL);\r\n}\r\nvoid RAND_seed(const void *buf, int num)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->seed)\r\nmeth->seed(buf,num);\r\n}\r\nvoid RAND_add(const void *buf, int num, double entropy)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->add)\r\nmeth->add(buf,num,entropy);\r\n}\r\nint RAND_bytes(unsigned char *buf, int num)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->bytes)\r\nreturn meth->bytes(buf,num);\r\nreturn(-1);\r\n}\r\nint RAND_pseudo_bytes(unsigned char *buf, int num)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->pseudorand)\r\nreturn meth->pseudorand(buf,num);\r\nreturn(-1);\r\n}\r\nint RAND_status(void)\r\n{\r\nconst RAND_METHOD *meth = RAND_get_rand_method();\r\nif (meth && meth->status)\r\nreturn meth->status();\r\nreturn 0;\r\n}
