void ENGINE_unregister_ciphers(ENGINE *e)\r\n{\r\nengine_table_unregister(&cipher_table, e);\r\n}\r\nstatic void engine_unregister_all_ciphers(void)\r\n{\r\nengine_table_cleanup(&cipher_table);\r\n}\r\nint ENGINE_register_ciphers(ENGINE *e)\r\n{\r\nif(e->ciphers)\r\n{\r\nconst int *nids;\r\nint num_nids = e->ciphers(e, NULL, &nids, 0);\r\nif(num_nids > 0)\r\nreturn engine_table_register(&cipher_table,\r\nengine_unregister_all_ciphers, e, nids,\r\nnum_nids, 0);\r\n}\r\nreturn 1;\r\n}\r\nvoid ENGINE_register_all_ciphers()\r\n{\r\nENGINE *e;\r\nfor(e=ENGINE_get_first() ; e ; e=ENGINE_get_next(e))\r\nENGINE_register_ciphers(e);\r\n}\r\nint ENGINE_set_default_ciphers(ENGINE *e)\r\n{\r\nif(e->ciphers)\r\n{\r\nconst int *nids;\r\nint num_nids = e->ciphers(e, NULL, &nids, 0);\r\nif(num_nids > 0)\r\nreturn engine_table_register(&cipher_table,\r\nengine_unregister_all_ciphers, e, nids,\r\nnum_nids, 1);\r\n}\r\nreturn 1;\r\n}\r\nENGINE *ENGINE_get_cipher_engine(int nid)\r\n{\r\nreturn engine_table_select(&cipher_table, nid);\r\n}\r\nconst EVP_CIPHER *ENGINE_get_cipher(ENGINE *e, int nid)\r\n{\r\nconst EVP_CIPHER *ret;\r\nENGINE_CIPHERS_PTR fn = ENGINE_get_ciphers(e);\r\nif(!fn || !fn(e, &ret, NULL, nid))\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_GET_CIPHER,\r\nENGINE_R_UNIMPLEMENTED_CIPHER);\r\nreturn NULL;\r\n}\r\nreturn ret;\r\n}\r\nENGINE_CIPHERS_PTR ENGINE_get_ciphers(const ENGINE *e)\r\n{\r\nreturn e->ciphers;\r\n}\r\nint ENGINE_set_ciphers(ENGINE *e, ENGINE_CIPHERS_PTR f)\r\n{\r\ne->ciphers = f;\r\nreturn 1;\r\n}
