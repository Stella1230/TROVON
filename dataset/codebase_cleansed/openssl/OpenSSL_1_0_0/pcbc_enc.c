void DES_pcbc_encrypt(const unsigned char *input, unsigned char *output,\r\nlong length, DES_key_schedule *schedule,\r\nDES_cblock *ivec, int enc)\r\n{\r\nregister DES_LONG sin0,sin1,xor0,xor1,tout0,tout1;\r\nDES_LONG tin[2];\r\nconst unsigned char *in;\r\nunsigned char *out,*iv;\r\nin=input;\r\nout=output;\r\niv = &(*ivec)[0];\r\nif (enc)\r\n{\r\nc2l(iv,xor0);\r\nc2l(iv,xor1);\r\nfor (; length>0; length-=8)\r\n{\r\nif (length >= 8)\r\n{\r\nc2l(in,sin0);\r\nc2l(in,sin1);\r\n}\r\nelse\r\nc2ln(in,sin0,sin1,length);\r\ntin[0]=sin0^xor0;\r\ntin[1]=sin1^xor1;\r\nDES_encrypt1((DES_LONG *)tin,schedule,DES_ENCRYPT);\r\ntout0=tin[0];\r\ntout1=tin[1];\r\nxor0=sin0^tout0;\r\nxor1=sin1^tout1;\r\nl2c(tout0,out);\r\nl2c(tout1,out);\r\n}\r\n}\r\nelse\r\n{\r\nc2l(iv,xor0); c2l(iv,xor1);\r\nfor (; length>0; length-=8)\r\n{\r\nc2l(in,sin0);\r\nc2l(in,sin1);\r\ntin[0]=sin0;\r\ntin[1]=sin1;\r\nDES_encrypt1((DES_LONG *)tin,schedule,DES_DECRYPT);\r\ntout0=tin[0]^xor0;\r\ntout1=tin[1]^xor1;\r\nif (length >= 8)\r\n{\r\nl2c(tout0,out);\r\nl2c(tout1,out);\r\n}\r\nelse\r\nl2cn(tout0,tout1,out,length);\r\nxor0=tout0^sin0;\r\nxor1=tout1^sin1;\r\n}\r\n}\r\ntin[0]=tin[1]=0;\r\nsin0=sin1=xor0=xor1=tout0=tout1=0;\r\n}
