EC_GROUP *EC_GROUP_new_curve_GFp(const BIGNUM *p, const BIGNUM *a, const BIGNUM *b, BN_CTX *ctx)\r\n{\r\nconst EC_METHOD *meth;\r\nEC_GROUP *ret;\r\nmeth = EC_GFp_nist_method();\r\nret = EC_GROUP_new(meth);\r\nif (ret == NULL)\r\nreturn NULL;\r\nif (!EC_GROUP_set_curve_GFp(ret, p, a, b, ctx))\r\n{\r\nunsigned long err;\r\nerr = ERR_peek_last_error();\r\nif (!(ERR_GET_LIB(err) == ERR_LIB_EC &&\r\n((ERR_GET_REASON(err) == EC_R_NOT_A_NIST_PRIME) ||\r\n(ERR_GET_REASON(err) == EC_R_NOT_A_SUPPORTED_NIST_PRIME))))\r\n{\r\nEC_GROUP_clear_free(ret);\r\nreturn NULL;\r\n}\r\nERR_clear_error();\r\nEC_GROUP_clear_free(ret);\r\nmeth = EC_GFp_mont_method();\r\nret = EC_GROUP_new(meth);\r\nif (ret == NULL)\r\nreturn NULL;\r\nif (!EC_GROUP_set_curve_GFp(ret, p, a, b, ctx))\r\n{\r\nEC_GROUP_clear_free(ret);\r\nreturn NULL;\r\n}\r\n}\r\nreturn ret;\r\n}\r\nEC_GROUP *EC_GROUP_new_curve_GF2m(const BIGNUM *p, const BIGNUM *a, const BIGNUM *b, BN_CTX *ctx)\r\n{\r\nconst EC_METHOD *meth;\r\nEC_GROUP *ret;\r\nmeth = EC_GF2m_simple_method();\r\nret = EC_GROUP_new(meth);\r\nif (ret == NULL)\r\nreturn NULL;\r\nif (!EC_GROUP_set_curve_GF2m(ret, p, a, b, ctx))\r\n{\r\nEC_GROUP_clear_free(ret);\r\nreturn NULL;\r\n}\r\nreturn ret;\r\n}
