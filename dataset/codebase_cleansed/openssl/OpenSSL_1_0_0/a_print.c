int ASN1_PRINTABLE_type(const unsigned char *s, int len)\r\n{\r\nint c;\r\nint ia5=0;\r\nint t61=0;\r\nif (len <= 0) len= -1;\r\nif (s == NULL) return(V_ASN1_PRINTABLESTRING);\r\nwhile ((*s) && (len-- != 0))\r\n{\r\nc= *(s++);\r\n#ifndef CHARSET_EBCDIC\r\nif (!( ((c >= 'a') && (c <= 'z')) ||\r\n((c >= 'A') && (c <= 'Z')) ||\r\n(c == ' ') ||\r\n((c >= '0') && (c <= '9')) ||\r\n(c == ' ') || (c == '\'') ||\r\n(c == '(') || (c == ')') ||\r\n(c == '+') || (c == ',') ||\r\n(c == '-') || (c == '.') ||\r\n(c == '/') || (c == ':') ||\r\n(c == '=') || (c == '?')))\r\nia5=1;\r\nif (c&0x80)\r\nt61=1;\r\n#else\r\nif (!isalnum(c) && (c != ' ') &&\r\nstrchr("'()+,-./:=?", c) == NULL)\r\nia5=1;\r\nif (os_toascii[c] & 0x80)\r\nt61=1;\r\n#endif\r\n}\r\nif (t61) return(V_ASN1_T61STRING);\r\nif (ia5) return(V_ASN1_IA5STRING);\r\nreturn(V_ASN1_PRINTABLESTRING);\r\n}\r\nint ASN1_UNIVERSALSTRING_to_string(ASN1_UNIVERSALSTRING *s)\r\n{\r\nint i;\r\nunsigned char *p;\r\nif (s->type != V_ASN1_UNIVERSALSTRING) return(0);\r\nif ((s->length%4) != 0) return(0);\r\np=s->data;\r\nfor (i=0; i<s->length; i+=4)\r\n{\r\nif ((p[0] != '\0') || (p[1] != '\0') || (p[2] != '\0'))\r\nbreak;\r\nelse\r\np+=4;\r\n}\r\nif (i < s->length) return(0);\r\np=s->data;\r\nfor (i=3; i<s->length; i+=4)\r\n{\r\n*(p++)=s->data[i];\r\n}\r\n*(p)='\0';\r\ns->length/=4;\r\ns->type=ASN1_PRINTABLE_type(s->data,s->length);\r\nreturn(1);\r\n}
