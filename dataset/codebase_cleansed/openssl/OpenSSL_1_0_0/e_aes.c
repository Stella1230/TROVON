static int aes_init_key(EVP_CIPHER_CTX *ctx, const unsigned char *key,\r\nconst unsigned char *iv, int enc)\r\n{\r\nint ret;\r\nif ((ctx->cipher->flags & EVP_CIPH_MODE) == EVP_CIPH_CFB_MODE\r\n|| (ctx->cipher->flags & EVP_CIPH_MODE) == EVP_CIPH_OFB_MODE\r\n|| enc)\r\nret=AES_set_encrypt_key(key, ctx->key_len * 8, ctx->cipher_data);\r\nelse\r\nret=AES_set_decrypt_key(key, ctx->key_len * 8, ctx->cipher_data);\r\nif(ret < 0)\r\n{\r\nEVPerr(EVP_F_AES_INIT_KEY,EVP_R_AES_KEY_SETUP_FAILED);\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}
