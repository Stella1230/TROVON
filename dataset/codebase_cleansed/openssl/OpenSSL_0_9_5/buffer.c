BUF_MEM *BUF_MEM_new(void)\r\n{\r\nBUF_MEM *ret;\r\nret=Malloc(sizeof(BUF_MEM));\r\nif (ret == NULL)\r\n{\r\nBUFerr(BUF_F_BUF_MEM_NEW,ERR_R_MALLOC_FAILURE);\r\nreturn(NULL);\r\n}\r\nret->length=0;\r\nret->max=0;\r\nret->data=NULL;\r\nreturn(ret);\r\n}\r\nvoid BUF_MEM_free(BUF_MEM *a)\r\n{\r\nif(a == NULL)\r\nreturn;\r\nif (a->data != NULL)\r\n{\r\nmemset(a->data,0,(unsigned int)a->max);\r\nFree(a->data);\r\n}\r\nFree(a);\r\n}\r\nint BUF_MEM_grow(BUF_MEM *str, int len)\r\n{\r\nchar *ret;\r\nunsigned int n;\r\nif (str->length >= len)\r\n{\r\nstr->length=len;\r\nreturn(len);\r\n}\r\nif (str->max >= len)\r\n{\r\nmemset(&str->data[str->length],0,len-str->length);\r\nstr->length=len;\r\nreturn(len);\r\n}\r\nn=(len+3)/3*4;\r\nif (str->data == NULL)\r\nret=Malloc(n);\r\nelse\r\nret=Realloc(str->data,n);\r\nif (ret == NULL)\r\n{\r\nBUFerr(BUF_F_BUF_MEM_GROW,ERR_R_MALLOC_FAILURE);\r\nlen=0;\r\n}\r\nelse\r\n{\r\nstr->data=ret;\r\nstr->length=len;\r\nstr->max=n;\r\n}\r\nreturn(len);\r\n}\r\nchar *BUF_strdup(const char *str)\r\n{\r\nchar *ret;\r\nint n;\r\nif (str == NULL) return(NULL);\r\nn=strlen(str);\r\nret=Malloc(n+1);\r\nif (ret == NULL)\r\n{\r\nBUFerr(BUF_F_BUF_STRDUP,ERR_R_MALLOC_FAILURE);\r\nreturn(NULL);\r\n}\r\nmemcpy(ret,str,n+1);\r\nreturn(ret);\r\n}
