void callback(stage,count,arg)\r\nint stage,count;\r\nchar *arg;\r\n{\r\nFILE *out;\r\nout=(FILE *)arg;\r\nfprintf(out,"%d",stage);\r\nif (stage == 3)\r\nfprintf(out,"\n");\r\nfflush(out);\r\n}\r\nmain()\r\n{\r\nRSA *rsa,*pub_rsa,*priv_rsa;\r\nint len;\r\nunsigned char buf[1024],*p;\r\nrsa=RSA_generate_key(512,RSA_F4,callback,(char *)stdout);\r\np=buf;\r\nlen=i2d_RSAPublicKey(rsa,&p);\r\nlen+=i2d_RSAPrivateKey(rsa,&p);\r\nprintf("The public and private key are now both in a char array\n");\r\nprintf("and are taking up %d bytes\n",len);\r\nRSA_free(rsa);\r\np=buf;\r\npub_rsa=d2i_RSAPublicKey(NULL,&p,(long)len);\r\nlen-=(p-buf);\r\npriv_rsa=d2i_RSAPrivateKey(NULL,&p,(long)len);\r\nif ((pub_rsa == NULL) || (priv_rsa == NULL))\r\nERR_print_errors_fp(stderr);\r\nRSA_free(pub_rsa);\r\nRSA_free(priv_rsa);\r\n}
