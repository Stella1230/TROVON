ASN1_OBJECT *OBJ_dup(ASN1_OBJECT *o)\r\n{\r\nASN1_OBJECT *r;\r\nint i;\r\nchar *ln=NULL;\r\nif (o == NULL) return(NULL);\r\nif (!(o->flags & ASN1_OBJECT_FLAG_DYNAMIC))\r\nreturn(o);\r\nr=ASN1_OBJECT_new();\r\nif (r == NULL)\r\n{\r\nOBJerr(OBJ_F_OBJ_DUP,ERR_R_ASN1_LIB);\r\nreturn(NULL);\r\n}\r\nr->data=Malloc(o->length);\r\nif (r->data == NULL)\r\ngoto err;\r\nmemcpy(r->data,o->data,o->length);\r\nr->length=o->length;\r\nr->nid=o->nid;\r\nr->ln=r->sn=NULL;\r\nif (o->ln != NULL)\r\n{\r\ni=strlen(o->ln)+1;\r\nr->ln=ln=Malloc(i);\r\nif (r->ln == NULL) goto err;\r\nmemcpy(ln,o->ln,i);\r\n}\r\nif (o->sn != NULL)\r\n{\r\nchar *s;\r\ni=strlen(o->sn)+1;\r\nr->sn=s=Malloc(i);\r\nif (r->sn == NULL) goto err;\r\nmemcpy(s,o->sn,i);\r\n}\r\nr->flags=o->flags|(ASN1_OBJECT_FLAG_DYNAMIC|\r\nASN1_OBJECT_FLAG_DYNAMIC_STRINGS|ASN1_OBJECT_FLAG_DYNAMIC_DATA);\r\nreturn(r);\r\nerr:\r\nOBJerr(OBJ_F_OBJ_DUP,ERR_R_MALLOC_FAILURE);\r\nif (r != NULL)\r\n{\r\nif (ln != NULL) Free(ln);\r\nif (r->data != NULL) Free(r->data);\r\nFree(r);\r\n}\r\nreturn(NULL);\r\n}\r\nint OBJ_cmp(ASN1_OBJECT *a, ASN1_OBJECT *b)\r\n{\r\nint ret;\r\nret=(a->length-b->length);\r\nif (ret) return(ret);\r\nreturn(memcmp(a->data,b->data,a->length));\r\n}
