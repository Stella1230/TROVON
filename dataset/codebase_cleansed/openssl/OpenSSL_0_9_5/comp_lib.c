COMP_CTX *COMP_CTX_new(COMP_METHOD *meth)\r\n{\r\nCOMP_CTX *ret;\r\nif ((ret=(COMP_CTX *)Malloc(sizeof(COMP_CTX))) == NULL)\r\n{\r\nreturn(NULL);\r\n}\r\nmemset(ret,0,sizeof(COMP_CTX));\r\nret->meth=meth;\r\nif ((ret->meth->init != NULL) && !ret->meth->init(ret))\r\n{\r\nFree(ret);\r\nret=NULL;\r\n}\r\n#if 0\r\nelse\r\nCRYPTO_new_ex_data(rsa_meth,(char *)ret,&ret->ex_data);\r\n#endif\r\nreturn(ret);\r\n}\r\nvoid COMP_CTX_free(COMP_CTX *ctx)\r\n{\r\nif(ctx == NULL)\r\nreturn;\r\nif (ctx->meth->finish != NULL)\r\nctx->meth->finish(ctx);\r\nFree(ctx);\r\n}\r\nint COMP_compress_block(COMP_CTX *ctx, unsigned char *out, int olen,\r\nunsigned char *in, int ilen)\r\n{\r\nint ret;\r\nif (ctx->meth->compress == NULL)\r\n{\r\nreturn(-1);\r\n}\r\nret=ctx->meth->compress(ctx,out,olen,in,ilen);\r\nif (ret > 0)\r\n{\r\nctx->compress_in+=ilen;\r\nctx->compress_out+=ret;\r\n}\r\nreturn(ret);\r\n}\r\nint COMP_expand_block(COMP_CTX *ctx, unsigned char *out, int olen,\r\nunsigned char *in, int ilen)\r\n{\r\nint ret;\r\nif (ctx->meth->expand == NULL)\r\n{\r\nreturn(-1);\r\n}\r\nret=ctx->meth->expand(ctx,out,olen,in,ilen);\r\nif (ret > 0)\r\n{\r\nctx->expand_in+=ilen;\r\nctx->expand_out+=ret;\r\n}\r\nreturn(ret);\r\n}
