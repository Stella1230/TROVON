long MS_CALLBACK BIO_debug_callback(BIO *bio, int cmd, const char *argp,\r\nint argi, long argl, long ret)\r\n{\r\nBIO *b;\r\nMS_STATIC char buf[256];\r\nchar *p;\r\nlong r=1;\r\nif (BIO_CB_RETURN & cmd)\r\nr=ret;\r\nsprintf(buf,"BIO[%08lX]:",(unsigned long)bio);\r\np= &(buf[14]);\r\nswitch (cmd)\r\n{\r\ncase BIO_CB_FREE:\r\nsprintf(p,"Free - %s\n",bio->method->name);\r\nbreak;\r\ncase BIO_CB_READ:\r\nif (bio->method->type & BIO_TYPE_DESCRIPTOR)\r\nsprintf(p,"read(%d,%d) - %s fd=%d\n",bio->num,argi,bio->method->name,bio->num);\r\nelse\r\nsprintf(p,"read(%d,%d) - %s\n",bio->num,argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_WRITE:\r\nif (bio->method->type & BIO_TYPE_DESCRIPTOR)\r\nsprintf(p,"write(%d,%d) - %s fd=%d\n",bio->num,argi,bio->method->name,bio->num);\r\nelse\r\nsprintf(p,"write(%d,%d) - %s\n",bio->num,argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_PUTS:\r\nsprintf(p,"puts() - %s\n",bio->method->name);\r\nbreak;\r\ncase BIO_CB_GETS:\r\nsprintf(p,"gets(%d) - %s\n",argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_CTRL:\r\nsprintf(p,"ctrl(%d) - %s\n",argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_READ:\r\nsprintf(p,"read return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_WRITE:\r\nsprintf(p,"write return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_GETS:\r\nsprintf(p,"gets return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_PUTS:\r\nsprintf(p,"puts return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_CTRL:\r\nsprintf(p,"ctrl return %ld\n",ret);\r\nbreak;\r\ndefault:\r\nsprintf(p,"bio callback - unknown type (%d)\n",cmd);\r\nbreak;\r\n}\r\nb=(BIO *)bio->cb_arg;\r\nif (b != NULL)\r\nBIO_write(b,buf,strlen(buf));\r\n#if !defined(NO_STDIO) && !defined(WIN16)\r\nelse\r\nfputs(buf,stderr);\r\n#endif\r\nreturn(r);\r\n}
