void RC5_32_cfb64_encrypt(unsigned char *in, unsigned char *out, long length,\r\nRC5_32_KEY *schedule, unsigned char *ivec, int *num, int encrypt)\r\n{\r\nregister unsigned long v0,v1,t;\r\nregister int n= *num;\r\nregister long l=length;\r\nunsigned long ti[2];\r\nunsigned char *iv,c,cc;\r\niv=(unsigned char *)ivec;\r\nif (encrypt)\r\n{\r\nwhile (l--)\r\n{\r\nif (n == 0)\r\n{\r\nc2l(iv,v0); ti[0]=v0;\r\nc2l(iv,v1); ti[1]=v1;\r\nRC5_32_encrypt((unsigned long *)ti,schedule);\r\niv=(unsigned char *)ivec;\r\nt=ti[0]; l2c(t,iv);\r\nt=ti[1]; l2c(t,iv);\r\niv=(unsigned char *)ivec;\r\n}\r\nc= *(in++)^iv[n];\r\n*(out++)=c;\r\niv[n]=c;\r\nn=(n+1)&0x07;\r\n}\r\n}\r\nelse\r\n{\r\nwhile (l--)\r\n{\r\nif (n == 0)\r\n{\r\nc2l(iv,v0); ti[0]=v0;\r\nc2l(iv,v1); ti[1]=v1;\r\nRC5_32_encrypt((unsigned long *)ti,schedule);\r\niv=(unsigned char *)ivec;\r\nt=ti[0]; l2c(t,iv);\r\nt=ti[1]; l2c(t,iv);\r\niv=(unsigned char *)ivec;\r\n}\r\ncc= *(in++);\r\nc=iv[n];\r\niv[n]=cc;\r\n*(out++)=c^cc;\r\nn=(n+1)&0x07;\r\n}\r\n}\r\nv0=v1=ti[0]=ti[1]=t=c=cc=0;\r\n*num=n;\r\n}
