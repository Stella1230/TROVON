void lh_stats(LHASH *lh, FILE *out)\r\n{\r\nfprintf(out,"num_items = %lu\n",lh->num_items);\r\nfprintf(out,"num_nodes = %u\n",lh->num_nodes);\r\nfprintf(out,"num_alloc_nodes = %u\n",lh->num_alloc_nodes);\r\nfprintf(out,"num_expands = %lu\n",lh->num_expands);\r\nfprintf(out,"num_expand_reallocs = %lu\n",lh->num_expand_reallocs);\r\nfprintf(out,"num_contracts = %lu\n",lh->num_contracts);\r\nfprintf(out,"num_contract_reallocs = %lu\n",lh->num_contract_reallocs);\r\nfprintf(out,"num_hash_calls = %lu\n",lh->num_hash_calls);\r\nfprintf(out,"num_comp_calls = %lu\n",lh->num_comp_calls);\r\nfprintf(out,"num_insert = %lu\n",lh->num_insert);\r\nfprintf(out,"num_replace = %lu\n",lh->num_replace);\r\nfprintf(out,"num_delete = %lu\n",lh->num_delete);\r\nfprintf(out,"num_no_delete = %lu\n",lh->num_no_delete);\r\nfprintf(out,"num_retrieve = %lu\n",lh->num_retrieve);\r\nfprintf(out,"num_retrieve_miss = %lu\n",lh->num_retrieve_miss);\r\nfprintf(out,"num_hash_comps = %lu\n",lh->num_hash_comps);\r\n#ifdef DEBUG\r\nfprintf(out,"p = %u\n",lh->p);\r\nfprintf(out,"pmax = %u\n",lh->pmax);\r\nfprintf(out,"up_load = %lu\n",lh->up_load);\r\nfprintf(out,"down_load = %lu\n",lh->down_load);\r\n#endif\r\n}\r\nvoid lh_node_stats(LHASH *lh, FILE *out)\r\n{\r\nLHASH_NODE *n;\r\nunsigned int i,num;\r\nfor (i=0; i<lh->num_nodes; i++)\r\n{\r\nfor (n=lh->b[i],num=0; n != NULL; n=n->next)\r\nnum++;\r\nfprintf(out,"node %6u -> %3u\n",i,num);\r\n}\r\n}\r\nvoid lh_node_usage_stats(LHASH *lh, FILE *out)\r\n{\r\nLHASH_NODE *n;\r\nunsigned long num;\r\nunsigned int i;\r\nunsigned long total=0,n_used=0;\r\nfor (i=0; i<lh->num_nodes; i++)\r\n{\r\nfor (n=lh->b[i],num=0; n != NULL; n=n->next)\r\nnum++;\r\nif (num != 0)\r\n{\r\nn_used++;\r\ntotal+=num;\r\n}\r\n}\r\nfprintf(out,"%lu nodes used out of %u\n",n_used,lh->num_nodes);\r\nfprintf(out,"%lu items\n",total);\r\nif (n_used == 0) return;\r\nfprintf(out,"load %d.%02d actual load %d.%02d\n",\r\n(int)(total/lh->num_nodes),\r\n(int)((total%lh->num_nodes)*100/lh->num_nodes),\r\n(int)(total/n_used),\r\n(int)((total%n_used)*100/n_used));\r\n}\r\nvoid lh_stats(LHASH *lh, FILE *fp)\r\n{\r\nBIO *bp;\r\nbp=BIO_new(BIO_s_file());\r\nif (bp == NULL) goto end;\r\nBIO_set_fp(bp,fp,BIO_NOCLOSE);\r\nlh_stats_bio(lh,bp);\r\nBIO_free(bp);\r\nend:;\r\n}\r\nvoid lh_node_stats(LHASH *lh, FILE *fp)\r\n{\r\nBIO *bp;\r\nbp=BIO_new(BIO_s_file());\r\nif (bp == NULL) goto end;\r\nBIO_set_fp(bp,fp,BIO_NOCLOSE);\r\nlh_node_stats_bio(lh,bp);\r\nBIO_free(bp);\r\nend:;\r\n}\r\nvoid lh_node_usage_stats(LHASH *lh, FILE *fp)\r\n{\r\nBIO *bp;\r\nbp=BIO_new(BIO_s_file());\r\nif (bp == NULL) goto end;\r\nBIO_set_fp(bp,fp,BIO_NOCLOSE);\r\nlh_node_usage_stats_bio(lh,bp);\r\nBIO_free(bp);\r\nend:;\r\n}\r\nvoid lh_stats_bio(LHASH *lh, BIO *out)\r\n{\r\nchar buf[128];\r\nsprintf(buf,"num_items = %lu\n",lh->num_items);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_nodes = %u\n",lh->num_nodes);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_alloc_nodes = %u\n",lh->num_alloc_nodes);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_expands = %lu\n",lh->num_expands);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_expand_reallocs = %lu\n",lh->num_expand_reallocs);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_contracts = %lu\n",lh->num_contracts);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_contract_reallocs = %lu\n",lh->num_contract_reallocs);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_hash_calls = %lu\n",lh->num_hash_calls);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_comp_calls = %lu\n",lh->num_comp_calls);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_insert = %lu\n",lh->num_insert);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_replace = %lu\n",lh->num_replace);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_delete = %lu\n",lh->num_delete);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_no_delete = %lu\n",lh->num_no_delete);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_retrieve = %lu\n",lh->num_retrieve);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_retrieve_miss = %lu\n",lh->num_retrieve_miss);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"num_hash_comps = %lu\n",lh->num_hash_comps);\r\nBIO_puts(out,buf);\r\n#ifdef DEBUG\r\nsprintf(buf,"p = %u\n",lh->p);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"pmax = %u\n",lh->pmax);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"up_load = %lu\n",lh->up_load);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"down_load = %lu\n",lh->down_load);\r\nBIO_puts(out,buf);\r\n#endif\r\n}\r\nvoid lh_node_stats_bio(LHASH *lh, BIO *out)\r\n{\r\nLHASH_NODE *n;\r\nunsigned int i,num;\r\nchar buf[128];\r\nfor (i=0; i<lh->num_nodes; i++)\r\n{\r\nfor (n=lh->b[i],num=0; n != NULL; n=n->next)\r\nnum++;\r\nsprintf(buf,"node %6u -> %3u\n",i,num);\r\nBIO_puts(out,buf);\r\n}\r\n}\r\nvoid lh_node_usage_stats_bio(LHASH *lh, BIO *out)\r\n{\r\nLHASH_NODE *n;\r\nunsigned long num;\r\nunsigned int i;\r\nunsigned long total=0,n_used=0;\r\nchar buf[128];\r\nfor (i=0; i<lh->num_nodes; i++)\r\n{\r\nfor (n=lh->b[i],num=0; n != NULL; n=n->next)\r\nnum++;\r\nif (num != 0)\r\n{\r\nn_used++;\r\ntotal+=num;\r\n}\r\n}\r\nsprintf(buf,"%lu nodes used out of %u\n",n_used,lh->num_nodes);\r\nBIO_puts(out,buf);\r\nsprintf(buf,"%lu items\n",total);\r\nBIO_puts(out,buf);\r\nif (n_used == 0) return;\r\nsprintf(buf,"load %d.%02d actual load %d.%02d\n",\r\n(int)(total/lh->num_nodes),\r\n(int)((total%lh->num_nodes)*100/lh->num_nodes),\r\n(int)(total/n_used),\r\n(int)((total%n_used)*100/n_used));\r\nBIO_puts(out,buf);\r\n}
