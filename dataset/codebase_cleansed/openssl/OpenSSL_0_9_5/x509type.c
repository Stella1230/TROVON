int X509_certificate_type(X509 *x, EVP_PKEY *pkey)\r\n{\r\nEVP_PKEY *pk;\r\nint ret=0,i;\r\nif (x == NULL) return(0);\r\nif (pkey == NULL)\r\npk=X509_get_pubkey(x);\r\nelse\r\npk=pkey;\r\nif (pk == NULL) return(0);\r\nswitch (pk->type)\r\n{\r\ncase EVP_PKEY_RSA:\r\nret=EVP_PK_RSA|EVP_PKT_SIGN;\r\nret|=EVP_PKT_ENC;\r\nbreak;\r\ncase EVP_PKEY_DSA:\r\nret=EVP_PK_DSA|EVP_PKT_SIGN;\r\nbreak;\r\ncase EVP_PKEY_DH:\r\nret=EVP_PK_DH|EVP_PKT_EXCH;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\ni=X509_get_signature_type(x);\r\nswitch (i)\r\n{\r\ncase EVP_PKEY_RSA:\r\nret|=EVP_PKS_RSA;\r\nbreak;\r\ncase EVP_PKS_DSA:\r\nret|=EVP_PKS_DSA;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (EVP_PKEY_size(pk) <= 512)\r\nret|=EVP_PKT_EXP;\r\nif(pkey==NULL) EVP_PKEY_free(pk);\r\nreturn(ret);\r\n}
