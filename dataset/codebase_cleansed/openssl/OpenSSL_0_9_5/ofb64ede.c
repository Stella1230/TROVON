void des_ede3_ofb64_encrypt(register const unsigned char *in,\r\nregister unsigned char *out, long length, des_key_schedule k1,\r\ndes_key_schedule k2, des_key_schedule k3, des_cblock *ivec,\r\nint *num)\r\n{\r\nregister DES_LONG v0,v1;\r\nregister int n= *num;\r\nregister long l=length;\r\ndes_cblock d;\r\nregister char *dp;\r\nDES_LONG ti[2];\r\nunsigned char *iv;\r\nint save=0;\r\niv = &(*ivec)[0];\r\nc2l(iv,v0);\r\nc2l(iv,v1);\r\nti[0]=v0;\r\nti[1]=v1;\r\ndp=(char *)d;\r\nl2c(v0,dp);\r\nl2c(v1,dp);\r\nwhile (l--)\r\n{\r\nif (n == 0)\r\n{\r\ndes_encrypt3(ti,k1,k2,k3);\r\nv0=ti[0];\r\nv1=ti[1];\r\ndp=(char *)d;\r\nl2c(v0,dp);\r\nl2c(v1,dp);\r\nsave++;\r\n}\r\n*(out++)= *(in++)^d[n];\r\nn=(n+1)&0x07;\r\n}\r\nif (save)\r\n{\r\niv = &(*ivec)[0];\r\nl2c(v0,iv);\r\nl2c(v1,iv);\r\n}\r\nv0=v1=ti[0]=ti[1]=0;\r\n*num=n;\r\n}
