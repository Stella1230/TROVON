void des_ofb64_encrypt(register const unsigned char *in,\r\nregister unsigned char *out, long length, des_key_schedule schedule,\r\ndes_cblock *ivec, int *num)\r\n{\r\nregister DES_LONG v0,v1,t;\r\nregister int n= *num;\r\nregister long l=length;\r\ndes_cblock d;\r\nregister unsigned char *dp;\r\nDES_LONG ti[2];\r\nunsigned char *iv;\r\nint save=0;\r\niv = &(*ivec)[0];\r\nc2l(iv,v0);\r\nc2l(iv,v1);\r\nti[0]=v0;\r\nti[1]=v1;\r\ndp=d;\r\nl2c(v0,dp);\r\nl2c(v1,dp);\r\nwhile (l--)\r\n{\r\nif (n == 0)\r\n{\r\ndes_encrypt(ti,schedule,DES_ENCRYPT);\r\ndp=d;\r\nt=ti[0]; l2c(t,dp);\r\nt=ti[1]; l2c(t,dp);\r\nsave++;\r\n}\r\n*(out++)= *(in++)^d[n];\r\nn=(n+1)&0x07;\r\n}\r\nif (save)\r\n{\r\nv0=ti[0];\r\nv1=ti[1];\r\niv = &(*ivec)[0];\r\nl2c(v0,iv);\r\nl2c(v1,iv);\r\n}\r\nt=v0=v1=ti[0]=ti[1]=0;\r\n*num=n;\r\n}
