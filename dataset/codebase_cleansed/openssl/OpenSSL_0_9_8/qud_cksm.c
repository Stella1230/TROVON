DES_LONG DES_quad_cksum(const unsigned char *input, DES_cblock output[],\r\nlong length, int out_count, DES_cblock *seed)\r\n{\r\nDES_LONG z0,z1,t0,t1;\r\nint i;\r\nlong l;\r\nconst unsigned char *cp;\r\n#ifdef _CRAY\r\nstruct lp_st { int a:32; int b:32; } *lp;\r\n#else\r\nDES_LONG *lp;\r\n#endif\r\nif (out_count < 1) out_count=1;\r\n#ifdef _CRAY\r\nlp = (struct lp_st *) &(output[0])[0];\r\n#else\r\nlp = (DES_LONG *) &(output[0])[0];\r\n#endif\r\nz0=Q_B0((*seed)[0])|Q_B1((*seed)[1])|Q_B2((*seed)[2])|Q_B3((*seed)[3]);\r\nz1=Q_B0((*seed)[4])|Q_B1((*seed)[5])|Q_B2((*seed)[6])|Q_B3((*seed)[7]);\r\nfor (i=0; ((i<4)&&(i<out_count)); i++)\r\n{\r\ncp=input;\r\nl=length;\r\nwhile (l > 0)\r\n{\r\nif (l > 1)\r\n{\r\nt0= (DES_LONG)(*(cp++));\r\nt0|=(DES_LONG)Q_B1(*(cp++));\r\nl--;\r\n}\r\nelse\r\nt0= (DES_LONG)(*(cp++));\r\nl--;\r\nt0+=z0;\r\nt0&=0xffffffffL;\r\nt1=z1;\r\nz0=((((t0*t0)&0xffffffffL)+((t1*t1)&0xffffffffL))\r\n&0xffffffffL)%0x7fffffffL;\r\nz1=((t0*((t1+NOISE)&0xffffffffL))&0xffffffffL)%0x7fffffffL;\r\n}\r\nif (lp != NULL)\r\n{\r\n#ifdef _CRAY\r\n(*lp).a = z0;\r\n(*lp).b = z1;\r\nlp++;\r\n#else\r\n*lp++ = z0;\r\n*lp++ = z1;\r\n#endif\r\n}\r\n}\r\nreturn(z0);\r\n}
