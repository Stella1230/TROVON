static SSL_METHOD *ssl23_get_method(int ver)\r\n{\r\nif (ver == SSL2_VERSION)\r\nreturn(SSLv2_method());\r\nelse if (ver == SSL3_VERSION)\r\nreturn(SSLv3_method());\r\nelse if (ver == TLS1_VERSION)\r\nreturn(TLSv1_method());\r\nelse\r\nreturn(NULL);\r\n}\r\nSSL_METHOD *SSLv23_method(void)\r\n{\r\nstatic int init=1;\r\nstatic SSL_METHOD SSLv23_data;\r\nif (init)\r\n{\r\nCRYPTO_w_lock(CRYPTO_LOCK_SSL_METHOD);\r\nif (init)\r\n{\r\nmemcpy((char *)&SSLv23_data,(char *)sslv23_base_method(),\r\nsizeof(SSL_METHOD));\r\nSSLv23_data.ssl_connect=ssl23_connect;\r\nSSLv23_data.ssl_accept=ssl23_accept;\r\nSSLv23_data.get_ssl_method=ssl23_get_method;\r\ninit=0;\r\n}\r\nCRYPTO_w_unlock(CRYPTO_LOCK_SSL_METHOD);\r\n}\r\nreturn(&SSLv23_data);\r\n}
