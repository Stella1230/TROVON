void RC2_set_key(RC2_KEY *key, int len, const unsigned char *data, int bits)\r\n{\r\nint i,j;\r\nunsigned char *k;\r\nRC2_INT *ki;\r\nunsigned int c,d;\r\nk= (unsigned char *)&(key->data[0]);\r\n*k=0;\r\nif (len > 128) len=128;\r\nif (bits <= 0) bits=1024;\r\nif (bits > 1024) bits=1024;\r\nfor (i=0; i<len; i++)\r\nk[i]=data[i];\r\nd=k[len-1];\r\nj=0;\r\nfor (i=len; i < 128; i++,j++)\r\n{\r\nd=key_table[(k[j]+d)&0xff];\r\nk[i]=d;\r\n}\r\nj=(bits+7)>>3;\r\ni=128-j;\r\nc= (0xff>>(-bits & 0x07));\r\nd=key_table[k[i]&c];\r\nk[i]=d;\r\nwhile (i--)\r\n{\r\nd=key_table[k[i+j]^d];\r\nk[i]=d;\r\n}\r\nki= &(key->data[63]);\r\nfor (i=127; i>=0; i-=2)\r\n*(ki--)=((k[i]<<8)|k[i-1])&0xffff;\r\n}
