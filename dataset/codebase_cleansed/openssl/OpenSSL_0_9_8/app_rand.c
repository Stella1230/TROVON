int app_RAND_load_file(const char *file, BIO *bio_e, int dont_warn)\r\n{\r\nint consider_randfile = (file == NULL);\r\nchar buffer[200];\r\n#ifdef OPENSSL_SYS_WINDOWS\r\nBIO_printf(bio_e,"Loading 'screen' into random state -");\r\nBIO_flush(bio_e);\r\nRAND_screen();\r\nBIO_printf(bio_e," done\n");\r\n#endif\r\nif (file == NULL)\r\nfile = RAND_file_name(buffer, sizeof buffer);\r\nelse if (RAND_egd(file) > 0)\r\n{\r\negdsocket = 1;\r\nreturn 1;\r\n}\r\nif (file == NULL || !RAND_load_file(file, -1))\r\n{\r\nif (RAND_status() == 0)\r\n{\r\nif (!dont_warn)\r\n{\r\nBIO_printf(bio_e,"unable to load 'random state'\n");\r\nBIO_printf(bio_e,"This means that the random number generator has not been seeded\n");\r\nBIO_printf(bio_e,"with much random data.\n");\r\nif (consider_randfile)\r\n{\r\nBIO_printf(bio_e,"Consider setting the RANDFILE environment variable to point at a file that\n");\r\nBIO_printf(bio_e,"'random' data can be kept in (the file will be overwritten).\n");\r\n}\r\n}\r\nreturn 0;\r\n}\r\n}\r\nseeded = 1;\r\nreturn 1;\r\n}\r\nlong app_RAND_load_files(char *name)\r\n{\r\nchar *p,*n;\r\nint last;\r\nlong tot=0;\r\nint egd;\r\nfor (;;)\r\n{\r\nlast=0;\r\nfor (p=name; ((*p != '\0') && (*p != LIST_SEPARATOR_CHAR)); p++);\r\nif (*p == '\0') last=1;\r\n*p='\0';\r\nn=name;\r\nname=p+1;\r\nif (*n == '\0') break;\r\negd=RAND_egd(n);\r\nif (egd > 0)\r\ntot+=egd;\r\nelse\r\ntot+=RAND_load_file(n,-1);\r\nif (last) break;\r\n}\r\nif (tot > 512)\r\napp_RAND_allow_write_file();\r\nreturn(tot);\r\n}\r\nint app_RAND_write_file(const char *file, BIO *bio_e)\r\n{\r\nchar buffer[200];\r\nif (egdsocket || !seeded)\r\nreturn 0;\r\nif (file == NULL)\r\nfile = RAND_file_name(buffer, sizeof buffer);\r\nif (file == NULL || !RAND_write_file(file))\r\n{\r\nBIO_printf(bio_e,"unable to write 'random state'\n");\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nvoid app_RAND_allow_write_file(void)\r\n{\r\nseeded = 1;\r\n}
