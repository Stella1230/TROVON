void AES_ofb128_encrypt(const unsigned char *in, unsigned char *out,\r\nconst unsigned long length, const AES_KEY *key,\r\nunsigned char *ivec, int *num) {\r\nunsigned int n;\r\nunsigned long l=length;\r\nassert(in && out && key && ivec && num);\r\nn = *num;\r\nwhile (l--) {\r\nif (n == 0) {\r\nAES_encrypt(ivec, ivec, key);\r\n}\r\n*(out++) = *(in++) ^ ivec[n];\r\nn = (n+1) % AES_BLOCK_SIZE;\r\n}\r\n*num=n;\r\n}
