void policy_data_free(X509_POLICY_DATA *data)\r\n{\r\nASN1_OBJECT_free(data->valid_policy);\r\nif (!(data->flags & POLICY_DATA_FLAG_SHARED_QUALIFIERS))\r\nsk_POLICYQUALINFO_pop_free(data->qualifier_set,\r\nPOLICYQUALINFO_free);\r\nsk_ASN1_OBJECT_pop_free(data->expected_policy_set, ASN1_OBJECT_free);\r\nOPENSSL_free(data);\r\n}\r\nX509_POLICY_DATA *policy_data_new(POLICYINFO *policy,\r\nconst ASN1_OBJECT *cid, int crit)\r\n{\r\nX509_POLICY_DATA *ret;\r\nASN1_OBJECT *id;\r\nif (!policy && !cid)\r\nreturn NULL;\r\nif (cid)\r\n{\r\nid = OBJ_dup(cid);\r\nif (!id)\r\nreturn NULL;\r\n}\r\nelse\r\nid = NULL;\r\nret = OPENSSL_malloc(sizeof(X509_POLICY_DATA));\r\nif (!ret)\r\nreturn NULL;\r\nret->expected_policy_set = sk_ASN1_OBJECT_new_null();\r\nif (!ret->expected_policy_set)\r\n{\r\nOPENSSL_free(ret);\r\nif (id)\r\nASN1_OBJECT_free(id);\r\nreturn NULL;\r\n}\r\nif (crit)\r\nret->flags = POLICY_DATA_FLAG_CRITICAL;\r\nelse\r\nret->flags = 0;\r\nif (id)\r\nret->valid_policy = id;\r\nelse\r\n{\r\nret->valid_policy = policy->policyid;\r\npolicy->policyid = NULL;\r\n}\r\nif (policy)\r\n{\r\nret->qualifier_set = policy->qualifiers;\r\npolicy->qualifiers = NULL;\r\n}\r\nelse\r\nret->qualifier_set = NULL;\r\nreturn ret;\r\n}
