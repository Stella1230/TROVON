ECDSA_SIG *ECDSA_do_sign(const unsigned char *dgst, int dlen, EC_KEY *eckey)\r\n{\r\nreturn ECDSA_do_sign_ex(dgst, dlen, NULL, NULL, eckey);\r\n}\r\nECDSA_SIG *ECDSA_do_sign_ex(const unsigned char *dgst, int dlen,\r\nconst BIGNUM *kinv, const BIGNUM *rp, EC_KEY *eckey)\r\n{\r\nECDSA_DATA *ecdsa = ecdsa_check(eckey);\r\nif (ecdsa == NULL)\r\nreturn NULL;\r\nreturn ecdsa->meth->ecdsa_do_sign(dgst, dlen, kinv, rp, eckey);\r\n}\r\nint ECDSA_sign(int type, const unsigned char *dgst, int dlen, unsigned char\r\n*sig, unsigned int *siglen, EC_KEY *eckey)\r\n{\r\nreturn ECDSA_sign_ex(type, dgst, dlen, sig, siglen, NULL, NULL, eckey);\r\n}\r\nint ECDSA_sign_ex(int type, const unsigned char *dgst, int dlen, unsigned char\r\n*sig, unsigned int *siglen, const BIGNUM *kinv, const BIGNUM *r,\r\nEC_KEY *eckey)\r\n{\r\nECDSA_SIG *s;\r\nRAND_seed(dgst, dlen);\r\ns = ECDSA_do_sign_ex(dgst, dlen, kinv, r, eckey);\r\nif (s == NULL)\r\n{\r\n*siglen=0;\r\nreturn 0;\r\n}\r\n*siglen = i2d_ECDSA_SIG(s, &sig);\r\nECDSA_SIG_free(s);\r\nreturn 1;\r\n}\r\nint ECDSA_sign_setup(EC_KEY *eckey, BN_CTX *ctx_in, BIGNUM **kinvp,\r\nBIGNUM **rp)\r\n{\r\nECDSA_DATA *ecdsa = ecdsa_check(eckey);\r\nif (ecdsa == NULL)\r\nreturn 0;\r\nreturn ecdsa->meth->ecdsa_sign_setup(eckey, ctx_in, kinvp, rp);\r\n}
