void *ASN1_dup(i2d_of_void *i2d, d2i_of_void *d2i, void *x)\r\n{\r\nunsigned char *b,*p;\r\nconst unsigned char *p2;\r\nint i;\r\nchar *ret;\r\nif (x == NULL) return(NULL);\r\ni=i2d(x,NULL);\r\nb=OPENSSL_malloc(i+10);\r\nif (b == NULL)\r\n{ ASN1err(ASN1_F_ASN1_DUP,ERR_R_MALLOC_FAILURE); return(NULL); }\r\np= b;\r\ni=i2d(x,&p);\r\np2= b;\r\nret=d2i(NULL,&p2,i);\r\nOPENSSL_free(b);\r\nreturn(ret);\r\n}\r\nvoid *ASN1_item_dup(const ASN1_ITEM *it, void *x)\r\n{\r\nunsigned char *b = NULL;\r\nconst unsigned char *p;\r\nlong i;\r\nvoid *ret;\r\nif (x == NULL) return(NULL);\r\ni=ASN1_item_i2d(x,&b,it);\r\nif (b == NULL)\r\n{ ASN1err(ASN1_F_ASN1_ITEM_DUP,ERR_R_MALLOC_FAILURE); return(NULL); }\r\np= b;\r\nret=ASN1_item_d2i(NULL,&p,i, it);\r\nOPENSSL_free(b);\r\nreturn(ret);\r\n}
