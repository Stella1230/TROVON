SIGRETTYPE sig_done(int sig)\r\n{\r\nsignal(SIGALRM,sig_done);\r\nrun=0;\r\n#ifdef LINT\r\nsig=sig;\r\n#endif\r\n}\r\ndouble Time_F(int s)\r\n{\r\ndouble ret;\r\n#ifdef TIMES\r\nstatic struct tms tstart,tend;\r\nif (s == START)\r\n{\r\ntimes(&tstart);\r\nreturn(0);\r\n}\r\nelse\r\n{\r\ntimes(&tend);\r\nret=((double)(tend.tms_utime-tstart.tms_utime))/HZ;\r\nreturn((ret == 0.0)?1e-6:ret);\r\n}\r\n#else\r\nstatic struct timeb tstart,tend;\r\nlong i;\r\nif (s == START)\r\n{\r\nftime(&tstart);\r\nreturn(0);\r\n}\r\nelse\r\n{\r\nftime(&tend);\r\ni=(long)tend.millitm-(long)tstart.millitm;\r\nret=((double)(tend.time-tstart.time))+((double)i)/1e3;\r\nreturn((ret == 0.0)?1e-6:ret);\r\n}\r\n#endif\r\n}\r\nint main(int argc, char **argv)\r\n{\r\nlong count;\r\nstatic unsigned char buf[BUFSIZE];\r\nstatic unsigned char key[] ={\r\n0x12,0x34,0x56,0x78,0x9a,0xbc,0xde,0xf0,\r\n0xfe,0xdc,0xba,0x98,0x76,0x54,0x32,0x10,\r\n};\r\nRC5_32_KEY sch;\r\ndouble a,b,c,d;\r\n#ifndef SIGALRM\r\nlong ca,cb,cc;\r\n#endif\r\n#ifndef TIMES\r\nprintf("To get the most accurate results, try to run this\n");\r\nprintf("program when this computer is idle.\n");\r\n#endif\r\n#ifndef SIGALRM\r\nprintf("First we calculate the approximate speed ...\n");\r\nRC5_32_set_key(&sch,16,key,12);\r\ncount=10;\r\ndo {\r\nlong i;\r\nunsigned long data[2];\r\ncount*=2;\r\nTime_F(START);\r\nfor (i=count; i; i--)\r\nRC5_32_encrypt(data,&sch);\r\nd=Time_F(STOP);\r\n} while (d < 3.0);\r\nca=count/512;\r\ncb=count;\r\ncc=count*8/BUFSIZE+1;\r\nprintf("Doing RC5_32_set_key %ld times\n",ca);\r\n#define COND(d) (count != (d))\r\n#define COUNT(d) (d)\r\n#else\r\n#define COND(c) (run)\r\n#define COUNT(d) (count)\r\nsignal(SIGALRM,sig_done);\r\nprintf("Doing RC5_32_set_key for 10 seconds\n");\r\nalarm(10);\r\n#endif\r\nTime_F(START);\r\nfor (count=0,run=1; COND(ca); count+=4)\r\n{\r\nRC5_32_set_key(&sch,16,key,12);\r\nRC5_32_set_key(&sch,16,key,12);\r\nRC5_32_set_key(&sch,16,key,12);\r\nRC5_32_set_key(&sch,16,key,12);\r\n}\r\nd=Time_F(STOP);\r\nprintf("%ld RC5_32_set_key's in %.2f seconds\n",count,d);\r\na=((double)COUNT(ca))/d;\r\n#ifdef SIGALRM\r\nprintf("Doing RC5_32_encrypt's for 10 seconds\n");\r\nalarm(10);\r\n#else\r\nprintf("Doing RC5_32_encrypt %ld times\n",cb);\r\n#endif\r\nTime_F(START);\r\nfor (count=0,run=1; COND(cb); count+=4)\r\n{\r\nunsigned long data[2];\r\nRC5_32_encrypt(data,&sch);\r\nRC5_32_encrypt(data,&sch);\r\nRC5_32_encrypt(data,&sch);\r\nRC5_32_encrypt(data,&sch);\r\n}\r\nd=Time_F(STOP);\r\nprintf("%ld RC5_32_encrypt's in %.2f second\n",count,d);\r\nb=((double)COUNT(cb)*8)/d;\r\n#ifdef SIGALRM\r\nprintf("Doing RC5_32_cbc_encrypt on %ld byte blocks for 10 seconds\n",\r\nBUFSIZE);\r\nalarm(10);\r\n#else\r\nprintf("Doing RC5_32_cbc_encrypt %ld times on %ld byte blocks\n",cc,\r\nBUFSIZE);\r\n#endif\r\nTime_F(START);\r\nfor (count=0,run=1; COND(cc); count++)\r\nRC5_32_cbc_encrypt(buf,buf,BUFSIZE,&sch,\r\n&(key[0]),RC5_ENCRYPT);\r\nd=Time_F(STOP);\r\nprintf("%ld RC5_32_cbc_encrypt's of %ld byte blocks in %.2f second\n",\r\ncount,BUFSIZE,d);\r\nc=((double)COUNT(cc)*BUFSIZE)/d;\r\nprintf("RC5_32/12/16 set_key per sec = %12.2f (%9.3fuS)\n",a,1.0e6/a);\r\nprintf("RC5_32/12/16 raw ecb bytes per sec = %12.2f (%9.3fuS)\n",b,8.0e6/b);\r\nprintf("RC5_32/12/16 cbc bytes per sec = %12.2f (%9.3fuS)\n",c,8.0e6/c);\r\nexit(0);\r\n#if defined(LINT) || defined(OPENSSL_SYS_MSDOS)\r\nreturn(0);\r\n#endif\r\n}
