void RC5_32_set_key(RC5_32_KEY *key, int len, const unsigned char *data,\r\nint rounds)\r\n{\r\nRC5_32_INT L[64],l,ll,A,B,*S,k;\r\nint i,j,m,c,t,ii,jj;\r\nif ( (rounds != RC5_16_ROUNDS) &&\r\n(rounds != RC5_12_ROUNDS) &&\r\n(rounds != RC5_8_ROUNDS))\r\nrounds=RC5_16_ROUNDS;\r\nkey->rounds=rounds;\r\nS= &(key->data[0]);\r\nj=0;\r\nfor (i=0; i<=(len-8); i+=8)\r\n{\r\nc2l(data,l);\r\nL[j++]=l;\r\nc2l(data,l);\r\nL[j++]=l;\r\n}\r\nii=len-i;\r\nif (ii)\r\n{\r\nk=len&0x07;\r\nc2ln(data,l,ll,k);\r\nL[j+0]=l;\r\nL[j+1]=ll;\r\n}\r\nc=(len+3)/4;\r\nt=(rounds+1)*2;\r\nS[0]=RC5_32_P;\r\nfor (i=1; i<t; i++)\r\nS[i]=(S[i-1]+RC5_32_Q)&RC5_32_MASK;\r\nj=(t>c)?t:c;\r\nj*=3;\r\nii=jj=0;\r\nA=B=0;\r\nfor (i=0; i<j; i++)\r\n{\r\nk=(S[ii]+A+B)&RC5_32_MASK;\r\nA=S[ii]=ROTATE_l32(k,3);\r\nm=(int)(A+B);\r\nk=(L[jj]+A+B)&RC5_32_MASK;\r\nB=L[jj]=ROTATE_l32(k,m);\r\nif (++ii >= t) ii=0;\r\nif (++jj >= c) jj=0;\r\n}\r\n}
