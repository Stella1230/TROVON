int int_strtoul(const char *str, unsigned long *val)\r\n{\r\n#ifdef HAVE_STRTOUL\r\nchar *tmp;\r\nunsigned long ret = strtoul(str, &tmp, 10);\r\nif((str == tmp) || (*tmp != '\0'))\r\nreturn 0;\r\nif(ret == ULONG_MAX)\r\nreturn 0;\r\n*val = ret;\r\nreturn 1;\r\n#else\r\nchar buf[2];\r\nunsigned long ret = 0;\r\nbuf[1] = '\0';\r\nif(str == '\0')\r\nreturn 0;\r\nwhile(*str != '\0') {\r\nif(ret && (((ULONG_MAX + 10) / ret) < 10))\r\nreturn 0;\r\nret *= 10;\r\nif(!isdigit(*str))\r\nreturn 0;\r\nbuf[0] = *str;\r\nret += atoi(buf);\r\nstr++;\r\n}\r\n*val = ret;\r\nreturn 1;\r\n#endif\r\n}\r\nchar *int_strstr(const char *haystack, const char *needle)\r\n{\r\nconst char *sub_haystack = haystack, *sub_needle = needle;\r\nunsigned int offset = 0;\r\nif(!needle)\r\nreturn haystack;\r\nif(!haystack)\r\nreturn NULL;\r\nwhile((*sub_haystack != '\0') && (*sub_needle != '\0')) {\r\nif(sub_haystack[offset] == sub_needle) {\r\noffset++;\r\nsub_needle++;\r\n} else {\r\nsub_haystack++;\r\noffset = 0;\r\nsub_needle = needle;\r\n}\r\n}\r\nif(*sub_haystack == '\0')\r\nreturn NULL;\r\nreturn sub_haystack;\r\n}
