DSO_METHOD *DSO_METHOD_beos(void)\r\n{\r\nreturn NULL;\r\n}\r\nDSO_METHOD *DSO_METHOD_beos(void)\r\n{\r\nreturn(&dso_meth_beos);\r\n}\r\nstatic int beos_load(DSO *dso)\r\n{\r\nimage_id id;\r\nchar *filename = DSO_convert_filename(dso, NULL);\r\nif(filename == NULL)\r\n{\r\nDSOerr(DSO_F_BEOS_LOAD,DSO_R_NO_FILENAME);\r\ngoto err;\r\n}\r\nid = load_add_on(filename);\r\nif(id < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_LOAD,DSO_R_LOAD_FAILED);\r\nERR_add_error_data(3, "filename(", filename, ")");\r\ngoto err;\r\n}\r\nif(!sk_push(dso->meth_data, (char *)id))\r\n{\r\nDSOerr(DSO_F_BEOS_LOAD,DSO_R_STACK_ERROR);\r\ngoto err;\r\n}\r\ndso->loaded_filename = filename;\r\nreturn(1);\r\nerr:\r\nif(filename != NULL)\r\nOPENSSL_free(filename);\r\nif(id > 0)\r\nunload_add_on(id);\r\nreturn(0);\r\n}\r\nstatic int beos_unload(DSO *dso)\r\n{\r\nimage_id id;\r\nif(dso == NULL)\r\n{\r\nDSOerr(DSO_F_BEOS_UNLOAD,ERR_R_PASSED_NULL_PARAMETER);\r\nreturn(0);\r\n}\r\nif(sk_num(dso->meth_data) < 1)\r\nreturn(1);\r\nid = (image_id)sk_pop(dso->meth_data);\r\nif(id < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_UNLOAD,DSO_R_NULL_HANDLE);\r\nreturn(0);\r\n}\r\nif(unload_add_on(id) != B_OK)\r\n{\r\nDSOerr(DSO_F_BEOS_UNLOAD,DSO_R_UNLOAD_FAILED);\r\nsk_push(dso->meth_data, (char *)id);\r\nreturn(0);\r\n}\r\nreturn(1);\r\n}\r\nstatic void *beos_bind_var(DSO *dso, const char *symname)\r\n{\r\nimage_id id;\r\nvoid *sym;\r\nif((dso == NULL) || (symname == NULL))\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_VAR,ERR_R_PASSED_NULL_PARAMETER);\r\nreturn(NULL);\r\n}\r\nif(sk_num(dso->meth_data) < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_VAR,DSO_R_STACK_ERROR);\r\nreturn(NULL);\r\n}\r\nid = (image_id)sk_value(dso->meth_data, sk_num(dso->meth_data) - 1);\r\nif(id < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_VAR,DSO_R_NULL_HANDLE);\r\nreturn(NULL);\r\n}\r\nif(get_image_symbol(id, symname, B_SYMBOL_TYPE_DATA, &sym) != B_OK)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_VAR,DSO_R_SYM_FAILURE);\r\nERR_add_error_data(3, "symname(", symname, ")");\r\nreturn(NULL);\r\n}\r\nreturn(sym);\r\n}\r\nstatic DSO_FUNC_TYPE beos_bind_func(DSO *dso, const char *symname)\r\n{\r\nimage_id id;\r\nvoid *sym;\r\nif((dso == NULL) || (symname == NULL))\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_FUNC,ERR_R_PASSED_NULL_PARAMETER);\r\nreturn(NULL);\r\n}\r\nif(sk_num(dso->meth_data) < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_FUNC,DSO_R_STACK_ERROR);\r\nreturn(NULL);\r\n}\r\nid = (image_id)sk_value(dso->meth_data, sk_num(dso->meth_data) - 1);\r\nif(id < 1)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_FUNC,DSO_R_NULL_HANDLE);\r\nreturn(NULL);\r\n}\r\nif(get_image_symbol(id, symname, B_SYMBOL_TYPE_TEXT, &sym) != B_OK)\r\n{\r\nDSOerr(DSO_F_BEOS_BIND_FUNC,DSO_R_SYM_FAILURE);\r\nERR_add_error_data(3, "symname(", symname, ")");\r\nreturn(NULL);\r\n}\r\nreturn((DSO_FUNC_TYPE)sym);\r\n}\r\nstatic char *beos_name_converter(DSO *dso, const char *filename)\r\n{\r\nchar *translated;\r\nint len, rsize, transform;\r\nlen = strlen(filename);\r\nrsize = len + 1;\r\ntransform = (strstr(filename, "/") == NULL);\r\nif(transform)\r\n{\r\nrsize += 3;\r\nif ((DSO_flags(dso) & DSO_FLAG_NAME_TRANSLATION_EXT_ONLY) == 0)\r\nrsize += 3;\r\n}\r\ntranslated = OPENSSL_malloc(rsize);\r\nif(translated == NULL)\r\n{\r\nDSOerr(DSO_F_BEOS_NAME_CONVERTER,\r\nDSO_R_NAME_TRANSLATION_FAILED);\r\nreturn(NULL);\r\n}\r\nif(transform)\r\n{\r\nif ((DSO_flags(dso) & DSO_FLAG_NAME_TRANSLATION_EXT_ONLY) == 0)\r\nsprintf(translated, "lib%s.so", filename);\r\nelse\r\nsprintf(translated, "%s.so", filename);\r\n}\r\nelse\r\nsprintf(translated, "%s", filename);\r\nreturn(translated);\r\n}
