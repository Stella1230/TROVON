int GENERAL_NAME_cmp(GENERAL_NAME *a, GENERAL_NAME *b)\r\n{\r\nint result = -1;\r\nif (!a || !b || a->type != b->type) return -1;\r\nswitch(a->type)\r\n{\r\ncase GEN_X400:\r\ncase GEN_EDIPARTY:\r\nresult = ASN1_TYPE_cmp(a->d.other, b->d.other);\r\nbreak;\r\ncase GEN_OTHERNAME:\r\nresult = OTHERNAME_cmp(a->d.otherName, b->d.otherName);\r\nbreak;\r\ncase GEN_EMAIL:\r\ncase GEN_DNS:\r\ncase GEN_URI:\r\nresult = ASN1_STRING_cmp(a->d.ia5, b->d.ia5);\r\nbreak;\r\ncase GEN_DIRNAME:\r\nresult = X509_NAME_cmp(a->d.dirn, b->d.dirn);\r\nbreak;\r\ncase GEN_IPADD:\r\nresult = ASN1_OCTET_STRING_cmp(a->d.ip, b->d.ip);\r\nbreak;\r\ncase GEN_RID:\r\nresult = OBJ_cmp(a->d.rid, b->d.rid);\r\nbreak;\r\n}\r\nreturn result;\r\n}\r\nint OTHERNAME_cmp(OTHERNAME *a, OTHERNAME *b)\r\n{\r\nint result = -1;\r\nif (!a || !b) return -1;\r\nif ((result = OBJ_cmp(a->type_id, b->type_id)) != 0)\r\nreturn result;\r\nresult = ASN1_TYPE_cmp(a->value, b->value);\r\nreturn result;\r\n}\r\nvoid GENERAL_NAME_set0_value(GENERAL_NAME *a, int type, void *value)\r\n{\r\nswitch(type)\r\n{\r\ncase GEN_X400:\r\ncase GEN_EDIPARTY:\r\na->d.other = value;\r\nbreak;\r\ncase GEN_OTHERNAME:\r\na->d.otherName = value;\r\nbreak;\r\ncase GEN_EMAIL:\r\ncase GEN_DNS:\r\ncase GEN_URI:\r\na->d.ia5 = value;\r\nbreak;\r\ncase GEN_DIRNAME:\r\na->d.dirn = value;\r\nbreak;\r\ncase GEN_IPADD:\r\na->d.ip = value;\r\nbreak;\r\ncase GEN_RID:\r\na->d.rid = value;\r\nbreak;\r\n}\r\na->type = type;\r\n}\r\nvoid *GENERAL_NAME_get0_value(GENERAL_NAME *a, int *ptype)\r\n{\r\nif (ptype)\r\n*ptype = a->type;\r\nswitch(a->type)\r\n{\r\ncase GEN_X400:\r\ncase GEN_EDIPARTY:\r\nreturn a->d.other;\r\ncase GEN_OTHERNAME:\r\nreturn a->d.otherName;\r\ncase GEN_EMAIL:\r\ncase GEN_DNS:\r\ncase GEN_URI:\r\nreturn a->d.ia5;\r\ncase GEN_DIRNAME:\r\nreturn a->d.dirn;\r\ncase GEN_IPADD:\r\nreturn a->d.ip;\r\ncase GEN_RID:\r\nreturn a->d.rid;\r\ndefault:\r\nreturn NULL;\r\n}\r\n}\r\nint GENERAL_NAME_set0_othername(GENERAL_NAME *gen,\r\nASN1_OBJECT *oid, ASN1_TYPE *value)\r\n{\r\nOTHERNAME *oth;\r\noth = OTHERNAME_new();\r\nif (!oth)\r\nreturn 0;\r\noth->type_id = oid;\r\noth->value = value;\r\nGENERAL_NAME_set0_value(gen, GEN_OTHERNAME, oth);\r\nreturn 1;\r\n}\r\nint GENERAL_NAME_get0_otherName(GENERAL_NAME *gen,\r\nASN1_OBJECT **poid, ASN1_TYPE **pvalue)\r\n{\r\nif (gen->type != GEN_OTHERNAME)\r\nreturn 0;\r\nif (poid)\r\n*poid = gen->d.otherName->type_id;\r\nif (pvalue)\r\n*pvalue = gen->d.otherName->value;\r\nreturn 1;\r\n}
