static void long_free(ASN1_VALUE **pval, const ASN1_ITEM *it)\r\n{\r\n*(long *)pval = it->size;\r\n}\r\nstatic int long_i2c(ASN1_VALUE **pval, unsigned char *cont, int *putype, const ASN1_ITEM *it)\r\n{\r\nlong ltmp;\r\nunsigned long utmp;\r\nint clen, pad, i;\r\nchar *cp = (char *)pval;\r\nmemcpy(&ltmp, cp, sizeof(long));\r\nif(ltmp == it->size) return -1;\r\nif(ltmp < 0) utmp = -ltmp - 1;\r\nelse utmp = ltmp;\r\nclen = BN_num_bits_word(utmp);\r\nif(!(clen & 0x7)) pad = 1;\r\nelse pad = 0;\r\nclen = (clen + 7) >> 3;\r\nif(cont) {\r\nif(pad) *cont++ = (ltmp < 0) ? 0xff : 0;\r\nfor(i = clen - 1; i >= 0; i--) {\r\ncont[i] = (unsigned char)(utmp & 0xff);\r\nif(ltmp < 0) cont[i] ^= 0xff;\r\nutmp >>= 8;\r\n}\r\n}\r\nreturn clen + pad;\r\n}\r\nstatic int long_c2i(ASN1_VALUE **pval, const unsigned char *cont, int len,\r\nint utype, char *free_cont, const ASN1_ITEM *it)\r\n{\r\nint neg, i;\r\nlong ltmp;\r\nunsigned long utmp = 0;\r\nchar *cp = (char *)pval;\r\nif(len > (int)sizeof(long)) {\r\nASN1err(ASN1_F_LONG_C2I, ASN1_R_INTEGER_TOO_LARGE_FOR_LONG);\r\nreturn 0;\r\n}\r\nif(len && (cont[0] & 0x80)) neg = 1;\r\nelse neg = 0;\r\nutmp = 0;\r\nfor(i = 0; i < len; i++) {\r\nutmp <<= 8;\r\nif(neg) utmp |= cont[i] ^ 0xff;\r\nelse utmp |= cont[i];\r\n}\r\nltmp = (long)utmp;\r\nif(neg) {\r\nltmp++;\r\nltmp = -ltmp;\r\n}\r\nif(ltmp == it->size) {\r\nASN1err(ASN1_F_LONG_C2I, ASN1_R_INTEGER_TOO_LARGE_FOR_LONG);\r\nreturn 0;\r\n}\r\nmemcpy(cp, &ltmp, sizeof(long));\r\nreturn 1;\r\n}\r\nstatic int long_print(BIO *out, ASN1_VALUE **pval, const ASN1_ITEM *it,\r\nint indent, const ASN1_PCTX *pctx)\r\n{\r\nreturn BIO_printf(out, "%ld\n", *(long *)pval);\r\n}
