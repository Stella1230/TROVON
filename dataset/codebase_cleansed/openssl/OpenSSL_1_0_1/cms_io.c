int CMS_stream(unsigned char ***boundary, CMS_ContentInfo *cms)\r\n{\r\nASN1_OCTET_STRING **pos;\r\npos = CMS_get0_content(cms);\r\nif (!pos)\r\nreturn 0;\r\nif (!*pos)\r\n*pos = ASN1_OCTET_STRING_new();\r\nif (*pos)\r\n{\r\n(*pos)->flags |= ASN1_STRING_FLAG_NDEF;\r\n(*pos)->flags &= ~ASN1_STRING_FLAG_CONT;\r\n*boundary = &(*pos)->data;\r\nreturn 1;\r\n}\r\nCMSerr(CMS_F_CMS_STREAM, ERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nCMS_ContentInfo *d2i_CMS_bio(BIO *bp, CMS_ContentInfo **cms)\r\n{\r\nreturn ASN1_item_d2i_bio(ASN1_ITEM_rptr(CMS_ContentInfo), bp, cms);\r\n}\r\nint i2d_CMS_bio(BIO *bp, CMS_ContentInfo *cms)\r\n{\r\nreturn ASN1_item_i2d_bio(ASN1_ITEM_rptr(CMS_ContentInfo), bp, cms);\r\n}\r\nBIO *BIO_new_CMS(BIO *out, CMS_ContentInfo *cms)\r\n{\r\nreturn BIO_new_NDEF(out, (ASN1_VALUE *)cms,\r\nASN1_ITEM_rptr(CMS_ContentInfo));\r\n}\r\nint i2d_CMS_bio_stream(BIO *out, CMS_ContentInfo *cms, BIO *in, int flags)\r\n{\r\nreturn i2d_ASN1_bio_stream(out, (ASN1_VALUE *)cms, in, flags,\r\nASN1_ITEM_rptr(CMS_ContentInfo));\r\n}\r\nint PEM_write_bio_CMS_stream(BIO *out, CMS_ContentInfo *cms, BIO *in, int flags)\r\n{\r\nreturn PEM_write_bio_ASN1_stream(out, (ASN1_VALUE *) cms, in, flags,\r\n"CMS",\r\nASN1_ITEM_rptr(CMS_ContentInfo));\r\n}\r\nint SMIME_write_CMS(BIO *bio, CMS_ContentInfo *cms, BIO *data, int flags)\r\n{\r\nSTACK_OF(X509_ALGOR) *mdalgs;\r\nint ctype_nid = OBJ_obj2nid(cms->contentType);\r\nint econt_nid = OBJ_obj2nid(CMS_get0_eContentType(cms));\r\nif (ctype_nid == NID_pkcs7_signed)\r\nmdalgs = cms->d.signedData->digestAlgorithms;\r\nelse\r\nmdalgs = NULL;\r\nreturn SMIME_write_ASN1(bio, (ASN1_VALUE *)cms, data, flags,\r\nctype_nid, econt_nid, mdalgs,\r\nASN1_ITEM_rptr(CMS_ContentInfo));\r\n}\r\nCMS_ContentInfo *SMIME_read_CMS(BIO *bio, BIO **bcont)\r\n{\r\nreturn (CMS_ContentInfo *)SMIME_read_ASN1(bio, bcont,\r\nASN1_ITEM_rptr(CMS_ContentInfo));\r\n}
