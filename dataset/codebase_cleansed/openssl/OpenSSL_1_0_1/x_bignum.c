static void bn_free(ASN1_VALUE **pval, const ASN1_ITEM *it)\r\n{\r\nif(!*pval) return;\r\nif(it->size & BN_SENSITIVE) BN_clear_free((BIGNUM *)*pval);\r\nelse BN_free((BIGNUM *)*pval);\r\n*pval = NULL;\r\n}\r\nstatic int bn_i2c(ASN1_VALUE **pval, unsigned char *cont, int *putype, const ASN1_ITEM *it)\r\n{\r\nBIGNUM *bn;\r\nint pad;\r\nif(!*pval) return -1;\r\nbn = (BIGNUM *)*pval;\r\nif(BN_num_bits(bn) & 0x7) pad = 0;\r\nelse pad = 1;\r\nif(cont) {\r\nif(pad) *cont++ = 0;\r\nBN_bn2bin(bn, cont);\r\n}\r\nreturn pad + BN_num_bytes(bn);\r\n}\r\nstatic int bn_c2i(ASN1_VALUE **pval, const unsigned char *cont, int len,\r\nint utype, char *free_cont, const ASN1_ITEM *it)\r\n{\r\nBIGNUM *bn;\r\nif(!*pval) bn_new(pval, it);\r\nbn = (BIGNUM *)*pval;\r\nif(!BN_bin2bn(cont, len, bn)) {\r\nbn_free(pval, it);\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}
