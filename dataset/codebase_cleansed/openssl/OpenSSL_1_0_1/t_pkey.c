int ASN1_bn_print(BIO *bp, const char *number, const BIGNUM *num,\r\nunsigned char *buf, int off)\r\n{\r\nint n,i;\r\nconst char *neg;\r\nif (num == NULL) return(1);\r\nneg = (BN_is_negative(num))?"-":"";\r\nif(!BIO_indent(bp,off,128))\r\nreturn 0;\r\nif (BN_is_zero(num))\r\n{\r\nif (BIO_printf(bp, "%s 0\n", number) <= 0)\r\nreturn 0;\r\nreturn 1;\r\n}\r\nif (BN_num_bytes(num) <= BN_BYTES)\r\n{\r\nif (BIO_printf(bp,"%s %s%lu (%s0x%lx)\n",number,neg,\r\n(unsigned long)num->d[0],neg,(unsigned long)num->d[0])\r\n<= 0) return(0);\r\n}\r\nelse\r\n{\r\nbuf[0]=0;\r\nif (BIO_printf(bp,"%s%s",number,\r\n(neg[0] == '-')?" (Negative)":"") <= 0)\r\nreturn(0);\r\nn=BN_bn2bin(num,&buf[1]);\r\nif (buf[1] & 0x80)\r\nn++;\r\nelse buf++;\r\nfor (i=0; i<n; i++)\r\n{\r\nif ((i%15) == 0)\r\n{\r\nif(BIO_puts(bp,"\n") <= 0\r\n|| !BIO_indent(bp,off+4,128))\r\nreturn 0;\r\n}\r\nif (BIO_printf(bp,"%02x%s",buf[i],((i+1) == n)?"":":")\r\n<= 0) return(0);\r\n}\r\nif (BIO_write(bp,"\n",1) <= 0) return(0);\r\n}\r\nreturn(1);\r\n}
