unsigned char *OPENSSL_asc2uni(const char *asc, int asclen, unsigned char **uni, int *unilen)\r\n{\r\nint ulen, i;\r\nunsigned char *unitmp;\r\nif (asclen == -1) asclen = strlen(asc);\r\nulen = asclen*2 + 2;\r\nif (!(unitmp = OPENSSL_malloc(ulen))) return NULL;\r\nfor (i = 0; i < ulen - 2; i+=2) {\r\nunitmp[i] = 0;\r\nunitmp[i + 1] = asc[i>>1];\r\n}\r\nunitmp[ulen - 2] = 0;\r\nunitmp[ulen - 1] = 0;\r\nif (unilen) *unilen = ulen;\r\nif (uni) *uni = unitmp;\r\nreturn unitmp;\r\n}\r\nchar *OPENSSL_uni2asc(unsigned char *uni, int unilen)\r\n{\r\nint asclen, i;\r\nchar *asctmp;\r\nasclen = unilen / 2;\r\nif (!unilen || uni[unilen - 1]) asclen++;\r\nuni++;\r\nif (!(asctmp = OPENSSL_malloc(asclen))) return NULL;\r\nfor (i = 0; i < unilen; i+=2) asctmp[i>>1] = uni[i];\r\nasctmp[asclen - 1] = 0;\r\nreturn asctmp;\r\n}\r\nint i2d_PKCS12_bio(BIO *bp, PKCS12 *p12)\r\n{\r\nreturn ASN1_item_i2d_bio(ASN1_ITEM_rptr(PKCS12), bp, p12);\r\n}\r\nint i2d_PKCS12_fp(FILE *fp, PKCS12 *p12)\r\n{\r\nreturn ASN1_item_i2d_fp(ASN1_ITEM_rptr(PKCS12), fp, p12);\r\n}\r\nPKCS12 *d2i_PKCS12_bio(BIO *bp, PKCS12 **p12)\r\n{\r\nreturn ASN1_item_d2i_bio(ASN1_ITEM_rptr(PKCS12), bp, p12);\r\n}\r\nPKCS12 *d2i_PKCS12_fp(FILE *fp, PKCS12 **p12)\r\n{\r\nreturn ASN1_item_d2i_fp(ASN1_ITEM_rptr(PKCS12), fp, p12);\r\n}\r\nPKCS12_SAFEBAG *PKCS12_x5092certbag(X509 *x509)\r\n{\r\nreturn PKCS12_item_pack_safebag(x509, ASN1_ITEM_rptr(X509),\r\nNID_x509Certificate, NID_certBag);\r\n}\r\nPKCS12_SAFEBAG *PKCS12_x509crl2certbag(X509_CRL *crl)\r\n{\r\nreturn PKCS12_item_pack_safebag(crl, ASN1_ITEM_rptr(X509_CRL),\r\nNID_x509Crl, NID_crlBag);\r\n}\r\nX509 *PKCS12_certbag2x509(PKCS12_SAFEBAG *bag)\r\n{\r\nif(M_PKCS12_bag_type(bag) != NID_certBag) return NULL;\r\nif(M_PKCS12_cert_bag_type(bag) != NID_x509Certificate) return NULL;\r\nreturn ASN1_item_unpack(bag->value.bag->value.octet, ASN1_ITEM_rptr(X509));\r\n}\r\nX509_CRL *PKCS12_certbag2x509crl(PKCS12_SAFEBAG *bag)\r\n{\r\nif(M_PKCS12_bag_type(bag) != NID_crlBag) return NULL;\r\nif(M_PKCS12_cert_bag_type(bag) != NID_x509Crl) return NULL;\r\nreturn ASN1_item_unpack(bag->value.bag->value.octet,\r\nASN1_ITEM_rptr(X509_CRL));\r\n}
