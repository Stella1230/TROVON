int TS_REQ_set_version(TS_REQ *a, long version)\r\n{\r\nreturn ASN1_INTEGER_set(a->version, version);\r\n}\r\nlong TS_REQ_get_version(const TS_REQ *a)\r\n{\r\nreturn ASN1_INTEGER_get(a->version);\r\n}\r\nint TS_REQ_set_msg_imprint(TS_REQ *a, TS_MSG_IMPRINT *msg_imprint)\r\n{\r\nTS_MSG_IMPRINT *new_msg_imprint;\r\nif (a->msg_imprint == msg_imprint)\r\nreturn 1;\r\nnew_msg_imprint = TS_MSG_IMPRINT_dup(msg_imprint);\r\nif (new_msg_imprint == NULL)\r\n{\r\nTSerr(TS_F_TS_REQ_SET_MSG_IMPRINT, ERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nTS_MSG_IMPRINT_free(a->msg_imprint);\r\na->msg_imprint = new_msg_imprint;\r\nreturn 1;\r\n}\r\nTS_MSG_IMPRINT *TS_REQ_get_msg_imprint(TS_REQ *a)\r\n{\r\nreturn a->msg_imprint;\r\n}\r\nint TS_MSG_IMPRINT_set_algo(TS_MSG_IMPRINT *a, X509_ALGOR *alg)\r\n{\r\nX509_ALGOR *new_alg;\r\nif (a->hash_algo == alg)\r\nreturn 1;\r\nnew_alg = X509_ALGOR_dup(alg);\r\nif (new_alg == NULL)\r\n{\r\nTSerr(TS_F_TS_MSG_IMPRINT_SET_ALGO, ERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nX509_ALGOR_free(a->hash_algo);\r\na->hash_algo = new_alg;\r\nreturn 1;\r\n}\r\nX509_ALGOR *TS_MSG_IMPRINT_get_algo(TS_MSG_IMPRINT *a)\r\n{\r\nreturn a->hash_algo;\r\n}\r\nint TS_MSG_IMPRINT_set_msg(TS_MSG_IMPRINT *a, unsigned char *d, int len)\r\n{\r\nreturn ASN1_OCTET_STRING_set(a->hashed_msg, d, len);\r\n}\r\nASN1_OCTET_STRING *TS_MSG_IMPRINT_get_msg(TS_MSG_IMPRINT *a)\r\n{\r\nreturn a->hashed_msg;\r\n}\r\nint TS_REQ_set_policy_id(TS_REQ *a, ASN1_OBJECT *policy)\r\n{\r\nASN1_OBJECT *new_policy;\r\nif (a->policy_id == policy)\r\nreturn 1;\r\nnew_policy = OBJ_dup(policy);\r\nif (new_policy == NULL)\r\n{\r\nTSerr(TS_F_TS_REQ_SET_POLICY_ID, ERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nASN1_OBJECT_free(a->policy_id);\r\na->policy_id = new_policy;\r\nreturn 1;\r\n}\r\nASN1_OBJECT *TS_REQ_get_policy_id(TS_REQ *a)\r\n{\r\nreturn a->policy_id;\r\n}\r\nint TS_REQ_set_nonce(TS_REQ *a, const ASN1_INTEGER *nonce)\r\n{\r\nASN1_INTEGER *new_nonce;\r\nif (a->nonce == nonce)\r\nreturn 1;\r\nnew_nonce = ASN1_INTEGER_dup(nonce);\r\nif (new_nonce == NULL)\r\n{\r\nTSerr(TS_F_TS_REQ_SET_NONCE, ERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nASN1_INTEGER_free(a->nonce);\r\na->nonce = new_nonce;\r\nreturn 1;\r\n}\r\nconst ASN1_INTEGER *TS_REQ_get_nonce(const TS_REQ *a)\r\n{\r\nreturn a->nonce;\r\n}\r\nint TS_REQ_set_cert_req(TS_REQ *a, int cert_req)\r\n{\r\na->cert_req = cert_req ? 0xFF : 0x00;\r\nreturn 1;\r\n}\r\nint TS_REQ_get_cert_req(const TS_REQ *a)\r\n{\r\nreturn a->cert_req ? 1 : 0;\r\n}\r\nvoid TS_REQ_ext_free(TS_REQ *a)\r\n{\r\nif (!a) return;\r\nsk_X509_EXTENSION_pop_free(a->extensions, X509_EXTENSION_free);\r\na->extensions = NULL;\r\n}\r\nint TS_REQ_get_ext_count(TS_REQ *a)\r\n{\r\nreturn X509v3_get_ext_count(a->extensions);\r\n}\r\nint TS_REQ_get_ext_by_NID(TS_REQ *a, int nid, int lastpos)\r\n{\r\nreturn X509v3_get_ext_by_NID(a->extensions, nid, lastpos);\r\n}\r\nint TS_REQ_get_ext_by_OBJ(TS_REQ *a, ASN1_OBJECT *obj, int lastpos)\r\n{\r\nreturn X509v3_get_ext_by_OBJ(a->extensions, obj, lastpos);\r\n}\r\nint TS_REQ_get_ext_by_critical(TS_REQ *a, int crit, int lastpos)\r\n{\r\nreturn X509v3_get_ext_by_critical(a->extensions, crit, lastpos);\r\n}\r\nX509_EXTENSION *TS_REQ_get_ext(TS_REQ *a, int loc)\r\n{\r\nreturn X509v3_get_ext(a->extensions,loc);\r\n}\r\nX509_EXTENSION *TS_REQ_delete_ext(TS_REQ *a, int loc)\r\n{\r\nreturn X509v3_delete_ext(a->extensions,loc);\r\n}\r\nint TS_REQ_add_ext(TS_REQ *a, X509_EXTENSION *ex, int loc)\r\n{\r\nreturn X509v3_add_ext(&a->extensions,ex,loc) != NULL;\r\n}\r\nvoid *TS_REQ_get_ext_d2i(TS_REQ *a, int nid, int *crit, int *idx)\r\n{\r\nreturn X509V3_get_d2i(a->extensions, nid, crit, idx);\r\n}
