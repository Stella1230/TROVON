static int idea_ecb_cipher(EVP_CIPHER_CTX *ctx, unsigned char *out,\r\nconst unsigned char *in, size_t inl)\r\n{\r\nBLOCK_CIPHER_ecb_loop()\r\nidea_ecb_encrypt(in + i, out + i, ctx->cipher_data);\r\nreturn 1;\r\n}\r\nstatic int idea_init_key(EVP_CIPHER_CTX *ctx, const unsigned char *key,\r\nconst unsigned char *iv, int enc)\r\n{\r\nif(!enc) {\r\nif (EVP_CIPHER_CTX_mode(ctx) == EVP_CIPH_OFB_MODE) enc = 1;\r\nelse if (EVP_CIPHER_CTX_mode(ctx) == EVP_CIPH_CFB_MODE) enc = 1;\r\n}\r\nif (enc) idea_set_encrypt_key(key,ctx->cipher_data);\r\nelse\r\n{\r\nIDEA_KEY_SCHEDULE tmp;\r\nidea_set_encrypt_key(key,&tmp);\r\nidea_set_decrypt_key(&tmp,ctx->cipher_data);\r\nOPENSSL_cleanse((unsigned char *)&tmp,\r\nsizeof(IDEA_KEY_SCHEDULE));\r\n}\r\nreturn 1;\r\n}
