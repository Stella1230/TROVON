int ENGINE_set_load_privkey_function(ENGINE *e, ENGINE_LOAD_KEY_PTR loadpriv_f)\r\n{\r\ne->load_privkey = loadpriv_f;\r\nreturn 1;\r\n}\r\nint ENGINE_set_load_pubkey_function(ENGINE *e, ENGINE_LOAD_KEY_PTR loadpub_f)\r\n{\r\ne->load_pubkey = loadpub_f;\r\nreturn 1;\r\n}\r\nint ENGINE_set_load_ssl_client_cert_function(ENGINE *e,\r\nENGINE_SSL_CLIENT_CERT_PTR loadssl_f)\r\n{\r\ne->load_ssl_client_cert = loadssl_f;\r\nreturn 1;\r\n}\r\nENGINE_LOAD_KEY_PTR ENGINE_get_load_privkey_function(const ENGINE *e)\r\n{\r\nreturn e->load_privkey;\r\n}\r\nENGINE_LOAD_KEY_PTR ENGINE_get_load_pubkey_function(const ENGINE *e)\r\n{\r\nreturn e->load_pubkey;\r\n}\r\nENGINE_SSL_CLIENT_CERT_PTR ENGINE_get_ssl_client_cert_function(const ENGINE *e)\r\n{\r\nreturn e->load_ssl_client_cert;\r\n}\r\nEVP_PKEY *ENGINE_load_private_key(ENGINE *e, const char *key_id,\r\nUI_METHOD *ui_method, void *callback_data)\r\n{\r\nEVP_PKEY *pkey;\r\nif(e == NULL)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PRIVATE_KEY,\r\nERR_R_PASSED_NULL_PARAMETER);\r\nreturn 0;\r\n}\r\nCRYPTO_w_lock(CRYPTO_LOCK_ENGINE);\r\nif(e->funct_ref == 0)\r\n{\r\nCRYPTO_w_unlock(CRYPTO_LOCK_ENGINE);\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PRIVATE_KEY,\r\nENGINE_R_NOT_INITIALISED);\r\nreturn 0;\r\n}\r\nCRYPTO_w_unlock(CRYPTO_LOCK_ENGINE);\r\nif (!e->load_privkey)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PRIVATE_KEY,\r\nENGINE_R_NO_LOAD_FUNCTION);\r\nreturn 0;\r\n}\r\npkey = e->load_privkey(e, key_id, ui_method, callback_data);\r\nif (!pkey)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PRIVATE_KEY,\r\nENGINE_R_FAILED_LOADING_PRIVATE_KEY);\r\nreturn 0;\r\n}\r\nreturn pkey;\r\n}\r\nEVP_PKEY *ENGINE_load_public_key(ENGINE *e, const char *key_id,\r\nUI_METHOD *ui_method, void *callback_data)\r\n{\r\nEVP_PKEY *pkey;\r\nif(e == NULL)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PUBLIC_KEY,\r\nERR_R_PASSED_NULL_PARAMETER);\r\nreturn 0;\r\n}\r\nCRYPTO_w_lock(CRYPTO_LOCK_ENGINE);\r\nif(e->funct_ref == 0)\r\n{\r\nCRYPTO_w_unlock(CRYPTO_LOCK_ENGINE);\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PUBLIC_KEY,\r\nENGINE_R_NOT_INITIALISED);\r\nreturn 0;\r\n}\r\nCRYPTO_w_unlock(CRYPTO_LOCK_ENGINE);\r\nif (!e->load_pubkey)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PUBLIC_KEY,\r\nENGINE_R_NO_LOAD_FUNCTION);\r\nreturn 0;\r\n}\r\npkey = e->load_pubkey(e, key_id, ui_method, callback_data);\r\nif (!pkey)\r\n{\r\nENGINEerr(ENGINE_F_ENGINE_LOAD_PUBLIC_KEY,\r\nENGINE_R_FAILED_LOADING_PUBLIC_KEY);\r\nreturn 0;\r\n}\r\nreturn pkey;\r\n}
