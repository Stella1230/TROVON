RSA *RSA_generate_key(int bits, unsigned long e_value,\r\nvoid (*callback)(int,int,void *), void *cb_arg)\r\n{\r\nBN_GENCB cb;\r\nint i;\r\nRSA *rsa = RSA_new();\r\nBIGNUM *e = BN_new();\r\nif(!rsa || !e) goto err;\r\nfor (i=0; i<(int)sizeof(unsigned long)*8; i++)\r\n{\r\nif (e_value & (1UL<<i))\r\nif (BN_set_bit(e,i) == 0)\r\ngoto err;\r\n}\r\nBN_GENCB_set_old(&cb, callback, cb_arg);\r\nif(RSA_generate_key_ex(rsa, bits, e, &cb)) {\r\nBN_free(e);\r\nreturn rsa;\r\n}\r\nerr:\r\nif(e) BN_free(e);\r\nif(rsa) RSA_free(rsa);\r\nreturn 0;\r\n}
