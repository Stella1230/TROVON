main()\r\n{\r\nint i;\r\nBIO *mbio,*b64bio,*bio;\r\nchar buf[512];\r\nchar *p;\r\nmbio=BIO_new(BIO_s_mem());\r\nb64bio=BIO_new(BIO_f_base64());\r\nbio=BIO_push(b64bio,mbio);\r\nfor (;;)\r\n{\r\ni=fread(buf,1,512,stdin);\r\nif (i <= 0) break;\r\nBIO_write(bio,buf,i);\r\n}\r\nBIO_flush(bio);\r\nprintf("We have %d bytes available\n",BIO_pending(mbio));\r\ni=(int)BIO_ctrl(mbio,BIO_CTRL_INFO,0,(char *)&p);\r\nprintf("%d\n",i);\r\nfwrite("---\n",1,4,stdout);\r\nfwrite(p,1,i,stdout);\r\nfwrite("---\n",1,4,stdout);\r\nBIO_free_all(bio);\r\n}
