int PKCS12_add_localkeyid(PKCS12_SAFEBAG *bag, unsigned char *name,\r\nint namelen)\r\n{\r\nif (X509at_add1_attr_by_NID(&bag->attrib, NID_localKeyID,\r\nV_ASN1_OCTET_STRING, name, namelen))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nint PKCS8_add_keyusage(PKCS8_PRIV_KEY_INFO *p8, int usage)\r\n{\r\nunsigned char us_val;\r\nus_val = (unsigned char) usage;\r\nif (X509at_add1_attr_by_NID(&p8->attributes, NID_key_usage,\r\nV_ASN1_BIT_STRING, &us_val, 1))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nint PKCS12_add_friendlyname_asc(PKCS12_SAFEBAG *bag, const char *name,\r\nint namelen)\r\n{\r\nif (X509at_add1_attr_by_NID(&bag->attrib, NID_friendlyName,\r\nMBSTRING_ASC, (unsigned char *)name, namelen))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nint PKCS12_add_friendlyname_uni(PKCS12_SAFEBAG *bag,\r\nconst unsigned char *name, int namelen)\r\n{\r\nif (X509at_add1_attr_by_NID(&bag->attrib, NID_friendlyName,\r\nMBSTRING_BMP, name, namelen))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nint PKCS12_add_CSPName_asc(PKCS12_SAFEBAG *bag, const char *name,\r\nint namelen)\r\n{\r\nif (X509at_add1_attr_by_NID(&bag->attrib, NID_ms_csp_name,\r\nMBSTRING_ASC, (unsigned char *)name, namelen))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nchar *PKCS12_get_friendlyname(PKCS12_SAFEBAG *bag)\r\n{\r\nASN1_TYPE *atype;\r\nif (!(atype = PKCS12_get_attr(bag, NID_friendlyName))) return NULL;\r\nif (atype->type != V_ASN1_BMPSTRING) return NULL;\r\nreturn OPENSSL_uni2asc(atype->value.bmpstring->data,\r\natype->value.bmpstring->length);\r\n}
