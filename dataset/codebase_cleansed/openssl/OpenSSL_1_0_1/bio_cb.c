long MS_CALLBACK BIO_debug_callback(BIO *bio, int cmd, const char *argp,\r\nint argi, long argl, long ret)\r\n{\r\nBIO *b;\r\nMS_STATIC char buf[256];\r\nchar *p;\r\nlong r=1;\r\nsize_t p_maxlen;\r\nif (BIO_CB_RETURN & cmd)\r\nr=ret;\r\nBIO_snprintf(buf,sizeof buf,"BIO[%08lX]:",(unsigned long)bio);\r\np= &(buf[14]);\r\np_maxlen = sizeof buf - 14;\r\nswitch (cmd)\r\n{\r\ncase BIO_CB_FREE:\r\nBIO_snprintf(p,p_maxlen,"Free - %s\n",bio->method->name);\r\nbreak;\r\ncase BIO_CB_READ:\r\nif (bio->method->type & BIO_TYPE_DESCRIPTOR)\r\nBIO_snprintf(p,p_maxlen,"read(%d,%lu) - %s fd=%d\n",\r\nbio->num,(unsigned long)argi,\r\nbio->method->name,bio->num);\r\nelse\r\nBIO_snprintf(p,p_maxlen,"read(%d,%lu) - %s\n",\r\nbio->num,(unsigned long)argi,\r\nbio->method->name);\r\nbreak;\r\ncase BIO_CB_WRITE:\r\nif (bio->method->type & BIO_TYPE_DESCRIPTOR)\r\nBIO_snprintf(p,p_maxlen,"write(%d,%lu) - %s fd=%d\n",\r\nbio->num,(unsigned long)argi,\r\nbio->method->name,bio->num);\r\nelse\r\nBIO_snprintf(p,p_maxlen,"write(%d,%lu) - %s\n",\r\nbio->num,(unsigned long)argi,\r\nbio->method->name);\r\nbreak;\r\ncase BIO_CB_PUTS:\r\nBIO_snprintf(p,p_maxlen,"puts() - %s\n",bio->method->name);\r\nbreak;\r\ncase BIO_CB_GETS:\r\nBIO_snprintf(p,p_maxlen,"gets(%lu) - %s\n",(unsigned long)argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_CTRL:\r\nBIO_snprintf(p,p_maxlen,"ctrl(%lu) - %s\n",(unsigned long)argi,bio->method->name);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_READ:\r\nBIO_snprintf(p,p_maxlen,"read return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_WRITE:\r\nBIO_snprintf(p,p_maxlen,"write return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_GETS:\r\nBIO_snprintf(p,p_maxlen,"gets return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_PUTS:\r\nBIO_snprintf(p,p_maxlen,"puts return %ld\n",ret);\r\nbreak;\r\ncase BIO_CB_RETURN|BIO_CB_CTRL:\r\nBIO_snprintf(p,p_maxlen,"ctrl return %ld\n",ret);\r\nbreak;\r\ndefault:\r\nBIO_snprintf(p,p_maxlen,"bio callback - unknown type (%d)\n",cmd);\r\nbreak;\r\n}\r\nb=(BIO *)bio->cb_arg;\r\nif (b != NULL)\r\nBIO_write(b,buf,strlen(buf));\r\n#if !defined(OPENSSL_NO_STDIO) && !defined(OPENSSL_SYS_WIN16)\r\nelse\r\nfputs(buf,stderr);\r\n#endif\r\nreturn(r);\r\n}
