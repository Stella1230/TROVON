const EVP_CIPHER *EVP_desx_cbc(void)\r\n{\r\nreturn(&d_xcbc_cipher);\r\n}\r\nstatic int desx_cbc_init_key(EVP_CIPHER_CTX *ctx, const unsigned char *key,\r\nconst unsigned char *iv, int enc)\r\n{\r\nDES_cblock *deskey = (DES_cblock *)key;\r\nDES_set_key_unchecked(deskey,&data(ctx)->ks);\r\nmemcpy(&data(ctx)->inw[0],&key[8],8);\r\nmemcpy(&data(ctx)->outw[0],&key[16],8);\r\nreturn 1;\r\n}\r\nstatic int desx_cbc_cipher(EVP_CIPHER_CTX *ctx, unsigned char *out,\r\nconst unsigned char *in, size_t inl)\r\n{\r\nwhile (inl>=EVP_MAXCHUNK)\r\n{\r\nDES_xcbc_encrypt(in,out,(long)EVP_MAXCHUNK,&data(ctx)->ks,\r\n(DES_cblock *)&(ctx->iv[0]),\r\n&data(ctx)->inw,\r\n&data(ctx)->outw,\r\nctx->encrypt);\r\ninl-=EVP_MAXCHUNK;\r\nin +=EVP_MAXCHUNK;\r\nout+=EVP_MAXCHUNK;\r\n}\r\nif (inl)\r\nDES_xcbc_encrypt(in,out,(long)inl,&data(ctx)->ks,\r\n(DES_cblock *)&(ctx->iv[0]),\r\n&data(ctx)->inw,\r\n&data(ctx)->outw,\r\nctx->encrypt);\r\nreturn 1;\r\n}
