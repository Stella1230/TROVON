void *ASN1_unpack_string(ASN1_STRING *oct, d2i_of_void *d2i)\r\n{\r\nconst unsigned char *p;\r\nchar *ret;\r\np = oct->data;\r\nif(!(ret = d2i(NULL, &p, oct->length)))\r\nASN1err(ASN1_F_ASN1_UNPACK_STRING,ASN1_R_DECODE_ERROR);\r\nreturn ret;\r\n}\r\nASN1_STRING *ASN1_pack_string(void *obj, i2d_of_void *i2d, ASN1_STRING **oct)\r\n{\r\nunsigned char *p;\r\nASN1_STRING *octmp;\r\nif (!oct || !*oct) {\r\nif (!(octmp = ASN1_STRING_new ())) {\r\nASN1err(ASN1_F_ASN1_PACK_STRING,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nif (oct) *oct = octmp;\r\n} else octmp = *oct;\r\nif (!(octmp->length = i2d(obj, NULL))) {\r\nASN1err(ASN1_F_ASN1_PACK_STRING,ASN1_R_ENCODE_ERROR);\r\nreturn NULL;\r\n}\r\nif (!(p = OPENSSL_malloc (octmp->length))) {\r\nASN1err(ASN1_F_ASN1_PACK_STRING,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\noctmp->data = p;\r\ni2d (obj, &p);\r\nreturn octmp;\r\n}\r\nASN1_STRING *ASN1_item_pack(void *obj, const ASN1_ITEM *it, ASN1_STRING **oct)\r\n{\r\nASN1_STRING *octmp;\r\nif (!oct || !*oct) {\r\nif (!(octmp = ASN1_STRING_new ())) {\r\nASN1err(ASN1_F_ASN1_ITEM_PACK,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nif (oct) *oct = octmp;\r\n} else octmp = *oct;\r\nif(octmp->data) {\r\nOPENSSL_free(octmp->data);\r\noctmp->data = NULL;\r\n}\r\nif (!(octmp->length = ASN1_item_i2d(obj, &octmp->data, it))) {\r\nASN1err(ASN1_F_ASN1_ITEM_PACK,ASN1_R_ENCODE_ERROR);\r\nreturn NULL;\r\n}\r\nif (!octmp->data) {\r\nASN1err(ASN1_F_ASN1_ITEM_PACK,ERR_R_MALLOC_FAILURE);\r\nreturn NULL;\r\n}\r\nreturn octmp;\r\n}\r\nvoid *ASN1_item_unpack(ASN1_STRING *oct, const ASN1_ITEM *it)\r\n{\r\nconst unsigned char *p;\r\nvoid *ret;\r\np = oct->data;\r\nif(!(ret = ASN1_item_d2i(NULL, &p, oct->length, it)))\r\nASN1err(ASN1_F_ASN1_ITEM_UNPACK,ASN1_R_DECODE_ERROR);\r\nreturn ret;\r\n}
