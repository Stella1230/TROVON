int TS_ASN1_INTEGER_print_bio(BIO *bio, const ASN1_INTEGER *num)\r\n{\r\nBIGNUM num_bn;\r\nint result = 0;\r\nchar *hex;\r\nBN_init(&num_bn);\r\nASN1_INTEGER_to_BN(num, &num_bn);\r\nif ((hex = BN_bn2hex(&num_bn)))\r\n{\r\nresult = BIO_write(bio, "0x", 2) > 0;\r\nresult = result && BIO_write(bio, hex, strlen(hex)) > 0;\r\nOPENSSL_free(hex);\r\n}\r\nBN_free(&num_bn);\r\nreturn result;\r\n}\r\nint TS_OBJ_print_bio(BIO *bio, const ASN1_OBJECT *obj)\r\n{\r\nchar obj_txt[128];\r\nint len = OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);\r\nBIO_write(bio, obj_txt, len);\r\nBIO_write(bio, "\n", 1);\r\nreturn 1;\r\n}\r\nint TS_X509_ALGOR_print_bio(BIO *bio, const X509_ALGOR *alg)\r\n{\r\nint i = OBJ_obj2nid(alg->algorithm);\r\nreturn BIO_printf(bio, "Hash Algorithm: %s\n",\r\n(i == NID_undef) ? "UNKNOWN" : OBJ_nid2ln(i));\r\n}\r\nint TS_MSG_IMPRINT_print_bio(BIO *bio, TS_MSG_IMPRINT *a)\r\n{\r\nconst ASN1_OCTET_STRING *msg;\r\nTS_X509_ALGOR_print_bio(bio, TS_MSG_IMPRINT_get_algo(a));\r\nBIO_printf(bio, "Message data:\n");\r\nmsg = TS_MSG_IMPRINT_get_msg(a);\r\nBIO_dump_indent(bio, (const char *)M_ASN1_STRING_data(msg),\r\nM_ASN1_STRING_length(msg), 4);\r\nreturn 1;\r\n}
