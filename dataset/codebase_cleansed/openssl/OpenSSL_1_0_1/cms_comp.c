int main(int argc, char **argv)\r\n{\r\nBIO *in = NULL, *out = NULL;\r\nCMS_ContentInfo *cms = NULL;\r\nint ret = 1;\r\nint flags = CMS_STREAM;\r\nOpenSSL_add_all_algorithms();\r\nERR_load_crypto_strings();\r\nin = BIO_new_file("comp.txt", "r");\r\nif (!in)\r\ngoto err;\r\ncms = CMS_compress(in, NID_zlib_compression, flags);\r\nif (!cms)\r\ngoto err;\r\nout = BIO_new_file("smcomp.txt", "w");\r\nif (!out)\r\ngoto err;\r\nif (!SMIME_write_CMS(out, cms, in, flags))\r\ngoto err;\r\nret = 0;\r\nerr:\r\nif (ret)\r\n{\r\nfprintf(stderr, "Error Compressing Data\n");\r\nERR_print_errors_fp(stderr);\r\n}\r\nif (cms)\r\nCMS_ContentInfo_free(cms);\r\nif (in)\r\nBIO_free(in);\r\nif (out)\r\nBIO_free(out);\r\nreturn ret;\r\n}
