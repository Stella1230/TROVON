int PKCS7_add_attrib_content_type(PKCS7_SIGNER_INFO *si, ASN1_OBJECT *coid)\r\n{\r\nif (PKCS7_get_signed_attribute(si, NID_pkcs9_contentType))\r\nreturn 0;\r\nif (!coid)\r\ncoid = OBJ_nid2obj(NID_pkcs7_data);\r\nreturn PKCS7_add_signed_attribute(si, NID_pkcs9_contentType,\r\nV_ASN1_OBJECT, coid);\r\n}\r\nint PKCS7_add0_attrib_signing_time(PKCS7_SIGNER_INFO *si, ASN1_TIME *t)\r\n{\r\nif (!t && !(t=X509_gmtime_adj(NULL,0)))\r\n{\r\nPKCS7err(PKCS7_F_PKCS7_ADD0_ATTRIB_SIGNING_TIME,\r\nERR_R_MALLOC_FAILURE);\r\nreturn 0;\r\n}\r\nreturn PKCS7_add_signed_attribute(si, NID_pkcs9_signingTime,\r\nV_ASN1_UTCTIME, t);\r\n}\r\nint PKCS7_add1_attrib_digest(PKCS7_SIGNER_INFO *si,\r\nconst unsigned char *md, int mdlen)\r\n{\r\nASN1_OCTET_STRING *os;\r\nos = ASN1_OCTET_STRING_new();\r\nif (!os)\r\nreturn 0;\r\nif (!ASN1_STRING_set(os, md, mdlen)\r\n|| !PKCS7_add_signed_attribute(si, NID_pkcs9_messageDigest,\r\nV_ASN1_OCTET_STRING, os))\r\n{\r\nASN1_OCTET_STRING_free(os);\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}
