static void\r\nexchange (char **argv, struct _getopt_data *d)\r\n{\r\nint bottom = d->__first_nonopt;\r\nint middle = d->__last_nonopt;\r\nint top = d->optind;\r\nchar *tem;\r\n#if defined _LIBC && defined USE_NONOPTION_FLAGS\r\nif (d->__nonoption_flags_len > 0 && top >= d->__nonoption_flags_max_len)\r\n{\r\nchar *new_str = malloc (top + 1);\r\nif (new_str == NULL)\r\nd->__nonoption_flags_len = d->__nonoption_flags_max_len = 0;\r\nelse\r\n{\r\nmemset (__mempcpy (new_str, __getopt_nonoption_flags,\r\nd->__nonoption_flags_max_len),\r\n'\0', top + 1 - d->__nonoption_flags_max_len);\r\nd->__nonoption_flags_max_len = top + 1;\r\n__getopt_nonoption_flags = new_str;\r\n}\r\n}\r\n#endif\r\nwhile (top > middle && middle > bottom)\r\n{\r\nif (top - middle > middle - bottom)\r\n{\r\nint len = middle - bottom;\r\nregister int i;\r\nfor (i = 0; i < len; i++)\r\n{\r\ntem = argv[bottom + i];\r\nargv[bottom + i] = argv[top - (middle - bottom) + i];\r\nargv[top - (middle - bottom) + i] = tem;\r\nSWAP_FLAGS (bottom + i, top - (middle - bottom) + i);\r\n}\r\ntop -= len;\r\n}\r\nelse\r\n{\r\nint len = top - middle;\r\nregister int i;\r\nfor (i = 0; i < len; i++)\r\n{\r\ntem = argv[bottom + i];\r\nargv[bottom + i] = argv[middle + i];\r\nargv[middle + i] = tem;\r\nSWAP_FLAGS (bottom + i, middle + i);\r\n}\r\nbottom += len;\r\n}\r\n}\r\nd->__first_nonopt += (d->optind - d->__last_nonopt);\r\nd->__last_nonopt = d->optind;\r\n}\r\nstatic const char *\r\n_getopt_initialize (int argc, char *const *argv, const char *optstring,\r\nstruct _getopt_data *d, int posixly_correct)\r\n{\r\nd->__first_nonopt = d->__last_nonopt = d->optind;\r\nd->__nextchar = NULL;\r\nd->__posixly_correct = posixly_correct | !!getenv ("POSIXLY_CORRECT");\r\nif (optstring[0] == '-')\r\n{\r\nd->__ordering = RETURN_IN_ORDER;\r\n++optstring;\r\n}\r\nelse if (optstring[0] == '+')\r\n{\r\nd->__ordering = REQUIRE_ORDER;\r\n++optstring;\r\n}\r\nelse if (d->__posixly_correct)\r\nd->__ordering = REQUIRE_ORDER;\r\nelse\r\nd->__ordering = PERMUTE;\r\n#if defined _LIBC && defined USE_NONOPTION_FLAGS\r\nif (!d->__posixly_correct\r\n&& argc == __libc_argc && argv == __libc_argv)\r\n{\r\nif (d->__nonoption_flags_max_len == 0)\r\n{\r\nif (__getopt_nonoption_flags == NULL\r\n|| __getopt_nonoption_flags[0] == '\0')\r\nd->__nonoption_flags_max_len = -1;\r\nelse\r\n{\r\nconst char *orig_str = __getopt_nonoption_flags;\r\nint len = d->__nonoption_flags_max_len = strlen (orig_str);\r\nif (d->__nonoption_flags_max_len < argc)\r\nd->__nonoption_flags_max_len = argc;\r\n__getopt_nonoption_flags =\r\n(char *) malloc (d->__nonoption_flags_max_len);\r\nif (__getopt_nonoption_flags == NULL)\r\nd->__nonoption_flags_max_len = -1;\r\nelse\r\nmemset (__mempcpy (__getopt_nonoption_flags, orig_str, len),\r\n'\0', d->__nonoption_flags_max_len - len);\r\n}\r\n}\r\nd->__nonoption_flags_len = d->__nonoption_flags_max_len;\r\n}\r\nelse\r\nd->__nonoption_flags_len = 0;\r\n#endif\r\nreturn optstring;\r\n}\r\nint\r\n_getopt_internal_r (int argc, char *const *argv, const char *optstring,\r\nconst struct option *longopts, int *longind,\r\nint long_only, struct _getopt_data *d, int posixly_correct)\r\n{\r\nint print_errors = d->opterr;\r\nif (argc < 1)\r\nreturn -1;\r\nd->optarg = NULL;\r\nif (d->optind == 0 || !d->__initialized)\r\n{\r\nif (d->optind == 0)\r\nd->optind = 1;\r\noptstring = _getopt_initialize (argc, argv, optstring, d,\r\nposixly_correct);\r\nd->__initialized = 1;\r\n}\r\nelse if (optstring[0] == '-' || optstring[0] == '+')\r\noptstring++;\r\nif (optstring[0] == ':')\r\nprint_errors = 0;\r\n#if defined _LIBC && defined USE_NONOPTION_FLAGS\r\n# define NONOPTION_P (argv[d->optind][0] != '-' || argv[d->optind][1] == '\0' \\r\n|| (d->optind < d->__nonoption_flags_len \\r\n&& __getopt_nonoption_flags[d->optind] == '1'))\r\n#else\r\n# define NONOPTION_P (argv[d->optind][0] != '-' || argv[d->optind][1] == '\0')\r\n#endif\r\nif (d->__nextchar == NULL || *d->__nextchar == '\0')\r\n{\r\nif (d->__last_nonopt > d->optind)\r\nd->__last_nonopt = d->optind;\r\nif (d->__first_nonopt > d->optind)\r\nd->__first_nonopt = d->optind;\r\nif (d->__ordering == PERMUTE)\r\n{\r\nif (d->__first_nonopt != d->__last_nonopt\r\n&& d->__last_nonopt != d->optind)\r\nexchange ((char **) argv, d);\r\nelse if (d->__last_nonopt != d->optind)\r\nd->__first_nonopt = d->optind;\r\nwhile (d->optind < argc && NONOPTION_P)\r\nd->optind++;\r\nd->__last_nonopt = d->optind;\r\n}\r\nif (d->optind != argc && !strcmp (argv[d->optind], "--"))\r\n{\r\nd->optind++;\r\nif (d->__first_nonopt != d->__last_nonopt\r\n&& d->__last_nonopt != d->optind)\r\nexchange ((char **) argv, d);\r\nelse if (d->__first_nonopt == d->__last_nonopt)\r\nd->__first_nonopt = d->optind;\r\nd->__last_nonopt = argc;\r\nd->optind = argc;\r\n}\r\nif (d->optind == argc)\r\n{\r\nif (d->__first_nonopt != d->__last_nonopt)\r\nd->optind = d->__first_nonopt;\r\nreturn -1;\r\n}\r\nif (NONOPTION_P)\r\n{\r\nif (d->__ordering == REQUIRE_ORDER)\r\nreturn -1;\r\nd->optarg = argv[d->optind++];\r\nreturn 1;\r\n}\r\nd->__nextchar = (argv[d->optind] + 1\r\n+ (longopts != NULL && argv[d->optind][1] == '-'));\r\n}\r\nif (longopts != NULL\r\n&& (argv[d->optind][1] == '-'\r\n|| (long_only && (argv[d->optind][2]\r\n|| !strchr (optstring, argv[d->optind][1])))))\r\n{\r\nchar *nameend;\r\nsize_t namelen;\r\nconst struct option *p;\r\nconst struct option *pfound = NULL;\r\nstruct option_list\r\n{\r\nconst struct option *p;\r\nstruct option_list *next;\r\n} *ambig_list = NULL;\r\nint exact = 0;\r\nint indfound = -1;\r\nint option_index;\r\nfor (nameend = d->__nextchar; *nameend && *nameend != '='; nameend++)\r\n;\r\nnamelen = nameend - d->__nextchar;\r\nfor (p = longopts, option_index = 0; p->name; p++, option_index++)\r\nif (!strncmp (p->name, d->__nextchar, namelen))\r\n{\r\nif (namelen == (unsigned int) strlen (p->name))\r\n{\r\npfound = p;\r\nindfound = option_index;\r\nexact = 1;\r\nbreak;\r\n}\r\nelse if (pfound == NULL)\r\n{\r\npfound = p;\r\nindfound = option_index;\r\n}\r\nelse if (long_only\r\n|| pfound->has_arg != p->has_arg\r\n|| pfound->flag != p->flag\r\n|| pfound->val != p->val)\r\n{\r\nstruct option_list *newp = alloca (sizeof (*newp));\r\nnewp->p = p;\r\nnewp->next = ambig_list;\r\nambig_list = newp;\r\n}\r\n}\r\nif (ambig_list != NULL && !exact)\r\n{\r\nif (print_errors)\r\n{\r\nstruct option_list first;\r\nfirst.p = pfound;\r\nfirst.next = ambig_list;\r\nambig_list = &first;\r\n#if defined _LIBC\r\nchar *buf = NULL;\r\nsize_t buflen = 0;\r\nFILE *fp = open_memstream (&buf, &buflen);\r\nif (fp != NULL)\r\n{\r\nfprintf (fp,\r\n_("%s: option '%s' is ambiguous; possibilities:"),\r\nargv[0], argv[d->optind]);\r\ndo\r\n{\r\nfprintf (fp, " '--%s'", ambig_list->p->name);\r\nambig_list = ambig_list->next;\r\n}\r\nwhile (ambig_list != NULL);\r\nfputc_unlocked ('\n', fp);\r\nif (__builtin_expect (fclose (fp) != EOF, 1))\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n}\r\n#else\r\nfprintf (stderr,\r\n_("%s: option '%s' is ambiguous; possibilities:"),\r\nargv[0], argv[d->optind]);\r\ndo\r\n{\r\nfprintf (stderr, " '--%s'", ambig_list->p->name);\r\nambig_list = ambig_list->next;\r\n}\r\nwhile (ambig_list != NULL);\r\nfputc ('\n', stderr);\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nd->optind++;\r\nd->optopt = 0;\r\nreturn '?';\r\n}\r\nif (pfound != NULL)\r\n{\r\noption_index = indfound;\r\nd->optind++;\r\nif (*nameend)\r\n{\r\nif (pfound->has_arg)\r\nd->optarg = nameend + 1;\r\nelse\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nint n;\r\n#endif\r\nif (argv[d->optind - 1][1] == '-')\r\n{\r\n#if defined _LIBC\r\nn = __asprintf (&buf, _("\\r\n%s: option '--%s' doesn't allow an argument\n"),\r\nargv[0], pfound->name);\r\n#else\r\nfprintf (stderr, _("\\r\n%s: option '--%s' doesn't allow an argument\n"),\r\nargv[0], pfound->name);\r\n#endif\r\n}\r\nelse\r\n{\r\n#if defined _LIBC\r\nn = __asprintf (&buf, _("\\r\n%s: option '%c%s' doesn't allow an argument\n"),\r\nargv[0], argv[d->optind - 1][0],\r\npfound->name);\r\n#else\r\nfprintf (stderr, _("\\r\n%s: option '%c%s' doesn't allow an argument\n"),\r\nargv[0], argv[d->optind - 1][0],\r\npfound->name);\r\n#endif\r\n}\r\n#if defined _LIBC\r\nif (n >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2\r\n|= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nd->optopt = pfound->val;\r\nreturn '?';\r\n}\r\n}\r\nelse if (pfound->has_arg == 1)\r\n{\r\nif (d->optind < argc)\r\nd->optarg = argv[d->optind++];\r\nelse\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf, _("\\r\n%s: option '--%s' requires an argument\n"),\r\nargv[0], pfound->name) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2\r\n|= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr,\r\n_("%s: option '--%s' requires an argument\n"),\r\nargv[0], pfound->name);\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nd->optopt = pfound->val;\r\nreturn optstring[0] == ':' ? ':' : '?';\r\n}\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nif (longind != NULL)\r\n*longind = option_index;\r\nif (pfound->flag)\r\n{\r\n*(pfound->flag) = pfound->val;\r\nreturn 0;\r\n}\r\nreturn pfound->val;\r\n}\r\nif (!long_only || argv[d->optind][1] == '-'\r\n|| strchr (optstring, *d->__nextchar) == NULL)\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nint n;\r\n#endif\r\nif (argv[d->optind][1] == '-')\r\n{\r\n#if defined _LIBC\r\nn = __asprintf (&buf, _("%s: unrecognized option '--%s'\n"),\r\nargv[0], d->__nextchar);\r\n#else\r\nfprintf (stderr, _("%s: unrecognized option '--%s'\n"),\r\nargv[0], d->__nextchar);\r\n#endif\r\n}\r\nelse\r\n{\r\n#if defined _LIBC\r\nn = __asprintf (&buf, _("%s: unrecognized option '%c%s'\n"),\r\nargv[0], argv[d->optind][0], d->__nextchar);\r\n#else\r\nfprintf (stderr, _("%s: unrecognized option '%c%s'\n"),\r\nargv[0], argv[d->optind][0], d->__nextchar);\r\n#endif\r\n}\r\n#if defined _LIBC\r\nif (n >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#endif\r\n}\r\nd->__nextchar = (char *) "";\r\nd->optind++;\r\nd->optopt = 0;\r\nreturn '?';\r\n}\r\n}\r\n{\r\nchar c = *d->__nextchar++;\r\nchar *temp = strchr (optstring, c);\r\nchar *nameend;\r\nconst struct option *p;\r\nconst struct option *pfound = NULL;\r\nint exact = 0;\r\nint ambig = 0;\r\nint indfound = 0;\r\nint option_index;\r\nif (*d->__nextchar == '\0')\r\n++d->optind;\r\nif (temp == NULL || c == ':' || c == ';')\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nint n;\r\n#endif\r\n#if defined _LIBC\r\nn = __asprintf (&buf, _("%s: invalid option -- '%c'\n"),\r\nargv[0], c);\r\n#else\r\nfprintf (stderr, _("%s: invalid option -- '%c'\n"), argv[0], c);\r\n#endif\r\n#if defined _LIBC\r\nif (n >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#endif\r\n}\r\nd->optopt = c;\r\nreturn '?';\r\n}\r\nif (temp[0] == 'W' && temp[1] == ';')\r\n{\r\nif (longopts == NULL)\r\ngoto no_longs;\r\nif (*d->__nextchar != '\0')\r\n{\r\nd->optarg = d->__nextchar;\r\nd->optind++;\r\n}\r\nelse if (d->optind == argc)\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf,\r\n_("%s: option requires an argument -- '%c'\n"),\r\nargv[0], c) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr,\r\n_("%s: option requires an argument -- '%c'\n"),\r\nargv[0], c);\r\n#endif\r\n}\r\nd->optopt = c;\r\nif (optstring[0] == ':')\r\nc = ':';\r\nelse\r\nc = '?';\r\nreturn c;\r\n}\r\nelse\r\nd->optarg = argv[d->optind++];\r\nfor (d->__nextchar = nameend = d->optarg; *nameend && *nameend != '=';\r\nnameend++)\r\n;\r\nfor (p = longopts, option_index = 0; p->name; p++, option_index++)\r\nif (!strncmp (p->name, d->__nextchar, nameend - d->__nextchar))\r\n{\r\nif ((unsigned int) (nameend - d->__nextchar) == strlen (p->name))\r\n{\r\npfound = p;\r\nindfound = option_index;\r\nexact = 1;\r\nbreak;\r\n}\r\nelse if (pfound == NULL)\r\n{\r\npfound = p;\r\nindfound = option_index;\r\n}\r\nelse if (long_only\r\n|| pfound->has_arg != p->has_arg\r\n|| pfound->flag != p->flag\r\n|| pfound->val != p->val)\r\nambig = 1;\r\n}\r\nif (ambig && !exact)\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf, _("%s: option '-W %s' is ambiguous\n"),\r\nargv[0], d->optarg) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr, _("%s: option '-W %s' is ambiguous\n"),\r\nargv[0], d->optarg);\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nd->optind++;\r\nreturn '?';\r\n}\r\nif (pfound != NULL)\r\n{\r\noption_index = indfound;\r\nif (*nameend)\r\n{\r\nif (pfound->has_arg)\r\nd->optarg = nameend + 1;\r\nelse\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf, _("\\r\n%s: option '-W %s' doesn't allow an argument\n"),\r\nargv[0], pfound->name) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2\r\n|= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr, _("\\r\n%s: option '-W %s' doesn't allow an argument\n"),\r\nargv[0], pfound->name);\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nreturn '?';\r\n}\r\n}\r\nelse if (pfound->has_arg == 1)\r\n{\r\nif (d->optind < argc)\r\nd->optarg = argv[d->optind++];\r\nelse\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf, _("\\r\n%s: option '-W %s' requires an argument\n"),\r\nargv[0], pfound->name) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2\r\n|= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr, _("\\r\n%s: option '-W %s' requires an argument\n"),\r\nargv[0], pfound->name);\r\n#endif\r\n}\r\nd->__nextchar += strlen (d->__nextchar);\r\nreturn optstring[0] == ':' ? ':' : '?';\r\n}\r\n}\r\nelse\r\nd->optarg = NULL;\r\nd->__nextchar += strlen (d->__nextchar);\r\nif (longind != NULL)\r\n*longind = option_index;\r\nif (pfound->flag)\r\n{\r\n*(pfound->flag) = pfound->val;\r\nreturn 0;\r\n}\r\nreturn pfound->val;\r\n}\r\nno_longs:\r\nd->__nextchar = NULL;\r\nreturn 'W';\r\n}\r\nif (temp[1] == ':')\r\n{\r\nif (temp[2] == ':')\r\n{\r\nif (*d->__nextchar != '\0')\r\n{\r\nd->optarg = d->__nextchar;\r\nd->optind++;\r\n}\r\nelse\r\nd->optarg = NULL;\r\nd->__nextchar = NULL;\r\n}\r\nelse\r\n{\r\nif (*d->__nextchar != '\0')\r\n{\r\nd->optarg = d->__nextchar;\r\nd->optind++;\r\n}\r\nelse if (d->optind == argc)\r\n{\r\nif (print_errors)\r\n{\r\n#if defined _LIBC\r\nchar *buf;\r\nif (__asprintf (&buf, _("\\r\n%s: option requires an argument -- '%c'\n"),\r\nargv[0], c) >= 0)\r\n{\r\n_IO_flockfile (stderr);\r\nint old_flags2 = ((_IO_FILE *) stderr)->_flags2;\r\n((_IO_FILE *) stderr)->_flags2 |= _IO_FLAGS2_NOTCANCEL;\r\n__fxprintf (NULL, "%s", buf);\r\n((_IO_FILE *) stderr)->_flags2 = old_flags2;\r\n_IO_funlockfile (stderr);\r\nfree (buf);\r\n}\r\n#else\r\nfprintf (stderr,\r\n_("%s: option requires an argument -- '%c'\n"),\r\nargv[0], c);\r\n#endif\r\n}\r\nd->optopt = c;\r\nif (optstring[0] == ':')\r\nc = ':';\r\nelse\r\nc = '?';\r\n}\r\nelse\r\nd->optarg = argv[d->optind++];\r\nd->__nextchar = NULL;\r\n}\r\n}\r\nreturn c;\r\n}\r\n}\r\nint\r\n_getopt_internal (int argc, char *const *argv, const char *optstring,\r\nconst struct option *longopts, int *longind, int long_only,\r\nint posixly_correct)\r\n{\r\nint result;\r\ngetopt_data.optind = optind;\r\ngetopt_data.opterr = opterr;\r\nresult = _getopt_internal_r (argc, argv, optstring, longopts,\r\nlongind, long_only, &getopt_data,\r\nposixly_correct);\r\noptind = getopt_data.optind;\r\noptarg = getopt_data.optarg;\r\noptopt = getopt_data.optopt;\r\nreturn result;\r\n}\r\nint\r\ngetopt (int argc, char *const *argv, const char *optstring)\r\n{\r\nreturn _getopt_internal (argc, argv, optstring,\r\n(const struct option *) 0,\r\n(int *) 0,\r\n0, 0);\r\n}\r\nint\r\ngetopt_long (int argc, char *const *argv, const char *options,\r\nconst struct option *long_options, int *opt_index)\r\n{\r\nreturn _getopt_internal (argc, argv, options, long_options,\r\nopt_index, 0, 0);\r\n}\r\nint\r\n__posix_getopt (int argc, char *const *argv, const char *optstring)\r\n{\r\nreturn _getopt_internal (argc, argv, optstring,\r\n(const struct option *) 0,\r\n(int *) 0,\r\n0, 1);\r\n}\r\nint\r\nmain (int argc, char **argv)\r\n{\r\nint c;\r\nint digit_optind = 0;\r\nwhile (1)\r\n{\r\nint this_option_optind = optind ? optind : 1;\r\nc = getopt (argc, argv, "abc:d:0123456789");\r\nif (c == -1)\r\nbreak;\r\nswitch (c)\r\n{\r\ncase '0':\r\ncase '1':\r\ncase '2':\r\ncase '3':\r\ncase '4':\r\ncase '5':\r\ncase '6':\r\ncase '7':\r\ncase '8':\r\ncase '9':\r\nif (digit_optind != 0 && digit_optind != this_option_optind)\r\nprintf ("digits occur in two different argv-elements.\n");\r\ndigit_optind = this_option_optind;\r\nprintf ("option %c\n", c);\r\nbreak;\r\ncase 'a':\r\nprintf ("option a\n");\r\nbreak;\r\ncase 'b':\r\nprintf ("option b\n");\r\nbreak;\r\ncase 'c':\r\nprintf ("option c with value '%s'\n", optarg);\r\nbreak;\r\ncase '?':\r\nbreak;\r\ndefault:\r\nprintf ("?? getopt returned character code 0%o ??\n", c);\r\n}\r\n}\r\nif (optind < argc)\r\n{\r\nprintf ("non-option ARGV-elements: ");\r\nwhile (optind < argc)\r\nprintf ("%s ", argv[optind++]);\r\nprintf ("\n");\r\n}\r\nexit (0);\r\n}
