static void\r\nipv4_hash_table_print_resolved(gpointer key _U_, gpointer value, gpointer user_data _U_)\r\n{\r\nhashipv4_t *ipv4_hash_table_entry = (hashipv4_t *)value;\r\nif (!(ipv4_hash_table_entry->flags & DUMMY_ADDRESS_ENTRY)) {\r\nprintf("%s\t%s\n",\r\nipv4_hash_table_entry->ip,\r\nipv4_hash_table_entry->name);\r\n}\r\n}\r\nstatic void\r\nipv6_hash_table_print_resolved(gpointer key _U_, gpointer value, gpointer user_data _U_)\r\n{\r\nhashipv6_t *ipv6_hash_table_entry = (hashipv6_t *)value;\r\nif (!(ipv6_hash_table_entry->flags & DUMMY_ADDRESS_ENTRY)) {\r\nprintf("%s\t%s\n",\r\nipv6_hash_table_entry->ip6,\r\nipv6_hash_table_entry->name);\r\n}\r\n}\r\nstatic void\r\nhosts_draw(void *dummy _U_)\r\n{\r\nGHashTable *ipv4_hash_table;\r\nGHashTable *ipv6_hash_table;\r\nprintf("# TShark hosts output\n");\r\nprintf("#\n");\r\nprintf("# Host data gathered from %s\n", cfile.filename);\r\nprintf("\n");\r\nipv4_hash_table = get_ipv4_hash_table();\r\nif (ipv4_hash_table) {\r\ng_hash_table_foreach( ipv4_hash_table, ipv4_hash_table_print_resolved, NULL);\r\n}\r\nipv6_hash_table = get_ipv6_hash_table();\r\nif (ipv6_hash_table) {\r\ng_hash_table_foreach( ipv6_hash_table, ipv6_hash_table_print_resolved, NULL);\r\n}\r\n}\r\nstatic void\r\nhosts_init(const char *opt_arg, void *userdata _U_)\r\n{\r\nGString *error_string;\r\ngchar **tokens;\r\ngint opt_count;\r\ndump_v4 = FALSE;\r\ndump_v6 = FALSE;\r\nif (strcmp(TAP_NAME, opt_arg) == 0) {\r\ndump_v4 = TRUE;\r\ndump_v6 = TRUE;\r\n} else {\r\ntokens = g_strsplit(opt_arg, ",", 0);\r\nopt_count = 0;\r\nwhile (tokens[opt_count]) {\r\nif (strcmp("ipv4", tokens[opt_count]) == 0) {\r\ndump_v4 = TRUE;\r\n} else if (strcmp("ipv6", tokens[opt_count]) == 0) {\r\ndump_v6 = TRUE;\r\n} else if (opt_count > 0) {\r\nfprintf(stderr, "tshark: invalid \"-z " TAP_NAME "[,ipv4|ipv6]\" argument\n");\r\nexit(1);\r\n}\r\nopt_count++;\r\n}\r\ng_strfreev(tokens);\r\n}\r\nerror_string = register_tap_listener("frame", NULL, NULL, TL_REQUIRES_PROTO_TREE,\r\nNULL, NULL, hosts_draw);\r\nif (error_string) {\r\nfprintf(stderr, "tshark: Couldn't register " TAP_NAME " tap: %s\n",\r\nerror_string->str);\r\ng_string_free(error_string, TRUE);\r\nexit(1);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_hosts(void)\r\n{\r\nregister_stat_tap_ui(&hosts_ui, NULL);\r\n}
