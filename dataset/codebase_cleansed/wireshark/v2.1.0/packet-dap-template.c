void proto_register_dap(void) {\r\nstatic hf_register_info hf[] =\r\n{\r\n#include "packet-dap-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_dap,\r\n#include "packet-dap-ettarr.c"\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_dap_anonymous, { "dap.anonymous", PI_PROTOCOL, PI_NOTE, "Anonymous", EXPFILL }},\r\n};\r\nmodule_t *dap_module;\r\nexpert_module_t* expert_dap;\r\nproto_dap = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_dap, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_dap = expert_register_protocol(proto_dap);\r\nexpert_register_field_array(expert_dap, ei, array_length(ei));\r\ndap_module = prefs_register_protocol_subtree("OSI/X.500", proto_dap, prefs_register_dap);\r\nprefs_register_uint_preference(dap_module, "tcp.port", "DAP TCP Port",\r\n"Set the port for DAP operations (if other"\r\n" than the default of 102)",\r\n10, &global_dap_tcp_port);\r\n}\r\nvoid proto_reg_handoff_dap(void) {\r\noid_add_from_string("id-ac-directory-access","2.5.3.1");\r\nregister_ros_protocol_info("2.5.9.1", &dap_ros_info, 0, "id-as-directory-access", FALSE);\r\nregister_idmp_protocol_info("2.5.33.0", &dap_ros_info, 0, "dap-ip");\r\ntpkt_handle = find_dissector("tpkt");\r\nx509if_register_fmt(hf_dap_equality, "=");\r\nx509if_register_fmt(hf_dap_greaterOrEqual, ">=");\r\nx509if_register_fmt(hf_dap_lessOrEqual, "<=");\r\nx509if_register_fmt(hf_dap_approximateMatch, "=~");\r\nx509if_register_fmt(hf_dap_present, "= *");\r\n}\r\nstatic void\r\nprefs_register_dap(void)\r\n{\r\nstatic guint tcp_port = 0;\r\nif((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_delete_uint("tcp.port", tcp_port, tpkt_handle);\r\ntcp_port = global_dap_tcp_port;\r\nif((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_add_uint("tcp.port", global_dap_tcp_port, tpkt_handle);\r\n}
