static int dissect_aim_snac_signon_logon(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree)\r\n{\r\nint offset = 0;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\noffset = dissect_aim_tlv(tvb, pinfo, offset, tree, aim_client_tlvs);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_snac_signon_logon_reply(tvbuff_t *tvb,\r\npacket_info *pinfo,\r\nproto_tree *tree)\r\n{\r\nint offset = 0;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\noffset = dissect_aim_tlv(tvb, pinfo, offset, tree, aim_client_tlvs);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_snac_signon_signon(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree)\r\n{\r\nguint8 buddyname_length = 0;\r\nint offset = 0;\r\nguint8 *buddyname;\r\nproto_tree_add_item(tree, hf_aim_infotype, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset += 1;\r\nbuddyname_length = aim_get_buddyname( &buddyname, tvb, offset );\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " Username: %s",\r\nformat_text(buddyname, buddyname_length));\r\nif(tree) {\r\noffset+=dissect_aim_buddyname(tvb, pinfo, offset, tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_snac_signon_signon_reply(tvbuff_t *tvb,\r\npacket_info *pinfo _U_,\r\nproto_tree *tree)\r\n{\r\nint offset = 0;\r\nguint16 challenge_length = 0;\r\nchallenge_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_aim_signon_challenge_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_aim_signon_challenge, tvb, offset, challenge_length, ENC_UTF_8|ENC_NA);\r\noffset += challenge_length;\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_tlv_value_registration(proto_item *ti _U_, guint16 value_id _U_, tvbuff_t *tvb _U_, packet_info *pinfo _U_)\r\n{\r\nreturn 0;\r\n}\r\nstatic int dissect_aim_snac_register (tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nreturn dissect_aim_tlv(tvb, pinfo, 0, tree, aim_registration_tlvs);\r\n}\r\nvoid\r\nproto_register_aim_signon(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_aim_infotype,\r\n{ "Infotype", "aim_signon.infotype", FT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_aim_signon_challenge_len,\r\n{ "Signon challenge length", "aim_signon.challengelen", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_aim_signon_challenge,\r\n{ "Signon challenge", "aim_signon.challenge", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_aim_signon,\r\n};\r\nproto_aim_signon = proto_register_protocol("AIM Signon", "AIM Signon", "aim_signon");\r\nproto_register_field_array(proto_aim_signon, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_aim_signon(void)\r\n{\r\naim_init_family(proto_aim_signon, ett_aim_signon, FAMILY_SIGNON, aim_fnac_family_signon);\r\n}
