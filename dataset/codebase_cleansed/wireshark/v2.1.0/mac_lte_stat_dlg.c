static void mac_lte_stat_reset(void *phs)\r\n{\r\nmac_lte_stat_t *mac_lte_stat = (mac_lte_stat_t *)phs;\r\nmac_lte_ep_t *list = mac_lte_stat->ep_list;\r\nchar *display_name;\r\ngchar title[256];\r\nGtkListStore *store;\r\ngint i, n;\r\nif (mac_lte_stat->mac_lte_stat_dlg_w != NULL) {\r\ndisplay_name = cf_get_display_name(&cfile);\r\ng_snprintf(title, sizeof(title), "Wireshark: LTE MAC Traffic Statistics: %s (filter=\"%s\")",\r\ndisplay_name,\r\nstrlen(mac_lte_stat->filter) ? mac_lte_stat->filter : "none");\r\ng_free(display_name);\r\ngtk_window_set_title(GTK_WINDOW(mac_lte_stat->mac_lte_stat_dlg_w), title);\r\n}\r\ng_snprintf(title, sizeof(title), "UL/DL-SCH data (0 entries)");\r\ngtk_frame_set_label(GTK_FRAME(mac_lte_stat->mac_lte_stat_ues_lb), title);\r\nmemset(mac_lte_stat->used_ueids, 0, 65535);\r\nmac_lte_stat->number_of_ueids = 0;\r\nmemset(mac_lte_stat->used_rntis, 0, 65535);\r\nmac_lte_stat->number_of_rntis = 0;\r\nmemset(&(mac_lte_stat->common_stats), 0, sizeof(mac_lte_common_stats));\r\nstore = GTK_LIST_STORE(gtk_tree_view_get_model(mac_lte_stat->ue_table));\r\ngtk_list_store_clear(store);\r\nif (!list) {\r\nreturn;\r\n}\r\nmac_lte_stat->ep_list = NULL;\r\nfor (n=1; n <=4; n++) {\r\nfor (i=CCCH_COLUMN; i < NUM_CHANNEL_COLUMNS; i++) {\r\ngtk_label_set_text(GTK_LABEL(mac_lte_stat->selected_ue_column_entry[i][n]), "0");\r\n}\r\n}\r\n}\r\nstatic mac_lte_ep_t* alloc_mac_lte_ep(const struct mac_lte_tap_info *si, packet_info *pinfo _U_)\r\n{\r\nmac_lte_ep_t *ep;\r\nint n;\r\nif (!si) {\r\nreturn NULL;\r\n}\r\nif (!(ep = (mac_lte_ep_t *)g_malloc(sizeof(mac_lte_ep_t)))) {\r\nreturn NULL;\r\n}\r\nep->stats.rnti = si->rnti;\r\nep->stats.rnti_type = si->rntiType;\r\nep->stats.ueid = si->ueid;\r\nep->stats.UL_frames = 0;\r\nep->stats.DL_frames = 0;\r\nep->stats.UL_total_bytes = 0;\r\nep->stats.UL_raw_bytes = 0;\r\nep->stats.DL_raw_bytes = 0;\r\nep->stats.UL_padding_bytes = 0;\r\nep->stats.DL_padding_bytes = 0;\r\nep->stats.DL_total_bytes = 0;\r\nep->stats.UL_CRC_errors = 0;\r\nep->stats.DL_CRC_failures = 0;\r\nep->stats.DL_CRC_high_code_rate = 0;\r\nep->stats.DL_CRC_PDSCH_lost = 0;\r\nep->stats.DL_CRC_Duplicate_Nonzero_rv = 0;\r\nep->stats.UL_retx_frames = 0;\r\nep->stats.DL_retx_frames = 0;\r\nfor (n=0; n < 11; n++) {\r\nep->stats.UL_sdus_for_lcid[n] = 0;\r\nep->stats.UL_bytes_for_lcid[n] = 0;\r\n}\r\nep->stats.DL_total_bytes = 0;\r\nfor (n=0; n < 11; n++) {\r\nep->stats.DL_sdus_for_lcid[n] = 0;\r\nep->stats.DL_bytes_for_lcid[n] = 0;\r\n}\r\nep->next = NULL;\r\nep->iter_valid = FALSE;\r\nreturn ep;\r\n}\r\nstatic void update_ueid_rnti_counts(guint16 rnti, guint16 ueid, mac_lte_stat_t *hs)\r\n{\r\nif (!hs->used_ueids[ueid]) {\r\nhs->used_ueids[ueid] = TRUE;\r\nhs->number_of_ueids++;\r\n}\r\nif (!hs->used_rntis[rnti]) {\r\nhs->used_rntis[rnti] = TRUE;\r\nhs->number_of_rntis++;\r\n}\r\n}\r\nstatic int mac_lte_stat_packet(void *phs, packet_info *pinfo, epan_dissect_t *edt _U_,\r\nconst void *phi)\r\n{\r\nint n;\r\nmac_lte_stat_t *hs = (mac_lte_stat_t *)phs;\r\nmac_lte_ep_t *tmp = NULL, *te = NULL;\r\nconst struct mac_lte_tap_info *si = (const struct mac_lte_tap_info *)phi;\r\nif (!hs) {\r\nreturn 0;\r\n}\r\nhs->common_stats.all_frames++;\r\nswitch (si->rntiType) {\r\ncase P_RNTI:\r\nhs->common_stats.pch_frames++;\r\nhs->common_stats.pch_bytes += si->single_number_of_bytes;\r\nhs->common_stats.pch_paging_ids += si->number_of_paging_ids;\r\nreturn 1;\r\ncase SI_RNTI:\r\nhs->common_stats.sib_frames++;\r\nhs->common_stats.sib_bytes += si->single_number_of_bytes;\r\nreturn 1;\r\ncase NO_RNTI:\r\nhs->common_stats.mib_frames++;\r\nreturn 1;\r\ncase RA_RNTI:\r\nhs->common_stats.rar_frames++;\r\nhs->common_stats.rar_entries += si->number_of_rars;\r\nreturn 1;\r\ncase C_RNTI:\r\ncase SPS_RNTI:\r\nbreak;\r\ndefault:\r\nreturn 0;\r\n}\r\nswitch (si->direction) {\r\ncase DIRECTION_UPLINK:\r\nhs->common_stats.max_ul_ues_in_tti =\r\nMAX(hs->common_stats.max_ul_ues_in_tti, si->ueInTTI);\r\nbreak;\r\ncase DIRECTION_DOWNLINK:\r\nhs->common_stats.max_dl_ues_in_tti =\r\nMAX(hs->common_stats.max_dl_ues_in_tti, si->ueInTTI);\r\nbreak;\r\n}\r\nif (!hs->ep_list) {\r\nhs->ep_list = alloc_mac_lte_ep(si, pinfo);\r\nte = hs->ep_list;\r\nupdate_ueid_rnti_counts(si->rnti, si->ueid, hs);\r\n} else {\r\nfor (tmp = hs->ep_list;(tmp != NULL); tmp = tmp->next) {\r\nif ((tmp->stats.rnti == si->rnti) &&\r\n(tmp->stats.ueid == si->ueid)) {\r\nte = tmp;\r\nbreak;\r\n}\r\n}\r\nif (te == NULL) {\r\nif ((te = alloc_mac_lte_ep(si, pinfo))) {\r\nmac_lte_ep_t *p = hs->ep_list;\r\nwhile (p->next) {\r\np = p->next;\r\n}\r\np->next = te;\r\nte->next = NULL;\r\nupdate_ueid_rnti_counts(si->rnti, si->ueid, hs);\r\n}\r\n}\r\n}\r\nif (!te) {\r\nreturn 0;\r\n}\r\nte->stats.rnti = si->rnti;\r\nte->stats.is_predefined_data = si->isPredefinedData;\r\nif (si->direction == DIRECTION_UPLINK) {\r\nif (si->isPHYRetx) {\r\nte->stats.UL_retx_frames++;\r\nreturn 1;\r\n}\r\nif (si->crcStatusValid && (si->crcStatus != crc_success)) {\r\nte->stats.UL_CRC_errors++;\r\nreturn 1;\r\n}\r\nif (te->stats.UL_frames == 0) {\r\nte->stats.UL_time_start = si->mac_lte_time;\r\n}\r\nte->stats.UL_time_stop = si->mac_lte_time;\r\nte->stats.UL_frames++;\r\nte->stats.UL_raw_bytes += si->raw_length;\r\nte->stats.UL_padding_bytes += si->padding_bytes;\r\nif (si->isPredefinedData) {\r\nte->stats.UL_total_bytes += si->single_number_of_bytes;\r\n}\r\nelse {\r\nfor (n=0; n < 11; n++) {\r\nte->stats.UL_sdus_for_lcid[n] += si->sdus_for_lcid[n];\r\nte->stats.UL_bytes_for_lcid[n] += si->bytes_for_lcid[n];\r\nte->stats.UL_total_bytes += si->bytes_for_lcid[n];\r\n}\r\n}\r\n}\r\nelse {\r\nif (si->isPHYRetx) {\r\nte->stats.DL_retx_frames++;\r\nreturn 1;\r\n}\r\nif (si->crcStatusValid && (si->crcStatus != crc_success)) {\r\nswitch (si->crcStatus) {\r\ncase crc_fail:\r\nte->stats.DL_CRC_failures++;\r\nbreak;\r\ncase crc_high_code_rate:\r\nte->stats.DL_CRC_high_code_rate++;\r\nbreak;\r\ncase crc_pdsch_lost:\r\nte->stats.DL_CRC_PDSCH_lost++;\r\nbreak;\r\ncase crc_duplicate_nonzero_rv:\r\nte->stats.DL_CRC_Duplicate_Nonzero_rv++;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn 1;\r\n}\r\nif (te->stats.DL_frames == 0) {\r\nte->stats.DL_time_start = si->mac_lte_time;\r\n}\r\nte->stats.DL_time_stop = si->mac_lte_time;\r\nte->stats.DL_frames++;\r\nte->stats.DL_raw_bytes += si->raw_length;\r\nte->stats.DL_padding_bytes += si->padding_bytes;\r\nif (si->isPredefinedData) {\r\nte->stats.DL_total_bytes += si->single_number_of_bytes;\r\n}\r\nelse {\r\nfor (n=0; n < 11; n++) {\r\nte->stats.DL_sdus_for_lcid[n] += si->sdus_for_lcid[n];\r\nte->stats.DL_bytes_for_lcid[n] += si->bytes_for_lcid[n];\r\nte->stats.DL_total_bytes += si->bytes_for_lcid[n];\r\n}\r\n}\r\n}\r\nreturn 1;\r\n}\r\nstatic void mac_lte_ue_details(mac_lte_ep_t *mac_stat_ep, mac_lte_stat_t *hs)\r\n{\r\nint n;\r\ngchar buff[32];\r\nguint8 show_dct_errors;\r\nfor (n=0; n < PREDEFINED_COLUMN-1; n++) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\n(mac_stat_ep != NULL) ? mac_stat_ep->stats.UL_sdus_for_lcid[n] : 0);\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[n+1][1]), buff);\r\n}\r\nif (mac_stat_ep != NULL) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\nmac_stat_ep->stats.is_predefined_data ? mac_stat_ep->stats.UL_frames : 0);\r\n}\r\nelse {\r\ng_snprintf(buff, sizeof(buff), "%u", 0);\r\n}\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[PREDEFINED_COLUMN][1]), buff);\r\nfor (n=0; n < PREDEFINED_COLUMN-1; n++) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\n(mac_stat_ep != NULL) ? mac_stat_ep->stats.UL_bytes_for_lcid[n] : 0);\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[n+1][2]), buff);\r\n}\r\nif (mac_stat_ep != NULL) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\nmac_stat_ep->stats.is_predefined_data ? mac_stat_ep->stats.UL_total_bytes : 0);\r\n}\r\nelse {\r\ng_snprintf(buff, sizeof(buff), "%u", 0);\r\n}\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[PREDEFINED_COLUMN][2]), buff);\r\nfor (n=0; n < PREDEFINED_COLUMN-1; n++) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\n(mac_stat_ep != NULL) ? mac_stat_ep->stats.DL_sdus_for_lcid[n] : 0);\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[n+1][3]), buff);\r\n}\r\nif (mac_stat_ep != NULL) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\nmac_stat_ep->stats.is_predefined_data ? mac_stat_ep->stats.DL_frames : 0);\r\n}\r\nelse {\r\ng_snprintf(buff, sizeof(buff), "%u", 0);\r\n}\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[PREDEFINED_COLUMN][3]), buff);\r\nfor (n=0; n < PREDEFINED_COLUMN-1; n++) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\n(mac_stat_ep != NULL) ? mac_stat_ep->stats.DL_bytes_for_lcid[n] : 0);\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[n+1][4]), buff);\r\n}\r\nif (mac_stat_ep != NULL) {\r\ng_snprintf(buff, sizeof(buff), "%u",\r\nmac_stat_ep->stats.is_predefined_data ? mac_stat_ep->stats.DL_total_bytes : 0);\r\n}\r\nelse {\r\ng_snprintf(buff, sizeof(buff), "%u", 0);\r\n}\r\ngtk_label_set_text(GTK_LABEL(hs->selected_ue_column_entry[PREDEFINED_COLUMN][4]), buff);\r\nif (mac_stat_ep) {\r\nhs->selected_rnti = mac_stat_ep->stats.rnti;\r\nhs->selected_ueid = mac_stat_ep->stats.ueid;\r\n}\r\ngtk_widget_set_sensitive(hs->ul_filter_bt, mac_stat_ep != NULL);\r\ngtk_widget_set_sensitive(hs->dl_filter_bt, mac_stat_ep != NULL);\r\ngtk_widget_set_sensitive(hs->uldl_filter_bt, mac_stat_ep != NULL);\r\ngtk_widget_set_sensitive(hs->show_mac_rach_cb, mac_stat_ep != NULL);\r\ngtk_widget_set_sensitive(hs->show_mac_srs_cb, mac_stat_ep != NULL);\r\ngtk_widget_set_sensitive(hs->show_dct_errors_cb, mac_stat_ep != NULL);\r\nshow_dct_errors = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb));\r\ngtk_widget_set_sensitive(hs->dct_error_substring_lb, show_dct_errors && (mac_stat_ep != NULL));\r\ngtk_widget_set_sensitive(hs->dct_error_substring_te, show_dct_errors && (mac_stat_ep != NULL));\r\n}\r\nstatic float calculate_bw(nstime_t *start_time, nstime_t *stop_time, guint32 bytes)\r\n{\r\nif (memcmp(start_time, stop_time, sizeof(nstime_t)) != 0) {\r\nfloat elapsed_ms = (((float)stop_time->secs - (float)start_time->secs) * 1000) +\r\n(((float)stop_time->nsecs - (float)start_time->nsecs) / 1000000);\r\nif (elapsed_ms < 2.0) {\r\nreturn 0.0f;\r\n}\r\nreturn ((bytes * 8) / elapsed_ms) / 1000;\r\n}\r\nelse {\r\nreturn 0.0f;\r\n}\r\n}\r\nstatic void mac_lte_stat_draw(void *phs)\r\n{\r\ngchar buff[32];\r\nguint16 number_of_ues = 0;\r\nchar *display_name;\r\ngchar title[256];\r\nmac_lte_stat_t *hs = (mac_lte_stat_t *)phs;\r\nmac_lte_ep_t *list = hs->ep_list, *tmp = 0;\r\nGtkListStore *ues_store;\r\nGtkTreeSelection *sel;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\ng_snprintf(buff, sizeof(buff), "Max UL UEs/TTI: %u", hs->common_stats.max_ul_ues_in_tti);\r\ngtk_label_set_text(GTK_LABEL(hs->ul_max_ues_per_tti), buff);\r\ng_snprintf(buff, sizeof(buff), "Max DL UEs/TTI: %u", hs->common_stats.max_dl_ues_in_tti);\r\ngtk_label_set_text(GTK_LABEL(hs->dl_max_ues_per_tti), buff);\r\ng_snprintf(buff, sizeof(buff), "MIBs: %u", hs->common_stats.mib_frames);\r\ngtk_label_set_text(GTK_LABEL(hs->common_mib_frames), buff);\r\ng_snprintf(buff, sizeof(buff), "SIB Frames: %u", hs->common_stats.sib_frames);\r\ngtk_label_set_text(GTK_LABEL(hs->common_sib_frames), buff);\r\ng_snprintf(buff, sizeof(buff), "SIB Bytes: %u", hs->common_stats.sib_bytes);\r\ngtk_label_set_text(GTK_LABEL(hs->common_sib_bytes), buff);\r\ng_snprintf(buff, sizeof(buff), "PCH Frames: %u", hs->common_stats.pch_frames);\r\ngtk_label_set_text(GTK_LABEL(hs->common_pch_frames), buff);\r\ng_snprintf(buff, sizeof(buff), "PCH Bytes: %u", hs->common_stats.pch_bytes);\r\ngtk_label_set_text(GTK_LABEL(hs->common_pch_bytes), buff);\r\ng_snprintf(buff, sizeof(buff), "PCH Paging Ids: %u", hs->common_stats.pch_paging_ids);\r\ngtk_label_set_text(GTK_LABEL(hs->common_pch_paging_ids), buff);\r\ng_snprintf(buff, sizeof(buff), "RAR Frames: %u", hs->common_stats.rar_frames);\r\ngtk_label_set_text(GTK_LABEL(hs->common_rar_frames), buff);\r\ng_snprintf(buff, sizeof(buff), "RAR Entries: %u", hs->common_stats.rar_entries);\r\ngtk_label_set_text(GTK_LABEL(hs->common_rar_entries), buff);\r\nues_store = GTK_LIST_STORE(gtk_tree_view_get_model(hs->ue_table));\r\nfor (tmp = list; (tmp!=NULL); tmp=tmp->next, number_of_ues++);\r\ng_snprintf(title, sizeof(title), "UL/DL-SCH data (%u entries - %u unique RNTIs, %u unique UEIds)",\r\nnumber_of_ues, hs->number_of_rntis, hs->number_of_ueids);\r\ngtk_frame_set_label(GTK_FRAME(hs->mac_lte_stat_ues_lb), title);\r\ndisplay_name = cf_get_display_name(&cfile);\r\ng_snprintf(title, sizeof(title), "Wireshark: LTE MAC Traffic Statistics: %s (%u UEs, %u frames) (filter=\"%s\")",\r\ndisplay_name,\r\nnumber_of_ues,\r\nhs->common_stats.all_frames,\r\nstrlen(hs->filter) ? hs->filter : "none");\r\ng_free(display_name);\r\ngtk_window_set_title(GTK_WINDOW(hs->mac_lte_stat_dlg_w), title);\r\nfor (tmp = list; tmp; tmp=tmp->next) {\r\nfloat UL_bw = calculate_bw(&tmp->stats.UL_time_start,\r\n&tmp->stats.UL_time_stop,\r\ntmp->stats.UL_total_bytes);\r\nfloat DL_bw = calculate_bw(&tmp->stats.DL_time_start,\r\n&tmp->stats.DL_time_stop,\r\ntmp->stats.DL_total_bytes);\r\nif (tmp->iter_valid != TRUE) {\r\ngtk_list_store_append(ues_store, &tmp->iter);\r\ntmp->iter_valid = TRUE;\r\n}\r\ngtk_list_store_set(ues_store, &tmp->iter,\r\nRNTI_COLUMN, tmp->stats.rnti,\r\nRNTI_TYPE_COLUMN,\r\n(tmp->stats.rnti_type == C_RNTI) ? "C-RNTI" : "SPS-RNTI",\r\nUEID_COLUMN, tmp->stats.ueid,\r\nUL_FRAMES_COLUMN, tmp->stats.UL_frames,\r\nUL_BYTES_COLUMN, tmp->stats.UL_total_bytes,\r\nUL_BW_COLUMN, UL_bw,\r\nUL_PADDING_PERCENT_COLUMN,\r\ntmp->stats.UL_raw_bytes ?\r\n(((float)tmp->stats.UL_padding_bytes / (float)tmp->stats.UL_raw_bytes) * 100.0) :\r\n0.0,\r\nUL_RETX_FRAMES_COLUMN, tmp->stats.UL_retx_frames,\r\nDL_FRAMES_COLUMN, tmp->stats.DL_frames,\r\nDL_BYTES_COLUMN, tmp->stats.DL_total_bytes,\r\nDL_BW_COLUMN, DL_bw,\r\nDL_PADDING_PERCENT_COLUMN,\r\ntmp->stats.DL_raw_bytes ?\r\n(((float)tmp->stats.DL_padding_bytes / (float)tmp->stats.DL_raw_bytes) * 100.0) :\r\n0.0,\r\nDL_CRC_FAILED_COLUMN, tmp->stats.DL_CRC_failures,\r\nDL_CRC_HIGH_CODE_RATE_COLUMN, tmp->stats.DL_CRC_high_code_rate,\r\nDL_CRC_PDSCH_LOST_COLUMN, tmp->stats.DL_CRC_PDSCH_lost,\r\nDL_CRC_DUPLICATE_NONZERO_RV, tmp->stats.DL_CRC_Duplicate_Nonzero_rv,\r\nDL_RETX_FRAMES_COLUMN, tmp->stats.DL_retx_frames,\r\nTABLE_COLUMN, tmp,\r\n-1);\r\n}\r\nif (hs->selected_rnti != 0) {\r\nGtkTreeIter *ue_iter = NULL;\r\nmac_lte_ep_t *ep = hs->ep_list;\r\nwhile (ep != NULL) {\r\nif ((ep->stats.ueid == hs->selected_ueid) &&\r\n(ep->stats.rnti == hs->selected_rnti)) {\r\nue_iter = &ep->iter;\r\nbreak;\r\n}\r\nep = ep->next;\r\n}\r\nif (ue_iter != NULL) {\r\ngtk_tree_selection_select_iter(gtk_tree_view_get_selection(hs->ue_table),\r\nue_iter);\r\n}\r\n}\r\nsel = gtk_tree_view_get_selection(GTK_TREE_VIEW(hs->ue_table));\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\nmac_lte_ep_t *ep;\r\ngtk_tree_model_get(model, &iter, TABLE_COLUMN, &ep, -1);\r\nmac_lte_ue_details(ep, hs);\r\n}\r\n}\r\nstatic void set_filter_expression(guint16 ueid,\r\nguint16 rnti,\r\nDirection_t direction,\r\ngint showRACH,\r\ngint showSRs,\r\ngint showDCTErrors,\r\nconst gchar *DCTErrorSubstring,\r\nmac_lte_stat_t *hs)\r\n{\r\n#define MAX_FILTER_LEN 512\r\nstatic char buffer[MAX_FILTER_LEN];\r\nint offset = 0;\r\nif (showRACH) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset,\r\n"(mac-lte.rar or (mac-lte.preamble-sent and mac-lte.ueid == %u)) or (",\r\nueid);\r\n}\r\nif (showSRs) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset,\r\n"(mac-lte.sr-req and mac-lte.ueid == %u) or (",\r\nueid);\r\n}\r\nif (showDCTErrors) {\r\nif (strlen(DCTErrorSubstring) > 0) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset,\r\n"(dct2000.error-comment and (dct2000.comment contains \"%s\")) or (",\r\nDCTErrorSubstring);\r\n}\r\nelse {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset,\r\n"dct2000.error-comment or (");\r\n}\r\n}\r\nif (strlen(hs->filter)) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset, "%s and ", hs->filter);\r\n}\r\nswitch (direction) {\r\ncase UL_Only:\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset, "(mac-lte.direction == 0) and ");\r\nbreak;\r\ncase DL_Only:\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset, "(mac-lte.direction == 1) and ");\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset,\r\n"mac-lte.rnti == %u and mac-lte.ueid == %u",\r\nrnti, ueid);\r\nif (showRACH) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset, ")");\r\n}\r\nif (showSRs) {\r\noffset += g_snprintf(buffer+offset, MAX_FILTER_LEN-offset, ")");\r\n}\r\nif (showDCTErrors) {\r\ng_snprintf(buffer+offset, MAX_FILTER_LEN-offset, ")");\r\n}\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), buffer);\r\nmain_filter_packets(&cfile, buffer, TRUE);\r\n}\r\nstatic void ul_filter_clicked(GtkWindow *win _U_, mac_lte_stat_t* hs)\r\n{\r\nGtkTreeSelection *sel;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nsel = gtk_tree_view_get_selection(GTK_TREE_VIEW(hs->ue_table));\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\nmac_lte_ep_t *ep;\r\ngtk_tree_model_get(model, &iter, TABLE_COLUMN, &ep, -1);\r\nset_filter_expression(ep->stats.ueid, ep->stats.rnti, UL_Only,\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_rach_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_srs_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb)),\r\ngtk_entry_get_text(GTK_ENTRY(hs->dct_error_substring_te)),\r\nhs);\r\n}\r\n}\r\nstatic void dl_filter_clicked(GtkWindow *win _U_, mac_lte_stat_t *hs)\r\n{\r\nGtkTreeSelection *sel;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nsel = gtk_tree_view_get_selection(GTK_TREE_VIEW(hs->ue_table));\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\nmac_lte_ep_t *ep;\r\ngtk_tree_model_get(model, &iter, TABLE_COLUMN, &ep, -1);\r\nset_filter_expression(ep->stats.ueid, ep->stats.rnti, DL_Only,\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_rach_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_srs_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb)),\r\ngtk_entry_get_text(GTK_ENTRY(hs->dct_error_substring_te)),\r\nhs);\r\n}\r\n}\r\nstatic void uldl_filter_clicked(GtkWindow *win _U_, mac_lte_stat_t *hs)\r\n{\r\nGtkTreeSelection *sel;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nsel = gtk_tree_view_get_selection(GTK_TREE_VIEW(hs->ue_table));\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\nmac_lte_ep_t *ep;\r\ngtk_tree_model_get(model, &iter, TABLE_COLUMN, &ep, -1);\r\nset_filter_expression(ep->stats.ueid, ep->stats.rnti, UL_and_DL,\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_rach_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_mac_srs_cb)),\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb)),\r\ngtk_entry_get_text(GTK_ENTRY(hs->dct_error_substring_te)),\r\nhs);\r\n}\r\n}\r\nstatic void mac_lte_select_cb(GtkTreeSelection *sel, gpointer data)\r\n{\r\nmac_lte_stat_t *hs = (mac_lte_stat_t *)data;\r\nmac_lte_ep_t *ep;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\ngtk_tree_model_get(model, &iter, TABLE_COLUMN, &ep, -1);\r\nmac_lte_ue_details(ep, hs);\r\n}\r\nelse {\r\nmac_lte_ue_details(NULL, hs);\r\n}\r\n}\r\nstatic void mac_lte_dct_errors_cb(GtkTreeSelection *sel _U_, gpointer data)\r\n{\r\nmac_lte_stat_t *hs = (mac_lte_stat_t*)data;\r\nguint8 show_dct_errors = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb));\r\ngtk_widget_set_sensitive(hs->dct_error_substring_lb, show_dct_errors);\r\ngtk_widget_set_sensitive(hs->dct_error_substring_te, show_dct_errors);\r\n}\r\nstatic void win_destroy_cb(GtkWindow *win _U_, gpointer data)\r\n{\r\nmac_lte_stat_t *hs = (mac_lte_stat_t *)data;\r\nremove_tap_listener(hs);\r\nif (hs->mac_lte_stat_dlg_w != NULL) {\r\nwindow_destroy(hs->mac_lte_stat_dlg_w);\r\nhs->mac_lte_stat_dlg_w = NULL;\r\n}\r\nmac_lte_stat_reset(hs);\r\ng_free(hs->filter);\r\ng_free(hs);\r\n}\r\nstatic void gtk_mac_lte_stat_init(const char *opt_arg, void *userdata _U_)\r\n{\r\nmac_lte_stat_t *hs;\r\nconst char *filter = NULL;\r\nGString *error_string;\r\nGtkWidget *ues_scrolled_window;\r\nGtkWidget *bbox;\r\nGtkWidget *top_level_vbox;\r\nGtkWidget *system_row_hbox;\r\nGtkWidget *common_row_hbox;\r\nGtkWidget *ues_vb;\r\nGtkWidget *selected_ue_hb;\r\nGtkWidget *mac_lte_stat_system_lb;\r\nGtkWidget *mac_lte_stat_common_channel_lb;\r\nGtkWidget *mac_lte_stat_selected_ue_lb;\r\nGtkWidget *selected_ue_vbox[NUM_CHANNEL_COLUMNS];\r\nGtkWidget *selected_ue_column_titles[5];\r\nGtkWidget *mac_lte_stat_filters_lb;\r\nGtkWidget *filter_buttons_hb;\r\nGtkWidget *close_bt;\r\nGtkWidget *help_bt;\r\nGtkListStore *store;\r\nGtkTreeView *tree_view;\r\nGtkCellRenderer *renderer;\r\nGtkTreeViewColumn *column;\r\nGtkTreeSelection *sel;\r\ngchar *display_name;\r\ngchar title[256];\r\ngint i, n;\r\nif (strncmp(opt_arg, "mac-lte,stat,", 13) == 0) {\r\nfilter = opt_arg + 13;\r\n}\r\nelse {\r\nfilter = NULL;\r\n}\r\nhs = (mac_lte_stat_t *)g_malloc(sizeof(mac_lte_stat_t));\r\nhs->ep_list = NULL;\r\nif (filter) {\r\nhs->filter = g_strdup(filter);\r\n}\r\nelse {\r\nhs->filter = NULL;\r\n}\r\ndisplay_name = cf_get_display_name(&cfile);\r\ng_snprintf(title, sizeof(title), "Wireshark: LTE MAC Statistics: %s",\r\ndisplay_name);\r\ng_free(display_name);\r\nhs->mac_lte_stat_dlg_w = window_new_with_geom(GTK_WINDOW_TOPLEVEL, title, "LTE MAC Statistics", GTK_WIN_POS_CENTER_ON_PARENT);\r\ngtk_window_set_default_size(GTK_WINDOW(hs->mac_lte_stat_dlg_w), 750, 300);\r\ntop_level_vbox = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_container_add(GTK_CONTAINER(hs->mac_lte_stat_dlg_w), top_level_vbox);\r\ngtk_container_set_border_width(GTK_CONTAINER(top_level_vbox), 6);\r\ngtk_widget_show(top_level_vbox);\r\nmac_lte_stat_system_lb = gtk_frame_new("System Data");\r\nsystem_row_hbox = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_container_add(GTK_CONTAINER(mac_lte_stat_system_lb), system_row_hbox);\r\ngtk_container_set_border_width(GTK_CONTAINER(system_row_hbox), 5);\r\ngtk_box_pack_start(GTK_BOX(top_level_vbox), mac_lte_stat_system_lb, FALSE, FALSE, 0);\r\nhs->ul_max_ues_per_tti = gtk_label_new("Max UL UEs/TTI:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->ul_max_ues_per_tti), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(system_row_hbox), hs->ul_max_ues_per_tti, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->ul_max_ues_per_tti);\r\nhs->dl_max_ues_per_tti = gtk_label_new("Max DL UEs/TTI:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->dl_max_ues_per_tti), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(system_row_hbox), hs->dl_max_ues_per_tti, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->dl_max_ues_per_tti);\r\nmac_lte_stat_common_channel_lb = gtk_frame_new("Common Channel Data");\r\ncommon_row_hbox = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_container_add(GTK_CONTAINER(mac_lte_stat_common_channel_lb), common_row_hbox);\r\ngtk_container_set_border_width(GTK_CONTAINER(common_row_hbox), 5);\r\ngtk_box_pack_start(GTK_BOX(top_level_vbox), mac_lte_stat_common_channel_lb, FALSE, FALSE, 0);\r\nhs->common_mib_frames = gtk_label_new("MIBs:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_mib_frames), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_mib_frames, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_mib_frames);\r\nhs->common_sib_frames = gtk_label_new("SIB Frames:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_sib_frames), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_sib_frames, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_sib_frames);\r\nhs->common_sib_bytes = gtk_label_new("SIB Bytes:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_sib_bytes), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_sib_bytes, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_sib_bytes);\r\nhs->common_pch_frames = gtk_label_new("PCH Frames:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_pch_frames), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_pch_frames, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_pch_frames);\r\nhs->common_pch_bytes = gtk_label_new("PCH Bytes:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_pch_bytes), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_pch_bytes, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_pch_bytes);\r\nhs->common_pch_paging_ids = gtk_label_new("PCH Paging IDs:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_pch_paging_ids), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_pch_paging_ids, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_pch_paging_ids);\r\nhs->common_rar_frames = gtk_label_new("RAR Frames:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_rar_frames), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_rar_frames, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_rar_frames);\r\nhs->common_rar_entries = gtk_label_new("RAR Entries:");\r\ngtk_misc_set_alignment(GTK_MISC(hs->common_rar_entries), 0.0f, .5f);\r\ngtk_box_pack_start(GTK_BOX(common_row_hbox), hs->common_rar_entries, TRUE, TRUE, 0);\r\ngtk_widget_show(hs->common_rar_entries);\r\nhs->mac_lte_stat_ues_lb = gtk_frame_new("UL/DL-SCH Data (0 UEs)");\r\nues_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_container_add(GTK_CONTAINER(hs->mac_lte_stat_ues_lb), ues_vb);\r\ngtk_container_set_border_width(GTK_CONTAINER(ues_vb), 5);\r\nues_scrolled_window = scrolled_window_new(NULL, NULL);\r\ngtk_box_pack_start(GTK_BOX(ues_vb), ues_scrolled_window, TRUE, TRUE, 0);\r\ngtk_scrolled_window_set_shadow_type(GTK_SCROLLED_WINDOW(ues_scrolled_window),\r\nGTK_SHADOW_IN);\r\nstore = gtk_list_store_new(NUM_UE_COLUMNS, G_TYPE_INT, G_TYPE_STRING, G_TYPE_INT,\r\nG_TYPE_INT, G_TYPE_INT, G_TYPE_FLOAT, G_TYPE_FLOAT, G_TYPE_INT,\r\nG_TYPE_INT, G_TYPE_INT, G_TYPE_FLOAT, G_TYPE_FLOAT, G_TYPE_INT,\r\nG_TYPE_INT, G_TYPE_INT, G_TYPE_INT, G_TYPE_INT,\r\nG_TYPE_POINTER);\r\nhs->ue_table = GTK_TREE_VIEW(tree_view_new(GTK_TREE_MODEL(store)));\r\ngtk_container_add(GTK_CONTAINER (ues_scrolled_window), GTK_WIDGET(hs->ue_table));\r\ng_object_unref(G_OBJECT(store));\r\ntree_view = hs->ue_table;\r\ngtk_tree_view_set_headers_visible(tree_view, TRUE);\r\ngtk_tree_view_set_headers_clickable(tree_view, TRUE);\r\nfor (i = 0; i < TABLE_COLUMN; i++) {\r\nif ((i == UL_PADDING_PERCENT_COLUMN) ||\r\n(i == DL_PADDING_PERCENT_COLUMN)) {\r\nrenderer = gtk_cell_renderer_progress_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes(ue_titles[i], renderer,\r\n"text", i,\r\n"value", i,\r\nNULL);\r\n}\r\nelse {\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes(ue_titles[i], renderer,\r\n"text", i, NULL);\r\n}\r\ngtk_tree_view_column_set_sort_column_id(column, i);\r\nif (i == 0) {\r\ngtk_tree_view_column_set_expand(column, TRUE);\r\n} else {\r\ng_object_set(G_OBJECT(renderer), "xalign", 1.0, NULL);\r\n}\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_AUTOSIZE);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_append_column(tree_view, column);\r\n}\r\nsel = gtk_tree_view_get_selection(GTK_TREE_VIEW(hs->ue_table));\r\ngtk_tree_selection_set_mode(sel, GTK_SELECTION_SINGLE);\r\ng_signal_connect(sel, "changed", G_CALLBACK(mac_lte_select_cb), hs);\r\ngtk_box_pack_start(GTK_BOX(top_level_vbox), hs->mac_lte_stat_ues_lb, TRUE, TRUE, 0);\r\nmac_lte_stat_selected_ue_lb = gtk_frame_new("Selected UE details");\r\nselected_ue_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 6, FALSE);\r\ngtk_container_add(GTK_CONTAINER(mac_lte_stat_selected_ue_lb), selected_ue_hb);\r\ngtk_container_set_border_width(GTK_CONTAINER(selected_ue_hb), 5);\r\nselected_ue_vbox[0] = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_hb), selected_ue_vbox[0], TRUE, TRUE, 0);\r\nselected_ue_column_titles[0] = gtk_label_new("");\r\ngtk_misc_set_alignment(GTK_MISC(selected_ue_column_titles[0]), 0.0f, 0.0f);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_vbox[0]), selected_ue_column_titles[0], FALSE, FALSE, 0);\r\nfor (n=1; n < 5; n++) {\r\nselected_ue_column_titles[n] = gtk_label_new(selected_ue_row_names[n-1]);\r\ngtk_misc_set_alignment(GTK_MISC(selected_ue_column_titles[n]), 0.0f, 0.0f);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_vbox[0]), selected_ue_column_titles[n], FALSE, FALSE, 0);\r\ngtk_widget_show(selected_ue_column_titles[n]);\r\n}\r\nfor (i=CCCH_COLUMN; i < NUM_CHANNEL_COLUMNS; i++) {\r\nselected_ue_vbox[i] = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_hb), selected_ue_vbox[i], TRUE, TRUE, 0);\r\nhs->selected_ue_column_entry[i][0] = gtk_label_new(channel_titles[i-1]);\r\ngtk_misc_set_alignment(GTK_MISC(hs->selected_ue_column_entry[i][0]), 0.5f, 0.0f);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_vbox[i]), hs->selected_ue_column_entry[i][0], FALSE, FALSE, 0);\r\nfor (n=1; n < 5; n++) {\r\nhs->selected_ue_column_entry[i][n] = gtk_label_new("0");\r\ngtk_misc_set_alignment(GTK_MISC(hs->selected_ue_column_entry[i][n]), 1.0f, 0.0f);\r\ngtk_box_pack_start(GTK_BOX(selected_ue_vbox[i]), hs->selected_ue_column_entry[i][n], FALSE, FALSE, 0);\r\ngtk_widget_show(hs->selected_ue_column_entry[i][n]);\r\n}\r\n}\r\ngtk_box_pack_start(GTK_BOX(top_level_vbox), mac_lte_stat_selected_ue_lb, FALSE, FALSE, 0);\r\nmac_lte_stat_filters_lb = gtk_frame_new("Filter on UE");\r\nfilter_buttons_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 6, FALSE);\r\ngtk_container_add(GTK_CONTAINER(mac_lte_stat_filters_lb), filter_buttons_hb);\r\ngtk_container_set_border_width(GTK_CONTAINER(filter_buttons_hb), 2);\r\ngtk_box_pack_start(GTK_BOX(top_level_vbox), mac_lte_stat_filters_lb, FALSE, FALSE, 0);\r\nhs->ul_filter_bt = gtk_button_new_with_label("Set UL display filter on selected this UE");\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->ul_filter_bt, FALSE, FALSE, 0);\r\ng_signal_connect(hs->ul_filter_bt, "clicked", G_CALLBACK(ul_filter_clicked), hs);\r\ngtk_widget_set_sensitive(hs->ul_filter_bt, FALSE);\r\ngtk_widget_show(hs->ul_filter_bt);\r\ngtk_widget_set_tooltip_text(hs->ul_filter_bt,\r\n"Generate and set a filter showing only UL frames with selected RNTI and UEId");\r\nhs->dl_filter_bt = gtk_button_new_with_label("Set DL display filter on selected this UE");\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->dl_filter_bt, FALSE, FALSE, 0);\r\ng_signal_connect(hs->dl_filter_bt, "clicked", G_CALLBACK(dl_filter_clicked), hs);\r\ngtk_widget_set_sensitive(hs->dl_filter_bt, FALSE);\r\ngtk_widget_show(hs->dl_filter_bt);\r\ngtk_widget_set_tooltip_text(hs->dl_filter_bt,\r\n"Generate and set a filter showing only DL frames with selected RNTI and UEId");\r\nhs->uldl_filter_bt = gtk_button_new_with_label("Set UL / DL display filter on selected this UE");\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->uldl_filter_bt, FALSE, FALSE, 0);\r\ng_signal_connect(hs->uldl_filter_bt, "clicked", G_CALLBACK(uldl_filter_clicked), hs);\r\ngtk_widget_set_sensitive(hs->uldl_filter_bt, FALSE);\r\ngtk_widget_show(hs->uldl_filter_bt);\r\ngtk_widget_set_tooltip_text(hs->uldl_filter_bt,\r\n"Generate and set a filter showing only frames with selected RNTI and UEId");\r\nhs->show_mac_rach_cb = gtk_check_button_new_with_mnemonic("Show MAC RACH");\r\ngtk_widget_set_sensitive(hs->show_mac_rach_cb, FALSE);\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->show_mac_rach_cb, TRUE, TRUE, 0);\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(hs->show_mac_rach_cb), FALSE);\r\ngtk_widget_set_tooltip_text(hs->show_mac_rach_cb, "When checked, generated filters will show "\r\n"MAC RACH attempts for the UE");\r\nhs->show_mac_srs_cb = gtk_check_button_new_with_mnemonic("Show MAC SRs");\r\ngtk_widget_set_sensitive(hs->show_mac_srs_cb, FALSE);\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->show_mac_srs_cb, TRUE, TRUE, 0);\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(hs->show_mac_srs_cb), FALSE);\r\ngtk_widget_set_tooltip_text(hs->show_mac_srs_cb, "When checked, generated filters will show "\r\n"MAC SRs for the UE");\r\nhs->show_dct_errors_cb = gtk_check_button_new_with_mnemonic("Show DCT2000 error strings");\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->show_dct_errors_cb, TRUE, TRUE, 0);\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(hs->show_dct_errors_cb), FALSE);\r\ng_signal_connect(hs->show_dct_errors_cb, "toggled", G_CALLBACK(mac_lte_dct_errors_cb), hs);\r\ngtk_widget_set_tooltip_text(hs->show_dct_errors_cb, "When checked, generated filters will "\r\n"include DCT2000 error strings");\r\ngtk_widget_set_sensitive(hs->show_dct_errors_cb, FALSE);\r\nhs->dct_error_substring_lb = gtk_label_new("...containing");\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->dct_error_substring_lb, FALSE, FALSE, 0);\r\ngtk_widget_show(hs->dct_error_substring_lb);\r\ngtk_widget_set_sensitive(hs->dct_error_substring_lb, FALSE);\r\nhs->dct_error_substring_te = gtk_entry_new();\r\ngtk_box_pack_start(GTK_BOX(filter_buttons_hb), hs->dct_error_substring_te, FALSE, FALSE, 0);\r\ngtk_widget_show(hs->dct_error_substring_te);\r\ngtk_widget_set_sensitive(hs->dct_error_substring_te, FALSE);\r\ngtk_widget_set_tooltip_text(hs->dct_error_substring_te,\r\n"If given, only match error strings containing this substring");\r\nerror_string = register_tap_listener("mac-lte", hs,\r\nfilter, 0,\r\nmac_lte_stat_reset,\r\nmac_lte_stat_packet,\r\nmac_lte_stat_draw);\r\nif (error_string) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "%s", error_string->str);\r\ng_string_free(error_string, TRUE);\r\ng_free(hs);\r\nreturn;\r\n}\r\nbbox = dlg_button_row_new (GTK_STOCK_CLOSE, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_end (GTK_BOX(top_level_vbox), bbox, FALSE, FALSE, 0);\r\nclose_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_CLOSE);\r\nwindow_set_cancel_button(hs->mac_lte_stat_dlg_w, close_bt, window_cancel_button_cb);\r\nhelp_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer)HELP_STATS_LTE_MAC_TRAFFIC_DIALOG);\r\ng_signal_connect(hs->mac_lte_stat_dlg_w, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ng_signal_connect(hs->mac_lte_stat_dlg_w, "destroy", G_CALLBACK(win_destroy_cb), hs);\r\ngtk_widget_show_all(hs->mac_lte_stat_dlg_w);\r\nwindow_present(hs->mac_lte_stat_dlg_w);\r\ncf_retap_packets(&cfile);\r\ngdk_window_raise(gtk_widget_get_window(hs->mac_lte_stat_dlg_w));\r\n}\r\nvoid register_tap_listener_mac_lte_stat(void)\r\n{\r\nregister_param_stat(&mac_lte_stat_dlg, "_MAC", REGISTER_STAT_GROUP_TELEPHONY_LTE);\r\n}
