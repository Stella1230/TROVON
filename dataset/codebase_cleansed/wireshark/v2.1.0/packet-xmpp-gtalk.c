void\r\nxmpp_gtalk_session(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *session_item;\r\nproto_tree *session_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, FALSE, NULL, NULL},\r\n{"type", &hf_xmpp_gtalk_session_type, TRUE, TRUE, NULL, NULL},\r\n{"initiator", NULL, FALSE, TRUE, NULL, NULL},\r\n{"id", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME,"description", xmpp_gtalk_session_desc, ONE},\r\n{NAME, "candidate", xmpp_gtalk_session_cand, MANY},\r\n{NAME, "reason", xmpp_gtalk_session_reason, ONE},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "http://www.google.com/transport/p2p"), xmpp_gtalk_transport_p2p, ONE},\r\n{NAME, "conference-info", xmpp_conferece_info_advert, ONE}\r\n};\r\nxmpp_attr_t *attr_type = xmpp_get_attr(element, "type");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "GTALK-SESSION(%s) ", attr_type?attr_type->value:"");\r\nsession_item = proto_tree_add_item(tree, hf_xmpp_gtalk_session, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nsession_tree = proto_item_add_subtree(session_item, ett_xmpp_gtalk_session);\r\nxmpp_display_attrs(session_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(session_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_session_desc(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *desc_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL},\r\n{"xml:lang", NULL, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "payload-type", xmpp_gtalk_session_desc_payload, MANY}\r\n};\r\ndesc_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_session_desc, NULL, "DESCRIPTION");\r\nxmpp_display_attrs(desc_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(desc_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_session_desc_payload(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *payload_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL},\r\n{"id", NULL, FALSE, TRUE, NULL, NULL},\r\n{"name", NULL, FALSE, TRUE, NULL, NULL},\r\n{"channels", NULL, FALSE, FALSE, NULL, NULL},\r\n{"clockrate", NULL, FALSE, FALSE, NULL, NULL},\r\n{"bitrate", NULL, FALSE, FALSE, NULL, NULL},\r\n{"width", NULL, FALSE, FALSE, NULL, NULL},\r\n{"height", NULL, FALSE, FALSE, NULL, NULL},\r\n{"framerate", NULL, FALSE, FALSE, NULL, NULL},\r\n};\r\npayload_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_session_desc_payload, NULL, "PAYLOAD-TYPE");\r\nxmpp_display_attrs(payload_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(payload_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_gtalk_session_cand(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *cand_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"name", NULL, TRUE, TRUE, NULL, NULL},\r\n{"address", NULL, TRUE, FALSE, NULL, NULL},\r\n{"port", NULL, TRUE, FALSE, NULL, NULL},\r\n{"preference", NULL, TRUE, FALSE, NULL, NULL},\r\n{"type", NULL, TRUE, TRUE, NULL, NULL},\r\n{"protocol", NULL, TRUE, TRUE, NULL, NULL},\r\n{"network", NULL, TRUE, FALSE, NULL, NULL},\r\n{"username", NULL, TRUE, FALSE, NULL, NULL},\r\n{"password", NULL, TRUE, FALSE, NULL, NULL},\r\n{"generation", NULL, TRUE, FALSE, NULL, NULL},\r\n{"foundation", NULL, FALSE, FALSE, NULL, NULL},\r\n{"component", NULL, FALSE, FALSE, NULL, NULL}\r\n};\r\ncand_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_session_cand, NULL, "CANDIDATE");\r\nxmpp_display_attrs(cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(cand_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_gtalk_session_reason(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *reason_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"condition", NULL, TRUE, TRUE, NULL, NULL},\r\n{"text", NULL, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_element_t *condition;\r\nxmpp_element_t *text;\r\nstatic const gchar *reason_names[] = { "success", "busy", "cancel"};\r\nreason_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_session_reason, NULL, "REASON");\r\nif((condition = xmpp_steal_element_by_names(element, reason_names, array_length(reason_names)))!=NULL)\r\n{\r\nxmpp_attr_t *fake_cond = xmpp_ep_init_attr_t(condition->name, condition->offset, condition->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"condition", fake_cond);\r\n}\r\nif((text = xmpp_steal_element_by_name(element, "text"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_text = xmpp_ep_init_attr_t(text->data?text->data->value:"", text->offset, text->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"text", fake_text);\r\n}\r\nxmpp_display_attrs(reason_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(reason_tree, tvb, pinfo, element);\r\n}\r\nvoid\r\nxmpp_gtalk_jingleinfo_query(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *query_item;\r\nproto_tree *query_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "stun", xmpp_gtalk_jingleinfo_stun, ONE},\r\n{NAME, "relay", xmpp_gtalk_jingleinfo_relay, ONE}\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "QUERY(google:jingleinfo) ");\r\nquery_item = proto_tree_add_item(tree, hf_xmpp_query, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nquery_tree = proto_item_add_subtree(query_item, ett_xmpp_query);\r\nxmpp_display_attrs(query_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(query_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_jingleinfo_stun(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *stun_tree;\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "server", xmpp_gtalk_jingleinfo_server, MANY},\r\n};\r\nstun_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_jingleinfo_stun, NULL, "STUN");\r\nxmpp_display_attrs(stun_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(stun_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_jingleinfo_server(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *serv_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"host", NULL, TRUE, TRUE, NULL, NULL},\r\n{"udp", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nserv_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_jingleinfo_server, NULL, "SERVER");\r\nxmpp_display_attrs(serv_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(serv_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_gtalk_jingleinfo_relay(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *relay_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"token", NULL, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "server", xmpp_gtalk_jingleinfo_relay_serv, ONE}\r\n};\r\nxmpp_element_t *token;\r\nrelay_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_jingleinfo_relay, NULL, "RELAY");\r\nif((token = xmpp_steal_element_by_name(element, "token"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_token = xmpp_ep_init_attr_t(token->data?token->data->value:"", token->offset, token->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"token", fake_token);\r\n}\r\nxmpp_display_attrs(relay_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(relay_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_jingleinfo_relay_serv(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *serv_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"host", NULL, TRUE, TRUE, NULL, NULL},\r\n{"udp", NULL, FALSE, TRUE, NULL, NULL},\r\n{"tcp", NULL, FALSE, TRUE, NULL, NULL},\r\n{"tcpssl", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nserv_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_jingleinfo_relay_serv, NULL, "SERVER");\r\nxmpp_display_attrs(serv_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(serv_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_gtalk_usersetting(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *sett_item;\r\nproto_tree *sett_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL}\r\n};\r\nguint i;\r\nsett_item = proto_tree_add_item(tree, hf_xmpp_gtalk_setting, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nsett_tree = proto_item_add_subtree(sett_item, ett_xmpp_gtalk_setting);\r\nxmpp_display_attrs(sett_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nfor(i = 0; i < g_list_length(element->elements); i++)\r\n{\r\nGList *elem_l = g_list_nth(element->elements,i);\r\nxmpp_element_t *elem = (xmpp_element_t *)(elem_l?elem_l->data:NULL);\r\nif(elem)\r\n{\r\nxmpp_attr_t *val = xmpp_get_attr(elem,"value");\r\nproto_tree_add_string_format(sett_tree, hf_xmpp_gtalk_setting_element, tvb, elem->offset, elem->length, val?val->value:"",\r\n"%s [%s]",elem->name,val?val->value:"");\r\n}\r\n}\r\n}\r\nvoid\r\nxmpp_gtalk_nosave_query(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element) {\r\nproto_item *query_item;\r\nproto_tree *query_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "item", xmpp_gtalk_nosave_item, MANY},\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "QUERY(google:nosave) ");\r\nquery_item = proto_tree_add_item(tree, hf_xmpp_query, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nquery_tree = proto_item_add_subtree(query_item, ett_xmpp_query);\r\nxmpp_display_attrs(query_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(query_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_nosave_item(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *item_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, FALSE, NULL,NULL},\r\n{"jid", NULL, TRUE, TRUE, NULL, NULL},\r\n{"source", NULL, FALSE, TRUE, NULL, NULL},\r\n{"value", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nitem_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_query_item, NULL, "ITEM");\r\nxmpp_display_attrs(item_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(item_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_gtalk_nosave_x(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *x_item;\r\nproto_tree *x_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL},\r\n{"value", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nx_item = proto_tree_add_item(tree, hf_xmpp_gtalk_nosave_x, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nx_tree = proto_item_add_subtree(x_item, ett_xmpp_gtalk_nosave_x);\r\nxmpp_display_attrs(x_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(x_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_gtalk_mail_query(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *query_item;\r\nproto_tree *query_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL},\r\n{"newer-than-time", NULL, FALSE, TRUE, NULL, NULL},\r\n{"newer-than-tid", NULL, FALSE, TRUE, NULL, NULL},\r\n{"q", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "QUERY(google:mail:notify) ");\r\nquery_item = proto_tree_add_item(tree, hf_xmpp_query, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nquery_tree = proto_item_add_subtree(query_item, ett_xmpp_query);\r\nxmpp_display_attrs(query_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(query_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_gtalk_mail_mailbox(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *mail_item;\r\nproto_tree *mail_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL},\r\n{"result-time", NULL, FALSE, TRUE, NULL, NULL},\r\n{"total-matched", NULL, FALSE, TRUE, NULL, NULL},\r\n{"total-estimate", NULL, FALSE, TRUE, NULL, NULL},\r\n{"url", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME,"mail-thread-info", xmpp_gtalk_mail_mail_info, MANY}\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "MAILBOX ");\r\nmail_item = proto_tree_add_item(tree, hf_xmpp_gtalk_mail_mailbox, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nmail_tree = proto_item_add_subtree(mail_item, ett_xmpp_gtalk_mail_mailbox);\r\nxmpp_display_attrs(mail_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(mail_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_mail_mail_info(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *mail_info_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"tid", NULL, FALSE, FALSE, NULL, NULL},\r\n{"participation", NULL, FALSE, FALSE, NULL, NULL},\r\n{"messages", NULL, FALSE, TRUE, NULL, NULL},\r\n{"date", NULL, FALSE, TRUE, NULL, NULL},\r\n{"url", NULL, FALSE, FALSE, NULL, NULL},\r\n{"labels", NULL, FALSE, FALSE, NULL, NULL},\r\n{"subject", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "senders", xmpp_gtalk_mail_senders, ONE},\r\n{NAME, "snippet", xmpp_gtalk_mail_snippet, ONE}\r\n};\r\nxmpp_element_t *labels, *subject;\r\nmail_info_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_mail_mail_info, NULL, "MAIL-THREAD-INFO");\r\nif((labels = xmpp_steal_element_by_name(element,"labels"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_labels = xmpp_ep_init_attr_t(labels->data?labels->data->value:"",labels->offset, labels->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"labels", fake_labels);\r\n}\r\nif((subject = xmpp_steal_element_by_name(element,"subject"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_subject = xmpp_ep_init_attr_t(subject->data?subject->data->value:"",subject->offset, subject->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"subject", fake_subject);\r\n}\r\nxmpp_display_attrs(mail_info_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(mail_info_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_mail_senders(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *senders_tree;\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "sender", xmpp_gtalk_mail_sender, MANY}\r\n};\r\nsenders_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_mail_senders, NULL, "SENDERS");\r\nxmpp_display_attrs(senders_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(senders_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_mail_sender(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *sender_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"name", NULL, FALSE, TRUE, NULL, NULL},\r\n{"address", NULL, FALSE, TRUE, NULL, NULL},\r\n{"originator", NULL, FALSE, TRUE, NULL, NULL},\r\n{"unread", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nsender_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_mail_sender, NULL, "SENDER");\r\nxmpp_display_attrs(sender_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(sender_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_gtalk_mail_snippet(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree_add_string(tree, hf_xmpp_gtalk_mail_snippet, tvb, element->offset, element->length, element->data?element->data->value:"");\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nvoid\r\nxmpp_gtalk_mail_new_mail(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "NEW-MAIL ");\r\nproto_tree_add_item(tree, hf_xmpp_gtalk_mail_new_mail, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nvoid\r\nxmpp_gtalk_status_query(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *query_item;\r\nproto_tree *query_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL},\r\n{"version", NULL, FALSE, TRUE, NULL, NULL},\r\n{"status-max", NULL, FALSE, FALSE, NULL, NULL},\r\n{"status-list-max", NULL, FALSE, FALSE, NULL, NULL},\r\n{"status-list-contents-max", NULL, FALSE, FALSE, NULL, NULL},\r\n{"status-min-ver", NULL, FALSE, TRUE, NULL, NULL},\r\n{"show", NULL, FALSE, TRUE, NULL, NULL},\r\n{"status", NULL, FALSE, TRUE, NULL, NULL},\r\n{"invisible", NULL, FALSE, TRUE, NULL, NULL},\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "status-list", xmpp_gtalk_status_status_list, MANY}\r\n};\r\nxmpp_element_t *status, *show, *invisible;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "QUERY(google:shared-status) ");\r\nquery_item = proto_tree_add_item(tree, hf_xmpp_query, tvb, element->offset, element->length,\r\nENC_BIG_ENDIAN);\r\nquery_tree = proto_item_add_subtree(query_item, ett_xmpp_query);\r\nif((status = xmpp_steal_element_by_name(element,"status"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_status = xmpp_ep_init_attr_t(status->data?status->data->value:"",status->offset, status->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"status", fake_status);\r\n}\r\nif((show = xmpp_steal_element_by_name(element,"show"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_show = xmpp_ep_init_attr_t(show->data?show->data->value:"",show->offset, show->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"show", fake_show);\r\n}\r\nif((invisible = xmpp_steal_element_by_name(element,"invisible"))!=NULL)\r\n{\r\nxmpp_attr_t *value = xmpp_get_attr(invisible, "value");\r\nxmpp_attr_t *fake_invisible = xmpp_ep_init_attr_t(value?value->value:"",invisible->offset, invisible->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"invisible", fake_invisible);\r\n}\r\nxmpp_display_attrs(query_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(query_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_status_status_list(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *list_tree;\r\nxmpp_attr_info attrs_info [] = {\r\n{"show", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_element_t *status;\r\nlist_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_status_status_list, NULL, "STATUS LIST");\r\nwhile((status = xmpp_steal_element_by_name(element, "status"))!=NULL)\r\n{\r\nproto_tree_add_string(list_tree, hf_xmpp_gtalk_status_status_list, tvb, status->offset, status->length, status->data?status->data->value:"");\r\n}\r\nxmpp_display_attrs(list_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(list_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_gtalk_transport_p2p(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *trans_item;\r\nproto_tree *trans_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "candidate", xmpp_gtalk_transport_p2p_cand, MANY}\r\n};\r\ntrans_item = proto_tree_add_item(tree, hf_xmpp_gtalk_transport_p2p, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ntrans_tree = proto_item_add_subtree(trans_item, ett_xmpp_gtalk_transport_p2p);\r\nxmpp_display_attrs(trans_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(trans_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_gtalk_transport_p2p_cand(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element) {\r\nproto_tree *cand_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"name", NULL, FALSE, TRUE, NULL, NULL},\r\n{"generation", NULL, FALSE, FALSE, NULL, NULL},\r\n{"network", NULL, FALSE, FALSE, NULL, NULL},\r\n{"component", NULL, FALSE, FALSE, NULL, NULL},\r\n{"type", NULL, FALSE, FALSE, NULL, NULL},\r\n{"protocol", NULL, FALSE, TRUE, NULL, NULL},\r\n{"preference", NULL, FALSE, FALSE, NULL, NULL},\r\n{"password", NULL, FALSE, FALSE, NULL, NULL},\r\n{"username", NULL, FALSE, FALSE, NULL, NULL},\r\n{"port", NULL, FALSE, TRUE, NULL, NULL},\r\n{"address", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\ncand_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_gtalk_transport_p2p_cand, NULL, "CANDIDATE");\r\nxmpp_display_attrs(cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(cand_tree, element, pinfo, tvb, NULL, 0);\r\n}
