static void\r\non_key_list_select_row(GtkTreeSelection *selection, gpointer data)\r\n{\r\nGtkWidget *add_new_key_bt, *edit_key_bt, *remove_key_bt;\r\nGtkWidget *move_key_up_bt, *move_key_down_bt;\r\nGtkTreeIter iter;\r\nGtkTreeModel *model;\r\nGtkTreePath *path, *path_up, *path_down;\r\nadd_new_key_bt = (GtkWidget *)g_object_get_data(G_OBJECT(data), AIRPCAP_KEY_MGMT_NEW_KEY);\r\nedit_key_bt = (GtkWidget *)g_object_get_data(G_OBJECT(data), AIRPCAP_KEY_MGMT_EDIT_KEY);\r\nremove_key_bt = (GtkWidget *)g_object_get_data(G_OBJECT(data), AIRPCAP_KEY_MGMT_DELETE_KEY);\r\nmove_key_up_bt = (GtkWidget *)g_object_get_data(G_OBJECT(data), AIRPCAP_KEY_MGMT_UP_KEY);\r\nmove_key_down_bt = (GtkWidget *)g_object_get_data(G_OBJECT(data), AIRPCAP_KEY_MGMT_DOWN_KEY);\r\nif (gtk_tree_selection_get_selected(selection, &model, &iter)) {\r\npath = gtk_tree_model_get_path(model, &iter);\r\npath_up = gtk_tree_path_copy(path);\r\npath_down = gtk_tree_path_copy(path);\r\ngtk_tree_path_next(path_down);\r\nif (gtk_tree_model_iter_n_children(model, NULL) >= MAX_ENCRYPTION_KEYS) {\r\ngtk_widget_set_sensitive(add_new_key_bt, FALSE);\r\n} else {\r\ngtk_widget_set_sensitive(add_new_key_bt, TRUE);\r\n}\r\ngtk_widget_set_sensitive(edit_key_bt, TRUE);\r\ngtk_widget_set_sensitive(remove_key_bt, TRUE);\r\nif (gtk_tree_path_prev(path_up)) {\r\ngtk_widget_set_sensitive(move_key_up_bt, TRUE);\r\n} else {\r\ngtk_widget_set_sensitive(move_key_up_bt, FALSE);\r\n}\r\nif (gtk_tree_model_get_iter(model, &iter, path_down)) {\r\ngtk_widget_set_sensitive(move_key_down_bt, TRUE);\r\n} else {\r\ngtk_widget_set_sensitive(move_key_down_bt, FALSE);\r\n}\r\ngtk_tree_path_free(path);\r\ngtk_tree_path_free(path_up);\r\ngtk_tree_path_free(path_down);\r\n} else {\r\ngtk_widget_set_sensitive(add_new_key_bt, FALSE);\r\ngtk_widget_set_sensitive(edit_key_bt, FALSE);\r\ngtk_widget_set_sensitive(remove_key_bt, FALSE);\r\ngtk_widget_set_sensitive(move_key_up_bt, FALSE);\r\ngtk_widget_set_sensitive(move_key_down_bt, FALSE);\r\n}\r\n}\r\nstatic void\r\non_key_list_reorder(GtkTreeModel *model _U_, GtkTreePath *path _U_, GtkTreeIter *iter _U_, gpointer no _U_, gpointer data) {\r\nGtkTreeSelection *selection;\r\nselection = (GtkTreeSelection *)g_object_get_data(G_OBJECT(data), AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY);\r\non_key_list_select_row(selection, data);\r\n}\r\nstatic void\r\non_fcs_ck_toggled(GtkWidget *w _U_, gpointer user_data _U_)\r\n{\r\nif (airpcap_if_selected != NULL)\r\n{\r\nif (airpcap_if_selected->IsFcsPresent)\r\n{\r\nairpcap_if_selected->IsFcsPresent = FALSE;\r\nairpcap_if_selected->saved = FALSE;\r\n}\r\nelse\r\n{\r\nairpcap_if_selected->IsFcsPresent = TRUE;\r\nairpcap_if_selected->saved = FALSE;\r\n}\r\n}\r\n}\r\nstatic void\r\non_edit_type_cb_changed(GtkWidget *w, gpointer data)\r\n{\r\nGtkWidget *edit_key_w;\r\nGtkWidget *edit_ssid_te;\r\nGtkWidget *type_cb;\r\nGtkWidget *key_lb;\r\nGtkWidget *ssid_lb;\r\ngchar* type_text = NULL;\r\nedit_key_w = GTK_WIDGET(data);\r\ntype_cb = w;\r\nedit_ssid_te = (GtkWidget *)g_object_get_data(G_OBJECT(edit_key_w),AIRPCAP_ADVANCED_EDIT_KEY_SSID_KEY);\r\nkey_lb = (GtkWidget *)g_object_get_data(G_OBJECT(edit_key_w),AIRPCAP_ADVANCED_EDIT_KEY_KEY_LABEL_KEY);\r\nssid_lb = (GtkWidget *)g_object_get_data(G_OBJECT(edit_key_w),AIRPCAP_ADVANCED_EDIT_KEY_SSID_LABEL_KEY);\r\ntype_text = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(type_cb));\r\nif (g_ascii_strcasecmp(type_text, ""))\r\n{\r\nif (g_ascii_strcasecmp(type_text,AIRPCAP_WEP_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(edit_ssid_te,FALSE);\r\ngtk_entry_set_text(GTK_ENTRY(edit_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Key");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"");\r\n}\r\nelse if (g_ascii_strcasecmp(type_text,AIRPCAP_WPA_BIN_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(edit_ssid_te,FALSE);\r\ngtk_entry_set_text(GTK_ENTRY(edit_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Key");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"");\r\n}\r\nelse if (g_ascii_strcasecmp(type_text,AIRPCAP_WPA_PWD_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(edit_ssid_te,TRUE);\r\ngtk_entry_set_text(GTK_ENTRY(edit_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Passphrase");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"SSID");\r\n}\r\n}\r\ngtk_widget_show(edit_ssid_te);\r\ng_free(type_text);\r\n}\r\nstatic void\r\non_add_type_cb_changed(GtkWidget *w, gpointer data)\r\n{\r\nGtkWidget *add_key_w;\r\nGtkWidget *add_ssid_te;\r\nGtkWidget *type_cb;\r\nGtkWidget *key_lb;\r\nGtkWidget *ssid_lb;\r\ngchar* type_text = NULL;\r\nadd_key_w = GTK_WIDGET(data);\r\ntype_cb = w;\r\nadd_ssid_te = (GtkWidget *)g_object_get_data(G_OBJECT(add_key_w),AIRPCAP_ADVANCED_ADD_KEY_SSID_KEY);\r\nkey_lb = (GtkWidget *)g_object_get_data(G_OBJECT(add_key_w),AIRPCAP_ADVANCED_ADD_KEY_KEY_LABEL_KEY);\r\nssid_lb = (GtkWidget *)g_object_get_data(G_OBJECT(add_key_w),AIRPCAP_ADVANCED_ADD_KEY_SSID_LABEL_KEY);\r\ntype_text = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(type_cb));\r\nif (g_ascii_strcasecmp(type_text, ""))\r\n{\r\nif (g_ascii_strcasecmp(type_text,AIRPCAP_WEP_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(add_ssid_te,FALSE);\r\ngtk_entry_set_text(GTK_ENTRY(add_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Key");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"");\r\n}\r\nelse if (g_ascii_strcasecmp(type_text,AIRPCAP_WPA_BIN_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(add_ssid_te,FALSE);\r\ngtk_entry_set_text(GTK_ENTRY(add_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Key");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"");\r\n}\r\nelse if (g_ascii_strcasecmp(type_text,AIRPCAP_WPA_PWD_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(add_ssid_te,TRUE);\r\ngtk_entry_set_text(GTK_ENTRY(add_ssid_te),"");\r\ngtk_label_set_text(GTK_LABEL(key_lb),"Passphrase");\r\ngtk_label_set_text(GTK_LABEL(ssid_lb),"SSID");\r\n}\r\n}\r\ngtk_widget_show(add_ssid_te);\r\ng_free(type_text);\r\n}\r\nstatic void\r\non_fcs_filter_cb_changed(GtkWidget *fcs_filter_cb, gpointer data _U_)\r\n{\r\ngchar *fcs_filter_str;\r\nif (fcs_filter_cb != NULL)\r\n{\r\nfcs_filter_str = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(fcs_filter_cb));\r\nif (fcs_filter_str && (g_ascii_strcasecmp("", fcs_filter_str)))\r\n{\r\nairpcap_if_selected->CrcValidationOn = airpcap_get_validation_type(fcs_filter_str);\r\nairpcap_if_selected->saved = FALSE;\r\n}\r\ng_free(fcs_filter_str);\r\n}\r\n}\r\nstatic void\r\non_capture_type_cb_changed(GtkWidget *cb, gpointer user_data _U_)\r\n{\r\ngchar *s;\r\nif (cb == NULL) {\r\nreturn;\r\n}\r\ns = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(cb));\r\nif ((g_ascii_strcasecmp("",s)))\r\n{\r\nairpcap_if_selected->linkType = airpcap_get_link_type(s);\r\nairpcap_if_selected->saved = FALSE;\r\n}\r\ng_free(s);\r\n}\r\nstatic gboolean\r\nupdate_blink(gpointer data)\r\n{\r\nairpcap_if_info_t* sel;\r\nPAirpcapHandle ad;\r\ngchar ebuf[AIRPCAP_ERRBUF_SIZE];\r\nsel = (airpcap_if_info_t*)data;\r\nad = airpcap_if_open(sel->name, ebuf);\r\nif (ad)\r\n{\r\nif (sel->led)\r\n{\r\nairpcap_if_turn_led_off(ad, 0);\r\nsel->led = FALSE;\r\n}\r\nelse\r\n{\r\nairpcap_if_turn_led_on(ad, 0);\r\nsel->led = TRUE;\r\n}\r\nairpcap_if_close(ad);\r\n}\r\nreturn TRUE;\r\n}\r\nstatic void\r\non_blink_bt_clicked( GtkWidget *blink_bt, gpointer data _U_)\r\n{\r\nPAirpcapHandle ad = NULL;\r\ngchar ebuf[AIRPCAP_ERRBUF_SIZE];\r\nif (airpcap_if_selected != NULL) {\r\nif (!(airpcap_if_selected->blinking))\r\n{\r\ngtk_button_set_label(GTK_BUTTON(blink_bt),"Stop Blinking");\r\nairpcap_if_selected->tag = g_timeout_add(500,update_blink,airpcap_if_selected);\r\nairpcap_if_selected->blinking = TRUE;\r\n}\r\nelse\r\n{\r\ngtk_button_set_label(GTK_BUTTON(blink_bt)," Blink Led ");\r\ng_source_remove(airpcap_if_selected->tag);\r\nairpcap_if_selected->blinking = FALSE;\r\nad = airpcap_if_open(airpcap_if_selected->name, ebuf);\r\nif (ad)\r\n{\r\ng_source_remove(airpcap_if_selected->tag);\r\nairpcap_if_turn_led_on(ad, 0);\r\nairpcap_if_selected->blinking = FALSE;\r\nairpcap_if_selected->led = TRUE;\r\nairpcap_if_close(ad);\r\n}\r\n}\r\n}\r\n}\r\nstatic void\r\non_what_s_this_bt_clicked( GtkWidget *blink_bt _U_, gpointer data _U_)\r\n{\r\nsimple_dialog(ESD_TYPE_INFO,ESD_BTN_OK,\r\n"The Multi-Channel Aggregator is a virtual device "\r\n"that can be used to capture packets from all the "\r\n"AirPcap adapters at the same time.\n"\r\n"The Capture Type, FCS and Encryption settings of "\r\n"this virtual device can be configured as for any "\r\n"real adapter.\nThe channel cannot be changed for "\r\n"this adapter.\n"\r\n"Refer to the AirPcap manual for more information.");\r\n}\r\nstatic void\r\non_key_management_destroy(GtkWidget *w _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w,\r\n*toolbar;\r\ngint *from_widget = NULL;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\ntoolbar = GTK_WIDGET(g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_TOOLBAR_KEY));\r\nfrom_widget = (gint*)g_object_get_data(G_OBJECT(toolbar),AIRPCAP_ADVANCED_FROM_KEY);\r\nif ( *from_widget == AIRPCAP_ADVANCED_FROM_TOOLBAR)\r\ngtk_widget_set_sensitive(toolbar,TRUE);\r\nelse\r\ngtk_widget_set_sensitive(toolbar,FALSE);\r\ng_free(from_widget);\r\nif (airpcap_if_selected != NULL)\r\n{\r\nif (!airpcap_if_selected->saved)\r\n{\r\nairpcap_load_selected_if_configuration(airpcap_if_selected);\r\n}\r\n}\r\n}\r\nstatic void\r\non_airpcap_advanced_destroy(GtkWidget *w _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w,\r\n*toolbar;\r\ngint *from_widget = NULL;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\ntoolbar = GTK_WIDGET(g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_TOOLBAR_KEY));\r\nfrom_widget = (gint*)g_object_get_data(G_OBJECT(toolbar),AIRPCAP_ADVANCED_FROM_KEY);\r\nif ( *from_widget == AIRPCAP_ADVANCED_FROM_TOOLBAR)\r\ngtk_widget_set_sensitive(toolbar,TRUE);\r\nelse\r\ngtk_widget_set_sensitive(toolbar,FALSE);\r\ng_free(from_widget);\r\nif (!airpcap_if_selected->saved)\r\n{\r\nairpcap_load_selected_if_configuration(airpcap_if_selected);\r\n}\r\n}\r\nstatic void\r\non_key_management_apply_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *toolbar_cb;\r\nGtkWidget *decryption_mode_cb;\r\nGtkListStore *key_list_store;\r\nmodule_t *wlan_module = prefs_find_module("wlan");\r\ngchar *decryption_mode_string;\r\nkey_management_w = GTK_WIDGET(data);\r\ndecryption_mode_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_DECRYPTION_MODE_KEY));\r\nkey_list_store = GTK_LIST_STORE(g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY));\r\ntoolbar_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_TOOLBAR_DECRYPTION_KEY));\r\n#define CANT_SAVE_ERR_STR "Cannot save configuration! Another application " \\r\n"might be using AirPcap, or you might not have sufficient privileges."\r\ndecryption_mode_string = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(decryption_mode_cb));\r\nif (g_ascii_strcasecmp(decryption_mode_string, AIRPCAP_DECRYPTION_TYPE_STRING_WIRESHARK) == 0)\r\n{\r\nset_wireshark_decryption(TRUE);\r\nif (!set_airpcap_decryption(FALSE)) g_warning(CANT_SAVE_ERR_STR);\r\n}\r\nelse if (g_ascii_strcasecmp(decryption_mode_string, AIRPCAP_DECRYPTION_TYPE_STRING_AIRPCAP) == 0)\r\n{\r\nset_wireshark_decryption(FALSE);\r\nif (!set_airpcap_decryption(TRUE)) g_warning(CANT_SAVE_ERR_STR);\r\n}\r\nelse if (g_ascii_strcasecmp(decryption_mode_string, AIRPCAP_DECRYPTION_TYPE_STRING_NONE) == 0)\r\n{\r\nset_wireshark_decryption(FALSE);\r\nif (!set_airpcap_decryption(FALSE)) g_warning(CANT_SAVE_ERR_STR);\r\n}\r\ng_free(decryption_mode_string);\r\nairpcap_read_and_save_decryption_keys_from_list_store(key_list_store,airpcap_if_selected,g_airpcap_if_list);\r\nupdate_decryption_mode(toolbar_cb);\r\nprefs_apply(wlan_module);\r\n}\r\nstatic void\r\non_add_key_ok_bt_clicked(GtkWidget *widget _U_, gpointer data)\r\n{\r\nGtkWidget *type_cb,\r\n*key_en,\r\n*ssid_en;\r\nGtkListStore *key_list_store;\r\nGString *new_type_string,\r\n*new_key_string,\r\n*new_ssid_string;\r\ngchar *type_entered = NULL;\r\ngchar *key_entered = NULL;\r\ngchar *ssid_entered = NULL;\r\nunsigned int i;\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_ADD_KEY_LIST_KEY);\r\ntype_cb = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_ADD_KEY_TYPE_KEY);\r\nkey_en = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_ADD_KEY_KEY_KEY);\r\nssid_en = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_ADD_KEY_SSID_KEY);\r\ntype_entered = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(type_cb));\r\nkey_entered = g_strdup(gtk_entry_get_text(GTK_ENTRY(key_en)));\r\nssid_entered = g_strdup(gtk_entry_get_text(GTK_ENTRY(ssid_en)));\r\nnew_type_string = g_string_new(type_entered);\r\nnew_key_string = g_string_new(key_entered);\r\nnew_ssid_string = g_string_new(ssid_entered);\r\ng_free(type_entered);\r\ng_free(key_entered );\r\ng_free(ssid_entered);\r\ng_strstrip(new_key_string->str);\r\ng_strstrip(new_ssid_string->str);\r\nif (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WEP_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) > WEP_KEY_MAX_CHAR_SIZE) || ((new_key_string->len) < WEP_KEY_MIN_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WEP key size out of range!\nValid key size range is %d-%d characters (%d-%d bits).",WEP_KEY_MIN_CHAR_SIZE,WEP_KEY_MAX_CHAR_SIZE,WEP_KEY_MIN_BIT_SIZE,WEP_KEY_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nif ((new_key_string->len % 2) != 0)\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WEP key!\nThe number of characters must be even.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nfor (i = 0; i < new_key_string->len; i++)\r\n{\r\nif (!g_ascii_isxdigit(new_key_string->str[i]))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WEP key!\nA WEP key must be a hexadecimal number.\nThe valid characters are: 0123456789ABCDEF.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\n}\r\nairpcap_add_key_to_list(key_list_store, new_type_string->str, new_key_string->str, new_ssid_string->str);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse if (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WPA_PWD_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) > WPA_KEY_MAX_CHAR_SIZE) || ((new_key_string->len) < WPA_KEY_MIN_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WPA key size out of range!\nValid key size range is %d-%d ASCII characters (%d-%d bits).",WPA_KEY_MIN_CHAR_SIZE,WPA_KEY_MAX_CHAR_SIZE,WPA_KEY_MIN_BIT_SIZE,WPA_KEY_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nif ((new_ssid_string->len) > WPA_SSID_MAX_CHAR_SIZE)\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"SSID key size out of range!\nValid SSID size range is %d-%d ASCII characters (%d-%d bits).",WPA_SSID_MIN_CHAR_SIZE,WPA_SSID_MAX_CHAR_SIZE,WPA_SSID_MIN_BIT_SIZE,WPA_SSID_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nairpcap_add_key_to_list(key_list_store, new_type_string->str, new_key_string->str, new_ssid_string->str);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse if (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WPA_BIN_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) != WPA_PSK_KEY_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WPA PSK/PMK key size is wrong!\nValid key size is %d characters (%d bits).",WPA_PSK_KEY_CHAR_SIZE,WPA_PSK_KEY_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nfor (i = 0; i < new_key_string->len; i++)\r\n{\r\nif (!g_ascii_isxdigit(new_key_string->str[i]))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WPA PSK/PMK key!\nKey must be an hexadecimal number.\nThe valid characters are: 0123456789ABCDEF.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\n}\r\nairpcap_add_key_to_list(key_list_store, new_type_string->str, new_key_string->str, new_ssid_string->str);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Unknown error in the key \"Type\" field.");\r\n}\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nwindow_destroy(GTK_WIDGET(data));\r\nreturn;\r\n}\r\nstatic void\r\non_edit_key_ok_bt_clicked(GtkWidget *widget _U_, gpointer data)\r\n{\r\nGtkWidget *type_cb,\r\n*key_en,\r\n*ssid_en;\r\nGtkListStore *key_list_store;\r\nGtkTreeSelection *selection;\r\nGtkTreeIter iter;\r\nGString *new_type_string,\r\n*new_key_string,\r\n*new_ssid_string;\r\ngchar *type_entered = NULL;\r\ngchar *key_entered = NULL;\r\ngchar *ssid_entered = NULL;\r\nunsigned int i;\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_EDIT_KEY_LIST_KEY);\r\nselection = (GtkTreeSelection *)g_object_get_data(G_OBJECT(data), AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY);\r\ntype_cb = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_EDIT_KEY_TYPE_KEY);\r\nkey_en = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_EDIT_KEY_KEY_KEY);\r\nssid_en = (GtkWidget *)g_object_get_data(G_OBJECT(data),AIRPCAP_ADVANCED_EDIT_KEY_SSID_KEY);\r\nif (!gtk_tree_selection_get_selected(selection, NULL, &iter))\r\nreturn;\r\ntype_entered = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(type_cb));\r\nkey_entered = g_strdup(gtk_entry_get_text(GTK_ENTRY(key_en)));\r\nssid_entered = g_strdup(gtk_entry_get_text(GTK_ENTRY(ssid_en)));\r\ng_strstrip(key_entered);\r\ng_strstrip(ssid_entered);\r\nnew_type_string = g_string_new(type_entered);\r\nnew_key_string = g_string_new(key_entered);\r\nnew_ssid_string = g_string_new(ssid_entered);\r\ng_free(type_entered);\r\ng_free(key_entered );\r\ng_free(ssid_entered);\r\nif (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WEP_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) > WEP_KEY_MAX_CHAR_SIZE) || ((new_key_string->len) < WEP_KEY_MIN_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WEP key size out of range!\nValid key size range is %d-%d characters (%d-%d bits).",WEP_KEY_MIN_CHAR_SIZE,WEP_KEY_MAX_CHAR_SIZE,WEP_KEY_MIN_BIT_SIZE,WEP_KEY_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nif ((new_key_string->len % 2) != 0)\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WEP key!\nThe number of characters must be even.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nfor (i = 0; i < new_key_string->len; i++)\r\n{\r\nif (!g_ascii_isxdigit(new_key_string->str[i]))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WEP key!\nA WEP key must be an hexadecimal number.\nThe valid characters are: 0123456789ABCDEF.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\n}\r\ngtk_list_store_set(key_list_store, &iter,\r\nKL_COL_TYPE, new_type_string->str,\r\nKL_COL_KEY, new_key_string->str,\r\nKL_COL_SSID, new_ssid_string->str,\r\n-1);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse if (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WPA_PWD_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) > WPA_KEY_MAX_CHAR_SIZE) || ((new_key_string->len) < WPA_KEY_MIN_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WPA key size out of range!\nValid key size range is %d-%d ASCII characters (%d-%d bits).",WPA_KEY_MIN_CHAR_SIZE,WPA_KEY_MAX_CHAR_SIZE,WPA_KEY_MIN_BIT_SIZE,WPA_KEY_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nif ((new_ssid_string->len) > WPA_SSID_MAX_CHAR_SIZE)\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"SSID key size out of range!\nValid SSID size range is %d-%d ASCII characters (%d-%d bits).",WPA_SSID_MIN_CHAR_SIZE,WPA_SSID_MAX_CHAR_SIZE,WPA_SSID_MIN_BIT_SIZE,WPA_SSID_MAX_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\ngtk_list_store_set(key_list_store, &iter,\r\nKL_COL_TYPE, new_type_string->str,\r\nKL_COL_KEY, new_key_string->str,\r\nKL_COL_SSID, new_ssid_string->str,\r\n-1);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse if (g_ascii_strcasecmp(new_type_string->str,AIRPCAP_WPA_BIN_KEY_STRING) == 0)\r\n{\r\nif ( ((new_key_string->len) != WPA_PSK_KEY_CHAR_SIZE))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"WPA PSK/PMK key size is wrong!\nValid key size is %d characters (%d bits).",WPA_PSK_KEY_CHAR_SIZE,WPA_PSK_KEY_BIT_SIZE);\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\nfor (i = 0; i < new_key_string->len; i++)\r\n{\r\nif (!g_ascii_isxdigit(new_key_string->str[i]))\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Invalid WPA PSK/PMK key!\nKey must be an hexadecimal number.\nThe valid characters are: 0123456789ABCDEF.");\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nreturn;\r\n}\r\n}\r\ngtk_list_store_set(key_list_store, &iter,\r\nKL_COL_TYPE, new_type_string->str,\r\nKL_COL_KEY, new_key_string->str,\r\nKL_COL_SSID, new_ssid_string->str,\r\n-1);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nelse\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Unknown error in the key \"Type\" field.");\r\n}\r\ng_string_free(new_type_string,TRUE);\r\ng_string_free(new_key_string, TRUE);\r\ng_string_free(new_ssid_string,TRUE);\r\nwindow_destroy(GTK_WIDGET(data));\r\nreturn;\r\n}\r\nstatic void\r\non_add_key_w_destroy(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\ngtk_widget_set_sensitive(GTK_WIDGET(airpcap_advanced_w),TRUE);\r\nreturn;\r\n}\r\nstatic void\r\non_add_new_key_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *add_key_window;\r\nGtkWidget *add_frame;\r\nGtkWidget *main_v_box;\r\nGtkWidget *add_grid;\r\nGtkWidget *add_frame_al;\r\nGtkWidget *add_type_cb;\r\nGtkWidget *add_key_te;\r\nGtkWidget *add_ssid_te;\r\nGtkWidget *add_type_lb;\r\nGtkWidget *add_key_lb;\r\nGtkWidget *add_ssid_lb;\r\nGtkWidget *low_h_button_box;\r\nGtkWidget *ok_bt;\r\nGtkWidget *cancel_bt;\r\nGtkWidget *add_frame_lb;\r\nGtkWidget *airpcap_advanced_w;\r\nGtkListStore *key_list_store;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nif (gtk_tree_model_iter_n_children(GTK_TREE_MODEL(key_list_store), NULL) >= MAX_ENCRYPTION_KEYS)\r\n{\r\nsimple_dialog(ESD_TYPE_ERROR,ESD_BTN_OK,"Maximum number (%d) of decryption keys reached! You cannot add another key!\n",MAX_ENCRYPTION_KEYS);\r\nreturn;\r\n}\r\ngtk_widget_set_sensitive(airpcap_advanced_w,FALSE);\r\nadd_key_window = dlg_window_new ("Add Decryption Key");\r\ngtk_window_set_modal(GTK_WINDOW(add_key_window), TRUE);\r\ngtk_window_set_transient_for(GTK_WINDOW(add_key_window), GTK_WINDOW(airpcap_advanced_w));\r\ngtk_widget_set_name (add_key_window, "add_key_window");\r\ngtk_container_set_border_width (GTK_CONTAINER (add_key_window), 5);\r\ngtk_window_set_resizable (GTK_WINDOW (add_key_window), FALSE);\r\nmain_v_box = ws_gtk_box_new (GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (main_v_box, "main_v_box");\r\ngtk_widget_show (main_v_box);\r\ngtk_container_add (GTK_CONTAINER (add_key_window), main_v_box);\r\nadd_frame = gtk_frame_new (NULL);\r\ngtk_widget_set_name (add_frame, "add_frame");\r\ngtk_widget_show (add_frame);\r\ngtk_box_pack_start (GTK_BOX (main_v_box), add_frame, TRUE, TRUE, 0);\r\nadd_frame_al = gtk_alignment_new (0.5f, 0.5f, 1, 1);\r\ngtk_widget_set_name (add_frame_al, "add_frame_al");\r\ngtk_widget_show (add_frame_al);\r\ngtk_container_add (GTK_CONTAINER (add_frame), add_frame_al);\r\ngtk_alignment_set_padding (GTK_ALIGNMENT (add_frame_al), 0, 0, 12, 0);\r\nadd_grid = ws_gtk_grid_new ();\r\ngtk_widget_set_name (add_grid, "add_tb");\r\ngtk_container_set_border_width(GTK_CONTAINER(add_grid),5);\r\ngtk_widget_show (add_grid);\r\ngtk_container_add (GTK_CONTAINER (add_frame_al), add_grid);\r\nadd_type_lb = gtk_label_new ("Type");\r\ngtk_widget_set_name (add_type_lb, "add_type_lb");\r\ngtk_widget_show (add_type_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_type_lb, 0, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (add_type_lb), GTK_JUSTIFY_CENTER);\r\nadd_key_lb = gtk_label_new ("Key");\r\ngtk_widget_set_name (add_key_lb, "add_key_lb");\r\ngtk_widget_show (add_key_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_key_lb, 1, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (add_key_lb), GTK_JUSTIFY_CENTER);\r\nadd_ssid_lb = gtk_label_new ("");\r\ngtk_widget_set_name (add_ssid_lb, "add_ssid_lb");\r\ngtk_widget_show (add_ssid_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_ssid_lb, 2, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (add_ssid_lb), GTK_JUSTIFY_CENTER);\r\nadd_type_cb = gtk_combo_box_text_new();\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(add_type_cb), AIRPCAP_WEP_KEY_STRING);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(add_type_cb), AIRPCAP_WPA_PWD_KEY_STRING);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(add_type_cb), AIRPCAP_WPA_BIN_KEY_STRING);\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(add_type_cb), 0);\r\ngtk_widget_set_name (add_type_cb, "add_type_cb");\r\ngtk_widget_show (add_type_cb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_type_cb, 0, 1, 1, 1);\r\ngtk_widget_set_size_request (add_type_cb, 83, -1);\r\nadd_key_te = gtk_entry_new ();\r\ngtk_widget_set_name (add_key_te, "add_key_te");\r\ngtk_widget_show (add_key_te);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_key_te, 1, 1, 1, 1);\r\ngtk_widget_set_size_request (add_key_te, 178, -1);\r\nadd_ssid_te = gtk_entry_new ();\r\ngtk_widget_set_name (add_ssid_te, "add_ssid_te");\r\ngtk_widget_set_sensitive(add_ssid_te,FALSE);\r\ngtk_widget_show (add_ssid_te);\r\nws_gtk_grid_attach_defaults (GTK_GRID (add_grid), add_ssid_te, 2, 1, 1, 1);\r\nlow_h_button_box = gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_set_name (low_h_button_box, "low_h_button_box");\r\ngtk_container_set_border_width (GTK_CONTAINER (low_h_button_box), 5);\r\ngtk_widget_show (low_h_button_box);\r\ngtk_box_pack_end (GTK_BOX (main_v_box), low_h_button_box, FALSE, FALSE, 0);\r\ngtk_button_box_set_layout (GTK_BUTTON_BOX (low_h_button_box),\r\nGTK_BUTTONBOX_END);\r\nok_bt = gtk_button_new_with_mnemonic ("OK");\r\ngtk_widget_set_name (ok_bt, "ok_bt");\r\ngtk_widget_show (ok_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), ok_bt);\r\ngtk_widget_set_can_default (ok_bt, TRUE);\r\ncancel_bt = gtk_button_new_with_mnemonic ("Cancel");\r\ngtk_widget_set_name (cancel_bt, "cancel_bt");\r\ngtk_widget_show (cancel_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), cancel_bt);\r\ngtk_widget_set_can_default (cancel_bt, TRUE);\r\nadd_frame_lb = gtk_label_new ("<b>Modify Selected Key</b>");\r\ngtk_widget_set_name (add_frame_lb, "add_frame_lb");\r\ngtk_widget_show (add_frame_lb);\r\ngtk_frame_set_label_widget (GTK_FRAME (add_frame), add_frame_lb);\r\ngtk_label_set_use_markup (GTK_LABEL (add_frame_lb), TRUE);\r\ng_signal_connect(ok_bt, "clicked", G_CALLBACK(on_add_key_ok_bt_clicked), add_key_window );\r\ng_signal_connect(cancel_bt, "clicked", G_CALLBACK(window_cancel_button_cb), add_key_window );\r\ng_signal_connect(add_type_cb, "changed", G_CALLBACK(on_add_type_cb_changed), add_key_window);\r\ng_signal_connect(add_key_window, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ng_signal_connect(add_key_window, "destroy", G_CALLBACK(on_add_key_w_destroy), data);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_LIST_KEY,key_list_store);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_TYPE_KEY,add_type_cb);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_KEY_KEY,add_key_te);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_SSID_KEY,add_ssid_te);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_KEY_LABEL_KEY,add_key_lb);\r\ng_object_set_data(G_OBJECT(add_key_window),AIRPCAP_ADVANCED_ADD_KEY_SSID_LABEL_KEY,add_ssid_lb);\r\ngtk_widget_show(add_key_window);\r\n}\r\nstatic void\r\non_edit_key_w_destroy(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\ngtk_widget_set_sensitive(GTK_WIDGET(airpcap_advanced_w),TRUE);\r\nreturn;\r\n}\r\nstatic void\r\non_remove_key_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nGtkTreeSelection *selection;\r\nselection = (GtkTreeSelection *)g_object_get_data(G_OBJECT(data), AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY);\r\nif (!gtk_tree_selection_get_selected(selection, &model, &iter))\r\nreturn;\r\ngtk_list_store_remove(GTK_LIST_STORE(model), &iter);\r\ngtk_tree_selection_select_iter(selection, &iter);\r\nif (airpcap_if_selected != NULL) airpcap_if_selected->saved = FALSE;\r\n}\r\nstatic void\r\non_edit_key_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *edit_key_window;\r\nGtkWidget *edit_frame;\r\nGtkWidget *main_v_box;\r\nGtkWidget *edit_grid;\r\nGtkWidget *edit_frame_al;\r\nGtkWidget *edit_type_cb;\r\nGtkWidget *edit_key_te;\r\nGtkWidget *edit_ssid_te;\r\nGtkWidget *edit_type_lb;\r\nGtkWidget *edit_key_lb;\r\nGtkWidget *edit_ssid_lb;\r\nGtkWidget *low_h_button_box;\r\nGtkWidget *ok_bt;\r\nGtkWidget *cancel_bt;\r\nGtkWidget *edit_frame_lb;\r\nGtkWidget *airpcap_advanced_w;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nGtkTreeSelection *selection;\r\nGtkListStore *key_list_store;\r\ngchar *row_type,\r\n*row_key,\r\n*row_ssid = NULL;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\nselection = (GtkTreeSelection *)g_object_get_data(G_OBJECT(data), AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY);\r\nkey_list_store = (GtkListStore *)g_object_get_data (G_OBJECT(data), AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nif (!gtk_tree_selection_get_selected(selection, &model, &iter))\r\nreturn;\r\ngtk_tree_model_get(model, &iter,\r\nKL_COL_TYPE, &row_type,\r\nKL_COL_KEY, &row_key,\r\nKL_COL_SSID, &row_ssid,\r\n-1);\r\ngtk_widget_set_sensitive(airpcap_advanced_w,FALSE);\r\nedit_key_window = dlg_window_new("Edit Decryption Key");\r\ngtk_window_set_modal(GTK_WINDOW(edit_key_window), TRUE);\r\ngtk_window_set_transient_for(GTK_WINDOW(edit_key_window), GTK_WINDOW(airpcap_advanced_w));\r\ngtk_widget_set_name (edit_key_window, "edit_key_window");\r\ngtk_container_set_border_width (GTK_CONTAINER (edit_key_window), 5);\r\ngtk_window_set_resizable (GTK_WINDOW (edit_key_window), FALSE);\r\nmain_v_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (main_v_box, "main_v_box");\r\ngtk_widget_show (main_v_box);\r\ngtk_container_add (GTK_CONTAINER (edit_key_window), main_v_box);\r\nedit_frame = gtk_frame_new (NULL);\r\ngtk_widget_set_name (edit_frame, "edit_frame");\r\ngtk_widget_show (edit_frame);\r\ngtk_box_pack_start (GTK_BOX (main_v_box), edit_frame, TRUE, TRUE, 0);\r\nedit_frame_al = gtk_alignment_new (0.5f, 0.5f, 1, 1);\r\ngtk_widget_set_name (edit_frame_al, "edit_frame_al");\r\ngtk_widget_show (edit_frame_al);\r\ngtk_container_add (GTK_CONTAINER (edit_frame), edit_frame_al);\r\ngtk_alignment_set_padding (GTK_ALIGNMENT (edit_frame_al), 0, 0, 12, 0);\r\nedit_grid = ws_gtk_grid_new();\r\ngtk_widget_set_name (edit_grid, "edit_tb");\r\ngtk_container_set_border_width(GTK_CONTAINER(edit_grid),5);\r\ngtk_widget_show (edit_grid);\r\ngtk_container_add (GTK_CONTAINER (edit_frame_al), edit_grid);\r\nedit_type_lb = gtk_label_new ("Type");\r\ngtk_widget_set_name (edit_type_lb, "edit_type_lb");\r\ngtk_widget_show (edit_type_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_type_lb, 0, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (edit_type_lb), GTK_JUSTIFY_CENTER);\r\nedit_key_lb = gtk_label_new ("Key");\r\ngtk_widget_set_name (edit_key_lb, "edit_key_lb");\r\ngtk_widget_show (edit_key_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_key_lb, 1, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (edit_key_lb), GTK_JUSTIFY_CENTER);\r\nedit_ssid_lb = gtk_label_new ("");\r\ngtk_widget_set_name (edit_ssid_lb, "edit_ssid_lb");\r\ngtk_widget_show (edit_ssid_lb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_ssid_lb, 2, 0, 1, 1);\r\ngtk_label_set_justify (GTK_LABEL (edit_ssid_lb), GTK_JUSTIFY_CENTER);\r\nedit_type_cb = gtk_combo_box_text_new();\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(edit_type_cb), AIRPCAP_WEP_KEY_STRING);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(edit_type_cb), AIRPCAP_WPA_PWD_KEY_STRING);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(edit_type_cb), AIRPCAP_WPA_BIN_KEY_STRING);\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(edit_type_cb), 0);\r\nif (g_ascii_strcasecmp(row_type, AIRPCAP_WPA_PWD_KEY_STRING) == 0) {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(edit_type_cb), 1);\r\n} else if (g_ascii_strcasecmp(row_type, AIRPCAP_WPA_BIN_KEY_STRING) == 0) {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(edit_type_cb), 2);\r\n}\r\ngtk_widget_set_name (edit_type_cb, "edit_type_cb");\r\ngtk_widget_show (edit_type_cb);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_type_cb, 0, 1, 1, 1);\r\ngtk_widget_set_size_request (edit_type_cb, 83, -1);\r\nedit_key_te = gtk_entry_new ();\r\ngtk_widget_set_name (edit_key_te, "edit_key_te");\r\ngtk_entry_set_text(GTK_ENTRY(edit_key_te),row_key);\r\ngtk_widget_show (edit_key_te);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_key_te, 1, 1, 1, 1);\r\ngtk_widget_set_size_request (edit_key_te, 178, -1);\r\nedit_ssid_te = gtk_entry_new ();\r\ngtk_widget_set_name (edit_ssid_te, "edit_ssid_te");\r\nif (g_ascii_strcasecmp(row_type,AIRPCAP_WEP_KEY_STRING) == 0)\r\n{\r\ngtk_widget_set_sensitive(edit_ssid_te,FALSE);\r\n}\r\nelse\r\n{\r\ngtk_widget_set_sensitive(edit_ssid_te,TRUE);\r\ngtk_entry_set_text(GTK_ENTRY(edit_ssid_te),row_ssid?row_ssid:"");\r\n}\r\ngtk_widget_show (edit_ssid_te);\r\nws_gtk_grid_attach_defaults (GTK_GRID (edit_grid), edit_ssid_te, 2, 1, 1, 1);\r\nlow_h_button_box = gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_set_name (low_h_button_box, "low_h_button_box");\r\ngtk_container_set_border_width (GTK_CONTAINER (low_h_button_box), 5);\r\ngtk_widget_show (low_h_button_box);\r\ngtk_box_pack_end (GTK_BOX (main_v_box), low_h_button_box, FALSE, FALSE, 0);\r\ngtk_button_box_set_layout (GTK_BUTTON_BOX (low_h_button_box),\r\nGTK_BUTTONBOX_END);\r\nok_bt = gtk_button_new_with_mnemonic ("OK");\r\ngtk_widget_set_name (ok_bt, "ok_bt");\r\ngtk_widget_show (ok_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), ok_bt);\r\ngtk_widget_set_can_default (ok_bt, TRUE);\r\ncancel_bt = gtk_button_new_with_mnemonic ("Cancel");\r\ngtk_widget_set_name (cancel_bt, "cancel_bt");\r\ngtk_widget_show (cancel_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), cancel_bt);\r\ngtk_widget_set_can_default (cancel_bt, TRUE);\r\nedit_frame_lb = gtk_label_new ("<b>Modify Selected Key</b>");\r\ngtk_widget_set_name (edit_frame_lb, "edit_frame_lb");\r\ngtk_widget_show (edit_frame_lb);\r\ngtk_frame_set_label_widget (GTK_FRAME (edit_frame), edit_frame_lb);\r\ngtk_label_set_use_markup (GTK_LABEL (edit_frame_lb), TRUE);\r\ng_signal_connect(ok_bt, "clicked", G_CALLBACK(on_edit_key_ok_bt_clicked), edit_key_window );\r\ng_signal_connect(cancel_bt, "clicked", G_CALLBACK(window_cancel_button_cb), edit_key_window );\r\ng_signal_connect(edit_type_cb, "changed", G_CALLBACK(on_edit_type_cb_changed), edit_key_window);\r\ng_signal_connect(edit_key_window, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ng_signal_connect(edit_key_window, "destroy", G_CALLBACK(on_edit_key_w_destroy), data);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_LIST_KEY,key_list_store);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY,selection);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_TYPE_KEY,edit_type_cb);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_KEY_KEY,edit_key_te);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_SSID_KEY,edit_ssid_te);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_KEY_LABEL_KEY,edit_key_lb);\r\ng_object_set_data(G_OBJECT(edit_key_window),AIRPCAP_ADVANCED_EDIT_KEY_SSID_LABEL_KEY,edit_ssid_lb);\r\ng_free(row_type);\r\ng_free(row_key);\r\ng_free(row_ssid);\r\ngtk_widget_show(edit_key_window);\r\n}\r\nstatic void\r\non_move_key_up_bt_clicked(GtkWidget *button _U_, gpointer key_list)\r\n{\r\ntree_view_list_store_move_selection(GTK_TREE_VIEW(key_list), TRUE);\r\n}\r\nstatic void\r\non_move_key_down_bt_clicked(GtkWidget *button _U_, gpointer list_view)\r\n{\r\ntree_view_list_store_move_selection(GTK_TREE_VIEW(list_view), FALSE);\r\n}\r\nvoid\r\non_decryption_mode_cb_changed(GtkWidget *cb, gpointer data _U_)\r\n{\r\ngint cur_active;\r\nif (cb == NULL) {\r\nreturn;\r\n}\r\ncur_active = gtk_combo_box_get_active(GTK_COMBO_BOX(cb));\r\nif (cur_active < 0) {\r\nreturn;\r\n}\r\nswitch(cur_active) {\r\ncase 1:\r\nset_wireshark_decryption(TRUE);\r\nif (!set_airpcap_decryption(FALSE)) g_warning(CANT_SAVE_ERR_STR);\r\nbreak;\r\ncase 2:\r\nset_wireshark_decryption(FALSE);\r\nif (!set_airpcap_decryption(TRUE)) g_warning(CANT_SAVE_ERR_STR);\r\nbreak;\r\ndefault:\r\nset_wireshark_decryption(FALSE);\r\nif (!set_airpcap_decryption(FALSE)) g_warning(CANT_SAVE_ERR_STR);\r\nbreak;\r\n}\r\nredissect_packets();\r\nredissect_all_packet_windows();\r\n}\r\nvoid\r\nupdate_decryption_mode(GtkWidget *cb)\r\n{\r\nif (cb == NULL) {\r\nreturn;\r\n}\r\nif (wireshark_decryption_on())\r\n{\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 1);\r\n}\r\nelse if (airpcap_decryption_on())\r\n{\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 2);\r\n}\r\nelse\r\n{\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 0);\r\n}\r\nreturn;\r\n}\r\nvoid\r\nupdate_decryption_mode_list(GtkWidget *cb)\r\n{\r\ngchar *current_text;\r\nif (cb == NULL)\r\nreturn;\r\ncurrent_text = NULL;\r\ncurrent_text = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT(cb));\r\nwhile (gtk_tree_model_iter_n_children(gtk_combo_box_get_model(GTK_COMBO_BOX(cb)), NULL) > 0) {\r\ngtk_combo_box_text_remove(GTK_COMBO_BOX_TEXT(cb), 0);\r\n}\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(cb), AIRPCAP_DECRYPTION_TYPE_STRING_NONE);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(cb), AIRPCAP_DECRYPTION_TYPE_STRING_WIRESHARK);\r\nif (g_airpcap_if_list != NULL && g_list_length(g_airpcap_if_list) > 0)\r\n{\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(cb), AIRPCAP_DECRYPTION_TYPE_STRING_AIRPCAP);\r\n}\r\nelse\r\n{\r\nif (current_text == NULL || g_ascii_strcasecmp(current_text, AIRPCAP_DECRYPTION_TYPE_STRING_AIRPCAP) == 0)\r\n{\r\ng_free(current_text);\r\ncurrent_text = g_strdup(AIRPCAP_DECRYPTION_TYPE_STRING_NONE);\r\n}\r\n}\r\nif (g_ascii_strcasecmp(current_text, AIRPCAP_DECRYPTION_TYPE_STRING_WIRESHARK) == 0) {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 1);\r\n} else if (g_ascii_strcasecmp(current_text, AIRPCAP_DECRYPTION_TYPE_STRING_AIRPCAP) == 0) {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 2);\r\n} else {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(cb), 0);\r\n}\r\ng_free(current_text);\r\n}\r\nstatic void\r\non_advanced_apply_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w;\r\nGtkWidget *channel_cb, *channel_offset_cb;\r\nGtkWidget *toolbar,\r\n*toolbar_if_lb,\r\n*toolbar_channel_cb,\r\n*toolbar_channel_offset_cb,\r\n*toolbar_fcs_filter_cb;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\nchannel_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_ADVANCED_CHANNEL_KEY));\r\nchannel_offset_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_ADVANCED_CHANNEL_OFFSET_KEY));\r\nairpcap_channel_offset_changed_cb(channel_offset_cb, NULL);\r\nairpcap_channel_changed_set_cb(channel_cb, channel_offset_cb);\r\ntoolbar = GTK_WIDGET(g_object_get_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_TOOLBAR_KEY));\r\ntoolbar_if_lb = GTK_WIDGET(g_object_get_data(G_OBJECT(toolbar),AIRPCAP_TOOLBAR_INTERFACE_KEY));\r\ntoolbar_channel_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(toolbar),AIRPCAP_TOOLBAR_CHANNEL_KEY));\r\ntoolbar_channel_offset_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(toolbar),AIRPCAP_TOOLBAR_CHANNEL_OFFSET_KEY));\r\ntoolbar_fcs_filter_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(toolbar),AIRPCAP_TOOLBAR_FCS_FILTER_KEY));\r\nairpcap_save_selected_if_configuration(airpcap_if_selected);\r\nif ( g_ascii_strcasecmp(airpcap_if_selected->description,airpcap_if_active->description) == 0)\r\n{\r\ngtk_label_set_text(GTK_LABEL(toolbar_if_lb), g_strdup_printf("%s %s\t","Current Wireless Interface: #",airpcap_get_if_string_number(airpcap_if_selected)));\r\nairpcap_update_channel_combo(GTK_WIDGET(toolbar_channel_cb),airpcap_if_selected);\r\nairpcap_update_channel_offset_combo(airpcap_if_selected, airpcap_if_selected->channelInfo.Frequency, toolbar_channel_offset_cb, TRUE);\r\nairpcap_validation_type_combo_set_by_type(toolbar_fcs_filter_cb,airpcap_if_selected->CrcValidationOn);\r\n}\r\n}\r\nstatic void\r\non_advanced_ok_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nPAirpcapHandle ad = NULL;\r\ngchar ebuf[AIRPCAP_ERRBUF_SIZE];\r\nGtkWidget *airpcap_advanced_w = GTK_WIDGET(data);\r\nif (airpcap_if_selected == NULL) {\r\ngtk_widget_destroy(airpcap_advanced_w);\r\nreturn;\r\n}\r\non_advanced_apply_bt_clicked(button, data);\r\nad = airpcap_if_open(airpcap_if_selected->name, ebuf);\r\nif (ad)\r\n{\r\ng_source_remove(airpcap_if_selected->tag);\r\nairpcap_if_turn_led_on(ad, 0);\r\nairpcap_if_selected->blinking = FALSE;\r\nairpcap_if_selected->led = TRUE;\r\nairpcap_if_close(ad);\r\n}\r\ng_source_remove(airpcap_if_selected->tag);\r\ngtk_widget_destroy(airpcap_advanced_w);\r\n}\r\nstatic void\r\non_advanced_cancel_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nPAirpcapHandle ad = NULL;\r\ngchar ebuf[AIRPCAP_ERRBUF_SIZE];\r\nGtkWidget *airpcap_advanced_w;\r\nairpcap_advanced_w = GTK_WIDGET(data);\r\nif (airpcap_if_selected != NULL)\r\n{\r\nad = airpcap_if_open(airpcap_if_selected->name, ebuf);\r\nif (ad)\r\n{\r\ng_source_remove(airpcap_if_selected->tag);\r\nairpcap_if_turn_led_on(ad, 0);\r\nairpcap_if_selected->blinking = FALSE;\r\nairpcap_if_selected->led = TRUE;\r\nairpcap_if_close(ad);\r\n}\r\nif (!airpcap_if_selected->saved)\r\n{\r\nairpcap_load_selected_if_configuration(airpcap_if_selected);\r\n}\r\n}\r\ngtk_widget_destroy(airpcap_advanced_w);\r\n}\r\nvoid\r\ndisplay_airpcap_advanced_cb(GtkWidget *w _U_, gpointer data)\r\n{\r\nGtkWidget *airpcap_advanced_w;\r\nGtkWidget *main_box;\r\nGtkWidget *settings_sub_box;\r\nGtkWidget *interface_fr;\r\nGtkWidget *interface_al;\r\nGtkWidget *interface_sub_h_box;\r\nGtkWidget *interface_name_lb;\r\nGtkWidget *blink_bt;\r\nGtkWidget *interface_frame_lb;\r\nGtkWidget *basic_parameters_fr;\r\nGtkWidget *basic_parameters_al;\r\nGtkWidget *basic_parameters_grid;\r\nGtkWidget *channel_lb;\r\nGtkWidget *channel_offset_lb;\r\nGtkWidget *capture_type_lb;\r\nGtkWidget *channel_cb;\r\nGtkWidget *channel_offset_cb;\r\nGtkWidget *capture_type_cb;\r\nGtkWidget *fcs_ck;\r\nGtkWidget *basic_parameters_fcs_h_box;\r\nGtkWidget *basic_parameters_fcs_filter_lb;\r\nGtkWidget *fcs_filter_cb;\r\nGtkWidget *basic_parameters_frame_lb;\r\nGtkWidget *low_buttons_h_box;\r\nGtkWidget *left_h_button_box;\r\nGtkWidget *right_h_button_box;\r\nGtkWidget *ok_bt;\r\nGtkWidget *apply_bt;\r\nGtkWidget *cancel_bt;\r\nGtkWidget *toolbar;\r\ntoolbar = GTK_WIDGET(data);\r\ngtk_widget_set_sensitive(toolbar,FALSE);\r\nairpcap_if_selected = airpcap_if_active;\r\nairpcap_advanced_w = dlg_window_new("Advanced Wireless Settings");\r\ngtk_window_set_modal(GTK_WINDOW(airpcap_advanced_w), TRUE);\r\ngtk_window_set_transient_for(GTK_WINDOW(airpcap_advanced_w), GTK_WINDOW(gtk_widget_get_toplevel(w)));\r\ngtk_window_set_destroy_with_parent (GTK_WINDOW(airpcap_advanced_w), TRUE);\r\ngtk_container_set_border_width (GTK_CONTAINER (airpcap_advanced_w), 5);\r\ngtk_window_set_position (GTK_WINDOW (airpcap_advanced_w),\r\nGTK_WIN_POS_CENTER);\r\ngtk_window_set_resizable (GTK_WINDOW (airpcap_advanced_w), FALSE);\r\ngtk_window_set_type_hint (GTK_WINDOW (airpcap_advanced_w), GDK_WINDOW_TYPE_HINT_DIALOG);\r\nmain_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (main_box, "main_box");\r\ngtk_widget_show (main_box);\r\ngtk_container_add (GTK_CONTAINER (airpcap_advanced_w), main_box);\r\nsettings_sub_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (settings_sub_box, "settings_sub_box");\r\ngtk_widget_show (settings_sub_box);\r\ngtk_box_pack_start (GTK_BOX (main_box), settings_sub_box, FALSE, TRUE, 0);\r\ninterface_fr = gtk_frame_new (NULL);\r\ngtk_widget_set_name (interface_fr, "interface_fr");\r\ngtk_widget_show (interface_fr);\r\ngtk_box_pack_start (GTK_BOX (settings_sub_box), interface_fr, FALSE, FALSE,\r\n0);\r\ngtk_container_set_border_width (GTK_CONTAINER (interface_fr), 10);\r\ninterface_al = gtk_alignment_new (0.5f, 0.5f, 1, 1);\r\ngtk_widget_set_name (interface_al, "interface_al");\r\ngtk_widget_show (interface_al);\r\ngtk_container_add (GTK_CONTAINER (interface_fr), interface_al);\r\ngtk_alignment_set_padding (GTK_ALIGNMENT (interface_al), 5, 5, 0, 0);\r\ninterface_sub_h_box = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_widget_set_name (interface_sub_h_box, "interface_sub_h_box");\r\ngtk_widget_show (interface_sub_h_box);\r\ngtk_container_add (GTK_CONTAINER (interface_al), interface_sub_h_box);\r\ngtk_container_set_border_width (GTK_CONTAINER (interface_sub_h_box), 5);\r\nif (airpcap_if_active != NULL)\r\n{\r\ninterface_name_lb = gtk_label_new(airpcap_if_active->description);\r\n}\r\nelse\r\n{\r\ninterface_name_lb = gtk_label_new("Couldn't find an airpcap interface.");\r\ngtk_widget_set_sensitive(main_box,FALSE);\r\n}\r\ngtk_widget_set_name (interface_name_lb, "interface_name_lb");\r\ngtk_widget_show (interface_name_lb);\r\ngtk_box_pack_start (GTK_BOX (interface_sub_h_box), interface_name_lb, TRUE,\r\nFALSE, 0);\r\nif (!airpcap_if_is_any(airpcap_if_selected))\r\n{\r\nblink_bt = gtk_button_new_with_mnemonic ("Blink Led");\r\n}\r\nelse\r\n{\r\nblink_bt = gtk_button_new_with_mnemonic ("What's This?");\r\n}\r\ngtk_widget_set_name (blink_bt, "blink_bt");\r\ngtk_widget_show (blink_bt);\r\ngtk_box_pack_end (GTK_BOX (interface_sub_h_box), blink_bt, FALSE, FALSE, 0);\r\ninterface_frame_lb = gtk_label_new ("<b>Interface</b>");\r\ngtk_widget_set_name (interface_frame_lb, "interface_frame_lb");\r\ngtk_widget_show (interface_frame_lb);\r\ngtk_frame_set_label_widget (GTK_FRAME (interface_fr), interface_frame_lb);\r\ngtk_label_set_use_markup (GTK_LABEL (interface_frame_lb), TRUE);\r\nbasic_parameters_fr = gtk_frame_new (NULL);\r\ngtk_widget_set_name (basic_parameters_fr, "basic_parameters_fr");\r\ngtk_widget_show (basic_parameters_fr);\r\ngtk_box_pack_start (GTK_BOX (settings_sub_box), basic_parameters_fr, TRUE,FALSE, 0);\r\ngtk_container_set_border_width (GTK_CONTAINER (basic_parameters_fr), 10);\r\nbasic_parameters_al = gtk_alignment_new (0.5f, 0.5f, 1, 1);\r\ngtk_widget_set_name (basic_parameters_al, "basic_parameters_al");\r\ngtk_widget_show (basic_parameters_al);\r\ngtk_container_add (GTK_CONTAINER (basic_parameters_fr),basic_parameters_al);\r\ngtk_alignment_set_padding (GTK_ALIGNMENT (basic_parameters_al), 10, 10, 0, 0);\r\nbasic_parameters_grid = ws_gtk_grid_new ();\r\ngtk_widget_set_name (basic_parameters_grid, "basic_parameters_grid");\r\ngtk_widget_show (basic_parameters_grid);\r\ngtk_container_add (GTK_CONTAINER (basic_parameters_al),\r\nbasic_parameters_grid);\r\ngtk_container_set_border_width (GTK_CONTAINER (basic_parameters_grid), 5);\r\nws_gtk_grid_set_column_spacing(GTK_GRID(basic_parameters_grid), 20);\r\nchannel_lb = gtk_label_new ("Channel:");\r\ngtk_widget_set_name (channel_lb, "channel_lb");\r\ngtk_widget_show (channel_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), channel_lb, 0, 0, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (channel_lb), 0, 0.5f);\r\ncapture_type_lb = gtk_label_new ("Capture Type:");\r\ngtk_widget_set_name (capture_type_lb, "capture_type_lb");\r\ngtk_widget_show (capture_type_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), capture_type_lb, 0, 2, 1,\r\n1, (GtkAttachOptions) (GTK_FILL), (GtkAttachOptions) (0),\r\n0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (capture_type_lb), 0, 0.5f);\r\nchannel_offset_lb = gtk_label_new ("Channel Offset:");\r\ngtk_widget_set_name (channel_offset_lb, "channel_offset_lb");\r\ngtk_widget_show (channel_offset_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), channel_offset_lb, 0, 1, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (channel_offset_lb), 0, 0.5f);\r\nchannel_offset_cb = gtk_combo_box_text_new();\r\ngtk_widget_set_name (channel_offset_cb, "channel_offset_cb");\r\nairpcap_update_channel_offset_combo(airpcap_if_selected, airpcap_if_selected->channelInfo.Frequency, channel_offset_cb, FALSE);\r\ngtk_widget_show(channel_offset_cb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), channel_offset_cb, 1, 1, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\nchannel_cb = gtk_combo_box_text_new();\r\ngtk_widget_set_name (channel_cb, "channel_cb");\r\ngtk_widget_show (channel_cb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), channel_cb, 1, 0, 1, 1,\r\n(GtkAttachOptions) (GTK_EXPAND | GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\nairpcap_update_channel_combo(GTK_WIDGET(channel_cb), airpcap_if_selected);\r\ncapture_type_cb = gtk_combo_box_text_new();\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(capture_type_cb), AIRPCAP_LINK_TYPE_NAME_802_11_ONLY);\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(capture_type_cb), AIRPCAP_LINK_TYPE_NAME_802_11_PLUS_RADIO);\r\nif (airpcap_get_dll_state() == AIRPCAP_DLL_OK) {\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(capture_type_cb), AIRPCAP_LINK_TYPE_NAME_802_11_PLUS_PPI);\r\n}\r\ngtk_widget_set_name (capture_type_cb, "capture_type_cb");\r\ngtk_widget_show (capture_type_cb);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), capture_type_cb, 1, 2, 1,\r\n1, (GtkAttachOptions) (GTK_EXPAND | GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\nif (airpcap_if_selected != NULL)\r\n{\r\nif (airpcap_if_selected->linkType == AIRPCAP_LT_802_11_PLUS_RADIO){\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(capture_type_cb), AIRPCAP_LINK_TYPE_NUM_802_11_PLUS_RADIO);\r\n}else if (airpcap_if_selected->linkType == AIRPCAP_LT_802_11_PLUS_PPI){\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(capture_type_cb), AIRPCAP_LINK_TYPE_NUM_802_11_PLUS_PPI);\r\n} else {\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(capture_type_cb), AIRPCAP_LINK_TYPE_NUM_802_11_ONLY);\r\n}\r\n}\r\nfcs_ck = gtk_check_button_new_with_label ("Include 802.11 FCS in Frames");\r\ngtk_widget_set_name (fcs_ck, "fcs_ck");\r\nif (airpcap_if_selected != NULL)\r\n{\r\nif (airpcap_if_selected->IsFcsPresent)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(fcs_ck),TRUE);\r\nelse\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(fcs_ck),FALSE);\r\n}\r\ngtk_widget_show (fcs_ck);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid), fcs_ck, 3, 0, 2, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\nbasic_parameters_fcs_h_box = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 1, FALSE);\r\ngtk_widget_set_name (basic_parameters_fcs_h_box,\r\n"basic_parameters_fcs_h_box");\r\ngtk_widget_show (basic_parameters_fcs_h_box);\r\nws_gtk_grid_attach_extended (GTK_GRID (basic_parameters_grid),\r\nbasic_parameters_fcs_h_box, 3, 2, 2, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (GTK_FILL), 3, 0);\r\nbasic_parameters_fcs_filter_lb = gtk_label_new ("FCS Filter:");\r\ngtk_widget_set_name (basic_parameters_fcs_filter_lb,\r\n"basic_parameters_fcs_filter_lb");\r\ngtk_widget_show (basic_parameters_fcs_filter_lb);\r\ngtk_box_pack_start (GTK_BOX (basic_parameters_fcs_h_box),\r\nbasic_parameters_fcs_filter_lb, FALSE, FALSE, 0);\r\nfcs_filter_cb = gtk_combo_box_text_new();\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(fcs_filter_cb), airpcap_get_validation_name(AIRPCAP_VT_ACCEPT_EVERYTHING));\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(fcs_filter_cb), airpcap_get_validation_name(AIRPCAP_VT_ACCEPT_CORRECT_FRAMES));\r\ngtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT(fcs_filter_cb), airpcap_get_validation_name(AIRPCAP_VT_ACCEPT_CORRUPT_FRAMES));\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(fcs_filter_cb), 0);\r\ngtk_widget_set_name (fcs_filter_cb, "fcs_filter_cb");\r\ngtk_widget_show (fcs_filter_cb);\r\ngtk_box_pack_start (GTK_BOX (basic_parameters_fcs_h_box), fcs_filter_cb,\r\nFALSE, FALSE, 0);\r\ngtk_widget_set_size_request (fcs_filter_cb, 112, -1);\r\nif (airpcap_if_selected != NULL)\r\n{\r\nairpcap_validation_type_combo_set_by_type(fcs_filter_cb, airpcap_if_selected->CrcValidationOn);\r\n}\r\nbasic_parameters_frame_lb = gtk_label_new ("<b>Basic Parameters</b>");\r\ngtk_widget_set_name (basic_parameters_frame_lb,\r\n"basic_parameters_frame_lb");\r\ngtk_widget_show (basic_parameters_frame_lb);\r\ngtk_frame_set_label_widget (GTK_FRAME (basic_parameters_fr),basic_parameters_frame_lb);\r\ngtk_label_set_use_markup (GTK_LABEL (basic_parameters_frame_lb), TRUE);\r\nlow_buttons_h_box = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_widget_set_name (low_buttons_h_box, "low_buttons_h_box");\r\ngtk_widget_show (low_buttons_h_box);\r\ngtk_box_pack_end (GTK_BOX (main_box), low_buttons_h_box, FALSE, FALSE, 0);\r\nleft_h_button_box = gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_set_name (left_h_button_box, "left_h_button_box");\r\ngtk_widget_show (left_h_button_box);\r\ngtk_box_pack_start (GTK_BOX (low_buttons_h_box), left_h_button_box, FALSE,\r\nFALSE, 0);\r\nright_h_button_box = dlg_button_row_new(GTK_STOCK_OK, GTK_STOCK_APPLY, GTK_STOCK_CANCEL, NULL);\r\ngtk_widget_show (right_h_button_box);\r\ngtk_box_pack_end (GTK_BOX (low_buttons_h_box), right_h_button_box, FALSE,\r\nFALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_OK);\r\napply_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_APPLY);\r\ncancel_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_CANCEL);\r\ng_signal_connect (airpcap_advanced_w, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ng_signal_connect (airpcap_advanced_w, "destroy", G_CALLBACK(on_airpcap_advanced_destroy), airpcap_advanced_w);\r\nif (!airpcap_if_is_any(airpcap_if_selected))\r\n{\r\ng_signal_connect (blink_bt, "clicked", G_CALLBACK(on_blink_bt_clicked), NULL);\r\n}\r\nelse\r\n{\r\ng_signal_connect (blink_bt, "clicked", G_CALLBACK(on_what_s_this_bt_clicked), NULL);\r\n}\r\ng_signal_connect (channel_cb, "changed", G_CALLBACK(airpcap_channel_changed_noset_cb), channel_offset_cb);\r\ng_signal_connect (capture_type_cb, "changed", G_CALLBACK(on_capture_type_cb_changed), NULL);\r\ng_signal_connect (fcs_ck, "toggled", G_CALLBACK(on_fcs_ck_toggled), NULL);\r\ng_signal_connect (fcs_filter_cb, "changed", G_CALLBACK(on_fcs_filter_cb_changed), NULL);\r\ng_signal_connect (apply_bt, "clicked", G_CALLBACK(on_advanced_apply_bt_clicked), airpcap_advanced_w);\r\ng_signal_connect (ok_bt,"clicked", G_CALLBACK(on_advanced_ok_bt_clicked), airpcap_advanced_w);\r\ng_signal_connect (cancel_bt,"clicked", G_CALLBACK(on_advanced_cancel_bt_clicked), airpcap_advanced_w);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_BLINK_KEY, blink_bt);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_CHANNEL_KEY,channel_cb);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_CHANNEL_OFFSET_KEY, channel_offset_cb);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_LINK_TYPE_KEY,capture_type_cb);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_FCS_CHECK_KEY, fcs_ck);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_FCS_FILTER_KEY, fcs_filter_cb);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_OK_KEY, ok_bt);\r\ng_object_set_data (G_OBJECT(airpcap_advanced_w), AIRPCAP_ADVANCED_CANCEL_KEY, cancel_bt);\r\ng_object_set_data(G_OBJECT(airpcap_advanced_w),AIRPCAP_TOOLBAR_KEY,toolbar);\r\ngtk_widget_show (airpcap_advanced_w);\r\n}\r\nstatic void\r\non_key_management_ok_bt_clicked(GtkWidget *button, gpointer data)\r\n{\r\nGtkWidget *key_management_w;\r\nkey_management_w = GTK_WIDGET(data);\r\non_key_management_apply_bt_clicked(button, data);\r\ngtk_widget_destroy(key_management_w);\r\n}\r\nstatic void\r\non_key_management_cancel_bt_clicked(GtkWidget *button _U_, gpointer data)\r\n{\r\nGtkWidget *key_management_w;\r\nkey_management_w = GTK_WIDGET(data);\r\ngtk_widget_destroy(key_management_w);\r\n}\r\nvoid\r\ndisplay_airpcap_key_management_cb(GtkWidget *w _U_, gpointer data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *main_box;\r\nGtkWidget *keys_fr;\r\nGtkWidget *keys_al;\r\nGtkWidget *keys_h_sub_box;\r\nGtkWidget *decryption_mode_grid;\r\nGtkWidget *decryption_mode_lb;\r\nGtkWidget *decryption_mode_cb;\r\nGtkWidget *keys_v_sub_box;\r\nGtkWidget *keys_scrolled_w;\r\nGtkListStore *key_list_store;\r\nGtkWidget *key_list;\r\nGtkWidget *key_v_button_box;\r\nGtkWidget *add_new_key_bt;\r\nGtkWidget *remove_key_bt;\r\nGtkWidget *edit_key_bt;\r\nGtkWidget *move_key_up_bt;\r\nGtkWidget *move_key_down_bt;\r\nGtkWidget *keys_frame_lb;\r\nGtkWidget *low_buttons_h_box;\r\nGtkWidget *left_h_button_box;\r\nGtkWidget *right_h_button_box;\r\nGtkWidget *ok_bt;\r\nGtkWidget *apply_bt;\r\nGtkWidget *cancel_bt;\r\nGtkWidget *toolbar,\r\n*toolbar_decryption_ck;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeSelection *selection;\r\nGtkTreeIter iter;\r\ntoolbar = GTK_WIDGET(data);\r\ntoolbar_decryption_ck = GTK_WIDGET(g_object_get_data(G_OBJECT(toolbar),AIRPCAP_TOOLBAR_DECRYPTION_KEY));\r\ngtk_widget_set_sensitive(toolbar,FALSE);\r\nairpcap_if_selected = airpcap_if_active;\r\nkey_management_w = dlg_window_new("Decryption Key Management");\r\ngtk_window_set_destroy_with_parent(GTK_WINDOW(key_management_w), TRUE);\r\ngtk_window_set_modal(GTK_WINDOW(key_management_w), TRUE);\r\ngtk_container_set_border_width (GTK_CONTAINER (key_management_w), 5);\r\ngtk_window_set_position (GTK_WINDOW (key_management_w),\r\nGTK_WIN_POS_CENTER);\r\ngtk_window_set_resizable (GTK_WINDOW (key_management_w), FALSE);\r\ngtk_window_set_type_hint (GTK_WINDOW (key_management_w), GDK_WINDOW_TYPE_HINT_DIALOG);\r\nmain_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (main_box, "main_box");\r\ngtk_widget_show (main_box);\r\ngtk_container_add (GTK_CONTAINER (key_management_w), main_box);\r\nkeys_fr = gtk_frame_new (NULL);\r\ngtk_widget_set_name (keys_fr, "keys_fr");\r\ngtk_widget_show (keys_fr);\r\ngtk_box_pack_start (GTK_BOX (main_box), keys_fr, FALSE, FALSE, 0);\r\ngtk_container_set_border_width (GTK_CONTAINER (keys_fr), 10);\r\nkeys_al = gtk_alignment_new (0.5f, 0.5f, 1, 1);\r\ngtk_widget_set_name (keys_al, "keys_al");\r\ngtk_widget_show (keys_al);\r\ngtk_container_add (GTK_CONTAINER (keys_fr), keys_al);\r\ngtk_container_set_border_width (GTK_CONTAINER (keys_al), 5);\r\ngtk_alignment_set_padding (GTK_ALIGNMENT (keys_al), 0, 0, 12, 0);\r\nkeys_h_sub_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (keys_h_sub_box, "keys_h_sub_box");\r\ngtk_widget_show (keys_h_sub_box);\r\ngtk_container_add (GTK_CONTAINER (keys_al), keys_h_sub_box);\r\ndecryption_mode_grid = ws_gtk_grid_new ();\r\ngtk_widget_set_name (decryption_mode_grid, "decryption_mode_grid");\r\ngtk_widget_show (decryption_mode_grid);\r\ngtk_box_pack_start (GTK_BOX (keys_h_sub_box), decryption_mode_grid, FALSE,\r\nFALSE, 0);\r\nws_gtk_grid_set_row_spacing(GTK_GRID(decryption_mode_grid), 6);\r\ndecryption_mode_lb = gtk_label_new ("Select Decryption Mode");\r\ngtk_widget_set_name (decryption_mode_lb, "decryption_mode_lb");\r\ngtk_widget_show (decryption_mode_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (decryption_mode_grid), decryption_mode_lb, 1,\r\n0, 1, 1, (GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (decryption_mode_lb), 0, 0.5f);\r\ndecryption_mode_cb = gtk_combo_box_text_new();\r\nupdate_decryption_mode_list(decryption_mode_cb);\r\ngtk_widget_set_name (decryption_mode_cb, "decryption_mode_cb");\r\ngtk_widget_show (decryption_mode_cb);\r\nws_gtk_grid_attach_extended (GTK_GRID (decryption_mode_grid), decryption_mode_cb, 0,\r\n0, 1, 1, (GtkAttachOptions) (0), (GtkAttachOptions) (0),\r\n0, 0);\r\ngtk_widget_set_size_request (decryption_mode_cb, 83, -1);\r\nupdate_decryption_mode(decryption_mode_cb);\r\nkeys_v_sub_box = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_widget_set_name (keys_v_sub_box, "keys_v_sub_box");\r\ngtk_widget_show (keys_v_sub_box);\r\ngtk_box_pack_start (GTK_BOX (keys_h_sub_box), keys_v_sub_box, TRUE, TRUE, 0);\r\nkeys_scrolled_w = gtk_scrolled_window_new (NULL, NULL);\r\ngtk_widget_set_name (keys_scrolled_w, "keys_scrolled_w");\r\ngtk_widget_show (keys_scrolled_w);\r\ngtk_box_pack_start (GTK_BOX (keys_v_sub_box), keys_scrolled_w, TRUE, TRUE,\r\n0);\r\ngtk_scrolled_window_set_policy (GTK_SCROLLED_WINDOW (keys_scrolled_w), GTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC);\r\nkey_list_store = gtk_list_store_new(KL_NUM_COLS,\r\nG_TYPE_STRING,\r\nG_TYPE_STRING\r\n, G_TYPE_STRING\r\n);\r\nkey_list = gtk_tree_view_new_with_model(GTK_TREE_MODEL(key_list_store));\r\ngtk_tree_view_set_fixed_height_mode(GTK_TREE_VIEW(key_list), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(key_list), FALSE);\r\ng_object_unref(G_OBJECT(key_list_store));\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Type", renderer,\r\n"text", KL_COL_TYPE, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, KL_COL_TYPE);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 60);\r\ngtk_tree_view_column_set_fixed_width(column, 100);\r\ngtk_tree_view_append_column(GTK_TREE_VIEW(key_list), column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Key", renderer,\r\n"text", KL_COL_KEY, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, KL_COL_KEY);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_column_set_fixed_width(column, 200);\r\ngtk_tree_view_append_column(GTK_TREE_VIEW(key_list), column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("SSID", renderer,\r\n"text", KL_COL_SSID,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, KL_COL_SSID);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_column_set_fixed_width(column, 150);\r\ngtk_tree_view_append_column(GTK_TREE_VIEW(key_list), column);\r\ngtk_tree_view_set_rules_hint(GTK_TREE_VIEW(key_list), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(key_list), TRUE);\r\nselection = gtk_tree_view_get_selection(GTK_TREE_VIEW(key_list));\r\ngtk_tree_selection_set_mode(selection, GTK_SELECTION_SINGLE);\r\ngtk_widget_show (key_list);\r\ngtk_container_add (GTK_CONTAINER (keys_scrolled_w), key_list);\r\nkey_v_button_box = gtk_button_box_new (GTK_ORIENTATION_VERTICAL);\r\ngtk_widget_set_name (key_v_button_box, "key_v_button_box");\r\ngtk_widget_show (key_v_button_box);\r\ngtk_box_pack_start (GTK_BOX (keys_v_sub_box), key_v_button_box, FALSE, TRUE,\r\n0);\r\nadd_new_key_bt = ws_gtk_button_new_from_stock(GTK_STOCK_NEW);\r\ngtk_widget_set_name (add_new_key_bt, "add_new_key_bt");\r\ngtk_widget_show (add_new_key_bt);\r\ngtk_container_add (GTK_CONTAINER (key_v_button_box), add_new_key_bt);\r\ngtk_widget_set_can_default (add_new_key_bt, TRUE);\r\nedit_key_bt = ws_gtk_button_new_from_stock(WIRESHARK_STOCK_EDIT);\r\ngtk_widget_set_name (edit_key_bt, "edit_key_bt");\r\ngtk_widget_show (edit_key_bt);\r\ngtk_container_add (GTK_CONTAINER (key_v_button_box), edit_key_bt);\r\ngtk_widget_set_can_default (edit_key_bt, TRUE);\r\nremove_key_bt = ws_gtk_button_new_from_stock(GTK_STOCK_DELETE);\r\ngtk_widget_set_name (remove_key_bt, "remove_key_bt");\r\ngtk_widget_show (remove_key_bt);\r\ngtk_container_add (GTK_CONTAINER (key_v_button_box), remove_key_bt);\r\ngtk_widget_set_can_default (remove_key_bt, TRUE);\r\nmove_key_up_bt = ws_gtk_button_new_from_stock(GTK_STOCK_GO_UP);\r\ngtk_widget_set_name (move_key_up_bt, "move_key_up_bt");\r\ngtk_widget_show (move_key_up_bt);\r\ngtk_container_add (GTK_CONTAINER (key_v_button_box), move_key_up_bt);\r\ngtk_widget_set_can_default (move_key_up_bt, TRUE);\r\nmove_key_down_bt = ws_gtk_button_new_from_stock(GTK_STOCK_GO_DOWN);\r\ngtk_widget_set_name (move_key_down_bt, "move_key_down_bt");\r\ngtk_widget_show (move_key_down_bt);\r\ngtk_container_add (GTK_CONTAINER (key_v_button_box), move_key_down_bt);\r\ngtk_widget_set_can_default (move_key_down_bt, TRUE);\r\nkeys_frame_lb = gtk_label_new ("<b>Decryption Keys</b>");\r\ngtk_widget_set_name (keys_frame_lb, "keys_frame_lb");\r\ngtk_widget_show (keys_frame_lb);\r\ngtk_frame_set_label_widget (GTK_FRAME (keys_fr), keys_frame_lb);\r\ngtk_label_set_use_markup (GTK_LABEL (keys_frame_lb), TRUE);\r\nlow_buttons_h_box = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0, FALSE);\r\ngtk_widget_set_name (low_buttons_h_box, "low_buttons_h_box");\r\ngtk_widget_show (low_buttons_h_box);\r\ngtk_box_pack_end (GTK_BOX (main_box), low_buttons_h_box, FALSE, FALSE, 0);\r\nleft_h_button_box = gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_set_name (left_h_button_box, "left_h_button_box");\r\ngtk_widget_show (left_h_button_box);\r\ngtk_box_pack_start (GTK_BOX (low_buttons_h_box), left_h_button_box, FALSE,\r\nFALSE, 0);\r\nright_h_button_box = dlg_button_row_new(GTK_STOCK_OK, GTK_STOCK_APPLY, GTK_STOCK_CANCEL, NULL);\r\ngtk_widget_set_name (right_h_button_box, "right_h_button_box");\r\ngtk_widget_show (right_h_button_box);\r\ngtk_box_pack_end (GTK_BOX (low_buttons_h_box), right_h_button_box, FALSE,\r\nFALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_OK);\r\napply_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_APPLY);\r\ncancel_bt = (GtkWidget *)g_object_get_data(G_OBJECT(right_h_button_box), GTK_STOCK_CANCEL);\r\ng_signal_connect (key_management_w, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ng_signal_connect (key_management_w, "destroy", G_CALLBACK(on_key_management_destroy), key_management_w);\r\ng_signal_connect (add_new_key_bt, "clicked", G_CALLBACK(on_add_new_key_bt_clicked), key_management_w);\r\ng_signal_connect (remove_key_bt, "clicked", G_CALLBACK(on_remove_key_bt_clicked), key_management_w);\r\ng_signal_connect (edit_key_bt, "clicked", G_CALLBACK(on_edit_key_bt_clicked), key_management_w);\r\ng_signal_connect (move_key_up_bt, "clicked", G_CALLBACK(on_move_key_up_bt_clicked), key_list);\r\ng_signal_connect (move_key_down_bt, "clicked", G_CALLBACK(on_move_key_down_bt_clicked), key_list);\r\ng_signal_connect (apply_bt, "clicked", G_CALLBACK(on_key_management_apply_bt_clicked), key_management_w);\r\ng_signal_connect (ok_bt, "clicked", G_CALLBACK(on_key_management_ok_bt_clicked), key_management_w);\r\ng_signal_connect (cancel_bt, "clicked", G_CALLBACK(on_key_management_cancel_bt_clicked), key_management_w);\r\ng_signal_connect (selection, "changed", G_CALLBACK(on_key_list_select_row), key_management_w);\r\ng_signal_connect (key_list_store, "rows_reordered", G_CALLBACK(on_key_list_reorder), key_management_w);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_ADVANCED_EDIT_KEY_SELECTION_KEY,selection);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_ADVANCED_DECRYPTION_MODE_KEY, decryption_mode_cb);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_ADVANCED_KEYLIST_KEY, key_list_store);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_ADVANCED_OK_KEY, ok_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_ADVANCED_CANCEL_KEY, cancel_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_KEY_MGMT_NEW_KEY, add_new_key_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_KEY_MGMT_EDIT_KEY, edit_key_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_KEY_MGMT_DELETE_KEY, remove_key_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_KEY_MGMT_UP_KEY, move_key_up_bt);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_KEY_MGMT_DOWN_KEY, move_key_down_bt);\r\ng_object_set_data(G_OBJECT(key_management_w),AIRPCAP_TOOLBAR_KEY,toolbar);\r\ng_object_set_data (G_OBJECT(key_management_w), AIRPCAP_TOOLBAR_DECRYPTION_KEY, toolbar_decryption_ck);\r\nif (!airpcap_check_decryption_keys(g_airpcap_if_list))\r\n{\r\nairpcap_keys_check_w(key_management_w,NULL);\r\n}\r\nelse\r\n{\r\nairpcap_load_decryption_keys(g_airpcap_if_list);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\nif(gtk_tree_model_get_iter_first(GTK_TREE_MODEL(key_list_store), &iter))\r\n{\r\ngtk_tree_selection_select_iter(selection, &iter);\r\n}\r\n}\r\nstatic void\r\non_keys_check_cancel_bt_clicked (GtkWidget *button _U_, gpointer user_data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *keys_check_w;\r\nGtkListStore *key_list_store;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nkey_management_w = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY);\r\nif (key_management_w != NULL)\r\n{\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\ngtk_widget_destroy(keys_check_w);\r\n}\r\nstatic void\r\non_merge_bt_clicked (GtkWidget* button _U_, gpointer user_data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *keys_check_w;\r\nGtkListStore *key_list_store;\r\nguint n_adapters = 0;\r\nguint i = 0;\r\nGList* wireshark_keys=NULL;\r\nGList* driver_keys=NULL;\r\nGList* current_adapter_keys=NULL;\r\nGList* merged_list = NULL;\r\nGList* merged_list_tmp = NULL;\r\nairpcap_if_info_t* curr_adapter;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nkey_management_w = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY);\r\nn_adapters = g_list_length(g_airpcap_if_list);\r\nwireshark_keys = get_wireshark_keys();\r\nmerged_list = merge_key_list(wireshark_keys,NULL);\r\ndriver_keys = get_airpcap_driver_keys();\r\nmerged_list = merge_key_list(merged_list,driver_keys);\r\nfor (i = 0; i<n_adapters; i++)\r\n{\r\ncurr_adapter = (airpcap_if_info_t*)g_list_nth_data(g_airpcap_if_list,i);\r\ncurrent_adapter_keys = get_airpcap_device_keys(curr_adapter);\r\nmerged_list_tmp = merged_list;\r\nmerged_list = merge_key_list(merged_list_tmp,current_adapter_keys);\r\nfree_key_list(merged_list_tmp);\r\n}\r\nairpcap_save_decryption_keys(merged_list,g_airpcap_if_list);\r\nfree_key_list(wireshark_keys);\r\nfree_key_list(driver_keys);\r\ngtk_widget_destroy(keys_check_w);\r\nif (key_management_w != NULL)\r\n{\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\n}\r\nstatic void\r\non_keep_bt_clicked (GtkWidget *button _U_, gpointer user_data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *keys_check_w;\r\nGtkListStore *key_list_store=NULL;\r\nGList* wireshark_keys=NULL;\r\nGList* merged_keys=NULL;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nkey_management_w = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY);\r\nwireshark_keys = get_wireshark_keys();\r\nmerged_keys = merge_key_list(wireshark_keys,NULL);\r\nairpcap_save_decryption_keys(merged_keys,g_airpcap_if_list);\r\nfree_key_list(wireshark_keys);\r\ngtk_widget_destroy(keys_check_w);\r\nif (key_management_w != NULL)\r\n{\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\n}\r\nstatic void\r\non_import_bt_clicked (GtkWidget* button _U_, gpointer user_data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *keys_check_w;\r\nGtkListStore *key_list_store;\r\nguint n_adapters = 0;\r\nguint i = 0;\r\nGList* wireshark_keys=NULL;\r\nGList* driver_keys=NULL;\r\nGList* current_adapter_keys=NULL;\r\nGList* merged_list = NULL;\r\nGList* merged_list_tmp = NULL;\r\nairpcap_if_info_t* curr_adapter;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nkey_management_w = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY);\r\nn_adapters = g_list_length(g_airpcap_if_list);\r\nwireshark_keys = get_wireshark_keys();\r\ndriver_keys = get_airpcap_driver_keys();\r\nmerged_list = merge_key_list(merged_list,driver_keys);\r\nfor (i = 0; i<n_adapters; i++)\r\n{\r\ncurr_adapter = (airpcap_if_info_t*)g_list_nth_data(g_airpcap_if_list,i);\r\ncurrent_adapter_keys = get_airpcap_device_keys(curr_adapter);\r\nmerged_list_tmp = merged_list;\r\nmerged_list = merge_key_list(merged_list_tmp,current_adapter_keys);\r\nfree_key_list(merged_list_tmp);\r\n}\r\nairpcap_save_decryption_keys(merged_list,g_airpcap_if_list);\r\nfree_key_list(wireshark_keys);\r\nfree_key_list(driver_keys);\r\ngtk_widget_destroy(keys_check_w);\r\nif (key_management_w != NULL)\r\n{\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\n}\r\nstatic void\r\non_ignore_bt_clicked (GtkWidget* button _U_, gpointer user_data)\r\n{\r\nGtkWidget *key_management_w;\r\nGtkWidget *keys_check_w;\r\nGtkListStore *key_list_store;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nkey_management_w = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY);\r\nif (key_management_w != NULL)\r\n{\r\nkey_list_store = (GtkListStore *)g_object_get_data(G_OBJECT(key_management_w),AIRPCAP_ADVANCED_KEYLIST_KEY);\r\nairpcap_fill_key_list(key_list_store);\r\ngtk_widget_show (key_management_w);\r\n}\r\ngtk_widget_destroy(keys_check_w);\r\n}\r\nstatic void\r\non_keys_check_ok_bt_clicked (GtkWidget *button _U_, gpointer user_data)\r\n{\r\nGtkWidget *keys_check_w;\r\nGtkWidget *merge_rb,\r\n*keep_rb,\r\n*import_rb,\r\n*ignore_rb;\r\nkeys_check_w = GTK_WIDGET(user_data);\r\nmerge_rb = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_MERGE_KEY);\r\nkeep_rb = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_KEEP_KEY);\r\nimport_rb = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_IMPORT_KEY);\r\nignore_rb = (GtkWidget *)g_object_get_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_IGNORE_KEY);\r\nif (gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(merge_rb)))\r\non_merge_bt_clicked (merge_rb,keys_check_w);\r\nelse if (gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON(keep_rb)))\r\non_keep_bt_clicked (keep_rb,keys_check_w);\r\nelse if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(import_rb)))\r\non_import_bt_clicked (import_rb,keys_check_w);\r\nelse if (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(ignore_rb)))\r\non_ignore_bt_clicked (ignore_rb,keys_check_w);\r\nelse on_keys_check_cancel_bt_clicked(NULL,keys_check_w);\r\n}\r\nstatic void\r\non_keys_check_w_destroy (GtkWidget *w _U_, gpointer user_data)\r\n{\r\ngtk_widget_set_sensitive(top_level,TRUE);\r\ngtk_widget_set_sensitive(GTK_WIDGET(user_data),TRUE);\r\n}\r\nvoid\r\nairpcap_keys_check_w(GtkWidget *w, gpointer data _U_)\r\n{\r\nGtkWidget *keys_check_w;\r\nGtkWidget *main_v_box;\r\nGtkWidget *warning_lb;\r\nGtkWidget *radio_grid;\r\nGtkWidget *keep_rb;\r\nGSList *radio_bt_group = NULL;\r\nGtkWidget *merge_rb;\r\nGtkWidget *import_rb;\r\nGtkWidget *ignore_rb;\r\nGtkWidget *keep_lb;\r\nGtkWidget *merge_lb;\r\nGtkWidget *import_lb;\r\nGtkWidget *ignore_lb;\r\nGtkWidget *low_h_button_box;\r\nGtkWidget *ok_bt;\r\nGtkWidget *cancel_bt;\r\nkeys_check_w = window_new (GTK_WINDOW_TOPLEVEL, "Decryption Key Warning");\r\ngtk_widget_set_name (keys_check_w, "keys_check_w");\r\ngtk_window_set_resizable (GTK_WINDOW (keys_check_w), FALSE);\r\nmain_v_box = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 0, FALSE);\r\ngtk_widget_set_name (main_v_box, "main_v_box");\r\ngtk_widget_show (main_v_box);\r\ngtk_container_add (GTK_CONTAINER (keys_check_w), main_v_box);\r\nwarning_lb = gtk_label_new("<b>WARNING!</b> Decryption keys specified in Wireshark's preferences file differ from those specified for the AirPcap adapter(s). You can choose to:");\r\ngtk_label_set_use_markup (GTK_LABEL (warning_lb), TRUE);\r\ngtk_widget_set_name (warning_lb, "warning_lb");\r\ngtk_widget_show (warning_lb);\r\ngtk_box_pack_start (GTK_BOX (main_v_box), warning_lb, FALSE, FALSE, 0);\r\ngtk_label_set_justify (GTK_LABEL (warning_lb), GTK_JUSTIFY_CENTER);\r\ngtk_label_set_line_wrap (GTK_LABEL (warning_lb), TRUE);\r\nradio_grid = ws_gtk_grid_new();\r\ngtk_widget_set_name (radio_grid, "radio_grid");\r\ngtk_widget_show (radio_grid);\r\ngtk_box_pack_start (GTK_BOX (main_v_box), radio_grid, TRUE, FALSE, 0);\r\ngtk_container_set_border_width (GTK_CONTAINER (radio_grid), 5);\r\nws_gtk_grid_set_column_spacing (GTK_GRID (radio_grid), 8);\r\nkeep_rb = gtk_radio_button_new_with_mnemonic (NULL, "Keep");\r\ngtk_widget_set_name (keep_rb, "keep_rb");\r\ngtk_widget_show (keep_rb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), keep_rb, 0, 0, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_radio_button_set_group (GTK_RADIO_BUTTON (keep_rb), radio_bt_group);\r\nradio_bt_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (keep_rb));\r\nmerge_rb = gtk_radio_button_new_with_mnemonic (NULL, "Merge");\r\ngtk_widget_set_name (merge_rb, "merge_rb");\r\ngtk_widget_show (merge_rb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), merge_rb, 0, 1, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_radio_button_set_group (GTK_RADIO_BUTTON (merge_rb), radio_bt_group);\r\nradio_bt_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (merge_rb));\r\nimport_rb = gtk_radio_button_new_with_mnemonic (NULL, "Import");\r\ngtk_widget_set_name (import_rb, "import_rb");\r\ngtk_widget_show (import_rb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), import_rb, 0, 2, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_radio_button_set_group (GTK_RADIO_BUTTON (import_rb), radio_bt_group);\r\nradio_bt_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (import_rb));\r\nignore_rb = gtk_radio_button_new_with_mnemonic (NULL, "Ignore");\r\ngtk_widget_set_name (ignore_rb, "ignore_rb");\r\ngtk_widget_show (ignore_rb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), ignore_rb, 0, 3, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_radio_button_set_group (GTK_RADIO_BUTTON (ignore_rb), radio_bt_group);\r\nradio_bt_group = gtk_radio_button_get_group (GTK_RADIO_BUTTON (ignore_rb));\r\nkeep_lb =\r\ngtk_label_new\r\n("Use Wireshark keys, thus overwriting AirPcap adapter(s) ones.");\r\ngtk_widget_set_name (keep_lb, "keep_lb");\r\ngtk_widget_show (keep_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), keep_lb, 1, 0, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (keep_lb), 0, 0.5f);\r\nmerge_lb = gtk_label_new ("Merge Wireshark and AirPcap adapter(s) keys.");\r\ngtk_widget_set_name (merge_lb, "merge_lb");\r\ngtk_widget_show (merge_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), merge_lb, 1, 1, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (merge_lb), 0, 0.5f);\r\nimport_lb =\r\ngtk_label_new\r\n("Use AirPcap adapter(s) keys, thus overwriting Wireshark ones.");\r\ngtk_widget_set_name (import_lb, "import_lb");\r\ngtk_widget_show (import_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), import_lb, 1, 2, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_misc_set_alignment (GTK_MISC (import_lb), 0, 0.5f);\r\nignore_lb =\r\ngtk_label_new\r\n("Keep using different set of keys. Remember that in this case, this dialog box will appear whenever you will attempt to modify/add/remove decryption keys.");\r\ngtk_widget_set_name (ignore_lb, "ignore_lb");\r\ngtk_widget_show (ignore_lb);\r\nws_gtk_grid_attach_extended (GTK_GRID (radio_grid), ignore_lb, 1, 3, 1, 1,\r\n(GtkAttachOptions) (GTK_FILL),\r\n(GtkAttachOptions) (0), 0, 0);\r\ngtk_label_set_line_wrap (GTK_LABEL (ignore_lb), TRUE);\r\ngtk_misc_set_alignment (GTK_MISC (ignore_lb), 0, 0.5f);\r\nlow_h_button_box = gtk_button_box_new (GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_set_name (low_h_button_box, "low_h_button_box");\r\ngtk_widget_show (low_h_button_box);\r\ngtk_box_pack_start (GTK_BOX (main_v_box), low_h_button_box, FALSE, FALSE,\r\n0);\r\ngtk_button_box_set_layout (GTK_BUTTON_BOX (low_h_button_box),\r\nGTK_BUTTONBOX_SPREAD);\r\nok_bt = gtk_button_new_with_mnemonic ("OK");\r\ngtk_widget_set_name (ok_bt, "ok_bt");\r\ngtk_widget_show (ok_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), ok_bt);\r\ngtk_widget_set_can_default (ok_bt, TRUE);\r\ncancel_bt = gtk_button_new_with_mnemonic ("Cancel");\r\ngtk_widget_set_name (cancel_bt, "cancel_bt");\r\ngtk_widget_show (cancel_bt);\r\ngtk_container_add (GTK_CONTAINER (low_h_button_box), cancel_bt);\r\ngtk_widget_set_can_default (cancel_bt, TRUE);\r\ng_signal_connect (ok_bt, "clicked", G_CALLBACK(on_keys_check_ok_bt_clicked), keys_check_w);\r\ng_signal_connect (cancel_bt, "clicked", G_CALLBACK(on_keys_check_cancel_bt_clicked), keys_check_w);\r\ng_signal_connect (keys_check_w, "destroy", G_CALLBACK(on_keys_check_w_destroy), keys_check_w);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_KEY,w);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_MERGE_KEY,merge_rb);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_KEEP_KEY,keep_rb);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_IMPORT_KEY,import_rb);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_IGNORE_KEY,ignore_rb);\r\ng_object_set_data(G_OBJECT(keys_check_w),AIRPCAP_CHECK_WINDOW_RADIO_GROUP_KEY,radio_bt_group);\r\ngtk_widget_set_sensitive(top_level,FALSE);\r\ngtk_widget_show(keys_check_w);\r\n}
