static void adjust_menus(void) {\r\nif(history_current) {\r\nmain_set_for_packet_history(\r\n(g_list_previous(history_current) != NULL),\r\n(g_list_next(history_current) != NULL));\r\n} else {\r\nmain_set_for_packet_history(FALSE, FALSE);\r\n}\r\n}\r\nstatic void clear_list(GList *current) {\r\nGList *next_packet;\r\nwhile(current) {\r\nnext_packet = g_list_next(current);\r\nhistory_list = g_list_remove(history_list, current->data);\r\ncurrent = next_packet;\r\n}\r\n}\r\nvoid packet_history_add(gint row) {\r\nif(row < 1) {\r\nreturn;\r\n}\r\nif(ignore_jump) {\r\nreturn;\r\n}\r\nif (history_current) {\r\nclear_list(g_list_next(history_current));\r\nif(GPOINTER_TO_INT(history_current->data) == row) {\r\nadjust_menus();\r\nreturn;\r\n}\r\n}\r\nhistory_list = g_list_append(history_list, GINT_TO_POINTER(row));\r\nhistory_current = g_list_last(history_list);\r\nadjust_menus();\r\n}\r\nvoid packet_history_clear(void) {\r\nclear_list(history_list);\r\nhistory_current = NULL;\r\npacket_history_add(0);\r\nadjust_menus();\r\n}\r\nstatic void packet_history_back(void) {\r\nGList *previous;\r\nif(history_current) {\r\nprevious = g_list_previous(history_current);\r\nif(previous) {\r\nhistory_current = previous;\r\nignore_jump = TRUE;\r\ncf_goto_frame(&cfile, GPOINTER_TO_INT(previous->data));\r\nignore_jump = FALSE;\r\n}\r\n}\r\nadjust_menus();\r\n}\r\nstatic void packet_history_forward(void) {\r\nGList *next;\r\nif(history_current) {\r\nnext = g_list_next(history_current);\r\nif(next) {\r\nhistory_current = next;\r\nignore_jump = TRUE;\r\ncf_goto_frame(&cfile, GPOINTER_TO_INT(next->data));\r\nignore_jump = FALSE;\r\n}\r\n}\r\nadjust_menus();\r\n}\r\nvoid history_forward_cb(GtkWidget *widget _U_, gpointer data _U_) {\r\npacket_history_forward();\r\n}\r\nvoid history_back_cb(GtkWidget *widget _U_, gpointer data _U_) {\r\npacket_history_back();\r\n}
