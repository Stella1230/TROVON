static int\r\ndissect_remact_remote_activation_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 u32ClientImpLevel;\r\nguint32 u32Mode;\r\nguint32 u32Interfaces;\r\nguint32 u32Pointer;\r\nguint32 u32ArraySize;\r\nguint32 u32ItemIdx;\r\nguint16 u16ProtSeqs;\r\ne_guid_t clsid;\r\ne_guid_t iid;\r\ngchar szObjName[1000] = { 0 };\r\nguint32 u32ObjNameLen = sizeof(szObjName);\r\noffset = dissect_dcom_this(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_dcom_append_UUID(tvb, offset, pinfo, tree, di, drep,\r\nhf_dcom_clsid, -1, &clsid);\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_BSTR(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_object_name, szObjName, u32ObjNameLen);\r\n}\r\noffset = dissect_dcom_PMInterfacePointer(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_object_storage, NULL );\r\noffset = dissect_dcom_DWORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_client_impl_level, &u32ClientImpLevel);\r\noffset = dissect_dcom_DWORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_mode, &u32Mode);\r\noffset = dissect_dcom_DWORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_interfaces, &u32Interfaces);\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nu32ItemIdx = 1;\r\nwhile (u32Interfaces--) {\r\noffset = dissect_dcom_append_UUID(tvb, offset, pinfo, tree, di, drep,\r\nhf_dcom_iid, u32ItemIdx, &iid);\r\nu32ItemIdx++;\r\n}\r\n}\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_requested_protseqs, &u16ProtSeqs);\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nu32ItemIdx = 1;\r\nwhile (u32ArraySize--) {\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_protseqs, &u16ProtSeqs);\r\nu32ItemIdx++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_remact_remote_activation_resp(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 u32Pointer;\r\ne_guid_t ipid;\r\nguint32 u32AuthnHint;\r\nguint16 u16VersionMajor;\r\nguint16 u16VersionMinor;\r\nguint32 u32HResult;\r\nguint32 u32ArraySize;\r\nguint32 u32Idx;\r\nguint32 u32VariableOffset;\r\noffset = dissect_dcom_that(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_dcom_oxid, NULL);\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\noffset = dissect_dcom_DUALSTRINGARRAY(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_oxid_bindings, NULL);\r\n}\r\noffset = dissect_dcom_UUID(tvb, offset, pinfo, tree, di, drep,\r\nhf_dcom_ipid, &ipid);\r\noffset = dissect_dcom_DWORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_remact_authn_hint, &u32AuthnHint);\r\noffset = dissect_dcom_COMVERSION(tvb, offset, pinfo, tree, di, drep,\r\n&u16VersionMajor, &u16VersionMinor);\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nu32VariableOffset = offset + u32ArraySize * 4;\r\nwhile (u32ArraySize--) {\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\nu32VariableOffset = dissect_dcom_MInterfacePointer(tvb, u32VariableOffset, pinfo, tree, di, drep,\r\nhf_remact_interface_data, NULL );\r\n}\r\n}\r\noffset = u32VariableOffset;\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nu32Idx = 1;\r\nwhile (u32ArraySize--) {\r\noffset = dissect_dcom_indexed_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult, u32Idx);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " %s[%u]",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)"),\r\nu32Idx);\r\nu32Idx++;\r\n}\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)"));\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_remact (void)\r\n{\r\nstatic hf_register_info hf_remact[] = {\r\n{ &hf_remact_opnum,\r\n{ "Operation", "remact.opnum", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_requested_protseqs,\r\n{ "RequestedProtSeqs", "remact.req_prot_seqs", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_protseqs,\r\n{ "ProtSeqs", "remact.prot_seqs", FT_UINT16, BASE_DEC, VALS(dcom_protseq_vals), 0x0, NULL, HFILL }},\r\n{ &hf_remact_interfaces,\r\n{ "Interfaces", "remact.interfaces", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_mode,\r\n{ "Mode", "remact.mode", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_client_impl_level,\r\n{ "ClientImplLevel", "remact.client_impl_level", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_object_name,\r\n{ "ObjectName", "remact.object_name", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_object_storage,\r\n{ "ObjectStorage", "remact.object_storage", FT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_interface_data,\r\n{ "InterfaceData", "remact.interface_data", FT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_oxid_bindings,\r\n{ "OxidBindings", "remact.oxid_bindings", FT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_remact_authn_hint,\r\n{ "AuthnHint", "remact.authn_hint", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_remact\r\n};\r\nproto_remact = proto_register_protocol ("DCOM IRemoteActivation", "REMACT", "remact");\r\nproto_register_field_array (proto_remact, hf_remact, array_length (hf_remact));\r\nproto_register_subtree_array (ett, array_length (ett));\r\n}\r\nvoid\r\nproto_reg_handoff_remact (void)\r\n{\r\ndcerpc_init_uuid (proto_remact, ett_remact, &uuid_remact, ver_remact, remact_dissectors, hf_remact_opnum);\r\n}
