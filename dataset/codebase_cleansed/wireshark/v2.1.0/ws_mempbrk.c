void\r\nws_mempbrk_compile(ws_mempbrk_pattern* pattern, const gchar *needles)\r\n{\r\nconst gchar *n = needles;\r\nwhile (*n) {\r\npattern->patt[(int)*n] = 1;\r\nn++;\r\n}\r\n#ifdef HAVE_SSE4_2\r\nws_mempbrk_sse42_compile(pattern, needles);\r\n#endif\r\n}\r\nconst guint8 *\r\nws_mempbrk_portable_exec(const guint8* haystack, size_t haystacklen, const ws_mempbrk_pattern* pattern, guchar *found_needle)\r\n{\r\nconst guint8 *haystack_end = haystack + haystacklen;\r\nwhile (haystack < haystack_end) {\r\nif (pattern->patt[*haystack]) {\r\nif (found_needle)\r\n*found_needle = *haystack;\r\nreturn haystack;\r\n}\r\nhaystack++;\r\n}\r\nreturn NULL;\r\n}\r\nWS_DLL_PUBLIC const guint8 *\r\nws_mempbrk_exec(const guint8* haystack, size_t haystacklen, const ws_mempbrk_pattern* pattern, guchar *found_needle)\r\n{\r\n#ifdef HAVE_SSE4_2\r\nif (haystacklen >= 16 && pattern->use_sse42)\r\nreturn ws_mempbrk_sse42_exec(haystack, haystacklen, pattern, found_needle);\r\n#endif\r\nreturn ws_mempbrk_portable_exec(haystack, haystacklen, pattern, found_needle);\r\n}
