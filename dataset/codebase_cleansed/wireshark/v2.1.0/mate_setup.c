static void report_error(const gchar* fmt, ...) {\r\nstatic gchar error_buffer[DEBUG_BUFFER_SIZE];\r\nva_list list;\r\nva_start( list, fmt );\r\ng_vsnprintf(error_buffer,DEBUG_BUFFER_SIZE,fmt,list);\r\nva_end( list );\r\ng_string_append(matecfg->config_error,error_buffer);\r\ng_string_append_c(matecfg->config_error,'\n');\r\n}\r\nextern mate_cfg_pdu* new_pducfg(gchar* name) {\r\nmate_cfg_pdu* cfg = (mate_cfg_pdu *)g_malloc(sizeof(mate_cfg_pdu));\r\ncfg->name = g_strdup(name);\r\ncfg->last_id = 0;\r\ncfg->items = g_hash_table_new(g_direct_hash,g_direct_equal);\r\ncfg->transforms = NULL;\r\ncfg->hfid = -1;\r\ncfg->hfid_pdu_rel_time = -1;\r\ncfg->hfid_pdu_time_in_gop = -1;\r\ncfg->my_hfids = g_hash_table_new(g_str_hash,g_str_equal);\r\ncfg->ett = -1;\r\ncfg->ett_attr = -1;\r\ncfg->criterium = NULL;\r\ncfg->criterium_match_mode = AVPL_NO_MATCH;\r\ncfg->criterium_accept_mode = ACCEPT_MODE;\r\ng_ptr_array_add(matecfg->pducfglist,(gpointer) cfg);\r\ng_hash_table_insert(matecfg->pducfgs,(gpointer) cfg->name,(gpointer) cfg);\r\ncfg->hfids_attr = g_hash_table_new(g_int_hash,g_int_equal);\r\nreturn cfg;\r\n}\r\nextern mate_cfg_gop* new_gopcfg(gchar* name) {\r\nmate_cfg_gop* cfg = (mate_cfg_gop *)g_malloc(sizeof(mate_cfg_gop));\r\ncfg->name = g_strdup(name);\r\ncfg->last_id = 0;\r\ncfg->items = g_hash_table_new(g_direct_hash,g_direct_equal);\r\ncfg->transforms = NULL;\r\ncfg->extra = new_avpl("extra");\r\ncfg->hfid = -1;\r\ncfg->ett = -1;\r\ncfg->ett_attr = -1;\r\ncfg->ett_times = -1;\r\ncfg->ett_children = -1;\r\ncfg->hfid_start_time = -1;\r\ncfg->hfid_stop_time = -1;\r\ncfg->hfid_last_time = -1;\r\ncfg->hfid_gop_pdu = -1;\r\ncfg->hfid_gop_num_pdus = -1;\r\ncfg->my_hfids = g_hash_table_new(g_str_hash,g_str_equal);\r\ncfg->gop_index = g_hash_table_new(g_str_hash,g_str_equal);\r\ncfg->gog_index = g_hash_table_new(g_str_hash,g_str_equal);\r\ng_hash_table_insert(matecfg->gopcfgs,(gpointer) cfg->name, (gpointer) cfg);\r\nreturn cfg;\r\n}\r\nextern mate_cfg_gog* new_gogcfg(gchar* name) {\r\nmate_cfg_gog* cfg = (mate_cfg_gog *)g_malloc(sizeof(mate_cfg_gop));\r\ncfg->name = g_strdup(name);\r\ncfg->last_id = 0;\r\ncfg->items = g_hash_table_new(g_direct_hash,g_direct_equal);\r\ncfg->transforms = NULL;\r\ncfg->extra = new_avpl("extra");\r\ncfg->my_hfids = g_hash_table_new(g_str_hash,g_str_equal);\r\ncfg->hfid = -1;\r\ncfg->ett = -1;\r\ncfg->ett_attr = -1;\r\ncfg->ett_times = -1;\r\ncfg->ett_children = -1;\r\ncfg->ett_gog_gop = -1;\r\ncfg->hfid_gog_num_of_gops = -1;\r\ncfg->hfid_gog_gop = -1;\r\ncfg->hfid_gog_gopstart = -1;\r\ncfg->hfid_gog_gopstop = -1;\r\ncfg->hfid_start_time = -1;\r\ncfg->hfid_stop_time = -1;\r\ncfg->hfid_last_time = -1;\r\ng_hash_table_insert(matecfg->gogcfgs,(gpointer) cfg->name, (gpointer) cfg);\r\nreturn cfg;\r\n}\r\nextern gboolean add_hfid(header_field_info* hfi, gchar* how, GHashTable* where) {\r\nheader_field_info* first_hfi = NULL;\r\ngboolean exists = FALSE;\r\ngchar* as;\r\ngchar* h;\r\nint* ip;\r\nwhile(hfi) {\r\nfirst_hfi = hfi;\r\nhfi = (hfi->same_name_prev_id != -1) ? proto_registrar_get_nth(hfi->same_name_prev_id) : NULL;\r\n}\r\nhfi = first_hfi;\r\nwhile (hfi) {\r\nexists = TRUE;\r\nip = (int *)g_malloc(sizeof(int));\r\n*ip = hfi->id;\r\nif (( as = (gchar *)g_hash_table_lookup(where,ip) )) {\r\ng_free(ip);\r\nif (! g_str_equal(as,how)) {\r\nreport_error("MATE Error: add field to Pdu: attempt to add %s(%i) as %s"\r\n" failed: field already added as '%s'",hfi->abbrev,hfi->id,how,as);\r\nreturn FALSE;\r\n}\r\n} else {\r\nh = g_strdup(how);\r\ng_hash_table_insert(where,ip,h);\r\n}\r\nhfi = hfi->same_name_next;\r\n}\r\nif (! exists) {\r\nreport_error("MATE Error: cannot find field for attribute %s",how);\r\n}\r\nreturn exists;\r\n}\r\nextern gchar* add_ranges(gchar* range,GPtrArray* range_ptr_arr) {\r\ngchar** ranges;\r\nguint i;\r\nheader_field_info* hfi;\r\nint* hfidp;\r\nranges = g_strsplit(range,"/",0);\r\nif (ranges) {\r\nfor (i=0; ranges[i]; i++) {\r\nhfi = proto_registrar_get_byname(ranges[i]);\r\nif (hfi) {\r\nhfidp = (int *)g_malloc(sizeof(int));\r\n*hfidp = hfi->id;\r\ng_ptr_array_add(range_ptr_arr,(gpointer)hfidp);\r\ng_string_append_printf(matecfg->fields_filter, "||%s",ranges[i]);\r\n} else {\r\ng_strfreev(ranges);\r\nreturn g_strdup_printf("no such proto: '%s'",ranges[i]);\r\n}\r\n}\r\ng_strfreev(ranges);\r\n}\r\nreturn NULL;\r\n}\r\nstatic void new_attr_hfri(gchar* item_name, GHashTable* hfids, gchar* name) {\r\nint* p_id = (int *)g_malloc(sizeof(int));\r\nhf_register_info hfri;\r\nmemset(&hfri, 0, sizeof hfri);\r\n*p_id = -1;\r\nhfri.p_id = p_id;\r\nhfri.hfinfo.name = g_strdup(name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.%s",item_name,name);\r\nhfri.hfinfo.type = FT_STRING;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.strings = NULL;\r\nhfri.hfinfo.bitmask = 0;\r\nhfri.hfinfo.blurb = g_strdup_printf("%s attribute of %s",name,item_name);\r\n*p_id = -1;\r\ng_hash_table_insert(hfids,name,p_id);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\n}\r\nstatic const gchar* my_protoname(int proto_id) {\r\nif (proto_id) {\r\nreturn proto_registrar_get_abbrev(proto_id);\r\n} else {\r\nreturn "*";\r\n}\r\n}\r\nstatic void analyze_pdu_hfids(gpointer k, gpointer v, gpointer p) {\r\nmate_cfg_pdu* cfg = (mate_cfg_pdu *)p;\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,(gchar*) v);\r\ng_string_append_printf(matecfg->fields_filter,"||%s",my_protoname(*(int*)k));\r\n}\r\nstatic void analyze_transform_hfrs(gchar* name, GPtrArray* transforms, GHashTable* hfids) {\r\nguint i;\r\nvoid* cookie = NULL;\r\nAVPL_Transf* t;\r\nAVP* avp;\r\nfor (i=0; i < transforms->len;i++) {\r\nfor (t = (AVPL_Transf *)g_ptr_array_index(transforms,i); t; t=t->next ) {\r\ncookie = NULL;\r\nwhile(( avp = get_next_avp(t->replace,&cookie) )) {\r\nif (! g_hash_table_lookup(hfids,avp->n)) {\r\nnew_attr_hfri(name,hfids,avp->n);\r\n}\r\n}\r\n}\r\n}\r\n}\r\nstatic void analyze_pdu_config(mate_cfg_pdu* cfg) {\r\nhf_register_info hfri = { NULL, {NULL, NULL, FT_STRING, BASE_NONE, NULL, 0, NULL, HFILL}};\r\ngint* ett;\r\nhfri.p_id = &(cfg->hfid);\r\nhfri.hfinfo.name = g_strdup(cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("%s id",cfg->name);\r\nhfri.hfinfo.type = FT_UINT32;\r\nhfri.hfinfo.display = BASE_DEC;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_pdu_rel_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s time",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.RelativeTime",cfg->name);\r\nhfri.hfinfo.type = FT_FLOAT;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = "Seconds passed since the start of capture";\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_pdu_time_in_gop);\r\nhfri.hfinfo.name = g_strdup_printf("%s time since beginning of Gop",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.TimeInGop",cfg->name);\r\nhfri.hfinfo.type = FT_FLOAT;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = "Seconds passed since the start of the GOP";\r\ng_array_append_val(matecfg->hfrs,hfri);\r\ng_hash_table_foreach(cfg->hfids_attr,analyze_pdu_hfids,cfg);\r\nett = &cfg->ett;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_attr;\r\ng_array_append_val(matecfg->ett,ett);\r\nanalyze_transform_hfrs(cfg->name,cfg->transforms,cfg->my_hfids);\r\n}\r\nstatic void analyze_gop_config(gpointer k _U_, gpointer v, gpointer p _U_) {\r\nmate_cfg_gop* cfg = (mate_cfg_gop *)v;\r\nvoid* cookie = NULL;\r\nAVP* avp;\r\ngint* ett;\r\nhf_register_info hfri = { NULL, {NULL, NULL, FT_STRING, BASE_NONE, NULL, 0, NULL, HFILL}};\r\nhfri.p_id = &(cfg->hfid);\r\nhfri.hfinfo.name = g_strdup(cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("%s id",cfg->name);\r\nhfri.hfinfo.type = FT_UINT32;\r\nhfri.hfinfo.display = BASE_DEC;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_start_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s start time",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.StartTime",cfg->name);\r\nhfri.hfinfo.type = FT_FLOAT;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = g_strdup_printf("Seconds passed since the beginning of capture to the start of this %s",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_stop_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s hold time",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.Time",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("Duration in seconds from start to stop of this %s",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_last_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s duration",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.Duration",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("Time passed between the start of this %s and the last pdu assigned to it",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gop_num_pdus);\r\nhfri.hfinfo.name = g_strdup_printf("%s number of PDUs",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.NumOfPdus",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("Number of PDUs assigned to this %s",cfg->name);\r\nhfri.hfinfo.type = FT_UINT32;\r\nhfri.hfinfo.display = BASE_DEC;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gop_pdu);\r\nhfri.hfinfo.name = g_strdup_printf("A PDU of %s",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.Pdu",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("A PDU assigned to this %s",cfg->name);\r\nif (cfg->pdu_tree_mode == GOP_FRAME_TREE) {\r\nhfri.hfinfo.type = FT_FRAMENUM;\r\nhfri.hfinfo.display = BASE_NONE;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\n} else if (cfg->pdu_tree_mode == GOP_PDU_TREE) {\r\nhfri.hfinfo.type = FT_UINT32;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\n} else {\r\ncfg->pdu_tree_mode = GOP_NO_TREE;\r\n}\r\nwhile(( avp = get_next_avp(cfg->key,&cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\n}\r\n}\r\nif(cfg->start) {\r\ncookie = NULL;\r\nwhile(( avp = get_next_avp(cfg->start,&cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\n}\r\n}\r\n}\r\nif (cfg->stop) {\r\ncookie = NULL;\r\nwhile(( avp = get_next_avp(cfg->stop,&cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\n}\r\n}\r\n}\r\ncookie = NULL;\r\nwhile(( avp = get_next_avp(cfg->extra,&cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\n}\r\n}\r\nanalyze_transform_hfrs(cfg->name,cfg->transforms,cfg->my_hfids);\r\nett = &cfg->ett;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_attr;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_times;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_children;\r\ng_array_append_val(matecfg->ett,ett);\r\ng_hash_table_insert(matecfg->gops_by_pduname,cfg->name,cfg);\r\n}\r\nstatic void analyze_gog_config(gpointer k _U_, gpointer v, gpointer p _U_) {\r\nmate_cfg_gog* cfg = (mate_cfg_gog *)v;\r\nvoid* avp_cookie;\r\nvoid* avpl_cookie;\r\nAVP* avp;\r\nAVPL* avpl;\r\nAVPL* gopkey_avpl;\r\nAVPL* key_avps;\r\nLoAL* gog_keys = NULL;\r\nhf_register_info hfri = { NULL, {NULL, NULL, FT_STRING, BASE_NONE, NULL, 0, NULL, HFILL}};\r\ngint* ett;\r\nhfri.p_id = &(cfg->hfid);\r\nhfri.hfinfo.name = g_strdup(cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("%s Id",cfg->name);\r\nhfri.hfinfo.type = FT_UINT32;\r\nhfri.hfinfo.display = BASE_DEC;\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gog_num_of_gops);\r\nhfri.hfinfo.name = "number of GOPs";\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.NumOfGops",cfg->name);\r\nhfri.hfinfo.type = FT_UINT32;\r\nhfri.hfinfo.display = BASE_DEC;\r\nhfri.hfinfo.blurb = g_strdup_printf("Number of GOPs assigned to this %s",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gog_gopstart);\r\nhfri.hfinfo.name = "GopStart frame";\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.GopStart",cfg->name);\r\nhfri.hfinfo.type = FT_FRAMENUM;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = g_strdup("The start frame of a GOP");\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gog_gopstop);\r\nhfri.hfinfo.name = "GopStop frame";\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.GopStop",cfg->name);\r\nhfri.hfinfo.type = FT_FRAMENUM;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = g_strdup("The stop frame of a GOP");\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_start_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s start time",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.StartTime",cfg->name);\r\nhfri.hfinfo.type = FT_FLOAT;\r\nhfri.hfinfo.blurb = g_strdup_printf("Seconds passed since the beginning of capture to the start of this %s",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_last_time);\r\nhfri.hfinfo.name = g_strdup_printf("%s duration",cfg->name);\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.Duration",cfg->name);\r\nhfri.hfinfo.blurb = g_strdup_printf("Time passed between the start of this %s and the last pdu assigned to it",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nhfri.p_id = &(cfg->hfid_gog_gop);\r\nhfri.hfinfo.name = "a GOP";\r\nhfri.hfinfo.abbrev = g_strdup_printf("mate.%s.Gop",cfg->name);\r\nhfri.hfinfo.type = FT_STRING;\r\nhfri.hfinfo.display = BASE_NONE;\r\nhfri.hfinfo.blurb = g_strdup_printf("a GOPs assigned to this %s",cfg->name);\r\ng_array_append_val(matecfg->hfrs,hfri);\r\nkey_avps = new_avpl("");\r\navpl_cookie = NULL;\r\nwhile (( avpl = get_next_avpl(cfg->keys,&avpl_cookie) )) {\r\nif (! ( gog_keys = (LoAL *)g_hash_table_lookup(matecfg->gogs_by_gopname,avpl->name))) {\r\ngog_keys = new_loal(avpl->name);\r\ng_hash_table_insert(matecfg->gogs_by_gopname,gog_keys->name,gog_keys);\r\n}\r\ngopkey_avpl = new_avpl_from_avpl(cfg->name, avpl, TRUE);\r\nloal_append(gog_keys,gopkey_avpl);\r\navp_cookie = NULL;\r\nwhile (( avp = get_next_avp(avpl,&avp_cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\ninsert_avp(key_avps,avp);\r\n}\r\n}\r\n}\r\navp_cookie = NULL;\r\nwhile (( avp = get_next_avp(cfg->extra,&avp_cookie) )) {\r\nif (! g_hash_table_lookup(cfg->my_hfids,avp->n)) {\r\nnew_attr_hfri(cfg->name,cfg->my_hfids,avp->n);\r\n}\r\n}\r\nmerge_avpl(cfg->extra,key_avps,TRUE);\r\nanalyze_transform_hfrs(cfg->name,cfg->transforms,cfg->my_hfids);\r\nett = &cfg->ett;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_attr;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_children;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_times;\r\ng_array_append_val(matecfg->ett,ett);\r\nett = &cfg->ett_gog_gop;\r\ng_array_append_val(matecfg->ett,ett);\r\n}\r\nstatic void analyze_config(void) {\r\nguint i;\r\nfor (i=0; i < matecfg->pducfglist->len; i++) {\r\nanalyze_pdu_config((mate_cfg_pdu*) g_ptr_array_index(matecfg->pducfglist,i));\r\n}\r\ng_hash_table_foreach(matecfg->gopcfgs,analyze_gop_config,matecfg);\r\ng_hash_table_foreach(matecfg->gogcfgs,analyze_gog_config,matecfg);\r\n}\r\nextern mate_config* mate_cfg(void) {\r\nreturn matecfg;\r\n}\r\nextern mate_config* mate_make_config(const gchar* filename, int mate_hfid) {\r\ngint* ett;\r\navp_init();\r\nmatecfg = (mate_config *)g_malloc(sizeof(mate_config));\r\nmatecfg->hfid_mate = mate_hfid;\r\nmatecfg->fields_filter = g_string_new("");\r\nmatecfg->protos_filter = g_string_new("");\r\nmatecfg->dbg_facility = NULL;\r\nmatecfg->mate_lib_path = g_strdup_printf("%s%c%s%c",get_datafile_dir(),DIR_SEP,DEFAULT_MATE_LIB_PATH,DIR_SEP);\r\nmatecfg->pducfgs = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->gopcfgs = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->gogcfgs = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->transfs = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->pducfglist = g_ptr_array_new();\r\nmatecfg->gops_by_pduname = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->gogs_by_gopname = g_hash_table_new(g_str_hash,g_str_equal);\r\nmatecfg->ett_root = -1;\r\nmatecfg->hfrs = g_array_new(FALSE,FALSE,sizeof(hf_register_info));\r\nmatecfg->ett = g_array_new(FALSE,FALSE,sizeof(gint*));\r\nmatecfg->defaults.pdu.drop_unassigned = FALSE;\r\nmatecfg->defaults.pdu.discard = FALSE;\r\nmatecfg->defaults.pdu.last_extracted = FALSE;\r\nmatecfg->defaults.pdu.match_mode = AVPL_STRICT;\r\nmatecfg->defaults.pdu.replace_mode = AVPL_INSERT;\r\nmatecfg->defaults.gop.expiration = -1.0f;\r\nmatecfg->defaults.gop.idle_timeout = -1.0f;\r\nmatecfg->defaults.gop.lifetime = -1.0f;\r\nmatecfg->defaults.gop.pdu_tree_mode = GOP_FRAME_TREE;\r\nmatecfg->defaults.gop.show_times = TRUE;\r\nmatecfg->defaults.gop.drop_unassigned = FALSE;\r\nmatecfg->defaults.gog.expiration = 5.0f;\r\nmatecfg->defaults.gog.show_times = TRUE;\r\nmatecfg->defaults.gog.gop_tree_mode = GOP_BASIC_TREE;\r\nmatecfg->dbg_lvl = 0;\r\nmatecfg->dbg_pdu_lvl = 0;\r\nmatecfg->dbg_gop_lvl = 0;\r\nmatecfg->dbg_gog_lvl = 0;\r\nmatecfg->config_error = g_string_new("");\r\nett = &matecfg->ett_root;\r\ng_array_append_val(matecfg->ett,ett);\r\nif ( mate_load_config(filename,matecfg) ) {\r\nanalyze_config();\r\n} else {\r\nreport_failure("MATE failed to configure!\n"\r\n"It is recommended that you fix your config and restart Wireshark.\n"\r\n"The reported error is:\n%s\n",matecfg->config_error->str);\r\nmatecfg = NULL;\r\nreturn NULL;\r\n}\r\nif (matecfg->fields_filter->len > 1) {\r\ng_string_erase(matecfg->fields_filter,0,2);\r\ng_string_erase(matecfg->protos_filter,0,2);\r\n} else {\r\nmatecfg = NULL;\r\nreturn NULL;\r\n}\r\nmatecfg->tap_filter = g_strdup_printf("(%s) && (%s)",matecfg->protos_filter->str,matecfg->fields_filter->str);\r\nreturn matecfg;\r\n}
