void proto_register_p7(void) {\r\nstatic hf_register_info hf[] =\r\n{\r\n#include "packet-p7-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_p7,\r\n#include "packet-p7-ettarr.c"\r\n};\r\nmodule_t *p7_module;\r\nproto_p7 = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_p7, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\np7_module = prefs_register_protocol_subtree("OSI/X.400", proto_p7, prefs_register_p7);\r\nprefs_register_uint_preference(p7_module, "tcp.port", "P7 TCP Port",\r\n"Set the port for P7 operations (if other"\r\n" than the default of 102)",\r\n10, &global_p7_tcp_port);\r\n}\r\nvoid proto_reg_handoff_p7(void) {\r\n#include "packet-p7-dis-tab.c"\r\noid_add_from_string("id-ac-ms-access","2.6.0.1.11");\r\noid_add_from_string("id-ac-ms-reliable-access","2.6.0.1.12");\r\nregister_ros_protocol_info("2.6.0.2.9", &p7_ros_info, 0, "id-as-ms", FALSE);\r\nregister_ros_protocol_info("2.6.0.2.5", &p7_ros_info, 0, "id-as-mrse", FALSE);\r\nregister_ros_protocol_info("2.6.0.2.1", &p7_ros_info, 0, "id-as-msse", FALSE);\r\ntpkt_handle = find_dissector("tpkt");\r\n}\r\nstatic void\r\nprefs_register_p7(void)\r\n{\r\nstatic guint tcp_port = 0;\r\nif((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_delete_uint("tcp.port", tcp_port, tpkt_handle);\r\ntcp_port = global_p7_tcp_port;\r\nif((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_add_uint("tcp.port", global_p7_tcp_port, tpkt_handle);\r\n}
