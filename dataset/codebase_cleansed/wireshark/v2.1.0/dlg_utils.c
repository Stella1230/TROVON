static GtkWidget *\r\ndlg_button_new(GtkWidget *hbox, GtkWidget *button_hbox, const gchar *stock_id)\r\n{\r\nGtkWidget *button;\r\nbutton = ws_gtk_button_new_from_stock(stock_id);\r\ngtk_widget_set_can_default(button, TRUE);\r\ng_object_set_data(G_OBJECT(hbox), stock_id, button);\r\ngtk_box_pack_end(GTK_BOX(button_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nreturn button;\r\n}\r\nvoid\r\ndlg_button_focus_nth(GtkWidget *hbox, gint focus_item) {\r\nGtkWidget *button_hbox, *button;\r\nGList *children;\r\ngint cur_item = 0;\r\nif (!hbox)\r\nreturn;\r\nbutton_hbox = (GtkWidget *)g_object_get_data(G_OBJECT(hbox), BUTTON_HBOX_KEY);\r\nchildren = gtk_container_get_children(GTK_CONTAINER(button_hbox));\r\nwhile (children) {\r\nif (cur_item == focus_item) {\r\nbutton = (GtkWidget *)children->data;\r\ngtk_widget_grab_focus(button);\r\ngtk_widget_grab_default(button);\r\nbreak;\r\n}\r\nchildren = g_list_next(children);\r\ncur_item++;\r\n}\r\ng_list_free(children);\r\n}\r\nGtkWidget *\r\ndlg_button_row_new(const gchar *stock_id_first, ...)\r\n{\r\ngint buttons = 0;\r\nva_list stock_id_list;\r\nconst gchar *stock_id = stock_id_first;\r\nGtkWidget *hbox;\r\nGtkWidget *button_hbox;\r\nGtkWidget *help_hbox;\r\nGtkWidget *button;\r\nconst gchar *apply = NULL;\r\nconst gchar *cancel = NULL;\r\nconst gchar *cap_start = NULL;\r\nconst gchar *cap_stop = NULL;\r\nconst gchar *cap_options = NULL;\r\n#ifdef _WIN32\r\nconst gchar *cap_details = NULL;\r\n#endif\r\nconst gchar *clear = NULL;\r\nconst gchar *closex = NULL;\r\nconst gchar *copy = NULL;\r\nconst gchar *create_stat = NULL;\r\nconst gchar *delete_id = NULL;\r\nconst gchar *dont_save = NULL;\r\nconst gchar *filter_stream = NULL;\r\nconst gchar *find = NULL;\r\nconst gchar *help = NULL;\r\nconst gchar *jump = NULL;\r\nconst gchar *no = NULL;\r\nconst gchar *ok = NULL;\r\nconst gchar *print = NULL;\r\nconst gchar *save = NULL;\r\nconst gchar *save_as = NULL;\r\nconst gchar *save_all = NULL;\r\nconst gchar *stop = NULL;\r\nconst gchar *yes = NULL;\r\nconst gchar *refresh = NULL;\r\nconst gchar *add = NULL;\r\n#ifdef HAVE_GEOIP\r\nconst gchar *map = NULL;\r\n#endif\r\nconst gchar *follow_stream = NULL;\r\nconst gchar *graph_a_b = NULL;\r\nconst gchar *graph_b_a = NULL;\r\nva_start(stock_id_list, stock_id_first);\r\nwhile(stock_id != NULL) {\r\nif (strcmp(stock_id, GTK_STOCK_OK) == 0) {\r\nok = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_CREATE_STAT) == 0) {\r\ncreate_stat = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_APPLY) == 0) {\r\napply = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_SAVE) == 0) {\r\nsave = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_SAVE_AS) == 0) {\r\nsave_as = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_SAVE_ALL) == 0) {\r\nsave_all = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_DONT_SAVE) == 0) {\r\ndont_save = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_QUIT_DONT_SAVE) == 0) {\r\ndont_save = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_CANCEL) == 0) {\r\ncancel = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_CLOSE) == 0) {\r\nclosex = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_CLEAR) == 0) {\r\nclear = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_REFRESH) == 0) {\r\nrefresh = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_ADD) == 0) {\r\nadd = stock_id;\r\n#ifdef HAVE_LIBPCAP\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_CAPTURE_START) == 0) {\r\ncap_start = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_CAPTURE_STOP) == 0) {\r\ncap_stop = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_CAPTURE_OPTIONS) == 0) {\r\ncap_options = stock_id;\r\n#ifdef _WIN32\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_CAPTURE_DETAILS) == 0) {\r\ncap_details = stock_id;\r\n#endif\r\n#endif\r\n#ifdef HAVE_GEOIP\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_MAP) == 0) {\r\nmap = stock_id;\r\n#endif\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_FOLLOW_STREAM) == 0) {\r\nfollow_stream = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_STOP) == 0) {\r\nstop = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_HELP) == 0) {\r\nhelp = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_PRINT) == 0) {\r\nprint = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_FIND) == 0) {\r\nfind = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_JUMP_TO) == 0) {\r\njump = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_YES) == 0) {\r\nyes = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_NO) == 0) {\r\nno = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_FILTER_OUT_STREAM) == 0) {\r\nfilter_stream = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_DELETE) == 0) {\r\ndelete_id = stock_id;\r\n} else if (strcmp(stock_id, GTK_STOCK_COPY) == 0) {\r\ncopy = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_GRAPH_A_B) == 0) {\r\ngraph_a_b = stock_id;\r\n} else if (strcmp(stock_id, WIRESHARK_STOCK_GRAPH_B_A) == 0) {\r\ngraph_b_a = stock_id;\r\n} else {\r\ng_assert_not_reached();\r\n}\r\nbuttons++;\r\nstock_id = va_arg(stock_id_list, gchar *);\r\n}\r\nva_end(stock_id_list);\r\nhbox = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, DLG_BUTTON_SPACING, FALSE);\r\ngtk_widget_show(hbox);\r\nbutton_hbox = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_end(GTK_BOX(hbox), button_hbox, TRUE, TRUE, 0);\r\ng_object_set_data(G_OBJECT(hbox), BUTTON_HBOX_KEY, button_hbox);\r\ngtk_widget_show(button_hbox);\r\ngtk_box_set_spacing(GTK_BOX(button_hbox), DLG_BUTTON_SPACING);\r\nhelp_hbox = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_end(GTK_BOX(hbox), help_hbox, FALSE, FALSE, 0);\r\ngtk_widget_show(help_hbox);\r\ngtk_box_set_spacing(GTK_BOX(help_hbox), DLG_BUTTON_SPACING);\r\nif (buttons == 0) {\r\nreturn hbox;\r\n}\r\nif (buttons == 1) {\r\ndlg_button_new(hbox, button_hbox, stock_id_first);\r\nreturn hbox;\r\n}\r\nif (help) {\r\nbutton = ws_gtk_button_new_from_stock(help);\r\ngtk_widget_set_can_default(button, TRUE);\r\ng_object_set_data(G_OBJECT(hbox), help, button);\r\ngtk_box_pack_start(GTK_BOX(help_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nbuttons--;\r\n}\r\nif (copy) {\r\nbutton = ws_gtk_button_new_from_stock(copy);\r\ngtk_widget_set_can_default(button, TRUE);\r\ng_object_set_data(G_OBJECT(hbox), copy, button);\r\ngtk_box_pack_start(GTK_BOX(help_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nbuttons--;\r\n}\r\nif (refresh) {\r\nbutton = ws_gtk_button_new_from_stock(refresh);\r\ng_object_set_data(G_OBJECT(hbox), refresh, button);\r\ngtk_box_pack_start(GTK_BOX(help_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nbuttons--;\r\n}\r\nif (add) {\r\nbutton = ws_gtk_button_new_from_stock(add);\r\ng_object_set_data(G_OBJECT(hbox), add, button);\r\ngtk_box_pack_start(GTK_BOX(help_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nbuttons--;\r\n}\r\n#ifdef HAVE_GEOIP\r\nif (map) {\r\nbutton = ws_gtk_button_new_from_stock(map);\r\ngtk_widget_set_can_default(button, TRUE);\r\ng_object_set_data(G_OBJECT(hbox), map, button);\r\ngtk_box_pack_start(GTK_BOX(help_hbox), button, FALSE, FALSE, 0);\r\ngtk_widget_show(button);\r\nbuttons--;\r\n}\r\n#endif\r\ngtk_button_box_set_layout (GTK_BUTTON_BOX(button_hbox), GTK_BUTTONBOX_END);\r\n#if !defined(_WIN32)\r\nif (buttons == 2) {\r\nif (ok && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\nif (print && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, print);\r\nreturn hbox;\r\n}\r\nif (find && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, find);\r\nreturn hbox;\r\n}\r\nif (jump && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, jump);\r\nreturn hbox;\r\n}\r\nif (save && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, save);\r\nreturn hbox;\r\n}\r\nif (ok && clear) {\r\ndlg_button_new(hbox, button_hbox, clear);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\nif (save && closex) {\r\ndlg_button_new(hbox, button_hbox, closex);\r\ndlg_button_new(hbox, button_hbox, save);\r\nreturn hbox;\r\n}\r\nif (create_stat && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, create_stat);\r\nreturn hbox;\r\n}\r\nif (cap_start && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, cap_start);\r\nreturn hbox;\r\n}\r\nif (cap_stop && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, cap_stop);\r\nreturn hbox;\r\n}\r\nif (delete_id && cancel) {\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, delete_id);\r\nreturn hbox;\r\n}\r\n}\r\nif (buttons == 3) {\r\nif (ok && save && closex) {\r\ndlg_button_new(hbox, button_hbox, save);\r\ndlg_button_new(hbox, button_hbox, closex);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\nif (ok && apply && cancel) {\r\ndlg_button_new(hbox, button_hbox, apply);\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\nif (apply && save && closex) {\r\ndlg_button_new(hbox, button_hbox, save);\r\ndlg_button_new(hbox, button_hbox, closex);\r\ndlg_button_new(hbox, button_hbox, apply);\r\nreturn hbox;\r\n}\r\nif (yes && no && cancel) {\r\ndlg_button_new(hbox, button_hbox, no);\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, yes);\r\nreturn hbox;\r\n}\r\nif (save && dont_save && cancel) {\r\ndlg_button_new(hbox, button_hbox, dont_save);\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, save);\r\nreturn hbox;\r\n}\r\n}\r\nif (buttons == 4) {\r\nif (ok && apply && save && cancel) {\r\ndlg_button_new(hbox, button_hbox, save);\r\ndlg_button_new(hbox, button_hbox, apply);\r\ndlg_button_new(hbox, button_hbox, cancel);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\nif (ok && apply && save && closex) {\r\ndlg_button_new(hbox, button_hbox, save);\r\ndlg_button_new(hbox, button_hbox, apply);\r\ndlg_button_new(hbox, button_hbox, closex);\r\ndlg_button_new(hbox, button_hbox, ok);\r\nreturn hbox;\r\n}\r\n}\r\n#endif\r\nif (ok != NULL) dlg_button_new(hbox, button_hbox, ok);\r\nif (delete_id != NULL) dlg_button_new(hbox, button_hbox, delete_id);\r\nif (jump != NULL) dlg_button_new(hbox, button_hbox, jump);\r\nif (find != NULL) dlg_button_new(hbox, button_hbox, find);\r\nif (print != NULL) dlg_button_new(hbox, button_hbox, print);\r\nif (create_stat != NULL) dlg_button_new(hbox, button_hbox, create_stat);\r\nif (apply != NULL) dlg_button_new(hbox, button_hbox, apply);\r\nif (yes != NULL) dlg_button_new(hbox, button_hbox, yes);\r\nif (no != NULL) dlg_button_new(hbox, button_hbox, no);\r\nif (save != NULL) dlg_button_new(hbox, button_hbox, save);\r\nif (save_as != NULL) dlg_button_new(hbox, button_hbox, save_as);\r\nif (save_all != NULL) dlg_button_new(hbox, button_hbox, save_all);\r\nif (dont_save != NULL) dlg_button_new(hbox, button_hbox, dont_save);\r\nif (cap_start != NULL) dlg_button_new(hbox, button_hbox, cap_start);\r\nif (cap_stop != NULL) dlg_button_new(hbox, button_hbox, cap_stop);\r\nif (cap_options != NULL) dlg_button_new(hbox, button_hbox, cap_options);\r\n#ifdef _WIN32\r\nif (cap_details != NULL) dlg_button_new(hbox, button_hbox, cap_details);\r\n#endif\r\nif (stop != NULL) dlg_button_new(hbox, button_hbox, stop);\r\nif (clear != NULL) dlg_button_new(hbox, button_hbox, clear);\r\nif (filter_stream != NULL) dlg_button_new(hbox, button_hbox, filter_stream);\r\nif (follow_stream != NULL) dlg_button_new(hbox, button_hbox, follow_stream);\r\nif (graph_a_b != NULL) dlg_button_new(hbox, button_hbox, graph_a_b);\r\nif (graph_b_a != NULL) dlg_button_new(hbox, button_hbox, graph_b_a);\r\nif (closex != NULL) dlg_button_new(hbox, button_hbox, closex);\r\nif (cancel != NULL) dlg_button_new(hbox, button_hbox, cancel);\r\nreturn hbox;\r\n}\r\nGtkWidget *\r\ndlg_window_new(const gchar *title)\r\n{\r\nGtkWidget *win;\r\nwin = window_new(GTK_WINDOW_TOPLEVEL, title);\r\n#ifndef _WIN32\r\nif (top_level) {\r\ngtk_window_set_transient_for(GTK_WINDOW(win), GTK_WINDOW(top_level));\r\n}\r\n#endif\r\nreturn win;\r\n}\r\nGtkWidget *\r\ndlg_window_new_with_geom(const gchar *title, const gchar *geom_name, GtkWindowPosition pos)\r\n{\r\nGtkWidget *win;\r\nwin = window_new_with_geom(GTK_WINDOW_TOPLEVEL, title, geom_name ? geom_name : title, pos);\r\n#ifndef _WIN32\r\nif (top_level) {\r\ngtk_window_set_transient_for(GTK_WINDOW(win), GTK_WINDOW(top_level));\r\n}\r\n#endif\r\nreturn win;\r\n}\r\nGtkWidget *\r\ndlg_conf_window_new(const gchar *title)\r\n{\r\nconst char *profile_name;\r\ngchar *win_name;\r\nGtkWidget *win;\r\nprofile_name = get_profile_name();\r\nwin_name = g_strdup_printf("%s - Profile: %s", title, profile_name);\r\nwin = dlg_window_new(win_name);\r\ng_free(win_name);\r\nreturn win;\r\n}\r\nvoid\r\ndlg_set_activate(GtkWidget *widget, GtkWidget *ok_button)\r\n{\r\ng_signal_connect(widget, "activate", G_CALLBACK(dlg_activate), ok_button);\r\n}\r\nstatic void\r\ndlg_activate (GtkWidget *widget _U_, gpointer ok_button)\r\n{\r\ngtk_widget_activate(GTK_WIDGET(ok_button));\r\n}
