int\r\ndissect_ndr_uint8(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint8 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nreturn dissect_dcerpc_uint8(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\nPIDL_dissect_uint8_val(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param, guint8 *pval)\r\n{\r\nguint8 val;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\noffset = dissect_dcerpc_uint8(tvb, offset, pinfo,\r\ntree, drep, hfindex, &val);\r\nif (param&PIDL_SET_COL_INFO) {\r\nheader_field_info *hf_info;\r\nchar *valstr;\r\nhf_info = proto_registrar_get_nth(hfindex);\r\nvalstr = (char *)wmem_alloc(wmem_packet_scope(), 64);\r\nvalstr[0]=0;\r\nswitch (hf_info->display) {\r\ncase BASE_DEC:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(%d)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "%d", val);\r\n}\r\nbreak;\r\ncase BASE_HEX:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(0x%02x)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "0x%02x", val);\r\n}\r\nbreak;\r\ndefault:\r\nREPORT_DISSECTOR_BUG("Invalid hf->display value");\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO," %s:%s", hf_info->name, valstr);\r\n}\r\nif (pval) {\r\n*pval = val;\r\n}\r\nreturn offset;\r\n}\r\nint\r\nPIDL_dissect_uint8(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param)\r\n{\r\nreturn PIDL_dissect_uint8_val(tvb, offset, pinfo, tree, di, drep, hfindex, param, NULL);\r\n}\r\nint\r\ndissect_ndr_uint16(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint16 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 2)) {\r\noffset++;\r\n}\r\nreturn dissect_dcerpc_uint16(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\nPIDL_dissect_uint16_val(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param, guint16 *pval)\r\n{\r\nguint16 val;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 2)) {\r\noffset++;\r\n}\r\noffset = dissect_dcerpc_uint16(tvb, offset, pinfo,\r\ntree, drep, hfindex, &val);\r\nif (param&PIDL_SET_COL_INFO) {\r\nheader_field_info *hf_info;\r\nchar *valstr;\r\nhf_info = proto_registrar_get_nth(hfindex);\r\nvalstr = (char *)wmem_alloc(wmem_packet_scope(), 64);\r\nvalstr[0]=0;\r\nswitch (hf_info->display) {\r\ncase BASE_DEC:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(%d)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "%d", val);\r\n}\r\nbreak;\r\ncase BASE_HEX:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(0x%04x)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "0x%04x", val);\r\n}\r\nbreak;\r\ndefault:\r\nREPORT_DISSECTOR_BUG("Invalid hf->display value");\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO," %s:%s", hf_info->name, valstr);\r\n}\r\nif (pval) {\r\n*pval = val;\r\n}\r\nreturn offset;\r\n}\r\nint\r\nPIDL_dissect_uint16(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param)\r\n{\r\nreturn PIDL_dissect_uint16_val(tvb, offset, pinfo, tree, di, drep, hfindex, param, NULL);\r\n}\r\nint\r\ndissect_ndr_uint32(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif ((di != NULL) && (di->conformant_run)) {\r\nreturn offset;\r\n}\r\nif ((di != NULL) && (!di->no_align) && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nreturn dissect_dcerpc_uint32(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_uint3264(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint3264 *pdata)\r\n{\r\nif (di->call_data->flags & DCERPC_IS_NDR64) {\r\nreturn dissect_ndr_uint64(tvb, offset, pinfo, tree, di, drep, hfindex, pdata);\r\n} else {\r\nguint32 val = 0;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep, hfindex, &val);\r\nif (pdata) {\r\n*pdata = val;\r\n}\r\nreturn offset;\r\n}\r\n}\r\nint\r\ndissect_ndr_uint1632(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint1632 *pdata)\r\n{\r\nif (di->call_data->flags & DCERPC_IS_NDR64) {\r\nreturn dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep, hfindex, pdata);\r\n} else {\r\nguint16 val = 0;\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep, hfindex, &val);\r\nif (pdata) {\r\n*pdata = val;\r\n}\r\nreturn offset;\r\n}\r\n}\r\nint\r\nPIDL_dissect_uint32_val(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param, guint32 *rval)\r\n{\r\nguint32 val;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\noffset = dissect_dcerpc_uint32(tvb, offset, pinfo,\r\ntree, drep, hfindex, &val);\r\nif (param&PIDL_SET_COL_INFO) {\r\nheader_field_info *hf_info;\r\nchar *valstr;\r\nhf_info = proto_registrar_get_nth(hfindex);\r\nvalstr = (char *)wmem_alloc(wmem_packet_scope(), 64);\r\nvalstr[0]=0;\r\nswitch (hf_info->display) {\r\ncase BASE_DEC:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(%d)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "%d", val);\r\n}\r\nbreak;\r\ncase BASE_HEX:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(0x%08x)",val_to_str(val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "0x%08x", val);\r\n}\r\nbreak;\r\ndefault:\r\nREPORT_DISSECTOR_BUG("Invalid hf->display value");\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO," %s:%s", hf_info->name, valstr);\r\n}\r\nif (rval != NULL) {\r\n*rval = val;\r\n}\r\nreturn offset;\r\n}\r\nint\r\nPIDL_dissect_uint32(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param)\r\n{\r\nreturn PIDL_dissect_uint32_val(tvb, offset, pinfo, tree, di, drep, hfindex, param, NULL);\r\n}\r\nint\r\ndissect_ndr_duint32(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint64 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nreturn dissect_dcerpc_uint64(tvb, offset, pinfo,\r\ntree, di, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_uint64(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint64 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 8)) {\r\ngint padding = 8 - (offset % 8);\r\nproto_tree_add_item(tree, hf_dcerpc_ndr_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\nreturn dissect_dcerpc_uint64(tvb, offset, pinfo,\r\ntree, di, drep, hfindex, pdata);\r\n}\r\nint\r\nPIDL_dissect_uint64_val(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param, guint64 *pval)\r\n{\r\nguint64 val;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 8)) {\r\noffset += 8 - (offset % 8);\r\n}\r\noffset = dissect_dcerpc_uint64(tvb, offset, pinfo,\r\ntree, di, drep, hfindex, &val);\r\nif (param&PIDL_SET_COL_INFO) {\r\nheader_field_info *hf_info;\r\nchar *valstr;\r\nhf_info = proto_registrar_get_nth(hfindex);\r\nvalstr = (char *)wmem_alloc(wmem_packet_scope(), 64);\r\nvalstr[0]=0;\r\nswitch (hf_info->display) {\r\ncase BASE_DEC:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(%" G_GINT64_MODIFIER "u)",val_to_str( (guint32) val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "%" G_GINT64_MODIFIER "u", val);\r\n}\r\nbreak;\r\ncase BASE_HEX:\r\nif (hf_info->strings) {\r\ng_snprintf(valstr, 64, "%s(0x%" G_GINT64_MODIFIER "x)",val_to_str( (guint32) val, (const value_string *)hf_info->strings, "Unknown:%u"), val);\r\n} else {\r\ng_snprintf(valstr, 64, "0x%" G_GINT64_MODIFIER "x", val);\r\n}\r\nbreak;\r\ndefault:\r\nREPORT_DISSECTOR_BUG("Invalid hf->display value");\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO," %s:%s", hf_info->name, valstr);\r\n}\r\nif (pval) {\r\n*pval = val;\r\n}\r\nreturn offset;\r\n}\r\nint\r\nPIDL_dissect_uint64(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 param)\r\n{\r\nreturn PIDL_dissect_uint64_val(tvb, offset, pinfo, tree, di, drep, hfindex, param, NULL);\r\n}\r\nint\r\ndissect_ndr_float(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, gfloat *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nreturn dissect_dcerpc_float(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_double(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, gdouble *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 8)) {\r\noffset += 8 - (offset % 8);\r\n}\r\nreturn dissect_dcerpc_double(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_time_t(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, guint32 *pdata)\r\n{\r\nif (pdata)\r\n*pdata = 0;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nreturn dissect_dcerpc_time_t(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_uuid_t(tvbuff_t *tvb, gint offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, e_guid_t *pdata)\r\n{\r\nif (pdata)\r\nmemset(pdata, 0, sizeof(*pdata));\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nreturn dissect_dcerpc_uuid_t(tvb, offset, pinfo,\r\ntree, drep, hfindex, pdata);\r\n}\r\nint\r\ndissect_ndr_ctx_hnd(tvbuff_t *tvb, gint offset, packet_info *pinfo _U_,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep,\r\nint hfindex, e_ctx_hnd *pdata)\r\n{\r\nstatic e_ctx_hnd ctx_hnd;\r\nif (di->conformant_run) {\r\nreturn offset;\r\n}\r\nif (!di->no_align && (offset % 4)) {\r\noffset += 4 - (offset % 4);\r\n}\r\nctx_hnd.attributes = dcerpc_tvb_get_ntohl(tvb, offset, drep);\r\ndcerpc_tvb_get_uuid(tvb, offset+4, drep, &ctx_hnd.uuid);\r\nif (tree) {\r\nproto_tree_add_item(tree, hfindex, tvb, offset, 20, ENC_NA);\r\n}\r\nif (pdata) {\r\n*pdata = ctx_hnd;\r\n}\r\nreturn offset + 20;\r\n}
