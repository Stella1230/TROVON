static void\r\nfile_print_cmd(gboolean print_selected)\r\n{\r\nprint_args_t *args = &print_args;\r\nif (print_win != NULL) {\r\nreactivate_window(print_win);\r\nreturn;\r\n}\r\nif(print_prefs_init == FALSE) {\r\nprint_prefs_init = TRUE;\r\nargs->format = (print_format_e)prefs.pr_format;\r\nargs->to_file = prefs.pr_dest;\r\nargs->file = g_strdup(prefs.pr_file);\r\nargs->cmd = g_strdup(prefs.pr_cmd);\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nif(print_selected) {\r\nargs->range.process = range_process_selected;\r\n}\r\nprint_win = open_print_dialog("Wireshark: Print", output_action_print, args);\r\ng_signal_connect(print_win, "destroy", G_CALLBACK(print_destroy_cb), &print_win);\r\n}\r\nvoid\r\nfile_print_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nfile_print_cmd(FALSE);\r\n}\r\nvoid\r\nfile_print_selected_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nfile_print_cmd(TRUE);\r\n}\r\nvoid\r\nexport_text_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_text);\r\nreturn;\r\n}\r\nvoid\r\nexport_text_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_text_args;\r\nif (export_text_win != NULL) {\r\nreactivate_window(export_text_win);\r\nreturn;\r\n}\r\nif(export_text_prefs_init == FALSE) {\r\nexport_text_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_text_win = open_print_dialog("Wireshark: Export as \"Plain Text\" File", output_action_export_text, args);\r\ng_signal_connect(export_text_win, "destroy", G_CALLBACK(print_destroy_cb), &export_text_win);\r\n}\r\nvoid\r\nexport_ps_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_ps);\r\nreturn;\r\n}\r\nvoid\r\nexport_ps_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_ps_args;\r\nif (export_ps_win != NULL) {\r\nreactivate_window(export_ps_win);\r\nreturn;\r\n}\r\nif(export_ps_prefs_init == FALSE) {\r\nexport_ps_prefs_init = TRUE;\r\nargs->format = PR_FMT_PS;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_ps_win = open_print_dialog("Wireshark: Export as \"PostScript\" file", output_action_export_ps, args);\r\ng_signal_connect(export_ps_win, "destroy", G_CALLBACK(print_destroy_cb), &export_ps_win);\r\n}\r\nvoid\r\nexport_psml_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_psml);\r\nreturn;\r\n}\r\nvoid\r\nexport_psml_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_psml_args;\r\nif (export_psml_win != NULL) {\r\nreactivate_window(export_psml_win);\r\nreturn;\r\n}\r\nif(export_psml_prefs_init == FALSE) {\r\nexport_psml_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_psml_win = open_print_dialog("Wireshark: Export as \"PSML\" file", output_action_export_psml, args);\r\ng_signal_connect(export_psml_win, "destroy", G_CALLBACK(print_destroy_cb), &export_psml_win);\r\n}\r\nvoid\r\nexport_pdml_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_pdml);\r\nreturn;\r\n}\r\nvoid\r\nexport_pdml_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_pdml_args;\r\nif (export_pdml_win != NULL) {\r\nreactivate_window(export_pdml_win);\r\nreturn;\r\n}\r\nif(export_pdml_prefs_init == FALSE) {\r\nexport_pdml_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_pdml_win = open_print_dialog("Wireshark: Export as \"PDML\" file", output_action_export_pdml, args);\r\ng_signal_connect(export_pdml_win, "destroy", G_CALLBACK(print_destroy_cb), &export_pdml_win);\r\n}\r\nvoid\r\nexport_csv_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_csv);\r\nreturn;\r\n}\r\nvoid\r\nexport_csv_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_csv_args;\r\nif (export_csv_win != NULL) {\r\nreactivate_window(export_csv_win);\r\nreturn;\r\n}\r\nif(export_csv_prefs_init == FALSE) {\r\nexport_csv_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = FALSE;\r\nargs->print_col_headings = FALSE;\r\nargs->print_dissections = print_dissections_none;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_csv_win = open_print_dialog("Wireshark: Export as \"Comma Separated Values\" File", output_action_export_csv, args);\r\ng_signal_connect(export_csv_win, "destroy", G_CALLBACK(print_destroy_cb), &export_csv_win);\r\n}\r\nvoid\r\nexport_carrays_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_carrays);\r\nreturn;\r\n}\r\nvoid\r\nexport_carrays_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_carrays_args;\r\nif (export_carrays_win != NULL) {\r\nreactivate_window(export_carrays_win);\r\nreturn;\r\n}\r\nif(export_carrays_prefs_init == FALSE) {\r\nexport_carrays_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = FALSE;\r\nargs->print_col_headings = FALSE;\r\nargs->print_dissections = print_dissections_none;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_carrays_win = open_print_dialog("Wireshark: Export as \"C Arrays\" File",\r\noutput_action_export_carrays, args);\r\ng_signal_connect(export_carrays_win, "destroy", G_CALLBACK(print_destroy_cb), &export_carrays_win);\r\n}\r\nvoid\r\nexport_json_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nwin32_export_file(GDK_WINDOW_HWND(gtk_widget_get_window(top_level)), &cfile, export_type_json);\r\nreturn;\r\n}\r\nvoid\r\nexport_json_cmd_cb(GtkWidget *widget _U_, gpointer data _U_)\r\n{\r\nprint_args_t *args = &export_json_args;\r\nif (export_json_win != NULL) {\r\nreactivate_window(export_json_win);\r\nreturn;\r\n}\r\nif(export_json_prefs_init == FALSE) {\r\nexport_json_prefs_init = TRUE;\r\nargs->format = PR_FMT_TEXT;\r\nargs->to_file = TRUE;\r\nargs->file = g_strdup("");\r\nargs->cmd = g_strdup("");\r\nargs->print_summary = TRUE;\r\nargs->print_col_headings = TRUE;\r\nargs->print_dissections = print_dissections_as_displayed;\r\nargs->print_hex = FALSE;\r\nargs->print_formfeed = FALSE;\r\n}\r\npacket_range_init(&args->range, &cfile);\r\nargs->range.process_filtered = TRUE;\r\nexport_json_win = open_print_dialog("Wireshark: Export as \"JSON\" file", output_action_export_json, args);\r\ng_signal_connect(export_json_win, "destroy", G_CALLBACK(print_destroy_cb), &export_json_win);\r\n}\r\nstatic void\r\nprint_browse_file_cb(GtkWidget *file_bt, GtkWidget *file_te)\r\n{\r\nfile_selection_browse(file_bt, file_te, "Wireshark: Print to File",\r\nFILE_SELECTION_WRITE_BROWSE);\r\n}\r\nstatic GtkWidget *\r\nopen_print_dialog(const char *title, output_action_e action, print_args_t *args)\r\n{\r\nGtkWidget *main_win;\r\nGtkWidget *main_vb;\r\nGtkWidget *printer_fr, *printer_vb, *export_format_lb;\r\nGtkWidget *text_rb, *ps_rb, *pdml_rb, *psml_rb, *csv_rb, *carrays_rb, *json_rb;\r\nGtkWidget *printer_grid, *dest_cb;\r\n#ifndef _WIN32\r\nGtkWidget *cmd_lb, *cmd_te;\r\n#endif\r\nGtkWidget *file_bt, *file_te;\r\nGtkWidget *range_fr, *range_grid;\r\nGtkWidget *packet_hb;\r\nGtkWidget *format_fr, *format_vb;\r\nGtkWidget *summary_cb;\r\nGtkWidget *col_headings_cb;\r\nGtkWidget *details_cb;\r\nGtkWidget *details_hb, *details_vb;\r\nGtkWidget *collapse_all_rb, *as_displayed_rb, *expand_all_rb;\r\nGtkWidget *hex_cb;\r\nGtkWidget *sep, *formfeed_cb;\r\nGtkWidget *bbox, *ok_bt, *cancel_bt, *help_bt;\r\nmain_win = dlg_window_new(title);\r\nmain_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 5, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(main_vb), 5);\r\ngtk_container_add(GTK_CONTAINER(main_win), main_vb);\r\ngtk_widget_show(main_vb);\r\nprinter_fr = gtk_frame_new(action == output_action_print ? "Printer" : "Export to file:");\r\ngtk_box_pack_start(GTK_BOX(main_vb), printer_fr, TRUE, TRUE, 0);\r\ngtk_widget_show(printer_fr);\r\nprinter_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 5, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(printer_vb), 5);\r\ngtk_container_add(GTK_CONTAINER(printer_fr), printer_vb);\r\ngtk_widget_show(printer_vb);\r\ntext_rb = gtk_radio_button_new_with_mnemonic_from_widget(NULL, "Plain _text");\r\nif (args->format == PR_FMT_TEXT)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(text_rb), TRUE);\r\ngtk_widget_set_tooltip_text(text_rb, "Print output in ascii \"plain text\" format. If you're unsure, use this format.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), text_rb, FALSE, FALSE, 0);\r\nif(action == output_action_print)\r\ngtk_widget_show(text_rb);\r\nps_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "_PostScript");\r\nif (args->format == PR_FMT_PS)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(ps_rb), TRUE);\r\ngtk_widget_set_tooltip_text(ps_rb, "Print output in \"postscript\" format, for postscript capable printers or print servers.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), ps_rb, FALSE, FALSE, 0);\r\nif(action == output_action_print)\r\ngtk_widget_show(ps_rb);\r\npdml_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "PDM_L (XML: Packet Details Markup Language)");\r\nif (action == output_action_export_pdml)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(pdml_rb), TRUE);\r\ngtk_widget_set_tooltip_text(pdml_rb,\r\n"Print output in \"PDML\" (Packet Details Markup Language), "\r\n"an XML based packet data interchange format. "\r\n"Usually used in combination with the \"Output to file\" option to export packet data into an XML file.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), pdml_rb, FALSE, FALSE, 0);\r\npsml_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "PSML (XML: Packet Summary Markup Language)");\r\nif (action == output_action_export_psml)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(psml_rb), TRUE);\r\ngtk_widget_set_tooltip_text(psml_rb,\r\n"Print output in \"PSML\" (Packet Summary Markup Language), "\r\n"an XML based packet summary interchange format. "\r\n"Usually used in combination with the \"Output to file\" option to export packet data into an XML file.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), psml_rb, FALSE, FALSE, 0);\r\ncsv_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "_CSV");\r\nif (action == output_action_export_csv)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(csv_rb), TRUE);\r\ngtk_widget_set_tooltip_text(csv_rb,\r\n"Print output in \"Comma Separated Values\" (CSV) format, "\r\n"a text format compatible with OpenOffice and Excel. "\r\n"One row for each packet, with its timestamp and size.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), csv_rb, FALSE, FALSE, 0);\r\ncarrays_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "C Arrays");\r\nif (action == output_action_export_carrays)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(carrays_rb), TRUE);\r\ngtk_widget_set_tooltip_text(carrays_rb,\r\n"Print output in C Arrays format, "\r\n"a text file suitable for use in C/C++ programs. "\r\n"One char[] for each packet.");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), carrays_rb, FALSE, FALSE, 0);\r\njson_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(text_rb), "JSON");\r\nif (action == output_action_export_json)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(json_rb), TRUE);\r\ngtk_widget_set_tooltip_text(json_rb,\r\n"Print output \"JavaScript Object Notation\" (JSON).");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), json_rb, FALSE, FALSE, 0);\r\nprinter_grid = ws_gtk_grid_new();\r\ngtk_box_pack_start(GTK_BOX(printer_vb), printer_grid, FALSE, FALSE, 0);\r\nws_gtk_grid_set_row_spacing(GTK_GRID(printer_grid), 5);\r\nws_gtk_grid_set_column_spacing(GTK_GRID(printer_grid), 5);\r\ngtk_widget_show(printer_grid);\r\ndest_cb = gtk_check_button_new_with_mnemonic("Output to _file:");\r\nif (args->to_file)\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(dest_cb), TRUE);\r\ngtk_widget_set_tooltip_text(dest_cb, "Output to file instead of printer");\r\nws_gtk_grid_attach(GTK_GRID(printer_grid), dest_cb, 0, 0, 1, 1);\r\nif(action == output_action_print)\r\ngtk_widget_show(dest_cb);\r\nfile_te = gtk_entry_new();\r\ng_object_set_data(G_OBJECT(dest_cb), PRINT_FILE_TE_KEY, file_te);\r\ngtk_widget_set_tooltip_text(file_te, "Enter Output filename");\r\ngtk_entry_set_text(GTK_ENTRY(file_te), args->file);\r\nws_gtk_grid_attach_extended(GTK_GRID(printer_grid), file_te, 1, 0, 1, 1, (GtkAttachOptions)(GTK_EXPAND|GTK_FILL), (GtkAttachOptions)0, 0, 0);\r\ngtk_widget_set_sensitive(file_te, args->to_file);\r\ngtk_widget_show(file_te);\r\nif (args->to_file)\r\ngtk_widget_grab_focus(file_te);\r\nfile_bt = ws_gtk_button_new_from_stock(WIRESHARK_STOCK_BROWSE);\r\ng_object_set_data(G_OBJECT(dest_cb), PRINT_FILE_BT_KEY, file_bt);\r\ng_object_set_data(G_OBJECT(file_bt), PRINT_TE_PTR_KEY, file_te);\r\ngtk_widget_set_tooltip_text(file_bt, "Browse output filename in filesystem");\r\nws_gtk_grid_attach(GTK_GRID(printer_grid), file_bt, 2, 0, 1, 1);\r\ngtk_widget_set_sensitive(file_bt, args->to_file);\r\ngtk_widget_show(file_bt);\r\n#ifndef _WIN32\r\ncmd_lb = gtk_label_new("Print command:");\r\ng_object_set_data(G_OBJECT(dest_cb), PRINT_CMD_LB_KEY, cmd_lb);\r\ngtk_misc_set_alignment(GTK_MISC(cmd_lb), 1.0f, 0.5f);\r\nws_gtk_grid_attach(GTK_GRID(printer_grid), cmd_lb, 0, 1, 1, 1);\r\ngtk_widget_set_sensitive(cmd_lb, !args->to_file);\r\nif(action == output_action_print)\r\ngtk_widget_show(cmd_lb);\r\ncmd_te = gtk_entry_new();\r\ng_object_set_data(G_OBJECT(dest_cb), PRINT_CMD_TE_KEY, cmd_te);\r\ngtk_widget_set_tooltip_text(cmd_te, "Enter print command");\r\ngtk_entry_set_text(GTK_ENTRY(cmd_te), args->cmd);\r\nws_gtk_grid_attach(GTK_GRID(printer_grid), cmd_te, 1, 1, 1, 1);\r\ngtk_widget_set_sensitive(cmd_te, !args->to_file);\r\nif(action == output_action_print)\r\ngtk_widget_show(cmd_te);\r\n#endif\r\ng_signal_connect(dest_cb, "toggled", G_CALLBACK(print_cmd_toggle_dest), NULL);\r\ng_signal_connect(file_bt, "clicked", G_CALLBACK(print_browse_file_cb), file_te);\r\nif(action == output_action_export_ps) {\r\nexport_format_lb = gtk_label_new("(PostScript files can be easily converted to PDF files using ghostscript's ps2pdf)");\r\ngtk_box_pack_start(GTK_BOX(printer_vb), export_format_lb, FALSE, FALSE, 0);\r\ngtk_widget_show(export_format_lb);\r\n}\r\npacket_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 5, FALSE);\r\ngtk_box_pack_start(GTK_BOX(main_vb), packet_hb, TRUE, TRUE, 0);\r\ngtk_widget_show(packet_hb);\r\nrange_fr = gtk_frame_new("Packet Range");\r\ngtk_box_pack_start(GTK_BOX(packet_hb), range_fr, FALSE, FALSE, 0);\r\ngtk_widget_show(range_fr);\r\nrange_grid = range_new(&args->range, FALSE);\r\ngtk_container_add(GTK_CONTAINER(range_fr), range_grid);\r\ngtk_widget_show(range_grid);\r\nformat_fr = gtk_frame_new("Packet Format");\r\ngtk_box_pack_start(GTK_BOX(packet_hb), format_fr, TRUE, TRUE, 0);\r\nif( action == output_action_print ||\r\naction == output_action_export_text ||\r\naction == output_action_export_ps)\r\ngtk_widget_show(format_fr);\r\nformat_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 5, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(format_vb), 5);\r\ngtk_container_add(GTK_CONTAINER(format_fr), format_vb);\r\ngtk_widget_show(format_vb);\r\nsummary_cb = gtk_check_button_new_with_mnemonic("Packet summary line");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(summary_cb), args->print_summary);\r\ng_signal_connect(summary_cb, "clicked", G_CALLBACK(print_cmd_toggle_detail), main_win);\r\ngtk_widget_set_tooltip_text(summary_cb, "Output of a packet summary line, like in the packet list");\r\ngtk_box_pack_start(GTK_BOX(format_vb), summary_cb, TRUE, TRUE, 0);\r\ngtk_widget_show(summary_cb);\r\ncol_headings_cb = gtk_check_button_new_with_mnemonic("Include column headings");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(col_headings_cb), args->print_col_headings);\r\ngtk_widget_set_sensitive(col_headings_cb, args->print_summary);\r\ng_signal_connect(col_headings_cb, "clicked", G_CALLBACK(print_cmd_toggle_detail), main_win);\r\ngtk_widget_set_tooltip_text(col_headings_cb, "Include column headings when printing the packet summary line");\r\ngtk_box_pack_start(GTK_BOX(format_vb), col_headings_cb, TRUE, TRUE, 0);\r\ngtk_widget_show(col_headings_cb);\r\ndetails_cb = gtk_check_button_new_with_mnemonic("Packet details:");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(details_cb), args->print_dissections != print_dissections_none);\r\ng_signal_connect(details_cb, "clicked", G_CALLBACK(print_cmd_toggle_detail), main_win);\r\ngtk_widget_set_tooltip_text(details_cb, "Output format of the selected packet details (protocol tree).");\r\ngtk_box_pack_start(GTK_BOX(format_vb), details_cb, TRUE, TRUE, 0);\r\ngtk_widget_show(details_cb);\r\ndetails_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 6, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(details_hb), 0);\r\ngtk_box_pack_start(GTK_BOX(format_vb), details_hb, TRUE, TRUE, 0);\r\ngtk_widget_show(details_hb);\r\ndetails_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 6, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(details_vb), 0);\r\ngtk_box_pack_start(GTK_BOX(details_hb), details_vb, FALSE, FALSE, 10);\r\ngtk_widget_show(details_vb);\r\ndetails_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 6, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(details_vb), 0);\r\ngtk_box_pack_start(GTK_BOX(details_hb), details_vb, FALSE, FALSE, 0);\r\ngtk_widget_show(details_vb);\r\ncollapse_all_rb = gtk_radio_button_new_with_mnemonic_from_widget(NULL, "All co_llapsed");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(collapse_all_rb), args->print_dissections == print_dissections_collapsed);\r\ngtk_widget_set_sensitive(collapse_all_rb, args->print_dissections != print_dissections_none);\r\ngtk_widget_set_tooltip_text(collapse_all_rb, "Output of the packet details tree \"collapsed\"");\r\ngtk_box_pack_start(GTK_BOX(details_vb), collapse_all_rb, TRUE, TRUE, 0);\r\ngtk_widget_show(collapse_all_rb);\r\nas_displayed_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(collapse_all_rb), "As displa_yed");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(as_displayed_rb), args->print_dissections == print_dissections_as_displayed);\r\ngtk_widget_set_sensitive(as_displayed_rb, args->print_dissections != print_dissections_none);\r\ngtk_widget_set_tooltip_text(as_displayed_rb, "Output of the packet details tree \"as displayed\"");\r\ngtk_box_pack_start(GTK_BOX(details_vb), as_displayed_rb, TRUE, TRUE, 0);\r\ngtk_widget_show(as_displayed_rb);\r\nexpand_all_rb = gtk_radio_button_new_with_mnemonic_from_widget(GTK_RADIO_BUTTON(collapse_all_rb), "All e_xpanded");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(expand_all_rb), args->print_dissections == print_dissections_expanded);\r\ngtk_widget_set_sensitive(expand_all_rb, args->print_dissections != print_dissections_none);\r\ngtk_widget_set_tooltip_text(expand_all_rb, "Output of the packet details tree \"expanded\"");\r\ngtk_box_pack_start(GTK_BOX(details_vb), expand_all_rb, TRUE, TRUE, 0);\r\ngtk_widget_show(expand_all_rb);\r\nhex_cb = gtk_check_button_new_with_mnemonic("Packet bytes");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(hex_cb), args->print_hex);\r\ng_signal_connect(hex_cb, "clicked", G_CALLBACK(print_cmd_toggle_detail), main_win);\r\ngtk_widget_set_tooltip_text(hex_cb, "Add a hexdump of the packet data");\r\ngtk_box_pack_start(GTK_BOX(format_vb), hex_cb, TRUE, TRUE, 0);\r\ngtk_widget_show(hex_cb);\r\nsep = gtk_separator_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(format_vb), sep, TRUE, TRUE, 0);\r\ngtk_widget_show(sep);\r\nformfeed_cb = gtk_check_button_new_with_mnemonic("Each packet on a new page");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(formfeed_cb), args->print_formfeed);\r\ngtk_widget_set_tooltip_text (formfeed_cb, "When checked, a new page will be used for each packet. "\r\n"This is done by adding a formfeed (or similar) between the packet outputs.");\r\ngtk_box_pack_start(GTK_BOX(format_vb), formfeed_cb, TRUE, TRUE, 0);\r\ngtk_widget_show(formfeed_cb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_ARGS_KEY, args);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_SUMMARY_CB_KEY, summary_cb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_COL_HEADINGS_CB_KEY, col_headings_cb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_DETAILS_CB_KEY, details_cb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_COLLAPSE_ALL_RB_KEY, collapse_all_rb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_AS_DISPLAYED_RB_KEY, as_displayed_rb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_EXPAND_ALL_RB_KEY, expand_all_rb);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_HEX_CB_KEY, hex_cb);\r\nbbox = dlg_button_row_new(action == output_action_print ? GTK_STOCK_PRINT : GTK_STOCK_OK, GTK_STOCK_CANCEL, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_start(GTK_BOX(main_vb), bbox, FALSE, FALSE, 0);\r\ngtk_widget_show(bbox);\r\nok_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), action == output_action_print ? GTK_STOCK_PRINT : GTK_STOCK_OK);\r\ng_object_set_data(G_OBJECT(main_win), PRINT_BT_KEY, ok_bt);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_PS_RB_KEY, ps_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_PDML_RB_KEY, pdml_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_PSML_RB_KEY, psml_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_CSV_RB_KEY, csv_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_CARRAYS_RB_KEY, carrays_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_JSON_RB_KEY, json_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_DEST_CB_KEY, dest_cb);\r\n#ifndef _WIN32\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_CMD_TE_KEY, cmd_te);\r\n#endif\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_ARGS_KEY, args);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_FILE_TE_KEY, file_te);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_SUMMARY_CB_KEY, summary_cb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_COL_HEADINGS_CB_KEY, col_headings_cb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_DETAILS_CB_KEY, details_cb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_COLLAPSE_ALL_RB_KEY, collapse_all_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_AS_DISPLAYED_RB_KEY, as_displayed_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_EXPAND_ALL_RB_KEY, expand_all_rb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_HEX_CB_KEY, hex_cb);\r\ng_object_set_data(G_OBJECT(ok_bt), PRINT_FORMFEED_CB_KEY, formfeed_cb);\r\ng_signal_connect(ok_bt, "clicked", G_CALLBACK(print_ok_cb), main_win);\r\ngtk_widget_set_tooltip_text (ok_bt, "Start output");\r\ncancel_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_CANCEL);\r\nwindow_set_cancel_button(main_win, cancel_bt, window_cancel_button_cb);\r\ngtk_widget_set_tooltip_text (cancel_bt, "Cancel and exit dialog");\r\nif(action == output_action_print) {\r\nhelp_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer)HELP_PRINT_DIALOG);\r\n} else {\r\n#ifdef _WIN32\r\nhelp_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer)HELP_EXPORT_FILE_WIN32_DIALOG);\r\n#else\r\nhelp_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer)HELP_EXPORT_FILE_DIALOG);\r\n#endif\r\n}\r\ngtk_widget_grab_default(ok_bt);\r\n#ifndef _WIN32\r\ndlg_set_activate(cmd_te, ok_bt);\r\n#endif\r\nif(action != output_action_print)\r\ndlg_set_activate(file_te, ok_bt);\r\ng_signal_connect(main_win, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ngtk_widget_show(main_win);\r\nwindow_present(main_win);\r\nreturn main_win;\r\n}\r\nstatic void\r\nprint_cmd_toggle_dest(GtkWidget *widget, gpointer data _U_)\r\n{\r\n#ifndef _WIN32\r\nGtkWidget *cmd_lb, *cmd_te;\r\n#endif\r\nGtkWidget *file_bt, *file_te;\r\nint to_file;\r\n#ifndef _WIN32\r\ncmd_lb = GTK_WIDGET(g_object_get_data(G_OBJECT(widget), PRINT_CMD_LB_KEY));\r\ncmd_te = GTK_WIDGET(g_object_get_data(G_OBJECT(widget), PRINT_CMD_TE_KEY));\r\n#endif\r\nfile_bt = GTK_WIDGET(g_object_get_data(G_OBJECT(widget), PRINT_FILE_BT_KEY));\r\nfile_te = GTK_WIDGET(g_object_get_data(G_OBJECT(widget), PRINT_FILE_TE_KEY));\r\nto_file = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (widget));\r\n#ifndef _WIN32\r\ngtk_widget_set_sensitive(cmd_lb, !to_file);\r\ngtk_widget_set_sensitive(cmd_te, !to_file);\r\n#endif\r\ngtk_widget_set_sensitive(file_bt, to_file);\r\ngtk_widget_set_sensitive(file_te, to_file);\r\n}\r\nstatic void\r\nprint_cmd_toggle_detail(GtkWidget *widget _U_, gpointer data)\r\n{\r\nGtkWidget *print_bt, *summary_cb, *col_headings_cb, *details_cb;\r\nGtkWidget *collapse_all_rb, *expand_all_rb, *as_displayed_rb, *hex_cb;\r\ngboolean print_detail, print_summary;\r\nprint_bt = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_BT_KEY));\r\nsummary_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_SUMMARY_CB_KEY));\r\ncol_headings_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_COL_HEADINGS_CB_KEY));\r\ndetails_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_DETAILS_CB_KEY));\r\ncollapse_all_rb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_COLLAPSE_ALL_RB_KEY));\r\nas_displayed_rb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_AS_DISPLAYED_RB_KEY));\r\nexpand_all_rb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_EXPAND_ALL_RB_KEY));\r\nhex_cb = GTK_WIDGET(g_object_get_data(G_OBJECT(data), PRINT_HEX_CB_KEY));\r\nprint_summary = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (summary_cb));\r\ngtk_widget_set_sensitive(col_headings_cb, print_summary);\r\nprint_detail = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (details_cb));\r\ngtk_widget_set_sensitive(collapse_all_rb, print_detail);\r\ngtk_widget_set_sensitive(as_displayed_rb, print_detail);\r\ngtk_widget_set_sensitive(expand_all_rb, print_detail);\r\ngtk_widget_set_sensitive(print_bt,\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (summary_cb)) ||\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (details_cb)) ||\r\ngtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (hex_cb)));\r\n}\r\nstatic void\r\nprint_ok_cb(GtkWidget *ok_bt, gpointer parent_w)\r\n{\r\nGtkWidget *button;\r\nprint_args_t *args;\r\nconst gchar *g_dest;\r\ngchar *f_name;\r\ngchar *dirname;\r\ngboolean export_as_pdml = FALSE, export_as_psml = FALSE;\r\ngboolean export_as_csv = FALSE, export_as_json = FALSE;\r\ngboolean export_as_carrays = FALSE;\r\n#ifdef _WIN32\r\ngboolean win_printer = FALSE;\r\nint tmp_fd;\r\nchar *tmp_namebuf;\r\nchar *tmp_oldfile = NULL;\r\n#endif\r\ncf_print_status_t status;\r\nargs = (print_args_t *)g_object_get_data(G_OBJECT(ok_bt), PRINT_ARGS_KEY);\r\nif (!range_check_validity(&args->range)) {\r\nreturn;\r\n}\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_DEST_CB_KEY);\r\nargs->to_file = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button));\r\nif (args->to_file) {\r\ng_dest = gtk_entry_get_text(GTK_ENTRY(g_object_get_data(G_OBJECT(ok_bt),\r\nPRINT_FILE_TE_KEY)));\r\nif (!g_dest[0]) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Output to file, but no file specified.");\r\nreturn;\r\n}\r\ng_free(args->file);\r\nargs->file = g_strdup(g_dest);\r\nf_name = g_strdup(g_dest);\r\ndirname = get_dirname(f_name);\r\nset_last_open_dir(dirname);\r\ng_free(f_name);\r\n} else {\r\n#ifdef _WIN32\r\nwin_printer = TRUE;\r\ntmp_fd = create_tempfile(&tmp_namebuf, "wshprint", NULL);\r\nif(tmp_fd == -1) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Couldn't create a temporary file for printing:\n%s", tmp_namebuf);\r\nreturn;\r\n}\r\ntmp_oldfile = args->file;\r\nargs->file = g_strdup(tmp_namebuf);\r\nws_unlink(args->file);\r\nargs->to_file = TRUE;\r\n#else\r\ng_free(args->cmd);\r\nargs->cmd = g_strdup(gtk_entry_get_text(GTK_ENTRY(g_object_get_data(G_OBJECT(ok_bt),\r\nPRINT_CMD_TE_KEY))));\r\n#endif\r\n}\r\nargs->format = PR_FMT_TEXT;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_PS_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nargs->format = PR_FMT_PS;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_PDML_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nexport_as_pdml = TRUE;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_PSML_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nexport_as_psml = TRUE;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_CSV_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nexport_as_csv = TRUE;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_CARRAYS_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nexport_as_carrays = TRUE;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_JSON_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button)))\r\nexport_as_json = TRUE;\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_SUMMARY_CB_KEY);\r\nargs->print_summary = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button));\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_COL_HEADINGS_CB_KEY);\r\nargs->print_col_headings = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button));\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_COLLAPSE_ALL_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button))) {\r\nargs->print_dissections = print_dissections_collapsed;\r\n}\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_AS_DISPLAYED_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button))) {\r\nargs->print_dissections = print_dissections_as_displayed;\r\n}\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_EXPAND_ALL_RB_KEY);\r\nif (gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button))) {\r\nargs->print_dissections = print_dissections_expanded;\r\n}\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_DETAILS_CB_KEY);\r\nif (!gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button))) {\r\nargs->print_dissections = print_dissections_none;\r\n}\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_HEX_CB_KEY);\r\nargs->print_hex = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button));\r\nbutton = (GtkWidget *)g_object_get_data(G_OBJECT(ok_bt), PRINT_FORMFEED_CB_KEY);\r\nargs->print_formfeed = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON (button));\r\nwindow_destroy(GTK_WIDGET(parent_w));\r\nif (export_as_pdml)\r\nstatus = cf_write_pdml_packets(&cfile, args);\r\nelse if (export_as_psml)\r\nstatus = cf_write_psml_packets(&cfile, args);\r\nelse if (export_as_csv)\r\nstatus = cf_write_csv_packets(&cfile, args);\r\nelse if (export_as_carrays)\r\nstatus = cf_write_carrays_packets(&cfile, args);\r\nelse if (export_as_json)\r\nstatus = cf_write_json_packets(&cfile, args);\r\nelse {\r\nswitch (args->format) {\r\ncase PR_FMT_TEXT:\r\nif (args->to_file) {\r\nargs->stream = print_stream_text_new(TRUE, args->file);\r\nif (args->stream == NULL) {\r\nopen_failure_alert_box(args->file, errno, TRUE);\r\nreturn;\r\n}\r\n} else {\r\nargs->stream = print_stream_text_new(FALSE, args->cmd);\r\nif (args->stream == NULL) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Couldn't run print command %s.", args->cmd);\r\n}\r\n}\r\nbreak;\r\ncase PR_FMT_PS:\r\nif (args->to_file) {\r\nargs->stream = print_stream_ps_new(TRUE, args->file);\r\nif (args->stream == NULL) {\r\nopen_failure_alert_box(args->file, errno, TRUE);\r\nreturn;\r\n}\r\n} else {\r\nargs->stream = print_stream_ps_new(FALSE, args->cmd);\r\nif (args->stream == NULL) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Couldn't run print command %s.", args->cmd);\r\n}\r\n}\r\nbreak;\r\ndefault:\r\ng_assert_not_reached();\r\nreturn;\r\n}\r\nstatus = cf_print_packets(&cfile, args, TRUE);\r\n}\r\nswitch (status) {\r\ncase CF_PRINT_OK:\r\nbreak;\r\ncase CF_PRINT_OPEN_ERROR:\r\nif (args->to_file)\r\nopen_failure_alert_box(args->file, errno, TRUE);\r\nelse\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "Couldn't run print command %s.",\r\nargs->cmd);\r\nbreak;\r\ncase CF_PRINT_WRITE_ERROR:\r\nif (args->to_file)\r\nwrite_failure_alert_box(args->file, errno);\r\nelse\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Error writing to print command: %s", g_strerror(errno));\r\nbreak;\r\n}\r\n#ifdef _WIN32\r\nif (win_printer) {\r\nprint_mswin(args->file);\r\nws_remove(args->file);\r\ng_free(args->file);\r\nargs->to_file = FALSE;\r\nargs->file = tmp_oldfile;\r\n}\r\n#endif\r\n}\r\nstatic void\r\nprint_destroy_cb(GtkWidget *win, gpointer user_data)\r\n{\r\nGtkWidget *fs;\r\nfs = (GtkWidget *)g_object_get_data(G_OBJECT(win), E_FILE_SEL_DIALOG_PTR_KEY);\r\nif (fs != NULL) {\r\nwindow_destroy(fs);\r\n}\r\n*((gpointer *) user_data) = NULL;\r\n}
