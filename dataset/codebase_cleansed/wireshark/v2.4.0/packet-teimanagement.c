static int\r\ndissect_teimanagement(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *tei_tree = NULL;\r\nproto_item *tei_ti;\r\nguint8 message;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "TEI");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tree) {\r\ntei_ti = proto_tree_add_item(tree, proto_tei, tvb, 0, 5, ENC_NA);\r\ntei_tree = proto_item_add_subtree(tei_ti, lm_subtree);\r\nproto_tree_add_item(tei_tree, lm_entity_id, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tei_tree, lm_reference, tvb, 1, 2, ENC_BIG_ENDIAN);\r\n}\r\nmessage = tvb_get_guint8(tvb, 3);\r\ncol_add_str(pinfo->cinfo, COL_INFO,\r\nval_to_str(message, tei_msg_vals, "Unknown message type (0x%04x)"));\r\nif (tree) {\r\nproto_tree_add_uint(tei_tree, lm_message, tvb, 3, 1, message);\r\nproto_tree_add_item(tei_tree, lm_action, tvb, 4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tei_tree, lm_extend, tvb, 4, 1, ENC_BIG_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_teimanagement(void)\r\n{\r\nstatic gint *subtree[]={\r\n&lm_subtree\r\n};\r\nstatic hf_register_info hf[] = {\r\n{ &lm_entity_id,\r\n{ "Entity", "tei.entity", FT_UINT8, BASE_HEX, NULL, 0x0,\r\n"Layer Management Entity Identifier", HFILL }},\r\n{ &lm_reference,\r\n{ "Reference", "tei.reference", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Reference Number", HFILL }},\r\n{ &lm_message,\r\n{ "Msg", "tei.msg", FT_UINT8, BASE_DEC, VALS(tei_msg_vals), 0x0,\r\n"Message Type", HFILL }},\r\n{ &lm_action,\r\n{ "Action", "tei.action", FT_UINT8, BASE_DEC, NULL, 0xfe,\r\n"Action Indicator", HFILL }},\r\n{ &lm_extend,\r\n{ "Extend", "tei.extend", FT_UINT8, BASE_DEC, NULL, 0x01,\r\n"Extension Indicator", HFILL }}\r\n};\r\nproto_tei = proto_register_protocol("TEI Management Procedure, Channel D (LAPD)",\r\n"TEI_MANAGEMENT", "tei_management");\r\nproto_register_field_array (proto_tei, hf, array_length(hf));\r\nproto_register_subtree_array(subtree, array_length(subtree));\r\n}\r\nvoid\r\nproto_reg_handoff_teimanagement(void)\r\n{\r\ndissector_handle_t teimanagement_handle;\r\nteimanagement_handle = create_dissector_handle(dissect_teimanagement,\r\nproto_tei);\r\ndissector_add_uint("lapd.sapi", LAPD_SAPI_L2, teimanagement_handle);\r\n}
