void\r\nxmpp_jingle(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *jingle_item;\r\nproto_tree *jingle_tree;\r\nstatic const gchar *rtp_info_msgs[] = {"active", "hold", "mute", "ringing", "unhold", "unmute"};\r\nstatic const gchar *action_enums[] = {"content-accept","content-add", "content-modify",\r\n"content-modify", "content-remove", "description-info", "security-info",\r\n"session-accept", "session-info", "session-initiate", "session-terminate",\r\n"transport-accept", "transport-info", "transport-reject", "transport-replace"\r\n};\r\nxmpp_array_t *action_array = xmpp_ep_init_array_t(action_enums,array_length(action_enums));\r\nxmpp_array_t *rtp_info_array = xmpp_ep_init_array_t(rtp_info_msgs, array_length(rtp_info_msgs));\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, FALSE, NULL, NULL},\r\n{"action", &hf_xmpp_jingle_action, TRUE, TRUE, xmpp_val_enum_list, action_array},\r\n{"sid", &hf_xmpp_jingle_sid, TRUE, FALSE, NULL, NULL},\r\n{"initiator", &hf_xmpp_jingle_initiator, FALSE, FALSE, NULL, NULL},\r\n{"responder", &hf_xmpp_jingle_responder, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "content", xmpp_jingle_content, MANY},\r\n{NAME, "reason", xmpp_jingle_reason, MANY},\r\n{NAMES, rtp_info_array, xmpp_jingle_rtp_info, ONE},\r\n{NAME, "conference-info", xmpp_conferece_info_advert, ONE}\r\n};\r\nxmpp_attr_t *action = xmpp_get_attr(element,"action");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "JINGLE(%s) ", action?action->value:"");\r\njingle_item = proto_tree_add_item(tree, hf_xmpp_jingle, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\njingle_tree = proto_item_add_subtree(jingle_item, ett_xmpp_jingle);\r\nxmpp_display_attrs(jingle_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(jingle_item, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_content(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *content_item;\r\nproto_tree *content_tree;\r\nstatic const gchar *creator_enums[] = {"initiator","responder"};\r\nxmpp_array_t *creator_enums_array = xmpp_ep_init_array_t(creator_enums,array_length(creator_enums));\r\nxmpp_attr_info attrs_info[] = {\r\n{"creator", &hf_xmpp_jingle_content_creator, TRUE, FALSE, xmpp_val_enum_list, creator_enums_array},\r\n{"name", &hf_xmpp_jingle_content_name, TRUE, TRUE, NULL, NULL},\r\n{"disposition", &hf_xmpp_jingle_content_disposition, FALSE, FALSE, NULL, NULL},\r\n{"senders", &hf_xmpp_jingle_content_senders, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("description", "xmlns", "urn:xmpp:jingle:apps:rtp:1"), xmpp_jingle_content_description_rtp, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("description", "xmlns", "urn:xmpp:jingle:apps:file-transfer:3"), xmpp_jingle_file_transfer_desc, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "urn:xmpp:jingle:transports:ice-udp:1"), xmpp_jingle_cont_trans_ice, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "urn:xmpp:jingle:transports:raw-udp:1"), xmpp_jingle_cont_trans_raw, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "urn:xmpp:jingle:transports:s5b:1"), xmpp_jingle_cont_trans_s5b, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "urn:xmpp:jingle:transports:ibb:1"), xmpp_jingle_cont_trans_ibb, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("transport", "xmlns", "http://www.google.com/transport/p2p"), xmpp_gtalk_transport_p2p, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("received", "xmlns", "urn:xmpp:jingle:apps:file-transfer:3"), xmpp_jingle_file_transfer_received, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("abort", "xmlns", "urn:xmpp:jingle:apps:file-transfer:3"), xmpp_jingle_file_transfer_abort, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("checksum", "xmlns", "urn:xmpp:jingle:apps:file-transfer:3"), xmpp_jingle_file_transfer_checksum, MANY},\r\n{NAME_AND_ATTR, xmpp_name_attr_struct("inputevt", "xmlns","http://jitsi.org/protocol/inputevt"), xmpp_jitsi_inputevt, ONE},\r\n};\r\ncontent_item = proto_tree_add_item(tree, hf_xmpp_jingle_content, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ncontent_tree = proto_item_add_subtree(content_item, ett_xmpp_jingle_content);\r\nxmpp_display_attrs(content_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(content_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_reason(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *reason_item;\r\nproto_tree *reason_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"condition", &hf_xmpp_jingle_reason_condition, TRUE, TRUE, NULL, NULL},\r\n{"sid", NULL, FALSE, TRUE, NULL, NULL},\r\n{"rtp-error", NULL, FALSE, TRUE, NULL, NULL},\r\n{"text", &hf_xmpp_jingle_reason_text, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_element_t *condition;\r\nxmpp_element_t *text;\r\nxmpp_element_t *rtp_error;\r\nstatic const gchar *reason_names[] = { "success", "busy", "failed-application", "cancel", "connectivity-error",\r\n"decline", "expired", "failed-transport", "general-error", "gone", "incompatible-parameters",\r\n"media-error", "security-error", "timeout", "unsupported-applications", "unsupported-transports"};\r\nstatic const gchar *rtp_error_names[] = {"crypto-required", "invalid-crypto"};\r\nreason_item = proto_tree_add_item(tree, hf_xmpp_jingle_reason, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nreason_tree = proto_item_add_subtree(reason_item, ett_xmpp_jingle_reason);\r\nif((condition = xmpp_steal_element_by_names(element, reason_names, array_length(reason_names)))!=NULL)\r\n{\r\nxmpp_attr_t *fake_cond = xmpp_ep_init_attr_t(condition->name, condition->offset, condition->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"condition", fake_cond);\r\n} else if((condition = xmpp_steal_element_by_name(element, "alternative-session"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_cond,*fake_alter_sid;\r\nxmpp_element_t *sid;\r\nfake_cond = xmpp_ep_init_attr_t(condition->name, condition->offset, condition->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"condition", fake_cond);\r\nif((sid = xmpp_steal_element_by_name(condition, "sid"))!=NULL)\r\n{\r\nfake_alter_sid = xmpp_ep_init_attr_t(sid->name, sid->offset, sid->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"sid", fake_alter_sid);\r\n}\r\n}\r\nif((rtp_error = xmpp_steal_element_by_names(element, rtp_error_names, array_length(rtp_error_names)))!=NULL)\r\n{\r\nxmpp_attr_t *fake_rtp_error = xmpp_ep_init_attr_t(rtp_error->name, rtp_error->offset, rtp_error->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"rtp-error", fake_rtp_error);\r\n}\r\nif((text = xmpp_steal_element_by_name(element, "text"))!=NULL)\r\n{\r\nxmpp_attr_t *fake_text = xmpp_ep_init_attr_t(text->data?text->data->value:"", text->offset, text->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"text", fake_text);\r\n}\r\nxmpp_display_attrs(reason_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(reason_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_content_description_rtp(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *desc_item;\r\nproto_tree *desc_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL},\r\n{"media", &hf_xmpp_jingle_content_description_media, TRUE, TRUE, NULL, NULL},\r\n{"ssrc", &hf_xmpp_jingle_content_description_ssrc , FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "payload-type", xmpp_jingle_cont_desc_rtp_payload, MANY},\r\n{NAME, "bandwidth", xmpp_jingle_cont_desc_rtp_bandwidth, ONE},\r\n{NAME, "encryption", xmpp_jingle_cont_desc_rtp_enc, ONE},\r\n{NAME, "rtp-hdrext", xmpp_jingle_cont_desc_rtp_hdrext, MANY},\r\n{NAME, "zrtp-hash", xmpp_jingle_cont_desc_rtp_enc_zrtp_hash, MANY}\r\n};\r\ndesc_item = proto_tree_add_item(tree, hf_xmpp_jingle_content_description, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ndesc_tree = proto_item_add_subtree(desc_item, ett_xmpp_jingle_content_description);\r\nxmpp_display_attrs(desc_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(desc_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_payload(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *payload_item;\r\nproto_tree *payload_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"id", &hf_xmpp_jingle_cont_desc_payload_id, TRUE, TRUE, NULL, NULL},\r\n{"channels", &hf_xmpp_jingle_cont_desc_payload_channels, FALSE, FALSE, NULL, NULL},\r\n{"clockrate", &hf_xmpp_jingle_cont_desc_payload_clockrate, FALSE, FALSE, NULL, NULL},\r\n{"maxptime", &hf_xmpp_jingle_cont_desc_payload_maxptime, FALSE, FALSE, NULL, NULL},\r\n{"name", &hf_xmpp_jingle_cont_desc_payload_name, FALSE, TRUE, NULL, NULL},\r\n{"ptime", &hf_xmpp_jingle_cont_desc_payload_ptime, FALSE, FALSE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] =\r\n{\r\n{NAME, "parameter", xmpp_jingle_cont_desc_rtp_payload_param, MANY}\r\n};\r\npayload_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_payload, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\npayload_tree = proto_item_add_subtree(payload_item, ett_xmpp_jingle_cont_desc_payload);\r\nxmpp_display_attrs(payload_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(payload_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_payload_param(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *param_item;\r\nproto_tree *param_tree;\r\nproto_item *parent_item;\r\nxmpp_attr_t *name, *value;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"name", &hf_xmpp_jingle_cont_desc_payload_param_name, TRUE, TRUE, NULL, NULL},\r\n{"value", &hf_xmpp_jingle_cont_desc_payload_param_value, TRUE, TRUE, NULL, NULL}\r\n};\r\nname = xmpp_get_attr(element, "name");\r\nvalue = xmpp_get_attr(element, "value");\r\nif(name && value)\r\n{\r\ngchar *parent_item_label;\r\nparent_item = proto_tree_get_parent(tree);\r\nparent_item_label = proto_item_get_text(parent_item);\r\nif(parent_item_label)\r\n{\r\nparent_item_label[strlen(parent_item_label)-1]= '\0';\r\nproto_item_set_text(parent_item, "%s param(\"%s\")=%s]", parent_item_label ,name->value, value->value);\r\n}\r\n}\r\nparam_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_payload_param, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nparam_tree = proto_item_add_subtree(param_item, ett_xmpp_jingle_cont_desc_payload_param);\r\nxmpp_display_attrs(param_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(param_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_enc(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *enc_item;\r\nproto_tree *enc_tree;\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "zrtp-hash", xmpp_jingle_cont_desc_rtp_enc_zrtp_hash, MANY},\r\n{NAME, "crypto", xmpp_jingle_cont_desc_rtp_enc_crypto, MANY}\r\n};\r\nenc_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_enc, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nenc_tree = proto_item_add_subtree(enc_item, ett_xmpp_jingle_cont_desc_enc);\r\nxmpp_display_attrs(enc_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(enc_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_enc_zrtp_hash(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *zrtp_hash_item;\r\nproto_tree *zrtp_hash_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"version", NULL, TRUE, TRUE,NULL,NULL},\r\n{"hash", NULL, TRUE, FALSE, NULL, NULL}\r\n};\r\nzrtp_hash_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_enc_zrtp_hash, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nzrtp_hash_tree = proto_item_add_subtree(zrtp_hash_item, ett_xmpp_jingle_cont_desc_enc_zrtp_hash);\r\nif(element->data)\r\n{\r\nxmpp_attr_t *fake_hash = xmpp_ep_init_attr_t(element->data->value, element->offset, element->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"hash", fake_hash);\r\n}\r\nxmpp_display_attrs(zrtp_hash_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(zrtp_hash_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_enc_crypto(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *crypto_item;\r\nproto_tree *crypto_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"crypto-suite", NULL, TRUE, TRUE, NULL, NULL},\r\n{"key-params", NULL, TRUE, FALSE,NULL,NULL},\r\n{"session-params", NULL, FALSE, TRUE, NULL, NULL},\r\n{"tag", NULL, TRUE, FALSE, NULL, NULL}\r\n};\r\ncrypto_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_enc_crypto, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ncrypto_tree = proto_item_add_subtree(crypto_item, ett_xmpp_jingle_cont_desc_enc_crypto);\r\nxmpp_display_attrs(crypto_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(crypto_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_bandwidth(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *bandwidth_item;\r\nproto_tree *bandwidth_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"type", NULL, TRUE, TRUE, NULL, NULL},\r\n{"value", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nbandwidth_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_bandwidth, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nbandwidth_tree = proto_item_add_subtree(bandwidth_item, ett_xmpp_jingle_cont_desc_bandwidth);\r\nif(element->data)\r\n{\r\nxmpp_attr_t *fake_value = xmpp_ep_init_attr_t(element->data->value, element->offset, element->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"value", fake_value);\r\n}\r\nxmpp_display_attrs(bandwidth_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(bandwidth_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_desc_rtp_hdrext(proto_tree* tree, tvbuff_t* tvb, packet_info *pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *rtp_hdr_item;\r\nproto_tree *rtp_hdr_tree;\r\nstatic const gchar *senders[] = {"both", "initiator", "responder"};\r\nxmpp_array_t *senders_enums = xmpp_ep_init_array_t(senders, 3);\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"id", NULL, TRUE, FALSE, NULL, NULL},\r\n{"uri", NULL, TRUE, TRUE, NULL, NULL},\r\n{"senders", NULL, FALSE, TRUE, xmpp_val_enum_list, senders_enums},\r\n{"parameter", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_element_t *parameter;\r\nrtp_hdr_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_desc_rtp_hdr, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nrtp_hdr_tree = proto_item_add_subtree(rtp_hdr_item, ett_xmpp_jingle_cont_desc_rtp_hdr);\r\nif((parameter = xmpp_steal_element_by_name(element, "parameter"))!=NULL)\r\n{\r\nxmpp_attr_t *name = xmpp_get_attr(element, "name");\r\nxmpp_attr_t *fake_attr = xmpp_ep_init_attr_t(name?name->value:"", parameter->offset, parameter->length);\r\ng_hash_table_insert(element->attrs, (gpointer)"parameter", fake_attr);\r\n}\r\nxmpp_display_attrs(rtp_hdr_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(rtp_hdr_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_rtp_info(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *rtp_info_item;\r\nproto_tree *rtp_info_tree;\r\nstatic const gchar *creator[] = {"initiator","responder"};\r\nxmpp_array_t *creator_enums = xmpp_ep_init_array_t(creator, array_length(creator));\r\nxmpp_attr_info mute_attrs_info[] = {\r\n{"creator", NULL, TRUE, TRUE, xmpp_val_enum_list, creator_enums},\r\n{"name", NULL, TRUE, TRUE, NULL, NULL}\r\n};\r\nrtp_info_item = proto_tree_add_string(tree, hf_xmpp_jingle_rtp_info, tvb, element->offset, element->length, element->name);\r\nrtp_info_tree = proto_item_add_subtree(rtp_info_item, ett_xmpp_jingle_rtp_info);\r\nif(strcmp("mute", element->name) == 0 || strcmp("unmute", element->name) == 0)\r\nxmpp_display_attrs(rtp_info_tree, element, pinfo, tvb, mute_attrs_info, array_length(mute_attrs_info));\r\nxmpp_unknown(rtp_info_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_ice(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *trans_item;\r\nproto_tree *trans_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL},\r\n{"pwd", &hf_xmpp_jingle_cont_trans_pwd, FALSE, FALSE, NULL, NULL},\r\n{"ufrag", &hf_xmpp_jingle_cont_trans_ufrag, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "candidate", xmpp_jingle_cont_trans_ice_candidate, MANY},\r\n{NAME, "remote-candidate", xmpp_jingle_cont_trans_ice_remote_candidate, ONE}\r\n};\r\ntrans_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ntrans_tree = proto_item_add_subtree(trans_item, ett_xmpp_jingle_cont_trans);\r\nxmpp_display_attrs(trans_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(trans_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_ice_candidate(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *cand_item;\r\nproto_tree *cand_tree;\r\nstatic const gchar *type_enums[] = {"host", "prflx", "relay", "srflx"};\r\nxmpp_array_t *type_enums_array = xmpp_ep_init_array_t(type_enums,array_length(type_enums));\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"component", NULL, TRUE, FALSE, NULL, NULL},\r\n{"foundation", NULL, TRUE, FALSE, NULL, NULL},\r\n{"generation", NULL, TRUE, FALSE, NULL, NULL},\r\n{"id", NULL, FALSE, FALSE, NULL, NULL},\r\n{"ip", NULL, TRUE, TRUE, NULL, NULL},\r\n{"network", NULL, TRUE, FALSE, NULL, NULL},\r\n{"port", NULL, TRUE, FALSE, NULL, NULL},\r\n{"priority", NULL, TRUE, TRUE, NULL, NULL},\r\n{"protocol", NULL, TRUE, TRUE, NULL, NULL},\r\n{"rel-addr", NULL, FALSE, FALSE, NULL, NULL},\r\n{"rel-port", NULL, FALSE, FALSE, NULL, NULL},\r\n{"type", NULL, TRUE, TRUE, xmpp_val_enum_list, type_enums_array}\r\n};\r\ncand_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_cand, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ncand_tree = proto_item_add_subtree(cand_item, ett_xmpp_jingle_cont_trans_cand);\r\nxmpp_display_attrs(cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(cand_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_ice_remote_candidate(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *remote_cand_item;\r\nproto_tree *remote_cand_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"component", NULL, TRUE, FALSE, NULL, NULL},\r\n{"ip", NULL, TRUE, FALSE, NULL, NULL},\r\n{"port", NULL, TRUE, FALSE, NULL, NULL}\r\n};\r\nremote_cand_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_rem_cand, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nremote_cand_tree = proto_item_add_subtree(remote_cand_item, ett_xmpp_jingle_cont_trans_rem_cand);\r\nxmpp_display_attrs(remote_cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_unknown(remote_cand_tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_raw(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *trans_item;\r\nproto_tree *trans_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "candidate", xmpp_jingle_cont_trans_raw_candidate, MANY}\r\n};\r\ntrans_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ntrans_tree = proto_item_add_subtree(trans_item, ett_xmpp_jingle_cont_trans);\r\nxmpp_display_attrs(trans_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(trans_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_raw_candidate(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *cand_item;\r\nproto_tree *cand_tree;\r\nstatic const gchar *type_enums[] = {"host", "prflx", "relay", "srflx"};\r\nxmpp_array_t *type_enums_array = xmpp_ep_init_array_t(type_enums,array_length(type_enums));\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"component", NULL, TRUE, FALSE, NULL, NULL},\r\n{"generation", NULL, TRUE, FALSE, NULL, NULL},\r\n{"id", NULL, TRUE, FALSE, NULL, NULL},\r\n{"ip", NULL, TRUE, TRUE, NULL, NULL},\r\n{"port", NULL, TRUE, TRUE, NULL, NULL},\r\n{"type", NULL, TRUE, TRUE, xmpp_val_enum_list, type_enums_array}\r\n};\r\ncand_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_cand, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ncand_tree = proto_item_add_subtree(cand_item, ett_xmpp_jingle_cont_trans_cand);\r\nxmpp_display_attrs(cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(cand_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *trans_item;\r\nproto_tree *trans_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL},\r\n{"mode", NULL, FALSE, TRUE, NULL, NULL},\r\n{"sid", NULL, FALSE, TRUE, NULL, NULL},\r\n};\r\nxmpp_elem_info elems_info [] = {\r\n{NAME, "candidate", xmpp_jingle_cont_trans_s5b_candidate, MANY},\r\n{NAME, "activated", xmpp_jingle_cont_trans_s5b_activated, ONE},\r\n{NAME, "candidate-used", xmpp_jingle_cont_trans_s5b_cand_used, ONE},\r\n{NAME, "candidate-error", xmpp_jingle_cont_trans_s5b_cand_error, ONE},\r\n{NAME, "proxy-error", xmpp_jingle_cont_trans_s5b_proxy_error, ONE},\r\n};\r\ntrans_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ntrans_tree = proto_item_add_subtree(trans_item, ett_xmpp_jingle_cont_trans);\r\nxmpp_display_attrs(trans_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(trans_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b_candidate(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *cand_item;\r\nproto_tree *cand_tree;\r\nstatic const gchar * type_enums[] = {"assisted", "direct", "proxy", "tunnel"};\r\nxmpp_array_t *type_enums_array = xmpp_ep_init_array_t(type_enums, array_length(type_enums));\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, FALSE, NULL, NULL},\r\n{"cid", NULL, TRUE, TRUE, NULL, NULL},\r\n{"jid", NULL, TRUE, TRUE, NULL, NULL},\r\n{"port", NULL, FALSE, TRUE, NULL, NULL},\r\n{"priority", NULL, TRUE, TRUE, NULL, NULL},\r\n{"type", NULL, TRUE, TRUE, xmpp_val_enum_list, type_enums_array}\r\n};\r\ncand_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_cand, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ncand_tree = proto_item_add_subtree(cand_item, ett_xmpp_jingle_cont_trans_cand);\r\nxmpp_display_attrs(cand_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(cand_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b_activated(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *activated_item;\r\nxmpp_attr_t *cid = xmpp_get_attr(element, "cid");\r\nactivated_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_activated, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(activated_item, " [cid=\"%s\"]",cid?cid->value:"");\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b_cand_used(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *cand_used_item;\r\nxmpp_attr_t *cid = xmpp_get_attr(element, "cid");\r\ncand_used_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_candidate_used, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(cand_used_item, " [cid=\"%s\"]",cid?cid->value:"");\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b_cand_error(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_candidate_error, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_s5b_proxy_error(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_tree_add_item(tree, hf_xmpp_jingle_cont_trans_proxy_error, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nxmpp_unknown(tree, tvb, pinfo, element);\r\n}\r\nstatic void\r\nxmpp_jingle_cont_trans_ibb(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element) {\r\nproto_item *trans_item;\r\nproto_tree *trans_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, FALSE, TRUE, NULL, NULL},\r\n{"block-size", NULL, TRUE, TRUE, NULL, NULL},\r\n{"sid", NULL, TRUE, TRUE, NULL, NULL},\r\n{"stanza", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\ntrans_item = proto_tree_add_item(tree, hf_xmpp_jingle_cont_trans, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ntrans_tree = proto_item_add_subtree(trans_item, ett_xmpp_jingle_cont_trans);\r\nxmpp_display_attrs(trans_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(trans_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_desc(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *desc_item;\r\nproto_tree *desc_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "offer", xmpp_jingle_file_transfer_offer, ONE},\r\n{NAME, "request", xmpp_jingle_file_transfer_request, ONE}\r\n};\r\ndesc_item = proto_tree_add_item(tree, hf_xmpp_jingle_content_description, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\ndesc_tree = proto_item_add_subtree(desc_item, ett_xmpp_jingle_content_description);\r\nxmpp_display_attrs(desc_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(desc_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_offer(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *offer_item;\r\nproto_tree *offer_tree;\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "file", xmpp_jingle_file_transfer_file, MANY},\r\n};\r\noffer_item = proto_tree_add_item(tree, hf_xmpp_jingle_file_transfer_offer, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\noffer_tree = proto_item_add_subtree(offer_item, ett_xmpp_jingle_file_transfer_offer);\r\nxmpp_display_attrs(offer_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(offer_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_request(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *request_item;\r\nproto_tree *request_tree;\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "file", xmpp_jingle_file_transfer_file, MANY},\r\n};\r\nrequest_item = proto_tree_add_item(tree, hf_xmpp_jingle_file_transfer_request, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nrequest_tree = proto_item_add_subtree(request_item, ett_xmpp_jingle_file_transfer_request);\r\nxmpp_display_attrs(request_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(request_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_received(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *received_item;\r\nproto_tree *received_tree;\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "file", xmpp_jingle_file_transfer_file, MANY},\r\n};\r\nreceived_item = proto_tree_add_item(tree, hf_xmpp_jingle_file_transfer_received, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nreceived_tree = proto_item_add_subtree(received_item, ett_xmpp_jingle_file_transfer_received);\r\nxmpp_display_attrs(received_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(received_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_abort(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *abort_item;\r\nproto_tree *abort_tree;\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "file", xmpp_jingle_file_transfer_file, MANY},\r\n};\r\nabort_item = proto_tree_add_item(tree, hf_xmpp_jingle_file_transfer_abort, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nabort_tree = proto_item_add_subtree(abort_item, ett_xmpp_jingle_file_transfer_abort);\r\nxmpp_display_attrs(abort_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(abort_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_checksum(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_item *checksum_item;\r\nproto_tree *checksum_tree;\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "file", xmpp_jingle_file_transfer_file, MANY},\r\n};\r\nchecksum_item = proto_tree_add_item(tree, hf_xmpp_jingle_file_transfer_checksum, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nchecksum_tree = proto_item_add_subtree(checksum_item, ett_xmpp_jingle_file_transfer_checksum);\r\nxmpp_display_attrs(checksum_tree, element, pinfo, tvb, NULL, 0);\r\nxmpp_display_elems(checksum_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jingle_file_transfer_file(proto_tree* tree, tvbuff_t* tvb, packet_info* pinfo, xmpp_element_t* element)\r\n{\r\nproto_tree *file_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"name", NULL, FALSE, TRUE, NULL, NULL},\r\n{"size", NULL, FALSE, TRUE, NULL, NULL},\r\n{"date", NULL, FALSE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "hashes", xmpp_hashes, ONE}\r\n};\r\nfile_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_jingle_file_transfer_file, NULL, "FILE");\r\nxmpp_change_elem_to_attrib("name", "name", element, xmpp_transform_func_cdata);\r\nxmpp_change_elem_to_attrib("size", "size", element, xmpp_transform_func_cdata);\r\nxmpp_change_elem_to_attrib("date", "date", element, xmpp_transform_func_cdata);\r\nxmpp_display_attrs(file_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(file_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nvoid\r\nxmpp_jinglenodes_services(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *services_item;\r\nproto_tree *services_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, TRUE, NULL, NULL}\r\n};\r\nxmpp_elem_info elems_info[] = {\r\n{NAME, "relay", xmpp_jinglenodes_relay_stun_tracker, ONE},\r\n{NAME, "tracker", xmpp_jinglenodes_relay_stun_tracker, ONE},\r\n{NAME, "stun", xmpp_jinglenodes_relay_stun_tracker, ONE},\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "SERVICES ");\r\nservices_item = proto_tree_add_item(tree, hf_xmpp_services, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nservices_tree = proto_item_add_subtree(services_item, ett_xmpp_services);\r\nxmpp_display_attrs(services_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(services_tree, element, pinfo, tvb, elems_info, array_length(elems_info));\r\n}\r\nstatic void\r\nxmpp_jinglenodes_relay_stun_tracker(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_tree *relay_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"address", NULL, TRUE, TRUE, NULL, NULL},\r\n{"port", NULL, FALSE, TRUE, NULL, NULL},\r\n{"policy", NULL, TRUE, TRUE, NULL, NULL},\r\n{"protocol", NULL, TRUE, TRUE, NULL, NULL},\r\n};\r\nrelay_tree = proto_tree_add_subtree(tree, tvb, element->offset, element->length, ett_xmpp_services_relay, NULL, element->name);\r\nxmpp_display_attrs(relay_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(relay_tree, element, pinfo, tvb, NULL, 0);\r\n}\r\nvoid\r\nxmpp_jinglenodes_channel(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, xmpp_element_t *element)\r\n{\r\nproto_item *channel_item;\r\nproto_tree *channel_tree;\r\nxmpp_attr_info attrs_info[] = {\r\n{"xmlns", &hf_xmpp_xmlns, TRUE, FALSE, NULL, NULL},\r\n{"id", NULL, FALSE, FALSE, NULL, NULL},\r\n{"host", NULL, FALSE, TRUE, NULL, NULL},\r\n{"localport", NULL, FALSE, TRUE, NULL, NULL},\r\n{"remoteport", NULL, FALSE, TRUE, NULL, NULL},\r\n{"protocol", NULL, TRUE, TRUE, NULL, NULL},\r\n{"maxkbps", NULL, FALSE, FALSE, NULL, NULL},\r\n{"expire", NULL, FALSE, FALSE, NULL, NULL},\r\n};\r\nchannel_item = proto_tree_add_item(tree, hf_xmpp_channel, tvb, element->offset, element->length, ENC_BIG_ENDIAN);\r\nchannel_tree = proto_item_add_subtree(channel_item, ett_xmpp_channel);\r\nxmpp_display_attrs(channel_tree, element, pinfo, tvb, attrs_info, array_length(attrs_info));\r\nxmpp_display_elems(channel_tree, element, pinfo, tvb, NULL, 0);\r\n}
