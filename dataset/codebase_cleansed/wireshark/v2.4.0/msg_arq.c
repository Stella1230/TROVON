void proto_register_mac_mgmt_msg_arq_feedback(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_arq_ack_type,\r\n{\r\n"ACK Type", "wmx.arq.ack_type",\r\nFT_UINT8, BASE_DEC, VALS(vals_arq_ack_type), 0x60, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_bsn,\r\n{\r\n"BSN", "wmx.arq.bsn",\r\nFT_UINT16, BASE_DEC, NULL, 0x1FFC, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_cid,\r\n{\r\n"Connection ID", "wmx.arq.cid",\r\nFT_UINT16, BASE_DEC, NULL, 0x00, "The ID of the connection being referenced", HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_discard_bsn,\r\n{\r\n"BSN", "wmx.arq.discard_bsn",\r\nFT_UINT16, BASE_DEC, NULL, 0x07FF, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_discard_cid,\r\n{\r\n"Connection ID", "wmx.arq.discard_cid",\r\nFT_UINT16, BASE_DEC, NULL, 0x00, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_discard_reserved,\r\n{\r\n"Reserved", "wmx.arq.discard_reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0xF8, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_last,\r\n{\r\n"LAST", "wmx.arq.last",\r\nFT_BOOLEAN, 8, TFS(&tfs_arq_last), 0x80, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_num_ack_maps,\r\n{\r\n"Number of ACK Maps", "wmx.arq.num_maps",\r\nFT_UINT8, BASE_DEC, NULL, 0x03, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_reserved,\r\n{\r\n"Reserved", "wmx.arq.reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x01, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_reset_cid,\r\n{\r\n"Connection ID", "wmx.arq.reset_cid",\r\nFT_UINT16, BASE_DEC, NULL, 0x00, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_reset_direction,\r\n{\r\n"Direction", "wmx.arq.reset_direction",\r\nFT_UINT8, BASE_DEC, VALS(vals_arq_reset_direction), 0x30, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_reset_reserved,\r\n{\r\n"Reserved", "wmx.arq.reset_reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_reset_type,\r\n{\r\n"Type", "wmx.arq.reset_type",\r\nFT_UINT8, BASE_DEC, VALS(vals_arq_reset_type), 0xC0, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_selective_map,\r\n{\r\n"Selective ACK Map", "wmx.arq.selective_map",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_0seq_ack_map,\r\n{\r\n"Sequence ACK Map", "wmx.arq.seq_ack_map",\r\nFT_UINT8, BASE_HEX, NULL, 0x60, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_1seq_ack_map,\r\n{\r\n"Sequence ACK Map", "wmx.arq.seq_ack_map",\r\nFT_UINT8, BASE_HEX, NULL, 0x70, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_seq_format,\r\n{\r\n"Sequence Format", "wmx.arq.seq_format",\r\nFT_UINT8, BASE_DEC, NULL, 0x80, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_0seq1_len,\r\n{\r\n"Sequence 1 Length", "wmx.arq.seq1_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x1F80, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_0seq2_len,\r\n{\r\n"Sequence 2 Length", "wmx.arq.seq2_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x007E, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_1seq1_len,\r\n{\r\n"Sequence 1 Length", "wmx.arq.seq1_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_1seq2_len,\r\n{\r\n"Sequence 2 Length", "wmx.arq.seq2_len",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_arq_1seq3_len,\r\n{\r\n"Sequence 3 Length", "wmx.arq.seq3_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_ack_type_reserved,\r\n{\r\n"Reserved", "wmx.ack_type.reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x03, NULL, HFILL\r\n}\r\n}\r\n};\r\nproto_mac_mgmt_msg_arq_decoder = proto_register_protocol (\r\n"WiMax ARQ Feedback/Discard/Reset Messages",\r\n"WiMax ARQ Feedback/Discard/Reset (arq)",\r\n"wmx.arq"\r\n);\r\nproto_register_field_array(proto_mac_mgmt_msg_arq_decoder, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nstatic int dissect_mac_mgmt_msg_arq_feedback_decoder(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nguint offset = 0;\r\nguint arq_feedback_ie_count = 0;\r\nguint arq_cid;\r\ngboolean arq_last = FALSE;\r\nguint arq_ack_type;\r\nguint arq_bsn;\r\nguint arq_num_ack_maps;\r\nguint tvb_len;\r\nproto_item *arq_feedback_item;\r\nproto_tree *arq_feedback_tree;\r\nproto_item *arq_fb_item = NULL;\r\nproto_tree *arq_fb_tree = NULL;\r\nproto_item *ti = NULL;\r\nguint i, seq_format;\r\n{\r\ntvb_len = tvb_reported_length(tvb);\r\narq_feedback_item = proto_tree_add_protocol_format(tree, proto_mac_mgmt_msg_arq_decoder, tvb, offset, -1, "MAC Management Message, ARQ-Feedback");\r\narq_feedback_tree = proto_item_add_subtree(arq_feedback_item, ett_mac_mgmt_msg_arq_decoder);\r\nwhile(offset < tvb_len && !arq_last)\r\n{\r\narq_feedback_ie_count++;\r\narq_cid = tvb_get_ntohs(tvb, offset);\r\narq_last = ((tvb_get_guint8(tvb, offset + 2) & 0x80) != 0);\r\narq_ack_type = (tvb_get_guint8(tvb, offset + 2) & 0x60) >> 5;\r\narq_bsn = (tvb_get_ntohs(tvb, offset + 2) & 0x1FFC) >> 2;\r\narq_num_ack_maps = 1 + (tvb_get_guint8(tvb, offset + 3) & 0x03);\r\narq_fb_item = proto_tree_add_protocol_format(arq_feedback_tree, proto_mac_mgmt_msg_arq_decoder, tvb, offset, tvb_len, "ARQ_Feedback_IE");\r\nproto_item_append_text(arq_fb_item, ", CID: %u, %s ARQ feedback IE, %s, BSN: %u",\r\narq_cid, arq_last ? "Last" : "More", val_to_str_const(arq_ack_type, vals_arq_ack_type, ""), arq_bsn);\r\nif (arq_ack_type != ARQ_CUMULATIVE_ACK_ENTRY) {\r\nproto_item_append_text(arq_fb_item, ", %u ACK Map(s)", arq_num_ack_maps);\r\n}\r\narq_fb_tree = proto_item_add_subtree(arq_fb_item, ett_mac_mgmt_msg_arq_decoder);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_cid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_last, tvb, offset + 2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_ack_type, tvb, offset + 2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_bsn, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\nif (arq_ack_type != ARQ_CUMULATIVE_ACK_ENTRY) {\r\nti = proto_tree_add_item(arq_fb_tree, hf_arq_num_ack_maps, tvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti, " (%d map(s))", arq_num_ack_maps);\r\noffset += 2;\r\nfor (i = 0; i < arq_num_ack_maps; i++) {\r\noffset += 2;\r\nif (arq_ack_type != 3) {\r\nproto_tree_add_item(arq_fb_tree, hf_arq_selective_map, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(arq_fb_tree, hf_arq_seq_format, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nseq_format = (tvb_get_guint8(tvb, offset) & 0x80) >> 7;\r\nif (seq_format == 0) {\r\nproto_tree_add_item(arq_fb_tree, hf_arq_0seq_ack_map, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_0seq1_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_0seq2_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_reserved, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(arq_fb_tree, hf_arq_1seq_ack_map, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_1seq1_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_1seq2_len, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_fb_tree, hf_arq_1seq3_len, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\n}\r\n} else {\r\nproto_tree_add_item(arq_fb_tree, hf_ack_type_reserved, tvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\noffset += 2;\r\n}\r\nproto_item_append_text(arq_feedback_item, ", %u ARQ_feedback_IE(s)", arq_feedback_ie_count);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int dissect_mac_mgmt_msg_arq_discard_decoder(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *arq_discard_item;\r\nproto_tree *arq_discard_tree;\r\n{\r\narq_discard_item = proto_tree_add_protocol_format(tree, proto_mac_mgmt_msg_arq_decoder, tvb, 0, -1, "MAC Management Message, ARQ-Discard");\r\narq_discard_tree = proto_item_add_subtree(arq_discard_item, ett_mac_mgmt_msg_arq_decoder);\r\nproto_tree_add_item(arq_discard_tree, hf_arq_discard_cid, tvb, 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_discard_tree, hf_arq_discard_reserved, tvb, 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_discard_tree, hf_arq_discard_bsn, tvb, 3, 2, ENC_BIG_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int dissect_mac_mgmt_msg_arq_reset_decoder(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *arq_reset_item;\r\nproto_tree *arq_reset_tree;\r\n{\r\narq_reset_item = proto_tree_add_protocol_format(tree, proto_mac_mgmt_msg_arq_decoder, tvb, 0, -1, "MAC Management Message, ARQ-Reset");\r\narq_reset_tree = proto_item_add_subtree(arq_reset_item, ett_mac_mgmt_msg_arq_decoder);\r\nproto_tree_add_item(arq_reset_tree, hf_arq_reset_cid, tvb, 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_reset_tree, hf_arq_reset_type, tvb, 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_reset_tree, hf_arq_reset_direction, tvb, 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(arq_reset_tree, hf_arq_reset_reserved, tvb, 3, 1, ENC_BIG_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_reg_handoff_mac_mgmt_msg_arq(void)\r\n{\r\ndissector_handle_t arq_handle;\r\narq_handle = create_dissector_handle(dissect_mac_mgmt_msg_arq_feedback_decoder, proto_mac_mgmt_msg_arq_decoder);\r\ndissector_add_uint("wmx.mgmtmsg", MAC_MGMT_MSG_ARQ_FEEDBACK, arq_handle);\r\narq_handle = create_dissector_handle(dissect_mac_mgmt_msg_arq_discard_decoder, proto_mac_mgmt_msg_arq_decoder);\r\ndissector_add_uint("wmx.mgmtmsg", MAC_MGMT_MSG_ARQ_DISCARD, arq_handle);\r\narq_handle = create_dissector_handle(dissect_mac_mgmt_msg_arq_reset_decoder, proto_mac_mgmt_msg_arq_decoder);\r\ndissector_add_uint("wmx.mgmtmsg", MAC_MGMT_MSG_ARQ_RESET, arq_handle);\r\n}
