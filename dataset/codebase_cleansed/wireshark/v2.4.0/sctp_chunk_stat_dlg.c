static\r\nGtkWidget* create_list(void)\r\n{\r\nGtkListStore *list_store;\r\nGtkWidget *list;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeSortable *sortable;\r\nGtkTreeView *list_view;\r\nGtkTreeSelection *selection;\r\nlist_store = gtk_list_store_new(N_COLUMN,\r\nG_TYPE_STRING,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT,\r\nG_TYPE_INT);\r\nlist = gtk_tree_view_new_with_model (GTK_TREE_MODEL (list_store));\r\nlist_view = GTK_TREE_VIEW(list);\r\nsortable = GTK_TREE_SORTABLE(list_store);\r\ngtk_tree_view_set_fixed_height_mode(list_view, TRUE);\r\ngtk_tree_sortable_set_sort_column_id(sortable, IP_ADDR_COLUMN, GTK_SORT_ASCENDING);\r\ngtk_tree_view_set_headers_clickable(list_view, FALSE);\r\ng_object_unref (G_OBJECT (list_store));\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("IP Address", renderer,\r\n"text", IP_ADDR_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, IP_ADDR_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 135);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("DATA", renderer,\r\n"text", DATA_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, DATA_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 70);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("INIT", renderer,\r\n"text", INIT_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, INIT_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 70);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("INIT-ACK", renderer,\r\n"text", INIT_ACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, INIT_ACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 90);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("SACK", renderer,\r\n"text", SACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, SACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 70);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("HEARTBEAT", renderer,\r\n"text", HEARTBEAT_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, HEARTBEAT_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 110);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("HEARTBEAT-ACK", renderer,\r\n"text", HEARTBEAT_ACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, HEARTBEAT_ACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 140);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("ABORT", renderer,\r\n"text", ABORT_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, ABORT_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("SHUTDOWN", renderer,\r\n"text", SHUTDOWN_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, SHUTDOWN_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("SHUTDOWN-ACK", renderer,\r\n"text", SHUTDOWN_ACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, SHUTDOWN_ACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 150);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("ERROR", renderer,\r\n"text", ERROR_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, ERROR_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("COOKIE-ECHO", renderer,\r\n"text", COOKIE_ECHO_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, COOKIE_ECHO_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 130);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("COOKIE-ACK", renderer,\r\n"text", COOKIE_ACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, COOKIE_ACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 130);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("ECNE", renderer,\r\n"text", ECNE_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, ECNE_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 70);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("CWR", renderer,\r\n"text", CWR_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, CWR_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 70);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("SHUT-COMPLETE", renderer,\r\n"text", SHUT_COMPLETE_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, SHUT_COMPLETE_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 150);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("AUTH", renderer,\r\n"text", AUTH_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, AUTH_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("NR-SACK", renderer,\r\n"text", NR_SACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, NR_SACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 100);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("I-DATA", renderer,\r\n"text", I_DATA_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, I_DATA_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 100);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("ASCONF-ACK", renderer,\r\n"text", ASCONF_ACK_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, ASCONF_ACK_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("PKTDROP", renderer,\r\n"text", PKTDROP_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, PKTDROP_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 100);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("FORWARD-TSN", renderer,\r\n"text", FORWARD_TSN_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, FORWARD_TSN_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 140);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("ASCONF", renderer,\r\n"text", ASCONF_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, ASCONF_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 90);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Others", renderer,\r\n"text", OTHERS_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, OTHERS_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (list_view, column);\r\ngtk_tree_view_set_rules_hint(GTK_TREE_VIEW(list_view), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(list_view), TRUE);\r\nselection = gtk_tree_view_get_selection(GTK_TREE_VIEW(list));\r\ngtk_tree_selection_set_mode(selection, GTK_SELECTION_SINGLE);\r\nreturn list;\r\n}\r\nstatic const char *\r\nchunk_name(int type)\r\n{\r\n#define CASE(x) case x: s = #x; break\r\nconst char *s = "unknown";\r\nswitch (type)\r\n{\r\nCASE(DATA);\r\nCASE(INIT);\r\nCASE(INIT_ACK);\r\nCASE(SACK);\r\nCASE(HEARTBEAT);\r\nCASE(HEARTBEAT_ACK);\r\nCASE(ABORT);\r\nCASE(SHUTDOWN);\r\nCASE(SHUTDOWN_ACK);\r\nCASE(SCTP_ERROR);\r\nCASE(COOKIE_ECHO);\r\nCASE(COOKIE_ACK);\r\nCASE(ECNE);\r\nCASE(CWR);\r\nCASE(SHUT_COMPLETE);\r\nCASE(AUTH);\r\nCASE(NR_SACK);\r\nCASE(I_DATA);\r\nCASE(ASCONF_ACK);\r\nCASE(PKTDROP);\r\nCASE(FORWARD_TSN);\r\nCASE(ASCONF);\r\n}\r\nreturn s;\r\n}\r\nstatic void\r\nchunk_dlg_destroy(GObject *object _U_, gpointer user_data)\r\n{\r\nstruct sctp_udata *u_data = (struct sctp_udata*)user_data;\r\ndecrease_childcount(u_data->parent);\r\nremove_child(u_data, u_data->parent);\r\ng_free(u_data->io);\r\ng_free(u_data);\r\n}\r\nstatic void\r\nadd_to_clist(sctp_addr_chunk* sac)\r\n{\r\nGtkListStore *list_store = NULL;\r\nGtkTreeIter iter;\r\ngchar *field;\r\nlist_store = GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW (clist)));\r\nif ((sac->addr->type == AT_IPv4) || (sac->addr->type == AT_IPv6)) {\r\nfield = (gchar*)address_to_str(NULL, sac->addr);\r\n} else {\r\nfield = wmem_strdup(NULL, "NONE");\r\n}\r\ngtk_list_store_insert_with_values( list_store , &iter, G_MAXINT,\r\nIP_ADDR_COLUMN, field,\r\nDATA_COLUMN, sac->addr_count[SCTP_DATA_CHUNK_ID],\r\nINIT_COLUMN, sac->addr_count[SCTP_INIT_CHUNK_ID],\r\nINIT_ACK_COLUMN, sac->addr_count[SCTP_INIT_ACK_CHUNK_ID],\r\nSACK_COLUMN, sac->addr_count[SCTP_SACK_CHUNK_ID],\r\nHEARTBEAT_COLUMN, sac->addr_count[SCTP_HEARTBEAT_CHUNK_ID],\r\nHEARTBEAT_ACK_COLUMN, sac->addr_count[SCTP_HEARTBEAT_ACK_CHUNK_ID],\r\nABORT_COLUMN, sac->addr_count[SCTP_ABORT_CHUNK_ID],\r\nSHUTDOWN_COLUMN, sac->addr_count[SCTP_SHUTDOWN_CHUNK_ID],\r\nSHUTDOWN_ACK_COLUMN, sac->addr_count[SCTP_SHUTDOWN_ACK_CHUNK_ID],\r\nERROR_COLUMN, sac->addr_count[SCTP_ERROR_CHUNK_ID],\r\nCOOKIE_ECHO_COLUMN, sac->addr_count[SCTP_COOKIE_ECHO_CHUNK_ID],\r\nCOOKIE_ACK_COLUMN, sac->addr_count[SCTP_COOKIE_ACK_CHUNK_ID],\r\nECNE_COLUMN, sac->addr_count[SCTP_ECNE_CHUNK_ID],\r\nCWR_COLUMN, sac->addr_count[SCTP_CWR_CHUNK_ID],\r\nSHUT_COMPLETE_COLUMN, sac->addr_count[SCTP_SHUTDOWN_COMPLETE_CHUNK_ID],\r\nAUTH_COLUMN, sac->addr_count[SCTP_AUTH_CHUNK_ID],\r\nNR_SACK_COLUMN, sac->addr_count[SCTP_NR_SACK_CHUNK_ID],\r\nI_DATA_COLUMN, sac->addr_count[SCTP_I_DATA_CHUNK_ID],\r\nASCONF_ACK_COLUMN, sac->addr_count[SCTP_ASCONF_ACK_CHUNK_ID],\r\nPKTDROP_COLUMN, sac->addr_count[SCTP_PKTDROP_CHUNK_ID],\r\nFORWARD_TSN_COLUMN, sac->addr_count[SCTP_FORWARD_TSN_CHUNK_ID],\r\nASCONF_COLUMN, sac->addr_count[SCTP_ASCONF_CHUNK_ID],\r\nOTHERS_COLUMN, sac->addr_count[OTHER_CHUNKS_INDEX],\r\n-1);\r\nwmem_free(NULL, field);\r\n}\r\nvoid sctp_chunk_stat_dlg_update(struct sctp_udata* udata, unsigned int direction)\r\n{\r\nGList *list = NULL;\r\nsctp_addr_chunk *sac;\r\nif (udata->io->window != NULL)\r\n{\r\ngtk_list_store_clear(GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW(clist))));\r\nif (udata->assoc->addr_chunk_count != NULL)\r\n{\r\nlist = g_list_first(udata->assoc->addr_chunk_count);\r\nwhile (list)\r\n{\r\nsac = (sctp_addr_chunk*)(list->data);\r\nif (sac->direction == direction)\r\n{\r\nadd_to_clist(sac);\r\nlist = g_list_next(list);\r\n}\r\nelse\r\nlist = g_list_next(list);\r\n}\r\n}\r\n}\r\nlast_list = list;\r\n}\r\nstatic void\r\nsctp_chunk_stat_on_close (GtkButton *button _U_, gpointer user_data)\r\n{\r\nstruct sctp_udata *udata;\r\nudata = (struct sctp_udata *)user_data;\r\ngtk_grab_remove(udata->io->window);\r\ngtk_widget_destroy(udata->io->window);\r\n}\r\nstatic void\r\npath_window_set_title(struct sctp_udata *u_data, unsigned int direction)\r\n{\r\nchar *display_name;\r\nchar *title;\r\nif (!u_data->io->window) {\r\nreturn;\r\n}\r\ndisplay_name = cf_get_display_name(&cfile);\r\ntitle = g_strdup_printf("SCTP Path Chunk Statistics for Endpoint %u: %s Port1 %u Port2 %u",direction,\r\ndisplay_name, u_data->assoc->port1, u_data->assoc->port2);\r\ng_free(display_name);\r\ngtk_window_set_title(GTK_WINDOW(u_data->io->window), title);\r\ng_free(title);\r\n}\r\nstatic void\r\ngtk_sctpstat_dlg(struct sctp_udata *u_data, unsigned int direction)\r\n{\r\nGtkWidget *vbox1;\r\nGtkWidget *scrolledwindow1;\r\nGtkWidget *hbuttonbox2;\r\nGtkWidget *bt_close;\r\nsctp_graph_t *io = (sctp_graph_t *)g_malloc(sizeof(sctp_graph_t));\r\nio->window = NULL;\r\nu_data->io = io;\r\nu_data->io->window = gtk_window_new (GTK_WINDOW_TOPLEVEL);\r\ngtk_window_set_default_size(GTK_WINDOW(u_data->io->window), 850, 200);\r\ngtk_window_set_position (GTK_WINDOW (u_data->io->window), GTK_WIN_POS_CENTER);\r\npath_window_set_title(u_data, direction);\r\ng_signal_connect(u_data->io->window, "destroy", G_CALLBACK(chunk_dlg_destroy), u_data);\r\nvbox1 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 2, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(vbox1), 8);\r\ngtk_container_add(GTK_CONTAINER(u_data->io->window), vbox1);\r\ngtk_widget_show(vbox1);\r\nscrolledwindow1 = scrolled_window_new (NULL, NULL);\r\ngtk_widget_show (scrolledwindow1);\r\ngtk_box_pack_start (GTK_BOX (vbox1), scrolledwindow1, TRUE, TRUE, 0);\r\nclist = create_list();\r\ngtk_widget_show (clist);\r\ngtk_container_add (GTK_CONTAINER (scrolledwindow1), clist);\r\ngtk_widget_show(u_data->io->window);\r\nhbuttonbox2 = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(vbox1), hbuttonbox2, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(hbuttonbox2), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX (hbuttonbox2), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX (hbuttonbox2), 0);\r\ngtk_widget_show(hbuttonbox2);\r\nbt_close = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_container_add (GTK_CONTAINER (hbuttonbox2), bt_close);\r\ngtk_widget_show (bt_close);\r\ng_signal_connect(bt_close, "clicked", G_CALLBACK(sctp_chunk_stat_on_close), u_data);\r\ncf_retap_packets(&cfile);\r\n}\r\nstatic void\r\nchunk_window_set_title(struct sctp_udata *u_data)\r\n{\r\nchar *display_name;\r\nchar *title;\r\nif (!u_data->io->window) {\r\nreturn;\r\n}\r\ndisplay_name = cf_get_display_name(&cfile);\r\ntitle = g_strdup_printf("SCTP Association Chunk Statistics: %s Port1 %u Port2 %u",\r\ndisplay_name, u_data->assoc->port1, u_data->assoc->port2);\r\ng_free(display_name);\r\ngtk_window_set_title(GTK_WINDOW(u_data->io->window), title);\r\ng_free(title);\r\n}\r\nstatic void\r\nsctp_chunk_dlg(struct sctp_udata *u_data)\r\n{\r\nGtkWidget *main_vb, *grid;\r\nGtkWidget *label, *h_button_box;\r\nGtkWidget *close_bt;\r\ngchar label_txt[50];\r\nint i, row;\r\nsctp_graph_t *io = (sctp_graph_t *)g_malloc(sizeof(sctp_graph_t));\r\nio->window = NULL;\r\nu_data->io = io;\r\nu_data->io->window = gtk_window_new (GTK_WINDOW_TOPLEVEL);\r\ngtk_window_set_position (GTK_WINDOW (u_data->io->window), GTK_WIN_POS_CENTER);\r\ngtk_widget_set_size_request(u_data->io->window, 500, 650);\r\ng_signal_connect(u_data->io->window, "destroy", G_CALLBACK(chunk_dlg_destroy), u_data);\r\nmain_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 12, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(main_vb), 12);\r\ngtk_container_add(GTK_CONTAINER(u_data->io->window), main_vb);\r\ngrid = ws_gtk_grid_new();\r\nws_gtk_grid_set_column_spacing(GTK_GRID(grid), 6);\r\nws_gtk_grid_set_row_spacing(GTK_GRID(grid), 3);\r\ngtk_box_pack_start(GTK_BOX(main_vb), grid, TRUE, TRUE, 0);\r\nrow = 0;\r\nlabel = gtk_label_new("ChunkType");\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 0, row, 1, 1);\r\nlabel = gtk_label_new("Association");\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 1, row, 1, 1);\r\nlabel = gtk_label_new("Endpoint 1");\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 2, row, 1, 1);\r\nlabel = gtk_label_new("Endpoint 2");\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 3, row, 1, 1);\r\nrow ++;\r\nlabel = gtk_label_new("");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 0, row, 1, 1);\r\nlabel = gtk_label_new("");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 1, row, 1, 1);\r\nlabel = gtk_label_new("");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 2, row, 1, 1);\r\nlabel = gtk_label_new("");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 3, row, 1, 1);\r\nrow ++;\r\nfor (i=0; i<NUM_CHUNKS; i++)\r\n{\r\nif (IS_SCTP_CHUNK_TYPE(i))\r\n{\r\nlabel = gtk_label_new(chunk_name(i));\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 0, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->chunk_count[i]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 1, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->ep1_chunk_count[i]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 2, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->ep2_chunk_count[i]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 3, row, 1, 1);\r\nrow ++;\r\n}\r\n}\r\nlabel = gtk_label_new("Others");\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 0, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->chunk_count[OTHER_CHUNKS_INDEX]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 1, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->ep1_chunk_count[OTHER_CHUNKS_INDEX]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 2, row, 1, 1);\r\ng_snprintf(label_txt, 10, "%u", selected_stream->ep2_chunk_count[OTHER_CHUNKS_INDEX]);\r\nlabel = gtk_label_new(label_txt);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0f, 0.5f);\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), label, 3, row, 1, 1);\r\nh_button_box = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(main_vb), h_button_box, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(h_button_box), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX (h_button_box), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX (h_button_box), 0);\r\ngtk_widget_show(h_button_box);\r\nclose_bt = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_box_pack_start(GTK_BOX(h_button_box), close_bt, FALSE, FALSE, 0);\r\ngtk_widget_show(close_bt);\r\ng_signal_connect(close_bt, "clicked", G_CALLBACK(sctp_chunk_stat_on_close), u_data);\r\ngtk_widget_show_all(u_data->io->window);\r\nchunk_window_set_title(u_data);\r\n}\r\nvoid\r\nsctp_chunk_dlg_show(struct sctp_analyse* userdata)\r\n{\r\ngint i;\r\nstruct sctp_udata *u_data;\r\nu_data = (struct sctp_udata *)g_malloc(sizeof(struct sctp_udata));\r\nu_data->assoc = userdata->assoc;\r\nu_data->io = NULL;\r\nu_data->parent = userdata;\r\nif (selected_stream == NULL)\r\nselected_stream = (sctp_assoc_info_t *)g_malloc(sizeof(sctp_assoc_info_t));\r\nselected_stream = u_data->assoc;\r\nfor (i=0; i<NUM_CHUNKS; i++)\r\n{\r\nif (IS_SCTP_CHUNK_TYPE(i) || (i == OTHER_CHUNKS_INDEX))\r\nselected_stream->chunk_count[i] = u_data->assoc->chunk_count[i];\r\n}\r\nset_child(u_data, u_data->parent);\r\nincrease_childcount(u_data->parent);\r\nsctp_chunk_dlg(u_data);\r\n}\r\nvoid\r\nsctp_chunk_stat_dlg_show(unsigned int direction, struct sctp_analyse* userdata)\r\n{\r\nstruct sctp_udata *u_data;\r\nu_data = (struct sctp_udata *)g_malloc(sizeof(struct sctp_udata));\r\nu_data->assoc = userdata->assoc;\r\nu_data->io = NULL;\r\nu_data->parent = userdata;\r\nif (selected_stream == NULL)\r\nselected_stream = (sctp_assoc_info_t *)g_malloc(sizeof(sctp_assoc_info_t));\r\nselected_stream = u_data->assoc;\r\nselected_stream->addr_chunk_count = u_data->assoc->addr_chunk_count;\r\nset_child(u_data, u_data->parent);\r\nincrease_childcount(u_data->parent);\r\ngtk_sctpstat_dlg(u_data, direction);\r\nsctp_chunk_stat_dlg_update(u_data,direction);\r\n}
