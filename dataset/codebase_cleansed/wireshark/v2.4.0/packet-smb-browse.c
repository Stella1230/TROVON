static void\r\ndissect_election_criterion_os(tvbuff_t *tvb, proto_tree *parent_tree, int offset)\r\n{\r\nstatic const int * flags[] = {\r\n&hf_election_os_wfw,\r\n&hf_election_os_ntw,\r\n&hf_election_os_nts,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(parent_tree, tvb, offset, hf_election_os, ett_browse_election_os, flags, ENC_NA);\r\n}\r\nstatic void\r\ndissect_election_criterion_desire(tvbuff_t *tvb, proto_tree *parent_tree, int offset)\r\n{\r\nstatic const int * flags[] = {\r\n&hf_election_desire_flags_backup,\r\n&hf_election_desire_flags_standby,\r\n&hf_election_desire_flags_master,\r\n&hf_election_desire_flags_domain_master,\r\n&hf_election_desire_flags_wins,\r\n&hf_election_desire_flags_nt,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(parent_tree, tvb, offset, hf_election_desire, ett_browse_election_desire, flags, ENC_NA);\r\n}\r\nstatic void\r\ndissect_election_criterion(tvbuff_t *tvb, proto_tree *parent_tree, int offset)\r\n{\r\nproto_tree *tree = NULL;\r\nproto_item *item = NULL;\r\nguint32 criterion;\r\ncriterion = tvb_get_letohl(tvb, offset);\r\nif (parent_tree) {\r\nitem = proto_tree_add_uint(parent_tree, hf_election_criteria, tvb, offset, 4, criterion);\r\ntree = proto_item_add_subtree(item, ett_browse_election_criteria);\r\n}\r\ndissect_election_criterion_desire(tvb, tree, offset);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_proto_major, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_proto_minor, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\ndissect_election_criterion_os(tvb, tree, offset);\r\n}\r\nint\r\ndissect_smb_server_type_flags(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *parent_tree, guint8 *drep,\r\ngboolean infoflag)\r\n{\r\nguint32 flags;\r\nint i;\r\nstatic const int * type_flags[] = {\r\n&hf_server_type_workstation,\r\n&hf_server_type_server,\r\n&hf_server_type_sql,\r\n&hf_server_type_domain,\r\n&hf_server_type_backup,\r\n&hf_server_type_time,\r\n&hf_server_type_apple,\r\n&hf_server_type_novell,\r\n&hf_server_type_member,\r\n&hf_server_type_print,\r\n&hf_server_type_dialin,\r\n&hf_server_type_xenix,\r\n&hf_server_type_ntw,\r\n&hf_server_type_wfw,\r\n&hf_server_type_nts,\r\n&hf_server_type_potentialb,\r\n&hf_server_type_backupb,\r\n&hf_server_type_masterb,\r\n&hf_server_type_domainmasterb,\r\n&hf_server_type_osf,\r\n&hf_server_type_vms,\r\n&hf_server_type_w95,\r\n&hf_server_type_dfs,\r\n&hf_server_type_local,\r\n&hf_server_type_domainenum,\r\nNULL\r\n};\r\nif (drep != NULL) {\r\noffset = dissect_ndr_uint32(\r\ntvb, offset, pinfo, NULL, NULL, drep, hf_server_type, &flags);\r\n} else {\r\nflags = tvb_get_letohl(tvb, offset);\r\noffset += 4;\r\n}\r\nif (infoflag) {\r\nfor (i = 0; i < 32; i++) {\r\nif (flags & (1U<<i)) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", %s",\r\nval_to_str(i, server_types,\r\n"Unknown server type:%d"));\r\n}\r\n}\r\n}\r\nproto_tree_add_bitmask_value(parent_tree, tvb, offset-4,\r\nhf_server_type, ett_browse_flags, type_flags, flags);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mailslot_browse(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 cmd;\r\nproto_tree *tree = NULL;\r\nproto_item *item = NULL;\r\nguint32 periodicity;\r\nguint8 *host_name;\r\ngint namelen;\r\nguint8 server_count;\r\nguint8 os_major_ver, os_minor_ver;\r\nconst gchar *windows_version;\r\nint i;\r\nguint32 uptime;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "BROWSER");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ncmd = tvb_get_guint8(tvb, offset);\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str(cmd, commands, "Unknown command:0x%02x"));\r\nitem = proto_tree_add_item(parent_tree, proto_smb_browse, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_browse);\r\nproto_tree_add_uint(tree, hf_command, tvb, offset, 1, cmd);\r\noffset += 1;\r\nswitch (cmd) {\r\ncase BROWSE_DOMAIN_ANNOUNCEMENT:\r\ncase BROWSE_LOCAL_MASTER_ANNOUNCEMENT:\r\ncase BROWSE_HOST_ANNOUNCE: {\r\nproto_tree_add_item(tree, hf_update_count, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nperiodicity = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint_format_value(tree, hf_periodicity, tvb, offset, 4,\r\nperiodicity,\r\n"%s",\r\nsigned_time_msecs_to_str(wmem_packet_scope(), periodicity));\r\noffset += 4;\r\nhost_name = tvb_get_stringzpad(wmem_packet_scope(), tvb, offset, HOST_NAME_LEN, ENC_CP437|ENC_NA);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " %s", host_name);\r\nproto_tree_add_string_format(tree, hf_server_name,\r\ntvb, offset, HOST_NAME_LEN,\r\nhost_name,\r\n(cmd==BROWSE_DOMAIN_ANNOUNCEMENT)?\r\n"Domain/Workgroup: %s":\r\n"Host Name: %s",\r\nhost_name);\r\noffset += HOST_NAME_LEN;\r\nos_major_ver = tvb_get_guint8(tvb, offset);\r\nos_minor_ver = tvb_get_guint8(tvb, offset+1);\r\nSET_WINDOWS_VERSION_STRING(os_major_ver, os_minor_ver, windows_version);\r\nproto_tree_add_string(tree, hf_windows_version, tvb, offset, 2, windows_version);\r\nproto_tree_add_item(tree, hf_os_major, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_os_minor, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\noffset = dissect_smb_server_type_flags(\r\ntvb, offset, pinfo, tree, NULL, TRUE);\r\nif (cmd == BROWSE_DOMAIN_ANNOUNCEMENT && tvb_get_letohs (tvb, offset + 2) != 0xAA55) {\r\nproto_tree_add_item(tree, hf_mysterious_field, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\n} else {\r\nproto_tree_add_item(tree, hf_proto_major, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_proto_minor, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_sig_const, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\n}\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree,\r\n(cmd==BROWSE_DOMAIN_ANNOUNCEMENT)?\r\nhf_mb_server_name : hf_server_comment,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\nbreak;\r\n}\r\ncase BROWSE_REQUEST_ANNOUNCE: {\r\nguint8 *computer_name;\r\nproto_tree_add_item(tree, hf_unused_flags,\r\ntvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\ncomputer_name = tvb_get_stringz_enc(wmem_packet_scope(), tvb, offset, &namelen, ENC_ASCII);\r\nproto_tree_add_string(tree, hf_response_computer_name,\r\ntvb, offset, namelen, computer_name);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " %s", computer_name);\r\nbreak;\r\n}\r\ncase BROWSE_ELECTION_REQUEST:\r\nproto_tree_add_item(tree, hf_election_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\ndissect_election_criterion(tvb, tree, offset);\r\noffset += 4;\r\nuptime = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint_format_value(tree, hf_server_uptime,\r\ntvb, offset, 4, uptime,\r\n"%s",\r\nsigned_time_msecs_to_str(wmem_packet_scope(), uptime));\r\noffset += 4;\r\noffset += 4;\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_server_name,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase BROWSE_BACKUP_LIST_REQUEST:\r\nproto_tree_add_item(tree, hf_backup_count, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_backup_token, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase BROWSE_BACKUP_LIST_RESPONSE:\r\nserver_count = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_backup_count, tvb, offset, 1,\r\nserver_count);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_backup_token, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nfor (i = 0; i < server_count; i++) {\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_backup_server,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\noffset += namelen;\r\n}\r\nbreak;\r\ncase BROWSE_MASTER_ANNOUNCEMENT:\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_mb_server_name,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase BROWSE_RESETBROWSERSTATE_ANNOUNCEMENT: {\r\nstatic const int * flags[] = {\r\n&hf_mb_reset_demote,\r\n&hf_mb_reset_flush,\r\n&hf_mb_reset_stop,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_mb_reset_command, ett_browse_reset_cmd_flags, flags, ENC_NA);\r\nbreak;\r\n}\r\ncase BROWSE_BECOME_BACKUP:\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_browser_to_promote,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_mailslot_lanman(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 cmd;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint32 periodicity;\r\nconst guint8 *host_name;\r\nguint8 os_major_ver, os_minor_ver;\r\nconst gchar *windows_version;\r\nguint namelen;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "BROWSER");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ncmd = tvb_get_guint8(tvb, offset);\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str(cmd, commands, "Unknown command:0x%02x"));\r\nitem = proto_tree_add_item(parent_tree, proto_smb_browse, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_browse);\r\nproto_tree_add_uint(tree, hf_command, tvb, offset, 1, cmd);\r\noffset += 1;\r\nswitch (cmd) {\r\ncase BROWSE_DOMAIN_ANNOUNCEMENT:\r\ncase BROWSE_LOCAL_MASTER_ANNOUNCEMENT:\r\ncase BROWSE_HOST_ANNOUNCE:\r\nproto_tree_add_item(tree, hf_update_count, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\noffset = dissect_smb_server_type_flags(\r\ntvb, offset, pinfo, tree, NULL, TRUE);\r\nos_major_ver = tvb_get_guint8(tvb, offset);\r\nos_minor_ver = tvb_get_guint8(tvb, offset+1);\r\nSET_WINDOWS_VERSION_STRING(os_major_ver, os_minor_ver, windows_version);\r\nproto_tree_add_string(tree, hf_windows_version, tvb, offset, 2, windows_version);\r\nproto_tree_add_item(tree, hf_os_major, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_os_minor, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nperiodicity = tvb_get_letohs(tvb, offset)*1000;\r\nproto_tree_add_uint_format_value(tree, hf_periodicity, tvb, offset, 2,\r\nperiodicity,\r\n"%s",\r\nsigned_time_msecs_to_str(wmem_packet_scope(), periodicity));\r\noffset += 2;\r\nhost_name = tvb_get_stringz_enc(wmem_packet_scope(), tvb, offset, &namelen, ENC_CP437|ENC_NA);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " %s", host_name);\r\nproto_tree_add_item(tree, hf_server_name,\r\ntvb, offset, namelen, ENC_ASCII|ENC_NA);\r\noffset += namelen;\r\nnamelen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree,\r\n(cmd==BROWSE_DOMAIN_ANNOUNCEMENT)?\r\nhf_mb_server_name : hf_server_comment,\r\ntvb, offset, namelen, ENC_CP437|ENC_NA);\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_smb_browse(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_command,\r\n{ "Command", "browser.command", FT_UINT8, BASE_HEX,\r\nVALS(commands), 0, "Browse command opcode", HFILL }},\r\n{ &hf_update_count,\r\n{ "Update Count", "browser.update_count", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Browse Update Count", HFILL }},\r\n{ &hf_periodicity,\r\n{ "Update Periodicity", "browser.period", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Update Periodicity in ms", HFILL }},\r\n{ &hf_server_name,\r\n{ "Server Name", "browser.server", FT_STRING, BASE_NONE,\r\nNULL, 0, "BROWSE Server Name", HFILL }},\r\n{ &hf_mb_server_name,\r\n{ "Master Browser Server Name", "browser.mb_server", FT_STRING, BASE_NONE,\r\nNULL, 0, "BROWSE Master Browser Server Name", HFILL }},\r\n{ &hf_mb_reset_command,\r\n{ "ResetBrowserState Command", "browser.reset_cmd", FT_UINT8,\r\nBASE_HEX, VALS(resetbrowserstate_command_names), 0,\r\nNULL, HFILL }},\r\n{ &hf_mb_reset_demote,\r\n{ "Demote LMB", "browser.reset_cmd.demote", FT_BOOLEAN,\r\n8, TFS(&tfs_demote_to_backup), 0x01, NULL, HFILL}},\r\n{ &hf_mb_reset_flush,\r\n{ "Flush Browse List", "browser.reset_cmd.flush", FT_BOOLEAN,\r\n8, TFS(&tfs_flush_browse_list), 0x02, NULL, HFILL}},\r\n{ &hf_mb_reset_stop,\r\n{ "Stop Being LMB", "browser.reset_cmd.stop_lmb", FT_BOOLEAN,\r\n8, TFS(&tfs_stop_being_lmb), 0x04, NULL, HFILL}},\r\n{ &hf_os_major,\r\n{ "OS Major Version", "browser.os_major", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Operating System Major Version", HFILL }},\r\n{ &hf_os_minor,\r\n{ "OS Minor Version", "browser.os_minor", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Operating System Minor Version", HFILL }},\r\n{ &hf_server_type,\r\n{ "Server Type", "browser.server_type", FT_UINT32, BASE_HEX,\r\nNULL, 0, "Server Type Flags", HFILL }},\r\n{ &hf_server_type_workstation,\r\n{ "Workstation", "browser.server_type.workstation", FT_BOOLEAN, 32,\r\nTFS(&tfs_workstation), 1U<<SERVER_WORKSTATION, "Is This A Workstation?", HFILL }},\r\n{ &hf_server_type_server,\r\n{ "Server", "browser.server_type.server", FT_BOOLEAN, 32,\r\nTFS(&tfs_server), 1U<<SERVER_SERVER, "Is This A Server?", HFILL }},\r\n{ &hf_server_type_sql,\r\n{ "SQL", "browser.server_type.sql", FT_BOOLEAN, 32,\r\nTFS(&tfs_sql), 1U<<SERVER_SQL_SERVER, "Is This A SQL Server?", HFILL }},\r\n{ &hf_server_type_domain,\r\n{ "Domain Controller", "browser.server_type.domain_controller", FT_BOOLEAN, 32,\r\nTFS(&tfs_domain), 1U<<SERVER_DOMAIN_CONTROLLER, "Is This A Domain Controller?", HFILL }},\r\n{ &hf_server_type_backup,\r\n{ "Backup Controller", "browser.server_type.backup_controller", FT_BOOLEAN, 32,\r\nTFS(&tfs_backup), 1U<<SERVER_BACKUP_CONTROLLER, "Is This A Backup Domain Controller?", HFILL }},\r\n{ &hf_server_type_time,\r\n{ "Time Source", "browser.server_type.time", FT_BOOLEAN, 32,\r\nTFS(&tfs_time), 1U<<SERVER_TIME_SOURCE, "Is This A Time Source?", HFILL }},\r\n{ &hf_server_type_apple,\r\n{ "Apple", "browser.server_type.apple", FT_BOOLEAN, 32,\r\nTFS(&tfs_apple), 1U<<SERVER_APPLE_SERVER, "Is This An Apple Server ?", HFILL }},\r\n{ &hf_server_type_novell,\r\n{ "Novell", "browser.server_type.novell", FT_BOOLEAN, 32,\r\nTFS(&tfs_novell), 1U<<SERVER_NOVELL_SERVER, "Is This A Novell Server?", HFILL }},\r\n{ &hf_server_type_member,\r\n{ "Member", "browser.server_type.member", FT_BOOLEAN, 32,\r\nTFS(&tfs_member), 1U<<SERVER_DOMAIN_MEMBER_SERVER, "Is This A Domain Member Server?", HFILL }},\r\n{ &hf_server_type_print,\r\n{ "Print", "browser.server_type.print", FT_BOOLEAN, 32,\r\nTFS(&tfs_print), 1U<<SERVER_PRINT_QUEUE_SERVER, "Is This A Print Server?", HFILL }},\r\n{ &hf_server_type_dialin,\r\n{ "Dialin", "browser.server_type.dialin", FT_BOOLEAN, 32,\r\nTFS(&tfs_dialin), 1U<<SERVER_DIALIN_SERVER, "Is This A Dialin Server?", HFILL }},\r\n{ &hf_server_type_xenix,\r\n{ "Xenix", "browser.server_type.xenix", FT_BOOLEAN, 32,\r\nTFS(&tfs_xenix), 1U<<SERVER_XENIX_SERVER, "Is This A Xenix Server?", HFILL }},\r\n{ &hf_server_type_ntw,\r\n{ "NT Workstation", "browser.server_type.ntw", FT_BOOLEAN, 32,\r\nTFS(&tfs_ntw), 1U<<SERVER_NT_WORKSTATION, "Is This A NT Workstation?", HFILL }},\r\n{ &hf_server_type_wfw,\r\n{ "WfW", "browser.server_type.wfw", FT_BOOLEAN, 32,\r\nTFS(&tfs_wfw), 1U<<SERVER_WINDOWS_FOR_WORKGROUPS, "Is This A Windows For Workgroups Server?", HFILL }},\r\n{ &hf_server_type_nts,\r\n{ "NT Server", "browser.server_type.nts", FT_BOOLEAN, 32,\r\nTFS(&tfs_nts), 1U<<SERVER_NT_SERVER, "Is This A NT Server?", HFILL }},\r\n{ &hf_server_type_potentialb,\r\n{ "Potential Browser", "browser.server_type.browser.potential", FT_BOOLEAN, 32,\r\nTFS(&tfs_potentialb), 1U<<SERVER_POTENTIAL_BROWSER, "Is This A Potential Browser?", HFILL }},\r\n{ &hf_server_type_backupb,\r\n{ "Backup Browser", "browser.server_type.browser.backup", FT_BOOLEAN, 32,\r\nTFS(&tfs_backupb), 1U<<SERVER_BACKUP_BROWSER, "Is This A Backup Browser?", HFILL }},\r\n{ &hf_server_type_masterb,\r\n{ "Master Browser", "browser.server_type.browser.master", FT_BOOLEAN, 32,\r\nTFS(&tfs_masterb), 1U<<SERVER_MASTER_BROWSER, "Is This A Master Browser?", HFILL }},\r\n{ &hf_server_type_domainmasterb,\r\n{ "Domain Master Browser", "browser.server_type.browser.domain_master", FT_BOOLEAN, 32,\r\nTFS(&tfs_domainmasterb), 1U<<SERVER_DOMAIN_MASTER_BROWSER, "Is This A Domain Master Browser?", HFILL }},\r\n{ &hf_server_type_osf,\r\n{ "OSF", "browser.server_type.osf", FT_BOOLEAN, 32,\r\nTFS(&tfs_osf), 1U<<SERVER_OSF, "Is This An OSF server ?", HFILL }},\r\n{ &hf_server_type_vms,\r\n{ "VMS", "browser.server_type.vms", FT_BOOLEAN, 32,\r\nTFS(&tfs_vms), 1U<<SERVER_VMS, "Is This A VMS Server?", HFILL }},\r\n{ &hf_server_type_w95,\r\n{ "Windows 95+", "browser.server_type.w95", FT_BOOLEAN, 32,\r\nTFS(&tfs_w95), 1U<<SERVER_WINDOWS_95, "Is This A Windows 95 or above server?", HFILL }},\r\n{ &hf_server_type_dfs,\r\n{ "DFS", "browser.server_type.dfs", FT_BOOLEAN, 32,\r\nTFS(&tfs_dfs), 1U<<SERVER_DFS_SERVER, "Is This A DFS server?", HFILL }},\r\n{ &hf_server_type_local,\r\n{ "Local", "browser.server_type.local", FT_BOOLEAN, 32,\r\nTFS(&tfs_local), 1U<<SERVER_LOCAL_LIST_ONLY, "Is This A Local List Only request?", HFILL }},\r\n{ &hf_server_type_domainenum,\r\n{ "Domain Enum", "browser.server_type.domainenum", FT_BOOLEAN, 32,\r\nTFS(&tfs_domainenum), 1U<<SERVER_DOMAIN_ENUM, "Is This A Domain Enum request?", HFILL }},\r\n{ &hf_election_version,\r\n{ "Election Version", "browser.election.version", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_proto_major,\r\n{ "Browser Protocol Major Version", "browser.proto_major", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_proto_minor,\r\n{ "Browser Protocol Minor Version", "browser.proto_minor", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_sig_const,\r\n{ "Signature", "browser.sig", FT_UINT16, BASE_HEX,\r\nNULL, 0, "Signature Constant", HFILL }},\r\n{ &hf_server_comment,\r\n{ "Host Comment", "browser.comment", FT_STRINGZ, BASE_NONE,\r\nNULL, 0, "Server Comment", HFILL }},\r\n{ &hf_unused_flags,\r\n{ "Unused flags", "browser.unused", FT_UINT8, BASE_HEX,\r\nNULL, 0, "Unused/unknown flags", HFILL }},\r\n{ &hf_response_computer_name,\r\n{ "Response Computer Name", "browser.response_computer_name", FT_STRINGZ, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_election_criteria,\r\n{ "Election Criteria", "browser.election.criteria", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_election_desire,\r\n{ "Election Desire", "browser.election.desire", FT_UINT8, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_election_desire_flags_backup,\r\n{ "Backup", "browser.election.desire.backup", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_backup), 1U<<DESIRE_BACKUP, "Is this a backup server", HFILL }},\r\n{ &hf_election_desire_flags_standby,\r\n{ "Standby", "browser.election.desire.standby", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_standby), 1U<<DESIRE_STANDBY, "Is this a standby server?", HFILL }},\r\n{ &hf_election_desire_flags_master,\r\n{ "Master", "browser.election.desire.master", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_master), 1U<<DESIRE_MASTER, "Is this a master server", HFILL }},\r\n{ &hf_election_desire_flags_domain_master,\r\n{ "Domain Master", "browser.election.desire.domain_master", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_domain_master), 1U<<DESIRE_DOMAIN_MASTER, "Is this a domain master", HFILL }},\r\n{ &hf_election_desire_flags_wins,\r\n{ "WINS", "browser.election.desire.wins", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_wins), 1U<<DESIRE_WINS, "Is this a WINS server", HFILL }},\r\n{ &hf_election_desire_flags_nt,\r\n{ "NT", "browser.election.desire.nt", FT_BOOLEAN, 8,\r\nTFS(&tfs_desire_nt), 1U<<DESIRE_NT, "Is this a NT server", HFILL }},\r\n#if 0\r\n{ &hf_election_revision,\r\n{ "Election Revision", "browser.election.revision", FT_UINT16, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n#endif\r\n{ &hf_election_os,\r\n{ "Election OS", "browser.election.os", FT_UINT8, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_election_os_wfw,\r\n{ "WfW", "browser.election.os.wfw", FT_BOOLEAN, 8,\r\nTFS(&tfs_os_wfw), 1U<<OS_WFW, "Is this a WfW host?", HFILL }},\r\n{ &hf_election_os_ntw,\r\n{ "NT Workstation", "browser.election.os.ntw", FT_BOOLEAN, 8,\r\nTFS(&tfs_os_ntw), 1U<<OS_NTW, "Is this a NT Workstation?", HFILL }},\r\n{ &hf_election_os_nts,\r\n{ "NT Server", "browser.election.os.nts", FT_BOOLEAN, 8,\r\nTFS(&tfs_os_nts), 1U<<OS_NTS, "Is this a NT Server?", HFILL }},\r\n{ &hf_server_uptime,\r\n{ "Uptime", "browser.uptime", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Server uptime in ms", HFILL }},\r\n{ &hf_backup_count,\r\n{ "Backup List Requested Count", "browser.backup.count", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_backup_token,\r\n{ "Backup Request Token", "browser.backup.token", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Backup requested/response token", HFILL }},\r\n{ &hf_backup_server,\r\n{ "Backup Server", "browser.backup.server", FT_STRING, BASE_NONE,\r\nNULL, 0, "Backup Server Name", HFILL }},\r\n{ &hf_browser_to_promote,\r\n{ "Browser to Promote", "browser.browser_to_promote", FT_STRINGZ, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_windows_version,\r\n{ "Windows version", "browser.windows_version", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_mysterious_field,\r\n{ "Mysterious Field", "browser.mysterious_field", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_browse,\r\n&ett_browse_flags,\r\n&ett_browse_election_criteria,\r\n&ett_browse_election_os,\r\n&ett_browse_election_desire,\r\n&ett_browse_reset_cmd_flags,\r\n};\r\nproto_smb_browse = proto_register_protocol("Microsoft Windows Browser Protocol",\r\n"BROWSER", "browser");\r\nproto_register_field_array(proto_smb_browse, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("mailslot_browse", dissect_mailslot_browse,\r\nproto_smb_browse);\r\nregister_dissector("mailslot_lanman", dissect_mailslot_lanman,\r\nproto_smb_browse);\r\n}
