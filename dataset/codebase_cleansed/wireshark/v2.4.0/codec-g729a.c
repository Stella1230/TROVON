void *codec_g729a_init(void) {\r\nstruct g729a_context *ctx = 0;\r\nctx = (struct g729a_context*)g_malloc0(sizeof(struct g729a_context));\r\nctx->handle = EasyG729A_init_decoder();\r\nreturn ctx;\r\n}\r\nvoid codec_g729a_release(void *context) {\r\nstruct g729a_context *ctx = (struct g729a_context*)context;\r\nif (!ctx) return;\r\nEasyG729A_release_decoder(ctx->handle);\r\ng_free(ctx);\r\n}\r\nint codec_g729a_decode(void *context, const void *input, int inputSizeBytes, void *output, int *outputSizeBytes) {\r\nstruct g729a_context *ctx = (struct g729a_context*)context;\r\nconst unsigned char *bitstream = (const unsigned char*)input;\r\nshort *speech = (short*)output;\r\nint decodedBytes = 0;\r\nif (!ctx) return 0;\r\nif ((inputSizeBytes % L_G729A_FRAME_COMPRESSED) != 0)\r\nreturn 0;\r\nif (!output)\r\nreturn (inputSizeBytes / L_G729A_FRAME_COMPRESSED) * L_G729A_FRAME * sizeof(short);\r\nwhile ((inputSizeBytes >= L_G729A_FRAME_COMPRESSED) &&\r\n((*outputSizeBytes - decodedBytes) >= L_G729A_FRAME * sizeof(short))) {\r\nif (EasyG729A_decoder(ctx->handle, (unsigned char*)bitstream, ctx->speach_buffer)) {\r\nmemcpy(speech, ctx->speach_buffer, L_G729A_FRAME * sizeof(short));\r\nspeech += L_G729A_FRAME;\r\ndecodedBytes += L_G729A_FRAME * sizeof(short);\r\n}\r\nbitstream += L_G729A_FRAME_COMPRESSED;\r\ninputSizeBytes -= L_G729A_FRAME_COMPRESSED;\r\n}\r\nreturn decodedBytes;\r\n}
