static guint\r\ndissect_rtnet_tdma_notify_master(tvbuff_t *tvb _U_, guint offset, proto_tree *tree _U_)\r\n{\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_request_test(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_test_counter, tvb,\r\noffset, 4, ENC_LITTLE_ENDIAN );\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_test_tx, tvb,\r\noffset, 8, ENC_LITTLE_ENDIAN );\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_ack_test(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_test_counter, tvb,\r\noffset, 4, ENC_LITTLE_ENDIAN );\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_test_tx, tvb,\r\noffset, 8, ENC_LITTLE_ENDIAN );\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_request_conf(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_conf_station, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_conf_padding, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_conf_mtu, tvb,\r\noffset, 2, ENC_BIG_ENDIAN );\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_conf_cycle, tvb,\r\noffset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_ack_conf(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_conf_station, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_conf_padding, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_conf_mtu, tvb,\r\noffset, 2, ENC_BIG_ENDIAN );\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_conf_cycle, tvb,\r\noffset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_ack_ack_conf(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_ack_conf_station, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_ack_ack_conf_padding, tvb,\r\noffset, 3, ENC_NA );\r\noffset += 3;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_station_list(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nguint8 nr_stations;\r\nguint8 i;\r\nnr_stations = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_tdma_v1_msg_station_list_nr_stations, tvb,\r\noffset, 1, nr_stations);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_station_list_padding, tvb,\r\noffset, 3, ENC_NA );\r\noffset += 3;\r\nfor( i = 0; i < nr_stations; i++ )\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_station_list_ip, tvb,\r\noffset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_station_list_nr, tvb,\r\noffset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_station_list_padding, tvb,\r\noffset, 3, ENC_NA );\r\noffset += 3;\r\n}\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_request_change_offset(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_request_change_offset_offset, tvb,\r\noffset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic guint\r\ndissect_rtnet_tdma_start_of_frame(tvbuff_t *tvb, guint offset, proto_tree *tree)\r\n{\r\nproto_tree_add_item(tree, hf_tdma_v1_msg_start_of_frame_timestamp, tvb,\r\noffset, 8, ENC_BIG_ENDIAN );\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic void\r\ndissect_rtnet_tdma_v1(tvbuff_t *tvb, packet_info *pinfo, proto_tree *root) {\r\nguint offset = 0;\r\nguint32 msg;\r\nproto_tree *tree;\r\nproto_item *ti;\r\nmsg = tvb_get_ntohl(tvb, offset);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "TDMA-V1");\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s",\r\nval_to_str(msg, tdma_v1_msg_vals, "Unknown (0x%04x)"));\r\nif (root) {\r\nti = proto_tree_add_item(root, proto_tdma, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(ti, ett_tdma);\r\nproto_item_append_text(ti, ", Version 1, %s",\r\nval_to_str(msg, tdma_v1_msg_vals, "Unknown (0x%04x)"));\r\nproto_tree_add_item(tree, hf_tdma_v1_msg, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nswitch( msg ) {\r\ncase TDMA_V1_MSG_NOTIFY_MASTER:\r\ndissect_rtnet_tdma_notify_master(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_REQUEST_TEST:\r\ndissect_rtnet_tdma_request_test(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_ACK_TEST:\r\ndissect_rtnet_tdma_ack_test(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_REQUEST_CONF:\r\ndissect_rtnet_tdma_request_conf(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_ACK_CONF:\r\ndissect_rtnet_tdma_ack_conf(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_ACK_ACK_CONF:\r\ndissect_rtnet_tdma_ack_ack_conf(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_STATION_LIST:\r\ndissect_rtnet_tdma_station_list (tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_REQUEST_CHANGE_OFFSET:\r\ndissect_rtnet_tdma_request_change_offset(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_V1_MSG_START_OF_FRAME:\r\ndissect_rtnet_tdma_start_of_frame(tvb, offset, tree);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_tdma_sync(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\ngint64 timestamp;\r\nproto_item *ti;\r\nproto_tree_add_item(tree, hf_tdma_sync_cycle, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nti = proto_tree_add_item(tree, hf_tdma_sync_xmit_stamp, tvb, offset, 8, ENC_BIG_ENDIAN);\r\ntimestamp = tvb_get_ntoh64(tvb, offset) - tvb_get_ntoh64(tvb, offset+8);\r\nproto_item_append_text(ti, " (%s%" G_GINT64_MODIFIER "d)", (timestamp > 0) ? "+" : "", timestamp);\r\noffset += 8;\r\nproto_tree_add_item(tree, hf_tdma_sync_sched_xmit, tvb, offset, 8, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_tdma_request_cal(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\nproto_tree_add_item(tree, hf_tdma_req_cal_xmit_stamp, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(tree, hf_tdma_req_cal_rpl_cycle, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_tdma_req_cal_rpl_slot, tvb, offset, 8, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_tdma_reply_cal(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\ngint64 timestamp;\r\nproto_item *ti;\r\nproto_tree_add_item(tree, hf_tdma_rpl_cal_req_stamp, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(tree, hf_tdma_rpl_cal_rcv_stamp, tvb, offset, 8, ENC_BIG_ENDIAN);\r\ntimestamp = tvb_get_ntoh64(tvb, offset+8) - tvb_get_ntoh64(tvb, offset);\r\noffset += 8;\r\nti = proto_tree_add_item(tree, hf_tdma_rpl_cal_xmit_stamp, tvb, offset, 8, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti, " (%s%" G_GINT64_MODIFIER "d)", (timestamp > 0) ? "+" : "", timestamp);\r\n}\r\nstatic void\r\ndissect_rtnet_tdma(tvbuff_t *tvb, packet_info *pinfo, proto_tree *root) {\r\nguint offset = 0;\r\nguint16 msg;\r\nproto_item *ti;\r\nproto_tree *tree;\r\nmsg = tvb_get_ntohs(tvb, 2);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "TDMA");\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s",\r\nval_to_str(msg, tdma_msg_vals, "Unknown (0x%04x)"));\r\nif (root) {\r\nti = proto_tree_add_item(root, proto_tdma, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(ti, ett_tdma);\r\nproto_item_append_text(ti, ", %s", val_to_str(msg, tdma_msg_vals, "Unknown (0x%04x)"));\r\nproto_tree_add_item(tree, hf_tdma_ver, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_tdma_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nswitch (msg) {\r\ncase TDMA_MSG_SYNC:\r\ndissect_tdma_sync(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_MSG_CAL_REQUEST:\r\ndissect_tdma_request_cal(tvb, offset, tree);\r\nbreak;\r\ncase TDMA_MSG_CAL_REPLY:\r\ndissect_tdma_reply_cal(tvb, offset, tree);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic int\r\ndissect_rtmac(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\ngint offset = 0;\r\nguint8 ver,flags;\r\nguint16 type;\r\ntvbuff_t *next_tvb;\r\nproto_tree *ti=NULL, *rtmac_tree=NULL;\r\nproto_item *item;\r\ndissector_handle_t dissector=NULL;\r\nconst gchar *type_str=NULL;\r\ntype = tvb_get_ntohs(tvb, offset);\r\nver = tvb_get_guint8(tvb, offset+2);\r\nflags = tvb_get_guint8(tvb, offset+3);\r\nif (ver == 1) {\r\ntype_str = try_val_to_str(type, rtmac_type_vals);\r\nif (!type_str) {\r\ndissector = dissector_get_uint_handle(ethertype_table, type);\r\n}\r\n} else {\r\nif (flags & RTMAC_FLAG_TUNNEL) {\r\ndissector = dissector_get_uint_handle(ethertype_table, type);\r\n}\r\n}\r\nif (!dissector)\r\ndissector = data_handle;\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_rtmac, tvb, offset, 4, ENC_NA);\r\nrtmac_tree = proto_item_add_subtree(ti, ett_rtmac);\r\nproto_item_append_text(ti, ", Version %d", ver);\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RTmac");\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "Unknown (0x%04x)",type);\r\nif (rtmac_tree) {\r\nif (ver == 1) {\r\nif (!type_str) {\r\nif (dissector != data_handle)\r\ntype_str = dissector_handle_get_short_name(dissector);\r\nelse\r\ntype_str = "Unknown";\r\n}\r\n} else {\r\nif (!(flags & RTMAC_FLAG_TUNNEL))\r\ntype_str = val_to_str_const(type, rtmac_type_vals, "Unknown");\r\nelse {\r\nif (dissector != data_handle)\r\ntype_str = dissector_handle_get_short_name(dissector);\r\nelse\r\ntype_str = "Unknown";\r\n}\r\n}\r\nproto_tree_add_string_format_value(rtmac_tree, hf_rtmac_header_type, tvb, offset, 2,\r\ntype_str, "%s (0x%04x)", type_str, type);\r\noffset += 2;\r\nproto_tree_add_item(rtmac_tree, hf_rtmac_header_ver, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nif (ver == 1)\r\nproto_tree_add_item(rtmac_tree, hf_rtmac_header_res_v1, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nelse {\r\nitem = proto_tree_add_item(rtmac_tree, hf_rtmac_header_flags, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nti = proto_item_add_subtree(item, ett_rtmac_flags);\r\nproto_tree_add_item(ti, hf_rtmac_header_flags_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_rtmac_header_flags_tunnel, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset += 1;\r\n}\r\nelse\r\noffset += 4;\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\nif (ver == 1) {\r\nswitch (type) {\r\ncase RTMAC_TYPE_TDMA_V1:\r\ndissect_rtnet_tdma_v1(next_tvb, pinfo, tree);\r\nbreak;\r\ndefault:\r\ncall_dissector(dissector, next_tvb, pinfo, tree);\r\nbreak;\r\n}\r\n} else {\r\nif (flags & RTMAC_FLAG_TUNNEL)\r\ncall_dissector(dissector, next_tvb, pinfo, tree);\r\nelse {\r\nswitch (type) {\r\ncase RTMAC_TYPE_TDMA:\r\ndissect_rtnet_tdma(next_tvb, pinfo, tree);\r\nbreak;\r\ndefault:\r\ncall_dissector(data_handle, next_tvb, pinfo, tree);\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_rtcfg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\ngint offset = 0;\r\nproto_tree *vers_id_tree, *vers_id_item, *flags_tree, *flags_item;\r\nguint8 vers_id;\r\nguint8 addr_type;\r\nguint32 config_length,len;\r\nproto_tree *ti=NULL,*rtcfg_tree=NULL;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RTcfg");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_rtcfg, tvb, offset, -1, ENC_NA);\r\nrtcfg_tree = proto_item_add_subtree(ti, ett_rtcfg);\r\n}\r\nvers_id = tvb_get_guint8(tvb, offset);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s",\r\nval_to_str(vers_id, rtcfg_msg_vals, "Unknown (0x%04x)"));\r\nif( rtcfg_tree )\r\n{\r\nvers_id_item = proto_tree_add_uint(rtcfg_tree, hf_rtcfg_vers_id, tvb,\r\noffset, 1, vers_id);\r\nvers_id_tree=proto_item_add_subtree(vers_id_item, ett_rtcfg);\r\nproto_tree_add_item(vers_id_tree, hf_rtcfg_vers, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(vers_id_tree, hf_rtcfg_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_item_append_text(ti, ", Version %d, %s",\r\n(vers_id >> 5),\r\nval_to_str(vers_id, rtcfg_msg_vals, "Unknown (0x%04x)"));\r\nswitch( vers_id & 0x1f )\r\n{\r\ncase RTCFG_MSG_S1_CONFIG:\r\naddr_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_address_type, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nswitch( addr_type )\r\n{\r\ncase RTCFG_ADDRESS_TYPE_MAC:\r\nbreak;\r\ncase RTCFG_ADDRESS_TYPE_IP:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_client_ip_address, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_server_ip_address, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nbreak;\r\n}\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_burst_rate, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nconfig_length = tvb_get_ntohs( tvb, offset );\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_s1_config_length, tvb, offset, 2, ENC_BIG_ENDIAN );\r\noffset += 2;\r\nif( config_length > 0 ) {\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_config_data, tvb, offset, config_length, ENC_NA );\r\n}\r\nbreak;\r\ncase RTCFG_MSG_ANN_NEW:\r\naddr_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_address_type, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nswitch( addr_type )\r\n{\r\ncase RTCFG_ADDRESS_TYPE_MAC:\r\nbreak;\r\ncase RTCFG_ADDRESS_TYPE_IP:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_client_ip_address, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nbreak;\r\n}\r\nflags_item = proto_tree_add_item(rtcfg_tree, hf_rtcfg_client_flags, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nflags_tree=proto_item_add_subtree(flags_item, ett_rtcfg);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_available, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_ready, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_burst_rate, tvb, offset, 1, ENC_BIG_ENDIAN );\r\nbreak;\r\ncase RTCFG_MSG_ANN_REPLY:\r\naddr_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_address_type, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nswitch( addr_type )\r\n{\r\ncase RTCFG_ADDRESS_TYPE_MAC:\r\nbreak;\r\ncase RTCFG_ADDRESS_TYPE_IP:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_client_ip_address, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nbreak;\r\n}\r\nflags_item = proto_tree_add_item(rtcfg_tree, hf_rtcfg_client_flags, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nflags_tree=proto_item_add_subtree(flags_item, ett_rtcfg);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_available, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_ready, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_client_flags_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_padding, tvb, offset, 1, ENC_BIG_ENDIAN );\r\nbreak;\r\ncase RTCFG_MSG_S2_CONFIG:\r\nflags_item = proto_tree_add_item(rtcfg_tree, hf_rtcfg_server_flags, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nflags_tree=proto_item_add_subtree(flags_item, ett_rtcfg);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_server_flags_res0, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_server_flags_ready, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rtcfg_server_flags_res2, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_active_stations, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_heartbeat_period, tvb, offset, 2, ENC_BIG_ENDIAN );\r\noffset += 2;\r\nconfig_length = tvb_get_ntohl( tvb, offset );\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_s2_config_length, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nif( config_length > 0 ) {\r\nlen = tvb_reported_length_remaining(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_config_data, tvb, offset, len, ENC_NA );\r\n}\r\nbreak;\r\ncase RTCFG_MSG_S2_FRAG:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_config_offset, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nlen = tvb_reported_length_remaining(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_config_data, tvb, offset, len, ENC_NA );\r\nbreak;\r\ncase RTCFG_MSG_ACK:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_ack_length, tvb, offset, 4, ENC_BIG_ENDIAN );\r\nbreak;\r\ncase RTCFG_MSG_READY:\r\nbreak;\r\ncase RTCFG_MSG_HBEAT:\r\nbreak;\r\ncase RTCFG_MSG_DEAD_STN:\r\naddr_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_address_type, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nswitch( addr_type )\r\n{\r\ncase RTCFG_ADDRESS_TYPE_MAC:\r\nbreak;\r\ncase RTCFG_ADDRESS_TYPE_IP:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_client_ip_address, tvb, offset, 4, ENC_BIG_ENDIAN );\r\noffset += 4;\r\nbreak;\r\n}\r\nswitch (pinfo->pkt_encap) {\r\ncase WTAP_ENCAP_ETHERNET:\r\nproto_tree_add_bytes_format_value( rtcfg_tree, hf_rtcfg_client_hw_address, tvb, offset, 32,\r\nNULL, "%s",\r\ntvb_ether_to_str(tvb, offset));\r\nbreak;\r\ndefault:\r\nproto_tree_add_item( rtcfg_tree, hf_rtcfg_client_hw_address, tvb, offset, 32, ENC_NA );\r\nbreak;\r\n}\r\nbreak;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_rtmac(void) {\r\nstatic hf_register_info hf_array_rtmac[] = {\r\n{ &hf_rtmac_header_type,\r\n{ "Type",\r\n"rtmac.header.type",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"RTmac Type", HFILL }},\r\n{ &hf_rtmac_header_ver,\r\n{ "Version",\r\n"rtmac.header.ver",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"RTmac Version", HFILL }},\r\n{ &hf_rtmac_header_flags,\r\n{ "Flags",\r\n"rtmac.header.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"RTmac Flags", HFILL }},\r\n{ &hf_rtmac_header_flags_tunnel,\r\n{ "Tunnelling Flag",\r\n"rtmac.header.flags.tunnel",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), RTMAC_FLAG_TUNNEL,\r\n"RTmac Tunnelling Flag", HFILL }},\r\n{ &hf_rtmac_header_flags_res,\r\n{ "Reserved Flags",\r\n"rtmac.header.flags.res",\r\nFT_UINT8, BASE_HEX, NULL, RTMAC_FLAGS_RES,\r\n"RTmac Reserved Flags", HFILL }},\r\n{ &hf_rtmac_header_res_v1,\r\n{ "Reserved",\r\n"rtmac.header.res",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"RTmac Reserved", HFILL }},\r\n};\r\nstatic hf_register_info hf_array_tdma[] = {\r\n{ &hf_tdma_v1_msg,\r\n{ "Message",\r\n"tdma-v1.msg",\r\nFT_UINT32, BASE_HEX, VALS(tdma_v1_msg_vals), 0x0,\r\n"TDMA-V1 Message", HFILL }},\r\n{ &hf_tdma_v1_msg_request_conf_station,\r\n{ "Station",\r\n"tdma-v1.msg.request_conf.station",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Station", HFILL }},\r\n{ &hf_tdma_v1_msg_request_conf_padding,\r\n{ "Padding",\r\n"tdma-v1.msg.request_conf.padding",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"TDMA Padding", HFILL }},\r\n{ &hf_tdma_v1_msg_request_conf_mtu,\r\n{ "MTU",\r\n"tdma-v1.msg.request_conf.mtu",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA MTU", HFILL }},\r\n{ &hf_tdma_v1_msg_request_conf_cycle,\r\n{ "Cycle",\r\n"tdma-v1.msg.request_conf.cycle",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Cycle", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_conf_station,\r\n{ "Station",\r\n"tdma-v1.msg.ack_conf.station",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Station", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_conf_padding,\r\n{ "Padding",\r\n"tdma-v1.msg.ack_conf.padding",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"TDMA Padding", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_conf_mtu,\r\n{ "MTU",\r\n"tdma-v1.msg.ack_conf.mtu",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA MTU", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_conf_cycle,\r\n{ "Cycle",\r\n"tdma-v1.msg.ack_conf.cycle",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Cycle", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_ack_conf_station,\r\n{ "Station",\r\n"tdma-v1.msg.ack_ack_conf.station",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Station", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_ack_conf_padding,\r\n{ "Padding",\r\n"tdma-v1.msg.ack_ack_conf.padding",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"TDMA Padding", HFILL }},\r\n{ &hf_tdma_v1_msg_request_test_counter,\r\n{ "Counter",\r\n"tdma-v1.msg.request_test.counter",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"TDMA Counter", HFILL }},\r\n{ &hf_tdma_v1_msg_request_test_tx,\r\n{ "TX",\r\n"tdma-v1.msg.request_test.tx",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA TX", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_test_counter,\r\n{ "Counter",\r\n"tdma-v1.msg.ack_test.counter",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"TDMA Counter", HFILL }},\r\n{ &hf_tdma_v1_msg_ack_test_tx,\r\n{ "TX",\r\n"tdma-v1.msg.ack_test.tx",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA TX", HFILL }},\r\n{ &hf_tdma_v1_msg_request_change_offset_offset,\r\n{ "Offset",\r\n"tdma-v1.msg.request_change_offset.offset",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"TDMA Offset", HFILL }},\r\n{ &hf_tdma_v1_msg_start_of_frame_timestamp,\r\n{ "Timestamp",\r\n"tdma-v1.msg.start_of_frame.timestamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Timestamp", HFILL }},\r\n{ &hf_tdma_v1_msg_station_list_nr_stations,\r\n{ "Nr. Stations",\r\n"tdma-v1.msg.station_list.nr_stations",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Nr. Stations", HFILL }},\r\n{ &hf_tdma_v1_msg_station_list_nr,\r\n{ "Nr.",\r\n"tdma-v1.msg.station_list.nr",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"TDMA Station Number", HFILL }},\r\n{ &hf_tdma_v1_msg_station_list_ip,\r\n{ "IP",\r\n"tdma-v1.msg.station_list.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\n"TDMA Station IP", HFILL }},\r\n{ &hf_tdma_v1_msg_station_list_padding,\r\n{ "Padding",\r\n"tdma-v1.msg.station_list.padding",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"TDMA Padding", HFILL }},\r\n{ &hf_tdma_ver,\r\n{ "Version",\r\n"tdma.ver",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\n"TDMA Version", HFILL }},\r\n{ &hf_tdma_id,\r\n{ "Message ID",\r\n"tdma.id",\r\nFT_UINT16, BASE_HEX, VALS(tdma_msg_vals), 0x0,\r\n"TDMA Message ID", HFILL }},\r\n{ &hf_tdma_sync_cycle,\r\n{ "Cycle Number",\r\n"tdma.sync.cycle",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"TDMA Sync Cycle Number", HFILL }},\r\n{ &hf_tdma_sync_xmit_stamp,\r\n{ "Transmission Time Stamp",\r\n"tdma.sync.xmit_stamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Sync Transmission Time Stamp", HFILL }},\r\n{ &hf_tdma_sync_sched_xmit,\r\n{ "Scheduled Transmission Time",\r\n"tdma.sync.sched_xmit",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Sync Scheduled Transmission Time", HFILL }},\r\n{ &hf_tdma_req_cal_xmit_stamp,\r\n{ "Transmission Time Stamp",\r\n"tdma.req_cal.xmit_stamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Request Calibration Transmission Time Stamp", HFILL }},\r\n{ &hf_tdma_req_cal_rpl_cycle,\r\n{ "Reply Cycle Number",\r\n"tdma.req_cal.rpl_cycle",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"TDMA Request Calibration Reply Cycle Number", HFILL }},\r\n{ &hf_tdma_req_cal_rpl_slot,\r\n{ "Reply Slot Offset",\r\n"tdma.req_cal.rpl_slot",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Request Calibration Reply Slot Offset", HFILL }},\r\n{ &hf_tdma_rpl_cal_req_stamp,\r\n{ "Request Transmission Time",\r\n"tdma.rpl_cal.req_stamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Reply Calibration Request Transmission Time", HFILL }},\r\n{ &hf_tdma_rpl_cal_rcv_stamp,\r\n{ "Reception Time Stamp",\r\n"tdma.rpl_cal.rcv_stamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Reply Calibration Reception Time Stamp", HFILL }},\r\n{ &hf_tdma_rpl_cal_xmit_stamp,\r\n{ "Transmission Time Stamp",\r\n"tdma.rpl_cal.xmit_stamp",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"TDMA Reply Calibration Transmission Time Stamp", HFILL }},\r\n};\r\nstatic gint *ett_array_rtmac[] = {\r\n&ett_rtmac,\r\n&ett_rtmac_flags,\r\n};\r\nstatic gint *ett_array_tdma[] = {\r\n&ett_tdma,\r\n};\r\nproto_rtmac = proto_register_protocol("Real-Time Media Access Control", "RTmac", "rtmac");\r\nproto_register_field_array(proto_rtmac, hf_array_rtmac, array_length(hf_array_rtmac));\r\nproto_register_subtree_array(ett_array_rtmac, array_length(ett_array_rtmac));\r\nproto_tdma = proto_register_protocol("TDMA RTmac Discipline", "TDMA", "tdma");\r\nproto_register_field_array(proto_rtmac, hf_array_tdma, array_length(hf_array_tdma));\r\nproto_register_subtree_array(ett_array_tdma, array_length(ett_array_tdma));\r\n}\r\nvoid\r\nproto_register_rtcfg(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_rtcfg_vers_id,\r\n{ "Version and ID",\r\n"rtcfg.vers_id",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"RTcfg Version and ID", HFILL }},\r\n{ &hf_rtcfg_vers,\r\n{ "Version",\r\n"rtcfg.vers",\r\nFT_UINT8, BASE_DEC, NULL, 0xe0,\r\n"RTcfg Version", HFILL }},\r\n{ &hf_rtcfg_id,\r\n{ "ID",\r\n"rtcfg.id",\r\nFT_UINT8, BASE_HEX, VALS(rtcfg_msg_vals), 0x1f,\r\n"RTcfg ID", HFILL }},\r\n{ &hf_rtcfg_address_type,\r\n{ "Address Type",\r\n"rtcfg.address_type",\r\nFT_UINT8, BASE_DEC, VALS(rtcfg_address_type_vals), 0x00,\r\n"RTcfg Address Type", HFILL }},\r\n{ &hf_rtcfg_client_ip_address,\r\n{ "Client IP Address",\r\n"rtcfg.client_ip_address",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\n"RTcfg Client IP Address", HFILL }},\r\n{ &hf_rtcfg_server_ip_address,\r\n{ "Server IP Address",\r\n"rtcfg.server_ip_address",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\n"RTcfg Server IP Address", HFILL }},\r\n{ &hf_rtcfg_burst_rate,\r\n{ "Stage 2 Burst Rate",\r\n"rtcfg.burst_rate",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"RTcfg Stage 2 Burst Rate", HFILL }},\r\n{ &hf_rtcfg_s1_config_length,\r\n{ "Stage 1 Config Length",\r\n"rtcfg.s1_config_length",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"RTcfg Stage 1 Config Length", HFILL }},\r\n{ &hf_rtcfg_config_data,\r\n{ "Config Data",\r\n"rtcfg.config_data",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"RTcfg Config Data", HFILL }},\r\n{ &hf_rtcfg_padding,\r\n{ "Padding",\r\n"rtcfg.padding",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"RTcfg Padding", HFILL }},\r\n{ &hf_rtcfg_client_flags,\r\n{ "Flags",\r\n"rtcfg.client_flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"RTcfg Client Flags", HFILL }},\r\n{ &hf_rtcfg_client_flags_available,\r\n{ "Req. Available",\r\n"rtcfg.client_flags.available",\r\nFT_UINT8, BASE_DEC, NULL, 0x01,\r\n"Request Available", HFILL }},\r\n{ &hf_rtcfg_client_flags_ready,\r\n{ "Client Ready",\r\n"rtcfg.client_flags.ready",\r\nFT_UINT8, BASE_DEC, NULL, 0x02,\r\nNULL, HFILL }},\r\n{ &hf_rtcfg_client_flags_res,\r\n{ "Reserved",\r\n"rtcfg.client_flags.res",\r\nFT_UINT8, BASE_HEX, NULL, 0xfc,\r\nNULL, HFILL }},\r\n{ &hf_rtcfg_server_flags,\r\n{ "Flags",\r\n"rtcfg.server_flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"RTcfg Server Flags", HFILL }},\r\n{ &hf_rtcfg_server_flags_res0,\r\n{ "Reserved",\r\n"rtcfg.server_flags.res0",\r\nFT_UINT8, BASE_HEX, NULL, 0x01,\r\nNULL, HFILL }},\r\n{ &hf_rtcfg_server_flags_ready,\r\n{ "Server Ready",\r\n"rtcfg.server_flags.ready",\r\nFT_UINT8, BASE_DEC, NULL, 0x02,\r\nNULL, HFILL }},\r\n{ &hf_rtcfg_server_flags_res2,\r\n{ "Reserved",\r\n"rtcfg.server_flags.res2",\r\nFT_UINT8, BASE_HEX, NULL, 0xfc,\r\nNULL, HFILL }},\r\n{ &hf_rtcfg_active_stations,\r\n{ "Active Stations",\r\n"rtcfg.active_stations",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"RTcfg Active Stations", HFILL }},\r\n{ &hf_rtcfg_heartbeat_period,\r\n{ "Heartbeat Period",\r\n"rtcfg.hearbeat_period",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"RTcfg Heartbeat Period", HFILL }},\r\n{ &hf_rtcfg_s2_config_length,\r\n{ "Stage 2 Config Length",\r\n"rtcfg.s2_config_length",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"RTcfg Stage 2 Config Length", HFILL }},\r\n{ &hf_rtcfg_config_offset,\r\n{ "Config Offset",\r\n"rtcfg.config_offset",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"RTcfg Config Offset", HFILL }},\r\n{ &hf_rtcfg_ack_length,\r\n{ "Ack Length",\r\n"rtcfg.ack_length",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"RTcfg Ack Length", HFILL }},\r\n{ &hf_rtcfg_client_hw_address,\r\n{ "Client Hardware Address",\r\n"rtcfg.client_hw_address",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"RTcfg Client Hardware Address", HFILL }}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_rtcfg,\r\n};\r\nproto_rtcfg = proto_register_protocol("RTcfg","RTcfg","rtcfg");\r\nproto_register_field_array(proto_rtcfg,hf,array_length(hf));\r\nproto_register_subtree_array(ett,array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_rtmac(void) {\r\ndissector_handle_t rtmac_handle;\r\nrtmac_handle = create_dissector_handle(dissect_rtmac, proto_rtmac);\r\ndissector_add_uint("ethertype", ETHERTYPE_RTMAC, rtmac_handle);\r\nethertype_table = find_dissector_table("ethertype");\r\n}\r\nvoid\r\nproto_reg_handoff_rtcfg(void) {\r\ndissector_handle_t rtcfg_handle;\r\ndata_handle = find_dissector("data");\r\nrtcfg_handle = create_dissector_handle(dissect_rtcfg, proto_rtcfg);\r\ndissector_add_uint("ethertype", ETHERTYPE_RTCFG, rtcfg_handle);\r\n}
