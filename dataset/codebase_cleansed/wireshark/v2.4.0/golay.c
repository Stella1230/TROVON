static guint weight12(guint vector)\r\n{\r\nguint w=0;\r\nguint i;\r\nfor( i=0; i<12; i++ )\r\nif( vector & 1<<i )\r\nw++;\r\nreturn w;\r\n}\r\nstatic guint golay_coding(guint w)\r\n{\r\nguint out=0;\r\nguint i;\r\nfor( i = 0; i<12; i++ ) {\r\nif( w & 1<<i )\r\nout ^= golay_encode_matrix[i];\r\n}\r\nreturn out;\r\n}\r\nguint32 golay_encode(guint w)\r\n{\r\nreturn ((guint32)w) | ((guint32)golay_coding(w))<<12;\r\n}\r\nstatic guint golay_decoding(guint w)\r\n{\r\nguint out=0;\r\nguint i;\r\nfor( i = 0; i<12; i++ ) {\r\nif( w & 1<<(i) )\r\nout ^= golay_decode_matrix[i];\r\n}\r\nreturn out;\r\n}\r\ngint32 golay_errors(guint32 codeword)\r\n{\r\nguint received_data, received_parity;\r\nguint syndrome;\r\nguint w,i;\r\nguint inv_syndrome = 0;\r\nreceived_parity = (guint)(codeword>>12);\r\nreceived_data = (guint)codeword & 0xfff;\r\nsyndrome = received_parity ^ (golay_coding(received_data));\r\nw = weight12(syndrome);\r\nif( w <= 3 ) {\r\nreturn ((gint32) syndrome)<<12;\r\n}\r\nfor( i = 0; i<12; i++ ) {\r\nguint error = 1<<i;\r\nguint coding_error = golay_encode_matrix[i];\r\nif( weight12(syndrome^coding_error) <= 2 ) {\r\nreturn (gint32)((((guint32)(syndrome^coding_error))<<12) | (guint32)error) ;\r\n}\r\n}\r\ninv_syndrome = golay_decoding(syndrome);\r\nw = weight12(inv_syndrome);\r\nif( w <=3 ) {\r\nreturn (gint32)inv_syndrome;\r\n}\r\nfor( i = 0; i<12; i++ ) {\r\nguint error = 1<<i;\r\nguint coding_error = golay_decode_matrix[i];\r\nif( weight12(inv_syndrome^coding_error) <= 2 ) {\r\nguint32 error_word = ((guint32)(inv_syndrome^coding_error)) | ((guint32)error)<<12;\r\nreturn (gint32)error_word;\r\n}\r\n}\r\nreturn -1;\r\n}\r\ngint golay_decode(guint32 w)\r\n{\r\nguint data = (guint)w & 0xfff;\r\ngint32 errors = golay_errors(w);\r\nguint data_errors;\r\nif( errors == -1 )\r\nreturn -1;\r\ndata_errors = (guint)errors & 0xfff;\r\nreturn (gint)(data ^ data_errors);\r\n}
