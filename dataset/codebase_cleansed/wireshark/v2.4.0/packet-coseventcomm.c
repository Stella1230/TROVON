static gboolean\r\ndecode_user_exception(tvbuff_t *tvb _U_, packet_info *pinfo _U_, proto_tree *ptree _U_, int *offset _U_, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian _U_)\r\n{\r\nproto_tree *tree _U_;\r\nif (!header->exception_id)\r\nreturn FALSE;\r\nreturn FALSE;\r\n}\r\nstatic void\r\ndecode_CosEventComm_PushConsumer_push(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, proto_item *item, int *offset, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nget_CDR_any(tvb, pinfo, tree, item, offset, stream_is_big_endian, boundary, header);\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PushConsumer_disconnect_push_consumer(tvbuff_t *tvb _U_, packet_info *pinfo, proto_tree *tree _U_, proto_item *item, int *offset _U_, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian _U_)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PushSupplier_disconnect_push_supplier(tvbuff_t *tvb _U_, packet_info *pinfo, proto_tree *tree _U_, proto_item *item, int *offset _U_, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian _U_)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PullSupplier_pull(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, proto_item *item, int *offset, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nget_CDR_any(tvb, pinfo, tree, item, offset, stream_is_big_endian, boundary, header);\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PullSupplier_try_pull(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, proto_item *item, int *offset, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nget_CDR_any(tvb, pinfo, tree, item, offset, stream_is_big_endian, boundary, header);\r\nproto_tree_add_boolean(tree, hf_CosEventComm_PullSupplier_try_pull_has_event, tvb, *offset-1, 1, get_CDR_boolean(tvb,offset));\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PullSupplier_disconnect_pull_supplier(tvbuff_t *tvb _U_, packet_info *pinfo, proto_tree *tree _U_, proto_item *item, int *offset _U_, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian _U_)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndecode_CosEventComm_PullConsumer_disconnect_pull_consumer(tvbuff_t *tvb _U_, packet_info *pinfo, proto_tree *tree _U_, proto_item *item, int *offset _U_, MessageHeader *header, const gchar *operation _U_, gboolean stream_is_big_endian _U_)\r\n{\r\nswitch(header->message_type) {\r\ncase Request:\r\nbreak;\r\ncase Reply:\r\nswitch(header->rep_status) {\r\ncase NO_EXCEPTION:\r\nbreak;\r\ncase USER_EXCEPTION:\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_exception, "Unknown exception %d", header->rep_status);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, item, &ei_coseventcomm_unknown_giop_msg, "Unknown GIOP message %d", header->message_type);\r\nbreak;\r\n}\r\n}\r\nstatic proto_tree *\r\nstart_dissecting(tvbuff_t *tvb, packet_info *pinfo, proto_tree *ptree, int *offset)\r\n{\r\nproto_item *ti = NULL;\r\nproto_tree *tree = NULL;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "COSEVENTCOMM");\r\nif (ptree) {\r\nti = proto_tree_add_item(ptree, proto_coseventcomm, tvb, *offset, tvb_reported_length_remaining(tvb, *offset), ENC_NA);\r\ntree = proto_item_add_subtree(ti, ett_coseventcomm);\r\n}\r\nreturn tree;\r\n}\r\nstatic proto_item*\r\nprocess_RequestOperation(tvbuff_t *tvb, packet_info *pinfo, proto_tree *ptree, MessageHeader *header, const gchar *operation)\r\n{\r\nproto_item *pi;\r\nif(header->message_type == Reply) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " op = %s",operation);\r\n}\r\npi=proto_tree_add_string(ptree, hf_operationrequest, tvb, 0, 0, operation);\r\nPROTO_ITEM_SET_GENERATED(pi);\r\nreturn pi;\r\n}\r\nstatic gboolean\r\ndissect_coseventcomm(tvbuff_t *tvb, packet_info *pinfo, proto_tree *ptree, int *offset, MessageHeader *header, const gchar *operation, gchar *idlname)\r\n{\r\nproto_item *item;\r\nproto_tree *tree;\r\ngboolean stream_is_big_endian = is_big_endian(header);\r\nif ((header->message_type == Reply) && (header->rep_status == USER_EXCEPTION)) {\r\nreturn decode_user_exception(tvb, pinfo, ptree, offset, header, operation, stream_is_big_endian);\r\n}\r\nswitch(header->message_type) {\r\ncase Request:\r\ncase Reply:\r\nif (strcmp(operation, "push") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PushConsumer") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PushConsumer_push(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "disconnect_push_consumer") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PushConsumer") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PushConsumer_disconnect_push_consumer(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "disconnect_push_supplier") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PushSupplier") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PushSupplier_disconnect_push_supplier(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "pull") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PullSupplier") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PullSupplier_pull(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "try_pull") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PullSupplier") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PullSupplier_try_pull(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "disconnect_pull_supplier") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PullSupplier") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PullSupplier_disconnect_pull_supplier(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nif (strcmp(operation, "disconnect_pull_consumer") == 0\r\n&& (!idlname || strcmp(idlname, "CosEventComm/PullConsumer") == 0)) {\r\nitem = process_RequestOperation(tvb, pinfo, ptree, header, operation);\r\ntree = start_dissecting(tvb, pinfo, ptree, offset);\r\ndecode_CosEventComm_PullConsumer_disconnect_pull_consumer(tvb, pinfo, tree, item, offset, header, operation, stream_is_big_endian);\r\nreturn TRUE;\r\n}\r\nbreak;\r\ncase CancelRequest:\r\ncase LocateRequest:\r\ncase LocateReply:\r\ncase CloseConnection:\r\ncase MessageError:\r\ncase Fragment:\r\nreturn FALSE;\r\ndefault:\r\nreturn FALSE;\r\n}\r\nreturn FALSE;\r\n}\r\nvoid proto_register_giop_coseventcomm(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_operationrequest, {"Request_Operation","giop-coseventcomm.Request_Operation",FT_STRING,BASE_NONE,NULL,0x0,NULL,HFILL}},\r\n{&hf_CosEventComm_PullSupplier_try_pull_has_event, {"has_event","giop-coseventcomm.PullSupplier.try_pull.has_event",FT_BOOLEAN,8,NULL,0x01,NULL,HFILL}},\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_coseventcomm_unknown_giop_msg, { "giop-coseventcomm.unknown_giop_msg", PI_PROTOCOL, PI_WARN, "Unknown GIOP message", EXPFILL }},\r\n{ &ei_coseventcomm_unknown_exception, { "giop-coseventcomm.unknown_exception", PI_PROTOCOL, PI_WARN, "Unknown exception", EXPFILL }},\r\n{ &ei_coseventcomm_unknown_reply_status, { "giop-coseventcomm.unknown_reply_status", PI_PROTOCOL, PI_WARN, "Unknown reply status", EXPFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_coseventcomm,\r\n};\r\nexpert_module_t* expert_coseventcomm;\r\nproto_coseventcomm = proto_register_protocol("Coseventcomm Dissector Using GIOP API" , "COSEVENTCOMM", "giop-coseventcomm" );\r\nproto_register_field_array(proto_coseventcomm, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_coseventcomm = expert_register_protocol(proto_coseventcomm);\r\nexpert_register_field_array(expert_coseventcomm, ei, array_length(ei));\r\n}\r\nvoid proto_reg_handoff_giop_coseventcomm(void)\r\n{\r\nregister_giop_user_module(dissect_coseventcomm, "COSEVENTCOMM", "CosEventComm/PullConsumer", proto_coseventcomm );\r\nregister_giop_user_module(dissect_coseventcomm, "COSEVENTCOMM", "CosEventComm/PullSupplier", proto_coseventcomm );\r\nregister_giop_user_module(dissect_coseventcomm, "COSEVENTCOMM", "CosEventComm/PushConsumer", proto_coseventcomm );\r\nregister_giop_user_module(dissect_coseventcomm, "COSEVENTCOMM", "CosEventComm/PushSupplier", proto_coseventcomm );\r\nregister_giop_user(dissect_coseventcomm, "COSEVENTCOMM" ,proto_coseventcomm);\r\n}
