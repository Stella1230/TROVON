static int\r\ndissect_nsrp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *nsrp_tree = NULL;\r\ngint offset = 0;\r\nguint8 msgtype = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "NSRP");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "NSRP Protocol");\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_nsrp, tvb, 0, -1, ENC_NA);\r\nnsrp_tree = proto_item_add_subtree(ti, ett_nsrp);\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_version, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nmsgtype = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msg_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_clust_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msg_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_ha_port, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_not_used, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_dst_unit, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_src_unit, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\nif ( msgtype == 0x00 ) {\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_wst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_hst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgflag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msglen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_encflag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_not_used, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_total_size, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_ns, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_nr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_no_used, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_checksum(nsrp_tree, tvb, offset, hf_nsrp_checksum, -1, NULL, pinfo, 0, ENC_BIG_ENDIAN, PROTO_CHECKSUM_NO_FLAGS);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_data, tvb, offset, -1, ENC_ASCII|ENC_NA);\r\n}\r\nif ( msgtype == 0x02 ) {\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_wst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_hst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgflag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msglen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_authflag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_not_used, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_priority, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_dummy, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_checksum(nsrp_tree, tvb, offset, hf_nsrp_authchecksum, -1, NULL, pinfo, 0, ENC_BIG_ENDIAN, PROTO_CHECKSUM_NO_FLAGS);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_data, tvb, offset, -1, ENC_ASCII|ENC_NA);\r\n}\r\nif ( msgtype == 0x03 ) {\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_wst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_hst_group, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msgflag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_msglen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_ifnum, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_not_used, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_total_size, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(nsrp_tree, hf_nsrp_data, tvb, offset, -1, ENC_ASCII|ENC_NA);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_nsrp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_nsrp_version,\r\n{ "Version", "nsrp.version",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP Version", HFILL }\r\n},\r\n{ &hf_nsrp_msg_type,\r\n{ "Type", "nsrp.type",\r\nFT_UINT8, BASE_DEC, VALS(nsrp_msg_type_vals), 0,\r\n"NSRP Message Type", HFILL }\r\n},\r\n{ &hf_nsrp_clust_id,\r\n{ "Clust ID", "nsrp.clustid",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP CLUST ID", HFILL }\r\n},\r\n{ &hf_nsrp_msg_flag,\r\n{ "Flag", "nsrp.flag",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP FLAG", HFILL }\r\n},\r\n{ &hf_nsrp_len,\r\n{ "Length", "nsrp.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\n"NSRP Length", HFILL }\r\n},\r\n{ &hf_nsrp_ha_port,\r\n{ "Port", "nsrp.haport",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP HA Port", HFILL }\r\n},\r\n{ &hf_nsrp_not_used,\r\n{ "Not used", "nsrp.notused",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_nsrp_dst_unit,\r\n{ "Destination", "nsrp.dst",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"DESTINATION UNIT INFORMATION", HFILL }\r\n},\r\n{ &hf_nsrp_src_unit,\r\n{ "Source", "nsrp.src",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"SOURCE UNIT INFORMATION", HFILL }\r\n},\r\n{ &hf_nsrp_msgtype,\r\n{ "MsgType", "nsrp.msgtype",\r\nFT_UINT8, BASE_DEC, VALS(nsrp_msgtype_vals), 0,\r\n"Message Type", HFILL }\r\n},\r\n{ &hf_nsrp_wst_group,\r\n{ "Wst group", "nsrp.wst",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP WST GROUP", HFILL }\r\n},\r\n{ &hf_nsrp_hst_group,\r\n{ "Hst group", "nsrp.hst",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"NSRP HST GROUP", HFILL }\r\n},\r\n{ &hf_nsrp_msgflag,\r\n{ "Msgflag", "nsrp.msgflag",\r\nFT_UINT8, BASE_DEC, VALS(nsrp_flag_vals), 0,\r\n"NSRP MSG FLAG", HFILL }\r\n},\r\n{ &hf_nsrp_msglen,\r\n{ "Msg Length", "nsrp.msglen",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\n"NSRP MESSAGE LENGTH", HFILL }\r\n},\r\n{ &hf_nsrp_encflag,\r\n{ "Enc Flag", "nsrp.encflag",\r\nFT_UINT8, BASE_DEC, VALS(nsrp_encflag_vals), 0,\r\n"NSRP ENCRYPT FLAG", HFILL }\r\n},\r\n#if 0\r\n{ &hf_nsrp_notused,\r\n{ "Not Used", "nsrp.notused",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_nsrp_total_size,\r\n{ "Total Size", "nsrp.totalsize",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"NSRP MSG TOTAL MESSAGE", HFILL }\r\n},\r\n{ &hf_nsrp_ns,\r\n{ "Ns", "nsrp.ns",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_nsrp_nr,\r\n{ "Nr", "nsrp.nr",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_nsrp_no_used,\r\n{ "Reserved", "nsrp.reserved",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_nsrp_checksum,\r\n{ "Checksum", "nsrp.checksum",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\n"NSRP PACKET CHECKSUM", HFILL }\r\n},\r\n{ &hf_nsrp_authflag,\r\n{ "AuthFlag", "nsrp.authflag",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\n"NSRP Auth Flag", HFILL }\r\n},\r\n{ &hf_nsrp_priority,\r\n{ "Priority", "nsrp.priority",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\n"NSRP Priority", HFILL }\r\n},\r\n{ &hf_nsrp_dummy,\r\n{ "Dummy", "nsrp.dummy",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\n"NSRP Dummy", HFILL }\r\n},\r\n{ &hf_nsrp_authchecksum,\r\n{ "Checksum", "nsrp.authchecksum",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\n"NSRP AUTH CHECKSUM", HFILL }\r\n},\r\n{ &hf_nsrp_ifnum,\r\n{ "Ifnum", "nsrp.ifnum",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\n"NSRP IfNum", HFILL }\r\n},\r\n{ &hf_nsrp_data,\r\n{ "Data", "nsrp.data",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"PADDING", HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_nsrp\r\n};\r\nproto_nsrp = proto_register_protocol("Juniper Netscreen Redundant Protocol",\r\n"NSRP", "nsrp");\r\nproto_register_field_array(proto_nsrp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_nsrp(void)\r\n{\r\ndissector_handle_t nsrp_handle;\r\nnsrp_handle = create_dissector_handle(dissect_nsrp, proto_nsrp);\r\ndissector_add_uint("ethertype", ETHERTYPE_NSRP, nsrp_handle);\r\n}
