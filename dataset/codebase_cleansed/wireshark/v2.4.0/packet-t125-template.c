static int\r\ndissect_t125(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\nproto_item *item = NULL;\r\nproto_tree *tree = NULL;\r\ngint8 ber_class;\r\ngboolean pc;\r\ngint32 tag;\r\ntop_tree = parent_tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "T.125");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_item(parent_tree, proto_t125, tvb, 0, tvb_captured_length(tvb), ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_t125);\r\nget_ber_identifier(tvb, 0, &ber_class, &pc, &tag);\r\nif ( (ber_class==BER_CLASS_APP) && (tag>=101) && (tag<=104) ){\r\ndissect_ConnectMCSPDU_PDU(tvb, pinfo, tree, NULL);\r\n} else {\r\nt124_set_top_tree(top_tree);\r\ndissect_DomainMCSPDU_PDU(tvb, pinfo, tree);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic gboolean\r\ndissect_t125_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\ngint8 ber_class;\r\ngboolean pc;\r\ngint32 tag;\r\nvolatile gboolean failed;\r\nfailed = FALSE;\r\nTRY {\r\nget_ber_identifier(tvb, 0, &ber_class, &pc, &tag);\r\n} CATCH_BOUNDS_ERRORS {\r\nfailed = TRUE;\r\n} ENDTRY;\r\nif (!failed && ((ber_class==BER_CLASS_APP) && ((tag>=101) && (tag<=104)))) {\r\ndissect_t125(tvb, pinfo, parent_tree, NULL);\r\nreturn TRUE;\r\n}\r\nreturn FALSE;\r\n}\r\nvoid proto_register_t125(void) {\r\nstatic hf_register_info hf[] = {\r\n#include "packet-t125-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_t125,\r\n#include "packet-t125-ettarr.c"\r\n};\r\nproto_t125 = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_t125, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nt125_heur_subdissector_list= register_heur_dissector_list("t125", proto_t125);\r\nregister_dissector("t125", dissect_t125, proto_t125);\r\n}\r\nvoid proto_reg_handoff_t125(void) {\r\nheur_dissector_add("cotp", dissect_t125_heur, "T.125 over COTP", "t125_cotp", proto_t125, HEURISTIC_ENABLE);\r\nheur_dissector_add("cotp_is", dissect_t125_heur, "T.125 over COTP (inactive subset)", "t125_cotp_is", proto_t125, HEURISTIC_ENABLE);\r\n}
