static int\r\ndissect_credssp_T_negoToken(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\n#line 45 "./asn1/credssp/credssp.cnf"\r\ntvbuff_t *token_tvb = NULL;\r\nheur_dtbl_entry_t *hdtbl_entry;\r\noffset = dissect_ber_octet_string(implicit_tag, actx, tree, tvb, offset, hf_index,\r\n&token_tvb);\r\nif(token_tvb != NULL)\r\ndissector_try_heuristic(credssp_heur_subdissector_list,\r\ntoken_tvb, actx->pinfo, proto_tree_get_root(tree), &hdtbl_entry, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_NegoData_item(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nNegoData_item_sequence, hf_index, ett_credssp_NegoData_item);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_NegoData(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence_of(implicit_tag, actx, tree, tvb, offset,\r\nNegoData_sequence_of, hf_index, ett_credssp_NegoData);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_OCTET_STRING(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_octet_string(implicit_tag, actx, tree, tvb, offset, hf_index,\r\nNULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_TSPasswordCreds(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nTSPasswordCreds_sequence, hf_index, ett_credssp_TSPasswordCreds);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_INTEGER(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_integer(implicit_tag, actx, tree, tvb, offset, hf_index,\r\nNULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_TSCspDataDetail(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nTSCspDataDetail_sequence, hf_index, ett_credssp_TSCspDataDetail);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_TSSmartCardCreds(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nTSSmartCardCreds_sequence, hf_index, ett_credssp_TSSmartCardCreds);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_T_credType(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_integer(implicit_tag, actx, tree, tvb, offset, hf_index,\r\n&creds_type);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_T_credentials(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\n#line 23 "./asn1/credssp/credssp.cnf"\r\ntvbuff_t *creds_tvb = NULL;\r\ntvbuff_t *decr_tvb = NULL;\r\noffset = dissect_ber_octet_string(implicit_tag, actx, tree, tvb, offset, hf_index,\r\n&creds_tvb);\r\nif((decr_tvb != NULL) &&\r\n((creds_type == TS_PASSWORD_CREDS) || (creds_type == TS_SMARTCARD_CREDS))) {\r\nswitch(creds_type) {\r\ncase TS_PASSWORD_CREDS:\r\noffset = dissect_credssp_TSPasswordCreds(FALSE, decr_tvb, 0, actx, tree, hf_credssp_TSPasswordCreds);\r\nbreak;\r\ncase TS_SMARTCARD_CREDS:\r\noffset = dissect_credssp_TSSmartCardCreds(FALSE, decr_tvb, 0, actx, tree, hf_credssp_TSSmartCardCreds);\r\nbreak;\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_TSCredentials(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nTSCredentials_sequence, hf_index, ett_credssp_TSCredentials);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_T_authInfo(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\n#line 10 "./asn1/credssp/credssp.cnf"\r\ntvbuff_t *auth_tvb = NULL;\r\ntvbuff_t *decr_tvb = NULL;\r\noffset = dissect_ber_octet_string(implicit_tag, actx, tree, tvb, offset, hf_index,\r\n&auth_tvb);\r\nif(decr_tvb != NULL)\r\noffset = dissect_credssp_TSCredentials(FALSE, decr_tvb, 0, actx, tree, hf_credssp_TSCredentials);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp_TSRequest(gboolean implicit_tag _U_, tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_ber_sequence(implicit_tag, actx, tree, tvb, offset,\r\nTSRequest_sequence, hf_index, ett_credssp_TSRequest);\r\nreturn offset;\r\n}\r\nstatic int dissect_TSRequest_PDU(tvbuff_t *tvb _U_, packet_info *pinfo _U_, proto_tree *tree _U_, void *data _U_) {\r\nint offset = 0;\r\nasn1_ctx_t asn1_ctx;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_BER, TRUE, pinfo);\r\noffset = dissect_credssp_TSRequest(FALSE, tvb, offset, &asn1_ctx, tree, hf_credssp_TSRequest_PDU);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_credssp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nif(parent_tree){\r\nitem = proto_tree_add_item(parent_tree, proto_credssp, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_credssp);\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "CredSSP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ncreds_type = -1;\r\nreturn dissect_TSRequest_PDU(tvb, pinfo, tree, data);\r\n}\r\nstatic gboolean\r\ndissect_credssp_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\nasn1_ctx_t asn1_ctx;\r\nint offset = 0;\r\ngint8 ber_class;\r\ngboolean pc;\r\ngint32 tag;\r\nguint32 length;\r\ngint8 ver;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_BER, TRUE, pinfo);\r\nif(tvb_captured_length(tvb) > 7) {\r\noffset = get_ber_identifier(tvb, offset, &ber_class, &pc, &tag);\r\nif((ber_class == BER_CLASS_UNI) && (tag == BER_UNI_TAG_SEQUENCE) && (pc == TRUE)) {\r\noffset = get_ber_length(tvb, offset, NULL, NULL);\r\noffset = get_ber_identifier(tvb, offset, &ber_class, &pc, &tag);\r\nif((ber_class == BER_CLASS_CON) && (tag == 0)) {\r\noffset = get_ber_length(tvb, offset, NULL, NULL);\r\noffset = get_ber_identifier(tvb, offset, &ber_class, &pc, &tag);\r\nif((ber_class == BER_CLASS_UNI) && (tag == BER_UNI_TAG_INTEGER)) {\r\noffset = get_ber_length(tvb, offset, &length, NULL);\r\nver = tvb_get_guint8(tvb, offset);\r\nif((length == 1) && ((ver == 2) || (ver == 3))) {\r\nif (have_tap_listener(exported_pdu_tap)) {\r\nexp_pdu_data_t *exp_pdu_data = export_pdu_create_common_tags(pinfo, "credssp", EXP_PDU_TAG_PROTO_NAME);\r\nexp_pdu_data->tvb_captured_length = tvb_captured_length(tvb);\r\nexp_pdu_data->tvb_reported_length = tvb_reported_length(tvb);\r\nexp_pdu_data->pdu_tvb = tvb;\r\ntap_queue_packet(exported_pdu_tap, pinfo, exp_pdu_data);\r\n}\r\ndissect_credssp(tvb, pinfo, parent_tree, NULL);\r\nreturn TRUE;\r\n}\r\n}\r\n}\r\n}\r\n}\r\nreturn FALSE;\r\n}\r\nvoid proto_register_credssp(void) {\r\nstatic hf_register_info hf[] =\r\n{\r\n{ &hf_credssp_TSPasswordCreds,\r\n{ "TSPasswordCreds", "credssp.TSPasswordCreds",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_TSSmartCardCreds,\r\n{ "TSSmartCardCreds", "credssp.TSSmartCardCreds",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_TSCredentials,\r\n{ "TSCredentials", "credssp.TSCredentials",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#line 1 "./asn1/credssp/packet-credssp-hfarr.c"\r\n{ &hf_credssp_TSRequest_PDU,\r\n{ "TSRequest", "credssp.TSRequest_element",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_NegoData_item,\r\n{ "NegoData item", "credssp.NegoData_item_element",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_negoToken,\r\n{ "negoToken", "credssp.negoToken",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_domainName,\r\n{ "domainName", "credssp.domainName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_userName,\r\n{ "userName", "credssp.userName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_password,\r\n{ "password", "credssp.password",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_keySpec,\r\n{ "keySpec", "credssp.keySpec",\r\nFT_INT32, BASE_DEC, NULL, 0,\r\n"INTEGER", HFILL }},\r\n{ &hf_credssp_cardName,\r\n{ "cardName", "credssp.cardName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_readerName,\r\n{ "readerName", "credssp.readerName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_containerName,\r\n{ "containerName", "credssp.containerName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_cspName,\r\n{ "cspName", "credssp.cspName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_pin,\r\n{ "pin", "credssp.pin",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_cspData,\r\n{ "cspData", "credssp.cspData_element",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"TSCspDataDetail", HFILL }},\r\n{ &hf_credssp_userHint,\r\n{ "userHint", "credssp.userHint",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_domainHint,\r\n{ "domainHint", "credssp.domainHint",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n{ &hf_credssp_credType,\r\n{ "credType", "credssp.credType",\r\nFT_INT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_credentials,\r\n{ "credentials", "credssp.credentials",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_version,\r\n{ "version", "credssp.version",\r\nFT_INT32, BASE_DEC, NULL, 0,\r\n"INTEGER", HFILL }},\r\n{ &hf_credssp_negoTokens,\r\n{ "negoTokens", "credssp.negoTokens",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"NegoData", HFILL }},\r\n{ &hf_credssp_authInfo,\r\n{ "authInfo", "credssp.authInfo",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_credssp_pubKeyAuth,\r\n{ "pubKeyAuth", "credssp.pubKeyAuth",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"OCTET_STRING", HFILL }},\r\n#line 147 "./asn1/credssp/packet-credssp-template.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_credssp,\r\n#line 1 "./asn1/credssp/packet-credssp-ettarr.c"\r\n&ett_credssp_NegoData,\r\n&ett_credssp_NegoData_item,\r\n&ett_credssp_TSPasswordCreds,\r\n&ett_credssp_TSCspDataDetail,\r\n&ett_credssp_TSSmartCardCreds,\r\n&ett_credssp_TSCredentials,\r\n&ett_credssp_TSRequest,\r\n#line 153 "./asn1/credssp/packet-credssp-template.c"\r\n};\r\nproto_credssp = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nregister_dissector("credssp", dissect_credssp, proto_credssp);\r\nproto_register_field_array(proto_credssp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\ncredssp_heur_subdissector_list = register_heur_dissector_list("credssp", proto_credssp);\r\n}\r\nvoid proto_reg_handoff_credssp(void) {\r\nheur_dissector_add("ssl", dissect_credssp_heur, "CredSSP over SSL", "credssp_ssl", proto_credssp, HEURISTIC_ENABLE);\r\nexported_pdu_tap = find_tap_id(EXPORT_PDU_TAP_NAME_LAYER_7);\r\n}
