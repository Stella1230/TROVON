static void\r\nman_addr_ill_addr_cb(gpointer dialog _U_, gint btn _U_, gpointer data _U_)\r\n{\r\ngtk_window_present(GTK_WINDOW(man_addr_resolv_dlg));\r\n}\r\nstatic void\r\nman_addr_resolv_ok(GtkWidget *w _U_, gpointer data _U_)\r\n{\r\nGtkWidget *addr_cb, *name_te, *resolv_cb;\r\nconst gchar *name;\r\ngchar *addr;\r\ngboolean active, redissect = FALSE;\r\naddr_cb = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "address");\r\nname_te = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "name");\r\naddr = gtk_combo_box_text_get_active_text(GTK_COMBO_BOX_TEXT(addr_cb));\r\nname = gtk_entry_get_text(GTK_ENTRY(name_te));\r\nif (strlen(addr) && strlen(name)) {\r\nif (!cf_add_ip_name_from_string(&cfile, addr, name)) {\r\nGtkWidget *dialog = (GtkWidget *)simple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Illegal IP address: \"%s\".", addr);\r\nsimple_dialog_set_cb(dialog, man_addr_ill_addr_cb, NULL);\r\ng_free(addr);\r\nreturn;\r\n} else {\r\nredissect = TRUE;\r\nmain_update_for_unsaved_changes(&cfile);\r\n}\r\n}\r\ng_free(addr);\r\nresolv_cb = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "resolv");\r\nactive = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(resolv_cb));\r\nif (!gbl_resolv_flags.network_name && active) {\r\ngbl_resolv_flags.network_name = TRUE;\r\nmenu_name_resolution_changed();\r\nredissect = TRUE;\r\n}\r\nif (redissect) {\r\nredissect_packets();\r\nredissect_all_packet_windows();\r\n}\r\nwindow_destroy(man_addr_resolv_dlg);\r\nman_addr_resolv_dlg = NULL;\r\n}\r\nstatic void\r\nchanged_cb(GtkWidget *w _U_, GtkWidget *ok_bt)\r\n{\r\nconst gchar *name;\r\ngchar *addr;\r\nGtkWidget *addr_cb, *name_cb, *resolv_cb;\r\ngboolean active;\r\nname_cb = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "name");\r\naddr_cb = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "address");\r\nresolv_cb = (GtkWidget *)g_object_get_data(G_OBJECT(man_addr_resolv_dlg), "resolv");\r\nname = gtk_entry_get_text(GTK_ENTRY(name_cb));\r\naddr = gtk_combo_box_text_get_active_text(GTK_COMBO_BOX_TEXT(addr_cb));\r\nactive = gtk_toggle_button_get_active(GTK_TOGGLE_BUTTON(resolv_cb));\r\ngtk_widget_set_sensitive(ok_bt, strlen(name) > 0 && strlen(addr) && active ? TRUE : FALSE);\r\ng_free(addr);\r\n}\r\nvoid\r\nmanual_addr_resolv_dlg(GtkWidget *w _U_, gpointer data)\r\n{\r\nGtkWidget *vbox, *bbox, *grid, *sep;\r\nGtkWidget *ok_bt, *close_bt, *help_bt;\r\nGtkWidget *addr_lb, *addr_cb;\r\nGtkWidget *name_lb, *name_te, *resolv_cb;\r\nGList *addr_list = NULL;\r\nman_addr_resolv_dlg = dlg_window_new("Manual Address Resolve");\r\ngtk_window_set_default_size(GTK_WINDOW(man_addr_resolv_dlg), 310, 80);\r\nvbox = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_container_add(GTK_CONTAINER(man_addr_resolv_dlg), vbox);\r\ngtk_container_set_border_width(GTK_CONTAINER(vbox), 6);\r\ngrid = ws_gtk_grid_new();\r\ngtk_box_pack_start(GTK_BOX(vbox), grid, TRUE, TRUE, 0);\r\naddr_lb = gtk_label_new("Address:");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), addr_lb, 0, 0, 1, 1);\r\naddr_cb = gtk_combo_box_text_new_with_entry();\r\nif (data) {\r\nGList *addr_entry;\r\naddr_list = get_ip_address_list_from_packet_list_row(data);\r\nfor (addr_entry = addr_list; addr_entry != NULL; addr_entry = g_list_next(addr_entry)) {\r\ngtk_combo_box_text_append_text(GTK_COMBO_BOX_TEXT(addr_cb), (const gchar *)addr_entry->data);\r\ng_free(addr_entry->data);\r\n}\r\ng_list_free(addr_entry);\r\ngtk_combo_box_set_active(GTK_COMBO_BOX(addr_cb), 0);\r\n}\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), addr_cb, 1, 0, 1, 1);\r\ng_object_set_data(G_OBJECT(man_addr_resolv_dlg), "address", addr_cb);\r\nname_lb = gtk_label_new("Name:");\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), name_lb, 0, 1, 1, 1);\r\nname_te = gtk_entry_new();\r\nws_gtk_grid_attach_defaults(GTK_GRID(grid), name_te, 1, 1, 1, 1);\r\ng_object_set_data(G_OBJECT(man_addr_resolv_dlg), "name", name_te);\r\nsep = gtk_separator_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(vbox), sep, TRUE, TRUE, 0);\r\nresolv_cb = gtk_check_button_new_with_mnemonic("Enable network name resolution");\r\ngtk_toggle_button_set_active(GTK_TOGGLE_BUTTON(resolv_cb), gbl_resolv_flags.network_name);\r\ngtk_widget_set_sensitive(resolv_cb, !gbl_resolv_flags.network_name);\r\ngtk_widget_set_tooltip_text(resolv_cb, "Perform network layer name resolution.");\r\ng_object_set_data(G_OBJECT(man_addr_resolv_dlg), "resolv", resolv_cb);\r\ngtk_box_pack_start(GTK_BOX(vbox), resolv_cb, TRUE, TRUE, 0);\r\nbbox = dlg_button_row_new(GTK_STOCK_OK, GTK_STOCK_CLOSE, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_end(GTK_BOX(vbox), bbox, FALSE, FALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_OK);\r\ng_signal_connect(ok_bt, "clicked", G_CALLBACK(man_addr_resolv_ok), NULL);\r\ngtk_widget_set_sensitive(ok_bt, FALSE);\r\ng_signal_connect(name_te, "changed", G_CALLBACK(changed_cb), ok_bt);\r\ng_signal_connect(addr_cb, "changed", G_CALLBACK(changed_cb), ok_bt);\r\ng_signal_connect(resolv_cb, "toggled", G_CALLBACK(changed_cb), ok_bt);\r\ndlg_set_activate(name_te, ok_bt);\r\nclose_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_CLOSE);\r\nwindow_set_cancel_button(man_addr_resolv_dlg, close_bt, window_cancel_button_cb);\r\nhelp_bt = (GtkWidget *)g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer)HELP_MANUAL_ADDR_RESOLVE_DIALOG);\r\ngtk_widget_grab_default(ok_bt);\r\ng_signal_connect(man_addr_resolv_dlg, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\nif (addr_list) {\r\ngtk_widget_grab_focus(name_te);\r\n}\r\ngtk_widget_show_all(man_addr_resolv_dlg);\r\nwindow_present(man_addr_resolv_dlg);\r\n}
