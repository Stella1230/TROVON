static guint16\r\nde_ta(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_ta, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_bsslap_cause(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_cause, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_rrlp_flg(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_rrlp_flg, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_rrlp_ie(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ntvbuff_t *rrlp_tvb;\r\nguint16 length;\r\nlength = tvb_get_ntohs(tvb, offset);\r\ncurr_offset = offset + 2;\r\nif (length > 0)\r\n{\r\nrrlp_tvb = tvb_new_subset_length(tvb, curr_offset, length);\r\nif (bsslap_rrlp_handle)\r\ncall_dissector(bsslap_rrlp_handle, rrlp_tvb, pinfo, tree);\r\n}\r\ncurr_offset += length;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_cell_id_list(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, guint32 offset, guint len, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\nguint8 consumed;\r\nguint8 cell_id_disc;\r\nguint8 num_cells;\r\nproto_item *item = NULL;\r\nproto_tree *subtree = NULL;\r\ncurr_offset = offset;\r\ncell_id_disc = tvb_get_guint8(tvb,curr_offset);\r\nnum_cells = 0;\r\nwhile(len>0){\r\nnum_cells++;\r\nconsumed = 0;\r\nsubtree = proto_tree_add_subtree_format(tree, tvb, curr_offset, -1, ett_bsslap_cell_list, &item, "Cell %u", num_cells);\r\nif (add_string)\r\nadd_string[0] = '\0';\r\nproto_tree_add_item(subtree, hf_gsm_bsslap_cell_id_disc, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nlen--;\r\nswitch(cell_id_disc){\r\ncase 0:\r\nconsumed+= be_cell_id_aux(tvb, subtree, pinfo, curr_offset, len, NULL, 0, 0);\r\nbreak;\r\ncase 1:\r\nconsumed+= be_cell_id_aux(tvb, subtree, pinfo, curr_offset, len, NULL, 0, 1);\r\nbreak;\r\ncase 2:\r\ncase 3:\r\ndefault:\r\nproto_tree_add_expert(subtree, pinfo, &ei_gsm_bsslap_not_decoded_yet, tvb, curr_offset, len);\r\nconsumed = len;\r\nbreak;\r\n}\r\ncurr_offset += consumed;\r\nlen-=consumed;\r\nproto_item_set_len(item, consumed+1);\r\n}\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_enh_meas_rep(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, guint32 offset, guint len, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_expert(tree, pinfo, &ei_gsm_bsslap_not_decoded_yet, tvb, curr_offset, len);\r\nreturn(len);\r\n}\r\nstatic guint16\r\nde_lac(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_lac, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_ms_pow(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_ms_pow, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_delta_time(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_timer_value, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_blap_enc_key(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_encryption_key, tvb, curr_offset, 8, ENC_NA);\r\ncurr_offset = curr_offset + 8;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_poll_rep(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_poll_rep, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic guint16\r\nde_pkt_ch_desc(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, guint32 offset, guint len, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_expert(tree, pinfo, &ei_gsm_bsslap_not_decoded_yet, tvb, curr_offset, len);\r\nreturn(len);\r\n}\r\nstatic guint16\r\nde_tfi(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo _U_, guint32 offset, guint len _U_, gchar *add_string _U_, int string_len _U_)\r\n{\r\nguint32 curr_offset;\r\ncurr_offset = offset;\r\nproto_tree_add_item(tree, hf_gsm_bsslap_tfi, tvb, curr_offset, 1, ENC_BIG_ENDIAN);\r\ncurr_offset++;\r\nreturn(curr_offset - offset);\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_ta_res(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_CELL_IDENTITY, GSM_A_PDU_TYPE_COMMON, DE_CELL_ID, "Serving Cell Identity", ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_TIMING_ADVANCE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TA, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MEAS_REP, " BSSLAP");\r\nELEM_OPT_TLV(BSSLAP_PARAM_ENHANCED_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENH_MEAS_REP, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_CELL_IDENTITY_LIST, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CELL_ID_LIST, "-Measured Cell");\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_reject(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_CAUSE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CAUSE, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_reset(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_CELL_IDENTITY, GSM_A_PDU_TYPE_COMMON, DE_CELL_ID, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_TIMING_ADVANCE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TA, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_CHANNEL_DESCRIPTION,GSM_A_PDU_TYPE_RR, DE_RR_CH_DSC, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_CAUSE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CAUSE, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MEAS_REP, " BSSLAP");\r\nELEM_OPT_TLV(BSSLAP_PARAM_ENHANCED_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENH_MEAS_REP, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_CELL_IDENTITY_LIST, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CELL_ID_LIST, "-Measured Cell");\r\nELEM_OPT_TLV(BSSLAP_PARAM_LOCATION_AREA_CODE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_LAC, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_FREQUENCY_LIST, GSM_A_PDU_TYPE_RR, DE_RR_FREQ_LIST, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_CHANNEL_MODE, GSM_A_PDU_TYPE_RR, DE_RR_CH_MODE, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MULTIRATE_CONFIGURATION, GSM_A_PDU_TYPE_RR, DE_RR_MULTIRATE_CONF, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_PACKET_CHANNEL_DESCRIPTION, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_PKT_CH_DESC, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_TLLI, GSM_A_PDU_TYPE_RR, DE_RR_TLLI,NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_TFI, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TFI,NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_STARTING_TIME, GSM_A_PDU_TYPE_RR, DE_RR_STARTING_TIME, "TBF Starting Time");\r\nELEM_OPT_TV(BSSLAP_PARAM_ENCRYPTION_KEY, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENC_KEY,NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_CIPHER_MODE_SETTING, GSM_A_PDU_TYPE_RR, DE_RR_CIP_MODE_SET, NULL);\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_abort(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_CAUSE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CAUSE, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_ta_layer3(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_TIMING_ADVANCE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TA, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MEAS_REP, " BSSLAP");\r\nELEM_OPT_TLV(BSSLAP_PARAM_ENHANCED_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENH_MEAS_REP, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_CELL_IDENTITY_LIST, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CELL_ID_LIST, "-Measured Cell");\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_ms_pos_cmd(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_RRLP_FLAG, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_RRLP_FLG, "flag", ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_RRLP_IE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_RRLP_IE, "RRLP Info", ei_gsm_bsslap_missing_mandatory_element);\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_ms_pos_res(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_RRLP_FLAG, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_RRLP_FLG, "flag", ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TV(BSSLAP_PARAM_RRLP_IE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_RRLP_IE, "RRLP Info", ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_OPT_TV(BSSLAP_PARAM_TIMING_ADVANCE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TA, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MEAS_REP, " BSSLAP");\r\nELEM_OPT_TLV(BSSLAP_PARAM_ENHANCED_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENH_MEAS_REP, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_CELL_IDENTITY_LIST, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CELL_ID_LIST, "-Measured Cell");\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_u_tdoa_req(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_OPT_TV(BSSLAP_PARAM_DELTA_TIMER, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_DELTA_TIME, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_POLLING_REPETITION, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_POLL_REP, NULL);\r\nreturn;\r\n}\r\nstatic void\r\ndissect_gsm_bsslap_u_tdoa_res(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nguint32 curr_offset;\r\nguint32 consumed;\r\nguint curr_len;\r\ncurr_offset = offset;\r\ncurr_len = tvb_reported_length_remaining(tvb,offset);\r\nELEM_MAND_TV(BSSLAP_PARAM_CHANNEL_DESCRIPTION,GSM_A_PDU_TYPE_RR, DE_RR_CH_DSC, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_MAND_TLV(BSSLAP_PARAM_SERVING_CELL_IDENTIFIER,GSM_A_PDU_TYPE_BSSMAP, BE_CELL_ID, NULL, ei_gsm_bsslap_missing_mandatory_element);\r\nELEM_OPT_TLV(BSSLAP_PARAM_FREQUENCY_LIST, GSM_A_PDU_TYPE_RR, DE_RR_FREQ_LIST, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_TIMING_ADVANCE, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TA, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_MS_POWER, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MS_POW, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MEASUREMENT_REPORT, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_MEAS_REP, " BSSLAP");\r\nELEM_OPT_TV(BSSLAP_PARAM_ENCRYPTION_KEY, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_ENC_KEY, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_CIPHER_MODE_SETTING, GSM_A_PDU_TYPE_RR, DE_RR_CIP_MODE_SET, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_CHANNEL_MODE, GSM_A_PDU_TYPE_RR, DE_RR_CH_MODE, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_MULTIRATE_CONFIGURATION, GSM_A_PDU_TYPE_RR, DE_RR_MULTIRATE_CONF, NULL);\r\nELEM_OPT_TLV(BSSLAP_PARAM_CELL_IDENTITY_LIST, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_CELL_ID_LIST, "-Measured Cell");\r\nELEM_OPT_TLV(BSSLAP_PARAM_PACKET_CHANNEL_DESCRIPTION, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_PKT_CH_DESC, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_TLLI, GSM_A_PDU_TYPE_RR, DE_RR_TLLI, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_TFI, GSM_A_PDU_TYPE_BSSLAP, DE_BLAP_TFI, NULL);\r\nELEM_OPT_TV(BSSLAP_PARAM_STARTING_TIME, GSM_A_PDU_TYPE_RR, DE_RR_STARTING_TIME, "TBF Starting Time");\r\nreturn;\r\n}\r\nstatic int\r\ndissect_gsm_bsslap(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *item;\r\nproto_tree *sub_tree;\r\nint offset=0;\r\nguint8 octet;\r\ncol_append_str(pinfo->cinfo, COL_PROTOCOL, "/BSSLAP");\r\nif (tree) {\r\noctet = tvb_get_guint8(tvb, offset);\r\nitem = proto_tree_add_item(tree, proto_gsm_bsslap, tvb, 0, -1, ENC_NA);\r\nsub_tree = proto_item_add_subtree(item, ett_gsm_bsslap);\r\nproto_tree_add_item(sub_tree, hf_gsm_bsslap_msg_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nswitch (octet){\r\ncase BSSLAP_TA_REQUEST:\r\nbreak;\r\ncase BSSLAP_TA_RESPONSE:\r\ndissect_gsm_bsslap_ta_res(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_REJECT:\r\ndissect_gsm_bsslap_reject(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_RESET:\r\ndissect_gsm_bsslap_reset(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_ABORT:\r\ndissect_gsm_bsslap_abort(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_TA_LAYER3:\r\ndissect_gsm_bsslap_ta_layer3(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_MS_POS_CMD:\r\ndissect_gsm_bsslap_ms_pos_cmd(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_MS_POS_RES:\r\ndissect_gsm_bsslap_ms_pos_res(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_U_TDOA_REQ:\r\ndissect_gsm_bsslap_u_tdoa_req(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ncase BSSLAP_U_TDOA_RES:\r\ndissect_gsm_bsslap_u_tdoa_res(tvb, sub_tree, pinfo, offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_reg_handoff_gsm_bsslap(void)\r\n{\r\nbsslap_rrlp_handle = find_dissector_add_dependency("rrlp", proto_gsm_bsslap);\r\n}\r\nvoid\r\nproto_register_gsm_bsslap(void)\r\n{\r\nguint i;\r\nguint last_offset;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_gsm_bsslap_msg_type,\r\n{ "Message Type IE", "gsm_bsslap.msg_type",\r\nFT_UINT8, BASE_DEC, VALS(gsm_a_bsslap_msg_strings), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_a_bsslap_elem_id,\r\n{ "Element ID", "gsm_bsslap.elem_id",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_ta,\r\n{ "Timing Advance", "gsm_bsslap.ta",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_timer_value,\r\n{"Timer Value", "gsm_bsslap.timerValue",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_ms_pow,\r\n{"MS Power", "gsm_bsslap.MS_pow",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_cause,\r\n{"Cause", "gsm_bsslap.cause",\r\nFT_UINT8, BASE_DEC, VALS(gsm_bsslap_cause_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_rrlp_flg,\r\n{"RRLP Flag", "gsm_bsslap.rrlp_flg",\r\nFT_BOOLEAN, 8, TFS(&gsm_bsslap_rrlp_flg_vals), 0x01,\r\n"Cause", HFILL }\r\n},\r\n{ &hf_gsm_bsslap_tfi,\r\n{"TFI", "gsm_bsslap.tfi",\r\nFT_UINT8, BASE_DEC, NULL, 0x1f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_poll_rep,\r\n{"Number of polling repetitions", "gsm_bsslap.poll_rep",\r\nFT_UINT8, BASE_DEC, NULL, 0x3F,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_lac,\r\n{"Location Area Code", "gsm_bsslap.lac",\r\nFT_UINT8, BASE_DEC, NULL, 0x3f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_cell_id_disc,\r\n{"Cell identification Discriminator", "gsm_bsslap.cell_id_disc",\r\nFT_UINT8, BASE_DEC, VALS(gsm_a_bsslap_cell_id_disc_vals), 0xf,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gsm_bsslap_encryption_key,\r\n{"Encryption Key (Kc)", "gsm_bsslap.encryption_key",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_gsm_bsslap_missing_mandatory_element, { "gsm_bsslap.missing_mandatory_element", PI_PROTOCOL, PI_WARN, "Missing Mandatory element, rest of dissection is suspect", EXPFILL }},\r\n{ &ei_gsm_bsslap_not_decoded_yet, { "gsm_bsslap.not_decoded_yet", PI_UNDECODED, PI_WARN, "Not decoded yet", EXPFILL }},\r\n};\r\nexpert_module_t* expert_gsm_bsslap;\r\n#define NUM_INDIVIDUAL_ELEMS 2\r\ngint *ett[NUM_INDIVIDUAL_ELEMS + NUM_GSM_BSSLAP_MSG +\r\nNUM_GSM_BSSLAP_ELEM];\r\nett[0] = &ett_gsm_bsslap;\r\nett[1] = &ett_bsslap_cell_list;\r\nlast_offset = NUM_INDIVIDUAL_ELEMS;\r\nfor (i=0; i < NUM_GSM_BSSLAP_MSG; i++, last_offset++)\r\n{\r\nett_gsm_bsslap_msg[i] = -1;\r\nett[last_offset] = &ett_gsm_bsslap_msg[i];\r\n}\r\nfor (i=0; i < NUM_GSM_BSSLAP_ELEM; i++, last_offset++)\r\n{\r\nett_gsm_bsslap_elem[i] = -1;\r\nett[last_offset] = &ett_gsm_bsslap_elem[i];\r\n}\r\nproto_gsm_bsslap =\r\nproto_register_protocol("BSS LCS Assistance Protocol",\r\n"BSSLAP", "bsslap");\r\nproto_register_field_array(proto_gsm_bsslap, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_gsm_bsslap = expert_register_protocol(proto_gsm_bsslap);\r\nexpert_register_field_array(expert_gsm_bsslap, ei, array_length(ei));\r\nregister_dissector("gsm_bsslap", dissect_gsm_bsslap, proto_gsm_bsslap);\r\n}
