static int dissect_mac_mgmt_msg_decoder(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint offset = 0;\r\nguint message_type;\r\nproto_item *message_item;\r\nproto_tree *message_tree;\r\nconst char* mgt_msg_str;\r\nmessage_item = proto_tree_add_protocol_format(tree, proto_mac_mgmt_msg_decoder, tvb, offset, -1,\r\n"MAC Management Message Type (%u bytes)", tvb_reported_length(tvb));\r\nmessage_tree = proto_item_add_subtree(message_item, ett_mac_mgmt_msg_decoder);\r\nif (tvb_reported_length(tvb) == 0)\r\n{\r\nexpert_add_info(pinfo, message_item, &ei_empty_payload);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nmessage_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(message_tree, hf_mac_mgmt_msg_type, tvb, offset, 1, ENC_NA);\r\nmgt_msg_str = val_to_str_ext_const(message_type, &mgt_msg_abbrv_vals_ext, "Unknown");\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", mgt_msg_str);\r\nif (try_val_to_str_ext(message_type, &mgt_msg_abbrv_vals_ext) == NULL)\r\n{\r\nproto_tree_add_item(message_tree, hf_mac_mgmt_msg_values, tvb, offset, -1, ENC_NA);\r\nreturn 1;\r\n}\r\nproto_item_append_text(proto_tree_get_parent(tree), ", %s", mgt_msg_str);\r\nif (!dissector_try_uint(subdissector_message_table, message_type,\r\ntvb_new_subset_remaining(tvb, 1), pinfo, tree))\r\n{\r\nproto_tree_add_item(message_tree, hf_mac_mgmt_msg_values, tvb, offset, -1, ENC_NA);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid proto_register_mac_mgmt_msg(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_mac_mgmt_msg_type,\r\n{\r\n"MAC Management Message Type", "wmx.macmgtmsgtype",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &mgt_msg_abbrv_vals_ext, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_mgmt_msg_values,\r\n{\r\n"Values", "wmx.values",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_mac_mgmt_msg_decoder,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_empty_payload, { "wmx.empty_payload", PI_PROTOCOL, PI_ERROR, "Error: Mac payload tvb is empty !", EXPFILL }},\r\n};\r\nexpert_module_t* expert_mac_mgmt;\r\nproto_mac_mgmt_msg_decoder = proto_register_protocol (\r\n"WiMax MAC Management Message",\r\n"MGMT MSG",\r\n"wmx.mgmt"\r\n);\r\nproto_register_field_array(proto_mac_mgmt_msg_decoder, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_mac_mgmt = expert_register_protocol(proto_mac_mgmt_msg_decoder);\r\nexpert_register_field_array(expert_mac_mgmt, ei, array_length(ei));\r\nsubdissector_message_table = register_dissector_table("wmx.mgmtmsg",\r\n"WiMax MAC Management Message", proto_mac_mgmt_msg_decoder, FT_UINT8, BASE_DEC);\r\nregister_dissector("wmx_mac_mgmt_msg_decoder", dissect_mac_mgmt_msg_decoder,\r\nproto_mac_mgmt_msg_decoder);\r\n}\r\nvoid proto_reg_handoff_mac_mgmt_msg(void)\r\n{\r\ndissector_handle_t mgt_msg_handle;\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mca_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MCA_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mca_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MCA_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_dbpc_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_DBPC_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_dbpc_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_DBPC_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_tftp_cplt_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_TFTP_CPLT, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_tftp_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_TFTP_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_ncfg_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MSH_NCFG, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_nent_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MSH_NENT, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_dsch_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MSH_DSCH, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_csch_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MSH_CSCH, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_cscf_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MSH_CSCF, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_aas_beam_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_AAS_BEAM_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_aas_beam_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_AAS_BEAM_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_slp_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_SLP_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_slp_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_SLP_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_trf_ind_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_TRF_IND, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_nbr_adv_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_NBR_ADV, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_scn_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_SCN_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_scn_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_SCN_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_bsho_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_BSHO_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_msho_req_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_MSHO_REQ, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_bsho_rsp_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_BSHO_RSP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_ho_ind_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_HO_IND, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_scn_rep_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_SCN_REP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_pag_adv_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_PAG_ADV, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mbs_map_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MBS_MAP, mgt_msg_handle );\r\nmgt_msg_handle = find_dissector("mac_mgmt_msg_mob_asc_rep_handler");\r\nif (mgt_msg_handle)\r\ndissector_add_uint( "wmx.mgmtmsg", MAC_MGMT_MSG_MOB_ASC_REP, mgt_msg_handle );\r\n}
