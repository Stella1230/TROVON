static int\r\ndissect_hpext(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *hpext_tree = NULL;\r\nproto_item *ti = NULL;\r\nguint16 dxsap, sxsap;\r\ntvbuff_t *next_tvb;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "HPEXT");\r\ndxsap = tvb_get_ntohs(tvb, 3);\r\nsxsap = tvb_get_ntohs(tvb, 5);\r\nif (tree) {\r\nti = proto_tree_add_item(tree, hfi_hpext, tvb, 0, 7, ENC_NA);\r\nhpext_tree = proto_item_add_subtree(ti, ett_hpext);\r\nproto_tree_add_item(hpext_tree, &hfi_hpext_reserved, tvb, 0, 3, ENC_NA);\r\nproto_tree_add_uint(hpext_tree, &hfi_hpext_dxsap, tvb, 3,\r\n2, dxsap);\r\nproto_tree_add_uint(hpext_tree, &hfi_hpext_sxsap, tvb, 5,\r\n2, sxsap);\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n"; HPEXT; DXSAP %s, SXSAP %s",\r\nval_to_str(dxsap, xsap_vals, "%04x"),\r\nval_to_str(sxsap, xsap_vals, "%04x"));\r\nif (tvb_reported_length_remaining(tvb, 7) > 0) {\r\nnext_tvb = tvb_new_subset_remaining(tvb, 7);\r\nif (!dissector_try_uint(subdissector_table,\r\ndxsap, next_tvb, pinfo, tree)) {\r\ncall_data_dissector(next_tvb, pinfo, tree);\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_hpext(void)\r\n{\r\n#ifndef HAVE_HFI_SECTION_INIT\r\nstatic header_field_info *hfi[] = {\r\n&hfi_hpext_reserved,\r\n&hfi_hpext_dxsap,\r\n&hfi_hpext_sxsap,\r\n};\r\n#endif\r\nstatic gint *ett[] = {\r\n&ett_hpext\r\n};\r\nint proto_hpext;\r\nproto_hpext = proto_register_protocol(\r\n"HP Extended Local-Link Control", "HPEXT", "hpext");\r\nhfi_hpext = proto_registrar_get_nth(proto_hpext);\r\nproto_register_fields(proto_hpext, hfi, array_length(hfi));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nsubdissector_table = register_dissector_table("hpext.dxsap",\r\n"HPEXT XSAP", proto_hpext, FT_UINT16, BASE_HEX);\r\nhpext_handle = register_dissector("hpext", dissect_hpext, proto_hpext);\r\n}\r\nvoid\r\nproto_reg_handoff_hpext(void)\r\n{\r\ndissector_add_uint("llc.dsap", SAP_HPEXT, hpext_handle);\r\n}
