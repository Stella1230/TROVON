static void\r\neth_hash_to_texbuff(gpointer key, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nguint8 *eth_addr = (guint8*)key;\r\nhashether_t* tp = (hashether_t*)value;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "%.2X:%.2X:%.2X:%.2X:%.2X:%.2X Status: %u %s %s\n",\r\neth_addr[0], eth_addr[1], eth_addr[2],\r\neth_addr[3], eth_addr[4], eth_addr[5],\r\nget_hash_ether_status(tp),\r\nget_hash_ether_hexaddr(tp),\r\nget_hash_ether_resolved_name(tp));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nmanuf_hash_to_texbuff(gpointer key, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nhashmanuf_t *manuf = (hashmanuf_t*)value;\r\nint eth_as_gint = *(int*)key;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "%.2X:%.2X:%.2X %s\n",eth_as_gint>>16, (eth_as_gint>>8)&0xff, eth_as_gint&0xff, get_hash_manuf_resolved_name(manuf));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nwka_hash_to_texbuff(gpointer key, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\ngchar *name = (gchar *)value;\r\nguint8 *eth_addr = (guint8*)key;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "%.2X:%.2X:%.2X:%.2X:%.2X:%.2X %s\n",\r\neth_addr[0], eth_addr[1], eth_addr[2],\r\neth_addr[3], eth_addr[4], eth_addr[5],\r\nname);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nserv_port_hash_to_texbuff(gpointer key, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nserv_port_t *serv_port_table = (serv_port_t *)value;\r\nint port = *(int*)key;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "Port %u \n"" TCP %s\n"" UDP %s\n"" SCTP %s\n"" DCCP %s\n",\r\nport,\r\nserv_port_table->tcp_name,\r\nserv_port_table->udp_name,\r\nserv_port_table->sctp_name,\r\nserv_port_table->dccp_name);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nipv4_hash_table_to_texbuff(gpointer key, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nhashipv4_t *ipv4_hash_table_entry = (hashipv4_t *)value;\r\nint addr = GPOINTER_TO_UINT(key);\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "Key:0x%x IP: %s, Name: %s\n",\r\naddr,\r\nipv4_hash_table_entry->ip,\r\nipv4_hash_table_entry->name);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nipv4_hash_table_resolved_to_texbuff(gpointer key _U_, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nhashipv4_t *ipv4_hash_table_entry = (hashipv4_t *)value;\r\nif((ipv4_hash_table_entry->flags & DUMMY_ADDRESS_ENTRY)== 0){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "%s\t%s\n",\r\nipv4_hash_table_entry->ip,\r\nipv4_hash_table_entry->name);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\n}\r\nstatic void\r\nipv6_hash_table_to_texbuff(gpointer key _U_, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nhashipv6_t *ipv6_hash_table_entry = (hashipv6_t *)value;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "IP: %s, Name: %s\n",\r\nipv6_hash_table_entry->ip6,\r\nipv6_hash_table_entry->name);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\nstatic void\r\nipv6_hash_table_resolved_to_texbuff(gpointer key _U_, gpointer value, gpointer user_data)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nGtkTextBuffer *buffer = (GtkTextBuffer*)user_data;\r\nhashipv6_t *ipv6_hash_table_entry = (hashipv6_t *)value;\r\nif((ipv6_hash_table_entry->flags & DUMMY_ADDRESS_ENTRY)== 0){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "%s\t%s\n",\r\nipv6_hash_table_entry->ip6,\r\nipv6_hash_table_entry->name);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n}\r\n}\r\nstatic void\r\naddres_resolution_to_texbuff(GtkTextBuffer *buffer)\r\n{\r\ngchar string_buff[ADDRESS_STR_MAX];\r\nwmem_map_t *manuf_hashtable;\r\nwmem_map_t *wka_hashtable;\r\nwmem_map_t *eth_hashtable;\r\nwmem_map_t *serv_port_hashtable;\r\nwmem_map_t *ipv4_hash_table;\r\nwmem_map_t *ipv6_hash_table;\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# Hosts information in Wireshark \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# Host data gathered from %s\n\n", cfile.filename);\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\n/* Dump the v4 addresses first, then v6 */\r\nipv4_hash_table = get_ipv4_hash_table();\r\nif(ipv4_hash_table){\r\nwmem_map_foreach( ipv4_hash_table, ipv4_hash_table_resolved_to_texbuff, buffer);\r\n}\r\nipv6_hash_table = get_ipv6_hash_table();\r\nif(ipv6_hash_table){\r\nwmem_map_foreach( ipv6_hash_table, ipv6_hash_table_resolved_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# Address resolution IPv4 Hash table \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nif(ipv4_hash_table){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(ipv4_hash_table));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( ipv4_hash_table, ipv4_hash_table_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# Address resolution IPv6 Hash table \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nif(ipv6_hash_table){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(ipv6_hash_table));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( ipv6_hash_table, ipv6_hash_table_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# Port names information in Wireshark \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nserv_port_hashtable = get_serv_port_hashtable();\r\nif(serv_port_hashtable){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(serv_port_hashtable));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( serv_port_hashtable, serv_port_hash_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# Eth names information in Wireshark \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\neth_hashtable = get_eth_hashtable();\r\nif(eth_hashtable){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(eth_hashtable));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( eth_hashtable, eth_hash_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# Manuf information in Wireshark \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nmanuf_hashtable = get_manuf_hashtable();\r\nif(manuf_hashtable){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(manuf_hashtable));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( manuf_hashtable, manuf_hash_to_texbuff, buffer);\r\n}\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "\n\n# wka information in Wireshark \n#\n");\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwka_hashtable = get_wka_hashtable();\r\nif(wka_hashtable){\r\ng_snprintf(string_buff, ADDRESS_STR_MAX, "# With %i entries\n#\n", wmem_map_size(wka_hashtable));\r\ngtk_text_buffer_insert_at_cursor (buffer, string_buff, -1);\r\nwmem_map_foreach( wka_hashtable, wka_hash_to_texbuff, buffer);\r\n}\r\n}\r\nvoid\r\naddr_resolution_dlg (GtkAction *action _U_, gpointer data _U_)\r\n{\r\nGtkWidget *vbox;\r\nGtkWidget *view;\r\nGtkWidget *scroll;\r\nGtkWidget *bbox;\r\nGtkWidget *ok_bt, *cancel_bt, *help_bt;\r\nGtkTextBuffer *buffer;\r\naddr_resolution_dlg_w = dlg_window_new ("Address Resolution");\r\ngtk_widget_set_size_request (addr_resolution_dlg_w, 750, 350);\r\ngtk_window_set_resizable (GTK_WINDOW (addr_resolution_dlg_w), TRUE);\r\ngtk_container_set_border_width (GTK_CONTAINER (addr_resolution_dlg_w), DLG_OUTER_MARGIN);\r\nvbox = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, DLG_UNRELATED_SPACING, FALSE);\r\ngtk_container_add (GTK_CONTAINER (addr_resolution_dlg_w), vbox);\r\ngtk_widget_show (vbox);\r\nview = gtk_text_view_new ();\r\ngtk_text_view_set_wrap_mode(GTK_TEXT_VIEW(view), GTK_WRAP_WORD);\r\nbuffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));\r\n#if GTK_CHECK_VERSION(3, 0, 0)\r\ngtk_widget_override_font(view, user_font_get_regular());\r\n#else\r\ngtk_widget_modify_font(view, user_font_get_regular());\r\n#endif\r\ngtk_widget_show (view);\r\nscroll = gtk_scrolled_window_new(NULL, NULL);\r\ngtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(scroll),\r\nGTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC);\r\ngtk_container_add(GTK_CONTAINER(scroll), view);\r\ngtk_widget_show(scroll);\r\ngtk_box_pack_start(GTK_BOX (vbox), scroll, TRUE, TRUE, 0);\r\n/* Get the address list */\r\naddres_resolution_to_texbuff(buffer);\r\n/* Button row. */\r\nbbox = dlg_button_row_new (GTK_STOCK_OK, GTK_STOCK_CANCEL, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_end (GTK_BOX(vbox), bbox, FALSE, FALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_OK);\r\ng_signal_connect(ok_bt, "clicked", G_CALLBACK(window_cancel_button_cb), addr_resolution_dlg_w); /* act as cxl */\r\ngtk_widget_set_sensitive (ok_bt, TRUE);\r\ncancel_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_CANCEL);\r\nwindow_set_cancel_button (addr_resolution_dlg_w, cancel_bt, window_cancel_button_cb);\r\nhelp_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_HELP);\r\n#if 0\r\ng_signal_connect (help_bt, "clicked",/* G_CALLBACK(topic_cb)*/NULL, /*(gpointer)HELP_MANUAL_ADDR_RESOLVE_DIALOG*/NULL);\r\n#endif\r\ngtk_widget_set_sensitive (help_bt, FALSE);\r\ngtk_widget_grab_default (ok_bt);\r\n/*g_signal_connect (addr_resolution_dlg_w, "delete_event"
