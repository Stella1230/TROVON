guint32\r\nip_get_subnet_mask(const guint32 mask_length)\r\n{\r\nstatic const guint32 masks[33] = {\r\n0x00000000,\r\n0x80000000, 0xc0000000, 0xe0000000, 0xf0000000,\r\n0xf8000000, 0xfc000000, 0xfe000000, 0xff000000,\r\n0xff800000, 0xffc00000, 0xffe00000, 0xfff00000,\r\n0xfff80000, 0xfffc0000, 0xfffe0000, 0xffff0000,\r\n0xffff8000, 0xffffc000, 0xffffe000, 0xfffff000,\r\n0xfffff800, 0xfffffc00, 0xfffffe00, 0xffffff00,\r\n0xffffff80, 0xffffffc0, 0xffffffe0, 0xfffffff0,\r\n0xfffffff8, 0xfffffffc, 0xfffffffe, 0xffffffff,\r\n};\r\ng_assert(mask_length <= 32);\r\nreturn masks[mask_length];\r\n}\r\nint\r\ntvb_get_ipv4_addr_with_prefix_len(tvbuff_t *tvb, int offset, guint8 *addr,\r\nguint32 prefix_len)\r\n{\r\nguint32 addr_len;\r\nif (prefix_len > 32)\r\nreturn -1;\r\naddr_len = (prefix_len + 7) / 8;\r\nmemset(addr, 0, 4);\r\ntvb_memcpy(tvb, addr, offset, addr_len);\r\nif (prefix_len % 8)\r\naddr[addr_len - 1] &= ((0xff00 >> (prefix_len % 8)) & 0xff);\r\nreturn addr_len;\r\n}\r\nint\r\ntvb_get_ipv6_addr_with_prefix_len(tvbuff_t *tvb, int offset, struct e_in6_addr *addr,\r\nguint32 prefix_len)\r\n{\r\nguint32 addr_len;\r\nif (prefix_len > 128)\r\nreturn -1;\r\naddr_len = (prefix_len + 7) / 8;\r\nmemset(addr->bytes, 0, 16);\r\ntvb_memcpy(tvb, addr->bytes, offset, addr_len);\r\nif (prefix_len % 8) {\r\naddr->bytes[addr_len - 1] &=\r\n((0xff00 >> (prefix_len % 8)) & 0xff);\r\n}\r\nreturn addr_len;\r\n}
