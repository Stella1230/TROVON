static int\r\ndissect_aprs_compression_type( tvbuff_t *tvb,\r\nint offset,\r\nproto_tree *parent_tree\r\n)\r\n{\r\nproto_tree *tc;\r\nproto_tree *compression_tree;\r\nint new_offset;\r\nint data_len;\r\nguint8 compression_type;\r\ndata_len = 1;\r\nnew_offset = offset + data_len;\r\nif ( parent_tree )\r\n{\r\ncompression_type = tvb_get_guint8( tvb, offset ) - 33;\r\ntc = proto_tree_add_uint( parent_tree, hf_aprs_compression_type, tvb, offset, data_len,\r\ncompression_type );\r\ncompression_tree = proto_item_add_subtree( tc, ett_aprs_ct );\r\nproto_tree_add_item( compression_tree, hf_aprs_ct_gps_fix, tvb, offset, data_len, ENC_BIG_ENDIAN );\r\nproto_tree_add_item( compression_tree, hf_aprs_ct_nmea_src, tvb, offset, data_len, ENC_BIG_ENDIAN );\r\nproto_tree_add_item( compression_tree, hf_aprs_ct_origin, tvb, offset, data_len, ENC_BIG_ENDIAN );\r\n}\r\nreturn new_offset;\r\n}\r\nstatic int\r\ndissect_aprs_msg( tvbuff_t *tvb,\r\nint offset,\r\nproto_tree *parent_tree,\r\nint wind,\r\nint brg_nrq\r\n)\r\n{\r\nproto_tree *msg_tree = NULL;\r\nguint8 ch;\r\nif ( parent_tree )\r\n{\r\nproto_tree *tc;\r\ntc = proto_tree_add_item( parent_tree, hf_aprs_msg, tvb, offset, 7, ENC_ASCII|ENC_NA );\r\nmsg_tree = proto_item_add_subtree( tc, ett_aprs_msg );\r\n}\r\nch = tvb_get_guint8( tvb, offset );\r\nif ( g_ascii_isdigit( ch ) )\r\n{\r\nif ( wind )\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_dir, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\nelse\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_cse, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_spd, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\n}\r\nelse\r\n{\r\nswitch ( ch )\r\n{\r\ncase 'D' :\r\noffset += 3;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_dfs_s, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_dfs_h, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_dfs_g, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_dfs_d, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\nbreak;\r\ncase 'P' :\r\noffset += 3;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_phg_p, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_phg_h, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_phg_g, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_phg_d, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\nbreak;\r\ncase 'R' :\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_rng, tvb, offset, 7, ENC_ASCII|ENC_NA );\r\nbreak;\r\ncase 'T' :\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_aod_t, tvb, offset, 2, ENC_ASCII|ENC_NA );\r\noffset += 2;\r\noffset += 2;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_aod_c, tvb, offset, 2, ENC_ASCII|ENC_NA );\r\nbreak;\r\ndefault :\r\nbreak;\r\n}\r\n}\r\nif ( brg_nrq )\r\n{\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_brg, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\noffset += 1;\r\nproto_tree_add_item( msg_tree, hf_aprs_msg_nrq, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_aprs_compressed_msg( tvbuff_t *tvb,\r\nint offset,\r\nproto_tree *parent_tree\r\n)\r\n{\r\nproto_tree *tc;\r\nproto_tree *msg_tree;\r\nint new_offset;\r\nint data_len;\r\nguint8 ch;\r\nguint8 course;\r\ndouble speed;\r\ndouble range;\r\ngchar *info_buffer;\r\ndata_len = 2;\r\nnew_offset = offset + data_len;\r\nif ( parent_tree )\r\n{\r\ntc = proto_tree_add_item( parent_tree, hf_aprs_msg, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nmsg_tree = proto_item_add_subtree( tc, ett_aprs_msg );\r\nch = tvb_get_guint8( tvb, offset );\r\nif ( ch != ' ' )\r\n{\r\nif ( ch == '{' )\r\n{\r\noffset += 1;\r\nch = tvb_get_guint8( tvb, offset );\r\nrange = exp( log( 1.08 ) * (ch - 33) );\r\ninfo_buffer = wmem_strdup_printf( wmem_packet_scope(), "%7.2f", range );\r\nproto_tree_add_string( msg_tree, hf_aprs_msg_rng, tvb, offset, 1, info_buffer );\r\n}\r\nelse\r\nif ( ch >= '!' && ch <= 'z' )\r\n{\r\ncourse = (ch - 33) * 4;\r\ninfo_buffer = wmem_strdup_printf( wmem_packet_scope(), "%d", course );\r\nproto_tree_add_string( msg_tree, hf_aprs_msg_cse,\r\ntvb, offset, 1, info_buffer );\r\noffset += 1;\r\nch = tvb_get_guint8( tvb, offset );\r\nspeed = exp( log( 1.08 ) * (ch - 33) );\r\ninfo_buffer = wmem_strdup_printf( wmem_packet_scope(), "%7.2f", speed );\r\nproto_tree_add_string( msg_tree, hf_aprs_msg_spd,\r\ntvb, offset, 1, info_buffer );\r\n}\r\n}\r\n}\r\nreturn new_offset;\r\n}\r\nstatic const mic_e_dst_code_table_s *\r\ndst_code_lookup( guint8 ch )\r\n{\r\nguint indx;\r\nindx = 0;\r\nwhile ( indx < ( sizeof( dst_code ) / sizeof( mic_e_dst_code_table_s ) )\r\n&& dst_code[ indx ].key != ch\r\n&& dst_code[ indx ].key > 0 )\r\nindx++;\r\nreturn &( dst_code[ indx ] );\r\n}\r\nstatic int\r\nd28_to_deg( guint8 code, int long_offset )\r\n{\r\nint value;\r\nvalue = code - 28 + long_offset;\r\nif ( value >= 180 && value <= 189 )\r\nvalue -= 80;\r\nelse\r\nif ( value >= 190 && value <= 199 )\r\nvalue -= 190;\r\nreturn value;\r\n}\r\nstatic int\r\nd28_to_min( guint8 code )\r\n{\r\nint value;\r\nvalue = code - 28;\r\nif ( value >= 60 )\r\nvalue -= 60;\r\nreturn value;\r\n}\r\nstatic int\r\ndissect_mic_e( tvbuff_t *tvb,\r\nint offset,\r\npacket_info *pinfo,\r\nproto_tree *parent_tree,\r\nint hf_mic_e_idx\r\n)\r\n{\r\nproto_tree *tc;\r\nproto_tree *mic_e_tree;\r\nint new_offset;\r\nint data_len;\r\nchar *info_buffer;\r\nchar latitude[7] = { '?', '?', '?', '?', '.', '?', '?' };\r\nint msg_a;\r\nint msg_b;\r\nint msg_c;\r\nchar n_s;\r\nint long_offset;\r\nchar w_e;\r\nint cse;\r\nint spd;\r\nguint8 ssid;\r\nconst guint8 *addr;\r\nconst mic_e_dst_code_table_s *dst_code_entry;\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\nnew_offset = offset + data_len;\r\ninfo_buffer = (char *)wmem_alloc( wmem_packet_scope(), STRLEN );\r\nmsg_a = 0;\r\nmsg_b = 0;\r\nmsg_c = 0;\r\nn_s = '?';\r\nlong_offset = 0;\r\nw_e = '?';\r\nssid = 0;\r\nif ( pinfo->dst.type == AT_AX25 && pinfo->dst.len == AX25_ADDR_LEN )\r\n{\r\naddr = (const guint8 *)pinfo->dst.data;\r\ndst_code_entry = dst_code_lookup( addr[ 0 ] );\r\nlatitude[ 0 ] = dst_code_entry->digit;\r\nmsg_a = dst_code_entry->msg & 0x1;\r\ndst_code_entry = dst_code_lookup( addr[ 1 ] );\r\nlatitude[ 1 ] = dst_code_entry->digit;\r\nmsg_b = dst_code_entry->msg & 0x1;\r\ndst_code_entry = dst_code_lookup( addr[ 2 ] );\r\nlatitude[ 2 ] = dst_code_entry->digit;\r\nmsg_c = dst_code_entry->msg & 0x1;\r\ndst_code_entry = dst_code_lookup( addr[ 3 ] );\r\nlatitude[ 3 ] = dst_code_entry->digit;\r\nn_s = dst_code_entry->n_s;\r\nlatitude[ 4 ] = '.';\r\ndst_code_entry = dst_code_lookup( addr[ 4 ] );\r\nlatitude[ 5 ] = dst_code_entry->digit;\r\nlong_offset = dst_code_entry->long_offset;\r\ndst_code_entry = dst_code_lookup( addr[ 5 ] );\r\nlatitude[ 6 ] = dst_code_entry->digit;\r\nw_e = dst_code_entry->w_e;\r\nssid = (addr[ 6 ] >> 1) & 0x0f;\r\n}\r\nspd = ((tvb_get_guint8( tvb, offset + 3 ) - 28) * 10) + ((tvb_get_guint8( tvb, offset + 4 ) - 28) / 10);\r\nif ( spd >= 800 )\r\nspd -= 800;\r\ncse = (((tvb_get_guint8( tvb, offset + 4 ) - 28) % 10) * 100) + ((tvb_get_guint8( tvb, offset + 5 ) - 28) * 10);\r\nif ( cse >= 400 )\r\ncse -= 400;\r\ng_snprintf( info_buffer, STRLEN,\r\n"Lat: %7.7s%c Long: %03d%02d.%02d%c, Cse: %d, Spd: %d, SSID: %d, Msg %s",\r\nlatitude,\r\nn_s,\r\nd28_to_deg( tvb_get_guint8( tvb, offset ), long_offset ),\r\nd28_to_min( tvb_get_guint8( tvb, offset + 1 ) ),\r\ntvb_get_guint8( tvb, offset + 2 ) - 28,\r\nw_e,\r\ncse,\r\nspd,\r\nssid,\r\nmic_e_msg_table[ (msg_a << 2) + (msg_b << 1) + msg_c ].std\r\n);\r\ncol_set_str( pinfo->cinfo, COL_INFO, "MIC-E " );\r\ncol_append_str( pinfo->cinfo, COL_INFO, info_buffer );\r\nif ( parent_tree )\r\n{\r\ntc = proto_tree_add_string( parent_tree, hf_mic_e_idx, tvb, offset, data_len, info_buffer );\r\nmic_e_tree = proto_item_add_subtree( tc, ett_aprs_mic_e );\r\ng_snprintf( info_buffer, STRLEN,\r\n"Lat %7.7s, Msg A %d, Msg B %d, Msg C %d, N/S %c, Long off %3d, W/E %c, SSID %d",\r\nlatitude,\r\nmsg_a,\r\nmsg_b,\r\nmsg_c,\r\nn_s,\r\nlong_offset,\r\nw_e,\r\nssid\r\n);\r\nproto_tree_add_string( mic_e_tree, hf_aprs_mic_e_dst, tvb, 0, 0, info_buffer );\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_long_d, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_long_m, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_long_h, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_spd_sp, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_spd_dc, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_spd_se, tvb, offset, 1, ENC_BIG_ENDIAN );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_sym_code, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( mic_e_tree, hf_aprs_sym_id, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nif ( offset < new_offset )\r\n{\r\nguint8 c = tvb_get_guint8(tvb, offset);\r\nif ( (c == ',') || (c == 0x1d) )\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_telemetry,\r\ntvb, offset, -1, ENC_NA );\r\nelse\r\nproto_tree_add_item( mic_e_tree, hf_aprs_mic_e_status,\r\ntvb, offset, -1, ENC_ASCII|ENC_NA );\r\n}\r\n}\r\nreturn new_offset;\r\n}\r\nstatic int\r\ndissect_aprs_storm( tvbuff_t *tvb,\r\nint offset,\r\nproto_tree *parent_tree\r\n)\r\n{\r\nproto_tree *storm_tree;\r\nproto_tree *tc;\r\ntc = proto_tree_add_item( parent_tree, hf_aprs_storm, tvb, offset, -1, ENC_ASCII|ENC_NA );\r\nstorm_tree = proto_item_add_subtree( tc, ett_aprs_storm );\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_dir, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\noffset += 1;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_spd, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_type, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_sws, tvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_pwg, tvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_cp, tvb, offset, 5, ENC_ASCII|ENC_NA );\r\noffset += 5;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_rhw, tvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_rtsw, tvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nproto_tree_add_item( storm_tree, hf_aprs_storm_rwg, tvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_aprs_weather( tvbuff_t *tvb,\r\nint offset,\r\nproto_tree *parent_tree\r\n)\r\n{\r\nproto_tree *tc;\r\nproto_tree *weather_tree;\r\nint new_offset;\r\nint data_len;\r\nguint8 ch;\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\nnew_offset = offset + data_len;\r\ntc = proto_tree_add_item( parent_tree, hf_aprs_weather, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nweather_tree = proto_item_add_subtree( tc, ett_aprs_weather );\r\nch = tvb_get_guint8( tvb, offset );\r\nif ( g_ascii_isdigit( ch ) )\r\n{\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_dir, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\noffset += 1;\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_spd, tvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\n}\r\nif ( parent_tree )\r\n{\r\nwhile ( offset < new_offset )\r\n{\r\nch = tvb_get_guint8( tvb, offset );\r\nswitch ( ch )\r\n{\r\ncase 'c' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_dir,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 's' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_spd,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'g' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_peak,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 't' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_temp,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'r' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_rain_1,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'P' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_rain_24,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'p' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_rain,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'h' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_humidty,\r\ntvb, offset, 3, ENC_ASCII|ENC_NA );\r\noffset += 3;\r\nbreak;\r\ncase 'b' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_press,\r\ntvb, offset, 6, ENC_ASCII|ENC_NA );\r\noffset += 6;\r\nbreak;\r\ncase 'l' :\r\ncase 'L' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_luminosity,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase 'S' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_snow,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ncase '#' :\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_raw_rain,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA );\r\noffset += 4;\r\nbreak;\r\ndefault : {\r\ngint lr;\r\nlr = new_offset - offset;\r\n#if 0\r\nif ( ((lr < 3) || (lr > 5)) ||\r\n( lr != strspn( tvb_get_string_enc( wmem_packet_scope(), tvb, offset, lr, ENC_ASCII|ENC_NA ), "a-zA-Z0-9-_" ) ) )\r\n{\r\nnew_offset = offset;\r\nbreak;\r\n}\r\n#endif\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_software,\r\ntvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nproto_tree_add_item( weather_tree, hf_aprs_weather_unit,\r\ntvb, offset, lr-1, ENC_ASCII|ENC_NA );\r\noffset = new_offset;\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\nreturn new_offset;\r\n}\r\nstatic int\r\naprs_timestamp( proto_tree *aprs_tree, tvbuff_t *tvb, int offset )\r\n{\r\nint data_len;\r\nconst char *tzone;\r\nguint8 ch;\r\ndata_len = 8;\r\ntzone = "zulu";\r\nch= tvb_get_guint8( tvb, offset + 6 );\r\nif ( g_ascii_isdigit( ch ) )\r\n{\r\nproto_tree_add_item( aprs_tree, hf_aprs_mdhm, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nproto_tree_add_string( aprs_tree, hf_aprs_tz, tvb, offset, data_len, tzone );\r\n}\r\nelse\r\n{\r\ndata_len -= 1;\r\nif ( ch == 'h' )\r\n{\r\nproto_tree_add_item( aprs_tree, hf_aprs_hms, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nproto_tree_add_string( aprs_tree, hf_aprs_tz, tvb, offset, data_len, tzone );\r\n}\r\nelse\r\n{\r\nswitch ( ch )\r\n{\r\ncase 'z' : tzone = "zulu"; break;\r\ncase '/' : tzone = "local"; break;\r\ndefault : tzone = "unknown"; break;\r\n}\r\nproto_tree_add_item( aprs_tree, hf_aprs_dhm, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nproto_tree_add_string( aprs_tree, hf_aprs_tz, tvb, offset + 6, 1, tzone );\r\n}\r\n}\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_latitude_compressed( proto_tree *aprs_tree, tvbuff_t *tvb, int offset )\r\n{\r\nif ( aprs_tree )\r\n{\r\nchar *info_buffer;\r\nint temp;\r\ninfo_buffer = (char *)wmem_alloc( wmem_packet_scope(), STRLEN );\r\ntemp = ( tvb_get_guint8( tvb, offset + 0 ) - 33 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 1 ) - 33 ) + ( temp * 91 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 2 ) - 33 ) + ( temp * 91 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 3 ) - 33 ) + ( temp * 91 );\r\ng_snprintf( info_buffer, STRLEN, "%6.2f", 90.0 - (temp / 380926.0) );\r\nproto_tree_add_string( aprs_tree, hf_aprs_lat, tvb, offset, 4, info_buffer );\r\n}\r\nreturn offset + 4;\r\n}\r\nstatic int\r\naprs_longitude_compressed( proto_tree *aprs_tree, tvbuff_t *tvb, int offset )\r\n{\r\nif ( aprs_tree )\r\n{\r\nchar *info_buffer;\r\nint temp;\r\ninfo_buffer = (char *)wmem_alloc( wmem_packet_scope(), STRLEN );\r\ntemp = ( tvb_get_guint8( tvb, offset + 0 ) - 33 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 1 ) - 33 ) + ( temp * 91 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 2 ) - 33 ) + ( temp * 91 );\r\ntemp = ( tvb_get_guint8( tvb, offset + 3 ) - 33 ) + ( temp * 91 );\r\ng_snprintf( info_buffer, STRLEN, "%7.2f", (temp / 190463.0) - 180.0 );\r\nproto_tree_add_string( aprs_tree, hf_aprs_long, tvb, offset, 4, info_buffer );\r\n}\r\nreturn offset + 4;\r\n}\r\nstatic int\r\naprs_status( proto_tree *aprs_tree, tvbuff_t *tvb, int offset )\r\n{\r\nint data_len;\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\nif ( ( data_len > 7 ) && ( tvb_get_guint8( tvb, offset+6 ) == 'z' ) )\r\n{\r\nproto_tree_add_item( aprs_tree, hf_aprs_dhm, tvb, offset, 6, ENC_ASCII|ENC_NA );\r\noffset += 6;\r\ndata_len -= 6;\r\nproto_tree_add_string( aprs_tree, hf_aprs_tz, tvb, offset, 1, "zulu" );\r\noffset += 1;\r\ndata_len -= 1;\r\n}\r\nproto_tree_add_item( aprs_tree, hf_aprs_status, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_item( proto_tree *aprs_tree, tvbuff_t *tvb, int offset )\r\n{\r\nchar *info_buffer;\r\nint data_len;\r\nchar *ch_ptr;\r\ndata_len = 10;\r\ninfo_buffer = tvb_get_string_enc( wmem_packet_scope(), tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nch_ptr = strchr( info_buffer, '!' );\r\nif ( ch_ptr != NULL )\r\n{\r\ndata_len = (int)(ch_ptr - info_buffer + 1);\r\n*ch_ptr = '\0';\r\n}\r\nelse\r\n{\r\nch_ptr = strchr( info_buffer, '!' );\r\nif ( ch_ptr != NULL )\r\n{\r\ndata_len = (int)(ch_ptr - info_buffer + 1);\r\n*ch_ptr = '\0';\r\n}\r\n}\r\nproto_tree_add_string( aprs_tree, hf_aprs_item, tvb, offset, data_len, info_buffer );\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_3rd_party( proto_tree *aprs_tree, tvbuff_t *tvb, int offset, int data_len )\r\n{\r\nif ( data_len == -1 )\r\n{\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\n#if 0\r\nif ( data_len <= 0 )\r\nreturn offset;\r\n#endif\r\n}\r\nproto_tree_add_item( aprs_tree, hf_aprs_third_party, tvb, offset, data_len, ENC_NA );\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_default_string( proto_tree *aprs_tree, tvbuff_t *tvb, int offset, int data_len, int hfindex )\r\n{\r\nif ( data_len == -1 )\r\n{\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\n#if 0\r\nif ( data_len <= 0 )\r\nreturn offset;\r\n#endif\r\n}\r\nproto_tree_add_item( aprs_tree, hfindex, tvb, offset, data_len, ENC_ASCII|ENC_NA );\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_default_bytes( proto_tree *aprs_tree, tvbuff_t *tvb, int offset, int data_len, int hfindex )\r\n{\r\nif ( data_len == -1 )\r\n{\r\ndata_len = tvb_reported_length_remaining( tvb, offset );\r\n#if 0\r\nif ( data_len <= 0 )\r\nreturn offset;\r\n#endif\r\n}\r\nproto_tree_add_item( aprs_tree, hfindex, tvb, offset, data_len, ENC_NA );\r\nreturn offset + data_len;\r\n}\r\nstatic int\r\naprs_position( proto_tree *aprs_tree, tvbuff_t *tvb, int offset, gboolean with_msg )\r\n{\r\nguint8 symbol_table_id = 0;\r\nguint8 symbol_code = 0;\r\ngboolean probably_a_msg = FALSE;\r\ngboolean probably_not_a_msg = FALSE;\r\nif ( g_ascii_isdigit( tvb_get_guint8( tvb, offset ) ) )\r\n{\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 8, hf_aprs_lat );\r\nsymbol_table_id = tvb_get_guint8( tvb, offset );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 1, hf_aprs_sym_id );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 9, hf_aprs_long );\r\nsymbol_code = tvb_get_guint8( tvb, offset );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 1, hf_aprs_sym_code );\r\nif ( gPREF_APRS_LAX )\r\n{\r\nswitch ( tvb_get_guint8( tvb, offset ) )\r\n{\r\ncase 'D' : probably_a_msg = TRUE; break;\r\ncase 'P' : probably_a_msg = TRUE; break;\r\ncase 'R' : probably_a_msg = TRUE; break;\r\ncase 'T' : probably_a_msg = TRUE; break;\r\ndefault : probably_not_a_msg = TRUE; break;\r\n}\r\n}\r\nif ( with_msg || probably_a_msg || ! probably_not_a_msg )\r\noffset = dissect_aprs_msg( tvb,\r\noffset,\r\naprs_tree,\r\n( symbol_code == '_' ),\r\n( symbol_table_id == '/' && symbol_code == '\\' )\r\n);\r\n}\r\nelse\r\n{\r\nsymbol_table_id = tvb_get_guint8( tvb, offset );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 1, hf_aprs_sym_id );\r\noffset = aprs_latitude_compressed( aprs_tree, tvb, offset );\r\noffset = aprs_longitude_compressed( aprs_tree, tvb, offset );\r\nsymbol_code = tvb_get_guint8( tvb, offset );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 1, hf_aprs_sym_code );\r\noffset = dissect_aprs_compressed_msg( tvb,\r\noffset,\r\naprs_tree\r\n);\r\noffset = dissect_aprs_compression_type( tvb,\r\noffset,\r\naprs_tree\r\n);\r\nif ( symbol_table_id == '/' && symbol_code == '\\' )\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 8, hf_aprs_msg_brg );\r\n}\r\nif ( symbol_code == '_' )\r\noffset = dissect_aprs_weather( tvb,\r\noffset,\r\naprs_tree\r\n);\r\nif ( ( symbol_table_id == '/' && symbol_code == '@' ) || ( symbol_table_id == '\\' && symbol_code == '@' ) )\r\noffset = dissect_aprs_storm( tvb,\r\noffset,\r\naprs_tree\r\n);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_aprs( tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_ )\r\n{\r\nproto_item *ti;\r\nproto_tree *aprs_tree;\r\nint offset;\r\nguint8 dti;\r\nwmem_strbuf_t *sb;\r\ncol_set_str( pinfo->cinfo, COL_PROTOCOL, "APRS" );\r\ncol_clear( pinfo->cinfo, COL_INFO );\r\noffset = 0;\r\ndti = tvb_get_guint8( tvb, offset );\r\nsb = wmem_strbuf_new_label(wmem_packet_scope());\r\nif (dti != '!')\r\nwmem_strbuf_append(sb, val_to_str_ext_const(dti, &aprs_description_ext, ""));\r\nswitch ( dti )\r\n{\r\ncase '!':\r\nif ( tvb_get_guint8( tvb, offset + 1 ) == '!' )\r\n{\r\nwmem_strbuf_append(sb, "Ultimeter 2000 WX Station");\r\n}\r\nelse\r\n{\r\nwmem_strbuf_append(sb, "Position (");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1, 8));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8 + 1, 9));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8, 1));\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8 + 1 + 9, 1));\r\n}\r\nbreak;\r\ncase '=':\r\nwmem_strbuf_append(sb, " (");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1, 8));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8 + 1, 9));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8, 1));\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 8 + 1 + 9, 1));\r\nbreak;\r\ncase '/':\r\nwmem_strbuf_append(sb, " (");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1, 7));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 1, 8));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 8 + 1, 9));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7, 1));\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 1 + 9, 1));\r\nbreak;\r\ncase '@':\r\nwmem_strbuf_append(sb, " (");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1, 7));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 1, 8));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 8 + 1, 9));\r\nwmem_strbuf_append(sb, " ");\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7, 1));\r\nwmem_strbuf_append(sb, tvb_format_text(tvb, offset + 1 + 7 + 1 + 9, 1));\r\nbreak;\r\n}\r\ncol_add_str( pinfo->cinfo, COL_INFO, wmem_strbuf_get_str(sb) );\r\nti = proto_tree_add_protocol_format( parent_tree , proto_aprs, tvb, 0, -1, "%s", wmem_strbuf_get_str(sb) );\r\naprs_tree = proto_item_add_subtree( ti, ett_aprs );\r\nproto_tree_add_item( aprs_tree, hf_aprs_dti, tvb, offset, 1, ENC_ASCII|ENC_NA );\r\noffset += 1;\r\nswitch ( dti )\r\n{\r\ncase '<' :\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_station );\r\nbreak;\r\ncase '>' :\r\noffset = aprs_status( aprs_tree, tvb, offset );\r\nbreak;\r\ncase '?' :\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_query );\r\nbreak;\r\ncase '$' :\r\nif ( tvb_get_guint8( tvb, offset ) == 'U' )\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_ultimeter_2000 );\r\nelse\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_raw );\r\nbreak;\r\ncase '%' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_agrelo );\r\nbreak;\r\ncase 'T' :\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_telemetry );\r\nbreak;\r\ncase '[' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_maidenhead );\r\nbreak;\r\ncase '_' :\r\noffset = aprs_timestamp( aprs_tree, tvb, offset );\r\noffset = dissect_aprs_weather( tvb,\r\noffset,\r\naprs_tree\r\n);\r\nbreak;\r\ncase ',' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_invalid_test );\r\nbreak;\r\ncase '{' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_user_defined );\r\nbreak;\r\ncase '}' :\r\noffset = aprs_3rd_party( aprs_tree, tvb, offset, -1 );\r\nbreak;\r\ncase ':' :\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_message );\r\nbreak;\r\ncase 0x1c :\r\noffset = dissect_mic_e( tvb,\r\noffset,\r\npinfo,\r\naprs_tree,\r\nhf_aprs_mic_e_0_current\r\n);\r\nbreak;\r\ncase 0x1d :\r\noffset = dissect_mic_e( tvb,\r\noffset,\r\npinfo,\r\naprs_tree,\r\nhf_aprs_mic_e_0_old\r\n);\r\nbreak;\r\ncase '\'' :\r\noffset = dissect_mic_e( tvb,\r\noffset,\r\npinfo,\r\naprs_tree,\r\nhf_aprs_mic_e_old\r\n);\r\nbreak;\r\ncase '`' :\r\noffset = dissect_mic_e( tvb,\r\noffset,\r\npinfo,\r\naprs_tree,\r\nhf_aprs_mic_e_current\r\n);\r\nbreak;\r\ncase '#' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_peet_1 );\r\nbreak;\r\ncase '*' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_peet_2 );\r\nbreak;\r\ncase '&' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_map_feature );\r\nbreak;\r\ncase '+' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_shelter_data );\r\nbreak;\r\ncase '.' :\r\noffset = aprs_default_bytes( aprs_tree, tvb, offset, -1, hf_aprs_space_weather );\r\nbreak;\r\ncase ')' :\r\noffset = aprs_item( aprs_tree, tvb, offset );\r\noffset = aprs_position( aprs_tree, tvb, offset, TRUE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\nbreak;\r\ncase ';' :\r\noffset = aprs_default_string( aprs_tree, tvb, offset, 10, hf_aprs_object );\r\noffset = aprs_timestamp( aprs_tree, tvb, offset );\r\noffset = aprs_position( aprs_tree, tvb, offset, TRUE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\nbreak;\r\ncase '!' :\r\nif ( tvb_get_guint8( tvb, offset ) == '!' )\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_ultimeter_2000 );\r\nelse\r\n{\r\noffset = aprs_position( aprs_tree, tvb, offset, FALSE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\n}\r\nbreak;\r\ncase '=' :\r\noffset = aprs_position( aprs_tree, tvb, offset, TRUE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\nbreak;\r\ncase '/' :\r\noffset = aprs_timestamp( aprs_tree, tvb, offset );\r\noffset = aprs_position( aprs_tree, tvb, offset, FALSE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\nbreak;\r\ncase '@' :\r\noffset = aprs_timestamp( aprs_tree, tvb, offset );\r\noffset = aprs_position( aprs_tree, tvb, offset, TRUE );\r\noffset = aprs_default_string( aprs_tree, tvb, offset, -1, hf_aprs_comment );\r\nbreak;\r\ndefault : break;\r\n}\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_aprs( void )\r\n{\r\nmodule_t *aprs_module;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_aprs_dti,\r\n{ "Data Type Indicator", "aprs.dti",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_sym_code,\r\n{ "Symbol code", "aprs.sym_code",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_sym_id,\r\n{ "Symbol table ID", "aprs.sym_id",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_aprs_position,\r\n{ "Position", "aprs.position",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_aprs_lat,\r\n{ "Latitude", "aprs.position.lat",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_long,\r\n{ "Longitude", "aprs.position.long",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_comment,\r\n{ "Comment", "aprs.comment",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ultimeter_2000,\r\n{ "Ultimeter 2000", "aprs.ultimeter_2000",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_status,\r\n{ "Status", "aprs.status",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_object,\r\n{ "Object", "aprs.object",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_item,\r\n{ "Item", "aprs.item",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_query,\r\n{ "Query", "aprs.query",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_telemetry,\r\n{ "Telemetry", "aprs.telemetry",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_raw,\r\n{ "Raw", "aprs.raw",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Raw NMEA position report format", HFILL }\r\n},\r\n{ &hf_aprs_station,\r\n{ "Station", "aprs.station",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Station capabilities", HFILL }\r\n},\r\n{ &hf_aprs_message,\r\n{ "Message", "aprs.message",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_agrelo,\r\n{ "Agrelo", "aprs.agrelo",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Agrelo DFJr / MicroFinder", HFILL }\r\n},\r\n{ &hf_aprs_maidenhead,\r\n{ "Maidenhead", "aprs.maidenhead",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Maidenhead grid locator beacon (obsolete)", HFILL }\r\n},\r\n{ &hf_aprs_invalid_test,\r\n{ "Invalid or test", "aprs.invalid_test",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Invalid data or test data", HFILL }\r\n},\r\n{ &hf_aprs_user_defined,\r\n{ "User-Defined", "aprs.user_defined",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"User-Defined APRS packet format", HFILL }\r\n},\r\n{ &hf_aprs_third_party,\r\n{ "Third-party", "aprs.third_party",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Third-party traffic", HFILL }\r\n},\r\n{ &hf_aprs_peet_1,\r\n{ "Peet U-II (1)", "aprs.peet_1",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Peet Bros U-II Weather Station", HFILL }\r\n},\r\n{ &hf_aprs_peet_2,\r\n{ "Peet U-II (2)", "aprs.peet_2",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Peet Bros U-II Weather Station", HFILL }\r\n},\r\n{ &hf_aprs_map_feature,\r\n{ "Map Feature", "aprs.map_feature",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"[Reserved - Map Feature", HFILL }\r\n},\r\n{ &hf_aprs_shelter_data,\r\n{ "Shelter data", "aprs.shelter_data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"[Reserved - Shelter data with time]", HFILL }\r\n},\r\n{ &hf_aprs_space_weather,\r\n{ "Space weather", "aprs.space_weather",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"[Reserved - Space weather]", HFILL }\r\n},\r\n{ &hf_aprs_storm,\r\n{ "Storm", "aprs.storm",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_dhm,\r\n{ "Day/Hour/Minute", "aprs.dhm",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_hms,\r\n{ "Hour/Minute/Second", "aprs.hms",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mdhm,\r\n{ "Month/Day/Hour/Minute", "aprs.mdhm",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_tz,\r\n{ "Time Zone", "aprs.tz",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_compression_type,\r\n{ "Compression type", "aprs.ct",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_ct_gps_fix,\r\n{ "GPS fix type", "aprs.ct.gps_fix",\r\nFT_UINT8, BASE_HEX, VALS(gps_vals), 0x20,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_ct_nmea_src,\r\n{ "NMEA source", "aprs.ct.nmea_src",\r\nFT_UINT8, BASE_HEX, VALS(nmea_vals), 0x18,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_ct_origin,\r\n{ "Compression origin", "aprs.ct.origin",\r\nFT_UINT8, BASE_HEX, VALS(ctype_vals), 0x07,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg,\r\n{ "Extended message", "aprs.msg",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_rng,\r\n{ "Range", "aprs.msg.rng",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Pre-calculated radio range", HFILL }\r\n},\r\n{ &hf_aprs_msg_cse,\r\n{ "Course", "aprs.msg.cse",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_spd,\r\n{ "Speed", "aprs.msg.spd",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_dir,\r\n{ "Wind direction", "aprs.msg.dir",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_brg,\r\n{ "Bearing", "aprs.msg.brg",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_nrq,\r\n{ "Number/Range/Quality", "aprs.msg.nrq",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_phg_p,\r\n{ "Power", "aprs.msg.phg.p",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_phg_h,\r\n{ "Height", "aprs.msg.phg.h",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_phg_g,\r\n{ "Gain", "aprs.msg.phg.g",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_phg_d,\r\n{ "Directivity", "aprs.msg.phg.d",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_dfs_s,\r\n{ "Strength", "aprs.msg.dfs.s",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_dfs_h,\r\n{ "Height", "aprs.msg.dfs.h",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_dfs_g,\r\n{ "Gain", "aprs.msg.dfs.g",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_dfs_d,\r\n{ "Directivity", "aprs.msg.dfs.d",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_aod_t,\r\n{ "Type", "aprs.msg.aod.t",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_msg_aod_c,\r\n{ "Colour", "aprs.msg.aod.c",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather,\r\n{ "Weather report", "aprs.weather",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_dir,\r\n{ "Wind direction", "aprs.weather.dir",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_spd,\r\n{ "Wind speed", "aprs.weather.speed",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Wind speed (1 minute)", HFILL }\r\n},\r\n{ &hf_aprs_weather_peak,\r\n{ "Peak wind speed", "aprs.weather.peak",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_temp,\r\n{ "Temperature (F)", "aprs.weather.temp",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_rain_1,\r\n{ "Rain (last 1 hour)", "aprs.weather.1_hour",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_rain_24,\r\n{ "Rain (last 24 hours)", "aprs.weather.24_hour",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_rain,\r\n{ "Rain", "aprs.weather.rain",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_humidty,\r\n{ "Humidity", "aprs.weather.humidity",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_press,\r\n{ "Pressure", "aprs.weather.pressure",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_luminosity,\r\n{ "Luminosity", "aprs.weather.luminosity",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_snow,\r\n{ "Snow", "aprs.weather.snow",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_raw_rain,\r\n{ "Raw rain", "aprs.weather.raw_rain",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_software,\r\n{ "Software", "aprs.weather.software",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_weather_unit,\r\n{ "Unit", "aprs.weather.unit",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_0_current,\r\n{ "Current Mic-E (Rev 0)", "aprs.mic_e_0_current",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_0_old,\r\n{ "Old Mic-E (Rev 0)", "aprs.mic_e_0_old",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_old,\r\n{ "Old Mic-E", "aprs.mic_e_old",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Old Mic-E Data (but Current data for TM-D700)", HFILL }\r\n},\r\n{ &hf_aprs_mic_e_current,\r\n{ "Current Mic-E", "aprs.mic_e_current",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\n"Current Mic-E Data (not used in TM-D700)", HFILL }\r\n},\r\n{ &hf_aprs_mic_e_dst,\r\n{ "Destination Address", "aprs.mic_e.dst",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_long_d,\r\n{ "Longitude degrees", "aprs.mic_e.long_d",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_long_m ,\r\n{ "Longitude minutes", "aprs.mic_e.long_m",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_long_h,\r\n{ "Longitude hundreths of minutes", "aprs.mic_e.long_h",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_spd_sp,\r\n{ "Speed (hundreds & tens)", "aprs.mic_e.speed_sp",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_spd_dc,\r\n{ "Speed (tens), Course (hundreds)", "aprs.mic_e.speed_dc",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_spd_se,\r\n{ "Course (tens & units)", "aprs.mic_e.speed_se",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_telemetry,\r\n{ "Telemetry", "aprs.mic_e.telemetry",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_mic_e_status,\r\n{ "Status", "aprs.mic_e.status",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_dir,\r\n{ "Direction", "aprs.storm.direction",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_spd,\r\n{ "Speed (knots)", "aprs.storm.speed",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_type,\r\n{ "Type", "aprs.storm.type",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_sws,\r\n{ "Sustained wind speed (knots)", "aprs.storm.sws",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_pwg,\r\n{ "Peak wind gusts (knots)", "aprs.storm.pwg",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_cp,\r\n{ "Central pressure (millibars/hPascal)", "aprs.storm.central_pressure",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_rhw,\r\n{ "Radius Hurricane Winds (nautical miles)", "aprs.storm.radius_hurricane_winds",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_rtsw,\r\n{ "Radius Tropical Storm Winds (nautical miles)", "aprs.storm.radius_tropical_storms_winds",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_aprs_storm_rwg,\r\n{ "Radius Whole Gale (nautical miles)", "aprs.storm.radius_whole_gale",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_aprs,\r\n&ett_aprs_msg,\r\n&ett_aprs_ct,\r\n&ett_aprs_weather,\r\n&ett_aprs_storm,\r\n&ett_aprs_mic_e,\r\n};\r\nproto_aprs = proto_register_protocol("Automatic Position Reporting System", "APRS", "aprs");\r\nregister_dissector( "aprs", dissect_aprs, proto_aprs);\r\nproto_register_field_array( proto_aprs, hf, array_length(hf ) );\r\nproto_register_subtree_array( ett, array_length( ett ) );\r\naprs_module = prefs_register_protocol( proto_aprs, NULL);\r\nprefs_register_bool_preference(aprs_module, "showaprslax",\r\n"Allow APRS violations.",\r\n"Attempt to display common APRS protocol violations correctly",\r\n&gPREF_APRS_LAX );\r\n}
