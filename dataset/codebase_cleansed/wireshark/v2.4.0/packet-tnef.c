static gint dissect_counted_values(tvbuff_t *tvb, gint offset, int hf_id, packet_info *pinfo, proto_tree *tree, gboolean single, guint encoding)\r\n{\r\nproto_item *item;\r\nguint32 length, count, i;\r\ncount = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_tnef_values_count, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nif(count > 1) {\r\nif(single) {\r\nitem = proto_tree_add_expert_format(tree, pinfo, &ei_tnef_expect_single_item, tvb, offset, 4,\r\n"Expecting a single item but found %d", count);\r\ntree = proto_item_add_subtree(item, ett_tnef_counted_items);\r\n}\r\n}\r\noffset += 4;\r\nfor(i = 0; i < count; i++) {\r\nlength = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_tnef_value_length, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_id, tvb, offset, length, encoding);\r\noffset += length;\r\n}\r\nreturn offset;\r\n}\r\nstatic gint dissect_counted_address(tvbuff_t *tvb, gint offset, packet_info *pinfo _U_, proto_tree *tree)\r\n{\r\nguint16 length;\r\nlength = tvb_get_letohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_tnef_value_length, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_display_name, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_letohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_tnef_value_length, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_email_address, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nreturn offset;\r\n}\r\nstatic void dissect_DTR(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset;\r\noffset = 0;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_year, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_month, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_day, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_hour, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_minute, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_second, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset +=2;\r\nproto_tree_add_item(tree, hf_tnef_attribute_date_day_of_week, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\n}\r\nstatic void dissect_mapiprops(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *item, *prop_item;\r\nproto_tree *prop_tree, *tag_tree;\r\nguint32 tag, tag_kind, tag_length;\r\nguint16 padding;\r\ngint offset, start_offset;\r\nguint8 drep[] = {0x10 , 0 };\r\nstatic dcerpc_info di;\r\nstatic dcerpc_call_value call_data;\r\noffset = 0;\r\ndi.conformant_run = 0;\r\ndi.call_data = &call_data;\r\ndi.dcerpc_procedure_name = "";\r\nproto_tree_add_item(tree, hf_tnef_mapi_props_count, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nwhile(tvb_reported_length_remaining(tvb, offset) > 0 ) {\r\nstart_offset = offset;\r\nprop_item = proto_tree_add_item(tree, hf_tnef_property, tvb, offset, -1, ENC_NA);\r\nprop_tree = proto_item_add_subtree(prop_item, ett_tnef_property);\r\nitem = proto_tree_add_item(prop_tree, hf_tnef_property_tag, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\ntag_tree = proto_item_add_subtree(item, ett_tnef_property_tag);\r\ntag = tvb_get_letohl(tvb, offset);\r\nproto_item_append_text(prop_item, " %s", val_to_str(tag, nspi_MAPITAGS_vals, "Unknown tag (0x%08lx)"));\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_type, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_id, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nif(tag & 0x80000000) {\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_set, tvb, offset, 16, ENC_LITTLE_ENDIAN);\r\noffset += 16;\r\ntag_kind = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_kind, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nif(tag_kind == 0) {\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_name_id, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_item_append_text(prop_item, " [Named Property]");\r\n} else {\r\nchar *name_string = NULL;\r\ntag_length = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_name_length, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tag_tree, hf_tnef_property_tag_name_string, tvb, offset, tag_length, ENC_UTF_16|ENC_LITTLE_ENDIAN);\r\noffset += tag_length;\r\nif((padding = (4 - tag_length % 4)) != 4) {\r\nproto_tree_add_item(tag_tree, hf_tnef_property_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\nproto_item_append_text(prop_item, " [Named Property: %s]", name_string);\r\n}\r\n}\r\nswitch(tag) {\r\ndefault:\r\nswitch(tag & 0x0000ffff) {\r\ncase PT_I2:\r\noffset = PIDL_dissect_uint16(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_i, 0);\r\nbreak;\r\ncase PT_LONG:\r\noffset = PIDL_dissect_uint32(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_l, 0);\r\nbreak;\r\ncase PT_BOOLEAN:\r\noffset = PIDL_dissect_uint16(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_b, 0);\r\nbreak;\r\ncase PT_STRING8:\r\noffset = dissect_counted_values(tvb, offset, hf_tnef_PropValue_lpszA, pinfo, prop_tree, TRUE, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase PT_BINARY:\r\noffset = dissect_counted_values(tvb, offset, hf_tnef_PropValue_bin, pinfo, prop_tree, TRUE, ENC_NA);\r\nbreak;\r\ncase PT_UNICODE:\r\noffset = dissect_counted_values (tvb, offset, hf_tnef_PropValue_lpszW, pinfo, prop_tree, TRUE, ENC_UTF_16|ENC_NA);\r\nbreak;\r\ncase PT_CLSID:\r\noffset = nspi_dissect_struct_MAPIUID(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_lpguid, 0);\r\nbreak;\r\ncase PT_SYSTIME:\r\noffset = nspi_dissect_struct_FILETIME(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_ft,0);\r\nbreak;\r\ncase PT_ERROR:\r\noffset = nspi_dissect_enum_MAPISTATUS(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_err, 0);\r\nbreak;\r\ncase PT_MV_I2:\r\noffset = nspi_dissect_struct_SShortArray(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVi,0);\r\nbreak;\r\ncase PT_MV_LONG:\r\noffset = nspi_dissect_struct_MV_LONG_STRUCT(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVl,0);\r\nbreak;\r\ncase PT_MV_STRING8:\r\noffset = nspi_dissect_struct_SLPSTRArray(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVszA,0);\r\nbreak;\r\ncase PT_MV_BINARY:\r\noffset = nspi_dissect_struct_SBinaryArray(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVbin,0);\r\nbreak;\r\ncase PT_MV_CLSID:\r\noffset = nspi_dissect_struct_SGuidArray(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVguid,0);\r\nbreak;\r\ncase PT_MV_UNICODE:\r\noffset = nspi_dissect_struct_MV_UNICODE_STRUCT(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVszW,0);\r\nbreak;\r\ncase PT_MV_SYSTIME:\r\noffset = nspi_dissect_struct_SDateTimeArray(tvb,offset,pinfo,prop_tree,&di,drep,hf_tnef_PropValue_MVft,0);\r\nbreak;\r\ncase PT_NULL:\r\noffset = PIDL_dissect_uint32(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_null, 0);\r\nbreak;\r\ncase PT_OBJECT:\r\noffset = PIDL_dissect_uint32(tvb, offset, pinfo, prop_tree, &di, drep, hf_tnef_PropValue_object, 0);\r\nbreak;\r\n}\r\n}\r\nif((padding = (4 - (offset - start_offset) % 4)) != 4) {\r\nproto_tree_add_item(prop_tree, hf_tnef_property_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\nproto_item_set_len(prop_item, offset - start_offset);\r\n}\r\n}\r\nstatic int dissect_tnef(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *attr_item, *item;\r\nproto_tree *attr_tree, *tag_tree, *props_tree, *addr_tree, *date_tree;\r\nguint32 tag, length, signature;\r\ngint offset, start_offset;\r\ntvbuff_t *next_tvb;\r\nif(tree){\r\nitem = proto_tree_add_item(tree, proto_tnef, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_tnef);\r\n}\r\noffset = 0;\r\nsignature = tvb_get_letohl(tvb, offset);\r\nitem = proto_tree_add_item(tree, hf_tnef_signature, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nif(signature != TNEF_SIGNATURE) {\r\nexpert_add_info_format(pinfo, item, &ei_tnef_incorrect_signature,\r\n" [Incorrect, should be 0x%x. No further dissection possible. Check any Content-Transfer-Encoding has been removed.]", TNEF_SIGNATURE);\r\nreturn offset;\r\n} else {\r\nproto_item_append_text(item, " [Correct]");\r\n}\r\nproto_tree_add_item(tree, hf_tnef_key, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nwhile(tvb_reported_length_remaining(tvb, offset) > 9 ) {\r\nstart_offset = offset;\r\nattr_item = proto_tree_add_item(tree, hf_tnef_attribute, tvb, offset, -1, ENC_NA);\r\nattr_tree = proto_item_add_subtree(attr_item, ett_tnef_attribute);\r\nproto_tree_add_item(attr_tree, hf_tnef_attribute_lvl, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nitem = proto_tree_add_item(attr_tree, hf_tnef_attribute_tag, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\ntag_tree = proto_item_add_subtree(item, ett_tnef_attribute_tag);\r\ntag = tvb_get_letohl(tvb, offset);\r\nproto_item_append_text(attr_item, " %s", val_to_str(tag, tnef_Attribute_vals, "Unknown tag (0x%08lx)"));\r\nproto_tree_add_item(tag_tree, hf_tnef_attribute_tag_id, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tag_tree, hf_tnef_attribute_tag_type, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nlength = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_item(attr_tree, hf_tnef_attribute_length, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nswitch(tag) {\r\ncase ATT_OEM_CODEPAGE:\r\nproto_tree_add_item(attr_tree, hf_tnef_oem_codepage, tvb, offset, length, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase ATT_TNEF_VERSION:\r\nproto_tree_add_item(attr_tree, hf_tnef_version, tvb, offset, length, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase ATT_MESSAGE_CLASS:\r\nproto_tree_add_item(attr_tree, hf_tnef_message_class, tvb, offset, length, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase ATT_ORIGINAL_MESSAGE_CLASS:\r\nproto_tree_add_item(attr_tree, hf_tnef_original_message_class, tvb, offset, length, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase ATT_MAPI_PROPS:\r\nitem = proto_tree_add_item(attr_tree, hf_tnef_mapi_props, tvb, offset, length, ENC_NA);\r\nprops_tree = proto_item_add_subtree(item, ett_tnef_mapi_props);\r\nnext_tvb = tvb_new_subset_length(tvb, offset, length);\r\ndissect_mapiprops(next_tvb, pinfo, props_tree);\r\nbreak;\r\ncase ATT_OWNER:\r\ncase ATT_SENT_FOR:\r\naddr_tree = proto_item_add_subtree(item, ett_tnef_attribute_address);\r\n(void)dissect_counted_address(tvb, offset, pinfo, addr_tree);\r\nbreak;\r\ncase ATT_PRIORITY:\r\nproto_tree_add_item(attr_tree, hf_tnef_priority, tvb, offset, length, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ndefault:\r\nswitch((tag >> 16) & 0xffff) {\r\ncase ATP_DATE:\r\nitem = proto_tree_add_item(attr_tree, hf_tnef_attribute_date, tvb, offset, length, ENC_NA);\r\ndate_tree = proto_item_add_subtree(item, ett_tnef_attribute_date);\r\nnext_tvb = tvb_new_subset_length(tvb, offset, length);\r\ndissect_DTR(next_tvb, pinfo, date_tree);\r\nbreak;\r\ncase ATP_STRING:\r\n{\r\nconst guint8* atp;\r\nproto_tree_add_item_ret_string(attr_tree, hf_tnef_attribute_string, tvb, offset, length, ENC_ASCII|ENC_NA, wmem_packet_scope(), &atp);\r\nproto_item_append_text(attr_item, " %s", atp);\r\n}\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(attr_tree, hf_tnef_attribute_value, tvb, offset, length, ENC_NA);\r\nbreak;\r\n}\r\n}\r\nif (offset + length > (guint32)offset) {\r\noffset += length;\r\n}\r\nproto_tree_add_checksum(attr_tree, tvb, offset, hf_tnef_attribute_checksum, -1, NULL, pinfo, 0, ENC_LITTLE_ENDIAN, PROTO_CHECKSUM_NO_FLAGS);\r\noffset += 2;\r\nproto_item_set_len(attr_item, offset - start_offset);\r\n}\r\nif(tvb_reported_length_remaining(tvb, offset))\r\nproto_tree_add_item(tree, hf_tnef_padding, tvb, offset, tvb_reported_length_remaining(tvb, offset), ENC_NA);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int dissect_tnef_file(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, PSNAME);\r\ncol_set_str(pinfo->cinfo, COL_DEF_SRC, PSNAME " encoded file");\r\ncol_append_str(pinfo->cinfo, COL_INFO, PNAME);\r\ndissect_tnef(tvb, pinfo, tree, NULL);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_tnef(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_tnef_signature,\r\n{ "Signature", "tnef.signature", FT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_key,\r\n{ "Key", "tnef.key", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute,\r\n{ "Attribute", "tnef.attribute", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_lvl,\r\n{ "Type", "tnef.attribute.lvl", FT_UINT8, BASE_DEC, VALS(tnef_Lvl_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_tag,\r\n{ "Tag", "tnef.attribute.tag", FT_UINT32, BASE_HEX, VALS(tnef_Attribute_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_tag_type,\r\n{ "Type", "tnef.attribute.tag.type", FT_UINT16, BASE_HEX, VALS(tnef_Types_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_tag_id,\r\n{ "Tag", "tnef.attribute.tag.id", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_length,\r\n{ "Length", "tnef.attribute.length", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_value,\r\n{ "Value", "tnef.attribute.value", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_string,\r\n{ "String", "tnef.attribute.string", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_date,\r\n{ "Date", "tnef.attribute.date", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_display_name,\r\n{ "Display Name", "tnef.attribute.display_name", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_email_address,\r\n{ "Email Address", "tnef.attribute.email_address", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_attribute_date_year,\r\n{ "Year", "tnef.attribute.date.year", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_month,\r\n{ "Month", "tnef.attribute.date.month", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_day,\r\n{ "Day", "tnef.attribute.date.day", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_hour,\r\n{ "Hour", "tnef.attribute.date.hour", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_minute,\r\n{ "Minute", "tnef.attribute.date.minute", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_second,\r\n{ "Second", "tnef.attribute.date.second", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_date_day_of_week,\r\n{ "Day Of Week", "tnef.attribute.date.day_of_week", FT_UINT16, BASE_DEC, VALS(weekday_vals), 0, NULL, HFILL }},\r\n{ &hf_tnef_attribute_checksum,\r\n{ "Checksum", "tnef.attribute.checksum", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_mapi_props,\r\n{ "MAPI Properties", "tnef.mapi_props", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_version,\r\n{ "Version", "tnef.version", FT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_oem_codepage,\r\n{ "OEM Codepage", "tnef.oem_codepage", FT_UINT64, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_message_class,\r\n{ "Message Class", "tnef.message_class", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_original_message_class,\r\n{ "Original Message Class", "tnef.message_class.original", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_priority,\r\n{ "Priority", "tnef.priority", FT_UINT16, BASE_DEC, VALS(tnef_Priority_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_mapi_props_count,\r\n{ "Count", "tnef.mapi_props.count", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property,\r\n{ "Property", "tnef.property", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag,\r\n{ "Tag", "tnef.property.tag", FT_UINT32, BASE_HEX, VALS(nspi_MAPITAGS_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_type,\r\n{ "Type", "tnef.property.tag.type", FT_UINT16, BASE_HEX, VALS(nspi_property_types_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_id,\r\n{ "Tag", "tnef.property.tag.id", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_set,\r\n{ "Set", "tnef.attribute.tag.set", FT_GUID, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_kind,\r\n{ "Kind", "tnef.attribute.tag.kind", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_name_id,\r\n{ "Name", "tnef.attribute.tag.name.id", FT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_name_length,\r\n{ "Length", "tnef.attribute.tag.name.length", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_tag_name_string,\r\n{ "Name", "tnef.attribute.tag.name.string", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_property_padding,\r\n{ "Padding", "tnef.property.padding", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_padding,\r\n{ "Padding", "tnef.padding", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_values_count,\r\n{ "Count", "tnef.values.count", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_value_length,\r\n{ "Length", "tnef.value.length", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_tnef_PropValue_i,\r\n{ "I", "tnef.PropValue.i", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_l,\r\n{ "L", "tnef.PropValue.l", FT_UINT32, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_b,\r\n{ "B", "tnef.PropValue.b", FT_UINT16, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_lpszA,\r\n{ "Lpsza", "tnef.PropValue.lpszA", FT_STRING, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_lpszW,\r\n{ "Lpszw", "tnef.PropValue.lpszW", FT_STRING, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_lpguid,\r\n{ "Lpguid", "tnef.PropValue.lpguid", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_bin,\r\n{ "Bin", "tnef.PropValue.bin", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_ft,\r\n{ "Ft", "tnef.PropValue.ft", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_err,\r\n{ "Err", "tnef.PropValue.err", FT_UINT32, BASE_DEC, VALS(nspi_MAPISTATUS_vals), 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVi,\r\n{ "Mvi", "tnef.PropValue.MVi", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVl,\r\n{ "Mvl", "tnef.PropValue.MVl", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVszA,\r\n{ "Mvsza", "tnef.PropValue.MVszA", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVbin,\r\n{ "Mvbin", "tnef.PropValue.MVbin", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVguid,\r\n{ "Mvguid", "tnef.PropValue.MVguid", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVszW,\r\n{ "Mvszw", "tnef.PropValue.MVszW", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_MVft,\r\n{ "Mvft", "tnef.PropValue.MVft", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_null,\r\n{ "Null", "tnef.PropValue.null", FT_UINT32, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n{ &hf_tnef_PropValue_object,\r\n{ "Object", "tnef.PropValue.object", FT_UINT32, BASE_DEC, NULL, 0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_tnef,\r\n&ett_tnef_attribute,\r\n&ett_tnef_attribute_tag,\r\n&ett_tnef_mapi_props,\r\n&ett_tnef_property,\r\n&ett_tnef_property_tag,\r\n&ett_tnef_counted_items,\r\n&ett_tnef_attribute_date,\r\n&ett_tnef_attribute_address,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_tnef_expect_single_item, { "tnef.expect_single_item", PI_MALFORMED, PI_ERROR, "Expected single item", EXPFILL }},\r\n{ &ei_tnef_incorrect_signature, { "tnef.signature.incorrect", PI_MALFORMED, PI_WARN, "Incorrect signature", EXPFILL }},\r\n};\r\nexpert_module_t* expert_tnef;\r\nproto_tnef = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_tnef, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_tnef = expert_register_protocol(proto_tnef);\r\nexpert_register_field_array(expert_tnef, ei, array_length(ei));\r\ntnef_handle = register_dissector(PFNAME, dissect_tnef, proto_tnef);\r\n}\r\nvoid\r\nproto_reg_handoff_tnef(void)\r\n{\r\ndissector_handle_t tnef_file_handle;\r\ntnef_file_handle = create_dissector_handle(dissect_tnef_file, proto_tnef);\r\ndissector_add_string("media_type", "application/ms-tnef", tnef_handle);\r\nregister_ber_oid_dissector_handle("1.2.840.113556.3.10.1", tnef_handle, proto_tnef, "id-et-tnef");\r\ndissector_add_uint("wtap_encap", WTAP_ENCAP_TNEF, tnef_file_handle);\r\n}
