static gint\r\ndissect_lon(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\ngint offset = 0;\r\ngint pdu_fmt, addr_fmt, dom_len, pdutype, length;\r\ngint addr_a;\r\nproto_tree *ti;\r\nproto_tree *lon_tree;\r\ngint npdu, type;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "LON");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nnpdu = tvb_get_guint8(tvb, 0);\r\ntype = tvb_get_guint8(tvb, 1);\r\ntype = (type&0x30)>>4;\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"%sDelta_BL: %i Type: %s",\r\nnpdu&0x80?"Priority ":"",\r\nnpdu&0x3F,\r\nval_to_str_const(type, pdu_fmt_vs, "Unknown"));\r\nti = proto_tree_add_item(tree, proto_lon, tvb, offset, -1, ENC_NA);\r\nlon_tree = proto_item_add_subtree(ti, ett_lon);\r\n{\r\nstatic const gint *ppdu_fields[] = {\r\n&hf_lon_ppdu_prio,\r\n&hf_lon_ppdu_alt,\r\n&hf_lon_ppdu_deltabl,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(lon_tree, tvb, offset, hf_lon_ppdu,\r\nett_ppdu, ppdu_fields, ENC_BIG_ENDIAN);\r\noffset++;\r\n}\r\n{\r\nstatic const gint *npdu_fields[] = {\r\n&hf_lon_npdu_version,\r\n&hf_lon_npdu_pdu_fmt,\r\n&hf_lon_npdu_addr_fmt,\r\n&hf_lon_npdu_dom_len,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(lon_tree, tvb, offset, hf_lon_npdu,\r\nett_npdu, npdu_fields, ENC_BIG_ENDIAN);\r\npdu_fmt = (tvb_get_guint8(tvb, offset) >> 4) & 0x03;\r\naddr_fmt = (tvb_get_guint8(tvb, offset) >> 2) & 0x03;\r\ndom_len = tvb_get_guint8(tvb, offset) & 0x03;\r\noffset++;\r\n}\r\nswitch(addr_fmt)\r\n{\r\ncase 0:\r\nti = proto_tree_add_subtree(lon_tree, tvb, offset, 3, ett_address, NULL, "Address type 0 (broadcast)");\r\nproto_tree_add_item(ti, hf_lon_addr_srcsub, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_srcnode, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstsub, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nbreak;\r\ncase 1:\r\nti = proto_tree_add_subtree(lon_tree, tvb, offset, 3, ett_address, NULL, "Address type 1 (multicast)");\r\nproto_tree_add_item(ti, hf_lon_addr_srcsub, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_srcnode, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstgrp, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nbreak;\r\ncase 2:\r\naddr_a = tvb_get_guint8(tvb, offset+1) >> 7;\r\nif (addr_a) {\r\nti = proto_tree_add_subtree(lon_tree, tvb, offset, 4, ett_address, NULL, "Address type 2a (unicast)");\r\nproto_tree_add_item(ti, hf_lon_addr_srcsub, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_srcnode, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstsub, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstnode, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n} else {\r\nti = proto_tree_add_subtree(lon_tree, tvb, offset, 6, ett_address, NULL, "Address type 2b (multicast)");\r\nproto_tree_add_item(ti, hf_lon_addr_srcsub, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_srcnode, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstgrp, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstnode, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_grp, tvb, offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_grpmem, tvb, offset+5, 1, ENC_BIG_ENDIAN);\r\noffset += 6;\r\n}\r\nbreak;\r\ncase 3:\r\nti = proto_tree_add_subtree(lon_tree, tvb, offset, 9, ett_address, NULL, "Address type 3 (UID)");\r\nproto_tree_add_item(ti, hf_lon_addr_srcsub, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_srcnode, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_dstsub, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti, hf_lon_addr_uid, tvb, offset+3, 6, ENC_NA);\r\noffset += 9;\r\nbreak;\r\n}\r\nswitch(dom_len)\r\n{\r\ncase 0:\r\nproto_tree_add_bytes_format(lon_tree, hf_lon_domain, tvb, offset, 0, NULL, "Domain wide addressing");\r\nbreak;\r\ncase 1:\r\nproto_tree_add_item(lon_tree, hf_lon_domain, tvb, offset, 1, ENC_NA);\r\noffset++;\r\nbreak;\r\ncase 2:\r\nproto_tree_add_item(lon_tree, hf_lon_domain, tvb, offset, 3, ENC_NA);\r\noffset += 3;\r\nbreak;\r\ncase 3:\r\nproto_tree_add_item(lon_tree, hf_lon_domain, tvb, offset, 6, ENC_NA);\r\noffset += 6;\r\nbreak;\r\n}\r\nswitch(pdu_fmt)\r\n{\r\ncase 0:\r\n{\r\nstatic const gint *tpdu_fields[] = {\r\n&hf_lon_auth,\r\n&hf_lon_tpdu_tpdu_type,\r\n&hf_lon_trans_no,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(lon_tree, tvb, offset, hf_lon_tpdu,\r\nett_tpdu, tpdu_fields, ENC_BIG_ENDIAN);\r\npdutype = (tvb_get_guint8(tvb, offset)>>4)& 0x07;\r\noffset++;\r\nswitch(pdutype)\r\n{\r\ncase 0:\r\ncase 1:\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\ncase 2:\r\nbreak;\r\ncase 4:\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lon_tree, hf_lon_mlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(lon_tree, hf_lon_mlist, tvb, offset, length, ENC_BIG_ENDIAN);\r\noffset += length;\r\nbreak;\r\ncase 5:\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lon_tree, hf_lon_mlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nif (length > 0)\r\nproto_tree_add_item(lon_tree, hf_lon_mlist, tvb, offset, length, ENC_BIG_ENDIAN);\r\noffset += length;\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, lon_tree, &ei_lon_tpdu_tpdu_type_unknown, "Unexpected TPDU type %i", pdutype);\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ncase 1:\r\n{\r\nstatic const gint *spdu_fields[] = {\r\n&hf_lon_auth,\r\n&hf_lon_spdu_spdu_type,\r\n&hf_lon_trans_no,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(lon_tree, tvb, offset, hf_lon_spdu,\r\nett_spdu, spdu_fields, ENC_BIG_ENDIAN);\r\npdutype = (tvb_get_guint8(tvb, offset)>>4)& 0x07;\r\noffset++;\r\nswitch(pdutype)\r\n{\r\ncase 0:\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\ncase 2:\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\ncase 4:\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lon_tree, hf_lon_mlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(lon_tree, hf_lon_mlist, tvb, offset, length, ENC_BIG_ENDIAN);\r\noffset += length;\r\nbreak;\r\ncase 5:\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lon_tree, hf_lon_mlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nif (length > 0)\r\nproto_tree_add_item(lon_tree, hf_lon_mlist, tvb, offset, length, ENC_BIG_ENDIAN);\r\noffset += length;\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, lon_tree, &ei_lon_tpdu_spdu_type_unknown, "Unexpected SPDU type %i", pdutype);\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ncase 2:\r\n{\r\nstatic const gint *authpdu_fields[] = {\r\n&hf_lon_authpdu_fmt,\r\n&hf_lon_authpdu_authpdu_type,\r\n&hf_lon_trans_no,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(lon_tree, tvb, offset, hf_lon_authpdu,\r\nett_authpdu, authpdu_fields, ENC_BIG_ENDIAN);\r\npdutype = (tvb_get_guint8(tvb, offset)>>4)& 0x03;\r\noffset++;\r\nswitch(pdutype)\r\n{\r\ncase 0:\r\ncase 2:\r\noffset += 9;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, lon_tree, &ei_lon_tpdu_authpdu_type_unknown, "Unexpected AuthPDU type %i", pdutype);\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ncase 3:\r\noffset += dissect_apdu(lon_tree, pinfo, tvb, offset);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic gint\r\ndissect_apdu(proto_tree *tree, packet_info *pinfo, tvbuff_t *tvb,\r\ngint offset)\r\n{\r\ntvbuff_t *next_tvb;\r\ngint old_offset = offset, dest_type;\r\ndest_type = tvb_get_guint8(tvb, offset);\r\nif ((dest_type&0x80) == 0x80) {\r\nstatic const gint *nv_fields[] = {\r\n&hf_lon_nv_dir,\r\n&hf_lon_nv_selector,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_lon_nv,\r\nett_nv, nv_fields, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n} else if ((dest_type&0xc0) == 0) {\r\nstatic const gint *app_fields[] = {\r\n&hf_lon_app_code,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_lon_app,\r\nett_app, app_fields, ENC_BIG_ENDIAN);\r\noffset++;\r\n} else if ((dest_type&0xe0) == 0x60) {\r\nstatic const gint *nm_fields[] = {\r\n&hf_lon_nm_code,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_lon_nm,\r\nett_nm, nm_fields, ENC_BIG_ENDIAN);\r\noffset++;\r\nif (dest_type == 0x7F) {\r\nproto_tree_add_item(tree, hf_lon_addr_uid, tvb, offset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(tree, hf_lon_name, tvb, offset, 8, ENC_NA);\r\noffset += 8;\r\n}\r\n} else if ((dest_type&0xf0) == 0x50) {\r\nstatic const gint *nd_fields[] = {\r\n&hf_lon_nd_code,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_lon_nd,\r\nett_nd, nd_fields, ENC_BIG_ENDIAN);\r\noffset++;\r\n} else if ((dest_type&0xf0) == 0x40) {\r\nstatic const gint *ff_fields[] = {\r\n&hf_lon_ff_code,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_lon_ff,\r\nett_ff, ff_fields, ENC_BIG_ENDIAN);\r\noffset++;\r\n} else {\r\nexpert_add_info_format(pinfo, tree, &ei_lon_tpdu_apdu_dest_type, "Malformed APDU destin&type %i", dest_type);\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\nreturn offset - old_offset + call_data_dissector(next_tvb, pinfo, tree);\r\n}\r\nvoid\r\nproto_register_lon(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{&hf_lon_ppdu,\r\n{"PPDU", "lon.ppdu",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_ppdu_prio,\r\n{"Priority", "lon.prio",\r\nFT_UINT8, BASE_DEC, NULL, 0x80,\r\n"Priority packet", HFILL }\r\n},\r\n{&hf_lon_ppdu_alt,\r\n{"Alt path", "lon.alt_path",\r\nFT_UINT8, BASE_DEC, NULL, 0x40,\r\n"Alternate path", HFILL }\r\n},\r\n{&hf_lon_ppdu_deltabl,\r\n{"Delta BL", "lon.delta_bl",\r\nFT_UINT8, BASE_DEC, NULL, 0x3f,\r\n"How many packets to expect from this one", HFILL }\r\n},\r\n{&hf_lon_npdu,\r\n{"NPDU", "lon.npdu",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_npdu_version,\r\n{"version", "lon.vers",\r\nFT_UINT8, BASE_HEX, NULL, 0xc0,\r\n"LON protocol version", HFILL }\r\n},\r\n{&hf_lon_npdu_pdu_fmt,\r\n{"PDU format", "lon.pdufmt",\r\nFT_UINT8, BASE_HEX, VALS(pdu_fmt_vs), 0x30,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_npdu_addr_fmt,\r\n{"Address format", "lon.addrfmt",\r\nFT_UINT8, BASE_HEX, VALS(addr_fmt_vs), 0x0c,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_npdu_dom_len,\r\n{"Domain length", "lon.domainlen",\r\nFT_UINT8, BASE_HEX, VALS(domain_length_vs), 0x03,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_srcsub,\r\n{"Source subnet", "lon.srcnet",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_srcnode,\r\n{"Source node", "lon.srcnode",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_dstsub,\r\n{"Destination subnet", "lon.dstnet",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_dstgrp,\r\n{"Destination group", "lon.dstgrp",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_dstnode,\r\n{"Destination node", "lon.dstnode",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_grp,\r\n{"Group", "lon.grp",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_grpmem,\r\n{"Group member", "lon.grpmem",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_addr_uid,\r\n{"Unique node ID", "lon.uid",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_domain,\r\n{"Domain", "lon.domain",\r\nFT_BYTES, BASE_NONE, NULL , 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_tpdu,\r\n{"TPDU", "lon.tpdu",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_auth,\r\n{"Auth", "lon.auth",\r\nFT_UINT8, BASE_HEX, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_tpdu_tpdu_type,\r\n{"TPDU type", "lon.tpdu_type",\r\nFT_UINT8, BASE_HEX, VALS(tpdu_type_vs), 0x70,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_trans_no,\r\n{"Transaction number", "lon.trans_no",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_spdu,\r\n{"SPDU", "lon.spdu",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_spdu_spdu_type,\r\n{"SPDU type", "lon.spdu_type",\r\nFT_UINT8, BASE_HEX, VALS(spdu_type_vs), 0x70,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_mlen,\r\n{"Length of M_List", "lon.spdu.mlen",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_mlist,\r\n{"M_List", "lon.spdu.mlist",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_authpdu,\r\n{"AuthPDU", "lon.authpdu",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_authpdu_fmt,\r\n{"FMT (same as AddrFmt)", "lon.authpdu_addrfmt",\r\nFT_UINT8, BASE_HEX, NULL, 0xc,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_authpdu_authpdu_type,\r\n{"AuthPDU type", "lon.authpdu_type",\r\nFT_UINT8, BASE_HEX, VALS(authpdu_type_vs), 0x2,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nv,\r\n{"Network Variable", "lon.nv",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nv_dir,\r\n{"NV direction", "lon.nv.dir",\r\nFT_UINT16, BASE_HEX, NULL, 0x4000,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nv_selector,\r\n{"NV selector", "lon.nv.selector",\r\nFT_UINT16, BASE_HEX, NULL, 0x3fff,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_app,\r\n{"Application", "lon.application",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_app_code,\r\n{"Code", "lon.code",\r\nFT_UINT8, BASE_HEX, NULL, 0x3f,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nm,\r\n{"Network Management", "lon.nm",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nm_code,\r\n{"Code", "lon.code",\r\nFT_UINT8, BASE_HEX, VALS(nm_code_vs), 0xff,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nd,\r\n{"Network Diagnostic", "lon.nd",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_nd_code,\r\n{"Code", "lon.code",\r\nFT_UINT8, BASE_HEX, VALS(nd_code_vs), 0xff,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_ff,\r\n{"Foreign Frame", "lon.ff",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_ff_code,\r\n{"Code", "lon.code",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{&hf_lon_name,\r\n{"Node name", "lon.name",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{&hf_lon_checksum,\r\n{"Checksum", "lon.chksum",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }\r\n}\r\n#endif\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_lon,\r\n&ett_address,\r\n&ett_ppdu,\r\n&ett_npdu,\r\n&ett_tpdu,\r\n&ett_spdu,\r\n&ett_authpdu,\r\n&ett_apdu,\r\n&ett_nv,\r\n&ett_app,\r\n&ett_nm,\r\n&ett_nd,\r\n&ett_ff\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_lon_tpdu_tpdu_type_unknown, { "lon.tpdu_type.unknown", PI_PROTOCOL, PI_WARN, "Unexpected TPDU type", EXPFILL }},\r\n{ &ei_lon_tpdu_spdu_type_unknown, { "lon.spdu_type.unknown", PI_PROTOCOL, PI_WARN, "Unexpected SPDU type", EXPFILL }},\r\n{ &ei_lon_tpdu_authpdu_type_unknown, { "lon.authpdu_type.unknown", PI_PROTOCOL, PI_WARN, "Unexpected AuthPDU type", EXPFILL }},\r\n{ &ei_lon_tpdu_apdu_dest_type, { "lon.authpdu_dest_type.unknown", PI_PROTOCOL, PI_WARN, "Malformed APDU destin&type", EXPFILL }},\r\n};\r\nexpert_module_t* expert_lon;\r\nproto_lon = proto_register_protocol("Local Operating Network",\r\n"LON", "lon");\r\nproto_register_field_array (proto_lon, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\nexpert_lon = expert_register_protocol(proto_lon);\r\nexpert_register_field_array(expert_lon, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_lon(void)\r\n{\r\ndissector_handle_t lon_handle;\r\nlon_handle = create_dissector_handle(dissect_lon, proto_lon);\r\ndissector_add_uint("cnip.protocol", 0, lon_handle);\r\n}
