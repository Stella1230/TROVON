void\r\nregister_t124_ns_dissector(const char *nsKey, dissector_t dissector, int proto)\r\n{\r\ndissector_handle_t dissector_handle;\r\ndissector_handle=create_dissector_handle(dissector, proto);\r\ndissector_add_string("t124.ns", nsKey, dissector_handle);\r\n}\r\nvoid register_t124_sd_dissector(packet_info *pinfo _U_, guint32 channelId_param, dissector_t dissector, int proto)\r\n{\r\ndissector_handle_t dissector_handle;\r\ndissector_handle=create_dissector_handle(dissector, proto);\r\ndissector_add_uint("t124.sd", channelId_param, dissector_handle);\r\n}\r\nguint32 t124_get_last_channelId(void)\r\n{\r\nreturn channelId;\r\n}\r\nvoid t124_set_top_tree(proto_tree *tree)\r\n{\r\ntop_tree = tree;\r\n}\r\nint dissect_DomainMCSPDU_PDU(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree) {\r\nint offset = 0;\r\nasn1_ctx_t asn1_ctx;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_PER, TRUE, pinfo);\r\noffset = dissect_t124_DomainMCSPDU(tvb, offset, &asn1_ctx, tree, hf_t124_DomainMCSPDU_PDU);\r\noffset += 7; offset >>= 3;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_t124(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\nproto_item *item = NULL;\r\nproto_tree *tree = NULL;\r\nasn1_ctx_t asn1_ctx;\r\ntop_tree = parent_tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "T.124");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_item(parent_tree, proto_t124, tvb, 0, tvb_captured_length(tvb), ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_t124);\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_PER, TRUE, pinfo);\r\ndissect_t124_ConnectData(tvb, 0, &asn1_ctx, tree, hf_t124_ConnectData);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic gboolean\r\ndissect_t124_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\nasn1_ctx_t asn1_ctx;\r\nvolatile gboolean failed = FALSE;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_PER, TRUE, pinfo);\r\nTRY {\r\n(void) dissect_per_sequence(tvb, 0, &asn1_ctx, NULL, hf_t124_connectGCCPDU, -1, t124Heur_sequence);\r\n} CATCH_BOUNDS_ERRORS {\r\nfailed = TRUE;\r\n} ENDTRY;\r\nif (!failed && ((asn1_ctx.external.direct_reference != NULL) &&\r\n(strcmp(asn1_ctx.external.direct_reference, "0.0.20.124.0.1") == 0))) {\r\ndissect_t124(tvb, pinfo, parent_tree, data);\r\nreturn TRUE;\r\n}\r\nreturn FALSE;\r\n}\r\nvoid proto_register_t124(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_t124_ConnectData,\r\n{ "ConnectData", "t124.ConnectData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_t124_connectGCCPDU,\r\n{ "connectGCCPDU", "t124.connectGCCPDU",\r\nFT_UINT32, BASE_DEC, VALS(t124_ConnectGCCPDU_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_t124_DomainMCSPDU_PDU,\r\n{ "DomainMCSPDU", "t124.DomainMCSPDU",\r\nFT_UINT32, BASE_DEC, VALS(t124_DomainMCSPDU_vals), 0,\r\nNULL, HFILL }},\r\n#include "packet-t124-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_t124,\r\n&ett_t124_connectGCCPDU,\r\n#include "packet-t124-ettarr.c"\r\n};\r\nproto_t124 = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_t124, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nt124_ns_dissector_table = register_dissector_table("t124.ns", "T.124 H.221 Non Standard Dissectors", proto_t124, FT_STRING, BASE_NONE);\r\nt124_sd_dissector_table = register_dissector_table("t124.sd", "T.124 H.221 Send Data Dissectors", proto_t124, FT_UINT32, BASE_HEX);\r\nregister_dissector("t124", dissect_t124, proto_t124);\r\n}\r\nvoid\r\nproto_reg_handoff_t124(void) {\r\nregister_ber_oid_dissector("0.0.20.124.0.1", dissect_t124, proto_t124, "Generic Conference Control");\r\nheur_dissector_add("t125", dissect_t124_heur, "T.124 over T.125", "t124_t125", proto_t124, HEURISTIC_ENABLE);\r\n}
