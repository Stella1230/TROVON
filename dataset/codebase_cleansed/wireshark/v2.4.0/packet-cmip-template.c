static int\r\ndissect_cmip(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data)\r\n{\r\nstruct SESSION_DATA_STRUCTURE* session;\r\nproto_item *item;\r\nproto_tree *tree;\r\nasn1_ctx_t asn1_ctx;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_BER, TRUE, pinfo);\r\nif (data == NULL)\r\nreturn 0;\r\nsession = (struct SESSION_DATA_STRUCTURE*)data;\r\nif(session->spdu_type == 0 ) {\r\nproto_tree_add_expert_format(parent_tree, pinfo, &ei_wrong_spdu_type, tvb, 0, -1,\r\n"Internal error: wrong spdu type %x from session dissector.", session->spdu_type);\r\nreturn 0;\r\n}\r\nasn1_ctx.private_data = session;\r\nitem = proto_tree_add_item(parent_tree, proto_cmip, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_cmip);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "CMIP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nswitch(session->spdu_type){\r\ncase SES_CONNECTION_REQUEST:\r\ncase SES_CONNECTION_ACCEPT:\r\ncase SES_DISCONNECT:\r\ncase SES_FINISH:\r\ncase SES_REFUSE:\r\ndissect_cmip_CMIPUserInfo(FALSE,tvb,0,&asn1_ctx,tree,-1);\r\nbreak;\r\ncase SES_ABORT:\r\ndissect_cmip_CMIPAbortInfo(FALSE,tvb,0,&asn1_ctx,tree,-1);\r\nbreak;\r\ncase SES_DATA_TRANSFER:\r\ndissect_cmip_ROS(FALSE,tvb,0,&asn1_ctx,tree,-1);\r\nbreak;\r\ndefault:\r\n;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid proto_register_cmip(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_cmip_actionType_OID,\r\n{ "actionType", "cmip.actionType_OID",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_cmip_eventType_OID,\r\n{ "eventType", "cmip.eventType_OID",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_cmip_attributeId_OID,\r\n{ "attributeId", "cmip.attributeId_OID",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_cmip_errorId_OID,\r\n{ "errorId", "cmip.errorId_OID",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_DiscriminatorConstruct,\r\n{ "DiscriminatorConstruct", "cmip.DiscriminatorConstruct",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_Destination,\r\n{ "Destination", "cmip.Destination",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_NameBinding,\r\n{ "NameBinding", "cmip.NameBinding",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_ObjectClass,\r\n{ "ObjectClass", "cmip.ObjectClass",\r\nFT_UINT32, BASE_DEC, VALS(cmip_ObjectClass_vals), 0,\r\nNULL, HFILL }},\r\n#include "packet-cmip-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_cmip,\r\n#include "packet-cmip-ettarr.c"\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_wrong_spdu_type, { "cmip.wrong_spdu_type", PI_PROTOCOL, PI_ERROR, "Internal error: wrong spdu type", EXPFILL }},\r\n};\r\nexpert_module_t* expert_cmip;\r\nproto_cmip = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\ncmip_handle = register_dissector("cmip", dissect_cmip, proto_cmip);\r\nproto_register_field_array(proto_cmip, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_cmip = expert_register_protocol(proto_cmip);\r\nexpert_register_field_array(expert_cmip, ei, array_length(ei));\r\n#include "packet-cmip-dis-tab.c"\r\noid_add_from_string("discriminatorId(1)","2.9.3.2.7.1");\r\nattribute_id_dissector_table = register_dissector_table("cmip.attribute_id", "CMIP Attribute Id", proto_cmip, FT_UINT32, BASE_DEC);\r\n}\r\nvoid proto_reg_handoff_cmip(void) {\r\nregister_ber_oid_dissector_handle("2.9.0.0.2", cmip_handle, proto_cmip, "cmip");\r\nregister_ber_oid_dissector_handle("2.9.1.1.4", cmip_handle, proto_cmip, "joint-iso-itu-t(2) ms(9) cmip(1) cmip-pci(1) abstractSyntax(4)");\r\noid_add_from_string("2.9.3.2.3.1","managedObjectClass(3) alarmRecord(1)");\r\noid_add_from_string("2.9.3.2.3.2","managedObjectClass(3) attributeValueChangeRecord(2)");\r\noid_add_from_string("2.9.3.2.3.3","managedObjectClass(3) discriminator(3)");\r\noid_add_from_string("2.9.3.2.3.4","managedObjectClass(3) eventForwardingDiscriminator(4)");\r\noid_add_from_string("2.9.3.2.3.5","managedObjectClass(3) eventLogRecord(5)");\r\noid_add_from_string("2.9.3.2.3.6","managedObjectClass(3) log(6)");\r\noid_add_from_string("2.9.3.2.3.7","managedObjectClass(3) logRecord(7)");\r\noid_add_from_string("2.9.3.2.3.8","managedObjectClass(3) objectCreationRecord(8)");\r\noid_add_from_string("2.9.3.2.3.9","managedObjectClass(3) objectDeletionRecord(9)");\r\noid_add_from_string("2.9.3.2.3.10","managedObjectClass(3) relationshipChangeRecord(10)");\r\noid_add_from_string("2.9.3.2.3.11","managedObjectClass(3) securityAlarmReportRecord(11)");\r\noid_add_from_string("2.9.3.2.3.12","managedObjectClass(3) stateChangeRecord(12)");\r\noid_add_from_string("2.9.3.2.3.13","managedObjectClass(3) system(13)");\r\noid_add_from_string("2.9.3.2.3.14","managedObjectClass(3) top(14)");\r\noid_add_from_string("2.9.3.2.4.14","administrativeStatePackage(14)");\r\noid_add_from_string("2.9.1.1.4","joint-iso-itu-t(2) ms(9) cmip(1) cmip-pci(1) abstractSyntax(4)");\r\n}
