guint\r\ntvb_get_guintvar (tvbuff_t *tvb, guint offset, guint *octetCount, packet_info *pinfo, expert_field *ei)\r\n{\r\nguint value = 0;\r\nguint octet;\r\nguint counter = 0;\r\nchar cont = 1;\r\n#ifdef DEBUG\r\nif (octetCount != NULL)\r\n{\r\nfprintf (stderr, "dissect_wap: Starting tvb_get_guintvar at offset %d, count=%d\n", offset, *octetCount);\r\n}\r\nelse\r\n{\r\nfprintf (stderr, "dissect_wap: Starting tvb_get_guintvar at offset %d, count=NULL\n", offset);\r\n}\r\n#endif\r\nwhile (cont != 0)\r\n{\r\nvalue <<= 7;\r\noctet = tvb_get_guint8 (tvb, offset+counter);\r\ncounter += 1;\r\nvalue += (octet & 0x7F);\r\ncont = (octet & 0x80);\r\n#ifdef DEBUG\r\nfprintf (stderr, "dissect_wap: computing: octet is %d (0x%02x), count=%d, value=%d, cont=%d\n",\r\noctet, octet, counter, value, cont);\r\n#endif\r\n}\r\nif (counter > 5) {\r\nproto_tree_add_expert(NULL, pinfo, ei, tvb, offset, counter);\r\nvalue = 0;\r\n}\r\nif (octetCount != NULL)\r\n{\r\n*octetCount = counter;\r\n#ifdef DEBUG\r\nfprintf (stderr, "dissect_wap: Leaving tvb_get_guintvar count=%d, value=%u\n", *octetCount, value);\r\n#endif\r\n}\r\nreturn (value);\r\n}
