static int dissect_mac_header_type_1_decoder(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ngint tvb_len, offset = 0;\r\nguint first_byte, sub_type;\r\nproto_item *parent_item = NULL;\r\nproto_item *ti = NULL;\r\nproto_tree *ti_tree = NULL;\r\nif (tree)\r\n{\r\ntvb_len = tvb_reported_length(tvb);\r\nti = proto_tree_add_protocol_format(tree, proto_mac_header_type_1_decoder, tvb, offset, tvb_len, "Mac Type I Header (%u bytes)", WIMAX_MAC_HEADER_SIZE);\r\nti_tree = proto_item_add_subtree(ti, ett_mac_header_type_1_decoder);\r\nif(tvb_len < WIMAX_MAC_HEADER_SIZE)\r\n{\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_value_bytes, tvb, offset, tvb_len, ENC_NA);\r\nreturn tvb_captured_length(tvb);\r\n}\r\n#ifdef DEBUG\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, NULL, type1_subtype_abbrv[]);\r\n#endif\r\nparent_item = proto_tree_get_parent(tree);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_ht, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_ec, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_type, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nfirst_byte = tvb_get_guint8(tvb, offset);\r\nsub_type = ((first_byte & WIMAX_MAC_HEADER_TYPE_1_SUB_TYPE_MASK)>>3);\r\nif(sub_type < TYPE_I_SUBTYPE_MAX)\r\n{\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, NULL, type1_subtype_abbrv[sub_type]);\r\n}\r\nelse\r\n{\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, NULL, "Unknown type 1 subtype");\r\nproto_tree_add_protocol_format(ti_tree, proto_mac_header_type_1_decoder, tvb, offset, tvb_len, "Unknown type 1 subtype: %u", sub_type);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_value_bytes, tvb, offset, tvb_len, ENC_NA);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nproto_item_append_text(parent_item, "%s", type1_subtype_abbrv[sub_type]);\r\nswitch (sub_type)\r\n{\r\ncase BR_INCREMENTAL:\r\ncase BR_AGGREGATE:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_br, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PHY_CHANNEL_REPORT:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_diuc, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_ultxpwr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_ulhdrm, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_rsv_2, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase BR_WITH_UL_TX_POWER_REPORT:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_br_3, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_ultxpwr_3, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase BR_AND_CINR_REPORT:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_br_3, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_cinr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_dci, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase BR_WITH_UL_SLEEP_CONTROL:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_br_3, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_pscid, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_op, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_rsv_5, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SN_REPORT:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_last, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_sdu_sn1, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_sdu_sn2, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_sdu_sn3, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase CQICH_ALLOCATION_REQUEST:\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_fb_type, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_fbssi, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_period, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_rsv_7, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_cid, tvb, (offset+3), 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ti_tree, hf_mac_header_type_1_hcs, tvb, (offset+5), 1, ENC_BIG_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid proto_register_mac_header_type_1(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_mac_header_type_1_value_bytes,\r\n{\r\n"Values", "wmx.type1ValueBytes",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_ht,\r\n{\r\n"MAC Header Type", "wmx.type1Ht",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_HT,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_ec,\r\n{\r\n"MAC Encryption Control", "wmx.type1Ec",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_EC,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_type,\r\n{\r\n"MAC Sub-Type", "wmx.type1Type",\r\nFT_UINT24, BASE_HEX, VALS(sub_types), WIMAX_MAC_HEADER_TYPE_1_TYPE,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_br,\r\n{\r\n"Bandwidth Request", "wmx.type1Br",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_BR,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_br_3,\r\n{\r\n"Bandwidth Request", "wmx.type1Br3",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_BR_3,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_fb_type,\r\n{\r\n"Feedback Type", "wmx.type1FbType",\r\nFT_UINT24, BASE_HEX, VALS(fb_types), WIMAX_MAC_HEADER_TYPE_1_FB_TYPE,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_diuc,\r\n{\r\n"Preferred DIUC Index", "wmx.type1Diuc",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_DIUC,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_ultxpwr,\r\n{\r\n"UL TX Power", "wmx.type1UlTxPwr",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_UL_TX_PWR,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_ultxpwr_3,\r\n{\r\n"UL TX Power", "wmx.type1UlTxPwr3",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_UL_TX_PWR_3,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_ulhdrm,\r\n{\r\n"Headroom to UL Max Power Level", "wmx.type1HdRm",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_UL_HDRM,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_cinr,\r\n{\r\n"CINR Value", "wmx.type1Cinr",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_CINR,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_dci,\r\n{\r\n"DCD Change Indication", "wmx.type1Dci",\r\nFT_UINT24, BASE_HEX, VALS(dci_msgs), WIMAX_MAC_HEADER_TYPE_1_DCI,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_pscid,\r\n{\r\n"Power Saving Class ID", "wmx.type1PsCid",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_PSCID,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_op,\r\n{\r\n"Operation", "wmx.type1Op",\r\nFT_UINT24, BASE_HEX, VALS(op_msgs), WIMAX_MAC_HEADER_TYPE_1_OP,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_last,\r\n{\r\n"Last ARQ BSN or SDU SN", "wmx.type1Last",\r\nFT_UINT24, BASE_HEX, VALS(last_msgs), WIMAX_MAC_HEADER_TYPE_1_LAST,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_sdu_sn1,\r\n{\r\n"ARQ BSN or MAC SDU SN (1)", "wmx.type1SduSn1",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_SDU_SN1,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_sdu_sn2,\r\n{\r\n"ARQ BSN or MAC SDU SN (2)", "wmx.type1SduSn2",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_SDU_SN2,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_sdu_sn3,\r\n{\r\n"ARQ BSN or MAC SDU SN (3)", "wmx.type1SduSn3",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_SDU_SN3,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_fbssi,\r\n{\r\n"FBSS Indicator", "wmx.type1Fbssi",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_FBSSI,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_period,\r\n{\r\n"Preferred CQICH Allocation Period", "wmx.type1Period",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_PERIOD,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_rsv_2,\r\n{\r\n"Reserved", "wmx.type1Rsv2",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_RSV_2,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_rsv_5,\r\n{\r\n"Reserved", "wmx.type1Rsv5",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_RSV_5,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_rsv_7,\r\n{\r\n"Reserved", "wmx.type1Rsv7",\r\nFT_UINT24, BASE_DEC, NULL, WIMAX_MAC_HEADER_TYPE_1_RSV_7,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_cid,\r\n{\r\n"Connection ID", "wmx.type1Cid",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mac_header_type_1_hcs,\r\n{\r\n"Header Check Sequence", "wmx.type1Hcs",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL\r\n}\r\n}\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_mac_header_type_1_decoder,\r\n};\r\nproto_mac_header_type_1_decoder = proto_mac_header_generic_decoder;\r\nproto_register_field_array(proto_mac_header_type_1_decoder, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("mac_header_type_1_handler", dissect_mac_header_type_1_decoder, proto_mac_header_type_1_decoder);\r\n}
