static prefs_set_pref_e\r\nread_language_pref(gchar *key, const gchar *value,\r\nvoid *private_data _U_, gboolean return_range_errors _U_)\r\n{\r\nif (strcmp(key, LANGUAGE_PREF_LANGUAGE) == 0) {\r\nif (language)\r\ng_free(language);\r\nif (!value || !*value || strcmp(value, "auto") == 0 ||\r\nstrcmp(value, "(null)") == 0)\r\nlanguage = g_strdup(USE_SYSTEM_LANGUAGE);\r\nelse\r\nlanguage = g_strdup(value);\r\n}\r\nreturn PREFS_SET_OK;\r\n}\r\nvoid\r\nread_language_prefs(void)\r\n{\r\nchar *rf_path;\r\nFILE *rf;\r\nrf_path = get_persconffile_path(LANGUAGE_FILE_NAME, FALSE);\r\nif ((rf = ws_fopen(rf_path, "r")) != NULL) {\r\nread_prefs_file(rf_path, rf, read_language_pref, NULL);\r\nfclose(rf);\r\n}\r\ng_free(rf_path);\r\n}\r\ngboolean\r\nwrite_language_prefs(void)\r\n{\r\nchar *pf_dir_path;\r\nchar *rf_path;\r\nFILE *rf;\r\nif (create_persconffile_dir(&pf_dir_path) == -1) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Can't create directory\n\"%s\"\nfor language file: %s.", pf_dir_path,\r\ng_strerror(errno));\r\ng_free(pf_dir_path);\r\nreturn FALSE;\r\n}\r\nrf_path = get_persconffile_path(LANGUAGE_FILE_NAME, FALSE);\r\nif ((rf = ws_fopen(rf_path, "w")) == NULL) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Can't open recent file\n\"%s\": %s.", rf_path,\r\ng_strerror(errno));\r\ng_free(rf_path);\r\nreturn FALSE;\r\n}\r\ng_free(rf_path);\r\nfputs("# Language settings file for Wireshark " VERSION ".\n"\r\n"#\n"\r\n"# This file is regenerated each time Wireshark is quit.\n"\r\n"# So be careful, if you want to make manual changes here.\n"\r\n"\n", rf);\r\nfprintf(rf, LANGUAGE_PREF_LANGUAGE ": %s\n", language ? language : USE_SYSTEM_LANGUAGE);\r\nfclose(rf);\r\nreturn TRUE;\r\n}
