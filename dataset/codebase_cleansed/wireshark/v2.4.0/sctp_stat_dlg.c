static void\r\nsctp_stat_on_select_row(GtkTreeSelection *sel, gpointer user_data _U_)\r\n{\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nGList *list;\r\nsctp_assoc_info_t *assoc;\r\ngboolean stream_found = FALSE;\r\nguint32 port2, port1;\r\nguint32 checksum, data_chunks, data_bytes, packets, vtag1, vtag2;\r\nif (gtk_tree_selection_get_selected(sel, &model, &iter)) {\r\ngtk_tree_model_get(model, &iter,\r\nPORT1_COLUMN, &port1,\r\nPORT2_COLUMN, &port2,\r\nPACKETS_COLUMN, &packets,\r\nCHECKSUM_ERRORS_COLUMN, &checksum,\r\nDATA_CHUNKS_COLUMN, &data_chunks,\r\nDATA_BYTES_COLUMN, &data_bytes,\r\nVTAG1_COLUMN, &vtag1,\r\nVTAG2_COLUMN, &vtag2,\r\n-1);\r\n} else {\r\nreturn;\r\n}\r\nlist = g_list_first(sctp_assocs->assoc_info_list);\r\nwhile (list)\r\n{\r\nassoc = (sctp_assoc_info_t*)(list->data);\r\nif ((assoc->port1 == port1) && (assoc->port2 == port2)\r\n&& (assoc->n_packets == packets)\r\n&& (assoc->n_data_chunks == data_chunks)\r\n&& (assoc->n_data_bytes == data_bytes)\r\n&& (assoc->verification_tag1 == vtag1) && (assoc->verification_tag2 == vtag2))\r\n{\r\nselected_stream = assoc;\r\nstream_found = TRUE;\r\nbreak;\r\n}\r\nlist = g_list_next(list);\r\n}\r\nif (!stream_found)\r\nselected_stream = NULL;\r\ngtk_widget_set_sensitive(bt_unselect,TRUE);\r\ngtk_widget_set_sensitive(bt_analyse,TRUE);\r\ngtk_widget_set_sensitive(bt_filter,TRUE);\r\n}\r\nstatic\r\nGtkWidget *create_list(void)\r\n{\r\nGtkListStore *list_store;\r\nGtkWidget * list;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeView *list_view;\r\nGtkTreeSelection *selection;\r\nlist_store = gtk_list_store_new(N_COLUMN,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT,\r\nG_TYPE_STRING,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT,\r\nG_TYPE_UINT);\r\nlist = gtk_tree_view_new_with_model(GTK_TREE_MODEL(list_store));\r\nlist_view = GTK_TREE_VIEW(list);\r\ngtk_tree_view_set_fixed_height_mode(list_view, TRUE);\r\ngtk_tree_view_set_headers_clickable(list_view, TRUE);\r\ng_object_unref(G_OBJECT(list_store));\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Port 1", renderer,\r\n"text", PORT1_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, PORT1_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Port 2", renderer,\r\n"text", PORT2_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, PORT2_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("No of Packets", renderer,\r\n"text", PACKETS_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, PACKETS_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Checksum", renderer,\r\n"text", CHECKSUM_TYPE_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, CHECKSUM_TYPE_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("No of Errors", renderer,\r\n"text", CHECKSUM_ERRORS_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, CHECKSUM_ERRORS_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Data Chunks", renderer,\r\n"text", DATA_CHUNKS_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, DATA_CHUNKS_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("Data Bytes", renderer,\r\n"text", DATA_BYTES_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, DATA_BYTES_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("VTag 1", renderer,\r\n"text", VTAG1_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, VTAG1_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\nrenderer = gtk_cell_renderer_text_new();\r\ncolumn = gtk_tree_view_column_new_with_attributes("VTag 2", renderer,\r\n"text", VTAG2_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, VTAG2_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 120);\r\ngtk_tree_view_append_column(list_view, column);\r\ngtk_tree_view_set_rules_hint(GTK_TREE_VIEW(list_view), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(list_view), TRUE);\r\nselection = gtk_tree_view_get_selection(GTK_TREE_VIEW(list));\r\ngtk_tree_selection_set_mode(selection, GTK_SELECTION_SINGLE);\r\ng_signal_connect(selection, "changed", G_CALLBACK(sctp_stat_on_select_row), NULL);\r\nreturn list;\r\n}\r\nstatic void\r\ndlg_destroy(GtkWidget *w _U_, gpointer user_data _U_)\r\n{\r\nguint32 i, j;\r\nGList *list;\r\nstruct sctp_analyse *child_data;\r\nj = n_children;\r\nfor (i=0; i<j; i++)\r\n{\r\nlist = g_list_last(sctp_assocs->children);\r\nchild_data = (struct sctp_analyse *)list->data;\r\ngtk_grab_remove(GTK_WIDGET(child_data->window));\r\ngtk_widget_destroy(GTK_WIDGET(child_data->window));\r\n}\r\ng_list_free(sctp_assocs->children);\r\nsctp_assocs->children = NULL;\r\nsctp_stat_dlg = NULL;\r\nprevent_update = FALSE;\r\nfilter_applied = FALSE;\r\n}\r\nvoid\r\ndecrease_analyse_childcount(void)\r\n{\r\nn_children--;\r\n}\r\nvoid\r\nincrease_analyse_childcount(void)\r\n{\r\nn_children++;\r\n}\r\nvoid\r\nset_analyse_child(struct sctp_analyse *child)\r\n{\r\nsctp_assocs->children = g_list_append(sctp_assocs->children, child);\r\n}\r\nvoid\r\nremove_analyse_child(struct sctp_analyse *child)\r\n{\r\nsctp_assocs->children = g_list_remove(sctp_assocs->children, child);\r\n}\r\nstatic void add_to_clist(sctp_assoc_info_t* assinfo)\r\n{\r\nGtkListStore *list_store;\r\nGtkTreeIter iter;\r\nlist_store = GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW(clist)));\r\ngtk_list_store_insert_with_values( list_store , &iter, G_MAXINT,\r\nPORT1_COLUMN, (guint32)assinfo->port1,\r\nPORT2_COLUMN, (guint32)assinfo->port2,\r\nPACKETS_COLUMN, assinfo->n_packets,\r\nCHECKSUM_TYPE_COLUMN, assinfo->checksum_type,\r\nCHECKSUM_ERRORS_COLUMN, assinfo->n_checksum_errors,\r\nDATA_CHUNKS_COLUMN, assinfo->n_data_chunks,\r\nDATA_BYTES_COLUMN, assinfo->n_data_bytes,\r\nVTAG1_COLUMN, assinfo->verification_tag1,\r\nVTAG2_COLUMN, assinfo->verification_tag2,\r\n-1);\r\n}\r\nstatic void\r\nsctp_stat_on_unselect(GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\nif (filter_string != NULL) {\r\ng_free(filter_string);\r\nfilter_string = NULL;\r\n}\r\nselected_stream = NULL;\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), "");\r\nmain_filter_packets(&cfile, "", FALSE);\r\ngtk_tree_selection_unselect_all(gtk_tree_view_get_selection(GTK_TREE_VIEW(clist)));\r\ngtk_widget_set_sensitive(bt_unselect,FALSE);\r\ngtk_widget_set_sensitive(bt_filter,FALSE);\r\ngtk_widget_set_sensitive(bt_analyse,FALSE);\r\ngtk_widget_set_sensitive(bt_afilter,FALSE);\r\nprevent_update = FALSE;\r\nfilter_applied = FALSE;\r\n}\r\nvoid sctp_stat_dlg_update(void)\r\n{\r\nGList *list;\r\nlist = (sctp_stat_get_info()->assoc_info_list);\r\nif ((sctp_stat_dlg != NULL) && !prevent_update)\r\n{\r\ngtk_list_store_clear(GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW(clist))));\r\nlist = g_list_first(sctp_stat_get_info()->assoc_info_list);\r\nwhile (list)\r\n{\r\nadd_to_clist((sctp_assoc_info_t*)(list->data));\r\nlist = g_list_next(list);\r\n}\r\n}\r\nlast_list = list;\r\n}\r\nstatic void\r\nsctp_stat_on_apply_filter(GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\nGList *list;\r\nsctp_assoc_info_t *assoc;\r\nguint16 port1, port2;\r\nguint32 data_chunks, data_bytes, packets, vtag1, vtag2;\r\nif (filter_string != NULL)\r\n{\r\nport1 = selected_stream->port1;\r\nport2 = selected_stream->port2;\r\ndata_chunks = selected_stream->n_data_chunks;\r\ndata_bytes = selected_stream->n_data_bytes;\r\npackets = selected_stream->n_packets;\r\nvtag1 = selected_stream->verification_tag1;\r\nvtag2 = selected_stream->verification_tag2;\r\nmain_filter_packets(&cfile, filter_string, FALSE);\r\nlist = g_list_first(sctp_assocs->assoc_info_list);\r\nwhile (list)\r\n{\r\nassoc = (sctp_assoc_info_t*)(list->data);\r\nif ((assoc->port1 == port1) && (assoc->port2 == port2)\r\n&& (assoc->n_packets == packets)\r\n&& (assoc->n_data_chunks == data_chunks)\r\n&& (assoc->n_data_bytes == data_bytes)\r\n&& (assoc->verification_tag1 == vtag1) && (assoc->verification_tag2 == vtag2))\r\n{\r\nselected_stream = assoc;\r\nbreak;\r\n}\r\nlist = g_list_next(list);\r\n}\r\ngtk_widget_set_sensitive(bt_afilter,FALSE);\r\nprevent_update = TRUE;\r\nfilter_applied = TRUE;\r\n}\r\n}\r\nstatic void\r\nsctp_stat_on_filter(GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\nif (selected_stream == NULL) {\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), "");\r\nreturn;\r\n}\r\nif (selected_stream->check_address == FALSE)\r\n{\r\ngchar *f_string;\r\nf_string = g_strdup_printf("((sctp.srcport==%u && sctp.dstport==%u && "\r\n"((sctp.verification_tag==0x%x && sctp.verification_tag!=0x0) || "\r\n"(sctp.verification_tag==0x0 && sctp.initiate_tag==0x%x) || "\r\n"(sctp.verification_tag==0x%x && (sctp.abort_t_bit==1 || "\r\n"sctp.shutdown_complete_t_bit==1)))) ||"\r\n"(sctp.srcport==%u && sctp.dstport==%u && ((sctp.verification_tag==0x%x "\r\n"&& sctp.verification_tag!=0x0) || "\r\n"(sctp.verification_tag==0x0 && sctp.initiate_tag==0x%x) ||"\r\n"(sctp.verification_tag==0x%x && (sctp.abort_t_bit==1 ||"\r\n" sctp.shutdown_complete_t_bit==1)))))",\r\nselected_stream->port1,\r\nselected_stream->port2,\r\nselected_stream->verification_tag1,\r\nselected_stream->initiate_tag,\r\nselected_stream->verification_tag2,\r\nselected_stream->port2,\r\nselected_stream->port1,\r\nselected_stream->verification_tag2,\r\nselected_stream->initiate_tag,\r\nselected_stream->verification_tag1);\r\nfilter_string = f_string;\r\n}\r\nelse\r\n{\r\ngchar *str;\r\nGString *gstring;\r\nGList *srclist, *dstlist;\r\nstruct sockaddr_in *infosrc;\r\nstruct sockaddr_in *infodst;\r\naddress addr;\r\nchar *addr_str;\r\nsrclist = g_list_first(selected_stream->addr1);\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\ngstring = g_string_new(g_strdup_printf("((sctp.srcport==%u && sctp.dstport==%u && (ip.src==%s",\r\nselected_stream->port1, selected_stream->port2, addr_str));\r\nsrclist= g_list_next(srclist);\r\nwmem_free(NULL, addr_str);\r\nwhile (srclist)\r\n{\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\nsrclist = g_list_next(srclist);\r\n}\r\ndstlist = g_list_first(selected_stream->addr2);\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(") && (ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\ndstlist = g_list_next(dstlist);\r\nwhile (dstlist)\r\n{\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\ndstlist = g_list_next(dstlist);\r\n}\r\nsrclist = g_list_first(selected_stream->addr1);\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(")) || (sctp.dstport==%u && sctp.srcport==%u && (ip.dst==%s",\r\nselected_stream->port1, selected_stream->port2, addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\nsrclist = g_list_next(srclist);\r\nwhile (srclist)\r\n{\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\nsrclist= g_list_next(srclist);\r\n}\r\ndstlist = g_list_first(selected_stream->addr2);\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(") && (ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\ndstlist = g_list_next(dstlist);\r\nwhile (dstlist)\r\n{\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\nwmem_free(NULL, addr_str);\r\ndstlist = g_list_next(dstlist);\r\n}\r\nstr = g_strdup(")))");\r\ng_string_append(gstring, str);\r\nfilter_string = g_string_free(gstring,FALSE);\r\n}\r\nif (filter_string != NULL) {\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), filter_string);\r\n} else {\r\ng_assert_not_reached();\r\n}\r\ngtk_widget_set_sensitive(bt_afilter,TRUE);\r\ngtk_widget_set_sensitive(bt_filter,FALSE);\r\nprevent_update = TRUE;\r\nfilter_applied = FALSE;\r\n}\r\nstatic void\r\nsctp_stat_on_close(GtkWidget *button _U_, gpointer user_data _U_)\r\n{\r\ngtk_grab_remove(sctp_stat_dlg);\r\ngtk_widget_destroy(sctp_stat_dlg);\r\nprevent_update = FALSE;\r\nfilter_applied = FALSE;\r\n}\r\nstatic void\r\nsctp_stat_on_analyse(GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\nif (selected_stream == NULL)\r\nreturn;\r\nelse\r\nassoc_analyse(selected_stream);\r\ngtk_widget_set_sensitive(bt_analyse,FALSE);\r\nif (!filter_applied)\r\ngtk_widget_set_sensitive(bt_filter,TRUE);\r\nprevent_update = TRUE;\r\n}\r\nstatic void\r\ngtk_sctpstat_dlg(void)\r\n{\r\nGtkWidget *sctp_stat_dlg_w;\r\nGtkWidget *vbox1;\r\nGtkWidget *scrolledwindow1;\r\nGtkWidget *hbuttonbox2;\r\nGtkWidget *bt_close;\r\nsctp_stat_dlg_w = window_new(GTK_WINDOW_TOPLEVEL, "Wireshark: SCTP Associations");\r\ngtk_window_set_position(GTK_WINDOW(sctp_stat_dlg_w), GTK_WIN_POS_CENTER);\r\ngtk_window_set_default_size(GTK_WINDOW(sctp_stat_dlg_w), 1000, 300);\r\ng_signal_connect(sctp_stat_dlg_w, "destroy", G_CALLBACK(dlg_destroy), NULL);\r\nvbox1 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 2, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(vbox1), 8);\r\ngtk_container_add(GTK_CONTAINER(sctp_stat_dlg_w), vbox1);\r\ngtk_widget_show(vbox1);\r\nscrolledwindow1 = scrolled_window_new(NULL, NULL);\r\ngtk_widget_show(scrolledwindow1);\r\ngtk_box_pack_start(GTK_BOX(vbox1), scrolledwindow1, TRUE, TRUE, 0);\r\nclist = create_list();\r\ngtk_widget_show(clist);\r\ngtk_container_add(GTK_CONTAINER(scrolledwindow1), clist);\r\ngtk_widget_set_size_request(clist, 1050, 200);\r\ngtk_widget_show(sctp_stat_dlg_w);\r\nhbuttonbox2 = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(vbox1), hbuttonbox2, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(hbuttonbox2), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX(hbuttonbox2), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX(hbuttonbox2), 0);\r\ngtk_widget_show(hbuttonbox2);\r\nbt_unselect = gtk_button_new_with_label("Unselect");\r\ngtk_container_add(GTK_CONTAINER(hbuttonbox2), bt_unselect);\r\ngtk_widget_show(bt_unselect);\r\ngtk_widget_set_sensitive(bt_unselect,FALSE);\r\nbt_filter = gtk_button_new_with_label("Set filter");\r\ngtk_container_add(GTK_CONTAINER(hbuttonbox2), bt_filter);\r\ngtk_widget_show(bt_filter);\r\ngtk_widget_set_sensitive(bt_filter,FALSE);\r\nbt_afilter = gtk_button_new_with_label("Apply filter");\r\ngtk_container_add(GTK_CONTAINER(hbuttonbox2), bt_afilter);\r\ngtk_widget_show(bt_afilter);\r\ngtk_widget_set_sensitive(bt_afilter,FALSE);\r\nbt_analyse = gtk_button_new_with_label("Analyse");\r\ngtk_container_add(GTK_CONTAINER(hbuttonbox2), bt_analyse);\r\ngtk_widget_show(bt_analyse);\r\ngtk_widget_set_sensitive(bt_analyse,FALSE);\r\nbt_close = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_container_add(GTK_CONTAINER(hbuttonbox2), bt_close);\r\ngtk_widget_set_can_default(bt_close, TRUE);\r\nwindow_set_cancel_button(sctp_stat_dlg_w, bt_close, sctp_stat_on_close);\r\ngtk_widget_grab_focus(bt_close);\r\ngtk_widget_show(bt_close);\r\ng_signal_connect(sctp_stat_dlg_w, "destroy", G_CALLBACK(dlg_destroy), NULL);\r\ng_signal_connect(bt_unselect, "clicked", G_CALLBACK(sctp_stat_on_unselect), NULL);\r\ng_signal_connect(bt_filter, "clicked", G_CALLBACK(sctp_stat_on_filter), NULL);\r\ng_signal_connect(bt_afilter, "clicked", G_CALLBACK(sctp_stat_on_apply_filter), NULL);\r\ng_signal_connect(bt_analyse, "clicked", G_CALLBACK(sctp_stat_on_analyse), NULL);\r\nsctp_stat_dlg = sctp_stat_dlg_w;\r\ncf_retap_packets(&cfile);\r\ngdk_window_raise(gtk_widget_get_window(sctp_stat_dlg_w));\r\n}\r\nstatic void sctp_stat_dlg_show(void)\r\n{\r\nif (sctp_stat_dlg != NULL)\r\n{\r\nreactivate_window(sctp_stat_dlg);\r\nif ((sctp_stat_get_info()->assoc_info_list) != last_list)\r\nsctp_stat_dlg_update();\r\n}\r\nelse\r\n{\r\ngtk_sctpstat_dlg();\r\nsctp_stat_dlg_update();\r\n}\r\n}\r\nvoid sctp_stat_start(GtkAction *action _U_, gpointer user_data _U_)\r\n{\r\nprevent_update = FALSE;\r\nfilter_applied = FALSE;\r\nsctp_assocs = (sctp_allassocs_info_t *)g_malloc(sizeof(sctp_allassocs_info_t));\r\nsctp_assocs = (sctp_allassocs_info_t*)sctp_stat_get_info();\r\nif (sctp_stat_get_info()->is_registered == FALSE)\r\nregister_tap_listener_sctp_stat();\r\nsctp_stat_scan();\r\nsctp_stat_dlg_show();\r\n}\r\nGtkWidget *get_stat_dlg(void)\r\n{\r\nreturn sctp_stat_dlg;\r\n}
