static int\r\ndissect_cgmp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *cgmp_tree = NULL;\r\nint offset = 0;\r\nguint8 count;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "CGMP");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Cisco Group Management Protocol");\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_cgmp, tvb, offset, -1,\r\nENC_NA);\r\ncgmp_tree = proto_item_add_subtree(ti, ett_cgmp);\r\nproto_tree_add_item(cgmp_tree, hf_cgmp_version, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(cgmp_tree, hf_cgmp_type, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(cgmp_tree, hf_cgmp_reserved, tvb, offset, 2,\r\nENC_BIG_ENDIAN);\r\noffset += 2;\r\ncount = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(cgmp_tree, hf_cgmp_count, tvb, offset, 1,\r\ncount);\r\noffset += 1;\r\nwhile (count != 0) {\r\nproto_tree_add_item(cgmp_tree, hf_cgmp_gda, tvb, offset, 6,\r\nENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(cgmp_tree, hf_cgmp_usa, tvb, offset, 6,\r\nENC_NA);\r\noffset += 6;\r\ncount--;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_cgmp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_cgmp_version,\r\n{ "Version", "cgmp.version", FT_UINT8, BASE_DEC, NULL, 0xF0,\r\nNULL, HFILL }},\r\n{ &hf_cgmp_type,\r\n{ "Type", "cgmp.type", FT_UINT8, BASE_DEC, VALS(type_vals), 0x0F,\r\nNULL, HFILL }},\r\n{ &hf_cgmp_reserved,\r\n{ "Reserved", "cgmp.reserved", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_cgmp_count,\r\n{ "Count", "cgmp.count", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_cgmp_gda,\r\n{ "Group Destination Address", "cgmp.gda", FT_ETHER, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_cgmp_usa,\r\n{ "Unicast Source Address", "cgmp.usa", FT_ETHER, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_cgmp,\r\n};\r\nproto_cgmp = proto_register_protocol("Cisco Group Management Protocol",\r\n"CGMP", "cgmp");\r\nproto_register_field_array(proto_cgmp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_cgmp(void)\r\n{\r\ndissector_handle_t cgmp_handle;\r\ncgmp_handle = create_dissector_handle(dissect_cgmp, proto_cgmp);\r\ndissector_add_uint("llc.cisco_pid", 0x2001, cgmp_handle);\r\ndissector_add_uint("ethertype", 0x2001, cgmp_handle);\r\n}
