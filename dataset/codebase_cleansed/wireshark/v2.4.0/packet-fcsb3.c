static void\r\ndissect_iui_flags (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint16 flags)\r\n{\r\nstatic const int * iui_flags[] = {\r\n&hf_sbccs_iui_as,\r\n&hf_sbccs_iui_es,\r\n&hf_sbccs_iui_val,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_iui,\r\nett_sbccs_iui, iui_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_linkctlinfo (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint16 flags)\r\n{\r\nstatic const int * linkctlinfo_flags[] = {\r\n&hf_sbccs_dib_linkctlinfo_ctcconn,\r\n&hf_sbccs_dib_linkctlinfo_ecrcg,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_linkctlinfo,\r\nett_sbccs_dib_linkctlinfo, linkctlinfo_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_dh_flags (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint16 flags)\r\n{\r\nstatic const int * dh_flags[] = {\r\n&hf_sbccs_dhflags_end,\r\n&hf_sbccs_dhflags_chaining,\r\n&hf_sbccs_dhflags_earlyend,\r\n&hf_sbccs_dhflags_nocrc,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dhflags,\r\nett_sbccs_dhflags, dh_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_ccw_flags (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 flags)\r\n{\r\nstatic const int * ccw_flags[] = {\r\n&hf_sbccs_dib_ccw_flags_cd,\r\n&hf_sbccs_dib_ccw_flags_cc,\r\n&hf_sbccs_dib_ccw_flags_sli,\r\n&hf_sbccs_dib_ccw_flags_crr,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_ccw_flags,\r\nett_sbccs_dib_ccw_flags, ccw_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_cmd_flags (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 flags)\r\n{\r\nstatic const int * cmd_flags[] = {\r\n&hf_sbccs_dib_cmdflags_du,\r\n&hf_sbccs_dib_cmdflags_coc,\r\n&hf_sbccs_dib_cmdflags_syr,\r\n&hf_sbccs_dib_cmdflags_rex,\r\n&hf_sbccs_dib_cmdflags_sss,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_cmdflags,\r\nett_sbccs_dib_cmdflags, cmd_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_status_flags (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 flags)\r\n{\r\nstatic const int * status_flags[] = {\r\n&hf_sbccs_dib_statusflags_ffc,\r\n&hf_sbccs_dib_statusflags_ci,\r\n&hf_sbccs_dib_statusflags_cr,\r\n&hf_sbccs_dib_statusflags_lri,\r\n&hf_sbccs_dib_statusflags_rv,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_statusflags,\r\nett_sbccs_dib_statusflags, status_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void\r\ndissect_status (packet_info *pinfo, proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 flags)\r\n{\r\nstatic const int * status_flags[] = {\r\n&hf_sbccs_dib_status_attention,\r\n&hf_sbccs_dib_status_modifier,\r\n&hf_sbccs_dib_status_cue,\r\n&hf_sbccs_dib_status_busy,\r\n&hf_sbccs_dib_status_channelend,\r\n&hf_sbccs_dib_status_deviceend,\r\n&hf_sbccs_dib_status_unit_check,\r\n&hf_sbccs_dib_status_unit_exception,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_status,\r\nett_sbccs_dib_status, status_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\nif (flags & 0x80) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Attention");\r\n}\r\nif (flags & 0x40) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Status Modifier");\r\n}\r\nif (flags & 0x20) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Control-Unit End");\r\n}\r\nif (flags & 0x10) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Busy");\r\n}\r\nif (flags & 0x08) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Channel End");\r\n}\r\nif (flags & 0x04) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Device End");\r\n}\r\nif (flags & 0x02) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Unit Check");\r\n}\r\nif (flags & 0x01) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Unit Exception");\r\n}\r\n}\r\nstatic void\r\ndissect_sel_rst_param (proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint32 flags)\r\n{\r\nstatic const int * rst_param_flags[] = {\r\n&hf_sbccs_dib_ctlparam_rc,\r\n&hf_sbccs_dib_ctlparam_ru,\r\n&hf_sbccs_dib_ctlparam_ro,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset, hf_sbccs_dib_ctlparam,\r\nett_sbccs_dib_ctlparam, rst_param_flags, flags, BMT_NO_FALSE|BMT_NO_TFS);\r\n}\r\nstatic void get_fc_sbccs_conv_data (tvbuff_t *tvb, guint offset,\r\nguint16 *ch_cu_id, guint16 *dev_addr,\r\nguint16 *ccw)\r\n{\r\n*ch_cu_id = *dev_addr = *ccw = 0;\r\n*ch_cu_id = (tvb_get_guint8 (tvb, offset+1)) << 8;\r\n*ch_cu_id |= tvb_get_guint8 (tvb, offset+3);\r\n*dev_addr = tvb_get_ntohs (tvb, offset+4);\r\n*ccw = tvb_get_ntohs (tvb, offset+10);\r\n}\r\nstatic void\r\ndissect_fc_sbccs_sb3_iu_hdr (tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nguint offset)\r\n{\r\nproto_tree *sb3hdr_tree;\r\nproto_tree *iuhdr_tree;\r\nguint8 iui, dhflags;\r\nguint type;\r\ntype = get_fc_sbccs_iu_type (tvb, offset);\r\ncol_add_str (pinfo->cinfo, COL_INFO, val_to_str (type, fc_sbccs_iu_val,\r\n"0x%x"));\r\nif (tree) {\r\nsb3hdr_tree = proto_tree_add_subtree(tree, tvb, offset, FC_SBCCS_SB3_HDR_SIZE,\r\nett_fc_sbccs, NULL, "SB-3 Header");\r\nproto_tree_add_item (sb3hdr_tree, hf_sbccs_chid, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (sb3hdr_tree, hf_sbccs_cuid, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (sb3hdr_tree, hf_sbccs_devaddr, tvb, offset+4, 2, ENC_BIG_ENDIAN);\r\niuhdr_tree = proto_tree_add_subtree(tree, tvb, offset + FC_SBCCS_SB3_HDR_SIZE,\r\nFC_SBCCS_IU_HDR_SIZE, ett_fc_sbccs, NULL, "IU Header");\r\noffset += FC_SBCCS_SB3_HDR_SIZE;\r\niui = tvb_get_guint8 (tvb, offset);\r\ndissect_iui_flags(iuhdr_tree, tvb, offset, iui);\r\ndhflags = tvb_get_guint8 (tvb, offset+1);\r\ndissect_dh_flags(iuhdr_tree, tvb, offset+1, dhflags);\r\nproto_tree_add_item (iuhdr_tree, hf_sbccs_ccw, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (iuhdr_tree, hf_sbccs_token, tvb, offset+5, 3, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void dissect_fc_sbccs_dib_data_hdr (tvbuff_t *tvb,\r\npacket_info *pinfo _U_,\r\nproto_tree *tree, guint offset)\r\n{\r\nif (tree) {\r\nproto_tree_add_item (tree, hf_sbccs_dib_iucnt, tvb, offset+9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_datacnt, tvb, offset+10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_lrc, tvb, offset+12, 4, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void dissect_fc_sbccs_dib_cmd_hdr (tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, guint offset)\r\n{\r\nguint8 flags;\r\ncol_append_fstr (pinfo->cinfo, COL_INFO,\r\n": %s", val_to_str (tvb_get_guint8 (tvb, offset),\r\nfc_sbccs_dib_cmd_val,\r\n"0x%x"));\r\nif (tree) {\r\nproto_tree_add_item (tree, hf_sbccs_dib_ccw_cmd, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nflags = tvb_get_guint8 (tvb, offset+1);\r\ndissect_ccw_flags(tree, tvb, offset+1, flags);\r\nproto_tree_add_item (tree, hf_sbccs_dib_ccw_cnt, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_ioprio, tvb, offset+5, 1, ENC_BIG_ENDIAN);\r\nflags = tvb_get_guint8 (tvb, offset+7);\r\ndissect_cmd_flags(tree, tvb, offset+7, flags);\r\nproto_tree_add_item (tree, hf_sbccs_dib_iucnt, tvb, offset+9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_datacnt, tvb, offset+10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_lrc, tvb, offset+12, 4, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void dissect_fc_sbccs_dib_status_hdr (tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, guint offset)\r\n{\r\nguint8 flags;\r\ngboolean rv_valid, qparam_valid;\r\ntvbuff_t *next_tvb;\r\nguint16 supp_status_cnt = 0;\r\nif (tree) {\r\nflags = tvb_get_guint8 (tvb, offset);\r\nrv_valid = flags & 0x1;\r\nqparam_valid = (((flags & 0xE0) >> 5) == 0x1);\r\ndissect_status_flags(tree, tvb, offset, flags);\r\nflags = tvb_get_guint8 (tvb, offset+1);\r\ndissect_status(pinfo, tree, tvb, offset+1, flags);\r\nif (rv_valid) {\r\nproto_tree_add_item (tree, hf_sbccs_dib_residualcnt, tvb, offset+2,\r\n2, ENC_BIG_ENDIAN);\r\n}\r\nelse {\r\nproto_tree_add_item (tree, hf_sbccs_dib_iupacing, tvb, offset+3,\r\n1, ENC_BIG_ENDIAN);\r\n}\r\nif (qparam_valid) {\r\nproto_tree_add_item (tree, hf_sbccs_dib_qtuf, tvb, offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_qtu, tvb, offset+4, 2, ENC_BIG_ENDIAN);\r\n}\r\nproto_tree_add_item (tree, hf_sbccs_dib_dtuf, tvb, offset+6, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_dtu, tvb, offset+6, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_iucnt, tvb, offset+9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_datacnt, tvb, offset+10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_lrc, tvb, offset+12, 4, ENC_BIG_ENDIAN);\r\n}\r\nsupp_status_cnt = tvb_get_ntohs (tvb, offset+10);\r\nif (supp_status_cnt) {\r\nnext_tvb = tvb_new_subset_remaining (tvb, offset+FC_SBCCS_DIB_LRC_HDR_SIZE);\r\ncall_data_dissector(next_tvb, pinfo, tree);\r\n}\r\n}\r\nstatic void dissect_fc_sbccs_dib_ctl_hdr (tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, guint offset)\r\n{\r\nguint8 ctlfn;\r\nctlfn = tvb_get_guint8 (tvb, offset);\r\ncol_append_fstr (pinfo->cinfo, COL_INFO,\r\n": %s",\r\nval_to_str (ctlfn,\r\nfc_sbccs_dib_ctl_fn_val,\r\n"0x%x"));\r\nif (tree) {\r\nproto_tree_add_item (tree, hf_sbccs_dib_ctlfn, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nswitch (ctlfn) {\r\ncase FC_SBCCS_CTL_FN_SEL_RST:\r\ndissect_sel_rst_param(tree, tvb, offset+1, tvb_get_ntoh24 (tvb, offset+1));\r\nbreak;\r\ncase FC_SBCCS_CTL_FN_DEV_XCP:\r\nproto_tree_add_item (tree, hf_sbccs_dev_xcp_code, tvb, offset+1,\r\n1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FC_SBCCS_CTL_FN_PRG_PTH:\r\nproto_tree_add_item (tree, hf_sbccs_prg_pth_errcode, tvb, offset+1,\r\n1, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item (tree, hf_sbccs_dib_ctlparam, tvb, offset+1,\r\n3, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\nproto_tree_add_item (tree, hf_sbccs_dib_iucnt, tvb, offset+9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_datacnt, tvb, offset+10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_lrc, tvb, offset+12, 4, ENC_BIG_ENDIAN);\r\nif (ctlfn == FC_SBCCS_CTL_FN_PRG_RSP) {\r\nproto_tree_add_item (tree, hf_sbccs_prg_rsp_errcode, tvb, offset+60,\r\n1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\n}\r\nstatic void dissect_fc_sbccs_dib_link_hdr (tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, guint offset)\r\n{\r\nguint8 link_ctl;\r\nguint16 ctl_info;\r\nguint link_payload_len, i;\r\ncol_append_fstr (pinfo->cinfo, COL_INFO,\r\n": %s",\r\nval_to_str (tvb_get_guint8 (tvb, offset+1),\r\nfc_sbccs_dib_link_ctl_fn_val,\r\n"0x%x"));\r\nif (tree) {\r\nlink_ctl = tvb_get_guint8 (tvb, offset+1);\r\nproto_tree_add_item (tree, hf_sbccs_dib_linkctlfn, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nctl_info = tvb_get_ntohs (tvb, offset+2);\r\nswitch (link_ctl) {\r\ncase FC_SBCCS_LINK_CTL_FN_ELP:\r\ncase FC_SBCCS_LINK_CTL_FN_LPE:\r\ndissect_linkctlinfo(tree, tvb, offset+2, ctl_info);\r\nbreak;\r\ncase FC_SBCCS_LINK_CTL_FN_LPR:\r\nproto_tree_add_item (tree, hf_sbccs_dib_lprcode, tvb, offset+2, 1,\r\nENC_BIG_ENDIAN);\r\nbreak;\r\ncase FC_SBCCS_LINK_CTL_FN_TIN:\r\nproto_tree_add_item (tree, hf_sbccs_dib_tin_imgid_cnt, tvb,\r\noffset+3, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FC_SBCCS_LINK_CTL_FN_TIR:\r\nproto_tree_add_item (tree, hf_sbccs_dib_tin_imgid_cnt, tvb,\r\noffset+3, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FC_SBCCS_LINK_CTL_FN_LRJ:\r\nproto_tree_add_item (tree, hf_sbccs_dib_lrjcode, tvb, offset+2,\r\n1, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nproto_tree_add_item (tree, hf_sbccs_dib_ctccntr, tvb, offset+4, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_iucnt, tvb, offset+9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_dib_datacnt, tvb, offset+10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_sbccs_lrc, tvb, offset+12, 4, ENC_BIG_ENDIAN);\r\nif (link_ctl == FC_SBCCS_LINK_CTL_FN_TIR) {\r\nlink_payload_len = tvb_get_ntohs (tvb, offset+10);\r\ni = 0;\r\noffset += 16;\r\nwhile (i < link_payload_len) {\r\nproto_tree_add_bytes_format(tree, hf_sbccs_logical_path, tvb, offset, 4,\r\nNULL, "Logical Paths %d-%d: %s",\r\ni*8, ((i+4)*8) - 1,\r\ntvb_bytes_to_str_punct(wmem_packet_scope(), tvb, offset, 4, ':'));\r\ni += 4;\r\noffset += 4;\r\n}\r\n}\r\n}\r\n}\r\nstatic int dissect_fc_sbccs (tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data _U_)\r\n{\r\nguint8 type;\r\nguint16 ch_cu_id, dev_addr, ccw;\r\nguint offset = 0;\r\nproto_item *ti;\r\nproto_tree *sb3_tree = NULL;\r\nproto_tree *dib_tree = NULL;\r\ntvbuff_t *next_tvb;\r\nconversation_t *conversation;\r\n#if 0\r\nsb3_task_id_t task_key;\r\n#endif\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "FC-SB3");\r\ntype = get_fc_sbccs_iu_type (tvb, offset);\r\nget_fc_sbccs_conv_data (tvb, offset, &ch_cu_id, &dev_addr, &ccw);\r\ncol_add_str (pinfo->cinfo, COL_INFO, val_to_str (type, fc_sbccs_iu_val,\r\n"0x%x"));\r\nconversation = find_conversation (pinfo->num, &pinfo->src, &pinfo->dst,\r\nPT_SBCCS, ch_cu_id, dev_addr, 0);\r\nif (conversation) {\r\n#if 0\r\ntask_key.conv_id = conversation->index;\r\ntask_key.task_id = ccw;\r\n#endif\r\n}\r\nelse if ((type == FC_SBCCS_IU_CMD_HDR) ||\r\n(type != FC_SBCCS_IU_CMD_DATA)) {\r\n#if 0\r\nconversation =\r\n#endif\r\nconversation_new (pinfo->num, &pinfo->src, &pinfo->dst,\r\nPT_SBCCS, ch_cu_id, dev_addr, 0);\r\n#if 0\r\ntask_key.conv_id = conversation->index;\r\ntask_key.task_id = ccw;\r\n#endif\r\n}\r\nif (tree) {\r\nti = proto_tree_add_protocol_format (tree, proto_fc_sbccs, tvb, 0, -1,\r\n"FC-SB3");\r\nsb3_tree = proto_item_add_subtree (ti, ett_fc_sbccs);\r\ndissect_fc_sbccs_sb3_iu_hdr (tvb, pinfo, sb3_tree, offset);\r\noffset += (FC_SBCCS_SB3_HDR_SIZE + FC_SBCCS_IU_HDR_SIZE);\r\ndib_tree = proto_tree_add_subtree(sb3_tree, tvb, offset,\r\nFC_SBCCS_DIB_LRC_HDR_SIZE, ett_fc_sbccs, NULL, "DIB Header");\r\n}\r\nelse {\r\noffset += (FC_SBCCS_SB3_HDR_SIZE + FC_SBCCS_IU_HDR_SIZE);\r\n}\r\nswitch (type) {\r\ncase FC_SBCCS_IU_DATA:\r\ndissect_fc_sbccs_dib_data_hdr (tvb, pinfo, dib_tree, offset);\r\nbreak;\r\ncase FC_SBCCS_IU_CMD_HDR:\r\ncase FC_SBCCS_IU_CMD_DATA:\r\ndissect_fc_sbccs_dib_cmd_hdr (tvb, pinfo, dib_tree, offset);\r\nbreak;\r\ncase FC_SBCCS_IU_STATUS:\r\ndissect_fc_sbccs_dib_status_hdr (tvb, pinfo, dib_tree, offset);\r\nbreak;\r\ncase FC_SBCCS_IU_CTL:\r\ndissect_fc_sbccs_dib_ctl_hdr (tvb, pinfo, dib_tree, offset);\r\nbreak;\r\ncase FC_SBCCS_IU_CMD_LINK_CTL:\r\ndissect_fc_sbccs_dib_link_hdr (tvb, pinfo, dib_tree, offset);\r\nbreak;\r\ndefault:\r\nnext_tvb = tvb_new_subset_remaining (tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, dib_tree);\r\nbreak;\r\n}\r\nif ((get_fc_sbccs_iu_type (tvb, 0) != FC_SBCCS_IU_CTL) &&\r\n(get_fc_sbccs_iu_type (tvb, 0) != FC_SBCCS_IU_CMD_LINK_CTL)) {\r\nnext_tvb = tvb_new_subset_remaining (tvb, offset+FC_SBCCS_DIB_LRC_HDR_SIZE);\r\ncall_data_dissector(next_tvb, pinfo, tree);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_fcsbccs (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_sbccs_chid,\r\n{ "Channel Image ID", "fcsb3.chid",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_cuid,\r\n{ "Control Unit Image ID", "fcsb3.cuid",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_devaddr,\r\n{ "Device Address", "fcsb3.devaddr",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_iui,\r\n{ "Information Unit Identifier", "fcsb3.iui",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dhflags,\r\n{ "DH Flags", "fcsb3.dhflags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_ccw,\r\n{ "CCW Number", "fcsb3.ccw",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_token,\r\n{ "Token", "fcsb3.token",\r\nFT_UINT24, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_iucnt,\r\n{ "DIB IU Count", "fcsb3.iucnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_datacnt,\r\n{ "DIB Data Byte Count", "fcsb3.databytecnt",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_cmd,\r\n{ "CCW Command", "fcsb3.ccwcmd",\r\nFT_UINT8, BASE_HEX, VALS (fc_sbccs_dib_cmd_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_cnt,\r\n{ "CCW Count", "fcsb3.ccwcnt",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ioprio,\r\n{ "I/O Priority", "fcsb3.ioprio",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status,\r\n{ "Status", "fcsb3.status",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_residualcnt,\r\n{ "Residual Count", "fcsb3.residualcnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_iupacing,\r\n{ "IU Pacing", "fcsb3.iupacing",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_qtuf,\r\n{ "Queue-Time Unit Factor", "fcsb3.qtuf",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_qtu,\r\n{ "Queue-Time Unit", "fcsb3.qtu",\r\nFT_UINT16, BASE_DEC, NULL, 0xFFF,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_dtuf,\r\n{ "Defer-Time Unit Function", "fcsb3.dtuf",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_dtu,\r\n{ "Defer-Time Unit", "fcsb3.dtu",\r\nFT_UINT16, BASE_DEC, NULL, 0xFFF,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctlfn,\r\n{ "Control Function", "fcsb3.ctlfn",\r\nFT_UINT8, BASE_HEX, VALS (fc_sbccs_dib_ctl_fn_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_linkctlfn,\r\n{ "Link Control Function", "fcsb3.linkctlfn",\r\nFT_UINT8, BASE_HEX, VALS (fc_sbccs_dib_link_ctl_fn_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctccntr,\r\n{ "CTC Counter", "fcsb3.ctccntr",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_lrc,\r\n{ "LRC", "fcsb3.lrc",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dev_xcp_code,\r\n{ "Device Level Exception Code", "fcsb3.dip.xcpcode",\r\nFT_UINT8, BASE_DEC, VALS (fc_sbccs_dib_dev_xcpcode_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_prg_pth_errcode,\r\n{ "Purge Path Error Code", "fcsb3.purgepathcode",\r\nFT_UINT8, BASE_DEC, VALS (fc_sbccs_dib_purge_path_err_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_prg_rsp_errcode,\r\n{ "Purge Path Response Error Code", "fcsb3.purgepathrspcode",\r\nFT_UINT8, BASE_DEC, VALS (fc_sbccs_dib_purge_path_rsp_err_val), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_lprcode,\r\n{ "LPR Reason Code", "fcsb3.lprcode",\r\nFT_UINT8, BASE_DEC, VALS (fc_sbccs_dib_lpr_errcode_val), 0xF,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_tin_imgid_cnt,\r\n{ "TIN Image ID", "fcsb3.tinimageidcnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_lrjcode,\r\n{ "LRJ Reaspn Code", "fcsb3.lrjcode",\r\nFT_UINT8, BASE_HEX, VALS (fc_sbccs_dib_lrj_errcode_val), 0x7F,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_iui_as,\r\n{ "AS", "fcsb3.iui.as",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_iui_es,\r\n{ "ES", "fcsb3.iui.es",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_iui_val,\r\n{ "Val", "fcsb3.iui.val",\r\nFT_UINT8, BASE_HEX, VALS(fc_sbccs_iu_val), 0x07,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dhflags_end,\r\n{ "End", "fcsb3.dhflags.end",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x80,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dhflags_chaining,\r\n{ "Chaining", "fcsb3.dhflags.chaining",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dhflags_earlyend,\r\n{ "Early End", "fcsb3.dhflags.earlyend",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dhflags_nocrc,\r\n{ "No CRC", "fcsb3.dhflags.nocrc",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x04,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_flags,\r\n{ "CCW Control Flags", "fcsb3.ccwflags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_flags_cd,\r\n{ "CD", "fcsb3.ccwflags.cd",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x80,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_flags_cc,\r\n{ "CC", "fcsb3.ccwflags.cc",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x40,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_flags_sli,\r\n{ "SLI", "fcsb3.ccwflags.sli",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x20,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ccw_flags_crr,\r\n{ "CRR", "fcsb3.ccwflags.crr",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags,\r\n{ "Command Flags", "fcsb3.cmdflags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags_du,\r\n{ "DU", "fcsb3.cmdflags.du",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags_coc,\r\n{ "COC", "fcsb3.cmdflags.coc",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags_syr,\r\n{ "SYR", "fcsb3.cmdflags.syr",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x04,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags_rex,\r\n{ "REX", "fcsb3.cmdflags.rex",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x02,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_cmdflags_sss,\r\n{ "SSS", "fcsb3.cmdflags.sss",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x01,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags,\r\n{ "Status Flags", "fcsb3.statusflags",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags_ffc,\r\n{ "FFC", "fcsb3.statusflags.ffc",\r\nFT_UINT8, BASE_HEX, VALS(status_ffc_val), 0xE0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags_ci,\r\n{ "CI", "fcsb3.statusflags.ci",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags_cr,\r\n{ "CR", "fcsb3.statusflags.cr",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x04,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags_lri,\r\n{ "LRI", "fcsb3.statusflags.lri",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x02,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_statusflags_rv,\r\n{ "RV", "fcsb3.statusflags.rv",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x01,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_attention,\r\n{ "Attention", "fcsb3.status.attention",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x80,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_modifier,\r\n{ "Status Modifier", "fcsb3.status.modifier",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x40,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_cue,\r\n{ "Control-Unit End", "fcsb3.status.cue",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x20,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_busy,\r\n{ "Busy", "fcsb3.status.busy",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_channelend,\r\n{ "Channel End", "fcsb3.status.channel_end",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_deviceend,\r\n{ "Device End", "fcsb3.status.device_end",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x04,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_unit_check,\r\n{ "Unit Check", "fcsb3.status.unit_check",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x02,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_status_unit_exception,\r\n{ "Unit Exception", "fcsb3.status.unitexception",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), 0x01,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctlparam,\r\n{ "Control Parameters", "fcsb3.ctlparam",\r\nFT_UINT24, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctlparam_rc,\r\n{ "RC", "fcsb3.ctlparam.rc",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), 0x80,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctlparam_ru,\r\n{ "RU", "fcsb3.ctlparam.ru",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), 0x10,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_ctlparam_ro,\r\n{ "RO", "fcsb3.ctlparam.ro",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), 0x08,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_linkctlinfo,\r\n{ "Link Control Information", "fcsb3.linkctlinfo",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_linkctlinfo_ctcconn,\r\n{ "CTC Conn", "fcsb3.linkctlinfo.ctc_conn",\r\nFT_BOOLEAN, 16, TFS(&tfs_supported_not_supported), 0x80,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_dib_linkctlinfo_ecrcg,\r\n{ "Enhanced CRC Generation", "fcsb3.linkctlinfo.ecrcg",\r\nFT_BOOLEAN, 16, TFS(&tfs_supported_not_supported), 0x01,\r\nNULL, HFILL}},\r\n{ &hf_sbccs_logical_path,\r\n{ "Logical Path", "fcsb3.logical_path",\r\nFT_BYTES, SEP_COLON, NULL, 0x0,\r\nNULL, HFILL}},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_fc_sbccs,\r\n&ett_sbccs_iui,\r\n&ett_sbccs_dhflags,\r\n&ett_sbccs_dib_ccw_flags,\r\n&ett_sbccs_dib_cmdflags,\r\n&ett_sbccs_dib_statusflags,\r\n&ett_sbccs_dib_status,\r\n&ett_sbccs_dib_ctlparam,\r\n&ett_sbccs_dib_linkctlinfo,\r\n};\r\nproto_fc_sbccs = proto_register_protocol ("Fibre Channel Single Byte Command",\r\n"FC-SB3", "fcsb3");\r\nproto_register_field_array(proto_fc_sbccs, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_fcsbccs (void)\r\n{\r\ndissector_handle_t fc_sbccs_handle;\r\nfc_sbccs_handle = create_dissector_handle (dissect_fc_sbccs,\r\nproto_fc_sbccs);\r\ndissector_add_uint("fc.ftype", FC_FTYPE_SBCCS, fc_sbccs_handle);\r\n}
