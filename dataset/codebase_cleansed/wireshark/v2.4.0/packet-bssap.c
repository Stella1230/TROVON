static void\r\ndissect_bssap_data_param(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *bssap_tree, proto_tree *tree, struct _sccp_msg_info_t* sccp_info)\r\n{\r\nif ((pdu_type <= 0x01))\r\n{\r\nif (bssap_or_bsap_global == BSSAP)\r\n{\r\nif((gsm_or_lb_interface_global == LB_INTERFACE) && (pdu_type == BSSAP_PDU_TYPE_BSSMAP))\r\n{\r\ncall_dissector_with_data(gsm_bssmap_le_dissector_handle, tvb, pinfo, tree, sccp_info);\r\nreturn;\r\n}\r\nelse if((gsm_or_lb_interface_global == GSM_INTERFACE) && (pdu_type == BSSAP_PDU_TYPE_BSSMAP))\r\n{\r\ncall_dissector_with_data(gsm_a_bssmap_dissector_handle, tvb, pinfo, tree, sccp_info);\r\nreturn;\r\n}\r\nelse\r\n{\r\nif (dissector_try_uint_new(bssap_dissector_table, pdu_type, tvb, pinfo, tree, TRUE, sccp_info)) return;\r\n}\r\n}\r\nelse\r\n{\r\nif (dissector_try_uint_new(bsap_dissector_table, pdu_type, tvb, pinfo, tree, TRUE, sccp_info))\r\nreturn;\r\n}\r\n}\r\ncall_data_dissector(tvb, pinfo, bssap_tree);\r\n}\r\nstatic void\r\ndissect_bssap_dlci_param(tvbuff_t *tvb, proto_tree *tree, guint16 length)\r\n{\r\nproto_tree *dlci_tree;\r\nguint8 oct;\r\ndlci_tree =\r\nproto_tree_add_subtree(tree, tvb, 0, length,\r\nett_bssap_dlci, NULL, "Data Link Connection Identifier");\r\noct = tvb_get_guint8(tvb, 0);\r\nif (bssap_or_bsap_global == BSSAP)\r\n{\r\nproto_tree_add_uint(dlci_tree, hf_bssap_dlci_cc, tvb, 0, length, oct);\r\nproto_tree_add_uint(dlci_tree, hf_bssap_dlci_spare, tvb, 0, length, oct);\r\nproto_tree_add_uint(dlci_tree, hf_bssap_dlci_sapi, tvb, 0, length, oct);\r\n}\r\nelse\r\n{\r\nproto_tree_add_uint(dlci_tree, hf_bsap_dlci_cc, tvb, 0, length, oct);\r\nproto_tree_add_uint(dlci_tree, hf_bsap_dlci_rsvd, tvb, 0, length, oct);\r\nproto_tree_add_uint(dlci_tree, hf_bsap_dlci_sapi, tvb, 0, length, oct);\r\n}\r\n}\r\nstatic void\r\ndissect_bssap_length_param(tvbuff_t *tvb, proto_tree *tree, guint16 length)\r\n{\r\nguint8 data_length;\r\ndata_length = tvb_get_guint8(tvb, 0);\r\nproto_tree_add_uint(tree, hf_bssap_length, tvb, 0, length, data_length);\r\n}\r\nstatic guint16\r\ndissect_bssap_parameter(tvbuff_t *tvb, packet_info *pinfo, proto_tree *bssap_tree,\r\nproto_tree *tree, guint8 parameter_type, gint offset,\r\nguint16 parameter_length, struct _sccp_msg_info_t* sccp_info)\r\n{\r\ntvbuff_t *parameter_tvb;\r\nparameter_tvb = tvb_new_subset_length(tvb, offset, parameter_length);\r\nswitch (parameter_type)\r\n{\r\ncase PARAMETER_DLCI:\r\ndissect_bssap_dlci_param(parameter_tvb, bssap_tree, parameter_length);\r\nbreak;\r\ncase PARAMETER_LENGTH:\r\ndissect_bssap_length_param(parameter_tvb, bssap_tree, parameter_length);\r\nbreak;\r\ncase PARAMETER_DATA:\r\ndissect_bssap_data_param(parameter_tvb, pinfo, bssap_tree, tree, sccp_info);\r\nbreak;\r\ndefault:\r\nproto_tree_add_expert_format(bssap_tree, pinfo, &ei_bssap_unknown_parameter, parameter_tvb, 0, parameter_length,\r\n"Unknown parameter 0x%x (%u byte%s)", parameter_type, parameter_length, plurality(parameter_length, "", "s"));\r\nbreak;\r\n}\r\nreturn(parameter_length);\r\n}\r\nstatic guint16\r\ndissect_bssap_var_parameter(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *bssap_tree, proto_tree *tree,\r\nguint8 parameter_type, gint offset, struct _sccp_msg_info_t* sccp_info)\r\n{\r\nguint16 parameter_length;\r\nguint8 length_length;\r\nparameter_length = tvb_get_guint8(tvb, offset);\r\nlength_length = LENGTH_LENGTH;\r\noffset += length_length;\r\ndissect_bssap_parameter(tvb, pinfo, bssap_tree, tree, parameter_type,\r\noffset, parameter_length, sccp_info);\r\nreturn(parameter_length + length_length);\r\n}\r\nstatic int\r\ndissect_bssap_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *bssap_tree,\r\nproto_tree *tree, struct _sccp_msg_info_t* sccp_info)\r\n{\r\ngint offset;\r\nproto_item* type_item;\r\npdu_type = tvb_get_guint8(tvb, PDU_TYPE_OFFSET);\r\noffset = PDU_TYPE_LENGTH;\r\ntype_item = proto_tree_add_uint(bssap_tree,\r\n(bssap_or_bsap_global == BSSAP) ? hf_bssap_pdu_type : hf_bsap_pdu_type,\r\ntvb, PDU_TYPE_OFFSET, PDU_TYPE_LENGTH, pdu_type);\r\nswitch (pdu_type)\r\n{\r\ncase BSSAP_PDU_TYPE_BSSMAP:\r\noffset += dissect_bssap_parameter(tvb, pinfo, bssap_tree, tree,\r\nPARAMETER_LENGTH, offset,\r\nLENGTH_LENGTH, sccp_info);\r\noffset += dissect_bssap_var_parameter(tvb, pinfo, bssap_tree, tree,\r\nPARAMETER_DATA,\r\n(offset - LENGTH_LENGTH), sccp_info);\r\nbreak;\r\ncase BSSAP_PDU_TYPE_DTAP:\r\noffset += dissect_bssap_parameter(tvb, pinfo, bssap_tree, tree,\r\nPARAMETER_DLCI,\r\noffset, DLCI_LENGTH, sccp_info);\r\noffset += dissect_bssap_parameter(tvb, pinfo, bssap_tree, tree,\r\nPARAMETER_LENGTH, offset,\r\nLENGTH_LENGTH, sccp_info);\r\noffset += dissect_bssap_var_parameter(tvb, pinfo, bssap_tree, tree,\r\nPARAMETER_DATA,\r\n(offset - LENGTH_LENGTH), sccp_info);\r\nbreak;\r\ndefault:\r\n{\r\nguint32 message_length;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s ",\r\nval_to_str_const(pdu_type,\r\n((bssap_or_bsap_global == BSSAP) ?\r\nbssap_pdu_type_acro_values : bsap_pdu_type_acro_values),\r\n"Unknown"));\r\nmessage_length = tvb_reported_length(tvb);\r\nexpert_add_info_format(pinfo, type_item, &ei_bssap_unknown_message, "Unknown message (%u byte%s)",\r\nmessage_length, plurality(message_length, "", "s"));\r\n}\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_bssap(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)\r\n{\r\nproto_item *bssap_item;\r\nproto_tree *bssap_tree;\r\nstruct _sccp_msg_info_t* sccp_info = (struct _sccp_msg_info_t*)data;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, ((bssap_or_bsap_global == BSSAP) ? "BSSAP" : "BSAP"));\r\nif (sccp_info && sccp_info->data.co.assoc )\r\nsccp_info->data.co.assoc->payload = SCCP_PLOAD_BSSAP;\r\nbssap_item = proto_tree_add_protocol_format(tree, proto_bssap, tvb, 0, -1,\r\n(bssap_or_bsap_global == BSSAP) ? "BSSAP" : "BSAP");\r\nbssap_tree = proto_item_add_subtree(bssap_item, ett_bssap);\r\nreturn dissect_bssap_message(tvb, pinfo, bssap_tree, tree, sccp_info);\r\n}\r\nstatic gboolean\r\ncheck_ie(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int *offset, guint8 expected_ie)\r\n{\r\nguint8 ie_type;\r\nguint8 ie_len;\r\nie_type = tvb_get_guint8(tvb, *offset);\r\nif (ie_type != expected_ie) {\r\nproto_tree_add_expert_format(tree, pinfo, &ei_bssap_mandatory_ie, tvb, *offset, 1, "Mandatory IE %s expected but IE %s Found",\r\nval_to_str_ext(expected_ie, &bssap_plus_ie_id_values_ext, "Unknown %u"),\r\nval_to_str_ext(ie_type, &bssap_plus_ie_id_values_ext, "Unknown %u"));\r\n(*offset)++;\r\nie_len = tvb_get_guint8(tvb, *offset);\r\n*offset = *offset + ie_len;\r\nreturn FALSE;\r\n}\r\nreturn TRUE;\r\n}\r\nstatic gboolean\r\ncheck_optional_ie(tvbuff_t *tvb, int offset, guint8 expected_ie)\r\n{\r\nguint8 ie_type;\r\nie_type = tvb_get_guint8(tvb, offset);\r\nif (ie_type != expected_ie) {\r\nreturn FALSE;\r\n}\r\nreturn TRUE;\r\n}\r\nstatic int\r\ndissect_bssap_cell_global_id(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nproto_item *cgi_item;\r\nproto_tree *cgi_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_cell_global_id_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_cell_global_id);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\ncgi_item = proto_tree_add_item(ie_tree, hf_bssap_cell_global_id, tvb, offset, ie_len, ENC_NA);\r\ncgi_tree = proto_item_add_subtree(cgi_item, ett_bssap_cgi);\r\nde_gmm_rai(tvb, cgi_tree, pinfo, offset, ie_len, NULL, 0);\r\noffset = offset + 6;\r\nde_cell_id(tvb, cgi_tree, pinfo, offset, ie_len, NULL, 0);\r\noffset = offset + 2;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_bssap_channel_needed(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_channel_needed_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_channel_needed);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nde_rr_chnl_needed(tvb, ie_tree, pinfo, offset, ie_len, NULL, 0);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_dlink_tunnel_payload_control_and_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\ntvbuff_t *next_tvb;\r\nguint8 ie_len;\r\nguint8 octet;\r\nguint8 prot_disc;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_dlink_tnl_pld_cntrl_amd_inf_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_dlink_tnl_pld_cntrl_amd_inf);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_tom_prot_disc, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noctet = tvb_get_guint8(tvb, offset);\r\nprot_disc = (octet&0x78)>>3;\r\nproto_tree_add_item(ie_tree, hf_bssap_e_bit, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_tunnel_prio, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nnext_tvb = tvb_new_subset_length(tvb, offset, ie_len-4);\r\nif ((prot_disc == 2)&&(rrlp_handle))\r\ncall_dissector(rrlp_handle, next_tvb, pinfo, ie_tree);\r\nelse\r\ncall_data_dissector(next_tvb, pinfo, ie_tree);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_emlpp_priority(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_emlpp_prio_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_emlpp_prio);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_call_priority, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_gprs_erroneous_msg(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_gprs_erroneous_msg_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_erroneous_msg);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_data, tvb, offset, ie_len, ENC_NA);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_gprs_location_update_type(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_gprs_loc_upd_type_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_gprs_loc_upd);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_gprs_loc_upd_type, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_Gs_cause(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_Gs_cause_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bassp_Gs_cause);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_Gs_cause, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_imei(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\ntvbuff_t *ie_tvb;\r\nconst char *digit_str;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_imei_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bassp_imei);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nie_tvb = tvb_new_subset_length(tvb, offset, ie_len);\r\ndigit_str = tvb_bcd_dig_to_wmem_packet_str(ie_tvb, 0, -1, NULL, FALSE);\r\nproto_tree_add_string(ie_tree, hf_bssap_imei, ie_tvb, 0, -1, digit_str);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_imesiv(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\ntvbuff_t *ie_tvb;\r\nconst char *digit_str;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_imesiv_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bassp_imesiv);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nie_tvb = tvb_new_subset_length(tvb, offset, ie_len);\r\ndigit_str = tvb_bcd_dig_to_wmem_packet_str(ie_tvb, 0, -1, NULL, FALSE);\r\nproto_tree_add_string(ie_tree, hf_bssap_imeisv, ie_tvb, 0, -1, digit_str);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_imsi(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\ntvbuff_t *ie_tvb;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_imsi_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_imsi);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nie_tvb = tvb_new_subset_length(tvb, offset, ie_len);\r\ndissect_e212_imsi(ie_tvb, pinfo, tree, 0, ie_len, TRUE);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_imsi_det_from_gprs_serv_type(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_imsi_det_from_gprs_serv_type_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_imsi_det_from_gprs_serv_type);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_imsi_det_from_gprs_serv_type, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_imsi_det_from_non_gprs_serv_type(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_imsi_det_from_non_gprs_serv_type_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_imsi_det_from_non_gprs_serv_type);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_data, tvb, offset, ie_len, ENC_NA);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_info_req(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_info_req_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_info_req);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_info_req, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_loc_area_id(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_loc_area_id_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_loc_area_id);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nde_lai(tvb, ie_tree, pinfo, offset, ie_len, NULL, 0);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_location_information_age(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_loc_inf_age_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_loc_inf_age);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_loc_inf_age, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_MM_information(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_mm_information_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_mm_information);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\ndtap_mm_mm_info(tvb, ie_tree, pinfo, offset, ie_len);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_mobile_id(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_mobile_id_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_mobile_id);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nde_mid(tvb, ie_tree, pinfo, offset, ie_len, NULL, 0);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_mobile_stn_cls_mrk1(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_mobile_stn_cls_mrk1_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_mobile_stn_cls_mrk1);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nde_ms_cm_1(tvb, ie_tree, pinfo, offset, ie_len, NULL, 0);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_mobile_station_state(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_mobile_station_state_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_mobile_station_state);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_mobile_station_state, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_ptmsi(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_ptmsi_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_ptmsi);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_ptmsi, tvb, offset, ie_len, ENC_NA);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_reject_cause(tvbuff_t *tvb, proto_tree *tree, packet_info *pinfo, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_reject_cause_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_reject_cause);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nde_rej_cause(tvb, ie_tree, pinfo, offset, ie_len, NULL, 0);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_service_area_id(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_service_area_id_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_service_area_id);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_data, tvb, offset, ie_len, ENC_NA);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_sgsn_number(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\ntvbuff_t *number_tvb;\r\nconst char *digit_str;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_sgsn_nr_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_sgsn_nr);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_extension, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_type_of_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_numbering_plan_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nnumber_tvb = tvb_new_subset_length(tvb, offset, ie_len-1);\r\ndigit_str = tvb_bcd_dig_to_wmem_packet_str(number_tvb, 0, -1, NULL, FALSE);\r\nproto_tree_add_string(ie_tree, hf_bssap_sgsn_number, number_tvb, 0, -1, digit_str);\r\nreturn offset + ie_len-1;\r\n}\r\nstatic int\r\ndissect_bssap_tmsi(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_tmsi_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_tmsi);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_tmsi, tvb, offset, ie_len, ENC_NA);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_tmsi_status(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_tmsi_status_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_tmsi_status);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_tmsi_status, tvb, offset, ie_len, ENC_BIG_ENDIAN);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_ulink_tunnel_payload_control_and_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\ntvbuff_t *next_tvb;\r\nguint8 ie_len;\r\nguint8 octet;\r\nguint8 prot_disc;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_ulink_tnl_pld_cntrl_amd_inf_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_ulink_tnl_pld_cntrl_amd_inf);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_tom_prot_disc, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noctet = tvb_get_guint8(tvb, offset);\r\nprot_disc = (octet&0x78)>>3;\r\nproto_tree_add_item(ie_tree, hf_bssap_e_bit, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_tunnel_prio, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nnext_tvb = tvb_new_subset_length(tvb, offset, ie_len - 4);\r\nif ((prot_disc == 2)&&(rrlp_handle))\r\ncall_dissector(rrlp_handle, next_tvb, pinfo, ie_tree);\r\nelse\r\ncall_data_dissector(next_tvb, pinfo, ie_tree);\r\nreturn offset + ie_len;\r\n}\r\nstatic int\r\ndissect_bssap_vlr_number(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nguint8 ie_len;\r\ntvbuff_t *number_tvb;\r\nconst char *digit_str;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_vlr_number_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_vlr_number);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_extension, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_type_of_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ie_tree, hf_bssap_numbering_plan_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nnumber_tvb = tvb_new_subset_length(tvb, offset, ie_len - 1);\r\ndigit_str = tvb_bcd_dig_to_wmem_packet_str(number_tvb, 0, -1, NULL, FALSE);\r\nproto_tree_add_string(ie_tree, hf_bssap_sgsn_number, number_tvb, 0, -1, digit_str);\r\nreturn offset + ie_len - 1;\r\n}\r\nstatic int\r\ndissect_bssap_global_cn_id(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *item;\r\nproto_tree *ie_tree;\r\nproto_item *plmn_item;\r\nproto_tree *plmn_tree;\r\nproto_item *global_cn_id_item;\r\nproto_tree *global_cn_id_tree;\r\nguint8 ie_len;\r\nie_len = tvb_get_guint8(tvb, offset+1);\r\nitem = proto_tree_add_item(tree, hf_bssap_global_cn_id_ie, tvb, offset, ie_len+2, ENC_NA);\r\nie_tree = proto_item_add_subtree(item, ett_bssap_global_cn);\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ie_tree, hf_bssap_plus_ie_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nglobal_cn_id_item = proto_tree_add_item(ie_tree, hf_bssap_global_cn_id, tvb, offset, ie_len, ENC_NA);\r\nglobal_cn_id_tree = proto_item_add_subtree(global_cn_id_item, ett_bssap_global_cn_id);\r\nplmn_item = proto_tree_add_item(global_cn_id_tree, hf_bssap_plmn_id, tvb, offset, 3, ENC_NA);\r\nplmn_tree = proto_item_add_subtree(plmn_item, ett_bssap_plmn);\r\ndissect_e212_mcc_mnc(tvb, pinfo, plmn_tree, offset, E212_NONE, TRUE);\r\noffset = offset + 3;\r\nproto_tree_add_item(global_cn_id_tree, hf_bssap_cn_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset = offset+2;\r\nreturn offset;\r\n}\r\nstatic int dissect_bssap_plus(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nproto_item *bssap_item;\r\nproto_tree *bssap_tree;\r\nguint8 message_type;\r\nint offset = 0;\r\nstruct _sccp_msg_info_t* sccp_info = (struct _sccp_msg_info_t*)data;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "BSSAP+");\r\nif (sccp_info && sccp_info->data.co.assoc)\r\nsccp_info->data.co.assoc->payload = SCCP_PLOAD_BSSAP;\r\nbssap_item = proto_tree_add_item(tree, proto_bssap, tvb, 0, -1, ENC_NA);\r\nbssap_tree = proto_item_add_subtree(bssap_item, ett_bssap);\r\nmessage_type = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(bssap_tree, hf_bssap_plus_message_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str_ext(message_type, &bssap_plus_message_type_values_ext, "Unknown %u"));\r\nswitch (message_type) {\r\ncase BSSAP_PAGING_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_VLR_NUMBER))\r\noffset = dissect_bssap_vlr_number(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_TMSI))\r\noffset = dissect_bssap_tmsi(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_LOC_AREA_ID))\r\noffset = dissect_bssap_loc_area_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CHANNEL_NEEDED))\r\noffset = dissect_bssap_channel_needed(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_EMLPP_PRIORITY))\r\noffset = dissect_bssap_emlpp_priority(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_GLOBAL_CN_ID))\r\noffset = dissect_bssap_global_cn_id(tvb, pinfo, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_PAGING_REJECT:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_GS_CAUSE))\r\noffset = dissect_bssap_Gs_cause(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_DOWNLINK_TUNNEL_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_VLR_NUMBER))\r\noffset = dissect_bssap_vlr_number(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_DLINK_TNL_PLD_CTR_AND_INF))\r\noffset = dissect_bssap_dlink_tunnel_payload_control_and_info(tvb, pinfo, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_UPLINK_TUNNEL_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_SGSN_NUMBER))\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_ULINK_TNL_PLD_CTR_AND_INF))\r\noffset = dissect_bssap_ulink_tunnel_payload_control_and_info(tvb, pinfo, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_LOCATION_UPDATE_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_SGSN_NUMBER))\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_GPRS_LOC_UPD_TYPE))\r\noffset = dissect_bssap_gprs_location_update_type(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_MOBILE_STN_CLS_MRK1))\r\noffset = dissect_bssap_mobile_stn_cls_mrk1(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_LOC_AREA_ID))\r\noffset = dissect_bssap_loc_area_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_TMSI_STATUS))\r\noffset = dissect_bssap_tmsi_status(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_IMEISV))\r\noffset = dissect_bssap_imesiv(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_LOCATION_UPDATE_ACCEPT:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_LOC_AREA_ID))\r\noffset = dissect_bssap_loc_area_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_MOBILE_ID))\r\noffset = dissect_bssap_mobile_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_LOCATION_UPDATE_REJECT:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_REJECT_CAUSE))\r\noffset = dissect_bssap_reject_cause(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_TMSI_REALLOCATION_COMPLETE:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_ALERT_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_ALERT_ACK:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_ALERT_REJECT:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_GS_CAUSE))\r\noffset = dissect_bssap_Gs_cause(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MS_ACTIVITY_INDICATION:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_GPRS_DETACH_INDICATION:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_SGSN_NUMBER))\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI_DET_FROM_GPRS_SERV_TYPE))\r\noffset = dissect_bssap_imsi_det_from_gprs_serv_type(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_GPRS_DETACH_ACK:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_IMSI_DETACH_INDICATION:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_SGSN_NUMBER))\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI_DET_FROM_NON_GPRS_SERV_TYPE))\r\noffset = dissect_bssap_imsi_det_from_non_gprs_serv_type(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_LOC_INF_AGE))\r\noffset = dissect_bssap_location_information_age(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_IMSI_DETACH_ACK:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_RESET_INDICATION:\r\nif (check_optional_ie(tvb, offset, BSSAP_SGSN_NUMBER)) {\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\n}else{\r\nif (check_optional_ie(tvb, offset, BSSAP_VLR_NUMBER)) {\r\noffset = dissect_bssap_vlr_number(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\n}\r\n}\r\nproto_tree_add_item(tree, hf_bssap_conditional_ie, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_RESET_ACK:\r\nif (check_optional_ie(tvb, offset, BSSAP_SGSN_NUMBER)) {\r\noffset = dissect_bssap_sgsn_number(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\n}else{\r\nif (check_optional_ie(tvb, offset, BSSAP_VLR_NUMBER)) {\r\noffset = dissect_bssap_vlr_number(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\n}\r\n}\r\nproto_tree_add_item(tree, hf_bssap_conditional_ie, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MS_INFORMATION_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_INFO_REQ))\r\noffset = dissect_bssap_info_req(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MS_INFORMATION_RESPONSE:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_TMSI))\r\noffset = dissect_bssap_tmsi(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_PTMSI))\r\noffset = dissect_bssap_ptmsi(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_IMEI))\r\noffset = dissect_bssap_imei(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_IMEISV))\r\noffset = dissect_bssap_imesiv(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_CELL_GBL_ID))\r\noffset = dissect_bssap_cell_global_id(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_LOC_INF_AGE))\r\noffset = dissect_bssap_location_information_age(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_MOBILE_STN_STATE))\r\noffset = dissect_bssap_mobile_station_state(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_SERVICE_AREA_ID))\r\noffset = dissect_bssap_service_area_id(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MM_INFORMATION_REQUEST:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nif (check_optional_ie(tvb, offset, BSSAP_MM_INFORMATION))\r\noffset = dissect_bssap_MM_information(tvb, bssap_tree, pinfo, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MOBILE_STATUS:\r\nif (check_optional_ie(tvb, offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_GS_CAUSE))\r\noffset = dissect_bssap_Gs_cause(tvb, bssap_tree, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_ERRONEOUS_MSG))\r\noffset = dissect_bssap_gprs_erroneous_msg(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ncase BSSAP_MS_UNREACHABLE:\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_IMSI))\r\noffset = dissect_bssap_imsi(tvb, bssap_tree, pinfo, offset);\r\nif (check_ie(tvb, pinfo, tree, &offset, BSSAP_GS_CAUSE))\r\noffset = dissect_bssap_Gs_cause(tvb, bssap_tree, offset);\r\nif (tvb_reported_length_remaining(tvb, offset) <= 0)\r\nreturn tvb_reported_length(tvb);\r\nproto_tree_add_item(tree, hf_bssap_extraneous_data, tvb, offset, -1, ENC_NA);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic gboolean\r\ndissect_bssap_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)\r\n{\r\nswitch (tvb_get_guint8(tvb, 0))\r\n{\r\ncase 0x00:\r\nif (tvb_get_guint8(tvb, 1) != (tvb_reported_length(tvb) - 2)) {\r\nreturn(FALSE);\r\n}\r\nif (tvb_get_guint8(tvb, 2) == 0x40 && tvb_get_guint8(tvb, 3) != 0x01) {\r\nreturn(FALSE);\r\n}\r\nbreak;\r\ncase 0x01:\r\nif (tvb_get_guint8(tvb, 2) != (tvb_reported_length(tvb) - 3)) {\r\nreturn(FALSE);\r\n}\r\nbreak;\r\ndefault:\r\nreturn(FALSE);\r\n}\r\ndissect_bssap(tvb, pinfo, tree, data);\r\nreturn(TRUE);\r\n}\r\nvoid\r\nproto_register_bssap(void)\r\n{\r\nmodule_t *bssap_module;\r\nexpert_module_t* expert_bssap;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_bssap_pdu_type,\r\n{ "Message Type", "bssap.pdu_type",\r\nFT_UINT8, BASE_HEX, VALS(bssap_pdu_type_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bsap_pdu_type,\r\n{ "Message Type", "bsap.pdu_type",\r\nFT_UINT8, BASE_HEX, VALS(bsap_pdu_type_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_dlci_cc,\r\n{ "Control Channel", "bssap.dlci.cc",\r\nFT_UINT8, BASE_HEX, VALS(bssap_cc_values), CC_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bsap_dlci_cc,\r\n{ "Control Channel", "bsap.dlci.cc",\r\nFT_UINT8, BASE_HEX, VALS(bsap_cc_values), CC_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bssap_dlci_spare,\r\n{ "Spare", "bssap.dlci.spare",\r\nFT_UINT8, BASE_HEX, NULL, SPARE_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bsap_dlci_rsvd,\r\n{ "Reserved", "bsap.dlci.rsvd",\r\nFT_UINT8, BASE_HEX, NULL, SPARE_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bssap_dlci_sapi,\r\n{ "SAPI", "bssap.dlci.sapi",\r\nFT_UINT8, BASE_HEX, VALS(bssap_sapi_values), SAPI_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bsap_dlci_sapi,\r\n{ "SAPI", "bsap.dlci.sapi",\r\nFT_UINT8, BASE_HEX, VALS(bsap_sapi_values), SAPI_MASK,\r\nNULL, HFILL}},\r\n{ &hf_bssap_length,\r\n{ "Length", "bssap.length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_plus_message_type,\r\n{ "Message Type", "bssap_plus.msg_type",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &bssap_plus_message_type_values_ext, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_plus_ie,\r\n{ "IEI", "bssap_plus.iei",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &bssap_plus_ie_id_values_ext, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_plus_ie_len,\r\n{ "Length indicator", "bssap_plus.ie_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_extension,\r\n{ "Extension", "bssap.extension",\r\nFT_BOOLEAN, 8, TFS(&bssap_extension_value), 0x80,\r\nNULL, HFILL }},\r\n{ &hf_bssap_type_of_number,\r\n{ "Type of number", "bssap.type_of_number",\r\nFT_UINT8, BASE_HEX, VALS(gsm_a_dtap_type_of_number_values), 0x70,\r\nNULL, HFILL }},\r\n{ &hf_bssap_numbering_plan_id,\r\n{ "Numbering plan identification", "bssap.number_plan",\r\nFT_UINT8, BASE_HEX, VALS(gsm_a_dtap_numbering_plan_id_values), 0x0f,\r\nNULL, HFILL }},\r\n{ &hf_bssap_sgsn_number,\r\n{ "SGSN number", "bssap.sgsn_number",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_bssap_vlr_number,\r\n{ "VLR number", "bssap.vlr_number",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#endif\r\n{ &hf_bssap_cell_global_id_ie,\r\n{ "Cell global identity IE", "bssap.cell_global_id_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_channel_needed_ie,\r\n{ "Channel needed IE", "bssap.channel_needed_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_dlink_tnl_pld_cntrl_amd_inf_ie,\r\n{ "Downlink Tunnel Payload Control and Info IE", "bssap.dlink_tnl_pld_cntrl_amd_inf_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_ulink_tnl_pld_cntrl_amd_inf_ie,\r\n{ "Uplink Tunnel Payload Control and Info IE", "bssap.ulink_tnl_pld_cntrl_amd_inf_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_emlpp_prio_ie,\r\n{ "eMLPP Priority IE", "bssap.emlpp_prio_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_gprs_erroneous_msg_ie,\r\n{ "Erroneous message IE", "bssap.erroneous_msg_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_gprs_loc_upd_type_ie,\r\n{ "GPRS location update type IE", "bssap.loc_upd_type_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_Gs_cause_ie,\r\n{ "Gs Cause IE", "bssap.Gs_cause_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imei_ie,\r\n{ "IMEI IE", "bssap.imei_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imesiv_ie,\r\n{ "IMEISV IE", "bssap.imesiv",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imsi_ie,\r\n{ "IMSI IE", "bssap.imsi_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imsi_det_from_gprs_serv_type_ie,\r\n{ "IMSI detach from GPRS service type IE", "bssap.msi_det_from_gprs_serv_type_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imsi_det_from_non_gprs_serv_type_ie,\r\n{ "IMSI detach from non-GPRS service IE", "bssap.msi_det_from_non_gprs_serv_type_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_info_req_ie,\r\n{ "Information requested IE", "bssap.info_req_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_loc_area_id_ie,\r\n{ "Location area identifier IE", "bssap.loc_area_id_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_loc_inf_age_ie,\r\n{ "Location information age IE", "bssap.loc_inf_age_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_mm_information_ie,\r\n{ "MM information IE", "bssap.mm_information",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_mobile_id_ie,\r\n{ "Mobile identity IE", "bssap.mobile_id_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_mobile_stn_cls_mrk1_ie,\r\n{ "Mobile station classmark 1 IE", "bssap.mobile_stn_cls_mrk1_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_mobile_station_state_ie,\r\n{ "Mobile station state IE", "bssap.mobile_station_state_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_ptmsi_ie,\r\n{ "PTMSI IE", "bssap.ptmsi_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_reject_cause_ie,\r\n{ "Reject cause IE", "bssap.reject_cause_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_service_area_id_ie,\r\n{ "Service area identification IE", "bssap.service_area_id_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Mobile station classmark 1", HFILL }},\r\n{ &hf_bssap_sgsn_nr_ie,\r\n{ "SGSN number IE", "bssap.sgsn_nr_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_tmsi_ie,\r\n{ "TMSI IE", "bssap.tmsi_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_tmsi_status_ie,\r\n{ "TMSI status IE", "bssap.tmsi_status_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_vlr_number_ie,\r\n{ "VLR number IE", "bssap.vlr_number_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_global_cn_id_ie,\r\n{ "Global CN-Id IE", "bssap.global_cn_id_ie",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_plus_ie_data,\r\n{ "IE Data", "bssap.ie_data",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_call_priority,\r\n{ "eMLPP Priority", "bssap.call_priority",\r\nFT_UINT8, BASE_DEC, VALS(bssap_call_priority_values), 0x07,\r\nNULL, HFILL}},\r\n{ &hf_bssap_gprs_loc_upd_type,\r\n{ "GPRS location update type", "bssap.gprs_loc_upd_type",\r\nFT_UINT8, BASE_DEC, VALS(bssap_plus_GPRS_loc_upd_type_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_Gs_cause,\r\n{ "Gs cause", "bssap.Gs_cause",\r\nFT_UINT8, BASE_DEC, VALS(bssap_Gs_cause_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_imei,\r\n{ "IMEI", "bssap.imei",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imeisv,\r\n{ "IMEISV", "bssap.imeisv",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_bssap_imsi_det_from_gprs_serv_type,\r\n{ "IMSI detach from GPRS service type", "bssap.imsi_det_from_gprs_serv_type",\r\nFT_UINT8, BASE_DEC, VALS(bssap_Gs_cause_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_info_req,\r\n{ "Information requested", "bssap.info_req",\r\nFT_UINT8, BASE_DEC, VALS(bssap_info_req_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_loc_inf_age,\r\n{ "AgeOfLocationInformation in minutes", "bssap.loc_inf_age",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_mobile_station_state,\r\n{ "Mobile station state", "bssap.mobile_station_state",\r\nFT_UINT8, BASE_DEC, VALS(bssap_mobile_station_state_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_ptmsi,\r\n{ "PTMSI", "bssap.ptmsi",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_tmsi,\r\n{ "TMSI", "bssap.tmsi",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_tmsi_status,\r\n{ "TMSI status", "bssap.tmsi_status",\r\nFT_BOOLEAN, 8, TFS(&bssap_tmsi_flag), 0x01,\r\nNULL, HFILL }},\r\n{ &hf_bssap_tom_prot_disc,\r\n{ "TOM Protocol Discriminator", "bssap.Tom_prot_disc",\r\nFT_UINT8, BASE_DEC, VALS(bssap_tom_prot_disc_values), 0x78,\r\nNULL, HFILL}},\r\n{ &hf_bssap_e_bit,\r\n{ "E: Cipher Request", "bssap.e_bit",\r\nFT_BOOLEAN, 8, TFS(&bssap_E_flag), 0x04,\r\nNULL, HFILL }},\r\n{ &hf_bssap_tunnel_prio,\r\n{ "Tunnel Priority", "bssap.tunnel_prio",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_global_cn_id,\r\n{ "Global CN-Id", "bssap.global_cn_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_plmn_id,\r\n{ "PLMN-Id", "bssap.plmn_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_cn_id,\r\n{ "CN-Id", "bssap.cn_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_cell_global_id,\r\n{ "Cell global identity", "bssap.cell_global_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_extraneous_data,\r\n{ "Extraneous data", "bssap.extraneous_data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_bssap_conditional_ie,\r\n{ "Conditional IE", "bssap.conditional_ie",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_bssap,\r\n&ett_bssap_dlci,\r\n&ett_bssap_imsi,\r\n&ett_bssap_imsi_det_from_gprs_serv_type,\r\n&ett_bssap_imsi_det_from_non_gprs_serv_type,\r\n&ett_bssap_info_req,\r\n&ett_bssap_loc_area_id,\r\n&ett_bssap_loc_inf_age,\r\n&ett_bssap_mm_information,\r\n&ett_bssap_mobile_id,\r\n&ett_bssap_sgsn_nr,\r\n&ett_bssap_tmsi,\r\n&ett_bssap_tmsi_status,\r\n&ett_bssap_vlr_number,\r\n&ett_bssap_global_cn,\r\n&ett_bssap_gprs_loc_upd,\r\n&ett_bassp_Gs_cause,\r\n&ett_bassp_imei,\r\n&ett_bassp_imesiv,\r\n&ett_bssap_cell_global_id,\r\n&ett_bssap_cgi,\r\n&ett_bssap_channel_needed,\r\n&ett_bssap_dlink_tnl_pld_cntrl_amd_inf,\r\n&ett_bssap_ulink_tnl_pld_cntrl_amd_inf,\r\n&ett_bssap_emlpp_prio,\r\n&ett_bssap_erroneous_msg,\r\n&ett_bssap_mobile_stn_cls_mrk1,\r\n&ett_bssap_mobile_station_state,\r\n&ett_bssap_ptmsi,\r\n&ett_bssap_reject_cause,\r\n&ett_bssap_service_area_id,\r\n&ett_bssap_global_cn_id,\r\n&ett_bssap_plmn,\r\n};\r\nstatic const enum_val_t gsm_or_lb_interface_options[] = {\r\n{ "gsm a", "GSM A", GSM_INTERFACE },\r\n{ "lb", "Lb", LB_INTERFACE },\r\n{ NULL, NULL, 0 }\r\n};\r\nstatic const enum_val_t bssap_or_bsap_options[] = {\r\n{ "bssap", "BSSAP", BSSAP },\r\n{ "bsap", "BSAP", BSAP },\r\n{ NULL, NULL, 0 }\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_bssap_unknown_message, { "bssap.unknown_message", PI_PROTOCOL, PI_WARN, "Unknown message", EXPFILL }},\r\n{ &ei_bssap_unknown_parameter, { "bssap.unknown_parameter", PI_PROTOCOL, PI_WARN, "Unknown parameter", EXPFILL }},\r\n{ &ei_bssap_mandatory_ie, { "bssap.mandatory_ie", PI_PROTOCOL, PI_WARN, "Mandatory IE expected", EXPFILL }},\r\n};\r\nproto_bssap = proto_register_protocol("BSSAP/BSAP", "BSSAP", "bssap");\r\nproto_bssap_plus = proto_register_protocol("BSSAP2", "BSSAP2", "bssap_plus");\r\nregister_dissector("bssap", dissect_bssap, proto_bssap);\r\nregister_dissector("bssap_plus", dissect_bssap_plus, proto_bssap_plus);\r\nproto_register_field_array(proto_bssap, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_bssap = expert_register_protocol(proto_bssap);\r\nexpert_register_field_array(expert_bssap, ei, array_length(ei));\r\nbssap_module = prefs_register_protocol(proto_bssap, proto_reg_handoff_bssap);\r\nprefs_register_enum_preference(bssap_module,\r\n"bsap_or_bssap",\r\n"Identify to sub-dissector as",\r\n"For the sake of sub-dissectors registering to accept data "\r\n"from the BSSAP/BSAP dissector, this defines whether it is "\r\n"identified as BSSAP or BSAP.",\r\n&bssap_or_bsap_global,\r\nbssap_or_bsap_options,\r\nFALSE);\r\nprefs_register_enum_preference(bssap_module,\r\n"gsm_or_lb_interface",\r\n"Identify the BSSAP interface",\r\n"GSM-A is the interface between the BSC and the MSC. Lb is the interface between the BSC and the SMLC.",\r\n&gsm_or_lb_interface_global,\r\ngsm_or_lb_interface_options,\r\nFALSE);\r\nprefs_register_uint_preference(bssap_module, "ssn",\r\n"Subsystem number used for BSSAP",\r\n"Set Subsystem number used for BSSAP/BSSAP+",\r\n10, &global_bssap_ssn);\r\nbssap_dissector_table = register_dissector_table("bssap.pdu_type", "BSSAP Message Type", proto_bssap, FT_UINT8, BASE_DEC);\r\nbsap_dissector_table = register_dissector_table("bsap.pdu_type", "BSAP Message Type", proto_bssap, FT_UINT8, BASE_DEC);\r\n}\r\nvoid\r\nproto_reg_handoff_bssap(void)\r\n{\r\nstatic gboolean initialized = FALSE;\r\nstatic dissector_handle_t bssap_plus_handle;\r\nstatic guint old_bssap_ssn;\r\nif (!initialized) {\r\nheur_dissector_add("sccp", dissect_bssap_heur, "BSSAP over SCCP", "bssap_sccp", proto_bssap, HEURISTIC_ENABLE);\r\nheur_dissector_add("sua", dissect_bssap_heur, "BSSAP over SUA", "bssap_sua", proto_bssap, HEURISTIC_ENABLE);\r\nbssap_plus_handle = create_dissector_handle(dissect_bssap_plus, proto_bssap);\r\nrrlp_handle = find_dissector_add_dependency("rrlp", proto_bssap_plus);\r\ngsm_bssmap_le_dissector_handle = find_dissector_add_dependency("gsm_bssmap_le", proto_bssap);\r\ngsm_a_bssmap_dissector_handle = find_dissector_add_dependency("gsm_a_bssmap", proto_bssap);\r\ninitialized = TRUE;\r\n} else {\r\ndissector_delete_uint("sccp.ssn", old_bssap_ssn, bssap_plus_handle);\r\n}\r\ndissector_add_uint("sccp.ssn", global_bssap_ssn, bssap_plus_handle);\r\nold_bssap_ssn = global_bssap_ssn;\r\n}
