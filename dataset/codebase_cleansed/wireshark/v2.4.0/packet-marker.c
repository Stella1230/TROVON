static int\r\ndissect_marker(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 raw_octet;\r\nproto_tree *marker_tree;\r\nproto_item *marker_item;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "Marker");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Marker Protocol");\r\nif (tree)\r\n{\r\nmarker_item = proto_tree_add_protocol_format(tree, proto_marker, tvb,\r\n0, -1, "Marker Protocol");\r\nmarker_tree = proto_item_add_subtree(marker_item, ett_marker);\r\nproto_tree_add_item(marker_tree, hf_marker_version_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nwhile (1)\r\n{\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nif (raw_octet == MARKERPDU_END_MARKER)\r\nbreak;\r\nproto_tree_add_uint(marker_tree, hf_marker_tlv_type, tvb,\r\noffset, 1, raw_octet);\r\noffset += 1;\r\nproto_tree_add_item(marker_tree, hf_marker_tlv_length, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(marker_tree, hf_marker_req_port, tvb,\r\noffset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(marker_tree, hf_marker_req_system, tvb,\r\noffset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(marker_tree, hf_marker_req_trans_id, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset += 2;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_marker(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_marker_version_number,\r\n{ "Version Number", "marker.version",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"Marker protocol version", HFILL }},\r\n{ &hf_marker_tlv_type,\r\n{ "TLV Type", "marker.tlvType",\r\nFT_UINT8, BASE_HEX, VALS(marker_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_marker_tlv_length,\r\n{ "TLV Length", "marker.tlvLen",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"Length of the Actor TLV", HFILL }},\r\n{ &hf_marker_req_port,\r\n{ "Requester Port", "marker.requesterPort",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_marker_req_system,\r\n{ "Requester System", "marker.requesterSystem",\r\nFT_ETHER, BASE_NONE, NULL, 0x0,\r\n"Requester System ID encoded as a MAC address", HFILL }},\r\n{ &hf_marker_req_trans_id,\r\n{ "Requester Transaction ID", "marker.requesterTransId",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_marker,\r\n};\r\nproto_marker = proto_register_protocol("Marker", "Link Aggregation Marker Protocol", "marker");\r\nproto_register_field_array(proto_marker, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_marker(void)\r\n{\r\ndissector_handle_t marker_handle;\r\nmarker_handle = create_dissector_handle(dissect_marker, proto_marker);\r\ndissector_add_uint("slow.subtype", MARKER_SUBTYPE, marker_handle);\r\n}
