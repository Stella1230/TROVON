int\r\nws_xton(char ch)\r\n{\r\nswitch (ch) {\r\ncase '0': return 0;\r\ncase '1': return 1;\r\ncase '2': return 2;\r\ncase '3': return 3;\r\ncase '4': return 4;\r\ncase '5': return 5;\r\ncase '6': return 6;\r\ncase '7': return 7;\r\ncase '8': return 8;\r\ncase '9': return 9;\r\ncase 'a': case 'A': return 10;\r\ncase 'b': case 'B': return 11;\r\ncase 'c': case 'C': return 12;\r\ncase 'd': case 'D': return 13;\r\ncase 'e': case 'E': return 14;\r\ncase 'f': case 'F': return 15;\r\ndefault: return -1;\r\n}\r\n}\r\ngchar *\r\nascii_strdown_inplace(gchar *str)\r\n{\r\ngchar *s;\r\nfor (s = str; *s; s++)\r\n*s = g_ascii_isupper (*s) ? *s - 'A' + 'a' : *s;\r\nreturn (str);\r\n}\r\ngchar *\r\nascii_strup_inplace(gchar *str)\r\n{\r\ngchar *s;\r\nfor (s = str; *s; s++)\r\n*s = g_ascii_islower (*s) ? *s - 'a' + 'A' : *s;\r\nreturn (str);\r\n}\r\ngboolean\r\nisprint_string(const gchar *str)\r\n{\r\nguint pos;\r\nfor(pos = 0; str[pos] != '\0'; pos++){\r\nif(!g_ascii_isprint(str[pos])){\r\nreturn FALSE;\r\n}\r\n}\r\nreturn TRUE;\r\n}\r\ngboolean\r\nisdigit_string(guchar *str)\r\n{\r\nguint pos;\r\nfor(pos = 0; str[pos] != '\0'; pos++){\r\nif(!g_ascii_isdigit(str[pos])){\r\nreturn FALSE;\r\n}\r\n}\r\nreturn TRUE;\r\n}\r\ngchar *\r\nformat_size(gint64 size, format_size_flags_e flags)\r\n{\r\nGString *human_str = g_string_new("");\r\nint power = 1000;\r\nint pfx_off = 0;\r\ngboolean is_small = FALSE;\r\nstatic const gchar *prefix[] = {"T", "G", "M", "k", "Ti", "Gi", "Mi", "Ki"};\r\ngchar *ret_val;\r\nif ((flags & FORMAT_SIZE_PFX_MASK) == format_size_prefix_iec) {\r\npfx_off = 4;\r\npower = 1024;\r\n}\r\nDIAG_OFF(format)\r\nif (size / power / power / power / power >= 10) {\r\ng_string_printf(human_str, "%" GROUP_FLAG G_GINT64_MODIFIER "d %s", size / power / power / power / power, prefix[pfx_off]);\r\n} else if (size / power / power / power >= 10) {\r\ng_string_printf(human_str, "%" GROUP_FLAG G_GINT64_MODIFIER "d %s", size / power / power / power, prefix[pfx_off+1]);\r\n} else if (size / power / power >= 10) {\r\ng_string_printf(human_str, "%" GROUP_FLAG G_GINT64_MODIFIER "d %s", size / power / power, prefix[pfx_off+2]);\r\n} else if (size / power >= 10) {\r\ng_string_printf(human_str, "%" GROUP_FLAG G_GINT64_MODIFIER "d %s", size / power, prefix[pfx_off+3]);\r\n} else {\r\ng_string_printf(human_str, "%" GROUP_FLAG G_GINT64_MODIFIER "d", size);\r\nis_small = TRUE;\r\n}\r\nDIAG_ON(format)\r\nswitch (flags & FORMAT_SIZE_UNIT_MASK) {\r\ncase format_size_unit_none:\r\nbreak;\r\ncase format_size_unit_bytes:\r\ng_string_append(human_str, is_small ? " bytes" : "B");\r\nbreak;\r\ncase format_size_unit_bits:\r\ng_string_append(human_str, is_small ? " bits" : "b");\r\nbreak;\r\ncase format_size_unit_bits_s:\r\ng_string_append(human_str, is_small ? " bits/s" : "bps");\r\nbreak;\r\ncase format_size_unit_bytes_s:\r\ng_string_append(human_str, is_small ? " bytes/s" : "Bps");\r\nbreak;\r\ncase format_size_unit_packets:\r\ng_string_append(human_str, is_small ? " packets" : "packets");\r\nbreak;\r\ncase format_size_unit_packets_s:\r\ng_string_append(human_str, is_small ? " packets/s" : "packets/s");\r\nbreak;\r\ndefault:\r\ng_assert_not_reached();\r\n}\r\nret_val = g_string_free(human_str, FALSE);\r\nreturn g_strchomp(ret_val);\r\n}\r\ngchar\r\nprintable_char_or_period(gchar c)\r\n{\r\nreturn g_ascii_isprint(c) ? c : '.';\r\n}
