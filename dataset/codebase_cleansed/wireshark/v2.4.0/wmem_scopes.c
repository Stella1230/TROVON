wmem_allocator_t *\r\nwmem_packet_scope(void)\r\n{\r\ng_assert(packet_scope);\r\nreturn packet_scope;\r\n}\r\nvoid\r\nwmem_enter_packet_scope(void)\r\n{\r\ng_assert(packet_scope);\r\ng_assert(file_scope->in_scope);\r\ng_assert(!packet_scope->in_scope);\r\npacket_scope->in_scope = TRUE;\r\n}\r\nvoid\r\nwmem_leave_packet_scope(void)\r\n{\r\ng_assert(packet_scope);\r\ng_assert(packet_scope->in_scope);\r\nwmem_free_all(packet_scope);\r\npacket_scope->in_scope = FALSE;\r\n}\r\nwmem_allocator_t *\r\nwmem_file_scope(void)\r\n{\r\ng_assert(file_scope);\r\nreturn file_scope;\r\n}\r\nvoid\r\nwmem_enter_file_scope(void)\r\n{\r\ng_assert(file_scope);\r\ng_assert(!file_scope->in_scope);\r\nfile_scope->in_scope = TRUE;\r\n}\r\nvoid\r\nwmem_leave_file_scope(void)\r\n{\r\ng_assert(file_scope);\r\ng_assert(file_scope->in_scope);\r\ng_assert(!packet_scope->in_scope);\r\nwmem_free_all(file_scope);\r\nfile_scope->in_scope = FALSE;\r\nwmem_gc(file_scope);\r\nwmem_gc(packet_scope);\r\n}\r\nwmem_allocator_t *\r\nwmem_epan_scope(void)\r\n{\r\ng_assert(epan_scope);\r\nreturn epan_scope;\r\n}\r\nvoid\r\nwmem_init_scopes(void)\r\n{\r\ng_assert(packet_scope == NULL);\r\ng_assert(file_scope == NULL);\r\ng_assert(epan_scope == NULL);\r\npacket_scope = wmem_allocator_new(WMEM_ALLOCATOR_BLOCK_FAST);\r\nfile_scope = wmem_allocator_new(WMEM_ALLOCATOR_BLOCK);\r\nepan_scope = wmem_allocator_new(WMEM_ALLOCATOR_BLOCK);\r\npacket_scope->in_scope = FALSE;\r\nfile_scope->in_scope = FALSE;\r\n}\r\nvoid\r\nwmem_cleanup_scopes(void)\r\n{\r\ng_assert(packet_scope);\r\ng_assert(file_scope);\r\ng_assert(epan_scope);\r\ng_assert(packet_scope->in_scope == FALSE);\r\ng_assert(file_scope->in_scope == FALSE);\r\nwmem_destroy_allocator(packet_scope);\r\nwmem_destroy_allocator(file_scope);\r\nwmem_destroy_allocator(epan_scope);\r\npacket_scope = NULL;\r\nfile_scope = NULL;\r\nepan_scope = NULL;\r\n}
