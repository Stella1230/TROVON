static int dissect_aim_chat_userinfo_list(tvbuff_t *tvb, packet_info *pinfo, proto_tree *chat_tree)\r\n{\r\nint offset = 0;\r\nwhile(tvb_reported_length_remaining(tvb, offset) > 0) {\r\noffset = dissect_aim_userinfo(tvb, pinfo, offset, chat_tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_chat_outgoing_msg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *chat_tree _U_)\r\n{\r\nguint8 *buddyname;\r\nguchar *msg;\r\nint buddyname_length;\r\nmsg=(guchar *)wmem_alloc(wmem_packet_scope(), 1000);\r\nbuddyname_length = aim_get_buddyname( &buddyname, tvb, 30 );\r\naim_get_message( msg, tvb, 40 + buddyname_length, tvb_reported_length(tvb)\r\n- 40 - buddyname_length );\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s", msg);\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic int dissect_aim_chat_incoming_msg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *chat_tree)\r\n{\r\nguint8 *buddyname;\r\nguchar *msg;\r\nint buddyname_length;\r\nmsg=(guchar *)wmem_alloc(wmem_packet_scope(), 1000);\r\nbuddyname_length = aim_get_buddyname( &buddyname, tvb, 30 );\r\naim_get_message( msg, tvb, 36 + buddyname_length, tvb_reported_length(tvb)\r\n- 36 - buddyname_length );\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "from: %s", buddyname);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s", msg);\r\nproto_tree_add_string(chat_tree, hf_aim_chat_screen_name, tvb, 31, buddyname_length, buddyname);\r\nreturn tvb_reported_length(tvb);\r\n}\r\nvoid\r\nproto_register_aim_chat(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_aim_chat_screen_name,\r\n{ "Screen Name", "aim_chat.screen_name", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_aim_chat,\r\n};\r\nproto_aim_chat = proto_register_protocol("AIM Chat Service", "AIM Chat", "aim_chat");\r\nproto_register_field_array(proto_aim_chat, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_aim_chat(void)\r\n{\r\naim_init_family(proto_aim_chat, ett_aim_chat, FAMILY_CHAT, aim_fnac_family_chat);\r\n}
