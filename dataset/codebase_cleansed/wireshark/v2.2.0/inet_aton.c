int\r\ninet_aton(cp_arg, addr)\r\nconst char *cp_arg;\r\nstruct in_addr *addr;\r\n{\r\nregister const u_char *cp = cp_arg;\r\nregister u_long val;\r\nregister int base;\r\nregister size_t n;\r\nregister u_char c;\r\nu_int parts[4];\r\nregister u_int *pp = parts;\r\nfor (;;) {\r\nval = 0; base = 10;\r\nif (*cp == '0') {\r\nif (*++cp == 'x' || *cp == 'X')\r\nbase = 16, cp++;\r\nelse\r\nbase = 8;\r\n}\r\nwhile ((c = *cp) != '\0') {\r\nif (isascii(c) && isdigit(c)) {\r\nval = (val * base) + (c - '0');\r\ncp++;\r\ncontinue;\r\n}\r\nif (base == 16 && isascii(c) && isxdigit(c)) {\r\nval = (val << 4) +\r\n(c + 10 - (islower(c) ? 'a' : 'A'));\r\ncp++;\r\ncontinue;\r\n}\r\nbreak;\r\n}\r\nif (*cp == '.') {\r\nif (pp >= parts + 3 || val > 0xff)\r\nreturn (0);\r\n*pp++ = val, cp++;\r\n} else\r\nbreak;\r\n}\r\nif (*cp && (!isascii(*cp) || !isspace(*cp)))\r\nreturn (0);\r\nn = pp - parts + 1;\r\nswitch (n) {\r\ncase 1:\r\nbreak;\r\ncase 2:\r\nif (val > 0xffffff)\r\nreturn (0);\r\nval |= parts[0] << 24;\r\nbreak;\r\ncase 3:\r\nif (val > 0xffff)\r\nreturn (0);\r\nval |= (parts[0] << 24) | (parts[1] << 16);\r\nbreak;\r\ncase 4:\r\nif (val > 0xff)\r\nreturn (0);\r\nval |= (parts[0] << 24) | (parts[1] << 16) | (parts[2] << 8);\r\nbreak;\r\n}\r\nif (addr)\r\naddr->s_addr = htonl(val);\r\nreturn (1);\r\n}
