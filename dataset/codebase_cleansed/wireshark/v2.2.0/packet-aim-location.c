static int dissect_aim_location_rightsinfo(tvbuff_t *tvb, packet_info *pinfo, proto_tree *loc_tree)\r\n{\r\nreturn dissect_aim_tlv_sequence(tvb, pinfo, 0, loc_tree, aim_location_rights_tlvs);\r\n}\r\nstatic int dissect_aim_location_setuserinfo(tvbuff_t *tvb, packet_info *pinfo, proto_tree *loc_tree)\r\n{\r\nreturn dissect_aim_tlv_sequence(tvb, pinfo, 0, loc_tree, aim_locate_tags_tlvs);\r\n}\r\nstatic int dissect_aim_location_watcher_notification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *loc_tree)\r\n{\r\nint offset = 0;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\noffset = dissect_aim_buddyname(tvb, pinfo, offset, loc_tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_location_user_info_query(tvbuff_t *tvb, packet_info *pinfo, proto_tree *loc_tree)\r\n{\r\nreturn dissect_aim_buddyname(tvb, pinfo, 4, loc_tree);\r\n}\r\nstatic int dissect_aim_snac_location_request_user_information(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree)\r\n{\r\nint offset = 0;\r\nguint8 buddyname_length = 0;\r\nproto_tree_add_item(tree, hf_aim_snac_location_request_user_info_infotype,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nbuddyname_length = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(tree, hf_aim_buddyname_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_aim_buddyname, tvb, offset, buddyname_length, ENC_UTF_8|ENC_NA);\r\noffset += buddyname_length;\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_snac_location_user_information(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nint offset = 0;\r\nguint8 buddyname_length = 0;\r\nbuddyname_length = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(tree, hf_aim_buddyname_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_aim_buddyname, tvb, offset, buddyname_length, ENC_UTF_8|ENC_NA);\r\noffset += buddyname_length;\r\nproto_tree_add_item(tree, hf_aim_userinfo_warninglevel, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = dissect_aim_tlv_list(tvb, pinfo, offset, tree, aim_onlinebuddy_tlvs);\r\nreturn dissect_aim_tlv_sequence(tvb, pinfo, offset, tree, aim_locate_tags_tlvs);\r\n}\r\nvoid\r\nproto_register_aim_location(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_aim_buddyname_len,\r\n{ "Buddyname len", "aim_location.buddynamelen", FT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_aim_buddyname,\r\n{ "Buddy Name", "aim_location.buddyname", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_aim_userinfo_warninglevel,\r\n{ "Warning Level", "aim_location.userinfo.warninglevel", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_aim_snac_location_request_user_info_infotype,\r\n{ "Infotype", "aim_location.snac.request_user_info.infotype", FT_UINT16, BASE_HEX, VALS(aim_snac_location_request_user_info_infotypes), 0x0,\r\nNULL, HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_aim_location,\r\n};\r\nproto_aim_location = proto_register_protocol("AIM Location", "AIM Location", "aim_location");\r\nproto_register_field_array(proto_aim_location, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_aim_location(void)\r\n{\r\naim_init_family(proto_aim_location, ett_aim_location, FAMILY_LOCATION, aim_fnac_family_location);\r\n}
