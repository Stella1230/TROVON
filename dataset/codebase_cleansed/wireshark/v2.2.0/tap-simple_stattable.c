static void\r\nsimple_draw(void *arg)\r\n{\r\nnew_stat_data_t* stat_data = (new_stat_data_t*)arg;\r\ntable_stat_t* stats = (table_stat_t*)stat_data->user_data;\r\nsize_t i;\r\nguint table_index, element, field_index;\r\nstat_tap_table_item* field;\r\nstat_tap_table* table;\r\nstat_tap_table_item_type* field_data;\r\ngchar fmt_string[250];\r\nprintf("\n");\r\nprintf("=====================================================================================================\n");\r\nprintf("%s:\n", stat_data->stat_tap_data->title);\r\nprintf("Filter for statistics: %s\n", stats->filter ? stats->filter : "");\r\nfor (i = 0, field = stat_data->stat_tap_data->fields; i < stat_data->stat_tap_data->nfields; i++, field++)\r\n{\r\nprintf("%s |", field->column_name);\r\n}\r\nprintf("\n");\r\nfor (table_index = 0; table_index < stat_data->stat_tap_data->tables->len; table_index++)\r\n{\r\ntable = g_array_index(stat_data->stat_tap_data->tables, stat_tap_table*, table_index);\r\nprintf("%s\n", table->title);\r\nfor (element = 0; element < table->num_elements; element++)\r\n{\r\nfor (field_index = 0, field = stat_data->stat_tap_data->fields; field_index < table->num_fields; field_index++, field++)\r\n{\r\nfield_data = new_stat_tap_get_field_data(table, element, field_index);\r\nif (field_data->type == TABLE_ITEM_NONE)\r\nbreak;\r\ng_snprintf(fmt_string, sizeof(fmt_string), "%s |", field->field_format);\r\nswitch(field->type)\r\n{\r\ncase TABLE_ITEM_UINT:\r\nprintf(fmt_string, field_data->value.uint_value);\r\nbreak;\r\ncase TABLE_ITEM_INT:\r\nprintf(fmt_string, field_data->value.int_value);\r\nbreak;\r\ncase TABLE_ITEM_STRING:\r\nprintf(fmt_string, field_data->value.string_value);\r\nbreak;\r\ncase TABLE_ITEM_FLOAT:\r\nprintf(fmt_string, field_data->value.float_value);\r\nbreak;\r\ncase TABLE_ITEM_ENUM:\r\nprintf(fmt_string, field_data->value.enum_value);\r\nbreak;\r\ncase TABLE_ITEM_NONE:\r\nbreak;\r\n}\r\n}\r\nprintf("\n");\r\n}\r\n}\r\nprintf("=====================================================================================================\n");\r\n}\r\nstatic void\r\ninit_stat_table(stat_tap_table_ui *new_stat_tap, const char *filter)\r\n{\r\nGString *error_string;\r\ntable_stat_t* ui;\r\nui = g_new0(table_stat_t, 1);\r\nui->filter = g_strdup(filter);\r\nui->stats.stat_tap_data = new_stat_tap;\r\nui->stats.user_data = ui;\r\nnew_stat_tap->stat_tap_init_cb(new_stat_tap, NULL, NULL);\r\nerror_string = register_tap_listener(new_stat_tap->tap_name, &ui->stats, filter, 0, NULL, new_stat_tap->packet_func, simple_draw);\r\nif (error_string) {\r\nfprintf(stderr, "tshark: Couldn't register tap: %s\n", error_string->str);\r\ng_string_free(error_string, TRUE);\r\nexit(1);\r\n}\r\n}\r\nstatic void\r\nsimple_stat_init(const char *opt_arg, void* userdata)\r\n{\r\nstat_tap_table_ui *new_stat_tap = (stat_tap_table_ui*)userdata;\r\nconst char *filter=NULL;\r\nchar* err = NULL;\r\nnew_stat_tap_get_filter(new_stat_tap, opt_arg, &filter, &err);\r\nif (err != NULL)\r\n{\r\nfprintf(stderr, "tshark: %s\n", err);\r\ng_free(err);\r\nexit(1);\r\n}\r\ninit_stat_table(new_stat_tap, filter);\r\n}\r\nvoid\r\nregister_simple_stat_tables(gpointer data, gpointer user_data _U_)\r\n{\r\nstat_tap_table_ui *new_stat_tap = (stat_tap_table_ui*)data;\r\nstat_tap_ui ui_info;\r\nui_info.group = new_stat_tap->group;\r\nui_info.title = new_stat_tap->title;\r\nui_info.cli_string = new_stat_tap->cli_string;\r\nui_info.tap_init_cb = simple_stat_init;\r\nui_info.nparams = new_stat_tap->nparams;\r\nui_info.params = new_stat_tap->params;\r\nregister_stat_tap_ui(&ui_info, new_stat_tap);\r\n}
