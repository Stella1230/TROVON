static int\r\ndissect_PNDCP_Option(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, int hfindex, gboolean append_col)\r\n{\r\nguint8 option;\r\nguint8 suboption;\r\nconst value_string *val_str;\r\noffset = dissect_pn_uint8 (tvb, offset, pinfo, tree, hfindex, &option);\r\nswitch (option) {\r\ncase PNDCP_OPTION_IP:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_ip, &suboption);\r\nval_str = pn_dcp_suboption_ip;\r\nbreak;\r\ncase PNDCP_OPTION_DEVICE:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device, &suboption);\r\nval_str = pn_dcp_suboption_device;\r\nbreak;\r\ncase PNDCP_OPTION_DHCP:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_dhcp, &suboption);\r\nval_str = pn_dcp_suboption_dhcp;\r\nbreak;\r\ncase PNDCP_OPTION_CONTROL:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_control, &suboption);\r\nval_str = pn_dcp_suboption_control;\r\nbreak;\r\ncase PNDCP_OPTION_DEVICEINITIATIVE:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_deviceinitiative, &suboption);\r\nval_str = pn_dcp_suboption_deviceinitiative;\r\nbreak;\r\ncase PNDCP_OPTION_ALLSELECTOR:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_all, &suboption);\r\nval_str = pn_dcp_suboption_all;\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_manuf, &suboption);\r\nval_str = pn_dcp_suboption_manuf;\r\n}\r\nproto_item_append_text(block_item, ", Status from %s - %s",\r\nval_to_str(option, pn_dcp_option, "Unknown"), val_to_str(suboption, val_str, "Unknown"));\r\nif (append_col) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", %s", val_to_str(suboption, val_str, "Unknown"));\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_IP(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id, gboolean is_response)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\nguint16 block_info;\r\nguint16 block_qualifier;\r\nguint32 ip;\r\nproto_item *item = NULL;\r\naddress addr;\r\noffset = dissect_pn_uint8 (tvb, offset, pinfo, tree, hf_pn_dcp_suboption_ip, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nswitch (suboption) {\r\ncase PNDCP_SUBOPTION_IP_MAC:\r\npn_append_info(pinfo, dcp_item, ", MAC");\r\nproto_item_append_text(block_item, "IP/MAC");\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\nbreak;\r\ncase PNDCP_SUBOPTION_IP_IP:\r\npn_append_info(pinfo, dcp_item, ", IP");\r\nproto_item_append_text(block_item, "IP/IP");\r\nif ( ((service_id == PNDCP_SERVICE_ID_IDENTIFY) && is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_HELLO) && !is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_GET) && is_response)) {\r\nblock_info = tvb_get_ntohs (tvb, offset);\r\nif (tree) {\r\nitem = proto_tree_add_uint(tree, hf_pn_dcp_suboption_ip_block_info, tvb, offset, 2, block_info);\r\n}\r\noffset += 2;\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_suboption_ip_block_info, "Undecoded"));\r\nblock_length -= 2;\r\nif (block_info & 0x80) {\r\nexpert_add_info(pinfo, item, &ei_pn_dcp_ip_conflict);\r\n}\r\n}\r\nif ( (service_id == PNDCP_SERVICE_ID_SET) && !is_response) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\nblock_length -= 2;\r\n}\r\noffset = dissect_pn_ipv4(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_ip_ip, &ip);\r\nset_address(&addr, AT_IPv4, 4, &ip);\r\nproto_item_append_text(block_item, ", IP: %s", address_to_str(wmem_packet_scope(), &addr));\r\noffset = dissect_pn_ipv4(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_ip_subnetmask, &ip);\r\nset_address(&addr, AT_IPv4, 4, &ip);\r\nproto_item_append_text(block_item, ", Subnet: %s", address_to_str(wmem_packet_scope(), &addr));\r\noffset = dissect_pn_ipv4(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_ip_standard_gateway, &ip);\r\nset_address(&addr, AT_IPv4, 4, &ip);\r\nproto_item_append_text(block_item, ", Gateway: %s", address_to_str(wmem_packet_scope(), &addr));\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_Device(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id, gboolean is_response)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\ngchar *info_str;\r\nguint8 device_role;\r\nguint16 vendor_id;\r\nguint16 device_id;\r\nchar *typeofstation;\r\nchar *nameofstation;\r\nchar *aliasname;\r\nguint16 block_info;\r\nguint16 block_qualifier;\r\ngboolean have_block_info = FALSE;\r\ngboolean have_block_qualifier = FALSE;\r\nguint8 device_instance_high;\r\nguint8 device_instance_low;\r\nguint16 oem_vendor_id;\r\nguint16 oem_device_id;\r\nconversation_t *conversation;\r\nstationInfo *station_info;\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nif ( ((service_id == PNDCP_SERVICE_ID_IDENTIFY) && is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_HELLO) && !is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_GET) && is_response)) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_info, &block_info);\r\nhave_block_info = TRUE;\r\nblock_length -= 2;\r\n}\r\nif ( (service_id == PNDCP_SERVICE_ID_SET) && !is_response) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nhave_block_qualifier = TRUE;\r\nblock_length -= 2;\r\n}\r\nswitch (suboption) {\r\ncase PNDCP_SUBOPTION_DEVICE_MANUF:\r\ntypeofstation = (char *)wmem_alloc(wmem_packet_scope(), block_length+1);\r\ntvb_memcpy(tvb, (guint8 *) typeofstation, offset, block_length);\r\ntypeofstation[block_length] = '\0';\r\nproto_tree_add_string (tree, hf_pn_dcp_suboption_device_typeofstation, tvb, offset, block_length, typeofstation);\r\npn_append_info(pinfo, dcp_item, ", DeviceVendorValue");\r\nproto_item_append_text(block_item, "Device/Manufacturer specific");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info){\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", DeviceVendorValue: \"%s\"", typeofstation);\r\nif (pinfo->fd->flags.visited == FALSE) {\r\nconversation = find_conversation(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\nif (conversation == NULL) {\r\nconversation = conversation_new(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\n}\r\nstation_info = (stationInfo*)conversation_get_proto_data(conversation, proto_pn_dcp);\r\nif (station_info == NULL) {\r\nstation_info = wmem_new0(wmem_file_scope(), stationInfo);\r\ninit_pnio_rtc1_station(station_info);\r\nconversation_add_proto_data(conversation, proto_pn_dcp, station_info);\r\n}\r\nstation_info->typeofstation = wmem_strdup(wmem_file_scope(), typeofstation);\r\n}\r\noffset += block_length;\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_NAMEOFSTATION:\r\nnameofstation = (char *)wmem_alloc(wmem_packet_scope(), block_length+1);\r\ntvb_memcpy(tvb, (guint8 *) nameofstation, offset, block_length);\r\nnameofstation[block_length] = '\0';\r\nproto_tree_add_string (tree, hf_pn_dcp_suboption_device_nameofstation, tvb, offset, block_length, nameofstation);\r\npn_append_info(pinfo, dcp_item, wmem_strdup_printf(wmem_packet_scope(), ", NameOfStation:\"%s\"", nameofstation));\r\nproto_item_append_text(block_item, "Device/NameOfStation");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", \"%s\"", nameofstation);\r\nif (pinfo->fd->flags.visited == FALSE) {\r\nconversation = find_conversation(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\nif (conversation == NULL) {\r\nconversation = conversation_new(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\n}\r\nstation_info = (stationInfo*)conversation_get_proto_data(conversation, proto_pn_dcp);\r\nif (station_info == NULL) {\r\nstation_info = wmem_new0(wmem_file_scope(), stationInfo);\r\ninit_pnio_rtc1_station(station_info);\r\nconversation_add_proto_data(conversation, proto_pn_dcp, station_info);\r\n}\r\nstation_info->nameofstation = wmem_strdup(wmem_file_scope(), nameofstation);\r\n}\r\noffset += block_length;\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_DEV_ID:\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_vendor_id, &vendor_id);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_id, &device_id);\r\nif (pinfo->fd->flags.visited == FALSE) {\r\nconversation = find_conversation(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\nif (conversation == NULL) {\r\nconversation = conversation_new(pinfo->num, &pinfo->dl_src, &pinfo->dl_dst, PT_NONE, 0, 0, 0);\r\n}\r\nstation_info = (stationInfo*)conversation_get_proto_data(conversation, proto_pn_dcp);\r\nif (station_info == NULL) {\r\nstation_info = wmem_new0(wmem_file_scope(), stationInfo);\r\ninit_pnio_rtc1_station(station_info);\r\nconversation_add_proto_data(conversation, proto_pn_dcp, station_info);\r\n}\r\nstation_info->u16Vendor_id = vendor_id;\r\nstation_info->u16Device_id = device_id;\r\n}\r\npn_append_info(pinfo, dcp_item, ", Dev-ID");\r\nproto_item_append_text(block_item, "Device/Device ID");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", VendorID: 0x%04x / DeviceID: 0x%04x", vendor_id, device_id);\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_DEV_ROLE:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_role, &device_role);\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_reserved8, NULL);\r\npn_append_info(pinfo, dcp_item, ", Dev-Role");\r\nproto_item_append_text(block_item, "Device/Device Role");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info)\r\nproto_item_append_text(block_item, ", BlockInfo: %s", val_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\nif (device_role & 0x01)\r\nproto_item_append_text(block_item, ", IO-Device");\r\nif (device_role & 0x02)\r\nproto_item_append_text(block_item, ", IO-Controller");\r\nif (device_role & 0x04)\r\nproto_item_append_text(block_item, ", IO-Multidevice");\r\nif (device_role & 0x08)\r\nproto_item_append_text(block_item, ", PN-Supervisor");\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_DEV_OPTIONS:\r\ninfo_str = wmem_strdup_printf(wmem_packet_scope(), ", Dev-Options(%u)", block_length/2);\r\npn_append_info(pinfo, dcp_item, info_str);\r\nproto_item_append_text(block_item, "Device/Device Options");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", %u options", block_length/2);\r\nfor( ; block_length != 0; block_length -= 2) {\r\noffset = dissect_PNDCP_Option(tvb, offset, pinfo, tree, NULL , hf_pn_dcp_option,\r\nFALSE );\r\n}\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_ALIAS_NAME:\r\naliasname = (char *)wmem_alloc(wmem_packet_scope(), block_length+1);\r\ntvb_memcpy(tvb, (guint8 *) aliasname, offset, block_length);\r\naliasname[block_length] = '\0';\r\nproto_tree_add_string (tree, hf_pn_dcp_suboption_device_aliasname, tvb, offset, block_length, aliasname);\r\npn_append_info(pinfo, dcp_item, wmem_strdup_printf(wmem_packet_scope(), ", AliasName:\"%s\"", aliasname));\r\nproto_item_append_text(block_item, "Device/AliasName");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", \"%s\"", aliasname);\r\noffset += block_length;\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_DEV_INSTANCE:\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_instance_high, &device_instance_high);\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_instance_low, &device_instance_low);\r\npn_append_info(pinfo, dcp_item, ", Dev-Instance");\r\nproto_item_append_text(block_item, "Device/Device Instance");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", InstanceHigh: %d, Instance Low: %d",\r\ndevice_instance_high, device_instance_low);\r\nbreak;\r\ncase PNDCP_SUBOPTION_DEVICE_OEM_DEV_ID:\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_oem_ven_id, &oem_vendor_id);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_device_oem_dev_id, &oem_device_id);\r\npn_append_info(pinfo, dcp_item, ", OEM-Dev-ID");\r\nproto_item_append_text(block_item, "Device/OEM Device ID");\r\nif(have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif(have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_item_append_text(block_item, ", OEMVendorID: 0x%04x / OEMDeviceID: 0x%04x", oem_vendor_id, oem_device_id);\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_DHCP(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id _U_, gboolean is_response _U_)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\nguint16 block_info;\r\nguint16 block_qualifier;\r\ngboolean have_block_info = FALSE;\r\ngboolean have_block_qualifier = FALSE;\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_dhcp, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nif ( ((service_id == PNDCP_SERVICE_ID_IDENTIFY) && is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_HELLO) && !is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_GET) && is_response)) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_info, &block_info);\r\nhave_block_info=TRUE;\r\nblock_length -= 2;\r\n}\r\nif ( (service_id == PNDCP_SERVICE_ID_SET) && !is_response) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nhave_block_qualifier=TRUE;\r\nblock_length -= 2;\r\n}\r\nswitch (suboption) {\r\ncase PNDCP_SUBOPTION_DHCP_CLIENT_ID:\r\npn_append_info(pinfo, dcp_item, ", DHCP client identifier");\r\nproto_item_append_text(block_item, "DHCP/Client-ID");\r\nif (have_block_qualifier) {\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\n}\r\nif (have_block_info) {\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\n}\r\nproto_tree_add_item(tree, hf_pn_dcp_suboption_dhcp_device_id, tvb, offset, block_length, ENC_NA);\r\noffset += block_length;\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_Control(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id _U_, gboolean is_response _U_)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\nguint16 block_qualifier;\r\nguint16 BlockQualifier;\r\ngchar *info_str;\r\nguint8 block_error;\r\nproto_item *item = NULL;\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_control, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nswitch (suboption) {\r\ncase PNDCP_SUBOPTION_CONTROL_START_TRANS:\r\npn_append_info(pinfo, dcp_item, ", Start-Trans");\r\nproto_item_append_text(block_item, "Control/Start-Transaction");\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nbreak;\r\ncase PNDCP_SUBOPTION_CONTROL_END_TRANS:\r\npn_append_info(pinfo, dcp_item, ", End-Trans");\r\nproto_item_append_text(block_item, "Control/End-Transaction");\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nbreak;\r\ncase PNDCP_SUBOPTION_CONTROL_SIGNAL:\r\npn_append_info(pinfo, dcp_item, ", Signal");\r\nproto_item_append_text(block_item, "Control/Signal");\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nblock_length -= 2;\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\nbreak;\r\ncase PNDCP_SUBOPTION_CONTROL_RESPONSE:\r\nproto_item_append_text(block_item, "Control/Response");\r\noffset = dissect_PNDCP_Option(tvb, offset, pinfo, tree, block_item, hf_pn_dcp_suboption_control_response,\r\nFALSE );\r\nblock_error = tvb_get_guint8 (tvb, offset);\r\nif (tree) {\r\nitem = proto_tree_add_uint(tree, hf_pn_dcp_block_error, tvb, offset, 1, block_error);\r\n}\r\noffset += 1;\r\nif (block_error != 0) {\r\nexpert_add_info_format(pinfo, item, &ei_pn_dcp_block_error_unknown, "%s",\r\nval_to_str(block_error, pn_dcp_block_error, "Unknown"));\r\n}\r\ninfo_str = wmem_strdup_printf(wmem_packet_scope(), ", Response(%s)",\r\nval_to_str(block_error, pn_dcp_block_error, "Unknown"));\r\npn_append_info(pinfo, dcp_item, info_str);\r\nproto_item_append_text(block_item, ", BlockError: %s",\r\nval_to_str(block_error, pn_dcp_block_error, "Unknown"));\r\nbreak;\r\ncase PNDCP_SUBOPTION_CONTROL_FACT_RESET:\r\npn_append_info(pinfo, dcp_item, ", Reset FactorySettings");\r\nproto_item_append_text(block_item, "Control/Reset FactorySettings");\r\nblock_length -= 2;\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_blockqualifier_r2f, &BlockQualifier);\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(BlockQualifier, pn_dcp_suboption_other, "reserved"));\r\nblock_length -= 2;\r\nbreak;\r\ncase PNDCP_SUBOPTION_CONTROL_RESET_TO_FACT:\r\npn_append_info(pinfo, dcp_item, ", Reset to Factory");\r\nproto_item_append_text(block_item, "Reset to FactorySettings");\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_blockqualifier, &BlockQualifier);\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(BlockQualifier, pn_dcp_BlockQualifier, "reserved"));\r\nblock_length -= 2;\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_DeviceInitiative(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id, gboolean is_response)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\nguint16 block_info;\r\nguint16 block_qualifier;\r\nguint16 value;\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_deviceinitiative, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\npn_append_info(pinfo, dcp_item, ", DeviceInitiative");\r\nproto_item_append_text(block_item, "DeviceInitiative/DeviceInitiative");\r\nif ( ((service_id == PNDCP_SERVICE_ID_IDENTIFY) && is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_HELLO) && !is_response) ||\r\n((service_id == PNDCP_SERVICE_ID_GET) && is_response)) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_info, &block_info);\r\nproto_item_append_text(block_item, ", BlockInfo: %s",\r\nval_to_str(block_info, pn_dcp_block_info, "Unknown"));\r\nblock_length -= 2;\r\n}\r\nif ( (service_id == PNDCP_SERVICE_ID_SET) && !is_response) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_qualifier, &block_qualifier);\r\nproto_item_append_text(block_item, ", BlockQualifier: %s",\r\nval_to_str(block_qualifier, pn_dcp_block_qualifier, "Unknown"));\r\nblock_length -= 2;\r\n}\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_deviceinitiative_value, &value);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_All(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id _U_, gboolean is_response _U_)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, tree, hf_pn_dcp_suboption_all, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nswitch (suboption) {\r\ncase 255:\r\npn_append_info(pinfo, dcp_item, ", All");\r\nproto_item_append_text(block_item, "All/All");\r\nbreak;\r\ndefault:\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Suboption_Manuf(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *block_item, proto_item *dcp_item,\r\nguint8 service_id _U_, gboolean is_response _U_)\r\n{\r\nguint8 suboption;\r\nguint16 block_length;\r\noffset = dissect_pn_uint8( tvb, offset, pinfo, tree, hf_pn_dcp_suboption_manuf, &suboption);\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_block_length, &block_length);\r\nswitch (suboption) {\r\ndefault:\r\npn_append_info(pinfo, dcp_item, ", Manufacturer Specific");\r\nproto_item_append_text(block_item, "Manufacturer Specific");\r\noffset = dissect_pn_undecoded(tvb, offset, pinfo, tree, block_length);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_PNDCP_Block(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, proto_item *dcp_item,\r\nguint8 service_id, gboolean is_response)\r\n{\r\nguint8 option;\r\nproto_item *block_item;\r\nproto_tree *block_tree;\r\nint ori_offset = offset;\r\nblock_item = proto_tree_add_none_format(tree, hf_pn_dcp_block,\r\ntvb, offset, 0, "Block: ");\r\nblock_tree = proto_item_add_subtree(block_item, ett_pn_dcp_block);\r\noffset = dissect_pn_uint8(tvb, offset, pinfo, block_tree, hf_pn_dcp_option, &option);\r\nswitch (option) {\r\ncase PNDCP_OPTION_IP:\r\noffset = dissect_PNDCP_Suboption_IP(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_DEVICE:\r\noffset = dissect_PNDCP_Suboption_Device(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_DHCP:\r\noffset = dissect_PNDCP_Suboption_DHCP(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_CONTROL:\r\noffset = dissect_PNDCP_Suboption_Control(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_DEVICEINITIATIVE:\r\noffset = dissect_PNDCP_Suboption_DeviceInitiative(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_ALLSELECTOR:\r\noffset = dissect_PNDCP_Suboption_All(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\nbreak;\r\ncase PNDCP_OPTION_MANUF_X80:\r\ncase PNDCP_OPTION_MANUF_X81:\r\ndefault:\r\noffset = dissect_PNDCP_Suboption_Manuf(tvb, offset, pinfo, block_tree, block_item, dcp_item, service_id, is_response);\r\n}\r\nproto_item_set_len(block_item, offset-ori_offset);\r\nif ((offset-ori_offset) & 1) {\r\noffset = dissect_pn_padding(tvb, offset, pinfo, tree, 1);\r\n}\r\nreturn offset;\r\n}\r\nstatic void\r\ndissect_PNDCP_PDU(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree, proto_item *dcp_item)\r\n{\r\nguint8 service_id;\r\nguint8 service_type;\r\nguint32 xid;\r\nguint16 response_delay;\r\nguint16 data_length;\r\nint offset = 0;\r\ngchar *xid_str;\r\ngboolean is_response = FALSE;\r\noffset = dissect_pn_uint8 (tvb, offset, pinfo, tree, hf_pn_dcp_service_id, &service_id);\r\noffset = dissect_pn_uint8 (tvb, offset, pinfo, tree, hf_pn_dcp_service_type, &service_type);\r\noffset = dissect_pn_uint32(tvb, offset, pinfo, tree, hf_pn_dcp_xid, &xid);\r\nif (service_id == PNDCP_SERVICE_ID_IDENTIFY && service_type == PNDCP_SERVICE_TYPE_REQUEST) {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_response_delay, &response_delay);\r\n} else {\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_reserved16, NULL);\r\n}\r\noffset = dissect_pn_uint16(tvb, offset, pinfo, tree, hf_pn_dcp_data_length, &data_length);\r\nswitch (service_id) {\r\ncase PNDCP_SERVICE_ID_GET:\r\npn_append_info(pinfo, dcp_item, "Get");\r\nbreak;\r\ncase PNDCP_SERVICE_ID_SET:\r\npn_append_info(pinfo, dcp_item, "Set");\r\nbreak;\r\ncase PNDCP_SERVICE_ID_IDENTIFY:\r\npn_append_info(pinfo, dcp_item, "Ident");\r\nbreak;\r\ncase PNDCP_SERVICE_ID_HELLO:\r\npn_append_info(pinfo, dcp_item, "Hello");\r\nbreak;\r\ndefault:\r\ndissect_pn_undecoded(tvb, offset, pinfo, tree, tvb_captured_length_remaining(tvb, offset));\r\nreturn;\r\n}\r\nswitch (service_type) {\r\ncase PNDCP_SERVICE_TYPE_REQUEST:\r\npn_append_info(pinfo, dcp_item, " Req");\r\nbreak;\r\ncase PNDCP_SERVICE_TYPE_RESPONSE_SUCCESS:\r\npn_append_info(pinfo, dcp_item, " Ok ");\r\nis_response = TRUE;\r\nbreak;\r\ncase PNDCP_SERVICE_TYPE_RESPONSE_UNSUPPORTED:\r\npn_append_info(pinfo, dcp_item, " unsupported");\r\nis_response = TRUE;\r\nbreak;\r\ndefault:\r\ndissect_pn_undecoded(tvb, offset, pinfo, tree, tvb_captured_length_remaining(tvb, offset));\r\nreturn;\r\n}\r\nxid_str = wmem_strdup_printf(wmem_packet_scope(), ", Xid:0x%x", xid);\r\npn_append_info(pinfo, dcp_item, xid_str);\r\nwhile(data_length) {\r\nint ori_offset = offset;\r\nif (service_id == PNDCP_SERVICE_ID_GET && service_type == PNDCP_SERVICE_TYPE_REQUEST) {\r\noffset = dissect_PNDCP_Option(tvb, offset, pinfo,\r\ntree, dcp_item, hf_pn_dcp_option, TRUE );\r\n} else {\r\noffset = dissect_PNDCP_Block(tvb, offset, pinfo, tree, dcp_item, service_id, is_response);\r\n}\r\nif (offset <= ori_offset || data_length < (offset - ori_offset)) {\r\nTHROW(ReportedBoundsError);\r\n}\r\ndata_length -= (offset - ori_offset);\r\n}\r\n}\r\nstatic gboolean\r\ndissect_PNDCP_Data_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data)\r\n{\r\nguint16 u16FrameID = GPOINTER_TO_UINT(data);\r\nproto_item *item;\r\nproto_tree *dcp_tree;\r\nif (u16FrameID < FRAME_ID_DCP_HELLO || u16FrameID > FRAME_ID_DCP_IDENT_RES) {\r\nreturn FALSE;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PN-DCP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_protocol_format(tree, proto_pn_dcp, tvb, 0, tvb_get_ntohs(tvb, 8) + 10,\r\n"PROFINET DCP, ");\r\ndcp_tree = proto_item_add_subtree(item, ett_pn_dcp);\r\ndissect_PNDCP_PDU(tvb, pinfo, dcp_tree, item);\r\nreturn TRUE;\r\n}\r\nvoid\r\nproto_register_pn_dcp (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_pn_dcp_service_id,\r\n{ "ServiceID", "pn_dcp.service_id",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_service_id), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_service_type,\r\n{ "ServiceType", "pn_dcp.service_type",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_service_type), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_xid,\r\n{ "Xid", "pn_dcp.xid",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_reserved8,\r\n{ "Reserved", "pn_dcp.reserved8",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_reserved16,\r\n{ "Reserved", "pn_dcp.reserved16",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_response_delay,\r\n{ "ResponseDelay", "pn_dcp.response_delay",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_data_length,\r\n{ "DCPDataLength", "pn_dcp.data_length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_block_length,\r\n{ "DCPBlockLength", "pn_dcp.block_length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_option,\r\n{ "Option", "pn_dcp.option",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_option), 0x0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_pn_dcp_suboption,\r\n{ "Suboption", "pn_dcp.suboption",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n#endif\r\n{ &hf_pn_dcp_block_error,\r\n{ "BlockError", "pn_dcp.block_error",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_block_error), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_block,\r\n{ "Block", "pn_dcp.block",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_block_info,\r\n{ "BlockInfo", "pn_dcp.block_info",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_block_info), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_block_qualifier,\r\n{ "BlockQualifier", "pn_dcp.block_qualifier",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_block_qualifier), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_blockqualifier_r2f,\r\n{ "BlockQualifier: ResettoFactory", "pn_dcp.block_qualifier_reset",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_BlockQualifier), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_blockqualifier,\r\n{ "BlockQualifier: ResetFactorySettings", "pn_dcp.block_qualifier_reset",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_suboption_other), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_ip,\r\n{ "Suboption", "pn_dcp.suboption_ip",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_ip), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_ip_block_info,\r\n{ "BlockInfo", "pn_dcp.suboption_ip_block_info",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_suboption_ip_block_info), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_ip_ip,\r\n{ "IPaddress", "pn_dcp.subobtion_ip_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_ip_subnetmask,\r\n{ "Subnetmask", "pn_dcp.subobtion_ip_subnetmask",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_ip_standard_gateway,\r\n{ "StandardGateway", "pn_dcp.suboption_ip_standard_gateway",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device,\r\n{ "Suboption", "pn_dcp.suboption_device",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_device), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_typeofstation,\r\n{ "DeviceVendorValue", "pn_dcp.suboption_device_devicevendorvalue",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_nameofstation,\r\n{ "NameOfStation", "pn_dcp.suboption_device_nameofstation",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_vendor_id,\r\n{ "VendorID", "pn_dcp.suboption_vendor_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_id,\r\n{ "DeviceID", "pn_dcp.suboption_device_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_role,\r\n{ "DeviceRoleDetails", "pn_dcp.suboption_device_role",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_aliasname,\r\n{ "AliasName", "pn_dcp.suboption_device_aliasname",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_instance_high,\r\n{ "DeviceInstanceHigh", "pn_dcp.suboption_device_instance",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_instance_low,\r\n{ "DeviceInstanceLow", "pn_dcp.suboption_device_instance",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_oem_ven_id,\r\n{ "OEMVendorID", "pn_dcp.suboption_device_oem_ven_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_device_oem_dev_id,\r\n{ "OEMDeviceID", "pn_dcp.suboption_device_oem_dev_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_dhcp,\r\n{ "Suboption", "pn_dcp.suboption_dhcp",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_dhcp), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_dhcp_device_id,\r\n{ "Device ID", "pn_dcp.suboption_dhcp_device_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_control,\r\n{ "Suboption", "pn_dcp.suboption_control",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_control), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_control_response,\r\n{ "Response", "pn_dcp.suboption_control_response",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_option), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_deviceinitiative,\r\n{ "Suboption", "pn_dcp.suboption_deviceinitiative",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_deviceinitiative), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_deviceinitiative_value,\r\n{ "DeviceInitiativeValue", "pn_dcp.deviceinitiative_value",\r\nFT_UINT16, BASE_DEC, VALS(pn_dcp_deviceinitiative_value), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_all,\r\n{ "Suboption", "pn_dcp.suboption_all",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_all), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_pn_dcp_suboption_manuf,\r\n{ "Suboption", "pn_dcp.suboption_manuf",\r\nFT_UINT8, BASE_DEC, VALS(pn_dcp_suboption_manuf), 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pn_dcp,\r\n&ett_pn_dcp_block\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_pn_dcp_block_error_unknown, { "pn_dcp.block_error.unknown", PI_RESPONSE_CODE, PI_CHAT, "Unknown", EXPFILL }},\r\n{ &ei_pn_dcp_ip_conflict, { "pn_dcp.ip_conflict", PI_RESPONSE_CODE, PI_NOTE, "IP address conflict detected!", EXPFILL }},\r\n};\r\nexpert_module_t* expert_pn_dcp;\r\nproto_pn_dcp = proto_register_protocol ("PROFINET DCP", "PN-DCP", "pn_dcp");\r\nproto_register_field_array (proto_pn_dcp, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\nexpert_pn_dcp = expert_register_protocol(proto_pn_dcp);\r\nexpert_register_field_array(expert_pn_dcp, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_pn_dcp (void)\r\n{\r\nheur_dissector_add("pn_rt", dissect_PNDCP_Data_heur, "PROFINET DCP IO", "pn_dcp_pn_rt", proto_pn_dcp, HEURISTIC_ENABLE);\r\n}
