static int\r\ndissect_ies(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_) {\r\nint offset = 0;\r\nif (q931_ie_handle) {\r\ncall_dissector(q931_ie_handle, tvb, pinfo, tree);\r\noffset += tvb_reported_length_remaining(tvb, offset);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_ras(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_) {\r\nint offset = 0;\r\nif (h225_ras_handle) {\r\ncall_dissector(h225_ras_handle, tvb, pinfo, tree);\r\noffset += tvb_reported_length_remaining(tvb, offset);\r\n}\r\nreturn offset;\r\n}\r\nstatic h460_feature_t *find_ftr(const gchar *key) {\r\nh460_feature_t *ftr = NULL;\r\nh460_feature_t *f;\r\nfor (f=h460_feature_tab; f->id; f++) {\r\nif (f->key_gd && !strcmp(key, f->key_gd)) { ftr = f; break; }\r\nif (f->key_fd && !strcmp(key, f->key_fd)) { ftr = f; break; }\r\nif (f->key_gm && !strcmp(key, f->key_gm)) { ftr = f; break; }\r\nif (f->key_gi && !strcmp(key, f->key_gi)) { ftr = f; break; }\r\n}\r\nreturn ftr;\r\n}\r\nstatic int\r\ndissect_h460_name(tvbuff_t *tvb _U_, packet_info *pinfo, proto_tree *tree, void *data) {\r\nint offset = 0;\r\nasn1_ctx_t *actx;\r\nh460_feature_t *ftr;\r\nif (data == NULL)\r\nreturn 0;\r\nactx = get_asn1_ctx(data);\r\nDISSECTOR_ASSERT(actx);\r\nif (tree) {\r\nftr = find_ftr(pinfo->match_string);\r\nif (ftr) {\r\nproto_item_append_text(actx->created_item, " - %s", ftr->name);\r\nproto_item_append_text(proto_item_get_parent(proto_tree_get_parent(tree)), ": %s", ftr->name);\r\n} else {\r\nproto_item_append_text(actx->created_item, " - unknown(%s)", pinfo->match_string);\r\n}\r\n}\r\nreturn offset;\r\n}\r\nvoid proto_register_h460(void) {\r\nh460_feature_t *ftr;\r\nstatic hf_register_info hf[] = {\r\n#include "packet-h460-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n#include "packet-h460-ettarr.c"\r\n};\r\nproto_h460 = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_h460, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nfor (ftr=h460_feature_tab; ftr->id; ftr++) {\r\nif (ftr->opt & GD) ftr->key_gd = g_strdup_printf("GenericData/%s", ftr->id);\r\nif (ftr->opt & FD) ftr->key_fd = g_strdup_printf("FeatureDescriptor/%s", ftr->id);\r\nif (ftr->opt & GM) ftr->key_gm = g_strdup_printf("GenericMessage/%s", ftr->id);\r\nif (ftr->opt & GI) ftr->key_gi = g_strdup_printf("GenericInformation/%s", ftr->id);\r\nif (ftr->content_pdu) ftr->content_hnd = create_dissector_handle(ftr->content_pdu, proto_h460);\r\n}\r\n}\r\nvoid proto_reg_handoff_h460(void)\r\n{\r\nh460_feature_t *ftr;\r\ndissector_handle_t h460_name_handle;\r\nq931_ie_handle = find_dissector_add_dependency("q931.ie", proto_h460);\r\nh225_ras_handle = find_dissector_add_dependency("h225.ras", proto_h460);\r\nh460_name_handle = create_dissector_handle(dissect_h460_name, proto_h460);\r\nfor (ftr=h460_feature_tab; ftr->id; ftr++) {\r\nif (ftr->key_gd) dissector_add_string("h225.gef.name", ftr->key_gd, h460_name_handle);\r\nif (ftr->key_fd) dissector_add_string("h225.gef.name", ftr->key_fd, h460_name_handle);\r\nif (ftr->key_gm) dissector_add_string("h245.gef.name", ftr->key_gm, h460_name_handle);\r\nif (ftr->key_gi) dissector_add_string("h245.gef.name", ftr->key_gi, h460_name_handle);\r\nif (ftr->content_hnd) {\r\nif (ftr->key_gd) dissector_add_string("h225.gef.content", ftr->key_gd, ftr->content_hnd);\r\nif (ftr->key_fd) dissector_add_string("h225.gef.content", ftr->key_fd, ftr->content_hnd);\r\nif (ftr->key_gm) dissector_add_string("h245.gef.content", ftr->key_gm, ftr->content_hnd);\r\nif (ftr->key_gi) dissector_add_string("h245.gef.content", ftr->key_gi, ftr->content_hnd);\r\n}\r\n}\r\n}
