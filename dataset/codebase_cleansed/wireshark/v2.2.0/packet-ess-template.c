static void *\r\ness_copy_cb(void *dest, const void *orig, size_t len _U_)\r\n{\r\ness_category_attributes_t *u = (ess_category_attributes_t *)dest;\r\nconst ess_category_attributes_t *o = (const ess_category_attributes_t *)orig;\r\nu->oid = g_strdup(o->oid);\r\nu->lacv = o->lacv;\r\nu->name = g_strdup(o->name);\r\nreturn dest;\r\n}\r\nstatic void\r\ness_free_cb(void *r)\r\n{\r\ness_category_attributes_t *u = (ess_category_attributes_t *)r;\r\ng_free(u->oid);\r\ng_free(u->name);\r\n}\r\nstatic void\r\ness_dissect_attribute (guint32 value, asn1_ctx_t *actx)\r\n{\r\nguint i;\r\nfor (i = 0; i < num_ess_category_attributes; i++) {\r\ness_category_attributes_t *u = &(ess_category_attributes[i]);\r\nif ((strcmp (u->oid, object_identifier_id) == 0) &&\r\n(u->lacv == value))\r\n{\r\nproto_item_append_text (actx->created_item, " (%s)", u->name);\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void\r\ness_dissect_attribute_flags (tvbuff_t *tvb, asn1_ctx_t *actx)\r\n{\r\nproto_tree *tree;\r\nguint8 *value;\r\nguint i;\r\ntree = proto_item_add_subtree (actx->created_item, ett_Category_attributes);\r\nvalue = (guint8 *)tvb_memdup (wmem_packet_scope(), tvb, 0, tvb_captured_length (tvb));\r\nfor (i = 0; i < num_ess_category_attributes; i++) {\r\ness_category_attributes_t *u = &(ess_category_attributes[i]);\r\nif ((strcmp (u->oid, object_identifier_id) == 0) &&\r\n((u->lacv / 8) < tvb_captured_length (tvb)) &&\r\n(value[u->lacv / 8] & (1U << (7 - (u->lacv % 8)))))\r\n{\r\nproto_tree_add_string_format (tree, hf_ess_Category_attribute, tvb,\r\nu->lacv / 8, 1, u->name,\r\n"%s (%d)", u->name, u->lacv);\r\n}\r\n}\r\n}\r\nvoid proto_register_ess(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_ess_SecurityCategory_type_OID,\r\n{ "type", "ess.type_OID", FT_STRING, BASE_NONE, NULL, 0,\r\n"Type of Security Category", HFILL }},\r\n{ &hf_ess_Category_attribute,\r\n{ "Attribute", "ess.attribute", FT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#include "packet-ess-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_Category_attributes,\r\n#include "packet-ess-ettarr.c"\r\n};\r\nstatic uat_field_t attributes_flds[] = {\r\nUAT_FLD_CSTRING(ess_category_attributes,oid, "Tag Set", "Category Tag Set (Object Identifier)"),\r\nUAT_FLD_DEC(ess_category_attributes,lacv, "Value", "Label And Cert Value"),\r\nUAT_FLD_CSTRING(ess_category_attributes,name, "Name", "Category Name"),\r\nUAT_END_FIELDS\r\n};\r\nuat_t *attributes_uat = uat_new("ESS Category Attributes",\r\nsizeof(ess_category_attributes_t),\r\n"ess_category_attributes",\r\nTRUE,\r\n&ess_category_attributes,\r\n&num_ess_category_attributes,\r\nUAT_AFFECTS_DISSECTION,\r\n"ChEssCategoryAttributes",\r\ness_copy_cb,\r\nNULL,\r\ness_free_cb,\r\nNULL,\r\nattributes_flds);\r\nstatic module_t *ess_module;\r\nproto_ess = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_ess, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\ness_module = prefs_register_protocol(proto_ess, NULL);\r\nprefs_register_uat_preference(ess_module, "attributes_table",\r\n"ESS Category Attributes",\r\n"ESS category attributes translation table",\r\nattributes_uat);\r\n}\r\nvoid proto_reg_handoff_ess(void) {\r\n#include "packet-ess-dis-tab.c"\r\n}
