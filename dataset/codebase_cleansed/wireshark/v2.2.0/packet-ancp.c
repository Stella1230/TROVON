static void\r\ndissect_ancp_port_up_dn_mgmt(tvbuff_t *tvb, proto_tree *ancp_tree, gint offset)\r\n{\r\nguint8 tech_type;\r\nproto_tree_add_item(ancp_tree, hf_ancp_port, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(ancp_tree, hf_ancp_port_sess_num, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(ancp_tree, hf_ancp_evt_seq_num, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(ancp_tree, hf_ancp_label, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(ancp_tree, hf_ancp_reserved, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\noffset += 1;\r\nproto_tree_add_item(ancp_tree, hf_ancp_tech_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ntech_type = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(ancp_tree, hf_ancp_blk_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nif (tech_type == TECH_TYPE_DSL) {\r\nproto_item *sti;\r\nproto_tree *tlv_tree;\r\nguint16 tlen, ttype;\r\ngint16 num_tlvs, num_stlvs;\r\nproto_tree_add_item(ancp_tree, hf_ancp_num_ext_tlvs, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nnum_tlvs = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(sti, " (Extension Block)");\r\noffset += 2;\r\ntlv_tree = proto_item_add_subtree(sti, ett_ancp_len);\r\nfor( ;num_tlvs; num_tlvs--) {\r\nproto_tree_add_item(tlv_tree, hf_ancp_ext_tlv_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nttype = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nsti = proto_tree_add_item(tlv_tree, hf_ancp_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\ntlen = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nswitch (ttype) {\r\ncase TLV_DSL_LINE_ATTRIBUTES:\r\n{\r\nproto_tree *dsl_tree;\r\nguint16 stlvtype, stlvlen;\r\ngint val;\r\ndsl_tree = proto_item_add_subtree(sti, ett_ancp_ext_tlv_type);\r\nnum_stlvs = tlen / 8;\r\nfor ( ;num_stlvs; num_stlvs--) {\r\nproto_tree_add_item(dsl_tree,\r\nhf_ancp_dsl_line_stlv_type, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\nstlvtype = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nstlvlen = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nsti = proto_tree_add_item(dsl_tree,\r\nhf_ancp_dsl_line_stlv_value, tvb, offset,\r\nstlvlen, ENC_BIG_ENDIAN);\r\nval = tvb_get_ntohl(tvb, offset);\r\noffset += stlvlen;\r\nswitch (stlvtype) {\r\ncase TLV_DSL_LINE_STATE:\r\nproto_item_append_text(sti, " (%s)",\r\nval_to_str(val, dsl_line_state_names,\r\n"Unknown (0x%02x)"));\r\nbreak;\r\ncase TLV_DSL_TYPE:\r\nproto_item_append_text(sti, " (%s)",\r\nval_to_str(val, dsl_line_type_names,\r\n"Unknown (0x%02x)"));\r\nbreak;\r\ndefault:\r\nproto_item_append_text(sti, " %s",\r\nval_to_str(stlvtype,\r\ndsl_line_attr_units,\r\n"Unknown (0x%02x)"));\r\nbreak;\r\n}\r\nSKIPPADDING(offset, stlvlen);\r\n}\r\nbreak;\r\n}\r\ncase TLV_PING_OPAQUE_DATA:\r\nproto_tree_add_item(tlv_tree, hf_ancp_oam_opaque,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tlv_tree, hf_ancp_oam_opaque,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbreak;\r\ncase TLV_PING_PARAMS:\r\nproto_tree_add_item(tlv_tree,\r\nhf_ancp_oam_loopb_cnt, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tlv_tree,\r\nhf_ancp_oam_timeout, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\noffset += 2;\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(tlv_tree, hf_ancp_ext_tlv_value_str,\r\ntvb, offset, tlen, ENC_ASCII|ENC_NA);\r\noffset += tlen;\r\nSKIPPADDING(offset, tlen);\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_ancp_adj_msg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *ancp_tree,\r\ngint offset, struct ancp_tap_t *ancp_info\r\n)\r\n{\r\nproto_item *sti;\r\nproto_tree *ancp_cap_tree;\r\nguint8 byte, numcaps, adjcode;\r\nguint16 tlv_len;\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_timer, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_item_append_text(sti, " msec");\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_adj_code, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\nbyte = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nadjcode = byte & ADJ_CODE_MASK;\r\nancp_info->ancp_adjcode = adjcode;\r\nproto_item_append_text(sti, " (%s, M Flag %s)",\r\nval_to_str(adjcode, adj_code_names, "Unknown (0x%02x)"),\r\n(byte >> 7) ? "Set" : "Unset");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " (%s)",\r\nval_to_str(adjcode, adj_code_names, "Unknown (0x%02x)"));\r\nproto_tree_add_item(ancp_tree, hf_ancp_sender_name, tvb, offset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(ancp_tree, hf_ancp_receiver_name, tvb,offset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(ancp_tree, hf_ancp_sender_port, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(ancp_tree, hf_ancp_receiver_port, tvb,offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_p_info, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nbyte = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_item_append_text(sti, " (Type = %d, Flag = %d)",\r\nbyte >> 4, byte & 0x0F);\r\nproto_tree_add_item(ancp_tree, hf_ancp_sender_instance, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(ancp_tree, hf_ancp_p_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(ancp_tree, hf_ancp_receiver_instance, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(ancp_tree, hf_ancp_tech_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_num_tlvs, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nnumcaps = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nancp_cap_tree = proto_item_add_subtree(sti, ett_ancp_tot_len);\r\nproto_tree_add_item(ancp_cap_tree, hf_ancp_tot_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nfor ( ;numcaps; numcaps--) {\r\nsti = proto_tree_add_item(ancp_cap_tree, hf_ancp_cap, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntlv_len = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nproto_item_append_text(sti, " (%d bytes)", tlv_len);\r\n}\r\n}\r\nstatic void\r\nancp_stats_tree_init(stats_tree *st)\r\n{\r\nst_node_packets = stats_tree_create_node(st, st_str_packets, 0, TRUE);\r\nst_node_packet_types = stats_tree_create_pivot(st, st_str_packet_types,\r\nst_node_packets);\r\nst_node_adj_pack_types = stats_tree_create_node(st, st_str_adj_pack_types,\r\nst_node_packets, TRUE);\r\n}\r\nstatic int\r\nancp_stats_tree_packet(stats_tree* st, packet_info* pinfo _U_,\r\nepan_dissect_t* edt _U_ , const void* p)\r\n{\r\nconst struct ancp_tap_t *pi = (const struct ancp_tap_t *) p;\r\ntick_stat_node(st, st_str_packets, 0, FALSE);\r\nstats_tree_tick_pivot(st, st_node_packet_types,\r\nval_to_str(pi->ancp_mtype, mtype_names,\r\n"Unknown packet type (%d)"));\r\nif (pi->ancp_mtype == ANCP_MTYPE_ADJ)\r\nstats_tree_tick_pivot(st, st_node_adj_pack_types,\r\nval_to_str(pi->ancp_adjcode, adj_code_names,\r\n"Unknown Adjacency packet (%d)"));\r\nreturn 1;\r\n}\r\nstatic int\r\ndissect_ancp_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ngint offset;\r\nguint8 mtype;\r\nstruct ancp_tap_t *ancp_info;\r\nproto_item *ti;\r\nproto_item *sti;\r\nproto_tree *ancp_tree;\r\nguint8 byte;\r\noffset = 0;\r\nif (tvb_get_ntohs(tvb, offset) != ANCP_GSMP_ETHER_TYPE)\r\nreturn 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "ANCP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nancp_info = wmem_new(wmem_packet_scope(), struct ancp_tap_t);\r\nancp_info->ancp_mtype = 0;\r\nancp_info->ancp_adjcode = 0;\r\nti = proto_tree_add_item(tree, proto_ancp, tvb, 0, -1, ENC_NA);\r\nancp_tree = proto_item_add_subtree(ti, ett_ancp_len);\r\noffset = 2;\r\nproto_tree_add_item(ancp_tree, hf_ancp_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_ver, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nbyte = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_item_append_text(sti, " (%d.%d)", byte >> 4, byte & 0x0F);\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_mtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nmtype = tvb_get_guint8(tvb, offset);\r\nancp_info->ancp_mtype = mtype;\r\noffset += 1;\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s Message",\r\nval_to_str(mtype, mtype_names, "Unknown (0x%02x)"));\r\nif (mtype != ANCP_MTYPE_ADJ) {\r\nproto_tree_add_item(ancp_tree, hf_ancp_result, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(ancp_tree, hf_ancp_code, tvb, offset, 2,\r\nENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(ancp_tree, hf_ancp_p_id, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(ancp_tree, hf_ancp_trans_id, tvb,\r\noffset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(ancp_tree, hf_ancp_i_flag, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\nsti = proto_tree_add_item(ancp_tree, hf_ancp_submsg_num, tvb,\r\noffset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset += 2;\r\n}\r\nswitch(mtype) {\r\ncase ANCP_MTYPE_ADJ:\r\ndissect_ancp_adj_msg(tvb, pinfo, ancp_tree, offset, ancp_info);\r\nbreak;\r\ncase ANCP_MTYPE_PORT_DN:\r\ncase ANCP_MTYPE_PORT_MGMT:\r\ncase ANCP_MTYPE_PORT_UP:\r\ndissect_ancp_port_up_dn_mgmt(tvb, ancp_tree, offset);\r\nbreak;\r\ndefault:\r\nproto_item_append_text(sti, " (Unknown Message %d)", mtype);\r\nbreak;\r\n}\r\ntap_queue_packet(ancp_tap, pinfo, ancp_info);\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic guint\r\nget_ancp_msg_len(packet_info *pinfo _U_, tvbuff_t *tvb, int offset, void *data _U_)\r\n{\r\nreturn (guint)tvb_get_ntohs(tvb, offset + 2) + 4;\r\n}\r\nstatic int\r\ndissect_ancp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, ANCP_MIN_HDR,\r\nget_ancp_msg_len, dissect_ancp_message, data);\r\nreturn tvb_reported_length(tvb);\r\n}\r\nvoid\r\nproto_register_ancp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_ancp_len,\r\n{ "Length", "ancp.len",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_ver,\r\n{ "Version", "ancp.ver",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_mtype,\r\n{ "Message Type", "ancp.mtype",\r\nFT_UINT8, BASE_DEC,\r\nVALS(mtype_names), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_timer,\r\n{ "Timer", "ancp.timer",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_adj_code,\r\n{ "Code", "ancp.adjcode",\r\nFT_UINT8, BASE_DEC,\r\nNULL, ADJ_CODE_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_sender_name,\r\n{ "Sender Name", "ancp.sender_name",\r\nFT_ETHER, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_receiver_name,\r\n{ "Receiver Name", "ancp.receiver_name",\r\nFT_ETHER, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_sender_port,\r\n{ "Sender Port", "ancp.sender_port",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_receiver_port,\r\n{ "Receiver Port", "ancp.receiver_port",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_p_info,\r\n{ "Partition Info", "ancp.partition_info",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_sender_instance,\r\n{ "Sender Instance", "ancp.sender_instance",\r\nFT_UINT24, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_p_id,\r\n{ "Partition ID", "ancp.partition_id",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_receiver_instance,\r\n{ "Receiver Instance", "ancp.receiver_instance",\r\nFT_UINT24, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_tech_type,\r\n{ "Tech Type", "ancp.tech_type",\r\nFT_UINT8, BASE_DEC,\r\nVALS(techtype_str), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_num_tlvs,\r\n{ "Num TLVs", "ancp.num_tlvs",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_tot_len,\r\n{ "Length", "ancp.tot_len",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_cap,\r\n{ "Capability", "ancp.capability",\r\nFT_UINT16, BASE_DEC,\r\nVALS(captype_names), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_result,\r\n{ "Result", "ancp.result",\r\nFT_UINT8, BASE_DEC,\r\nVALS(resulttype_names), ANCP_RESULT_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_code,\r\n{ "Code", "ancp.code",\r\nFT_UINT16, BASE_HEX,\r\nVALS(codetype_names), ANCP_CODE_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_trans_id,\r\n{ "Transaction ID", "ancp.transaction_id",\r\nFT_UINT24, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_i_flag,\r\n{ "I Flag", "ancp.i_flag",\r\nFT_BOOLEAN, 8,\r\nTFS(&tfs_set_notset), ANCP_I_FLAG_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_submsg_num,\r\n{ "SubMessage Number", "ancp.submessage_number",\r\nFT_UINT16, BASE_DEC,\r\nNULL, ANCP_SUBMSG_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_port,\r\n{ "Port", "ancp.port",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_port_sess_num,\r\n{ "Port Session Number", "ancp.port_sess_num",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_evt_seq_num,\r\n{ "Event Sequence Number", "ancp.evt_seq_num",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_label,\r\n{ "Label", "ancp.label",\r\nFT_UINT64, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_reserved,\r\n{ "Reserved", "ancp.reserved",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_blk_len,\r\n{ "Block Length", "ancp.blk_len",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_num_ext_tlvs,\r\n{ "Num TLVs", "ancp.ext_tlvs.count",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_ext_tlv_type,\r\n{ "TLV", "ancp.ext_tlv.type",\r\nFT_UINT16, BASE_DEC,\r\nVALS(ext_tlv_types), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_dsl_line_stlv_type,\r\n{ "Sub-TLV", "ancp.sub_tlv_type",\r\nFT_UINT16, BASE_HEX,\r\nVALS(dsl_line_attrs), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_dsl_line_stlv_value,\r\n{ "Value", "ancp.dsl_line_param",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_ext_tlv_value_str,\r\n{ "Value", "ancp.ext_tlv.value",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_oam_opaque,\r\n{ "Opaque", "ancp.oam.opaque",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_oam_loopb_cnt,\r\n{ "OAM Loopback Count", "ancp.oam.loopback_count",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ancp_oam_timeout,\r\n{ "OAM Timeout", "ancp.oam.timeout",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_ancp_len,\r\n&ett_ancp_ver,\r\n&ett_ancp_mtype,\r\n&ett_ancp_timer,\r\n&ett_ancp_adj_code,\r\n&ett_ancp_sender_name,\r\n&ett_ancp_receiver_name,\r\n&ett_ancp_sender_port,\r\n&ett_ancp_receiver_port,\r\n&ett_ancp_p_info,\r\n&ett_ancp_sender_instance,\r\n&ett_ancp_p_id,\r\n&ett_ancp_receiver_instance,\r\n&ett_ancp_tech_type,\r\n&ett_ancp_num_tlvs,\r\n&ett_ancp_tot_len,\r\n&ett_ancp_cap,\r\n&ett_ancp_result,\r\n&ett_ancp_code,\r\n&ett_ancp_trans_id,\r\n&ett_ancp_i_flag,\r\n&ett_ancp_submsg_num,\r\n&ett_ancp_port,\r\n&ett_ancp_port_sess_num,\r\n&ett_ancp_evt_seq_num,\r\n&ett_ancp_label,\r\n&ett_ancp_reserved,\r\n&ett_ancp_blk_len,\r\n&ett_ancp_num_ext_tlvs,\r\n&ett_ancp_ext_tlv_type,\r\n&ett_ancp_dsl_line_stlv_type,\r\n&ett_ancp_dsl_line_stlv_val,\r\n&ett_ancp_ext_tlv_value_str,\r\n&ett_ancp_oam_opaque,\r\n&ett_ancp_oam_loopb_cnt,\r\n&ett_ancp_oam_timeout,\r\n};\r\nproto_ancp = proto_register_protocol (\r\n"Access Node Control Protocol",\r\n"ANCP",\r\n"ancp"\r\n);\r\nproto_register_field_array(proto_ancp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nancp_tap = register_tap("ancp");\r\n}\r\nvoid\r\nproto_reg_handoff_ancp(void)\r\n{\r\ndissector_handle_t ancp_handle;\r\nancp_handle = create_dissector_handle(dissect_ancp, proto_ancp);\r\ndissector_add_uint("tcp.port", ANCP_PORT, ancp_handle);\r\nstats_tree_register("ancp", "ancp", "ANCP", 0,\r\nancp_stats_tree_packet, ancp_stats_tree_init, NULL);\r\n}
