static void\r\ndissect_mplstp_fm_tlv (tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nproto_item *ti;\r\nproto_tree *fm_tlv_tree;\r\nguint offset = 0;\r\nif (!tree)\r\nreturn;\r\nti = proto_tree_add_protocol_format (tree, proto_mplstp_fm, tvb, offset, 16,\r\n"Fault-Management TLVs");\r\nfm_tlv_tree = proto_item_add_subtree (ti, ett_mplstp_fm_tlv_tree);\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_if_tlv_type , tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_tlv_len, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_node_id, tvb, offset,\r\n4, ENC_BIG_ENDIAN);\r\noffset = offset + 4;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_if_num, tvb, offset,\r\n4, ENC_BIG_ENDIAN);\r\noffset = offset + 4;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_global_tlv_type , tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_tlv_len, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tlv_tree, hf_mplstp_fm_global_id, tvb, offset,\r\n4, ENC_BIG_ENDIAN);\r\nreturn;\r\n}\r\nstatic int\r\ndissect_mplstp_lock(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *lock_tree;\r\ntvbuff_t *next_tvb;\r\nguint8 offset = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "MPLS-TP LI");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (!tree)\r\nreturn tvb_captured_length(tvb);\r\nti = proto_tree_add_item(tree, proto_mplstp_lock, tvb, 0, -1, ENC_NA);\r\nlock_tree = proto_item_add_subtree (ti, ett_mplstp_lock);\r\nproto_tree_add_item (lock_tree, hf_mplstp_lock_version , tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (lock_tree, hf_mplstp_lock_reserved, tvb, offset,\r\n3, ENC_BIG_ENDIAN);\r\noffset = offset + 3;\r\nproto_tree_add_item (lock_tree, hf_mplstp_lock_refresh_timer, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nnext_tvb = tvb_new_subset_remaining (tvb, offset);\r\ndissect_bfd_mep (next_tvb, tree, proto_mplstp_lock);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_mplstp_fm(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti, *ti_flags;\r\nproto_tree *fm_tree, *fm_flags;\r\nguint8 offset = 0;\r\nguint8 tlv_len;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "MPLS-TP FM");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ntlv_len = tvb_get_guint8 (tvb, (offset + 4));\r\nif (!tree)\r\nreturn tvb_captured_length(tvb);\r\nti = proto_tree_add_item(tree, proto_mplstp_fm, tvb, 0, (tlv_len + 5), ENC_NA);\r\nfm_tree = proto_item_add_subtree (ti, ett_mplstp_fm);\r\nproto_tree_add_item (fm_tree, hf_mplstp_fm_version , tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (fm_tree, hf_mplstp_fm_reserved, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tree, hf_mplstp_fm_msg_type, tvb, offset,\r\n1,ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nti_flags = proto_tree_add_item (fm_tree, hf_mplstp_fm_flags, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nfm_flags = proto_item_add_subtree(ti_flags, ett_mplstp_fm_flags);\r\nproto_tree_add_item (fm_flags, hf_mplstp_fm_flags_l, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (fm_flags, hf_mplstp_fm_flags_r, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tree, hf_mplstp_fm_refresh_timer, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nproto_tree_add_item (fm_tree, hf_mplstp_fm_total_tlv_len, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nif (tlv_len != 0)\r\n{\r\ntvbuff_t *next_tvb;\r\nnext_tvb = tvb_new_subset_remaining (tvb, offset);\r\ndissect_mplstp_fm_tlv (next_tvb, tree);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_mplstp_lock(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_mplstp_lock_version,\r\n{"Version", "mplstp_lock.version", FT_UINT8,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_lock_reserved,\r\n{"Reserved", "mplstp_lock.reserved", FT_UINT24,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_lock_refresh_timer,\r\n{"Refresh-timer value", "mplstp_lock.refresh-timer", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mplstp_lock,\r\n};\r\nproto_mplstp_lock =\r\nproto_register_protocol("MPLS-TP Lock-Instruct", "MPLS[-TP] Lock-Instruct "\r\n"Lock-Instruct (LI) Protocol",\r\n"mplstp_lock");\r\nproto_register_field_array(proto_mplstp_lock, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_mplstp_lock(void)\r\n{\r\ndissector_handle_t mplstp_lock_handle;\r\nmplstp_lock_handle = create_dissector_handle( dissect_mplstp_lock, proto_mplstp_lock );\r\ndissector_add_uint("pwach.channel_type", 0x0026, mplstp_lock_handle);\r\n}\r\nvoid\r\nproto_register_mplstp_fm(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_mplstp_fm_version,\r\n{"Version", "mplstp_oam.version", FT_UINT8,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_reserved,\r\n{"Reserved", "mplstp_oam.reserved", FT_UINT8,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_refresh_timer,\r\n{"Refresh-timer value", "mplstp_oam.refresh.timer", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_total_tlv_len,\r\n{"FM TLV Length", "mplstp_oam.total.tlv.len", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_if_tlv_type,\r\n{"Type : IF-ID TLV", "mplstp_oam.if_id_tlv_type", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_global_tlv_type,\r\n{"Type : GLOBAL-ID TLV", "mplstp_oam.global_id_tlv_type", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_tlv_len,\r\n{"Length", "mplstp_oam.tlv_len", FT_UINT8,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_node_id,\r\n{"Node id", "mplstp_oam.node_id", FT_IPv4,\r\nBASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_if_num,\r\n{"Interface Number", "mplstp_oam.if_num", FT_UINT32,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_global_id,\r\n{"Global id", "mplstp_oam.global_id", FT_UINT32,\r\nBASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{&hf_mplstp_fm_msg_type,\r\n{"Message Type", "mplstp_oam.message.type", FT_UINT8,\r\nBASE_DEC, VALS(fm_msg_type), 0x0, "MPLS-TP FM Message Type", HFILL }},\r\n{ &hf_mplstp_fm_flags,\r\n{ "FM Flags", "mplstp_oam.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0000, "MPLS-TP FM Flags", HFILL}\r\n},\r\n{ &hf_mplstp_fm_flags_l,\r\n{ "Link Down Indication", "mplstp_oam.flag_l",\r\nFT_BOOLEAN, 8, NULL, 0x0002, NULL, HFILL}\r\n},\r\n{ &hf_mplstp_fm_flags_r,\r\n{ "FM Condition Cleared", "mplstp_oam.flag_r",\r\nFT_BOOLEAN, 8, NULL, 0x0001, "Fault Condition Cleared", HFILL}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mplstp_fm,\r\n&ett_mplstp_fm_tlv_tree,\r\n&ett_mplstp_fm_flags,\r\n};\r\nproto_mplstp_fm =\r\nproto_register_protocol("MPLS-TP Fault-Management", "MPLS[-TP] Fault-Management "\r\n"Fault-Management (FM) Protocol",\r\n"mplstp_fm");\r\nproto_register_field_array(proto_mplstp_fm, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_mplstp_fm(void)\r\n{\r\ndissector_handle_t mplstp_fm_handle;\r\nmplstp_fm_handle = create_dissector_handle( dissect_mplstp_fm, proto_mplstp_fm );\r\ndissector_add_uint("pwach.channel_type", 0x0058, mplstp_fm_handle);\r\n}
