void rdt_add_address(packet_info *pinfo,\r\naddress *addr, int port,\r\nint other_port,\r\nconst gchar *setup_method,\r\ngint rdt_feature_level)\r\n{\r\naddress null_addr;\r\nconversation_t* p_conv;\r\nstruct _rdt_conversation_info *p_conv_data;\r\nif (pinfo->fd->flags.visited)\r\n{\r\nreturn;\r\n}\r\nclear_address(&null_addr);\r\np_conv = find_conversation(pinfo->num, addr, &null_addr, PT_UDP, port, other_port,\r\nNO_ADDR_B | (!other_port ? NO_PORT_B : 0));\r\nif ( !p_conv || p_conv->setup_frame != pinfo->num)\r\n{\r\np_conv = conversation_new(pinfo->num, addr, &null_addr, PT_UDP,\r\n(guint32)port, (guint32)other_port,\r\nNO_ADDR2 | (!other_port ? NO_PORT2 : 0));\r\n}\r\nconversation_set_dissector(p_conv, rdt_handle);\r\np_conv_data = (struct _rdt_conversation_info *)conversation_get_proto_data(p_conv, proto_rdt);\r\nif (!p_conv_data)\r\n{\r\np_conv_data = wmem_new(wmem_file_scope(), struct _rdt_conversation_info);\r\nconversation_add_proto_data(p_conv, proto_rdt, p_conv_data);\r\n}\r\ng_strlcpy(p_conv_data->method, setup_method, MAX_RDT_SETUP_METHOD_SIZE);\r\np_conv_data->frame_number = pinfo->num;\r\np_conv_data->feature_level = rdt_feature_level;\r\n}\r\nstatic int dissect_rdt(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint previous_offset = 0;\r\ngint offset = 0;\r\nproto_item *ti;\r\nproto_tree *rdt_tree = NULL;\r\nproto_tree *rdt_packet_tree;\r\nguint16 packet_type;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RDT");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tree)\r\n{\r\nti = proto_tree_add_item(tree, proto_rdt, tvb, offset, -1, ENC_NA);\r\nrdt_tree = proto_item_add_subtree(ti, ett_rdt);\r\n}\r\nif (global_rdt_show_setup_info)\r\n{\r\nshow_setup_info(tvb, pinfo, rdt_tree);\r\n}\r\nwhile (offset != -1 && tvb_reported_length_remaining(tvb, offset))\r\n{\r\ntvb_ensure_bytes_exist(tvb, offset, 3);\r\npacket_type = tvb_get_ntohs(tvb, offset+1);\r\nti = proto_tree_add_string_format(rdt_tree, hf_rdt_packet, tvb, offset, -1,\r\n"",\r\n"RDT packet (%s)",\r\npacket_type < 0xff00 ? "Data" :\r\nval_to_str_const(packet_type, packet_type_vals, "Unknown"));\r\nrdt_packet_tree = proto_item_add_subtree(ti, ett_rdt_packet);\r\nif (packet_type < 0xff00)\r\n{\r\noffset = dissect_rdt_data_packet(tvb, pinfo, rdt_packet_tree, offset);\r\n}\r\nelse\r\n{\r\nswitch (packet_type)\r\n{\r\ncase RDT_ASMACTIION_PACKET:\r\noffset = dissect_rdt_asm_action_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_BANDWIDTHREPORT_PACKET:\r\noffset = dissect_rdt_bandwidth_report_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_ACK_PACKET:\r\noffset = dissect_rdt_ack_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_RTTREQUEST_PACKET:\r\noffset = dissect_rdt_rtt_request_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_RTTRESPONSE_PACKET:\r\noffset = dissect_rdt_rtt_response_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_CONGESTION_PACKET:\r\noffset = dissect_rdt_congestion_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_STREAMEND_PACKET:\r\noffset = dissect_rdt_stream_end_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_REPORT_PACKET:\r\noffset = dissect_rdt_report_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_LATENCYREPORT_PACKET:\r\noffset = dissect_rdt_latency_report_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_TRANSPORTINFO_PACKET:\r\noffset = dissect_rdt_transport_info_request_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_TRANSPORTINFORESPONSE_PACKET:\r\noffset = dissect_rdt_transport_info_response_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ncase RDT_BWPROBING_PACKET:\r\noffset = dissect_rdt_bw_probing_packet(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\ndefault:\r\noffset = dissect_rdt_unknown_control(tvb, pinfo, rdt_packet_tree, offset);\r\nbreak;\r\n}\r\n}\r\nif (offset != -1)\r\n{\r\nproto_item_set_len(rdt_packet_tree, offset-previous_offset);\r\n}\r\nprevious_offset = offset;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nguint dissect_rdt_data_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nguint8 need_reliable_flag;\r\nguint16 stream_id;\r\nguint16 sequence_number;\r\nguint8 is_reliable_flag;\r\nguint8 flags2;\r\nguint32 timestamp;\r\nguint16 asm_rule_number;\r\nguint8 back_to_back;\r\nguint8 slow_data;\r\nproto_tree *flags_tree1;\r\nproto_tree *flags_tree2;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nneed_reliable_flag = (flags1 & 0x40) >> 6;\r\nstream_id = (flags1 & 0x3e) >> 1;\r\nis_reliable_flag = flags1 & 0x01;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_data_flags1, tvb, offset, 1,\r\n"",\r\n"Length-included=%u, need-reliable=%u, stream-id=%u, is-reliable=%u",\r\nlength_included_flag,\r\nneed_reliable_flag,\r\nstream_id,\r\nis_reliable_flag);\r\nflags_tree1 = proto_item_add_subtree(ti, ett_rdt_data_flags1);\r\nproto_tree_add_item(flags_tree1, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree1, hf_rdt_data_need_reliable, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree1, hf_rdt_data_stream_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree1, hf_rdt_data_is_reliable, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nsequence_number = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_sequence_number, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nflags2 = tvb_get_guint8(tvb, offset);\r\nback_to_back = (flags2 & 0x80) >> 7;\r\nslow_data = (flags2 & 0x40) >> 6;\r\nasm_rule_number = flags2 & 0x3f;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_data_flags2, tvb, offset, 1,\r\n"",\r\n"Back-to-back=%u, slow-data=%u, asm-rule=%u",\r\nback_to_back,\r\nslow_data,\r\nasm_rule_number);\r\nflags_tree2 = proto_item_add_subtree(ti, ett_rdt_data_flags2);\r\nproto_tree_add_item(flags_tree2, hf_rdt_data_backtoback, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree2, hf_rdt_data_slowdata, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree2, hf_rdt_data_asmrule, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\ntimestamp = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_timestamp, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (stream_id == 31)\r\n{\r\nstream_id = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_stream_id_ex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\nif (need_reliable_flag)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_total_reliable, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\nif (asm_rule_number == 63)\r\n{\r\nasm_rule_number = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_asmrule_ex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n"DATA: stream-id=%02u asm-rule=%02u seq=%05u ts=%05u ",\r\nstream_id, asm_rule_number, sequence_number, timestamp);\r\nproto_tree_add_item(tree, hf_rdt_data, tvb, offset, -1, ENC_NA);\r\noffset += tvb_captured_length_remaining(tvb, offset);\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_asm_action_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nguint16 stream_id;\r\nguint16 rel_seqno;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nstream_id = (flags1 & 0x7c) >> 2;\r\nif (tree)\r\n{\r\nproto_tree_add_item(tree, proto_rdt, tvb, offset, -1, ENC_NA);\r\nti = proto_tree_add_string_format(tree, hf_rdt_aact_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u, stream_id=%u",\r\nlength_included_flag,\r\nstream_id);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_aact_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_aact_stream_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nrel_seqno = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_aact_reliable_seqno, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nif (stream_id == 31)\r\n{\r\nstream_id = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_stream_id_ex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n"ASM-ACTION: stream-id=%02u rel-seqno=%05u ",\r\nstream_id, rel_seqno);\r\nproto_tree_add_item(tree, hf_rdt_data, tvb, offset, -1, ENC_NA);\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_bandwidth_report_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_bandwidth_report_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u",\r\nlength_included_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_bandwidth_report_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nproto_tree_add_item(tree, hf_rdt_brpt_interval, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_brpt_bandwidth, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_rdt_brpt_sequence, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "BANDWIDTH-REPORT: ");\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_ack_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nguint8 lost_high_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nlost_high_flag = (flags1 & 0x40) >> 6;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_ack_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u, lost-high=%u",\r\nlength_included_flag,\r\nlost_high_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_ack_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_ack_lost_high, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nproto_tree_add_item(tree, hf_rdt_data, tvb, offset, -1, ENC_NA);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "ACK: lh=%u ", lost_high_flag);\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_rtt_request_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "RTT-REQUEST: ");\r\nreturn offset;\r\n}\r\nguint dissect_rdt_rtt_response_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_rtrp_ts_sec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_rdt_rtrp_ts_usec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "RTT-RESPONSE: ");\r\nreturn offset;\r\n}\r\nguint dissect_rdt_congestion_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_cong_xmit_mult, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_rdt_cong_recv_mult, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "CONGESTION: ");\r\nreturn offset;\r\n}\r\nguint dissect_rdt_stream_end_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint8 flags1;\r\nguint8 need_reliable;\r\nguint16 stream_id;\r\nguint8 packet_sent;\r\nguint8 ext_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nneed_reliable = (flags1 & 0x80) >> 7;\r\nstream_id = (flags1 & 0x7c) >> 2;\r\npacket_sent = (flags1 & 0x2) >> 1;\r\next_flag = flags1 & 0x1;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_stre_flags, tvb, offset, 1,\r\n"",\r\n"Need-reliable=%u, stream-id=%u, packet-sent=%u, ext-flag=%u",\r\nneed_reliable,\r\nstream_id,\r\npacket_sent,\r\next_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_stre_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_stre_need_reliable, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_stre_stream_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_stre_packet_sent, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_stre_ext_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_stre_seqno, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_timestamp, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (stream_id == 31)\r\n{\r\nstream_id = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_stream_id_ex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\nif (need_reliable)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_total_reliable, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\nif (ext_flag)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_stre_dummy_flags1, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_rdt_stre_dummy_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_stre_reason_code, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset += tvb_captured_length_remaining(tvb, offset);\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "STREAM-END: stream-id=%02u ", stream_id);\r\nreturn offset;\r\n}\r\nguint dissect_rdt_report_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_report_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u",\r\nlength_included_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_report_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, "REPORT: ");\r\nproto_tree_add_item(tree, hf_rdt_data, tvb, offset, -1, ENC_NA);\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_latency_report_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nguint32 server_out_time;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_latency_report_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u",\r\nlength_included_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_latency_report_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nserver_out_time = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_lrpt_server_out_time, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "LATENCY-REPORT: t=%u ", server_out_time);\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_transport_info_request_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint8 flags1;\r\nguint8 request_rtt_info_flag;\r\nguint8 request_buffer_info_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nrequest_rtt_info_flag = (flags1 & 0x2) >> 1;\r\nrequest_buffer_info_flag = (flags1 & 0x01);\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_ack_flags, tvb, offset, 1,\r\n"",\r\n"Request-rtt-info=%u, request-buffer-info=%u",\r\nrequest_rtt_info_flag,\r\nrequest_buffer_info_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_tirq_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_tirq_request_rtt_info, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_tirq_request_buffer_info, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (request_rtt_info_flag)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_tirq_request_time_msec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, "TRANSPORT-INFO-REQUEST: ");\r\nreturn offset;\r\n}\r\nguint dissect_rdt_transport_info_response_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint8 flags1;\r\nguint8 has_rtt_info;\r\nguint8 is_delayed;\r\nguint8 has_buffer_info;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nhas_rtt_info = (flags1 & 0x4) >> 2;\r\nis_delayed = (flags1 & 0x2) >> 1;\r\nhas_buffer_info = (flags1 & 0x1);\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_tirp_flags, tvb, offset, 1,\r\n"",\r\n"Has-rtt-info=%u, is-delayed=%u, has-buffer-info=%u",\r\nhas_rtt_info,\r\nis_delayed,\r\nhas_buffer_info);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_tirp_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_tirp_has_rtt_info, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_tirp_is_delayed, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_rdt_tirp_has_buffer_info, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (has_rtt_info)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_tirp_request_time_msec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (is_delayed)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_tirp_response_time_msec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\n}\r\nif (has_buffer_info)\r\n{\r\nguint16 n;\r\nguint16 buffer_info_count = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_tirp_buffer_info_count, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nfor (n=0; n < buffer_info_count; n++)\r\n{\r\nproto_tree *buffer_info_tree;\r\nproto_item *ti2;\r\nti2 = proto_tree_add_string_format(tree, hf_rdt_tirp_buffer_info, tvb, offset, 14,\r\n"",\r\n"Buffer info %u",\r\nn+1);\r\nbuffer_info_tree = proto_item_add_subtree(ti2, ett_rdt_tirp_buffer_info);\r\nproto_tree_add_item(buffer_info_tree, hf_rdt_tirp_buffer_info_stream_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(buffer_info_tree, hf_rdt_tirp_buffer_info_lowest_timestamp, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(buffer_info_tree, hf_rdt_tirp_buffer_info_highest_timestamp, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(buffer_info_tree, hf_rdt_tirp_buffer_info_bytes_buffered, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\n}\r\noffset += tvb_captured_length_remaining(tvb, offset);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "RESPONSE: ");\r\nreturn offset;\r\n}\r\nguint dissect_rdt_bw_probing_packet(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nguint start_offset = offset;\r\nguint16 packet_length;\r\nguint8 flags1;\r\nguint8 length_included_flag;\r\nproto_tree *flags_tree;\r\nproto_item *ti;\r\nflags1 = tvb_get_guint8(tvb, offset);\r\nlength_included_flag = (flags1 & 0x80) >> 7;\r\nif (tree)\r\n{\r\nti = proto_tree_add_string_format(tree, hf_rdt_bw_probing_flags, tvb, offset, 1,\r\n"",\r\n"Length-included=%u",\r\nlength_included_flag);\r\nflags_tree = proto_item_add_subtree(ti, ett_rdt_bw_probing_flags);\r\nproto_tree_add_item(flags_tree, hf_rdt_len_included, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (length_included_flag)\r\n{\r\npacket_length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_rdt_packet_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\ntvb_ensure_bytes_exist(tvb, start_offset, packet_length);\r\n}\r\nelse\r\n{\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nproto_tree_add_item(tree, hf_rdt_bwpp_seqno, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_rdt_timestamp, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "BW-PROBING: ");\r\nif (packet_length < (offset - start_offset) ||\r\npacket_length > tvb_reported_length_remaining(tvb, start_offset))\r\n{\r\nproto_tree_add_expert(tree, pinfo, &ei_rdt_packet_length, tvb, 0, 0);\r\npacket_length = tvb_captured_length_remaining(tvb, start_offset);\r\n}\r\nreturn start_offset + packet_length;\r\n}\r\nguint dissect_rdt_unknown_control(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint offset)\r\n{\r\nproto_tree_add_item(tree, hf_rdt_unk_flags1, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(tree, hf_rdt_packet_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_rdt_data, tvb, offset, -1, ENC_NA);\r\noffset += tvb_captured_length_remaining(tvb, offset);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "UNKNOWN-CTL: ");\r\nreturn offset;\r\n}\r\nstatic void show_setup_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nconversation_t *p_conv;\r\nstruct _rdt_conversation_info *p_conv_data;\r\np_conv_data = (struct _rdt_conversation_info *)p_get_proto_data(wmem_file_scope(), pinfo, proto_rdt, 0);\r\nif (!p_conv_data)\r\n{\r\np_conv = find_conversation(pinfo->num, &pinfo->net_dst, &pinfo->net_src,\r\npinfo->ptype,\r\npinfo->destport, pinfo->srcport, NO_ADDR_B);\r\nif (p_conv)\r\n{\r\nstruct _rdt_conversation_info *p_conv_packet_data;\r\np_conv_data = (struct _rdt_conversation_info *)conversation_get_proto_data(p_conv, proto_rdt);\r\nif (p_conv_data)\r\n{\r\np_conv_packet_data = wmem_new(wmem_file_scope(), struct _rdt_conversation_info);\r\ng_strlcpy(p_conv_packet_data->method, p_conv_data->method, MAX_RDT_SETUP_METHOD_SIZE);\r\np_conv_packet_data->frame_number = p_conv_data->frame_number;\r\np_conv_packet_data->feature_level = p_conv_data->feature_level;\r\np_add_proto_data(wmem_file_scope(), pinfo, proto_rdt, 0, p_conv_packet_data);\r\n}\r\n}\r\n}\r\nif (p_conv_data)\r\n{\r\nproto_tree *rdt_setup_tree;\r\nproto_item *ti = proto_tree_add_string_format(tree, hf_rdt_setup, tvb, 0, 0,\r\n"",\r\n"Stream setup by %s (frame %u), feature level %d",\r\np_conv_data->method,\r\np_conv_data->frame_number,\r\np_conv_data->feature_level);\r\nPROTO_ITEM_SET_GENERATED(ti);\r\nrdt_setup_tree = proto_item_add_subtree(ti, ett_rdt_setup);\r\nif (rdt_setup_tree)\r\n{\r\nproto_item* item = proto_tree_add_uint(rdt_setup_tree, hf_rdt_setup_frame,\r\ntvb, 0, 0, p_conv_data->frame_number);\r\nPROTO_ITEM_SET_GENERATED(item);\r\nitem = proto_tree_add_string(rdt_setup_tree, hf_rdt_setup_method,\r\ntvb, 0, 0, p_conv_data->method);\r\nPROTO_ITEM_SET_GENERATED(item);\r\nitem = proto_tree_add_int(rdt_setup_tree, hf_rdt_feature_level,\r\ntvb, 0, 0, p_conv_data->feature_level);\r\nPROTO_ITEM_SET_GENERATED(item);\r\n}\r\n}\r\n}\r\nvoid proto_register_rdt(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_rdt_packet,\r\n{\r\n"RDT packet",\r\n"rdt.packet",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_flags1,\r\n{\r\n"RDT data flags 1",\r\n"rdt.data-flags1",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_len_included,\r\n{\r\n"Length included",\r\n"rdt.length-included",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_need_reliable,\r\n{\r\n"Need reliable",\r\n"rdt.need-reliable",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x40,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_stream_id,\r\n{\r\n"Stream ID",\r\n"rdt.stream-id",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x3e,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_is_reliable,\r\n{\r\n"Is reliable",\r\n"rdt.is-reliable",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x01,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_flags2,\r\n{\r\n"RDT data flags 2",\r\n"rdt.data-flags2",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\n"RDT data flags2", HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_backtoback,\r\n{\r\n"Back-to-back",\r\n"rdt.back-to-back",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_slowdata,\r\n{\r\n"Slow data",\r\n"rdt.slow-data",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x40,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data_asmrule,\r\n{\r\n"asm rule",\r\n"rdt.asm-rule",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x3f,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_aact_flags,\r\n{\r\n"RDT asm-action flags 1",\r\n"rdt.aact-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\n"RDT aact flags", HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_aact_stream_id,\r\n{\r\n"Stream ID",\r\n"rdt.stream-id",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x7c,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_sequence_number,\r\n{\r\n"Sequence number",\r\n"rdt.sequence-number",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_packet_type,\r\n{\r\n"Packet type",\r\n"rdt.packet-type",\r\nFT_UINT16,\r\nBASE_HEX,\r\nVALS(packet_type_vals),\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_ack_flags,\r\n{\r\n"RDT ack flags",\r\n"rdt.ack-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_ack_lost_high,\r\n{\r\n"Lost high",\r\n"rdt.lost-high",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x40,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_latency_report_flags,\r\n{\r\n"RDT latency report flags",\r\n"rdt.latency-report-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_bandwidth_report_flags,\r\n{\r\n"RDT bandwidth report flags",\r\n"rdt.bandwidth-report-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_flags,\r\n{\r\n"RDT stream end flags",\r\n"rdt.stream-end-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#if 0\r\n{\r\n&hf_rdt_rtt_request_flags,\r\n{\r\n"RDT rtt request flags",\r\n"rdt.rtt-request-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#endif\r\n#if 0\r\n{\r\n&hf_rdt_rtt_response_flags,\r\n{\r\n"RDT rtt response flags",\r\n"rdt.rtt-response-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#endif\r\n#if 0\r\n{\r\n&hf_rdt_congestion_flags,\r\n{\r\n"RDT congestion flags",\r\n"rdt.congestion-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#endif\r\n{\r\n&hf_rdt_report_flags,\r\n{\r\n"RDT report flags",\r\n"rdt.report-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#if 0\r\n{\r\n&hf_rdt_tirq_flags,\r\n{\r\n"RDT transport info request flags",\r\n"rdt.transport-info-request-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n#endif\r\n{\r\n&hf_rdt_tirp_flags,\r\n{\r\n"RDT transport info response flags",\r\n"rdt.transport-info-response-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_bw_probing_flags,\r\n{\r\n"RDT bw probing flags",\r\n"rdt.bw-probing-flags",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_packet_length,\r\n{\r\n"Packet length",\r\n"rdt.packet-length",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_timestamp,\r\n{\r\n"Timestamp",\r\n"rdt.timestamp",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stream_id_ex,\r\n{\r\n"Stream-id expansion",\r\n"rdt.stream-id-expansion",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_asmrule_ex,\r\n{\r\n"Asm rule expansion",\r\n"rdt.asm-rule-expansion",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_total_reliable,\r\n{\r\n"Total reliable",\r\n"rdt.total-reliable",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_data,\r\n{\r\n"Data",\r\n"rdt.data",\r\nFT_NONE,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_aact_reliable_seqno,\r\n{\r\n"Reliable sequence number",\r\n"rdt.reliable-seq-no",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_brpt_interval,\r\n{\r\n"Bandwidth report interval",\r\n"rdt.bwid-report-interval",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_brpt_bandwidth,\r\n{\r\n"Bandwidth report bandwidth",\r\n"rdt.bwid-report-bandwidth",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_brpt_sequence,\r\n{\r\n"Bandwidth report sequence",\r\n"rdt.bwid-report-sequence",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_rtrp_ts_sec,\r\n{\r\n"Round trip response timestamp seconds",\r\n"rdt.rtrp-ts-sec",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_rtrp_ts_usec,\r\n{\r\n"Round trip response timestamp microseconds",\r\n"rdt.rtrp-ts-usec",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_cong_xmit_mult,\r\n{\r\n"Congestion transmit multiplier",\r\n"rdt.cong-xmit-mult",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_cong_recv_mult,\r\n{\r\n"Congestion receive multiplier",\r\n"rdt.cong-recv-mult",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_need_reliable,\r\n{\r\n"Need reliable",\r\n"rdt.stre-need-reliable",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_stream_id,\r\n{\r\n"Stream id",\r\n"rdt.stre-stream-id",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x7c,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_packet_sent,\r\n{\r\n"Packet sent",\r\n"rdt.stre-packet-sent",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x02,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_ext_flag,\r\n{\r\n"Ext flag",\r\n"rdt.stre-ext-flag",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x01,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_seqno,\r\n{\r\n"Stream end sequence number",\r\n"rdt.stre-seqno",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_dummy_flags1,\r\n{\r\n"Stream end reason dummy flags1",\r\n"rdt.stre-reason-dummy-flags1",\r\nFT_UINT8,\r\nBASE_HEX,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_dummy_type,\r\n{\r\n"Stream end reason dummy type",\r\n"rdt.stre-reason-dummy-type",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_stre_reason_code,\r\n{\r\n"Stream end reason code",\r\n"rdt.stre-reason-code",\r\nFT_UINT32,\r\nBASE_HEX,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_lrpt_server_out_time,\r\n{\r\n"Latency report server out time",\r\n"rdt.lrpt-server-out-time",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirq_request_rtt_info,\r\n{\r\n"Transport info request rtt info flag",\r\n"rdt.tirq-request-rtt-info",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x2,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirq_request_buffer_info,\r\n{\r\n"Transport info request buffer info flag",\r\n"rdt.tirq-request-buffer-info",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x1,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirq_request_time_msec,\r\n{\r\n"Transport info request time msec",\r\n"rdt.tirq-request-time-msec",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_has_rtt_info,\r\n{\r\n"Transport info response has rtt info flag",\r\n"rdt.tirp-has-rtt-info",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x4,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_is_delayed,\r\n{\r\n"Transport info response is delayed",\r\n"rdt.tirp-is-delayed",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x2,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_has_buffer_info,\r\n{\r\n"Transport info response has buffer info",\r\n"rdt.tirp-has-buffer-info",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x1,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_request_time_msec,\r\n{\r\n"Transport info request time msec",\r\n"rdt.tirp-request-time-msec",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_response_time_msec,\r\n{\r\n"Transport info response time msec",\r\n"rdt.tirp-response-time-msec",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info_count,\r\n{\r\n"Transport info buffer into count",\r\n"rdt.tirp-buffer-info-count",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info,\r\n{\r\n"RDT buffer info",\r\n"rdt.tirp-buffer-info",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info_stream_id,\r\n{\r\n"Buffer info stream-id",\r\n"rdt.tirp-buffer-info-stream-id",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info_lowest_timestamp,\r\n{\r\n"Lowest timestamp",\r\n"rdt.tirp-buffer-info-lowest-timestamp",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info_highest_timestamp,\r\n{\r\n"Highest timestamp",\r\n"rdt.tirp-buffer-info-highest-timestamp",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_tirp_buffer_info_bytes_buffered,\r\n{\r\n"Bytes buffered",\r\n"rdt.tirp-buffer-info-bytes-buffered",\r\nFT_UINT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_bwpp_seqno,\r\n{\r\n"Bandwidth probing packet seqno",\r\n"rdt.bwpp-seqno",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_unk_flags1,\r\n{\r\n"Unknown packet flags",\r\n"rdt.unk-flags1",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_setup,\r\n{\r\n"Stream setup",\r\n"rdt.setup",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\n"Stream setup, method and frame number", HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_setup_frame,\r\n{\r\n"Setup frame",\r\n"rdt.setup-frame",\r\nFT_FRAMENUM,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\n"Frame that set up this stream", HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_setup_method,\r\n{\r\n"Setup Method",\r\n"rdt.setup-method",\r\nFT_STRING,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\n"Method used to set up this stream", HFILL\r\n}\r\n},\r\n{\r\n&hf_rdt_feature_level,\r\n{\r\n"RDT feature level",\r\n"rdt.feature-level",\r\nFT_INT32,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_rdt,\r\n&ett_rdt_packet,\r\n&ett_rdt_setup,\r\n&ett_rdt_data_flags1,\r\n&ett_rdt_data_flags2,\r\n&ett_rdt_aact_flags,\r\n&ett_rdt_ack_flags,\r\n&ett_rdt_latency_report_flags,\r\n&ett_rdt_bandwidth_report_flags,\r\n&ett_rdt_stre_flags,\r\n&ett_rdt_rtt_request_flags,\r\n&ett_rdt_rtt_response_flags,\r\n&ett_rdt_congestion_flags,\r\n&ett_rdt_report_flags,\r\n&ett_rdt_tirq_flags,\r\n&ett_rdt_tirp_flags,\r\n&ett_rdt_tirp_buffer_info,\r\n&ett_rdt_bw_probing_flags\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_rdt_packet_length, { "rdt.invalid_packet_length", PI_MALFORMED, PI_ERROR, "Packet length invalid", EXPFILL }},\r\n};\r\nmodule_t *rdt_module;\r\nexpert_module_t* expert_rdt;\r\nproto_rdt = proto_register_protocol("Real Data Transport", "RDT", "rdt");\r\nproto_register_field_array(proto_rdt, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_rdt = expert_register_protocol(proto_rdt);\r\nexpert_register_field_array(expert_rdt, ei, array_length(ei));\r\nregister_dissector("rdt", dissect_rdt, proto_rdt);\r\nrdt_module = prefs_register_protocol(proto_rdt, proto_reg_handoff_rdt);\r\nprefs_register_bool_preference(rdt_module, "show_setup_info",\r\n"Show stream setup information",\r\n"Where available, show which protocol and frame caused "\r\n"this RDT stream to be created",\r\n&global_rdt_show_setup_info);\r\nprefs_register_bool_preference(rdt_module, "register_udp_port",\r\n"Register default UDP client port",\r\n"Register a client UDP port for RDT traffic",\r\n&global_rdt_register_udp_port);\r\nprefs_register_uint_preference(rdt_module, "default_udp_port",\r\n"Default UDP client port",\r\n"Set the UDP port for clients",\r\n10, &global_rdt_udp_port);\r\n}\r\nvoid proto_reg_handoff_rdt(void)\r\n{\r\nstatic gboolean rdt_prefs_initialized = FALSE;\r\nstatic gboolean rdt_register_udp_port;\r\nstatic guint rdt_udp_port;\r\nif (!rdt_prefs_initialized)\r\n{\r\nrdt_handle = find_dissector("rdt");\r\ndissector_add_for_decode_as("udp.port", rdt_handle);\r\nrdt_prefs_initialized = TRUE;\r\n}\r\nelse\r\n{\r\nif (rdt_register_udp_port)\r\n{\r\ndissector_delete_uint("udp.port", rdt_udp_port, rdt_handle);\r\n}\r\n}\r\nrdt_register_udp_port = global_rdt_register_udp_port;\r\nif (global_rdt_register_udp_port)\r\n{\r\nrdt_udp_port = global_rdt_udp_port;\r\ndissector_add_uint("udp.port", global_rdt_udp_port, rdt_handle);\r\n}\r\n}
