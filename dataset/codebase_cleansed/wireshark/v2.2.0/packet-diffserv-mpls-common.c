void\r\ndissect_diffserv_mpls_common(tvbuff_t *tvb, proto_tree *tree, int type,\r\nint offset, int **hfindexes, gint **etts)\r\n{\r\nproto_item *ti = NULL, *sub_ti;\r\nproto_tree *tree2 = NULL, *phbid_subtree;\r\nint exp;\r\nguint16 phbid;\r\nswitch (type) {\r\ncase 1:\r\nti = proto_tree_add_item(tree, hf_map, tvb, offset, 4, ENC_NA);\r\ntree2 = proto_item_add_subtree(ti, ett_map);\r\nproto_item_set_text(ti, "MAP: ");\r\noffset ++;\r\nexp = tvb_get_guint8(tvb, offset) & 7;\r\nproto_tree_add_uint(tree2, hf_exp, tvb, offset, 1, exp);\r\nproto_item_append_text(ti, "EXP %u, ", exp);\r\noffset ++;\r\nbreak;\r\ncase 2:\r\ntree2 = tree;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nsub_ti = proto_tree_add_item(tree2, hf_phbid, tvb, offset, 2, ENC_NA);\r\nphbid_subtree = proto_item_add_subtree(sub_ti, ett_map_phbid);\r\nproto_item_set_text(sub_ti, "%s: ", (type == 1) ? PHBID_DESCRIPTION : "PSC");\r\nphbid = tvb_get_ntohs(tvb, offset);\r\nif ((phbid & 1) == 0) {\r\nproto_tree_add_uint(phbid_subtree, hf_phbid_dscp,\r\ntvb, offset, 2, phbid);\r\nif (type == 1)\r\nproto_item_append_text(ti, "DSCP %u", phbid >> 10);\r\nproto_item_append_text(sub_ti, "DSCP %u", phbid >> 10);\r\n}\r\nelse {\r\nproto_tree_add_uint(phbid_subtree, hf_phbid_code,\r\ntvb, offset, 2, phbid);\r\nif (type == 1)\r\nproto_item_append_text(ti, "PHB id code %u", phbid >> 4);\r\nproto_item_append_text(sub_ti, "PHB id code %u", phbid >> 4);\r\n}\r\nproto_tree_add_uint(phbid_subtree, hf_phbid_bit14, tvb, offset, 2, phbid);\r\nproto_tree_add_uint(phbid_subtree, hf_phbid_bit15, tvb, offset, 2, phbid);\r\n}
