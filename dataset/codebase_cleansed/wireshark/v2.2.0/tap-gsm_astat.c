static int\r\ngsm_a_stat_packet(\r\nvoid *tapdata,\r\npacket_info *pinfo _U_,\r\nepan_dissect_t *edt _U_,\r\nconst void *data)\r\n{\r\ngsm_a_stat_t *stat_p = (gsm_a_stat_t *)tapdata;\r\nconst gsm_a_tap_rec_t *tap_p = (const gsm_a_tap_rec_t *)data;\r\nswitch (tap_p->pdu_type)\r\n{\r\ncase BSSAP_PDU_TYPE_BSSMAP:\r\nstat_p->bssmap_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase BSSAP_PDU_TYPE_DTAP:\r\nswitch (tap_p->protocol_disc)\r\n{\r\ncase PD_CC:\r\nstat_p->dtap_cc_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_MM:\r\nstat_p->dtap_mm_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_RR:\r\nstat_p->dtap_rr_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_GMM:\r\nstat_p->dtap_gmm_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_SMS:\r\nstat_p->dtap_sms_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_SM:\r\nstat_p->dtap_sm_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_SS:\r\nstat_p->dtap_ss_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase PD_TP:\r\nstat_p->dtap_tp_message_type[tap_p->message_type]++;\r\nbreak;\r\ndefault:\r\nreturn(0);\r\n}\r\nbreak;\r\ncase GSM_A_PDU_TYPE_SACCH:\r\nswitch (tap_p->protocol_disc)\r\n{\r\ncase 0:\r\nstat_p->sacch_rr_message_type[tap_p->message_type]++;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nreturn(0);\r\n}\r\nreturn(1);\r\n}\r\nstatic void\r\ngsm_a_stat_draw(\r\nvoid *tapdata)\r\n{\r\ngsm_a_stat_t *stat_p = (gsm_a_stat_t *)tapdata;\r\nguint8 i;\r\nprintf("\n");\r\nprintf("=========== GS=M A-i/f Statistics ============================\n");\r\nprintf("BSSMAP\n");\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_bssmap_msg_strings[i].strptr)\r\n{\r\nif (stat_p->bssmap_message_type[gsm_a_bssmap_msg_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_bssmap_msg_strings[i].value,\r\ngsm_a_bssmap_msg_strings[i].strptr,\r\nstat_p->bssmap_message_type[gsm_a_bssmap_msg_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_MM]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_mm_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_mm_message_type[gsm_a_dtap_msg_mm_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_mm_strings[i].value,\r\ngsm_a_dtap_msg_mm_strings[i].strptr,\r\nstat_p->dtap_mm_message_type[gsm_a_dtap_msg_mm_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_RR]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_rr_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_rr_message_type[gsm_a_dtap_msg_rr_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_rr_strings[i].value,\r\ngsm_a_dtap_msg_rr_strings[i].strptr,\r\nstat_p->dtap_rr_message_type[gsm_a_dtap_msg_rr_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_CC]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_cc_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_cc_message_type[gsm_a_dtap_msg_cc_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_cc_strings[i].value,\r\ngsm_a_dtap_msg_cc_strings[i].strptr,\r\nstat_p->dtap_cc_message_type[gsm_a_dtap_msg_cc_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_GMM]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_gmm_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_gmm_message_type[gsm_a_dtap_msg_gmm_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_gmm_strings[i].value,\r\ngsm_a_dtap_msg_gmm_strings[i].strptr,\r\nstat_p->dtap_gmm_message_type[gsm_a_dtap_msg_gmm_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_SMS]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_sms_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_sms_message_type[gsm_a_dtap_msg_sms_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_sms_strings[i].value,\r\ngsm_a_dtap_msg_sms_strings[i].strptr,\r\nstat_p->dtap_sms_message_type[gsm_a_dtap_msg_sms_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_SM]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_sm_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_sm_message_type[gsm_a_dtap_msg_sm_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_sm_strings[i].value,\r\ngsm_a_dtap_msg_sm_strings[i].strptr,\r\nstat_p->dtap_sm_message_type[gsm_a_dtap_msg_sm_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_SS]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_ss_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_ss_message_type[gsm_a_dtap_msg_ss_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_ss_strings[i].value,\r\ngsm_a_dtap_msg_ss_strings[i].strptr,\r\nstat_p->dtap_ss_message_type[gsm_a_dtap_msg_ss_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP %s\n", gsm_a_pd_str[PD_TP]);\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_dtap_msg_tp_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_tp_message_type[gsm_a_dtap_msg_tp_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_dtap_msg_tp_strings[i].value,\r\ngsm_a_dtap_msg_tp_strings[i].strptr,\r\nstat_p->dtap_tp_message_type[gsm_a_dtap_msg_tp_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nSACCH Radio Resources Management messages\n");\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (gsm_a_rr_short_pd_msg_strings[i].strptr)\r\n{\r\nif (stat_p->sacch_rr_message_type[gsm_a_rr_short_pd_msg_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\ngsm_a_rr_short_pd_msg_strings[i].value,\r\ngsm_a_rr_short_pd_msg_strings[i].strptr,\r\nstat_p->sacch_rr_message_type[gsm_a_rr_short_pd_msg_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("==============================================================\n");\r\n}\r\nstatic void\r\ngsm_a_stat_init(const char *opt_arg _U_, void *userdata _U_)\r\n{\r\ngsm_a_stat_t *stat_p;\r\nGString *err_p;\r\nstat_p = g_new(gsm_a_stat_t, 1);\r\nmemset(stat_p, 0, sizeof(gsm_a_stat_t));\r\nerr_p =\r\nregister_tap_listener("gsm_a", stat_p, NULL, 0,\r\nNULL,\r\ngsm_a_stat_packet,\r\ngsm_a_stat_draw);\r\nif (err_p != NULL)\r\n{\r\ng_free(stat_p);\r\ng_string_free(err_p, TRUE);\r\nexit(1);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_gsm_astat(void)\r\n{\r\nregister_stat_tap_ui(&gsm_a_stat_ui, NULL);\r\n}
