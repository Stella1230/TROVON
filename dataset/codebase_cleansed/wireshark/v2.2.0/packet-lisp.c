static int\r\nget_lcaf_data(tvbuff_t *tvb, gint offset, guint8 *lcaf_type, guint16 *len)\r\n{\r\noffset += 2;\r\nif (lcaf_type)\r\n*lcaf_type = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\noffset += 1;\r\nif (len)\r\n*len = tvb_get_ntohs(tvb, offset) + LCAF_HEADER_LEN;\r\noffset += 2;\r\nreturn offset;\r\n}\r\nstatic const gchar *\r\nget_addr_str(tvbuff_t *tvb, gint offset, guint16 afi, guint16 *addr_len)\r\n{\r\nconst gchar *notset_str = "not set";\r\nconst gchar *addr_str;\r\nguint8 lcaf_type;\r\nguint32 iid, asn;\r\nguint16 cur_len;\r\nswitch (afi) {\r\ncase AFNUM_RESERVED:\r\n*addr_len = 0;\r\nreturn notset_str;\r\ncase AFNUM_INET:\r\n*addr_len = INET_ADDRLEN;\r\naddr_str = tvb_ip_to_str(tvb, offset);\r\nreturn addr_str;\r\ncase AFNUM_INET6:\r\n*addr_len = INET6_ADDRLEN;\r\naddr_str = tvb_ip6_to_str(tvb, offset);\r\nreturn addr_str;\r\ncase AFNUM_LCAF:\r\nget_lcaf_data(tvb, offset, &lcaf_type, addr_len);\r\naddr_str = val_to_str(lcaf_type, lcaf_typevals, "Unknown LCAF Type (%d)");\r\nif (lcaf_type == LCAF_IID) {\r\niid = tvb_get_ntohl(tvb, offset + LCAF_HEADER_LEN);\r\nafi = tvb_get_ntohs(tvb, offset + LCAF_HEADER_LEN + 4);\r\naddr_str = get_addr_str(tvb, offset + LCAF_HEADER_LEN + 6, afi, &cur_len);\r\nreturn wmem_strdup_printf(wmem_packet_scope(), "[%d] %s", iid, addr_str);\r\n}\r\nif (lcaf_type == LCAF_ASN) {\r\nasn = tvb_get_ntohl(tvb, offset + LCAF_HEADER_LEN);\r\nafi = tvb_get_ntohs(tvb, offset + LCAF_HEADER_LEN + 4);\r\naddr_str = get_addr_str(tvb, offset + LCAF_HEADER_LEN + 6, afi, &cur_len);\r\nreturn wmem_strdup_printf(wmem_packet_scope(), "%s (ASN %d)", addr_str, asn);\r\n}\r\nreturn addr_str;\r\ncase AFNUM_EUI48:\r\n*addr_len = EUI48_ADDRLEN;\r\naddr_str = tvb_ether_to_str(tvb, offset);\r\nreturn addr_str;\r\ndefault:\r\nreturn NULL;\r\n}\r\n}\r\nstatic int\r\ndissect_lcaf_natt_rloc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, const gchar *str, int idx)\r\n{\r\nguint16 addr_len = 0;\r\nguint16 rloc_afi;\r\nconst gchar *rloc_str;\r\nproto_item *ti;\r\nproto_tree *rloc_tree;\r\nti = proto_tree_add_item(tree, hf_lisp_lcaf_natt_rloc, tvb, offset, 2, ENC_NA);\r\nrloc_tree = proto_item_add_subtree(ti, ett_lisp_lcaf_natt_rloc);\r\nproto_tree_add_item(rloc_tree, hf_lisp_lcaf_natt_rloc_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nrloc_afi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nrloc_str = get_addr_str(tvb, offset, rloc_afi, &addr_len);\r\nswitch (rloc_afi) {\r\ncase AFNUM_RESERVED:\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(rloc_tree, hf_lisp_lcaf_natt_rloc_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(rloc_tree, hf_lisp_lcaf_natt_rloc_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\nbreak;\r\ncase AFNUM_LCAF:\r\ndissect_lcaf(tvb, pinfo, rloc_tree, offset, NULL);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, rloc_tree, &ei_lisp_unexpected_field,\r\n"Unexpected NAT-T RLOC AFI (%d), cannot decode", rloc_afi);\r\n}\r\nif (idx) {\r\nproto_item_append_text(ti, str, idx, rloc_str);\r\n} else {\r\nproto_item_append_text(ti, str, rloc_str);\r\n}\r\nproto_item_set_len(ti, 2 + addr_len);\r\nreturn addr_len + 2;\r\n}\r\nstatic int\r\ndissect_lcaf_elp_hop(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, int idx, proto_item *tip)\r\n{\r\nguint16 addr_len = 0;\r\nguint16 hop_afi;\r\nguint16 hop_flags;\r\nconst gchar *hop_str;\r\nproto_item *ti, *ti_flags;\r\nproto_tree *hop_tree, *flags_tree;\r\nti = proto_tree_add_item(tree, hf_lisp_lcaf_elp_hop, tvb, offset, 2, ENC_NA);\r\nhop_tree = proto_item_add_subtree(ti, ett_lisp_lcaf_elp_hop);\r\nti_flags = proto_tree_add_item(hop_tree, hf_lisp_lcaf_elp_hop_flags, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nflags_tree = proto_item_add_subtree(ti_flags, ett_lisp_lcaf_elp_hop_flags);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_elp_hop_flags_res, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_elp_hop_flags_lookup, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_elp_hop_flags_probe, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_elp_hop_flags_strict, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nhop_flags = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nproto_tree_add_item(hop_tree, hf_lisp_lcaf_elp_hop_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nhop_afi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nhop_str = get_addr_str(tvb, offset, hop_afi, &addr_len);\r\nswitch (hop_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(hop_tree, hf_lisp_lcaf_elp_hop_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(hop_tree, hf_lisp_lcaf_elp_hop_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\nbreak;\r\ncase AFNUM_LCAF:\r\ndissect_lcaf(tvb, pinfo, hop_tree, offset, NULL);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, hop_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Reencap Hop AFI (%d), cannot decode", hop_afi);\r\n}\r\nif (idx) {\r\nproto_item_append_text(ti, " %d.", idx);\r\n} else {\r\nproto_item_append_text(ti, ":");\r\n}\r\nproto_item_append_text(ti, " %s", hop_str);\r\nproto_item_set_len(ti, 4 + addr_len);\r\nif (hop_flags & 0x04)\r\nproto_item_append_text(ti, ", Lookup");\r\nif (hop_flags & 0x02)\r\nproto_item_append_text(ti, ", RLOC-Probe");\r\nif (hop_flags & 0x01)\r\nproto_item_append_text(ti, ", Strict");\r\nproto_item_append_text(tip, ", %s", hop_str);\r\nreturn addr_len + 4;\r\n}\r\nstatic int\r\ndissect_lcaf_rle_entry(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, int idx, proto_item *tip)\r\n{\r\nguint8 level;\r\nguint16 addr_len = 0;\r\nguint16 entry_afi;\r\nconst gchar *entry_str;\r\nproto_item *ti;\r\nproto_tree *entry_tree;\r\nti = proto_tree_add_item(tree, hf_lisp_lcaf_rle_entry, tvb, offset, 2, ENC_NA);\r\nentry_tree = proto_item_add_subtree(ti, ett_lisp_lcaf_rle_entry);\r\nproto_tree_add_item(entry_tree, hf_lisp_lcaf_rle_entry_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(entry_tree, hf_lisp_lcaf_rle_entry_level, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nlevel = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(entry_tree, hf_lisp_lcaf_rle_entry_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nentry_afi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nentry_str = get_addr_str(tvb, offset, entry_afi, &addr_len);\r\nswitch (entry_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(entry_tree, hf_lisp_lcaf_rle_entry_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(entry_tree, hf_lisp_lcaf_rle_entry_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\nbreak;\r\ncase AFNUM_LCAF:\r\ndissect_lcaf(tvb, pinfo, entry_tree, offset, NULL);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, entry_tree, &ei_lisp_unexpected_field,\r\n"Unexpected RTR/ETR AFI (%d), cannot decode", entry_afi);\r\n}\r\nif (idx) {\r\nproto_item_append_text(ti, " %d.", idx);\r\n} else {\r\nproto_item_append_text(ti, ":");\r\n}\r\nproto_item_append_text(ti, " %s, level %d", entry_str, level);\r\nproto_item_set_len(ti, 6 + addr_len);\r\nproto_item_append_text(tip, ", %s (%d)", entry_str, level);\r\nreturn addr_len + 6;\r\n}\r\nstatic int\r\ndissect_lcaf_afi_list(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, guint16 length)\r\n{\r\ngint old_offset;\r\ngint remaining = length;\r\ngint i = 1;\r\nguint16 addr_len = 0;\r\nguint16 afi;\r\nconst gchar *lcaf_str;\r\nproto_item *tir;\r\nproto_tree *lisp_afi_list_tree;\r\nwhile (remaining > 0) {\r\nafi = tvb_get_ntohs(tvb, offset);\r\ntir = proto_tree_add_item(tree, hf_lisp_lcaf_afi_list_item, tvb, offset, LCAF_HEADER_LEN, ENC_NA);\r\nlisp_afi_list_tree = proto_item_add_subtree(tir, ett_lisp_afi_list);\r\nproto_tree_add_item(lisp_afi_list_tree, hf_lisp_lcaf_afi_list_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nremaining -= 2;\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(lisp_afi_list_tree, hf_lisp_lcaf_afi_list_ipv4, tvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tir, " %d. IPv4 Address: %s", i, tvb_ip_to_str(tvb, offset));\r\nproto_item_set_len(tir, 2 + INET_ADDRLEN);\r\noffset += INET_ADDRLEN;\r\nremaining -= INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(lisp_afi_list_tree, hf_lisp_lcaf_afi_list_ipv6, tvb, offset, INET6_ADDRLEN, ENC_NA);\r\nproto_item_append_text(tir, " %d. IPv6 Address: %s", i, tvb_ip6_to_str(tvb, offset));\r\nproto_item_set_len(tir, 2 + INET6_ADDRLEN);\r\noffset += INET6_ADDRLEN;\r\nremaining -= INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\nold_offset = offset;\r\nlcaf_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nproto_item_append_text(tir, " %d. %s", i, lcaf_str);\r\nproto_item_set_len(tir, 2 + addr_len);\r\noffset = dissect_lcaf(tvb, pinfo, lisp_afi_list_tree, offset, tir);\r\nremaining -= (offset - old_offset);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(lisp_afi_list_tree, hf_lisp_lcaf_afi_list_mac, tvb, offset, EUI48_ADDRLEN, ENC_NA);\r\nproto_item_append_text(tir, " %d. MAC Address: %s", i, tvb_ether_to_str(tvb, offset));\r\nproto_item_set_len(tir, 2 + EUI48_ADDRLEN);\r\noffset += EUI48_ADDRLEN;\r\nremaining -= EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_unexpected_field,\r\n"Unexpected AFI (%d), cannot decode", afi);\r\nreturn -1;\r\n}\r\ni++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_iid(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, proto_item *tip)\r\n{\r\nconst gchar *ip_address;\r\nguint16 afi, addr_len = 0;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_iid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tip, ": %d", tvb_get_ntohl(tvb, offset));\r\noffset += 4;\r\nafi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_lisp_lcaf_iid_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nip_address = get_addr_str(tvb, offset, afi, &addr_len);\r\nif (ip_address && afi)\r\nproto_item_append_text(tip, ", Address: %s", ip_address);\r\nswitch (afi) {\r\ncase AFNUM_RESERVED:\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_iid_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_iid_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_iid_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_unexpected_field,\r\n"Unexpected Instance ID AFI (%d), cannot decode", afi);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_asn(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, proto_item *tip)\r\n{\r\nconst gchar *addr;\r\nguint16 afi, addr_len = 0;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_asn, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tip, ": %d", tvb_get_ntohl(tvb, offset));\r\noffset += 4;\r\nafi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_lisp_lcaf_asn_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\naddr = get_addr_str(tvb, offset, afi, &addr_len);\r\nif (addr && afi)\r\nproto_item_append_text(tip, ", Address: %s", addr);\r\nswitch (afi) {\r\ncase AFNUM_RESERVED:\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_asn_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_asn_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_asn_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_unexpected_field,\r\n"Unexpected Instance ID AFI (%d), cannot decode", afi);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_geo(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, proto_item *tir)\r\n{\r\nguint16 addr_len = 0;\r\ngboolean north, east;\r\nguint16 deg;\r\nguint8 min, sec;\r\nguint32 alt;\r\nguint16 afi;\r\nconst gchar *ip_address;\r\nconst guint16 mask = 0x7FFF;\r\nproto_item *ti_lat, *ti_lon, *ti_alt;\r\nproto_tree *lat_tree, *lon_tree;\r\nti_lat = proto_tree_add_item(tree, hf_lisp_lcaf_geo_lat, tvb, offset, 4, ENC_NA);\r\nlat_tree = proto_item_add_subtree(ti_lat, ett_lisp_lcaf_geo_lat);\r\nproto_tree_add_item(lat_tree, hf_lisp_lcaf_geo_lat_hemisphere, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lat_tree, hf_lisp_lcaf_geo_lat_deg, tvb, offset, 2, ENC_BIG_ENDIAN);\r\ndeg = tvb_get_ntohs(tvb, offset);\r\nnorth = deg >> 15;\r\ndeg &= mask;\r\nif (deg > 90)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid latitude degrees value (%d)", deg);\r\noffset += 2;\r\nproto_tree_add_item(lat_tree, hf_lisp_lcaf_geo_lat_min, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nmin = tvb_get_guint8(tvb, offset);\r\nif (min > 60)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid latitude minutes value (%d)", min);\r\noffset += 1;\r\nproto_tree_add_item(lat_tree, hf_lisp_lcaf_geo_lat_sec, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nsec = tvb_get_guint8(tvb, offset);\r\nif (sec > 60)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid latitude seconds value (%d)", min);\r\noffset += 1;\r\nproto_item_append_text(ti_lat, ": %s %d" UTF8_DEGREE_SIGN "%d' %d\"",\r\nval_to_str_const(north, lat_typevals, ""), deg, min, sec);\r\nproto_item_append_text(tir, ": (%s%d" UTF8_DEGREE_SIGN "%d'%d\"",\r\nval_to_str_const(north, lat_typevals, ""), deg, min, sec);\r\nti_lon = proto_tree_add_item(tree, hf_lisp_lcaf_geo_lon, tvb, offset, 4, ENC_NA);\r\nlon_tree = proto_item_add_subtree(ti_lon, ett_lisp_lcaf_geo_lon);\r\nproto_tree_add_item(lon_tree, hf_lisp_lcaf_geo_lon_hemisphere, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lon_tree, hf_lisp_lcaf_geo_lon_deg, tvb, offset, 2, ENC_BIG_ENDIAN);\r\ndeg = tvb_get_ntohs(tvb, offset);\r\neast = deg >> 15;\r\ndeg &= mask;\r\nif (deg > 180)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid longitude degrees value (%d)", deg);\r\noffset += 2;\r\nproto_tree_add_item(lon_tree, hf_lisp_lcaf_geo_lon_min, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nmin = tvb_get_guint8(tvb, offset);\r\nif (min > 60)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid longitude minutes value (%d)", min);\r\noffset += 1;\r\nproto_tree_add_item(lon_tree, hf_lisp_lcaf_geo_lon_sec, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nsec = tvb_get_guint8(tvb, offset);\r\nif (sec > 60)\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_invalid_field,\r\n"Invalid longitude seconds value (%d)", min);\r\noffset += 1;\r\nproto_item_append_text(ti_lon, ": %s %d" UTF8_DEGREE_SIGN " %d' %d\"",\r\nval_to_str_const(east, lon_typevals, ""), deg, min, sec);\r\nproto_item_append_text(tir, ", %s%d" UTF8_DEGREE_SIGN "%d'%d\")",\r\nval_to_str_const(east, lon_typevals, ""), deg, min, sec);\r\nti_alt = proto_tree_add_item(tree, hf_lisp_lcaf_geo_alt, tvb, offset, 4, ENC_NA);\r\nalt = tvb_get_ntohl(tvb, offset);\r\nif (alt == 0x7fffffff) {\r\nproto_item_append_text(ti_alt, ": no value encoded");\r\n} else {\r\nproto_item_append_text(ti_alt, ": %d m", alt);\r\nproto_item_append_text(tir, ", Altitude: %d m", alt);\r\n}\r\noffset += 4;\r\nafi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_lisp_lcaf_geo_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nip_address = get_addr_str(tvb, offset, afi, &addr_len);\r\nif (ip_address && afi)\r\nproto_item_append_text(tir, ", Address: %s", ip_address);\r\nswitch (afi) {\r\ncase AFNUM_RESERVED:\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_geo_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_geo_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_geo_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_unexpected_field,\r\n"Unexpected Geo Coordinates AFI (%d), cannot decode", afi);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_natt(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, guint16 length)\r\n{\r\ngint i;\r\ngint len;\r\ngint remaining = length;\r\nconst gchar *global_etr = " of Global ETR: %s";\r\nconst gchar *ms = " of MS: %s";\r\nconst gchar *private_etr = " of Private ETR: %s";\r\nconst gchar *rtr = " of RTR %d: %s";\r\nremaining -= 4;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_natt_msport, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nremaining -= 2;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_natt_etrport, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nremaining -= 2;\r\nlen = dissect_lcaf_natt_rloc(tvb, pinfo, tree, offset, global_etr, 0);\r\noffset += len;\r\nremaining -= len;\r\nlen = dissect_lcaf_natt_rloc(tvb, pinfo, tree, offset, ms, 0);\r\noffset += len;\r\nremaining -= len;\r\nlen = dissect_lcaf_natt_rloc(tvb, pinfo, tree, offset, private_etr, 0);\r\noffset += len;\r\nremaining -= len;\r\ni = 1;\r\nwhile (remaining > 0) {\r\nlen = dissect_lcaf_natt_rloc(tvb, pinfo, tree, offset, rtr, i);\r\noffset += len;\r\nremaining -= len;\r\ni++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_nonce_loc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, proto_item *tip)\r\n{\r\nconst gchar *addr;\r\nguint16 afi, addr_len = 0;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tip, ": %d", tvb_get_ntohl(tvb, offset));\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tip, ": %d", tvb_get_ntohl(tvb, offset));\r\noffset += 3;\r\nafi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\naddr = get_addr_str(tvb, offset, afi, &addr_len);\r\nif (addr && afi)\r\nproto_item_append_text(tip, ", Address: %s", addr);\r\nswitch (afi) {\r\ncase AFNUM_RESERVED:\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(tree, hf_lisp_lcaf_nonce_loc_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, tree, &ei_lisp_unexpected_field,\r\n"Unexpected Instance ID AFI (%d), cannot decode", afi);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_mcast_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, proto_item *tir)\r\n{\r\nguint8 src_masklen, grp_masklen;\r\nguint16 afi, addr_len = 0;\r\nguint32 iid;\r\nconst gchar *src_str, *grp_str;\r\nproto_item *ti_src, *ti_grp;\r\nproto_tree *src_tree, *grp_tree;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_iid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\niid = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_res, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_src_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nsrc_masklen = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_grp_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ngrp_masklen = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nti_src = proto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_src, tvb, offset, 2, ENC_NA);\r\nsrc_tree = proto_item_add_subtree(ti_src, ett_lisp_lcaf_mcinfo_src);\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_mcinfo_src_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nsrc_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_mcinfo_src_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_mcinfo_src_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, src_tree, offset, NULL);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, src_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Source Prefix AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_src, ": %s", src_str);\r\nproto_item_set_len(ti_src, 2 + addr_len);\r\nti_grp = proto_tree_add_item(tree, hf_lisp_lcaf_mcinfo_grp, tvb, offset, 2, ENC_NA);\r\ngrp_tree = proto_item_add_subtree(ti_grp, ett_lisp_lcaf_mcinfo_grp);\r\nproto_tree_add_item(grp_tree, hf_lisp_lcaf_mcinfo_grp_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\ngrp_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(grp_tree, hf_lisp_lcaf_mcinfo_grp_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(grp_tree, hf_lisp_lcaf_mcinfo_grp_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, grp_tree, offset, NULL);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, grp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Destination Prefix AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_grp, ": %s", grp_str);\r\nproto_item_set_len(ti_grp, 2 + addr_len);\r\nproto_item_append_text(tir, " ([%d], %s/%d, %s/%d)", iid, src_str, src_masklen, grp_str, grp_masklen);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_elp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, guint16 length, proto_item *tir)\r\n{\r\ngint len;\r\ngint remaining = length;\r\ngint i = 1;\r\nwhile (remaining > 0) {\r\nlen = dissect_lcaf_elp_hop(tvb, pinfo, tree, offset, i, tir);\r\noffset += len;\r\nremaining -= len;\r\ni++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_src_dst_key(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, proto_item *tir)\r\n{\r\nguint8 src_masklen, dst_masklen;\r\nguint16 afi, addr_len = 0;\r\nconst gchar *src_str, *dst_str;\r\nproto_item *ti_src, *ti_dst;\r\nproto_tree *src_tree, *dst_tree;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_srcdst_res, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_srcdst_src_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nsrc_masklen = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_lisp_lcaf_srcdst_dst_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ndst_masklen = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nti_src = proto_tree_add_item(tree, hf_lisp_lcaf_srcdst_src, tvb, offset, 2, ENC_NA);\r\nsrc_tree = proto_item_add_subtree(ti_src, ett_lisp_lcaf_srcdst_src);\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_srcdst_src_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nsrc_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_srcdst_src_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_srcdst_src_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, src_tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(src_tree, hf_lisp_lcaf_srcdst_src_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, src_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Source Prefix AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_src, ": %s", src_str);\r\nproto_item_set_len(ti_src, 2 + addr_len);\r\nti_dst = proto_tree_add_item(tree, hf_lisp_lcaf_srcdst_dst, tvb, offset, 2, ENC_NA);\r\ndst_tree = proto_item_add_subtree(ti_dst, ett_lisp_lcaf_srcdst_dst);\r\nproto_tree_add_item(dst_tree, hf_lisp_lcaf_srcdst_dst_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\ndst_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(dst_tree, hf_lisp_lcaf_srcdst_dst_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(dst_tree, hf_lisp_lcaf_srcdst_dst_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, dst_tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(dst_tree, hf_lisp_lcaf_srcdst_dst_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, dst_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Destination Prefix AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_dst, ": %s", dst_str);\r\nproto_item_set_len(ti_dst, 2 + addr_len);\r\nproto_item_append_text(tir, " (%s/%d, %s/%d)", src_str, src_masklen, dst_str, dst_masklen);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_rle(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset, guint16 length, proto_item *tir)\r\n{\r\ngint len;\r\ngint remaining = length;\r\ngint i = 1;\r\nwhile (remaining > 0) {\r\nlen = dissect_lcaf_rle_entry(tvb, pinfo, tree, offset, i, tir);\r\noffset += len;\r\nremaining -= len;\r\ni++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf_kv_addr_pair(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\ngint offset)\r\n{\r\nguint16 afi, addr_len = 0;\r\nconst gchar *key_str, *value_str;\r\nproto_item *ti_key, *ti_value;\r\nproto_tree *key_tree, *value_tree;\r\nti_key = proto_tree_add_item(tree, hf_lisp_lcaf_kv_key, tvb, offset, 2, ENC_NA);\r\nkey_tree = proto_item_add_subtree(ti_key, ett_lisp_lcaf_kv_key);\r\nproto_tree_add_item(key_tree, hf_lisp_lcaf_kv_key_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nkey_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(key_tree, hf_lisp_lcaf_kv_key_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(key_tree, hf_lisp_lcaf_kv_key_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, key_tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(key_tree, hf_lisp_lcaf_kv_key_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, key_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Key AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_key, ": %s", key_str);\r\nproto_item_set_len(ti_key, 2 + addr_len);\r\nti_value = proto_tree_add_item(tree, hf_lisp_lcaf_kv_value, tvb, offset, 2, ENC_NA);\r\nvalue_tree = proto_item_add_subtree(ti_value, ett_lisp_lcaf_kv_value);\r\nproto_tree_add_item(value_tree, hf_lisp_lcaf_kv_value_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nvalue_str = get_addr_str(tvb, offset, afi, &addr_len);\r\nswitch (afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(value_tree, hf_lisp_lcaf_kv_value_ipv4,\r\ntvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(value_tree, hf_lisp_lcaf_kv_value_ipv6,\r\ntvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\noffset = dissect_lcaf(tvb, pinfo, value_tree, offset, NULL);\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(value_tree, hf_lisp_lcaf_kv_value_mac,\r\ntvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, value_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Value AFI (%d), cannot decode", afi);\r\n}\r\nproto_item_append_text(ti_value, ": %s", value_str);\r\nproto_item_set_len(ti_value, 2 + addr_len);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lcaf(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, proto_item *tip)\r\n{\r\nguint8 lcaf_type;\r\nguint16 len;\r\nproto_item *tir, *ti_header, *ti_flags, *ti;\r\nproto_tree *lcaf_tree, *lcaf_header_tree, *flags_tree;\r\nlen = tvb_get_ntohs(tvb, offset + 4);\r\ntir = proto_tree_add_item(tree, hf_lisp_lcaf, tvb, offset, LCAF_HEADER_LEN + len, ENC_NA);\r\nlcaf_tree = proto_item_add_subtree(tir, ett_lisp_lcaf);\r\nti_header = proto_tree_add_item(lcaf_tree, hf_lisp_lcaf_header, tvb, offset, LCAF_HEADER_LEN, ENC_NA);\r\nlcaf_header_tree = proto_item_add_subtree(ti_header, ett_lisp_lcaf_header);\r\nproto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_res1, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_flags, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nlcaf_type = tvb_get_guint8(tvb, offset);\r\nproto_item_append_text(tir, ": %s", val_to_str(lcaf_type, lcaf_typevals, "Unknown (%d)"));\r\noffset += 1;\r\nif (lcaf_type == LCAF_MCAST_INFO) {\r\nti_flags = proto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_mcinfo_flags, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nflags_tree = proto_item_add_subtree(ti_flags, ett_lisp_lcaf_mcinfo_flags);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_mcinfo_flags_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_mcinfo_flags_rp, tvb, offset, 1, ENC_NA);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_mcinfo_flags_leave, tvb, offset, 1, ENC_NA);\r\nproto_tree_add_item(flags_tree, hf_lisp_lcaf_mcinfo_flags_join, tvb, offset, 1, ENC_NA);\r\n} else {\r\nproto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_res2, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\noffset += 1;\r\nproto_tree_add_item(lcaf_header_tree, hf_lisp_lcaf_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nti = (tip) ? tip : tir;\r\nswitch (lcaf_type) {\r\ncase LCAF_NULL:\r\nbreak;\r\ncase LCAF_AFI_LIST:\r\noffset = dissect_lcaf_afi_list(tvb, pinfo, lcaf_tree, offset, len);\r\nbreak;\r\ncase LCAF_IID:\r\noffset = dissect_lcaf_iid(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_ASN:\r\noffset = dissect_lcaf_asn(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_GEO:\r\noffset = dissect_lcaf_geo(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_NATT:\r\noffset = dissect_lcaf_natt(tvb, pinfo, lcaf_tree, offset, len);\r\nbreak;\r\ncase LCAF_NONCE_LOC:\r\noffset = dissect_lcaf_nonce_loc(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_MCAST_INFO:\r\noffset = dissect_lcaf_mcast_info(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_ELP:\r\noffset = dissect_lcaf_elp(tvb, pinfo, lcaf_tree, offset, len, ti);\r\nbreak;\r\ncase LCAF_SRC_DST_KEY:\r\noffset = dissect_lcaf_src_dst_key(tvb, pinfo, lcaf_tree, offset, ti);\r\nbreak;\r\ncase LCAF_RLE:\r\noffset = dissect_lcaf_rle(tvb, pinfo, lcaf_tree, offset, len, ti);\r\nbreak;\r\ncase LCAF_KV_ADDR_PAIR:\r\noffset = dissect_lcaf_kv_addr_pair(tvb, pinfo, lcaf_tree, offset);\r\nbreak;\r\ndefault:\r\nif (lcaf_type < 16)\r\nproto_tree_add_expert(tree, pinfo, &ei_lisp_undecoded, tvb, offset, len);\r\nelse\r\nexpert_add_info_format(pinfo, lcaf_tree, &ei_lisp_lcaf_type,\r\n"LCAF type %d is not defined in draft-ietf-lisp-lcaf-%s",\r\nlcaf_type, LCAF_DRAFT_VERSION);\r\nreturn offset + len;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lisp_locator(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_mapping_tree, int rec)\r\n{\r\ngint offset = 0;\r\nguint16 addr_len = 0;\r\nguint8 prio;\r\nguint8 weight;\r\nguint8 m_prio;\r\nguint8 m_weight;\r\nguint16 flags;\r\nguint16 loc_afi;\r\nconst gchar *locator;\r\nproto_item *tir, *ti_flags;\r\nproto_tree *lisp_lcaf_tree, *lisp_loc_tree, *lisp_flags_tree;\r\ntir = proto_tree_add_item(lisp_mapping_tree, hf_lisp_loc, tvb, offset, 8, ENC_NA);\r\nlisp_loc_tree = proto_item_add_subtree(tir, ett_lisp_loc);\r\nproto_tree_add_item(lisp_loc_tree, hf_lisp_loc_priority, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nprio = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(lisp_loc_tree, hf_lisp_loc_weight, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nweight = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(lisp_loc_tree, hf_lisp_loc_mpriority, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nm_prio = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(lisp_loc_tree, hf_lisp_loc_mweight, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nm_weight = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nti_flags = proto_tree_add_item(lisp_loc_tree, hf_lisp_loc_flags, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nlisp_flags_tree = proto_item_add_subtree(ti_flags, ett_lisp_loc_flags);\r\nproto_tree_add_item(lisp_flags_tree, hf_lisp_loc_flags_res, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_flags_tree, hf_lisp_loc_flags_local, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_flags_tree, hf_lisp_loc_flags_probe, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_flags_tree, hf_lisp_loc_flags_reach, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nflags = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nproto_tree_add_item(lisp_loc_tree, hf_lisp_loc_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nloc_afi = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nlocator = get_addr_str(tvb, offset, loc_afi, &addr_len);\r\nif (locator == NULL) {\r\nexpert_add_info_format(pinfo, lisp_mapping_tree, &ei_lisp_unexpected_field,\r\n"Unexpected locator AFI (%d), cannot decode", loc_afi);\r\nreturn offset;\r\n}\r\nif (loc_afi == AFNUM_LCAF) {\r\nlisp_lcaf_tree = proto_item_add_subtree(tir, ett_lisp_lcaf);\r\noffset = dissect_lcaf(tvb, pinfo, lisp_lcaf_tree, offset, NULL);\r\n} else {\r\nproto_tree_add_string(lisp_loc_tree, hf_lisp_loc_locator, tvb, offset, addr_len, locator);\r\noffset += addr_len;\r\n}\r\nproto_item_append_text(tir, " %d, %sRLOC: %s%s, %s, Priority/Weight: %d/%d, Multicast Priority/Weight: %d/%d",\r\nrec,\r\n(flags&LOCAL_BIT_MASK) ? "Local " : "",\r\nlocator,\r\n(flags&PROBE_BIT_MASK) ? " (probed)" : "",\r\n(flags&REACH_BIT_MASK) ? "Reachable" : "Unreachable",\r\nprio, weight, m_prio, m_weight);\r\nproto_item_set_len(tir, 8 + addr_len);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_lisp_mapping(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree,\r\nguint8 rec_cnt, int rec, gboolean referral)\r\n{\r\nint i;\r\ngint offset = 0;\r\nguint16 addr_len = 0;\r\nguint8 prefix_mask, loc_cnt;\r\nguint16 flags;\r\nguint16 act;\r\nguint16 prefix_afi, eid_afi;\r\nconst gchar *prefix;\r\nproto_item *tir, *ti_lcaf_prefix;\r\nproto_tree *lisp_mapping_tree, *lcaf_prefix_tree;\r\nprefix_mask = tvb_get_guint8(tvb, 5);\r\nflags = tvb_get_ntohs(tvb, 6);\r\nprefix_afi = tvb_get_ntohs(tvb, 10);\r\nact = flags & LISP_MAP_ACT;\r\nact >>= 13;\r\nprefix = get_addr_str(tvb, 12, prefix_afi, &addr_len);\r\nif (prefix == NULL) {\r\nexpert_add_info_format(pinfo, lisp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected EID prefix AFI (%d), cannot decode", prefix_afi);\r\nreturn offset;\r\n}\r\ntir = proto_tree_add_item(lisp_tree, hf_lisp_mapping, tvb, 0, 12 + addr_len, ENC_NA);\r\nif (rec_cnt == 1)\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " for %s/%d",\r\nprefix, prefix_mask);\r\nlisp_mapping_tree = proto_item_add_subtree(tir, ett_lisp_mapping);\r\nproto_item_append_text(tir, " %d, EID Prefix: %s/%d", rec, prefix, prefix_mask);\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_ttl, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nif (tvb_get_ntohl(tvb, offset) == 0xFFFFFFFF) {\r\nproto_item_append_text(tir, ", TTL: Unlimited");\r\n} else {\r\nproto_item_append_text(tir, ", TTL: %d", tvb_get_ntohl(tvb, offset));\r\n}\r\noffset += 4;\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_loccnt, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nloc_cnt = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_act, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tir, ", %s%s%s",\r\n(referral) ? "" : "Action: ",\r\nval_to_str(act, (referral) ? referral_actions : mapping_actions, "Invalid action code (%d)"),\r\n(referral&&(flags&REFERRAL_INCOMPLETE)) ? " (Incomplete)" : "");\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_auth, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nif (flags&LISP_MAP_AUTH) {\r\nproto_item_append_text(tir, ", Authoritative");\r\n} else {\r\nproto_item_append_text(tir, ", Not Authoritative");\r\n}\r\nif (referral)\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_referral_incomplete, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_res1, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (referral) {\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_referral_sigcnt, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_res2, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n}\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_ver, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\neid_afi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nswitch (eid_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_ipv4, tvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_ipv6, tvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\nti_lcaf_prefix = proto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_lcaf, tvb, offset, addr_len, ENC_ASCII|ENC_NA);\r\nproto_item_append_text(ti_lcaf_prefix, "%s", prefix);\r\nlcaf_prefix_tree = proto_item_add_subtree(ti_lcaf_prefix, ett_lisp_lcaf);\r\ndissect_lcaf(tvb, pinfo, lcaf_prefix_tree, offset, NULL);\r\noffset += addr_len;\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(lisp_mapping_tree, hf_lisp_mapping_eid_mac, tvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\n}\r\nfor(i=0; i < loc_cnt; i++) {\r\ntvbuff_t *loc_tvb;\r\nint len = 0;\r\nloc_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_locator(loc_tvb, pinfo, lisp_mapping_tree, i+1);\r\noffset += len;\r\n}\r\nreturn offset;\r\n}\r\nstatic void\r\ndissect_lisp_map_request(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\nint i;\r\nguint16 addr_len = 0;\r\ngint offset = 0;\r\nguint16 flags;\r\ngboolean mrep;\r\ngboolean smr;\r\ngboolean probe;\r\ngboolean pitr;\r\ngboolean smr_invoked;\r\nguint8 itr_rec_cnt = 0;\r\nguint8 rec_cnt = 0;\r\nguint16 src_eid_afi;\r\nconst gchar *src_eid;\r\nproto_item *ti_flags, *ti_lcaf_src_eid, *ti_lcaf_prefix;\r\nproto_tree *flags_tree, *lcaf_src_eid_tree, *lcaf_prefix_tree;\r\ntvbuff_t *next_tvb;\r\nflags = tvb_get_ntohs(tvb, offset);\r\nmrep = flags & (MAP_REQ_FLAG_M >> 8);\r\nsmr = flags & (MAP_REQ_FLAG_S >> 8);\r\nprobe = flags & (MAP_REQ_FLAG_P >> 8);\r\npitr = flags & (MAP_REQ_FLAG_p >> 8);\r\nsmr_invoked = flags & (MAP_REQ_FLAG_s >> 8);\r\nti_flags = proto_tree_add_item(lisp_tree, hf_lisp_mreq_flags, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nflags_tree = proto_item_add_subtree(ti_flags, ett_lisp_mreq_flags);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_auth, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_mrp, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_probe, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_smr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_pitr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flags_tree, hf_lisp_mreq_flags_smri, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nif (pitr)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " by P-ITR");\r\nif (smr)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (SMR)");\r\nif (probe)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (RLOC-probe)");\r\nif (smr_invoked)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (SMR-invoked)");\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreq_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nitr_rec_cnt = tvb_get_guint8(tvb, offset + 2) & 0x1F;\r\nproto_tree_add_item(lisp_tree, hf_lisp_irc, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrec_cnt = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_records, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nsrc_eid_afi = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreq_srceid_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nswitch (src_eid_afi) {\r\ncase AFNUM_RESERVED:\r\nproto_tree_add_string(lisp_tree, hf_lisp_mreq_srceid_string, tvb, offset, 0, "not set");\r\nbreak;\r\ncase AFNUM_INET:\r\nproto_tree_add_item(lisp_tree,\r\nhf_lisp_mreq_srceid_ipv4, tvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(lisp_tree,\r\nhf_lisp_mreq_srceid_ipv6, tvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\nsrc_eid = get_addr_str(tvb, offset, src_eid_afi, &addr_len);\r\nti_lcaf_src_eid = proto_tree_add_item(lisp_tree, hf_lisp_mreq_srceid_lcaf, tvb, offset, addr_len, ENC_ASCII|ENC_NA);\r\nproto_item_append_text(ti_lcaf_src_eid, "%s", src_eid);\r\nlcaf_src_eid_tree = proto_item_add_subtree(ti_lcaf_src_eid, ett_lisp_lcaf);\r\ndissect_lcaf(tvb, pinfo, lcaf_src_eid_tree, offset, NULL);\r\noffset += addr_len;\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(lisp_tree,\r\nhf_lisp_mreq_srceid_mac, tvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, lisp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected Source EID AFI (%d), cannot decode", src_eid_afi);\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\nreturn;\r\n}\r\nfor(i=0; i < itr_rec_cnt+1; i++) {\r\nguint16 itr_afi;\r\nproto_item *tir;\r\nproto_tree *lisp_itr_tree;\r\nitr_afi = tvb_get_ntohs(tvb, offset);\r\ntir = proto_tree_add_item(lisp_tree, hf_lisp_mreq_itr_rloc, tvb, offset, 2, ENC_NA);\r\nlisp_itr_tree = proto_item_add_subtree(tir, ett_lisp_itr);\r\nproto_tree_add_item(lisp_itr_tree, hf_lisp_mreq_itr_rloc_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nswitch (itr_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(lisp_itr_tree, hf_lisp_mreq_itr_rloc_ipv4, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tir, " %d: %s", i + 1, tvb_ip_to_str(tvb, offset));\r\nproto_item_set_len(tir, 2 + INET_ADDRLEN);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(lisp_itr_tree, hf_lisp_mreq_itr_rloc_ipv6, tvb, offset, 16, ENC_NA);\r\nproto_item_append_text(tir, " %d: %s", i + 1, tvb_ip6_to_str(tvb, offset));\r\nproto_item_set_len(tir, 2 + INET6_ADDRLEN);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, lisp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected ITR-RLOC-AFI (%d), cannot decode", itr_afi);\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\nreturn;\r\n}\r\n}\r\nfor(i=0; i < rec_cnt; i++) {\r\nguint16 prefix_mask;\r\nguint16 prefix_afi;\r\nconst gchar *prefix;\r\nproto_item *tir;\r\nproto_tree *lisp_record_tree;\r\naddr_len = 0;\r\nprefix_mask = tvb_get_guint8(tvb, offset + 1);\r\nprefix_afi = tvb_get_ntohs(tvb, offset + 2);\r\nprefix = get_addr_str(tvb, offset + 4, prefix_afi, &addr_len);\r\nif (prefix == NULL) {\r\nexpert_add_info_format(pinfo, lisp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected EID prefix AFI (%d), cannot decode", prefix_afi);\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\nreturn;\r\n}\r\ntir = proto_tree_add_item(lisp_tree, hf_lisp_mreq_record, tvb, offset, 4+addr_len, ENC_NA);\r\nif (rec_cnt == 1)\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " for %s/%d", prefix, prefix_mask);\r\nlisp_record_tree = proto_item_add_subtree(tir, ett_lisp_record);\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_res, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_length, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nswitch (prefix_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_ipv4, tvb, offset, INET_ADDRLEN, ENC_NA);\r\noffset += INET_ADDRLEN;\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_ipv6, tvb, offset, INET6_ADDRLEN, ENC_NA);\r\noffset += INET6_ADDRLEN;\r\nbreak;\r\ncase AFNUM_LCAF:\r\nti_lcaf_prefix = proto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_lcaf, tvb, offset, addr_len, ENC_ASCII|ENC_NA);\r\nproto_item_append_text(ti_lcaf_prefix, "%s", prefix);\r\nlcaf_prefix_tree = proto_item_add_subtree(ti_lcaf_prefix, ett_lisp_lcaf);\r\ndissect_lcaf(tvb, pinfo, lcaf_prefix_tree, offset, NULL);\r\noffset += addr_len;\r\nbreak;\r\ncase AFNUM_EUI48:\r\nproto_tree_add_item(lisp_record_tree, hf_lisp_mreq_record_prefix_mac, tvb, offset, EUI48_ADDRLEN, ENC_NA);\r\noffset += EUI48_ADDRLEN;\r\nbreak;\r\n}\r\nproto_item_append_text(tir, " %d: %s/%d", i+1, prefix, prefix_mask);\r\n}\r\nif (mrep) {\r\nint len = 0;\r\ntvbuff_t *rep_tvb;\r\nproto_item *tim;\r\nproto_tree *lisp_mr_tree;\r\ntim = proto_tree_add_item(lisp_tree, hf_lisp_mrep_record, tvb, offset, -1, ENC_NA);\r\nlisp_mr_tree = proto_item_add_subtree(tim, ett_lisp_mr);\r\nrep_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_mapping(rep_tvb, pinfo, lisp_mr_tree, 0, 1, FALSE);\r\noffset += len;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_map_reply(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\nint i;\r\ngint offset = 0;\r\ngboolean probe;\r\nguint8 flags;\r\nguint8 rec_cnt = 0;\r\ntvbuff_t *next_tvb;\r\nflags = tvb_get_guint8(tvb, offset);\r\nprobe = flags & (MAP_REP_FLAG_P >> 16);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mrep_flags_probe, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mrep_flags_enlr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mrep_flags_sec, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nif (probe)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (RLOC-probe reply)");\r\nproto_tree_add_item(lisp_tree, hf_lisp_mrep_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrec_cnt = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_records, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nfor(i=0; i < rec_cnt; i++) {\r\ntvbuff_t *rec_tvb;\r\nint len = 0;\r\nrec_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_mapping(rec_tvb, pinfo, lisp_tree, rec_cnt, i+1, FALSE);\r\noffset += len;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_map_register(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\nint i;\r\ngint offset = 0;\r\nguint8 rec_cnt = 0;\r\ntvbuff_t *next_tvb;\r\nguint16 authlen = 0;\r\nguint16 flags;\r\ngboolean xtrid;\r\ngboolean rtr;\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_flags_pmr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_flags_sec, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nflags = tvb_get_ntohs(tvb, offset);\r\nxtrid = flags & (MAP_REG_FLAG_I >> 8);\r\nrtr = flags & (MAP_REG_FLAG_R >> 8);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_flags_xtrid, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_flags_rtr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nif (rtr)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (RTR)");\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mreg_flags_wmn, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrec_cnt = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_records, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(lisp_tree, hf_lisp_keyid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nauthlen = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_authlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(lisp_tree, hf_lisp_auth, tvb, offset, authlen, ENC_NA);\r\noffset += authlen;\r\nfor(i=0; i < rec_cnt; i++) {\r\ntvbuff_t *rec_tvb;\r\nint len = 0;\r\nrec_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_mapping(rec_tvb, pinfo, lisp_tree, rec_cnt, i+1, FALSE);\r\noffset += len;\r\n}\r\nif (xtrid) {\r\nproto_tree_add_item(lisp_tree, hf_lisp_xtrid, tvb, offset, LISP_XTRID_LEN, ENC_NA);\r\nproto_tree_add_item(lisp_tree, hf_lisp_siteid, tvb, offset + LISP_XTRID_LEN, LISP_SITEID_LEN, ENC_NA);\r\noffset += LISP_XTRID_LEN + LISP_SITEID_LEN;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_map_notify(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\nint i;\r\ngint offset = 0;\r\nguint8 rec_cnt = 0;\r\ntvbuff_t *next_tvb;\r\nguint16 authlen = 0;\r\nguint16 flags;\r\ngboolean xtrid;\r\ngboolean rtr;\r\nflags = tvb_get_ntohs(tvb, offset);\r\nxtrid = flags & (MAP_NOT_FLAG_I >> 8);\r\nrtr = flags & (MAP_NOT_FLAG_R >> 8);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mnot_flags_xtrid, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_mnot_flags_rtr, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nif (rtr)\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (RTR)");\r\nproto_tree_add_item(lisp_tree, hf_lisp_mnot_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrec_cnt = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_records, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(lisp_tree, hf_lisp_keyid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nauthlen = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_authlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(lisp_tree, hf_lisp_auth, tvb, offset, authlen, ENC_NA);\r\noffset += authlen;\r\nfor(i=0; i < rec_cnt; i++) {\r\ntvbuff_t *rec_tvb;\r\nint len = 0;\r\nrec_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_mapping(rec_tvb, pinfo, lisp_tree, rec_cnt, i+1, FALSE);\r\noffset += len;\r\n}\r\nif (xtrid) {\r\nproto_tree_add_item(lisp_tree, hf_lisp_xtrid, tvb, offset, LISP_XTRID_LEN, ENC_NA);\r\nproto_tree_add_item(lisp_tree, hf_lisp_siteid, tvb, offset + LISP_XTRID_LEN, LISP_SITEID_LEN, ENC_NA);\r\noffset += LISP_XTRID_LEN + LISP_SITEID_LEN;\r\n}\r\nif (rtr) {\r\nproto_tree_add_item(lisp_tree, hf_lisp_msrtr_keyid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nauthlen = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_msrtr_authlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(lisp_tree, hf_lisp_msrtr_auth, tvb, offset, authlen, ENC_NA);\r\noffset += authlen;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_map_referral(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\nint i;\r\ngint offset = 0;\r\nguint8 rec_cnt = 0;\r\ntvbuff_t *next_tvb;\r\nproto_tree_add_item(lisp_tree, hf_lisp_mref_res, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrec_cnt = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_records, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nfor(i=0; i < rec_cnt; i++) {\r\ntvbuff_t *rec_tvb;\r\nint len = 0;\r\nrec_tvb = tvb_new_subset_remaining(tvb, offset);\r\nlen = dissect_lisp_mapping(rec_tvb, pinfo, lisp_tree, rec_cnt, i+1, TRUE);\r\noffset += len;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *lisp_tree)\r\n{\r\ngint offset = 0;\r\ntvbuff_t *next_tvb;\r\nguint8 flags;\r\ngboolean reply;\r\nguint16 authlen = 0;\r\nguint8 prefix_mask;\r\nguint16 prefix_afi, afi;\r\nconst gchar *prefix;\r\nguint16 addr_len = 0;\r\nproto_item *tir, *ti_prefix;\r\nproto_tree *prefix_tree;\r\nflags = tvb_get_guint8(tvb, offset);\r\nreply = flags & (INFO_FLAG_R >> 16);\r\nif (reply)\r\ncol_append_str(pinfo->cinfo, COL_INFO, "-Reply");\r\nelse\r\ncol_append_str(pinfo->cinfo, COL_INFO, "-Request");\r\nproto_tree_add_item(lisp_tree, hf_lisp_info_r, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_info_res1, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(lisp_tree, hf_lisp_nonce, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(lisp_tree, hf_lisp_keyid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nauthlen = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(lisp_tree, hf_lisp_authlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(lisp_tree, hf_lisp_auth, tvb, offset, authlen, ENC_NA);\r\noffset += authlen;\r\nproto_tree_add_item(lisp_tree, hf_lisp_info_ttl, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(lisp_tree, hf_lisp_info_res2, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nti_prefix = proto_tree_add_item(lisp_tree, hf_lisp_info_prefix, tvb, offset, 3, ENC_ASCII|ENC_NA);\r\nprefix_tree = proto_item_add_subtree(ti_prefix, ett_lisp_info_prefix);\r\nproto_tree_add_item(prefix_tree, hf_lisp_info_prefix_masklen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nprefix_mask = tvb_get_guint8(tvb, offset); offset += 1;\r\nproto_tree_add_item(prefix_tree, hf_lisp_info_prefix_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nprefix_afi = tvb_get_ntohs(tvb, offset); offset += 2;\r\nprefix = get_addr_str(tvb, offset, prefix_afi, &addr_len);\r\nif (prefix == NULL) {\r\nexpert_add_info_format(pinfo, lisp_tree, &ei_lisp_unexpected_field,\r\n"Unexpected EID prefix AFI (%d), cannot decode", prefix_afi);\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\nreturn;\r\n}\r\nswitch (prefix_afi) {\r\ncase AFNUM_INET:\r\nproto_tree_add_item(prefix_tree, hf_lisp_info_prefix_ipv4, tvb, offset, INET_ADDRLEN, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase AFNUM_INET6:\r\nproto_tree_add_item(prefix_tree, hf_lisp_info_prefix_ipv6, tvb, offset, INET6_ADDRLEN, ENC_NA);\r\nbreak;\r\n}\r\nproto_item_append_text(ti_prefix, "%s/%d", prefix, prefix_mask);\r\nproto_item_set_len(ti_prefix, 3 + addr_len);\r\noffset += addr_len;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " for %s/%d", prefix, prefix_mask);\r\ntir = proto_tree_add_item(lisp_tree, hf_lisp_info_afi, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nafi = tvb_get_ntohs(tvb, offset); offset += 2;\r\nif (!reply) {\r\nif (afi != 0) {\r\nexpert_add_info_format(pinfo, tir, &ei_lisp_expected_field,\r\n"Expecting NULL AFI (0), found %d, incorrect packet!", afi);\r\n}\r\n} else {\r\nif (afi != AFNUM_LCAF) {\r\nexpert_add_info_format(pinfo, tir, &ei_lisp_expected_field,\r\n"Expecting LCAF AFI (%d), found %d, incorrect packet!",\r\nAFNUM_LCAF, afi);\r\n} else {\r\noffset = dissect_lcaf(tvb, pinfo, lisp_tree, offset, NULL);\r\n}\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\ncall_data_dissector(next_tvb, pinfo, lisp_tree);\r\n}\r\nstatic void\r\ndissect_lisp_ecm(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, proto_tree *lisp_tree)\r\n{\r\ntvbuff_t *next_tvb;\r\nguint8 flags;\r\nguint8 ip_ver;\r\nflags = tvb_get_guint8(tvb, 0);\r\nddt_originated = flags & (ECM_FLAG_D >> 24);\r\nproto_tree_add_item(lisp_tree, hf_lisp_ecm_flags_sec, tvb, 0, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_ecm_flags_ddt, tvb, 0, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(lisp_tree, hf_lisp_ecm_res, tvb, 0, 4, ENC_BIG_ENDIAN);\r\nnext_tvb = tvb_new_subset_remaining(tvb, LISP_ECM_HEADER_LEN);\r\nip_ver = tvb_get_bits8(next_tvb, 0, 4);\r\nswitch (ip_ver) {\r\ncase 4:\r\ncall_dissector(ipv4_handle, next_tvb, pinfo, tree);\r\nbreak;\r\ncase 6:\r\ncall_dissector(ipv6_handle, next_tvb, pinfo, tree);\r\nbreak;\r\ndefault:\r\ncall_data_dissector(next_tvb, pinfo, tree);\r\nbreak;\r\n}\r\nencapsulated = FALSE;\r\n}\r\nstatic int\r\ndissect_lisp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nguint8 type;\r\nproto_tree *lisp_tree = NULL;\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ntype = tvb_get_bits8(tvb, 0, 4);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "LISP");\r\nif (encapsulated) {\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "Encapsulated %s", val_to_str(type, lisp_typevals,\r\n"Unknown LISP Control Packet (%d)"));\r\n} else {\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str(type, lisp_typevals,\r\n"Unknown LISP Control Packet (%d)"));\r\n}\r\nif (ddt_originated) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " (DDT-originated)");\r\nddt_originated = FALSE;\r\n}\r\nif (tree) {\r\nproto_item *ti;\r\nti = proto_tree_add_item(tree, proto_lisp, tvb, 0,\r\n(type == LISP_ECM) ? LISP_ECM_HEADER_LEN : -1, ENC_NA);\r\nlisp_tree = proto_item_add_subtree(ti, ett_lisp);\r\nproto_tree_add_item(lisp_tree,\r\nhf_lisp_type, tvb, 0, 3, ENC_BIG_ENDIAN);\r\n}\r\nswitch (type) {\r\ncase LISP_MAP_REQUEST:\r\ndissect_lisp_map_request(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_MAP_REPLY:\r\ndissect_lisp_map_reply(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_MAP_REGISTER:\r\ndissect_lisp_map_register(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_MAP_NOTIFY:\r\ndissect_lisp_map_notify(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_MAP_REFERRAL:\r\ndissect_lisp_map_referral(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_INFO:\r\ndissect_lisp_info(tvb, pinfo, lisp_tree);\r\nbreak;\r\ncase LISP_ECM:\r\nencapsulated = TRUE;\r\ndissect_lisp_ecm(tvb, pinfo, tree, lisp_tree);\r\nbreak;\r\ndefault:\r\ncall_data_dissector(tvb, pinfo, tree);\r\nbreak;\r\n}\r\nreturn tvb_reported_length(tvb);\r\n}\r\nvoid\r\nproto_register_lisp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_lisp_type,\r\n{ "Type", "lisp.type",\r\nFT_UINT24, BASE_DEC, VALS(lisp_typevals), 0xF00000, "LISP Control Message Type", HFILL }},\r\n{ &hf_lisp_irc,\r\n{ "ITR-RLOC Count", "lisp.irc",\r\nFT_UINT24, BASE_DEC, NULL, 0x00001F, NULL, HFILL }},\r\n{ &hf_lisp_records,\r\n{ "Record Count", "lisp.records",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_nonce,\r\n{ "Nonce", "lisp.nonce",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags,\r\n{ "Flags", "lisp.mreq.flags",\r\nFT_UINT24, BASE_HEX, NULL, 0x0FC000, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_auth,\r\n{ "A bit (Authoritative)", "lisp.mreq.flags.auth",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_A, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_mrp,\r\n{ "M bit (Map-Reply present)", "lisp.mreq.flags.mrp",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_M, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_probe,\r\n{ "P bit (Probe)", "lisp.mreq.flags.probe",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_P, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_smr,\r\n{ "S bit (Solicit-Map-Request)", "lisp.mreq.flags.smr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_S, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_pitr,\r\n{ "p bit (Proxy ITR)", "lisp.mreq.flags.pitr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_p, NULL, HFILL }},\r\n{ &hf_lisp_mreq_flags_smri,\r\n{ "s bit (SMR-invoked)", "lisp.mreq.flags.smri",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REQ_FLAG_s, NULL, HFILL }},\r\n{ &hf_lisp_mreq_res,\r\n{ "Reserved bits", "lisp.mreq.res",\r\nFT_UINT24, BASE_HEX, NULL, MAP_REQ_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_mreq_srceid_afi,\r\n{ "Source EID AFI", "lisp.mreq.srceid.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, "Source EID Address Family Indicator", HFILL }},\r\n{ &hf_lisp_mreq_srceid_string,\r\n{ "Source EID", "lisp.mreq.srceid.string",\r\nFT_STRING, BASE_NONE, NULL, 0x0, "Source EID Address", HFILL }},\r\n{ &hf_lisp_mreq_srceid_ipv4,\r\n{ "Source EID", "lisp.mreq.srceid.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "Source EID Address", HFILL }},\r\n{ &hf_lisp_mreq_srceid_ipv6,\r\n{ "Source EID", "lisp.mreq.srceid_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "Source EID Address", HFILL }},\r\n{ &hf_lisp_mreq_srceid_mac,\r\n{ "Source EID", "lisp.mreq.srceid.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_srceid_lcaf,\r\n{ "Source EID", "lisp.mreq.srceid.lcaf",\r\nFT_STRING, BASE_NONE, NULL, 0x0, "Source EID Address", HFILL }},\r\n{ &hf_lisp_mreq_itr_rloc,\r\n{ "ITR-RLOC", "lisp.mreq.itr_rloc",\r\nFT_NONE, BASE_NONE, NULL, 0x0, "Originating ITR RLOC Address", HFILL }},\r\n{ &hf_lisp_mreq_itr_rloc_afi,\r\n{ "ITR-RLOC AFI", "lisp.mreq.itr_rloc.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, "Originating ITR RLOC Address Family Indicator", HFILL }},\r\n{ &hf_lisp_mreq_itr_rloc_ipv4,\r\n{ "ITR-RLOC Address", "lisp.mreq.itr_rloc_ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "Originating ITR RLOC Address", HFILL }},\r\n{ &hf_lisp_mreq_itr_rloc_ipv6,\r\n{ "ITR-RLOC Address", "lisp.mreq.itr_rloc_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "Originating ITR RLOC Address", HFILL }},\r\n{ &hf_lisp_mreq_record_res,\r\n{ "Reserved", "lisp.mreq.record.res",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_length,\r\n{ "Prefix Length", "lisp.mreq.record.prefix.length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_afi,\r\n{ "Prefix AFI", "lisp.mreq.record.prefix.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_ipv4,\r\n{ "Prefix", "lisp.mreq.record.prefix.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_ipv6,\r\n{ "Prefix", "lisp.mreq.record.prefix.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_mac,\r\n{ "Prefix", "lisp.mreq.record.prefix.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record_prefix_lcaf,\r\n{ "Prefix", "lisp.mreq.record.prefix.lcaf",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mreq_record,\r\n{ "Map-Request Record", "lisp.mreq.record",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mrep_record,\r\n{ "Map-Reply Record", "lisp.mrep.record",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mrep_flags_probe,\r\n{ "P bit (Probe)", "lisp.mrep.flags.probe",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REP_FLAG_P, NULL, HFILL }},\r\n{ &hf_lisp_mrep_flags_enlr,\r\n{ "E bit (Echo-Nonce locator reachability algorithm enabled)", "lisp.mrep.flags.enlr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REP_FLAG_E, NULL, HFILL }},\r\n{ &hf_lisp_mrep_flags_sec,\r\n{ "S bit (LISP-SEC capable)", "lisp.mrep.flags.sec",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REP_FLAG_S, NULL, HFILL }},\r\n{ &hf_lisp_mrep_res,\r\n{ "Reserved bits", "lisp.mrep.res",\r\nFT_UINT24, BASE_HEX, NULL, MAP_REP_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_mreg_flags_pmr,\r\n{ "P bit (Proxy-Map-Reply)", "lisp.mreg.flags.pmr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REG_FLAG_P, NULL, HFILL }},\r\n{ &hf_lisp_mreg_flags_sec,\r\n{ "S bit (LISP-SEC capable)", "lisp.mreg.flags.sec",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REG_FLAG_S, NULL, HFILL }},\r\n{ &hf_lisp_mreg_flags_xtrid,\r\n{ "I bit (xTR-ID present)", "lisp.mreg.flags.xtrid",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REG_FLAG_I, NULL, HFILL }},\r\n{ &hf_lisp_mreg_flags_rtr,\r\n{ "R bit (Built for an RTR)", "lisp.mreg.flags.rtr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REG_FLAG_R, NULL, HFILL }},\r\n{ &hf_lisp_mreg_flags_wmn,\r\n{ "M bit (Want-Map-Notify)", "lisp.mreg.flags.wmn",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_REG_FLAG_M, NULL, HFILL }},\r\n{ &hf_lisp_mreg_res,\r\n{ "Reserved bits", "lisp.mreg.res",\r\nFT_UINT24, BASE_HEX, NULL, MAP_REG_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_mref_res,\r\n{ "Reserved bits", "lisp.mref.res",\r\nFT_UINT24, BASE_HEX, NULL, MAP_REF_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_keyid,\r\n{ "Key ID", "lisp.keyid",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_authlen,\r\n{ "Authentication Data Length", "lisp.authlen",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_auth,\r\n{ "Authentication Data", "lisp.auth",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_msrtr_keyid,\r\n{ "MS-RTR Key ID", "lisp.msrtr.keyid",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_msrtr_authlen,\r\n{ "MS-RTR Authentication Data Length", "lisp.msrtr.authlen",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_msrtr_auth,\r\n{ "MS-RTR Authentication Data", "lisp.msrtr.auth",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_xtrid,\r\n{ "xTR-ID", "lisp.xtrid",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_siteid,\r\n{ "Site-ID", "lisp.siteid",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mnot_flags_xtrid,\r\n{ "I bit (xTR-ID present)", "lisp.mnot.flags.xtrid",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_NOT_FLAG_I, NULL, HFILL }},\r\n{ &hf_lisp_mnot_flags_rtr,\r\n{ "R bit (Built for an RTR)", "lisp.mnot.flags.rtr",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), MAP_NOT_FLAG_R, NULL, HFILL }},\r\n{ &hf_lisp_mnot_res,\r\n{ "Reserved bits", "lisp.mnot.res",\r\nFT_UINT24, BASE_HEX, NULL, MAP_NOT_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_info_r,\r\n{ "R bit (Info-Reply)", "lisp.info.r",\r\nFT_BOOLEAN, 24, TFS(&tfs_set_notset), INFO_FLAG_R, NULL, HFILL }},\r\n{ &hf_lisp_info_res1,\r\n{ "Reserved bits", "lisp.info.res1",\r\nFT_UINT32, BASE_HEX, NULL, INFO_RESERVED, "Must be zero", HFILL }},\r\n{ &hf_lisp_info_ttl,\r\n{ "TTL", "lisp.info.ttl",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "RTR information time-to-live", HFILL }},\r\n{ &hf_lisp_info_res2,\r\n{ "Reserved bits", "lisp.info.res2",\r\nFT_UINT8, BASE_HEX, NULL, 0xFF, "Must be zero", HFILL }},\r\n{ &hf_lisp_info_prefix,\r\n{ "EID Prefix", "lisp.info.prefix",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_info_prefix_masklen,\r\n{ "EID Prefix Mask Length", "lisp.info.prefix.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_info_prefix_afi,\r\n{ "Prefix AFI", "lisp.info.prefix.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_info_prefix_ipv4,\r\n{ "Prefix", "lisp.info.prefix.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_info_prefix_ipv6,\r\n{ "Prefix", "lisp.info.prefix.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_info_afi,\r\n{ "AFI", "lisp.info.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, "Address Family Indicator", HFILL }},\r\n{ &hf_lisp_loc,\r\n{ "Locator Record", "lisp.loc",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_priority,\r\n{ "Priority", "lisp.loc.priority",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_weight,\r\n{ "Weight", "lisp.loc.weight",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_mpriority,\r\n{ "Multicast Priority", "lisp.loc.multicast_priority",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_mweight,\r\n{ "Multicast Weight", "lisp.loc.multicast_weight",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_flags,\r\n{ "Flags", "lisp.loc.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_flags_local,\r\n{ "Local", "lisp.loc.flags.local",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), LOCAL_BIT_MASK, NULL, HFILL }},\r\n{ &hf_lisp_loc_flags_probe,\r\n{ "Probe", "lisp.loc.flags.probe",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), PROBE_BIT_MASK, NULL, HFILL }},\r\n{ &hf_lisp_loc_flags_reach,\r\n{ "Reachable", "lisp.loc.flags.reach",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), REACH_BIT_MASK, NULL, HFILL }},\r\n{ &hf_lisp_loc_flags_res,\r\n{ "Reserved", "lisp.loc.flags.res",\r\nFT_UINT16, BASE_HEX, NULL, 0xFFF8, "Must be zero", HFILL }},\r\n{ &hf_lisp_loc_afi,\r\n{ "AFI", "lisp.loc.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_loc_locator,\r\n{ "Locator", "lisp.loc.locator",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping,\r\n{ "Mapping Record", "lisp.mapping",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_ttl,\r\n{ "Record TTL", "lisp.mapping.ttl",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_loccnt,\r\n{ "Locator Count", "lisp.mapping.loccnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_masklen,\r\n{ "EID Mask Length", "lisp.mapping.eid.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_act,\r\n{ "Action", "lisp.mapping.act",\r\nFT_UINT16, BASE_DEC, VALS(mapping_actions), 0xE000, NULL, HFILL }},\r\n{ &hf_lisp_mapping_auth,\r\n{ "Authoritative bit", "lisp.mapping.auth",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), LISP_MAP_AUTH, NULL, HFILL }},\r\n{ &hf_lisp_referral_incomplete,\r\n{ "Incomplete", "lisp.referral.incomplete",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), REFERRAL_INCOMPLETE, NULL, HFILL }},\r\n{ &hf_lisp_mapping_res1,\r\n{ "Reserved", "lisp.mapping.res1",\r\nFT_UINT16, BASE_HEX, NULL, 0x07FF, NULL, HFILL }},\r\n{ &hf_lisp_mapping_res2,\r\n{ "Reserved", "lisp.mapping.res2",\r\nFT_UINT16, BASE_HEX, NULL, 0xF000, NULL, HFILL }},\r\n{ &hf_lisp_mapping_ver,\r\n{ "Mapping Version", "lisp.mapping.ver",\r\nFT_UINT16, BASE_DEC, NULL, 0x0FFF, NULL, HFILL }},\r\n{ &hf_lisp_referral_sigcnt,\r\n{ "Signature Count", "lisp.referral.sigcnt",\r\nFT_UINT16, BASE_DEC, NULL, 0xF000, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_afi,\r\n{ "EID Prefix AFI", "lisp.mapping.eid.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_ipv4,\r\n{ "EID Prefix", "lisp.mapping.eid.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_ipv6,\r\n{ "EID Prefix", "lisp.mapping.eid.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_mac,\r\n{ "EID Prefix", "lisp.mapping.eid.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_mapping_eid_lcaf,\r\n{ "EID Prefix", "lisp.mapping.eid.lcaf",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_ecm_flags_sec,\r\n{ "S bit (LISP-SEC capable)", "lisp.ecm.flags.sec",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), ECM_FLAG_S, NULL, HFILL }},\r\n{ &hf_lisp_ecm_flags_ddt,\r\n{ "D bit (DDT-originated)", "lisp.ecm.flags.ddt",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), ECM_FLAG_D, NULL, HFILL }},\r\n{ &hf_lisp_ecm_res,\r\n{ "Reserved bits", "lisp.ecm.res",\r\nFT_UINT32, BASE_HEX, NULL, 0x03FFFFFF, NULL, HFILL }},\r\n{ &hf_lisp_lcaf,\r\n{ "LCAF", "lisp.lcaf",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_header,\r\n{ "LCAF Header", "lisp.lcaf.header",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_res1,\r\n{ "Reserved bits", "lisp.lcaf.res1",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_flags,\r\n{ "Flags", "lisp.lcaf.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_type,\r\n{ "Type", "lisp.lcaf.type",\r\nFT_UINT8, BASE_DEC, VALS(lcaf_typevals), 0x0, "LISP LCAF Type", HFILL }},\r\n{ &hf_lisp_lcaf_res2,\r\n{ "Reserved bits", "lisp.lcaf.res2",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_length,\r\n{ "Length", "lisp.lcaf.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_afi_list_item,\r\n{ "List Item", "lisp.lcaf.afi_list.item",\r\nFT_NONE, BASE_NONE, NULL, 0x0, "AFI List Item", HFILL }},\r\n{ &hf_lisp_lcaf_afi_list_afi,\r\n{ "List Item AFI", "lisp.lcaf.afi_list.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_afi_list_ipv4,\r\n{ "List Item Address", "lisp.lcaf.afi_list.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_afi_list_ipv6,\r\n{ "List Item Address", "lisp.lcaf.afi_list.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_afi_list_mac,\r\n{ "List Item Address", "lisp.lcaf.afi_list.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_iid,\r\n{ "Instance ID", "lisp.lcaf.iid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_iid_afi,\r\n{ "Address AFI", "lisp.lcaf.iid.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_iid_ipv4,\r\n{ "Address", "lisp.lcaf.iid.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_iid_ipv6,\r\n{ "Address", "lisp.lcaf.iid.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_iid_mac,\r\n{ "Address", "lisp.lcaf.iid.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_asn,\r\n{ "AS Number", "lisp.lcaf.asn",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_asn_afi,\r\n{ "Address AFI", "lisp.lcaf.asn.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_asn_ipv4,\r\n{ "Address", "lisp.lcaf.asn.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_asn_ipv6,\r\n{ "Address", "lisp.lcaf.asn.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_asn_mac,\r\n{ "Address", "lisp.lcaf.asn.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lat,\r\n{ "Latitude", "lisp.lcaf.geo.lat",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lat_hemisphere,\r\n{ "Hemisphere", "lisp.lcaf.geo.lat.hemisphere",\r\nFT_UINT16, BASE_DEC, VALS(lat_typevals), 0x8000, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lat_deg,\r\n{ "Degrees", "lisp.lcaf.geo.lat.deg",\r\nFT_UINT16, BASE_DEC, NULL, 0x7FFF, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lat_min,\r\n{ "Minutes", "lisp.lcaf.geo.lat.min",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lat_sec,\r\n{ "Seconds", "lisp.lcaf.geo.lat.sec",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lon,\r\n{ "Longitude", "lisp.lcaf.geo.lon",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lon_hemisphere,\r\n{ "Hemisphere", "lisp.lcaf.geo.lon.hemisphere",\r\nFT_UINT16, BASE_DEC, VALS(lon_typevals), 0x8000, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lon_deg,\r\n{ "Degrees", "lisp.lcaf.geo.lon.deg",\r\nFT_UINT16, BASE_DEC, NULL, 0x7FFF, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lon_min,\r\n{ "Minutes", "lisp.lcaf.geo.lon.min",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_lon_sec,\r\n{ "Seconds", "lisp.lcaf.geo.lon.sec",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_alt,\r\n{ "Altitude", "lisp.lcaf.geo.alt",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_afi,\r\n{ "Address AFI", "lisp.lcaf.geo.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_ipv4,\r\n{ "Address", "lisp.lcaf.geo.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_ipv6,\r\n{ "Address", "lisp.lcaf.geo.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_geo_mac,\r\n{ "Address", "lisp.lcaf.geo.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc_res,\r\n{ "Reserved bits", "lisp.lcaf.nonce_loc.res",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc,\r\n{ "Nonce", "lisp.lcaf.nonce_loc",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc_afi,\r\n{ "Address AFI", "lisp.lcaf.nonce_loc.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc_ipv4,\r\n{ "Address", "lisp.lcaf.nonce_loc.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc_ipv6,\r\n{ "Address", "lisp.lcaf.nonce_loc.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_nonce_loc_mac,\r\n{ "Address", "lisp.lcaf.nonce_loc.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_flags,\r\n{ "Multicast Info Flags", "lisp.lcaf.mcinfo.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_flags_res,\r\n{ "Reserved", "lisp.lcaf.mcinfo.flags.res",\r\nFT_UINT8, BASE_HEX, NULL, 0xF8, "Must be zero", HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_flags_rp,\r\n{ "RP-bit", "lisp.lcaf.mcinfo.flags.rp",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), MCINFO_FLAG_R, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_flags_leave,\r\n{ "Leave (L-bit)", "lisp.lcaf.mcinfo.flags.leave",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), MCINFO_FLAG_L, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_flags_join,\r\n{ "Join (J-bit)", "lisp.lcaf_mcinfo.flags.join",\r\nFT_BOOLEAN, 8, TFS(&tfs_set_notset), MCINFO_FLAG_J, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_iid,\r\n{ "Instance ID", "lisp.lcaf.mcinfo_iid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_res,\r\n{ "Reserved bits", "lisp.lcaf.mcinfo.res",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_src_masklen,\r\n{ "Source Mask Length", "lisp.lcaf.mcinfo.src.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_grp_masklen,\r\n{ "Group Mask Length", "lisp.lcaf.mcinfo.grp.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_src,\r\n{ "Source/Subnet Address", "lisp.lcaf.mcinfo.src",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_src_afi,\r\n{ "Source/Subnet AFI", "lisp.lcaf.mcinfo.src.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_src_ipv4,\r\n{ "Source/Subnet Address", "lisp.lcaf.mcinfo.src.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_src_ipv6,\r\n{ "Source/Subnet Address", "lisp.lcaf.mcinfo.src.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_grp,\r\n{ "Group Address", "lisp.lcaf.mcinfo.grp",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_grp_afi,\r\n{ "Group AFI", "lisp.lcaf.mcinfo.grp.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_grp_ipv4,\r\n{ "Group Address", "lisp.lcaf.mcinfo.grp.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_mcinfo_grp_ipv6,\r\n{ "Group Address", "lisp.lcaf.mcinfo.grp.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop,\r\n{ "Reencap Hop", "lisp.lcaf.elp_hop",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_flags,\r\n{ "Flags", "lisp.lcaf.elp_hop.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_flags_res,\r\n{ "Reserved", "lisp.lcaf.elp_hop.flags.res",\r\nFT_UINT16, BASE_HEX, NULL, 0xFFF8, "Must be zero", HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_flags_lookup,\r\n{ "Lookup", "lisp.lcaf.elp_hop.flags.local",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), ELP_FLAG_L, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_flags_probe,\r\n{ "Probe", "lisp.lcaf.elp_hop.flags.probe",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), ELP_FLAG_P, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_flags_strict,\r\n{ "Strict", "lisp.lcaf_elp_hop.flags.strict",\r\nFT_BOOLEAN, 16, TFS(&tfs_set_notset), ELP_FLAG_S, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_afi,\r\n{ "Reencap Hop AFI", "lisp.lcaf.elp_hop.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_ipv4,\r\n{ "Reencap Hop", "lisp.lcaf.elp_hop.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_elp_hop_ipv6,\r\n{ "Reencap Hop", "lisp.lcaf.elp_hop.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_res,\r\n{ "Reserved bits", "lisp.lcaf.srcdst.res",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src_masklen,\r\n{ "Source Prefix Mask Length", "lisp.lcaf.srcdst.src.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst_masklen,\r\n{ "Destination Prefix Mask Length", "lisp.lcaf.srcdst.dst.masklen",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src,\r\n{ "Source Prefix", "lisp.lcaf.srcdst.src",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src_afi,\r\n{ "Source Prefix AFI", "lisp.lcaf.srcdst.src.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src_ipv4,\r\n{ "Source Prefix", "lisp.lcaf.srcdst.src.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src_ipv6,\r\n{ "Source Prefix", "lisp.lcaf.srcdst.src.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_src_mac,\r\n{ "Destination Prefix", "lisp.lcaf.srcdst.src.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst,\r\n{ "Destination Prefix", "lisp.lcaf.srcdst.dst",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst_afi,\r\n{ "Destination Prefix AFI", "lisp.lcaf.srcdst.dst.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst_ipv4,\r\n{ "Destination Prefix", "lisp.lcaf.srcdst.dst.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst_ipv6,\r\n{ "Destination Prefix", "lisp.lcaf.srcdst.dst.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_srcdst_dst_mac,\r\n{ "Destination Prefix", "lisp.lcaf.srcdst.dst.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry,\r\n{ "RTR/ETR", "lisp.lcaf.rle_entry",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry_res,\r\n{ "Reserved bits", "lisp.lcaf.rle_entry.res",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, "Must be zero", HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry_level,\r\n{ "Level Value", "lisp.lcaf.rle_entry.level",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry_afi,\r\n{ "RTR/ETR AFI", "lisp.lcaf.rle_entry.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry_ipv4,\r\n{ "RTR/ETR", "lisp.lcaf.rle_entry.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_rle_entry_ipv6,\r\n{ "RTR/ETR", "lisp.lcaf.rle_entry.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_key,\r\n{ "Key", "lisp.lcaf.kv_key",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_key_afi,\r\n{ "Key AFI", "lisp.lcaf.kv_key.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_key_ipv4,\r\n{ "Key", "lisp.lcaf.kv_key.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_key_ipv6,\r\n{ "Key", "lisp.lcaf.kv_key.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_key_mac,\r\n{ "Key", "lisp.lcaf.kv_key.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_value,\r\n{ "Value", "lisp.lcaf.kv_value",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_value_afi,\r\n{ "Value AFI", "lisp.lcaf.kv_value.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_value_ipv4,\r\n{ "Value", "lisp.lcaf.kv_value.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_value_ipv6,\r\n{ "Value", "lisp.lcaf.kv_value.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_kv_value_mac,\r\n{ "Value", "lisp.lcaf.kv_value.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_rloc,\r\n{ "RLOC", "lisp.lcaf.natt.rloc",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_rloc_afi,\r\n{ "RLOC AFI", "lisp.lcaf.natt.rloc.afi",\r\nFT_UINT16, BASE_DEC, VALS(afn_vals), 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_rloc_ipv4,\r\n{ "RLOC", "lisp.lcaf.natt.rloc.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_rloc_ipv6,\r\n{ "RLOC", "lisp.lcaf.natt.rloc.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_msport,\r\n{ "MS UDP Port Number", "lisp.lcaf.natt.msport",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_lisp_lcaf_natt_etrport,\r\n{ "ETR UDP Port Number", "lisp.lcaf.natt.etrport",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_lisp,\r\n&ett_lisp_mr,\r\n&ett_lisp_mreq_flags,\r\n&ett_lisp_mapping,\r\n&ett_lisp_itr,\r\n&ett_lisp_record,\r\n&ett_lisp_lcaf,\r\n&ett_lisp_lcaf_header,\r\n&ett_lisp_lcaf_geo_lat,\r\n&ett_lisp_lcaf_geo_lon,\r\n&ett_lisp_lcaf_natt_rloc,\r\n&ett_lisp_lcaf_mcinfo_flags,\r\n&ett_lisp_lcaf_mcinfo_src,\r\n&ett_lisp_lcaf_mcinfo_grp,\r\n&ett_lisp_lcaf_elp_hop,\r\n&ett_lisp_lcaf_elp_hop_flags,\r\n&ett_lisp_lcaf_srcdst_src,\r\n&ett_lisp_lcaf_srcdst_dst,\r\n&ett_lisp_lcaf_rle_entry,\r\n&ett_lisp_lcaf_kv_key,\r\n&ett_lisp_lcaf_kv_value,\r\n&ett_lisp_loc,\r\n&ett_lisp_loc_flags,\r\n&ett_lisp_info_prefix,\r\n&ett_lisp_afi_list\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_lisp_undecoded, { "lisp.undecoded", PI_UNDECODED, PI_WARN, "Not dissected yet (report to wireshark.org)", EXPFILL }},\r\n{ &ei_lisp_unexpected_field, { "lisp.unexpected_field", PI_PROTOCOL, PI_ERROR, "Unexpected field", EXPFILL }},\r\n{ &ei_lisp_invalid_field, { "lisp.invalid_field", PI_PROTOCOL, PI_WARN, "Invalid field", EXPFILL }},\r\n{ &ei_lisp_lcaf_type, { "lisp.lcaf.type.invalid", PI_PROTOCOL, PI_ERROR, "LCAF type is not defined in draft-ietf-lisp-lcaf-X", EXPFILL }},\r\n{ &ei_lisp_expected_field, { "lisp.expected_field", PI_PROTOCOL, PI_ERROR, "Expecting field", EXPFILL }},\r\n};\r\nexpert_module_t* expert_lisp;\r\nproto_lisp = proto_register_protocol("Locator/ID Separation Protocol",\r\n"LISP Control", "lisp");\r\nproto_register_field_array(proto_lisp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_lisp = expert_register_protocol(proto_lisp);\r\nexpert_register_field_array(expert_lisp, ei, array_length(ei));\r\nlisp_handle = register_dissector("lisp", dissect_lisp, proto_lisp);\r\n}\r\nvoid\r\nproto_reg_handoff_lisp(void)\r\n{\r\ndissector_add_uint("udp.port", LISP_CONTROL_PORT, lisp_handle);\r\nipv4_handle = find_dissector_add_dependency("ip", proto_lisp);\r\nipv6_handle = find_dissector_add_dependency("ipv6", proto_lisp);\r\n}
