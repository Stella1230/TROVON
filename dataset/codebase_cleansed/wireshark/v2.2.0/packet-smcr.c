static void\r\ndisect_smcr_proposal(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nguint16 mask_offset;\r\nguint8 ipv6_prefix_count;\r\nproto_item *proposal_flag_item;\r\nproto_tree *proposal_flag_tree;\r\noffset = CLC_MSG_START_OFFSET;\r\nproposal_flag_item = proto_tree_add_item(tree, hf_smcr_proposal_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproposal_flag_tree = proto_item_add_subtree(proposal_flag_item, ett_proposal_flag);\r\nproto_tree_add_item(proposal_flag_tree, hf_proposal_smc_version, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_proposal_client_peer_id, tvb, offset,\r\nPEERID_LEN, ENC_BIG_ENDIAN);\r\noffset += PEERID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_proposal_client_preferred_gid, tvb,\r\noffset, GID_LEN, ENC_NA);\r\noffset += GID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_proposal_client_preferred_mac, tvb,\r\noffset, MAC_ADDR_LEN, ENC_NA);\r\noffset += MAC_ADDR_LEN;\r\nmask_offset = tvb_get_ntohs(tvb, offset);\r\noffset += 2 + mask_offset;\r\nproto_tree_add_item(tree, hf_smcr_proposal_outgoing_interface_subnet_mask, tvb,\r\noffset, IPV4_SUBNET_MASK_LEN, ENC_BIG_ENDIAN);\r\noffset += IPV4_SUBNET_MASK_LEN;\r\nproto_tree_add_item(tree, hf_smcr_proposal_outgoing_subnet_mask_signifcant_bits, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\noffset += TWO_BYTE_RESERVED;\r\nipv6_prefix_count = tvb_get_guint8(tvb, offset);\r\noffset += 2;\r\nwhile (ipv6_prefix_count != 0) {\r\nproto_tree_add_item(tree, hf_smcr_proposal_ipv6_prefix, tvb,\r\noffset, IPV6_PREFIX_LEN, ENC_NA);\r\noffset += IPV6_PREFIX_LEN;\r\nproto_tree_add_item(tree, hf_smcr_proposal_ipv6_prefix_length, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nipv6_prefix_count--;\r\n}\r\n}\r\nstatic void\r\ndisect_smcr_accept(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *accept_flag_item;\r\nproto_tree *accept_flag_tree;\r\nproto_item *accept_flag2_item;\r\nproto_tree *accept_flag2_tree;\r\noffset = CLC_MSG_START_OFFSET;\r\naccept_flag_item = proto_tree_add_item(tree, hf_smcr_accept_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\naccept_flag_tree = proto_item_add_subtree(accept_flag_item, ett_accept_flag);\r\nproto_tree_add_item(accept_flag_tree, hf_accept_smc_version, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(accept_flag_tree, hf_accept_first_contact, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_peer_id, tvb, offset,\r\nPEERID_LEN, ENC_BIG_ENDIAN);\r\noffset += PEERID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_preferred_gid, tvb,\r\noffset, GID_LEN, ENC_NA);\r\noffset += GID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_preferred_mac, tvb,\r\noffset, MAC_ADDR_LEN, ENC_NA);\r\noffset += MAC_ADDR_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_qp_number, tvb,\r\noffset, QP_LEN, ENC_BIG_ENDIAN);\r\noffset += QP_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_rmb_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_tcp_conn_index, tvb,\r\noffset, CONN_INDEX_LEN, ENC_BIG_ENDIAN);\r\noffset += CONN_INDEX_LEN;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_rmb_element_alert_token, tvb,\r\noffset, ALERT_TOKEN_LEN, ENC_BIG_ENDIAN);\r\noffset += ALERT_TOKEN_LEN;\r\naccept_flag2_item = proto_tree_add_item(tree, hf_smcr_accept_flags2, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\naccept_flag2_tree = proto_item_add_subtree(accept_flag2_item, ett_accept_flag2);\r\nproto_tree_add_item(accept_flag2_tree, hf_accept_rmb_buffer_size, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(accept_flag2_tree, hf_accept_qp_mtu_value, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\noffset += ONE_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_accept_server_rmb_virtual_address, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\noffset += VIRTUAL_ADDR_LEN;\r\noffset += ONE_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_accept_initial_psn, tvb,\r\noffset, PSN_LEN, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_confirm(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *confirm_flag_item;\r\nproto_tree *confirm_flag_tree;\r\nproto_item *confirm_flag2_item;\r\nproto_tree *confirm_flag2_tree;\r\noffset = CLC_MSG_START_OFFSET;\r\nconfirm_flag_item = proto_tree_add_item(tree, hf_smcr_confirm_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nconfirm_flag_tree = proto_item_add_subtree(confirm_flag_item, ett_confirm_flag);\r\nproto_tree_add_item(confirm_flag_tree, hf_confirm_smc_version, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_peer_id, tvb, offset,\r\nPEERID_LEN, ENC_BIG_ENDIAN);\r\noffset += PEERID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_gid, tvb,\r\noffset, GID_LEN, ENC_NA);\r\noffset += GID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_mac, tvb,\r\noffset, MAC_ADDR_LEN, ENC_NA);\r\noffset += MAC_ADDR_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_qp_number, tvb,\r\noffset, QP_LEN, ENC_BIG_ENDIAN);\r\noffset += QP_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_rmb_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_tcp_conn_index, tvb,\r\noffset, CONN_INDEX_LEN, ENC_BIG_ENDIAN);\r\noffset += CONN_INDEX_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_rmb_element_alert_token, tvb,\r\noffset, ALERT_TOKEN_LEN, ENC_BIG_ENDIAN);\r\noffset += ALERT_TOKEN_LEN;\r\nconfirm_flag2_item = proto_tree_add_item(tree, hf_smcr_confirm_flags2, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nconfirm_flag2_tree = proto_item_add_subtree(confirm_flag2_item, ett_confirm_flag2);\r\nproto_tree_add_item(confirm_flag2_tree, hf_confirm_rmb_buffer_size, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(confirm_flag2_tree, hf_confirm_qp_mtu_value, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\noffset += ONE_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_confirm_client_rmb_virtual_address, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\noffset += VIRTUAL_ADDR_LEN;\r\noffset += ONE_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_confirm_initial_psn, tvb,\r\noffset, PSN_LEN, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_decline(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\noffset = CLC_MSG_START_OFFSET;\r\nproto_tree_add_item(tree, hf_smcr_decline_flags, tvb, offset,\r\nFLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_decline_peer_id, tvb, offset,\r\nPEERID_LEN, ENC_BIG_ENDIAN);\r\noffset += PEERID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_decline_diag_info, tvb, offset,\r\n4, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_confirm_link(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *confirm_flag_item;\r\nproto_tree *confirm_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\nconfirm_flag_item = proto_tree_add_item(tree, hf_smcr_confirm_link_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nconfirm_flag_tree = proto_item_add_subtree(confirm_flag_item, ett_confirm_link_flag);\r\nproto_tree_add_item(confirm_flag_tree, hf_smcr_confirm_link_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_mac, tvb,\r\noffset, MAC_ADDR_LEN, ENC_NA);\r\noffset += MAC_ADDR_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_gid, tvb,\r\noffset, GID_LEN, ENC_NA);\r\noffset += GID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_qp_number, tvb,\r\noffset, QP_LEN, ENC_BIG_ENDIAN);\r\noffset += QP_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_userid, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_smcr_confirm_link_max_links, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_add_link(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *add_link_flag_item;\r\nproto_tree *add_link_flag_tree;\r\nproto_item *add_link_flag2_item;\r\nproto_tree *add_link_flag2_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\nadd_link_flag_item = proto_tree_add_item(tree, hf_smcr_add_link_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nadd_link_flag_tree = proto_item_add_subtree(add_link_flag_item, ett_add_link_flag);\r\nproto_tree_add_item(add_link_flag_tree, hf_smcr_add_link_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(add_link_flag_tree, hf_smcr_add_link_response_rejected, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_mac, tvb,\r\noffset, MAC_ADDR_LEN, ENC_NA);\r\noffset += MAC_ADDR_LEN;\r\noffset += TWO_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_add_link_gid, tvb,\r\noffset, GID_LEN, ENC_NA);\r\noffset += GID_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_qp_number, tvb,\r\noffset, QP_LEN, ENC_BIG_ENDIAN);\r\noffset += QP_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nadd_link_flag2_item = proto_tree_add_item(tree, hf_smcr_add_link_flags2, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nadd_link_flag2_tree = proto_item_add_subtree(add_link_flag2_item, ett_add_link_flag2);\r\nproto_tree_add_item(add_link_flag2_tree, hf_smcr_add_link_qp_mtu_value, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_add_link_initial_psn, tvb,\r\noffset, PSN_LEN, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_add_continuation(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nguint8 num_of_keys;\r\nproto_item *add_link_flag_item;\r\nproto_tree *add_link_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\nadd_link_flag_item = proto_tree_add_item(tree, hf_smcr_add_link_cont_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nadd_link_flag_tree = proto_item_add_subtree(add_link_flag_item, ett_add_link_cont_flag);\r\nproto_tree_add_item(add_link_flag_tree, hf_smcr_add_link_cont_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_number_of_rkeys, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nnum_of_keys = tvb_get_guint8(tvb,offset);\r\noffset += 1;\r\nif (num_of_keys >= 1) {\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p1_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p1_rkey2, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p1_virt_addr, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\nif (num_of_keys >= 2) {\r\noffset += VIRTUAL_ADDR_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p2_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p2_rkey2, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_add_link_cont_p2_virt_addr, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\n}\r\n}\r\n}\r\nstatic void\r\ndisect_smcr_delete_link(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *delete_link_flag_item;\r\nproto_tree *delete_link_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\ndelete_link_flag_item = proto_tree_add_item(tree, hf_smcr_delete_link_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\ndelete_link_flag_tree = proto_item_add_subtree(delete_link_flag_item, ett_delete_link_flag);\r\nproto_tree_add_item(delete_link_flag_tree, hf_smcr_delete_link_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(delete_link_flag_tree, hf_smcr_delete_link_all, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(delete_link_flag_tree, hf_smcr_delete_link_orderly, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_delete_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_delete_link_reason_code, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_confirm_rkey(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nguint8 num_entries;\r\nproto_item *confirm_rkey_flag_item;\r\nproto_tree *confirm_rkey_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\nconfirm_rkey_flag_item = proto_tree_add_item(tree, hf_smcr_confirm_rkey_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nconfirm_rkey_flag_tree = proto_item_add_subtree(confirm_rkey_flag_item, ett_confirm_rkey_flag);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_negative_response,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_retry_rkey_set,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nnum_entries = tvb_get_guint8(tvb,offset);\r\nif (num_entries > 2)\r\nnum_entries = 2;\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_new_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_virtual_address, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\nfor (; num_entries > 0; num_entries--) {\r\noffset += VIRTUAL_ADDR_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_new_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_virtual_address, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndisect_smcr_confirm_rkey_cont(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *confirm_rkey_flag_item;\r\nproto_tree *confirm_rkey_flag_tree;\r\nguint8 num_entries;\r\noffset = LLC_MSG_START_OFFSET;\r\nconfirm_rkey_flag_item = proto_tree_add_item(tree, hf_smcr_confirm_rkey_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nconfirm_rkey_flag_tree = proto_item_add_subtree(confirm_rkey_flag_item, ett_confirm_rkey_flag);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_negative_response,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(confirm_rkey_flag_tree, hf_smcr_confirm_rkey_retry_rkey_set,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nnum_entries = tvb_get_guint8(tvb,offset);\r\nif (num_entries > 3)\r\nnum_entries = 3;\r\noffset += 1;\r\nfor (; num_entries > 0; num_entries--) {\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_link_number, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_new_rkey, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\nproto_tree_add_item(tree, hf_smcr_confirm_rkey_virtual_address, tvb,\r\noffset, VIRTUAL_ADDR_LEN, ENC_BIG_ENDIAN);\r\noffset += VIRTUAL_ADDR_LEN;\r\n}\r\n}\r\nstatic void\r\ndisect_smcr_delete_rkey(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nguint8 count;\r\nproto_item *delete_rkey_flag_item;\r\nproto_tree *delete_rkey_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\ndelete_rkey_flag_item = proto_tree_add_item(tree, hf_smcr_delete_rkey_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\ndelete_rkey_flag_tree = proto_item_add_subtree(delete_rkey_flag_item, ett_delete_rkey_flag);\r\nproto_tree_add_item(delete_rkey_flag_tree, hf_smcr_delete_rkey_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(delete_rkey_flag_tree, hf_smcr_delete_rkey_negative_response,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nproto_tree_add_item(tree, hf_smcr_delete_rkey_mask, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nfor (count=0; count < 8; count++) {\r\nproto_tree_add_item(tree, hf_smcr_delete_rkey_deleted, tvb,\r\noffset, RKEY_LEN, ENC_BIG_ENDIAN);\r\noffset += RKEY_LEN;\r\n}\r\n}\r\nstatic void\r\ndisect_smcr_test_link(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint offset;\r\nproto_item *test_link_flag_item;\r\nproto_tree *test_link_flag_tree;\r\noffset = LLC_MSG_START_OFFSET;\r\ntest_link_flag_item = proto_tree_add_item(tree, hf_smcr_test_link_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\ntest_link_flag_tree = proto_item_add_subtree(test_link_flag_item, ett_test_link_flag);\r\nproto_tree_add_item(test_link_flag_tree, hf_smcr_test_link_response, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndisect_smcr_rmbe_ctrl(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\ngint offset;\r\nproto_item *rmbe_ctrl_rw_status_flag_item;\r\nproto_tree *rmbe_ctrl_rw_status_flag_tree;\r\nproto_item *rmbe_ctrl_peer_conn_state_flag_item;\r\nproto_tree *rmbe_ctrl_peer_conn_state_flag_tree;\r\noffset = RMBE_CTRL_START_OFFSET;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_seqno, tvb, offset, SEQNO_LEN, ENC_BIG_ENDIAN);\r\noffset += SEQNO_LEN;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_alert_token, tvb, offset, ALERT_TOKEN_LEN, ENC_BIG_ENDIAN);\r\noffset += ALERT_TOKEN_LEN;\r\noffset += TWO_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_prod_wrap_seqno, tvb, offset, SEQNO_LEN, ENC_BIG_ENDIAN);\r\noffset += SEQNO_LEN;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_peer_prod_curs, tvb, offset, CURSOR_LEN, ENC_BIG_ENDIAN);\r\noffset += CURSOR_LEN;\r\noffset += TWO_BYTE_RESERVED;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_cons_wrap_seqno, tvb, offset, SEQNO_LEN, ENC_BIG_ENDIAN);\r\noffset += SEQNO_LEN;\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_peer_cons_curs, tvb, offset, CURSOR_LEN, ENC_BIG_ENDIAN);\r\noffset += CURSOR_LEN;\r\nrmbe_ctrl_rw_status_flag_item =\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_conn_rw_status_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nrmbe_ctrl_rw_status_flag_tree =\r\nproto_item_add_subtree(rmbe_ctrl_rw_status_flag_item, ett_rmbe_ctrl_rw_status_flag);\r\nproto_tree_add_item(rmbe_ctrl_rw_status_flag_tree, hf_smcr_rmbe_ctrl_write_blocked,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_rw_status_flag_tree, hf_smcr_rmbe_ctrl_urgent_pending,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_rw_status_flag_tree, hf_smcr_rmbe_ctrl_urgent_present,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_rw_status_flag_tree, hf_smcr_rmbe_ctrl_cons_update_requested,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_rw_status_flag_tree, hf_smcr_rmbe_ctrl_failover_validation,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\noffset += FLAG_BYTE_LEN;\r\nrmbe_ctrl_peer_conn_state_flag_item =\r\nproto_tree_add_item(tree, hf_smcr_rmbe_ctrl_peer_conn_state_flags, tvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nrmbe_ctrl_peer_conn_state_flag_tree =\r\nproto_item_add_subtree(rmbe_ctrl_peer_conn_state_flag_item, ett_rmbe_ctrl_peer_conn_state_flag);\r\nproto_tree_add_item(rmbe_ctrl_peer_conn_state_flag_tree, hf_smcr_rmbe_ctrl_peer_sending_done,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_peer_conn_state_flag_tree, hf_smcr_rmbe_ctrl_peer_closed_conn,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(rmbe_ctrl_peer_conn_state_flag_tree, hf_smcr_rmbe_ctrl_peer_abnormal_close,\r\ntvb, offset, FLAG_BYTE_LEN, ENC_BIG_ENDIAN);\r\n}\r\nstatic int\r\ndissect_smcr_tcp_pdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data _U_)\r\n{\r\ngint offset;\r\nguint16 msg_len;\r\nclc_message clc_msgid;\r\nproto_item *ti;\r\nproto_tree *smcr_tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SMC-R");\r\nmsg_len = tvb_get_ntohs(tvb, CLC_MSG_LEN_OFFSET);\r\noffset = 4;\r\nclc_msgid = (clc_message) tvb_get_guint8(tvb, offset);\r\ncol_prepend_fstr(pinfo->cinfo, COL_INFO, "[SMC-R-%s],",\r\nval_to_str_const((guint32)clc_msgid,\r\nsmcr_clc_message_txt, "Unknown Command"));\r\nif ((clc_msgid == SMC_CLC_ACCEPT) ||\r\n(clc_msgid == SMC_CLC_CONFIRMATION)) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " QP=0x%06x",\r\ntvb_get_ntoh24(tvb, ACCEPT_CONFIRM_QP_OFFSET));\r\n}\r\nif (!tree)\r\nreturn tvb_reported_length(tvb);\r\nti = proto_tree_add_item(tree, proto_smcr, tvb, 0, msg_len, ENC_NA);\r\nsmcr_tree = proto_item_add_subtree(ti, ett_smcr);\r\nproto_tree_add_item(smcr_tree, hf_smcr_clc_msg, tvb, offset, 1,\r\nENC_BIG_ENDIAN);\r\nswitch (clc_msgid) {\r\ncase SMC_CLC_PROPOSAL:\r\ndisect_smcr_proposal(tvb, smcr_tree);\r\nbreak;\r\ncase SMC_CLC_ACCEPT:\r\ndisect_smcr_accept(tvb, smcr_tree);\r\nbreak;\r\ncase SMC_CLC_CONFIRMATION:\r\ndisect_smcr_confirm(tvb, smcr_tree);\r\nbreak;\r\ncase SMC_CLC_DECLINE:\r\ndisect_smcr_decline(tvb, smcr_tree);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic void\r\ndissect_smcr_infiniband(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint16 msg_len;\r\nllc_message llc_msgid;\r\nproto_item *ti;\r\nproto_tree *smcr_tree;\r\nmsg_len = tvb_get_guint8(tvb, LLC_LEN_OFFSET);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SMC-R");\r\nllc_msgid = (llc_message) tvb_get_guint8(tvb, LLC_CMD_OFFSET);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "[SMC-R] ");\r\ncol_append_str(pinfo->cinfo, COL_INFO,\r\nval_to_str_const((guint32)llc_msgid,\r\nsmcr_llc_message_txt, "Unknown Command"));\r\nif ((llc_msgid != RMBE_CTRL) &&\r\n(tvb_get_guint8(tvb, LLC_CMD_RSP_OFFSET) & LLC_FLAG_RESP))\r\ncol_append_str(pinfo->cinfo, COL_INFO, "(Resp)");\r\nif (!tree)\r\nreturn;\r\nti = proto_tree_add_item(tree, proto_smcr, tvb, 0, msg_len, ENC_NA);\r\nsmcr_tree = proto_item_add_subtree(ti, ett_smcr);\r\nproto_tree_add_item(smcr_tree, hf_smcr_llc_msg, tvb, 0, 1,\r\nENC_BIG_ENDIAN);\r\nswitch (llc_msgid) {\r\ncase LLC_CONFIRM_LINK:\r\ndisect_smcr_confirm_link(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_ADD_LINK:\r\ndisect_smcr_add_link(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_ADD_LINK_CONT:\r\ndisect_smcr_add_continuation(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_DEL_LINK:\r\ndisect_smcr_delete_link(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_CONFIRM_RKEY:\r\ndisect_smcr_confirm_rkey(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_CONFIRM_RKEY_CONT:\r\ndisect_smcr_confirm_rkey_cont(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_DELETE_RKEY:\r\ndisect_smcr_delete_rkey(tvb, smcr_tree);\r\nbreak;\r\ncase LLC_TEST_LINK:\r\ndisect_smcr_test_link(tvb, smcr_tree);\r\nbreak;\r\ncase RMBE_CTRL:\r\ndisect_smcr_rmbe_ctrl(tvb, smcr_tree);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn;\r\n}\r\nstatic guint\r\nget_smcr_pdu_length(packet_info *pinfo _U_, tvbuff_t *tvb, int offset, void *data _U_)\r\n{\r\nguint32 length;\r\nlength = tvb_get_ntohs(tvb, offset+CLC_MSG_LEN_OFFSET);\r\nreturn length;\r\n}\r\nstatic int\r\ndissect_smcr_tcp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data)\r\n{\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, SMCR_TCP_MIN_HEADER_LENGTH,\r\nget_smcr_pdu_length, dissect_smcr_tcp_pdu, data);\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic gboolean\r\ndissect_smcr_tcp_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data)\r\n{\r\nif (tvb_captured_length(tvb) < 4) {\r\nreturn FALSE;\r\n}\r\nif (tvb_get_ntohl(tvb, CLC_MSG_BYTE_0) != SMCR_CLC_ID) return FALSE;\r\ndissect_smcr_tcp(tvb, pinfo, tree, data);\r\nreturn TRUE;\r\n}\r\nstatic gboolean\r\ndissect_smcr_infiniband_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data _U_)\r\n{\r\nguint16 msg_len;\r\nllc_message msg_byte0;\r\nguint8 msg_byte1;\r\nif (tvb_captured_length_remaining(tvb, SMCR_MSG_BYTE_0) < 2)\r\nreturn FALSE;\r\nmsg_byte0 = (llc_message) tvb_get_guint8(tvb,CLC_MSG_BYTE_0);\r\nmsg_byte1 = tvb_get_guint8(tvb,CLC_MSG_BYTE_1);\r\nif (!((msg_byte1 == LLC_MSG_LENGTH) &&\r\n(((msg_byte0 >= LLC_CONFIRM_LINK) &&\r\n(msg_byte0 <= LLC_DELETE_RKEY)) ||\r\n(msg_byte0 == LLC_RMBE_CTRL))))\r\nreturn FALSE;\r\nmsg_len = tvb_get_guint8(tvb, LLC_LEN_OFFSET);\r\nif (msg_len != tvb_reported_length_remaining(tvb, LLC_CMD_OFFSET))\r\nreturn FALSE;\r\ndissect_smcr_infiniband(tvb, pinfo, tree);\r\nreturn TRUE;\r\n}\r\nvoid\r\nproto_register_smcr(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_smcr_clc_msg, {\r\n"CLC Message", "smcr.clc_msg",\r\nFT_UINT8, BASE_DEC, VALS(smcr_clc_message_txt), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_smcr_llc_msg, {\r\n"LLC Message", "smcr.llc_msg",\r\nFT_UINT8, BASE_DEC, VALS(smcr_llc_message_txt), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_proposal_smc_version, {\r\n"SMC Version", "smcr.proposal.smc.version",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL}},\r\n{ &hf_accept_smc_version, {\r\n"SMC Version", "smcr.proposal.smc.version",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL}},\r\n{ &hf_accept_first_contact, {\r\n"First Contact", "smcr.proposal.first.contact",\r\nFT_BOOLEAN, 8, NULL, 0x08, NULL, HFILL}},\r\n{ &hf_confirm_smc_version, {\r\n"SMC Version", "smcr.proposal.smc.version",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL}},\r\n{ &hf_accept_rmb_buffer_size, {\r\n"Server RMB Buffers Size (Compressed Notation)",\r\n"smcr.accept.rmb.buffer.size",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL}},\r\n{ &hf_accept_qp_mtu_value, {\r\n"QP MTU Value (enumerated value)",\r\n"smcr.accept.qp.mtu.value",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL}},\r\n{ &hf_confirm_rmb_buffer_size, {\r\n"Client RMB Buffers Size (Compressed Notation)",\r\n"smcr.confirm.rmb.buffer.size",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL}},\r\n{ &hf_confirm_qp_mtu_value, {\r\n"QP MTU Value (enumerated value)",\r\n"smcr.confirm.qp.mtu.value",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL}},\r\n{ &hf_smcr_proposal_flags, {\r\n"Flags", "smcr.proposal.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_flags, {\r\n"Flags", "smcr.accept.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_flags2, {\r\n"Flags 2", "smcr.accept.flags.2",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_flags, {\r\n"Flags", "smcr.confirm.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_decline_flags, {\r\n"Flags", "smcr.decline.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_flags2, {\r\n"Flags 2", "smcr.confirm.flags.2",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_client_peer_id, {\r\n"Sender (Client) Peer ID", "smcr.proposal.sender.client.peer.id",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_client_preferred_gid, {\r\n"Client Preferred GID", "smcr.proposal.client.preferred.gid",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_client_preferred_mac, {\r\n"Client Preferred MAC Address",\r\n"smcr.proposal.client.preferred.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_peer_id, {\r\n"Sender (Server) Peer ID", "smcr.accept.sender.server.peer.id",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_preferred_gid, {\r\n"Server Preferred GID", "smcr.accept.server.preferred.gid",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_preferred_mac, {\r\n"Server Preferred MAC Address",\r\n"smcr.accept.server.preferred.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_outgoing_interface_subnet_mask, {\r\n"Outgoing Interface Subnet Mask",\r\n"smcr.outgoing.interface.subnet.mask",\r\nFT_IPv4, BASE_NETMASK, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_outgoing_subnet_mask_signifcant_bits, {\r\n"Outgoing Interface Subnet Mask Number of Significant Bits",\r\n"smcr.outgoing.interface.subnet.mask.number.of.significant.bits",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_ipv6_prefix, {\r\n"IPv6 Prefix Value","smcr.proposal.ipv6.prefix.value",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_proposal_ipv6_prefix_length, {\r\n"IPv6 Prefix Length", "smcr.proposal.ipv6.prefix.length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_qp_number, {\r\n"Server QP Number","smcr.accept.server.qp.number",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_rmb_rkey, {\r\n"Server RMB Rkey","smcr.accept.server.rmb.rkey",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_tcp_conn_index, {\r\n"Server TCP Connection Index",\r\n"smcr.accept.server.tcp.conn.index",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_rmb_element_alert_token, {\r\n"Server RMB Element Alert Token",\r\n"smcr.accept.server.rmb.element.alert.token",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_server_rmb_virtual_address, {\r\n"Server's RMB Virtual Address",\r\n"smcr.accept.server.rmb.virtual.address",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_accept_initial_psn, {\r\n"Initial PSN","smcr.accept.initial.psn",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_peer_id, {\r\n"Sender (Client) Peer ID",\r\n"smcr.confirm.sender.client.peer.id",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_gid, {\r\n"Client GID", "smcr.client.gid",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_mac, {\r\n"Client MAC Address", "smcr.confirm.client.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_qp_number, {\r\n"Client QP Number","smcr.confirm.client.qp.number",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_rmb_rkey, {\r\n"Client RMB Rkey","smcr.confirm.client.rmb.rkey",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_tcp_conn_index, {\r\n"Client TCP Connection Index",\r\n"smcr.confirm.client.tcp.conn.index",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_rmb_element_alert_token, {\r\n"Client RMB Element Alert Token",\r\n"smcr.client.rmb.element.alert.token",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_client_rmb_virtual_address, {\r\n"Client's RMB Virtual Address",\r\n"smcr.client.rmb.virtual.address",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_initial_psn, {\r\n"Initial PSN","smcr.initial.psn",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_decline_peer_id, {\r\n"Sender Peer ID", "smcr.sender.peer.id",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_decline_diag_info, {\r\n"Peer Diagnosis Information", "smcr.peer.diag.info",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_gid, {\r\n"Sender GID", "smcr.sender.gid",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_mac, {\r\n"Sender MAC Address", "smcr.confirm.link.sender.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_qp_number, {\r\n"Sender QP Number","smcr.confirm.link.sender.qp.number",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_number, {\r\n"Link Number", "smcr.confirm.link.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_userid, {\r\n"Sender Link User ID",\r\n"smcr.confirm.link.sender.link.userid",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_max_links, {\r\n"Max Links","smcr.confirm.link.max.links",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_flags, {\r\n"Flags", "smcr.confirm.link.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_link_response, {\r\n"Response", "smcr.confirm.link.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_add_link_gid, {\r\n"Sender GID", "smcr.add.link.sender.gid",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_mac, {\r\n"Sender MAC Address", "smcr.add.link.sender.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_qp_number, {\r\n"Sender QP Number","smcr.add.link.sender.qp.number",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_number, {\r\n"Link Number", "smcr.add.link.link.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_initial_psn, {\r\n"Initial PSN", "smcr.add.link.initial.psn",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_flags, {\r\n"Flags", "smcr.add.link.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_response, {\r\n"Add Link Response", "smcr.add.link.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_add_link_response_rejected, {\r\n"Add Link Rejected", "smcr.add.link.response.rejected",\r\nFT_BOOLEAN, 8, NULL, 0x40, NULL, HFILL}},\r\n{ &hf_smcr_add_link_flags2, {\r\n"Flags", "smcr.add.link.flags2",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_smcr_add_link_qp_mtu_value, {\r\n"QP MTU Value", "smcr.add.link.qp.mtu.value",\r\nFT_UINT8, BASE_HEX, NULL, 0x0F, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_flags, {\r\n"Flags", "smcr.add.link.cont.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_response, {\r\n"Response", "smcr.add.link.cont.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_link_number, {\r\n"Link Number", "smcr.add.link.cont.link.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_number_of_rkeys, {\r\n"Number of Rkeys", "smcr.add.link.cont.rkey.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p1_rkey, {\r\n"RMB RToken Pair 1 - Rkey as known on this SMC Link",\r\n"smcr.add.link.cont.rmb.RTok1.Rkey1",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p1_rkey2, {\r\n"RMB RToken Pair 1 - Equivalent Rkey for the new SMC Link",\r\n"smcr.add.link.cont.rmb.RTok1.Rkey2",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p1_virt_addr, {\r\n"RMB RToken Pair 1 Virtual Address for the new SMC Link",\r\n"smcr.add.link.cont.rmb.RTok1.virt",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p2_rkey, {\r\n"RMB RToken Pair 2 - Rkey as known on this SMC Link",\r\n"smcr.add.link.cont.rmb.RTok2.Rkey1",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p2_rkey2, {\r\n"RMB RToken Pair 2 - Equivalent Rkey for the new SMC Link",\r\n"smcr.add.link.cont.rmb.RTok2.Rkey2",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_add_link_cont_p2_virt_addr, {\r\n"RMB RToken Pair 2 Virtual Address for the new SMC Link",\r\n"smcr.add.link.cont.rmb.RTok1.virt",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_flags, {\r\n"Flags", "smcr.delete.link.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_response, {\r\n"Response", "smcr.delete.link.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_all, {\r\n"Terminate All Links In The Link Group",\r\n"smcr.delete.link.all",\r\nFT_BOOLEAN, 8, NULL, 0x40, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_orderly, {\r\n"Terminate Links Orderly", "smcr.delete.link.orderly",\r\nFT_BOOLEAN, 8, NULL, 0x20, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_number, {\r\n"Link Number For The Failed Link", "smcr.delete.link.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_delete_link_reason_code, {\r\n"Reason Code", "smcr.delete.link.reason.code",\r\nFT_UINT32, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_flags, {\r\n"Flags", "smcr.confirm.rkey.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_response, {\r\n"Response", "smcr.confirm.rkey.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_negative_response, {\r\n"Negative Response", "smcr.confirm.rkey.negative.response",\r\nFT_BOOLEAN, 8, NULL, 0x20, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_retry_rkey_set, {\r\n"Retry Rkey Set", "smcr.confirm.rkey.retry.rkey.set",\r\nFT_BOOLEAN, 8, NULL, 0x10, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_number, {\r\n"Number of other QP", "smcr.confirm.rkey.number.qp",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_new_rkey, {\r\n"New Rkey for this link","smcr.confirm.rkey.new.rkey",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_virtual_address, {\r\n"New RMB virtual address for this link",\r\n"smcr.confirm.rkey.new.virt",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_confirm_rkey_link_number, {\r\n"Link Number", "smcr.confirm.rkey.link.number",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_delete_rkey_flags, {\r\n"Flags", "smcr.delete.rkey.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_delete_rkey_response, {\r\n"Response", "smcr.delete.rkey.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_delete_rkey_negative_response, {\r\n"Negative Response", "smcr.delete.rkey.negative.response",\r\nFT_BOOLEAN, 8, NULL, 0x20, NULL, HFILL}},\r\n{ &hf_smcr_delete_rkey_mask, {\r\n"Error Mask", "smcr.delete.rkey.error.mask",\r\nFT_UINT8, BASE_HEX, NULL, 0x00, NULL, HFILL}},\r\n{ &hf_smcr_delete_rkey_deleted, {\r\n"RMB Rkey to be deleted", "smcr.delete.rkey.deleted",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_test_link_flags, {\r\n"Flags", "smcr.test.link.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_test_link_response, {\r\n"Response", "smcr.test.link.response",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_seqno, {\r\n"Sequence Number", "smcr.rmbe.ctrl.seqno",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_alert_token, {\r\n"Alert Token", "smcr.rmbe.ctrl.alert.token",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_prod_wrap_seqno, {\r\n"Producer window wrap sequence number",\r\n"smcr.rmbe.ctrl.prod.wrap.seq",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_prod_curs, {\r\n"Peer Producer Cursor", "smcr.rmbe.ctrl.peer.prod.curs",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_smcr_rmbe_ctrl_cons_wrap_seqno, {\r\n"Consumer window wrap sequence number",\r\n"smcr.rmbe.ctrl.prod.wrap.seq",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_cons_curs, {\r\n"Peer Consumer Cursor", "smcr.rmbe.ctrl.peer.prod.curs",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_conn_rw_status_flags, {\r\n"Connection read/write status flags",\r\n"smcr.rmbe.ctrl.conn.rw.status.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_write_blocked, {\r\n"Write Blocked", "smcr.rmbe.ctrl.write.blocked",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_urgent_pending, {\r\n"Urgent Data Pending", "smcr.rmbe.ctrl.urgent.pending",\r\nFT_BOOLEAN, 8, NULL, 0x40, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_urgent_present, {\r\n"Urgent Data Present", "smcr.rmbe.ctrl.urgent.present",\r\nFT_BOOLEAN, 8, NULL, 0x20, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_cons_update_requested, {\r\n"Consumer Cursor Update Requested",\r\n"smcr.rmbe.ctrl.cons.update.requested",\r\nFT_BOOLEAN, 8, NULL, 0x10, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_failover_validation, {\r\n"Failover Validation Indicator",\r\n"smcr.rmbe.ctrl.failover.validation",\r\nFT_BOOLEAN, 8, NULL, 0x08, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_conn_state_flags, {\r\n"Peer Connection State Flags",\r\n"smcr.rmbe.ctrl.peer.conn.state.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_sending_done, {\r\n"Peer Sending Done", "smcr.rmbe.ctrl.peer.sending.done",\r\nFT_BOOLEAN, 8, NULL, 0x80, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_closed_conn, {\r\n"Peer Closed Connection", "smcr.rmbe.ctrl.peer.closed.conn",\r\nFT_BOOLEAN, 8, NULL, 0x40, NULL, HFILL}},\r\n{ &hf_smcr_rmbe_ctrl_peer_abnormal_close, {\r\n"Peer Abnormal Close", "smcr.rmbe.ctrl.peer.abnormal.close",\r\nFT_BOOLEAN, 8, NULL, 0x20, NULL, HFILL}}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_smcr,\r\n&ett_proposal_flag,\r\n&ett_accept_flag,\r\n&ett_accept_flag2,\r\n&ett_confirm_flag,\r\n&ett_confirm_flag2,\r\n&ett_confirm_link_flag,\r\n&ett_add_link_flag,\r\n&ett_add_link_flag2,\r\n&ett_add_link_cont_flag,\r\n&ett_delete_link_flag,\r\n&ett_confirm_rkey_flag,\r\n&ett_delete_rkey_flag,\r\n&ett_test_link_flag,\r\n&ett_rmbe_ctrl_rw_status_flag,\r\n&ett_rmbe_ctrl_peer_conn_state_flag\r\n};\r\nproto_register_field_array(proto_smcr, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nproto_smcr = proto_register_protocol("Shared Memory Communications - RDMA",\r\n"SMCR", "smcr");\r\nsmcr_tcp_handle = register_dissector("smcr", dissect_smcr_tcp, proto_smcr);\r\n}\r\nvoid\r\nproto_reg_handoff_smcr(void)\r\n{\r\nheur_dissector_add("tcp", dissect_smcr_tcp_heur, "Shared Memory Communications over TCP", "smcr_tcp", proto_smcr, HEURISTIC_ENABLE);\r\nheur_dissector_add("infiniband.payload", dissect_smcr_infiniband_heur, "Shared Memory Communications Infiniband", "smcr_infiniband", proto_smcr, HEURISTIC_ENABLE);\r\n}
