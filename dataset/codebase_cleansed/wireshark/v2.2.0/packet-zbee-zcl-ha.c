static int\r\ndissect_zbee_zcl_appl_idt(tvbuff_t *tvb _U_, packet_info *pinfo _U_, proto_tree *tree _U_, void* data _U_)\r\n{\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\ndissect_zcl_appl_idt_attr_data(proto_tree *tree, tvbuff_t *tvb, guint *offset, guint16 attr_id, guint data_type)\r\n{\r\nproto_tree *sub_tree;\r\nguint64 value64;\r\nswitch ( attr_id ) {\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_BASIC_IDENT:\r\nvalue64 = tvb_get_letoh56(tvb, *offset);\r\nsub_tree = proto_tree_add_subtree_format(tree, tvb, *offset, 8, ett_zbee_zcl_appl_idt_basic, NULL,\r\n"Basic Identification: 0x%" G_GINT64_MODIFIER "x", value64);\r\nproto_tree_add_item(sub_tree, hf_zbee_zcl_appl_idt_company_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nproto_tree_add_item(sub_tree, hf_zbee_zcl_appl_idt_brand_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nproto_tree_add_item(sub_tree, hf_zbee_zcl_appl_idt_prod_type_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nproto_tree_add_item(sub_tree, hf_zbee_zcl_appl_idt_ceced_spec_ver, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_COMPANY_ID:\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_company_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_BRAND_ID:\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_brand_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_PROD_TYPE_NAME:\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_string_len, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_prod_type_name, tvb, *offset, 2, ENC_BIG_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_PROD_TYPE_ID:\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_prod_type_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_APPL_IDT_CECED_SPEC_VER:\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_idt_ceced_spec_ver, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nbreak;\r\ndefault:\r\ndissect_zcl_attr_data(tvb, tree, offset, data_type);\r\nbreak;\r\n}\r\n}\r\nvoid\r\nproto_register_zbee_zcl_appl_idt(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_appl_idt_attr_id,\r\n{ "Attribute", "zbee_zcl_ha.applident.attr_id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_idt_attr_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_company_id,\r\n{ "Company ID", "zbee_zcl_ha.applident.attr.company.id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_idt_company_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_brand_id,\r\n{ "Brand ID", "zbee_zcl_ha.applident.attr.brand.id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_idt_brand_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_string_len,\r\n{ "Length", "zbee_zcl_ha.applident.string.len", FT_UINT8, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_prod_type_name,\r\n{ "Product Type Name", "zbee_zcl_ha.applident.attr.prod_type.name", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_idt_prod_type_name_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_prod_type_id,\r\n{ "Product Type ID", "zbee_zcl_ha.applident.attr.prod_type.id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_idt_prod_type_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_idt_ceced_spec_ver,\r\n{ "CECED Spec. Version", "zbee_zcl_ha.applident.attr.ceced_spec_ver", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_idt_ceced_spec_ver_names),\r\n0x00, NULL, HFILL } }\r\n};\r\ngint *ett[ZBEE_ZCL_APPL_IDT_NUM_ETT];\r\nett[0] = &ett_zbee_zcl_appl_idt;\r\nett[1] = &ett_zbee_zcl_appl_idt_basic;\r\nproto_zbee_zcl_appl_idt = proto_register_protocol("ZigBee ZCL Appliance Identification", "ZCL Appliance Identification", ZBEE_PROTOABBREV_ZCL_APPLIDT);\r\nproto_register_field_array(proto_zbee_zcl_appl_idt, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_APPLIDT, dissect_zbee_zcl_appl_idt, proto_zbee_zcl_appl_idt);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_appl_idt(void)\r\n{\r\nzbee_zcl_init_cluster( proto_zbee_zcl_appl_idt,\r\nett_zbee_zcl_appl_idt,\r\nZBEE_ZCL_CID_APPLIANCE_IDENTIFICATION,\r\nhf_zbee_zcl_appl_idt_attr_id,\r\n-1, -1,\r\n(zbee_zcl_fn_attr_data)dissect_zcl_appl_idt_attr_data\r\n);\r\n}\r\nstatic int\r\ndissect_zbee_zcl_met_idt(tvbuff_t *tvb _U_, packet_info *pinfo _U_, proto_tree *tree _U_, void* data _U_)\r\n{\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\ndissect_zcl_met_idt_attr_data(proto_tree *tree, tvbuff_t *tvb, guint *offset, guint16 attr_id, guint data_type)\r\n{\r\nswitch ( attr_id ) {\r\ncase ZBEE_ZCL_ATTR_ID_MET_IDT_METER_TYPE_ID:\r\nproto_tree_add_item(tree, hf_zbee_zcl_met_idt_meter_type_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ncase ZBEE_ZCL_ATTR_ID_MET_IDT_DATA_QUALITY_ID:\r\nproto_tree_add_item(tree, hf_zbee_zcl_met_idt_data_quality_id, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nbreak;\r\ndefault:\r\ndissect_zcl_attr_data(tvb, tree, offset, data_type);\r\nbreak;\r\n}\r\n}\r\nvoid\r\nproto_register_zbee_zcl_met_idt(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_met_idt_attr_id,\r\n{ "Attribute", "zbee_zcl_ha.metidt.attr_id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_met_idt_attr_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_met_idt_meter_type_id,\r\n{ "Meter Type ID", "zbee_zcl_ha.metidt.attr.meter_type.id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_met_idt_meter_type_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_met_idt_data_quality_id,\r\n{ "Data Quality ID", "zbee_zcl_ha.metidt.attr.data_quality.id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_met_idt_data_quality_names),\r\n0x00, NULL, HFILL } }\r\n};\r\nproto_zbee_zcl_met_idt = proto_register_protocol("ZigBee ZCL Meter Identification", "ZCL Meter Identification", ZBEE_PROTOABBREV_ZCL_METIDT);\r\nproto_register_field_array(proto_zbee_zcl_met_idt, hf, array_length(hf));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_METIDT, dissect_zbee_zcl_met_idt, proto_zbee_zcl_met_idt);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_met_idt(void)\r\n{\r\nzbee_zcl_init_cluster( proto_zbee_zcl_met_idt,\r\nett_zbee_zcl_met_idt,\r\nZBEE_ZCL_CID_METER_IDENTIFICATION,\r\nhf_zbee_zcl_met_idt_attr_id,\r\n-1, -1,\r\n(zbee_zcl_fn_attr_data)dissect_zcl_met_idt_attr_data\r\n);\r\n}\r\nstatic int\r\ndissect_zbee_zcl_appl_evtalt(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nproto_tree *payload_tree;\r\nzbee_zcl_packet *zcl;\r\nguint offset = 0;\r\nguint8 cmd_id;\r\ngint rem_len;\r\nif (data == NULL)\r\nreturn 0;\r\nzcl = (zbee_zcl_packet *)data;\r\ncmd_id = zcl->cmd_id;\r\nif (zcl->direction == ZBEE_ZCL_FCF_TO_SERVER) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_appl_evtalt_srv_rx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_srv_rx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\nproto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_appl_evtalt, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_APPL_EVTALT_GET_ALERTS_CMD:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nelse {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_appl_evtalt_srv_tx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_srv_tx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_appl_evtalt, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_APPL_EVTALT_GET_ALERTS_RSP_CMD:\r\ncase ZBEE_ZCL_CMD_ID_APPL_EVTALT_ALERTS_NOTIF_CMD:\r\ndissect_zcl_appl_evtalt_get_alerts_rsp(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_APPL_EVTALT_EVENT_NOTIF_CMD:\r\ndissect_zcl_appl_evtalt_event_notif(tvb, payload_tree, &offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_zcl_appl_evtalt_alerts_struct(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_alert_id, tvb, *offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_category, tvb, *offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_status, tvb, *offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_reserved, tvb, *offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_proprietary, tvb, *offset, 3, ENC_BIG_ENDIAN);\r\n*offset += 3;\r\n}\r\nstatic void\r\ndissect_zcl_appl_evtalt_get_alerts_rsp(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree *sub_tree = NULL;\r\nguint i;\r\nguint8 count;\r\ncount = tvb_get_guint8(tvb, *offset) & ZBEE_ZCL_APPL_EVTALT_COUNT_NUM_MASK;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_count_num, tvb, *offset, 1, ENC_NA);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_count_type, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nfor ( i=0 ; i<count ; i++)\r\n{\r\nsub_tree = proto_tree_add_subtree_format(tree, tvb, *offset, 1,\r\nett_zbee_zcl_appl_evtalt_alerts_struct[i], NULL, "Alerts Structure #%u", i);\r\ndissect_zcl_appl_evtalt_alerts_struct(tvb, sub_tree, offset);\r\n}\r\n}\r\nstatic void\r\ndissect_zcl_appl_evtalt_event_notif(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_event_hdr, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_evtalt_event_id, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\n}\r\nvoid\r\nproto_register_zbee_zcl_appl_evtalt(void)\r\n{\r\nguint i, j;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_appl_evtalt_srv_tx_cmd_id,\r\n{ "Command", "zbee_zcl_ha.applevtalt.cmd.srv_tx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_evtalt_srv_tx_cmd_names),\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_srv_rx_cmd_id,\r\n{ "Command", "zbee_zcl_ha.applevtalt.cmd.srv_rx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_evtalt_srv_rx_cmd_names),\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_count_num,\r\n{ "Number of Alerts", "zbee_zcl_ha.applevtalt.count.num", FT_UINT8, BASE_DEC, NULL,\r\nZBEE_ZCL_APPL_EVTALT_COUNT_NUM_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_count_type,\r\n{ "Type of Alerts", "zbee_zcl_ha.applevtalt.count.type", FT_UINT8, BASE_DEC, NULL,\r\nZBEE_ZCL_APPL_EVTALT_COUNT_TYPE_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_alert_id,\r\n{ "Alert Id", "zbee_zcl_ha.applevtalt.alert_id", FT_UINT24, BASE_HEX, NULL,\r\nZBEE_ZCL_APPL_EVTALT_ALERT_ID_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_category,\r\n{ "Category", "zbee_zcl_ha.applevtalt.category", FT_UINT24, BASE_HEX, VALS(zbee_zcl_appl_evtalt_category_names),\r\nZBEE_ZCL_APPL_EVTALT_CATEGORY_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_status,\r\n{ "Status", "zbee_zcl_ha.applevtalt.status", FT_UINT24, BASE_HEX, VALS(zbee_zcl_appl_evtalt_status_names),\r\nZBEE_ZCL_APPL_EVTALT_STATUS_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_reserved,\r\n{ "Reserved", "zbee_zcl_ha.applevtalt.reserved", FT_UINT24, BASE_HEX, NULL,\r\nZBEE_ZCL_APPL_EVTALT_RESERVED_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_proprietary,\r\n{ "Proprietary", "zbee_zcl_ha.applevtalt.proprietary", FT_UINT24, BASE_HEX, NULL,\r\nZBEE_ZCL_APPL_EVTALT_PROPRIETARY_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_event_hdr,\r\n{ "Event Header", "zbee_zcl_ha.applevtalt.event.header", FT_UINT8, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_evtalt_event_id,\r\n{ "Event Id", "zbee_zcl_ha.applevtalt.event.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_evtalt_event_id_names),\r\n0x00, NULL, HFILL } }\r\n};\r\ngint *ett[ZBEE_ZCL_APPL_EVTALT_NUM_ETT];\r\nett[0] = &ett_zbee_zcl_appl_evtalt;\r\nfor ( i = 0, j = ZBEE_ZCL_APPL_EVTALT_NUM_GENERIC_ETT; i < ZBEE_ZCL_APPL_EVTALT_NUM_STRUCT_ETT; i++, j++) {\r\nett_zbee_zcl_appl_evtalt_alerts_struct[i] = -1;\r\nett[j] = &ett_zbee_zcl_appl_evtalt_alerts_struct[i];\r\n}\r\nproto_zbee_zcl_appl_evtalt = proto_register_protocol("ZigBee ZCL Appliance Events & Alert", "ZCL Appliance Events & Alert", ZBEE_PROTOABBREV_ZCL_APPLEVTALT);\r\nproto_register_field_array(proto_zbee_zcl_appl_evtalt, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_APPLEVTALT, dissect_zbee_zcl_appl_evtalt, proto_zbee_zcl_appl_evtalt);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_appl_evtalt(void)\r\n{\r\ndissector_handle_t appl_evtalt_handle;\r\nappl_evtalt_handle = find_dissector(ZBEE_PROTOABBREV_ZCL_APPLEVTALT);\r\ndissector_add_uint("zbee.zcl.cluster", ZBEE_ZCL_CID_APPLIANCE_EVENTS_AND_ALERT, appl_evtalt_handle);\r\nzbee_zcl_init_cluster( proto_zbee_zcl_appl_evtalt,\r\nett_zbee_zcl_appl_evtalt,\r\nZBEE_ZCL_CID_APPLIANCE_EVENTS_AND_ALERT,\r\n-1,\r\nhf_zbee_zcl_appl_evtalt_srv_rx_cmd_id,\r\nhf_zbee_zcl_appl_evtalt_srv_tx_cmd_id,\r\nNULL\r\n);\r\n}\r\nstatic int\r\ndissect_zbee_zcl_appl_stats (tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nproto_tree *payload_tree;\r\nzbee_zcl_packet *zcl;\r\nguint offset = 0;\r\nguint8 cmd_id;\r\ngint rem_len;\r\nif (data == NULL)\r\nreturn 0;\r\nzcl = (zbee_zcl_packet *)data;\r\ncmd_id = zcl->cmd_id;\r\nif (zcl->direction == ZBEE_ZCL_FCF_TO_SERVER) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_appl_stats_srv_rx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_srv_rx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_appl_stats, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_LOG_REQ:\r\ndissect_zcl_appl_stats_log_req(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_LOG_QUEUE_REQ:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nelse {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_appl_stats_srv_tx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_srv_tx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_appl_stats, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_LOG_NOTIF:\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_LOG_RSP:\r\ndissect_zcl_appl_stats_log_rsp(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_LOG_QUEUE_RSP:\r\ncase ZBEE_ZCL_CMD_ID_APPL_STATS_STATS_AVAILABLE:\r\ndissect_zcl_appl_stats_log_queue_rsp(tvb, payload_tree, &offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_zcl_appl_stats_log_req(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_id, tvb, *offset, 4, ENC_LITTLE_ENDIAN);\r\n*offset += 4;\r\n}\r\nstatic void\r\ndissect_zcl_appl_stats_log_rsp(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nguint32 log_len;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_utc_time, tvb, *offset, 4, ENC_LITTLE_ENDIAN);\r\n*offset += 4;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_id, tvb, *offset, 4, ENC_LITTLE_ENDIAN);\r\n*offset += 4;\r\nlog_len = tvb_get_letohl(tvb, *offset);\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_length, tvb, *offset, 4, ENC_LITTLE_ENDIAN);\r\n*offset += 4;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_payload, tvb, *offset, log_len, ENC_NA);\r\n*offset += log_len;\r\n}\r\nstatic void\r\ndissect_zcl_appl_stats_log_queue_rsp(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\ngint list_len;\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_queue_size, tvb, *offset, 1, ENC_NA);\r\n*offset += 1;\r\nlist_len = tvb_reported_length_remaining(tvb, *offset);\r\nif ( list_len > 0 ) {\r\nwhile ( *offset < (guint)list_len ) {\r\nproto_tree_add_item(tree, hf_zbee_zcl_appl_stats_log_id, tvb, *offset, 4, ENC_LITTLE_ENDIAN);\r\n*offset += 4;\r\n}\r\n}\r\n}\r\nstatic void\r\ndecode_zcl_appl_stats_utc_time(gchar *s, guint32 value)\r\n{\r\nif (value == ZBEE_ZCL_APPL_STATS_INVALID_TIME)\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "Invalid UTC Time");\r\nelse {\r\ngchar *utc_time;\r\nvalue += ZBEE_ZCL_NSTIME_UTC_OFFSET;\r\nutc_time = abs_time_secs_to_str (NULL, value, ABSOLUTE_TIME_LOCAL, TRUE);\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%s", utc_time);\r\nwmem_free(NULL, utc_time);\r\n}\r\n}\r\nvoid\r\nproto_register_zbee_zcl_appl_stats(void)\r\n{\r\nguint i, j;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_appl_stats_attr_id,\r\n{ "Attribute", "zbee_zcl_ha.applstats.attr_id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_appl_stats_attr_names),\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_srv_tx_cmd_id,\r\n{ "Command", "zbee_zcl_ha.applstats.cmd.srv_tx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_stats_srv_tx_cmd_names),\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_srv_rx_cmd_id,\r\n{ "Command", "zbee_zcl_ha.applstats.cmd.srv_rx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_appl_stats_srv_rx_cmd_names),\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_utc_time,\r\n{ "UTC Time", "zbee_zcl_ha.applstats.utc_time", FT_UINT32, BASE_CUSTOM, CF_FUNC(decode_zcl_appl_stats_utc_time),\r\n0x0, NULL, HFILL }},\r\n{ &hf_zbee_zcl_appl_stats_log_length,\r\n{ "Log Length", "zbee_zcl_ha.applstats.log.length", FT_UINT32, BASE_DEC, NULL,\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_log_id,\r\n{ "Log ID", "zbee_zcl_ha.applstats.log.id", FT_UINT32, BASE_DEC, NULL,\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_log_queue_size,\r\n{ "Log Queue Size", "zbee_zcl_ha.applstats.log_queue_size", FT_UINT8, BASE_DEC, NULL,\r\n0x0, NULL, HFILL } },\r\n{ &hf_zbee_zcl_appl_stats_log_payload,\r\n{ "Log Payload", "zbee_zcl_ha.applstats.log.payload", FT_BYTES, SEP_COLON, NULL,\r\n0x00, NULL, HFILL } },\r\n};\r\nstatic gint *ett[ZBEE_ZCL_APPL_STATS_NUM_ETT];\r\nett[0] = &ett_zbee_zcl_appl_stats;\r\nfor ( i = 0, j = ZBEE_ZCL_APPL_STATS_NUM_GENERIC_ETT; i < ZBEE_ZCL_APPL_STATS_NUM_LOGS_ETT; i++, j++ ) {\r\nett_zbee_zcl_appl_stats_logs[i] = -1;\r\nett[j] = &ett_zbee_zcl_appl_stats_logs[i];\r\n}\r\nproto_zbee_zcl_appl_stats = proto_register_protocol("ZigBee ZCL Appliance Statistics", "ZCL Appliance Statistics", ZBEE_PROTOABBREV_ZCL_APPLSTATS);\r\nproto_register_field_array(proto_zbee_zcl_appl_stats, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_APPLSTATS, dissect_zbee_zcl_appl_stats, proto_zbee_zcl_appl_stats);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_appl_stats(void)\r\n{\r\ndissector_handle_t appl_stats_handle;\r\nappl_stats_handle = find_dissector(ZBEE_PROTOABBREV_ZCL_APPLSTATS);\r\ndissector_add_uint("zbee.zcl.cluster", ZBEE_ZCL_CID_APPLIANCE_STATISTICS, appl_stats_handle);\r\nzbee_zcl_init_cluster( proto_zbee_zcl_appl_stats,\r\nett_zbee_zcl_appl_stats,\r\nZBEE_ZCL_CID_APPLIANCE_STATISTICS,\r\nhf_zbee_zcl_appl_stats_attr_id,\r\nhf_zbee_zcl_appl_stats_srv_rx_cmd_id,\r\nhf_zbee_zcl_appl_stats_srv_tx_cmd_id,\r\nNULL\r\n);\r\n}
