static int\r\ndissect_marker(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *marker_tree;\r\nproto_item *ti;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "CISCO ERSPAN3 MARKER");\r\nif (tree) {\r\nguint32 offset = 20;\r\nti = proto_tree_add_item(tree, hfi_marker, tvb, 0, -1, ENC_NA);\r\nmarker_tree = proto_item_add_subtree(ti, ett_marker);\r\nproto_tree_add_item(marker_tree, &cisco_erspan_prop_header, tvb, 0, 20, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(marker_tree, &cisco_erspan_info, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_version, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(marker_tree, &cisco_erspan_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(marker_tree, &cisco_erspan_ssid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_granularity, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(marker_tree, &cisco_erspan_utcoffset, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset+= 2;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_timestamp, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_utc_sec, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_utc_usec, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_sequence_number, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_reserved, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(marker_tree, &cisco_erspan_tail, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_erpsan_marker(void)\r\n{\r\n#ifndef HAVE_HFI_SECTION_INIT\r\nstatic header_field_info *hfi[] = {\r\n&cisco_erspan_prop_header,\r\n&cisco_erspan_info,\r\n&cisco_erspan_version,\r\n&cisco_erspan_type,\r\n&cisco_erspan_ssid,\r\n&cisco_erspan_granularity,\r\n&cisco_erspan_utcoffset,\r\n&cisco_erspan_timestamp,\r\n&cisco_erspan_utc_sec,\r\n&cisco_erspan_utc_usec,\r\n&cisco_erspan_sequence_number,\r\n&cisco_erspan_reserved,\r\n&cisco_erspan_tail\r\n};\r\n#endif\r\nstatic gint *ett[] = {\r\n&ett_marker,\r\n};\r\nint proto_marker;\r\nproto_marker = proto_register_protocol("CISCO ERSPAN3 Marker Packet", "CISCO3 ERSPAN MARKER", "cisco-erspan3-marker");\r\nhfi_marker = proto_registrar_get_nth(proto_marker);\r\nproto_register_fields(proto_marker, hfi, array_length(hfi));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nmarker_handle = create_dissector_handle(dissect_marker, proto_marker);\r\n}\r\nvoid\r\nproto_reg_handoff_erspan_marker(void)\r\n{\r\ndissector_add_for_decode_as("udp.port", marker_handle);\r\n}
