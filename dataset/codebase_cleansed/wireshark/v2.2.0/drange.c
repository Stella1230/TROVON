drange_node*\r\ndrange_node_new(void)\r\n{\r\ndrange_node* new_range_node;\r\nnew_range_node = g_new(drange_node,1);\r\nnew_range_node->start_offset = 0;\r\nnew_range_node->length = 0;\r\nnew_range_node->end_offset = 0;\r\nnew_range_node->ending = DRANGE_NODE_END_T_UNINITIALIZED;\r\nreturn new_range_node;\r\n}\r\nstatic drange_node*\r\ndrange_node_dup(drange_node *org)\r\n{\r\ndrange_node *new_range_node;\r\nif (!org)\r\nreturn NULL;\r\nnew_range_node = g_new(drange_node,1);\r\nnew_range_node->start_offset = org->start_offset;\r\nnew_range_node->length = org->length;\r\nnew_range_node->end_offset = org->end_offset;\r\nnew_range_node->ending = org->ending;\r\nreturn new_range_node;\r\n}\r\nvoid\r\ndrange_node_free(drange_node* drnode)\r\n{\r\ng_free(drnode);\r\n}\r\ngint\r\ndrange_node_get_start_offset(drange_node* drnode)\r\n{\r\ng_assert(drnode->ending != DRANGE_NODE_END_T_UNINITIALIZED);\r\nreturn drnode->start_offset;\r\n}\r\ngint\r\ndrange_node_get_length(drange_node* drnode)\r\n{\r\ng_assert(drnode->ending == DRANGE_NODE_END_T_LENGTH);\r\nreturn drnode->length;\r\n}\r\ngint\r\ndrange_node_get_end_offset(drange_node* drnode)\r\n{\r\ng_assert(drnode->ending == DRANGE_NODE_END_T_OFFSET);\r\nreturn drnode->end_offset;\r\n}\r\ndrange_node_end_t\r\ndrange_node_get_ending(drange_node* drnode)\r\n{\r\ng_assert(drnode->ending != DRANGE_NODE_END_T_UNINITIALIZED);\r\nreturn drnode->ending;\r\n}\r\nvoid\r\ndrange_node_set_start_offset(drange_node* drnode, gint offset)\r\n{\r\ndrnode->start_offset = offset;\r\n}\r\nvoid\r\ndrange_node_set_length(drange_node* drnode, gint length)\r\n{\r\ndrnode->length = length;\r\ndrnode->ending = DRANGE_NODE_END_T_LENGTH;\r\n}\r\nvoid\r\ndrange_node_set_end_offset(drange_node* drnode, gint offset)\r\n{\r\ndrnode->end_offset = offset;\r\ndrnode->ending = DRANGE_NODE_END_T_OFFSET;\r\n}\r\nvoid\r\ndrange_node_set_to_the_end(drange_node* drnode)\r\n{\r\ndrnode->ending = DRANGE_NODE_END_T_TO_THE_END;\r\n}\r\ndrange_t *\r\ndrange_new(void)\r\n{\r\ndrange_t * new_drange;\r\nnew_drange = g_new(drange_t,1);\r\nnew_drange->range_list = NULL;\r\nnew_drange->has_total_length = TRUE;\r\nnew_drange->total_length = 0;\r\nnew_drange->min_start_offset = G_MAXINT;\r\nnew_drange->max_start_offset = G_MININT;\r\nreturn new_drange;\r\n}\r\nstatic void\r\ndrange_append_wrapper(gpointer data, gpointer user_data)\r\n{\r\ndrange_node *drnode = (drange_node *)data;\r\ndrange_t *dr = (drange_t *)user_data;\r\ndrange_append_drange_node(dr, drnode);\r\n}\r\ndrange_t *\r\ndrange_new_from_list(GSList *list)\r\n{\r\ndrange_t *new_drange;\r\nnew_drange = drange_new();\r\ng_slist_foreach(list, drange_append_wrapper, new_drange);\r\nreturn new_drange;\r\n}\r\ndrange_t *\r\ndrange_dup(drange_t *org)\r\n{\r\ndrange_t *new_drange;\r\nGSList *p;\r\nif (!org)\r\nreturn NULL;\r\nnew_drange = drange_new();\r\nfor (p = org->range_list; p; p = p->next) {\r\ndrange_node *drnode = (drange_node *)p->data;\r\ndrange_append_drange_node(new_drange, drange_node_dup(drnode));\r\n}\r\nreturn new_drange;\r\n}\r\nstatic void\r\ndrange_node_free_wrapper(gpointer data, gpointer userdata _U_)\r\n{\r\ng_free(data);\r\n}\r\nvoid\r\ndrange_free(drange_t * dr)\r\n{\r\ndrange_node_free_list(dr->range_list);\r\ng_free(dr);\r\n}\r\nvoid\r\ndrange_node_free_list(GSList* list)\r\n{\r\ng_slist_foreach(list, drange_node_free_wrapper, NULL);\r\n}\r\ngboolean drange_has_total_length(drange_t * dr) { return dr->has_total_length; }\r\ngint drange_get_total_length(drange_t * dr) { return dr->total_length; }\r\ngint drange_get_min_start_offset(drange_t * dr) { return dr->min_start_offset; }\r\ngint drange_get_max_start_offset(drange_t * dr) { return dr->max_start_offset; }\r\nstatic void\r\nupdate_drange_with_node(drange_t *dr, drange_node *drnode)\r\n{\r\nif(drnode->ending == DRANGE_NODE_END_T_TO_THE_END){\r\ndr->has_total_length = FALSE;\r\n}\r\nelse if(dr->has_total_length){\r\ndr->total_length += drnode->length;\r\n}\r\nif(drnode->start_offset < dr->min_start_offset){\r\ndr->min_start_offset = drnode->start_offset;\r\n}\r\nif(drnode->start_offset > dr->max_start_offset){\r\ndr->max_start_offset = drnode->start_offset;\r\n}\r\n}\r\nvoid\r\ndrange_prepend_drange_node(drange_t * dr, drange_node* drnode)\r\n{\r\nif(drnode != NULL){\r\ndr->range_list = g_slist_prepend(dr->range_list,drnode);\r\nupdate_drange_with_node(dr, drnode);\r\n}\r\n}\r\nvoid\r\ndrange_append_drange_node(drange_t * dr, drange_node* drnode)\r\n{\r\nif(drnode != NULL){\r\ndr->range_list = g_slist_append(dr->range_list,drnode);\r\nupdate_drange_with_node(dr, drnode);\r\n}\r\n}\r\nvoid\r\ndrange_foreach_drange_node(drange_t * dr, GFunc func, gpointer funcdata)\r\n{\r\ng_slist_foreach(dr->range_list,func,funcdata);\r\n}
