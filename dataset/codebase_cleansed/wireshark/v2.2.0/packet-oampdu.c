static int\r\ndissect_oampdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 oampdu_code;\r\nproto_tree *oampdu_tree;\r\nproto_item *oampdu_item;\r\nstatic const int * oampdu_flags[] = {\r\n&hf_oampdu_flags_link_fault,\r\n&hf_oampdu_flags_dying_gasp,\r\n&hf_oampdu_flags_critical_event,\r\n&hf_oampdu_flags_local_evaluating,\r\n&hf_oampdu_flags_local_stable,\r\n&hf_oampdu_flags_remote_evaluating,\r\n&hf_oampdu_flags_remote_stable,\r\nNULL\r\n};\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "OAM");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\noampdu_item = proto_tree_add_protocol_format(tree, proto_oampdu,\r\ntvb, 0, -1, "OAM Protocol");\r\noampdu_tree = proto_item_add_subtree(oampdu_item, ett_oampdu);\r\nproto_tree_add_bitmask_with_flags(oampdu_tree, tvb, offset, hf_oampdu_flags, ett_oampdu_flags, oampdu_flags, ENC_BIG_ENDIAN, BMT_NO_FALSE|BMT_NO_TFS);\r\noffset += 2;\r\noampdu_code = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(oampdu_tree, hf_oampdu_code, tvb,\r\noffset, 1, oampdu_code);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "OAMPDU: %s", val_to_str_const(oampdu_code, code_vals, "Unknown"));\r\nswitch (oampdu_code)\r\n{\r\ncase OAMPDU_INFORMATION:\r\ndissect_oampdu_information(tvb, oampdu_tree);\r\nbreak;\r\ncase OAMPDU_EVENT_NOTIFICATION:\r\ndissect_oampdu_event_notification(tvb, pinfo, oampdu_tree);\r\nbreak;\r\ncase OAMPDU_VAR_REQUEST:\r\ndissect_oampdu_variable_request(tvb, oampdu_tree);\r\nbreak;\r\ncase OAMPDU_VAR_RESPONSE:\r\ndissect_oampdu_variable_response(tvb, oampdu_tree);\r\nbreak;\r\ncase OAMPDU_LOOPBACK_CTRL:\r\ndissect_oampdu_loopback_control(tvb, oampdu_tree);\r\nbreak;\r\ncase OAMPDU_VENDOR_SPECIFIC:\r\ndissect_oampdu_vendor_specific(tvb, oampdu_tree);\r\ndefault:\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_oampdu_information(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint8 raw_octet;\r\nguint8 info_type;\r\nguint32 offset;\r\nguint16 bytes;\r\nconst guint8 *ptr;\r\nproto_tree *info_tree;\r\nproto_item *info_item;\r\nproto_item *oui_item;\r\nproto_item *item;\r\noffset = OAMPDU_HEADER_SIZE;\r\nwhile (1)\r\n{\r\nbytes = tvb_captured_length_remaining(tvb, offset);\r\nif (bytes < 1) break;\r\ninfo_type = tvb_get_guint8(tvb, offset);\r\nif (info_type == OAMPDU_INFO_TYPE_ENDMARKER) break;\r\ninfo_item = proto_tree_add_uint(tree, hf_oampdu_info_type, tvb,\r\noffset, 1, info_type);\r\nswitch (info_type)\r\n{\r\ncase OAMPDU_INFO_TYPE_LOCAL:\r\ninfo_tree = proto_item_add_subtree(info_item, ett_oampdu_local_info);\r\nbreak;\r\ncase OAMPDU_INFO_TYPE_REMOTE:\r\ninfo_tree = proto_item_add_subtree(info_item, ett_oampdu_remote_info);\r\nbreak;\r\ncase OAMPDU_INFO_TYPE_ORG:\r\ninfo_tree = proto_item_add_subtree(info_item, ett_oampdu_org_info);\r\nbreak;\r\ndefault:\r\ninfo_tree = NULL;\r\nbreak;\r\n}\r\noffset += OAMPDU_INFO_TYPE_SZ;\r\nif ((info_type==OAMPDU_INFO_TYPE_LOCAL)||(info_type==OAMPDU_INFO_TYPE_REMOTE))\r\n{\r\nstatic const int * info_states[] = {\r\n&hf_oampdu_info_state_parser,\r\n&hf_oampdu_info_state_mux,\r\nNULL\r\n};\r\nstatic const int * info_config[] = {\r\n&hf_oampdu_info_oamConfig_mode,\r\n&hf_oampdu_info_oamConfig_uni,\r\n&hf_oampdu_info_oamConfig_lpbk,\r\n&hf_oampdu_info_oamConfig_event,\r\n&hf_oampdu_info_oamConfig_var,\r\nNULL\r\n};\r\nproto_tree_add_item(info_tree, hf_oampdu_info_len,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_INFO_LENGTH_SZ;\r\nproto_tree_add_item(info_tree, hf_oampdu_info_version,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_INFO_VERSION_SZ;\r\nproto_tree_add_item(info_tree, hf_oampdu_info_revision,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_INFO_REVISION_SZ;\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nif (raw_octet == OAMPDU_INFO_TYPE_LOCAL)\r\nproto_tree_add_bitmask(info_tree, tvb, offset, hf_oampdu_info_state, ett_oampdu_local_info_state, info_states, ENC_NA);\r\nelse\r\nproto_tree_add_bitmask(info_tree, tvb, offset, hf_oampdu_info_state, ett_oampdu_remote_info_state, info_states, ENC_NA);\r\noffset += OAMPDU_INFO_STATE_SZ;\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nif (raw_octet == OAMPDU_INFO_TYPE_LOCAL)\r\nproto_tree_add_bitmask(info_tree, tvb, offset, hf_oampdu_info_oamConfig, ett_oampdu_local_info_config, info_config, ENC_NA);\r\nelse\r\nproto_tree_add_bitmask(info_tree, tvb, offset, hf_oampdu_info_oamConfig, ett_oampdu_remote_info_config, info_config, ENC_NA);\r\noffset += OAMPDU_INFO_OAM_CONFIG_SZ;\r\nitem = proto_tree_add_item(info_tree, hf_oampdu_info_oampduConfig,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(item, " (bytes)");\r\noffset += OAMPDU_INFO_OAMPDU_CONFIG_SZ;\r\noui_item = proto_tree_add_item(info_tree, hf_oampdu_info_oui,\r\ntvb, offset, 3, ENC_NA);\r\nAPPEND_OUI_NAME(oui_item, ptr, tvb, offset);\r\noffset += OAMPDU_INFO_OUI_SZ;\r\nproto_tree_add_item(info_tree, hf_oampdu_info_vendor,\r\ntvb, offset, 4, ENC_NA);\r\noffset += OAMPDU_INFO_VENDOR_SPECIFIC_SZ;\r\n}\r\nelse if (info_type == OAMPDU_INFO_TYPE_ORG)\r\n{\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(info_tree, hf_oampdu_info_len,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_INFO_LENGTH_SZ;\r\noui_item = proto_tree_add_item(info_tree, hf_oampdu_info_oui,\r\ntvb, offset, 3, ENC_NA);\r\nAPPEND_OUI_NAME(oui_item, ptr, tvb, offset);\r\noffset += OAMPDU_INFO_OUI_SZ;\r\nproto_tree_add_item(info_tree, hf_oampdu_info_vendor,\r\ntvb, offset, raw_octet-5, ENC_NA);\r\noffset += raw_octet-5;\r\n}\r\nelse\r\n{\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\noffset += raw_octet;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_oampdu_event_notification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint8 raw_octet;\r\nguint8 event_type;\r\nguint32 offset;\r\nguint16 bytes;\r\nproto_tree *event_tree;\r\nproto_item *event_item;\r\noffset = OAMPDU_HEADER_SIZE;\r\nproto_tree_add_item(tree, hf_oampdu_event_sequence,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_SEQUENCE_SZ;\r\nwhile (1)\r\n{\r\nbytes = tvb_captured_length_remaining(tvb, offset);\r\nif (bytes < 1) break;\r\nevent_type = tvb_get_guint8(tvb, offset);\r\nif (event_type == OAMPDU_EVENT_TYPE_END) break;\r\nevent_item = proto_tree_add_uint(tree, hf_oampdu_event_type,\r\ntvb, offset, 1, event_type);\r\noffset += OAMPDU_EVENT_TYPE_SZ;\r\nswitch (event_type)\r\n{\r\ncase OAMPDU_EVENT_TYPE_ESPE:\r\nevent_tree = proto_item_add_subtree(event_item,\r\nett_oampdu_event_espe);\r\nproto_tree_add_item(event_tree, hf_oampdu_event_length,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_LENGTH_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_timeStamp,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_TIMESTAMP_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_espeWindow,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_ESPE_WINDOW_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_espeThreshold,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_ESPE_THRESHOLD_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_espeErrors,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_ESPE_ERRORS_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_espeTotalErrors,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_ESPE_ERR_TOTAL_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_espeTotalEvents,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_ESPE_TOTAL_SZ;\r\nbreak;\r\ncase OAMPDU_EVENT_TYPE_EFE:\r\nevent_tree = proto_item_add_subtree(event_item,\r\nett_oampdu_event_efe);\r\nproto_tree_add_item(event_tree, hf_oampdu_event_length,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_LENGTH_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_timeStamp,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_TIMESTAMP_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efeWindow,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFE_WINDOW_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efeThreshold,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFE_THRESHOLD_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efeErrors,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFE_ERRORS_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efeTotalErrors,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFE_ERR_TOTAL_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efeTotalEvents,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFE_TOTAL_SZ;\r\nbreak;\r\ncase OAMPDU_EVENT_TYPE_EFPE:\r\nevent_tree = proto_item_add_subtree(event_item,\r\nett_oampdu_event_efpe);\r\nproto_tree_add_item(event_tree, hf_oampdu_event_length,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_LENGTH_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_timeStamp,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_TIMESTAMP_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efpeWindow,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFPE_WINDOW_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efpeThreshold,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFPE_THRESHOLD_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efpeErrors,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFPE_ERRORS_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efpeTotalErrors,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFPE_ERR_TOTAL_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efpeTotalEvents,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFPE_TOTAL_SZ;\r\nbreak;\r\ncase OAMPDU_EVENT_TYPE_EFSSE:\r\nevent_tree = proto_item_add_subtree(event_item,\r\nett_oampdu_event_efsse);\r\nproto_tree_add_item(event_tree, hf_oampdu_event_length,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_LENGTH_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_timeStamp,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EVENT_TIMESTAMP_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efsseWindow,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFSSE_WINDOW_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efsseThreshold,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFSSE_THRESHOLD_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efsseErrors,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFSSE_ERRORS_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efsseTotalErrors,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFSSE_ERR_TOTAL_SZ;\r\nproto_tree_add_item(event_tree, hf_oampdu_event_efsseTotalEvents,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += OAMPDU_EFSSE_TOTAL_SZ;\r\nbreak;\r\ncase OAMPDU_EVENT_TYPE_OSE:\r\n{\r\nevent_tree = proto_item_add_subtree(event_item,\r\nett_oampdu_event_ose);\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nevent_item = proto_tree_add_uint(event_tree, hf_oampdu_event_length,\r\ntvb, offset, 1, raw_octet);\r\noffset += OAMPDU_EVENT_LENGTH_SZ;\r\nif (raw_octet < 2)\r\n{\r\nexpert_add_info_format(pinfo, event_item, &ei_oampdu_event_length_bad, "Event length should be at least 2");\r\n}\r\nelse\r\n{\r\noffset += (raw_octet-2);\r\n}\r\nbreak;\r\n}\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_oampdu_variable_request(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint8 raw_octet;\r\nguint32 offset;\r\noffset = OAMPDU_HEADER_SIZE;\r\nwhile (1)\r\n{\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nif (raw_octet == 0) break;\r\nproto_tree_add_uint(tree, hf_oampdu_variable_branch,\r\ntvb,offset, 1, raw_octet);\r\noffset+=1;\r\nswitch (raw_octet)\r\n{\r\ncase OAMPDU_VARS_OBJECT:\r\nproto_tree_add_item(tree, hf_oampdu_variable_object,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_PACKAGE:\r\nproto_tree_add_item(tree, hf_oampdu_variable_package,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_BINDING:\r\nproto_tree_add_item(tree, hf_oampdu_variable_binding,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_ATTRIBUTE:\r\nproto_tree_add_item(tree, hf_oampdu_variable_attribute,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\noffset+=2;\r\n}\r\n}\r\nstatic void\r\ndissect_oampdu_variable_response(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint8 branch, raw_octet;\r\nguint32 offset;\r\noffset = OAMPDU_HEADER_SIZE;\r\nwhile (1)\r\n{\r\nbranch = tvb_get_guint8(tvb, offset);\r\nif (branch == 0) break;\r\nproto_tree_add_uint(tree, hf_oampdu_variable_branch,\r\ntvb,offset, 1, branch);\r\noffset+=1;\r\nswitch (branch)\r\n{\r\ncase OAMPDU_VARS_OBJECT:\r\nproto_tree_add_item(tree, hf_oampdu_variable_object,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_PACKAGE:\r\nproto_tree_add_item(tree, hf_oampdu_variable_package,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_BINDING:\r\nproto_tree_add_item(tree, hf_oampdu_variable_binding,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase OAMPDU_VARS_ATTRIBUTE:\r\nproto_tree_add_item(tree, hf_oampdu_variable_attribute,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\noffset+=2;\r\ndo {\r\nraw_octet = tvb_get_guint8(tvb, offset);\r\nif (raw_octet >= 0x80) {\r\nproto_tree_add_uint(tree, hf_oampdu_variable_indication,\r\ntvb,offset, 1, (raw_octet&0x7F));\r\noffset+=1;\r\nbreak;\r\n}\r\nelse {\r\nif (raw_octet == 0) raw_octet = 128;\r\nproto_tree_add_uint(tree, hf_oampdu_variable_width,\r\ntvb,offset, 1, raw_octet);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_oampdu_variable_value,\r\ntvb, offset, raw_octet, ENC_NA);\r\noffset+=raw_octet;\r\n}\r\n} while (branch==OAMPDU_VARS_OBJECT || branch==OAMPDU_VARS_PACKAGE);\r\n}\r\n}\r\nstatic void\r\ndissect_oampdu_loopback_control(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint32 offset;\r\nguint16 bytes;\r\nstatic const int * ctrl[] = {\r\n&hf_oampdu_lpbk_enable,\r\n&hf_oampdu_lpbk_disable,\r\nNULL\r\n};\r\noffset = OAMPDU_HEADER_SIZE;\r\nbytes = tvb_captured_length_remaining(tvb, offset);\r\nif (bytes >= 1)\r\n{\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_oampdu_lpbk, ett_oampdu_lpbk_ctrl, ctrl, ENC_NA);\r\n}\r\n}\r\nstatic void\r\ndissect_oampdu_vendor_specific(tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nguint32 offset;\r\nguint16 bytes;\r\nguint32 leaf_branch;\r\nguint8 dpoe_opcode;\r\nguint8 variable_length;\r\nguint8 next_byte;\r\nguint8 pir_subtype;\r\nguint8 rr_byte;\r\nconst guint8 *ptr;\r\nconst guint8 oui_cl[] = {OUI_CL_0, OUI_CL_1, OUI_CL_2};\r\nproto_item *oui_item;\r\nproto_tree *oampdu_vendor_specific_tree;\r\nproto_tree *dpoe_opcode_tree;\r\nproto_item *dpoe_opcode_item;\r\nproto_item *dpoe_opcode_response;\r\nproto_tree *dpoe_opcode_response_tree;\r\noffset = OAMPDU_HEADER_SIZE;\r\nbytes = tvb_captured_length_remaining(tvb, offset);\r\nif (bytes >= 3) {\r\noui_item = proto_tree_add_item(tree, hf_oampdu_info_oui, tvb, offset, 3, ENC_NA);\r\nAPPEND_OUI_NAME(oui_item, ptr, tvb, offset);\r\nif (tvb_memeql(tvb, offset, oui_cl, OUI_SIZE) == 0) {\r\noffset += 3;\r\noampdu_vendor_specific_tree = proto_item_add_subtree(oui_item, ett_oampdu_vendor_specific);\r\ndpoe_opcode_item = proto_tree_add_item(oampdu_vendor_specific_tree, hf_oampdu_vendor_specific_dpoe_opcode, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ndpoe_opcode_tree = proto_item_add_subtree(dpoe_opcode_item, ett_dpoe_opcode);\r\ndpoe_opcode = tvb_get_guint8(tvb, offset);\r\noffset +=1;\r\nnext_byte = tvb_get_guint8(tvb, offset);\r\nswitch (dpoe_opcode) {\r\ncase 0x00:\r\nbreak;\r\ncase DPOE_OPCODE_GET_REQUEST:\r\nleaf_branch = tvb_get_ntoh24(tvb, offset);\r\nif (leaf_branch == DPOE_LB_ONU_OBJ) {\r\nproto_tree_add_item(dpoe_opcode_tree, hf_dpoe_variable_descriptor, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nvariable_length = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\noffset += variable_length;\r\n}\r\nnext_byte = tvb_get_guint8(tvb, offset);\r\nwhile (next_byte != 0x00) {\r\nproto_tree_add_item(dpoe_opcode_tree, hf_dpoe_variable_descriptor, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nnext_byte = tvb_get_guint8(tvb, offset);\r\n}\r\nbreak;\r\ncase DPOE_OPCODE_GET_RESPONSE:\r\ncase DPOE_OPCODE_SET_REQUEST:\r\ncase DPOE_OPCODE_SET_RESPONSE:\r\nwhile (next_byte != 0x00) {\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_opcode_tree, hf_dpoe_variable_descriptor, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nleaf_branch = tvb_get_ntoh24(tvb, offset);\r\noffset += 3;\r\nvariable_length = tvb_get_guint8(tvb, offset);\r\ndpoe_opcode_response_tree = proto_item_add_subtree(dpoe_opcode_response, ett_dpoe_opcode_response);\r\nif (variable_length >= 0x80) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_dpoe_variable_response_code, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nvariable_length = 0;\r\noffset += 1;\r\n} else if (variable_length == 0) {\r\noffset += 1;\r\nvariable_length = 128;\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oampdu_variable_value, tvb, offset, variable_length, ENC_NA);\r\n} else {\r\noffset += 1;\r\nif (leaf_branch == (DPOE_LB_ONU_ID)) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_response_eth, tvb, offset, variable_length, ENC_NA);\r\n} else if (leaf_branch == DPOE_LB_MAX_LL) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_mll_b, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_mll_do, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\n} else if (leaf_branch == DPOE_LB_MAX_NET_PORTS) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_response_int, tvb, offset, variable_length, ENC_BIG_ENDIAN);\r\n} else if (leaf_branch == DPOE_LB_NUM_S1_INT) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_response_int, tvb, offset, variable_length, ENC_BIG_ENDIAN);\r\n} else if (leaf_branch == DPOE_LB_OAM_FR) {\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_frame_rate_minimum, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_opcode_response, " (PDUs/100ms)");\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_frame_rate_maximum, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_opcode_response, " (Number of 100ms)");\r\n} else if (leaf_branch == DPOE_LB_REP_THRESH) {\r\nguint8 nqs;\r\nguint8 rvpqs;\r\nguint8 nqs_i;\r\nguint8 rvpqs_i;\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_repthr_nqs, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nnqs = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_repthr_rvpqs, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nrvpqs = tvb_get_guint8(tvb, offset+1);\r\nfor (nqs_i = 0; nqs_i < nqs; nqs_i++) {\r\nfor (rvpqs_i = 0; rvpqs_i < rvpqs; rvpqs_i++) {\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_report_threshold, tvb, offset+2+(2*(nqs_i+rvpqs_i)), 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_opcode_response, " (Report Threshold %i for Queue Set %i)", nqs_i, rvpqs_i);\r\n}\r\n}\r\n} else if (leaf_branch == DPOE_LB_S1_INT_PORT_AUTONEG) {\r\nproto_tree_add_bitmask(dpoe_opcode_response_tree, tvb, offset, hf_oam_dpoe_s1_autoneg, ett_oam_dpoe_s1_autoneg, s1_autoneg_mode_bits, ENC_BIG_ENDIAN);\r\n} else if (leaf_branch == DPOE_LB_USER_PORT_OBJ) {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n} else if (leaf_branch == DPOE_LB_PORT_INGRESS_RULE) {\r\nguint8 pir_mvl;\r\npir_subtype = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_subtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nswitch (pir_subtype) {\r\ncase 0:\r\nbreak;\r\ncase 1:\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_header_precedence, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 2:\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_fc, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_fi, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_msbm, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_lsbm, tvb, offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_operator, tvb, offset+5, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_mvl, tvb, offset+6, 1, ENC_BIG_ENDIAN);\r\npir_mvl = tvb_get_guint8(tvb, offset+6);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_clause_mv, tvb, offset+7, pir_mvl, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 3:\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nrr_byte = tvb_get_guint8(tvb, offset+1);\r\nswitch (rr_byte) {\r\ncase 0x00:\r\nproto_item_append_text(dpoe_opcode_response, " No operation");\r\nbreak;\r\ncase 0x01:\r\nproto_item_append_text(dpoe_opcode_response, " Set Discard Flag for Frame");\r\nbreak;\r\ncase 0x02:\r\nproto_item_append_text(dpoe_opcode_response, " Clear Discard Flag for Frame (Forward Frame)");\r\nbreak;\r\ncase 0x03:\r\nproto_item_append_text(dpoe_opcode_response, " Set destination queue for frame");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_queue, tvb, offset+2, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x04:\r\nproto_item_append_text(dpoe_opcode_response, " Set output field");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_set_fc, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_set_fi, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x05:\r\nproto_item_append_text(dpoe_opcode_response, " Copy output field");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_copy, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x06:\r\nproto_item_append_text(dpoe_opcode_response, " Delete field");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_delete, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x07:\r\nproto_item_append_text(dpoe_opcode_response, " Insert field");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_insert, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x08:\r\nproto_item_append_text(dpoe_opcode_response, " Delete field and Insert current output field");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_replace, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x09:\r\nproto_item_append_text(dpoe_opcode_response, " Do not delete field (override other Delete result)");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_cd, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase 0x0A:\r\nproto_item_append_text(dpoe_opcode_response, " Do not insert field (override other Insert result)");\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_user_port_object_result_rr_ci, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n} else if (leaf_branch == DPOE_LB_QUEUE_CONFIG) {\r\nguint8 qc_n;\r\nguint8 qc_m;\r\nguint8 qc_p;\r\nguint8 qc_j;\r\nguint8 qc_n_i;\r\nguint8 qc_m_i;\r\nguint8 qc_p_i;\r\nguint8 qc_j_i;\r\nproto_tree *dpoe_oam_qc_upstream;\r\nproto_tree *dpoe_oam_qc_upstream_subtree;\r\nproto_tree *dpoe_oam_qc_downstream;\r\nproto_tree *dpoe_oam_qc_downstream_subtree;\r\nproto_tree *dpoe_oam_qc_nq;\r\nproto_tree *dpoe_oam_qc_nq_subtree;\r\nqc_n = tvb_get_guint8(tvb, offset);\r\ndpoe_oam_qc_upstream = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_qc_ll_u, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ndpoe_oam_qc_upstream_subtree = proto_item_add_subtree(dpoe_oam_qc_upstream, ett_oam_dpoe_qc_u);\r\nfor (qc_n_i = 0; qc_n_i < qc_n; qc_n_i++) {\r\noffset++;\r\nqc_m = tvb_get_guint8(tvb, offset);\r\ndpoe_oam_qc_nq = proto_tree_add_item(dpoe_oam_qc_upstream_subtree, hf_oam_dpoe_qc_nq, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_oam_qc_nq, " (Upstream link %i)", qc_n_i);\r\ndpoe_oam_qc_nq_subtree = proto_item_add_subtree(dpoe_oam_qc_nq, ett_oam_dpoe_qc_nq);\r\nfor (qc_m_i = 0; qc_m_i < qc_m; qc_m_i++) {\r\noffset++;\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_oam_qc_nq_subtree, hf_oam_dpoe_qc_queue_size, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_opcode_response, " (Upstream link %i queue %i size)", qc_n_i, qc_m_i);\r\n}\r\n}\r\noffset++;\r\nqc_p = tvb_get_guint8(tvb, offset);\r\ndpoe_oam_qc_downstream = proto_tree_add_item(dpoe_opcode_response_tree, hf_oam_dpoe_qc_ports_d, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ndpoe_oam_qc_downstream_subtree = proto_item_add_subtree(dpoe_oam_qc_downstream, ett_oam_dpoe_qc_d);\r\nfor (qc_p_i = 0; qc_p_i < qc_p; qc_p_i++) {\r\noffset++;\r\nqc_j = tvb_get_guint8(tvb, offset);\r\ndpoe_oam_qc_nq = proto_tree_add_item(dpoe_oam_qc_downstream_subtree, hf_oam_dpoe_qc_nq, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_oam_qc_nq, " (Downstream port %i)", qc_p_i);\r\ndpoe_oam_qc_nq_subtree = proto_item_add_subtree(dpoe_oam_qc_nq, ett_oam_dpoe_qc_nq);\r\nfor (qc_j_i = 0; qc_j_i < qc_j; qc_j_i++) {\r\noffset++;\r\ndpoe_opcode_response = proto_tree_add_item(dpoe_oam_qc_nq_subtree, hf_oam_dpoe_qc_queue_size, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(dpoe_opcode_response, " (Downstream port %i queue %i size)", qc_p_i, qc_j_i);\r\n}\r\n}\r\n} else {\r\nproto_tree_add_item(dpoe_opcode_response_tree, hf_oampdu_variable_value, tvb, offset, variable_length, ENC_NA);\r\n}\r\n}\r\noffset += variable_length;\r\nnext_byte = tvb_get_guint8(tvb, offset);\r\n}\r\nbreak;\r\ncase 0x05:\r\nbreak;\r\ncase 0x06:\r\nbreak;\r\ncase 0x07:\r\nbreak;\r\ncase 0x08:\r\nbreak;\r\ncase 0x09:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\nvoid\r\nproto_register_oampdu(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_oampdu_flags,\r\n{ "Flags", "oampdu.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\n"The Flags Field", HFILL }},\r\n{ &hf_oampdu_flags_link_fault,\r\n{ "Link Fault", "oampdu.flags.linkFault",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_LINK_FAULT,\r\n"The PHY detected a fault in the receive direction. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_dying_gasp,\r\n{ "Dying Gasp", "oampdu.flags.dyingGasp",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_DYING_GASP,\r\n"An unrecoverable local failure occurred. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_critical_event,\r\n{ "Critical Event", "oampdu.flags.criticalEvent",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_CRITICAL_EVENT,\r\n"A critical event has occurred. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_local_evaluating,\r\n{ "Local Evaluating", "oampdu.flags.localEvaluating",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_LOCAL_EVAL,\r\n"Local DTE Discovery process in progress. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_local_stable,\r\n{ "Local Stable", "oampdu.flags.localStable",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_LOCAL_STABLE,\r\n"Local DTE is Stable. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_remote_evaluating,\r\n{ "Remote Evaluating", "oampdu.flags.remoteEvaluating",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_REMOTE_EVAL,\r\n"Remote DTE Discovery process in progress. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_flags_remote_stable,\r\n{ "Remote Stable", "oampdu.flags.remoteStable",\r\nFT_BOOLEAN, 8, TFS(&tfs_true_false), OAMPDU_FLAGS_REMOTE_STABLE,\r\n"Remote DTE is Stable. True = 1, False = 0", HFILL }},\r\n{ &hf_oampdu_code,\r\n{ "OAMPDU code", "oampdu.code",\r\nFT_UINT8, BASE_HEX, VALS(code_vals), 0x0,\r\n"Identifies the TLVs code", HFILL }},\r\n{ &hf_oampdu_info_type,\r\n{ "Type", "oampdu.info.type",\r\nFT_UINT8, BASE_HEX, VALS(info_type_vals), 0x0,\r\n"Identifies the TLV type", HFILL }},\r\n{ &hf_oampdu_info_len,\r\n{ "TLV Length", "oampdu.info.length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Identifies the TLVs type", HFILL }},\r\n{ &hf_oampdu_info_version,\r\n{ "TLV Version", "oampdu.info.version",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"Identifies the TLVs version", HFILL }},\r\n{ &hf_oampdu_info_revision,\r\n{ "TLV Revision", "oampdu.info.revision",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Identifies the TLVs revision", HFILL }},\r\n{ &hf_oampdu_info_state,\r\n{ "OAM DTE States", "oampdu.info.state",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"OAM DTE State of the Mux and the Parser", HFILL }},\r\n{ &hf_oampdu_info_state_parser,\r\n{ "Parser Action", "oampdu.info.state.parser",\r\nFT_UINT8, BASE_HEX, VALS(parser_vals), 0x03,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_state_mux,\r\n{ "Muxiplexer Action", "oampdu.info.state.muxiplexer",\r\nFT_BOOLEAN, 8, TFS(&mux), 0x04,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig,\r\n{ "OAM Configuration", "oampdu.info.oamConfig",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig_mode,\r\n{ "OAM Mode", "oampdu.info.oamConfig.mode",\r\nFT_BOOLEAN, 8, TFS(&oam_mode), OAMPDU_INFO_CONFIG_MODE,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig_uni,\r\n{ "Unidirectional support", "oampdu.flags.dyingGasp",\r\nFT_BOOLEAN, 8, TFS(&oam_uni), OAMPDU_INFO_CONFIG_UNI,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig_lpbk,\r\n{ "Loopback support", "oampdu.flags.criticalEvent",\r\nFT_BOOLEAN, 8, TFS(&oam_lpbk), OAMPDU_INFO_CONFIG_LPBK,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig_event,\r\n{ "Link Events support", "oampdu.flags.localEvaluating",\r\nFT_BOOLEAN, 8, TFS(&oam_event), OAMPDU_INFO_CONFIG_EVENT,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_oamConfig_var,\r\n{ "Variable Retrieval", "oampdu.flags.localStable",\r\nFT_BOOLEAN, 8, TFS(&oam_var), OAMPDU_INFO_CONFIG_VAR,\r\n"Variable Retrieval support", HFILL }},\r\n{ &hf_oampdu_info_oampduConfig,\r\n{ "Max OAMPDU Size", "oampdu.info.oampduConfig",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"OAMPDU Configuration", HFILL }},\r\n{ &hf_oampdu_info_oui,\r\n{ "Organizationally Unique Identifier", "oampdu.info.oui",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_info_vendor,\r\n{ "Vendor Specific Information", "oampdu.info.vendor",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_event_sequence,\r\n{ "Sequence Number", "oampdu.event.sequence",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Identifies the Event Notification TLVs", HFILL }},\r\n{ &hf_oampdu_event_type,\r\n{ "Event Type", "oampdu.event.type",\r\nFT_UINT8, BASE_HEX, VALS(event_type_vals), 0x0,\r\n"Identifies the TLV type", HFILL }},\r\n{ &hf_oampdu_event_length,\r\n{ "Event Length", "oampdu.event.length",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"This field indicates the length in octets of the TLV-tuple", HFILL }},\r\n{ &hf_oampdu_event_timeStamp,\r\n{ "Event Timestamp (100ms)", "oampdu.event.timestamp",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Event Time Stamp in term of 100 ms intervals", HFILL }},\r\n{ &hf_oampdu_event_espeWindow,\r\n{ "Errored Symbol Window", "oampdu.event.espeWindow",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in the period", HFILL }},\r\n{ &hf_oampdu_event_espeThreshold,\r\n{ "Errored Symbol Threshold", "oampdu.event.espeThreshold",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of symbols required to generate the Event", HFILL }},\r\n{ &hf_oampdu_event_espeErrors,\r\n{ "Errored Symbols", "oampdu.event.espeErrors",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in error", HFILL }},\r\n{ &hf_oampdu_event_espeTotalErrors,\r\n{ "Error Running Total", "oampdu.event.espeTotalErrors",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in error since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_espeTotalEvents,\r\n{ "Event Running Total", "oampdu.event.espeTotalEvents",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Total Event generated since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efeWindow,\r\n{ "Errored Frame Window", "oampdu.event.efeWindow",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in the period", HFILL }},\r\n{ &hf_oampdu_event_efeThreshold,\r\n{ "Errored Frame Threshold", "oampdu.event.efeThreshold",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of frames required to generate the Event", HFILL }},\r\n{ &hf_oampdu_event_efeErrors,\r\n{ "Errored Frames", "oampdu.event.efeErrors",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in error", HFILL }},\r\n{ &hf_oampdu_event_efeTotalErrors,\r\n{ "Error Running Total", "oampdu.event.efeTotalErrors",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of frames in error since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efeTotalEvents,\r\n{ "Event Running Total", "oampdu.event.efeTotalEvents",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Total Event generated since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efpeWindow,\r\n{ "Errored Frame Window", "oampdu.event.efpeWindow",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of frame in error during the period", HFILL }},\r\n{ &hf_oampdu_event_efpeThreshold,\r\n{ "Errored Frame Threshold", "oampdu.event.efpeThreshold",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of frames required to generate the Event", HFILL }},\r\n{ &hf_oampdu_event_efpeErrors,\r\n{ "Errored Frames", "oampdu.event.efeErrors",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in error", HFILL }},\r\n{ &hf_oampdu_event_efpeTotalErrors,\r\n{ "Error Running Total", "oampdu.event.efpeTotalErrors",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\n"Number of frames in error since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efpeTotalEvents,\r\n{ "Event Running Total", "oampdu.event.efpeTotalEvents",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Total Event generated since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efsseWindow,\r\n{ "Errored Frame Window", "oampdu.event.efsseWindow",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Number of frame in error during the period", HFILL }},\r\n{ &hf_oampdu_event_efsseThreshold,\r\n{ "Errored Frame Threshold", "oampdu.event.efsseThreshold",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Number of frames required to generate the Event", HFILL }},\r\n{ &hf_oampdu_event_efsseErrors,\r\n{ "Errored Frames", "oampdu.event.efeErrors",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Number of symbols in error", HFILL }},\r\n{ &hf_oampdu_event_efsseTotalErrors,\r\n{ "Error Running Total", "oampdu.event.efsseTotalErrors",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Number of frames in error since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_event_efsseTotalEvents,\r\n{ "Event Running Total", "oampdu.event.efsseTotalEvents",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Total Event generated since reset of the sublayer", HFILL }},\r\n{ &hf_oampdu_variable_branch,\r\n{ "Branch", "oampdu.variable.branch",\r\nFT_UINT8, BASE_HEX, VALS(branch_vals), 0x0,\r\n"Variable Branch, derived from the CMIP protocol in Annex 30A", HFILL }},\r\n{ &hf_oampdu_variable_object,\r\n{ "Leaf", "oampdu.variable.object",\r\nFT_UINT16, BASE_HEX, VALS(object_vals), 0x0,\r\n"Object, derived from the CMIP protocol in Annex 30A", HFILL }},\r\n{ &hf_oampdu_variable_package,\r\n{ "Leaf", "oampdu.variable.package",\r\nFT_UINT16, BASE_HEX, VALS(package_vals), 0x0,\r\n"Package, derived from the CMIP protocol in Annex 30A", HFILL }},\r\n{ &hf_oampdu_variable_binding,\r\n{ "Leaf", "oampdu.variable.binding",\r\nFT_UINT16, BASE_HEX, VALS(binding_vals), 0x0,\r\n"Binding, derived from the CMIP protocol in Annex 30A", HFILL }},\r\n{ &hf_oampdu_variable_attribute,\r\n{ "Leaf", "oampdu.variable.attribute",\r\nFT_UINT16, BASE_HEX|BASE_EXT_STRING, &attribute_vals_ext, 0x0,\r\n"Attribute, derived from the CMIP protocol in Annex 30A", HFILL }},\r\n{ &hf_oampdu_variable_width,\r\n{ "Variable Width", "oampdu.variable.width",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Width", HFILL }},\r\n{ &hf_oampdu_variable_indication,\r\n{ "Variable indication", "oampdu.variable.indication",\r\nFT_UINT8, BASE_HEX, VALS(indication_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oampdu_variable_value,\r\n{ "Variable Value", "oampdu.variable.value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Value", HFILL }},\r\n{ &hf_oampdu_lpbk,\r\n{ "Commands", "oampdu.lpbk.commands",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\n"The List of Loopback Commands", HFILL }},\r\n{ &hf_oampdu_lpbk_enable,\r\n{ "Enable Remote Loopback", "oampdu.lpbk.commands.enable",\r\nFT_BOOLEAN, 8, NULL, OAMPDU_LPBK_ENABLE,\r\n"Enable Remote Loopback Command", HFILL }},\r\n{ &hf_oampdu_lpbk_disable,\r\n{ "Disable Remote Loopback", "oampdu.lpbk.commands.disable",\r\nFT_BOOLEAN, 8, NULL, OAMPDU_LPBK_DISABLE,\r\n"Disable Remote Loopback Command", HFILL }},\r\n{ &hf_oampdu_vendor_specific_dpoe_opcode,\r\n{ "DPoE Opcode", "oampdu.vendor.specific.opcode",\r\nFT_UINT8, BASE_HEX, VALS(vendor_specific_opcode_vals),\r\n0x0, NULL, HFILL }},\r\n{ &hf_dpoe_variable_descriptor,\r\n{ "Variable Descriptor", "oampdu.variable.descriptor",\r\nFT_UINT8, BASE_HEX, VALS(dpoe_variable_descriptor_vals),\r\n0x0, NULL, HFILL }},\r\n{ &hf_dpoe_variable_response_code,\r\n{ "Response Code", "oampdu.variable.response.code",\r\nFT_UINT8, BASE_HEX, VALS(dpoe_variable_response_code_vals),\r\n0x0, NULL, HFILL }},\r\n{ &hf_oam_dpoe_response_eth,\r\n{ "OAM Response Value", "oampdu.response.eth",\r\nFT_ETHER, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oam_dpoe_response_int,\r\n{ "OAM Response Value", "oampdu.response.int",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_oam_dpoe_mll_b,\r\n{ "Bidirectional", "oampdu.mll.b",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_mll_do,\r\n{ "Downstream-only", "oampdu.mll.do",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_frame_rate_maximum,\r\n{ "Maximum OAM Rate", "oampdu.frame.rate.min",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_frame_rate_minimum,\r\n{ "Minimum OAM Rate", "oampdu.frame.rate.max",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_repthr_nqs,\r\n{ "Number of Queue Sets", "oampdu.report.threshold.queue",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_repthr_rvpqs,\r\n{ "Report Values Per Queue Set", "oampdu.report.threshold.queue.values",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_report_threshold,\r\n{ "Report Threshold", "oampdu.report.threshold",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg,\r\n{ "Auto-Negotiation Capability", "oampdu.s1.autoneg",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_hd,\r\n{ "Half Duplex", "oampdu.s1.autoneg.hd",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x01,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_fd,\r\n{ "Full Duplex", "oampdu.s1.autoneg.fd",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x02,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_10,\r\n{ "10 Mbps", "oampdu.s1.autoneg.10",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x04,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_100,\r\n{ "100 Mbps", "oampdu.s1.autoneg.100",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x08,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_1000,\r\n{ "1000 Mbps", "oampdu.s1.autoneg.1000",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x10,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_10000,\r\n{ "10Gbps", "oampdu.s1.autoneg.10000",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x20,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_fc,\r\n{ "Flow Control", "oampdu.s1.autoneg.fc",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x40,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_s1_autoneg_mdi,\r\n{ "Auto MDI/MDI-X", "oampdu.s1.autoneg.mdi",\r\nFT_BOOLEAN, 16, TFS(&tfs_yes_no), 0x80,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object,\r\n{ "UNI Number", "oampdu.user.port.object",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_subtype,\r\n{ "Subtype", "oampdu.user.port.object.subtype",\r\nFT_UINT16, BASE_DEC, VALS(user_port_object_subtype_vals), 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_header_precedence,\r\n{ "Precedence", "oampdu.user.port.object.header.precedence",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_fc,\r\n{ "Field Code", "oampdu.user.port.object.clause.fc",\r\nFT_UINT8, BASE_HEX, VALS(user_port_object_clause_fc_vals), 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_fi,\r\n{ "Field Instance", "oampdu.user.port.object.clause.fi",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_msbm,\r\n{ "MSB Mask", "oampdu.user.port.object.clause.msbm",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_lsbm,\r\n{ "LSB Mask", "oampdu.user.port.object.clause.lsbm",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_operator,\r\n{ "Operator", "oampdu.user.port.object.clause.operator",\r\nFT_UINT8, BASE_HEX, VALS(user_port_object_clause_operator_vals), 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_mvl,\r\n{ "Match Value Length", "oampdu.user.port.object.clause.mvl",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_clause_mv,\r\n{ "Match Value", "oampdu.user.port.object.clause.mv",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr,\r\n{ "Rule Result", "oampdu.user.port.object.result.rr",\r\nFT_UINT8, BASE_HEX, VALS(user_port_object_result_rr_vals), 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_queue,\r\n{ "{port type, port instance, link, queue}", "oampdu.user.port.object.result.rr.queue",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_set_fc,\r\n{ "Field Code", "oampdu.user.port.object.result.rr.set.fc",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_set_fi,\r\n{ "Field Instance", "oampdu.user.port.object.result.rr.set.fi",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_copy,\r\n{ "Field Code to set from field used in last clause of rule", "oampdu.user.port.object.result.rr.copy",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_delete,\r\n{ "Field Code to remove from frame", "oampdu.user.port.object.result.rr.delete",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_insert,\r\n{ "Field Code to insert into frame", "oampdu.user.port.object.result.rr.insert",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_replace,\r\n{ "Field Code to replace", "oampdu.user.port.object.result.rr.replace",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_cd,\r\n{ "Field Code not to delete", "oampdu.user.port.object.result.rr.cd",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_user_port_object_result_rr_ci,\r\n{ "Field Code not to insert", "oampdu.user.port.object.result.rr.ci",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_qc_ll_u,\r\n{ "Upstream Logical Links", "oampdu.queue_configuration.logical_links.upstream",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_qc_ports_d,\r\n{ "Downstream Ports", "oampdu.queue_configuration.ports.downstream",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_qc_nq,\r\n{"Number of queues", "oampdu.queue_configuration.queues",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{ &hf_oam_dpoe_qc_queue_size,\r\n{"Queue size (in 4KB units)", "oampdu.queue_configuration.size",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_oampdu,\r\n&ett_oampdu_flags,\r\n&ett_oampdu_local_info,\r\n&ett_oampdu_local_info_state,\r\n&ett_oampdu_local_info_config,\r\n&ett_oampdu_remote_info,\r\n&ett_oampdu_remote_info_state,\r\n&ett_oampdu_remote_info_config,\r\n&ett_oampdu_org_info,\r\n&ett_oampdu_event_espe,\r\n&ett_oampdu_event_efe,\r\n&ett_oampdu_event_efpe,\r\n&ett_oampdu_event_efsse,\r\n&ett_oampdu_event_ose,\r\n&ett_oampdu_lpbk_ctrl,\r\n&ett_oampdu_vendor_specific,\r\n&ett_dpoe_opcode,\r\n&ett_dpoe_opcode_response,\r\n&ett_oam_dpoe_s1_autoneg,\r\n&ett_oam_dpoe_qc_u,\r\n&ett_oam_dpoe_qc_d,\r\n&ett_oam_dpoe_qc_nq,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_oampdu_event_length_bad, { "oampdu.event.length.bad", PI_MALFORMED, PI_ERROR, "Event length should be at least 2", EXPFILL }},\r\n};\r\nexpert_module_t* expert_oampdu;\r\nproto_oampdu = proto_register_protocol("OAMPDU", "Ethernet OAM PDU", "oampdu");\r\nproto_register_field_array(proto_oampdu, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_oampdu = expert_register_protocol(proto_oampdu);\r\nexpert_register_field_array(expert_oampdu, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_oampdu(void)\r\n{\r\ndissector_handle_t oampdu_handle;\r\noampdu_handle = create_dissector_handle(dissect_oampdu, proto_oampdu);\r\ndissector_add_uint("slow.subtype", OAM_SUBTYPE, oampdu_handle);\r\n}
