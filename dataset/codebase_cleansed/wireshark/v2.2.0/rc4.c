void crypt_rc4_init(rc4_state_struct *rc4_state,\r\nconst unsigned char *key, int key_len)\r\n{\r\nint ind;\r\nunsigned char j = 0;\r\nunsigned char *s_box;\r\nmemset(rc4_state, 0, sizeof(rc4_state_struct));\r\ns_box = rc4_state->s_box;\r\nfor (ind = 0; ind < 256; ind++)\r\n{\r\ns_box[ind] = (unsigned char)ind;\r\n}\r\nfor( ind = 0; ind < 256; ind++)\r\n{\r\nunsigned char tc;\r\nj += (s_box[ind] + key[ind%key_len]);\r\ntc = s_box[ind];\r\ns_box[ind] = s_box[j];\r\ns_box[j] = tc;\r\n}\r\n}\r\nvoid crypt_rc4(rc4_state_struct *rc4_state, unsigned char *data, int data_len)\r\n{\r\nunsigned char *s_box;\r\nunsigned char index_i;\r\nunsigned char index_j;\r\nint ind;\r\nindex_i = rc4_state->index_i;\r\nindex_j = rc4_state->index_j;\r\ns_box = rc4_state->s_box;\r\nfor( ind = 0; ind < data_len; ind++)\r\n{\r\nunsigned char tc;\r\nunsigned char t;\r\nindex_i++;\r\nindex_j += s_box[index_i];\r\ntc = s_box[index_i];\r\ns_box[index_i] = s_box[index_j];\r\ns_box[index_j] = tc;\r\nt = s_box[index_i] + s_box[index_j];\r\ndata[ind] = data[ind] ^ s_box[t];\r\n}\r\nrc4_state->index_i = index_i;\r\nrc4_state->index_j = index_j;\r\n}
