static int\r\ngluster_gd_mgmt_dissect_uuid(tvbuff_t *tvb, proto_tree *tree, int hfindex,\r\nint offset)\r\n{\r\nif (tree) {\r\ne_guid_t uuid;\r\nint start_offset = offset;\r\nuuid.data1 = (tvb_get_ntohl(tvb, offset) & 0xff) << 24 |\r\n(tvb_get_ntohl(tvb, offset+4) & 0xff) << 16 |\r\n(tvb_get_ntohl(tvb, offset+8) & 0xff) << 8 |\r\n(tvb_get_ntohl(tvb, offset+12) & 0xff);\r\noffset += 16;\r\nuuid.data2 = (tvb_get_ntohl(tvb, offset) & 0xff) << 8 |\r\n(tvb_get_ntohl(tvb, offset+4) & 0xff);\r\noffset += 8;\r\nuuid.data3 = (tvb_get_ntohl(tvb, offset) & 0xff) << 8 |\r\n(tvb_get_ntohl(tvb, offset+4) & 0xff);\r\noffset += 8;\r\nuuid.data4[0] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[1] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[2] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[3] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[4] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[5] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[6] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nuuid.data4[7] = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_guid(tree, hfindex, tvb, start_offset, 4*16, &uuid);\r\n} else\r\noffset += 16 * 4;\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_probe_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_hostname, offset,\r\nNULL);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_port, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_probe_call(tvbuff_t *tvb, packet_info *pinfo _U_,\r\nproto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_hostname, offset,\r\nNULL);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_port, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_friend_add_reply(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_hostname, offset,\r\nNULL);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_port, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_friend_add_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_hostname, offset,\r\nNULL);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_port, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_vols, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_cluster_lock_reply(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_cluster_lock_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nreturn gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid, 0);\r\n}\r\nstatic int\r\ngluster_gd_mgmt_stage_op_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_stage_op_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_commit_op_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_buf, offset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_commit_op_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_buf,\r\noffset);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_friend_update_reply(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\nreturn offset;\r\n}\r\nstatic int\r\ngluster_gd_mgmt_friend_update_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_vols,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_port, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_2_cluster_lock_reply(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_2_cluster_lock_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nreturn gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid, 0);\r\n}\r\nstatic int\r\nglusterd_mgmt_2_stage_op_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_2_stage_op_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_2_commit_op_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_buf, offset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_2_commit_op_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_buf, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_lock_call(tvbuff_t *tvb, packet_info *pinfo _U_,\r\nproto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_tnx_id,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_lock_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_tnx_id,\r\noffset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_pre_val_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_pre_val_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_commit_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_mgmt_3_post_val_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = gluster_gd_mgmt_dissect_uuid(tvb, tree, hf_glusterd_uuid,\r\noffset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op_ret, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_brick_2_common_reply(tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *tree, void* data)\r\n{\r\nint offset = 0;\r\noffset = gluster_dissect_common_reply(tvb, offset, pinfo, tree, data);\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_op_errstr, offset,\r\nNULL);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nglusterd_brick_2_common_call(tvbuff_t *tvb,\r\npacket_info *pinfo _U_, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\noffset = dissect_rpc_string(tvb, tree, hf_glusterd_name, offset,\r\nNULL);\r\noffset = dissect_rpc_uint32(tvb, tree, hf_glusterd_op, offset);\r\noffset = gluster_rpc_dissect_dict(tree, tvb, hf_glusterd_dict, offset);\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_gluster_gd_mgmt(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_gd_mgmt_proc,\r\n{ "Gluster Daemon Management", "glusterd.mgmt.proc",\r\nFT_UINT32, BASE_DEC | BASE_EXT_STRING, &gd_mgmt_proc_vals_ext,\r\n0, NULL, HFILL }\r\n},\r\n{ &hf_gd_mgmt_2_proc,\r\n{ "Gluster Daemon Management", "glusterd.mgmt.proc",\r\nFT_UINT32, BASE_DEC | BASE_EXT_STRING, &gd_mgmt_2_proc_vals_ext,\r\n0, NULL, HFILL }\r\n},\r\n{ &hf_gd_mgmt_3_proc,\r\n{ "Gluster Daemon Management", "glusterd.mgmt.proc",\r\nFT_UINT32, BASE_DEC | BASE_EXT_STRING, &gd_mgmt_3_proc_vals_ext,\r\n0, NULL, HFILL }\r\n},\r\n{ &hf_gd_mgmt_brick_2_proc,\r\n{ "Gluster Daemon Brick Operations",\r\n"glusterd.brick.proc", FT_UINT32, BASE_DEC | BASE_EXT_STRING,\r\n&gd_mgmt_brick_2_proc_vals_ext, 0, NULL,\r\nHFILL }\r\n},\r\n{ &hf_glusterd_friend_proc ,\r\n{ "Gluster Daemon Friend Operations",\r\n"glusterd.friend.proc", FT_UINT32, BASE_DEC | BASE_EXT_STRING,\r\n&glusterd_friend_proc_vals_ext, 0, NULL,\r\nHFILL }\r\n},\r\n{ &hf_glusterd_dict,\r\n{ "Dict", "glusterd.dict", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_op,\r\n{ "Operation", "glusterd.op", FT_UINT32, BASE_DEC | BASE_EXT_STRING,\r\n&glusterd_op_vals_ext, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_op_ret,\r\n{ "Return of previous operation", "glusterd.op_ret",\r\nFT_UINT32, BASE_DEC, NULL , 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_op_errstr,\r\n{ "Error", "glusterd.op_errstr", FT_STRING,\r\nBASE_NONE, NULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_uuid,\r\n{ "UUID", "glusterd.uuid", FT_GUID,\r\nBASE_NONE, NULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_tnx_id,\r\n{ "Transaction ID", "glusterd.tnx_id", FT_GUID,\r\nBASE_NONE, NULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_hostname,\r\n{ "Hostname", "glusterd.hostname", FT_STRING,\r\nBASE_NONE, NULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_port,\r\n{ "Port", "glusterd.port", FT_INT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_vols,\r\n{ "Volumes", "glusterd.vols", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_buf,\r\n{ "Buffer", "glusterd.buffer", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }\r\n},\r\n{ &hf_glusterd_name,\r\n{ "Name", "glusterd.name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_gd_mgmt,\r\n&ett_gd_brick,\r\n&ett_gd_friend\r\n};\r\nproto_glusterd = proto_register_protocol("Gluster Daemon", "GlusterD",\r\n"glusterd");\r\nproto_register_subtree_array(ett, array_length(ett));\r\nproto_register_field_array(proto_glusterd, hf, array_length(hf));\r\nproto_gd_mgmt = proto_register_protocol("Gluster Daemon Management",\r\n"GlusterD Management", "glusterd.mgmt");\r\nproto_gd_brick = proto_register_protocol(\r\n"Gluster Daemon Brick Operations",\r\n"GlusterD Brick", "glusterd.brick");\r\nproto_gd_friend = proto_register_protocol(\r\n"Gluster Daemon Friend Operations",\r\n"GlusterD Friend", "glusterd.friend");\r\n}\r\nvoid\r\nproto_reg_handoff_gluster_gd_mgmt(void)\r\n{\r\nrpc_init_prog(proto_gd_mgmt, GD_MGMT_PROGRAM, ett_gd_mgmt,\r\nG_N_ELEMENTS(glusterd_mgmt_vers_info), glusterd_mgmt_vers_info);\r\nrpc_init_prog(proto_gd_brick, GD_BRICK_PROGRAM, ett_gd_brick,\r\nG_N_ELEMENTS(gd_mgmt_brick_vers_info), gd_mgmt_brick_vers_info);\r\nrpc_init_prog(proto_gd_friend, GD_FRIEND_PROGRAM, ett_gd_friend,\r\nG_N_ELEMENTS(glusterd_friend_vers_info), glusterd_friend_vers_info);\r\n}
