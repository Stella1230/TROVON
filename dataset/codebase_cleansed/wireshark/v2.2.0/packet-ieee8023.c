void\r\ndissect_802_3(volatile int length, gboolean is_802_2, tvbuff_t *tvb,\r\nint offset_after_length, packet_info *pinfo, proto_tree *tree,\r\nproto_tree *fh_tree, int length_id, int trailer_id, expert_field* ei_len,\r\nint fcs_len)\r\n{\r\nproto_item *length_it;\r\ntvbuff_t *volatile next_tvb = NULL;\r\ntvbuff_t *trailer_tvb = NULL;\r\nconst char *saved_proto;\r\ngint captured_length, reported_length;\r\nlength_it = proto_tree_add_uint(fh_tree, length_id, tvb,\r\noffset_after_length - 2, 2, length);\r\nreported_length = tvb_reported_length_remaining(tvb, offset_after_length);\r\nif (fcs_len > 0) {\r\nif (reported_length >= fcs_len)\r\nreported_length -= fcs_len;\r\n}\r\nif (length > reported_length) {\r\nlength = reported_length;\r\nexpert_add_info(pinfo, length_it, ei_len);\r\n}\r\ncaptured_length = tvb_captured_length_remaining(tvb, offset_after_length);\r\nif (captured_length > length)\r\ncaptured_length = length;\r\nnext_tvb = tvb_new_subset(tvb, offset_after_length, captured_length, length);\r\nsaved_proto = pinfo->current_proto;\r\nTRY {\r\nif (is_802_2)\r\ncall_dissector(llc_handle, next_tvb, pinfo, tree);\r\nelse {\r\nif (tvb_get_bits8(next_tvb, 0, 3) == 7)\r\ncall_dissector(ipx_handle, next_tvb, pinfo, tree);\r\nelse\r\ncall_dissector(ccsds_handle, next_tvb, pinfo, tree);\r\n}\r\n}\r\nCATCH_NONFATAL_ERRORS {\r\nshow_exception(next_tvb, pinfo, tree, EXCEPT_CODE, GET_MESSAGE);\r\n}\r\nENDTRY;\r\npinfo->current_proto = saved_proto;\r\ntrailer_tvb = tvb_new_subset_remaining(tvb, offset_after_length + length);\r\nadd_ethernet_trailer(pinfo, tree, fh_tree, trailer_id, tvb, trailer_tvb, fcs_len);\r\n}\r\nvoid\r\nproto_reg_handoff_ieee802_3(void)\r\n{\r\nipx_handle = find_dissector("ipx");\r\nllc_handle = find_dissector("llc");\r\nccsds_handle = find_dissector("ccsds");\r\n}
