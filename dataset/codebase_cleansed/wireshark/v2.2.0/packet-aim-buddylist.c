static int dissect_aim_buddylist_buddylist(tvbuff_t *tvb, packet_info *pinfo, proto_tree *buddy_tree)\r\n{\r\nint offset = 0;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\noffset = dissect_aim_buddyname( tvb, pinfo, offset, buddy_tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_buddylist_rights_repl(tvbuff_t *tvb, packet_info *pinfo, proto_tree *buddy_tree)\r\n{\r\nreturn dissect_aim_tlv_sequence(tvb, pinfo, 0, buddy_tree, aim_buddylist_tlvs);\r\n}\r\nstatic int dissect_aim_buddylist_reject(tvbuff_t *tvb, packet_info *pinfo, proto_tree *buddy_tree)\r\n{\r\nreturn dissect_aim_buddyname(tvb, pinfo, 0, buddy_tree);\r\n}\r\nstatic int dissect_aim_buddylist_oncoming(tvbuff_t *tvb, packet_info *pinfo, proto_tree *buddy_tree)\r\n{\r\nguint8 *buddyname;\r\nint offset = 0;\r\nint buddyname_length = aim_get_buddyname( &buddyname, tvb, offset );\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Oncoming Buddy");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": %s",\r\nformat_text(buddyname, buddyname_length));\r\noffset += dissect_aim_buddyname(tvb, pinfo, offset, buddy_tree);\r\nproto_tree_add_item(buddy_tree, hf_aim_userinfo_warninglevel, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = dissect_aim_tlv_list(tvb, pinfo, offset, buddy_tree, aim_onlinebuddy_tlvs);\r\nreturn offset;\r\n}\r\nstatic int dissect_aim_buddylist_offgoing(tvbuff_t *tvb, packet_info *pinfo, proto_tree *buddy_tree)\r\n{\r\nguint8 *buddyname;\r\nint offset = 0;\r\nint buddyname_length = aim_get_buddyname( &buddyname, tvb, offset );\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Offgoing Buddy");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": %s",\r\nformat_text(buddyname, buddyname_length));\r\noffset += dissect_aim_buddyname(tvb, pinfo, offset, buddy_tree);\r\nproto_tree_add_item(buddy_tree, hf_aim_userinfo_warninglevel, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nreturn dissect_aim_tlv_list(tvb, pinfo, offset, buddy_tree, aim_onlinebuddy_tlvs);\r\n}\r\nvoid\r\nproto_register_aim_buddylist(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_aim_userinfo_warninglevel,\r\n{ "Warning Level", "aim_buddylist.userinfo.warninglevel", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL },\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_aim_buddylist,\r\n};\r\nproto_aim_buddylist = proto_register_protocol("AIM Buddylist Service", "AIM Buddylist", "aim_buddylist");\r\nproto_register_field_array(proto_aim_buddylist, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_aim_buddylist(void)\r\n{\r\naim_init_family(proto_aim_buddylist, ett_aim_buddylist, FAMILY_BUDDYLIST, aim_fnac_family_buddylist);\r\n}
