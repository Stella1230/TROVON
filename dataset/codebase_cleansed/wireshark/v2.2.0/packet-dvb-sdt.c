static int\r\ndissect_dvb_sdt(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint offset = 0, length = 0;\r\nguint descriptor_len;\r\nguint16 svc_id;\r\nproto_item *ti;\r\nproto_tree *dvb_sdt_tree;\r\nproto_tree *dvb_sdt_service_tree;\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Service Description Table (SDT)");\r\nti = proto_tree_add_item(tree, proto_dvb_sdt, tvb, offset, -1, ENC_NA);\r\ndvb_sdt_tree = proto_item_add_subtree(ti, ett_dvb_sdt);\r\noffset += packet_mpeg_sect_header(tvb, offset, dvb_sdt_tree, &length, NULL);\r\nlength -= 4;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_transport_stream_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_reserved1, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_version_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_current_next_indicator, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_last_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_original_network_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(dvb_sdt_tree, hf_dvb_sdt_reserved2, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nif (offset >= length)\r\nreturn offset;\r\nwhile (offset < length) {\r\nsvc_id = tvb_get_ntohs(tvb, offset);\r\ndvb_sdt_service_tree = proto_tree_add_subtree_format(dvb_sdt_tree, tvb, offset, 5,\r\nett_dvb_sdt_service, NULL, "Service 0x%04hx", svc_id);\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_service_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_reserved3, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_eit_schedule_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_eit_present_following_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_running_status, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_free_ca_mode, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dvb_sdt_service_tree, hf_dvb_sdt_descriptors_loop_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\ndescriptor_len = tvb_get_ntohs(tvb, offset) & DVB_SDT_DESCRIPTORS_LOOP_LENGTH_MASK;\r\noffset += 2;\r\noffset += proto_mpeg_descriptor_loop_dissect(tvb, offset, descriptor_len, dvb_sdt_service_tree);\r\n}\r\noffset += packet_mpeg_sect_crc(tvb, pinfo, dvb_sdt_tree, 0, offset);\r\nproto_item_set_len(ti, offset);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_dvb_sdt(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_dvb_sdt_transport_stream_id, {\r\n"Transport Stream ID", "dvb_sdt.tsid",\r\nFT_UINT16, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_reserved1, {\r\n"Reserved", "dvb_sdt.reserved1",\r\nFT_UINT8, BASE_HEX, NULL, DVB_SDT_RESERVED1_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_version_number, {\r\n"Version Number", "dvb_sdt.version",\r\nFT_UINT8, BASE_HEX, NULL, DVB_SDT_VERSION_NUMBER_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_current_next_indicator, {\r\n"Current/Next Indicator", "dvb_sdt.cur_next_ind",\r\nFT_UINT8, BASE_DEC, VALS(dvb_sdt_cur_next_vals), DVB_SDT_CURRENT_NEXT_INDICATOR_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_section_number, {\r\n"Section Number", "dvb_sdt.sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_last_section_number, {\r\n"Last Section Number", "dvb_sdt.last_sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_original_network_id, {\r\n"Original Network ID", "dvb_sdt.original_nid",\r\nFT_UINT16, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_reserved2, {\r\n"Reserved", "dvb_sdt.reserved2",\r\nFT_UINT8, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_service_id, {\r\n"Service ID", "dvb_sdt.svc.id",\r\nFT_UINT16, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_reserved3, {\r\n"Reserved", "dvb_sdt.svc.reserved",\r\nFT_UINT8, BASE_HEX, NULL, DVB_SDT_RESERVED3_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_eit_schedule_flag, {\r\n"EIT Schedule Flag", "dvb_sdt.svc.eit_schedule_flag",\r\nFT_UINT8, BASE_DEC, NULL, DVB_SDT_EIT_SCHEDULE_FLAG_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_eit_present_following_flag, {\r\n"EIT Present Following Flag", "dvb_sdt.svc.eit_present_following_flag",\r\nFT_UINT8, BASE_DEC, NULL, DVB_SDT_EIT_PRESENT_FOLLOWING_FLAG_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_running_status, {\r\n"Running Status", "dvb_sdt.svc.running_status",\r\nFT_UINT16, BASE_HEX, VALS(dvb_sdt_running_status_vals), DVB_SDT_RUNNING_STATUS_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_free_ca_mode, {\r\n"Free CA Mode", "dvb_sdt.svc.free_ca_mode",\r\nFT_UINT16, BASE_HEX, VALS(dvb_sdt_free_ca_mode_vals), DVB_SDT_FREE_CA_MODE_MASK, NULL, HFILL\r\n} },\r\n{ &hf_dvb_sdt_descriptors_loop_length, {\r\n"Descriptors Loop Length", "dvb_sdt.svc.descr_loop_len",\r\nFT_UINT16, BASE_HEX, NULL, DVB_SDT_DESCRIPTORS_LOOP_LENGTH_MASK, NULL, HFILL\r\n} }\r\n};\r\nstatic gint *ett[] = {\r\n&ett_dvb_sdt,\r\n&ett_dvb_sdt_service\r\n};\r\nproto_dvb_sdt = proto_register_protocol("DVB Service Description Table", "DVB SDT", "dvb_sdt");\r\nproto_register_field_array(proto_dvb_sdt, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_dvb_sdt(void)\r\n{\r\ndissector_handle_t dvb_sdt_handle;\r\ndvb_sdt_handle = create_dissector_handle(dissect_dvb_sdt, proto_dvb_sdt);\r\ndissector_add_uint("mpeg_sect.tid", DVB_SDT_TID_ACTUAL, dvb_sdt_handle);\r\ndissector_add_uint("mpeg_sect.tid", DVB_SDT_TID_OTHER, dvb_sdt_handle);\r\n}
