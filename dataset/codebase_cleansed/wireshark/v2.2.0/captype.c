static void\r\nprint_usage(FILE *output)\r\n{\r\nfprintf(output, "\n");\r\nfprintf(output, "Usage: captype <infile> ...\n");\r\n}\r\nstatic void\r\nfailure_message(const char *msg_format _U_, va_list ap _U_)\r\n{\r\nreturn;\r\n}\r\nint\r\nmain(int argc, char *argv[])\r\n{\r\nGString *comp_info_str;\r\nGString *runtime_info_str;\r\nwtap *wth;\r\nint err;\r\ngchar *err_info;\r\nint i;\r\nint opt;\r\nint overall_error_status;\r\nstatic const struct option long_options[] = {\r\n{"help", no_argument, NULL, 'h'},\r\n{"version", no_argument, NULL, 'v'},\r\n{0, 0, 0, 0 }\r\n};\r\n#ifdef HAVE_PLUGINS\r\nchar *init_progfile_dir_error;\r\n#endif\r\nsetlocale(LC_ALL, "");\r\ncomp_info_str = get_compiled_version_info(NULL, NULL);\r\nruntime_info_str = get_runtime_version_info(NULL);\r\nws_add_crash_info("Captype (Wireshark) %s\n"\r\n"\n"\r\n"%s"\r\n"\n"\r\n"%s",\r\nget_ws_vcs_version_info(), comp_info_str->str, runtime_info_str->str);\r\n#ifdef _WIN32\r\narg_list_utf_16to8(argc, argv);\r\ncreate_app_running_mutex();\r\n#endif\r\ninit_process_policies();\r\ninit_open_routines();\r\n#ifdef HAVE_PLUGINS\r\nif ((init_progfile_dir_error = init_progfile_dir(argv[0], main))) {\r\ng_warning("captype: init_progfile_dir(): %s", init_progfile_dir_error);\r\ng_free(init_progfile_dir_error);\r\n} else {\r\nwtap_register_plugin_types();\r\ninit_report_err(failure_message,NULL,NULL,NULL);\r\nscan_plugins();\r\nregister_all_wiretap_modules();\r\n}\r\n#endif\r\nwhile ((opt = getopt_long(argc, argv, "hv", long_options, NULL)) !=-1) {\r\nswitch (opt) {\r\ncase 'h':\r\nprintf("Captype (Wireshark) %s\n"\r\n"Print the file types of capture files.\n"\r\n"See https://www.wireshark.org for more information.\n",\r\nget_ws_vcs_version_info());\r\nprint_usage(stdout);\r\nexit(0);\r\nbreak;\r\ncase 'v':\r\nshow_version("Captype (Wireshark)", comp_info_str, runtime_info_str);\r\ng_string_free(comp_info_str, TRUE);\r\ng_string_free(runtime_info_str, TRUE);\r\nexit(0);\r\nbreak;\r\ncase '?':\r\nprint_usage(stderr);\r\nexit(1);\r\nbreak;\r\n}\r\n}\r\nif (argc < 2) {\r\nprint_usage(stderr);\r\nreturn 1;\r\n}\r\noverall_error_status = 0;\r\nfor (i = 1; i < argc; i++) {\r\nwth = wtap_open_offline(argv[i], WTAP_TYPE_AUTO, &err, &err_info, FALSE);\r\nif(wth) {\r\nprintf("%s: %s\n", argv[i], wtap_file_type_subtype_short_string(wtap_file_type_subtype(wth)));\r\nwtap_close(wth);\r\n} else {\r\nif (err == WTAP_ERR_FILE_UNKNOWN_FORMAT)\r\nprintf("%s: unknown\n", argv[i]);\r\nelse {\r\nfprintf(stderr, "captype: Can't open %s: %s\n", argv[i],\r\nwtap_strerror(err));\r\nif (err_info != NULL) {\r\nfprintf(stderr, "(%s)\n", err_info);\r\ng_free(err_info);\r\n}\r\noverall_error_status = 1;\r\n}\r\n}\r\n}\r\nreturn overall_error_status;\r\n}
