static guint16\r\ncorosync_totemsrp_get_guint16(tvbuff_t* tvb, gint offset, const guint encoding)\r\n{\r\nif (encoding == ENC_LITTLE_ENDIAN)\r\nreturn tvb_get_letohs(tvb, offset);\r\nreturn tvb_get_ntohs(tvb, offset);\r\n}\r\nstatic guint32\r\ncorosync_totemsrp_get_guint32(tvbuff_t* tvb, gint offset, const guint encoding)\r\n{\r\nif (encoding == ENC_LITTLE_ENDIAN)\r\nreturn tvb_get_letohl(tvb, offset);\r\nreturn tvb_get_ntohl(tvb, offset);\r\n}\r\nstatic guint64\r\ncorosync_totemsrp_get_guint64(tvbuff_t* tvb, gint offset, const guint encoding)\r\n{\r\nif (encoding == ENC_LITTLE_ENDIAN)\r\nreturn tvb_get_letoh64(tvb, offset);\r\nreturn tvb_get_ntoh64(tvb, offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_ip_address(tvbuff_t *tvb,\r\npacket_info *pinfo _U_,\r\nproto_tree *parent_tree,\r\nguint length _U_, int offset,\r\nconst guint encoding,\r\ngboolean print_interface,\r\nguint interface,\r\nguint *nodeid)\r\n{\r\nguint16 family;\r\nguint nid;\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\ngint len;\r\nnid = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\nif (nodeid)\r\n*nodeid = nid;\r\nfamily = corosync_totemsrp_get_guint16(tvb, offset + 4, encoding);\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_ip_address, tvb, offset,\r\n-1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_ip_address);\r\nproto_item_append_text(item, " (");\r\nif (print_interface)\r\nproto_item_append_text(item, "interface: %u; ", interface);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_ip_address_nodeid,\r\ntvb, offset, 4, encoding);\r\nproto_item_append_text(item, "node: %u)", nid);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_ip_address_family,\r\ntvb, offset, 2, encoding);\r\noffset += 2;\r\nswitch (family)\r\n{\r\ncase COMMON_AF_INET:\r\nlen = 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_ip_address_addr4, tvb, offset, len, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase BSD_AF_INET6_BSD:\r\ncase BSD_AF_INET6_FREEBSD:\r\ncase BSD_AF_INET6_DARWIN:\r\ncase LINUX_AF_INET6:\r\ncase SOLARIS_AF_INET6:\r\ncase WINSOCK_AF_INET6:\r\nlen = sizeof(struct e_in6_addr);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_ip_address_addr6, tvb, offset, len, ENC_NA);\r\nbreak;\r\ndefault:\r\nlen = sizeof(struct e_in6_addr);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_ip_address_addr, tvb, offset, len, ENC_NA);\r\nbreak;\r\n}\r\noffset += len;\r\nif (len != sizeof(struct e_in6_addr)) {\r\ngint padding_len;\r\npadding_len = (gint)(sizeof(struct e_in6_addr) - len);\r\nproto_tree_add_item (tree, hf_corosync_totemsrp_ip_address_addr4_padding,\r\ntvb, offset, padding_len, ENC_NA);\r\noffset += padding_len;\r\n}\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn offset - original_offset;\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_memb_ring_id(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding,\r\nguint *node_id,\r\nguint64 *ring_id)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint64 rid;\r\nguint nid;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_memb_ring_id, tvb, offset,\r\n-1, encoding);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_memb_ring_id);\r\noffset += dissect_corosync_totemsrp_ip_address(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\nFALSE, -1,\r\n&nid);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_ring_id_seq,\r\ntvb, offset, 8, encoding);\r\nrid = corosync_totemsrp_get_guint64(tvb, offset, encoding);\r\noffset += 8;\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u)", rid);\r\nif (node_id)\r\n*node_id = nid;\r\nif (ring_id)\r\n*ring_id = rid;\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn offset - original_offset;\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_rtr_list(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint node_id;\r\nguint64 ring_id;\r\nguint32 seq;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_rtr_item, tvb, offset,\r\n-1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_rtr_item);\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_rtr_item_seq,\r\ntvb, offset, 4, encoding);\r\nseq = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u seq: %u)",\r\nring_id, node_id, seq);\r\noffset += 4;\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_orf_token(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nguint32 rtr_list_entries = 0, seq, aru, i;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint node_id;\r\nguint64 ring_id;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_orf_token,\r\ntvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_orf_token);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_seq,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_token_seq,\r\ntvb, offset, 4, encoding);\r\nseq = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_aru,\r\ntvb, offset, 4, encoding);\r\naru = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_aru_addr,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_backlog,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_fcc,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_retrnas_flg,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_orf_token_rtr_list_entries,\r\ntvb, offset, 4, encoding);\r\nrtr_list_entries = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nfor (i = 0; i < rtr_list_entries; i++) {\r\noffset += dissect_corosync_totemsrp_rtr_list(tvb, pinfo,\r\ntree,\r\nlength, offset,\r\nencoding);\r\n}\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u nrtr: %d seq: %d au: %u)",\r\nring_id, node_id, rtr_list_entries, seq, aru);\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn offset - original_offset;\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_srp_addr(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nint hf,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint nodeid;\r\nitem = proto_tree_add_item(parent_tree, hf? hf: hf_corosync_totemsrp_srp_addr, tvb, offset,\r\n-1, encoding);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_srp_addr);\r\noffset += dissect_corosync_totemsrp_ip_address(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\nTRUE, 0,\r\n&nodeid);\r\nproto_item_append_text(item, " (node: %u)", nodeid);\r\noffset += dissect_corosync_totemsrp_ip_address(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\nTRUE, 1,\r\nNULL);\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_mcast(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree,\r\nguint length, int offset,\r\nguint8 message_header__encapsulated,\r\nconst guint encoding, proto_tree *parent_tree,\r\nstruct corosync_totemsrp_info *totemsrp_info)\r\n{\r\nint original_offset = offset;\r\nproto_tree *mcast_tree;\r\nproto_item *item;\r\nguint node_id;\r\nguint64 ring_id;\r\ntvbuff_t *next_tvb;\r\nheur_dtbl_entry_t *hdtbl_entry = NULL;\r\nitem = proto_tree_add_item(tree, hf_corosync_totemsrp_mcast, tvb, offset,\r\n-1, encoding);\r\nmcast_tree = proto_item_add_subtree(item, ett_corosync_totemsrp_mcast);\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, mcast_tree,\r\nlength, offset,\r\nhf_corosync_totemsrp_mcast_system_from,\r\nencoding);\r\nproto_tree_add_item(mcast_tree, hf_corosync_totemsrp_mcast_seq,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(mcast_tree, hf_corosync_totemsrp_mcast_this_seqno,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, mcast_tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u)",\r\nring_id, node_id);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_mcast_node_id,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_mcast_guarantee,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\nif (message_header__encapsulated == COROSYNC_TOTEMSRP_MESSAGE_ENCAPSULATED)\r\n{\r\noffset += dissect_corosync_totemsrp0(next_tvb, pinfo, tree, TRUE);\r\n}\r\nelse\r\n{\r\nif (dissector_try_heuristic(heur_subdissector_list,\r\nnext_tvb,\r\npinfo,\r\nparent_tree,\r\n&hdtbl_entry,\r\ntotemsrp_info))\r\noffset = length;\r\n}\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_memb_merge_detect(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint node_id;\r\nguint64 ring_id;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_memb_merge_detect, tvb, offset,\r\n-1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_memb_merge_detect);\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, tree,\r\nlength, offset,\r\n0,\r\nencoding);\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u)",\r\nring_id, node_id);\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_memb_join(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint32 proc_list_entries;\r\nproto_tree *proc_tree;\r\nguint32 failed_list_entries;\r\nproto_tree *failed_tree;\r\nproto_item *failed_item;\r\nguint i;\r\nproto_item *proc_item;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_memb_join, tvb, offset,\r\n-1, encoding);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_memb_join);\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, tree,\r\nlength, offset,\r\n0,\r\nencoding);\r\nproc_item = proto_tree_add_item(tree, hf_corosync_totemsrp_memb_join_proc_list_entries,\r\ntvb, offset, 4, encoding);\r\nproc_list_entries = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nfailed_item = proto_tree_add_item(tree, hf_corosync_totemsrp_memb_join_failed_list_entries,\r\ntvb, offset, 4, encoding);\r\nfailed_list_entries = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_join_ring_seq,\r\ntvb, offset, 8, encoding);\r\noffset += 8;\r\nproc_tree = proto_item_add_subtree(proc_item, ett_corosync_totemsrp_memb_join_proc_list);\r\nproto_item_append_text(item, " (nprocs: %u nfailed: %u)",\r\nproc_list_entries, failed_list_entries);\r\nfor (i = 0; i < proc_list_entries; i++) {\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, proc_tree,\r\nlength, offset,\r\n0,\r\nencoding);\r\n}\r\nfailed_tree = proto_item_add_subtree(failed_item,\r\nett_corosync_totemsrp_memb_join_failed_list);\r\nfor (i = 0; i < failed_list_entries; i++) {\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, failed_tree,\r\nlength, offset,\r\n0,\r\nencoding);\r\n}\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_memb_commit_token_memb_entry(tvbuff_t *tvb,\r\npacket_info *pinfo,\r\nproto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding,\r\nguint *node_id,\r\nguint64 *ring_id)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_memb_commit_token_memb_entry,\r\ntvb, offset, -1, encoding);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_memb_commit_token_memb_entry);\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\nnode_id,\r\nring_id);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_memb_entry_aru,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_memb_entry_high_delivered,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_memb_entry_received_flg,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_memb_commit_token(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint32 i, addr_entries;\r\nguint32 seq;\r\nguint node_id;\r\nguint64 ring_id;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_memb_commit_token,\r\ntvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_memb_commit_token);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_token_seq,\r\ntvb, offset, 4, encoding);\r\nseq = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_retrans_flg,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_memb_index,\r\ntvb, offset, 4, encoding);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_corosync_totemsrp_memb_commit_token_addr_entries,\r\ntvb, offset, 4, encoding);\r\naddr_entries = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nfor (i = 0; i < addr_entries; i++) {\r\noffset += dissect_corosync_totemsrp_srp_addr(tvb, pinfo, tree,\r\nlength, offset,\r\n0,\r\nencoding);\r\n}\r\nfor (i = 0; i < addr_entries; i++) {\r\noffset += dissect_corosync_totemsrp_memb_commit_token_memb_entry(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\nNULL,\r\nNULL);\r\n}\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u seq: %u entries: %u)",\r\nring_id, node_id, seq, addr_entries);\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp_token_hold_cancel(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\nguint length, int offset,\r\nconst guint encoding)\r\n{\r\nint original_offset = offset;\r\nproto_tree *tree;\r\nproto_item *item;\r\nguint node_id;\r\nguint64 ring_id;\r\nitem = proto_tree_add_item(parent_tree, hf_corosync_totemsrp_token_hold_cancel, tvb, offset,\r\n-1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_corosync_totemsrp_token_hold_cancel);\r\noffset += dissect_corosync_totemsrp_memb_ring_id(tvb, pinfo, tree,\r\nlength, offset,\r\nencoding,\r\n&node_id,\r\n&ring_id);\r\nproto_item_append_text(item, " (ring: %" G_GINT64_MODIFIER "u node: %u)",\r\nring_id, node_id);\r\nproto_item_set_len(item, offset - original_offset);\r\nreturn (offset - original_offset);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nreturn dissect_corosync_totemsrp0(tvb, pinfo, parent_tree, FALSE);\r\n}\r\nstatic int\r\ndissect_corosync_totemsrp0(tvbuff_t *tvb,\r\npacket_info *pinfo, proto_tree *tree,\r\ngboolean encapsulated)\r\n{\r\nproto_item *item;\r\nguint length;\r\nint offset = 0;\r\nguint16 endian_test;\r\nproto_tree *corosync_tree;\r\nguint8 message_header__type;\r\nguint8 message_header__encapsulated;\r\nguint encoding;\r\nstruct corosync_totemsrp_info info;\r\nlength = tvb_reported_length(tvb);\r\nif (length < 1 + 1 + 2 + 4)\r\nreturn 0;\r\nmessage_header__type = tvb_get_guint8(tvb, 0);\r\nif (message_header__type > 5)\r\nreturn 0;\r\nmessage_header__encapsulated = tvb_get_guint8(tvb, 1);\r\nendian_test = tvb_get_ntohs(tvb, 2);\r\nif (endian_test == COROSYNC_TOTEMSRP_TEST_LITTLE_ENDIAN)\r\nencoding = ENC_LITTLE_ENDIAN;\r\nelse if (endian_test == COROSYNC_TOTEMSRP_TEST_BIG_ENDIAN)\r\nencoding = ENC_BIG_ENDIAN;\r\nelse\r\nreturn 0;\r\nif (encapsulated == FALSE)\r\n{\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "COROSYNC/TOTEMSRP");\r\ncol_set_str(pinfo->cinfo, COL_INFO,\r\n((message_header__type == COROSYNC_TOTEMSRP_MESSAGE_TYPE_MCAST)\r\n&& (message_header__encapsulated == COROSYNC_TOTEMSRP_MESSAGE_ENCAPSULATED))?\r\n"ENCAPSULATED":\r\nval_to_str_const(message_header__type,\r\ncorosync_totemsrp_message_header_type,\r\n"Unknown"));\r\n}\r\nitem = proto_tree_add_item(tree, proto_corosync_totemsrp, tvb, offset, -1, ENC_NA);\r\ncorosync_tree = proto_item_add_subtree(item, ett_corosync_totemsrp);\r\nproto_tree_add_item(corosync_tree, hf_corosync_totemsrp_message_header_type,\r\ntvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(corosync_tree, hf_corosync_totemsrp_message_header_encapsulated,\r\ntvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(corosync_tree, hf_corosync_totemsrp_message_header_endian_detector,\r\ntvb, offset, 2, encoding);\r\noffset += 2;\r\nproto_tree_add_item(corosync_tree,\r\nhf_corosync_totemsrp_message_header_nodeid,\r\ntvb, offset, 4, encoding);\r\ninfo.encoding = encoding;\r\ninfo.nodeid = corosync_totemsrp_get_guint32(tvb, offset, encoding);\r\noffset += 4;\r\nswitch (message_header__type) {\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_ORF_TOKEN:\r\ndissect_corosync_totemsrp_orf_token(tvb, pinfo, corosync_tree, length, offset, encoding);\r\nbreak;\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_MCAST:\r\ndissect_corosync_totemsrp_mcast(tvb, pinfo, corosync_tree, length, offset,\r\nmessage_header__encapsulated,\r\nencoding, tree, &info);\r\nbreak;\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_MEMB_MERGE_DETECT:\r\ndissect_corosync_totemsrp_memb_merge_detect(tvb, pinfo, corosync_tree, length, offset,\r\nencoding);\r\nbreak;\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_MEMB_JOIN:\r\ndissect_corosync_totemsrp_memb_join(tvb, pinfo, corosync_tree, length, offset,\r\nencoding);\r\nbreak;\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_MEMB_COMMIT_TOKEN:\r\ndissect_corosync_totemsrp_memb_commit_token(tvb, pinfo, corosync_tree, length, offset,\r\nencoding);\r\nbreak;\r\ncase COROSYNC_TOTEMSRP_MESSAGE_TYPE_TOKEN_HOLD_CANCEL:\r\ndissect_corosync_totemsrp_token_hold_cancel(tvb, pinfo, corosync_tree, length, offset,\r\nencoding);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn length;\r\n}\r\nvoid\r\nproto_register_corosync_totemsrp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_corosync_totemsrp_message_header_type,\r\n{ "Type", "corosync_totemsrp.message_header.type",\r\nFT_INT8, BASE_DEC, VALS(corosync_totemsrp_message_header_type), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_message_header_encapsulated,\r\n{ "Encapsulated", "corosync_totemsrp.message_header.encapsulated",\r\nFT_INT8, BASE_DEC, VALS(corosync_totemsrp_message_header_encapsulated), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_message_header_endian_detector,\r\n{ "Endian detector", "corosync_totemsrp.message_header.endian_detector",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_message_header_nodeid,\r\n{ "Node ID", "corosync_totemsrp.message_header.nodeid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token,\r\n{ "Ordering, Reliability, Flow (ORF) control Token", "corosync_totemsrp.orf_token",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_seq,\r\n{ "Sequence number allowing recognition of redundant copies of the token", "corosync_totemsrp.orf_token.seq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_token_seq,\r\n{ "The largest sequence number", "corosync_totemsrp.orf_token.seq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"The largest sequence number of any message "\r\n"that has been broadcast on the ring"\r\n"[1]" ,\r\nHFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_aru,\r\n{ "Sequence number all received up to", "corosync_totemsrp.orf_token.aru",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_aru_addr,\r\n{ "ID of node setting ARU", "corosync_totemsrp.orf_token.aru_addr",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_backlog,\r\n{ "Backlog", "corosync_totemsrp.orf_token.backlog",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"The sum of the number of new message waiting to be transmitted by each processor on the ring "\r\n"at the time at which that processor forwarded the token during the previous rotation"\r\n"[1]",\r\nHFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_fcc,\r\n{ "FCC",\r\n"corosync_totemsrp.orf_token.fcc",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"A count of the number of messages broadcast by all processors "\r\n"during the previous rotation of the token"\r\n"[1]",\r\nHFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_retrnas_flg,\r\n{ "Retransmission flag", "corosync_totemsrp.orf_token.retrans_flg",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_orf_token_rtr_list_entries,\r\n{ "The number of retransmission list entries", "corosync_totemsrp.orf_token.rtr_list_entries",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_memb_ring_id,\r\n{ "Member ring id", "corosync_totemsrp.memb_ring_id",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_memb_ring_id_seq,\r\n{ "Sequence in member ring id", "corosync_totemsrp.memb_ring_id.seq",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address,\r\n{ "Node IP address", "corosync_totemsrp.ip_address",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_nodeid,\r\n{ "Node ID", "corosync_totemsrp.ip_address.nodeid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_family,\r\n{ "Address family", "corosync_totemsrp.ip_address.family",\r\nFT_UINT16, BASE_DEC, VALS(corosync_totemsrp_ip_address_family), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_addr,\r\n{ "Address", "corosync_totemsrp.ip_address.addr",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_addr4,\r\n{ "Address", "corosync_totemsrp.ip_address.addr4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_addr4_padding,\r\n{ "Address padding", "corosync_totemsrp.ip_address.addr4_padding",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_ip_address_addr6,\r\n{ "Address", "corosync_totemsrp.ip_address.addr6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast,\r\n{ "ring ordered multicast message", "corosync_totemsrp.mcast",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast_seq,\r\n{"Multicast sequence number", "corosync_totemsrp.mcast.seq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast_this_seqno,\r\n{"This Sequence number", "corosync_totemsrp.mcast.this_seqno",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast_node_id,\r\n{"Node id(unused?)", "corosync_totemsrp.mcast.node_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast_system_from,\r\n{"System from address", "corosync_totemsrp.mcast.system_from",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_mcast_guarantee,\r\n{"Guarantee", "corosync_totemsrp.mcast.guarantee",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_memb_merge_detect,\r\n{ "Merge rings if there are available rings", "corosync_totemsrp.memb_merge_detect",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_srp_addr,\r\n{"Single Ring Protocol Address", "corosync_totemsrp.srp_addr",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_rtr_item,\r\n{"Retransmission Item", "corosync_totemsrp.rtr_item",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_rtr_item_seq,\r\n{"Sequence of Retransmission Item", "corosync_totemsrp.rtr_item.seq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_corosync_totemsrp_memb_join,\r\n{"Membership join message", "corosync_totemsrp.memb_join",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_join_proc_list_entries,\r\n{"The number of processor list entries", "corosync_totemsrp.memb_join.proc_list_entries",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_join_failed_list_entries,\r\n{"The number of failed list entries", "corosync_totemsrp.memb_join.failed_list_entries",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_join_ring_seq,\r\n{"Ring sequence number", "corosync_totemsrp.memb_join.ring_seq",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token,\r\n{"Membership commit token", "corosync_totemsrp.memb_commit_token",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_token_seq,\r\n{"Token sequence", "corosync_totemsrp.memb_commit_token.token_seq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_retrans_flg,\r\n{"Retransmission flag", "corosync_totemsrp.memb_commit_token.retrans_flg",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_memb_index,\r\n{"Member index", "corosync_totemsrp.memb_commit_token.memb_index",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_addr_entries,\r\n{"The number of address entries", "corosync_totemsrp.memb_commit_token.addr_entries",\r\nFT_INT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_memb_entry,\r\n{ "Membership entry", "corosync_totemsrp.memb_commit_token_memb_entry",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_memb_entry_aru,\r\n{"Sequence number all received up to", "corosync_totemsrp.memb_commit_token_memb_entry.aru",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_memb_entry_high_delivered,\r\n{"High delivered", "corosync_totemsrp.memb_commit_token_memb_entry.high_delivered",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_memb_commit_token_memb_entry_received_flg,\r\n{"Received flag", "corosync_totemsrp.memb_commit_token_memb_entry.received_flg",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_corosync_totemsrp_token_hold_cancel,\r\n{"Hold cancel token", "corosync_totemsrp.token_hold_cancel",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_corosync_totemsrp,\r\n&ett_corosync_totemsrp_orf_token,\r\n&ett_corosync_totemsrp_memb_ring_id,\r\n&ett_corosync_totemsrp_ip_address,\r\n&ett_corosync_totemsrp_mcast,\r\n&ett_corosync_totemsrp_memb_merge_detect,\r\n&ett_corosync_totemsrp_srp_addr,\r\n&ett_corosync_totemsrp_rtr_item,\r\n&ett_corosync_totemsrp_memb_join,\r\n&ett_corosync_totemsrp_memb_commit_token,\r\n&ett_corosync_totemsrp_memb_commit_token_memb_entry,\r\n&ett_corosync_totemsrp_token_hold_cancel,\r\n&ett_corosync_totemsrp_memb_join_proc_list,\r\n&ett_corosync_totemsrp_memb_join_failed_list\r\n};\r\nproto_corosync_totemsrp = proto_register_protocol("Totem Single Ring Protocol implemented in Corosync Cluster Engine",\r\n"COROSYNC/TOTEMSRP", "corosync_totemsrp");\r\nproto_register_field_array(proto_corosync_totemsrp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nheur_subdissector_list = register_heur_dissector_list("corosync_totemsrp.mcast", proto_corosync_totemsrp);\r\nregister_dissector( "corosync_totemsrp", dissect_corosync_totemsrp, proto_corosync_totemsrp);\r\n}\r\nvoid\r\nproto_reg_handoff_corosync_totemsrp(void)\r\n{\r\n}
