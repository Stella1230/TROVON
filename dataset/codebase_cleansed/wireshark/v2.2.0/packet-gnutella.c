static void dissect_gnutella_pong(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\nproto_tree_add_item(tree,\r\nhf_gnutella_pong_port,\r\ntvb,\r\noffset + GNUTELLA_PONG_PORT_OFFSET,\r\nGNUTELLA_PORT_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_pong_ip,\r\ntvb,\r\noffset + GNUTELLA_PONG_IP_OFFSET,\r\nGNUTELLA_IP_LENGTH,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_pong_files,\r\ntvb,\r\noffset + GNUTELLA_PONG_FILES_OFFSET,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_pong_kbytes,\r\ntvb,\r\noffset + GNUTELLA_PONG_KBYTES_OFFSET,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\n}\r\nstatic void dissect_gnutella_query(tvbuff_t *tvb, guint offset, proto_tree *tree, guint size) {\r\nproto_tree_add_item(tree,\r\nhf_gnutella_query_min_speed,\r\ntvb,\r\noffset + GNUTELLA_QUERY_SPEED_OFFSET,\r\nGNUTELLA_SHORT_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nif (size > GNUTELLA_SHORT_LENGTH) {\r\nproto_tree_add_item(tree,\r\nhf_gnutella_query_search,\r\ntvb,\r\noffset + GNUTELLA_QUERY_SEARCH_OFFSET,\r\nsize - GNUTELLA_SHORT_LENGTH,\r\nENC_ASCII|ENC_NA);\r\n}\r\nelse {\r\nproto_tree_add_string_format(tree,\r\nhf_gnutella_query_search, tvb,\r\noffset + GNUTELLA_QUERY_SEARCH_OFFSET,\r\n0, "", "Missing data for Query Search.");\r\n}\r\n}\r\nstatic void dissect_gnutella_queryhit(tvbuff_t *tvb, guint offset, proto_tree *tree, guint size) {\r\nproto_tree *qhi, *hit_tree;\r\nint hit_count, i;\r\nint hit_offset;\r\nint name_length, extra_length;\r\nint idx_at_offset, size_at_offset;\r\nint servent_id_at_offset;\r\nint name_at_offset, extra_at_offset;\r\nint cur_char, remaining, used;\r\nhit_count = tvb_get_guint8(tvb, offset + GNUTELLA_QUERYHIT_COUNT_OFFSET);\r\nproto_tree_add_uint(tree,\r\nhf_gnutella_queryhit_count,\r\ntvb,\r\noffset + GNUTELLA_QUERYHIT_COUNT_OFFSET,\r\nGNUTELLA_BYTE_LENGTH,\r\nhit_count);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_queryhit_port,\r\ntvb,\r\noffset + GNUTELLA_QUERYHIT_PORT_OFFSET,\r\nGNUTELLA_PORT_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_queryhit_ip,\r\ntvb,\r\noffset + GNUTELLA_QUERYHIT_IP_OFFSET,\r\nGNUTELLA_IP_LENGTH,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_queryhit_speed,\r\ntvb,\r\noffset + GNUTELLA_QUERYHIT_SPEED_OFFSET,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nhit_offset = offset + GNUTELLA_QUERYHIT_FIRST_HIT_OFFSET;\r\nfor(i = 0; i < hit_count; i++) {\r\nidx_at_offset = hit_offset;\r\nsize_at_offset = hit_offset + GNUTELLA_QUERYHIT_HIT_SIZE_OFFSET;\r\nhit_offset += (GNUTELLA_LONG_LENGTH * 2);\r\nname_length = 0;\r\nextra_length = 0;\r\nname_at_offset = hit_offset;\r\nwhile(hit_offset - offset < size) {\r\ncur_char = tvb_get_guint8(tvb, hit_offset);\r\nif(cur_char == '\0')\r\nbreak;\r\nhit_offset++;\r\nname_length++;\r\n}\r\nhit_offset++;\r\nextra_at_offset = hit_offset;\r\nwhile(hit_offset - offset < size) {\r\ncur_char = tvb_get_guint8(tvb, hit_offset);\r\nif(cur_char == '\0')\r\nbreak;\r\nhit_offset++;\r\nextra_length++;\r\n}\r\nhit_offset++;\r\nqhi = proto_tree_add_item(tree,\r\nhf_gnutella_queryhit_hit,\r\ntvb,\r\nidx_at_offset,\r\n(GNUTELLA_LONG_LENGTH * 2) +\r\nname_length + extra_length +\r\nGNUTELLA_QUERYHIT_END_OF_STRING_LENGTH,\r\nENC_NA);\r\nhit_tree = proto_item_add_subtree(qhi, ett_gnutella);\r\nproto_tree_add_item(hit_tree,\r\nhf_gnutella_queryhit_hit_index,\r\ntvb,\r\nidx_at_offset,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(hit_tree,\r\nhf_gnutella_queryhit_hit_size,\r\ntvb,\r\nsize_at_offset,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(hit_tree,\r\nhf_gnutella_queryhit_hit_name,\r\ntvb,\r\nname_at_offset,\r\nname_length,\r\nENC_ASCII|ENC_NA);\r\nif(extra_length) {\r\nproto_tree_add_item(hit_tree,\r\nhf_gnutella_queryhit_hit_extra,\r\ntvb,\r\nextra_at_offset,\r\nextra_length,\r\nENC_NA);\r\n}\r\n}\r\nused = hit_offset - offset;\r\nremaining = size - used;\r\nif(remaining > GNUTELLA_SERVENT_ID_LENGTH) {\r\nservent_id_at_offset = hit_offset + remaining - GNUTELLA_SERVENT_ID_LENGTH;\r\nproto_tree_add_item(tree,\r\nhf_gnutella_queryhit_extra,\r\ntvb,\r\nhit_offset,\r\nservent_id_at_offset - hit_offset,\r\nENC_NA);\r\n}\r\nelse {\r\nservent_id_at_offset = hit_offset;\r\n}\r\nproto_tree_add_item(tree,\r\nhf_gnutella_queryhit_servent_id,\r\ntvb,\r\nservent_id_at_offset,\r\nGNUTELLA_SERVENT_ID_LENGTH,\r\nENC_NA);\r\n}\r\nstatic void dissect_gnutella_push(tvbuff_t *tvb, guint offset, proto_tree *tree) {\r\nproto_tree_add_item(tree,\r\nhf_gnutella_push_servent_id,\r\ntvb,\r\noffset + GNUTELLA_PUSH_SERVENT_ID_OFFSET,\r\nGNUTELLA_SERVENT_ID_LENGTH,\r\nENC_NA);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_push_index,\r\ntvb,\r\noffset + GNUTELLA_PUSH_INDEX_OFFSET,\r\nGNUTELLA_LONG_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_push_ip,\r\ntvb,\r\noffset + GNUTELLA_PUSH_IP_OFFSET,\r\nGNUTELLA_IP_LENGTH,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree,\r\nhf_gnutella_push_port,\r\ntvb,\r\noffset + GNUTELLA_PUSH_PORT_OFFSET,\r\nGNUTELLA_PORT_LENGTH,\r\nENC_LITTLE_ENDIAN);\r\n}\r\nstatic guint\r\nget_gnutella_pdu_len(packet_info *pinfo _U_, tvbuff_t *tvb,\r\nint offset, void *data _U_)\r\n{\r\nguint32 size;\r\nsize = tvb_get_letohl(\r\ntvb,\r\noffset + GNUTELLA_HEADER_SIZE_OFFSET);\r\nif (size > GNUTELLA_MAX_SNAP_SIZE) {\r\nsize = GNUTELLA_MAX_SNAP_SIZE;\r\n}\r\nreturn GNUTELLA_HEADER_LENGTH + size;\r\n}\r\nstatic int dissect_gnutella_pdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\nproto_item *ti, *hi, *pi;\r\nproto_tree *gnutella_tree = NULL;\r\nproto_tree *gnutella_header_tree, *gnutella_pong_tree;\r\nproto_tree *gnutella_queryhit_tree, *gnutella_push_tree;\r\nproto_tree *gnutella_query_tree;\r\nguint8 payload_descriptor;\r\nguint32 size = 0;\r\nconst char *payload_descriptor_text;\r\nif (tree) {\r\nti = proto_tree_add_item(tree,\r\nproto_gnutella,\r\ntvb,\r\n0,\r\n-1,\r\nENC_NA);\r\ngnutella_tree = proto_item_add_subtree(ti, ett_gnutella);\r\nsize = tvb_get_letohl(\r\ntvb,\r\nGNUTELLA_HEADER_SIZE_OFFSET);\r\n}\r\npayload_descriptor = tvb_get_guint8(\r\ntvb,\r\nGNUTELLA_HEADER_PAYLOAD_OFFSET);\r\nswitch(payload_descriptor) {\r\ncase GNUTELLA_PING:\r\npayload_descriptor_text = GNUTELLA_PING_NAME;\r\nbreak;\r\ncase GNUTELLA_PONG:\r\npayload_descriptor_text = GNUTELLA_PONG_NAME;\r\nbreak;\r\ncase GNUTELLA_PUSH:\r\npayload_descriptor_text = GNUTELLA_PUSH_NAME;\r\nbreak;\r\ncase GNUTELLA_QUERY:\r\npayload_descriptor_text = GNUTELLA_QUERY_NAME;\r\nbreak;\r\ncase GNUTELLA_QUERYHIT:\r\npayload_descriptor_text = GNUTELLA_QUERYHIT_NAME;\r\nbreak;\r\ndefault:\r\npayload_descriptor_text = GNUTELLA_UNKNOWN_NAME;\r\nbreak;\r\n}\r\ncol_append_sep_fstr(pinfo->cinfo, COL_INFO, NULL, "%s",\r\npayload_descriptor_text);\r\nif (tree) {\r\nhi = proto_tree_add_item(gnutella_tree,\r\nhf_gnutella_header,\r\ntvb,\r\n0,\r\nGNUTELLA_HEADER_LENGTH,\r\nENC_NA);\r\ngnutella_header_tree = proto_item_add_subtree(hi, ett_gnutella);\r\nproto_tree_add_item(gnutella_header_tree,\r\nhf_gnutella_header_id,\r\ntvb,\r\nGNUTELLA_HEADER_ID_OFFSET,\r\nGNUTELLA_SERVENT_ID_LENGTH,\r\nENC_NA);\r\nproto_tree_add_uint_format_value(gnutella_header_tree,\r\nhf_gnutella_header_payload,\r\ntvb,\r\nGNUTELLA_HEADER_PAYLOAD_OFFSET,\r\nGNUTELLA_BYTE_LENGTH,\r\npayload_descriptor,\r\n"%i (%s)",\r\npayload_descriptor,\r\npayload_descriptor_text);\r\nproto_tree_add_item(gnutella_header_tree,\r\nhf_gnutella_header_ttl,\r\ntvb,\r\nGNUTELLA_HEADER_TTL_OFFSET,\r\nGNUTELLA_BYTE_LENGTH,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_item(gnutella_header_tree,\r\nhf_gnutella_header_hops,\r\ntvb,\r\nGNUTELLA_HEADER_HOPS_OFFSET,\r\nGNUTELLA_BYTE_LENGTH,\r\nENC_BIG_ENDIAN);\r\nproto_tree_add_uint(gnutella_header_tree,\r\nhf_gnutella_header_size,\r\ntvb,\r\nGNUTELLA_HEADER_SIZE_OFFSET,\r\nGNUTELLA_LONG_LENGTH,\r\nsize);\r\nif (size > 0) {\r\nswitch(payload_descriptor) {\r\ncase GNUTELLA_PONG:\r\npi = proto_tree_add_item(\r\ngnutella_header_tree,\r\nhf_gnutella_pong_payload,\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\nsize,\r\nENC_NA);\r\ngnutella_pong_tree = proto_item_add_subtree(\r\npi,\r\nett_gnutella);\r\ndissect_gnutella_pong(\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\ngnutella_pong_tree);\r\nbreak;\r\ncase GNUTELLA_PUSH:\r\npi = proto_tree_add_item(\r\ngnutella_header_tree,\r\nhf_gnutella_push_payload,\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\nsize,\r\nENC_NA);\r\ngnutella_push_tree = proto_item_add_subtree(\r\npi,\r\nett_gnutella);\r\ndissect_gnutella_push(\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\ngnutella_push_tree);\r\nbreak;\r\ncase GNUTELLA_QUERY:\r\npi = proto_tree_add_item(\r\ngnutella_header_tree,\r\nhf_gnutella_query_payload,\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\nsize,\r\nENC_NA);\r\ngnutella_query_tree = proto_item_add_subtree(\r\npi,\r\nett_gnutella);\r\ndissect_gnutella_query(\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\ngnutella_query_tree,\r\nsize);\r\nbreak;\r\ncase GNUTELLA_QUERYHIT:\r\npi = proto_tree_add_item(\r\ngnutella_header_tree,\r\nhf_gnutella_queryhit_payload,\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\nsize,\r\nENC_NA);\r\ngnutella_queryhit_tree = proto_item_add_subtree(\r\npi,\r\nett_gnutella);\r\ndissect_gnutella_queryhit(\r\ntvb,\r\nGNUTELLA_HEADER_LENGTH,\r\ngnutella_queryhit_tree,\r\nsize);\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int dissect_gnutella(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data) {\r\nproto_item *ti;\r\nproto_tree *gnutella_tree = NULL;\r\nguint32 size;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "Gnutella");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tvb_bytes_exist(tvb, GNUTELLA_HEADER_SIZE_OFFSET, 4)) {\r\nsize = tvb_get_letohl(\r\ntvb,\r\nGNUTELLA_HEADER_SIZE_OFFSET);\r\nif (size > GNUTELLA_MAX_SNAP_SIZE) {\r\nif (tree) {\r\nti = proto_tree_add_item(tree,\r\nproto_gnutella,\r\ntvb,\r\n0,\r\n-1,\r\nENC_NA);\r\ngnutella_tree = proto_item_add_subtree(ti,\r\nett_gnutella);\r\nproto_tree_add_item(gnutella_tree,\r\nhf_gnutella_stream,\r\ntvb,\r\n0,\r\n-1,\r\nENC_NA);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\n}\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, GNUTELLA_HEADER_SIZE_OFFSET+4,\r\nget_gnutella_pdu_len, dissect_gnutella_pdu, data);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid proto_register_gnutella(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_gnutella_header,\r\n{ "Descriptor Header", "gnutella.header",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella Descriptor Header", HFILL }\r\n},\r\n{ &hf_gnutella_pong_payload,\r\n{ "Pong", "gnutella.pong.payload",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella Pong Payload", HFILL }\r\n},\r\n{ &hf_gnutella_push_payload,\r\n{ "Push", "gnutella.push.payload",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella Push Payload", HFILL }\r\n},\r\n{ &hf_gnutella_query_payload,\r\n{ "Query", "gnutella.query.payload",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella Query Payload", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_payload,\r\n{ "QueryHit", "gnutella.queryhit.payload",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella QueryHit Payload", HFILL }\r\n},\r\n{ &hf_gnutella_stream,\r\n{ "Gnutella Upload / Download Stream", "gnutella.stream",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_gnutella_header_id,\r\n{ "ID", "gnutella.header.id",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"Gnutella Descriptor ID", HFILL }\r\n},\r\n{ &hf_gnutella_header_payload,\r\n{ "Payload", "gnutella.header.payload",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"Gnutella Descriptor Payload", HFILL }\r\n},\r\n{ &hf_gnutella_header_ttl,\r\n{ "TTL", "gnutella.header.ttl",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"Gnutella Descriptor Time To Live", HFILL }\r\n},\r\n{ &hf_gnutella_header_hops,\r\n{ "Hops", "gnutella.header.hops",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"Gnutella Descriptor Hop Count", HFILL }\r\n},\r\n{ &hf_gnutella_header_size,\r\n{ "Length", "gnutella.header.size",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"Gnutella Descriptor Payload Length", HFILL }\r\n},\r\n{ &hf_gnutella_pong_port,\r\n{ "Port", "gnutella.pong.port",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\n"Gnutella Pong TCP Port", HFILL }\r\n},\r\n{ &hf_gnutella_pong_ip,\r\n{ "IP", "gnutella.pong.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0,\r\n"Gnutella Pong IP Address", HFILL }\r\n},\r\n{ &hf_gnutella_pong_files,\r\n{ "Files Shared", "gnutella.pong.files",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella Pong Files Shared", HFILL }\r\n},\r\n{ &hf_gnutella_pong_kbytes,\r\n{ "KBytes Shared", "gnutella.pong.kbytes",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella Pong KBytes Shared", HFILL }\r\n},\r\n{ &hf_gnutella_query_min_speed,\r\n{ "Min Speed", "gnutella.query.min_speed",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella Query Minimum Speed", HFILL }\r\n},\r\n{ &hf_gnutella_query_search,\r\n{ "Search", "gnutella.query.search",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\n"Gnutella Query Search", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_hit,\r\n{ "Hit", "gnutella.queryhit.hit",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\n"Gnutella QueryHit", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_hit_index,\r\n{ "Index", "gnutella.queryhit.hit.index",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella QueryHit Index", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_hit_size,\r\n{ "Size", "gnutella.queryhit.hit.size",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella QueryHit Size", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_hit_name,\r\n{ "Name", "gnutella.queryhit.hit.name",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"Gnutella Query Name", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_hit_extra,\r\n{ "Extra", "gnutella.queryhit.hit.extra",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"Gnutella Query Extra", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_count,\r\n{ "Count", "gnutella.queryhit.count",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"Gnutella QueryHit Count", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_port,\r\n{ "Port", "gnutella.queryhit.port",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\n"Gnutella QueryHit Port", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_ip,\r\n{ "IP", "gnutella.queryhit.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0,\r\n"Gnutella QueryHit IP Address", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_speed,\r\n{ "Speed", "gnutella.queryhit.speed",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella QueryHit Speed", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_extra,\r\n{ "Extra", "gnutella.queryhit.extra",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"Gnutella QueryHit Extra", HFILL }\r\n},\r\n{ &hf_gnutella_queryhit_servent_id,\r\n{ "Servent ID", "gnutella.queryhit.servent_id",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"Gnutella QueryHit Servent ID", HFILL }\r\n},\r\n{ &hf_gnutella_push_servent_id,\r\n{ "Servent ID", "gnutella.push.servent_id",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"Gnutella Push Servent ID", HFILL }\r\n},\r\n{ &hf_gnutella_push_ip,\r\n{ "IP", "gnutella.push.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0,\r\n"Gnutella Push IP Address", HFILL }\r\n},\r\n{ &hf_gnutella_push_index,\r\n{ "Index", "gnutella.push.index",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"Gnutella Push Index", HFILL }\r\n},\r\n{ &hf_gnutella_push_port,\r\n{ "Port", "gnutella.push.port",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\n"Gnutella Push Port", HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_gnutella,\r\n};\r\nproto_gnutella = proto_register_protocol("Gnutella Protocol",\r\n"GNUTELLA",\r\n"gnutella");\r\nproto_register_field_array(proto_gnutella, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_gnutella(void) {\r\ndissector_handle_t gnutella_handle;\r\ngnutella_handle = create_dissector_handle(dissect_gnutella,\r\nproto_gnutella);\r\ndissector_add_uint("tcp.port", GNUTELLA_TCP_PORT, gnutella_handle);\r\n}
