static int\r\ndissect_v150fw(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, void *data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *v150fw_tree, *field_tree;\r\nguint8 extb, ric;\r\nguint16 ext_len = 0;\r\ngint payload_length;\r\nunsigned int offset = 0;\r\nif(tree)\r\n{\r\nti = proto_tree_add_item(tree, proto_v150fw, tvb, 0, -1, ENC_NA);\r\nv150fw_tree = proto_item_add_subtree(ti, ett_v150fw);\r\npayload_length = tvb_reported_length(tvb);\r\nextb = tvb_get_guint8(tvb, offset) & 0x01;\r\nric = tvb_get_guint8(tvb, offset + 1);\r\nif(extb && payload_length >= 6)\r\next_len = tvb_get_ntohs(tvb, offset + 4) & 0x07FF;\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_event_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_force_response_bit, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_extension_bit, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_reason_id_code, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nswitch(ric)\r\n{\r\ncase V150FW_RIC_CM:\r\ncase V150FW_RIC_JM:\r\nti = proto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_mod_avail, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nfield_tree = proto_item_add_subtree(ti, ett_available_modulations);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_pcm_mode, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v34_duplex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v34_half_duplex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v32_v32bis, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v22_v22bis, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v17, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v29_half_duplex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v27ter, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v26ter, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v26bis, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v23_duplex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v23_half_duplex, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v21, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v90_or_v92_analog, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v90_or_v92_digital, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(field_tree, hf_v150fw_cm_jm_mod_avail_v91, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase V150FW_RIC_TIMEOUT:\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_timeout, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_timeout_vendor, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase V150FW_RIC_CLEARDOWN:\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_cleardown, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_cleardown_reserved, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_reason_id_code_info, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\noffset += 2;\r\nif(extb && payload_length >= 6)\r\n{\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_reserved, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nif(ext_len != (payload_length - 6))\r\n{\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_extension_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_extension_len, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n}\r\noffset += 2;\r\nswitch(ric) {\r\ncase V150FW_RIC_CLEARDOWN:\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_cleardown_vendor_tag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_ric_info_cleardown_vendor_info, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(v150fw_tree, hf_v150fw_remainder, tvb, offset, (payload_length - 6), ENC_NA);\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_v150fw(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_v150fw_event_id,\r\n{\r\n"Event ID",\r\n"v150fw.event",\r\nFT_UINT8,\r\nBASE_DEC | BASE_RANGE_STRING,\r\nRVALS(v150fw_event_id_name),\r\n0xFC,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_force_response_bit,\r\n{\r\n"Force response",\r\n"v150fw.frb",\r\nFT_BOOLEAN,\r\n8,\r\nTFS(&tfs_yes_no),\r\n0x02,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_extension_bit,\r\n{\r\n"Payload extension",\r\n"v150fw.extb",\r\nFT_BOOLEAN,\r\n8,\r\nTFS(&tfs_present_absent),\r\n0x01,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_reason_id_code,\r\n{\r\n"Reason ID",\r\n"v150fw.ric",\r\nFT_UINT8,\r\nBASE_DEC | BASE_RANGE_STRING,\r\nRVALS(v150fw_ric_name),\r\n0xFF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_reason_id_code_info,\r\n{\r\n"Info",\r\n"v150fw.ricinfo",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0xFFFF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_timeout,\r\n{\r\n"Timeout type",\r\n"v150fw.ricinfo.timeout",\r\nFT_UINT16,\r\nBASE_HEX,\r\nVALS(v150fw_ric_info_timeout_type),\r\n0xFF00,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_timeout_vendor,\r\n{\r\n"Vendor-specific timeout info",\r\n"v150fw.ricinfo.timeout_vendor",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0x00FF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_cleardown,\r\n{\r\n"Cleardown type",\r\n"v150fw.ricinfo.cleardown",\r\nFT_UINT16,\r\nBASE_HEX,\r\nVALS(v150fw_ric_info_cleardown_type),\r\n0xFF00,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_cleardown_reserved,\r\n{\r\n"Reserved for use by the ITU-T",\r\n"v150fw.ricinfo.cleardown_reserved",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0x00FF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_cleardown_vendor_tag,\r\n{\r\n"Vendor tag",\r\n"v150fw.cleardown_vendor_tag",\r\nFT_UINT8,\r\nBASE_HEX,\r\nNULL,\r\n0xFF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_cleardown_vendor_info,\r\n{\r\n"Vendor-specific info",\r\n"v150fw.cleardown_vendor_info",\r\nFT_UINT8,\r\nBASE_HEX,\r\nNULL,\r\n0xFF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_ric_info_mod_avail,\r\n{\r\n"Modulation availability",\r\n"v150fw.rinfo.mod_avail",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0xFFFF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_pcm_mode,\r\n{\r\n"PCM mode",\r\n"v150fw.rinfo.mod_avail.pcm_mode",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x8000,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v34_duplex,\r\n{\r\n"V.34 duplex",\r\n"v150fw.rinfo.mod_avail.v34_duplex",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x4000,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v34_half_duplex,\r\n{\r\n"V.34 half-duplex",\r\n"v150fw.rinfo.mod_avail.v34_half_duplex",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x2000,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v32_v32bis,\r\n{\r\n"V.32/V.32bis",\r\n"v150fw.rinfo.mod_avail.v32_v32bis",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x1000,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v22_v22bis,\r\n{\r\n"V.22/V.22bis",\r\n"v150fw.rinfo.mod_avail.v22_v22bis",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0800,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v17,\r\n{\r\n"V.17",\r\n"v150fw.rinfo.mod_avail.v17",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0400,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v29_half_duplex,\r\n{\r\n"V.29 half-duplex",\r\n"v150fw.rinfo.mod_avail.v29_half_duplex",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0200,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v27ter,\r\n{\r\n"V.27ter",\r\n"v150fw.rinfo.mod_avail.v27ter",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0100,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v26ter,\r\n{\r\n"V.26ter",\r\n"v150fw.rinfo.mod_avail.v26ter",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0080,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v26bis,\r\n{\r\n"V.26bis",\r\n"v150fw.rinfo.mod_avail.v26bis",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0040,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v23_duplex,\r\n{\r\n"V.23 duplex",\r\n"v150fw.rinfo.mod_avail.v23_duplex",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0020,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v23_half_duplex,\r\n{\r\n"V.23 half-duplex",\r\n"v150fw.rinfo.mod_avail.half_duplex",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0010,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v21,\r\n{\r\n"V.21",\r\n"v150fw.rinfo.mod_avail.v21",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0008,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v90_or_v92_analog,\r\n{\r\n"V.90 or V.92 analog",\r\n"v150fw.rinfo.mod_avail.v90_or_v92_analog",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0004,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v90_or_v92_digital,\r\n{\r\n"V.90 or V.92 digital",\r\n"v150fw.rinfo.mod_avail.v90_or_v92_digital",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0002,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_cm_jm_mod_avail_v91,\r\n{\r\n"V.91",\r\n"v150fw.rinfo.mod_avail.v91",\r\nFT_BOOLEAN,\r\n16,\r\nTFS(&tfs_available_not_available),\r\n0x0001,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_reserved,\r\n{\r\n"Reserved",\r\n"v150fw.reserved",\r\nFT_UINT16,\r\nBASE_HEX,\r\nNULL,\r\n0xF800,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_extension_len,\r\n{\r\n"Extension field length",\r\n"v150fw.eflen",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x07FF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_v150fw_remainder,\r\n{\r\n"Remaining bytes",\r\n"v150fw.remainder",\r\nFT_BYTES,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_v150fw,\r\n&ett_available_modulations\r\n};\r\nproto_v150fw = proto_register_protocol("v150fw State Signaling Event", "v150fw", "v150fw");\r\nproto_register_field_array(proto_v150fw, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("v150fw", dissect_v150fw, proto_v150fw);\r\n}
