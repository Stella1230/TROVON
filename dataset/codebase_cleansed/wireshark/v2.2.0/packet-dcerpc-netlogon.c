static void printnbyte(const guint8* tab,int nb,const char* txt,const char* txt2)\r\n{\r\nint i=0;\r\ndebugprintf("%s ",txt);\r\nfor(i=0;i<nb;i++)\r\n{\r\ndebugprintf("%02X ",*(tab+i));\r\n}\r\ndebugprintf("%s",txt2);\r\n}\r\nstatic void printnbyte(const guint8* tab _U_,int nb _U_,const char* txt _U_,const char* txt2 _U_) {}\r\nstatic gint dissect_dcerpc_8bytes (tvbuff_t *tvb, gint offset, packet_info *pinfo _U_,\r\nproto_tree *tree, guint8 *drep,\r\nint hfindex, guint64 *pdata)\r\n{\r\nguint64 data;\r\ndata = ((drep[0] & DREP_LITTLE_ENDIAN)\r\n? tvb_get_letoh64 (tvb, offset)\r\n: tvb_get_ntoh64 (tvb, offset));\r\nif (tree) {\r\nproto_tree_add_item(tree, hfindex, tvb, offset, 8, ENC_NA);\r\n}\r\nif (pdata)\r\n*pdata = data;\r\nreturn offset+8;\r\n}\r\nstatic gint\r\nnetlogon_auth_equal (gconstpointer k1, gconstpointer k2)\r\n{\r\nconst netlogon_auth_key *key1 = (const netlogon_auth_key *)k1;\r\nconst netlogon_auth_key *key2 = (const netlogon_auth_key *)k2;\r\nif(key1->name == NULL || key2->name ==NULL)\r\nreturn ((key1->srcport == key2->srcport) && (key1->dstport == key2->dstport) && addresses_equal(&key1->src,&key2->src) &&\r\naddresses_equal(&key1->dst,&key2->dst));\r\nelse\r\nreturn ((strcmp(key1->name,key2->name)==0) && addresses_equal(&key1->src,&key2->src) &&\r\naddresses_equal(&key1->dst,&key2->dst));\r\n}\r\nstatic guint\r\nnetlogon_auth_hash (gconstpointer k)\r\n{\r\nconst netlogon_auth_key *key1 = (const netlogon_auth_key *)k;\r\nguint hash_val1;\r\nif(key1->name == NULL) {\r\nhash_val1 = key1->dstport;\r\nhash_val1 += key1->srcport;\r\n}\r\nelse {\r\nunsigned int i = 0;\r\nhash_val1 = 0;\r\nfor(i=0; key1->name[i]; i++) {\r\nhash_val1 += key1->name[i];\r\n}\r\n}\r\nhash_val1 = add_address_to_hash(hash_val1, &key1->src);\r\nhash_val1 = add_address_to_hash(hash_val1, &key1->dst);\r\nreturn hash_val1;\r\n}\r\nstatic int\r\nnetlogon_dissect_EXTRA_FLAGS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * extraflags[] = {\r\n&hf_netlogon_extra_flags_root_forest,\r\n&hf_netlogon_trust_flags_dc_firsthop,\r\n&hf_netlogon_trust_flags_rodc_to_dc,\r\n&hf_netlogon_trust_flags_rodc_ntlm,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_extraflags, ett_trust_flags, extraflags, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_ndr_lm_nt_hash_cb(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep, int hf_index,\r\ndcerpc_callback_fnct_t *callback,\r\nvoid *callback_args)\r\n{\r\nguint16 len, size;\r\nALIGN_TO_4_BYTES;\r\nif (di->conformant_run)\r\nreturn offset;\r\n#if 0\r\nstruct {\r\nshort len;\r\nshort size;\r\n[size_is(size/2), length_is(len/2), ptr] unsigned short *string;\r\n} HASH;\r\n#endif\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_nt_cs_len, &len);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_nt_cs_size, &size);\r\noffset = dissect_ndr_pointer_cb(tvb, offset, pinfo, tree, di, drep,\r\ndissect_ndr_byte_array, NDR_POINTER_UNIQUE,\r\n"Bytes Array", hf_index, callback, callback_args);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_ndr_lm_nt_hash_helper(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep, int hf_index, int levels _U_,\r\ngboolean add_subtree)\r\n{\r\nproto_tree *subtree = tree;\r\nif (add_subtree) {\r\nsubtree = proto_tree_add_subtree(\r\ntree, tvb, offset, 0, ett_LM_OWF_PASSWORD, NULL,\r\nproto_registrar_get_name(hf_index));\r\n}\r\nreturn dissect_ndr_lm_nt_hash_cb(\r\ntvb, offset, pinfo, subtree, di, drep, hf_index,\r\nNULL, NULL);\r\n}\r\nstatic int\r\nnetlogon_dissect_USER_ACCOUNT_CONTROL(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * uac[] = {\r\n&hf_netlogon_user_account_control_dont_require_preauth,\r\n&hf_netlogon_user_account_control_use_des_key_only,\r\n&hf_netlogon_user_account_control_not_delegated,\r\n&hf_netlogon_user_account_control_trusted_for_delegation,\r\n&hf_netlogon_user_account_control_smartcard_required,\r\n&hf_netlogon_user_account_control_encrypted_text_password_allowed,\r\n&hf_netlogon_user_account_control_account_auto_locked,\r\n&hf_netlogon_user_account_control_dont_expire_password,\r\n&hf_netlogon_user_account_control_server_trust_account,\r\n&hf_netlogon_user_account_control_workstation_trust_account,\r\n&hf_netlogon_user_account_control_interdomain_trust_account,\r\n&hf_netlogon_user_account_control_mns_logon_account,\r\n&hf_netlogon_user_account_control_normal_account,\r\n&hf_netlogon_user_account_control_temp_duplicate_account,\r\n&hf_netlogon_user_account_control_password_not_required,\r\n&hf_netlogon_user_account_control_home_directory_required,\r\n&hf_netlogon_user_account_control_account_disabled,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_user_account_control, ett_user_account_control, uac, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LOGONSRV_HANDLE(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Server Handle",\r\nhf_netlogon_logonsrv_handle, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION_UAS_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Effective Account",\r\nhf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_priv, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_auth_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_bad_pw_count, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_logon_time, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_last_logoff_time, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_logoff_time, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_kickoff_time, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_pwd_age, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_pwd_can_change_time, NULL);\r\noffset = dissect_ndr_time_t(tvb, offset, pinfo, tree, di, drep, hf_netlogon_pwd_must_change_time, NULL);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_domain_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Script", hf_netlogon_logon_script, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonuaslogon_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Account", hf_netlogon_acct_name, CB_STR_COL_INFO);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Workstation", hf_netlogon_workstation, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonuaslogon_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_UAS_INFO, NDR_POINTER_UNIQUE,\r\n"VALIDATION_UAS_INFO", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LOGOFF_UAS_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 duration;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nduration = tvb_get_guint32(tvb, offset, DREP_ENC_INTEGER(drep));\r\nproto_tree_add_uint_format_value(tree, hf_netlogon_logon_duration, tvb, offset, 4, duration, "unknown time format");\r\noffset+= 4;\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count16, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonuaslogoff_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Account", hf_netlogon_acct_name, CB_STR_COL_INFO);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Workstation", hf_netlogon_workstation, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonuaslogoff_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LOGOFF_UAS_INFO, NDR_POINTER_REF,\r\n"LOGOFF_UAS_INFO", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_BYTE_byte(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_BYTE_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_byte);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LOGON_IDENTITY_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_IDENTITY_INFO, &item, "IDENTITY_INFO:");\r\n}\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_param_ctrl, NULL);\r\noffset = dissect_ndr_duint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_id, NULL);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_name, 1);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_workstation, 0);\r\n#ifdef REMOVED\r\noffset = netlogon_dissect_8_unknown_bytes(tvb, offset, pinfo, tree, di, drep);\r\n#endif\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LM_OWF_PASSWORD(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 16,\r\nett_LM_OWF_PASSWORD, &item, "LM_OWF_PASSWORD:");\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_lm_owf_password, tvb, offset, 16,\r\nENC_NA);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NT_OWF_PASSWORD(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 16,\r\nett_NT_OWF_PASSWORD, &item, "NT_OWF_PASSWORD:");\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_nt_owf_password, tvb, offset, 16,\r\nENC_NA);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_INTERACTIVE_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGON_IDENTITY_INFO(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_LM_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_NT_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CHALLENGE(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_challenge, tvb, offset, 8,\r\nENC_NA);\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NETWORK_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGON_IDENTITY_INFO(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_CHALLENGE(tvb, offset,\r\npinfo, tree, di, drep);\r\n#if 0\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "NT ",\r\nhf_netlogon_nt_owf_password, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_data_length, NULL);\r\n#endif\r\noffset = dissect_ndr_lm_nt_hash_helper(tvb,offset,pinfo, tree, di, drep, hf_netlogon_lm_chal_resp, 0,TRUE);\r\noffset = dissect_ndr_lm_nt_hash_helper(tvb,offset,pinfo, tree, di, drep, hf_netlogon_lm_chal_resp, 0,TRUE);\r\n#if 0\r\noffset = netlogon_dissect_LM_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_NT_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\n#endif\r\nreturn offset;\r\n#if 0\r\noffset = dissect_ndr_counted_byte_array_cb(\r\ntvb, offset, pinfo, tree, di, drep, hf_netlogon_nt_chal_resp,\r\ndissect_nt_chal_resp_cb,GINT_TO_POINTER(2));\r\noffset = dissect_ndr_counted_byte_array(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_lm_chal_resp, 0);\r\nreturn offset;\r\n#endif\r\n}\r\nstatic int\r\nnetlogon_dissect_SERVICE_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGON_IDENTITY_INFO(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_LM_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_NT_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_GENERIC_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGON_IDENTITY_INFO(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_package_name, 0|CB_STR_SAVE);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_data_length, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_REF,\r\n"Logon Data", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LEVEL(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint16 level = 0;\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level16, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_INTERACTIVE_INFO, NDR_POINTER_UNIQUE,\r\n"INTERACTIVE_INFO:", -1);\r\nbreak;\r\ncase 2:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_NETWORK_INFO, NDR_POINTER_UNIQUE,\r\n"NETWORK_INFO:", -1);\r\nbreak;\r\ncase 3:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_SERVICE_INFO, NDR_POINTER_UNIQUE,\r\n"SERVICE_INFO:", -1);\r\nbreak;\r\ncase 4:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GENERIC_INFO, NDR_POINTER_UNIQUE,\r\n"GENERIC_INFO:", -1);\r\nbreak;\r\ncase 5:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_INTERACTIVE_INFO, NDR_POINTER_UNIQUE,\r\n"INTERACTIVE_TRANSITIVE_INFO:", -1);\r\nbreak;\r\ncase 6:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_NETWORK_INFO, NDR_POINTER_UNIQUE,\r\n"NETWORK_TRANSITIVE_INFO", -1);\r\nbreak;\r\ncase 7:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_SERVICE_INFO, NDR_POINTER_UNIQUE,\r\n"SERVICE_TRANSITIVE_INFO", -1);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CREDENTIAL(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_credential, tvb, offset, 8,\r\nENC_NA);\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_AUTHENTICATOR(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nnstime_t ts;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = netlogon_dissect_CREDENTIAL(tvb, offset,\r\npinfo, tree, di, drep);\r\nALIGN_TO_4_BYTES;\r\nts.secs = tvb_get_letohl(tvb, offset);\r\nts.nsecs = 0;\r\nproto_tree_add_time(tree, hf_netlogon_timestamp, tvb, offset, 4, &ts);\r\noffset+= 4;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ATTRIBUTES(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * attr[] = {\r\n&hf_netlogon_group_attrs_enabled,\r\n&hf_netlogon_group_attrs_enabled_by_default,\r\n&hf_netlogon_group_attrs_mandatory,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_attrs, ett_group_attrs, attr, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_GROUP_MEMBERSHIP(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_GROUP_MEMBERSHIP, &item, "GROUP_MEMBERSHIP:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\noffset = netlogon_dissect_GROUP_MEMBERSHIP_ATTRIBUTES(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GROUP_MEMBERSHIP);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_USER_SESSION_KEY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_user_session_key, tvb, offset, 16,\r\nENC_NA);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_USER_FLAGS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * flags[] = {\r\n&hf_netlogon_user_flags_resource_groups,\r\n&hf_netlogon_user_flags_extra_sids,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_user_flags, ett_user_flags, flags, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION_SAM_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_kickoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_last_set_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_can_change_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_must_change_time);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_full_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_script, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_profile_path, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_home_dir, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dir_drive, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count16, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_bad_pw_count16, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_rids, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ARRAY, NDR_POINTER_UNIQUE,\r\n"GROUP_MEMBERSHIP_ARRAY", -1);\r\noffset = netlogon_dissect_USER_FLAGS(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_USER_SESSION_KEY(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_srv, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy1_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy2_long, NULL);\r\noffset = netlogon_dissect_USER_ACCOUNT_CONTROL(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy4_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy5_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy6_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy7_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy8_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy9_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy10_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION_SAM_INFO2(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_VALIDATION_SAM_INFO(tvb,offset,pinfo,tree,di,drep);\r\n#if 0\r\nint i;\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_kickoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_last_set_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_can_change_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_must_change_time);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_full_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_script, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_profile_path, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_home_dir, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dir_drive, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count16, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_bad_pw_count16, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_rids, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ARRAY, NDR_POINTER_UNIQUE,\r\n"GROUP_MEMBERSHIP_ARRAY", -1);\r\noffset = netlogon_dissect_USER_FLAGS(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_USER_SESSION_KEY(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_srv, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nfor(i=0;i<2;i++){\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\n}\r\noffset = netlogon_dissect_USER_ACCOUNT_CONTROL(tvb, offset,\r\npinfo, tree, di, drep);\r\nfor(i=0;i<7;i++){\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\n}\r\n#endif\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_sid, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_ndr_nt_SID_AND_ATTRIBUTES_ARRAY, NDR_POINTER_UNIQUE,\r\n"SID_AND_ATTRIBUTES_ARRAY:", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION_SAM_INFO4(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_VALIDATION_SAM_INFO2(tvb,offset,pinfo,tree,di,drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_dnslogondomainname, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_upn, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string2, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string3, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string4, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string5, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string6, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string7, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string8, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string9, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string10, 0);\r\nreturn offset;\r\n}\r\nint\r\nnetlogon_dissect_PAC_LOGON_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 rgc;\r\noffset = netlogon_dissect_VALIDATION_SAM_INFO(tvb,offset,pinfo,tree,di, drep);\r\n#if 0\r\nint i;\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_kickoff_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_last_set_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_can_change_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_must_change_time);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_full_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_script, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_profile_path, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_home_dir, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dir_drive, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count16, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_bad_pw_count16, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_rids, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ARRAY, NDR_POINTER_UNIQUE,\r\n"GROUP_MEMBERSHIP_ARRAY", -1);\r\noffset = netlogon_dissect_USER_FLAGS(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_USER_SESSION_KEY(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_srv, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nfor(i=0;i<2;i++){\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\n}\r\noffset = netlogon_dissect_USER_ACCOUNT_CONTROL(tvb, offset,\r\npinfo, tree, di, drep);\r\nfor(i=0;i<7;i++){\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\n}\r\n#endif\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_sid, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_ndr_nt_SID_AND_ATTRIBUTES_ARRAY, NDR_POINTER_UNIQUE,\r\n"SID_AND_ATTRIBUTES_ARRAY:", -1);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_resourcegroupcount, &rgc);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_GROUP_MEMBERSHIP_ARRAY, NDR_POINTER_UNIQUE,\r\n"ResourceGroupIDs", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_S4U_Transited_Service_name(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_transited_service, 1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_S4U_Transited_Services_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_S4U_Transited_Service_name);\r\nreturn offset;\r\n}\r\nint\r\nnetlogon_dissect_PAC_S4U_DELEGATION_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_s4u2proxytarget, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_transitedlistsize, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_S4U_Transited_Services_array, NDR_POINTER_UNIQUE,\r\n"S4UTransitedServices", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION_GENERIC_INFO2 (tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_data_length, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_REF,\r\n"Validation Data", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_VALIDATION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint16 level = 0;\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_validation_level, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_UAS_INFO, NDR_POINTER_UNIQUE,\r\n"VALIDATION_UAS_INFO:", -1);\r\nbreak;\r\ncase 2:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_SAM_INFO, NDR_POINTER_UNIQUE,\r\n"VALIDATION_SAM_INFO:", -1);\r\nbreak;\r\ncase 3:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_SAM_INFO2, NDR_POINTER_UNIQUE,\r\n"VALIDATION_SAM_INFO2:", -1);\r\nbreak;\r\ncase 4:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_GENERIC_INFO2, NDR_POINTER_UNIQUE,\r\n"VALIDATION_INFO:", -1);\r\nbreak;\r\ncase 5:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_GENERIC_INFO2, NDR_POINTER_UNIQUE,\r\n"VALIDATION_INFO2:", -1);\r\nbreak;\r\ncase 6:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION_SAM_INFO4, NDR_POINTER_UNIQUE,\r\n"VALIDATION_SAM_INFO4:", -1);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogonflags_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level16, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LEVEL, NDR_POINTER_REF,\r\n"LEVEL: LogonLevel", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_validation_level, NULL);\r\noffset = netlogon_dissect_EXTRA_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogonflags_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION, NDR_POINTER_REF,\r\n"VALIDATION:", -1);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_authoritative, NULL);\r\noffset = netlogon_dissect_EXTRA_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogon_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level16, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LEVEL, NDR_POINTER_REF,\r\n"LEVEL: LogonLevel", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_validation_level, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogon_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION, NDR_POINTER_REF,\r\n"VALIDATION:", -1);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_authoritative, NULL);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogoff_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level16, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LEVEL, NDR_POINTER_REF,\r\n"LEVEL: logoninformation", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogoff_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic void generate_hash_key(packet_info *pinfo,unsigned char is_server,netlogon_auth_key *key,char* name)\r\n{\r\nif(is_server) {\r\nkey->dstport = pinfo->srcport;\r\nkey->srcport = pinfo->destport;\r\ncopy_address(&key->dst,&pinfo->src);\r\ncopy_address(&key->src,&pinfo->dst);\r\nkey->name = name;\r\n}\r\nelse {\r\ncopy_address(&key->dst,&pinfo->dst);\r\ncopy_address(&key->src,&pinfo->src);\r\nkey->dstport = pinfo->destport;\r\nkey->srcport = pinfo->srcport;\r\nkey->name = name;\r\n}\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverreqchallenge_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nnetlogon_auth_vars *vars;\r\nnetlogon_auth_vars *existing_vars;\r\nnetlogon_auth_key *key;\r\nguint8 tab[8] = { 0,0,0,0,0,0,0,0};\r\ndcerpc_call_value *dcv = (dcerpc_call_value *)di->call_data;\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_pointer_cb(\r\ntvb, offset, pinfo, tree, di, drep,\r\ndissect_ndr_wchar_cvstring, NDR_POINTER_REF,\r\n"Computer Name", hf_netlogon_computer_name,\r\ncb_wstr_postprocess,\r\nGINT_TO_POINTER(CB_STR_COL_INFO |CB_STR_SAVE | 1));\r\ndebugprintf("1)Len %d offset %d txt %s\n",(int) strlen(dcv->private_data),offset,(char*)dcv->private_data);\r\nvars = wmem_new0(wmem_file_scope(), netlogon_auth_vars);\r\nvars->client_name = wmem_strdup(wmem_file_scope(), (const guint8 *)dcv->private_data);\r\ndebugprintf("2)Len %d offset %d txt %s\n",(int) strlen(dcv->private_data),offset,vars->client_name);\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, tree, drep,\r\nhf_client_challenge,&vars->client_challenge);\r\nmemcpy(tab,&vars->client_challenge,8);\r\nvars->start = pinfo->num;\r\nvars->next_start = -1;\r\nvars->next = NULL;\r\nkey = wmem_new(wmem_file_scope(), netlogon_auth_key);\r\ngenerate_hash_key(pinfo,0,key,NULL);\r\nexisting_vars = (netlogon_auth_vars *)g_hash_table_lookup(netlogon_auths, key);\r\nif (!existing_vars) {\r\ndebugprintf("Adding initial vars with this start packet = %d\n",vars->start);\r\ng_hash_table_insert(netlogon_auths, key, vars);\r\n}\r\nelse {\r\nwhile(existing_vars->next != NULL && existing_vars->start < vars->start) {\r\ndebugprintf("Looping to find existing vars ...\n");\r\nexisting_vars = existing_vars->next;\r\n}\r\nif(existing_vars->next != NULL || existing_vars->start == vars->start) {\r\ndebugprintf("It seems that I already record this vars start packet = %d\n",vars->start);\r\n}\r\nelse {\r\ndebugprintf("Adding a new entry with this start packet = %d\n",vars->start);\r\nexisting_vars->next_start = pinfo->num;\r\nexisting_vars->next = vars;\r\n}\r\n}\r\n#if 0\r\ngenerate_hash_key(pinfo,0,key,vars->client_name);\r\nexisting_vars = NULL;\r\nexisting_vars = g_hash_table_lookup(schannel_auths, key);\r\nif (!existing_vars)\r\n{\r\ng_hash_table_insert(schannel_auths, key, vars);\r\n}\r\nelse\r\n{\r\nwhile(existing_vars->next != NULL && existing_vars->start <= vars->start) {\r\nexisting_vars = existing_vars->next;\r\n}\r\nif(existing_vars->next != NULL || existing_vars == vars) {\r\ndebugprintf("It seems that I already record this vars (schannel hash)%d\n",vars->start);\r\n}\r\nelse {\r\nexisting_vars->next_start = pinfo->num;\r\nexisting_vars->next = vars;\r\n}\r\n#endif\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverreqchallenge_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nnetlogon_auth_vars *vars;\r\nnetlogon_auth_key key;\r\nguint64 server_challenge;\r\ngenerate_hash_key(pinfo,1,&key,NULL);\r\nvars = (netlogon_auth_vars *)g_hash_table_lookup(netlogon_auths,(gconstpointer*) &key);\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, tree, drep,\r\nhf_server_challenge, &server_challenge);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nif(vars != NULL) {\r\nwhile(vars !=NULL && vars->next_start != -1 && vars->next_start < (int)pinfo->num )\r\n{\r\nvars = vars->next;\r\ndebugprintf("looping challenge reply... %d %d \n", vars->next_start, pinfo->num);\r\n}\r\nif(vars == NULL)\r\n{\r\ndebugprintf("Something strange happened while searching for challenge_reply\n");\r\n}\r\nelse\r\n{\r\nvars->server_challenge = server_challenge;\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NETLOGON_SECURE_CHANNEL_TYPE(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_secure_channel_type, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "User Name", hf_netlogon_acct_name, CB_STR_COL_INFO);\r\noffset = netlogon_dissect_NETLOGON_SECURE_CHANNEL_TYPE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, CB_STR_COL_INFO);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CREDENTIAL, NDR_POINTER_REF,\r\n"CREDENTIAL: client challenge", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CREDENTIAL, NDR_POINTER_REF,\r\n"CREDENTIAL: server challenge", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_ENCRYPTED_LM_OWF_PASSWORD(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo _U_, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep _U_)\r\n{\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_encrypted_lm_owf_password, tvb, offset, 16,\r\nENC_NA);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordset_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "User Name", hf_netlogon_acct_name, 0);\r\noffset = netlogon_dissect_NETLOGON_SECURE_CHANNEL_TYPE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_ENCRYPTED_LM_OWF_PASSWORD, NDR_POINTER_REF,\r\n"ENCRYPTED_LM_OWF_PASSWORD: hashed_pwd", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordset_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_DELETE_USER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Account Name", hf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_SENSITIVE_DATA(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 data_len;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sensitive_data_len, &data_len);\r\nproto_tree_add_item(tree, hf_netlogon_sensitive_data, tvb, offset,\r\ndata_len, ENC_NA);\r\noffset += data_len;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_USER_PRIVATE_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sensitive_data_flag, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sensitive_data_len, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_SENSITIVE_DATA, NDR_POINTER_UNIQUE,\r\n"SENSITIVE_DATA", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_USER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_name, 3);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_full_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_home_dir, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dir_drive, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_script, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_desc, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_workstations, 0);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logoff_time);\r\noffset = dissect_ndr_nt_LOGON_HOURS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_bad_pw_count16, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_count16, NULL);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_last_set_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_acct_expiry_time);\r\noffset = dissect_ndr_nt_acct_ctrl(tvb, offset, pinfo, tree, di, drep);\r\noffset = netlogon_dissect_LM_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_NT_OWF_PASSWORD(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_nt_pwd_present, NULL);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_lm_pwd_present, NULL);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_expired, NULL);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_comment, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_parameters, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_country, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_codepage, NULL);\r\noffset = netlogon_dissect_USER_PRIVATE_INFO(tvb, offset, pinfo, tree,\r\ndi, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_DOMAIN(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_domain_name, 3);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_oem_info, 0);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_kickoff_time);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_minpasswdlen, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_passwdhistorylen, NULL);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_must_change_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pwd_can_change_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_domain_modify_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_domain_create_time);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_GROUP(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_name, 3);\r\noffset = netlogon_dissect_GROUP_MEMBERSHIP(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_desc, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_RENAME(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\ndi->hf_index, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\ndi->hf_index, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_RID(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_RID_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_RID);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_ATTRIB(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_attrs, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_ATTRIB_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_ATTRIB);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_GROUP_MEMBER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_RID_array, NDR_POINTER_UNIQUE,\r\n"RIDs:", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_ATTRIB_array, NDR_POINTER_UNIQUE,\r\n"Attribs:", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_rids, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ALIAS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_alias_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_alias_rid, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ALIAS_MEMBER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_nt_PSID_ARRAY(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_EVENT_AUDIT_OPTION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_event_audit_option, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_EVENT_AUDIT_OPTIONS_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_EVENT_AUDIT_OPTION);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_QUOTA_LIMITS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_QUOTA_LIMITS, &item, "QUOTA_LIMTS:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pagedpoollimit, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_nonpagedpoollimit, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_minworkingsetsize, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_maxworkingsetsize, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pagefilelimit, NULL);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_timelimit);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_POLICY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_log_size, NULL);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_audit_retention_period);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_auditing_mode, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_audit_event_count, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_EVENT_AUDIT_OPTIONS_ARRAY, NDR_POINTER_UNIQUE,\r\n"Event Audit Options:", -1);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_domain_name, 0);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\noffset = netlogon_dissect_QUOTA_LIMITS(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_db_modify_time);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_db_create_time);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CONTROLLER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dc_name, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CONTROLLER_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROLLER);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_TRUSTED_DOMAINS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_domain_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_controllers, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROLLER_ARRAY, NDR_POINTER_UNIQUE,\r\n"Domain Controllers:", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_PRIV_ATTR(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_attrs, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_PRIV_ATTR_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_PRIV_ATTR);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_PRIV_NAME(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_privilege_name, 1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_PRIV_NAME_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_PRIV_NAME);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ACCOUNTS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_privilege_entries, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_privilege_control, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_PRIV_ATTR_ARRAY, NDR_POINTER_UNIQUE,\r\n"PRIV_ATTR_ARRAY:", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_PRIV_NAME_ARRAY, NDR_POINTER_UNIQUE,\r\n"PRIV_NAME_ARRAY:", -1);\r\noffset = netlogon_dissect_QUOTA_LIMITS(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_systemflags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CIPHER_VALUE_DATA(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 data_len;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_uint32 (tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_maxlen, NULL);\r\noffset += 4;\r\noffset = dissect_ndr_uint32 (tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_len, &data_len);\r\nproto_tree_add_item(tree, di->hf_index, tvb, offset,\r\ndata_len, ENC_NA);\r\noffset += data_len;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CIPHER_VALUE(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep, const char *name, int hf_index)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_CYPHER_VALUE, &item, name);\r\n}\r\noffset = dissect_ndr_uint32 (tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_len, NULL);\r\noffset = dissect_ndr_uint32 (tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_maxlen, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CIPHER_VALUE_DATA, NDR_POINTER_UNIQUE,\r\nname, hf_index);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_SECRET(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_CIPHER_VALUE(tvb, offset,\r\npinfo, tree, di, drep,\r\n"CIPHER_VALUE: current cipher value",\r\nhf_netlogon_cipher_current_data);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_current_set_time);\r\noffset = netlogon_dissect_CIPHER_VALUE(tvb, offset,\r\npinfo, tree, di, drep,\r\n"CIPHER_VALUE: old cipher value",\r\nhf_netlogon_cipher_old_data);\r\noffset = dissect_ndr_nt_NTTIME(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_cipher_old_set_time);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_security_information, NULL);\r\noffset = lsarpc_dissect_sec_desc_buf(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_MODIFIED_COUNT(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_duint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_modify_count, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_UNION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nguint16 level = 0;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DELTA_UNION, &item, "DELTA_UNION:");\r\n}\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_delta_type, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_DOMAIN, NDR_POINTER_UNIQUE,\r\n"DELTA_DOMAIN:", -1);\r\nbreak;\r\ncase 2:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_GROUP, NDR_POINTER_UNIQUE,\r\n"DELTA_GROUP:", -1);\r\nbreak;\r\ncase 4:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_RENAME, NDR_POINTER_UNIQUE,\r\n"DELTA_RENAME_GROUP:", hf_netlogon_group_name);\r\nbreak;\r\ncase 5:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_USER, NDR_POINTER_UNIQUE,\r\n"DELTA_USER:", -1);\r\nbreak;\r\ncase 7:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_RENAME, NDR_POINTER_UNIQUE,\r\n"DELTA_RENAME_USER:", hf_netlogon_acct_name);\r\nbreak;\r\ncase 8:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_GROUP_MEMBER, NDR_POINTER_UNIQUE,\r\n"DELTA_GROUP_MEMBER:", -1);\r\nbreak;\r\ncase 9:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ALIAS, NDR_POINTER_UNIQUE,\r\n"DELTA_ALIAS:", -1);\r\nbreak;\r\ncase 11:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_RENAME, NDR_POINTER_UNIQUE,\r\n"DELTA_RENAME_ALIAS:", hf_netlogon_alias_name);\r\nbreak;\r\ncase 12:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ALIAS_MEMBER, NDR_POINTER_UNIQUE,\r\n"DELTA_ALIAS_MEMBER:", -1);\r\nbreak;\r\ncase 13:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_POLICY, NDR_POINTER_UNIQUE,\r\n"DELTA_POLICY:", -1);\r\nbreak;\r\ncase 14:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_TRUSTED_DOMAINS, NDR_POINTER_UNIQUE,\r\n"DELTA_TRUSTED_DOMAINS:", -1);\r\nbreak;\r\ncase 16:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ACCOUNTS, NDR_POINTER_UNIQUE,\r\n"DELTA_ACCOUNTS:", -1);\r\nbreak;\r\ncase 18:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_SECRET, NDR_POINTER_UNIQUE,\r\n"DELTA_SECRET:", -1);\r\nbreak;\r\ncase 20:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_DELETE_USER, NDR_POINTER_UNIQUE,\r\n"DELTA_DELETE_GROUP:", -1);\r\nbreak;\r\ncase 21:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_DELETE_USER, NDR_POINTER_UNIQUE,\r\n"DELTA_DELETE_USER:", -1);\r\nbreak;\r\ncase 22:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_MODIFIED_COUNT, NDR_POINTER_UNIQUE,\r\n"MODIFIED_COUNT:", -1);\r\nbreak;\r\n}\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ID_UNION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nguint16 level = 0;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DELTA_ID_UNION, &item, "DELTA_ID_UNION:");\r\n}\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_delta_type, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_group_rid, NULL);\r\nbreak;\r\ncase 2:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 3:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 4:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 5:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 6:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 7:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 8:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 9:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 10:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 11:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 12:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 13:\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nbreak;\r\ncase 14:\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nbreak;\r\ncase 15:\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nbreak;\r\ncase 16:\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nbreak;\r\ncase 17:\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\nbreak;\r\ncase 18:\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo,\r\ntree, di, drep, NDR_POINTER_UNIQUE, "unknown",\r\nhf_netlogon_unknown_string, 0);\r\nbreak;\r\ncase 19:\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo,\r\ntree, di, drep, NDR_POINTER_UNIQUE, "unknown",\r\nhf_netlogon_unknown_string, 0);\r\nbreak;\r\ncase 20:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\ncase 21:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_user_rid, NULL);\r\nbreak;\r\n}\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ENUM(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nguint16 type;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DELTA_ENUM, &item, "DELTA_ENUM:");\r\n}\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_delta_type, &type);\r\nproto_item_append_text(item, "%s", val_to_str(\r\ntype, delta_type_vals, "Unknown"));\r\noffset = netlogon_dissect_DELTA_ID_UNION(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_DELTA_UNION(tvb, offset,\r\npinfo, tree, di, drep);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ENUM_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DELTA_ENUM_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_deltas, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM_array, NDR_POINTER_UNIQUE,\r\n"DELTA_ENUM: deltas", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasedeltas_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_database_id, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_MODIFIED_COUNT, NDR_POINTER_REF,\r\n"MODIFIED_COUNT: domain modified count", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasedeltas_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_MODIFIED_COUNT, NDR_POINTER_REF,\r\n"MODIFIED_COUNT: domain modified count", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM_ARRAY, NDR_POINTER_UNIQUE,\r\n"DELTA_ENUM_ARRAY: deltas", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasesync_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_database_id, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sync_context, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasesync_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sync_context, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM_ARRAY, NDR_POINTER_UNIQUE,\r\n"DELTA_ENUM_ARRAY: deltas", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_UAS_INFO_0(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 time_created;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_netlogon_computer_name, tvb, offset, 16, ENC_ASCII|ENC_NA);\r\noffset += 16;\r\ntime_created = tvb_get_guint32(tvb, offset, DREP_ENC_INTEGER(drep));\r\nproto_tree_add_uint_format_value(tree, hf_netlogon_time_created, tvb, offset, 4, time_created, "unknown time format");\r\noffset+= 4;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_serial_number, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netraccountdeltas_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UAS_INFO_0, NDR_POINTER_REF,\r\n"UAS_INFO_0: RecordID", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_count, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netraccountdeltas_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_REF,\r\n"BYTE_array: Buffer", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_count, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_entries, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UAS_INFO_0, NDR_POINTER_REF,\r\n"UAS_INFO_0: RecordID", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netraccountsync_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reference, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netraccountsync_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_REF,\r\n"BYTE_array: Buffer", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_count, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_entries, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_next_reference, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UAS_INFO_0, NDR_POINTER_REF,\r\n"UAS_INFO_0: RecordID", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrgetdcname_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_domain_name, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrgetdcname_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_dc_name, 0);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NETLOGON_INFO_1(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pdc_connection_status, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NETLOGON_INFO_2(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_pdc_connection_status, NULL);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Trusted DC Name",\r\nhf_netlogon_trusted_dc_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_tc_connection_status, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_NETLOGON_INFO_3(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_logon_attempts, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_reserved, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CONTROL_QUERY_INFORMATION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 level = 0;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_NETLOGON_INFO_1, NDR_POINTER_UNIQUE,\r\n"NETLOGON_INFO_1:", -1);\r\nbreak;\r\ncase 2:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_NETLOGON_INFO_2, NDR_POINTER_UNIQUE,\r\n"NETLOGON_INFO_2:", -1);\r\nbreak;\r\ncase 3:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_NETLOGON_INFO_3, NDR_POINTER_UNIQUE,\r\n"NETLOGON_INFO_3:", -1);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_code, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROL_QUERY_INFORMATION, NDR_POINTER_REF,\r\n"CONTROL_QUERY_INFORMATION:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrgetanydcname_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Server Handle",\r\nhf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_domain_name, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrgetanydcname_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_dc_name, 0);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_CONTROL_DATA_INFORMATION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 level = 0;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 5:\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo,\r\ntree, di, drep, NDR_POINTER_UNIQUE, "Trusted Domain Name",\r\nhf_netlogon_TrustedDomainName_string, 0);\r\nbreak;\r\ncase 6:\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo,\r\ntree, di, drep, NDR_POINTER_UNIQUE, "Trusted Domain Name",\r\nhf_netlogon_TrustedDomainName_string, 0);\r\nbreak;\r\ncase 0xfffe:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nbreak;\r\ncase 8:\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo,\r\ntree, di, drep, NDR_POINTER_UNIQUE, "UserName",\r\nhf_netlogon_UserName_string, 0);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_code, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROL_DATA_INFORMATION, NDR_POINTER_REF,\r\n"CONTROL_DATA_INFORMATION: ", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol2_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 status;\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROL_QUERY_INFORMATION, NDR_POINTER_REF,\r\n"CONTROL_QUERY_INFORMATION:", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep, hf_netlogon_werr_rc, &status);\r\nif (status != 0)\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", Error: %s", val_to_str_ext(status, &WERR_errors_ext, "Unknown WERR error 0x%08x"));\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasesync2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_database_id, NULL);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_restart_state, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sync_context, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabasesync2_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_sync_context, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM_ARRAY, NDR_POINTER_UNIQUE,\r\n"DELTA_ENUM_ARRAY: deltas", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabaseredo_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_logonsrv_handle, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_REF,\r\n"Change log entry: ", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_max_log_size, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrdatabaseredo_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DELTA_ENUM_ARRAY, NDR_POINTER_UNIQUE,\r\n"DELTA_ENUM_ARRAY: deltas", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol2ex_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_code, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROL_DATA_INFORMATION, NDR_POINTER_REF,\r\n"CONTROL_DATA_INFORMATION: ", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncontrol2ex_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CONTROL_QUERY_INFORMATION, NDR_POINTER_REF,\r\n"CONTROL_QUERY_INFORMATION:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_TRUST_FLAGS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * flags[] = {\r\n&hf_netlogon_trust_flags_inbound,\r\n&hf_netlogon_trust_flags_native_mode,\r\n&hf_netlogon_trust_flags_primary,\r\n&hf_netlogon_trust_flags_tree_root,\r\n&hf_netlogon_trust_flags_outbound,\r\n&hf_netlogon_trust_flags_in_forest,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_trust_flags, ett_trust_flags, flags, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_TRUST_ATTRIBS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * attr[] = {\r\n&hf_netlogon_trust_attribs_treat_as_external,\r\n&hf_netlogon_trust_attribs_within_forest,\r\n&hf_netlogon_trust_attribs_cross_organization,\r\n&hf_netlogon_trust_attribs_forest_transitive,\r\n&hf_netlogon_trust_attribs_quarantined_domain,\r\n&hf_netlogon_trust_attribs_uplevel_only,\r\n&hf_netlogon_trust_attribs_non_transitive,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep,\r\n-1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_trust_attribs, ett_trust_attribs, attr, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_GET_DCNAME_REQUEST_FLAGS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nstatic const int * flags[] = {\r\n&hf_netlogon_get_dcname_request_flags_return_flat_name,\r\n&hf_netlogon_get_dcname_request_flags_return_dns_name,\r\n&hf_netlogon_get_dcname_request_flags_is_flat_name,\r\n&hf_netlogon_get_dcname_request_flags_is_dns_name,\r\n&hf_netlogon_get_dcname_request_flags_only_ldap_needed,\r\n&hf_netlogon_get_dcname_request_flags_avoid_self,\r\n&hf_netlogon_get_dcname_request_flags_good_timeserv_preferred,\r\n&hf_netlogon_get_dcname_request_flags_writable_required,\r\n&hf_netlogon_get_dcname_request_flags_timeserv_required,\r\n&hf_netlogon_get_dcname_request_flags_kdc_required,\r\n&hf_netlogon_get_dcname_request_flags_ip_required,\r\n&hf_netlogon_get_dcname_request_flags_background_only,\r\n&hf_netlogon_get_dcname_request_flags_pdc_required,\r\n&hf_netlogon_get_dcname_request_flags_gc_server_required,\r\n&hf_netlogon_get_dcname_request_flags_directory_service_preferred,\r\n&hf_netlogon_get_dcname_request_flags_directory_service_required,\r\n&hf_netlogon_get_dcname_request_flags_force_rediscovery,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep, -1, &mask);\r\nproto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_get_dcname_request_flags, ett_get_dcname_request_flags, flags, mask, BMT_NO_APPEND);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DC_FLAGS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 mask;\r\nproto_item *item;\r\nstatic const int * flags[] = {\r\n&hf_netlogon_dc_flags_dns_forest_flag,\r\n&hf_netlogon_dc_flags_dns_domain_flag,\r\n&hf_netlogon_dc_flags_dns_controller_flag,\r\n&hf_netlogon_dc_flags_ndnc_flag,\r\n&hf_netlogon_dc_flags_good_timeserv_flag,\r\n&hf_netlogon_dc_flags_writable_flag,\r\n&hf_netlogon_dc_flags_closest_flag,\r\n&hf_netlogon_dc_flags_timeserv_flag,\r\n&hf_netlogon_dc_flags_kdc_flag,\r\n&hf_netlogon_dc_flags_ds_flag,\r\n&hf_netlogon_dc_flags_ldap_flag,\r\n&hf_netlogon_dc_flags_gc_flag,\r\n&hf_netlogon_dc_flags_pdc_flag,\r\nNULL\r\n};\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset=dissect_ndr_uint32(tvb, offset, pinfo, NULL, di, drep, -1, &mask);\r\nitem = proto_tree_add_bitmask_value_with_flags(parent_tree, tvb, offset-4, hf_netlogon_dc_flags, ett_dc_flags, flags, mask, BMT_NO_APPEND);\r\nif (mask==0x0000ffff)\r\nproto_item_append_text(item, " PING (mask==0x0000ffff)");\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_pointer_long(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32 (tvb, offset, pinfo, tree, di, drep,\r\ndi->hf_index, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_UNICODE_MULTI_byte(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_UNICODE_MULTI_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UNICODE_MULTI_byte);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_UNICODE_MULTI(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_UNICODE_MULTI, &item, "UNICODE_MULTI:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_len, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UNICODE_MULTI_array, NDR_POINTER_UNIQUE,\r\n"unknown", hf_netlogon_unknown_string);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_CONTROLLER_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DOMAIN_CONTROLLER_INFO, &item, "DOMAIN_CONTROLLER_INFO:");\r\n}\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "DC Name", hf_netlogon_dc_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "DC Address", hf_netlogon_dc_address, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dc_address_type, NULL);\r\noffset = dissect_nt_GUID(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Logon Domain", hf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "DNS Forest", hf_netlogon_dns_forest_name, 0);\r\noffset = netlogon_dissect_DC_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "DC Site", hf_netlogon_dc_site_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Client Site",\r\nhf_netlogon_client_site_name, 0);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_ndr_trust_extension(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 len,max;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_max, &max);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_offset, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_len, &len);\r\nif( max * 2 == 16 ) {\r\noffset = netlogon_dissect_DOMAIN_TRUST_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_parent_index, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_type, NULL);\r\noffset = netlogon_dissect_DOMAIN_TRUST_ATTRIBS(tvb, offset, pinfo, tree, di, drep);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_BLOB_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 len;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_blob_size, &len);\r\nproto_tree_add_item(tree, hf_netlogon_blob, tvb, offset, len,\r\nENC_NA);\r\noffset += len;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_ndr_ulongs_as_counted_string(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep, int hf_index)\r\n{\r\nguint16 len, size;\r\ngboolean add_subtree = TRUE;\r\nproto_item *item;\r\nproto_tree *subtree = tree;\r\nif (add_subtree) {\r\nsubtree = proto_tree_add_subtree(\r\ntree, tvb, offset, 0, ett_nt_counted_longs_as_string, &item,\r\nproto_registrar_get_name(hf_index));\r\n}\r\nALIGN_TO_4_BYTES;\r\nif (di->conformant_run)\r\nreturn offset;\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, subtree, di, drep,\r\nhf_nt_cs_len, &len);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, subtree, di, drep,\r\nhf_nt_cs_size, &size);\r\noffset = dissect_ndr_pointer_cb(tvb, offset, pinfo, subtree, di, drep,\r\ndissect_ndr_trust_extension, NDR_POINTER_UNIQUE,\r\n"Buffer", hf_index,NULL,NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nDomainInfo_sid_(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = lsarpc_dissect_struct_dom_sid2(tvb, offset, pinfo, tree, di, drep, DomainInfo_sid, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_element_lsa_DnsDomainInfo_sid(tvbuff_t *tvb , int offset , packet_info *pinfo , proto_tree *tree , dcerpc_info *di, guint8 *drep )\r\n{\r\noffset = dissect_ndr_embedded_pointer(tvb, offset, pinfo, tree, di, drep, DomainInfo_sid_, NDR_POINTER_UNIQUE, "Pointer to Sid (dom_sid2)",DnsDomainInfo_sid);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_element_lsa_DnsDomainInfo_domain_guid(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep )\r\n{\r\noffset = dissect_ndr_uuid_t(tvb, offset, pinfo, tree, di, drep, DnsDomainInfo_domain_guid, NULL);\r\nreturn offset;\r\n}\r\nstatic int dissect_part_DnsDomainInfo(tvbuff_t *tvb , int offset, packet_info *pinfo, proto_tree *tree , dcerpc_info *di, guint8 *drep, int hf_index _U_, guint32 param _U_)\r\n{\r\noffset = lsarpc_dissect_struct_lsa_StringLarge(tvb, offset, pinfo, tree, di, drep, DnsDomainInfo_name, 0);\r\noffset = lsarpc_dissect_struct_lsa_StringLarge(tvb,offset, pinfo, tree, di, drep, DnsDomainInfo_dns_domain, 0);\r\noffset = lsarpc_dissect_struct_lsa_StringLarge(tvb,offset, pinfo, tree, di, drep, DnsDomainInfo_dns_forest, 0);\r\noffset = dissect_element_lsa_DnsDomainInfo_domain_guid(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_element_lsa_DnsDomainInfo_sid(tvb, offset, pinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_ONE_DOMAIN_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DOMAIN_TRUST_INFO, &item, "ONE_DOMAIN_INFO");\r\n}\r\noffset = dissect_part_DnsDomainInfo(tvb, offset, pinfo, tree, di, drep, 0, 0);\r\noffset = dissect_ndr_ulongs_as_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_extention);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string2, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string3, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string4, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy1_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy2_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy3_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy4_long, NULL);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_TRUST_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_ONE_DOMAIN_INFO);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_LSA_POLICY_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep )\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *subtree=NULL;\r\nguint32 len;\r\nif(di->conformant_run){\r\nreturn offset;\r\n}\r\nif(tree){\r\nsubtree = proto_tree_add_subtree(tree, tvb, offset, 0,\r\nett_LSA_POLICY_INFO, &item, "LSA Policy");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, subtree, di, drep,\r\nhf_netlogon_lsapolicy_len, &len);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, subtree, di, drep,\r\nnetlogon_dissect_BLOB_array, NDR_POINTER_UNIQUE,\r\n"Pointer:", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_WORKSTATION_INFO(tvbuff_t *tvb , int offset ,\r\npacket_info *pinfo , proto_tree *tree ,\r\ndcerpc_info *di, guint8 *drep )\r\n{\r\noffset = netlogon_dissect_LSA_POLICY_INFO(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Workstation FQDN",\r\nhf_netlogon_workstation_fqdn, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Workstation Site",\r\nhf_netlogon_workstation_site_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Dummy 1", hf_netlogon_dummy_string, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Dummy 2", hf_netlogon_dummy_string2, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Dummy 3", hf_netlogon_dummy_string3, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Dummy 4", hf_netlogon_dummy_string4, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_os_version, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_workstation_os, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string3, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string4, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_workstation_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy2_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy3_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy4_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_WORKSTATION_INFORMATION(tvbuff_t *tvb , int offset ,\r\npacket_info *pinfo , proto_tree *tree ,\r\ndcerpc_info *di, guint8 *drep ) {\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_WORKSTATION_INFO, NDR_POINTER_UNIQUE,\r\n"WORKSTATION INFO", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_INFO(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_ONE_DOMAIN_INFO(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_num_trusts, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_TRUST_INFO, NDR_POINTER_UNIQUE,\r\n"DOMAIN_TRUST_ARRAY: Trusted domains", -1);\r\noffset = netlogon_dissect_LSA_POLICY_INFO(tvb,offset,pinfo, tree,di,drep);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_ad_client_dns_name, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string2, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string3, 0);\r\noffset = dissect_ndr_counted_string(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy_string4, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_workstation_flags, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_supportedenctypes, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy3_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dummy4_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DOMAIN_INFORMATION(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 level = 0;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_INFO, NDR_POINTER_UNIQUE,\r\n"DOMAIN_INFO", -1);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_UNICODE_STRING_512(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nint i;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_UNICODE_STRING_512, &item, "UNICODE_STRING_512:");\r\n}\r\nfor(i=0;i<512;i++){\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_short, NULL);\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_844_byte(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_844_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_844_byte);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_TYPE_50(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_TYPE_50, &item, "TYPE_50:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_844_array, NDR_POINTER_UNIQUE,\r\n"unknown", hf_netlogon_unknown_string);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_TYPE_50_ptr(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_TYPE_50, NDR_POINTER_UNIQUE,\r\n"TYPE_50 pointer: unknown_TYPE_50", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DS_DOMAIN_TRUSTS(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 tmp;\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_DS_DOMAIN_TRUSTS, NULL, "DS_DOMAIN_TRUSTS");\r\n}\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "NetBIOS Name",\r\nhf_netlogon_downlevel_domain_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "DNS Domain Name",\r\nhf_netlogon_dns_domain_name, 0);\r\noffset = netlogon_dissect_DOMAIN_TRUST_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_parent_index, &tmp);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_trust_type, &tmp);\r\noffset = netlogon_dissect_DOMAIN_TRUST_ATTRIBS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ndr_nt_PSID(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_nt_GUID(tvb, offset, pinfo, tree, di, drep);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_DS_DOMAIN_TRUSTS_ARRAY(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DS_DOMAIN_TRUSTS);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_865_byte(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_865_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_865_byte);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_866_byte(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_element_866_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_866_byte);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_TYPE_52(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_TYPE_52, &item, "TYPE_52:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_865_array, NDR_POINTER_UNIQUE,\r\n"unknown", hf_netlogon_unknown_string);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_element_866_array, NDR_POINTER_UNIQUE,\r\n"unknown", hf_netlogon_unknown_string);\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_TYPE_52_ptr(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_TYPE_52, NDR_POINTER_UNIQUE,\r\n"TYPE_52 pointer: unknown_TYPE_52", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_TYPE_44(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *parent_tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nproto_item *item=NULL;\r\nproto_tree *tree=NULL;\r\nint old_offset=offset;\r\nguint32 level = 0;\r\nif(parent_tree){\r\ntree = proto_tree_add_subtree(parent_tree, tvb, offset, 0,\r\nett_TYPE_44, &item, "TYPE_44:");\r\n}\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, &level);\r\nALIGN_TO_4_BYTES;\r\nswitch(level){\r\ncase 1:\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nbreak;\r\n}\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_WORKSTATION_BUFFER(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 level;\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level, &level);\r\nif (level == 2) {\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_WORKSTATION_INFORMATION, NDR_POINTER_UNIQUE,\r\n"LSA POLICY INFO", -1);\r\n}\r\nelse {\r\nif (level == 1) {\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_WORKSTATION_INFORMATION, NDR_POINTER_UNIQUE,\r\n"WORKSTATION INFORMATION", -1);}\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrenumeratetrusteddomains_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrenumeratetrusteddomains_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_UNICODE_MULTI, NDR_POINTER_REF,\r\n"UNICODE_MULTI pointer: trust_dom_name_list", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcname_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"GUID pointer: domain_guid", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"GUID pointer: site_guid", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_flags, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcname_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_CONTROLLER_INFO, NDR_POINTER_UNIQUE,\r\n"DOMAIN_CONTROLLER_INFO:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogondummyroutine1_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogondummyroutine1_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_TYPE_44, NDR_POINTER_UNIQUE,\r\n"TYPE_44 pointer: unknown_TYPE_44", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsetservicebits_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsetservicebits_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongettrustrid_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongettrustrid_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_pointer_long, NDR_POINTER_UNIQUE,\r\n"ULONG pointer: unknown_ULONG", hf_netlogon_unknown_long);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncomputeserverdigest_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_BYTE_16_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nint i;\r\nfor(i=0;i<16;i++){\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_char, NULL);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncomputeserverdigest_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_16_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncomputeclientdigest_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogoncomputeclientdigest_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_16_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int netlogon_dissect_neg_options(tvbuff_t *tvb,proto_tree *tree,guint32 flags,int offset)\r\n{\r\nstatic const int * hf_flags[] = {\r\n#if 0\r\n&hf_netlogon_neg_flags_80000000,\r\n#endif\r\n&hf_netlogon_neg_flags_40000000,\r\n&hf_netlogon_neg_flags_20000000,\r\n#if 0\r\n&hf_netlogon_neg_flags_10000000,\r\n&hf_netlogon_neg_flags_8000000,\r\n&hf_netlogon_neg_flags_4000000,\r\n&hf_netlogon_neg_flags_2000000,\r\n&hf_netlogon_neg_flags_800000,\r\n#endif\r\n&hf_netlogon_neg_flags_1000000,\r\n&hf_netlogon_neg_flags_400000,\r\n&hf_netlogon_neg_flags_200000,\r\n&hf_netlogon_neg_flags_100000,\r\n&hf_netlogon_neg_flags_80000,\r\n&hf_netlogon_neg_flags_40000,\r\n&hf_netlogon_neg_flags_20000,\r\n&hf_netlogon_neg_flags_10000,\r\n&hf_netlogon_neg_flags_8000,\r\n&hf_netlogon_neg_flags_4000,\r\n&hf_netlogon_neg_flags_2000,\r\n&hf_netlogon_neg_flags_1000,\r\n&hf_netlogon_neg_flags_800,\r\n&hf_netlogon_neg_flags_400,\r\n&hf_netlogon_neg_flags_200,\r\n&hf_netlogon_neg_flags_100,\r\n&hf_netlogon_neg_flags_80,\r\n&hf_netlogon_neg_flags_40,\r\n&hf_netlogon_neg_flags_20,\r\n&hf_netlogon_neg_flags_10,\r\n&hf_netlogon_neg_flags_8,\r\n&hf_netlogon_neg_flags_4,\r\n&hf_netlogon_neg_flags_2,\r\n&hf_netlogon_neg_flags_1,\r\nNULL\r\n};\r\nproto_tree_add_bitmask_value_with_flags(tree, tvb, offset, hf_netlogon_neg_flags, ett_authenticate_flags, hf_flags, flags, BMT_NO_APPEND);\r\nreturn 0;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate3_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 flags;\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Acct Name", hf_netlogon_acct_name, 0);\r\noffset = netlogon_dissect_NETLOGON_SECURE_CHANNEL_TYPE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Computer Name", hf_netlogon_computer_name, 0);\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, tree, drep,\r\nhf_client_credential, NULL);\r\n#if 0\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_CREDENTIAL, NDR_POINTER_REF,\r\n"Client Challenge", -1);\r\n#endif\r\n#if 0\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_neg_flags, NULL);\r\n#endif\r\nALIGN_TO_4_BYTES;\r\nflags = tvb_get_letohl (tvb, offset);\r\nnetlogon_dissect_neg_options(tvb,tree,flags,offset);\r\nseen.isseen = FALSE;\r\nseen.num = 0;\r\noffset +=4;\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nreturn netlogon_dissect_netrserverauthenticate3_rqst(tvb,offset,pinfo,tree,di,drep);\r\n}\r\nstatic void str_to_unicode(const char *nt_password, char *nt_password_unicode)\r\n{\r\nsize_t password_len = 0;\r\nsize_t i;\r\npassword_len = strlen(nt_password);\r\nif(nt_password_unicode != NULL)\r\n{\r\nfor(i=0;i<(password_len);i++)\r\n{\r\nnt_password_unicode[i*2]=nt_password[i];\r\nnt_password_unicode[i*2+1]=0;\r\n}\r\nnt_password_unicode[2*password_len]='\0';\r\n}\r\n}\r\nstatic guint32 get_keytab_as_list(md4_pass **p_pass_list, const char* ntlm_pass)\r\n{\r\nenc_key_t *ek;\r\nmd4_pass* pass_list;\r\nmd4_pass ntlm_pass_hash;\r\nint i = 0;\r\nguint32 nb_pass = 0;\r\nchar ntlm_pass_unicode[258];\r\nint add_ntlm = 0;\r\nint password_len;\r\nif(!krb_decrypt){\r\n*p_pass_list=NULL;\r\nreturn 0;\r\n}\r\nread_keytab_file_from_preferences();\r\nmemset(ntlm_pass_hash.md4,0,sizeof(md4_pass));\r\nfor(ek=enc_key_list;ek;ek=ek->next){\r\nif( ek->keylength == 16 ) {\r\nnb_pass++;\r\n}\r\n}\r\nif (ntlm_pass[0] != '\0' && ( strlen(ntlm_pass) < 129 )) {\r\nnb_pass++;\r\ndebugprintf("Password: %s\n",ntlm_pass);\r\npassword_len = (int)strlen(ntlm_pass);\r\nstr_to_unicode(ntlm_pass,ntlm_pass_unicode);\r\ncrypt_md4(ntlm_pass_hash.md4,ntlm_pass_unicode,password_len*2);\r\nprintnbyte(ntlm_pass_hash.md4,16,"Hash of the NT pass: ","\n");\r\nadd_ntlm = 1;\r\n}\r\n*p_pass_list = (md4_pass *)wmem_alloc(wmem_packet_scope(), nb_pass*sizeof(md4_pass));\r\npass_list=*p_pass_list;\r\nif(add_ntlm) {\r\nmemcpy(pass_list[0].md4,&(ntlm_pass_hash.md4),sizeof(md4_pass));\r\ni++;\r\n}\r\nfor(ek=enc_key_list;ek;ek=ek->next){\r\nif( ek->keylength == 16 ) {\r\nmemcpy(pass_list[i].md4,ek->keyvalue,16);\r\ni++;\r\n}\r\n}\r\nreturn nb_pass;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate23_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep, int version3)\r\n{\r\nguint32 flags;\r\nnetlogon_auth_vars *vars;\r\nnetlogon_auth_key key;\r\nguint64 server_cred;\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, tree, drep,\r\nhf_server_credential, &server_cred);\r\nflags = tvb_get_letohl (tvb, offset);\r\nnetlogon_dissect_neg_options(tvb,tree,flags,offset);\r\noffset +=4;\r\nALIGN_TO_4_BYTES;\r\nif(version3) {\r\noffset = dissect_dcerpc_uint32(tvb, offset, pinfo, tree, drep,\r\nhf_server_rid, NULL);\r\n}\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\ngenerate_hash_key(pinfo, 1 , &key, NULL);\r\nvars = (netlogon_auth_vars *)g_hash_table_lookup(netlogon_auths, &key);\r\nif(vars != NULL) {\r\ndebugprintf("Found some vars (ie. server/client challenges), let's see if I can get a session key\n");\r\nwhile(vars != NULL && vars->next_start != -1 && vars->next_start < (int) pinfo->num ) {\r\ndebugprintf("looping auth reply...\n");\r\nvars = vars->next;\r\n}\r\nif(vars == NULL ) {\r\ndebugprintf("Something strange happened while searching for authenticate_reply\n");\r\n}\r\nelse {\r\n#ifdef HAVE_KERBEROS\r\nmd4_pass *pass_list=NULL;\r\nguint32 list_size = 0;\r\nunsigned int i = 0;\r\nmd4_pass password;\r\n#endif\r\nguint8 session_key[16];\r\nint found = 0;\r\nvars->flags = flags;\r\nvars->can_decrypt = FALSE;\r\n#ifdef HAVE_KERBEROS\r\nlist_size = get_keytab_as_list(&pass_list,gbl_nt_password);\r\ndebugprintf("Found %d passwords \n",list_size);\r\n#endif\r\nif( flags & NETLOGON_FLAG_STRONGKEY ) {\r\n#ifdef HAVE_KERBEROS\r\nguint8 zeros[4];\r\nguint8 md5[16];\r\nmd5_state_t md5state;\r\nguint8 buf[8];\r\nguint64 calculated_cred;\r\nmemset(zeros,0,4);\r\nmd5_init(&md5state);\r\nmd5_append(&md5state,zeros,4);\r\nmd5_append(&md5state,(unsigned char*)&vars->client_challenge,8);\r\nmd5_append(&md5state,(unsigned char*)&vars->server_challenge,8);\r\nmd5_finish(&md5state,md5);\r\nprintnbyte(md5,8,"MD5:","\n");\r\nprintnbyte((guint8*)&vars->client_challenge,8,"Client challenge:","\n");\r\nprintnbyte((guint8*)&vars->server_challenge,8,"Server challenge:","\n");\r\nprintnbyte((guint8*)&server_cred,8,"Server creds:","\n");\r\nfor(i=0;i<list_size;i++)\r\n{\r\npassword = pass_list[i];\r\nmd5_hmac(md5,16,(guint8*) &password,16,session_key);\r\ncrypt_des_ecb(buf,(unsigned char*)&vars->server_challenge,session_key,1);\r\ncrypt_des_ecb((unsigned char*)&calculated_cred,buf,session_key+7,1);\r\n#if 0\r\nprintnbyte((guint8*)&calculated_cred,8,"Calculated creds:","\n");\r\n#endif\r\nif(calculated_cred==server_cred) {\r\nfound = 1;\r\nbreak;\r\n}\r\n}\r\n#endif\r\n}\r\nelse if( flags&NETLOGON_FLAG_USEAES)\r\n{\r\ndebugprintf("AES not supported yet\n");\r\nmemset(session_key,0,16);\r\n}\r\nelse\r\n{\r\ndebugprintf("Else case not implemented\n");\r\nmemset(session_key,0,16);\r\n}\r\nif(found) {\r\nmemcpy(&vars->session_key,session_key,16);\r\ndebugprintf("Found the good session key !\n");\r\n}\r\nelse {\r\ndebugprintf("Session key not found !\n");\r\nmemset(&vars->session_key,0,16);\r\n}\r\n}\r\n} else {\r\nprintnbyte((guint8*)&vars->session_key, 16, "Session key:","\n");\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate3_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nreturn netlogon_dissect_netrserverauthenticate23_reply(tvb,offset,pinfo,tree,di,drep,1);\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverauthenticate2_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nreturn netlogon_dissect_netrserverauthenticate23_reply(tvb,offset,pinfo,tree,di,drep,0);\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcnameex_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"GUID pointer: domain_guid", -1);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Site Name", hf_netlogon_site_name, 0);\r\noffset = netlogon_dissect_GET_DCNAME_REQUEST_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcnameex_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_CONTROLLER_INFO, NDR_POINTER_UNIQUE,\r\n"DOMAIN_CONTROLLER_INFO:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetsitename_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetsitename_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer_cb(tvb, offset, pinfo, tree, di, drep,\r\ndissect_ndr_wchar_cvstring, NDR_POINTER_UNIQUE, "Site Name",\r\nhf_netlogon_site_name, cb_wstr_postprocess,\r\nGINT_TO_POINTER(CB_STR_COL_INFO | 1));\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongetdomaininfo_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "Server Handle", hf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: client", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_WORKSTATION_BUFFER, NDR_POINTER_REF,\r\n"WORKSTATION_BUFFER", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongetdomaininfo_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_INFORMATION, NDR_POINTER_REF,\r\n"DOMAIN_INFORMATION", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordset2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_short, NULL);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = netlogon_dissect_UNICODE_STRING_512(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordset2_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordget_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Acct Name", hf_netlogon_acct_name, 0);\r\noffset = netlogon_dissect_NETLOGON_SECURE_CHANNEL_TYPE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrserverpasswordget_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LM_OWF_PASSWORD, NDR_POINTER_REF,\r\n"LM_OWF_PASSWORD pointer: server_pwd", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsendtosam_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_REF,\r\n"AUTHENTICATOR: credential", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsendtosam_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_AUTHENTICATOR, NDR_POINTER_UNIQUE,\r\n"AUTHENTICATOR: return_authenticator", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsraddresstositenamesw_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsraddresstositenamesw_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_TYPE_50_ptr, NDR_POINTER_UNIQUE,\r\n"TYPE_50** pointer: unknown_TYPE_50", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcnameex2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Client Account",\r\nhf_netlogon_acct_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Client Account",\r\nhf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"Domain GUID:", -1);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Client Site",\r\nhf_netlogon_site_name, 0);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcnameex2_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DOMAIN_CONTROLLER_INFO, NDR_POINTER_UNIQUE,\r\n"DOMAIN_CONTROLLER_INFO:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongettimeserviceparentdomain_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogongettimeserviceparentdomain_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_pointer_long, NDR_POINTER_UNIQUE,\r\n"ULONG pointer: unknown_ULONG", hf_netlogon_unknown_long);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrenumeratetrusteddomainsex_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrenumeratetrusteddomainsex_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_entries, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DS_DOMAIN_TRUSTS_ARRAY, NDR_POINTER_UNIQUE,\r\n"DS_DOMAIN_TRUSTS_ARRAY:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsraddresstositenamesexw_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_long, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_BYTE_array, NDR_POINTER_UNIQUE,\r\n"BYTE pointer: unknown_BYTE", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsraddresstositenamesexw_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_TYPE_52_ptr, NDR_POINTER_UNIQUE,\r\n"TYPE_52 pointer: unknown_TYPE_52", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_site_name_item(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_counted_string_cb(\r\ntvb, offset, pinfo, tree, di, drep, hf_netlogon_site_name,\r\ncb_wstr_postprocess,\r\nGINT_TO_POINTER(CB_STR_COL_INFO | 1));\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_site_name_array(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_ucarray(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_site_name_item);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_site_names(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_count, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_site_name_array, NDR_POINTER_UNIQUE,\r\n"Site name array", -1);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcsitecoveragew_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrgetdcsitecoveragew_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_site_names, NDR_POINTER_UNIQUE,\r\n"Site names", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogonex_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "LogonServer",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Computer Name",\r\nhf_netlogon_computer_name, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_level16, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LEVEL, NDR_POINTER_REF,\r\n"LEVEL: LogonLevel", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_validation_level, NULL);\r\noffset = netlogon_dissect_EXTRA_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\n#if 0\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "unknown string",\r\nhf_netlogon_unknown_string, 0);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_short, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_LEVEL, NDR_POINTER_UNIQUE,\r\n"LEVEL pointer: unknown_NETLOGON_LEVEL", -1);\r\noffset = dissect_ndr_uint16(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_unknown_short, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_pointer_long, NDR_POINTER_UNIQUE,\r\n"ULONG pointer: unknown_ULONG", hf_netlogon_unknown_long);\r\n#endif\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_netrlogonsamlogonex_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION, NDR_POINTER_REF,\r\n"VALIDATION:", -1);\r\noffset = dissect_ndr_uint8(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_authoritative, NULL);\r\noffset = netlogon_dissect_EXTRA_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\n#if 0\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_VALIDATION, NDR_POINTER_UNIQUE,\r\n"VALIDATION: unknown_NETLOGON_VALIDATION", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_pointer_char, NDR_POINTER_UNIQUE,\r\n"BOOLEAN pointer: unknown_BOOLEAN", hf_netlogon_unknown_char);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_pointer_long, NDR_POINTER_UNIQUE,\r\n"ULONG pointer: unknown_ULONG", hf_netlogon_unknown_long);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\n#endif\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrenumeratedomaintrusts_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = netlogon_dissect_DOMAIN_TRUST_FLAGS(tvb, offset, pinfo, tree, di, drep);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrenumeratedomaintrusts_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_entries, NULL);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\nnetlogon_dissect_DS_DOMAIN_TRUSTS_ARRAY, NDR_POINTER_UNIQUE,\r\n"DS_DOMAIN_TRUSTS_ARRAY:", -1);\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_dos_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrderegisterdnshostrecords_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = netlogon_dissect_LOGONSRV_HANDLE(tvb, offset,\r\npinfo, tree, di, drep);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_UNIQUE, "Domain", hf_netlogon_logon_dom, 0);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"GUID pointer: domain_guid", -1);\r\noffset = dissect_ndr_pointer(tvb, offset, pinfo, tree, di, drep,\r\ndissect_nt_GUID, NDR_POINTER_UNIQUE,\r\n"GUID pointer: dsa_guid", -1);\r\noffset = dissect_ndr_str_pointer_item(tvb, offset, pinfo, tree, di, drep,\r\nNDR_POINTER_REF, "dns_host", hf_netlogon_dns_host, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\nnetlogon_dissect_dsrderegisterdnshostrecords_reply(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_ntstatus(tvb, offset, pinfo, tree, di, drep,\r\nhf_netlogon_rc, NULL);\r\nreturn offset;\r\n}\r\nstatic int dissect_secchan_nl_auth_message(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di _U_, guint8 *drep)\r\n{\r\nproto_item *item = NULL;\r\nproto_tree *subtree = NULL;\r\nguint32 messagetype;\r\nguint64 messageflags;\r\nstatic const int *flag_fields[] = {\r\n&hf_netlogon_secchan_nl_message_flags_nb_domain,\r\n&hf_netlogon_secchan_nl_message_flags_nb_host,\r\n&hf_netlogon_secchan_nl_message_flags_dns_domain,\r\n&hf_netlogon_secchan_nl_message_flags_dns_host,\r\n&hf_netlogon_secchan_nl_message_flags_nb_host_utf8,\r\nNULL\r\n};\r\nint len;\r\nif (tree) {\r\nsubtree = proto_tree_add_subtree(\r\ntree, tvb, offset, -1, ett_secchan_nl_auth_message, &item,\r\n"Secure Channel NL_AUTH_MESSAGE");\r\n}\r\noffset = dissect_dcerpc_uint32(\r\ntvb, offset, pinfo, subtree, drep,\r\nhf_netlogon_secchan_nl_message_type, &messagetype);\r\nproto_tree_add_bitmask_ret_uint64(subtree, tvb, offset,\r\nhf_netlogon_secchan_nl_message_flags,\r\nett_secchan_nl_auth_message_flags,\r\nflag_fields,\r\n(drep[0] & DREP_LITTLE_ENDIAN) ?\r\nENC_LITTLE_ENDIAN :\r\nENC_BIG_ENDIAN,\r\n&messageflags);\r\noffset += 4;\r\nif (messageflags&0x00000001) {\r\nlen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(subtree, hf_netlogon_secchan_nl_nb_domain, tvb, offset, len, ENC_ASCII|ENC_NA);\r\noffset += len;\r\n}\r\nif (messageflags&0x00000002) {\r\nlen = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(subtree, hf_netlogon_secchan_nl_nb_host, tvb, offset, len, ENC_ASCII|ENC_NA);\r\noffset += len;\r\n}\r\nif (messageflags&0x00000004) {\r\nint old_offset=offset;\r\nchar str[256];\r\noffset=dissect_mscldap_string(tvb, offset, str, 255, FALSE);\r\nproto_tree_add_string(subtree, hf_netlogon_secchan_nl_dns_domain, tvb, old_offset, offset-old_offset, str);\r\n}\r\nif (messageflags&0x00000008) {\r\nint old_offset=offset;\r\nchar str[256];\r\noffset=dissect_mscldap_string(tvb, offset, str, 255, FALSE);\r\nproto_tree_add_string(subtree, hf_netlogon_secchan_nl_dns_host, tvb, old_offset, offset-old_offset, str);\r\n}\r\nif (messageflags&0x00000010) {\r\nint old_offset=offset;\r\nchar str[256];\r\noffset=dissect_mscldap_string(tvb, offset, str, 255, FALSE);\r\nproto_tree_add_string(subtree, hf_netlogon_secchan_nl_nb_host_utf8, tvb, old_offset, offset-old_offset, str);\r\n}\r\nreturn offset;\r\n}\r\nstatic int get_seal_key(const guint8 *session_key,int key_len,guint64 sequence,guint8* seal_key)\r\n{\r\nguint8 zeros[4];\r\nguint8 *buf = (guint8 *)wmem_alloc(wmem_packet_scope(), key_len);\r\nguint8 buf2[16];\r\nguint8 zero_sk[16];\r\nint i = 0;\r\nmemset(zero_sk,0,16);\r\nmemset(seal_key,0,16);\r\nif(memcmp(session_key,zero_sk,16)) {\r\nmemset(zeros,0,4);\r\nfor(i=0;i<key_len;i++) {\r\nbuf[i] = session_key[i] ^ 0xF0;\r\n}\r\nmd5_hmac(zeros,4,buf,key_len,buf2);\r\nmd5_hmac((guint8*)&sequence,8,buf2,16,seal_key);\r\nreturn 1;\r\n}\r\nelse {\r\nreturn 0;\r\n}\r\n}\r\nstatic guint64 uncrypt_sequence(guint8* session_key,guint64 checksum,guint64 enc_seq,unsigned char is_server _U_)\r\n{\r\nguint8 zeros[4];\r\nguint8 buf[16];\r\nguint8 key[16];\r\nrc4_state_struct rc4state;\r\nguint8 *p_seq = (guint8*) &enc_seq;\r\nmemset(zeros,0,4);\r\nmd5_hmac(zeros,4,session_key,16,buf);\r\nmd5_hmac((guint8*)&checksum,8,buf,16,key);\r\ncrypt_rc4_init(&rc4state,key,16);\r\ncrypt_rc4(&rc4state,p_seq,8);\r\nreturn enc_seq;\r\n}\r\nstatic tvbuff_t *\r\ndissect_packet_data(tvbuff_t *tvb ,tvbuff_t *auth_tvb _U_,\r\nint offset , packet_info *pinfo ,dcerpc_auth_info *auth_info _U_,unsigned char is_server)\r\n{\r\ntvbuff_t *buf = NULL;\r\nguint8* decrypted;\r\nnetlogon_auth_vars *vars;\r\nnetlogon_auth_key key;\r\ngenerate_hash_key(pinfo,is_server,&key,NULL);\r\nvars = (netlogon_auth_vars *)g_hash_table_lookup(netlogon_auths, &key);\r\nif(vars != NULL ) {\r\nwhile(vars != NULL && vars->next_start != -1 && vars->next_start < (int) pinfo->num ) {\r\nvars = vars->next;\r\n}\r\nif(vars == NULL ) {\r\ndebugprintf("Vars not found %d (packet_data)\n",g_hash_table_size(netlogon_auths));\r\nreturn(buf);\r\n}\r\nelse {\r\nif(vars->can_decrypt == TRUE) {\r\nrc4_state_struct rc4state;\r\nint data_len;\r\nguint64 copyconfounder = vars->confounder;\r\ndata_len = tvb_captured_length_remaining(tvb,offset);\r\nif (data_len < 0) {\r\nreturn NULL;\r\n}\r\ncrypt_rc4_init(&rc4state,vars->encryption_key,16);\r\ncrypt_rc4(&rc4state,(guint8*)&copyconfounder,8);\r\ndecrypted = (guint8*)tvb_memdup(pinfo->pool, tvb, offset,data_len);\r\ncrypt_rc4_init(&rc4state,vars->encryption_key,16);\r\ncrypt_rc4(&rc4state,decrypted,data_len);\r\nbuf = tvb_new_child_real_data(tvb, decrypted, data_len, data_len);\r\n}\r\nelse {\r\ndebugprintf("Session key not found can't decrypt ...\n");\r\n}\r\n}\r\n} else {\r\ndebugprintf("Vars not found %d (packet_data)\n",g_hash_table_size(netlogon_auths));\r\nreturn(buf);\r\n}\r\nreturn(buf);\r\n}\r\nstatic tvbuff_t* dissect_request_data( tvbuff_t *tvb ,tvbuff_t *auth_tvb ,\r\nint offset , packet_info *pinfo ,dcerpc_auth_info *auth_info )\r\n{\r\nreturn dissect_packet_data(tvb,auth_tvb,offset,pinfo,auth_info,0);\r\n}\r\nstatic tvbuff_t* dissect_response_data( tvbuff_t *tvb ,tvbuff_t *auth_tvb ,\r\nint offset , packet_info *pinfo ,dcerpc_auth_info *auth_info )\r\n{\r\nreturn dissect_packet_data(tvb,auth_tvb,offset,pinfo,auth_info,1);\r\n}\r\nstatic int\r\ndissect_secchan_verf(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, guint8 *drep, unsigned char is_server)\r\n{\r\nnetlogon_auth_vars *vars;\r\nnetlogon_auth_key key;\r\nproto_item *vf = NULL;\r\nproto_tree *subtree = NULL;\r\nguint64 encrypted_seq;\r\nguint64 digest;\r\nguint64 confounder = 0;\r\nint update_vars = 0;\r\ngenerate_hash_key(pinfo,is_server,&key,NULL);\r\nvars = (netlogon_auth_vars *)g_hash_table_lookup(netlogon_auths,(gconstpointer*) &key);\r\nif( ! (seen.isseen && seen.num == pinfo->num) ) {\r\nvf = proto_tree_add_item(tree, hf_netlogon_secchan_verf, tvb,\r\noffset, -1, ENC_NA);\r\nsubtree = proto_item_add_subtree(vf, ett_secchan_verf);\r\nproto_tree_add_item(subtree, hf_netlogon_secchan_verf_signalg, tvb,\r\noffset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(subtree, hf_netlogon_secchan_verf_sealalg, tvb,\r\noffset+2, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(subtree, hf_netlogon_secchan_verf_flag, tvb,\r\noffset+6, 2, ENC_NA);\r\noffset += 8;\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, subtree, drep,\r\nhf_netlogon_secchan_verf_seq, &encrypted_seq);\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, subtree, drep,\r\nhf_netlogon_secchan_verf_digest, &digest);\r\nif (tvb_bytes_exist(tvb, offset, 8)) {\r\noffset = dissect_dcerpc_8bytes(tvb, offset, pinfo, subtree, drep,\r\nhf_netlogon_secchan_verf_nonce, &confounder);\r\n}\r\nupdate_vars = 1;\r\n}\r\nif( vars != NULL ) {\r\nwhile(vars != NULL && vars->next_start != -1 && vars->next_start < (int)pinfo->num ) {\r\nvars = vars->next;\r\n}\r\nif(vars == NULL ) {\r\ndebugprintf("Vars not found %d (packet_data)\n",g_hash_table_size(netlogon_auths));\r\nreturn(offset);\r\n}\r\nelse {\r\nif(update_vars) {\r\nvars->confounder = confounder;\r\nvars->seq = uncrypt_sequence(vars->session_key,digest,encrypted_seq,is_server);\r\n}\r\nif(get_seal_key(vars->session_key,16,vars->seq,vars->encryption_key))\r\n{\r\nvars->can_decrypt = TRUE;\r\n}\r\nelse\r\n{\r\ndebugprintf("get seal key returned 0\n");\r\n}\r\n}\r\n}\r\nelse\r\n{\r\ndebugprintf("Vars not found (is null %d) %d (dissect_verf)\n",vars==NULL,g_hash_table_size(netlogon_auths));\r\n}\r\nseen.isseen = TRUE;\r\nseen.num = pinfo->num;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_request_secchan_verf(tvbuff_t *tvb, int offset, packet_info *pinfo ,\r\nproto_tree *tree, dcerpc_info *di _U_, guint8 *drep )\r\n{\r\nreturn dissect_secchan_verf(tvb,offset,pinfo,tree,drep,0);\r\n}\r\nstatic int\r\ndissect_response_secchan_verf(tvbuff_t *tvb, int offset, packet_info *pinfo ,\r\nproto_tree *tree, dcerpc_info *di _U_, guint8 *drep )\r\n{\r\nreturn dissect_secchan_verf(tvb,offset,pinfo,tree,drep,1);\r\n}\r\nstatic void\r\nnetlogon_reassemble_init(void)\r\n{\r\nnetlogon_auths = g_hash_table_new (netlogon_auth_hash, netlogon_auth_equal);\r\nschannel_auths = g_hash_table_new (netlogon_auth_hash, netlogon_auth_equal);\r\n}\r\nstatic void\r\nnetlogon_reassemble_cleanup(void)\r\n{\r\ng_hash_table_destroy(netlogon_auths);\r\ng_hash_table_destroy(schannel_auths);\r\n}\r\nvoid\r\nproto_register_dcerpc_netlogon(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_netlogon_opnum,\r\n{ "Operation", "netlogon.opnum", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_rc, {\r\n"Return code", "netlogon.rc", FT_UINT32, BASE_HEX | BASE_EXT_STRING,\r\n&NT_errors_ext, 0x0, "Netlogon return code", HFILL }},\r\n{ &hf_netlogon_dos_rc,\r\n{ "DOS error code", "netlogon.dos.rc", FT_UINT32,\r\nBASE_HEX | BASE_EXT_STRING, &DOS_errors_ext, 0x0, NULL, HFILL}},\r\n{ &hf_netlogon_werr_rc,\r\n{ "WERR error code", "netlogon.werr.rc", FT_UINT32,\r\nBASE_HEX | BASE_EXT_STRING, &WERR_errors_ext, 0x0, NULL, HFILL}},\r\n{ &hf_netlogon_param_ctrl, {\r\n"Param Ctrl", "netlogon.param_ctrl", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_logon_id, {\r\n"Logon ID", "netlogon.logon_id", FT_UINT64, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_modify_count, {\r\n"Modify Count", "netlogon.modify_count", FT_UINT64, BASE_DEC,\r\nNULL, 0x0, "How many times the object has been modified", HFILL }},\r\n{ &hf_netlogon_security_information, {\r\n"Security Information", "netlogon.security_information", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_count, {\r\n"Count", "netlogon.count", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_entries, {\r\n"Entries", "netlogon.entries", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_credential, {\r\n"Credential", "netlogon.credential", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "Netlogon Credential", HFILL }},\r\n{ &hf_netlogon_challenge, {\r\n"Challenge", "netlogon.challenge", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "Netlogon challenge", HFILL }},\r\n{ &hf_netlogon_lm_owf_password, {\r\n"LM Pwd", "netlogon.lm_owf_pwd", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "LanManager OWF Password", HFILL }},\r\n{ &hf_netlogon_user_session_key, {\r\n"User Session Key", "netlogon.user_session_key", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_encrypted_lm_owf_password, {\r\n"Encrypted LM Pwd", "netlogon.lm_owf_pwd.encrypted", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "Encrypted LanManager OWF Password", HFILL }},\r\n{ &hf_netlogon_nt_owf_password, {\r\n"NT Pwd", "netlogon.nt_owf_pwd", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "NT OWF Password", HFILL }},\r\n{ &hf_netlogon_blob, {\r\n"BLOB", "netlogon.blob", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_len, {\r\n"Len", "netlogon.len", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Length", HFILL }},\r\n{ &hf_netlogon_priv, {\r\n"Priv", "netlogon.priv", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_privilege_entries, {\r\n"Privilege Entries", "netlogon.privilege_entries", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_privilege_control, {\r\n"Privilege Control", "netlogon.privilege_control", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_privilege_name, {\r\n"Privilege Name", "netlogon.privilege_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_pdc_connection_status, {\r\n"PDC Connection Status", "netlogon.pdc_connection_status", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_tc_connection_status, {\r\n"TC Connection Status", "netlogon.tc_connection_status", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_attrs, {\r\n"Attributes", "netlogon.attrs", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n#if 0\r\n{ &hf_netlogon_lsapolicy_referentid,\r\n{ "Referent ID", "netlogon.lsapolicy.referentID", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n#endif\r\n{ &hf_netlogon_lsapolicy_len,\r\n{ "Length", "netlogon.lsapolicy.length", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Length of the policy buffer", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_lsapolicy_pointer,\r\n{ "Pointer", "netlogon.lsapolicy.pointer", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, "Pointer to LSA POLICY", HFILL }},\r\n#endif\r\n{ &hf_netlogon_unknown_string,\r\n{ "Unknown string", "netlogon.unknown_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Unknown string. If you know what this is, contact wireshark developers.", HFILL }},\r\n{ &hf_netlogon_TrustedDomainName_string,\r\n{ "TrustedDomainName", "netlogon.TrustedDomainName", FT_STRING, BASE_NONE,\r\nNULL, 0, "TrustedDomainName string.", HFILL }},\r\n{ &hf_netlogon_UserName_string,\r\n{ "UserName", "netlogon.UserName", FT_STRING, BASE_NONE,\r\nNULL, 0, "UserName string.", HFILL }},\r\n{ &hf_netlogon_dummy_string,\r\n{ "Dummy String", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_trust_extention,\r\n{ "Trust extension", "netlogon.trust.extention", FT_STRING, BASE_NONE,\r\nNULL, 0, "Trusts extension.", HFILL }},\r\n{ &hf_netlogon_trust_offset,\r\n{ "Offset", "netlogon.trust.extention_offset", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Trusts extension.", HFILL }},\r\n{ &hf_netlogon_trust_len,\r\n{ "Length", "netlogon.trust.extention_length", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_trust_max,\r\n{ "Max Count", "netlogon.trust.extention.maxcount", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dummy_string2,\r\n{ "Dummy String2", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 2. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string3,\r\n{ "Dummy String3", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 3. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string4,\r\n{ "Dummy String4", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 4. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string5,\r\n{ "Dummy String5", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 5. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string6,\r\n{ "Dummy String6", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 6. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string7,\r\n{ "Dummy String7", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 7. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string8,\r\n{ "Dummy String8", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 8. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string9,\r\n{ "Dummy String9", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 9. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy_string10,\r\n{ "Dummy String10", "netlogon.dummy_string", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy String 10. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_unknown_long,\r\n{ "Unknown long", "netlogon.unknown.long", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Unknown long. If you know what this is, contact wireshark developers.", HFILL }},\r\n{ &hf_netlogon_dummy1_long,\r\n{ "Dummy1 Long", "netlogon.dummy.long1", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 1. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy2_long,\r\n{ "Dummy2 Long", "netlogon.dummy.long2", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 2. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy3_long,\r\n{ "Dummy3 Long", "netlogon.dummy.long3", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 3. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy4_long,\r\n{ "Dummy4 Long", "netlogon.dummy.long4", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 4. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy5_long,\r\n{ "Dummy5 Long", "netlogon.dummy.long5", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 5. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy6_long,\r\n{ "Dummy6 Long", "netlogon.dummy.long6", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 6. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy7_long,\r\n{ "Dummy7 Long", "netlogon.dummy.long7", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 7. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy8_long,\r\n{ "Dummy8 Long", "netlogon.dummy.long8", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 8. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy9_long,\r\n{ "Dummy9 Long", "netlogon.dummy.long9", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 9. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_dummy10_long,\r\n{ "Dummy10 Long", "netlogon.dummy.long10", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Dummy long 10. Used is reserved for next evolutions.", HFILL }},\r\n{ &hf_netlogon_supportedenctypes,\r\n{ "Supported Encryption Types", "netlogon.encryption.types", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Encryption types", HFILL }},\r\n{ &hf_netlogon_workstation_flags,\r\n{ "Workstation Flags", "netlogon.workstation.flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Flags", HFILL }},\r\n{ &hf_netlogon_reserved,\r\n{ "Reserved", "netlogon.reserved", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_unknown_short,\r\n{ "Unknown short", "netlogon.unknown.short", FT_UINT16, BASE_HEX,\r\nNULL, 0x0, "Unknown short. If you know what this is, contact wireshark developers.", HFILL }},\r\n{ &hf_netlogon_unknown_char,\r\n{ "Unknown char", "netlogon.unknown.char", FT_UINT8, BASE_HEX,\r\nNULL, 0x0, "Unknown char. If you know what this is, contact wireshark developers.", HFILL }},\r\n{ &hf_netlogon_acct_expiry_time,\r\n{ "Acct Expiry Time", "netlogon.acct.expiry_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0x0, "When this account will expire", HFILL }},\r\n{ &hf_netlogon_nt_pwd_present,\r\n{ "NT PWD Present", "netlogon.nt_pwd_present", FT_UINT8, BASE_HEX,\r\nNULL, 0x0, "Is NT password present for this account?", HFILL }},\r\n{ &hf_netlogon_lm_pwd_present,\r\n{ "LM PWD Present", "netlogon.lm_pwd_present", FT_UINT8, BASE_HEX,\r\nNULL, 0x0, "Is LanManager password present for this account?", HFILL }},\r\n{ &hf_netlogon_pwd_expired,\r\n{ "PWD Expired", "netlogon.pwd_expired", FT_UINT8, BASE_HEX,\r\nNULL, 0x0, "Whether this password has expired or not", HFILL }},\r\n{ &hf_netlogon_authoritative,\r\n{ "Authoritative", "netlogon.authoritative", FT_UINT8, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_sensitive_data_flag,\r\n{ "Sensitive Data", "netlogon.sensitive_data_flag", FT_UINT8, BASE_DEC,\r\nNULL, 0x0, "Sensitive data flag", HFILL }},\r\n{ &hf_netlogon_auditing_mode,\r\n{ "Auditing Mode", "netlogon.auditing_mode", FT_UINT8, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_max_audit_event_count,\r\n{ "Max Audit Event Count", "netlogon.max_audit_event_count", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_event_audit_option,\r\n{ "Event Audit Option", "netlogon.event_audit_option", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_sensitive_data_len,\r\n{ "Length", "netlogon.sensitive_data_len", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Length of sensitive data", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_nt_chal_resp,\r\n{ "NT Chal resp", "netlogon.nt_chal_resp", FT_BYTES, BASE_NONE,\r\nNULL, 0, "Challenge response for NT authentication", HFILL }},\r\n#endif\r\n{ &hf_netlogon_lm_chal_resp,\r\n{ "LM Chal resp", "netlogon.lm_chal_resp", FT_BYTES, BASE_NONE,\r\nNULL, 0, "Challenge response for LM authentication", HFILL }},\r\n{ &hf_netlogon_cipher_len,\r\n{ "Cipher Len", "netlogon.cipher_len", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_cipher_maxlen,\r\n{ "Cipher Max Len", "netlogon.cipher_maxlen", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n#if 0\r\n{ &hf_netlogon_pac_data,\r\n{ "Pac Data", "netlogon.pac.data", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n#endif\r\n{ &hf_netlogon_sensitive_data,\r\n{ "Data", "netlogon.sensitive_data", FT_BYTES, BASE_NONE,\r\nNULL, 0, "Sensitive Data", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_auth_data,\r\n{ "Auth Data", "netlogon.auth.data", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n#endif\r\n{ &hf_netlogon_cipher_current_data,\r\n{ "Cipher Current Data", "netlogon.cipher_current_data", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_cipher_old_data,\r\n{ "Cipher Old Data", "netlogon.cipher_old_data", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_acct_name,\r\n{ "Acct Name", "netlogon.acct_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "Account Name", HFILL }},\r\n{ &hf_netlogon_acct_desc,\r\n{ "Acct Desc", "netlogon.acct_desc", FT_STRING, BASE_NONE,\r\nNULL, 0, "Account Description", HFILL }},\r\n{ &hf_netlogon_group_desc,\r\n{ "Group Desc", "netlogon.group_desc", FT_STRING, BASE_NONE,\r\nNULL, 0, "Group Description", HFILL }},\r\n{ &hf_netlogon_full_name,\r\n{ "Full Name", "netlogon.full_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_comment,\r\n{ "Comment", "netlogon.comment", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_parameters,\r\n{ "Parameters", "netlogon.parameters", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_logon_script,\r\n{ "Logon Script", "netlogon.logon_script", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_profile_path,\r\n{ "Profile Path", "netlogon.profile_path", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_home_dir,\r\n{ "Home Dir", "netlogon.home_dir", FT_STRING, BASE_NONE,\r\nNULL, 0, "Home Directory", HFILL }},\r\n{ &hf_netlogon_dir_drive,\r\n{ "Dir Drive", "netlogon.dir_drive", FT_STRING, BASE_NONE,\r\nNULL, 0, "Drive letter for home directory", HFILL }},\r\n{ &hf_netlogon_logon_srv,\r\n{ "Server", "netlogon.server", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n#if 0\r\n{ &hf_netlogon_principal,\r\n{ "Principal", "netlogon.principal", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n#endif\r\n{ &hf_netlogon_logon_dom,\r\n{ "Domain", "netlogon.domain", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_resourcegroupcount,\r\n{ "ResourceGroup count", "netlogon.resourcegroupcount", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Number of Resource Groups", HFILL }},\r\n{ &hf_netlogon_computer_name,\r\n{ "Computer Name", "netlogon.computer_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_site_name,\r\n{ "Site Name", "netlogon.site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dc_name,\r\n{ "DC Name", "netlogon.dc.name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dc_site_name,\r\n{ "DC Site Name", "netlogon.dc.site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dns_forest_name,\r\n{ "DNS Forest Name", "netlogon.dns.forest_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dc_address,\r\n{ "DC Address", "netlogon.dc.address", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dc_address_type,\r\n{ "DC Address Type", "netlogon.dc.address_type", FT_UINT32, BASE_DEC,\r\nVALS(dc_address_types), 0, NULL, HFILL }},\r\n{ &hf_netlogon_client_site_name,\r\n{ "Client Site Name", "netlogon.client.site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_workstation_site_name,\r\n{ "Wkst Site Name", "netlogon.wkst.site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "Workstation Site Name", HFILL }},\r\n{ &hf_netlogon_workstation,\r\n{ "Wkst Name", "netlogon.wkst.name", FT_STRING, BASE_NONE,\r\nNULL, 0, "Workstation Name", HFILL }},\r\n{ &hf_netlogon_os_version,\r\n{ "OS version", "netlogon.os.version", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_workstation_os,\r\n{ "Wkst OS", "netlogon.wkst.os", FT_STRING, BASE_NONE,\r\nNULL, 0, "Workstation OS", HFILL }},\r\n{ &hf_netlogon_workstations,\r\n{ "Workstations", "netlogon.wksts", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_workstation_fqdn,\r\n{ "Wkst FQDN", "netlogon.wkst.fqdn", FT_STRING, BASE_NONE,\r\nNULL, 0, "Workstation FQDN", HFILL }},\r\n{ &hf_netlogon_group_name,\r\n{ "Group Name", "netlogon.group_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_alias_name,\r\n{ "Alias Name", "netlogon.alias_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_dns_host,\r\n{ "DNS Host", "netlogon.dns_host", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_downlevel_domain_name,\r\n{ "Downlevel Domain", "netlogon.downlevel_domain", FT_STRING, BASE_NONE,\r\nNULL, 0, "Downlevel Domain Name", HFILL }},\r\n{ &hf_netlogon_dns_domain_name,\r\n{ "DNS Domain", "netlogon.dns_domain", FT_STRING, BASE_NONE,\r\nNULL, 0, "DNS Domain Name", HFILL }},\r\n{ &hf_netlogon_ad_client_dns_name,\r\n{ "Client DNS Name", "netlogon.client_dns_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_domain_name,\r\n{ "Domain", "netlogon.domain", FT_STRING, BASE_NONE,\r\nNULL, 0, "Domain Name", HFILL }},\r\n{ &hf_netlogon_oem_info,\r\n{ "OEM Info", "netlogon.oem_info", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_trusted_dc_name,\r\n{ "Trusted DC", "netlogon.trusted_dc", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_logon_dnslogondomainname,\r\n{ "DNS Logon Domain name", "netlogon.logon.dnslogondomainname", FT_STRING, BASE_NONE,\r\nNULL, 0, "DNS Name of the logon domain", HFILL }},\r\n{ &hf_netlogon_logon_upn,\r\n{ "UPN", "netlogon.logon.upn", FT_STRING, BASE_NONE,\r\nNULL, 0, "User Principal Name", HFILL }},\r\n{ &hf_netlogon_logonsrv_handle,\r\n{ "Handle", "netlogon.handle", FT_STRING, BASE_NONE,\r\nNULL, 0, "Logon Srv Handle", HFILL }},\r\n{ &hf_netlogon_dummy,\r\n{ "Dummy", "netlogon.dummy", FT_STRING, BASE_NONE,\r\nNULL, 0, "Dummy string", HFILL }},\r\n{ &hf_netlogon_logon_count16,\r\n{ "Logon Count", "netlogon.logon_count16", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Number of successful logins", HFILL }},\r\n{ &hf_netlogon_logon_count,\r\n{ "Logon Count", "netlogon.logon_count", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of successful logins", HFILL }},\r\n{ &hf_netlogon_bad_pw_count16,\r\n{ "Bad PW Count", "netlogon.bad_pw_count16", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Number of failed logins", HFILL }},\r\n{ &hf_netlogon_bad_pw_count,\r\n{ "Bad PW Count", "netlogon.bad_pw_count", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of failed logins", HFILL }},\r\n{ &hf_netlogon_country,\r\n{ "Country", "netlogon.country", FT_UINT16, BASE_DEC | BASE_EXT_STRING,\r\n&ms_country_codes_ext, 0x0, "Country setting for this account", HFILL }},\r\n{ &hf_netlogon_codepage,\r\n{ "Codepage", "netlogon.codepage", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Codepage setting for this account", HFILL }},\r\n{ &hf_netlogon_level16,\r\n{ "Level", "netlogon.level16", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Which option of the union is represented here", HFILL }},\r\n{ &hf_netlogon_validation_level,\r\n{ "Validation Level", "netlogon.validation_level", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Requested level of validation", HFILL }},\r\n{ &hf_netlogon_minpasswdlen,\r\n{ "Min Password Len", "netlogon.min_passwd_len", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Minimum length of password", HFILL }},\r\n{ &hf_netlogon_passwdhistorylen,\r\n{ "Passwd History Len", "netlogon.passwd_history_len", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, "Length of password history", HFILL }},\r\n{ &hf_netlogon_secure_channel_type,\r\n{ "Sec Chan Type", "netlogon.sec_chan_type", FT_UINT16, BASE_DEC,\r\nVALS(sec_chan_type_vals), 0x0, "Secure Channel Type", HFILL }},\r\n{ &hf_netlogon_restart_state,\r\n{ "Restart State", "netlogon.restart_state", FT_UINT16, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_delta_type,\r\n{ "Delta Type", "netlogon.delta_type", FT_UINT16, BASE_DEC,\r\nVALS(delta_type_vals), 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_blob_size,\r\n{ "Size", "netlogon.blob.size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Size in bytes of BLOB", HFILL }},\r\n{ &hf_netlogon_code,\r\n{ "Code", "netlogon.code", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_level,\r\n{ "Level", "netlogon.level", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Which option of the union is represented here", HFILL }},\r\n{ &hf_netlogon_reference,\r\n{ "Reference", "netlogon.reference", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_next_reference,\r\n{ "Next Reference", "netlogon.next_reference", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_timestamp,\r\n{ "Timestamp", "netlogon.timestamp", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_user_rid,\r\n{ "User RID", "netlogon.rid", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_alias_rid,\r\n{ "Alias RID", "netlogon.alias_rid", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_group_rid,\r\n{ "Group RID", "netlogon.group_rid", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_num_rids,\r\n{ "Num RIDs", "netlogon.num_rids", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of RIDs", HFILL }},\r\n{ &hf_netlogon_num_controllers,\r\n{ "Num DCs", "netlogon.num_dc", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of domain controllers", HFILL }},\r\n{ &hf_netlogon_num_sid,\r\n{ "Num Extra SID", "netlogon.num_sid", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_flags,\r\n{ "Flags", "netlogon.flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_user_account_control,\r\n{ "User Account Control", "netlogon.user_account_control", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_user_flags,\r\n{ "User Flags", "netlogon.user_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_auth_flags,\r\n{ "Auth Flags", "netlogon.auth_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_systemflags,\r\n{ "System Flags", "netlogon.system_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_database_id,\r\n{ "Database Id", "netlogon.database_id", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_sync_context,\r\n{ "Sync Context", "netlogon.sync_context", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_max_size,\r\n{ "Max Size", "netlogon.max_size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Max Size of database", HFILL }},\r\n{ &hf_netlogon_max_log_size,\r\n{ "Max Log Size", "netlogon.max_log_size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Max Size of log", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_pac_size,\r\n{ "Pac Size", "netlogon.pac.size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Size of PacData in bytes", HFILL }},\r\n#endif\r\n#if 0\r\n{ &hf_netlogon_auth_size,\r\n{ "Auth Size", "netlogon.auth.size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Size of AuthData in bytes", HFILL }},\r\n#endif\r\n{ &hf_netlogon_num_deltas,\r\n{ "Num Deltas", "netlogon.num_deltas", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of SAM Deltas in array", HFILL }},\r\n{ &hf_netlogon_num_trusts,\r\n{ "Num Trusts", "netlogon.num_trusts", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_logon_attempts,\r\n{ "Logon Attempts", "netlogon.logon_attempts", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, "Number of logon attempts", HFILL }},\r\n{ &hf_netlogon_pagefilelimit,\r\n{ "Page File Limit", "netlogon.page_file_limit", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_pagedpoollimit,\r\n{ "Paged Pool Limit", "netlogon.paged_pool_limit", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_nonpagedpoollimit,\r\n{ "Non-Paged Pool Limit", "netlogon.nonpaged_pool_limit", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_minworkingsetsize,\r\n{ "Min Working Set Size", "netlogon.min_working_set_size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_maxworkingsetsize,\r\n{ "Max Working Set Size", "netlogon.max_working_set_size", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_serial_number,\r\n{ "Serial Number", "netlogon.serial_number", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags,\r\n{ "Negotiation options", "netlogon.neg_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Negotiation Flags", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_neg_flags_80000000,\r\n{ "Not used 80000000", "ntlmssp.neg_flags.na8000000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_80000000, "Not used", HFILL }},\r\n#endif\r\n{ &hf_netlogon_neg_flags_40000000,\r\n{ "Authenticated RPC supported", "ntlmssp.neg_flags.na8000000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_40000000, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_20000000,\r\n{ "Authenticated RPC via lsass supported", "ntlmssp.neg_flags.na8000000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_20000000, "rpc via lsass", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_neg_flags_10000000,\r\n{ "Not used 10000000", "ntlmssp.neg_flags.na8000000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_10000000, "Not used", HFILL }},\r\n#endif\r\n#if 0\r\n{ &hf_netlogon_neg_flags_8000000,\r\n{ "Not used 8000000", "ntlmssp.neg_flags.na800000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_8000000, "Not used", HFILL }},\r\n#endif\r\n#if 0\r\n{ &hf_netlogon_neg_flags_4000000,\r\n{ "Not used 4000000", "ntlmssp.neg_flags.na400000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_4000000, "Not used", HFILL }},\r\n#endif\r\n#if 0\r\n{ &hf_netlogon_neg_flags_2000000,\r\n{ "Not used 2000000", "ntlmssp.neg_flags.na200000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_2000000, "Not used", HFILL }},\r\n#endif\r\n{ &hf_netlogon_neg_flags_1000000,\r\n{ "AES supported", "ntlmssp.neg_flags.na100000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_1000000, "AES", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_neg_flags_800000,\r\n{ "Not used 800000", "ntlmssp.neg_flags.na8000000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_800000, "Not used", HFILL }},\r\n#endif\r\n{ &hf_netlogon_neg_flags_400000,\r\n{ "AES & SHA2 supported", "ntlmssp.neg_flags.na400000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_USEAES, "AES&SHA2", HFILL }},\r\n{ &hf_netlogon_neg_flags_200000,\r\n{ "RODC pass-through", "ntlmssp.neg_flags.na200000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_200000, "rodc pt", HFILL }},\r\n{ &hf_netlogon_neg_flags_100000,\r\n{ "NO NT4 emulation", "ntlmssp.neg_flags.na100000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_100000, "No NT4 emu", HFILL }},\r\n{ &hf_netlogon_neg_flags_80000,\r\n{ "Cross forest trust", "ntlmssp.neg_flags.na80000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_80000, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_40000,\r\n{ "GetDomainInfo supported", "ntlmssp.neg_flags.na40000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_40000, "GetDomainInfo", HFILL }},\r\n{ &hf_netlogon_neg_flags_20000,\r\n{ "ServerPasswordSet2 supported", "ntlmssp.neg_flags.na20000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_20000, "PasswordSet2", HFILL }},\r\n{ &hf_netlogon_neg_flags_10000,\r\n{ "DNS trusts supported", "ntlmssp.neg_flags.na10000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_10000, "DNS Trusts", HFILL }},\r\n{ &hf_netlogon_neg_flags_8000,\r\n{ "Transitive trusts", "ntlmssp.neg_flags.na8000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_8000, "Transitive trust", HFILL }},\r\n{ &hf_netlogon_neg_flags_4000,\r\n{ "Strong key", "ntlmssp.neg_flags.na4000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_STRONGKEY, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_2000,\r\n{ "Avoid replication Auth database", "ntlmssp.neg_flags.na2000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_2000, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_1000,\r\n{ "Avoid replication account database", "ntlmssp.neg_flags.na1000", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_1000, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_800,\r\n{ "Concurent RPC", "ntlmssp.neg_flags.na800", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_800, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_400,\r\n{ "Generic pass-through", "ntlmssp.neg_flags.na400", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_400, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_200,\r\n{ "SendToSam", "ntlmssp.neg_flags.na200", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_200, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_100,\r\n{ "Refusal of password change", "ntlmssp.neg_flags.na100", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_100, "PWD change refusal", HFILL }},\r\n{ &hf_netlogon_neg_flags_80,\r\n{ "DatabaseRedo call", "ntlmssp.neg_flags.na80", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_80, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_40,\r\n{ "Handle multiple SIDs", "ntlmssp.neg_flags.na40", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_40, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_20,\r\n{ "Restarting full DC sync", "ntlmssp.neg_flags.na20", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_20, NULL, HFILL }},\r\n{ &hf_netlogon_neg_flags_10,\r\n{ "BDC handling Changelogs", "ntlmssp.neg_flags.na10", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_10, "BDC Changelog", HFILL }},\r\n{ &hf_netlogon_neg_flags_8,\r\n{ "Promotion count(deprecated)", "ntlmssp.neg_flags.na8", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_8, "Promotion count", HFILL }},\r\n{ &hf_netlogon_neg_flags_4,\r\n{ "RC4 encryption", "ntlmssp.neg_flags.na4", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_4, "RC4", HFILL }},\r\n{ &hf_netlogon_neg_flags_2,\r\n{ "NT3.5 BDC continuous update", "ntlmssp.neg_flags.na2", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_2, "NT3.5", HFILL }},\r\n{ &hf_netlogon_neg_flags_1,\r\n{ "Account lockout", "ntlmssp.neg_flags.na1", FT_BOOLEAN, 32, TFS(&tfs_set_notset), NETLOGON_FLAG_1, NULL, HFILL }},\r\n{ &hf_netlogon_dc_flags,\r\n{ "Domain Controller Flags", "netlogon.dc.flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_dc_flags_pdc_flag,\r\n{ "PDC", "netlogon.dc.flags.pdc",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_pdc_flag), DS_PDC_FLAG,\r\n"If this server is a PDC", HFILL }},\r\n{ &hf_netlogon_dc_flags_gc_flag,\r\n{ "GC", "netlogon.dc.flags.gc",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_gc_flag), DS_GC_FLAG,\r\n"If this server is a GC", HFILL }},\r\n{ &hf_netlogon_dc_flags_ldap_flag,\r\n{ "LDAP", "netlogon.dc.flags.ldap",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_ldap_flag), DS_LDAP_FLAG,\r\n"If this is an LDAP server", HFILL }},\r\n{ &hf_netlogon_dc_flags_ds_flag,\r\n{ "DS", "netlogon.dc.flags.ds",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_ds_flag), DS_DS_FLAG,\r\n"If this server is a DS", HFILL }},\r\n{ &hf_netlogon_dc_flags_kdc_flag,\r\n{ "KDC", "netlogon.dc.flags.kdc",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_kdc_flag), DS_KDC_FLAG,\r\n"If this is a KDC", HFILL }},\r\n{ &hf_netlogon_dc_flags_timeserv_flag,\r\n{ "Timeserv", "netlogon.dc.flags.timeserv",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_timeserv_flag), DS_TIMESERV_FLAG,\r\n"If this server is a TimeServer", HFILL }},\r\n{ &hf_netlogon_dc_flags_closest_flag,\r\n{ "Closest", "netlogon.dc.flags.closest",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_closest_flag), DS_CLOSEST_FLAG,\r\n"If this is the closest server", HFILL }},\r\n{ &hf_netlogon_dc_flags_writable_flag,\r\n{ "Writable", "netlogon.dc.flags.writable",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_writable_flag), DS_WRITABLE_FLAG,\r\n"If this server can do updates to the database", HFILL }},\r\n{ &hf_netlogon_dc_flags_good_timeserv_flag,\r\n{ "Good Timeserv", "netlogon.dc.flags.good_timeserv",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_good_timeserv_flag), DS_GOOD_TIMESERV_FLAG,\r\n"If this is a Good TimeServer", HFILL }},\r\n{ &hf_netlogon_dc_flags_ndnc_flag,\r\n{ "NDNC", "netlogon.dc.flags.ndnc",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_ndnc_flag), DS_NDNC_FLAG,\r\n"If this is an NDNC server", HFILL }},\r\n{ &hf_netlogon_dc_flags_dns_controller_flag,\r\n{ "DNS Controller", "netlogon.dc.flags.dns_controller",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_dns_controller_flag), DS_DNS_CONTROLLER_FLAG,\r\n"If this server is a DNS Controller", HFILL }},\r\n{ &hf_netlogon_dc_flags_dns_domain_flag,\r\n{ "DNS Domain", "netlogon.dc.flags.dns_domain",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_dns_domain_flag), DS_DNS_DOMAIN_FLAG,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_dc_flags_dns_forest_flag,\r\n{ "DNS Forest", "netlogon.dc.flags.dns_forest",\r\nFT_BOOLEAN, 32, TFS(&dc_flags_dns_forest_flag), DS_DNS_FOREST_FLAG,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags,\r\n{ "Flags", "netlogon.get_dcname.request.flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Flags for DSGetDCName request", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_force_rediscovery,\r\n{ "Force Rediscovery", "netlogon.get_dcname.request.flags.force_rediscovery",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_force_rediscovery), DS_FORCE_REDISCOVERY,\r\n"Whether to allow the server to returned cached information or not", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_directory_service_required,\r\n{ "DS Required", "netlogon.get_dcname.request.flags.ds_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_directory_service_required), DS_DIRECTORY_SERVICE_REQUIRED,\r\n"Whether we require that the returned DC supports w2k or not", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_directory_service_preferred,\r\n{ "DS Preferred", "netlogon.get_dcname.request.flags.ds_preferred",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_directory_service_preferred), DS_DIRECTORY_SERVICE_PREFERRED,\r\n"Whether we prefer the call to return a w2k server (if available)", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_gc_server_required,\r\n{ "GC Required", "netlogon.get_dcname.request.flags.gc_server_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_gc_server_required), DS_GC_SERVER_REQUIRED,\r\n"Whether we require that the returned DC is a Global Catalog server", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_pdc_required,\r\n{ "PDC Required", "netlogon.get_dcname.request.flags.pdc_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_pdc_required), DS_PDC_REQUIRED,\r\n"Whether we require the returned DC to be the PDC", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_background_only,\r\n{ "Background Only", "netlogon.get_dcname.request.flags.background_only",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_background_only), DS_BACKGROUND_ONLY,\r\n"If we want cached data, even if it may have expired", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_ip_required,\r\n{ "IP Required", "netlogon.get_dcname.request.flags.ip_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_ip_required), DS_IP_REQUIRED,\r\n"If we require the IP of the DC in the reply", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_kdc_required,\r\n{ "KDC Required", "netlogon.get_dcname.request.flags.kdc_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_kdc_required), DS_KDC_REQUIRED,\r\n"If we require that the returned server is a KDC", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_timeserv_required,\r\n{ "Timeserv Required", "netlogon.get_dcname.request.flags.timeserv_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_timeserv_required), DS_TIMESERV_REQUIRED,\r\n"If we require the returned server to be a WindowsTimeServ server", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_writable_required,\r\n{ "Writable Required", "netlogon.get_dcname.request.flags.writable_required",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_writable_required), DS_WRITABLE_REQUIRED,\r\n"If we require that the returned server is writable", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_good_timeserv_preferred,\r\n{ "Timeserv Preferred", "netlogon.get_dcname.request.flags.good_timeserv_preferred",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_good_timeserv_preferred), DS_GOOD_TIMESERV_PREFERRED,\r\n"If we prefer Windows Time Servers", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_avoid_self,\r\n{ "Avoid Self", "netlogon.get_dcname.request.flags.avoid_self",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_avoid_self), DS_AVOID_SELF,\r\n"Return another DC than the one we ask", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_only_ldap_needed,\r\n{ "Only LDAP Needed", "netlogon.get_dcname.request.flags.only_ldap_needed",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_only_ldap_needed), DS_ONLY_LDAP_NEEDED,\r\n"We just want an LDAP server, it does not have to be a DC", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_is_flat_name,\r\n{ "Is Flat Name", "netlogon.get_dcname.request.flags.is_flat_name",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_is_flat_name), DS_IS_FLAT_NAME,\r\n"If the specified domain name is a NetBIOS name", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_is_dns_name,\r\n{ "Is DNS Name", "netlogon.get_dcname.request.flags.is_dns_name",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_is_dns_name), DS_IS_DNS_NAME,\r\n"If the specified domain name is a DNS name", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_return_dns_name,\r\n{ "Return DNS Name", "netlogon.get_dcname.request.flags.return_dns_name",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_return_dns_name), DS_RETURN_DNS_NAME,\r\n"Only return a DNS name (or an error)", HFILL }},\r\n{ &hf_netlogon_get_dcname_request_flags_return_flat_name,\r\n{ "Return Flat Name", "netlogon.get_dcname.request.flags.return_flat_name",\r\nFT_BOOLEAN, 32, TFS(&get_dcname_request_flags_return_flat_name), DS_RETURN_FLAT_NAME,\r\n"Only return a NetBIOS name (or an error)", HFILL }},\r\n{ &hf_netlogon_trust_attribs,\r\n{ "Trust Attributes", "netlogon.trust_attribs", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_non_transitive,\r\n{ "Non Transitive", "netlogon.trust.attribs.non_transitive", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_non_transitive), 0x00000001, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_uplevel_only,\r\n{ "Uplevel Only", "netlogon.trust.attribs.uplevel_only", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_uplevel_only), 0x00000002, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_quarantined_domain,\r\n{ "Quarantined Domain", "netlogon.trust.attribs.quarantined_domain", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_quarantined_domain), 0x00000004, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_forest_transitive,\r\n{ "Forest Transitive", "netlogon.trust.attribs.forest_transitive", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_forest_transitive), 0x00000008, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_cross_organization,\r\n{ "Cross Organization", "netlogon.trust.attribs.cross_organization", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_cross_organization), 0x00000010, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_within_forest,\r\n{ "Within Forest", "netlogon.trust.attribs.within_forest", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_within_forest), 0x00000020, NULL, HFILL }},\r\n{ &hf_netlogon_trust_attribs_treat_as_external,\r\n{ "Treat As External", "netlogon.trust.attribs.treat_as_external", FT_BOOLEAN, 32,\r\nTFS(&trust_attribs_treat_as_external), 0x00000040, NULL, HFILL }},\r\n{ &hf_netlogon_trust_type,\r\n{ "Trust Type", "netlogon.trust_type", FT_UINT32, BASE_DEC,\r\nVALS(trust_type_vals), 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_extraflags,\r\n{ "Extra Flags", "netlogon.extra_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_extra_flags_root_forest,\r\n{ "Request passed to DC of root forest", "netlogon.extra.flags.rootdc",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), RQ_ROOT_FOREST,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_trust_flags_dc_firsthop,\r\n{ "DC at the end of the first hop of cross forest", "netlogon.extra.flags.dc_firsthop",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), RQ_DC_XFOREST,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_trust_flags_rodc_to_dc,\r\n{ "Request from a RODC to a DC from another domain", "netlogon.extra.flags.rodc_to_dc",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), RQ_RODC_DIF_DOMAIN,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_trust_flags_rodc_ntlm,\r\n{ "Request is a NTLM auth passed by a RODC", "netlogon.extra.flags.rodc_ntlm",\r\nFT_BOOLEAN, 32, TFS(&tfs_set_notset), RQ_NTLM_FROM_RODC,\r\nNULL, HFILL }},\r\n{ &hf_netlogon_trust_flags,\r\n{ "Trust Flags", "netlogon.trust_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_trust_flags_inbound,\r\n{ "Inbound Trust", "netlogon.trust.flags.inbound",\r\nFT_BOOLEAN, 32, TFS(&trust_inbound), DS_DOMAIN_DIRECT_INBOUND,\r\n"Inbound trust. Whether the domain directly trusts the queried servers domain", HFILL }},\r\n{ &hf_netlogon_trust_flags_outbound,\r\n{ "Outbound Trust", "netlogon.trust.flags.outbound",\r\nFT_BOOLEAN, 32, TFS(&trust_outbound), DS_DOMAIN_DIRECT_OUTBOUND,\r\n"Outbound Trust. Whether the domain is directly trusted by the servers domain", HFILL }},\r\n{ &hf_netlogon_trust_flags_in_forest,\r\n{ "In Forest", "netlogon.trust.flags.in_forest",\r\nFT_BOOLEAN, 32, TFS(&trust_in_forest), DS_DOMAIN_IN_FOREST,\r\n"Whether this domain is a member of the same forest as the servers domain", HFILL }},\r\n{ &hf_netlogon_trust_flags_native_mode,\r\n{ "Native Mode", "netlogon.trust.flags.native_mode",\r\nFT_BOOLEAN, 32, TFS(&trust_native_mode), DS_DOMAIN_NATIVE_MODE,\r\n"Whether the domain is a w2k native mode domain or not", HFILL }},\r\n{ &hf_netlogon_trust_flags_primary,\r\n{ "Primary", "netlogon.trust.flags.primary",\r\nFT_BOOLEAN, 32, TFS(&trust_primary), DS_DOMAIN_PRIMARY,\r\n"Whether the domain is the primary domain for the queried server or not", HFILL }},\r\n{ &hf_netlogon_trust_flags_tree_root,\r\n{ "Tree Root", "netlogon.trust.flags.tree_root",\r\nFT_BOOLEAN, 32, TFS(&trust_tree_root), DS_DOMAIN_TREE_ROOT,\r\n"Whether the domain is the root of the tree for the queried server", HFILL }},\r\n{ &hf_netlogon_trust_parent_index,\r\n{ "Parent Index", "netlogon.parent_index", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_logon_time,\r\n{ "Logon Time", "netlogon.logon_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time for last time this user logged on", HFILL }},\r\n{ &hf_netlogon_kickoff_time,\r\n{ "Kickoff Time", "netlogon.kickoff_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when this user will be kicked off", HFILL }},\r\n{ &hf_netlogon_logoff_time,\r\n{ "Logoff Time", "netlogon.logoff_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time for last time this user logged off", HFILL }},\r\n{ &hf_netlogon_last_logoff_time,\r\n{ "Last Logoff Time", "netlogon.last_logoff_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time for last time this user logged off", HFILL }},\r\n{ &hf_netlogon_pwd_last_set_time,\r\n{ "PWD Last Set", "netlogon.pwd_last_set_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Last time this users password was changed", HFILL }},\r\n{ &hf_netlogon_pwd_age,\r\n{ "PWD Age", "netlogon.pwd_age", FT_RELATIVE_TIME, BASE_NONE,\r\nNULL, 0, "Time since this users password was changed", HFILL }},\r\n{ &hf_netlogon_pwd_can_change_time,\r\n{ "PWD Can Change", "netlogon.pwd_can_change_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "When this users password may be changed", HFILL }},\r\n{ &hf_netlogon_pwd_must_change_time,\r\n{ "PWD Must Change", "netlogon.pwd_must_change_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "When this users password must be changed", HFILL }},\r\n{ &hf_netlogon_domain_create_time,\r\n{ "Domain Create Time", "netlogon.domain_create_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when this domain was created", HFILL }},\r\n{ &hf_netlogon_domain_modify_time,\r\n{ "Domain Modify Time", "netlogon.domain_modify_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when this domain was last modified", HFILL }},\r\n{ &hf_netlogon_db_modify_time,\r\n{ "DB Modify Time", "netlogon.db_modify_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when last modified", HFILL }},\r\n{ &hf_netlogon_db_create_time,\r\n{ "DB Create Time", "netlogon.db_create_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when created", HFILL }},\r\n{ &hf_netlogon_cipher_current_set_time,\r\n{ "Cipher Current Set Time", "netlogon.cipher_current_set_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when current cipher was initiated", HFILL }},\r\n{ &hf_netlogon_cipher_old_set_time,\r\n{ "Cipher Old Set Time", "netlogon.cipher_old_set_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Time when previous cipher was initiated", HFILL }},\r\n{ &hf_netlogon_audit_retention_period,\r\n{ "Audit Retention Period", "netlogon.audit_retention_period", FT_RELATIVE_TIME, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_timelimit,\r\n{ "Time Limit", "netlogon.time_limit", FT_RELATIVE_TIME, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_client_credential,\r\n{ "Client Credential", "netlogon.clientcred", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_server_credential,\r\n{ "Server Credential", "netlogon.servercred", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_server_rid,\r\n{ "Account RID", "netlogon.serverrid", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_client_challenge,\r\n{ "Client Challenge", "netlogon.clientchallenge", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_server_challenge,\r\n{ "Server Challenge", "netlogon.serverchallenge", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_type,\r\n{ "Message Type", "netlogon.secchan.nl_auth_message.message_type", FT_UINT32, BASE_HEX,\r\nVALS(nl_auth_types), 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags,\r\n{ "Message Flags", "netlogon.secchan.nl_auth_message.message_flags", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags_nb_domain,\r\n{ "NetBios Domain", "netlogon.secchan.nl_auth_message.message_flags.nb_domain", FT_BOOLEAN, 32,\r\nNULL, 0x00000001, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags_nb_host,\r\n{ "NetBios Host", "netlogon.secchan.nl_auth_message.message_flags.nb_host", FT_BOOLEAN, 32,\r\nNULL, 0x00000002, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags_dns_domain,\r\n{ "DNS Domain", "netlogon.secchan.nl_auth_message.message_flags.dns_domain", FT_BOOLEAN, 32,\r\nNULL, 0x00000004, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags_dns_host,\r\n{ "DNS Host", "netlogon.secchan.nl_auth_message.message_flags.dns_host", FT_BOOLEAN, 32,\r\nNULL, 0x00000008, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_message_flags_nb_host_utf8,\r\n{ "NetBios Host(UTF8)", "netlogon.secchan.nl_auth_message.message_flags.nb_host_utf8", FT_BOOLEAN, 32,\r\nNULL, 0x00000010, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_nb_domain,\r\n{ "NetBios Domain", "netlogon.secchan.nl_auth_message.nb_domain", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_nb_host,\r\n{ "NetBios Host", "netlogon.secchan.nl_auth_message.nb_host", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_nb_host_utf8,\r\n{ "NetBios Host(UTF8)", "netlogon.secchan.nl_auth_message.nb_host_utf8", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_dns_domain,\r\n{ "DNS Domain", "netlogon.secchan.nl_auth_message.dns_domain", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_nl_dns_host,\r\n{ "DNS Host", "netlogon.secchan.nl_auth_message.dns_host", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_data_length,\r\n{ "Length of Data", "netlogon.data.length", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_package_name,\r\n{ "SSP Package Name", "netlogon.data.package_name", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf,\r\n{ "Secure Channel Verifier", "netlogon.secchan.verifier", FT_NONE, BASE_NONE,\r\nNULL, 0x0, "Verifier", HFILL }},\r\n{ &hf_netlogon_secchan_verf_signalg,\r\n{ "Sign algorithm", "netlogon.secchan.signalg", FT_UINT16, BASE_HEX,\r\nVALS(sign_algs), 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf_sealalg,\r\n{ "Seal algorithm", "netlogon.secchan.sealalg", FT_UINT16, BASE_HEX,\r\nVALS(seal_algs), 0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf_flag,\r\n{ "Flags", "netlogon.secchan.flags", FT_BYTES, BASE_NONE, NULL,\r\n0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf_digest,\r\n{ "Packet Digest", "netlogon.secchan.digest", FT_BYTES, BASE_NONE, NULL,\r\n0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf_seq,\r\n{ "Sequence No", "netlogon.secchan.seq", FT_BYTES, BASE_NONE, NULL,\r\n0x0, NULL, HFILL }},\r\n{ &hf_netlogon_secchan_verf_nonce,\r\n{ "Nonce", "netlogon.secchan.nonce", FT_BYTES, BASE_NONE, NULL,\r\n0x0, NULL, HFILL }},\r\n{ &hf_netlogon_group_attrs_mandatory,\r\n{ "Mandatory", "netlogon.groups.attrs.mandatory",\r\nFT_BOOLEAN, 32, TFS(&group_attrs_mandatory), 0x00000001,\r\n"The group attributes MANDATORY flag", HFILL }},\r\n{ &hf_netlogon_group_attrs_enabled_by_default,\r\n{ "Enabled By Default", "netlogon.groups.attrs.enabled_by_default",\r\nFT_BOOLEAN, 32, TFS(&group_attrs_enabled_by_default), 0x00000002,\r\n"The group attributes ENABLED_BY_DEFAULT flag", HFILL }},\r\n{ &hf_netlogon_group_attrs_enabled,\r\n{ "Enabled", "netlogon.groups.attrs.enabled",\r\nFT_BOOLEAN, 32, TFS(&group_attrs_enabled), 0x00000004,\r\n"The group attributes ENABLED flag", HFILL }},\r\n{ &hf_netlogon_user_flags_extra_sids,\r\n{ "Extra SIDs", "netlogon.user.flags.extra_sids",\r\nFT_BOOLEAN, 32, TFS(&user_flags_extra_sids), 0x00000020,\r\n"The user flags EXTRA_SIDS", HFILL }},\r\n{ &hf_netlogon_user_flags_resource_groups,\r\n{ "Resource Groups", "netlogon.user.flags.resource_groups",\r\nFT_BOOLEAN, 32, TFS(&user_flags_resource_groups), 0x00000200,\r\n"The user flags RESOURCE_GROUPS", HFILL }},\r\n{ &hf_netlogon_user_account_control_dont_require_preauth,\r\n{ "Don't Require PreAuth", "netlogon.user.account_control.dont_require_preauth",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_dont_require_preauth), 0x00010000,\r\n"The user account control DONT_REQUIRE_PREAUTH flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_use_des_key_only,\r\n{ "Use DES Key Only", "netlogon.user.account_control.use_des_key_only",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_use_des_key_only), 0x00008000,\r\n"The user account control use_des_key_only flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_not_delegated,\r\n{ "Not Delegated", "netlogon.user.account_control.not_delegated",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_not_delegated), 0x00004000,\r\n"The user account control not_delegated flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_trusted_for_delegation,\r\n{ "Trusted For Delegation", "netlogon.user.account_control.trusted_for_delegation",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_trusted_for_delegation), 0x00002000,\r\n"The user account control trusted_for_delegation flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_smartcard_required,\r\n{ "SmartCard Required", "netlogon.user.account_control.smartcard_required",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_smartcard_required), 0x00001000,\r\n"The user account control smartcard_required flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_encrypted_text_password_allowed,\r\n{ "Encrypted Text Password Allowed", "netlogon.user.account_control.encrypted_text_password_allowed",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_encrypted_text_password_allowed), 0x00000800,\r\n"The user account control encrypted_text_password_allowed flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_account_auto_locked,\r\n{ "Account Auto Locked", "netlogon.user.account_control.account_auto_locked",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_account_auto_locked), 0x00000400,\r\n"The user account control account_auto_locked flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_dont_expire_password,\r\n{ "Don't Expire Password", "netlogon.user.account_control.dont_expire_password",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_dont_expire_password), 0x00000200,\r\n"The user account control dont_expire_password flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_server_trust_account,\r\n{ "Server Trust Account", "netlogon.user.account_control.server_trust_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_server_trust_account), 0x00000100,\r\n"The user account control server_trust_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_workstation_trust_account,\r\n{ "Workstation Trust Account", "netlogon.user.account_control.workstation_trust_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_workstation_trust_account), 0x00000080,\r\n"The user account control workstation_trust_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_interdomain_trust_account,\r\n{ "Interdomain trust Account", "netlogon.user.account_control.interdomain_trust_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_interdomain_trust_account), 0x00000040,\r\n"The user account control interdomain_trust_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_mns_logon_account,\r\n{ "MNS Logon Account", "netlogon.user.account_control.mns_logon_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_mns_logon_account), 0x00000020,\r\n"The user account control mns_logon_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_normal_account,\r\n{ "Normal Account", "netlogon.user.account_control.normal_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_normal_account), 0x00000010,\r\n"The user account control normal_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_temp_duplicate_account,\r\n{ "Temp Duplicate Account", "netlogon.user.account_control.temp_duplicate_account",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_temp_duplicate_account), 0x00000008,\r\n"The user account control temp_duplicate_account flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_password_not_required,\r\n{ "Password Not Required", "netlogon.user.account_control.password_not_required",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_password_not_required), 0x00000004,\r\n"The user account control password_not_required flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_home_directory_required,\r\n{ "Home Directory Required", "netlogon.user.account_control.home_directory_required",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_home_directory_required), 0x00000002,\r\n"The user account control home_directory_required flag", HFILL }},\r\n{ &hf_netlogon_user_account_control_account_disabled,\r\n{ "Account Disabled", "netlogon.user.account_control.account_disabled",\r\nFT_BOOLEAN, 32, TFS(&user_account_control_account_disabled), 0x00000001,\r\n"The user account control account_disabled flag", HFILL }},\r\n#if 0\r\n{ &hf_netlogon_dnsdomaininfo,\r\n{ "DnsDomainInfo", "netlogon.dnsdomaininfo", FT_NONE, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n#endif\r\n{ &DnsDomainInfo_sid,\r\n{ "Sid", "lsarpc.lsa_DnsDomainInfo.sid", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &DomainInfo_sid,\r\n{ "Sid", "lsarpc.lsa_DomainInfo.sid", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &DnsDomainInfo_domain_guid,\r\n{ "Domain Guid", "lsarpc.lsa_DnsDomainInfo.domain_guid", FT_GUID, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &DnsDomainInfo_dns_forest,\r\n{ "Dns Forest", "lsarpc.lsa_DnsDomainInfo.dns_forest", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &DnsDomainInfo_dns_domain,\r\n{ "Dns Domain", "lsarpc.lsa_DnsDomainInfo.dns_domain", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &DnsDomainInfo_name,\r\n{ "Name", "lsarpc.lsa_DnsDomainInfo.name", FT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_netlogon_s4u2proxytarget,\r\n{ "S4U2proxyTarget", "netlogon.s4u2proxytarget", FT_STRING, BASE_NONE,\r\nNULL, 0, "Target for constrained delegation using s4u2proxy", HFILL }},\r\n{ &hf_netlogon_transitedlistsize,\r\n{ "TransitedListSize", "netlogon.transited_list_size", FT_UINT32, BASE_HEX,\r\nNULL, 0x0, "Number of elements in the TransitedServices array.", HFILL }},\r\n{ &hf_netlogon_transited_service,\r\n{ "Transited Service", "netlogon.transited_service", FT_STRING, BASE_NONE,\r\nNULL, 0, "S4U2 Transited Service name", HFILL }},\r\n{ &hf_netlogon_logon_duration,\r\n{ "Duration", "netlogon.logon_duration", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_netlogon_time_created,\r\n{ "Time Created", "netlogon.time_created", FT_UINT32, BASE_DEC,\r\nNULL, 0x0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_dcerpc_netlogon,\r\n&ett_authenticate_flags,\r\n&ett_CYPHER_VALUE,\r\n&ett_QUOTA_LIMITS,\r\n&ett_IDENTITY_INFO,\r\n&ett_DELTA_ENUM,\r\n&ett_UNICODE_MULTI,\r\n&ett_DOMAIN_CONTROLLER_INFO,\r\n&ett_UNICODE_STRING_512,\r\n&ett_TYPE_50,\r\n&ett_TYPE_52,\r\n&ett_DELTA_ID_UNION,\r\n&ett_TYPE_44,\r\n&ett_DELTA_UNION,\r\n&ett_LM_OWF_PASSWORD,\r\n&ett_NT_OWF_PASSWORD,\r\n&ett_GROUP_MEMBERSHIP,\r\n&ett_DS_DOMAIN_TRUSTS,\r\n&ett_BLOB,\r\n&ett_DOMAIN_TRUST_INFO,\r\n&ett_LSA_POLICY_INFO,\r\n&ett_trust_flags,\r\n&ett_trust_attribs,\r\n&ett_get_dcname_request_flags,\r\n&ett_dc_flags,\r\n&ett_secchan_nl_auth_message,\r\n&ett_secchan_nl_auth_message_flags,\r\n&ett_secchan_verf,\r\n&ett_group_attrs,\r\n&ett_user_flags,\r\n&ett_nt_counted_longs_as_string,\r\n&ett_user_account_control\r\n};\r\nproto_dcerpc_netlogon = proto_register_protocol(\r\n"Microsoft Network Logon", "RPC_NETLOGON", "rpc_netlogon");\r\nproto_register_field_array(proto_dcerpc_netlogon, hf,\r\narray_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_init_routine(netlogon_reassemble_init);\r\nregister_cleanup_routine(netlogon_reassemble_cleanup);\r\n}\r\nvoid\r\nproto_reg_handoff_dcerpc_netlogon(void)\r\n{\r\nseen.isseen = FALSE;\r\nseen.num = 0;\r\ndcerpc_init_uuid(proto_dcerpc_netlogon, ett_dcerpc_netlogon,\r\n&uuid_dcerpc_netlogon, ver_dcerpc_netlogon,\r\ndcerpc_netlogon_dissectors, hf_netlogon_opnum);\r\nregister_dcerpc_auth_subdissector(DCE_C_AUTHN_LEVEL_PKT_INTEGRITY,\r\nDCE_C_RPC_AUTHN_PROTOCOL_SEC_CHAN,\r\n&secchan_auth_fns);\r\nregister_dcerpc_auth_subdissector(DCE_C_AUTHN_LEVEL_PKT_PRIVACY,\r\nDCE_C_RPC_AUTHN_PROTOCOL_SEC_CHAN,\r\n&secchan_auth_fns);\r\n}
