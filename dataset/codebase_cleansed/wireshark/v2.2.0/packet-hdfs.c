static void\r\ndissect_params (tvbuff_t *tvb, proto_tree *hdfs_tree, guint offset, int params) {\r\nguint length;\r\nint i = 0;\r\nconst guint8* type_name;\r\nfor (i = 0; i < params; i++) {\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_paramtype, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nif (offset >= length && (!tvb_memeql(tvb, offset - length, "long", length) || !tvb_memeql(tvb, offset - length, "int", length) ||\r\n!tvb_memeql(tvb, offset - length, "short", length) || !tvb_memeql(tvb, offset - length, "char", length) ||\r\n!tvb_memeql(tvb, offset - length, "byte", length) || !tvb_memeql(tvb, offset - length, "float", length)\r\n|| !tvb_memeql(tvb, offset - length, "double", length) || !tvb_memeql(tvb, offset - length, "boolean", length))) {\r\nif (!tvb_memeql(tvb, offset - length, "boolean", length)) {\r\nlength = 1;\r\n} else if (!tvb_memeql(tvb, offset - length, "short", length)) {\r\nlength = 2;\r\n} else {\r\nlength = sizeof(type_name);\r\n}\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_paramvalnum, tvb, offset, length, ENC_BIG_ENDIAN);\r\noffset += length;\r\n} else {\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_paramval, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nif (!tvb_memeql(tvb, offset - length, "org.apache.hadoop.fs.permission.FsPermission", length)) {\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_fileperm, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_data (tvbuff_t *tvb, proto_tree *hdfs_tree, guint offset) {\r\nint params = 0;\r\nguint length = 0;\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_strcall, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nif (!(tvb_get_ntohl(tvb, offset - SEND_OFFSET) == SEND_DEC && tvb_get_ntohl(tvb, offset - HEAR_OFFSET) == HEAR_DEC &&\r\ntvb_get_ntohl(tvb, offset - TBEA_OFFSET) == TBEA_DEC && tvb_get_guint8(tvb, offset - T_OFFSET) == T_DEC)) {\r\nparams = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_params, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ndissect_params (tvb, hdfs_tree, offset, params);\r\n}\r\n}\r\nstatic int\r\ndissect_resp_long (tvbuff_t *tvb, proto_tree *hdfs_tree, int offset) {\r\nint length = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_paramtype, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_prover, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_resp_filestatus (tvbuff_t *tvb, proto_tree *hdfs_tree, int offset) {\r\nint length;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_fileperm, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_filename, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_endblockloc, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_isdir, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blockrep, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blocksize, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_modtime, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_accesstime, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_fileperm, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nlength = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_ownername, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_groupname, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_block_info (tvbuff_t *tvb, proto_tree *hdfs_tree, int offset) {\r\nint length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_identifier, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_password, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_kind, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_service, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_corrupt, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_offset, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blockloc, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blocksize, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blockgen, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_locations, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_datanodeid, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_storageid, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_infoport, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_ipcport, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_capacity, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_dfsused, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_remaining, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_lastupdate, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_activecon, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_rackloc, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_hostname, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelenone, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_adminstate, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nreturn offset;\r\n}\r\nstatic void\r\ndissect_resp_locatedblocks (tvbuff_t *tvb, proto_tree *hdfs_tree, int offset) {\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_filelen, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_construct, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_blockcount, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nwhile (tvb_reported_length(tvb) - offset > 0) {\r\noffset = dissect_block_info (tvb, hdfs_tree, offset);\r\n}\r\n}\r\nstatic int\r\ndissect_hdfs_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint offset = 0;\r\nint success = 0;\r\nguint length = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "HDFS");\r\ncol_clear(pinfo->cinfo,COL_INFO);\r\nif (tree) {\r\nproto_item *ti;\r\nproto_tree *hdfs_tree;\r\nti = proto_tree_add_item(tree, proto_hdfs, tvb, 0, -1, ENC_NA);\r\nhdfs_tree = proto_item_add_subtree(ti, ett_hdfs);\r\nif (pinfo->srcport == tcp_port) {\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_packetno, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nsuccess = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_success, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (success != 0) {\r\nreturn offset;\r\n}\r\nif (!tvb_memeql(tvb, offset + 2, "long", 4)) {\r\ndissect_resp_long (tvb, hdfs_tree, offset);\r\n} else {\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_objname, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_objname, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\nif (!tvb_memeql(tvb, offset - length, "org.apache.hadoop.hdfs.protocol.LocatedBlocks", length)) {\r\ndissect_resp_locatedblocks (tvb, hdfs_tree, offset);\r\n} else if (!tvb_memeql(tvb, offset - length, "org.apache.hadoop.hdfs.protocol.HdfsFileStatus", length)) {\r\ndissect_resp_filestatus (tvb, hdfs_tree, offset);\r\n} else {\r\nlength = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_namelentwo, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_paramval, tvb, offset, length, ENC_ASCII|ENC_NA);\r\n}\r\n}\r\n} else {\r\nguint auth = tvb_get_ntohl(tvb, offset);\r\nif (!tvb_memeql(tvb, offset, REQUEST_STR, sizeof(REQUEST_STR) - 1)) {\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_sequenceno, tvb, offset, sizeof(REQUEST_STR) - 1, ENC_ASCII|ENC_NA);\r\noffset += (int)sizeof(REQUEST_STR) - 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_pdu_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_flags, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n} else {\r\nif (auth + 4 != tvb_reported_length(tvb)) {\r\nlength = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_authlen, tvb, offset, 4, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_auth, tvb, offset, length, ENC_ASCII|ENC_NA);\r\noffset += length;\r\n}\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_len, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hdfs_tree, hf_hdfs_packetno, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\ndissect_data (tvb, hdfs_tree, offset);\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic guint get_hdfs_message_len(packet_info *pinfo _U_, tvbuff_t *tvb,\r\nint offset _U_, void *data _U_)\r\n{\r\nint len = tvb_reported_length(tvb);\r\nif (tvb_reported_length(tvb) == 1448 || tvb_reported_length(tvb) == 1321) {\r\nlen = 150 * tvb_get_ntohs(tvb, 113) + 115 ;\r\n}\r\nreturn len;\r\n}\r\nstatic int\r\ndissect_hdfs(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nint frame_header_len = 0;\r\ngboolean need_reassemble = FALSE;\r\nframe_header_len = tvb_reported_length(tvb);\r\nif (frame_header_len == 1448 || frame_header_len == 1321) {\r\nneed_reassemble = TRUE;\r\n}\r\ntcp_dissect_pdus(tvb, pinfo, tree, need_reassemble, frame_header_len, get_hdfs_message_len, dissect_hdfs_message, data);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_hdfs(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_hdfs_sequenceno,\r\n{ "HDFS protocol type", "hdfs.type",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_pdu_type,\r\n{ "HDFS protocol version", "hdfs.version",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_flags,\r\n{ "HDFS authentication type", "hdfs.auth_type",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_authlen,\r\n{ "HDFS authentication length", "hdfs.authlen",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_auth,\r\n{ "HDFS authorization bits", "hdfs.auth",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_packetno,\r\n{ "HDFS packet number", "hdfs.seqno",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_success,\r\n{ "HDFS success", "hdfs.success",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_strcall,\r\n{ "HDFS method name", "hdfs.strcall",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_hdfs_rest,\r\n{ "HDFS value", "hdfs.rest",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_hdfs_blockloc,\r\n{ "HDFS block location", "hdfs.blockloc",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_blocksize,\r\n{ "HDFS block size", "hdfs.blocksize",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_endblockloc,\r\n{ "HDFS file size", "hdfs.endblockloc",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_blockgen,\r\n{ "HDFS block gen", "hdfs.blockgen",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_prover,\r\n{ "HDFS protocol version", "hdfs.prover",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_objname,\r\n{ "HDFS object name", "hdfs.objname",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_filename,\r\n{ "HDFS file name", "hdfs.filename",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_blockcount,\r\n{ "HDFS block count", "hdfs.blockcount",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_ownername,\r\n{ "HDFS owner name", "hdfs.ownername",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_groupname,\r\n{ "HDFS group name", "hdfs.groupname",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_accesstime,\r\n{ "HDFS access time", "hdfs.accesstime",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_modtime,\r\n{ "HDFS modified time", "hdfs.modtime",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_blockrep,\r\n{ "HDFS block replication factor", "hdfs.blockrep",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_isdir,\r\n{ "HDFS is directory", "hdfs.isdir",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_filelen,\r\n{ "HDFS file length", "hdfs.filelen",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_construct,\r\n{ "HDFS under construction", "hdfs.construct",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_rackloc,\r\n{ "HDFS rack location", "hdfs.rackloc",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_adminstate,\r\n{ "HDFS admin state", "hdfs.adminstate",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_hostname,\r\n{ "HDFS hostname", "hdfs.hostname",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_namelenone,\r\n{ "HDFS name length", "hdfs.namelenone",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_namelentwo,\r\n{ "HDFS name length", "hdfs.namelentwo",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_activecon,\r\n{ "HDFS active connections", "hdfs.activecon",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_lastupdate,\r\n{ "HDFS lastupdate", "hdfs.lastupdate",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_remaining,\r\n{ "HDFS remaining", "hdfs.remaining",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_dfsused,\r\n{ "HDFS dfs used", "hdfs.dfsused",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_capacity,\r\n{ "HDFS capacity", "hdfs.capacity",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_ipcport,\r\n{ "HDFS ipcport", "hdfs.ipcport",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_infoport,\r\n{ "HDFS info port", "hdfs.infoport",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_storageid,\r\n{ "HDFS storage id", "hdfs.storageid",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_datanodeid,\r\n{ "HDFS datanodeid", "hdfs.datanodeid",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_locations,\r\n{ "HDFS locations", "hdfs.locations",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_identifier,\r\n{ "HDFS locations", "hdfs.identifier",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_password,\r\n{ "HDFS password", "hdfs.password",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_kind,\r\n{ "HDFS kind", "hdfs.kind",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_service,\r\n{ "HDFS locations", "hdfs.service",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_corrupt,\r\n{ "HDFS corrupt", "hdfs.corrupt",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_offset,\r\n{ "HDFS offset", "hdfs.offset",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_len,\r\n{ "HDFS length", "hdfs.len",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_params,\r\n{ "HDFS number of parameters", "hdfs.params",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_paramtype,\r\n{ "HDFS parameter type", "hdfs.paramtype",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_paramval,\r\n{ "HDFS parameter value", "hdfs.paramval",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_paramvalnum,\r\n{ "HDFS parameter value", "hdfs.paramvalnum",\r\nFT_INT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hdfs_fileperm,\r\n{ "HDFS File permission", "hdfs.fileperm",\r\nFT_INT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_hdfs\r\n};\r\nmodule_t *hdfs_module;\r\nproto_hdfs = proto_register_protocol (\r\n"HDFS Protocol",\r\n"HDFS",\r\n"hdfs"\r\n);\r\nproto_register_field_array(proto_hdfs, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nhdfs_module = prefs_register_protocol(proto_hdfs, proto_reg_handoff_hdfs);\r\nprefs_register_uint_preference(hdfs_module,\r\n"tcp.port",\r\n"TCP port for HDFS",\r\n"Set the TCP port for HDFS",\r\n10,\r\n&tcp_port);\r\nhdfs_handle = register_dissector("hdfs", dissect_hdfs, proto_hdfs);\r\n}\r\nvoid\r\nproto_reg_handoff_hdfs(void)\r\n{\r\nstatic gboolean initialized = FALSE;\r\nstatic guint saved_tcp_port;\r\nif (!initialized) {\r\ndissector_add_for_decode_as("tcp.port", hdfs_handle);\r\ninitialized = TRUE;\r\n} else if (saved_tcp_port != 0) {\r\ndissector_delete_uint("tcp.port", saved_tcp_port, hdfs_handle);\r\n}\r\nif (tcp_port != 0) {\r\ndissector_add_uint("tcp.port", tcp_port, hdfs_handle);\r\n}\r\nsaved_tcp_port = tcp_port;\r\n}
