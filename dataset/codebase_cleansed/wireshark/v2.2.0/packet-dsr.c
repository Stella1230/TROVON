static int\r\ndissect_dsr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data _U_)\r\n{\r\nproto_item *ti_main, *ti, *ti_hoplist;\r\nproto_tree *dsr_tree, *opt_tree, *options_tree, *opt_hoplist_tree;\r\nguint offset = 0;\r\nguint offset_in_option = 0;\r\nguint nexthdr, opt_tot_len, opt_len, opt_type, opt_id, opt_err_type, flowstate_hdr;\r\nguint i;\r\ntvbuff_t *next_tvb;\r\nif (tvb_reported_length(tvb) < DSR_MIN_LENGTH)\r\nreturn 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "DSR");\r\ncol_add_str(pinfo->cinfo, COL_INFO, "Options : ");\r\nti_main = proto_tree_add_item(tree, proto_dsr, tvb, 0, -1, ENC_NA);\r\ndsr_tree = proto_item_add_subtree(ti_main, ett_dsr);\r\nproto_tree_add_item(dsr_tree, hf_dsr_nexthdr, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nnexthdr = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nproto_tree_add_item(dsr_tree, hf_dsr_flowstate, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nflowstate_hdr = tvb_get_bits8(tvb, offset*8, 1);\r\nif (!flowstate_hdr) {\r\nproto_tree_add_item(dsr_tree, hf_dsr_reserved, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dsr_tree, hf_dsr_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nopt_tot_len = tvb_get_ntohs(tvb, offset);\r\nproto_item_set_len(ti_main, opt_tot_len+4);\r\noffset += 2;\r\noptions_tree = proto_tree_add_subtree(dsr_tree, tvb, offset, opt_tot_len, ett_dsr_options, NULL, "Options");\r\nwhile (offset - 4 < opt_tot_len) {\r\nopt_type = tvb_get_guint8(tvb, offset);\r\noffset_in_option = offset;\r\nopt_len = 0;\r\nswitch(opt_type) {\r\ncase DSR_OPT_TYPE_RREQ:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_rreq_opt, &ti, "Route request");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Route request");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option);\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_rreq_id, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\nopt_id = tvb_get_ntohs(tvb, offset_in_option);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " (id=0x%x)", opt_id);\r\noffset_in_option += 2;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_rreq_targetaddress, tvb, offset_in_option, 4, ENC_NA);\r\noffset_in_option += 4;\r\nif(opt_len > 6) {\r\nopt_hoplist_tree = proto_tree_add_subtree(opt_tree, tvb, offset_in_option, 1, ett_dsr_rreq_hoplist, &ti_hoplist, "Hop list" );\r\nproto_item_append_text(ti_hoplist, " :");\r\nfor(i=0;i<(opt_len-4)/4;i++) {\r\nproto_tree_add_item(opt_hoplist_tree, hf_dsr_opt_rreq_address, tvb, offset_in_option, 4, ENC_NA);\r\nproto_item_append_text(ti_hoplist, " %s", tvb_ip_to_str(tvb, offset_in_option));\r\noffset_in_option += 4;\r\n}\r\n}\r\nbreak;\r\ncase DSR_OPT_TYPE_RREP:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_rrep_opt, &ti, "Route reply");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Route reply");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option);\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_rrep_lasthopex, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_rrep_reserved, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nif(opt_len > 2) {\r\nopt_hoplist_tree = proto_tree_add_subtree(opt_tree, tvb, offset_in_option, 1, ett_dsr_rrep_hoplist, &ti_hoplist, "Hop list" );\r\nproto_item_append_text(ti_hoplist, " :");\r\nfor(i=0;i<(opt_len-1)/4;i++) {\r\nproto_tree_add_item(opt_hoplist_tree, hf_dsr_opt_rrep_address, tvb, offset_in_option, 4, ENC_NA);\r\nproto_item_append_text(ti_hoplist, " %s", tvb_ip_to_str(tvb, offset_in_option));\r\noffset_in_option += 4;\r\n}\r\n}\r\nbreak;\r\ncase DSR_OPT_TYPE_RERR:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_rerr_opt, &ti, "Route error");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Route error");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option);\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_type, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_err_type = tvb_get_guint8(tvb, offset_in_option);\r\noffset_in_option += 1;\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_err_reserved, tvb, offset_in_option*8, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_err_salvage, tvb, offset_in_option*8+4, 4, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_src, tvb, offset_in_option, 4, ENC_NA);\r\noffset_in_option += 4;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_dest, tvb, offset_in_option, 4, ENC_NA);\r\noffset_in_option += 4;\r\nswitch(opt_err_type) {\r\ncase DSR_RERR_TYPE_UNREACHABLE:\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_unreach_addr, tvb, offset_in_option, 4, ENC_NA);\r\nbreak;\r\ncase DSR_RERR_TYPE_FLOWSTATENOTSUPPORTED:\r\nbreak;\r\ncase DSR_RERR_TYPE_OPTIONNOTSUPPORTED:\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_unsupportedoption, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase DSR_RERR_TYPE_UNKNOWNFLOW:\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_unknownflow_dest, tvb, offset_in_option, 4, ENC_NA);\r\noffset_in_option += 4;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_unknownflow_id, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase DSR_RERR_TYPE_DEFAULTFLOWUNKNOWN:\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_err_defaultflowunknown_dest, tvb, offset_in_option, 4, ENC_NA);\r\nbreak;\r\n}\r\nbreak;\r\ncase DSR_OPT_TYPE_ACKREQ:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_ackreq_opt, &ti, "Acknowledgement request");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Ack request");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option);\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_ack_req_id, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\nopt_id = tvb_get_ntohs(tvb, offset_in_option);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " (id=0x%x)", opt_id);\r\noffset_in_option += 2;\r\nif(opt_len >= 6) {\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_ack_req_address, tvb, offset_in_option, 4, ENC_NA);\r\n}\r\nbreak;\r\ncase DSR_OPT_TYPE_ACK:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_ack_opt, &ti, "Acknowledgement");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Ack");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option);\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_ack_id, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\nopt_id = tvb_get_ntohs(tvb, offset_in_option);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " (id=0x%x)", opt_id);\r\noffset_in_option += 2;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_ack_src, tvb, offset_in_option, 4, ENC_NA);\r\noffset_in_option += 4;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_ack_dest, tvb, offset_in_option, 4, ENC_NA);\r\nbreak;\r\ncase DSR_OPT_TYPE_SRCRT:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_srcrt_opt, &ti, "Source route");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Source route");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option );\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_srcrt_firsthopext, tvb, offset_in_option*8, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_srcrt_lasthopext, tvb, offset_in_option*8+1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_srcrt_reserved, tvb, offset_in_option*8+2, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_bits_item(opt_tree, hf_dsr_opt_srcrt_salvage, tvb, offset_in_option*8+6, 4, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_opt_srcrt_segsleft, tvb, offset_in_option , 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nif(opt_len > 2) {\r\nopt_hoplist_tree = proto_tree_add_subtree(opt_tree, tvb, offset_in_option, 1, ett_dsr_srcrt_hoplist, &ti_hoplist, "Hop list" );\r\nproto_item_append_text(ti_hoplist, " :");\r\nfor(i=0;i<(opt_len-2)/4;i++) {\r\nproto_tree_add_item(opt_hoplist_tree, hf_dsr_opt_srcrt_address, tvb, offset_in_option , 4, ENC_NA);\r\nproto_item_append_text(ti_hoplist, " %s", tvb_ip_to_str(tvb, offset_in_option));\r\noffset_in_option += 4;\r\n}\r\n}\r\nbreak;\r\ncase DSR_OPT_TYPE_PADN:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_padn_opt, &ti, "PadN");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option , 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option , 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option );\r\nproto_item_set_len(ti, opt_len+2);\r\nbreak;\r\ncase DSR_OPT_TYPE_PAD1:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_pad1_opt, &ti, "Pad1");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option , 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase DSR_FS_OPT_TYPE_TIMEOUT :\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_fs_timeout_opt, &ti, "Timeout");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Timeout");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option );\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_fs_opt_timeout_timeout, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase DSR_FS_OPT_TYPE_DESTFLOWID:\r\nopt_tree = proto_tree_add_subtree(options_tree, tvb, offset_in_option, 1, ett_dsr_fs_destflowid_opt, &ti, "Destination and flow id");\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Dest&FlowId");\r\nproto_tree_add_item(opt_tree, hf_dsr_opttype, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_optlen, tvb, offset_in_option, 1, ENC_BIG_ENDIAN);\r\nopt_len = tvb_get_guint8(tvb, offset_in_option );\r\nproto_item_set_len(ti, opt_len+2);\r\noffset_in_option += 1;\r\nproto_tree_add_item(opt_tree, hf_dsr_fs_opt_destflowid_id, tvb, offset_in_option, 2, ENC_BIG_ENDIAN);\r\noffset_in_option += 2;\r\nproto_tree_add_item(opt_tree, hf_dsr_fs_opt_destflowid_dest, tvb, offset_in_option, 4, ENC_NA);\r\nbreak;\r\n}\r\nif (opt_type != DSR_OPT_TYPE_PAD1)\r\noffset += 2+opt_len;\r\nelse\r\noffset += 1;\r\nif(offset-4 < opt_tot_len && opt_type != DSR_OPT_TYPE_PAD1 && opt_type != DSR_OPT_TYPE_PADN) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, ", ");\r\n}\r\n}\r\n} else {\r\nproto_tree_add_item(dsr_tree, hf_dsr_fs_hopcount, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(dsr_tree, hf_dsr_fs_id, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\nif (!dissector_try_uint(ip_dissector_table, nexthdr, next_tvb, pinfo, tree)) {\r\ncall_data_dissector(next_tvb, pinfo, tree);\r\n}\r\nreturn offset+4;\r\n}\r\nvoid\r\nproto_register_dsr(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_dsr_nexthdr,\r\n{ "Next header", "dsr.nexthdr",\r\nFT_UINT8, BASE_HEX | BASE_EXT_STRING,\r\n&ipproto_val_ext, 0x0,\r\n"Next header protocol type", HFILL }\r\n},\r\n{ &hf_dsr_flowstate,\r\n{ "Flow state", "dsr.flowstate",\r\nFT_BOOLEAN, 8,\r\nNULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_reserved,\r\n{ "Reserved", "dsr.reserved",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x7F,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_length,\r\n{ "Length", "dsr.len",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\n"Payload length", HFILL }\r\n},\r\n{ &hf_dsr_opttype,\r\n{ "Type", "dsr.option.type",\r\nFT_UINT8, BASE_DEC,\r\nVALS(dsropttypenames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_optlen,\r\n{ "Length", "dsr.option.len",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\n"Option length", HFILL }\r\n},\r\n{ &hf_dsr_opt_rreq_id,\r\n{ "Id", "dsr.option.rreq.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_rreq_targetaddress,\r\n{ "Target address", "dsr.option.rreq.targetaddress",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"Target IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_rreq_address,\r\n{ "Hop", "dsr.option.rreq.address",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_rrep_lasthopex,\r\n{ "Last hop external", "dsr.option.rrep.lasthopex",\r\nFT_BOOLEAN, 8,\r\nNULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_rrep_reserved,\r\n{ "Reserved", "dsr.option.rrep.reserved",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x7F,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_rrep_address,\r\n{ "Hop", "dsr.option.rrep.address",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_err_type,\r\n{ "Type", "dsr.option.err.type",\r\nFT_UINT8, BASE_DEC,\r\nVALS(dsrrerrtypenames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_err_reserved,\r\n{ "Reserved", "dsr.option.err.reserved",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_err_salvage,\r\n{ "Salvage", "dsr.option.err.salvage",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_err_src,\r\n{ "Source address", "dsr.option.err.src",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x00,\r\n"Source IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_err_dest,\r\n{ "Destination address", "dsr.option.err.dest",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x00,\r\n"Destination IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_err_unreach_addr,\r\n{ "Unreachable node address", "dsr.option.err.unreachablenode",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x00,\r\n"Unreachable node IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_err_unsupportedoption,\r\n{ "Unsupported option", "dsr.option.err.unsupportedoption",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_ack_req_id,\r\n{ "Id", "dsr.option.ackreq.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_ack_req_address,\r\n{ "Source address", "dsr.option.ackreq.address",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"Source IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_ack_id,\r\n{ "Id", "dsr.option.ack.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_ack_src,\r\n{ "Source IP", "dsr.option.ack.source",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"Source IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_ack_dest,\r\n{ "Destination IP", "dsr.option.ack.dest",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"Destination IP address", HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_firsthopext,\r\n{ "First hop external", "dsr.option.srcrt.firsthopext",\r\nFT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_lasthopext,\r\n{ "Last hop external", "dsr.option.srcrt.lasthopext",\r\nFT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_reserved,\r\n{ "Reserved", "dsr.option.srcrt.reserved",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_salvage,\r\n{ "Salvage", "dsr.option.srcrt.salvage",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_segsleft,\r\n{ "Segments left", "dsr.option.srcrt.segsleft",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x3F,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_srcrt_address,\r\n{ "Hop", "dsr.option.ack.address",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"Hop IP address", HFILL }\r\n},\r\n{ &hf_dsr_fs_hopcount,\r\n{ "Hop count", "dsr.fs.hopcount",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x7F,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_fs_id,\r\n{ "Flow id", "dsr.fs.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_fs_opt_timeout_timeout,\r\n{ "Timeout", "dsr.option.timeout.timeout",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_fs_opt_destflowid_id,\r\n{ "Flow id", "dsr.option.destflowid.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x0,\r\n"New flow identifier", HFILL }\r\n},\r\n{ &hf_dsr_fs_opt_destflowid_dest,\r\n{ "Destination IP", "dsr.option.destflowid.dest",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\n"New IP destination address", HFILL }\r\n},\r\n{ &hf_dsr_opt_err_unknownflow_dest,\r\n{ "Original IP destination", "dsr.option.err.unknownflow.dest",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x00,\r\n"Original IP destination address", HFILL }\r\n},\r\n{ &hf_dsr_opt_err_unknownflow_id,\r\n{ "Flow id", "dsr.option.err.unknownflow.id",\r\nFT_UINT16, BASE_HEX_DEC,\r\nNULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_dsr_opt_err_defaultflowunknown_dest,\r\n{ "Original IP destination", "dsr.option.err.defaultflowunknow.dest",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x00,\r\n"Original IP destination address", HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_dsr,\r\n&ett_dsr_options,\r\n&ett_dsr_rreq_opt,\r\n&ett_dsr_rrep_opt,\r\n&ett_dsr_rerr_opt,\r\n&ett_dsr_ackreq_opt,\r\n&ett_dsr_ack_opt,\r\n&ett_dsr_srcrt_opt,\r\n&ett_dsr_padn_opt,\r\n&ett_dsr_pad1_opt,\r\n&ett_dsr_fs_timeout_opt,\r\n&ett_dsr_fs_destflowid_opt,\r\n&ett_dsr_rreq_hoplist,\r\n&ett_dsr_rrep_hoplist,\r\n&ett_dsr_srcrt_hoplist\r\n};\r\nproto_dsr = proto_register_protocol(\r\n"Dynamic Source Routing",\r\n"DSR",\r\n"dsr");\r\nproto_register_field_array(proto_dsr, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_dsr(void)\r\n{\r\ndissector_handle_t dsr_handle;\r\nip_dissector_table = find_dissector_table("ip.proto");\r\ndsr_handle = create_dissector_handle(dissect_dsr, proto_dsr);\r\ndissector_add_uint("ip.proto", IP_PROTO_DSR, dsr_handle);\r\n}
