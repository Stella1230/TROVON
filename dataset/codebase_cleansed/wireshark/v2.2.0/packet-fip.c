static proto_tree*\r\nfip_desc_type_len(proto_tree *tree, tvbuff_t *tvb, guint8 dtype, int ett, proto_item** item)\r\n{\r\nproto_tree* ret_tree;\r\nret_tree = proto_tree_add_subtree_format(tree, tvb, 0, -1, ett, item,\r\n"Descriptor: %s ", val_to_str_ext_const(dtype, &fip_desc_types_ext, "Unknown 0x%x"));\r\nproto_tree_add_item(ret_tree, hf_fip_desc_type, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(ret_tree, hf_fip_desc_len, tvb, 1, 1, ENC_BIG_ENDIAN);\r\nreturn ret_tree;\r\n}\r\nstatic void\r\nfip_desc_fc4f(tvbuff_t *tvb, proto_tree *tree, proto_item *item)\r\n{\r\nguint mask;\r\nguint offset;\r\nstatic const int *types_word0[] = {\r\n&hf_fip_type_ip,\r\n&hf_fip_type_fcp,\r\nNULL\r\n};\r\nstatic const int *types_word1[] = {\r\n&hf_fip_type_gs3,\r\nNULL\r\n};\r\nstatic const int *fcp_feat[] = {\r\n&hf_fip_fcp_feat_t,\r\n&hf_fip_fcp_feat_i,\r\nNULL\r\n};\r\noffset = 4;\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_fip_desc_fc4f_types,\r\nett_fip_dt_fc4f_types, types_word0, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_fip_desc_fc4f_types,\r\nett_fip_dt_fc4f_types, types_word1, ENC_BIG_ENDIAN);\r\noffset += 256 / 8 - 4;\r\noffset += 8 / 2;\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_fip_desc_fcp_feat,\r\nett_fip_dt_fcp_feat, fcp_feat, ENC_BIG_ENDIAN);\r\nmask = tvb_get_ntohl(tvb, offset);\r\nif (mask & 1) {\r\nproto_item_append_text(item, "FCP Target ");\r\n}\r\nif (mask & 2) {\r\nproto_item_append_text(item, "FCP Initiator ");\r\n}\r\n}\r\nstatic int\r\ndissect_fip(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint op;\r\nguint sub;\r\nguint rlen;\r\nproto_item *ti;\r\nproto_item *item;\r\nproto_tree *fip_tree;\r\nproto_tree *subtree;\r\nguint dtype;\r\nguint dlen;\r\nguint desc_offset;\r\nguint val;\r\ntvbuff_t *desc_tvb;\r\nconst char *info;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "FIP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (!tvb_bytes_exist(tvb, 0, FIP_HEADER_LEN)) {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "[packet too short]");\r\nproto_tree_add_protocol_format(tree, proto_fip, tvb, 0,\r\n-1, "FIP [packet too short]");\r\nreturn tvb_captured_length(tvb);\r\n}\r\nop = tvb_get_ntohs(tvb, 2);\r\nsub = tvb_get_guint8(tvb, 5);\r\nswitch (op) {\r\ncase FIP_OP_DISC:\r\ninfo = val_to_str(sub, fip_disc_subcodes, "Discovery 0x%x");\r\nbreak;\r\ncase FIP_OP_LS:\r\ninfo = val_to_str(sub, fip_ls_subcodes, "Link Service 0x%x");\r\nbreak;\r\ncase FIP_OP_CTRL:\r\ninfo = val_to_str(sub, fip_ctrl_subcodes, "Control 0x%x");\r\nbreak;\r\ncase FIP_OP_VLAN:\r\ninfo = val_to_str(sub, fip_vlan_subcodes, "VLAN 0x%x");\r\nbreak;\r\ncase FIP_OP_VN2VN:\r\ninfo = val_to_str(sub, fip_vn2vn_subcodes, "VN2VN 0x%x");\r\nbreak;\r\ndefault:\r\ninfo = val_to_str(op, fip_opcodes, "Unknown op 0x%x");\r\nbreak;\r\n}\r\ncol_add_str(pinfo->cinfo, COL_INFO, info);\r\nrlen = tvb_get_ntohs(tvb, 6);\r\nti = proto_tree_add_protocol_format(tree, proto_fip, tvb, 0,\r\nFIP_HEADER_LEN + rlen * FIP_BPW,\r\n"FIP %s", info);\r\nfip_tree = proto_item_add_subtree(ti, ett_fip);\r\nproto_tree_add_item(fip_tree, hf_fip_ver, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(fip_tree, hf_fip_reserved12, tvb, 0, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(fip_tree, hf_fip_op, tvb, 2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(fip_tree, hf_fip_reserved8, tvb, 4, 1, ENC_NA);\r\nswitch (op) {\r\ncase FIP_OP_DISC:\r\nproto_tree_add_item(fip_tree, hf_fip_disc_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FIP_OP_LS:\r\nproto_tree_add_item(fip_tree, hf_fip_ls_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FIP_OP_CTRL:\r\nproto_tree_add_item(fip_tree, hf_fip_ctrl_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FIP_OP_VLAN:\r\nproto_tree_add_item(fip_tree, hf_fip_vlan_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase FIP_OP_VN2VN:\r\nproto_tree_add_item(fip_tree, hf_fip_vn2vn_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(fip_tree, hf_fip_hex_subcode, tvb, 5, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\nproto_tree_add_item(fip_tree, hf_fip_dlen, tvb, 6, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_bitmask(fip_tree, tvb, 8, hf_fip_flags,\r\nett_fip_flags, hf_fip_flags_fields, ENC_BIG_ENDIAN);\r\ndesc_offset = FIP_HEADER_LEN;\r\nrlen *= FIP_BPW;\r\nproto_tree_add_bytes_format(fip_tree, hf_fip_descriptors, tvb, desc_offset, rlen, NULL, "Descriptors");\r\nwhile ((rlen > 0) && tvb_bytes_exist(tvb, desc_offset, 2)) {\r\ndlen = tvb_get_guint8(tvb, desc_offset + 1) * FIP_BPW;\r\nif (!dlen) {\r\nproto_tree_add_expert(fip_tree, pinfo, &ei_fip_descriptors, tvb, desc_offset, -1);\r\nbreak;\r\n}\r\nif (!tvb_bytes_exist(tvb, desc_offset, dlen) || dlen > rlen) {\r\nbreak;\r\n}\r\ndesc_tvb = tvb_new_subset(tvb, desc_offset, dlen, -1);\r\ndtype = tvb_get_guint8(desc_tvb, 0);\r\ndesc_offset += dlen;\r\nrlen -= dlen;\r\nswitch (dtype) {\r\ncase FIP_DT_PRI:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_pri, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_pri, desc_tvb,\r\n3, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(item, "%u", tvb_get_guint8(desc_tvb, 3));\r\nbreak;\r\ncase FIP_DT_MAC:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_mac, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_mac, desc_tvb,\r\n2, 6, ENC_NA);\r\nproto_item_append_text(item, "%s",\r\ntvb_bytes_to_str_punct(wmem_packet_scope(), desc_tvb, 2, 6, ':'));\r\nbreak;\r\ncase FIP_DT_MAP_OUI:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_map, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_map, desc_tvb,\r\n5, 3, ENC_NA);\r\nproto_item_append_text(item, "%s", tvb_fc_to_str(desc_tvb, 5));\r\nbreak;\r\ncase FIP_DT_NAME:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_name, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_name, desc_tvb, 4, 8, ENC_NA);\r\nproto_item_append_text(item, "%s", tvb_fcwwn_to_str(desc_tvb, 4));\r\nbreak;\r\ncase FIP_DT_FAB:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_fab, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_fab_vfid, desc_tvb,\r\n2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(subtree, hf_fip_desc_fab_map, desc_tvb,\r\n5, 3, ENC_NA);\r\nproto_tree_add_item(subtree, hf_fip_desc_fab_name, desc_tvb, 8, 8, ENC_NA);\r\nproto_item_append_text(item, "%s", tvb_fcwwn_to_str(desc_tvb, 8));\r\nbreak;\r\ncase FIP_DT_FCOE_SIZE:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_mdl, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_fcoe_size, desc_tvb,\r\n2, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(item, "%u", tvb_get_ntohs(desc_tvb, 2));\r\nbreak;\r\ncase FIP_DT_FLOGI:\r\ncase FIP_DT_FDISC:\r\ncase FIP_DT_LOGO:\r\ncase FIP_DT_ELP: {\r\ntvbuff_t *ls_tvb;\r\nfc_data_t fc_data = {ETHERTYPE_FIP, 0};\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_caps, &item);\r\nls_tvb = tvb_new_subset(desc_tvb, 4, dlen - 4, -1);\r\ncall_dissector_with_data(fc_handle, ls_tvb, pinfo, subtree, &fc_data);\r\nproto_item_append_text(item, "%u bytes", dlen - 4);\r\n}\r\nbreak;\r\ncase FIP_DT_VN:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_vn, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_vn_mac, desc_tvb,\r\n2, 6, ENC_NA);\r\nproto_tree_add_item(subtree, hf_fip_desc_vn_fid, desc_tvb,\r\n9, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(subtree, hf_fip_desc_vn_wwpn,\r\ndesc_tvb, 12, 8, ENC_NA);\r\nproto_item_append_text(item, "MAC %s FC_ID %6.6x",\r\ntvb_bytes_to_str_punct(wmem_packet_scope(), desc_tvb, 2, 6, ':'),\r\ntvb_get_ntoh24(desc_tvb, 9));\r\nbreak;\r\ncase FIP_DT_FKA:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_fka, &item);\r\nval = tvb_get_ntohl(desc_tvb, 4);\r\nproto_tree_add_uint_format_value(subtree, hf_fip_desc_fka,\r\ndesc_tvb, 4, 4, val, "%u ms", val);\r\nproto_item_append_text(item, "%u ms", val);\r\nbreak;\r\ncase FIP_DT_VEND:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_vend, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_vend, desc_tvb,\r\n4, 8, ENC_NA);\r\nif (tvb_bytes_exist(desc_tvb, 9, -1)) {\r\nproto_tree_add_item(subtree, hf_fip_desc_vend_data,\r\ndesc_tvb, 9, -1, ENC_NA);\r\n}\r\nbreak;\r\ncase FIP_DT_VLAN:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_vlan, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_vlan, desc_tvb,\r\n2, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(item, "%u", tvb_get_ntohs(desc_tvb, 2));\r\nbreak;\r\ncase FIP_DT_FC4F:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_fc4f, &item);\r\nfip_desc_fc4f(desc_tvb, subtree, item);\r\nbreak;\r\ndefault:\r\nsubtree = fip_desc_type_len(fip_tree, desc_tvb, dtype, ett_fip_dt_unk, &item);\r\nproto_tree_add_item(subtree, hf_fip_desc_unk, desc_tvb,\r\n2, -1, ENC_NA);\r\nbreak;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_fip(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_fip_ver,\r\n{ "Version", "fip.ver",\r\nFT_UINT8, BASE_DEC, NULL, 0xf0,\r\nNULL, HFILL}},\r\n{ &hf_fip_reserved12,\r\n{ "Reserved", "fip.reserved",\r\nFT_UINT16, BASE_HEX, NULL, 0x0fff,\r\nNULL, HFILL}},\r\n{ &hf_fip_op,\r\n{ "Opcode", "fip.opcode",\r\nFT_UINT16, BASE_HEX, VALS(fip_opcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_reserved8,\r\n{ "Reserved", "fip.reserved",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_fip_disc_subcode,\r\n{ "Discovery Subcode", "fip.disc_subcode",\r\nFT_UINT8, BASE_HEX, VALS(fip_disc_subcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_ls_subcode,\r\n{ "Link Service Subcode", "fip.ls.subcode",\r\nFT_UINT8, BASE_HEX, VALS(fip_ls_subcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_ctrl_subcode,\r\n{ "Control Subcode", "fip.ctrl_subcode",\r\nFT_UINT8, BASE_HEX, VALS(fip_ctrl_subcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_vlan_subcode,\r\n{ "VLAN Subcode", "fip.vlan_subcode",\r\nFT_UINT8, BASE_HEX, VALS(fip_vlan_subcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_vn2vn_subcode,\r\n{ "VN2VN Subcode", "fip.vn2vn_subcode",\r\nFT_UINT8, BASE_HEX, VALS(fip_vn2vn_subcodes), 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_hex_subcode,\r\n{ "Unknown Subcode", "fip.subcode",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_dlen,\r\n{ "Length of Descriptors (words)", "fip.dl_len",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_flags,\r\n{ "Flags", "fip.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_fpma,\r\n{ "Fabric Provided MAC addr", "fip.flags.fpma",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_FPMA,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_spma,\r\n{ "Server Provided MAC addr", "fip.flags.spma",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_SPMA,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_rec_p2p,\r\n{ "REC/P2P", "fip.flags.rec_p2p",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_REC_P2P,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_avail,\r\n{ "Available", "fip.flags.available",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_AVAIL,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_sol,\r\n{ "Solicited", "fip.flags.sol",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_SOL,\r\nNULL, HFILL}},\r\n{ &hf_fip_flag_fport,\r\n{ "F_Port", "fip.flags.fport",\r\nFT_BOOLEAN, 16, NULL, FIP_FL_FPORT,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_type,\r\n{ "Descriptor Type", "fip.desc_type",\r\nFT_UINT8, BASE_HEX | BASE_EXT_STRING, &fip_desc_types_ext, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_len,\r\n{ "Descriptor Length (words)", "fip.desc_len",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_pri,\r\n{ "Priority", "fip.pri",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_mac,\r\n{ "MAC Address", "fip.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_map,\r\n{ "FC-MAP-OUI", "fip.map",\r\nFT_BYTES, SEP_DOT, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_name,\r\n{ "Switch or Node Name", "fip.name",\r\nFT_FCWWN, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fab_vfid,\r\n{ "VFID", "fip.fab.vfid",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fab_map,\r\n{ "FC-MAP", "fip.fab.map",\r\nFT_BYTES, SEP_DOT, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fab_name,\r\n{ "Fabric Name", "fip.fab.name",\r\nFT_FCWWN, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fcoe_size,\r\n{ "Max FCoE frame size", "fip.fcoe_size",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vn_mac,\r\n{ "VN_Port MAC Address", "fip.vn.mac",\r\nFT_ETHER, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vn_fid,\r\n{ "VN_Port FC_ID", "fip.vn.fc_id",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vn_wwpn,\r\n{ "Port Name", "fip.vn.pwwn",\r\nFT_FCWWN, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fka,\r\n{ "FKA_ADV_Period", "fip.fka",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vend,\r\n{ "Vendor-ID", "fip.vendor",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vend_data,\r\n{ "Vendor-specific data", "fip.vendor.data",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_vlan,\r\n{ "VLAN", "fip.vlan",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fc4f_types,\r\n{ "FC4 Types", "fip.fc4f.types",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_fcp_feat,\r\n{ "FCP Features", "fip.fc4f.feat.fcp",\r\nFT_UINT32, BASE_HEX, NULL, 0xf,\r\nNULL, HFILL}},\r\n{ &hf_fip_type_ip,\r\n{ "IP", "fip.fc4f.ip",\r\nFT_BOOLEAN, 32, NULL, 1 << 5,\r\nNULL, HFILL}},\r\n{ &hf_fip_type_fcp,\r\n{ "FCP", "fip.fc4f.fcp",\r\nFT_BOOLEAN, 32, NULL, 1 << 8,\r\nNULL, HFILL}},\r\n{ &hf_fip_type_gs3,\r\n{ "GS3", "fip.fc4f.gs3",\r\nFT_BOOLEAN, 32, NULL, 1 << 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_fcp_feat_t,\r\n{ "FCP Target", "fip.fc4f.feat.fcp.target",\r\nFT_BOOLEAN, 32, NULL, 1,\r\nNULL, HFILL}},\r\n{ &hf_fip_fcp_feat_i,\r\n{ "FCP Initiator", "fip.fc4f.feat.fcp.initiator",\r\nFT_BOOLEAN, 32, NULL, 2,\r\nNULL, HFILL}},\r\n{ &hf_fip_desc_unk,\r\n{ "Unknown Descriptor", "fip.desc_unk",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n{ &hf_fip_descriptors,\r\n{ "Descriptors", "fip.descriptors",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL}},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_fip,\r\n&ett_fip_flags,\r\n&ett_fip_dt_pri,\r\n&ett_fip_dt_mac,\r\n&ett_fip_dt_map,\r\n&ett_fip_dt_name,\r\n&ett_fip_dt_fab,\r\n&ett_fip_dt_mdl,\r\n&ett_fip_dt_caps,\r\n&ett_fip_dt_vn,\r\n&ett_fip_dt_fka,\r\n&ett_fip_dt_vend,\r\n&ett_fip_dt_vlan,\r\n&ett_fip_dt_fc4f,\r\n&ett_fip_dt_fc4f_types,\r\n&ett_fip_dt_fcp_feat,\r\n&ett_fip_dt_unk\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_fip_descriptors, { "fip.descriptors.length_error", PI_MALFORMED, PI_ERROR, "Descriptor [length error]", EXPFILL }},\r\n};\r\nexpert_module_t* expert_fip;\r\nproto_fip = proto_register_protocol("FCoE Initialization Protocol",\r\n"FIP", "fip");\r\nproto_register_field_array(proto_fip, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_fip = expert_register_protocol(proto_fip);\r\nexpert_register_field_array(expert_fip, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_fip(void)\r\n{\r\ndissector_handle_t fip_handle;\r\nfip_handle = create_dissector_handle(dissect_fip, proto_fip);\r\ndissector_add_uint("ethertype", ETHERTYPE_FIP, fip_handle);\r\nfc_handle = find_dissector_add_dependency("fc", proto_fip);\r\n}
