static int\r\ndissect_ax4000(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *ax4000_tree;\r\nguint8 ax_port;\r\nguint8 ax_chassis;\r\nguint16 ax_index;\r\nguint32 ax_seq;\r\nguint32 ax_timestamp;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "AX4000");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nax_port = tvb_get_guint8(tvb, 0);\r\nax_chassis = tvb_get_guint8(tvb, 1);\r\nax_index = tvb_get_ntohs(tvb, 2) & 0x0FFF;\r\nax_timestamp = tvb_get_letohl(tvb, 6);\r\nax_seq = tvb_get_letohl(tvb, 10);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n"Chss:%u Prt:%u Idx:%u Seq:0x%08x TS:%.6f[msec]",\r\nax_chassis, ax_port, ax_index, ax_seq, ax_timestamp*1e-5);\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_ax4000, tvb, 0, -1, ENC_NA);\r\nax4000_tree = proto_item_add_subtree(ti, ett_ax4000);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_port, tvb, 0, 1, ax_port);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_chassis, tvb, 1, 1, ax_chassis);\r\nproto_tree_add_item(ax4000_tree,\r\nhf_ax4000_fill, tvb, 2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_index, tvb, 2, 2, ax_index);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_timestamp, tvb, 6, 4, ax_timestamp);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_seq, tvb, 10, 4, ax_seq);\r\nproto_tree_add_uint(ax4000_tree,\r\nhf_ax4000_crc, tvb, 14, 2, tvb_get_letohs(tvb, 14));\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_ax4000(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_ax4000_port,\r\n{ "Port Number", "ax4000.port",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_chassis,\r\n{ "Chassis Number", "ax4000.chassis",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_fill,\r\n{ "Fill Type", "ax4000.fill",\r\nFT_UINT8, BASE_DEC, NULL, 0xc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_index,\r\n{ "Index", "ax4000.index",\r\nFT_UINT16, BASE_DEC, NULL, 0x0FFF,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_timestamp,\r\n{ "Timestamp", "ax4000.timestamp",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_seq,\r\n{ "Sequence Number", "ax4000.seq",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ax4000_crc,\r\n{ "CRC (unchecked)", "ax4000.crc",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_ax4000\r\n};\r\nproto_ax4000 = proto_register_protocol("AX/4000 Test Block",\r\n"AX4000", "ax4000");\r\nproto_register_field_array(proto_ax4000, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_ax4000(void)\r\n{\r\ndissector_handle_t ax4000_handle;\r\nax4000_handle = create_dissector_handle(dissect_ax4000,\r\nproto_ax4000);\r\ndissector_add_uint("ip.proto", IP_PROTO_AX4000, ax4000_handle);\r\ndissector_add_uint("tcp.port", AX4000_TCP_PORT, ax4000_handle);\r\ndissector_add_uint("udp.port", AX4000_UDP_PORT, ax4000_handle);\r\n}
