static int\r\ndissect_PROTOABBREV(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree,\r\nvoid *data _U_)\r\n{\r\nproto_item *ti, *expert_ti;\r\nproto_tree *PROTOABBREV_tree;\r\nguint offset = 0;\r\nint len = 0;\r\nif (tvb_reported_length(tvb) < PROTOABBREV_MIN_LENGTH)\r\nreturn 0;\r\nif (tvb_captured_length(tvb) < MAX_NEEDED_FOR_HEURISTICS)\r\nreturn 0;\r\nif ( TEST_HEURISTICS_FAIL )\r\nreturn 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PROTOABBREV");\r\n#if 0\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\n#endif\r\ncol_set_str(pinfo->cinfo, COL_INFO, "XXX Request");\r\nti = proto_tree_add_item(tree, proto_PROTOABBREV, tvb, 0, -1, ENC_NA);\r\nPROTOABBREV_tree = proto_item_add_subtree(ti, ett_PROTOABBREV);\r\nexpert_ti = proto_tree_add_item(PROTOABBREV_tree, hf_PROTOABBREV_FIELDABBREV, tvb,\r\noffset, len, ENC_xxx);\r\noffset += len;\r\nif ( TEST_EXPERT_condition )\r\nexpert_add_info(pinfo, expert_ti, &ei_PROTOABBREV_EXPERTABBREV);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_PROTOABBREV(void)\r\n{\r\nmodule_t *PROTOABBREV_module;\r\nexpert_module_t *expert_PROTOABBREV;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_PROTOABBREV_FIELDABBREV,\r\n{ "FIELDNAME", "PROTOABBREV.FIELDABBREV",\r\nFT_FIELDTYPE, FIELDDISPLAY, FIELDCONVERT, BITMASK,\r\n"FIELDDESCR", HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_PROTOABBREV\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_PROTOABBREV_EXPERTABBREV,\r\n{ "PROTOABBREV.EXPERTABBREV", PI_SEVERITY, PI_GROUP,\r\n"EXPERTDESCR", EXPFILL }\r\n}\r\n};\r\nproto_PROTOABBREV = proto_register_protocol("PROTONAME",\r\n"PROTOSHORTNAME", "PROTOABBREV");\r\nproto_register_field_array(proto_PROTOABBREV, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_PROTOABBREV = expert_register_protocol(proto_PROTOABBREV);\r\nexpert_register_field_array(expert_PROTOABBREV, ei, array_length(ei));\r\nPROTOABBREV_module = prefs_register_protocol(proto_PROTOABBREV,\r\nproto_reg_handoff_PROTOABBREV);\r\nPROTOABBREV_module = prefs_register_protocol_subtree(const char *subtree,\r\nproto_PROTOABBREV, proto_reg_handoff_PROTOABBREV);\r\nprefs_register_bool_preference(PROTOABBREV_module, "show_hex",\r\n"Display numbers in Hex",\r\n"Enable to display numerical values in hexadecimal.",\r\n&pref_hex);\r\nprefs_register_uint_preference(PROTOABBREV_module, "tcp.port", "PROTOABBREV TCP Port",\r\n" PROTOABBREV TCP port if other than the default",\r\n10, &tcp_port_pref);\r\n}\r\nvoid\r\nproto_reg_handoff_PROTOABBREV(void)\r\n{\r\nstatic gboolean initialized = FALSE;\r\nstatic dissector_handle_t PROTOABBREV_handle;\r\nstatic int current_port;\r\nif (!initialized) {\r\nPROTOABBREV_handle = create_dissector_handle(dissect_PROTOABBREV,\r\nproto_PROTOABBREV);\r\ninitialized = TRUE;\r\n} else {\r\ndissector_delete_uint("tcp.port", current_port, PROTOABBREV_handle);\r\n}\r\ncurrent_port = tcp_port_pref;\r\ndissector_add_uint("tcp.port", current_port, PROTOABBREV_handle);\r\n}
