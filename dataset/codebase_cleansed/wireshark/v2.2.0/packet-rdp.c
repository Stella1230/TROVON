static rdp_conv_info_t *\r\nrdp_get_conversation_data(packet_info *pinfo)\r\n{\r\nconversation_t *conversation;\r\nrdp_conv_info_t *rdp_info;\r\nconversation = find_or_create_conversation(pinfo);\r\nrdp_info = (rdp_conv_info_t *)conversation_get_proto_data(conversation, proto_rdp);\r\nif (rdp_info == NULL) {\r\nrdp_info = wmem_new0(wmem_file_scope(), rdp_conv_info_t);\r\nrdp_info->staticChannelId = -1;\r\nrdp_info->encryptionMethod = 0;\r\nrdp_info->encryptionLevel = 0;\r\nrdp_info->licenseAgreed = 0;\r\nrdp_info->maxChannels = 0;\r\nconversation_add_proto_data(conversation, proto_rdp, rdp_info);\r\n}\r\nreturn rdp_info;\r\n}\r\nstatic int\r\ndissect_rdp_fields(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, const rdp_field_info_t *fields, int totlen)\r\n{\r\nconst rdp_field_info_t *c;\r\ngint len;\r\nint base_offset = offset;\r\nguint32 info_flags = 0;\r\nguint encoding;\r\nwhile (((c = fields++)->pfield) != NULL) {\r\nif ((c->fixedLength == 0) && (c->variableLength)) {\r\nlen = *(c->variableLength);\r\n} else {\r\nlen = c->fixedLength;\r\nif ((c->variableLength) && (c->fixedLength <= 4)) {\r\nswitch (c->fixedLength) {\r\ncase 1:\r\n*(c->variableLength) = tvb_get_guint8(tvb, offset);\r\nbreak;\r\ncase 2:\r\n*(c->variableLength) = tvb_get_letohs(tvb, offset);\r\nbreak;\r\ncase 4:\r\n*(c->variableLength) = tvb_get_letohl(tvb, offset);\r\nbreak;\r\ndefault:\r\nREPORT_DISSECTOR_BUG("Invalid length");\r\n}\r\n*(c->variableLength) += c->offsetOrTree;\r\n}\r\n}\r\nif (len) {\r\nproto_item *pi;\r\nif (c->flags & RDP_FI_STRING) {\r\nif (c->flags & RDP_FI_UNICODE)\r\nencoding = ENC_UTF_16|ENC_LITTLE_ENDIAN;\r\nelse if (c->flags & RDP_FI_ANSI)\r\nencoding = ENC_ASCII|ENC_NA;\r\nelse {\r\nencoding = (info_flags & INFO_UNICODE) ? ENC_UTF_16|ENC_LITTLE_ENDIAN : ENC_ASCII|ENC_NA;\r\n}\r\n} else\r\nencoding = ENC_LITTLE_ENDIAN;\r\npi = proto_tree_add_item(tree, *c->pfield, tvb, offset, len, encoding);\r\nif (c->flags & RDP_FI_INFO_FLAGS) {\r\nDISSECTOR_ASSERT(len == 4);\r\ninfo_flags = tvb_get_letohl(tvb, offset);\r\n}\r\nif (c->flags & RDP_FI_SUBTREE) {\r\nproto_tree *next_tree;\r\nif (c->offsetOrTree != -1)\r\nnext_tree = proto_item_add_subtree(pi, c->offsetOrTree);\r\nelse\r\nREPORT_DISSECTOR_BUG("Tree Error!!");\r\nif (c->subfields)\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, c->subfields, 0);\r\n}\r\nif (!(c->flags & RDP_FI_NOINCOFFSET))\r\noffset += len;\r\n}\r\nif ((totlen > 0) && ((offset-base_offset) >= totlen))\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_nyi(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, const char *info)\r\n{\r\nrdp_field_info_t nyi_fields[] = {\r\n{&hf_rdp_notYetImplemented, -1, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, nyi_fields, 0);\r\nif ((tree != NULL) && (info != NULL))\r\nproto_item_append_text(tree->last_child, " (%s)", info);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_encrypted(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, const char *info)\r\n{\r\nrdp_field_info_t enc_fields[] = {\r\n{&hf_rdp_encrypted, -1, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset,pinfo, tree, enc_fields, 0);\r\nif ((tree != NULL) && (info != NULL))\r\nproto_item_append_text(tree->last_child, " (%s)", info);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", "[Encrypted]");\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_clientNetworkData(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, guint length, rdp_conv_info_t *rdp_info)\r\n{\r\nproto_tree *next_tree;\r\nproto_item *pi;\r\nguint32 channelCount = 0;\r\nrdp_field_info_t net_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\nFI_VALUE(&hf_rdp_channelCount, 4, channelCount),\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t option_fields[] = {\r\n{&hf_rdp_optionsInitialized, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsEncryptRDP, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsEncryptSC, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsEncryptCS, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsPriHigh, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsPriMed, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsPriLow, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsCompressRDP, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsCompress, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsShowProtocol, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_optionsRemoteControlPersistent, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR,\r\n};\r\nrdp_field_info_t channel_fields[] = {\r\nFI_FIXEDLEN_ANSI_STRING(&hf_rdp_name, 8),\r\nFI_SUBTREE(&hf_rdp_options, 4, ett_rdp_options, option_fields),\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t def_fields[] = {\r\nFI_SUBTREE(&hf_rdp_channelDef, 12, ett_rdp_channelDef, channel_fields),\r\nFI_TERMINATOR\r\n};\r\npi = proto_tree_add_item(tree, hf_rdp_clientNetworkData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientNetworkData);\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, net_fields, 0);\r\nif (channelCount > 0) {\r\nguint i;\r\npi = proto_tree_add_item(next_tree, hf_rdp_channelDefArray, tvb, offset, channelCount * 12, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_channelDefArray);\r\nif (rdp_info)\r\nrdp_info->maxChannels = MIN(channelCount, MAX_CHANNELS);\r\nfor (i = 0; i < MIN(channelCount, MAX_CHANNELS); i++) {\r\nif (rdp_info) {\r\nrdp_info->channels[i].value = -1;\r\nrdp_info->channels[i].strptr = tvb_get_string_enc(wmem_packet_scope(), tvb, offset, 8, ENC_ASCII);\r\n}\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, def_fields, 0);\r\n}\r\nif (rdp_info) {\r\nrdp_info->channels[i].value = 0;\r\nrdp_info->channels[i].strptr = NULL;\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_basicSecurityHeader(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, guint32 *flags_ptr) {\r\nguint32 flags = 0;\r\nrdp_field_info_t secFlags_fields[] = {\r\n{&hf_rdp_flagsPkt, 2, &flags, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsEncrypt, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsResetSeqno, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsIgnoreSeqno, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsLicenseEncrypt,2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsSecureChecksum,2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsFlagsHiValid, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t flags_fields[] = {\r\nFI_SUBTREE(&hf_rdp_flags, 2, ett_rdp_flags, secFlags_fields),\r\nFI_FIXEDLEN(&hf_rdp_flagsHi, 2),\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, flags_fields, 0);\r\nif (flags_ptr)\r\n*flags_ptr = flags;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_securityHeader(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, rdp_conv_info_t *rdp_info, gboolean alwaysBasic, guint32 *flags_ptr) {\r\nrdp_field_info_t fips_fields[] = {\r\n{&hf_rdp_fipsLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_fipsVersion, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_padlen, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_dataSignature, 8, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t enc_fields[] = {\r\n{&hf_rdp_dataSignature, 8, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nconst rdp_field_info_t *fields = NULL;\r\nif (rdp_info) {\r\nif (alwaysBasic || (rdp_info->encryptionLevel != ENCRYPTION_LEVEL_NONE))\r\noffset = dissect_rdp_basicSecurityHeader(tvb, offset, pinfo, tree, flags_ptr);\r\nif (rdp_info->encryptionMethod &\r\n(ENCRYPTION_METHOD_40BIT |\r\nENCRYPTION_METHOD_128BIT |\r\nENCRYPTION_METHOD_56BIT)) {\r\nfields = enc_fields;\r\n} else if (rdp_info->encryptionMethod == ENCRYPTION_METHOD_FIPS) {\r\nfields = fips_fields;\r\n}\r\nif (fields)\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, fields, 0);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_channelPDU(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 length = 0;\r\nrdp_field_info_t flag_fields[] = {\r\n{&hf_rdp_channelFlagFirst, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelFlagLast, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelFlagShowProtocol, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelFlagSuspend, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelFlagResume, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelPacketCompressed, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelPacketAtFront, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelPacketFlushed, 4, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_channelPacketCompressionType, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t channel_fields[] = {\r\nFI_VALUE(&hf_rdp_length, 4, length),\r\nFI_SUBTREE(&hf_rdp_channelFlags, 4, ett_rdp_channelFlags, flag_fields),\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t channelPDU_fields[] = {\r\nFI_SUBTREE(&hf_rdp_channelPDUHeader, 8, ett_rdp_channelPDUHeader, channel_fields),\r\nFI_FIXEDLEN(&hf_rdp_virtualChannelData, -1),\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, channelPDU_fields, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_shareDataHeader(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 pduType2 = 0;\r\nguint32 compressedType;\r\nguint32 action = 0;\r\nrdp_field_info_t compressed_fields[] = {\r\n{&hf_rdp_compressedTypeType, 1, &compressedType, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_compressedTypeCompressed, 1, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_compressedTypeAtFront, 1, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_compressedTypeFlushed, 1, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t share_fields[] = {\r\n{&hf_rdp_shareId, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_pad1, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_streamId, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_uncompressedLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_pduType2, 1, &pduType2, 0, 0, NULL },\r\nFI_SUBTREE(&hf_rdp_compressedType, 1, ett_rdp_compressedType, compressed_fields),\r\n{&hf_rdp_compressedLength, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t control_fields[] = {\r\n{&hf_rdp_action, 2, &action, 0, 0, NULL },\r\n{&hf_rdp_grantId, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_controlId, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t sync_fields[] = {\r\n{&hf_rdp_messageType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_targetUser, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t mapflags_fields[] = {\r\n{&hf_rdp_fontMapFirst, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_fontMapLast, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t fontmap_fields[] = {\r\n{&hf_rdp_numberEntries, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalNumberEntries, 2, NULL, 0, 0, NULL },\r\nFI_SUBTREE(&hf_rdp_mapFlags, 2, ett_rdp_mapFlags, mapflags_fields),\r\n{&hf_rdp_entrySize, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t persistent_fields[] = {\r\n{&hf_rdp_numEntriesCache0, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_numEntriesCache1, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_numEntriesCache2, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_numEntriesCache3, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_numEntriesCache4, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalEntriesCache0, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalEntriesCache1, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalEntriesCache2, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalEntriesCache3, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_totalEntriesCache4, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_bBitMask, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_Pad2, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_Pad3, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nconst rdp_field_info_t *fields;\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, share_fields, 0);\r\nif (pduType2 != PDUTYPE2_CONTROL)\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", val_to_str_const(pduType2, rdp_pduType2_vals, "Unknown"));\r\nfields = NULL;\r\nswitch(pduType2) {\r\ncase PDUTYPE2_UPDATE:\r\nbreak;\r\ncase PDUTYPE2_CONTROL:\r\nfields = control_fields;\r\nbreak;\r\ncase PDUTYPE2_POINTER:\r\nbreak;\r\ncase PDUTYPE2_INPUT:\r\nbreak;\r\ncase PDUTYPE2_SYNCHRONIZE:\r\nfields = sync_fields;\r\nbreak;\r\ncase PDUTYPE2_REFRESH_RECT:\r\nbreak;\r\ncase PDUTYPE2_PLAY_SOUND:\r\nbreak;\r\ncase PDUTYPE2_SUPPRESS_OUTPUT:\r\nbreak;\r\ncase PDUTYPE2_SHUTDOWN_REQUEST:\r\nbreak;\r\ncase PDUTYPE2_SHUTDOWN_DENIED:\r\nbreak;\r\ncase PDUTYPE2_SAVE_SESSION_INFO:\r\nbreak;\r\ncase PDUTYPE2_FONTLIST:\r\nbreak;\r\ncase PDUTYPE2_FONTMAP:\r\nfields = fontmap_fields;\r\nbreak;\r\ncase PDUTYPE2_SET_KEYBOARD_INDICATORS:\r\nbreak;\r\ncase PDUTYPE2_BITMAPCACHE_PERSISTENT_LIST:\r\nfields = persistent_fields;\r\nbreak;\r\ncase PDUTYPE2_BITMAPCACHE_ERROR_PDU:\r\nbreak;\r\ncase PDUTYPE2_SET_KEYBOARD_IME_STATUS:\r\nbreak;\r\ncase PDUTYPE2_OFFSCRCACHE_ERROR_PDU:\r\nbreak;\r\ncase PDUTYPE2_SET_ERROR_INFO_PDU:\r\nbreak;\r\ncase PDUTYPE2_DRAWNINEGRID_ERROR_PDU:\r\nbreak;\r\ncase PDUTYPE2_DRAWGDIPLUS_ERROR_PDU:\r\nbreak;\r\ncase PDUTYPE2_ARC_STATUS_PDU:\r\nbreak;\r\ncase PDUTYPE2_STATUS_INFO_PDU:\r\nbreak;\r\ncase PDUTYPE2_MONITOR_LAYOUT_PDU:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (fields) {\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, fields, 0);\r\n}\r\nif (pduType2 == PDUTYPE2_CONTROL)\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", val_to_str_const(action, rdp_action_vals, "Unknown"));\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_capabilitySets(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree, guint32 numberCapabilities) {\r\nguint i;\r\nguint32 lengthCapability;\r\nrdp_field_info_t cs_fields[] = {\r\n{&hf_rdp_capabilitySetType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_lengthCapability, 2, &lengthCapability, -4, 0, NULL },\r\n{&hf_rdp_capabilityData, 0, &lengthCapability, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t set_fields[] = {\r\nFI_SUBTREE(&hf_rdp_capabilitySet, 0, ett_rdp_capabilitySet, cs_fields),\r\nFI_TERMINATOR\r\n};\r\nfor (i = 0; i < numberCapabilities; i++) {\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, set_fields, 0);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_demandActivePDU(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 lengthSourceDescriptor;\r\nguint32 numberCapabilities = 0;\r\nrdp_field_info_t fields[] = {\r\n{&hf_rdp_shareId, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_lengthSourceDescriptor, 2, &lengthSourceDescriptor, 0, 0, NULL },\r\n{&hf_rdp_lengthCombinedCapabilities, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_sourceDescriptor, 0, &lengthSourceDescriptor, 0, RDP_FI_STRING|RDP_FI_ANSI, NULL },\r\n{&hf_rdp_numberCapabilities, 2, &numberCapabilities, 0, 0, NULL },\r\n{&hf_rdp_pad2Octets, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t final_fields[] = {\r\n{&hf_rdp_sessionId, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, fields, 0);\r\noffset = dissect_rdp_capabilitySets(tvb, offset, pinfo, tree, numberCapabilities);\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, final_fields, 0);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_confirmActivePDU(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 lengthSourceDescriptor;\r\nguint32 numberCapabilities = 0;\r\nrdp_field_info_t fields[] = {\r\n{&hf_rdp_shareId, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_originatorId, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_lengthSourceDescriptor, 2, &lengthSourceDescriptor, 0, 0, NULL },\r\n{&hf_rdp_lengthCombinedCapabilities, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_sourceDescriptor, 0, &lengthSourceDescriptor, 0, 0, NULL },\r\n{&hf_rdp_numberCapabilities, 2, &numberCapabilities, 0, 0, NULL },\r\n{&hf_rdp_pad2Octets, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, tree, fields, 0);\r\noffset = dissect_rdp_capabilitySets(tvb, offset, pinfo, tree, numberCapabilities);\r\nreturn offset;\r\n}\r\nstatic proto_tree *\r\ndissect_rdp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree)\r\n{\r\nproto_item *item;\r\nproto_tree *tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RDP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_item(parent_tree, proto_rdp, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_rdp);\r\nreturn tree;\r\n}\r\nstatic int\r\ndissect_rdp_SendData(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\nproto_item *pi;\r\nint offset = 0;\r\nguint32 flags = 0;\r\nguint32 cbDomain, cbUserName, cbPassword, cbAlternateShell, cbWorkingDir,\r\ncbClientAddress, cbClientDir, cbAutoReconnectLen, wBlobLen, pduType = 0;\r\nguint32 bMsgType = 0xffffffff;\r\nguint32 encryptedLen = 0;\r\nconversation_t *conversation;\r\nrdp_conv_info_t *rdp_info;\r\nrdp_field_info_t secFlags_fields[] = {\r\n{&hf_rdp_flagsPkt, 2, &flags, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsEncrypt, 2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsResetSeqno, 2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsIgnoreSeqno, 2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsLicenseEncrypt,2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsSecureChecksum,2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_flagsFlagsHiValid, 2, NULL , 0, RDP_FI_NOINCOFFSET, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t se_fields[] = {\r\nFI_SUBTREE(&hf_rdp_flags, 2, ett_rdp_flags, secFlags_fields),\r\nFI_FIXEDLEN(&hf_rdp_flagsHi, 2),\r\n{&hf_rdp_length, 4, &encryptedLen, 0, 0, NULL },\r\n{&hf_rdp_encryptedClientRandom, 0, &encryptedLen, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t systime_fields [] = {\r\nFI_FIXEDLEN(&hf_rdp_wYear , 2),\r\nFI_FIXEDLEN(&hf_rdp_wMonth , 2),\r\nFI_FIXEDLEN(&hf_rdp_wDayOfWeek , 2),\r\nFI_FIXEDLEN(&hf_rdp_wDay , 2),\r\nFI_FIXEDLEN(&hf_rdp_wHour , 2),\r\nFI_FIXEDLEN(&hf_rdp_wMinute , 2),\r\nFI_FIXEDLEN(&hf_rdp_wSecond , 2),\r\nFI_FIXEDLEN(&hf_rdp_wMilliseconds, 2),\r\nFI_TERMINATOR,\r\n};\r\nrdp_field_info_t tz_info_fields [] = {\r\nFI_FIXEDLEN(&hf_rdp_Bias, 4),\r\n{&hf_rdp_StandardName, 64, NULL, 0, RDP_FI_STRING|RDP_FI_UNICODE, NULL },\r\nFI_SUBTREE(&hf_rdp_StandardDate, 16, ett_rdp_StandardDate, systime_fields),\r\nFI_FIXEDLEN(&hf_rdp_StandardBias, 4),\r\n{&hf_rdp_DaylightName, 64, NULL, 0, RDP_FI_STRING|RDP_FI_UNICODE, NULL },\r\nFI_SUBTREE(&hf_rdp_DaylightDate, 16, ett_rdp_DaylightDate, systime_fields),\r\nFI_FIXEDLEN(&hf_rdp_DaylightBias, 4),\r\nFI_TERMINATOR,\r\n};\r\nrdp_field_info_t ue_fields[] = {\r\n{&hf_rdp_codePage, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_optionFlags, 4, NULL, 0, RDP_FI_INFO_FLAGS, NULL },\r\n{&hf_rdp_cbDomain, 2, &cbDomain, 2, 0, NULL },\r\n{&hf_rdp_cbUserName, 2, &cbUserName, 2, 0, NULL },\r\n{&hf_rdp_cbPassword, 2, &cbPassword, 2, 0, NULL },\r\n{&hf_rdp_cbAlternateShell, 2, &cbAlternateShell, 2, 0, NULL },\r\n{&hf_rdp_cbWorkingDir, 2, &cbWorkingDir, 2, 0, NULL },\r\n{&hf_rdp_domain, 0, &cbDomain, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_userName, 0, &cbUserName, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_password, 0, &cbPassword, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_alternateShell, 0, &cbAlternateShell, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_workingDir, 0, &cbWorkingDir, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_clientAddressFamily,2, NULL, 0, 0, NULL },\r\n{&hf_rdp_cbClientAddress, 2, &cbClientAddress, 0, 0, NULL },\r\n{&hf_rdp_clientAddress, 0, &cbClientAddress, 0, RDP_FI_STRING, NULL },\r\n{&hf_rdp_cbClientDir, 2, &cbClientDir, 0, 0, NULL },\r\n{&hf_rdp_clientDir, 0, &cbClientDir, 0, RDP_FI_STRING, NULL },\r\nFI_SUBTREE(&hf_rdp_clientTimeZone, 172, ett_rdp_clientTimeZone, tz_info_fields),\r\n{&hf_rdp_clientSessionId, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_performanceFlags, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_cbAutoReconnectLen, 2, &cbAutoReconnectLen, 0, 0, NULL },\r\n{&hf_rdp_autoReconnectCookie,0, &cbAutoReconnectLen, 0, 0, NULL },\r\n{&hf_rdp_reserved1, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_reserved2, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t msg_fields[] = {\r\n{&hf_rdp_bMsgType, 1, &bMsgType, 0, 0, NULL },\r\n{&hf_rdp_bVersion, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_wMsgSize, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t error_fields[] = {\r\n{&hf_rdp_wErrorCode, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_wStateTransition, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_wBlobType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_wBlobLen, 2, &wBlobLen, 0, 0, NULL },\r\n{&hf_rdp_blobData, 0, &wBlobLen, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t pdu_fields[] = {\r\n{&hf_rdp_pduTypeType, 2, &pduType, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_pduTypeVersionLow, 2, NULL, 0, RDP_FI_NOINCOFFSET, NULL },\r\n{&hf_rdp_pduTypeVersionHigh, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t ctrl_fields[] = {\r\n{&hf_rdp_totalLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_pduType, 2, NULL, ett_rdp_pduType, RDP_FI_SUBTREE,\r\npdu_fields },\r\n{&hf_rdp_pduSource, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\ntree = dissect_rdp(tvb, pinfo, tree);\r\npi = proto_tree_add_item(tree, hf_rdp_SendData, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(pi, ett_rdp_SendData);\r\nconversation = find_or_create_conversation(pinfo);\r\nrdp_info = (rdp_conv_info_t *)conversation_get_proto_data(conversation, proto_rdp);\r\nif (rdp_info &&\r\n((rdp_info->licenseAgreed == 0) ||\r\n(pinfo->num <= rdp_info->licenseAgreed))) {\r\nproto_tree *next_tree;\r\nflags = tvb_get_letohs(tvb, offset);\r\nswitch(flags & SEC_PKT_MASK) {\r\ncase SEC_EXCHANGE_PKT:\r\npi = proto_tree_add_item(tree, hf_rdp_securityExchangePDU, tvb, offset, -1, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_securityExchangePDU);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, " ", "SecurityExchange");\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, se_fields, 0);\r\nbreak;\r\ncase SEC_INFO_PKT:\r\npi = proto_tree_add_item(tree, hf_rdp_clientInfoPDU, tvb, offset, -1, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientInfoPDU);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, " ", "ClientInfo");\r\noffset = dissect_rdp_securityHeader(tvb, offset, pinfo, next_tree, rdp_info, TRUE, NULL);\r\nif (!(flags & SEC_ENCRYPT)) {\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, ue_fields, 0);\r\n} else {\r\ndissect_rdp_encrypted(tvb, offset, pinfo, next_tree, NULL);\r\n}\r\nbreak;\r\ncase SEC_LICENSE_PKT:\r\npi = proto_tree_add_item(tree, hf_rdp_validClientLicenseData, tvb, offset, -1, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_validClientLicenseData);\r\noffset = dissect_rdp_securityHeader(tvb, offset, pinfo, next_tree, rdp_info, TRUE, NULL);\r\nif (!(flags & SEC_ENCRYPT)) {\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, msg_fields, 0);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", val_to_str_const(bMsgType, rdp_bMsgType_vals, "Unknown"));\r\nswitch(bMsgType) {\r\ncase LICENSE_REQUEST:\r\ncase PLATFORM_CHALLENGE:\r\ncase NEW_LICENSE:\r\ncase UPGRADE_LICENSE:\r\ncase LICENSE_INFO:\r\ncase NEW_LICENSE_REQUEST:\r\ncase PLATFORM_CHALLENGE_RESPONSE:\r\ndissect_rdp_nyi(tvb, offset, pinfo, next_tree, "RDPELE not implemented");\r\nbreak;\r\ncase ERROR_ALERT:\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, error_fields, 0);\r\nrdp_info->licenseAgreed = pinfo->num;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n} else {\r\ndissect_rdp_encrypted(tvb, offset, pinfo, next_tree, NULL);\r\nrdp_info->licenseAgreed = pinfo->num;\r\n}\r\nbreak;\r\ncase SEC_REDIRECTION_PKT:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nif (rdp_info && (t124_get_last_channelId() == rdp_info->staticChannelId)) {\r\noffset = dissect_rdp_securityHeader(tvb, offset, pinfo, tree, rdp_info, FALSE, &flags);\r\nif (!(flags & SEC_ENCRYPT)) {\r\nproto_tree *next_tree;\r\npi = proto_tree_add_item(tree, hf_rdp_shareControlHeader, tvb, offset, -1, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_shareControlHeader);\r\noffset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, ctrl_fields, 0);\r\npduType &= PDUTYPE_TYPE_MASK;\r\nif (pduType != PDUTYPE_DATAPDU)\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, ", ", val_to_str_const(pduType, rdp_pduTypeType_vals, "Unknown"));\r\nswitch(pduType) {\r\ncase PDUTYPE_DEMANDACTIVEPDU:\r\ndissect_rdp_demandActivePDU(tvb, offset, pinfo, next_tree);\r\nbreak;\r\ncase PDUTYPE_CONFIRMACTIVEPDU:\r\ndissect_rdp_confirmActivePDU(tvb, offset, pinfo, next_tree);\r\nbreak;\r\ncase PDUTYPE_DEACTIVATEALLPDU:\r\nbreak;\r\ncase PDUTYPE_DATAPDU:\r\ndissect_rdp_shareDataHeader(tvb, offset, pinfo, next_tree);\r\nbreak;\r\ncase PDUTYPE_SERVER_REDIR_PKT:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n} else {\r\ndissect_rdp_encrypted(tvb, offset, pinfo, tree, NULL);\r\n}\r\ncol_set_fence(pinfo->cinfo, COL_INFO);\r\nreturn tvb_captured_length(tvb);\r\n}\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, " ", "Virtual Channel PDU");\r\noffset = dissect_rdp_securityHeader(tvb, offset, pinfo, tree, rdp_info, FALSE, &flags);\r\nif (!(flags & SEC_ENCRYPT))\r\ndissect_rdp_channelPDU(tvb, offset, pinfo, tree);\r\nelse\r\ndissect_rdp_encrypted(tvb, offset, pinfo, tree, "Channel PDU");\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_rdp_ClientData(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\nint offset = 0;\r\nproto_item *pi;\r\nproto_tree *next_tree;\r\nguint16 type;\r\nguint length;\r\nrdp_conv_info_t *rdp_info;\r\nrdp_field_info_t header_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t core_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_versionMajor, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_versionMinor, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_desktopWidth, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_desktopHeight, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_colorDepth, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_SASSequence, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_keyboardLayout, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_clientBuild, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_clientName, 32, NULL, 0, RDP_FI_STRING|RDP_FI_UNICODE, NULL },\r\n{&hf_rdp_keyboardType, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_keyboardSubType, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_keyboardFunctionKey, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_imeFileName, 64, NULL, 0, 0, NULL },\r\n{&hf_rdp_postBeta2ColorDepth, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_clientProductId, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_serialNumber, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_highColorDepth, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_supportedColorDepths, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_earlyCapabilityFlags, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_clientDigProductId, 64, NULL, 0, RDP_FI_STRING|RDP_FI_UNICODE, NULL },\r\n{&hf_rdp_connectionType, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_pad1octet, 1, NULL, 0, 0, NULL },\r\n{&hf_rdp_serverSelectedProtocol, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t security_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_encryptionMethods, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_extEncryptionMethods, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t cluster_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_cluster_flags, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_redirectedSessionId, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t msgchannel_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_msgChannelFlags, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t monitor_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_monitorCount, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t monitorex_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_monitorExFlags, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_monitorAttributeSize, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_monitorCount, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t multitransport_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_multiTransportFlags, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\ntree = dissect_rdp(tvb, pinfo, tree);\r\nrdp_info = rdp_get_conversation_data(pinfo);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, " ", "ClientData");\r\npi = proto_tree_add_item(tree, hf_rdp_ClientData, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(pi, ett_rdp_ClientData);\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\ntype = tvb_get_letohs(tvb, offset);\r\nlength = tvb_get_letohs(tvb, offset+2);\r\n#if 0\r\nprintf("offset=%d, type=%x, length=%d, remaining=%d\n",\r\noffset, type, length, tvb_captured_length_remaining(tvb, offset));\r\n#endif\r\nswitch(type) {\r\ncase CS_CORE:\r\npi = proto_tree_add_item(tree, hf_rdp_clientCoreData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientCoreData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, core_fields, length);\r\nbreak;\r\ncase CS_SECURITY:\r\npi = proto_tree_add_item(tree, hf_rdp_clientSecurityData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientSecurityData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, security_fields, 0);\r\nbreak;\r\ncase CS_NET:\r\ndissect_rdp_clientNetworkData(tvb, offset, pinfo, tree, length, rdp_info);\r\nbreak;\r\ncase CS_CLUSTER:\r\npi = proto_tree_add_item(tree, hf_rdp_clientClusterData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientClusterData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, cluster_fields, 0);\r\nbreak;\r\ncase CS_MONITOR:\r\npi = proto_tree_add_item(tree, hf_rdp_clientMonitorData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientMonitorData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, monitor_fields, 0);\r\nbreak;\r\ncase CS_MONITOR_EX:\r\npi = proto_tree_add_item(tree, hf_rdp_clientMonitorExData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientMonitorExData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, monitorex_fields, 0);\r\nbreak;\r\ncase CS_MCS_MSGCHANNEL:\r\npi = proto_tree_add_item(tree, hf_rdp_clientMsgChannelData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientMsgChannelData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, msgchannel_fields, 0);\r\nbreak;\r\ncase CS_MULTITRANSPORT:\r\npi = proto_tree_add_item(tree, hf_rdp_clientMultiTransportData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientMultiTransportData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, multitransport_fields, 0);\r\nbreak;\r\ndefault:\r\npi = proto_tree_add_item(tree, hf_rdp_clientUnknownData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_clientUnknownData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, header_fields, 0);\r\nbreak;\r\n}\r\noffset += MAX(4, length);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_rdp_ServerData(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_) {\r\nint offset = 0;\r\nproto_item *pi;\r\nproto_tree *next_tree;\r\nguint16 type;\r\nguint length;\r\nguint32 serverRandomLen = 0;\r\nguint32 serverCertLen = 0;\r\nguint32 encryptionMethod = 0;\r\nguint32 encryptionLevel = 0;\r\nguint32 channelCount = 0;\r\nguint32 channelId = 0;\r\nguint i;\r\nrdp_conv_info_t *rdp_info;\r\nrdp_field_info_t header_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t sc_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_versionMajor, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_versionMinor, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_clientRequestedProtocols, 4, NULL, 0, 0, NULL },\r\n{&hf_rdp_earlyCapabilityFlags, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t ss_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_encryptionMethod, 4, &encryptionMethod, 0, 0, NULL },\r\n{&hf_rdp_encryptionLevel, 4, &encryptionLevel, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t encryption_fields[] = {\r\n{&hf_rdp_serverRandomLen, 4, &serverRandomLen, 0, 0, NULL },\r\n{&hf_rdp_serverCertLen, 4, &serverCertLen, 0, 0, NULL },\r\n{&hf_rdp_serverRandom, 0, &serverRandomLen, 0, 0, NULL },\r\n{&hf_rdp_serverCertificate, 0, &serverCertLen, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t sn_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_MCSChannelId, 2, &channelId, 0, 0, NULL },\r\n{&hf_rdp_channelCount, 2, &channelCount, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t array_fields[] = {\r\n{&hf_rdp_channelIdArray, 0 , NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t channel_fields[] = {\r\n{&hf_rdp_MCSChannelId, 2, &channelId, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t pad_fields[] = {\r\n{&hf_rdp_Pad, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t msgchannel_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_msgChannelId, 2, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\nrdp_field_info_t multitransport_fields[] = {\r\n{&hf_rdp_headerType, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_headerLength, 2, NULL, 0, 0, NULL },\r\n{&hf_rdp_multiTransportFlags, 4, NULL, 0, 0, NULL },\r\nFI_TERMINATOR\r\n};\r\ntree = dissect_rdp(tvb, pinfo, tree);\r\nrdp_info = rdp_get_conversation_data(pinfo);\r\ncol_append_sep_str(pinfo->cinfo, COL_INFO, " ", "ServerData");\r\npi = proto_tree_add_item(tree, hf_rdp_ServerData, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(pi, ett_rdp_ServerData);\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\ntype = tvb_get_letohs(tvb, offset);\r\nlength = tvb_get_letohs(tvb, offset+2);\r\nswitch(type) {\r\ncase SC_CORE:\r\npi = proto_tree_add_item(tree, hf_rdp_serverCoreData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverCoreData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, sc_fields, length);\r\nbreak;\r\ncase SC_SECURITY: {\r\ngint lcl_offset;\r\npi = proto_tree_add_item(tree, hf_rdp_serverSecurityData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverSecurityData);\r\nlcl_offset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, ss_fields, 0);\r\ncol_append_sep_fstr(pinfo->cinfo, COL_INFO, " ", "Encryption: %s (%s)",\r\nval_to_str_const(encryptionMethod, rdp_encryptionMethod_vals, "Unknown"),\r\nval_to_str_const(encryptionLevel, rdp_encryptionLevel_vals, "Unknown"));\r\nif ((encryptionLevel != 0) || (encryptionMethod != 0)) {\r\ndissect_rdp_fields(tvb, lcl_offset, pinfo, next_tree, encryption_fields, 0);\r\n}\r\nrdp_info->encryptionMethod = encryptionMethod;\r\nrdp_info->encryptionLevel = encryptionLevel;\r\nbreak;\r\n}\r\ncase SC_NET: {\r\ngint lcl_offset;\r\npi = proto_tree_add_item(tree, hf_rdp_serverNetworkData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverNetworkData);\r\nlcl_offset = dissect_rdp_fields(tvb, offset, pinfo, next_tree, sn_fields, 0);\r\nrdp_info->staticChannelId = channelId;\r\nregister_t124_sd_dissector(pinfo, channelId, dissect_rdp_SendData, proto_rdp);\r\nif (channelCount > 0) {\r\narray_fields[0].fixedLength = channelCount * 2;\r\ndissect_rdp_fields(tvb, lcl_offset, pinfo, next_tree, array_fields, 0);\r\nif (next_tree)\r\nnext_tree = proto_item_add_subtree(next_tree->last_child, ett_rdp_channelIdArray);\r\nfor (i = 0; i < channelCount; i++) {\r\nlcl_offset = dissect_rdp_fields(tvb, lcl_offset, pinfo, next_tree, channel_fields, 0);\r\nif (i < MAX_CHANNELS)\r\nrdp_info->channels[i].value = channelId;\r\nregister_t124_sd_dissector(pinfo, channelId, dissect_rdp_SendData, proto_rdp);\r\n}\r\nif (channelCount % 2)\r\ndissect_rdp_fields(tvb, lcl_offset, pinfo, next_tree, pad_fields, 0);\r\n}\r\nbreak;\r\n}\r\ncase SC_MCS_MSGCHANNEL:\r\npi = proto_tree_add_item(tree, hf_rdp_serverMsgChannelData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverMsgChannelData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, msgchannel_fields, length);\r\nbreak;\r\ncase SC_MULTITRANSPORT:\r\npi = proto_tree_add_item(tree, hf_rdp_serverMultiTransportData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverMultiTransportData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, multitransport_fields, length);\r\nbreak;\r\ndefault:\r\npi = proto_tree_add_item(tree, hf_rdp_serverUnknownData, tvb, offset, length, ENC_NA);\r\nnext_tree = proto_item_add_subtree(pi, ett_rdp_serverUnknownData);\r\ndissect_rdp_fields(tvb, offset, pinfo, next_tree, header_fields, 0);\r\nbreak;\r\n}\r\noffset += MAX(4, length);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_rdpCorrelationInfo(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 type;\r\nguint32 length;\r\nproto_item *type_item, *length_item;\r\ntype_item = proto_tree_add_item_ret_uint(tree, hf_rdp_neg_type, tvb, offset, 1, ENC_NA, &type);\r\noffset += 1;\r\nif (type != TYPE_RDP_CORRELATION_INFO) {\r\nexpert_add_info(pinfo, type_item, &ei_rdp_not_correlation_info);\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_rdp_correlationInfo_flags, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nlength_item = proto_tree_add_item_ret_uint(tree, hf_rdp_neg_length, tvb, offset, 1, ENC_LITTLE_ENDIAN, &length);\r\noffset += 2;\r\nif (length != 36) {\r\nexpert_add_info_format(pinfo, length_item, &ei_rdp_neg_len_invalid, "RDP Correlation Info length is %u, not 36", length);\r\nreturn offset;\r\n}\r\nproto_tree_add_item(tree, hf_rdp_correlationId, tvb, offset, 16, ENC_NA);\r\noffset += 16;\r\nproto_tree_add_item(tree, hf_rdp_correlationInfo_reserved, tvb, offset, 16, ENC_NA);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdpNegReq(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint64 flags;\r\nguint32 length;\r\nproto_item *length_item;\r\nstatic const int *flag_bits[] = {\r\n&hf_rdp_negReq_flag_restricted_admin_mode_req,\r\n&hf_rdp_negReq_flag_correlation_info_present,\r\nNULL\r\n};\r\nstatic const int *requestedProtocols_bits[] = {\r\n&hf_rdp_requestedProtocols_flag_ssl,\r\n&hf_rdp_requestedProtocols_flag_hybrid,\r\n&hf_rdp_requestedProtocols_flag_hybrid_ex,\r\nNULL\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Negotiate Request");\r\nproto_tree_add_item(tree, hf_rdp_neg_type, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_bitmask_ret_uint64(tree, tvb, offset, hf_rdp_negReq_flags,\r\nett_negReq_flags, flag_bits,\r\nENC_LITTLE_ENDIAN, &flags);\r\noffset += 1;\r\nlength_item = proto_tree_add_item_ret_uint(tree, hf_rdp_neg_length, tvb, offset, 1, ENC_LITTLE_ENDIAN, &length);\r\noffset += 2;\r\nif (length != 8) {\r\nexpert_add_info_format(pinfo, length_item, &ei_rdp_neg_len_invalid, "RDP Negotiate Request length is %u, not 8", length);\r\nreturn offset;\r\n}\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_rdp_requestedProtocols,\r\nett_requestedProtocols, requestedProtocols_bits,\r\nENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nif (flags & CORRELATION_INFO_PRESENT)\r\noffset = dissect_rdpCorrelationInfo(tvb, offset, pinfo, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_cr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nint offset = 0;\r\ngboolean have_cookie = FALSE;\r\ngboolean have_rdpNegRequest = FALSE;\r\nproto_item *item;\r\nproto_tree *tree;\r\ngint linelen, next_offset;\r\nconst guint8 *stringval;\r\nconst char *sep = "";\r\nif (tvb_memeql(tvb, offset, "Cookie: ", 8) == 0) {\r\nhave_cookie = TRUE;\r\n} else if (tvb_bytes_exist(tvb, offset, 4) &&\r\ntvb_get_guint8(tvb, offset) == TYPE_RDP_NEG_REQ &&\r\ntvb_get_letohs(tvb, offset + 2) == 8) {\r\nhave_rdpNegRequest = TRUE;\r\n}\r\nif (!have_cookie && !have_rdpNegRequest) {\r\nreturn 0;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RDP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_item(parent_tree, proto_rdp, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_rdp);\r\nif (have_cookie) {\r\nlinelen = tvb_find_line_end(tvb, offset, -1, &next_offset, TRUE);\r\nproto_tree_add_item_ret_string(tree, hf_rdp_rt_cookie, tvb, offset,\r\nlinelen, ENC_ASCII|ENC_NA,\r\nwmem_packet_scope(), &stringval);\r\noffset = (linelen == -1) ? (gint)tvb_captured_length(tvb) : next_offset;\r\ncol_append_str(pinfo->cinfo, COL_INFO, format_text(stringval, strlen(stringval)));\r\nsep = ", ";\r\n}\r\nif (tvb_reported_length_remaining(tvb, offset) > 0) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, sep);\r\noffset = dissect_rdpNegReq(tvb, offset, pinfo, tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdpNegRsp(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 length;\r\nproto_item *length_item;\r\nstatic const int *flag_bits[] = {\r\n&hf_rdp_negRsp_flag_extended_client_data_supported,\r\n&hf_rdp_negRsp_flag_dynvc_gfx_protocol_supported,\r\n&hf_rdp_negRsp_flag_restricted_admin_mode_supported,\r\nNULL\r\n};\r\nstatic const int *selectedProtocol_bits[] = {\r\n&hf_rdp_selectedProtocol_flag_ssl,\r\n&hf_rdp_selectedProtocol_flag_hybrid,\r\n&hf_rdp_selectedProtocol_flag_hybrid_ex,\r\nNULL\r\n};\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Negotiate Response");\r\nproto_tree_add_item(tree, hf_rdp_neg_type, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_rdp_negRsp_flags,\r\nett_negRsp_flags, flag_bits,\r\nENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nlength_item = proto_tree_add_item_ret_uint(tree, hf_rdp_neg_length, tvb, offset, 1, ENC_LITTLE_ENDIAN, &length);\r\noffset += 2;\r\nif (length != 8) {\r\nexpert_add_info_format(pinfo, length_item, &ei_rdp_neg_len_invalid, "RDP Negotiate Response length is %u, not 8", length);\r\nreturn offset;\r\n}\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_rdp_selectedProtocol,\r\nett_selectedProtocol, selectedProtocol_bits,\r\nENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdpNegFailure(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *tree) {\r\nguint32 length;\r\nproto_item *length_item;\r\nguint32 failureCode;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Negotiate Failure");\r\nproto_tree_add_item(tree, hf_rdp_neg_type, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_rdp_negReq_flags, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nlength_item = proto_tree_add_item_ret_uint(tree, hf_rdp_neg_length, tvb, offset, 1, ENC_LITTLE_ENDIAN, &length);\r\noffset += 2;\r\nif (length != 8) {\r\nexpert_add_info_format(pinfo, length_item, &ei_rdp_neg_len_invalid, "RDP Negotiate Failure length is %u, not 8", length);\r\nreturn offset;\r\n}\r\nproto_tree_add_item_ret_uint(tree, hf_rdp_negFailure_failureCode, tvb, offset, 4, ENC_LITTLE_ENDIAN, &failureCode);\r\noffset += 4;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", failureCode %s",\r\nval_to_str(failureCode, failure_code_vals, "Unknown (0x%08x)"));\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_rdp_cc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 type;\r\nguint16 length;\r\ngboolean ours = FALSE;\r\nproto_item *item;\r\nproto_tree *tree;\r\nif (tvb_bytes_exist(tvb, offset, 4)) {\r\ntype = tvb_get_guint8(tvb, offset);\r\nlength = tvb_get_letohs(tvb, offset + 2);\r\nif ((type == TYPE_RDP_NEG_RSP || type == TYPE_RDP_NEG_FAILURE) &&\r\nlength == 8) {\r\nours = TRUE;\r\n}\r\n}\r\nif (!ours) {\r\nreturn 0;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RDP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nitem = proto_tree_add_item(parent_tree, proto_rdp, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_rdp);\r\nswitch (type) {\r\ncase TYPE_RDP_NEG_RSP:\r\noffset = dissect_rdpNegRsp(tvb, offset, pinfo, tree);\r\nbreak;\r\ncase TYPE_RDP_NEG_FAILURE:\r\noffset = dissect_rdpNegFailure(tvb, offset, pinfo, tree);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_rdp(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_rdp_rt_cookie,\r\n{ "Routing Token/Cookie", "rdp.rt_cookie",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_neg_type,\r\n{ "Type", "rdp.neg_type",\r\nFT_UINT8, BASE_HEX, VALS(neg_type_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negReq_flags,\r\n{ "Flags", "rdp.negReq.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negReq_flag_restricted_admin_mode_req,\r\n{ "Restricted admin mode required", "rdp.negReq.flags.restricted_admin_mode_req",\r\nFT_BOOLEAN, 8, NULL, RESTRICTED_ADMIN_MODE_REQUIRED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negReq_flag_correlation_info_present,\r\n{ "Correlation info present", "rdp.negReq.flags.correlation_info_present",\r\nFT_BOOLEAN, 8, NULL, CORRELATION_INFO_PRESENT,\r\nNULL, HFILL }},\r\n{ &hf_rdp_neg_length,\r\n{ "Length", "rdp.neg_length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_requestedProtocols,\r\n{ "requestedProtocols", "rdp.negReq.requestedProtocols",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_requestedProtocols_flag_ssl,\r\n{ "TLS security supported", "rdp.negReq.requestedProtocols.ssl",\r\nFT_BOOLEAN, 32, NULL, 0x00000001,\r\nNULL, HFILL }},\r\n{ &hf_rdp_requestedProtocols_flag_hybrid,\r\n{ "CredSSP supported", "rdp.negReq.requestedProtocols.hybrid",\r\nFT_BOOLEAN, 32, NULL, 0x00000002,\r\nNULL, HFILL }},\r\n{ &hf_rdp_requestedProtocols_flag_hybrid_ex,\r\n{ "Early User Authorization Result PDU supported", "rdp.negReq.requestedProtocols.hybrid_ex",\r\nFT_BOOLEAN, 32, NULL, 0x00000008,\r\nNULL, HFILL }},\r\n{ &hf_rdp_correlationInfo_flags,\r\n{ "Flags", "rdp.correlationInfo.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_correlationId,\r\n{ "correlationId", "rdp.correlationInfo.correlationId",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_correlationInfo_reserved,\r\n{ "Reserved", "rdp.correlationInfo.reserved",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negRsp_flags,\r\n{ "Flags", "rdp.negRsp.flags",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negRsp_flag_extended_client_data_supported,\r\n{ "Extended Client Data Blocks supported", "rdp.negRsp.flags.extended_client_data_supported",\r\nFT_BOOLEAN, 8, NULL, 0x01,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negRsp_flag_dynvc_gfx_protocol_supported,\r\n{ "Graphics Pipeline Extension Protocol supported", "rdp.negRsp.flags.dynvc_gfx_protocol_supported",\r\nFT_BOOLEAN, 8, NULL, 0x02,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negRsp_flag_restricted_admin_mode_supported,\r\n{ "Restricted admin mode supported", "rdp.negRsp.flags.restricted_admin_mode_supported",\r\nFT_BOOLEAN, 8, NULL, 0x08,\r\nNULL, HFILL }},\r\n{ &hf_rdp_selectedProtocol,\r\n{ "selectedProtocol", "rdp.negReq.selectedProtocol",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_selectedProtocol_flag_ssl,\r\n{ "TLS security selected", "rdp.negReq.selectedProtocol.ssl",\r\nFT_BOOLEAN, 32, NULL, 0x00000001,\r\nNULL, HFILL }},\r\n{ &hf_rdp_selectedProtocol_flag_hybrid,\r\n{ "CredSSP selected", "rdp.negReq.selectedProtocol.hybrid",\r\nFT_BOOLEAN, 32, NULL, 0x00000002,\r\nNULL, HFILL }},\r\n{ &hf_rdp_selectedProtocol_flag_hybrid_ex,\r\n{ "Early User Authorization Result PDU selected", "rdp.negReq.selectedProtocol.hybrid_ex",\r\nFT_BOOLEAN, 32, NULL, 0x00000008,\r\nNULL, HFILL }},\r\n{ &hf_rdp_negFailure_failureCode,\r\n{ "failureCode", "rdp.negFailure.failureCode",\r\nFT_UINT32, BASE_HEX, VALS(failure_code_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_ClientData,\r\n{ "ClientData", "rdp.clientData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_SendData,\r\n{ "SendData", "rdp.sendData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientCoreData,\r\n{ "clientCoreData", "rdp.client.coreData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientSecurityData,\r\n{ "clientSecurityData", "rdp.client.securityData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientNetworkData,\r\n{ "clientNetworkData", "rdp.client.networkData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientClusterData,\r\n{ "clientClusterData", "rdp.client.clusterData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientMonitorData,\r\n{ "clientMonitorData", "rdp.client.monitorData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientMsgChannelData,\r\n{ "clientMsgChannelData", "rdp.client.msgChannelData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientMonitorExData,\r\n{ "clientMonitorExData", "rdp.client.monitorExData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientMultiTransportData,\r\n{ "clientMultiTransportData", "rdp.client.multiTransportData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientUnknownData,\r\n{ "clientUnknownData", "rdp.unknownData.client",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_ServerData,\r\n{ "ServerData", "rdp.serverData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverCoreData,\r\n{ "serverCoreData", "rdp.server.coreData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverSecurityData,\r\n{ "serverSecurityData", "rdp.server.securityData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverNetworkData,\r\n{ "serverNetworkData", "rdp.server.networkData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverMsgChannelData,\r\n{ "serverMsgChannelData", "rdp.server.msgChannelData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverMultiTransportData,\r\n{ "serverMultiTransportData", "rdp.server.multiTransportData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverUnknownData,\r\n{ "serverUnknownData", "rdp.unknownData.server",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_securityExchangePDU,\r\n{ "securityExchangePDU", "rdp.securityExchangePDU",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientInfoPDU,\r\n{ "clientInfoPDU", "rdp.clientInfoPDU",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_validClientLicenseData,\r\n{ "validClientLicenseData", "rdp.validClientLicenseData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_headerType,\r\n{ "headerType", "rdp.header.type",\r\nFT_UINT16, BASE_HEX, VALS(rdp_headerType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_headerLength,\r\n{ "headerLength", "rdp.header.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_versionMajor,\r\n{ "versionMajor", "rdp.version.major",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_versionMinor,\r\n{ "versionMinor", "rdp.version.minor",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_desktopWidth,\r\n{ "desktopWidth", "rdp.desktop.width",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_desktopHeight,\r\n{ "desktopHeight", "rdp.desktop.height",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_colorDepth,\r\n{ "colorDepth", "rdp.colorDepth",\r\nFT_UINT16, BASE_HEX, VALS(rdp_colorDepth_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_SASSequence,\r\n{ "SASSequence", "rdp.SASSequence",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_keyboardLayout,\r\n{ "keyboardLayout", "rdp.keyboardLayout",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientBuild,\r\n{ "clientBuild", "rdp.client.build",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientName,\r\n{ "clientName", "rdp.client.name",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_keyboardType,\r\n{ "keyboardType", "rdp.keyboard.type",\r\nFT_UINT32, BASE_DEC, VALS(rdp_keyboardType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_keyboardSubType,\r\n{ "keyboardSubType", "rdp.keyboard.subtype",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_keyboardFunctionKey,\r\n{ "keyboardFunctionKey", "rdp.keyboard.functionkey",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_imeFileName,\r\n{ "imeFileName", "rdp.imeFileName",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_postBeta2ColorDepth,\r\n{ "postBeta2ColorDepth", "rdp.postBeta2ColorDepth",\r\nFT_UINT16, BASE_HEX, VALS(rdp_colorDepth_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientProductId,\r\n{ "clientProductId", "rdp.client.productId",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serialNumber,\r\n{ "serialNumber", "rdp.serialNumber",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_highColorDepth,\r\n{ "highColorDepth", "rdp.highColorDepth",\r\nFT_UINT16, BASE_HEX, VALS(rdp_highColorDepth_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_supportedColorDepths,\r\n{ "supportedColorDepths", "rdp.supportedColorDepths",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_earlyCapabilityFlags,\r\n{ "earlyCapabilityFlags", "rdp.earlyCapabilityFlags",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientDigProductId,\r\n{ "clientDigProductId", "rdp.client.digProductId",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_connectionType,\r\n{ "connectionType", "rdp.connectionType",\r\nFT_UINT8, BASE_DEC, VALS(rdp_connectionType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pad1octet,\r\n{ "pad1octet", "rdp.pad1octet",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverSelectedProtocol,\r\n{ "serverSelectedProtocol", "rdp.serverSelectedProtocol",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_encryptionMethods,\r\n{ "encryptionMethods", "rdp.encryptionMethods",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_extEncryptionMethods,\r\n{ "extEncryptionMethods", "rdp.extEncryptionMethods",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cluster_flags,\r\n{ "clusterFlags", "rdp.clusterFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_redirectedSessionId,\r\n{ "redirectedSessionId", "rdp.redirectedSessionId",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_msgChannelFlags,\r\n{ "msgChannelFlags", "rdp.msgChannelFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_msgChannelId,\r\n{ "msgChannelId", "rdp.msgChannelId",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_monitorExFlags,\r\n{ "monitorExFlags", "rdp.monitorExFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_monitorAttributeSize,\r\n{ "monitorAttributeSize", "rdp.monitorAttributeSize",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_monitorCount,\r\n{ "monitorCount", "rdp.monitorCount",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_multiTransportFlags,\r\n{ "multiTransportFlags", "rdp.multiTransportFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_encryptionMethod,\r\n{ "encryptionMethod", "rdp.encryptionMethod",\r\nFT_UINT32, BASE_HEX, VALS(rdp_encryptionMethod_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_encryptionLevel,\r\n{ "encryptionLevel", "rdp.encryptionLevel",\r\nFT_UINT32, BASE_HEX, VALS(rdp_encryptionLevel_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverRandomLen,\r\n{ "serverRandomLen", "rdp.serverRandomLen",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverCertLen,\r\n{ "serverCertLen", "rdp.serverCertLen",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverRandom,\r\n{ "serverRandom", "rdp.serverRandom",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_serverCertificate,\r\n{ "serverCertificate", "rdp.serverCertificate",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientRequestedProtocols,\r\n{ "clientRequestedProtocols", "rdp.client.requestedProtocols",\r\nFT_UINT32, BASE_HEX, VALS(rdp_requestedProtocols_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_MCSChannelId,\r\n{ "MCSChannelId", "rdp.MCSChannelId",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelCount,\r\n{ "channelCount", "rdp.channelCount",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelIdArray,\r\n{ "channelIdArray", "rdp.channelIdArray",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_Pad,\r\n{ "Pad", "rdp.Pad",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flags,\r\n{ "flags", "rdp.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlags,\r\n{ "channelFlags", "rdp.channelFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsPkt,\r\n{ "flagsPkt", "rdp.flags.pkt",\r\nFT_UINT16, BASE_HEX, VALS(rdp_flagsPkt_vals), SEC_PKT_MASK,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsEncrypt,\r\n{ "flagsEncrypt", "rdp.flags.encrypt",\r\nFT_UINT16, BASE_HEX, NULL, SEC_ENCRYPT,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsResetSeqno,\r\n{ "flagsResetSeqno", "rdp.flags.resetseqno",\r\nFT_UINT16, BASE_HEX, NULL, SEC_RESET_SEQNO,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsIgnoreSeqno,\r\n{ "flagsIgnoreSeqno", "rdp.flags.ignoreseqno",\r\nFT_UINT16, BASE_HEX, NULL, SEC_IGNORE_SEQNO,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsLicenseEncrypt,\r\n{ "flagsLicenseEncrypt", "rdp.flags.licenseencrypt",\r\nFT_UINT16, BASE_HEX, NULL, SEC_LICENSE_ENCRYPT_CS,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsSecureChecksum,\r\n{ "flagsSecureChecksum", "rdp.flags.securechecksum",\r\nFT_UINT16, BASE_HEX, NULL, SEC_SECURE_CHECKSUM,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsFlagsHiValid,\r\n{ "flagsHiValid", "rdp.flags.flagshivalid",\r\nFT_UINT16, BASE_HEX, NULL, SEC_FLAGSHI_VALID,\r\nNULL, HFILL }},\r\n{ &hf_rdp_flagsHi,\r\n{ "flagsHi", "rdp.flagsHi",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_length,\r\n{ "length", "rdp.length",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_encryptedClientRandom,\r\n{ "encryptedClientRandom", "rdp.encryptedClientRandom",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_dataSignature,\r\n{ "dataSignature", "rdp.dataSignature",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_fipsLength,\r\n{ "fipsLength", "rdp.fipsLength",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_fipsVersion,\r\n{ "fipsVersion", "rdp.fipsVersion",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_padlen,\r\n{ "padlen", "rdp.padlen",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_codePage,\r\n{ "codePage", "rdp.codePage",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionFlags,\r\n{ "optionFlags", "rdp.optionFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbDomain,\r\n{ "cbDomain", "rdp.domain.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbUserName,\r\n{ "cbUserName", "rdp.userName.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbPassword,\r\n{ "cbPassword", "rdp.password.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbAlternateShell,\r\n{ "cbAlternateShell", "rdp.alternateShell.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbWorkingDir,\r\n{ "cbWorkingDir", "rdp.workingDir.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbClientAddress,\r\n{ "cbClientAddress", "rdp.client.address.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbClientDir,\r\n{ "cbClientDir", "rdp.client.dir.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_cbAutoReconnectLen,\r\n{ "cbAutoReconnectLen", "rdp.autoReconnectCookie.length",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_domain,\r\n{ "domain", "rdp.domain",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_userName,\r\n{ "userName", "rdp.userName",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_password,\r\n{ "password", "rdp.password",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_alternateShell,\r\n{ "alternateShell", "rdp.alternateShell",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_workingDir,\r\n{ "workingDir", "rdp.workingDir",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientAddressFamily,\r\n{ "clientAddressFamily", "rdp.client.addressFamily",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientAddress,\r\n{ "clientAddress", "rdp.client.address",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientDir,\r\n{ "clientDir", "rdp.client.dir",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientTimeZone,\r\n{ "clientTimeZone", "rdp.client.timeZone",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_clientSessionId,\r\n{ "clientSessionId", "rdp.client.sessionId",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_performanceFlags,\r\n{ "performanceFlags", "rdp.performanceFlags",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_autoReconnectCookie,\r\n{ "autoReconnectCookie", "rdp.autoReconnectCookie",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_reserved1,\r\n{ "reserved1", "rdp.reserved1",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_reserved2,\r\n{ "reserved2", "rdp.reserved2",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_bMsgType,\r\n{ "bMsgType", "rdp.bMsgType",\r\nFT_UINT8, BASE_HEX, VALS(rdp_bMsgType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_bVersion,\r\n{ "bVersion", "rdp.bVersion",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wMsgSize,\r\n{ "wMsgSize", "rdp.wMsgSize",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wBlobType,\r\n{ "wBlobType", "rdp.wBlobType",\r\nFT_UINT16, BASE_DEC, VALS(rdp_wBlobType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wBlobLen,\r\n{ "wBlobLen", "rdp.wBlobLen",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_blobData,\r\n{ "blobData", "rdp.blobData",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_shareControlHeader,\r\n{ "shareControlHeader", "rdp.shareControlHeader",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelPDUHeader,\r\n{ "channelPDUHeader", "rdp.channelPDUHeader",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_virtualChannelData,\r\n{ "virtualChannelData", "rdp.virtualChannelData",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalLength,\r\n{ "totalLength", "rdp.totalLength",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduType,\r\n{ "pduType", "rdp.pduType",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduTypeType,\r\n{ "pduTypeType", "rdp.pduType.type",\r\nFT_UINT16, BASE_HEX, VALS(rdp_pduTypeType_vals), PDUTYPE_TYPE_MASK,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduTypeVersionLow,\r\n{ "pduTypeVersionLow", "rdp.pduType.versionLow",\r\nFT_UINT16, BASE_DEC, NULL, PDUTYPE_VERSIONLOW_MASK,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduTypeVersionHigh,\r\n{ "pduTypeVersionHigh", "rdp.pduType.versionHigh",\r\nFT_UINT16, BASE_DEC, NULL, PDUTYPE_VERSIONHIGH_MASK,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduSource,\r\n{ "pduSource", "rdp.pduSource",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_shareId,\r\n{ "shareId", "rdp.shareId",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pad1,\r\n{ "pad1", "rdp.pad1",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_streamId,\r\n{ "streamId", "rdp.streamId",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_uncompressedLength,\r\n{ "uncompressedLength", "rdp.uncompressedLength",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pduType2,\r\n{ "pduType2", "rdp.pduType2",\r\nFT_UINT8, BASE_DEC, VALS(rdp_pduType2_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedType,\r\n{ "compressedType", "rdp.compressedType",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedTypeType,\r\n{ "compressedTypeType", "rdp.compressedType.type",\r\nFT_UINT8, BASE_HEX, VALS(rdp_compressionType_vals),\r\nPacketCompressionTypeMask,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedTypeCompressed,\r\n{ "compressedTypeCompressed", "rdp.compressedType.compressed",\r\nFT_UINT8, BASE_HEX, NULL, PACKET_COMPRESSED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedTypeAtFront,\r\n{ "compressedTypeAtFront", "rdp.compressedType.atFront",\r\nFT_UINT8, BASE_HEX, NULL, PACKET_AT_FRONT,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedTypeFlushed,\r\n{ "compressedTypeFlushed", "rdp.compressedType.flushed",\r\nFT_UINT8, BASE_HEX, NULL, PACKET_FLUSHED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_compressedLength,\r\n{ "compressedLength", "rdp.compressedLength",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wErrorCode,\r\n{ "errorCode", "rdp.errorCode",\r\nFT_UINT32, BASE_DEC, VALS(rdp_wErrorCode_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wStateTransition,\r\n{ "stateTransition", "rdp.stateTransition",\r\nFT_UINT32, BASE_DEC, VALS(rdp_wStateTransition_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numberEntries,\r\n{ "numberEntries", "rdp.numberEntries",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalNumberEntries,\r\n{ "totalNumberEntries", "rdp.totalNumberEntries",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_mapFlags,\r\n{ "mapFlags", "rdp.mapFlags",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_fontMapFirst,\r\n{ "fontMapFirst", "rdp.mapFlags.fontMapFirst",\r\nFT_UINT16, BASE_HEX, NULL, FONTMAP_FIRST,\r\nNULL, HFILL }},\r\n{ &hf_rdp_fontMapLast,\r\n{ "fontMapLast", "rdp.mapFlags.fontMapLast",\r\nFT_UINT16, BASE_HEX, NULL, FONTMAP_LAST,\r\nNULL, HFILL }},\r\n{ &hf_rdp_entrySize,\r\n{ "entrySize", "rdp.entrySize",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_action,\r\n{ "action", "rdp.action",\r\nFT_UINT16, BASE_HEX, VALS(rdp_action_vals),\r\n0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_grantId,\r\n{ "grantId", "rdp.grantId",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_controlId,\r\n{ "controlId", "rdp.controlId",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_messageType,\r\n{ "messageType", "rdp.messageType",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_targetUser,\r\n{ "targetUser", "rdp.targetUser",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numEntriesCache0,\r\n{ "numEntriesCache0", "rdp.numEntriesCache0",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numEntriesCache1,\r\n{ "numEntriesCache1", "rdp.numEntriesCache1",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numEntriesCache2,\r\n{ "numEntriesCache2", "rdp.numEntriesCache2",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numEntriesCache3,\r\n{ "numEntriesCache3", "rdp.numEntriesCache3",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numEntriesCache4,\r\n{ "numEntriesCache4", "rdp.numEntriesCache4",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalEntriesCache0,\r\n{ "totalEntriesCache0", "rdp.totalEntriesCache0",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalEntriesCache1,\r\n{ "totalEntriesCache1", "rdp.totalEntriesCache1",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalEntriesCache2,\r\n{ "totalEntriesCache2", "rdp.totalEntriesCache2",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalEntriesCache3,\r\n{ "totalEntriesCache3", "rdp.totalEntriesCache3",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_totalEntriesCache4,\r\n{ "totalEntriesCache4", "rdp.totalEntriesCache4",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_bBitMask,\r\n{ "bBitMask", "rdp.bBitMask",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_Pad2,\r\n{ "Pad2", "rdp.Pad2",\r\nFT_UINT8, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_Pad3,\r\n{ "Pad3", "rdp.Pad3",\r\nFT_UINT16, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_rdp_Key1,\r\n{ "Key1", "rdp.Key1",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n#endif\r\n#if 0\r\n{ &hf_rdp_Key2,\r\n{ "Key2", "rdp.Key2",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n#endif\r\n{ &hf_rdp_originatorId,\r\n{ "originatorId", "rdp.OriginatorId",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_lengthSourceDescriptor,\r\n{ "lengthSourceDescriptor", "rdp.lengthSourceDescriptor",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_lengthCombinedCapabilities,\r\n{ "lengthCombinedCapabilities", "rdp.lengthCombinedCapabilities",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_sourceDescriptor,\r\n{ "sourceDescriptor", "rdp.sourceDescriptor",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_numberCapabilities,\r\n{ "numberCapabilities", "rdp.numberCapabilities",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_pad2Octets,\r\n{ "pad2Octets", "rdp.pad2Octets",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_capabilitySetType,\r\n{ "capabilitySetType", "rdp.capabilitySetType",\r\nFT_UINT16, BASE_HEX, VALS(rdp_capabilityType_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_capabilitySet,\r\n{ "capabilitySet", "rdp.capabilitySet",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_lengthCapability,\r\n{ "lengthCapability", "rdp.lengthCapability",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_capabilityData,\r\n{ "capabilityData", "rdp.capabilityData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_rdp_unknownData,\r\n{ "unknownData", "rdp.unknownData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#endif\r\n{ &hf_rdp_notYetImplemented,\r\n{ "notYetImplemented", "rdp.notYetImplemented",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_encrypted,\r\n{ "encryptedData", "rdp.encryptedData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_rdp_compressed,\r\n{ "compressedData", "rdp.compressedData",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n#endif\r\n{ &hf_rdp_sessionId,\r\n{ "sessionId", "rdp.sessionId",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelDefArray,\r\n{ "channelDefArray", "rdp.channelDefArray",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelDef,\r\n{ "channelDef", "rdp.channelDef",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_name,\r\n{ "name", "rdp.name",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_options,\r\n{ "options", "rdp.options",\r\nFT_UINT32, BASE_HEX, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsInitialized,\r\n{ "optionsInitialized", "rdp.options.initialized",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_INITIALIZED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsEncryptRDP,\r\n{ "encryptRDP", "rdp.options.encrypt.rdp",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_ENCRYPT_RDP,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsEncryptSC,\r\n{ "encryptSC", "rdp.options.encrypt.sc",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_ENCRYPT_SC,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsEncryptCS,\r\n{ "encryptCS", "rdp.options.encrypt.cs",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_ENCRYPT_CS,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsPriHigh,\r\n{ "priorityHigh", "rdp.options.priority.high",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_PRI_HIGH,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsPriMed,\r\n{ "priorityMed", "rdp.options.priority.med",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_PRI_MED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsPriLow,\r\n{ "priorityLow", "rdp.options.priority.low",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_PRI_LOW,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsCompressRDP,\r\n{ "compressRDP", "rdp.options.compress.rdp",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_COMPRESS_RDP,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsCompress,\r\n{ "compress", "rdp.options.compress",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_COMPRESS,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsShowProtocol,\r\n{ "showProtocol", "rdp.options.showprotocol",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_SHOW_PROTOCOL,\r\nNULL, HFILL }},\r\n{ &hf_rdp_optionsRemoteControlPersistent,\r\n{ "remoteControlPersistent", "rdp.options.remotecontrolpersistent",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_OPTION_REMOTE_CONTROL_PERSISTENT,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlagFirst,\r\n{ "channelFlagFirst", "rdp.channelFlag.first",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_FLAG_FIRST,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlagLast,\r\n{ "channelFlagLast", "rdp.channelFlag.last",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_FLAG_LAST,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlagShowProtocol,\r\n{ "channelFlagShowProtocol", "rdp.channelFlag.showProtocol",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_FLAG_SHOW_PROTOCOL,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlagSuspend,\r\n{ "channelFlagSuspend", "rdp.channelFlag.suspend",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_FLAG_SUSPEND,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelFlagResume,\r\n{ "channelFlagResume", "rdp.channelFlag.resume",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_FLAG_RESUME,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelPacketCompressed,\r\n{ "channelPacketCompressed", "rdp.channelPacket.compressed",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_PACKET_COMPRESSED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelPacketAtFront,\r\n{ "channelPacketAtFront", "rdp.channelPacket.atFront",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_PACKET_AT_FRONT,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelPacketFlushed,\r\n{ "channelPacketFlushed", "rdp.channelPacket.flushed",\r\nFT_UINT32, BASE_HEX, NULL, CHANNEL_PACKET_FLUSHED,\r\nNULL, HFILL }},\r\n{ &hf_rdp_channelPacketCompressionType,\r\n{ "channelPacketCompresssionType", "rdp.channelPacket.compressionType",\r\nFT_UINT32, BASE_HEX, VALS(rdp_channelCompressionType_vals), ChannelCompressionTypeMask,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wYear,\r\n{ "wYear", "rdp.wYear",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wMonth,\r\n{ "wMonth", "rdp.wMonth",\r\nFT_UINT16, BASE_DEC, VALS(rdp_wMonth_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wDayOfWeek,\r\n{ "wDayOfWeek", "rdp.wDayOfWeek",\r\nFT_UINT16, BASE_DEC, VALS(rdp_wDayOfWeek_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wDay,\r\n{ "wDay", "rdp.wDay",\r\nFT_UINT16, BASE_DEC, VALS(rdp_wDay_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wHour,\r\n{ "wHour", "rdp.wHour",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wMinute,\r\n{ "wMinute", "rdp.wMinute",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wSecond,\r\n{ "wSecond", "rdp.wSecond",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_wMilliseconds,\r\n{ "wMilliseconds", "rdp.wMilliseconds",\r\nFT_UINT16, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_Bias,\r\n{ "Bias", "rdp.Bias",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_StandardBias,\r\n{ "StandardBias", "rdp.Bias.standard",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_DaylightBias,\r\n{ "DaylightBias", "rdp.Bias.daylight",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_StandardName,\r\n{ "StandardName", "rdp.Name.Standard",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_StandardDate,\r\n{ "StandardDate", "rdp.Date.Standard",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_DaylightName,\r\n{ "DaylightName", "rdp.Name.Daylight",\r\nFT_STRINGZ, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_DaylightDate,\r\n{ "DaylightDate", "rdp.Date.Daylight",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_rdp_unused,\r\n{ "Unused", "rdp.unused",\r\nFT_NONE, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_rdp,\r\n&ett_negReq_flags,\r\n&ett_requestedProtocols,\r\n&ett_negRsp_flags,\r\n&ett_selectedProtocol,\r\n&ett_rdp_ClientData,\r\n&ett_rdp_ServerData,\r\n&ett_rdp_SendData,\r\n&ett_rdp_capabilitySet,\r\n&ett_rdp_channelDef,\r\n&ett_rdp_channelDefArray,\r\n&ett_rdp_channelFlags,\r\n&ett_rdp_channelIdArray,\r\n&ett_rdp_channelPDUHeader,\r\n&ett_rdp_clientClusterData,\r\n&ett_rdp_clientCoreData,\r\n&ett_rdp_clientInfoPDU,\r\n&ett_rdp_clientMonitorData,\r\n&ett_rdp_clientMonitorExData,\r\n&ett_rdp_clientMsgChannelData,\r\n&ett_rdp_clientMultiTransportData,\r\n&ett_rdp_clientNetworkData,\r\n&ett_rdp_clientSecurityData,\r\n&ett_rdp_clientUnknownData,\r\n&ett_rdp_compressedType,\r\n&ett_rdp_flags,\r\n&ett_rdp_mapFlags,\r\n&ett_rdp_options,\r\n&ett_rdp_pduType,\r\n&ett_rdp_securityExchangePDU,\r\n&ett_rdp_serverCoreData,\r\n&ett_rdp_serverMsgChannelData,\r\n&ett_rdp_serverMultiTransportData,\r\n&ett_rdp_serverNetworkData,\r\n&ett_rdp_serverSecurityData,\r\n&ett_rdp_serverUnknownData,\r\n&ett_rdp_shareControlHeader,\r\n&ett_rdp_validClientLicenseData,\r\n&ett_rdp_StandardDate,\r\n&ett_rdp_DaylightDate,\r\n&ett_rdp_clientTimeZone,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_rdp_neg_len_invalid, { "rdp.neg_len.invalid", PI_PROTOCOL, PI_ERROR, "Invalid length", EXPFILL }},\r\n{ &ei_rdp_not_correlation_info, { "rdp.not_correlation_info", PI_PROTOCOL, PI_ERROR, "What follows RDP Negotiation Request is not an RDP Correlation Info", EXPFILL }},\r\n};\r\nmodule_t *rdp_module;\r\nexpert_module_t* expert_rdp;\r\nproto_rdp = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_rdp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_rdp = expert_register_protocol(proto_rdp);\r\nexpert_register_field_array(expert_rdp, ei, array_length(ei));\r\nrdp_module = prefs_register_protocol(proto_rdp, prefs_register_rdp);\r\nprefs_register_uint_preference(rdp_module, "tcp.port", "RDP TCP Port",\r\n"Set the port for RDP operations (if other"\r\n" than the default of 3389)",\r\n10, &global_rdp_tcp_port);\r\n}\r\nvoid\r\nproto_reg_handoff_rdp(void)\r\n{\r\ntpkt_handle = find_dissector("tpkt");\r\nheur_dissector_add("cotp_cr", dissect_rdp_cr, "RDP", "rdp_cr", proto_rdp, HEURISTIC_ENABLE);\r\nheur_dissector_add("cotp_cc", dissect_rdp_cc, "RDP", "rdp_cc", proto_rdp, HEURISTIC_ENABLE);\r\nprefs_register_rdp();\r\nregister_t124_ns_dissector("Duca", dissect_rdp_ClientData, proto_rdp);\r\nregister_t124_ns_dissector("McDn", dissect_rdp_ServerData, proto_rdp);\r\n}\r\nstatic void\r\nprefs_register_rdp(void) {\r\nstatic guint tcp_port = 0;\r\nif ((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_delete_uint("tcp.port", tcp_port, tpkt_handle);\r\ntcp_port = global_rdp_tcp_port;\r\nif ((tcp_port > 0) && (tcp_port != 102) && tpkt_handle)\r\ndissector_add_uint("tcp.port", tcp_port, tpkt_handle);\r\n}
