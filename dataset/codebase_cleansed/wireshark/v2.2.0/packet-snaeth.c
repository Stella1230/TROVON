static int\r\ndissect_snaeth(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *snaeth_tree;\r\nproto_item *snaeth_ti;\r\nguint16 len;\r\ntvbuff_t *next_tvb;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SNAETH");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "SNA over Ethernet");\r\nlen = tvb_get_ntohs(tvb, 0);\r\nif (tree) {\r\nsnaeth_ti = proto_tree_add_item(tree, proto_snaeth, tvb, 0, 3,\r\nENC_NA);\r\nsnaeth_tree = proto_item_add_subtree(snaeth_ti, ett_snaeth);\r\nproto_tree_add_uint(snaeth_tree, hf_snaeth_len, tvb, 0, 2, len);\r\nproto_tree_add_item(snaeth_tree, hf_snaeth_padding, tvb, 2, 1, ENC_BIG_ENDIAN);\r\n}\r\nset_actual_length(tvb, 3 + len);\r\nnext_tvb = tvb_new_subset_remaining(tvb, 3);\r\ncall_dissector(llc_handle, next_tvb, pinfo, tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_snaeth(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_snaeth_len,\r\n{ "Length", "snaeth.len", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Length of LLC payload", HFILL }},\r\n{ &hf_snaeth_padding,\r\n{ "Padding", "snaeth.padding", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_snaeth,\r\n};\r\nproto_snaeth = proto_register_protocol("SNA-over-Ethernet",\r\n"SNAETH", "snaeth");\r\nproto_register_field_array(proto_snaeth, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_snaeth(void)\r\n{\r\ndissector_handle_t snaeth_handle;\r\nllc_handle = find_dissector_add_dependency("llc", proto_snaeth);\r\nsnaeth_handle = create_dissector_handle(dissect_snaeth, proto_snaeth);\r\ndissector_add_uint("ethertype", ETHERTYPE_SNA, snaeth_handle);\r\n}
