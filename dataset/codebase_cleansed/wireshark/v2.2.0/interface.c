GSList *local_interfaces_to_list(void)\r\n{\r\nGSList *interfaces = NULL;\r\n#ifdef HAVE_GETIFADDRS\r\nstruct ifaddrs *ifap;\r\nstruct ifaddrs *ifa;\r\nint family;\r\nchar ip[INET6_ADDRSTRLEN];\r\nif (getifaddrs(&ifap)) {\r\ngoto end;\r\n}\r\nfor (ifa = ifap; ifa != NULL; ifa = ifa->ifa_next) {\r\nif (ifa->ifa_addr == NULL)\r\ncontinue;\r\nfamily = ifa->ifa_addr->sa_family;\r\nmemset(ip, 0x0, INET6_ADDRSTRLEN);\r\nswitch (family) {\r\ncase AF_INET:\r\n{\r\nstruct sockaddr_in *addr4 = (struct sockaddr_in *)ifa->ifa_addr;\r\nws_inet_ntop4(&addr4->sin_addr, ip, sizeof(ip));\r\nbreak;\r\n}\r\ncase AF_INET6:\r\n{\r\nstruct sockaddr_in6 *addr6 = (struct sockaddr_in6 *)ifa->ifa_addr;\r\nws_inet_ntop6(&addr6->sin6_addr, ip, sizeof(ip));\r\nbreak;\r\n}\r\ndefault:\r\nbreak;\r\n}\r\nif (!g_strcmp0(ip, "127.0.0.1") || !g_strcmp0(ip, "::1"))\r\ncontinue;\r\nif (*ip) {\r\ninterfaces = g_slist_prepend(interfaces, g_strdup(ip));\r\n}\r\n}\r\nfreeifaddrs(ifap);\r\nend:\r\n#endif\r\nreturn interfaces;\r\n}
