static void\r\ndissect_common_header(tvbuff_t *common_header_tvb, packet_info *pinfo, proto_tree *m2ua_tree)\r\n{\r\nguint8 message_class, message_type;\r\nmessage_class = tvb_get_guint8(common_header_tvb, MESSAGE_CLASS_OFFSET);\r\nmessage_type = tvb_get_guint8(common_header_tvb, MESSAGE_TYPE_OFFSET);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s ", val_to_str_const(message_class * 256 + message_type, message_class_type_acro_values, "reserved"));\r\nif (m2ua_tree) {\r\nproto_tree_add_item(m2ua_tree, hf_version, common_header_tvb, VERSION_OFFSET, VERSION_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(m2ua_tree, hf_reserved, common_header_tvb, RESERVED_OFFSET, RESERVED_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(m2ua_tree, hf_message_class, common_header_tvb, MESSAGE_CLASS_OFFSET, MESSAGE_CLASS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_uint_format_value(m2ua_tree, hf_message_type, common_header_tvb, MESSAGE_TYPE_OFFSET, MESSAGE_TYPE_LENGTH, message_type,\r\n"%s (%u)",\r\nval_to_str_const(message_class * 256 + message_type, message_class_type_values, "reserved"), message_type);\r\nproto_tree_add_item(m2ua_tree, hf_message_length, common_header_tvb, MESSAGE_LENGTH_OFFSET, MESSAGE_LENGTH_LENGTH, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_interface_identifier_int_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_interface_id_int, parameter_tvb, INT_INTERFACE_ID_OFFSET, INT_INTERFACE_ID_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%d)", tvb_get_ntohl(parameter_tvb, INT_INTERFACE_ID_OFFSET));\r\n}\r\nstatic void\r\ndissect_interface_identifier_text_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 interface_id_length;\r\ninterface_id_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nproto_tree_add_item(parameter_tree, hf_interface_id_text, parameter_tvb, TEXT_INTERFACE_ID_OFFSET, interface_id_length, ENC_ASCII|ENC_NA);\r\nproto_item_append_text(parameter_item, " (%.*s)", interface_id_length,\r\ntvb_format_text(parameter_tvb, TEXT_INTERFACE_ID_OFFSET, interface_id_length));\r\n}\r\nstatic void\r\ndissect_info_string_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 info_string_length;\r\ninfo_string_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nproto_tree_add_item(parameter_tree, hf_info_string, parameter_tvb, INFO_STRING_OFFSET, info_string_length, ENC_ASCII|ENC_NA);\r\nproto_item_append_text(parameter_item, " (%.*s)", info_string_length,\r\ntvb_format_text(parameter_tvb, INFO_STRING_OFFSET, info_string_length));\r\n}\r\nstatic void\r\ndissect_diagnostic_information_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 diag_info_length;\r\ndiag_info_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nproto_tree_add_item(parameter_tree, hf_diagnostic_information, parameter_tvb, DIAGNOSTIC_INFO_OFFSET, diag_info_length, ENC_NA);\r\nproto_item_append_text(parameter_item, " (%u byte%s)", diag_info_length, plurality(diag_info_length, "", "s"));\r\n}\r\nstatic void\r\ndissect_interface_identifier_range_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 number_of_ranges, range_number;\r\ngint offset;\r\nnumber_of_ranges = (tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH) / INTERVAL_LENGTH;\r\noffset = PARAMETER_VALUE_OFFSET;\r\nfor(range_number = 0; range_number < number_of_ranges; range_number++) {\r\nproto_tree_add_item(parameter_tree, hf_interface_id_start, parameter_tvb, offset + START_OFFSET, START_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(parameter_tree, hf_interface_id_stop, parameter_tvb, offset + END_OFFSET, END_LENGTH, ENC_BIG_ENDIAN);\r\noffset += INTERVAL_LENGTH;\r\n};\r\nproto_item_append_text(parameter_item, " (%u range%s)", number_of_ranges, plurality(number_of_ranges, "", "s"));\r\n}\r\nstatic void\r\ndissect_heartbeat_data_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 heartbeat_data_length;\r\nheartbeat_data_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nproto_tree_add_item(parameter_tree, hf_heartbeat_data, parameter_tvb, HEARTBEAT_DATA_OFFSET, heartbeat_data_length, ENC_NA);\r\nproto_item_append_text(parameter_item, " (%u byte%s)", heartbeat_data_length, plurality(heartbeat_data_length, "", "s"));\r\n}\r\nstatic void\r\ndissect_traffic_mode_type_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_traffic_mode_type, parameter_tvb, TRAFFIC_MODE_TYPE_OFFSET, TRAFFIC_MODE_TYPE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)",\r\nval_to_str_const(tvb_get_ntohl(parameter_tvb, TRAFFIC_MODE_TYPE_OFFSET), traffic_mode_type_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_error_code_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_error_code, parameter_tvb, ERROR_CODE_OFFSET, ERROR_CODE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)",\r\nval_to_str_const(tvb_get_ntohl(parameter_tvb, ERROR_CODE_OFFSET), error_code_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_status_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 status_type, status_id;\r\nstatus_type = tvb_get_ntohs(parameter_tvb, STATUS_TYPE_OFFSET);\r\nstatus_id = tvb_get_ntohs(parameter_tvb, STATUS_IDENT_OFFSET);\r\nproto_tree_add_item(parameter_tree, hf_status_type, parameter_tvb, STATUS_TYPE_OFFSET, STATUS_TYPE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_uint_format(parameter_tree, hf_status_ident, parameter_tvb, STATUS_IDENT_OFFSET, STATUS_IDENT_LENGTH,\r\nstatus_id, "Status identification: %u (%s)", status_id,\r\nval_to_str_const(status_type * 256 * 256 + status_id, status_type_id_values, "unknown"));\r\nproto_item_append_text(parameter_item, " (%s)",\r\nval_to_str_const(status_type * 256 * 256 + status_id, status_type_id_values, "unknown status information"));\r\n}\r\nstatic void\r\ndissect_asp_identifier_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_asp_id, parameter_tvb, ASP_IDENTIFIER_OFFSET, ASP_IDENTIFIER_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohl(parameter_tvb, ASP_IDENTIFIER_OFFSET));\r\n}\r\nstatic void\r\ndissect_correlation_identifier_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_correlation_id, parameter_tvb, CORRELATION_ID_OFFSET, CORRELATION_ID_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohl(parameter_tvb, CORRELATION_ID_OFFSET));\r\n}\r\nstatic void\r\ndissect_protocol_data_1_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_item *parameter_item)\r\n{\r\ntvbuff_t *payload_tvb;\r\nguint32 payload_length;\r\npayload_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\npayload_tvb = tvb_new_subset_length(parameter_tvb, DATA_1_MTP3_OFFSET, payload_length);\r\nproto_item_set_len(parameter_item, PARAMETER_HEADER_LENGTH);\r\ncall_dissector(mtp3_handle, payload_tvb, pinfo, tree);\r\nproto_item_set_text(parameter_item, "Data 1 parameter");\r\n}\r\nstatic void\r\ndissect_protocol_data_2_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\ntvbuff_t *payload_tvb;\r\nguint32 payload_length;\r\npayload_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH - DATA_2_LI_LENGTH;\r\nproto_tree_add_item(parameter_tree, hf_data_2_li, parameter_tvb, DATA_2_LI_OFFSET, DATA_2_LI_LENGTH, ENC_BIG_ENDIAN);\r\npayload_tvb = tvb_new_subset_length(parameter_tvb, DATA_2_MTP3_OFFSET, payload_length);\r\nproto_item_set_len(parameter_item, PARAMETER_HEADER_LENGTH + DATA_2_LI_LENGTH);\r\ncall_dissector(mtp3_handle, payload_tvb, pinfo, tree);\r\n}\r\nstatic void\r\ndissect_state_request_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_state, parameter_tvb, STATE_OFFSET, STATE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, STATE_OFFSET), state_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_state_event_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_event, parameter_tvb, EVENT_OFFSET, EVENT_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, STATE_OFFSET), event_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_congestion_status_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_congestion_status, parameter_tvb, CONGESTION_STATUS_OFFSET, CONGESTION_STATUS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, CONGESTION_STATUS_OFFSET), level_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_discard_status_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_discard_status, parameter_tvb, DISCARD_STATUS_OFFSET, DISCARD_STATUS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, DISCARD_STATUS_OFFSET), level_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_action_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_action, parameter_tvb, ACTION_OFFSET, ACTION_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, ACTION_OFFSET), action_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_sequence_number_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_sequence_number, parameter_tvb, SEQUENCE_NUMBER_OFFSET, SEQUENCE_NUMBER_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohl(parameter_tvb, SEQUENCE_NUMBER_OFFSET));\r\n}\r\nstatic void\r\ndissect_retrieval_result_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_retrieval_result, parameter_tvb, RETRIEVAL_RESULT_OFFSET, RETRIEVAL_RESULT_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, RETRIEVAL_RESULT_OFFSET), retrieval_result_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_link_key_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *parameter_tree)\r\n{\r\ntvbuff_t *parameters_tvb;\r\nguint16 parameters_length;\r\nparameters_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nparameters_tvb = tvb_new_subset_length(parameter_tvb, PARAMETER_VALUE_OFFSET, parameters_length);\r\ndissect_parameters(parameters_tvb, pinfo, tree, parameter_tree);\r\n}\r\nstatic void\r\ndissect_local_lk_identifier_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_local_lk_id, parameter_tvb, LOCAL_LK_ID_OFFSET, LOCAL_LK_ID_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohl(parameter_tvb, LOCAL_LK_ID_OFFSET));\r\n}\r\nstatic void\r\ndissect_sdt_identifier_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_sdt_reserved, parameter_tvb, SDT_RESERVED_OFFSET, SDT_RESERVED_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(parameter_tree, hf_sdt_id, parameter_tvb, SDT_ID_OFFSET, SDT_ID_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohs(parameter_tvb, SDT_ID_OFFSET));\r\n}\r\nstatic void\r\ndissect_sdl_identifier_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_sdl_reserved, parameter_tvb, SDL_RESERVED_OFFSET, SDL_RESERVED_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(parameter_tree, hf_sdl_id, parameter_tvb, SDL_ID_OFFSET, SDL_ID_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%u)", tvb_get_ntohs(parameter_tvb, SDL_ID_OFFSET));\r\n}\r\nstatic void\r\ndissect_registration_result_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *parameter_tree)\r\n{\r\ntvbuff_t *parameters_tvb;\r\nguint16 parameters_length;\r\nparameters_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nparameters_tvb = tvb_new_subset_length(parameter_tvb, PARAMETER_VALUE_OFFSET, parameters_length);\r\ndissect_parameters(parameters_tvb, pinfo, tree, parameter_tree);\r\n}\r\nstatic void\r\ndissect_registration_status_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_registration_status, parameter_tvb, REGISTRATION_STATUS_OFFSET, REGISTRATION_STATUS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, REGISTRATION_STATUS_OFFSET), registration_status_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_deregistration_result_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *parameter_tree)\r\n{\r\ntvbuff_t *parameters_tvb;\r\nguint16 parameters_length;\r\nparameters_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nparameters_tvb = tvb_new_subset_length(parameter_tvb, PARAMETER_VALUE_OFFSET, parameters_length);\r\ndissect_parameters(parameters_tvb, pinfo, tree, parameter_tree);\r\n}\r\nstatic void\r\ndissect_deregistration_status_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nproto_tree_add_item(parameter_tree, hf_deregistration_status, parameter_tvb, DEREGISTRATION_STATUS_OFFSET, DEREGISTRATION_STATUS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_item_append_text(parameter_item, " (%s)", val_to_str_const(tvb_get_ntohl(parameter_tvb, DEREGISTRATION_STATUS_OFFSET), deregistration_status_values, "unknown"));\r\n}\r\nstatic void\r\ndissect_unknown_parameter(tvbuff_t *parameter_tvb, proto_tree *parameter_tree, proto_item *parameter_item)\r\n{\r\nguint16 parameter_value_length;\r\nparameter_value_length = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET) - PARAMETER_HEADER_LENGTH;\r\nif (parameter_value_length > 0)\r\nproto_tree_add_item(parameter_tree, hf_parameter_value, parameter_tvb, PARAMETER_VALUE_OFFSET, parameter_value_length, ENC_NA);\r\nproto_item_append_text(parameter_item, " with tag %u and %u byte%s value",\r\ntvb_get_ntohs(parameter_tvb, PARAMETER_TAG_OFFSET), parameter_value_length, plurality(parameter_value_length, "", "s"));\r\n}\r\nstatic void\r\ndissect_parameter(tvbuff_t *parameter_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *m2ua_tree)\r\n{\r\nguint16 tag, length, padding_length;\r\nproto_item *parameter_item;\r\nproto_tree *parameter_tree;\r\ntag = tvb_get_ntohs(parameter_tvb, PARAMETER_TAG_OFFSET);\r\nlength = tvb_get_ntohs(parameter_tvb, PARAMETER_LENGTH_OFFSET);\r\npadding_length = tvb_reported_length(parameter_tvb) - length;\r\nparameter_tree = proto_tree_add_subtree(m2ua_tree, parameter_tvb, PARAMETER_HEADER_OFFSET, -1,\r\nett_m2ua_parameter, &parameter_item, val_to_str_const(tag, parameter_tag_values, "Unknown parameter"));\r\nif ((protocol_data_1_global == PROTOCOL_DATA_1_DRAFT_7) &&\r\n(tag == PROTOCOL_DATA_1_DRAFT_7))\r\n{\r\nproto_item *hidden_item;\r\nhidden_item = proto_tree_add_uint(parameter_tree, hf_parameter_tag, parameter_tvb, PARAMETER_TAG_OFFSET, PARAMETER_TAG_LENGTH, tag);\r\nPROTO_ITEM_SET_HIDDEN(hidden_item);\r\nproto_tree_add_uint_format_value(parameter_tree, hf_parameter_tag, parameter_tvb, PARAMETER_TAG_OFFSET, PARAMETER_TAG_LENGTH,\r\ntag, "Protocol data 1 (0x000e)");\r\nproto_tree_add_item(parameter_tree, hf_parameter_length, parameter_tvb, PARAMETER_LENGTH_OFFSET, PARAMETER_LENGTH_LENGTH, ENC_BIG_ENDIAN);\r\ntag = PROTOCOL_DATA_1_PARAMETER_TAG;\r\n}\r\nelse\r\n{\r\nproto_tree_add_item(parameter_tree, hf_parameter_tag, parameter_tvb, PARAMETER_TAG_OFFSET, PARAMETER_TAG_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(parameter_tree, hf_parameter_length, parameter_tvb, PARAMETER_LENGTH_OFFSET, PARAMETER_LENGTH_LENGTH, ENC_BIG_ENDIAN);\r\n}\r\nswitch(tag) {\r\ncase INTERFACE_IDENTIFIER_INT_PARAMETER_TAG:\r\ndissect_interface_identifier_int_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase INTERFACE_IDENTIFIER_TEXT_PARAMETER_TAG:\r\ndissect_interface_identifier_text_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase INFO_STRING_PARAMETER_TAG:\r\ndissect_info_string_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase DIAGNOSTIC_INFORMATION_PARAMETER_TAG:\r\ndissect_diagnostic_information_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase INTERFACE_IDENTIFIER_RANGE_PARAMETER_TAG:\r\ndissect_interface_identifier_range_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase HEARTBEAT_DATA_PARAMETER_TAG:\r\ndissect_heartbeat_data_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase TRAFFIC_MODE_TYPE_PARAMETER_TAG:\r\ndissect_traffic_mode_type_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase ERROR_CODE_PARAMETER_TAG:\r\ndissect_error_code_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase STATUS_PARAMETER_TAG:\r\ndissect_status_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase ASP_IDENTIFIER_PARAMETER_TAG:\r\ndissect_asp_identifier_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase CORRELATION_IDENTIFIER_PARAMETER_TAG:\r\ndissect_correlation_identifier_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase PROTOCOL_DATA_1_PARAMETER_TAG:\r\ndissect_protocol_data_1_parameter(parameter_tvb, pinfo, tree, parameter_item);\r\nbreak;\r\ncase PROTOCOL_DATA_2_PARAMETER_TAG:\r\ndissect_protocol_data_2_parameter(parameter_tvb, pinfo, tree, parameter_tree, parameter_item);\r\nbreak;\r\ncase STATE_REQUEST_PARAMETER_TAG:\r\ndissect_state_request_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase STATE_EVENT_PARAMETER_TAG:\r\ndissect_state_event_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase CONGESTION_STATUS_PARAMETER_TAG:\r\ndissect_congestion_status_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase DISCARD_STATUS_PARAMETER_TAG:\r\ndissect_discard_status_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase ACTION_PARAMETER_TAG:\r\ndissect_action_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase SEQUENCE_NUMBER_PARAMETER_TAG:\r\ndissect_sequence_number_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase RETRIEVAL_RESULT_PARAMETER_TAG:\r\ndissect_retrieval_result_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase LINK_KEY_PARAMETER_TAG:\r\ndissect_link_key_parameter(parameter_tvb, pinfo, tree, parameter_tree);\r\nbreak;\r\ncase LOCAL_LK_IDENTIFIER_PARAMETER_TAG:\r\ndissect_local_lk_identifier_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase SDT_IDENTIFIER_PARAMETER_TAG:\r\ndissect_sdt_identifier_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase SDL_IDENTIFIER_PARAMETER_TAG:\r\ndissect_sdl_identifier_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase REG_RESULT_PARAMETER_TAG:\r\ndissect_registration_result_parameter(parameter_tvb, pinfo, tree, parameter_tree);\r\nbreak;\r\ncase REG_STATUS_PARAMETER_TAG:\r\ndissect_registration_status_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ncase DEREG_RESULT_PARAMETER_TAG:\r\ndissect_deregistration_result_parameter(parameter_tvb, pinfo, tree, parameter_tree);\r\nbreak;\r\ncase DEREG_STATUS_PARAMETER_TAG:\r\ndissect_deregistration_status_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\ndefault:\r\ndissect_unknown_parameter(parameter_tvb, parameter_tree, parameter_item);\r\nbreak;\r\n};\r\nif (padding_length > 0)\r\nproto_tree_add_item(parameter_tree, hf_parameter_padding, parameter_tvb, PARAMETER_HEADER_OFFSET + length, padding_length, ENC_NA);\r\n}\r\nstatic void\r\ndissect_parameters(tvbuff_t *parameters_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *m2ua_tree)\r\n{\r\ngint offset, length, total_length, remaining_length;\r\ntvbuff_t *parameter_tvb;\r\noffset = 0;\r\nwhile((remaining_length = tvb_reported_length_remaining(parameters_tvb, offset))) {\r\nlength = tvb_get_ntohs(parameters_tvb, offset + PARAMETER_LENGTH_OFFSET);\r\ntotal_length = ADD_PADDING(length);\r\nif (remaining_length >= length)\r\ntotal_length = MIN(total_length, remaining_length);\r\nparameter_tvb = tvb_new_subset_length(parameters_tvb, offset, total_length);\r\ndissect_parameter(parameter_tvb, pinfo, tree, m2ua_tree);\r\noffset += total_length;\r\n}\r\n}\r\nstatic void\r\ndissect_message(tvbuff_t *message_tvb, packet_info *pinfo, proto_tree *tree, proto_tree *m2ua_tree)\r\n{\r\ntvbuff_t *common_header_tvb, *parameters_tvb;\r\ncommon_header_tvb = tvb_new_subset_length(message_tvb, 0, COMMON_HEADER_LENGTH);\r\nparameters_tvb = tvb_new_subset_remaining(message_tvb, COMMON_HEADER_LENGTH);\r\ndissect_common_header(common_header_tvb, pinfo, m2ua_tree);\r\ndissect_parameters(parameters_tvb, pinfo, tree, m2ua_tree);\r\n}\r\nstatic int\r\ndissect_m2ua(tvbuff_t *message_tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *m2ua_item;\r\nproto_tree *m2ua_tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "M2UA");\r\nm2ua_item = proto_tree_add_item(tree, proto_m2ua, message_tvb, 0, -1, ENC_NA);\r\nm2ua_tree = proto_item_add_subtree(m2ua_item, ett_m2ua);\r\ndissect_message(message_tvb, pinfo, tree, m2ua_tree);\r\nreturn tvb_captured_length(message_tvb);\r\n}\r\nvoid\r\nproto_register_m2ua(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_version, { "Version", "m2ua.version", FT_UINT8, BASE_DEC, VALS(protocol_version_values), 0x0, NULL, HFILL } },\r\n{ &hf_reserved, { "Reserved", "m2ua.reserved", FT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_message_class, { "Message class", "m2ua.message_class", FT_UINT8, BASE_DEC, VALS(message_class_values), 0x0, NULL, HFILL } },\r\n{ &hf_message_type, { "Message Type", "m2ua.message_type", FT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_message_length, { "Message length", "m2ua.message_length", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_parameter_tag, { "Parameter Tag", "m2ua.parameter_tag", FT_UINT16, BASE_HEX, VALS(parameter_tag_values), 0x0, NULL, HFILL } },\r\n{ &hf_parameter_length, { "Parameter length", "m2ua.parameter_length", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_parameter_value, { "Parameter value", "m2ua.parameter_value", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_parameter_padding, { "Padding", "m2ua.parameter_padding", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_interface_id_int, { "Interface Identifier (integer)", "m2ua.interface_identifier_int", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_interface_id_text, { "Interface identifier (text)", "m2ua.interface_identifier_text", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_info_string, { "Info string", "m2ua.info_string", FT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_diagnostic_information, { "Diagnostic information", "m2ua.diagnostic_information", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_interface_id_start, { "Interface Identifier (start)", "m2ua.interface_identifier_start", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_interface_id_stop, { "Interface Identifier (stop)", "m2ua.interface_identifier_stop", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_heartbeat_data, { "Heartbeat data", "m2ua.heartbeat_data", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_traffic_mode_type, { "Traffic mode Type", "m2ua.traffic_mode_type", FT_UINT32, BASE_DEC, VALS(traffic_mode_type_values), 0x0, NULL, HFILL } },\r\n{ &hf_error_code, { "Error code", "m2ua.error_code", FT_UINT32, BASE_DEC, VALS(error_code_values), 0x0, NULL, HFILL } },\r\n{ &hf_status_type, { "Status type", "m2ua.status_type", FT_UINT16, BASE_DEC, VALS(status_type_values), 0x0, NULL, HFILL } },\r\n{ &hf_status_ident, { "Status info", "m2ua.status_info", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_asp_id, { "ASP identifier", "m2ua.asp_identifier", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_correlation_id, { "Correlation identifier", "m2ua.correlation_identifier", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_data_2_li, { "Length indicator", "m2ua.data_2_li", FT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_state, { "State", "m2ua.state", FT_UINT32, BASE_DEC, VALS(state_values), 0x0, NULL, HFILL } },\r\n{ &hf_event, { "Event", "m2ua.event", FT_UINT32, BASE_DEC, VALS(event_values), 0x0, NULL, HFILL } },\r\n{ &hf_congestion_status, { "Congestion status", "m2ua.congestion_status", FT_UINT32, BASE_DEC, VALS(level_values), 0x0, NULL, HFILL } },\r\n{ &hf_discard_status, { "Discard status", "m2ua.discard_status", FT_UINT32, BASE_DEC, VALS(level_values), 0x0, NULL, HFILL } },\r\n{ &hf_action, { "Actions", "m2ua.action", FT_UINT32, BASE_DEC, VALS(action_values), 0x0, NULL, HFILL } },\r\n{ &hf_sequence_number, { "Sequence number", "m2ua.sequence_number", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_retrieval_result, { "Retrieval result", "m2ua.retrieval_result", FT_UINT32, BASE_DEC, VALS(retrieval_result_values), 0x0, NULL, HFILL } },\r\n{ &hf_local_lk_id, { "Local LK identifier", "m2ua.local_lk_identifier", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_sdt_reserved, { "Reserved", "m2ua.sdt_reserved", FT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_sdt_id, { "SDT identifier", "m2ua.sdt_identifier", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_sdl_reserved, { "Reserved", "m2ua.sdl_reserved", FT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_sdl_id, { "SDL identifier", "m2ua.sdl_identifier", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_registration_status, { "Registration status", "m2ua.registration_status", FT_UINT32, BASE_DEC, VALS(registration_status_values), 0x0, NULL, HFILL } },\r\n{ &hf_deregistration_status, { "Deregistration status", "m2ua.deregistration_status", FT_UINT32, BASE_DEC, VALS(deregistration_status_values), 0x0, NULL, HFILL } },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_m2ua,\r\n&ett_m2ua_parameter,\r\n};\r\nstatic const enum_val_t protocol_data_1_options[] = {\r\n{ "draft-7", "0x000e (Draft 7)", PROTOCOL_DATA_1_DRAFT_7 },\r\n{ "rfc3331", "0x0300 (RFC3331)", PROTOCOL_DATA_1_PARAMETER_TAG },\r\n{ NULL, NULL, 0 }\r\n};\r\nmodule_t *m2ua_module;\r\nproto_m2ua = proto_register_protocol("MTP 2 User Adaptation Layer", "M2UA", "m2ua");\r\nproto_register_field_array(proto_m2ua, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nm2ua_module = prefs_register_protocol(proto_m2ua, NULL);\r\nprefs_register_enum_preference(m2ua_module,\r\n"protocol_data_1_tag",\r\n"Protocol Data 1 Parameter Tag",\r\n"The value of the parameter tag for protocol data 1",\r\n&protocol_data_1_global,\r\nprotocol_data_1_options,\r\nFALSE);\r\n}\r\nvoid\r\nproto_reg_handoff_m2ua(void)\r\n{\r\ndissector_handle_t m2ua_handle;\r\nmtp3_handle = find_dissector_add_dependency("mtp3", proto_m2ua);\r\nm2ua_handle = create_dissector_handle(dissect_m2ua, proto_m2ua);\r\ndissector_add_uint("sctp.ppi", M2UA_PAYLOAD_PROTOCOL_ID, m2ua_handle);\r\ndissector_add_uint("sctp.port", SCTP_PORT_M2UA, m2ua_handle);\r\n}
