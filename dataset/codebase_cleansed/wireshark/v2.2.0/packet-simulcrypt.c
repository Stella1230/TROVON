static int\r\ndissect_simulcrypt(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, FRAME_HEADER_LEN,\r\nget_simulcrypt_message_len, dissect_simulcrypt_message, data);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic guint16\r\nget_interface (guint16 type)\r\n{\r\nint interface;\r\nif (type >= 0x8000) {\r\nreturn SIMULCRYPT_USER_DEFINED;\r\n}\r\nswitch (type & 0xFFF0) {\r\ncase 0x0000:\r\ncase 0x0100:\r\ncase 0x0200:\r\ninterface = SIMULCRYPT_ECMG_SCS;\r\nbreak;\r\ncase 0x0010:\r\ncase 0x0110:\r\ncase 0x0210:\r\ninterface = SIMULCRYPT_EMMG_MUX;\r\nbreak;\r\ncase 0x0310:\r\ncase 0x0320:\r\ninterface = SIMULCRYPT_CPSIG_PSIG;\r\nbreak;\r\ncase 0x0400:\r\ninterface = SIMULCRYPT_EIS_SCS;\r\nbreak;\r\ncase 0x0410:\r\ncase 0x0420:\r\ninterface = SIMULCRYPT_PSIG_MUX;\r\nbreak;\r\ncase 0x0430:\r\ninterface = SIMULCRYPT_MUX_CIM;\r\nbreak;\r\ncase 0x0440:\r\ninterface = SIMULCRYPT_PSIG_CIP;\r\nbreak;\r\ndefault:\r\ninterface = SIMULCRYPT_RESERVED;\r\nbreak;\r\n}\r\nreturn interface;\r\n}\r\nstatic void\r\ndissect_ecmg_parameter_value (proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, guint32 offset,\r\nguint16 plen, guint16 ptype, gchar *pvalue_char)\r\n{\r\nproto_item *simulcrypt_item;\r\nproto_tree *simulcrypt_super_cas_id_tree;\r\nproto_tree *simulcrypt_ecm_datagram_tree;\r\ntvbuff_t *next_tvb;\r\nguint32 pvaluedec;\r\nint ca_system_id;\r\nguint i;\r\nswitch (ptype) {\r\ncase SIMULCRYPT_ECMG_SUPER_CAS_ID:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_super_cas_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nsimulcrypt_super_cas_id_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_super_cas_id);\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_super_cas_id_tree, hf_simulcrypt_ca_system_id, tvb, offset, 2, ENC_BIG_ENDIAN );\r\nca_system_id = tvb_get_ntohs(tvb,offset);\r\nfor(i=0;i<ECM_INTERPRETATION_SIZE;i++)\r\n{\r\nif(tab_ecm_inter[i].ca_system_id==ca_system_id)\r\n{\r\ntab_ecm_inter[i].ecmg_port=pinfo->destport;\r\nproto_item_append_text(simulcrypt_item, ", Port %d, Protocol %s",tab_ecm_inter[i].ecmg_port, tab_ecm_inter[i].protocol_name);\r\nbreak;\r\n}\r\n}\r\nproto_tree_add_item(simulcrypt_super_cas_id_tree, hf_simulcrypt_ca_subsystem_id, tvb, offset+2, 2, ENC_BIG_ENDIAN );\r\nbreak;\r\ncase SIMULCRYPT_ECMG_SECTION_TSPKT_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_section_tspkt_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ECM_CHANNEL_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_ecm_channel_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_DELAY_START:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_delay_start, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_DELAY_STOP:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_delay_stop, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_TRANSITION_DELAY_START:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_transition_delay_start, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_TRANSITION_DELAY_STOP:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_transition_delay_stop, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_AC_DELAY_START:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_ac_delay_start, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_AC_DELAY_STOP:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_ac_delay_stop, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ECM_REP_PERIOD:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_ecm_rep_period, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_MAX_STREAMS:\r\nproto_tree_add_item(tree, hf_simulcrypt_max_streams, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_MIN_CP_DURATION:\r\npvaluedec = tvb_get_ntohs(tvb, offset);\r\npvaluedec = pvaluedec*100;\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_min_cp_duration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (%d ms)",pvaluedec);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_LEAD_CW:\r\nproto_tree_add_item(tree, hf_simulcrypt_lead_cw, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_CW_PER_MESSAGE:\r\nproto_tree_add_item(tree, hf_simulcrypt_cw_per_msg, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_MAX_COMP_TIME:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_max_comp_time, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ACCESS_CRITERIA:\r\nproto_tree_add_item(tree, hf_simulcrypt_access_criteria, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ECM_STREAM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_ecm_stream_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_NOMINAL_CP_DURATION:\r\npvaluedec = tvb_get_ntohs(tvb, offset);\r\npvaluedec = pvaluedec*100;\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_nominal_cp_duration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (%d ms)", pvaluedec);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ACCESS_CRITERIA_TRANSFER_MODE:\r\nproto_tree_add_item(tree, hf_simulcrypt_access_criteria_transfer_mode, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_CP_NUMBER:\r\nproto_tree_add_item(tree, hf_simulcrypt_cp_number, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_CP_DURATION:\r\npvaluedec = tvb_get_ntohs(tvb, offset);\r\npvaluedec = pvaluedec*100;\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_cp_duration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (%d ms)", pvaluedec);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_CP_CW_COMBINATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_cp_cw_combination, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ECM_DATAGRAM:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_ecm_datagram, tvb, offset, plen, ENC_NA);\r\nfor(i=0;i<ECM_INTERPRETATION_SIZE;i++)\r\n{\r\nif(tab_ecm_inter[i].ecmg_port==pinfo->srcport)\r\n{\r\nnext_tvb = tvb_new_subset_remaining(tvb, offset);\r\nsimulcrypt_ecm_datagram_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_ecm_datagram);\r\nif(tab_ecm_inter[i].protocol_handle != NULL)\r\n{\r\ncall_dissector(tab_ecm_inter[i].protocol_handle, next_tvb,pinfo, simulcrypt_ecm_datagram_tree);\r\n}\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ncase SIMULCRYPT_ECMG_CW_ENCRYPTION:\r\nproto_tree_add_item(tree, hf_simulcrypt_cw_encryption, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ECM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_ecm_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ERROR_STATUS:\r\nproto_tree_add_item(tree, hf_simulcrypt_ecmg_error_status, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_ECMG_ERROR_INFORMATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_error_information, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ndefault:\r\nproto_tree_add_string(tree, hf_simulcrypt_parameter_value, tvb, offset, plen, pvalue_char);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndissect_emmg_parameter_value (proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo _U_, guint32 offset,\r\nguint16 plen, guint16 ptype, gchar *pvalue_char)\r\n{\r\nproto_item *simulcrypt_item;\r\nswitch (ptype) {\r\ncase SIMULCRYPT_EMMG_CLIENT_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_client_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_SECTION_TSPKT_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_section_tspkt_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_DATA_CHANNEL_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_data_channel_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_DATA_STREAM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_data_stream_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_DATAGRAM:\r\nproto_tree_add_item(tree, hf_simulcrypt_datagram, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_BANDWIDTH:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_bandwidth, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " kbit/s");\r\nbreak;\r\ncase SIMULCRYPT_EMMG_DATA_TYPE:\r\nproto_tree_add_item(tree, hf_simulcrypt_data_type, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_DATA_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_data_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_ERROR_STATUS:\r\nproto_tree_add_item(tree, hf_simulcrypt_emmg_error_status, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_ERROR_INFORMATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_error_information, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ndefault:\r\nproto_tree_add_string(tree, hf_simulcrypt_parameter_value, tvb, offset, plen, pvalue_char);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndissect_eis_parameter_value (proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo _U_, guint32 offset,\r\nguint16 plen, guint16 ptype, gchar *pvalue_char)\r\n{\r\nproto_item *simulcrypt_item;\r\nproto_tree *simulcrypt_super_cas_id_tree;\r\nproto_tree *simulcrypt_ecm_group_tree;\r\nproto_tree *simulcrypt_activation_time_tree;\r\nguint32 pvaluedec;\r\nint ca_system_id;\r\nguint i;\r\nswitch (ptype) {\r\ncase SIMULCRYPT_EIS_CHANNEL_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_eis_channel_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SERVICE_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_service_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_COMPONENT_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_component_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_MAX_SCG:\r\nproto_tree_add_item(tree, hf_simulcrypt_max_scg, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ECM_GROUP:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_ecm_group, tvb, offset, plen, ENC_NA);\r\nsimulcrypt_ecm_group_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_ecm_group);\r\ndissect_simulcrypt_data(simulcrypt_ecm_group_tree, simulcrypt_item, pinfo, tvb, tree, offset, plen, SIMULCRYPT_EIS_SCS, TRUE);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCG_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_scg_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCG_REFERENCE_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_scg_reference_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SUPER_CAS_ID:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_super_cas_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nsimulcrypt_super_cas_id_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_super_cas_id);\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_super_cas_id_tree, hf_simulcrypt_ca_system_id, tvb, offset, 2, ENC_BIG_ENDIAN );\r\nca_system_id = tvb_get_ntohs(tvb,offset);\r\nfor(i=0;i<ECM_INTERPRETATION_SIZE;i++)\r\n{\r\nif(tab_ecm_inter[i].ca_system_id==ca_system_id)\r\n{\r\ntab_ecm_inter[i].ecmg_port=pinfo->destport;\r\nproto_item_append_text(simulcrypt_item, ", Port %d, Protocol %s",tab_ecm_inter[i].ecmg_port, tab_ecm_inter[i].protocol_name);\r\nbreak;\r\n}\r\n}\r\nproto_tree_add_item(simulcrypt_super_cas_id_tree, hf_simulcrypt_ca_subsystem_id, tvb, offset+2, 2, ENC_BIG_ENDIAN );\r\nbreak;\r\ncase SIMULCRYPT_EIS_ECM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_ecm_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ACCESS_CRITERIA:\r\nproto_tree_add_item(tree, hf_simulcrypt_access_criteria, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ACTIVATION_TIME:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_activation_time, tvb, offset, plen, ENC_NA);\r\nsimulcrypt_activation_time_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_activation_time);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_year, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_month, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_day, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_hour, tvb, offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_minute, tvb, offset+5, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_second, tvb, offset+6, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_hundredth_second, tvb, offset+7, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ACTIVATION_PENDING_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_activation_pending_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_COMPONENT_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_component_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SERVICE_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_service_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_TRANSPORT_STREAM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_transport_stream_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_AC_CHANGED_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_ac_changed_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCG_CURRENT_REFERENCE_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_scg_current_reference_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCG_PENDING_REFERENCE_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_scg_pending_reference_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_CP_DURATION_FLAG:\r\nproto_tree_add_item(tree, hf_simulcrypt_cp_duration_flag, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_RECOMMENDED_CP_DURATION:\r\npvaluedec = tvb_get_ntohs(tvb, offset);\r\npvaluedec = pvaluedec*100;\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_recommended_cp_duration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (%d ms)", pvaluedec);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCG_NOMINAL_CP_DURATION:\r\npvaluedec = tvb_get_ntohs(tvb, offset);\r\npvaluedec = pvaluedec*100;\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_scg_nominal_cp_duration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (%d ms)", pvaluedec);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ORIGINAL_NETWORK_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_original_network_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ERROR_STATUS:\r\nproto_tree_add_item(tree, hf_simulcrypt_eis_error_status, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ERROR_INFORMATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_error_information, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_EIS_ERROR_DESCRIPTION:\r\nproto_tree_add_item(tree, hf_simulcrypt_error_description, tvb, offset, plen, ENC_ASCII|ENC_NA);\r\nbreak;\r\ndefault:\r\nproto_tree_add_string(tree, hf_simulcrypt_parameter_value, tvb, offset, plen, pvalue_char);\r\nbreak;\r\n}\r\n}\r\nstatic void\r\ndissect_psig_parameter_value (proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo _U_, guint32 offset,\r\nguint16 plen, guint16 ptype, gchar *pvalue_char)\r\n{\r\nproto_tree *simulcrypt_psig_table_period_pair_tree;\r\nproto_tree *simulcrypt_activation_time_tree;\r\nproto_item *simulcrypt_item;\r\nguint32 pvaluedec;\r\nswitch (ptype) {\r\ncase SIMULCRYPT_PSIG_PSIG_TYPE:\r\npvaluedec = tvb_get_guint8(tvb, offset);\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_psig_type, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nswitch(pvaluedec){\r\ncase 1:\r\nproto_item_append_text(simulcrypt_item, " (PSIG)");\r\nbreak;\r\ncase 2:\r\nproto_item_append_text(simulcrypt_item, " (SIG)");\r\nbreak;\r\ncase 3:\r\nproto_item_append_text(simulcrypt_item, " (PSISIG)");\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase SIMULCRYPT_PSIG_CHANNEL_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_channel_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_STREAM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_stream_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_TRANSPORT_STREAM_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_transport_stream_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_ORIGINAL_NETWORK_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_original_network_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_PACKET_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_packet_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_INTERFACE_MODE_CONFIGURATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_interface_mode_configuration, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MAX_STREAM:\r\nproto_tree_add_item(tree, hf_simulcrypt_max_stream, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_TABLE_PERIOD_PAIR:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_table_period_pair, tvb, offset, plen, ENC_NA);\r\nsimulcrypt_psig_table_period_pair_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_table_period_pair);\r\ndissect_simulcrypt_data(simulcrypt_psig_table_period_pair_tree, simulcrypt_item, pinfo, tvb, tree, offset, plen, SIMULCRYPT_MUX_CIM, TRUE);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MPEG_SECTION:\r\nproto_tree_add_item(tree, hf_simulcrypt_mpeg_section, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_REPETITION_RATE:\r\nproto_tree_add_item(tree, hf_simulcrypt_repetition_rate, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_ACTIVATION_TIME:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_activation_time, tvb, offset, plen, ENC_NA);\r\nsimulcrypt_activation_time_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_activation_time);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_year, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_month, tvb, offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_day, tvb, offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_hour, tvb, offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_minute, tvb, offset+5, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_second, tvb, offset+6, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(simulcrypt_activation_time_tree, hf_simulcrypt_hundredth_second, tvb, offset+7, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_DATAGRAM:\r\nproto_tree_add_item(tree, hf_simulcrypt_datagram, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_BANDWIDTH:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_bandwidth, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " kbit/s");\r\nbreak;\r\ncase SIMULCRYPT_PSIG_INITIAL_BANDWIDTH:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_initial_bandwidth, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " kbit/s");\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MAX_COMP_TIME:\r\nsimulcrypt_item = proto_tree_add_item(tree, hf_simulcrypt_max_comp_time, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " ms");\r\nbreak;\r\ncase SIMULCRYPT_PSIG_ASI_INPUT_PACKET_ID:\r\nproto_tree_add_item(tree, hf_simulcrypt_asi_input_packet_id, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_ERROR_STATUS:\r\nproto_tree_add_item(tree, hf_simulcrypt_psig_error_status, tvb, offset, plen, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_ERROR_INFORMATION:\r\nproto_tree_add_item(tree, hf_simulcrypt_error_information, tvb, offset, plen, ENC_NA);\r\nbreak;\r\ndefault:\r\nproto_tree_add_string(tree, hf_simulcrypt_parameter_value, tvb, offset, plen, pvalue_char);\r\nbreak;\r\n}\r\n}\r\nstatic int\r\ndissect_simulcrypt_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *simulcrypt_item;\r\nproto_tree *simulcrypt_tree;\r\nproto_tree *simulcrypt_header_tree;\r\nproto_tree *simulcrypt_message_tree;\r\nguint16 type, iftype;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, PROTO_TAG_SIMULCRYPT);\r\ncol_clear(pinfo->cinfo,COL_INFO);\r\ntype = tvb_get_ntohs(tvb, 1);\r\niftype = get_interface (type);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%d > %d Info Type:[%s]",\r\npinfo->srcport, pinfo->destport,\r\nval_to_str_ext(type, &messagetypenames_ext, "Unknown Type:0x%02x"));\r\nif (tree)\r\n{\r\nguint32 offset = 0;\r\nguint32 msg_length;\r\nsimulcrypt_item = proto_tree_add_item(tree, proto_simulcrypt, tvb, 0, -1, ENC_NA);\r\nsimulcrypt_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt);\r\nproto_item_append_text(simulcrypt_item, ", Interface: %s", val_to_str(iftype, interfacenames, "Unknown (0x%02x)"));\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_tree, hf_simulcrypt_header, tvb, offset, 5, ENC_NA );\r\nsimulcrypt_header_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_header);\r\nproto_item_append_text(simulcrypt_header_tree, ", Length: %s", "5 bytes");\r\nproto_tree_add_item(simulcrypt_header_tree, hf_simulcrypt_version, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item(simulcrypt_header_tree, hf_simulcrypt_message_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nsimulcrypt_item = proto_tree_add_uint_format_value(simulcrypt_header_tree, hf_simulcrypt_interface, tvb, offset, 2, iftype,\r\n"%s", val_to_str_const(iftype, interfacenames, "Unknown"));\r\nPROTO_ITEM_SET_GENERATED (simulcrypt_item);\r\noffset+=2;\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_header_tree, hf_simulcrypt_message_length, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (bytes)");\r\nmsg_length = tvb_get_ntohs(tvb, offset);\r\noffset+=2;\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_tree, hf_simulcrypt_message, tvb, offset, -1, ENC_NA );\r\nsimulcrypt_message_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_message);\r\nproto_item_append_text(simulcrypt_message_tree, " containing TLV parameters");\r\nproto_item_append_text(simulcrypt_message_tree, ", Length: %d (bytes)", msg_length);\r\ndissect_simulcrypt_data(simulcrypt_message_tree, simulcrypt_item, pinfo, tvb, tree, offset, (msg_length+5), iftype, FALSE);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_simulcrypt_data(proto_tree *simulcrypt_tree, proto_item *simulcrypt_item, packet_info *pinfo _U_,\r\ntvbuff_t *tvb, proto_tree *tree, int offset,\r\nint container_data_length, guint16 iftype, gboolean is_subtree)\r\n{\r\nint subtree_offset = 0;\r\nproto_tree *simulcrypt_parameter_tree;\r\nint applied_offset;\r\nif(is_subtree)\r\n{\r\napplied_offset = subtree_offset;\r\n}\r\nelse\r\n{\r\napplied_offset = offset;\r\n}\r\nwhile (applied_offset < container_data_length)\r\n{\r\nguint16 plen;\r\nguint16 ptype;\r\ngchar *pvalue_char;\r\nptype = tvb_get_ntohs(tvb, offset);\r\nplen = tvb_get_ntohs(tvb, offset+2);\r\npvalue_char = tvb_bytes_to_str(wmem_packet_scope(), tvb, offset+4, plen);\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_tree, hf_simulcrypt_parameter, tvb, offset, plen+2+2, ENC_NA );\r\nswitch (iftype) {\r\ncase SIMULCRYPT_ECMG_SCS:\r\nproto_item_append_text(simulcrypt_item, ": Type=%s", val_to_str_ext(ptype, &ecmg_parametertypenames_ext, "Unknown Type:0x%02x"));\r\nbreak;\r\ncase SIMULCRYPT_EMMG_MUX:\r\nproto_item_append_text(simulcrypt_item, ": Type=%s", val_to_str_ext(ptype, &emmg_parametertypenames_ext, "Unknown Type:0x%02x"));\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCS:\r\nproto_item_append_text(simulcrypt_item, ": Type=%s", val_to_str_ext(ptype, &eis_parametertypenames_ext, "Unknown Type:0x%02x"));\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MUX:\r\ncase SIMULCRYPT_MUX_CIM:\r\ncase SIMULCRYPT_PSIG_CIP:\r\nproto_item_append_text(simulcrypt_item, ": Type=%s", val_to_str_ext(ptype, &psig_parametertypenames_ext, "Unknown Type:0x%02x"));\r\nbreak;\r\ndefault:\r\nproto_item_append_text(simulcrypt_item, ": Type=0x%02x", ptype);\r\nbreak;\r\n}\r\nproto_item_append_text(simulcrypt_item, ", Value Length=%d (bytes)", plen);\r\nproto_item_append_text(simulcrypt_item, ", Value=0x%s", pvalue_char);\r\nsimulcrypt_parameter_tree = proto_item_add_subtree(simulcrypt_item, ett_simulcrypt_parameter);\r\nswitch (iftype) {\r\ncase SIMULCRYPT_ECMG_SCS:\r\nproto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_ecmg_parameter_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_MUX:\r\nproto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_emmg_parameter_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCS:\r\nproto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_eis_parameter_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MUX:\r\ncase SIMULCRYPT_MUX_CIM:\r\ncase SIMULCRYPT_PSIG_CIP:\r\nproto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_psig_parameter_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_parameter_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\nsimulcrypt_item = proto_tree_add_item(simulcrypt_parameter_tree, hf_simulcrypt_parameter_length, tvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nproto_item_append_text(simulcrypt_item, " (bytes)");\r\noffset += 2+2;\r\nswitch (iftype) {\r\ncase SIMULCRYPT_ECMG_SCS:\r\ndissect_ecmg_parameter_value (simulcrypt_parameter_tree, tvb, pinfo, offset, plen, ptype, pvalue_char);\r\nbreak;\r\ncase SIMULCRYPT_EMMG_MUX:\r\ndissect_emmg_parameter_value (simulcrypt_parameter_tree, tvb, pinfo, offset, plen, ptype, pvalue_char);\r\nbreak;\r\ncase SIMULCRYPT_EIS_SCS:\r\ndissect_eis_parameter_value (simulcrypt_parameter_tree, tvb, pinfo, offset, plen, ptype, pvalue_char);\r\nbreak;\r\ncase SIMULCRYPT_PSIG_MUX:\r\ncase SIMULCRYPT_MUX_CIM:\r\ncase SIMULCRYPT_PSIG_CIP:\r\ndissect_psig_parameter_value (simulcrypt_parameter_tree, tvb, pinfo, offset, plen, ptype, pvalue_char);\r\nbreak;\r\ndefault:\r\nproto_tree_add_string(tree, hf_simulcrypt_parameter_value, tvb, offset, plen, pvalue_char);\r\nbreak;\r\n}\r\noffset += plen;\r\nsubtree_offset += 2+2+plen;\r\nif(is_subtree)\r\n{\r\napplied_offset = subtree_offset;\r\n}\r\nelse\r\n{\r\napplied_offset = offset;\r\n}\r\n}\r\n}\r\nstatic guint\r\nget_simulcrypt_message_len(packet_info *pinfo _U_, tvbuff_t *tvb,\r\nint offset, void *data _U_)\r\n{\r\nguint iLg;\r\niLg = tvb_get_ntohs(tvb,offset+3);\r\niLg += 5;\r\nreturn iLg;\r\n}\r\nstatic void\r\nsimulcrypt_init(void)\r\n{\r\nguint i;\r\nfor(i=0;i<ECM_INTERPRETATION_SIZE;i++)\r\n{\r\ntab_ecm_inter[i].ecmg_port = -1;\r\n}\r\n}\r\nvoid\r\nproto_register_simulcrypt (void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{ &hf_simulcrypt_header,\r\n{ "Header", "simulcrypt.header", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_version,\r\n{ "Version", "simulcrypt.version", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_message_type,\r\n{ "Message Type", "simulcrypt.message.type", FT_UINT16, BASE_HEX|BASE_EXT_STRING, &messagetypenames_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_interface,\r\n{ "Interface", "simulcrypt.message.interface", FT_UINT16, BASE_DEC, VALS(interfacenames), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_message_length,\r\n{ "Message Length", "simulcrypt.message.len", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_message,\r\n{ "Message", "simulcrypt.message", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_parameter,\r\n{ "Parameter", "simulcrypt.parameter", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_parameter_type,\r\n{ "Parameter Type", "simulcrypt.parameter.type", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecmg_parameter_type,\r\n{ "Parameter Type", "simulcrypt.parameter.type", FT_UINT16, BASE_HEX | BASE_EXT_STRING, &ecmg_parametertypenames_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_emmg_parameter_type,\r\n{ "Parameter Type", "simulcrypt.parameter.type", FT_UINT16, BASE_HEX | BASE_EXT_STRING, &emmg_parametertypenames_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_parameter_length,\r\n{ "Parameter Length", "simulcrypt.parameter.len", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ca_system_id,\r\n{ "CA System ID", "simulcrypt.parameter.ca_system_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ca_subsystem_id,\r\n{ "CA Subsystem ID", "simulcrypt.parameter.ca_subsystem_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_super_cas_id,\r\n{ "SuperCAS ID", "simulcrypt.super_cas_id", FT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_section_tspkt_flag,\r\n{ "Section TS pkt flag", "simulcrypt.section_tspkt_flag", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_channel_id,\r\n{ "ECM channel ID", "simulcrypt.ecm_channel_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_delay_start,\r\n{ "Delay start", "simulcrypt.delay_start", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_delay_stop,\r\n{ "Delay stop", "simulcrypt.delay_stop", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ac_delay_start,\r\n{ "AC delay start", "simulcrypt.ac_delay_start", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ac_delay_stop,\r\n{ "AC delay stop", "simulcrypt.ac_delay_stop", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_transition_delay_start,\r\n{ "Transition delay start", "simulcrypt.transition_delay_start", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_transition_delay_stop,\r\n{ "Transition delay stop", "simulcrypt.transition_delay_stop", FT_INT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_rep_period,\r\n{ "ECM repetition period", "simulcrypt.ecm_rep_period", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_max_streams,\r\n{ "Max streams", "simulcrypt.max_streams", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_min_cp_duration,\r\n{ "Min CP duration", "simulcrypt.min_cp_duration", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_lead_cw,\r\n{ "Lead CW", "simulcrypt.lead_cw", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cw_per_msg,\r\n{ "CW per msg", "simulcrypt.cw_per_msg", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_max_comp_time,\r\n{ "Max comp time", "simulcrypt.max_comp_time", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_access_criteria,\r\n{ "Access criteria", "simulcrypt.access_criteria", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_stream_id,\r\n{ "ECM stream ID", "simulcrypt.ecm_stream_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_nominal_cp_duration,\r\n{ "Nominal CP duration", "simulcrypt.nominal_cp_duration", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_access_criteria_transfer_mode,\r\n{ "AC transfer mode", "simulcrypt.access_criteria_transfer_mode", FT_BOOLEAN, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cp_number,\r\n{ "CP number", "simulcrypt.cp_number", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cp_duration,\r\n{ "CP duration", "simulcrypt.cp_duration", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cp_cw_combination,\r\n{ "CP CW combination", "simulcrypt.cp_cw_combination", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_datagram,\r\n{ "ECM datagram", "simulcrypt.ecm_datagram", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cw_encryption,\r\n{ "CW encryption", "simulcrypt.cw_encryption", FT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_id,\r\n{ "ECM ID", "simulcrypt.ecm_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_client_id,\r\n{ "Client ID", "simulcrypt.client_id", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_data_channel_id,\r\n{ "Data Channel ID", "simulcrypt.data_channel_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_data_stream_id,\r\n{ "Data Stream ID", "simulcrypt.data_stream_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_datagram,\r\n{ "Datagram", "simulcrypt.datagram", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_bandwidth,\r\n{ "Bandwidth", "simulcrypt.bandwidth", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_data_type,\r\n{ "Data Type", "simulcrypt.data_type", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_data_id,\r\n{ "Data ID", "simulcrypt.data_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecmg_error_status,\r\n{ "Error status", "simulcrypt.error_status", FT_UINT16, BASE_DEC | BASE_EXT_STRING, &ecmg_error_values_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_emmg_error_status,\r\n{ "Error status", "simulcrypt.error_status", FT_UINT16, BASE_DEC | BASE_EXT_STRING, &emmg_error_values_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_error_information,\r\n{ "Error information", "simulcrypt.error_information", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_eis_parameter_type,\r\n{ "Parameter Type", "simulcrypt.parameter.type", FT_UINT16, BASE_HEX | BASE_EXT_STRING, &eis_parametertypenames_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_eis_channel_id,\r\n{ "EIS channel ID", "simulcrypt.parameter.eis_channel_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_service_flag,\r\n{ "Service flag", "simulcrypt.parameter.service_flag", FT_BOOLEAN, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_component_flag,\r\n{ "Component flag", "simulcrypt.parameter.component_flag", FT_BOOLEAN, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_max_scg,\r\n{ "Max SCG", "simulcrypt.parameter.max_scg", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ecm_group,\r\n{ "ECM group", "simulcrypt.parameter.ecm_group", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_scg_id,\r\n{ "SCG ID", "simulcrypt.parameter.scg_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_scg_reference_id,\r\n{ "SCG reference ID", "simulcrypt.parameter.scg_reference_id", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_activation_time,\r\n{ "Activation time", "simulcrypt.parameter.activation_time", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_year,\r\n{ "Year", "simulcrypt.parameter.year", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_month,\r\n{ "Month", "simulcrypt.parameter.month", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_day,\r\n{ "Day", "simulcrypt.parameter.day", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_hour,\r\n{ "Hour", "simulcrypt.parameter.hour", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_minute,\r\n{ "Minute", "simulcrypt.parameter.minute", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_second,\r\n{ "Second", "simulcrypt.parameter.second", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_hundredth_second,\r\n{ "Hundredth_second", "simulcrypt.parameter.hundredth_second", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_activation_pending_flag,\r\n{ "Activation pending flag", "simulcrypt.parameter.activation_pending_flag", FT_BOOLEAN, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_component_id,\r\n{ "Component ID", "simulcrypt.parameter.component_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_service_id,\r\n{ "Service ID", "simulcrypt.parameter.service_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_transport_stream_id,\r\n{ "Transport stream ID", "simulcrypt.parameter.transport_stream_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_ac_changed_flag,\r\n{ "AC changed flag", "simulcrypt.parameter.ac_changed_flag", FT_BOOLEAN, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_scg_current_reference_id,\r\n{ "SCG current reference ID", "simulcrypt.parameter.scg_current_reference_id", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_scg_pending_reference_id,\r\n{ "SCG pending reference ID", "simulcrypt.parameter.scg_pending_reference_id", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_cp_duration_flag,\r\n{ "CP duration flag", "simulcrypt.parameter.cp_duration_flag", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_recommended_cp_duration,\r\n{ "Recommended CP duration", "simulcrypt.parameter.recommended_cp_duration", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_scg_nominal_cp_duration,\r\n{ "SCG nominal CP duration", "simulcrypt.parameter.scg_nominal_cp_duration", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_original_network_id,\r\n{ "Original network ID", "simulcrypt.parameter.original_network_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_eis_error_status,\r\n{ "Error status", "simulcrypt.error_status", FT_UINT16, BASE_DEC | BASE_EXT_STRING, &eis_error_values_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_error_description,\r\n{ "Error status", "simulcrypt.error_description", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_psig_parameter_type,\r\n{ "Parameter Type", "simulcrypt.parameter.type", FT_UINT16, BASE_HEX | BASE_EXT_STRING, &psig_parametertypenames_ext, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_psig_type,\r\n{ "PSIG type", "simulcrypt.parameter.psig_type", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_channel_id,\r\n{ "Channel ID", "simulcrypt.parameter.channel_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_stream_id,\r\n{ "Stream ID", "simulcrypt.parameter.stream_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_packet_id,\r\n{ "Packet ID", "simulcrypt.parameter.packet_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_interface_mode_configuration,\r\n{ "Interface mode configuration", "simulcrypt.parameter.interface_mode_configuration", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_max_stream,\r\n{ "Max stream", "simulcrypt.parameter.max_stream", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_table_period_pair,\r\n{ "Table period pair", "simulcrypt.parameter.table_period_pair", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_mpeg_section,\r\n{ "MPEG section", "simulcrypt.parameter.mpeg_section", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_repetition_rate,\r\n{ "Repetition rate", "simulcrypt.parameter.repetition_rate", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_initial_bandwidth,\r\n{ "Initial bandwidth", "simulcrypt.parameter.initial_bandwidth", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_asi_input_packet_id,\r\n{ "ASI input packet ID", "simulcrypt.parameter.asi_input_packet_id", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_psig_error_status,\r\n{ "Error status", "simulcrypt.parameter.error_status", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_simulcrypt_parameter_value,\r\n{ "Parameter Value", "simulcrypt.parameter.value", FT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }}\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_simulcrypt,\r\n&ett_simulcrypt_header,\r\n&ett_simulcrypt_message,\r\n&ett_simulcrypt_parameter,\r\n&ett_simulcrypt_super_cas_id,\r\n&ett_simulcrypt_ecm_datagram,\r\n&ett_simulcrypt_ecm_group,\r\n&ett_simulcrypt_activation_time,\r\n&ett_simulcrypt_table_period_pair\r\n};\r\nmodule_t *simulcrypt_module;\r\nproto_simulcrypt = proto_register_protocol ("SIMULCRYPT Protocol", "SIMULCRYPT", "simulcrypt");\r\nproto_register_field_array (proto_simulcrypt, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\nregister_init_routine(simulcrypt_init);\r\nsimulcrypt_module = prefs_register_protocol(proto_simulcrypt, proto_reg_handoff_simulcrypt);\r\nprefs_register_uint_preference(simulcrypt_module, "tcp.port", "Simulcrypt TCP Port",\r\n"Set the TCP port for Simulcrypt messages ('0' means no port is assigned)",\r\n10, &global_simulcrypt_tcp_port);\r\nprefs_register_uint_preference(simulcrypt_module, "udp.port", "Simulcrypt UDP Port",\r\n"Set the UDP port for Simulcrypt messages ('0' means no port is assigned)",\r\n10, &global_simulcrypt_udp_port);\r\nprefs_register_uint_preference(simulcrypt_module, "ca_system_id_mikey","MIKEY ECM CA_system_ID (in hex)",\r\n"Set the CA_system_ID used to decode ECM datagram as MIKEY", 16, &ca_system_id_mikey);\r\n}\r\nvoid\r\nproto_reg_handoff_simulcrypt(void)\r\n{\r\nstatic gboolean initialized=FALSE;\r\nstatic dissector_handle_t simulcrypt_handle;\r\nstatic guint tcp_port, udp_port;\r\nguint i;\r\nif (!initialized) {\r\nsimulcrypt_handle = create_dissector_handle(dissect_simulcrypt, proto_simulcrypt);\r\nfor(i=0;i<ECM_INTERPRETATION_SIZE;i++)\r\n{\r\ntab_ecm_inter[i].protocol_handle = find_dissector(tab_ecm_inter[i].protocol_name);\r\n}\r\ndissector_add_for_decode_as("tcp.port", simulcrypt_handle);\r\ndissector_add_for_decode_as("udp.port", simulcrypt_handle);\r\ninitialized = TRUE;\r\n}\r\nelse {\r\ndissector_delete_uint("tcp.port", tcp_port, simulcrypt_handle);\r\ndissector_delete_uint("udp.port", udp_port, simulcrypt_handle);\r\n}\r\nif (global_simulcrypt_tcp_port != 0) {\r\ndissector_add_uint("tcp.port", global_simulcrypt_tcp_port, simulcrypt_handle);\r\n}\r\nif (global_simulcrypt_udp_port != 0) {\r\ndissector_add_uint("udp.port", global_simulcrypt_udp_port, simulcrypt_handle);\r\n}\r\ntcp_port = global_simulcrypt_tcp_port;\r\nudp_port = global_simulcrypt_udp_port;\r\ntab_ecm_inter[ECM_MIKEY_INDEX].ca_system_id=ca_system_id_mikey;\r\n}
