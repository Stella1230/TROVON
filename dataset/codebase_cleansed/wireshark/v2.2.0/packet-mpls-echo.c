static void\r\ndissect_mpls_echo_tlv_fec(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem)\r\n{\r\nproto_tree *ti, *tlv_fec_tree;\r\nguint16 idx = 1, nil_idx = 1, type, saved_type;\r\nint length, nil_length, pad;\r\nguint32 label;\r\nguint8 exp, bos, ttl;\r\nwhile (rem >= 4) {\r\ntype = tvb_get_ntohs(tvb, offset);\r\nsaved_type = type;\r\nif (type >= TLV_FEC_VENDOR_PRIVATE_START)\r\ntype = TLV_FEC_VENDOR_PRIVATE_START;\r\nlength = tvb_get_ntohs(tvb, offset + 2);\r\nti = NULL;\r\ntlv_fec_tree = NULL;\r\nif (tree) {\r\ntlv_fec_tree = proto_tree_add_subtree_format(tree, tvb, offset, length + 4 + (4-(length%4)),\r\nett_mpls_echo_tlv_fec, NULL, "FEC Element %u: %s",\r\nidx, val_to_str_ext(type, &mpls_echo_tlv_fec_names_ext,\r\n"Unknown FEC type (0x%04X)"));\r\nproto_tree_add_uint_format_value(tlv_fec_tree, hf_mpls_echo_tlv_fec_type, tvb,\r\noffset, 2, saved_type, "%s (%u)",\r\nval_to_str_ext_const(type, &mpls_echo_tlv_fec_names_ext,\r\n"Unknown sub-TLV type"), saved_type);\r\nti = proto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_len, tvb, offset + 2,\r\n2, ENC_BIG_ENDIAN);\r\n}\r\nif (length + 4 > rem) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length (claimed %u, found %u)",\r\nlength, rem - 4);\r\nreturn;\r\n}\r\nswitch (type) {\r\ncase TLV_FEC_STACK_LDP_IPv4:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_ldp_ipv4,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_ldp_ipv4_mask,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_LDP_IPv6:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_ldp_ipv6,\r\ntvb, offset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_ldp_ipv6_mask,\r\ntvb, offset + 20, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_RSVP_IPv4:\r\nif (length != 20) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be %u)",\r\nlength, 20);\r\nreturn;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv4_ipv4_endpoint,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_mbz1,\r\ntvb, offset + 8, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_tunnel_id,\r\ntvb, offset + 10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv4_ext_tunnel_id,\r\ntvb, offset + 12, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv4_ipv4_sender,\r\ntvb, offset + 16, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_mbz2,\r\ntvb, offset + 20, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_lsp_id,\r\ntvb, offset + 22, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_RSVP_IPv6:\r\nif (length != 56) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be %u)",\r\nlength, 56);\r\nreturn;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv6_ipv6_endpoint,\r\ntvb, offset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_mbz1,\r\ntvb, offset + 20, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_tunnel_id,\r\ntvb, offset + 22, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv6_ext_tunnel_id,\r\ntvb, offset + 24, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ipv6_ipv6_sender,\r\ntvb, offset + 40, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_mbz2,\r\ntvb, offset + 56, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_lsp_id,\r\ntvb, offset + 58, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_VPN_IPv4:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_route_dist,\r\ntvb, offset + 4, 8, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_ipv4,\r\ntvb, offset + 12, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_len,\r\ntvb, offset + 16, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_VPN_IPv6:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_route_dist,\r\ntvb, offset + 4, 8, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_ipv6,\r\ntvb, offset + 12, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_vpn_len,\r\ntvb, offset + 28, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_L2_VPN:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2_vpn_route_dist,\r\ntvb, offset + 4, 8, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2_vpn_send_ve_id,\r\ntvb, offset + 12, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2_vpn_recv_ve_id,\r\ntvb, offset + 14, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2_vpn_encap_type,\r\ntvb, offset + 16, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_L2_CID_OLD:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_remote,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_vcid,\r\ntvb, offset + 8, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_encap,\r\ntvb, offset + 12, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_mbz,\r\ntvb, offset + 14, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_L2_CID_NEW:\r\nif (length < 14) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be %u)",\r\nlength, 14);\r\nreturn;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_sender,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_remote,\r\ntvb, offset + 8, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_vcid,\r\ntvb, offset + 12, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_encap,\r\ntvb, offset + 16, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_l2cid_mbz,\r\ntvb, offset + 18, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_VENDOR_PRIVATE_START:\r\nif (length < 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be >= %u)",\r\nlength, 4);\r\n} else {\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_vendor, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_value, tvb,\r\noffset + 8, length - 4, ENC_NA);\r\n}\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_BGP_LAB_v4:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_bgp_ipv4,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_bgp_len,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_BGP_LAB_v6:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_bgp_ipv6,\r\ntvb, offset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_bgp_len,\r\ntvb, offset + 20, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_GEN_IPv4:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_gen_ipv4,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_gen_ipv4_mask,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_GEN_IPv6:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_gen_ipv6,\r\ntvb, offset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_gen_ipv6_mask,\r\ntvb, offset + 20, 1, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_NIL:\r\nnil_length = length;\r\nwhile (nil_length >= 4) {\r\ndecode_mpls_label(tvb, offset + 4, &label, &exp, &bos, &ttl);\r\nif (label <= MPLS_LABEL_MAX_RESERVED) {\r\nproto_tree_add_uint_format(tlv_fec_tree, hf_mpls_echo_tlv_fec_nil_label,\r\ntvb, offset + 4, 3, label, "Label %u: %u (%s)", nil_idx, label,\r\nval_to_str_const(label, special_labels, "Reserved - Unknown"));\r\n} else {\r\nproto_tree_add_uint_format(tlv_fec_tree, hf_mpls_echo_tlv_fec_nil_label,\r\ntvb, offset + 4, 3, label, "Label %u: %u", nil_idx, label);\r\n}\r\nnil_length -= 4;\r\noffset += 4;\r\nnil_idx++;\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_P2MP_IPv4:\r\nif (length != 20) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be %u)",\r\nlength, 20);\r\nreturn;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_p2mp_id,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_mbz1,\r\ntvb, offset + 8, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_tunnel_id,\r\ntvb, offset + 10, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_ext_tunnel_id,\r\ntvb, offset + 12, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_ipv4_sender,\r\ntvb, offset + 16, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_mbz2,\r\ntvb, offset + 20, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_lsp_id,\r\ntvb, offset + 22, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_P2MP_IPv6:\r\nif (length != 56) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Length "\r\n"(claimed %u, should be %u)",\r\nlength, 56);\r\nreturn;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_p2mp_id,\r\ntvb, offset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_mbz1,\r\ntvb, offset + 20, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_tunnel_id,\r\ntvb, offset + 22, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_ext_tunnel_id,\r\ntvb, offset + 24, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_ipv6_sender,\r\ntvb, offset + 40, 16, ENC_NA);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_ip_mbz2,\r\ntvb, offset + 56, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_lsp_id,\r\ntvb, offset + 58, 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_STATIC_LSP:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_src_gid,\r\ntvb, (offset + 4), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_src_nid,\r\ntvb, (offset + 8), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_src_tunnel_no,\r\ntvb, (offset + 12), 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_lsp_no,\r\ntvb, (offset + 14), 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_dst_gid,\r\ntvb, (offset + 16), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_dst_nid,\r\ntvb, (offset + 20), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_dst_tunnel_no,\r\ntvb, (offset + 24), 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_resv,\r\ntvb, (offset + 26), 2, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_STATIC_PW:\r\nif (tree) {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_pw_serv_identifier,\r\ntvb, (offset + 4), 8, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_src_gid,\r\ntvb, (offset + 12), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_src_nid,\r\ntvb, (offset + 16), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_pw_src_ac_id,\r\ntvb, (offset + 20), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_dst_gid,\r\ntvb, (offset + 24), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_dst_nid,\r\ntvb, (offset + 28), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_lspping_tlv_pw_dst_ac_id,\r\ntvb, (offset + 32), 4, ENC_BIG_ENDIAN);\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_RES:\r\ndefault:\r\nif (length)\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_tlv_fec_value,\r\ntvb, offset + 4, length, ENC_NA);\r\nbreak;\r\n}\r\nif (length % 4) {\r\npad = 4 - (length % 4);\r\nif (length + 4 + pad > rem) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_fec_len,\r\n"Invalid FEC Sub-TLV Padded Length (claimed %u, found %u)",\r\nlength + pad, rem - 4);\r\nreturn;\r\n} else {\r\nproto_tree_add_item(tlv_fec_tree, hf_mpls_echo_padding, tvb, offset + 4 + length, pad, ENC_NA);\r\n}\r\nlength += pad;\r\n}\r\nrem -= 4 + length;\r\noffset += 4 + length;\r\nidx++;\r\n}\r\n}\r\nstatic void\r\ndissect_mpls_echo_tlv_ds_map(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem)\r\n{\r\nproto_tree *ti, *tlv_ds_map_tree;\r\nproto_tree *addr_ti;\r\nguint16 mplen, idx = 1;\r\nguint32 label;\r\nguint8 exp, bos, proto;\r\nguint8 hash_type, addr_type;\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_mtu, tvb,\r\noffset, 2, ENC_BIG_ENDIAN);\r\naddr_ti = proto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_addr_type, tvb,\r\noffset + 2, 1, ENC_BIG_ENDIAN);\r\nti = proto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_res, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_ds_map_tree = proto_item_add_subtree(ti, ett_mpls_echo_tlv_ds_map);\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_flag_res, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_flag_i, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_flag_n, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\naddr_type = tvb_get_guint8(tvb, offset + 2);\r\nswitch (addr_type) {\r\ncase TLV_ADDR_IPv4:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_ds_ip, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_int_ip, tvb,\r\noffset + 8, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_ADDR_UNNUM_IPv4:\r\ncase TLV_ADDR_UNNUM_IPv6:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_ds_ip, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_if_index, tvb,\r\noffset + 8, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_ADDR_IPv6:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_ds_ipv6, tvb,\r\noffset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_int_ipv6, tvb,\r\noffset + 20, 16, ENC_NA);\r\nrem -= 24;\r\noffset += 24;\r\nbreak;\r\ncase TLV_ADDR_NONIP :\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_ingress_if_num, tvb,\r\n(offset + 4), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_egress_if_num, tvb,\r\n(offset + 8), 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, addr_ti, &ei_mpls_echo_unknown_address_type,\r\n"Unknown Address Type (%u)", addr_type);\r\nbreak;\r\n}\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_hash_type, tvb,\r\noffset + 12, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_depth, tvb,\r\noffset + 13, 1, ENC_BIG_ENDIAN);\r\nti = proto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_muti_len, tvb,\r\noffset + 14, 2, ENC_BIG_ENDIAN);\r\nmplen = tvb_get_ntohs(tvb, offset + 14);\r\nhash_type = tvb_get_guint8(tvb, offset + 12);\r\nrem -= 16;\r\noffset += 16;\r\nif (rem < mplen) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_ds_map_muti_len,\r\n"Invalid FEC Multipath (claimed %u, found %u)",\r\nmplen, rem);\r\nreturn;\r\n}\r\nrem -= mplen;\r\nif (mplen) {\r\nswitch (hash_type) {\r\ncase TLV_DS_MAP_HASH_IP:\r\nif (mplen != 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_ds_map_muti_len,\r\n"Invalid FEC Multipath (claimed %u, should be 4)",\r\nmplen);\r\nbreak;\r\n}\r\ntlv_ds_map_tree = proto_tree_add_subtree(tree, tvb, offset, 4,\r\nett_mpls_echo_tlv_ds_map, NULL, "Multipath Information");\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_ip, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_DS_MAP_HASH_IP_RANGE:\r\nif (mplen != 8) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_ds_map_muti_len,\r\n"Invalid FEC Multipath (claimed %u, should be 8)",\r\nmplen);\r\nbreak;\r\n}\r\ntlv_ds_map_tree = proto_tree_add_subtree(tree, tvb, offset, 8,\r\nett_mpls_echo_tlv_ds_map, NULL, "Multipath Information");\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_ip_low, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_ip_high, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_DS_MAP_HASH_NO_MP:\r\ncase TLV_DS_MAP_HASH_NO_LABEL:\r\ncase TLV_DS_MAP_HASH_ALL_IP:\r\ncase TLV_DS_MAP_HASH_NO_MATCH:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_mp_no_multipath_info, tvb, offset, mplen, ENC_NA);\r\nbreak;\r\ncase TLV_DS_MAP_HASH_BITMASK_IP:\r\nif (mplen < 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_ds_map_muti_len,\r\n"Invalid FEC Multipath (claimed %u, should be 4)",\r\nmplen);\r\nbreak;\r\n}\r\ntlv_ds_map_tree = proto_tree_add_subtree(tree, tvb, offset, mplen,\r\nett_mpls_echo_tlv_ds_map, NULL, "Multipath Information");\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_ip, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\nif (mplen > 4)\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_mask, tvb,\r\noffset + 4, mplen - 4, ENC_NA);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ds_map_mp_value, tvb,\r\noffset, mplen, ENC_NA);\r\nbreak;\r\n}\r\n}\r\noffset += mplen;\r\nif (tree) {\r\nwhile (rem >= 4) {\r\ndecode_mpls_label(tvb, offset, &label, &exp, &bos, &proto);\r\ntlv_ds_map_tree = proto_tree_add_subtree_format(tree, tvb, offset, 4,\r\nett_mpls_echo_tlv_ds_map, &ti, "Downstream Label Element %u", idx);\r\nproto_item_append_text(ti, ", Label: %u", label);\r\nif (label <= MPLS_LABEL_MAX_RESERVED) {\r\nproto_tree_add_uint(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_label,\r\ntvb, offset, 3, label);\r\nproto_item_append_text(ti, " (%s)", val_to_str_const(label, special_labels,\r\n"Reserved - Unknown"));\r\n} else {\r\nproto_tree_add_uint_format_value(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_label,\r\ntvb, offset, 3, label, "%u", label);\r\n}\r\nproto_item_append_text(ti, ", Exp: %u, BOS: %u", exp, bos);\r\nproto_tree_add_uint(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_exp,\r\ntvb, offset + 2, 1, exp);\r\nproto_tree_add_uint(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_bos,\r\ntvb, offset + 2, 1, bos);\r\nproto_tree_add_item(tlv_ds_map_tree, hf_mpls_echo_tlv_ds_map_mp_proto,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti, ", Protocol: %u (%s)", proto,\r\nval_to_str_const(proto, mpls_echo_tlv_ds_map_mp_proto, "Unknown"));\r\nrem -= 4;\r\noffset += 4;\r\nidx++;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_mpls_echo_tlv_dd_map(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem)\r\n{\r\nproto_tree *ddti = NULL, *tlv_dd_map_tree, *tlv_ddstlv_map_tree;\r\nproto_tree *ddsti, *ddsti2;\r\nguint16 subtlv_length, subtlv_type, multipath_length;\r\nguint8 addr_type, multipath_type, fec_tlv_length;\r\nguint16 idx = 1;\r\nguint32 label;\r\nguint8 tc, s_bit, proto;\r\nif (tree) {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_mtu, tvb,\r\noffset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_addr_type, tvb,\r\noffset + 2, 1, ENC_BIG_ENDIAN);\r\nddti = proto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_res, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_dd_map_tree = proto_item_add_subtree(ddti, ett_mpls_echo_tlv_dd_map);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_flag_res, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_flag_i, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\nddti = proto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_flag_n, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\n}\r\naddr_type = tvb_get_guint8(tvb, offset + 2);\r\nswitch (addr_type) {\r\ncase TLV_ADDR_IPv4:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_ds_ip, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_int_ip, tvb,\r\noffset + 8, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_ADDR_IPv6:\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_ds_ipv6, tvb,\r\noffset + 4, 16, ENC_NA);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_int_ipv6, tvb,\r\noffset + 20, 16, ENC_NA);\r\nrem -= 24;\r\noffset += 24;\r\nbreak;\r\ncase TLV_ADDR_NONIP :\r\nproto_tree_add_item (tree, hf_mpls_echo_tlv_dd_map_ingress_if_num, tvb,\r\n(offset + 4), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (tree, hf_mpls_echo_tlv_dd_map_egress_if_num, tvb,\r\n(offset + 8), 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, ddti, &ei_mpls_echo_unknown_address_type,\r\n"Unknown Address Type (%u)", addr_type);\r\nbreak;\r\n}\r\nif (tree) {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_return_code, tvb,\r\noffset + 12, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_return_subcode, tvb,\r\noffset + 13, 1, ENC_BIG_ENDIAN);\r\nddti = proto_tree_add_item(tree, hf_mpls_echo_tlv_dd_map_subtlv_len, tvb,\r\noffset + 14, 2, ENC_BIG_ENDIAN);\r\n}\r\nrem -= 16;\r\noffset += 16;\r\nwhile (rem > 4) {\r\nsubtlv_type = tvb_get_ntohs(tvb, offset);\r\nsubtlv_length = tvb_get_ntohs(tvb, offset+2);\r\nrem -= 4;\r\noffset += 4;\r\nif (rem<subtlv_length){\r\nexpert_add_info_format(pinfo, ddti, &ei_mpls_echo_tlv_dd_map_subtlv_len,\r\n"Invalid Sub-tlv Length (claimed %u, found %u)",\r\nsubtlv_length, rem);\r\nreturn;\r\n}\r\nswitch (subtlv_type) {\r\ncase TLV_FEC_MULTIPATH_DATA:\r\nmultipath_type = tvb_get_guint8(tvb, offset);\r\nmultipath_length = tvb_get_ntohs(tvb, offset + 1);\r\ntlv_dd_map_tree = proto_tree_add_subtree(tree, tvb, offset - 4, multipath_length + 8,\r\nett_mpls_echo_tlv_dd_map, &ddsti, "Multipath sub-TLV");\r\nswitch (multipath_type) {\r\ncase TLV_MULTIPATH_NO_MULTIPATH:\r\nif (!tree)\r\nbreak;\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_length, tvb, offset + 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_resv, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_ddstlv_map_tree = proto_tree_add_subtree(tlv_dd_map_tree, tvb, offset + 4, multipath_length,\r\nett_mpls_echo_tlv_ddstlv_map, NULL, "Empty (Multipath Length = 0)");\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_multipath_info,\r\ntvb, offset + 4, multipath_length, ENC_NA);\r\nbreak;\r\ncase TLV_MULTIPATH_IP_ADDRESS:\r\nif (multipath_length != 4) {\r\nexpert_add_info_format(pinfo, ddsti, &ei_mpls_echo_tlv_dd_map_subtlv_len,\r\n"Invalid Sub-tlv Length (claimed %u, should be 4)",\r\nmultipath_length);\r\nbreak;\r\n}\r\nif (!tree)\r\nbreak;\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_length, tvb, offset + 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_resv, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_ddstlv_map_tree = proto_tree_add_subtree(tlv_dd_map_tree, tvb, offset + 4, multipath_length,\r\nett_mpls_echo_tlv_ddstlv_map, NULL, "Multipath Information (IP addresses)");\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_multipath_ip, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_MULTIPATH_IP_ADDRESS_RANGE:\r\nif (multipath_length != 8) {\r\nexpert_add_info_format(pinfo, ddsti, &ei_mpls_echo_tlv_dd_map_subtlv_len,\r\n"Invalid Sub-tlv Length (claimed %u, should be 8)",\r\nmultipath_length);\r\nbreak;\r\n}\r\nif (!tree)\r\nbreak;\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_length, tvb, offset + 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_resv, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_ddstlv_map_tree = proto_tree_add_subtree(tlv_dd_map_tree, tvb, offset + 4, multipath_length,\r\nett_mpls_echo_tlv_ddstlv_map, NULL, "Multipath Information (low/high address pairs)");\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_mp_ip_low, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_mp_ip_high, tvb,\r\noffset + 8, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_MULTIPATH_BIT_MASKED_IP:\r\nif (multipath_length < 4) {\r\nexpert_add_info_format(pinfo, ddsti, &ei_mpls_echo_tlv_dd_map_subtlv_len,\r\n"Invalid Sub-tlv Length (claimed %u, should be >= 4)",\r\nmultipath_length);\r\nbreak;\r\n}\r\nif (!tree)\r\nbreak;\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_length, tvb, offset + 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_resv, tvb,\r\noffset + 3, 1, ENC_BIG_ENDIAN);\r\ntlv_ddstlv_map_tree = proto_tree_add_subtree(tlv_dd_map_tree, tvb, offset + 4, multipath_length,\r\nett_mpls_echo_tlv_ddstlv_map, NULL, "Multipath Information (IP address prefix and bit mask)");\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_multipath_ip, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nif (multipath_length > 4)\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_mp_mask,\r\ntvb, offset + 8, multipath_length - 4, ENC_NA);\r\nbreak;\r\ncase TLV_MULTIPATH_BIT_MASKED_LABEL_SET:\r\nproto_tree_add_uint_format(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb, offset, 1, multipath_type,\r\n"Multipath Information (Label prefix and bit mask)");\r\nbreak;\r\ndefault:\r\nif (!tree)\r\nbreak;\r\nproto_tree_add_uint_format(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb, offset, 1, multipath_type,\r\n"Multipath Type not identified (%u)", multipath_type);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_type, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree,\r\nhf_mpls_echo_sub_tlv_multipath_length, tvb, offset + 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_multipath_value, tvb,\r\noffset + 3, rem, ENC_NA);\r\nbreak;\r\n}\r\nrem -= (multipath_length + 4);\r\nbreak;\r\ncase TLV_FEC_LABEL_STACK:\r\ntlv_dd_map_tree = proto_tree_add_subtree(tree, tvb, offset - 4, subtlv_length + 4,\r\nett_mpls_echo_tlv_dd_map, NULL, "Label stack sub-TLV");\r\nwhile (rem >= 4) {\r\nif (tree) {\r\ndecode_mpls_label(tvb, offset, &label, &tc, &s_bit, &proto);\r\ntlv_ddstlv_map_tree = proto_tree_add_subtree_format(tlv_dd_map_tree, tvb, offset, 4,\r\nett_mpls_echo_tlv_ddstlv_map, &ddsti2, "Downstream Label Element %u", idx);\r\nproto_item_append_text(ddsti2, ", Label: %u , Protocol: %u", label, proto);\r\nproto_tree_add_uint(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_label, tvb, offset, 3, label);\r\nproto_tree_add_uint(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_traffic_class, tvb, offset + 2, 1, tc);\r\nproto_tree_add_uint(tlv_ddstlv_map_tree, hf_mpls_echo_sub_tlv_s_bit, tvb, offset + 2, 1, s_bit);\r\nproto_tree_add_item(tlv_ddstlv_map_tree, hf_mpls_echo_tlv_ddstlv_map_mp_proto,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\n}\r\nrem -= 4;\r\noffset += 4;\r\nidx++;\r\n}\r\nbreak;\r\ncase TLV_FEC_STACK_CHANGE: {\r\naddr_type = tvb_get_guint8(tvb, offset + 1);\r\nfec_tlv_length = tvb_get_guint8(tvb, offset + 2);\r\ntlv_dd_map_tree = proto_tree_add_subtree(tree, tvb, offset - 4, fec_tlv_length + 12,\r\nett_mpls_echo_tlv_dd_map, NULL, "Stack change sub-TLV");\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_op_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_addr_type, tvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_fec_tlv_value, tvb, offset + 2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_res, tvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nswitch (addr_type) {\r\ncase SUB_TLV_FEC_UNSPECIFIED:\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_remote_peer_unspecified, tvb, offset + 4, 0, ENC_NA);\r\nrem += 4;\r\noffset -= 4;\r\nbreak;\r\ncase SUB_TLV_FEC_IPV4:\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_remote_peer_ip, tvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase SUB_TLV_FEC_IPV6:\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_sub_tlv_remore_peer_ipv6, tvb, offset + 4, 16, ENC_NA);\r\nrem -= 12;\r\noffset += 12;\r\nbreak;\r\n}\r\noffset -= 8;\r\ndissect_mpls_echo_tlv_fec(tvb, pinfo, offset, tlv_dd_map_tree, fec_tlv_length);\r\nrem -= (fec_tlv_length + 8);\r\nbreak;\r\n}\r\ndefault:\r\ntlv_dd_map_tree = proto_tree_add_subtree(tree, tvb, offset, subtlv_length, ett_mpls_echo_tlv_dd_map, NULL, "Error processing sub-TLV");\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_type, tvb, offset - 4, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_length, tvb, offset - 2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_dd_map_tree, hf_mpls_echo_tlv_dd_map_value, tvb, offset, subtlv_length, ENC_NA);\r\nrem -= subtlv_length;\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_mpls_echo_tlv_ilso(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem, gboolean is_ipv6)\r\n{\r\nproto_tree *ti;\r\nguint8 type;\r\nguint16 idx = 1;\r\nguint32 label;\r\nguint8 exp, bos, ttl;\r\nti = proto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_addr_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\ntype = tvb_get_guint8(tvb, offset);\r\noffset += 1;\r\nrem -= 1;\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_mbz, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nrem -= 3;\r\nif ((type == TLV_ADDR_IPv4) || (type == TLV_ADDR_UNNUM_IPv4)) {\r\nif (is_ipv6) {\r\nexpert_add_info(pinfo, ti, &ei_mpls_echo_incorrect_address_type);\r\n}\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_ipv4_addr, tvb,\r\noffset, 4, ENC_BIG_ENDIAN);\r\nif (type == TLV_ADDR_IPv4) {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_ipv4_int_addr, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_int_index, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\n}\r\noffset += 8;\r\nrem -= 8;\r\n} else if ((type == TLV_ADDR_IPv6) || (type == TLV_ADDR_UNNUM_IPv6)) {\r\nif (!is_ipv6) {\r\nexpert_add_info(pinfo, ti, &ei_mpls_echo_incorrect_address_type);\r\n}\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_ipv6_addr, tvb,\r\noffset, 16, ENC_NA);\r\nif (type == TLV_ADDR_IPv6) {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_ipv6_int_addr, tvb,\r\noffset + 16, 16, ENC_NA);\r\noffset += 32;\r\nrem -= 32;\r\n} else {\r\nproto_tree_add_item(tree, hf_mpls_echo_tlv_ilso_int_index, tvb,\r\noffset + 16, 4, ENC_BIG_ENDIAN);\r\noffset += 20;\r\nrem -= 20;\r\n}\r\n} else {\r\nexpert_add_info(pinfo, ti, &ei_mpls_echo_incorrect_address_type);\r\nreturn;\r\n}\r\nif (tree) {\r\nwhile (rem >= 4) {\r\nproto_tree *tlv_ilso;\r\ndecode_mpls_label(tvb, offset, &label, &exp, &bos, &ttl);\r\ntlv_ilso = proto_tree_add_subtree_format(tree, tvb, offset, 4, ett_mpls_echo_tlv_ilso, &ti, "Label Stack Element %u", idx);\r\nproto_item_append_text(ti, ", Label: %u", label);\r\nif (label <= MPLS_LABEL_MAX_RESERVED) {\r\nproto_tree_add_uint_format_value(tlv_ilso, hf_mpls_echo_tlv_ilso_label,\r\ntvb, offset, 3, label, "%u (%s)", label,\r\nval_to_str_const(label, special_labels, "Reserved - Unknown"));\r\nproto_item_append_text(ti, " (%s)", val_to_str_const(label, special_labels,\r\n"Reserved - Unknown"));\r\n} else {\r\nproto_tree_add_uint_format_value(tlv_ilso, hf_mpls_echo_tlv_ilso_label,\r\ntvb, offset, 3, label, "%u", label);\r\n}\r\nproto_item_append_text(ti, ", Exp: %u, BOS: %u, TTL: %u",\r\nexp, bos, ttl);\r\nproto_tree_add_uint(tlv_ilso, hf_mpls_echo_tlv_ilso_exp,\r\ntvb, offset + 2, 1, exp);\r\nproto_tree_add_uint(tlv_ilso, hf_mpls_echo_tlv_ilso_bos,\r\ntvb, offset + 2, 1, bos);\r\nproto_tree_add_item(tlv_ilso, hf_mpls_echo_tlv_ilso_ttl,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nrem -= 4;\r\noffset += 4;\r\nidx++;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_mpls_echo_tlv_errored(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem)\r\n{\r\nint errored_tlv_length;\r\nwhile (rem >= 4) {\r\nerrored_tlv_length = dissect_mpls_echo_tlv(tvb, pinfo, offset, tree, rem, TRUE);\r\nrem -= errored_tlv_length;\r\noffset += errored_tlv_length;\r\n}\r\n}\r\nstatic int\r\ndissect_mpls_echo_tlv(tvbuff_t *tvb, packet_info *pinfo, guint offset, proto_tree *tree, int rem, gboolean in_errored)\r\n{\r\nproto_tree *ti = NULL, *mpls_echo_tlv_tree = NULL;\r\nguint16 type, saved_type;\r\nint length;\r\nlength = tvb_reported_length_remaining(tvb, offset);\r\nrem = MIN(rem, length);\r\nif ( rem < 4 ) {\r\nproto_tree_add_expert_format(tree, pinfo, &ei_mpls_echo_tlv_len, tvb, offset, rem,\r\n"Error processing TLV: length is %d, should be >= 4", rem);\r\nreturn rem;\r\n}\r\ntype = tvb_get_ntohs(tvb, offset);\r\nlength = tvb_get_ntohs(tvb, offset + 2);\r\nrem -= 4;\r\nlength = MIN(length, rem);\r\nsaved_type = type;\r\nif (type >= TLV_VENDOR_PRIVATE_START)\r\ntype = TLV_VENDOR_PRIVATE_START;\r\nif (tree) {\r\nmpls_echo_tlv_tree = proto_tree_add_subtree_format(tree, tvb, offset, length + 4, ett_mpls_echo_tlv, NULL,\r\n"%s%s", in_errored ? "Errored TLV Type: " : "",\r\nval_to_str_ext(type, &mpls_echo_tlv_type_names_ext, "Unknown TLV type (0x%04X)"));\r\nif (in_errored) {\r\nproto_tree_add_uint_format_value(mpls_echo_tlv_tree, hf_mpls_echo_tlv_errored_type, tvb,\r\noffset, 2, saved_type, "%s (%u)",\r\nval_to_str_ext_const(type, &mpls_echo_tlv_type_names_ext,\r\n"Unknown TLV type"), saved_type);\r\n} else {\r\nproto_tree_add_uint_format_value(mpls_echo_tlv_tree, hf_mpls_echo_tlv_type, tvb,\r\noffset, 2, saved_type, "%s (%u)",\r\nval_to_str_ext_const(type, &mpls_echo_tlv_type_names_ext,\r\n"Unknown TLV type"), saved_type);\r\n}\r\nti = proto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_len, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\n}\r\nif (length == 0)\r\nreturn 4;\r\nswitch (type) {\r\ncase TLV_TARGET_FEC_STACK:\r\ndissect_mpls_echo_tlv_fec(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length);\r\nbreak;\r\ncase TLV_PAD:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_padaction, tvb,\r\noffset + 4, 1, ENC_BIG_ENDIAN);\r\nif (length > 1)\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_padding, tvb,\r\noffset + 5, length - 1, ENC_NA);\r\nbreak;\r\ncase TLV_VENDOR_CODE:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_vendor, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_ILSO_IPv4:\r\nif (length < 12) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be >= 12)",\r\nlength);\r\nbreak;\r\n}\r\ndissect_mpls_echo_tlv_ilso(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length, FALSE);\r\nbreak;\r\ncase TLV_ILSO_IPv6:\r\nif (length < 24) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be >= 24)",\r\nlength);\r\nbreak;\r\n}\r\ndissect_mpls_echo_tlv_ilso(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length, TRUE);\r\nbreak;\r\n#if 0\r\ncase TLV_RTO_IPv4:\r\nif (length != 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 4)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_rto_ipv4,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_RTO_IPv6:\r\nif (length != 16) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 16)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_rto_ipv6,\r\ntvb, offset + 4, 16, ENC_NA);\r\nbreak;\r\n#endif\r\ncase TLV_P2MP_ECHO_JITTER:\r\nif (length != 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 4)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_echo_jitter,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_P2MP_RESPONDER_IDENT: {\r\nguint16 resp_ident_type, resp_ident_len;\r\nproto_item *hidden_item;\r\nresp_ident_type = tvb_get_ntohs(tvb, offset + 4);\r\nresp_ident_len = tvb_get_ntohs(tvb, offset + 6);\r\nswitch (resp_ident_type) {\r\ncase TLV_P2MP_RESPONDER_IDENT_IPV4_EGRESS_ADDR:\r\ncase TLV_P2MP_RESPONDER_IDENT_IPV4_NODE_ADDR:\r\nif (resp_ident_len != 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 4)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_responder_indent_type,\r\ntvb, offset + 4, 2, ENC_BIG_ENDIAN);\r\nhidden_item = proto_tree_add_item(mpls_echo_tlv_tree,\r\nhf_mpls_echo_tlv_responder_indent_len, tvb,\r\noffset + 6, 2, ENC_BIG_ENDIAN);\r\nPROTO_ITEM_SET_HIDDEN(hidden_item);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_responder_indent_ipv4,\r\ntvb, offset + 8, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_P2MP_RESPONDER_IDENT_IPV6_EGRESS_ADDR:\r\ncase TLV_P2MP_RESPONDER_IDENT_IPV6_NODE_ADDR:\r\nif (resp_ident_len != 16) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 16)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_responder_indent_type,\r\ntvb, offset + 4, 2, ENC_BIG_ENDIAN);\r\nhidden_item = proto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_responder_indent_len,\r\ntvb, offset + 6, 2, ENC_BIG_ENDIAN);\r\nPROTO_ITEM_SET_HIDDEN(hidden_item);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_responder_indent_ipv4,\r\ntvb, offset + 8, 16, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\nbreak;\r\n}\r\ncase TLV_VENDOR_PRIVATE_START:\r\nif (length < 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be >= 4)",\r\nlength);\r\n} else {\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_vendor, tvb,\r\noffset + 4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_value, tvb,\r\noffset + 8, length - 4, ENC_NA);\r\n}\r\nbreak;\r\ncase TLV_DOWNSTREAM_MAPPING:\r\nif (length < 16) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be >= 16)",\r\nlength);\r\nbreak;\r\n}\r\ndissect_mpls_echo_tlv_ds_map(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length);\r\nbreak;\r\ncase TLV_DETAILED_DOWNSTREAM:\r\nif (length < 16) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be >= 16)",\r\nlength);\r\nbreak;\r\n}\r\ndissect_mpls_echo_tlv_dd_map(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length);\r\nbreak;\r\ncase TLV_ERRORED_TLV:\r\nif (in_errored)\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_value, tvb,\r\noffset + 4, length, ENC_NA);\r\nelse\r\ndissect_mpls_echo_tlv_errored(tvb, pinfo, offset + 4, mpls_echo_tlv_tree, length);\r\nbreak;\r\ncase TLV_REPLY_TOS:\r\nif (length != 4) {\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_tlv_len,\r\n"Invalid TLV Length (claimed %u, should be 4)",\r\nlength);\r\nbreak;\r\n}\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_reply_tos, tvb,\r\noffset + 4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_reply_tos_mbz, tvb,\r\noffset + 5, 3, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_SRC_IDENTIFIER:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_lspping_tlv_src_addr_gid,\r\ntvb, (offset + 4), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_lspping_tlv_src_addr_nid,\r\ntvb, (offset + 8), 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_DST_IDENTIFIER:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_lspping_tlv_src_addr_gid,\r\ntvb, (offset + 4), 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_lspping_tlv_src_addr_nid,\r\ntvb, (offset + 8), 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_BFD_DISCRIMINATOR:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_bfd,\r\ntvb, (offset + 4), 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase TLV_REVERSE_PATH_FEC_STACK:\r\ndissect_mpls_echo_tlv_fec (tvb, pinfo, (offset + 4), mpls_echo_tlv_tree, length);\r\nbreak ;\r\ncase TLV_ERROR_CODE:\r\ndefault:\r\nproto_tree_add_item(mpls_echo_tlv_tree, hf_mpls_echo_tlv_value, tvb,\r\noffset + 4, length, ENC_NA);\r\nbreak;\r\n}\r\nreturn length + 4;\r\n}\r\nstatic int\r\ndissect_mpls_echo(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nint offset = 0, rem = 0, len;\r\nproto_item *ti = NULL;\r\nproto_tree *mpls_echo_tree = NULL;\r\nguint8 msgtype;\r\nif (tvb_captured_length(tvb) < 5) {\r\nreturn 0;\r\n}\r\nif (tvb_get_ntohs(tvb, 0) != 1) {\r\nreturn 0;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "MPLS ECHO");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nrem = tvb_reported_length_remaining(tvb, offset);\r\nmsgtype = tvb_get_guint8(tvb, offset + 4);\r\nif ( ((!MSGTYPE_MPLS_ECHO(msgtype)) && (rem < 16)) ||\r\n((MSGTYPE_MPLS_ECHO(msgtype)) && (rem < 32)) ) {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Malformed Message");\r\nti = proto_tree_add_item(tree, proto_mpls_echo, tvb, 0, -1, ENC_NA);\r\nexpert_add_info_format(pinfo, ti, &ei_mpls_echo_malformed, "Error processing Message: length is %d, should be >= %u",\r\nrem, (MSGTYPE_MPLS_ECHO(msgtype)) ? 32 : 16);\r\nreturn 0;\r\n}\r\ncol_add_str(pinfo->cinfo, COL_INFO,\r\nval_to_str(msgtype, mpls_echo_msgtype, "Unknown Message Type (0x%02X)"));\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_mpls_echo, tvb, 0, -1, ENC_NA);\r\nmpls_echo_tree = proto_item_add_subtree(ti, ett_mpls_echo);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_version, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nif (MSGTYPE_MPLS_ECHO(msgtype)) {\r\nproto_tree *mpls_echo_gflags;\r\nti = proto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_gflags, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\nmpls_echo_gflags = proto_item_add_subtree(ti, ett_mpls_echo_gflags);\r\nproto_tree_add_item(mpls_echo_gflags,\r\nhf_mpls_echo_flag_sbz, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_gflags,\r\nhf_mpls_echo_flag_v, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_gflags,\r\nhf_mpls_echo_flag_t, tvb, (offset + 2), 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_gflags,\r\nhf_mpls_echo_flag_r, tvb, (offset + 2), 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_mbz, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\n}\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_msgtype, tvb, offset + 4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_replymode, tvb, offset + 5, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_returncode, tvb, offset + 6, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_returnsubcode, tvb, offset + 7, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_handle, tvb, offset + 8, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree,\r\nhf_mpls_echo_sequence, tvb, offset + 12, 4, ENC_BIG_ENDIAN);\r\nif (MSGTYPE_MPLS_ECHO(msgtype)) {\r\nproto_tree_add_item(mpls_echo_tree, hf_mpls_echo_ts_sent, tvb,\r\noffset + 16, 8, ENC_TIME_NTP|ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpls_echo_tree, hf_mpls_echo_ts_rec, tvb,\r\noffset + 24, 8, ENC_TIME_NTP|ENC_BIG_ENDIAN);\r\n}\r\n}\r\nif (MSGTYPE_MPLS_ECHO(msgtype)) {\r\noffset += 32;\r\nrem -= 32;\r\n} else {\r\noffset += 16;\r\nrem -= 16;\r\n}\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0 ) {\r\nlen = dissect_mpls_echo_tlv(tvb, pinfo, offset, mpls_echo_tree, rem, FALSE);\r\noffset += len;\r\nrem -= len;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_mpls_echo(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_mpls_echo_version,\r\n{ "Version", "mpls_echo.version",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO Version Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_mbz,\r\n{ "MBZ", "mpls_echo.mbz",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, "MPLS ECHO Must be Zero", HFILL}\r\n},\r\n{ &hf_mpls_echo_gflags,\r\n{ "Global Flags", "mpls_echo.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, "MPLS ECHO Global Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_flag_sbz,\r\n{ "Reserved", "mpls_echo.flag_sbz",\r\nFT_UINT16, BASE_HEX, NULL, 0xFFF8, "MPLS ECHO Reserved Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_flag_v,\r\n{ "Validate FEC Stack", "mpls_echo.flag_v",\r\nFT_BOOLEAN, 16, NULL, 0x0001, "MPLS ECHO Validate FEC Stack Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_flag_t,\r\n{ "Respond only if TTL expired", "mpls_echo.flag_t",\r\nFT_BOOLEAN, 16, NULL, 0x0002, "MPLS ECHO Respond only if TTL expired Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_flag_r,\r\n{ "Validate Reverse Path", "mpls_echo.flag_r",\r\nFT_BOOLEAN, 16, NULL, 0x0004, "MPLS ECHO Validate Reverse Path Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_msgtype,\r\n{ "Message Type", "mpls_echo.msg_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_msgtype), 0x0, "MPLS ECHO Message Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_replymode,\r\n{ "Reply Mode", "mpls_echo.reply_mode",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_replymode), 0x0, "MPLS ECHO Reply Mode", HFILL}\r\n},\r\n{ &hf_mpls_echo_returncode,\r\n{ "Return Code", "mpls_echo.return_code",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &mpls_echo_returncode_ext, 0x0, "MPLS ECHO Return Code", HFILL}\r\n},\r\n{ &hf_mpls_echo_returnsubcode,\r\n{ "Return Subcode", "mpls_echo.return_subcode",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO Return Subcode", HFILL}\r\n},\r\n{ &hf_mpls_echo_handle,\r\n{ "Sender's Handle", "mpls_echo.sender_handle",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, "MPLS ECHO Sender's Handle", HFILL}\r\n},\r\n{ &hf_mpls_echo_sequence,\r\n{ "Sequence Number", "mpls_echo.sequence",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "MPLS ECHO Sequence Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_ts_sent,\r\n{ "Timestamp Sent", "mpls_echo.timestamp_sent",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x0, "MPLS ECHO Timestamp Sent", HFILL}\r\n},\r\n{ &hf_mpls_echo_ts_rec,\r\n{ "Timestamp Received", "mpls_echo.timestamp_rec",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x0, "MPLS ECHO Timestamp Received", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_type,\r\n{ "Type", "mpls_echo.tlv.type",\r\nFT_UINT16, BASE_DEC | BASE_EXT_STRING, &mpls_echo_tlv_type_names_ext, 0x0,\r\n"MPLS ECHO TLV Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_len,\r\n{ "Length", "mpls_echo.tlv.len",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_value,\r\n{ "Value", "mpls_echo.tlv.value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Value", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_type,\r\n{ "Type", "mpls_echo.tlv.fec.type",\r\nFT_UINT16, BASE_DEC | BASE_EXT_STRING, &mpls_echo_tlv_fec_names_ext, 0x0,\r\n"MPLS ECHO TLV FEC Stack Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_len,\r\n{ "Length", "mpls_echo.tlv.fec.len",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_value,\r\n{ "Value", "mpls_echo.tlv.fec.value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack Value", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_ldp_ipv4,\r\n{ "IPv4 Prefix", "mpls_echo.tlv.fec.ldp_ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack LDP IPv4", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_ldp_ipv4_mask,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.ldp_ipv4_mask",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack LDP IPv4 Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_ldp_ipv6,\r\n{ "IPv6 Prefix", "mpls_echo.tlv.fec.ldp_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack LDP IPv6", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_ldp_ipv6_mask,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.ldp_ipv6_mask",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack LDP IPv6 Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv4_ipv4_endpoint,\r\n{ "IPv4 Tunnel endpoint address", "mpls_echo.tlv.fec.rsvp_ipv4_ep",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv4 Tunnel Endpoint Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv6_ipv6_endpoint,\r\n{ "IPv6 Tunnel endpoint address", "mpls_echo.tlv.fec.rsvp_ipv6_ep",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv6 Tunnel Endpoint Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ip_mbz1,\r\n{ "Must Be Zero", "mpls_echo.tlv.fec.rsvp_ip_mbz1",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ip_tunnel_id,\r\n{ "Tunnel ID", "mpls_echo.tlv.fec.rsvp_ip_tun_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv4_ext_tunnel_id,\r\n{ "Extended Tunnel ID", "mpls_echo.tlv.fec.rsvp_ipv4_ext_tun_id",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv4 Extended Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv4_ipv4_sender,\r\n{ "IPv4 Tunnel sender address", "mpls_echo.tlv.fec.rsvp_ipv4_sender",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv4 Sender", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv6_ext_tunnel_id,\r\n{ "Extended Tunnel ID", "mpls_echo.tlv.fec.rsvp_ipv6_ext_tun_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv6 Extended Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ipv6_ipv6_sender,\r\n{ "IPv6 Tunnel sender address", "mpls_echo.tlv.fec.rsvp_ipv6_sender",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP IPv4 Sender", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ip_mbz2,\r\n{ "Must Be Zero", "mpls_echo.tlv.fec.rsvp_ip_mbz2",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_ip_lsp_id,\r\n{ "LSP ID", "mpls_echo.tlv.fec.rsvp_ip_lsp_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP LSP ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_vpn_route_dist,\r\n{ "Route Distinguisher", "mpls_echo.tlv.fec.vpn_route_dist",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack VPN Route Distinguisher", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_vpn_ipv4,\r\n{ "IPv4 Prefix", "mpls_echo.tlv.fec.vpn_ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack VPN IPv4", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_vpn_ipv6,\r\n{ "IPv6 Prefix", "mpls_echo.tlv.fec.vpn_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack VPN IPv6", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_vpn_len,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.vpn_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack VPN Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2_vpn_route_dist,\r\n{ "Route Distinguisher", "mpls_echo.tlv.fec.l2vpn_route_dist",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2VPN Route Distinguisher", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2_vpn_send_ve_id,\r\n{ "Sender's VE ID", "mpls_echo.tlv.fec.l2vpn_send_ve_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2VPN Sender's VE ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2_vpn_recv_ve_id,\r\n{ "Receiver's VE ID", "mpls_echo.tlv.fec.l2vpn_recv_ve_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2VPN Receiver's VE ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2_vpn_encap_type,\r\n{ "Encapsulation", "mpls_echo.tlv.fec.l2vpn_encap_type",\r\nFT_UINT16, BASE_DEC, VALS(fec_vc_types_vals), 0x0, "MPLS ECHO TLV FEC Stack L2VPN Encapsulation", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2cid_sender,\r\n{ "Sender's PE Address", "mpls_echo.tlv.fec.l2cid_sender",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2CID Sender", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2cid_remote,\r\n{ "Remote PE Address", "mpls_echo.tlv.fec.l2cid_remote",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2CID Remote", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2cid_vcid,\r\n{ "VC ID", "mpls_echo.tlv.fec.l2cid_vcid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2CID VCID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2cid_encap,\r\n{ "Encapsulation", "mpls_echo.tlv.fec.l2cid_encap",\r\nFT_UINT16, BASE_DEC, VALS(fec_vc_types_vals), 0x0, "MPLS ECHO TLV FEC Stack L2CID Encapsulation", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_l2cid_mbz,\r\n{ "MBZ", "mpls_echo.tlv.fec.l2cid_mbz",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV FEC Stack L2CID MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_bgp_ipv4,\r\n{ "IPv4 Prefix", "mpls_echo.tlv.fec.bgp_ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack BGP IPv4", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_bgp_ipv6,\r\n{ "IPv6 Prefix", "mpls_echo.tlv.fec.bgp_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack BGP IPv6", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_bgp_len,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.bgp_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack BGP Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_gen_ipv4,\r\n{ "IPv4 Prefix", "mpls_echo.tlv.fec.gen_ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack Generic IPv4", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_gen_ipv4_mask,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.gen_ipv4_mask",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack Generic IPv4 Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_gen_ipv6,\r\n{ "IPv6 Prefix", "mpls_echo.tlv.fec.gen_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack Generic IPv6", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_gen_ipv6_mask,\r\n{ "Prefix Length", "mpls_echo.tlv.fec.gen_ipv6_mask",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack Generic IPv6 Prefix Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_nil_label,\r\n{ "Label", "mpls_echo.tlv.fec.nil_label",\r\nFT_UINT24, BASE_DEC, VALS(special_labels), 0x0, "MPLS ECHO TLV FEC Stack NIL Label", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mtu,\r\n{ "MTU", "mpls_echo.tlv.ds_map.mtu",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map MTU", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_addr_type,\r\n{ "Address Type", "mpls_echo.tlv.ds_map.addr_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_addr_type), 0x0,\r\n"MPLS ECHO TLV Downstream Map Address Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_res,\r\n{ "DS Flags", "mpls_echo.tlv.ds_map.res",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV Downstream Map DS Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_flag_res,\r\n{ "MBZ", "mpls_echo.tlv.ds_map.flag_res",\r\nFT_UINT8, BASE_HEX, NULL, 0xFC, "MPLS ECHO TLV Downstream Map Reserved Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_flag_i,\r\n{ "Interface and Label Stack Request", "mpls_echo.tlv.ds_map.flag_i",\r\nFT_BOOLEAN, 8, NULL, 0x02, "MPLS ECHO TLV Downstream Map I-Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_flag_n,\r\n{ "Treat as Non-IP Packet", "mpls_echo.tlv.ds_map.flag_n",\r\nFT_BOOLEAN, 8, NULL, 0x01, "MPLS ECHO TLV Downstream Map N-Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_ds_ip,\r\n{ "Downstream IP Address", "mpls_echo.tlv.ds_map.ds_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_int_ip,\r\n{ "Downstream Interface Address", "mpls_echo.tlv.ds_map.int_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Interface Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_if_index,\r\n{ "Upstream Interface Index", "mpls_echo.tlv.ds_map.if_index",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map Interface Index", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_ds_ipv6,\r\n{ "Downstream IPv6 Address", "mpls_echo.tlv.ds_map.ds_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map IPv6 Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_int_ipv6,\r\n{ "Downstream Interface IPv6 Address", "mpls_echo.tlv.ds_map.int_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Interface IPv6 Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_hash_type,\r\n{ "Multipath Type", "mpls_echo.tlv.ds_map.hash_type",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &mpls_echo_tlv_ds_map_hash_type_ext, 0x0,\r\n"MPLS ECHO TLV Downstream Map Multipath Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_depth,\r\n{ "Depth Limit", "mpls_echo.tlv.ds_map.depth",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map Depth Limit", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_muti_len,\r\n{ "Multipath Length", "mpls_echo.tlv.ds_map.multi_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map Multipath Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_ip,\r\n{ "IP Address", "mpls_echo.tlv.ds_map_mp.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Multipath IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_mask,\r\n{ "Mask", "mpls_echo.tlv.ds_map_mp.mask",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Multipath Mask", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_ip_low,\r\n{ "IP Address Low", "mpls_echo.tlv.ds_map_mp.ip_low",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Multipath Low IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_ip_high,\r\n{ "IP Address High", "mpls_echo.tlv.ds_map_mp.ip_high",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Downstream Map Multipath High IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_no_multipath_info,\r\n{ "No Multipath Information", "mpls_echo.tlv.ds_map_mp.no_multipath_info",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_value,\r\n{ "Multipath Value", "mpls_echo.tlv.ds_map_mp.value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Multipath Value", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_label,\r\n{ "Downstream Label", "mpls_echo.tlv.ds_map.mp_label",\r\nFT_UINT24, BASE_DEC, VALS(special_labels), 0x0, "MPLS ECHO TLV Downstream Map Downstream Label", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_exp,\r\n{ "Downstream Exp", "mpls_echo.tlv.ds_map.mp_exp",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map Downstream Experimental", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_bos,\r\n{ "Downstream BOS", "mpls_echo.tlv.ds_map.mp_bos",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Downstream Map Downstream BOS", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_mp_proto,\r\n{ "Downstream Protocol", "mpls_echo.tlv.ds_map.mp_proto",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_ds_map_mp_proto), 0x0,\r\n"MPLS ECHO TLV Downstream Map Downstream Protocol", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_padaction,\r\n{ "Pad Action", "mpls_echo.tlv.pad_action",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_pad), 0x0, "MPLS ECHO Pad TLV Action", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_padding,\r\n{ "Padding", "mpls_echo.tlv.pad_padding",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO Pad TLV Padding", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_vendor,\r\n{ "Vendor Id", "mpls_echo.tlv.vendor_id",\r\nFT_UINT32, BASE_DEC|BASE_EXT_STRING, &sminmpec_values_ext, 0x0, "MPLS ECHO Vendor Id", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_addr_type,\r\n{ "Address Type", "mpls_echo.tlv.ilso.addr_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_addr_type), 0x0,\r\n"MPLS ECHO TLV Interface and Label Stack Address Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_mbz,\r\n{ "Must Be Zero", "mpls_echo.tlv.ilso.mbz",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_ipv4_addr,\r\n{ "Downstream IPv4 Address", "mpls_echo.tlv.ilso_ipv4.addr",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_ipv4_int_addr,\r\n{ "Downstream Interface Address", "mpls_echo.tlv.ilso_ipv4.int_addr",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Interface Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_ipv6_addr,\r\n{ "Downstream IPv6 Address", "mpls_echo.tlv.ilso_ipv6.addr",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_ipv6_int_addr,\r\n{ "Downstream Interface Address", "mpls_echo.tlv.ilso_ipv6.int_addr",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Interface Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_int_index,\r\n{ "Downstream Interface Index", "mpls_echo.tlv.ilso.int_index",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Interface Index", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_label,\r\n{ "Label", "mpls_echo.tlv.ilso_ipv4.label",\r\nFT_UINT24, BASE_DEC, VALS(special_labels), 0x0, "MPLS ECHO TLV Interface and Label Stack Label", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_exp,\r\n{ "Exp", "mpls_echo.tlv.ilso_ipv4.exp",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack Exp", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_bos,\r\n{ "BOS", "mpls_echo.tlv.ilso_ipv4.bos",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack BOS", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ilso_ttl,\r\n{ "TTL", "mpls_echo.tlv.ilso_ipv4.ttl",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Interface and Label Stack TTL", HFILL}\r\n},\r\n#if 0\r\n{ &hf_mpls_echo_tlv_rto_ipv4,\r\n{ "Reply-to IPv4 Address", "mpls_echo.tlv.rto.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV IPv4 Reply-To Object", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_rto_ipv6,\r\n{ "Reply-to IPv6 Address", "mpls_echo.tlv.rto.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV IPv6 Reply-To Object", HFILL}\r\n},\r\n#endif\r\n{ &hf_mpls_echo_tlv_reply_tos,\r\n{ "Reply-TOS Byte", "mpls_echo.tlv.reply.tos",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Reply-TOS Byte", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_reply_tos_mbz,\r\n{ "MBZ", "mpls_echo.tlv.reply.tos.mbz",\r\nFT_UINT24, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV Reply-TOS MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_errored_type,\r\n{ "Errored TLV Type", "mpls_echo.tlv.errored.type",\r\nFT_UINT16, BASE_DEC | BASE_EXT_STRING, &mpls_echo_tlv_type_names_ext, 0x0,\r\n"MPLS ECHO TLV Errored TLV Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_ingress_if_num,\r\n{ "Ingress Interface Number", "mpls_echo.tlv.ds_map.ingress.if.num",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"MPLS ECHO TLV DownStream Map Ingress Interface Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_ds_map_egress_if_num,\r\n{ "Egress Interface Number", "mpls_echo.tlv.ds_map.egress.if.num",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"MPLS ECHO TLV DownStream Map Egress Interface Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_src_gid,\r\n{ "SRC GLOBAL ID", "mpls_echo.lspping.tlv.src.gid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "LSP SRC GID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_src_nid,\r\n{ "SRC NODE ID", "mpls_echo.lspping.tlv.src.nid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "LSP SRC NID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_src_tunnel_no,\r\n{ "SRC Tunnel Number", "mpls_echo.lspping.tlv.tunnel.no",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "LSP FEC Tunnel Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_lsp_no,\r\n{ "SRC LSP Number", "mpls_echo.lspping.tlv.lsp.no",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "LSP FEC LSP Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_dst_gid,\r\n{ "DST GLOBAL ID", "mpls_echo.lspping.tlv.dst.gid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "LSP FEC DST GID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_dst_nid,\r\n{ "DST NODE ID", "mpls_echo.lspping.tlv.dst.nid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "LSP FEC DST NID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_dst_tunnel_no,\r\n{ "DST Tunnel Number", "mpls_echo.lspping.tlv.dst.tunnel.no",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "LSP FEC DST Tunnel Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_resv,\r\n{ "RESERVED", "mpls_echo.lspping.tlv.resv",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "RESERVED BITS", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_src_addr_gid,\r\n{ "Global ID", "mpls_echo.lspping.tlv.src.addr.gid",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "SRC ADDR TLV GID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_src_addr_nid,\r\n{ "Node ID", "mpls_echo.lspping.tlv.src.addr.nid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "SRC ADDR TLV NID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_pw_serv_identifier,\r\n{ "Service identifier", "mpls_echo.lspping.tlv.pw.serv.identifier",\r\nFT_UINT64, BASE_DEC, NULL, 0x0, "PW FEC Service identifier", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_pw_src_ac_id,\r\n{ "SRC AC ID", "mpls_echo.lspping.tlv.pw.src.ac.id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "PW FEC SRC AC ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_lspping_tlv_pw_dst_ac_id,\r\n{ "DST AC ID", "mpls_echo.lspping.tlv.pw.dst.ac.id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "PW FEC DST AC ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_padding,\r\n{ "Padding", "mpls_echo.padding",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL}\r\n},\r\n#if 0\r\n{ &hf_mpls_echo_lspping_tlv_pw_agi_type,\r\n{ "AGI TYPE", "mpls_echo.lspping.tlv.pw.agi.type",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "PW AGI TYPE", HFILL}\r\n},\r\n#endif\r\n#if 0\r\n{ &hf_mpls_echo_lspping_tlv_pw_agi_len,\r\n{ "AGI Length", "mpls_echo.lspping.tlv.pw.agi.len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "PW AGI LENGTH", HFILL}\r\n},\r\n#endif\r\n#if 0\r\n{ &hf_mpls_echo_lspping_tlv_pw_agi_val,\r\n{ "AGI VALUE", "mpls_echo.lspping.tlv.pw.agi.val",\r\nFT_STRING, BASE_NONE, NULL, 0x0, "PW AGI VALUE", HFILL}\r\n},\r\n#endif\r\n{ &hf_mpls_echo_tlv_dd_map_mtu,\r\n{ "MTU", "mpls_echo.lspping.tlv.dd_map.mtu",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map MTU", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_addr_type,\r\n{ "Address Type", "mpls_echo.tlv.dd_map.addr_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_addr_type), 0x0, "MPLS ECHO TLV Detailed Downstream Map Address Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_res,\r\n{ "DS Flags", "mpls_echo.tlv.dd_map.res",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map DS Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_flag_res,\r\n{ "MBZ", "mpls_echo.tlv.dd_map.flag_res",\r\nFT_UINT8, BASE_HEX, NULL, 0xFC, "MPLS ECHO TLV Detailed Downstream Map Reserved Flags", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_flag_i,\r\n{ "Interface and Label Stack Request", "mpls_echo.tlv.dd_map.flag_i",\r\nFT_BOOLEAN, 8, NULL, 0x02, "MPLS ECHO TLV Detailed Downstream Map I-Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_flag_n,\r\n{ "Treat as Non-IP Packet", "mpls_echo.tlv.dd_map.flag_n",\r\nFT_BOOLEAN, 8, NULL, 0x01, "MPLS ECHO TLV Detailed Downstream Map N-Flag", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_ds_ip,\r\n{ "Downstream IP Address", "mpls_echo.tlv.dd_map.ds_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_int_ip,\r\n{ "Downstream Interface Address", "mpls_echo.tlv.dd_map.int_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Interface Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_ds_ipv6,\r\n{ "Downstream IPv6 Address", "mpls_echo.tlv.dd_map.ds_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map IPv6 Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_int_ipv6,\r\n{ "Downstream Interface IPv6 Address", "mpls_echo.tlv.dd_map.int_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Interface IPv6 Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_return_code,\r\n{ "Return Code", "mpls_echo.tlv.dd_map.return_code",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Return Code", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_return_subcode,\r\n{ "Return Subcode", "mpls_echo.tlv.dd_map.return_subcode",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Return Subcode", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_ingress_if_num,\r\n{ "Ingress Interface Number", "mpls_echo.tlv.dd_map.ingress.if.num",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"MPLS ECHO TLV Detailed DownStream Map Ingress Interface Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_egress_if_num,\r\n{ "Egress Interface Number", "mpls_echo.tlv.dd_map.egress.if.num",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\n"MPLS ECHO TLV Detailed DownStream Map Egress Interface Number", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_subtlv_len,\r\n{ "Subtlv Length", "mpls_echo.tlv.dd_map.subtlv_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Subtlv Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_multipath_type,\r\n{ "Multipath Type", "mpls_echo.subtlv.dd_map.multipath_type",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "Detailed Downstream Mapping TLV Multipath Data Sub-TLV Multipath Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_multipath_length,\r\n{ "Multipath Length", "mpls_echo.subtlv.dd_map.multipath_length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "Detailed Downstream Mapping TLV Multipath Data Sub-TLV Multipath Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_multipath_value,\r\n{ "Multipath Value", "mpls_echo.subtlv.dd_map.multipath_value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "Detailed Downstream Mapping TLV Multipath Data Sub-TLV Multipath Value", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_resv,\r\n{ "Reserved", "mpls_echo.subtlv.dd_map.reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "Detailed Downstream Mapping TLV Multipath Data Sub-TLV Reserved Bits", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_multipath_info,\r\n{ "Multipath Information", "mpls_echo.subtlv.dd_map.multipath_info",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "Detailed Downstream Mapping TLV Multipath Data Sub-TLV Value", HFILL}\r\n},\r\n#if 0\r\n{ &hf_mpls_echo_tlv_ddstlv_map_mp_label,\r\n{ "Downstream Label", "mpls_echo.tlv.ddstlv_map.mp_label",\r\nFT_UINT24, BASE_DEC, VALS(special_labels), 0x0, "MPLS ECHO TLV Detailed Downstream Map Downstream Label", HFILL}\r\n},\r\n#endif\r\n{ &hf_mpls_echo_tlv_ddstlv_map_mp_proto,\r\n{ "Downstream Protocol", "mpls_echo.tlv.ddstlv_map.mp_proto",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_tlv_ds_map_mp_proto), 0x0,\r\n"MPLS ECHO TLV Detailed Downstream Map Downstream Protocol", HFILL}\r\n},\r\n#if 0\r\n{ &hf_mpls_echo_tlv_ddstlv_map_mp_exp,\r\n{ "Downstream Experimental", "mpls_echo.tlv.ddstlv_map.mp_exp",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Downstream Experimental", HFILL}\r\n},\r\n#endif\r\n#if 0\r\n{ &hf_mpls_echo_tlv_ddstlv_map_mp_bos,\r\n{ "Downstream BOS", "mpls_echo.tlv.ddstlv_map.mp_bos",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Downstream BOS", HFILL}\r\n},\r\n#endif\r\n{ &hf_mpls_echo_sub_tlv_multipath_ip,\r\n{ "IP Address", "mpls_echo.tlv.ddstlv_map_mp.ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Multipath IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_mp_ip_low,\r\n{ "IP Address Low", "mpls_echo.tlv.ddstlv_map_mp.ip_low",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Multipath Low IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_mp_ip_high,\r\n{ "IP Address High", "mpls_echo.tlv.ddstlv_map_mp.ip_high",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Multipath High IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_mp_mask,\r\n{ "Mask", "mpls_echo.tlv.ddstlv_map_mp.mask",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV Detailed Downstream Map Multipath Mask", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_op_type,\r\n{ "Operation Type", "mpls_echo.tlv.ddstlv_map.op_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_subtlv_op_types), 0x0,\r\n"MPLS ECHO TLV Detailed Downstream Map Stack Change Operation Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_addr_type,\r\n{ "Address Type", "mpls_echo.tlv.ddstlv_map.address_type",\r\nFT_UINT8, BASE_DEC, VALS(mpls_echo_subtlv_addr_types), 0x0,\r\n"MPLS ECHO TLV Detailed Downstream Map Stack Change Address Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_fec_tlv_value,\r\n{ "FEC tlv Length", "mpls_echo.subtlv.dd_map.fec_tlv_type",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "Detailed Downstream Map FEC TLV Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_label,\r\n{ "Label", "mpls_echo.subtlv.label",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_traffic_class,\r\n{ "Traffic Class", "mpls_echo.subtlv.traffic_class",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_s_bit,\r\n{ "S bit", "mpls_echo.subtlv.s_bit",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_res,\r\n{ "Reserved", "mpls_echo.subtlv.dd_map.reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, "Detailed Downstream Map FEC Stack Change Reserved Bits", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_remote_peer_unspecified,\r\n{ "Unspecified (Address Length = 0)", "mpls_echo.tlv.dd_map.unspecified",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_remote_peer_ip,\r\n{ "Remote Peer IP Address", "mpls_echo.tlv.dd_map.remote_ip",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "Detailed Downstream Map FEC Stack Change Remote Peer IP Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_sub_tlv_remore_peer_ipv6,\r\n{ "Remote Peer IPv6 Address", "mpls_echo.tlv.dd_map.remote_ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "Detailed Downstream Map FEC Stack Change Remote Peer IPv6 Address", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_type,\r\n{ "Sub-TLV Type", "mpls_echo.subtlv.dd_map.type",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "Detailed Downstream Mapping TLV Type", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_length,\r\n{ "Sub-TLV Length", "mpls_echo.subtlv.dd_map.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "Detailed Downstream Mapping TLV Length", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_dd_map_value,\r\n{ "Sub-TLV Value", "mpls_echo.subtlv.dd_map.value",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, "Detailed Downstream Mapping TLV Value", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_p2mp_id,\r\n{ "P2MP ID", "mpls_echo.tlv.fec.rsvp_p2mp_ipv4_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_mbz1,\r\n{ "Must Be Zero", "mpls_echo.tlv.fec.rsvp_p2mp_ip_mbz1",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_tunnel_id,\r\n{ "Tunnel ID", "mpls_echo.tlv.fec.rsvp_p2mp_ip_tun_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_ext_tunnel_id,\r\n{ "Extended Tunnel ID", "mpls_echo.tlv.fec.rsvp_p2mp_ipv4_ext_tun_id",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP IPv4 Extended Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv4_ipv4_sender,\r\n{ "IPv4 Tunnel sender address", "mpls_echo.tlv.fec.rsvp_p2mp_ipv4_sender",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP IPv4 Sender", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_mbz2,\r\n{ "Must Be Zero", "mpls_echo.tlv.fec.rsvp_p2mp_ip_mbz2",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP MBZ", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ip_lsp_id,\r\n{ "LSP ID", "mpls_echo.tlv.fec.rsvp_p2mp_ip_lsp_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP LSP ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_p2mp_id,\r\n{ "P2MP IPv6 Tunnel ID address", "mpls_echo.tlv.fec.rsvp_p2mp_ipv6_id",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP IPv6 ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_ext_tunnel_id,\r\n{ "Extended Tunnel ID", "mpls_echo.tlv.fec.rsvp_p2mp_ipv6_ext_tun_id",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP IPv6 Extended Tunnel ID", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_fec_rsvp_p2mp_ipv6_ipv6_sender,\r\n{ "P2MP IPv6 Tunnel sender address", "mpls_echo.tlv.fec.rsvp_p2mp_ipv6_sender",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "MPLS ECHO TLV FEC Stack RSVP P2MP IPv6 Sender", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_responder_indent_type,\r\n{ "Target Type", "mpls_echo.tlv.resp_id.type",\r\nFT_UINT16, BASE_DEC, VALS(mpls_echo_tlv_responder_ident_sub_tlv_type), 0x0, "P2MP Responder ID TLV", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_responder_indent_len,\r\n{ "Length", "mpls_echo.tlv.resp_id.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, "P2MP Responder ID TLV LENGTH", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_responder_indent_ipv4,\r\n{ "Target IPv4 Address", "mpls_echo.tlv.resp_id.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, "P2MP Responder ID TLV IPv4 Address", HFILL}\r\n},\r\n#if 0\r\n{ &hf_mpls_echo_tlv_responder_indent_ipv6,\r\n{ "Target IPv6 Address", "mpls_echo.tlv.resp_id.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0, "P2MP Responder ID TLV IPv6 Address", HFILL}\r\n},\r\n#endif\r\n{ &hf_mpls_echo_tlv_echo_jitter,\r\n{ "Echo Jitter time", "mpls_echo.tlv.echo_jitter",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, "MPLS ECHO Jitter time", HFILL}\r\n},\r\n{ &hf_mpls_echo_tlv_bfd,\r\n{ "BFD Discriminator", "mpls_echo.bfd_discriminator",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, "MPLS ECHO BFD Discriminator", HFILL}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mpls_echo,\r\n&ett_mpls_echo_gflags,\r\n&ett_mpls_echo_tlv,\r\n&ett_mpls_echo_tlv_fec,\r\n&ett_mpls_echo_tlv_ds_map,\r\n&ett_mpls_echo_tlv_ilso,\r\n&ett_mpls_echo_tlv_dd_map,\r\n&ett_mpls_echo_tlv_ddstlv_map\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_mpls_echo_tlv_fec_len, { "mpls_echo.tlv.fec.len.invalid", PI_MALFORMED, PI_ERROR, "Invalid FEC TLV length", EXPFILL }},\r\n{ &ei_mpls_echo_tlv_dd_map_subtlv_len, { "mpls_echo.tlv.dd_map.subtlv_len.invalid", PI_MALFORMED, PI_ERROR, "Invalid Sub-TLV length", EXPFILL }},\r\n{ &ei_mpls_echo_tlv_len, { "mpls_echo.tlv.len.invalid", PI_MALFORMED, PI_ERROR, "Invalid TLV length", EXPFILL }},\r\n{ &ei_mpls_echo_tlv_ds_map_muti_len, { "mpls_echo.tlv.ds_map.multi_len.invalid", PI_MALFORMED, PI_ERROR, "Invalid Multipath TLV length", EXPFILL }},\r\n{ &ei_mpls_echo_unknown_address_type, { "mpls_echo.address_type.unknown", PI_UNDECODED, PI_WARN, "Unknown Address Type", EXPFILL }},\r\n{ &ei_mpls_echo_incorrect_address_type, { "mpls_echo.address_type.incorrect", PI_PROTOCOL, PI_WARN, "Incorrect address type for TLV?", EXPFILL }},\r\n{ &ei_mpls_echo_malformed, { "mpls_echo.malformed", PI_MALFORMED, PI_ERROR, "Malformed MPLS message", EXPFILL }},\r\n};\r\nmodule_t *mpls_echo_module;\r\nexpert_module_t* expert_mpls_echo;\r\nproto_mpls_echo = proto_register_protocol("Multiprotocol Label Switching Echo",\r\n"MPLS Echo", "mpls-echo");\r\nproto_register_field_array(proto_mpls_echo, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_mpls_echo = expert_register_protocol(proto_mpls_echo);\r\nexpert_register_field_array(expert_mpls_echo, ei, array_length(ei));\r\nmpls_echo_module = prefs_register_protocol(proto_mpls_echo, proto_reg_handoff_mpls_echo);\r\nprefs_register_uint_preference(mpls_echo_module, "udp.port", "MPLS Echo UDP Port",\r\n"Set the UDP port for messages (if other"\r\n" than the default of 3503)",\r\n10, &global_mpls_echo_udp_port);\r\n}\r\nvoid\r\nproto_reg_handoff_mpls_echo(void)\r\n{\r\nstatic gboolean mpls_echo_prefs_initialized = FALSE;\r\nstatic dissector_handle_t mpls_echo_handle;\r\nstatic guint mpls_echo_udp_port;\r\nif (!mpls_echo_prefs_initialized) {\r\nmpls_echo_handle = create_dissector_handle(dissect_mpls_echo,\r\nproto_mpls_echo);\r\nmpls_echo_prefs_initialized = TRUE;\r\n} else {\r\ndissector_delete_uint("udp.port", mpls_echo_udp_port, mpls_echo_handle);\r\n}\r\nmpls_echo_udp_port = global_mpls_echo_udp_port;\r\ndissector_add_uint("udp.port", global_mpls_echo_udp_port, mpls_echo_handle);\r\ndissector_add_uint("pwach.channel_type", ACH_TYPE_ONDEMAND_CV, mpls_echo_handle);\r\n}
