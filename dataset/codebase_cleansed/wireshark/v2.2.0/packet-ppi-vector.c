static void\r\nannotate_vector_chars(guint32 chars, proto_tree *my_pt)\r\n{\r\nif (chars & PPI_VECTOR_VCHARS_ANTENNA)\r\nproto_item_append_text(my_pt, " (Antenna)");\r\nif (chars & PPI_VECTOR_VCHARS_DIR_OF_TRAVEL)\r\nproto_item_append_text(my_pt, " (DOT)");\r\nif (chars & PPI_VECTOR_VCHARS_FRONT_OF_VEH)\r\nproto_item_append_text(my_pt, " (Front_of_veh)");\r\nif (chars & PPI_VECTOR_VCHARS_AOA)\r\nproto_item_append_text(my_pt, " (AOA)");\r\nif (chars & PPI_VECTOR_VCHARS_TRANSMITTER_POS)\r\nproto_item_append_text(my_pt, " (TRANSMITTER_POS)");\r\n}\r\nstatic void\r\ndissect_ppi_vector_v1(tvbuff_t *tvb, packet_info *pinfo, int offset, gint length_remaining, proto_tree *ppi_vector_tree)\r\n{\r\nproto_tree *vectorflags_tree = NULL;\r\nproto_tree *vectorchars_tree = NULL;\r\nproto_tree *my_pt, *pt;\r\nproto_item *ti;\r\nint bit;\r\nguint32 present, next_present;\r\ngdouble rot_x, rot_y, rot_z;\r\ngdouble off_r, off_f, off_u;\r\ngdouble vel_r, vel_f, vel_u, vel_t;\r\ngdouble acc_r, acc_f, acc_u, acc_t = 0;\r\ngdouble err_rot, err_off, err_vel, err_acc;\r\nguint32 appsecific_num;\r\nguint32 flags=0, chars=0;\r\nstatic const int * ppi_vector_present_flags[] = {\r\n&hf_ppi_vector_present_vflags,\r\n&hf_ppi_vector_present_vchars,\r\n&hf_ppi_vector_present_val_x,\r\n&hf_ppi_vector_present_val_y,\r\n&hf_ppi_vector_present_val_z,\r\n&hf_ppi_vector_present_off_r,\r\n&hf_ppi_vector_present_off_f,\r\n&hf_ppi_vector_present_off_u,\r\n&hf_ppi_vector_present_vel_r,\r\n&hf_ppi_vector_present_vel_f,\r\n&hf_ppi_vector_present_vel_u,\r\n&hf_ppi_vector_present_vel_t,\r\n&hf_ppi_vector_present_acc_r,\r\n&hf_ppi_vector_present_acc_f,\r\n&hf_ppi_vector_present_acc_u,\r\n&hf_ppi_vector_present_acc_t,\r\n&hf_ppi_vector_present_err_rot,\r\n&hf_ppi_vector_present_err_off,\r\n&hf_ppi_vector_present_err_vel,\r\n&hf_ppi_vector_present_err_acc,\r\n&hf_ppi_vector_present_descstr,\r\n&hf_ppi_vector_presenappsecific_num,\r\n&hf_ppi_vector_present_appspecific_data,\r\n&hf_ppi_vector_present_ext,\r\nNULL\r\n};\r\nguint32 t_val;\r\npresent = tvb_get_letohl(tvb, offset+4);\r\npt = proto_tree_add_bitmask(ppi_vector_tree, tvb, offset + 4, hf_ppi_vector_present, ett_ppi_vector_present, ppi_vector_present_flags, ENC_LITTLE_ENDIAN);\r\noffset += PPI_GEOBASE_MIN_HEADER_LEN;\r\nlength_remaining -= PPI_GEOBASE_MIN_HEADER_LEN;\r\nfor (; present; present = next_present) {\r\nnext_present = present & (present - 1);\r\nbit = BITNO_32(present ^ next_present);\r\nswitch (bit) {\r\ncase PPI_VECTOR_VFLAGS:\r\nif (length_remaining < 4)\r\nbreak;\r\nflags = tvb_get_letohl(tvb, offset);\r\nif (ppi_vector_tree) {\r\nmy_pt = proto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_vflags, tvb, offset , 4, flags);\r\nvectorflags_tree= proto_item_add_subtree(my_pt, ett_ppi_vectorflags);\r\nproto_tree_add_item(vectorflags_tree, hf_ppi_vector_vflags_defines_forward, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorflags_tree, hf_ppi_vector_vflags_rots_absolute, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorflags_tree, hf_ppi_vector_vflags_offsets_from_gps, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VCHARS:\r\nif (length_remaining < 4)\r\nbreak;\r\nchars = tvb_get_letohl(tvb, offset);\r\nif (ppi_vector_tree) {\r\nmy_pt = proto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_vchars, tvb, offset , 4, chars);\r\nvectorchars_tree= proto_item_add_subtree(my_pt, ett_ppi_vectorchars);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_antenna, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_dir_of_travel, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_front_of_veh, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_gps_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_ins_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_compass_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_accelerometer_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_human_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTX:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_x = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_x, tvb, offset, 4, rot_x);\r\nif (flags & PPI_VECTOR_VFLAGS_ROTS_ABSOLUTE)\r\nproto_item_append_text(ti, " Degrees (Absolute)");\r\nelse\r\nproto_item_append_text(ti, " Degrees (Rel to forward)");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTY:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_y = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_y, tvb, offset, 4, rot_y);\r\nif (flags & PPI_VECTOR_VFLAGS_ROTS_ABSOLUTE)\r\nproto_item_append_text(ti, " Degrees (Absolute)");\r\nelse\r\nproto_item_append_text(ti, " Degrees (Rel to forward)");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTZ:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_z = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_z, tvb, offset, 4, rot_z);\r\nif (flags & PPI_VECTOR_VFLAGS_ROTS_ABSOLUTE)\r\nproto_item_append_text(ti, " Degrees (Absolute) ");\r\nelse\r\nproto_item_append_text(ti, " Degrees (Rel to forward)");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_R:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_r = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_r, tvb, offset, 4, off_r);\r\nif (flags & PPI_VECTOR_VFLAGS_OFFSETS_FROM_GPS)\r\nproto_item_append_text(ti, " m from Curr_GPS");\r\nelse\r\nproto_item_append_text(ti, " m from Curr_Pos");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_F:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_f = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_f, tvb, offset, 4, off_f);\r\nif (flags & PPI_VECTOR_VFLAGS_OFFSETS_FROM_GPS)\r\nproto_item_append_text(ti, " m from Curr_GPS");\r\nelse\r\nproto_item_append_text(ti, " m from Curr_Pos");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_U:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_u = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_u, tvb, offset, 4, off_u);\r\nif (flags & PPI_VECTOR_VFLAGS_OFFSETS_FROM_GPS)\r\nproto_item_append_text(ti, " m from Curr_GPS");\r\nelse\r\nproto_item_append_text(ti, " m from Curr_Pos");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VEL_R:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nvel_r = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_vel_r, tvb, offset, 4, vel_r);\r\nproto_item_append_text(ti, " m/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VEL_F:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nvel_f = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_vel_f, tvb, offset, 4, vel_f);\r\nproto_item_append_text(ti, " m/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VEL_U:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nvel_u = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_vel_u, tvb, offset, 4, vel_u);\r\nproto_item_append_text(ti, " m/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VEL_T:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nvel_t = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_vel_t, tvb, offset, 4, vel_t);\r\nproto_item_append_text(ti, " m/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ACC_R:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nacc_r = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_acc_r, tvb, offset, 4, acc_r);\r\nproto_item_append_text(ti, " (m/s)/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ACC_F:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nacc_f = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_acc_f, tvb, offset, 4, acc_f);\r\nproto_item_append_text(ti, " (m/s)/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ACC_U:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nacc_u = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_acc_u, tvb, offset, 4, acc_u);\r\nproto_item_append_text(ti, " (m/s)/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ACC_T:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nacc_t = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_acc_t, tvb, offset, 4, acc_t);\r\nproto_item_append_text(ti, " (m/s)/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_ROT:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_rot = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_rot, tvb, offset, 4, err_rot);\r\nproto_item_append_text(ti, " degrees");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_OFF:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_off = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_off, tvb, offset, 4, err_off);\r\nproto_item_append_text(ti, " meters");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_VEL:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_vel = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_vel, tvb, offset, 4, err_vel);\r\nproto_item_append_text(ti, "m/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_ACC:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_acc = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_acc, tvb, offset, 4, err_acc);\r\nproto_item_append_text(ti, " (m/s)/s");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_DESCSTR:\r\nif (length_remaining < 32)\r\nbreak;\r\nproto_tree_add_item(ppi_vector_tree, hf_ppi_vector_descstr, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\noffset+=32;\r\nlength_remaining-=32;\r\nbreak;\r\ncase PPI_VECTOR_APPID:\r\nif (length_remaining < 4)\r\nbreak;\r\nappsecific_num = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_appspecific_num, tvb, offset, 4, appsecific_num);\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_APPDATA:\r\nif (length_remaining < 60)\r\nbreak;\r\nproto_tree_add_item(ppi_vector_tree, hf_ppi_vector_appspecific_data, tvb, offset, 60, ENC_NA);\r\noffset+=60;\r\nlength_remaining-=60;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, pt, &ei_ppi_vector_present_bit, "Error: PPI-VECTOR: unknown bit (%d) set in present field.", bit);\r\nnext_present = 0;\r\ncontinue;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_ppi_vector_v2(tvbuff_t *tvb, packet_info *pinfo, int offset, gint length_remaining, proto_tree *ppi_vector_tree, proto_item *vector_line)\r\n{\r\nproto_tree *vectorflags_tree = NULL;\r\nproto_tree *vectorchars_tree = NULL;\r\nproto_tree *my_pt, *pt;\r\nproto_item *ti;\r\nint bit;\r\nguint32 present, next_present;\r\ngchar *curr_str;\r\nguint32 relativeto_int;\r\nconst gchar *relativeto_str= "RelativeTo: Forward";\r\nguint32 flags=0, chars=0;\r\ngdouble rot_x, rot_y, rot_z;\r\ngdouble off_x, off_y, off_z;\r\ngdouble err_rot, err_off;\r\nguint32 appsecific_num;\r\nstatic const int * ppi_vector_present_flags[] = {\r\n&hf_ppi_vector_present_vflags,\r\n&hf_ppi_vector_present_vchars,\r\n&hf_ppi_vector_present_val_x,\r\n&hf_ppi_vector_present_val_y,\r\n&hf_ppi_vector_present_val_z,\r\n&hf_ppi_vector_present_off_x,\r\n&hf_ppi_vector_present_off_y,\r\n&hf_ppi_vector_present_off_z,\r\n&hf_ppi_vector_present_err_rot,\r\n&hf_ppi_vector_present_err_off,\r\n&hf_ppi_vector_present_descstr,\r\n&hf_ppi_vector_presenappsecific_num,\r\n&hf_ppi_vector_present_appspecific_data,\r\n&hf_ppi_vector_present_ext,\r\nNULL\r\n};\r\nguint32 t_val;\r\npresent = tvb_get_letohl(tvb, offset+4);\r\npt = proto_tree_add_bitmask(ppi_vector_tree, tvb, offset + 4, hf_ppi_vector_present, ett_ppi_vector_present, ppi_vector_present_flags, ENC_LITTLE_ENDIAN);\r\noffset += PPI_GEOBASE_MIN_HEADER_LEN;\r\nlength_remaining -= PPI_GEOBASE_MIN_HEADER_LEN;\r\nif ( (present & PPI_VECTOR_MASK_VFLAGS) && length_remaining >= 4)\r\n{\r\nflags = tvb_get_letohl(tvb, offset);\r\nrelativeto_int = (flags & (PPI_VECTOR_VFLAGS_RELATIVE_TO));\r\nrelativeto_int = relativeto_int >> 1;\r\nrelativeto_str = val_to_str_const (relativeto_int, relativeto_string, "Reserved");\r\nif (flags & PPI_VECTOR_VFLAGS_DEFINES_FORWARD)\r\nproto_item_append_text(vector_line, " (Forward)");\r\n}\r\nelse\r\n{\r\nrelativeto_str = " RelativeTo: Forward";\r\n}\r\nif ( ( (present & PPI_VECTOR_MASK_VFLAGS)) && (present & PPI_VECTOR_MASK_VCHARS) && length_remaining >= 8)\r\nchars = tvb_get_letohl(tvb, offset + 4);\r\nelse if ( (!(present & PPI_VECTOR_MASK_VFLAGS)) && (present & PPI_VECTOR_MASK_VCHARS) && length_remaining >= 4)\r\nchars = tvb_get_letohl(tvb, offset );\r\nif (chars)\r\n{\r\nannotate_vector_chars(chars, vector_line);\r\n}\r\nfor (; present; present = next_present) {\r\nnext_present = present & (present - 1);\r\nbit = BITNO_32(present ^ next_present);\r\nswitch (bit) {\r\ncase PPI_VECTOR_VFLAGS:\r\nif (length_remaining < 4)\r\nbreak;\r\nif (ppi_vector_tree) {\r\nmy_pt = proto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_vflags, tvb, offset , 4, flags);\r\nvectorflags_tree= proto_item_add_subtree(my_pt, ett_ppi_vectorflags);\r\nproto_tree_add_item(vectorflags_tree, hf_ppi_vector_vflags_defines_forward, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorflags_tree, hf_ppi_vector_vflags_relative_to, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nif (flags & PPI_VECTOR_VFLAGS_DEFINES_FORWARD)\r\nproto_item_append_text(vectorflags_tree, " (Forward)");\r\nproto_item_append_text (vectorflags_tree, " RelativeTo: %s", relativeto_str);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_VCHARS:\r\nif (length_remaining < 4)\r\nbreak;\r\nif (ppi_vector_tree) {\r\nmy_pt = proto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_vchars, tvb, offset , 4, chars);\r\nvectorchars_tree= proto_item_add_subtree(my_pt, ett_ppi_vectorchars);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_antenna, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_dir_of_travel, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_front_of_veh, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_angle_of_arrival, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_transmitter_pos, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_gps_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_ins_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_compass_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_accelerometer_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(vectorchars_tree, hf_ppi_vector_vchars_human_derived, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nannotate_vector_chars(chars, my_pt);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTX:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_x = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_x, tvb, offset, 4, rot_x);\r\nproto_item_append_text(ti, " Degrees RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Pitch:%3f ", rot_x);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTY:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_y = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_y, tvb, offset, 4, rot_y);\r\nproto_item_append_text(ti, " Degrees RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Roll:%3f ", rot_y);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ROTZ:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nrot_z = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_rot_z, tvb, offset, 4, rot_z);\r\nproto_item_append_text(ti, " Degrees RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Heading:%3f ", rot_z);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_X:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_x = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_x, tvb, offset, 4, off_x);\r\nproto_item_append_text(ti, " Meters RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Off-X:%3f ", off_x);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_Y:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_y = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_y, tvb, offset, 4, off_y);\r\nproto_item_append_text(ti, " Meters RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Off-Y:%3f ", off_y);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_OFF_Z:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\noff_z = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_off_z, tvb, offset, 4, off_z);\r\nproto_item_append_text(ti, " Meters RelativeTo: %s", relativeto_str);\r\nproto_item_append_text(vector_line, " Off-Z:%3f ", off_z);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_ROT:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_rot = ppi_fixed3_6_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_rot, tvb, offset, 4, err_rot);\r\nproto_item_append_text(ti, " Degrees");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_ERR_OFF:\r\nif (length_remaining < 4)\r\nbreak;\r\nt_val = tvb_get_letohl(tvb, offset);\r\nerr_off = ppi_fixed6_4_to_gdouble(t_val);\r\nif (ppi_vector_tree) {\r\nti = proto_tree_add_double(ppi_vector_tree, hf_ppi_vector_err_off, tvb, offset, 4, err_off);\r\nproto_item_append_text(ti, " Meters");\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_DESCSTR:\r\nif (length_remaining < 32)\r\nbreak;\r\nif (ppi_vector_tree)\r\n{\r\ncurr_str = tvb_format_stringzpad(tvb, offset, 32);\r\nproto_tree_add_string(ppi_vector_tree, hf_ppi_vector_descstr, tvb, offset, 32, curr_str);\r\nproto_item_append_text(vector_line, " (%s)", curr_str);\r\n}\r\noffset+=32;\r\nlength_remaining-=32;\r\nbreak;\r\ncase PPI_VECTOR_APPID:\r\nif (length_remaining < 4)\r\nbreak;\r\nappsecific_num = tvb_get_letohl(tvb, offset);\r\nif (ppi_vector_tree) {\r\nproto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_appspecific_num, tvb, offset, 4, appsecific_num);\r\n}\r\noffset+=4;\r\nlength_remaining-=4;\r\nbreak;\r\ncase PPI_VECTOR_APPDATA:\r\nif (length_remaining < 60)\r\nbreak;\r\nif (ppi_vector_tree) {\r\nproto_tree_add_item(ppi_vector_tree, hf_ppi_vector_appspecific_data, tvb, offset, 60, ENC_NA);\r\n}\r\noffset+=60;\r\nlength_remaining-=60;\r\nbreak;\r\ndefault:\r\nexpert_add_info_format(pinfo, pt, &ei_ppi_vector_present_bit, "Error: PPI-VECTOR: unknown bit (%d) set in present field.\n", bit);\r\nnext_present = 0;\r\ncontinue;\r\n}\r\n}\r\nproto_item_append_text (vector_line, " RelativeTo: %s", relativeto_str);\r\n}\r\nstatic int\r\ndissect_ppi_vector(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *ppi_vector_tree;\r\nproto_item *ti, *vector_line;\r\ngint length_remaining;\r\nint offset = 0;\r\nguint32 version;\r\nguint length;\r\ncol_clear(pinfo->cinfo,COL_INFO);\r\nversion = tvb_get_guint8(tvb, offset);\r\nlength = tvb_get_letohs(tvb, offset+2);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "PPI_Vector Capture v%u, Length %u",\r\nversion, length);\r\nvector_line = proto_tree_add_protocol_format(tree, proto_ppi_vector, tvb, 0, length, "Vector:");\r\nppi_vector_tree = proto_item_add_subtree(vector_line, ett_ppi_vector);\r\nproto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_version,\r\ntvb, offset, 1, version);\r\nproto_tree_add_item(ppi_vector_tree, hf_ppi_vector_pad,\r\ntvb, offset + 1, 1, ENC_LITTLE_ENDIAN);\r\nti = proto_tree_add_uint(ppi_vector_tree, hf_ppi_vector_length,\r\ntvb, offset + 2, 2, length);\r\nlength_remaining = length;\r\nif (length_remaining < PPI_GEOBASE_MIN_HEADER_LEN) {\r\nexpert_add_info_format(pinfo, ti, &ei_ppi_vector_length, "Invalid PPI-Vector length - minimum length is %d", PPI_GEOBASE_MIN_HEADER_LEN);\r\nreturn 2;\r\n}\r\nswitch (version) {\r\ncase 1:\r\ndissect_ppi_vector_v1(tvb, pinfo, offset, length_remaining, ppi_vector_tree);\r\nbreak;\r\ncase 2:\r\nif (length > PPI_VECTOR_MAXTAGLEN ) {\r\nexpert_add_info_format(pinfo, ti, &ei_ppi_vector_length, "Invalid PPI-Vector length (got %d, %d max\n)", length, PPI_VECTOR_MAXTAGLEN);\r\nreturn 2;\r\n}\r\ndissect_ppi_vector_v2(tvb, pinfo, offset, length_remaining, ppi_vector_tree, vector_line);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(ppi_vector_tree, hf_ppi_vector_unknown_data, tvb, offset + 4, -1, ENC_NA);\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_ppi_vector(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_ppi_vector_version,\r\n{ "Header revision", "ppi_vector.version",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Version of ppi_vector header format", HFILL } },\r\n{ &hf_ppi_vector_pad,\r\n{ "Header pad", "ppi_vector.pad",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Padding", HFILL } },\r\n{ &hf_ppi_vector_length,\r\n{ "Header length", "ppi_vector.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Length of header including version, pad, length and data fields", HFILL } },\r\n{ &hf_ppi_vector_present,\r\n{ "Present", "ppi_vector.present",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\n"Bitmask indicating which fields are present", HFILL } },\r\n{ &hf_ppi_vector_present_vflags,\r\n{ "Vector flags", "ppi_vector.present.flags",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VFLAGS,\r\n"Specifies if the Vector flags bitfield is present", HFILL } },\r\n{ &hf_ppi_vector_present_vchars,\r\n{ "Vector characteristics", "ppi_vector.present.chars",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VCHARS,\r\n"Specifies if the Vector chars bitfield is present", HFILL } },\r\n{ &hf_ppi_vector_present_val_x,\r\n{ "Pitch", "ppi_vector.present.pitch",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ROTX,\r\n"Specifies if the rotate-x field (pitch) is present", HFILL } },\r\n{ &hf_ppi_vector_present_val_y,\r\n{ "Roll", "ppi_vector.present.roll",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ROTY,\r\n"Specifies if the rotate-y field (roll) is present", HFILL } },\r\n{ &hf_ppi_vector_present_val_z,\r\n{ "Heading", "ppi_vector.present.heading",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ROTZ,\r\n"Specifies if the rotate-z field (heading) is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_r,\r\n{ "Offset_R", "ppi_vector.present.off_r",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_R,\r\n"Specifies if the offset-right field is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_f,\r\n{ "Offset_F", "ppi_vector.present.off_f",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_F,\r\n"Specifies if the offset-forward field is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_u,\r\n{ "Offset_U", "ppi_vector.present.off_u",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_U,\r\n"Specifies if the offset-up field is present", HFILL } },\r\n{ &hf_ppi_vector_present_vel_r,\r\n{ "Velocity_R", "ppi_vector.present.vel_r",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VEL_R,\r\n"Specifies if the velocity-right field is present", HFILL } },\r\n{ &hf_ppi_vector_present_vel_f,\r\n{ "Velocity_F", "ppi_vector.present.vel_f",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VEL_F,\r\n"Specifies if the velocity-forward field is present", HFILL } },\r\n{ &hf_ppi_vector_present_vel_u,\r\n{ "Velocity_U", "ppi_vector.present.vel_u",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VEL_U,\r\n"Specifies if the velocity-up field is present", HFILL } },\r\n{ &hf_ppi_vector_present_vel_t,\r\n{ "Velocity_T", "ppi_vector.present.vel_t",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_VEL_T,\r\n"Specifies if the total velocity field is present", HFILL } },\r\n{ &hf_ppi_vector_present_acc_r,\r\n{ "Acceleration_R", "ppi_vector.present.acc_r",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ACC_R,\r\n"Specifies if the accel-right field is present", HFILL } },\r\n{ &hf_ppi_vector_present_acc_f,\r\n{ "Acceleration_F", "ppi_vector.present.acc_f",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ACC_F,\r\n"Specifies if the accel-forward field is present", HFILL } },\r\n{ &hf_ppi_vector_present_acc_u,\r\n{ "Acceleration_U", "ppi_vector.present.acc_u",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ACC_U,\r\n"Specifies if the accel-up field is present", HFILL } },\r\n{ &hf_ppi_vector_present_acc_t,\r\n{ "Acceleration_T", "ppi_vector.present.acc_t",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ACC_T,\r\n"Specifies if the total acceleration field is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_x,\r\n{ "Offset_R", "ppi_vector.present.off_x",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_X,\r\n"Specifies if the offset-x (right/east) field is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_y,\r\n{ "Offset_F", "ppi_vector.present.off_y",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_Y,\r\n"Specifies if the offset-y (forward/north) field is present", HFILL } },\r\n{ &hf_ppi_vector_present_off_z,\r\n{ "Offset_U", "ppi_vector.present.off_z",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_OFF_Z,\r\n"Specifies if the offset-z (up) field is present", HFILL } },\r\n{ &hf_ppi_vector_present_err_rot,\r\n{ "err_rot", "ppi_vector.present.err_rot",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ERR_ROT,\r\n"Specifies if the rotation error field is present", HFILL } },\r\n{ &hf_ppi_vector_present_err_off,\r\n{ "err_off", "ppi_vector.present.err_off",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ERR_OFF,\r\n"Specifies if the offset error field is present", HFILL } },\r\n{ &hf_ppi_vector_present_err_vel,\r\n{ "err_vel", "ppi_vector.present.err_vel",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ERR_VEL,\r\n"Specifies if the velocity error field is present", HFILL } },\r\n{ &hf_ppi_vector_present_err_acc,\r\n{ "err_acc", "ppi_vector.present.err_acc",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_ERR_ACC,\r\n"Specifies if the acceleration error field is present", HFILL } },\r\n{ &hf_ppi_vector_present_descstr,\r\n{ "descstr", "ppi_vector.present.descstr",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_DESCSTR,\r\n"Specifies if the acceleration error field is present", HFILL } },\r\n{ &hf_ppi_vector_presenappsecific_num,\r\n{ "appid", "ppi_vector.present.appid",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_APPID,\r\n"Specifies if the application specific field id is present", HFILL } },\r\n{ &hf_ppi_vector_present_appspecific_data,\r\n{ "appdata", "ppi_vector.present.appdata",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_APPDATA,\r\n"Specifies if the application specific data field is present", HFILL } },\r\n{ &hf_ppi_vector_present_ext,\r\n{ "Ext", "ppi_vector.present.ext",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_MASK_EXT,\r\n"Specifies if there are any extensions to the header present", HFILL } },\r\n{ &hf_ppi_vector_vflags,\r\n{ "Vector flags", "ppi_vector.vector_flags",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\n"Bitmask indicating coordinate sys, among others, etc", HFILL } },\r\n{ &hf_ppi_vector_vchars,\r\n{ "Vector chars", "ppi_vector.vector_chars",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\n"Bitmask indicating if vector tracks antenna, vehicle, motion, etc", HFILL } },\r\n{ &hf_ppi_vector_rot_x,\r\n{ "Pitch", "ppi_vector.pitch",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Pitch (Rotation x) packet was received at", HFILL } },\r\n{ &hf_ppi_vector_rot_y,\r\n{ "Roll", "ppi_vector.roll",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Roll (Rotation y) packet was received at", HFILL } },\r\n{ &hf_ppi_vector_rot_z,\r\n{ "Heading", "ppi_vector.heading",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Heading (Rotation z) packet was received at", HFILL } },\r\n{ &hf_ppi_vector_off_r,\r\n{ "Off-r", "ppi_vector.off_r",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset right", HFILL } },\r\n{ &hf_ppi_vector_off_f,\r\n{ "Off-f", "ppi_vector.off_f",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offation forward", HFILL } },\r\n{ &hf_ppi_vector_off_u,\r\n{ "Off-u", "ppi_vector.off_u",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset up", HFILL } },\r\n{ &hf_ppi_vector_vel_r,\r\n{ "Vel-r", "ppi_vector.vel_r",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Velocity-right", HFILL } },\r\n{ &hf_ppi_vector_vel_f,\r\n{ "Vel-f", "ppi_vector.vel_f",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Velocity-forward", HFILL } },\r\n{ &hf_ppi_vector_vel_u,\r\n{ "Vel-u", "ppi_vector.vel_u",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Velocity-up", HFILL } },\r\n{ &hf_ppi_vector_vel_t,\r\n{ "Vel-t", "ppi_vector.vel_t",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Velocity-Total", HFILL } },\r\n{ &hf_ppi_vector_acc_r,\r\n{ "Accel-r", "ppi_vector.acc_r",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Acceleration-right", HFILL } },\r\n{ &hf_ppi_vector_acc_f,\r\n{ "Accel-f", "ppi_vector.acc_f",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Acceleration-forward", HFILL } },\r\n{ &hf_ppi_vector_acc_u,\r\n{ "Accel-u", "ppi_vector.acc_u",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Acceleration-up", HFILL } },\r\n{ &hf_ppi_vector_acc_t,\r\n{ "Accel-t", "ppi_vector.acc_t",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Acceleration-Total", HFILL } },\r\n{ &hf_ppi_vector_off_x,\r\n{ "Off-x", "ppi_vector.off_x",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset-x (right/east)", HFILL } },\r\n{ &hf_ppi_vector_off_y,\r\n{ "Off-y", "ppi_vector.off_y",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset-y (forward/north)", HFILL } },\r\n{ &hf_ppi_vector_off_z,\r\n{ "Off-z", "ppi_vector.off_z",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset-z (up)", HFILL } },\r\n{ &hf_ppi_vector_err_rot,\r\n{ "Err-Rot", "ppi_vector.err_rot",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Rotation margin of error", HFILL } },\r\n{ &hf_ppi_vector_err_off,\r\n{ "Err-Off", "ppi_vector.err_off",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Offset margin of error", HFILL } },\r\n{ &hf_ppi_vector_err_vel,\r\n{ "Err-Vel", "ppi_vector.err_vel",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Velocity margin of error", HFILL } },\r\n{ &hf_ppi_vector_err_acc,\r\n{ "Err-Accel", "ppi_vector.err_acc",\r\nFT_DOUBLE, BASE_NONE, NULL, 0x0,\r\n"Acceleration margin of error", HFILL } },\r\n{ &hf_ppi_vector_descstr,\r\n{ "Description", "ppi_vector.descr",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL } } ,\r\n{ &hf_ppi_vector_appspecific_num,\r\n{ "Application Specific id", "ppi_vector.appid",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\n"Application-specific identifier", HFILL } },\r\n{ &hf_ppi_vector_appspecific_data,\r\n{ "Application specific data", "ppi_vector.appdata",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Application-specific data", HFILL } },\r\n{ &hf_ppi_vector_vflags_defines_forward,\r\n{ "Defines forward", "ppi_vector.vflags.forward",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VFLAGS_DEFINES_FORWARD,\r\n"Current vector indicates forward frame of reference", HFILL } },\r\n{ &hf_ppi_vector_vflags_rots_absolute,\r\n{ "Absolute (E/N/U) rotations", "ppi_vector.vflags.abs_rots",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VFLAGS_ROTS_ABSOLUTE,\r\n"Rotations are in East/North/Up coord. sys", HFILL } },\r\n{ &hf_ppi_vector_vflags_offsets_from_gps,\r\n{ "Offsets from prev GPS TAG", "ppi_vector.vflags.offsets_from_gps",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VFLAGS_OFFSETS_FROM_GPS,\r\n"Offsets fied rel. to Curr_Gps", HFILL } },\r\n{ &hf_ppi_vector_vflags_relative_to,\r\n{ "RelativeTo", "ppi_vector.vflags.relative_to", FT_UINT32, BASE_HEX, VALS(relativeto_string), PPI_VECTOR_VFLAGS_RELATIVE_TO,\r\n"Reference frame vectors are RelativeTo:", HFILL } },\r\n{ &hf_ppi_vector_vchars_antenna,\r\n{ "Antenna", "ppi_vector.chars.antenna",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_ANTENNA,\r\n"Vector represents: Antenna", HFILL } },\r\n{ &hf_ppi_vector_vchars_dir_of_travel,\r\n{ "Dir of travel", "ppi_vector.chars.dir_of_travel",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_DIR_OF_TRAVEL,\r\n"Vector represents: Direction of travel", HFILL } },\r\n{ &hf_ppi_vector_vchars_front_of_veh,\r\n{ "Front of vehicle", "ppi_vector.chars.front_of_veh",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_FRONT_OF_VEH,\r\n"Vector represents: Front of vehicle", HFILL } },\r\n{ &hf_ppi_vector_vchars_angle_of_arrival,\r\n{ "Angle of arrival", "ppi_vector.chars.angle_of_arr",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_AOA,\r\n"Vector represents: Angle of Arrival", HFILL } },\r\n{ &hf_ppi_vector_vchars_transmitter_pos,\r\n{ "Transmitter Position", "ppi_vector.chars.transmitter_pos",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_TRANSMITTER_POS,\r\n"Vector position represents computed transmitter location", HFILL } },\r\n{ &hf_ppi_vector_vchars_gps_derived,\r\n{ "GPS Derived", "ppi_vector.vflags.gps_derived",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_GPS_DERIVED,\r\n"Vector derived from: gps", HFILL } },\r\n{ &hf_ppi_vector_vchars_ins_derived,\r\n{ "INS Derived", "ppi_vector.vflags.ins_derived",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_INS_DERIVED,\r\n"Vector derived from: inertial nav system", HFILL } },\r\n{ &hf_ppi_vector_vchars_compass_derived,\r\n{ "Compass derived", "ppi_vector.vflags.compass_derived",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_COMPASS_DERIVED,\r\n"Vector derived from: compass", HFILL } },\r\n{ &hf_ppi_vector_vchars_accelerometer_derived,\r\n{ "Accelerometer derived", "ppi_vector.vflags.accelerometer_derived",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_ACCELEROMETER_DERIVED,\r\n"Vector derived from: accelerometer", HFILL } },\r\n{ &hf_ppi_vector_vchars_human_derived,\r\n{ "Human derived", "ppi_vector.vflags.human_derived",\r\nFT_BOOLEAN, 32, NULL, PPI_VECTOR_VCHARS_HUMAN_DERIVED,\r\n"Vector derived from: human", HFILL } },\r\n{ &hf_ppi_vector_unknown_data,\r\n{ "Data for unknown version", "ppi_vector.unknown_data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL } },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_ppi_vector,\r\n&ett_ppi_vector_present,\r\n&ett_ppi_vectorflags,\r\n&ett_ppi_vectorchars\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_ppi_vector_present_bit, { "ppi_vector.present.unknown_bit", PI_PROTOCOL, PI_WARN, "Error: PPI-VECTOR: unknown bit set in present field.", EXPFILL }},\r\n{ &ei_ppi_vector_length, { "ppi_vector.length.invalid", PI_MALFORMED, PI_ERROR, "Invalid length", EXPFILL }},\r\n};\r\nexpert_module_t* expert_ppi_vector;\r\nproto_ppi_vector = proto_register_protocol("PPI vector decoder", "PPI vector Decoder", "ppi_vector");\r\nproto_register_field_array(proto_ppi_vector, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_ppi_vector = expert_register_protocol(proto_ppi_vector);\r\nexpert_register_field_array(expert_ppi_vector, ei, array_length(ei));\r\nregister_dissector("ppi_vector", dissect_ppi_vector, proto_ppi_vector);\r\n}
