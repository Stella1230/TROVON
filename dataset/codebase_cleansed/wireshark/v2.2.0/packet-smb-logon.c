static int\r\ndissect_account_control(tvbuff_t *tvb, proto_tree *tree, int offset)\r\n{\r\nstatic const int * flags[] = {\r\n&hf_flags_autolock,\r\n&hf_flags_expire,\r\n&hf_flags_server_trust,\r\n&hf_flags_workstation_trust,\r\n&hf_flags_interdomain_trust,\r\n&hf_flags_mns_user,\r\n&hf_flags_normal_user,\r\n&hf_flags_temp_dup_user,\r\n&hf_flags_password_required,\r\n&hf_flags_homedir_required,\r\n&hf_flags_enabled,\r\nNULL\r\n};\r\nproto_tree_add_bitmask(tree, tvb, offset, hf_account_control, ett_smb_account_flags, flags, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int\r\ndisplay_LM_token(tvbuff_t *tvb, int offset, proto_tree *tree)\r\n{\r\nguint16 Token;\r\nToken = tvb_get_letohs(tvb, offset);\r\nif (Token & 0x01) {\r\nproto_tree_add_uint_format(tree, hf_lm_token, tvb, offset, 2,\r\nToken,\r\n"LM20 Token: 0x%04x (LanMan 2.0 or higher)", Token);\r\n} else {\r\nproto_tree_add_uint_format(tree, hf_lm_token, tvb, offset, 2,\r\nToken,\r\n"LM10 Token: 0x%04x (WFW Networking)", Token);\r\n}\r\noffset += 2;\r\nreturn offset;\r\n}\r\nstatic int\r\ndisplay_LMNT_token(tvbuff_t *tvb, int offset, proto_tree *tree)\r\n{\r\nguint16 Token;\r\nToken = tvb_get_letohs(tvb, offset);\r\nif (Token == 0xffff) {\r\nproto_tree_add_uint_format_value(tree, hf_lmnt_token, tvb, offset, 2,\r\nToken,\r\n"0x%04x (Windows NT Networking)", Token);\r\n} else {\r\nproto_tree_add_uint_format(tree, hf_lm_token, tvb, offset, 2,\r\nToken,\r\n"LMNT Token: 0x%04x (Unknown)", Token);\r\n}\r\noffset += 2;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_logon_request(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_computer_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_user_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_mailslot_name, NULL);\r\nproto_tree_add_item(tree, hf_request_count, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_logon_LM10_resp(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_user_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_script_name, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_logon_2(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_computer_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_mailslot_name, NULL);\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_logon_LM20_resp(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_server_name, NULL);\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_pdc_query(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nchar *name;\r\noffset = display_ms_string(tvb, tree, offset, hf_computer_name, &name);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " from %s", name);\r\noffset = display_ms_string(tvb, tree, offset, hf_mailslot_name, NULL);\r\nif (tvb_reported_length_remaining(tvb, offset) > 2) {\r\nif (offset % 2) offset++;\r\noffset = display_unicode_string(tvb, tree, offset, hf_unicode_computer_name, NULL);\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\n}\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_pdc_startup(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_pdc_name, NULL);\r\nif (tvb_reported_length_remaining(tvb, offset) != 0) {\r\nchar *name = NULL;\r\nif (offset % 2) offset++;\r\noffset = display_unicode_string(tvb, tree, offset, hf_unicode_pdc_name, &name);\r\nif (name) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": host %s", name);\r\nname = NULL;\r\n}\r\nif (offset % 2) offset++;\r\noffset = display_unicode_string(tvb, tree, offset, hf_domain_name, &name);\r\nif (name) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", domain %s", name);\r\nname = NULL;\r\n}\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\noffset = display_LM_token(tvb, offset, tree);\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_pdc_failure(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_announce_change(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nguint32 info_count;\r\nproto_tree *info_tree;\r\nguint32 db_index;\r\nguint32 domain_sid_size;\r\nproto_tree_add_item(tree, hf_low_serial, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_date_time, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_pulse, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_random, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_ms_string(tvb, tree, offset, hf_pdc_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_domain_name, NULL);\r\nif (offset % 2) offset++;\r\nif (tvb_reported_length_remaining(tvb, offset) > 2) {\r\noffset = display_unicode_string(tvb, tree, offset, hf_unicode_pdc_name, NULL);\r\noffset = display_unicode_string(tvb, tree, offset, hf_domain_name, NULL);\r\ninfo_count = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_db_count, tvb, offset, 4, info_count);\r\noffset += 4;\r\nwhile (info_count != 0) {\r\ndb_index = tvb_get_letohl(tvb, offset);\r\ninfo_tree = proto_tree_add_subtree_format(tree, tvb, offset, 20,\r\nett_smb_db_info, NULL, "DBChange Info Structure: index %u", db_index);\r\nproto_tree_add_uint(info_tree, hf_db_index, tvb, offset, 4,\r\ndb_index);\r\noffset += 4;\r\nproto_tree_add_item(info_tree, hf_large_serial, tvb, offset, 8,\r\nENC_LITTLE_ENDIAN);\r\noffset += 8;\r\noffset = dissect_nt_64bit_time(tvb, info_tree, offset,\r\nhf_nt_date_time);\r\ninfo_count--;\r\n}\r\ndomain_sid_size = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_domain_sid_size, tvb, offset, 4,\r\ndomain_sid_size);\r\noffset += 4;\r\nif (domain_sid_size != 0) {\r\noffset = ((offset + 3)/4)*4;\r\noffset = dissect_nt_sid(\r\ntvb, offset, tree, "Domain", NULL, -1);\r\n}\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\n}\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_sam_logon_req(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nguint32 domain_sid_size;\r\nproto_tree_add_item(tree, hf_request_count, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\noffset = display_unicode_string(tvb, tree, offset, hf_unicode_computer_name, NULL);\r\noffset = display_unicode_string(tvb, tree, offset, hf_user_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_mailslot_name, NULL);\r\noffset = dissect_account_control(tvb, tree, offset);\r\ndomain_sid_size = tvb_get_letohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_domain_sid_size, tvb, offset, 4,\r\ndomain_sid_size);\r\noffset += 4;\r\nif (domain_sid_size != 0) {\r\noffset = ((offset + 3)/4)*4;\r\noffset = dissect_nt_sid(tvb, offset, tree, "Domain", NULL, -1);\r\n}\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_no_user(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\noffset = display_ms_string(tvb, tree, offset, hf_computer_name, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_relogon_resp(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_major_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_minor_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_os_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_acc_update(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_signature, tvb, offset, 8, ENC_LITTLE_ENDIAN);\r\noffset += 8;\r\nproto_tree_add_item(tree, hf_date_time, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_ms_string(tvb, tree, offset, hf_computer_name, NULL);\r\noffset = display_ms_string(tvb, tree, offset, hf_user_name, NULL);\r\nproto_tree_add_item(tree, hf_update_type, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_inter_resp(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_major_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_minor_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_os_version, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_sam_logon_resp(tvbuff_t *tvb, packet_info *pinfo _U_,\r\nproto_tree *tree, int offset)\r\n{\r\noffset = display_unicode_string(tvb, tree, offset, hf_server_name, NULL);\r\noffset = display_unicode_string(tvb, tree, offset, hf_user_name, NULL);\r\noffset = display_unicode_string(tvb, tree, offset, hf_domain_name, NULL);\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_pdc_response_ads(tvbuff_t *tvb, packet_info *pinfo _U_,\r\nproto_tree *tree, int offset)\r\n{\r\noffset = ((offset + 3)/4)*4;\r\nproto_tree_add_item(tree, hf_unknown32, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_domain_guid, tvb, offset, 16, ENC_NA);\r\noffset += 16;\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_forest_dns_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_domain_dns_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_server_dns_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_domain_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_server_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_user_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_server_site_name, NULL);\r\noffset=dissect_ms_compressed_string(tvb, tree, offset, hf_client_site_name, NULL);\r\nproto_tree_add_item(tree, hf_unknown8, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_unknown32, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_server_ip, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_unknown32, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_unknown32, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_nt_version, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset += 4;\r\noffset = display_LMNT_token(tvb, offset, tree);\r\noffset = display_LM_token(tvb, offset, tree);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_smb_unknown(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_data, tvb, offset, -1, ENC_NA);\r\nreturn offset+tvb_reported_length_remaining(tvb, offset);\r\n}\r\nstatic int\r\ndissect_smb_logon(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint8 cmd;\r\nproto_tree *smb_logon_tree = NULL;\r\nproto_item *item = NULL;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SMB_NETLOGON");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ncmd = tvb_get_guint8(tvb, offset);\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str(cmd, commands, "Unknown Command:%02x") );\r\nif (tree) {\r\nitem = proto_tree_add_item(tree, proto_smb_logon, tvb,\r\noffset, -1, ENC_NA);\r\nsmb_logon_tree = proto_item_add_subtree(item, ett_smb_logon);\r\n}\r\nproto_tree_add_uint(smb_logon_tree, hf_command, tvb, offset, 1, cmd);\r\noffset += 1;\r\noffset += 1;\r\nif (cmd<LOGON_LAST_CMD) {\r\n(dissect_smb_logon_cmds[cmd])(tvb, pinfo,\r\nsmb_logon_tree, offset);\r\n} else {\r\ndissect_smb_unknown(tvb, pinfo, smb_logon_tree,\r\noffset);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_smb_logon( void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_command,\r\n{ "Command", "smb_netlogon.command", FT_UINT8, BASE_HEX,\r\nVALS(commands), 0, "SMB NETLOGON Command", HFILL }},\r\n{ &hf_computer_name,\r\n{ "Computer Name", "smb_netlogon.computer_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Computer Name", HFILL }},\r\n{ &hf_unicode_computer_name,\r\n{ "Unicode Computer Name", "smb_netlogon.unicode_computer_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Unicode Computer Name", HFILL }},\r\n{ &hf_server_name,\r\n{ "Server Name", "smb_netlogon.server_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Server Name", HFILL }},\r\n{ &hf_server_dns_name,\r\n{ "Server DNS Name", "smb_netlogon.server_dns_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Server DNS Name", HFILL }},\r\n{ &hf_user_name,\r\n{ "User Name", "smb_netlogon.user_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON User Name", HFILL }},\r\n{ &hf_domain_name,\r\n{ "Domain Name", "smb_netlogon.domain_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Domain Name", HFILL }},\r\n{ &hf_domain_dns_name,\r\n{ "Domain DNS Name", "smb_netlogon.domain_dns_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Domain DNS Name", HFILL }},\r\n{ &hf_forest_dns_name,\r\n{ "Forest DNS Name", "smb_netlogon.forest_dns_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Forest DNS Name", HFILL }},\r\n{ &hf_mailslot_name,\r\n{ "Mailslot Name", "smb_netlogon.mailslot_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Mailslot Name", HFILL }},\r\n{ &hf_pdc_name,\r\n{ "PDC Name", "smb_netlogon.pdc_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON PDC Name", HFILL }},\r\n{ &hf_unicode_pdc_name,\r\n{ "Unicode PDC Name", "smb_netlogon.unicode_pdc_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Unicode PDC Name", HFILL }},\r\n{ &hf_script_name,\r\n{ "Script Name", "smb_netlogon.script_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Script Name", HFILL }},\r\n{ &hf_nt_version,\r\n{ "NT Version", "smb_netlogon.nt_version", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON NT Version", HFILL }},\r\n{ &hf_lmnt_token,\r\n{ "LMNT Token", "smb_netlogon.lmnt_token", FT_UINT16, BASE_HEX,\r\nNULL, 0, "SMB NETLOGON LMNT Token", HFILL }},\r\n{ &hf_lm_token,\r\n{ "LM Token", "smb_netlogon.lm_token", FT_UINT16, BASE_HEX,\r\nNULL, 0, "SMB NETLOGON LM Token", HFILL }},\r\n{ &hf_major_version,\r\n{ "Workstation Major Version", "smb_netlogon.major_version", FT_UINT8, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Workstation Major Version", HFILL }},\r\n{ &hf_minor_version,\r\n{ "Workstation Minor Version", "smb_netlogon.minor_version", FT_UINT8, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Workstation Minor Version", HFILL }},\r\n{ &hf_os_version,\r\n{ "Workstation OS Version", "smb_netlogon.os_version", FT_UINT8, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Workstation OS Version", HFILL }},\r\n{ &hf_signature,\r\n{ "Signature", "smb_netlogon.signature", FT_UINT64, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_date_time,\r\n{ "Date/Time", "smb_netlogon.date_time", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Date/Time", HFILL }},\r\n{ &hf_update_type,\r\n{ "Update Type", "smb_netlogon.update", FT_UINT16, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Update Type", HFILL }},\r\n{ &hf_request_count,\r\n{ "Request Count", "smb_netlogon.request_count", FT_UINT16, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Request Count", HFILL }},\r\n{ &hf_account_control,\r\n{ "Account control", "smb_netlogon.flags", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_flags_autolock,\r\n{ "Autolock", "smb_netlogon.flags.autolock", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_autolock), ACC_FLAG_AUTO_LOCKED, "SMB NETLOGON Account Autolock", HFILL}},\r\n{ &hf_flags_expire,\r\n{ "Expire", "smb_netlogon.flags.expire", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_expire), ACC_FLAG_EXPIRE, "SMB NETLOGON Will Account Expire", HFILL}},\r\n{ &hf_flags_server_trust,\r\n{ "Server Trust", "smb_netlogon.flags.server", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_server_trust), ACC_FLAG_SERVER_TRUST, "SMB NETLOGON Server Trust Account", HFILL}},\r\n{ &hf_flags_workstation_trust,\r\n{ "Workstation Trust", "smb_netlogon.flags.workstation", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_workstation_trust), ACC_FLAG_WORKSTATION_TRUST, "SMB NETLOGON Workstation Trust Account", HFILL}},\r\n{ &hf_flags_interdomain_trust,\r\n{ "Interdomain Trust", "smb_netlogon.flags.interdomain", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_interdomain_trust), ACC_FLAG_INTERDOMAIN_TRUST, "SMB NETLOGON Inter-domain Trust Account", HFILL}},\r\n{ &hf_flags_mns_user,\r\n{ "MNS User", "smb_netlogon.flags.mns", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_mns_user), ACC_FLAG_MNS_USER, "SMB NETLOGON MNS User Account", HFILL}},\r\n{ &hf_flags_normal_user,\r\n{ "Normal User", "smb_netlogon.flags.normal", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_normal_user), ACC_FLAG_NORMAL_USER, "SMB NETLOGON Normal User Account", HFILL}},\r\n{ &hf_flags_temp_dup_user,\r\n{ "Temp Duplicate User", "smb_netlogon.flags.temp_dup", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_temp_dup_user), ACC_FLAG_TEMP_DUP_USER, "SMB NETLOGON Temp Duplicate User Account", HFILL}},\r\n{ &hf_flags_password_required,\r\n{ "Password", "smb_netlogon.flags.password", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_password_required), ACC_FLAG_PASSWORD_REQUIRED, "SMB NETLOGON Password Required", HFILL}},\r\n{ &hf_flags_homedir_required,\r\n{ "Homedir", "smb_netlogon.flags.homedir", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_homedir_required), ACC_FLAG_HOMEDIR_REQUIRED, "SMB NETLOGON Homedir Required", HFILL}},\r\n{ &hf_flags_enabled,\r\n{ "Enabled", "smb_netlogon.flags.enabled", FT_BOOLEAN, 32,\r\nTFS(&tfs_flags_enabled), ACC_FLAG_ENABLED, "SMB NETLOGON Is This Account Enabled", HFILL}},\r\n{ &hf_domain_sid_size,\r\n{ "Domain SID Size", "smb_netlogon.domain_sid_size", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Domain SID Size", HFILL }},\r\n{ &hf_low_serial,\r\n{ "Low Serial Number", "smb_netlogon.low_serial", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Low Serial Number", HFILL }},\r\n{ &hf_pulse,\r\n{ "Pulse", "smb_netlogon.pulse", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Pulse", HFILL }},\r\n{ &hf_random,\r\n{ "Random", "smb_netlogon.random", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Random", HFILL }},\r\n{ &hf_db_count,\r\n{ "DB Count", "smb_netlogon.db_count", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON DB Count", HFILL }},\r\n{ &hf_db_index,\r\n{ "Database Index", "smb_netlogon.db_index", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Database Index", HFILL }},\r\n{ &hf_large_serial,\r\n{ "Large Serial Number", "smb_netlogon.large_serial", FT_UINT64, BASE_DEC,\r\nNULL, 0, "SMB NETLOGON Large Serial Number", HFILL }},\r\n{ &hf_nt_date_time,\r\n{ "NT Date/Time", "smb_netlogon.nt_date_time", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "SMB NETLOGON NT Date/Time", HFILL }},\r\n{ &hf_unknown8,\r\n{ "Unknown", "smb_netlogon.unknown", FT_UINT8, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_unknown32,\r\n{ "Unknown", "smb_netlogon.unknown", FT_UINT32, BASE_HEX,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_domain_guid,\r\n{ "Domain GUID", "smb_netlogon.domain.guid", FT_BYTES, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_server_ip, {\r\n"Server IP", "smb_netlogon.server_ip", FT_IPv4, BASE_NONE,\r\nNULL, 0x0, "Server IP Address", HFILL }},\r\n{ &hf_server_site_name,\r\n{ "Server Site Name", "smb_netlogon.server_site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Server Site Name", HFILL }},\r\n{ &hf_client_site_name,\r\n{ "Client Site Name", "smb_netlogon.client_site_name", FT_STRING, BASE_NONE,\r\nNULL, 0, "SMB NETLOGON Client Site Name", HFILL }},\r\n{ &hf_data,\r\n{ "Data", "smb_netlogon.data", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_smb_logon,\r\n&ett_smb_account_flags,\r\n&ett_smb_db_info\r\n};\r\nproto_smb_logon = proto_register_protocol(\r\n"Microsoft Windows Logon Protocol (Old)", "SMB_NETLOGON", "smb_netlogon");\r\nproto_register_field_array(proto_smb_logon, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("smb_netlogon", dissect_smb_logon, proto_smb_logon);\r\n}
