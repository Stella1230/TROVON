extern GList * ext_menubar_get_entries(void)\r\n{\r\nreturn menubar_entries;\r\n}\r\nextern ext_menu_t * ext_menubar_register_menu(int proto_id, const gchar * menulabel,\r\ngboolean is_plugin)\r\n{\r\next_menubar_t * entry = NULL;\r\ngchar * name = NULL;\r\ng_assert(menulabel != NULL && strlen ( menulabel ) > 0 );\r\ng_assert(find_protocol_by_id(proto_id) != NULL);\r\nname = g_strconcat(proto_get_protocol_filter_name(proto_id), "Menu", NULL);\r\ng_assert(g_list_find(menubar_menunames, name) == NULL);\r\nentry = (ext_menubar_t *)g_malloc0(sizeof(ext_menubar_t));\r\nentry->type = EXT_MENUBAR_MENU;\r\nentry->proto = proto_id;\r\nentry->is_plugin = is_plugin;\r\nentry->parent_menu = 0;\r\nentry->name = name;\r\nentry->label = g_strdup(menulabel);\r\nentry->tooltip = g_strdup(menulabel);\r\nentry->submenu_cnt = 0;\r\nentry->item_cnt = 0;\r\nmenubar_entries = g_list_append(menubar_entries, entry);\r\nmenubar_menunames = g_list_append(menubar_menunames, name);\r\nreturn entry;\r\n}\r\nextern ext_menu_t * ext_menubar_set_parentmenu(ext_menu_t * menu, const gchar * parentmenu)\r\n{\r\ng_assert(menu != NULL && menu->parent == NULL);\r\ng_assert(parentmenu != 0);\r\nmenu->parent_menu = g_strdup(parentmenu);\r\nreturn menu;\r\n}\r\nextern ext_menu_t * ext_menubar_add_submenu(ext_menu_t * parent, const gchar *menulabel)\r\n{\r\next_menubar_t * entry = NULL;\r\ng_assert(menulabel != NULL && strlen ( menulabel ) > 0 );\r\ng_assert(parent != NULL && parent->type == EXT_MENUBAR_MENU);\r\nparent->submenu_cnt++;\r\nentry = (ext_menubar_t *)g_malloc0(sizeof(ext_menubar_t));\r\nentry->type = EXT_MENUBAR_MENU;\r\nentry->parent = parent;\r\nentry->proto = parent->proto;\r\nentry->is_plugin = parent->is_plugin;\r\nentry->name = g_strdup_printf("%sS%02d", parent->name, parent->submenu_cnt);\r\nentry->label = g_strdup(menulabel);\r\nentry->tooltip = g_strdup(menulabel);\r\nparent->children = g_list_append(parent->children, entry);\r\nreturn entry;\r\n}\r\nstatic void ext_menubar_add_generic_entry (\r\next_menubar_entry_t type, ext_menu_t * parent, const gchar * label,\r\nconst gchar * tooltip, ext_menubar_action_cb callback, gpointer user_data )\r\n{\r\next_menubar_t * entry = NULL;\r\ng_assert(parent != NULL && parent->type == EXT_MENUBAR_MENU);\r\ng_assert(label != NULL && strlen ( label ) > 0 );\r\nparent->item_cnt++;\r\nentry = (ext_menubar_t*)g_malloc0(sizeof(ext_menubar_t));\r\nentry->type = type;\r\nentry->name = g_strdup_printf("%sI%02d", parent->name, parent->item_cnt);\r\nentry->label = g_strdup(label);\r\nif ( tooltip != NULL && strlen(tooltip) > 0 )\r\nentry->tooltip = g_strdup(tooltip);\r\nentry->callback = callback;\r\nentry->user_data = user_data;\r\nparent->children = g_list_append(parent->children, entry);\r\n}\r\nextern void ext_menubar_add_entry(ext_menu_t * parent, const gchar *label,\r\nconst gchar *tooltip, ext_menubar_action_cb callback, gpointer user_data)\r\n{\r\ng_assert(callback != NULL);\r\next_menubar_add_generic_entry ( EXT_MENUBAR_ITEM, parent, label, tooltip, callback, user_data );\r\n}\r\nextern void ext_menubar_add_website(ext_menu_t * parent, const gchar *label,\r\nconst gchar *tooltip, const gchar *url)\r\n{\r\ng_assert(url != NULL && strlen ( url ) > 0 );\r\next_menubar_add_generic_entry ( EXT_MENUBAR_URL, parent, label, tooltip, NULL, (gpointer) g_strdup(url) );\r\n}\r\nextern void ext_menubar_add_separator(ext_menu_t *parent)\r\n{\r\next_menubar_add_generic_entry ( EXT_MENUBAR_SEPARATOR, parent, g_strdup("-"), NULL, NULL, NULL );\r\n}\r\nstatic void\r\nplugin_if_init_hashtable(void)\r\n{\r\nif ( plugin_if_callback_functions == 0 )\r\nplugin_if_callback_functions = g_hash_table_new(g_int_hash, g_int_equal);\r\n}\r\nstatic void plugin_if_call_gui_cb(plugin_if_callback_t actionType, GHashTable * dataSet)\r\n{\r\nplugin_if_gui_cb action;\r\ngint * key = 0;\r\nkey = (gint *)g_malloc0(sizeof(gint));\r\n*key = (gint) actionType;\r\nplugin_if_init_hashtable();\r\nif ( g_hash_table_size(plugin_if_callback_functions) != 0 )\r\n{\r\nif ( g_hash_table_lookup_extended(plugin_if_callback_functions, key, NULL, (gpointer*)&action) )\r\n{\r\nif ( action != NULL )\r\naction(dataSet);\r\n}\r\n}\r\n}\r\nextern void plugin_if_apply_filter(const char * filter_string, gboolean force)\r\n{\r\nplugin_if_callback_t actionType;\r\nGHashTable * dataSet = NULL;\r\nactionType = ( force == TRUE ) ? PLUGIN_IF_FILTER_ACTION_APPLY : PLUGIN_IF_FILTER_ACTION_PREPARE;\r\ndataSet = g_hash_table_new(g_str_hash, g_str_equal);\r\ng_hash_table_insert( dataSet, g_strdup("action_type"), (gpointer) &actionType );\r\ng_hash_table_insert( dataSet, g_strdup("filter_string"), g_strdup(filter_string) );\r\ng_hash_table_insert( dataSet, g_strdup("force"), (gpointer) &force );\r\nplugin_if_call_gui_cb(actionType, dataSet);\r\n}\r\nextern void plugin_if_goto_frame(guint32 framenr)\r\n{\r\nGHashTable * dataSet = NULL;\r\ndataSet = g_hash_table_new(g_str_hash, g_str_equal);\r\ng_hash_table_insert( dataSet, g_strdup("frame_nr"), GUINT_TO_POINTER(framenr) );\r\nplugin_if_call_gui_cb(PLUGIN_IF_GOTO_FRAME, dataSet);\r\n}\r\nextern void plugin_if_save_preference(const char * pref_module, const char * pref_key, const char * pref_value)\r\n{\r\nGHashTable * dataSet = NULL;\r\ndataSet = g_hash_table_new(g_str_hash, g_str_equal);\r\ng_hash_table_insert( dataSet, g_strdup("pref_module"), g_strdup(pref_module) );\r\ng_hash_table_insert( dataSet, g_strdup("pref_key"), g_strdup(pref_key) );\r\ng_hash_table_insert( dataSet, g_strdup("pref_value"), g_strdup(pref_value) );\r\nplugin_if_call_gui_cb(PLUGIN_IF_PREFERENCE_SAVE, dataSet);\r\n}\r\nextern void plugin_if_get_ws_info(ws_info_t **ws_info_ptr)\r\n{\r\nstatic ws_info_t ws_info = { FALSE, FILE_CLOSED, NULL, 0, 0, FALSE };\r\n#ifdef HAVE_LIBPCAP\r\nGHashTable * dataSet;\r\ngchar * pluginKey = g_strdup("ws_info");\r\ndataSet = g_hash_table_new(g_str_hash, g_str_equal);\r\ng_hash_table_insert(dataSet, pluginKey, &ws_info);\r\nplugin_if_call_gui_cb(PLUGIN_IF_GET_WS_INFO, dataSet);\r\ng_hash_table_destroy(dataSet);\r\ng_free(pluginKey);\r\n#else\r\nws_info.ws_info_supported = FALSE;\r\nws_info.cf_count = 0;\r\nws_info.cf_filename = NULL;\r\nws_info.cf_framenr = 0;\r\nws_info.frame_passed_dfilter = FALSE;\r\nws_info.cf_state = FILE_CLOSED;\r\n#endif\r\n*ws_info_ptr = &ws_info;\r\n}\r\nextern void plugin_if_register_gui_cb(plugin_if_callback_t actionType, plugin_if_gui_cb callback)\r\n{\r\ngint * key = 0;\r\nkey = (gint *)g_malloc0(sizeof(gint));\r\n*key = actionType;\r\nplugin_if_init_hashtable();\r\nif ( ! g_hash_table_lookup_extended(plugin_if_callback_functions, key, NULL, NULL ) )\r\ng_hash_table_insert(plugin_if_callback_functions, key, (gpointer)callback);\r\n}
