static int\r\ndissect_mpeg1( tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_ )\r\n{\r\nproto_item *ti;\r\nproto_tree *mpg_tree;\r\nunsigned int offset = 0;\r\nstatic const int * mpg_fields1[] = {\r\n&hf_rtp_mpg_mbz,\r\n&hf_rtp_mpg_T,\r\n&hf_rtp_mpg_tr,\r\nNULL\r\n};\r\nstatic const int * mpg_fields2[] = {\r\n&hf_rtp_mpg_an,\r\n&hf_rtp_mpg_n,\r\n&hf_rtp_mpg_s,\r\n&hf_rtp_mpg_b,\r\n&hf_rtp_mpg_e,\r\n&hf_rtp_mpg_p,\r\nNULL\r\n};\r\nstatic const int * mpg_fields3[] = {\r\n&hf_rtp_mpg_fbv,\r\n&hf_rtp_mpg_bfc,\r\n&hf_rtp_mpg_ffv,\r\n&hf_rtp_mpg_ffc,\r\nNULL\r\n};\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "MPEG-1");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "MPEG-1 message");\r\nti = proto_tree_add_item( tree, proto_mpg, tvb, offset, -1, ENC_NA );\r\nmpg_tree = proto_item_add_subtree( ti, ett_mpg );\r\nproto_tree_add_bitmask_list(mpg_tree, tvb, offset, 2, mpg_fields1, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_bitmask_list(mpg_tree, tvb, offset, 2, mpg_fields2, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_bitmask_list(mpg_tree, tvb, offset, 1, mpg_fields3, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item( mpg_tree, hf_rtp_mpg_data, tvb, offset, -1, ENC_NA );\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_mpeg1(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_rtp_mpg_mbz,\r\n{\r\n"MBZ",\r\n"rtp.payload_mpeg_mbz",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0xF800,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_T,\r\n{\r\n"T",\r\n"rtp.payload_mpeg_T",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x0400,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_tr,\r\n{\r\n"Temporal Reference",\r\n"rtp.payload_mpeg_tr",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x03FF,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_an,\r\n{\r\n"AN",\r\n"rtp.payload_mpeg_an",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_n,\r\n{\r\n"New Picture Header",\r\n"rtp.payload_mpeg_n",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x40,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_s,\r\n{\r\n"Sequence Header",\r\n"rtp.payload_mpeg_s",\r\nFT_BOOLEAN,\r\n16,\r\nNULL,\r\n0x20,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_b,\r\n{\r\n"Beginning-of-slice",\r\n"rtp.payload_mpeg_b",\r\nFT_BOOLEAN,\r\n16,\r\nNULL,\r\n0x10,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_e,\r\n{\r\n"End-of-slice",\r\n"rtp.payload_mpeg_e",\r\nFT_BOOLEAN,\r\n16,\r\nNULL,\r\n0x08,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_p,\r\n{\r\n"Picture type",\r\n"rtp.payload_mpeg_p",\r\nFT_UINT16,\r\nBASE_DEC,\r\nVALS(rtp_mpg_picture_types_vals),\r\n0x07,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_fbv,\r\n{\r\n"FBV",\r\n"rtp.payload_mpeg_fbv",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_bfc,\r\n{\r\n"BFC",\r\n"rtp.payload_mpeg_bfc",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x70,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_ffv,\r\n{\r\n"FFV",\r\n"rtp.payload_mpeg_ffv",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x08,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_ffc,\r\n{\r\n"FFC",\r\n"rtp.payload_mpeg_ffc",\r\nFT_UINT16,\r\nBASE_DEC,\r\nNULL,\r\n0x07,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_rtp_mpg_data,\r\n{\r\n"MPEG-1 stream",\r\n"mpeg1.stream",\r\nFT_BYTES,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_mpg,\r\n};\r\nproto_mpg = proto_register_protocol("RFC 2250 MPEG1","MPEG1","mpeg1");\r\nproto_register_field_array(proto_mpg, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_mpeg1(void)\r\n{\r\ndissector_handle_t mpeg1_handle;\r\nmpeg1_handle = create_dissector_handle(dissect_mpeg1, proto_mpg);\r\ndissector_add_uint("rtp.pt", PT_MPV, mpeg1_handle);\r\n}
