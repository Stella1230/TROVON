static void\r\nadd_row_to_grid(GtkWidget *grid, guint *row, gchar *title, const gchar *value, gboolean sensitive)\r\n{\r\nGtkWidget *label;\r\ngchar *indent;\r\nif (strlen(value) != 0) {\r\nindent = g_strdup_printf(" %s", title);\r\n} else {\r\nindent = g_strdup(title);\r\n}\r\nlabel = gtk_label_new(indent);\r\ng_free(indent);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.5);\r\ngtk_widget_set_sensitive(label, sensitive);\r\nws_gtk_grid_attach_extended(GTK_GRID(grid), label, 0, *row, 1, 1, GTK_EXPAND | GTK_FILL, 0, 0,0);\r\nlabel = gtk_label_new(value);\r\ngtk_misc_set_alignment(GTK_MISC(label), 0.0, 0.5);\r\ngtk_widget_set_sensitive(label, sensitive);\r\nws_gtk_grid_attach_extended(GTK_GRID(grid), label, 1, *row, 1, 1, GTK_EXPAND | GTK_FILL, 0, 0,0);\r\n*row += 1;\r\n}\r\nstatic void\r\nadd_string_to_grid(GtkWidget *grid, guint *row, gchar *title, const gchar *value)\r\n{\r\nadd_row_to_grid(grid, row, title, value, TRUE);\r\n}\r\nstatic void\r\nssid_details(GtkWidget *grid, guint *row, struct ndis_essid *ssid_in) {\r\nstruct ndis_essid ssid[2];\r\nssid[0] = *ssid_in;\r\ng_assert(ssid->length <= NDIS_ESSID_MAX_SIZE);\r\nif (ssid->length != 0) {\r\nssid->essid[ssid->length] = '\0';\r\nadd_string_to_grid(grid, row, "SSID (Service Set IDentifier)", ssid->essid);\r\n} else {\r\nadd_string_to_grid(grid, row, "SSID (Service Set IDentifier)", "(currently not associated with an SSID)");\r\n}\r\n}\r\nstatic GString *\r\nrates_details(unsigned char *values, int length) {\r\nint i;\r\nGString *Rates;\r\nfloat float_value;\r\nint int_value;\r\nRates = g_string_new("");\r\nif (length != 0) {\r\ni = 0;\r\nwhile (length--) {\r\nif (values[i]) {\r\nif (i != 0) {\r\ng_string_append(Rates, "/");\r\n}\r\nfloat_value = ((float) (values[i] & 0x7F)) / 2;\r\nint_value = (int)float_value;\r\nif (float_value == (float)int_value) {\r\ng_string_append_printf(Rates, "%.0f", float_value);\r\n} else {\r\ng_string_append_printf(Rates, "%.1f", float_value);\r\n}\r\n}\r\ni++;\r\n}\r\nRates = g_string_append(Rates, " MBits/s");\r\n} else {\r\nRates = g_string_append(Rates, "-");\r\n}\r\nreturn Rates;\r\n}\r\nstatic void\r\nhex(unsigned char *p, int len) {\r\nint i = 0;\r\nwhile (len) {\r\ng_warning("%u: 0x%x (%u) '%c'", i, *p, *p,\r\ng_ascii_isprint(*p) ? *p : '.');\r\ni++;\r\np++;\r\nlen--;\r\n}\r\n}\r\nstatic void\r\ncapture_if_details_802_11_bssid_list(GtkWidget *main_vb, struct ndis_bssid_list *bssid_list)\r\n{\r\nstruct ndis_ssid_item *bssid_item;\r\nunsigned char mac[6];\r\nconst gchar *manuf_name;\r\nGString *Rates;\r\ngchar *tmp_str;\r\nif (bssid_list->num_items != 0) {\r\nstatic const char *titles[] = { "SSID", "MAC", "Vendor", "Privacy", "RSSI" , "Network Type" ,\r\n"Infra. Mode" , "Ch." , "Rates", "Country" };\r\nGtkWidget *list;\r\ngboolean privacy_required;\r\ngboolean privacy_wpa;\r\ngboolean privacy_wpa2;\r\ngchar ssid_buff [DETAILS_STR_MAX];\r\ngchar mac_buff [DETAILS_STR_MAX];\r\ngchar vendor_buff [DETAILS_STR_MAX];\r\ngchar privacy_buff [DETAILS_STR_MAX];\r\ngchar rssi_buff [DETAILS_STR_MAX];\r\ngchar nettype_buff [DETAILS_STR_MAX];\r\ngchar infra_buff [DETAILS_STR_MAX];\r\ngchar freq_buff [DETAILS_STR_MAX];\r\ngchar country_buff [DETAILS_STR_MAX] = "";\r\nlist = simple_list_new(10, titles);\r\ngtk_box_pack_start(GTK_BOX(main_vb), list, TRUE , TRUE , 0 );\r\nbssid_item = &bssid_list->items[0];\r\nwhile (bssid_list->num_items--) {\r\nprivacy_required = FALSE;\r\nprivacy_wpa = FALSE;\r\nprivacy_wpa2 = FALSE;\r\nif (bssid_item->ssid.length > DETAILS_STR_MAX-1) {\r\nbssid_item->ssid.length = DETAILS_STR_MAX-1;\r\n}\r\nmemcpy(ssid_buff, bssid_item->ssid.essid, bssid_item->ssid.length);\r\nssid_buff[bssid_item->ssid.length] = '\0';\r\nmemcpy(mac, &bssid_item->mac, sizeof(mac));\r\ng_snprintf(mac_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X",\r\nmac[0], mac[1], mac[2],\r\nmac[3], mac[4], mac[5]);\r\nmanuf_name = get_manuf_name_if_known(mac);\r\nif (manuf_name != NULL) {\r\ng_strlcpy(vendor_buff, manuf_name, DETAILS_STR_MAX);\r\n} else {\r\nvendor_buff[0] = '\0';\r\n}\r\nRates = rates_details(bssid_item->rates, NDIS_MAX_RATES_EX);\r\ng_snprintf(rssi_buff, DETAILS_STR_MAX, "%d dBm", bssid_item->rssi);\r\nif (bssid_item->privacy) {\r\nprivacy_required = TRUE;\r\n}\r\ntmp_str = val_to_str_wmem(NULL, bssid_item->net_type, win32_802_11_network_type_vals, "(0x%x)");\r\ng_snprintf(nettype_buff, sizeof(nettype_buff), "%s", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\ntmp_str = val_to_str_wmem(NULL, bssid_item->mode, win32_802_11_infra_mode_vals, "(0x%x)");\r\ng_snprintf(infra_buff, sizeof(infra_buff), "%s", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\ntmp_str = val_to_str_wmem(NULL, bssid_item->config.ds_config, win32_802_11_channel_vals, "(%u kHz)");\r\ng_snprintf(freq_buff, sizeof(freq_buff), "%s", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\n{\r\nint len = bssid_item->ie_length;\r\nunsigned char *iep = bssid_item->ies;\r\nunsigned char id;\r\nguint el_len;\r\nNDIS_802_11_FIXED_IEs *fixed_ies;\r\n#ifdef DEBUG_IE\r\nconst gchar *manuf_name;\r\ngchar string_buff[DETAILS_STR_MAX];\r\n#endif\r\nfixed_ies = (NDIS_802_11_FIXED_IEs *)iep;\r\niep += sizeof(NDIS_802_11_FIXED_IEs);\r\nlen = bssid_item->ie_length - sizeof(NDIS_802_11_FIXED_IEs);\r\nwhile (len >= 2) {\r\nid = *iep;\r\niep++;\r\nel_len = *iep;\r\niep++;\r\nlen -= 2;\r\n#ifdef DEBUG_IE\r\ntmp_str = val_to_str_wmem(NULL, id, ie_id_vals, "0x%x");\r\ng_warning("ID: %s (%u) Len: %u", tmp_str, id, el_len);\r\nwmem_free(NULL, tmp_str);\r\n#endif\r\nswitch (id) {\r\ncase(IE_ID_COUNTRY):\r\nif (el_len >= 6)\r\ng_snprintf(country_buff, sizeof(country_buff), "%c%c: Ch: %u-%u Max: %ddBm",\r\niep[0], iep[1], iep[3], iep[4], iep[5]);\r\nbreak;\r\ncase(IE_ID_WPA2):\r\nprivacy_wpa2 = TRUE;\r\nbreak;\r\ncase(IE_ID_VENDOR_SPECIFIC):\r\nprivacy_wpa = TRUE;\r\n#ifdef DEBUG_IE\r\nmanuf_name = get_manuf_name_if_known(iep);\r\nif (manuf_name != NULL) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X (%s) Type: %02X",\r\n*(iep), *(iep+1), *(iep+2), manuf_name, *(iep+3));\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X Type: %02X",\r\n*(iep), *(iep+1), *(iep+2), *(iep+3));\r\n}\r\ng_warning("%s", string_buff);\r\niep += 4;\r\nel_len-= 4;\r\nlen -= 4;\r\ng_warning("WPA IE: %u", id);\r\nhex(iep, el_len);\r\n#endif\r\nbreak;\r\ncase(IE_ID_SSID):\r\ncase(IE_ID_SUPPORTED_RATES):\r\ncase(IE_ID_DS_PARAMETER_SET):\r\ncase(IE_ID_TIM):\r\ncase(IE_ID_ERP_INFORMATION):\r\ncase(IE_ID_EXTENDED_SUPPORT_RATES):\r\nbreak;\r\ndefault:\r\ng_warning("Unknown IE ID: %u Len: %u", id, el_len);\r\nhex(iep, el_len);\r\n}\r\niep += el_len;\r\nlen -= el_len;\r\n}\r\n}\r\nif (privacy_required) {\r\nif (privacy_wpa2) {\r\ng_snprintf(privacy_buff, DETAILS_STR_MAX, "WPA2");\r\n} else {\r\nif (privacy_wpa) {\r\ng_snprintf(privacy_buff, DETAILS_STR_MAX, "WPA");\r\n} else {\r\ng_snprintf(privacy_buff, DETAILS_STR_MAX, "WEP");\r\n}\r\n}\r\n} else {\r\ng_snprintf(privacy_buff, DETAILS_STR_MAX, "None");\r\n}\r\nsimple_list_append(list,\r\n0, ssid_buff,\r\n1, mac_buff,\r\n2, vendor_buff,\r\n3, privacy_buff,\r\n4, rssi_buff,\r\n5, nettype_buff,\r\n6, infra_buff,\r\n7, freq_buff,\r\n8, Rates->str,\r\n9, country_buff,\r\n-1);\r\ng_string_free(Rates, TRUE );\r\nbssid_item = (struct ndis_ssid_item *) (((char *) bssid_item) + bssid_item->length);\r\n}\r\n}\r\n}\r\nstatic int\r\ncapture_if_details_802_11(GtkWidget *grid, GtkWidget *main_vb, guint *row, LPADAPTER adapter) {\r\nULONG ulong_value;\r\nLONG rssi = -100;\r\nunsigned int uint_value;\r\nunsigned char values[100];\r\nstruct ndis_essid ssid;\r\nint length;\r\ngchar string_buff[DETAILS_STR_MAX];\r\nGString *Rates;\r\nint entries = 0;\r\nconst gchar *manuf_name;\r\nstruct ndis_bssid_list *bssid_list;\r\nstruct ndis_configuration *configuration;\r\ngchar* tmp_str;\r\nadd_string_to_grid(grid, row, "Current network", "");\r\nlength = sizeof(struct ndis_essid);\r\nmemset(&ssid, 0, length);\r\nif (wpcap_packet_request(adapter, OID_802_11_SSID, FALSE , (char *) &ssid, &length)) {\r\nssid_details(grid, row, &ssid);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "SSID (Service Set IDentifier)", "-");\r\n}\r\nlength = sizeof(values);\r\nmemset(values, 0, 6);\r\nif (wpcap_packet_request(adapter, OID_802_11_BSSID, FALSE , values, &length)) {\r\nmanuf_name = get_manuf_name_if_known(values);\r\nif (manuf_name != NULL) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X (%s)",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5],\r\nmanuf_name);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5]);\r\n}\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "BSSID (Basic Service Set IDentifier)", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_11_NETWORK_TYPE_IN_USE, &uint_value)) {\r\ntmp_str = val_to_str_wmem(NULL, uint_value, win32_802_11_network_type_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Network type used", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "Network type used", "-");\r\n}\r\nif (wpcap_packet_request_ulong(adapter, OID_802_11_INFRASTRUCTURE_MODE, &uint_value)) {\r\ntmp_str = val_to_str_wmem(NULL, uint_value, win32_802_11_infra_mode_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Infrastructure mode", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "Infrastructure mode", "-");\r\n}\r\nif (wpcap_packet_request_ulong(adapter, OID_802_11_AUTHENTICATION_MODE, &uint_value)) {\r\ntmp_str = val_to_str_wmem(NULL, uint_value, win32_802_11_auth_mode_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Authentication mode", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "Authentication mode", "-");\r\n}\r\nif (wpcap_packet_request_ulong(adapter, OID_802_11_ENCRYPTION_STATUS, &uint_value)) {\r\ntmp_str = val_to_str_wmem(NULL, uint_value, win32_802_11_encryption_status_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Encryption status", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "Encryption status", "-");\r\n}\r\nif (wpcap_packet_request_ulong(adapter, OID_802_11_TX_POWER_LEVEL, &ulong_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%ld mW", ulong_value);\r\nadd_string_to_grid(grid, row, "TX power", string_buff);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "TX power", "-");\r\n}\r\nif (wpcap_packet_request_ulong(adapter, OID_802_11_RSSI, &rssi)) {\r\n#if 0\r\nint i;\r\nGList * scale_items = NULL;\r\nGList * current;\r\nGtkVUMeterScaleItem *item;\r\nfor (i = 0; i <= 100; i++) {\r\nitem = g_malloc(sizeof(GtkVUMeterScaleItem));\r\nitem->level = i;\r\nitem->large = !(i%5);\r\nitem->label = NULL;\r\nswitch (item->level) {\r\ncase 0:\r\nitem->label = "-100 ";\r\nbreak;\r\ncase 20:\r\nitem->label = "-80 ";\r\nbreak;\r\ncase 40:\r\nitem->label = "-60 ";\r\nbreak;\r\ncase 60:\r\nitem->label = "-40 ";\r\nbreak;\r\ncase 80:\r\nitem->label = "-20 ";\r\nbreak;\r\ncase 100:\r\nitem->label = "0";\r\nbreak;\r\ndefault:\r\nitem->label = NULL;\r\n}\r\nscale_items = g_list_append(scale_items, item);\r\n}\r\nif (rssi < -100) {\r\nrssi = -100;\r\n}\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%ld dBm", rssi);\r\nadd_meter_to_grid(grid, row, "RSSI (Received Signal Strength Indication)",\r\nrssi+100 , string_buff, -100+100, 0+100, -80+100, scale_items);\r\ncurrent = scale_items;\r\nwhile (current != NULL) {\r\ng_free(current->data);\r\ncurrent = g_list_next(current);\r\n}\r\ng_list_free(scale_items);\r\nentries++;\r\n#endif\r\n} else {\r\nadd_string_to_grid(grid, row, "RSSI (Received Signal Strength Indication)", "-");\r\n}\r\nlength = sizeof(values);\r\nif (!wpcap_packet_request(adapter, OID_802_11_SUPPORTED_RATES, FALSE , values, &length)) {\r\nlength = 0;\r\n} else {\r\nentries++;\r\n}\r\nif (length != 0 && wpcap_packet_request_uint(adapter, OID_GEN_LINK_SPEED, &uint_value)) {\r\n#if 0\r\nint max;\r\nint yellow;\r\nGList *rates_list;\r\nGList * current;\r\nrates_list = rates_vu_list(values, length, &max);\r\nif (rssi == -100) {\r\nuint_value = 0;\r\n}\r\nuint_value /= 10 * 1000;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u MBits/s", uint_value);\r\nif (max >= 54) {\r\nyellow = 2;\r\n} else {\r\nyellow = 1;\r\n}\r\nadd_meter_to_grid(grid, row, "Link Speed",\r\nuint_value, string_buff, 0, max, yellow, rates_list);\r\ncurrent = rates_list;\r\nwhile (current != NULL) {\r\ng_free(current->data);\r\ncurrent = g_list_next(current);\r\n}\r\ng_list_free(rates_list);\r\n#endif\r\n}\r\nRates = rates_details(values, length);\r\nadd_string_to_grid(grid, row, "Supported Rates", Rates->str);\r\ng_string_free(Rates, TRUE );\r\nlength = sizeof(values);\r\nif (!wpcap_packet_request(adapter, OID_802_11_DESIRED_RATES, FALSE , values, &length)) {\r\nlength = 0;\r\n} else {\r\nentries++;\r\n}\r\nRates = rates_details(values, length);\r\nadd_string_to_grid(grid, row, "Desired Rates", Rates->str);\r\ng_string_free(Rates, TRUE );\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_802_11_CONFIGURATION, FALSE , (char *) values, &length)) {\r\nconfiguration = (struct ndis_configuration *) values;\r\ntmp_str = val_to_str_wmem(NULL, configuration->ds_config, win32_802_11_channel_freq_vals, "(%u kHz)");\r\nadd_string_to_grid(grid, row, "Channel", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\nentries++;\r\n} else {\r\nadd_string_to_grid(grid, row, "Channel", "-");\r\n}\r\nlength = sizeof(uint_value);\r\nif (wpcap_packet_request(adapter, OID_802_11_BSSID_LIST_SCAN, TRUE , (char *) &uint_value, &length)) {\r\n#if 0\r\ng_warning("BSSID list scan done");\r\n} else {\r\ng_warning("BSSID list scan failed");\r\n#endif\r\n}\r\nlength = sizeof(ULONG) + sizeof(struct ndis_ssid_item) * 16;\r\nbssid_list = g_malloc(length);\r\nmemset(bssid_list, 0, length);\r\nif (wpcap_packet_request(adapter, OID_802_11_BSSID_LIST, FALSE , (char *) bssid_list, &length)) {\r\nadd_string_to_grid(grid, row, "", "");\r\nadd_string_to_grid(grid, row, "Available networks (BSSID list)", "");\r\ncapture_if_details_802_11_bssid_list(main_vb, bssid_list);\r\nentries += bssid_list->num_items;\r\n} else {\r\nadd_string_to_grid(grid, row, "Available networks (BSSID list)", "-");\r\n}\r\ng_free(bssid_list);\r\nreturn entries;\r\n}\r\nstatic int\r\ncapture_if_details_802_3(GtkWidget *grid, GtkWidget *main_vb, guint *row, LPADAPTER adapter) {\r\nunsigned int uint_value;\r\nunsigned char values[100];\r\nint length;\r\ngchar string_buff[DETAILS_STR_MAX];\r\nconst gchar *manuf_name;\r\nint entries = 0;\r\nadd_string_to_grid(grid, row, "Characteristics", "");\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_802_3_PERMANENT_ADDRESS, FALSE , values, &length)) {\r\nmanuf_name = get_manuf_name_if_known(values);\r\nif (manuf_name != NULL) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X (%s)",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5],\r\nmanuf_name);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5]);\r\n}\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Permanent station address", string_buff);\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_802_3_CURRENT_ADDRESS, FALSE , values, &length)) {\r\nmanuf_name = get_manuf_name_if_known(values);\r\nif (manuf_name != NULL) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X (%s)",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5],\r\nmanuf_name);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X:%02X:%02X:%02X",\r\nvalues[0], values[1], values[2],\r\nvalues[3], values[4], values[5]);\r\n}\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Current station address", string_buff);\r\nadd_string_to_grid(grid, row, "", "");\r\nadd_string_to_grid(grid, row, "Statistics", "");\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_RCV_ERROR_ALIGNMENT, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets received with alignment error", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_ONE_COLLISION, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets transmitted with one collision", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_MORE_COLLISIONS, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets transmitted with more than one collision", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_RCV_OVERRUN, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets not received due to overrun", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_DEFERRED, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets transmitted after deferred", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_MAX_COLLISIONS, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets not transmitted due to collisions", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_UNDERRUN, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets not transmitted due to underrun", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_HEARTBEAT_FAILURE, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packets transmitted with heartbeat failure", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_TIMES_CRS_LOST, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Times carrier sense signal lost during transmission", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_802_3_XMIT_LATE_COLLISIONS, &uint_value)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Times late collisions detected", string_buff);\r\nreturn entries;\r\n}\r\nstatic int\r\ncapture_if_details_task_offload(GtkWidget *table, GtkWidget *main_vb, guint *row, LPADAPTER adapter) {\r\nNDIS_TASK_OFFLOAD_HEADER *offload;\r\nunsigned char values[10000];\r\nint length;\r\ngchar string_buff[DETAILS_STR_MAX];\r\nint entries = 0;\r\nint TcpIpChecksumSupported = 0;\r\nint IpSecSupported = 0;\r\nint TcpLargeSendSupported = 0;\r\noffload = (NDIS_TASK_OFFLOAD_HEADER *) values;\r\noffload->Version = NDIS_TASK_OFFLOAD_VERSION;\r\noffload->Size = sizeof(NDIS_TASK_OFFLOAD_HEADER);\r\noffload->Reserved = 0;\r\noffload->OffsetFirstTask = 0;\r\noffload->EncapsulationFormat.Encapsulation = IEEE_802_3_Encapsulation;\r\noffload->EncapsulationFormat.Flags.FixedHeaderSize = 1;\r\noffload->EncapsulationFormat.Flags.Reserved = 0;\r\noffload->EncapsulationFormat.EncapsulationHeaderSize = 14; ;\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_TCP_TASK_OFFLOAD, FALSE , values, &length)) {\r\nNDIS_TASK_OFFLOAD *of;\r\nunsigned char *valuep = values + offload->OffsetFirstTask;\r\nlength -= offload->OffsetFirstTask;\r\ndo {\r\nof = (NDIS_TASK_OFFLOAD *) valuep;\r\nswitch (of->Task) {\r\ncase TcpIpChecksumNdisTask:\r\n{\r\nNDIS_TASK_TCP_IP_CHECKSUM *tic = (NDIS_TASK_TCP_IP_CHECKSUM *) (of->TaskBuffer);\r\nentries++;\r\nTcpIpChecksumSupported++;\r\nadd_string_to_grid(table, row, "TCP/IP Checksum", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "");\r\nadd_string_to_grid(table, row, "V4 transmit checksum", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, UDP: %s, IP: %s",\r\ntic->V4Transmit.TcpChecksum ? "Yes" : "No",\r\ntic->V4Transmit.UdpChecksum ? "Yes" : "No",\r\ntic->V4Transmit.IpChecksum ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Calculation supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, IP: %s",\r\ntic->V4Transmit.TcpOptionsSupported ? "Yes" : "No",\r\ntic->V4Transmit.IpOptionsSupported ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Options fields supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "");\r\nadd_string_to_grid(table, row, "V4 receive checksum", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, UDP: %s, IP: %s",\r\ntic->V4Receive.TcpChecksum ? "Yes" : "No",\r\ntic->V4Receive.UdpChecksum ? "Yes" : "No",\r\ntic->V4Receive.IpChecksum ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Validation supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, IP: %s",\r\ntic->V4Receive.TcpOptionsSupported ? "Yes" : "No",\r\ntic->V4Receive.IpOptionsSupported ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Options fields supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "");\r\nadd_string_to_grid(table, row, "V6 transmit checksum", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, UDP: %s",\r\ntic->V6Transmit.TcpChecksum ? "Yes" : "No",\r\ntic->V6Transmit.UdpChecksum ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Calculation supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, IP: %s",\r\ntic->V6Transmit.TcpOptionsSupported ? "Yes" : "No",\r\ntic->V6Transmit.IpOptionsSupported ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Options fields supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "");\r\nadd_string_to_grid(table, row, "V6 receive checksum", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, UDP: %s",\r\ntic->V6Receive.TcpChecksum ? "Yes" : "No",\r\ntic->V6Receive.UdpChecksum ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Validation supported", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "TCP: %s, IP: %s",\r\ntic->V6Receive.TcpOptionsSupported ? "Yes" : "No",\r\ntic->V6Receive.IpOptionsSupported ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "Options fields supported", string_buff);\r\n}\r\nbreak;\r\ncase IpSecNdisTask:\r\nentries++;\r\nIpSecSupported++;\r\nadd_string_to_grid(table, row, "IPSEC", "");\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "IPSEC (TaskID 1) not decoded yet");\r\nadd_string_to_grid(table, row, "Task", string_buff);\r\nbreak;\r\ncase TcpLargeSendNdisTask:\r\n{\r\nNDIS_TASK_TCP_LARGE_SEND *tls = (NDIS_TASK_TCP_LARGE_SEND *) (of->TaskBuffer);\r\nentries++;\r\nTcpLargeSendSupported++;\r\nadd_string_to_grid(table, row, "TCP large send", "");\r\nif (tls->Version == 1) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u", tls->MaxOffLoadSize);\r\nadd_string_to_grid(table, row, "Max Offload Size", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u", tls->MinSegmentCount);\r\nadd_string_to_grid(table, row, "Min Segment Count", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%s", tls->TcpOptions ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "TCP option fields", string_buff);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%s", tls->IpOptions ? "Yes" : "No");\r\nadd_string_to_grid(table, row, "IP option fields", string_buff);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u (unknown)", tls->Version);\r\nadd_string_to_grid(table, row, "Version", string_buff);\r\n}\r\n}\r\nbreak;\r\ndefault:\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "Unknown task %u", of->Task);\r\nadd_string_to_grid(table, row, "Task", string_buff);\r\n}\r\nadd_string_to_grid(table, row, "", "");\r\nvaluep += of->OffsetNextTask;\r\nlength -= of->OffsetNextTask;\r\n} while (of->OffsetNextTask != 0);\r\n}\r\nif (TcpIpChecksumSupported == 0) {\r\nadd_string_to_grid(table, row, "TCP/IP Checksum", "");\r\nadd_string_to_grid(table, row, "Offload not supported", "-");\r\n}\r\nif (IpSecSupported == 0) {\r\nadd_string_to_grid(table, row, "IpSec", "");\r\nadd_string_to_grid(table, row, "Offload not supported", "-");\r\n}\r\nif (TcpLargeSendSupported == 0) {\r\nadd_string_to_grid(table, row, "TCP Large Send", "");\r\nadd_string_to_grid(table, row, "Offload not supported", "-");\r\n}\r\nreturn entries;\r\n}\r\nstatic int\r\ncapture_if_details_general(GtkWidget *grid, GtkWidget *main_vb, guint *row, LPADAPTER adapter, gchar *iface) {\r\ngchar *interface_friendly_name;\r\ngchar string_buff[DETAILS_STR_MAX];\r\nconst gchar *manuf_name;\r\nunsigned int uint_value;\r\nunsigned int uint_array[50];\r\nint uint_array_size;\r\nunsigned int physical_medium;\r\nint i;\r\nunsigned char values[100];\r\nguint16 wvalues[100];\r\nchar *utf8value;\r\nint length;\r\nunsigned short ushort_value;\r\nint entries = 0;\r\ngchar *size_str, *tmp_str;\r\nadd_string_to_grid(grid, row, "Characteristics", "");\r\ninterface_friendly_name = get_windows_interface_friendly_name( iface);\r\nif (interface_friendly_name != NULL){\r\nadd_string_to_grid(grid, row, "OS Friendly name", interface_friendly_name);\r\ng_free(interface_friendly_name);\r\n}\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_GEN_VENDOR_DESCRIPTION, FALSE , values, &length)) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%s", values);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Vendor description", string_buff);\r\nlength = sizeof(wvalues);\r\nif (wpcap_packet_request(adapter, OID_GEN_FRIENDLY_NAME, FALSE , (char *)wvalues, &length)) {\r\nutf8value = g_utf16_to_utf8(wvalues, -1, NULL, NULL, NULL);\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%s", utf8value);\r\ng_free(utf8value);\r\nentries++;\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "NDIS Friendly name", string_buff);\r\nadd_string_to_grid(grid, row, "Interface", iface);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MEDIA_CONNECT_STATUS, &uint_value)) {\r\nentries++;\r\nif (uint_value == 0) {\r\nadd_string_to_grid(grid, row, "Link status", "Connected");\r\n} else {\r\nadd_string_to_grid(grid, row, "Link status", "Disconnected");\r\n}\r\n} else {\r\nadd_string_to_grid(grid, row, "Link status", "-");\r\n}\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_LINK_SPEED, &uint_value)) {\r\nentries++;\r\nuint_value *= 100;\r\nsize_str = format_size(uint_value, format_size_unit_bits_s|format_size_prefix_si);\r\ng_strlcpy(string_buff, size_str, DETAILS_STR_MAX);\r\ng_free(size_str);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Link speed", string_buff);\r\nuint_array_size = sizeof(uint_array);\r\nif (wpcap_packet_request(adapter, OID_GEN_MEDIA_SUPPORTED, FALSE , (char *) uint_array, &uint_array_size)) {\r\nentries++;\r\nuint_array_size /= sizeof(unsigned int);\r\ni = 0;\r\nwhile (uint_array_size--) {\r\ntmp_str = val_to_str_wmem(NULL, uint_array[i], win32_802_3_medium_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Media supported", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\ni++;\r\n}\r\n} else {\r\nadd_string_to_grid(grid, row, "Media supported", "-");\r\n}\r\nuint_array_size = sizeof(uint_array);\r\nif (wpcap_packet_request(adapter, OID_GEN_MEDIA_IN_USE, FALSE , (char *) uint_array, &uint_array_size)) {\r\nentries++;\r\nuint_array_size /= sizeof(unsigned int);\r\ni = 0;\r\nwhile (uint_array_size--) {\r\ntmp_str = val_to_str_wmem(NULL, uint_array[i], win32_802_3_medium_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Media in use", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\ni++;\r\n}\r\n} else {\r\nadd_string_to_grid(grid, row, "Media in use", "-");\r\n}\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_PHYSICAL_MEDIUM, &physical_medium)) {\r\nentries++;\r\ntmp_str = val_to_str_wmem(NULL, physical_medium, win32_802_3_physical_medium_vals, "(0x%x)");\r\nadd_string_to_grid(grid, row, "Physical medium", tmp_str);\r\nwmem_free(NULL, tmp_str);\r\n} else {\r\nadd_string_to_grid(grid, row, "Physical medium", "-");\r\n}\r\nlength = sizeof(ushort_value);\r\nif (wpcap_packet_request(adapter, OID_GEN_DRIVER_VERSION, FALSE , (char *) &ushort_value, &length)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u.%u", ushort_value / 0x100, ushort_value % 0x100);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "NDIS Driver Version", string_buff);\r\nlength = sizeof(uint_value);\r\nif (wpcap_packet_request(adapter, OID_GEN_VENDOR_DRIVER_VERSION, FALSE , (char *) &uint_value, &length)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u.%u (Hex: %X.%X)",\r\n(uint_value / 0x10000 ) % 0x10000,\r\nuint_value % 0x10000,\r\n(uint_value / 0x10000 ) % 0x10000,\r\nuint_value % 0x10000);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Vendor Driver Version", string_buff);\r\nlength = sizeof(values);\r\nif (wpcap_packet_request(adapter, OID_GEN_VENDOR_ID, FALSE , values, &length)) {\r\nentries++;\r\nmanuf_name = get_manuf_name_if_known(values);\r\nif (manuf_name != NULL) {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X (%s) NIC: %02X",\r\nvalues[0], values[1], values[2], manuf_name, values[3]);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%02X:%02X:%02X NIC: %02X",\r\nvalues[0], values[1], values[2], values[3]);\r\n}\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Vendor ID", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MAC_OPTIONS, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX,\r\n"802.1P Priority: %s, 802.1Q VLAN: %s",\r\n(uint_value & NDIS_MAC_OPTION_8021P_PRIORITY) ? "Supported" : "Unsupported",\r\n(uint_value & NDIS_MAC_OPTION_8021Q_VLAN) ? "Supported" : "Unsupported" );\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "MAC Options", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_VLAN_ID, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%u", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "VLAN ID", string_buff);\r\n#if 0\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_CURRENT_PACKET_FILTER, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Packet filter", string_buff);\r\n#endif\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_TRANSMIT_BUFFER_SPACE, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Transmit Buffer Space", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RECEIVE_BUFFER_SPACE, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Receive Buffer Space", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_TRANSMIT_BLOCK_SIZE , &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Transmit Block Size", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RECEIVE_BLOCK_SIZE, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Receive Block Size", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MAXIMUM_TOTAL_SIZE, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(grid, row, "Maximum Packet Size", string_buff);\r\nreturn entries;\r\n}\r\nstatic int\r\ncapture_if_details_stats(GtkWidget *table, GtkWidget *main_vb, guint *row, LPADAPTER adapter) {\r\ngchar string_buff[DETAILS_STR_MAX];\r\nunsigned int uint_value;\r\nint entries = 0;\r\nadd_string_to_grid(table, row, "Statistics", "");\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_XMIT_OK, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Transmit OK", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_XMIT_ERROR, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Transmit Error", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RCV_OK, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Receive OK", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RCV_ERROR, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Receive Error", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RCV_NO_BUFFER, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Receive but no Buffer", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_DIRECTED_BYTES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Directed bytes transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_DIRECTED_FRAMES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Directed packets transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MULTICAST_BYTES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Multicast bytes transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MULTICAST_FRAMES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Multicast packets transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_BROADCAST_BYTES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Broadcast bytes transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_BROADCAST_FRAMES_XMIT, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Broadcast packets transmitted w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_DIRECTED_BYTES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Directed bytes received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_DIRECTED_FRAMES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Directed packets received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MULTICAST_BYTES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Multicast bytes received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_MULTICAST_FRAMES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Multicast packets received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_BROADCAST_BYTES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Broadcast bytes received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_BROADCAST_FRAMES_RCV, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Broadcast packets received w/o errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_RCV_CRC_ERROR, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Packets received with CRC or FCS errors", string_buff);\r\nif (wpcap_packet_request_uint(adapter, OID_GEN_TRANSMIT_QUEUE_LENGTH, &uint_value)) {\r\nentries++;\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "%d", uint_value);\r\n} else {\r\ng_snprintf(string_buff, DETAILS_STR_MAX, "-");\r\n}\r\nadd_string_to_grid(table, row, "Packets queued for transmission", string_buff);\r\nreturn entries;\r\n}\r\nstatic GtkWidget *\r\ncapture_if_details_page_new(GtkWidget **grid)\r\n{\r\nGtkWidget *main_vb;\r\nmain_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 6, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(main_vb), 12);\r\n*grid = ws_gtk_grid_new();\r\nws_gtk_grid_set_column_spacing(GTK_GRID(*grid), 6);\r\nws_gtk_grid_set_row_spacing(GTK_GRID(*grid), 3);\r\ngtk_box_pack_start(GTK_BOX (main_vb), *grid, TRUE, TRUE, 0);\r\nreturn main_vb;\r\n}\r\nstatic void\r\ncapture_if_details_open_win(char *iface)\r\n{\r\nGtkWidget *details_open_w,\r\n*main_vb, *bbox, *close_bt, *help_bt;\r\nGtkWidget *page_general, *page_stats, *page_802_3, *page_802_11, *page_task_offload;\r\nGtkWidget *page_lb;\r\nGtkWidget *grid, *notebook, *label;\r\nguint row;\r\nLPADAPTER adapter;\r\nint entries;\r\nadapter = wpcap_packet_open(iface);\r\nif (adapter == NULL) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"%sCould not open adapter %s!%s"\r\n"\n\nHas it been unplugged?",\r\nsimple_dialog_primary_start(), iface, simple_dialog_primary_end());\r\nreturn;\r\n}\r\ndetails_open_w = dlg_window_new("Wireshark: Interface Details");\r\ngtk_window_set_destroy_with_parent (GTK_WINDOW(details_open_w), TRUE);\r\nmain_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 12, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(main_vb), 12);\r\ngtk_container_add(GTK_CONTAINER(details_open_w), main_vb);\r\nnotebook = gtk_notebook_new();\r\ngtk_box_pack_start(GTK_BOX(main_vb), notebook, TRUE , TRUE , 0 );\r\npage_general = capture_if_details_page_new(&grid);\r\npage_lb = gtk_label_new("Characteristics");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page_general, page_lb);\r\nrow = 0;\r\nentries = capture_if_details_general(grid, page_general, &row, adapter, iface);\r\nif (entries == 0) {\r\ngtk_widget_set_sensitive(page_lb, FALSE);\r\n}\r\npage_stats = capture_if_details_page_new(&grid);\r\npage_lb = gtk_label_new("Statistics");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page_stats, page_lb);\r\nrow = 0;\r\nentries = capture_if_details_stats(grid, page_stats, &row, adapter);\r\nif (entries == 0) {\r\ngtk_widget_set_sensitive(page_lb, FALSE);\r\n}\r\npage_802_3 = capture_if_details_page_new(&grid);\r\npage_lb = gtk_label_new("802.3 (Ethernet)");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page_802_3, page_lb);\r\nrow = 0;\r\nentries = capture_if_details_802_3(grid, page_802_3, &row, adapter);\r\nif (entries == 0) {\r\ngtk_widget_set_sensitive(page_lb, FALSE);\r\n}\r\npage_802_11 = capture_if_details_page_new(&grid);\r\npage_lb = gtk_label_new("802.11 (WLAN)");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page_802_11, page_lb);\r\nrow = 0;\r\nentries = capture_if_details_802_11(grid, page_802_11, &row, adapter);\r\nif (entries == 0) {\r\ngtk_widget_set_sensitive(page_lb, FALSE);\r\n}\r\npage_task_offload = capture_if_details_page_new(&grid);\r\npage_lb = gtk_label_new("Task Offload");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page_task_offload, page_lb);\r\nrow = 0;\r\nentries = capture_if_details_task_offload(grid, page_task_offload, &row, adapter);\r\nif (entries == 0) {\r\ngtk_widget_set_sensitive(page_lb, FALSE);\r\n}\r\nwpcap_packet_close(adapter);\r\nlabel = gtk_label_new("Some drivers may not provide accurate values.");\r\ngtk_box_pack_start(GTK_BOX(main_vb), label, FALSE , FALSE , 0 );\r\nbbox = dlg_button_row_new(GTK_STOCK_CLOSE, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_start(GTK_BOX(main_vb), bbox, FALSE , FALSE , 0 );\r\nclose_bt = g_object_get_data(G_OBJECT(bbox), GTK_STOCK_CLOSE);\r\nwindow_set_cancel_button(details_open_w, close_bt, window_cancel_button_cb);\r\nhelp_bt = g_object_get_data(G_OBJECT(bbox), GTK_STOCK_HELP);\r\ng_signal_connect(help_bt, "clicked", G_CALLBACK(topic_cb), (gpointer) (HELP_CAPTURE_INTERFACES_DETAILS_DIALOG));\r\ngtk_widget_grab_focus(close_bt);\r\ng_signal_connect(details_open_w, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ngtk_widget_show_all(details_open_w);\r\nwindow_present(details_open_w);\r\n}\r\nstatic void\r\ncapture_if_details_open_answered_cb(gpointer dialog _U_, gint btn, gpointer data)\r\n{\r\nswitch (btn) {\r\ncase(ESD_BTN_OK):\r\ncapture_if_details_open_win(data);\r\nbreak;\r\ncase(ESD_BTN_CANCEL):\r\nbreak;\r\ndefault:\r\ng_assert_not_reached();\r\n}\r\n}\r\nvoid\r\ncapture_if_details_open(char *iface)\r\n{\r\nchar *version;\r\nversion = wpcap_packet_get_version();\r\nif (version == NULL) {\r\nsimple_dialog(ESD_TYPE_WARN, ESD_BTN_OK,\r\n"%sCouldn't obtain WinPcap packet.dll version.%s"\r\n"\n\nThe WinPcap packet.dll is not installed or the version you use seems to be very old."\r\n"\n\nPlease update or install WinPcap.",\r\nsimple_dialog_primary_start(), simple_dialog_primary_end());\r\nreturn;\r\n}\r\ncapture_if_details_open_win(iface);\r\n}\r\ngboolean\r\ncapture_if_has_details(char *iface) {\r\nLPADAPTER adapter;\r\nif (!iface) {\r\nreturn FALSE;\r\n}\r\nadapter = wpcap_packet_open(iface);\r\nif (adapter) {\r\nwpcap_packet_close(adapter);\r\nreturn TRUE;\r\n}\r\nreturn FALSE;\r\n}
