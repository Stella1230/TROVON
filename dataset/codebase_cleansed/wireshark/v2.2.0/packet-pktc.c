static int\r\ndissect_pktc_app_specific_data(packet_info *pinfo, proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 doi, guint8 kmmid)\r\n{\r\nint old_offset=offset;\r\nproto_tree *tree;\r\nproto_tree *engineid_tree = NULL;\r\nproto_item *item;\r\nproto_item *engineid_item = NULL;\r\nguint8 len;\r\nitem = proto_tree_add_item(parent_tree, hf_pktc_app_spec_data, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_pktc_app_spec_data);\r\nswitch(doi){\r\ncase DOI_SNMPv3:\r\nswitch(kmmid){\r\ncase KMMID_AP_REQUEST:\r\ncase KMMID_AP_REPLY:\r\nlen=tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_snmpEngineID_len, tvb, offset, 1, len);\r\noffset+=1;\r\nengineid_item = proto_tree_add_item(tree, hf_pktc_snmpEngineID, tvb, offset, len, ENC_NA);\r\nengineid_tree = proto_item_add_subtree(engineid_item, ett_pktc_engineid);\r\ndissect_snmp_engineid(engineid_tree, pinfo, tvb, offset, len);\r\noffset+=len;\r\nproto_tree_add_item(tree, hf_pktc_snmpEngineBoots, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(tree, hf_pktc_snmpEngineTime, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nlen=tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_usmUserName_len, tvb, offset, 1, len);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_usmUserName, tvb, offset, len, ENC_ASCII|ENC_NA);\r\noffset+=len;\r\nbreak;\r\ndefault:\r\nproto_tree_add_expert(tree, pinfo, &ei_pktc_unknown_kmmid, tvb, offset, 1);\r\n};\r\nbreak;\r\ncase DOI_IPSEC:\r\nswitch(kmmid){\r\ncase KMMID_AP_REQUEST:\r\ncase KMMID_AP_REPLY:\r\ncase KMMID_REKEY:\r\nproto_tree_add_item(tree, hf_pktc_ipsec_spi, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nbreak;\r\ndefault:\r\nproto_tree_add_expert(tree, pinfo, &ei_pktc_unknown_kmmid, tvb, offset, 1);\r\n};\r\nbreak;\r\ndefault:\r\nproto_tree_add_expert(tree, pinfo, &ei_pktc_unknown_doi, tvb, offset, 1);\r\n}\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_list_of_ciphersuites(packet_info *pinfo _U_, proto_tree *parent_tree, tvbuff_t *tvb, int offset, guint8 doi)\r\n{\r\nint old_offset=offset;\r\nproto_tree *tree;\r\nproto_item *item, *hidden_item;\r\nguint8 len, i;\r\nitem = proto_tree_add_item(parent_tree, hf_pktc_list_of_ciphersuites, tvb, offset, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_pktc_list_of_ciphersuites);\r\nlen=tvb_get_guint8(tvb, offset);\r\nif (len>0) {\r\nproto_item_append_text(tree, " (%d):", len);\r\n}\r\nhidden_item = proto_tree_add_uint(tree, hf_pktc_list_of_ciphersuites_len, tvb, offset, 1, len);\r\nPROTO_ITEM_SET_HIDDEN(hidden_item);\r\noffset+=1;\r\nswitch(doi){\r\ncase DOI_SNMPv3:\r\nfor(i=0;i<len;i++){\r\nproto_tree_add_item(tree, hf_pktc_snmpAuthenticationAlgorithm, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tree, " %s", val_to_str(tvb_get_guint8(tvb, offset), snmp_authentication_algorithm_vals, "%0x"));\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_snmpEncryptionTransformID, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tree, "/%s", val_to_str(tvb_get_guint8(tvb, offset), snmp_transform_id_vals, "%0x"));\r\noffset+=1;\r\n}\r\nbreak;\r\ncase DOI_IPSEC:\r\nfor(i=0;i<len;i++){\r\nproto_tree_add_item(tree, hf_pktc_ipsecAuthenticationAlgorithm, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tree, " %s", val_to_str(tvb_get_guint8(tvb, offset), ipsec_authentication_algorithm_vals, "%0x"));\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_ipsecEncryptionTransformID, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_item_append_text(tree, "/%s", val_to_str(tvb_get_guint8(tvb, offset), ipsec_transform_id_vals, "%0x"));\r\noffset+=1;\r\n}\r\nbreak;\r\ndefault:\r\nproto_tree_add_expert(tree, pinfo, &ei_pktc_unknown_doi, tvb, offset, 1);\r\n}\r\nproto_item_set_len(item, offset-old_offset);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_wakeup(proto_tree *tree, tvbuff_t *tvb, int offset)\r\n{\r\nguint32 snonce;\r\nguint string_len;\r\nsnonce=tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_server_nonce, tvb, offset, 4, snonce);\r\noffset+=4;\r\nstring_len=tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_pktc_server_principal, tvb, offset, string_len, ENC_ASCII|ENC_NA);\r\noffset+=string_len;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_ap_request(packet_info *pinfo, proto_tree *tree, tvbuff_t *tvb, int offset, guint8 doi)\r\n{\r\ntvbuff_t *pktc_tvb;\r\nguint32 snonce;\r\npktc_tvb = tvb_new_subset_remaining(tvb, offset);\r\noffset += dissect_kerberos_main(pktc_tvb, pinfo, tree, FALSE, NULL);\r\nsnonce=tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_server_nonce, tvb, offset, 4, snonce);\r\noffset+=4;\r\noffset=dissect_pktc_app_specific_data(pinfo, tree, tvb, offset, doi, KMMID_AP_REQUEST);\r\noffset=dissect_pktc_list_of_ciphersuites(pinfo, tree, tvb, offset, doi);\r\nproto_tree_add_item(tree, hf_pktc_reestablish_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_sha1_hmac, tvb, offset, 20, ENC_NA);\r\noffset+=20;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_ap_reply(packet_info *pinfo, proto_tree *tree, tvbuff_t *tvb, int offset, guint8 doi)\r\n{\r\ntvbuff_t *pktc_tvb;\r\npktc_tvb = tvb_new_subset_remaining(tvb, offset);\r\noffset += dissect_kerberos_main(pktc_tvb, pinfo, tree, FALSE, NULL);\r\noffset=dissect_pktc_app_specific_data(pinfo, tree, tvb, offset, doi, KMMID_AP_REPLY);\r\noffset=dissect_pktc_list_of_ciphersuites(pinfo, tree, tvb, offset, doi);\r\nproto_tree_add_uint_format(tree, hf_pktc_sec_param_lifetime, tvb, offset, 4,\r\ntvb_get_ntohl(tvb, offset), "%s: %s",\r\nproto_registrar_get_name(hf_pktc_sec_param_lifetime),\r\nsigned_time_secs_to_str(wmem_packet_scope(), tvb_get_ntohl(tvb, offset)));\r\noffset+=4;\r\nproto_tree_add_item(tree, hf_pktc_grace_period, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(tree, hf_pktc_reestablish_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_ack_required_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_sha1_hmac, tvb, offset, 20, ENC_NA);\r\noffset+=20;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_sec_param_rec(proto_tree *tree, tvbuff_t *tvb, int offset)\r\n{\r\nproto_tree_add_item(tree, hf_pktc_sha1_hmac, tvb, offset, 20, ENC_NA);\r\noffset+=20;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_rekey(packet_info *pinfo, proto_tree *tree, tvbuff_t *tvb, int offset, guint8 doi)\r\n{\r\nguint32 snonce;\r\nguint string_len;\r\nconst guint8 *timestr;\r\nsnonce=tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_server_nonce, tvb, offset, 4, snonce);\r\noffset+=4;\r\nstring_len=tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_pktc_server_principal, tvb, offset, string_len, ENC_ASCII|ENC_NA);\r\noffset+=string_len;\r\ntimestr=tvb_get_string_enc(wmem_packet_scope(), tvb, offset, 13, ENC_ASCII);\r\nproto_tree_add_string_format_value(tree, hf_pktc_timestamp, tvb, offset, 13, timestr,\r\n"%.2s-%.2s-%.2s %.2s:%.2s:%.2s",\r\ntimestr, timestr+2, timestr+4, timestr+6, timestr+8, timestr+10);\r\noffset+=13;\r\noffset=dissect_pktc_app_specific_data(pinfo, tree, tvb, offset, doi, KMMID_REKEY);\r\noffset=dissect_pktc_list_of_ciphersuites(pinfo, tree, tvb, offset, doi);\r\nproto_tree_add_item(tree, hf_pktc_sec_param_lifetime, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(tree, hf_pktc_grace_period, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(tree, hf_pktc_reestablish_flag, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item(tree, hf_pktc_sha1_hmac, tvb, offset, 20, ENC_NA);\r\noffset+=20;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_error_reply(packet_info *pinfo, proto_tree *tree, tvbuff_t *tvb, int offset)\r\n{\r\ntvbuff_t *pktc_tvb;\r\npktc_tvb = tvb_new_subset_remaining(tvb, offset);\r\noffset += dissect_kerberos_main(pktc_tvb, pinfo, tree, FALSE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_mtafqdn_krbsafeuserdata(packet_info *pinfo, tvbuff_t *tvb, proto_tree *tree)\r\n{\r\nint offset=0, string_len=0;\r\nguint8 msgtype;\r\nguint32 bignum;\r\nnstime_t ts;\r\nmsgtype = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_pktc_mtafqdn_msgtype, tvb, offset, 1, msgtype);\r\noffset+=1;\r\ncol_add_str(pinfo->cinfo, COL_INFO,\r\nval_to_str(msgtype, pktc_mtafqdn_msgtype_vals, "MsgType %u"));\r\nproto_tree_add_uint(tree, hf_pktc_mtafqdn_enterprise, tvb, offset, 4, tvb_get_ntohl(tvb, offset));\r\noffset+=4;\r\nproto_tree_add_uint(tree, hf_pktc_mtafqdn_version, tvb, offset, 1, tvb_get_guint8(tvb, offset));\r\noffset+=1;\r\nswitch(msgtype) {\r\ncase PKTC_MTAFQDN_REQ:\r\nproto_tree_add_item(tree, hf_pktc_mtafqdn_mac, tvb, offset, 6, ENC_NA);\r\noffset+=6;\r\nproto_tree_add_item(tree, hf_pktc_mtafqdn_pub_key_hash, tvb, offset, 20, ENC_NA);\r\noffset+=20;\r\nbignum = tvb_get_ntohl(tvb, offset);\r\nts.secs = bignum;\r\nif (bignum==0) {\r\nproto_tree_add_time_format_value(tree, hf_pktc_mtafqdn_manu_cert_revoked, tvb, offset, 4,\r\n&ts, "not revoked");\r\n} else {\r\nproto_tree_add_time(tree, hf_pktc_mtafqdn_manu_cert_revoked, tvb, offset, 4, &ts);\r\n}\r\nbreak;\r\ncase PKTC_MTAFQDN_REP:\r\nstring_len = tvb_reported_length_remaining(tvb, offset) - 4;\r\nproto_tree_add_item(tree, hf_pktc_mtafqdn_fqdn, tvb, offset, string_len, ENC_ASCII|ENC_NA);\r\noffset+=string_len;\r\ntvb_memcpy(tvb, (guint8 *)&bignum, offset, sizeof(bignum));\r\nproto_tree_add_ipv4(tree, hf_pktc_mtafqdn_ip, tvb, offset, 4, bignum);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_pktc_mtafqdn(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset=0;\r\nproto_tree *pktc_mtafqdn_tree;\r\nproto_item *item;\r\ntvbuff_t *pktc_mtafqdn_tvb;\r\ngint8 ber_class;\r\ngboolean pc;\r\ngint32 tag;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PKTC");\r\nitem = proto_tree_add_item(tree, proto_pktc, tvb, 0, 0, ENC_NA);\r\npktc_mtafqdn_tree = proto_item_add_subtree(item, ett_pktc_mtafqdn);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "MTA FQDN %s",\r\npinfo->srcport == pinfo->match_uint ? "Reply":"Request");\r\npktc_mtafqdn_tvb = tvb_new_subset_remaining(tvb, offset);\r\nget_ber_identifier(pktc_mtafqdn_tvb, 0, &ber_class, &pc, &tag);\r\nif ((tag == KERBEROS_APPLICATIONS_AP_REQ) || (tag == KERBEROS_APPLICATIONS_AP_REP)) {\r\noffset += dissect_kerberos_main(pktc_mtafqdn_tvb, pinfo, pktc_mtafqdn_tree, FALSE, NULL);\r\n} else {\r\nexpert_add_info_format(pinfo, item, &ei_pktc_unknown_kerberos_application, "Unknown Kerberos application (%d), expected 10 or 11", tag);\r\nreturn tvb_captured_length(tvb);\r\n}\r\npktc_mtafqdn_tvb = tvb_new_subset_remaining(tvb, offset);\r\nget_ber_identifier(pktc_mtafqdn_tvb, 0, &ber_class, &pc, &tag);\r\nif (tag == KERBEROS_APPLICATIONS_KRB_SAFE) {\r\noffset += dissect_kerberos_main(pktc_mtafqdn_tvb, pinfo, pktc_mtafqdn_tree, FALSE, cb);\r\n} else {\r\nexpert_add_info_format(pinfo, item, &ei_pktc_unknown_kerberos_application, "Unknown Kerberos application (%d), expected 20", tag);\r\n}\r\nproto_item_set_len(item, offset);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_pktc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint8 kmmid, doi, version;\r\nint offset=0;\r\nproto_tree *pktc_tree, *version_tree;\r\nproto_item *item;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PKTC");\r\nitem = proto_tree_add_item(tree, proto_pktc, tvb, 0, 3, ENC_NA);\r\npktc_tree = proto_item_add_subtree(item, ett_pktc);\r\nkmmid=tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(pktc_tree, hf_pktc_kmmid, tvb, offset, 1, kmmid);\r\noffset+=1;\r\ndoi=tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(pktc_tree, hf_pktc_doi, tvb, offset, 1, doi);\r\noffset+=1;\r\nversion=tvb_get_guint8(tvb, offset);\r\nversion_tree = proto_tree_add_subtree_format(pktc_tree, tvb, offset, 1, ett_pktc_version, NULL,\r\n"Version: %d.%d", (version>>4)&0x0f, (version)&0x0f);\r\nproto_tree_add_item(version_tree, hf_pktc_version_major, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(version_tree, hf_pktc_version_minor, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset+=1;\r\ncol_add_str(pinfo->cinfo, COL_INFO,\r\nval_to_str(kmmid, kmmid_types, "Unknown KMMID %#x"));\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " (%s)",\r\nval_to_str(doi, doi_types, "Unknown DOI %#x"));\r\nswitch(kmmid){\r\ncase KMMID_WAKEUP:\r\noffset=dissect_pktc_wakeup(pktc_tree, tvb, offset);\r\nbreak;\r\ncase KMMID_AP_REQUEST:\r\noffset=dissect_pktc_ap_request(pinfo, pktc_tree, tvb, offset, doi);\r\nbreak;\r\ncase KMMID_AP_REPLY:\r\noffset=dissect_pktc_ap_reply(pinfo, pktc_tree, tvb, offset, doi);\r\nbreak;\r\ncase KMMID_SEC_PARAM_REC:\r\noffset=dissect_pktc_sec_param_rec(pktc_tree, tvb, offset);\r\nbreak;\r\ncase KMMID_REKEY:\r\noffset=dissect_pktc_rekey(pinfo, pktc_tree, tvb, offset, doi);\r\nbreak;\r\ncase KMMID_ERROR_REPLY:\r\noffset=dissect_pktc_error_reply(pinfo, pktc_tree, tvb, offset);\r\nbreak;\r\n};\r\nproto_item_set_len(item, offset);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_pktc(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_pktc_kmmid, {\r\n"Key Management Message ID", "pktc.kmmid", FT_UINT8, BASE_HEX,\r\nVALS(kmmid_types), 0, NULL, HFILL }},\r\n{ &hf_pktc_doi, {\r\n"Domain of Interpretation", "pktc.doi", FT_UINT8, BASE_DEC,\r\nVALS(doi_types), 0, NULL, HFILL }},\r\n{ &hf_pktc_version_major, {\r\n"Major version", "pktc.version.major", FT_UINT8, BASE_DEC,\r\nNULL, 0xF0, "Major version of PKTC", HFILL }},\r\n{ &hf_pktc_version_minor, {\r\n"Minor version", "pktc.version.minor", FT_UINT8, BASE_DEC,\r\nNULL, 0x0F, "Minor version of PKTC", HFILL }},\r\n{ &hf_pktc_server_nonce, {\r\n"Server Nonce", "pktc.server_nonce", FT_UINT32, BASE_HEX,\r\nNULL, 0, "Server Nonce random number", HFILL }},\r\n{ &hf_pktc_server_principal, {\r\n"Server Kerberos Principal Identifier", "pktc.server_principal", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_timestamp, {\r\n"Timestamp", "pktc.timestamp", FT_STRING, STR_UNICODE,\r\nNULL, 0, "Timestamp (UTC)", HFILL }},\r\n{ &hf_pktc_app_spec_data, {\r\n"Application Specific Data", "pktc.asd", FT_NONE, BASE_NONE,\r\nNULL, 0, "KMMID/DOI application specific data", HFILL }},\r\n{ &hf_pktc_list_of_ciphersuites, {\r\n"List of Ciphersuites", "pktc.ciphers", FT_NONE, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_list_of_ciphersuites_len, {\r\n"Number of Ciphersuites", "pktc.ciphers.len", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_snmpAuthenticationAlgorithm, {\r\n"SNMPv3 Authentication Algorithm", "pktc.asd.snmp_auth_alg", FT_UINT8, BASE_HEX,\r\nVALS(snmp_authentication_algorithm_vals), 0, NULL, HFILL }},\r\n{ &hf_pktc_snmpEncryptionTransformID, {\r\n"SNMPv3 Encryption Transform ID", "pktc.asd.snmp_enc_alg", FT_UINT8, BASE_HEX,\r\nVALS(snmp_transform_id_vals), 0, NULL, HFILL }},\r\n{ &hf_pktc_ipsecAuthenticationAlgorithm, {\r\n"IPsec Authentication Algorithm", "pktc.asd.ipsec_auth_alg", FT_UINT8, BASE_HEX,\r\nVALS(ipsec_authentication_algorithm_vals), 0, NULL, HFILL }},\r\n{ &hf_pktc_ipsecEncryptionTransformID, {\r\n"IPsec Encryption Transform ID", "pktc.asd.ipsec_enc_alg", FT_UINT8, BASE_HEX,\r\nVALS(ipsec_transform_id_vals), 0, NULL, HFILL }},\r\n{ &hf_pktc_snmpEngineID_len, {\r\n"SNMPv3 Engine ID Length", "pktc.asd.snmp_engine_id.len", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Length of SNMPv3 Engine ID", HFILL }},\r\n{ &hf_pktc_snmpEngineID, {\r\n"SNMPv3 Engine ID", "pktc.asd.snmp_engine_id", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_snmpEngineBoots, {\r\n"SNMPv3 Engine Boots", "pktc.asd.snmp_engine_boots", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_snmpEngineTime, {\r\n"SNMPv3 Engine Time", "pktc.asd.snmp_engine_time", FT_UINT32, BASE_DEC,\r\nNULL, 0, "SNMPv3 Engine ID Time", HFILL }},\r\n{ &hf_pktc_usmUserName_len, {\r\n"SNMPv3 USM User Name Length", "pktc.asd.snmp_usm_username.len", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Length of SNMPv3 USM User Name", HFILL }},\r\n{ &hf_pktc_usmUserName, {\r\n"SNMPv3 USM User Name", "pktc.asd.snmp_usm_username", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_ipsec_spi, {\r\n"IPsec Security Parameter Index", "pktc.asd.ipsec_spi", FT_UINT32, BASE_HEX,\r\nNULL, 0, "Security Parameter Index for inbound Security Association (IPsec)", HFILL }},\r\n{ &hf_pktc_reestablish_flag, {\r\n"Re-establish Flag", "pktc.reestablish", FT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_pktc_ack_required_flag, {\r\n"ACK Required Flag", "pktc.ack_required", FT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0, NULL, HFILL }},\r\n{ &hf_pktc_sec_param_lifetime, {\r\n"Security Parameter Lifetime", "pktc.spl", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Lifetime in seconds of security parameter", HFILL }},\r\n{ &hf_pktc_sha1_hmac, {\r\n"SHA-1 HMAC", "pktc.sha1_hmac", FT_BYTES, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_grace_period, {\r\n"Grace Period", "pktc.grace_period", FT_UINT32, BASE_DEC,\r\nNULL, 0, "Grace Period in seconds", HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pktc,\r\n&ett_pktc_app_spec_data,\r\n&ett_pktc_list_of_ciphersuites,\r\n&ett_pktc_engineid,\r\n&ett_pktc_version,\r\n};\r\nproto_pktc = proto_register_protocol("PacketCable", "PKTC", "pktc");\r\nproto_register_field_array(proto_pktc, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_pktc(void)\r\n{\r\ndissector_handle_t pktc_handle;\r\npktc_handle = create_dissector_handle(dissect_pktc, proto_pktc);\r\ndissector_add_uint("udp.port", PKTC_PORT, pktc_handle);\r\n}\r\nvoid\r\nproto_register_pktc_mtafqdn(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_pktc_mtafqdn_msgtype, {\r\n"Message Type", "pktc.mtafqdn.msgtype", FT_UINT8, BASE_DEC,\r\nVALS(pktc_mtafqdn_msgtype_vals), 0, "MTA FQDN Message Type", HFILL }},\r\n{ &hf_pktc_mtafqdn_enterprise, {\r\n"Enterprise Number", "pktc.mtafqdn.enterprise", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_mtafqdn_version, {\r\n"Protocol Version", "pktc.mtafqdn.version", FT_UINT8, BASE_DEC,\r\nNULL, 0, "MTA FQDN Protocol Version", HFILL }},\r\n{ &hf_pktc_mtafqdn_mac, {\r\n"MTA MAC address", "pktc.mtafqdn.mac", FT_ETHER, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_mtafqdn_pub_key_hash, {\r\n"MTA Public Key Hash", "pktc.mtafqdn.pub_key_hash", FT_BYTES, BASE_NONE,\r\nNULL, 0, "MTA Public Key Hash (SHA-1)", HFILL }},\r\n{ &hf_pktc_mtafqdn_manu_cert_revoked, {\r\n"Manufacturer Cert Revocation Time", "pktc.mtafqdn.manu_cert_revoked", FT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL,\r\nNULL, 0, "Manufacturer Cert Revocation Time (UTC) or 0 if not revoked", HFILL }},\r\n{ &hf_pktc_mtafqdn_fqdn, {\r\n"MTA FQDN", "pktc.mtafqdn.fqdn", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL }},\r\n{ &hf_pktc_mtafqdn_ip, {\r\n"MTA IP Address", "pktc.mtafqdn.ip", FT_IPv4, BASE_NONE,\r\nNULL, 0, "MTA IP Address (all zeros if not supplied)", HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pktc_mtafqdn,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_pktc_unknown_kmmid, { "pktc.mtafqdn.unknown_kmmid", PI_PROTOCOL, PI_WARN, "Unknown KMMID", EXPFILL }},\r\n{ &ei_pktc_unknown_doi, { "pktc.mtafqdn.unknown_doi", PI_PROTOCOL, PI_WARN, "Unknown DOI", EXPFILL }},\r\n{ &ei_pktc_unknown_kerberos_application, { "pktc.mtafqdn.unknown_kerberos_application", PI_PROTOCOL, PI_WARN, "Unknown Kerberos application", EXPFILL }},\r\n};\r\nexpert_module_t* expert_pktc;\r\nproto_pktc_mtafqdn = proto_register_protocol("PacketCable MTA FQDN", "PKTC MTA FQDN", "pktc.mtafqdn");\r\nproto_register_field_array(proto_pktc_mtafqdn, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_pktc = expert_register_protocol(proto_pktc_mtafqdn);\r\nexpert_register_field_array(expert_pktc, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_pktc_mtafqdn(void)\r\n{\r\ndissector_handle_t pktc_mtafqdn_handle;\r\npktc_mtafqdn_handle = create_dissector_handle(dissect_pktc_mtafqdn, proto_pktc_mtafqdn);\r\ndissector_add_uint("udp.port", PKTC_MTAFQDN_PORT, pktc_mtafqdn_handle);\r\n}
