static funnel_text_window_t *new_text_window(const gchar *title) {\r\nfunnel_text_window_t *tw = g_new(funnel_text_window_t, 1);\r\ntw->title = g_strdup(title);\r\ntw->text = g_string_new("");\r\nif (!text_windows)\r\ntext_windows = g_ptr_array_new();\r\ng_ptr_array_add(text_windows, tw);\r\nreturn tw;\r\n}\r\nstatic void text_window_clear(funnel_text_window_t *tw) {\r\ng_string_free(tw->text, TRUE);\r\ntw->text = g_string_new("");\r\n}\r\nstatic void text_window_append(funnel_text_window_t *tw, const char *text ) {\r\ng_string_append(tw->text, text);\r\n}\r\nstatic void text_window_set_text(funnel_text_window_t *tw, const char *text) {\r\ng_string_free(tw->text, TRUE);\r\ntw->text = g_string_new(text);\r\n}\r\nstatic void text_window_prepend(funnel_text_window_t *tw, const char *text) {\r\ng_string_prepend(tw->text, text);\r\n}\r\nstatic const gchar *text_window_get_text(funnel_text_window_t *tw) {\r\nreturn tw->text->str;\r\n}\r\nstatic void funnel_logger(const gchar *log_domain _U_,\r\nGLogLevelFlags log_level _U_,\r\nconst gchar *message,\r\ngpointer user_data _U_) {\r\nfputs(message, stderr);\r\n}\r\nvoid initialize_funnel_ops(void) {\r\nfunnel_set_funnel_ops(&funnel_ops);\r\n}\r\nvoid funnel_dump_all_text_windows(void) {\r\nguint i;\r\nif (!text_windows) return;\r\nfor ( i = 0 ; i < text_windows->len; i++) {\r\nfunnel_text_window_t *tw = (funnel_text_window_t *)g_ptr_array_index(text_windows, i);\r\nprintf("\n========================== %s "\r\n"==========================\n%s\n", tw->title, tw->text->str);\r\ng_ptr_array_remove_index(text_windows, i);\r\ng_free(tw->title);\r\ng_string_free(tw->text, TRUE);\r\ng_free(tw);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_funnel(void)\r\n{\r\n#if 0\r\nfunnel_register_all_menus(register_menu_cb);\r\n#endif\r\n}
