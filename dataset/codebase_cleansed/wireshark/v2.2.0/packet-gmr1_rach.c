static void\r\ndissect_gmr1_rach_kls1(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *root_tree,\r\nint *is_moc, int *is_pdt)\r\n{\r\nproto_tree *tree = NULL;\r\nproto_item *ec_item = NULL;\r\nproto_tree *ec_tree = NULL;\r\nguint8 ec;\r\ntree = proto_tree_add_subtree(\r\nroot_tree, tvb, 0, 2,\r\nett_rach_kls1, NULL, "Class-1 informations");\r\nproto_tree_add_item(tree, hf_rach_prio,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nec = (tvb_get_guint8(tvb, offset) >> 1) & 0x1f;\r\n*is_moc = !!(ec & 0x10);\r\n*is_pdt = (ec == 14);\r\nif (ec & 0x10)\r\n{\r\nec_item = proto_tree_add_item(tree, hf_rach_est_cause_moc,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nec_tree = proto_item_add_subtree(ec_item, ett_rach_est_cause);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Mobile Originated Call ");\r\nproto_tree_add_item(ec_tree, hf_rach_num_plan,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\nelse if ((ec & 0x1c) == 0x00)\r\n{\r\nec_item = proto_tree_add_item(tree, hf_rach_est_cause_pag_resp,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nec_tree = proto_item_add_subtree(ec_item, ett_rach_est_cause);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Paging response ");\r\nproto_tree_add_item(ec_tree, hf_rach_chan_needed,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\nelse if (ec == 7)\r\n{\r\nproto_tree_add_item(tree, hf_rach_est_cause,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nproto_tree_add_item(tree, hf_rach_est_cause,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s",\r\nval_to_str(ec, rach_est_cause_vals, "Unknown (%u)"));\r\n}\r\nproto_tree_add_item(tree, hf_rach_retry_cnt,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_precorr,\r\ntvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_rand_ref,\r\ntvb, offset + 1, 1, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\nrach_gps_pos_lat_fmt(gchar *s, guint32 v)\r\n{\r\ngint32 sv = v;\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%.5f %s (%d)",\r\nabs(sv) / 2912.7f, sv < 0 ? "S" : "N", sv);\r\n}\r\nstatic void\r\nrach_gps_pos_long_fmt(gchar *s, guint32 v)\r\n{\r\ngint32 sv = v;\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%.5f %s (%d)",\r\nabs(sv) / 2912.70555f, sv < 0 ? "W" : "E", sv);\r\n}\r\nstatic void\r\ndissect_gmr1_rach_gps_pos(tvbuff_t *tvb, int offset, packet_info *pinfo _U_, proto_tree *tree)\r\n{\r\nguint32 lat, lng;\r\nlat = (tvb_get_ntohl(tvb, offset) >> 12) & 0x7ffff;\r\nlng = tvb_get_ntohl(tvb, offset + 1) & 0xfffff;\r\nif (lat == 0x40000) {\r\nproto_tree_add_int_format(tree, hf_rach_gps_pos_lat, tvb, offset, 5, lat,\r\n"NULL GPS Position (latitude == 0x40000)");\r\nreturn;\r\n} else if (lng == 0x80000) {\r\nproto_tree_add_int_format(tree, hf_rach_gps_pos_long, tvb, offset, 5, lng,\r\n"NULL GPS Position (longitude == 0x80000)");\r\nreturn;\r\n}\r\nproto_tree_add_item(tree, hf_rach_gps_pos_cpi,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gps_pos_lat,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gps_pos_long,\r\ntvb, offset + 2, 3, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\nrach_sp_hplmn_id_fmt(gchar *s, guint32 v)\r\n{\r\nif (v == 0xfffff) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%05x (Null)", v);\r\n} else if ((v & 0xf8000) == 0xf8000) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%05x (SP ID %4d)", v, v & 0x7fff);\r\n} else {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%05x (HPLMN ID)", v);\r\n}\r\n}\r\nstatic void\r\nrach_dialed_num_grp1234_fmt(gchar *s, guint32 v)\r\n{\r\nif (v <= 999) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%03d", v);\r\n} else if (v == 1023) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH,\r\n"All digits in the preceding group are valid (%d)", v);\r\n} else if (v == 1022) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH,\r\n"First two digits in the preceding group are valid, "\r\n"and the third digit (i.e. 0) is padding (%d)", v);\r\n} else if (v == 1021) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH,\r\n"First digit in the preceding group is valid, and "\r\n"the second and third 0s are padding (%d)", v);\r\n} else {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "Invalid (%d)", v);\r\n}\r\n}\r\nstatic void\r\nrach_dialed_num_grp5_fmt(gchar *s, guint32 v)\r\n{\r\nif (v >= 1100 && v <= 1199) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%02d (%d)", v - 1100, v);\r\n} else if (v >= 1200 && v <= 1209) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%01d (%d)", v - 1200, v);\r\n} else {\r\nrach_dialed_num_grp1234_fmt(s, v);\r\n}\r\n}\r\nstatic void\r\nrach_gps_timestamp_fmt(gchar *s, guint32 v)\r\n{\r\nif (v == 0xffff) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, ">= 65535 minutes or N/A (%04x)", v);\r\n} else {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d minutes (%04x)", v, v);\r\n}\r\n}\r\nstatic int\r\n_parse_dialed_number(gchar *s, int slen, tvbuff_t *tvb, int offset)\r\n{\r\nguint16 grp[5];\r\nint rv, i, done;\r\ngrp[0] = ((tvb_get_guint8(tvb, offset+0) & 0x3f) << 4) |\r\n((tvb_get_guint8(tvb, offset+1) & 0xf0) >> 4);\r\ngrp[1] = ((tvb_get_guint8(tvb, offset+1) & 0x0f) << 6) |\r\n((tvb_get_guint8(tvb, offset+2) & 0xfc) >> 2);\r\ngrp[2] = ((tvb_get_guint8(tvb, offset+2) & 0x03) << 8) |\r\ntvb_get_guint8(tvb, offset+3);\r\ngrp[3] = ((tvb_get_guint8(tvb, offset+4) & 0xff) << 2) |\r\n((tvb_get_guint8(tvb, offset+5) & 0xc0) >> 6);\r\ngrp[4] = ((tvb_get_guint8(tvb, offset+5) & 0x3f) << 5) |\r\n((tvb_get_guint8(tvb, offset+6) & 0xf8) >> 3);\r\nrv = 0;\r\ndone = 0;\r\nfor (i=0; i<4; i++)\r\n{\r\nif (grp[i+1] <= 999)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%03d", grp[i]);\r\n}\r\nelse if (grp[i+1] == 1023)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%03d", grp[i]);\r\ndone = 1;\r\nbreak;\r\n}\r\nelse if (grp[i+1] == 1022)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%02d", grp[i] / 10);\r\ndone = 1;\r\nbreak;\r\n}\r\nelse if (grp[i+1] == 1021)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%01d", grp[i] / 100);\r\ndone = 1;\r\nbreak;\r\n}\r\nelse if ((i==3) && (grp[i+1] >= 1100) && (grp[i+1] <= 1209))\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%03d", grp[i]);\r\n}\r\nelse\r\n{\r\nreturn g_snprintf(s, slen, "(Invalid)");\r\n}\r\n}\r\nif (!done) {\r\nif (grp[4] <= 999)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%03d", grp[4]);\r\n}\r\nelse if (grp[4] >= 1100 && grp[4] <= 1199)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%02d", grp[4] - 1100);\r\n}\r\nelse if (grp[4] >= 1200 && grp[4] <= 1209)\r\n{\r\nrv += g_snprintf(s + rv, slen - rv, "%01d", grp[4] - 1200);\r\n}\r\nelse\r\n{\r\nreturn g_snprintf(s, slen, "(Invalid)");\r\n}\r\n}\r\nreturn rv;\r\n}\r\nstatic void\r\ndissect_gmr1_rach_kls2(tvbuff_t *tvb, int offset, packet_info *pinfo, proto_tree *root_tree,\r\nint is_moc)\r\n{\r\nproto_tree *tree = NULL;\r\nproto_item *dialed_num_item = NULL;\r\nproto_tree *dialed_num_tree = NULL, *gps_pos_tree = NULL;\r\ntree = proto_tree_add_subtree(\r\nroot_tree, tvb, 2, 16,\r\nett_rach_kls2, NULL, "Class-2 informations");\r\nproto_tree_add_item(tree, hf_rach_mes_pwr_class,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_sp_hplmn_id,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_pd,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nif (is_moc) {\r\ngchar s[32];\r\n_parse_dialed_number(s, sizeof(s), tvb, offset + 3);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s ", s);\r\ndialed_num_item = proto_tree_add_string(\r\ntree, hf_rach_number, tvb, offset + 3, 7, s);\r\ndialed_num_tree = proto_item_add_subtree(\r\ndialed_num_item, ett_rach_dialed_num);\r\nproto_tree_add_item(dialed_num_tree, hf_rach_number_grp1,\r\ntvb, offset + 3, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dialed_num_tree, hf_rach_number_grp2,\r\ntvb, offset + 4, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dialed_num_tree, hf_rach_number_grp3,\r\ntvb, offset + 5, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dialed_num_tree, hf_rach_number_grp4,\r\ntvb, offset + 7, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(dialed_num_tree, hf_rach_number_grp5,\r\ntvb, offset + 8, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(tree, hf_rach_msc_id,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gps_timestamp,\r\ntvb, offset + 4, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_software_version,\r\ntvb, offset + 6, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_spare,\r\ntvb, offset + 6, 1, ENC_BIG_ENDIAN);\r\n}\r\nproto_tree_add_item(tree, hf_rach_gci,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_r,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_o,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\ngps_pos_tree = proto_tree_add_subtree(\r\ntree, tvb, offset + 10, 5,\r\nett_rach_gps_pos, NULL, "GPS Position");\r\ndissect_gmr1_rach_gps_pos(tvb, offset + 10, pinfo, gps_pos_tree);\r\nproto_tree_add_item(tree, hf_rach_number_type,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_gmprs_rach_type1_kls2(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *root_tree, int is_pdt)\r\n{\r\nproto_tree *tree = NULL;\r\nproto_tree *gps_pos_tree = NULL;\r\nguint8 term_type;\r\nint is_class_d;\r\ntree = proto_tree_add_subtree(\r\nroot_tree, tvb, 2, 16,\r\nett_rach_gmprs_type1_kls2, NULL, "GmPRS Type-1 Class-2 informations");\r\nproto_tree_add_split_bits_item_ret_val(\r\ntree, hf_rach_gmprs_term_type,\r\ntvb, offset << 3,\r\nrach_gmprs_type1_term_type_crumbs,\r\nNULL);\r\nterm_type = ((tvb_get_guint8(tvb, offset) >> 1) & 0x78 ) |\r\n( tvb_get_guint8(tvb, offset + 3) & 0x07);\r\nis_class_d = (term_type == 0x0d) ||\r\n(term_type == 0x0e) ||\r\n(term_type == 0x0f);\r\nif (is_class_d) {\r\nproto_tree_add_item(tree, hf_rach_gmprs_dl_peak_tput,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_reserved1,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(tree, hf_rach_sp_hplmn_id,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\n}\r\nproto_tree_add_item(tree, hf_rach_gmprs_radio_prio,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_spare1,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_pd,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_tlli,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nif (is_pdt) {\r\nproto_tree_add_split_bits_item_ret_val(\r\ntree, hf_rach_gmprs_num_rlc_blks,\r\ntvb, (offset + 8) << 3,\r\nrach_gmprs_num_rlc_blks_crumbs,\r\nNULL);\r\nproto_tree_add_item(tree, is_class_d ?\r\nhf_rach_gmprs_ul_peak_tput :\r\nhf_rach_gmprs_peak_tput,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_spare2,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(tree, hf_rach_gps_timestamp,\r\ntvb, offset + 8, 2, ENC_BIG_ENDIAN);\r\n}\r\ngps_pos_tree = proto_tree_add_subtree(\r\ntree, tvb, offset + 10, 5,\r\nett_rach_gps_pos, NULL, "GPS Position");\r\ndissect_gmr1_rach_gps_pos(tvb, offset + 10, pinfo, gps_pos_tree);\r\nproto_tree_add_item(tree, hf_rach_gmprs_rlc_mode,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_llc_mode,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_spare3,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_gmprs_rach_type2_kls2(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *root_tree)\r\n{\r\nproto_tree *tree = NULL;\r\nproto_tree *gps_pos_tree = NULL;\r\nguint8 req_type;\r\ntree = proto_tree_add_subtree(\r\nroot_tree, tvb, 2, 16,\r\nett_rach_gmprs_type2_kls2, NULL, "GmPRS Type-2 Class-2 informations");\r\nproto_tree_add_split_bits_item_ret_val(\r\ntree, hf_rach_gmprs_term_type,\r\ntvb, offset << 3,\r\nrach_gmprs_type2_term_type_crumbs,\r\nNULL);\r\nproto_tree_add_item(tree, hf_rach_sp_hplmn_id,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_pd,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_msc_id,\r\ntvb, offset + 3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_gmprs_tlli,\r\ntvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nreq_type = tvb_get_guint8(tvb, offset + 8) & 0x1f;\r\nif ((req_type & 0x1c) == 0) {\r\nproto_item *rt_item = proto_tree_add_item(\r\ntree, hf_rach_gmprs_req_type_pag_resp,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\nproto_tree *rt_tree = proto_item_add_subtree(rt_item, ett_rach_gmprs_req_type);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Paging response ");\r\nproto_tree_add_item(rt_tree, hf_rach_gmprs_chan_needed,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(tree, hf_rach_gmprs_req_type,\r\ntvb, offset + 8, 1, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s",\r\nval_to_str(req_type, rach_gmprs_req_type_vals, "Unknown (%u)"));\r\n}\r\nproto_tree_add_item(tree, hf_rach_software_version,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_spare,\r\ntvb, offset + 9, 1, ENC_BIG_ENDIAN);\r\ngps_pos_tree = proto_tree_add_subtree(\r\ntree, tvb, offset + 10, 5,\r\nett_rach_gps_pos, NULL, "GPS Position");\r\ndissect_gmr1_rach_gps_pos(tvb, offset + 10, pinfo, gps_pos_tree);\r\nproto_tree_add_item(tree, hf_rach_gci,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_r,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_rach_o,\r\ntvb, offset + 15, 1, ENC_BIG_ENDIAN);\r\n}\r\nstatic int\r\ndissect_gmr1_rach(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nconst int RACH_IE_CLASS1 = (1 << 0);\r\nconst int RACH_IE_CLASS2_GMR1 = (1 << 1);\r\nconst int RACH_IE_CLASS2_GMPRS_TYPE1 = (1 << 2);\r\nconst int RACH_IE_CLASS2_GMPRS_TYPE2 = (1 << 3);\r\nproto_item *rach_item;\r\nproto_tree *rach_tree;\r\nconst char *desc;\r\nint len, is_moc, is_pdt, ies;\r\nlen = tvb_reported_length(tvb);\r\ndesc = "GMR-1 Channel Request (RACH)";\r\nies = 0;\r\nif (len == 18) {\r\nguint8 ec = (tvb_get_guint8(tvb, 0) >> 1) & 0x1f;\r\nies |= RACH_IE_CLASS1;\r\nif ((ec == 13) || (ec == 14)) {\r\ndesc = "GMR-1 GmPRS Channel Request Type 1 (RACH)";\r\nies |= RACH_IE_CLASS2_GMPRS_TYPE1;\r\n} else if (ec == 7) {\r\ndesc = "GMR-1 GmPRS Channel Request Type 2 (RACH)";\r\nies |= RACH_IE_CLASS2_GMPRS_TYPE2;\r\n} else if (ec == 12) {\r\nies |= RACH_IE_CLASS2_GMR1;\r\n} else {\r\nies |= RACH_IE_CLASS2_GMR1;\r\n}\r\n}\r\nrach_item = proto_tree_add_protocol_format(\r\ntree, proto_gmr1_rach, tvb, 0, len, "%s", desc);\r\nrach_tree = proto_item_add_subtree(rach_item, ett_rach_msg);\r\nif (!ies) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, "(Invalid)");\r\ncall_data_dissector(tvb, pinfo, tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, "(RACH) ");\r\nif (ies & RACH_IE_CLASS1)\r\ndissect_gmr1_rach_kls1(tvb, 0, pinfo, rach_tree, &is_moc, &is_pdt);\r\nif (ies & RACH_IE_CLASS2_GMR1)\r\ndissect_gmr1_rach_kls2(tvb, 2, pinfo, rach_tree, is_moc);\r\nif (ies & RACH_IE_CLASS2_GMPRS_TYPE1)\r\ndissect_gmprs_rach_type1_kls2(tvb, 2, pinfo, rach_tree, is_pdt);\r\nif (ies & RACH_IE_CLASS2_GMPRS_TYPE2)\r\ndissect_gmprs_rach_type2_kls2(tvb, 2, pinfo, rach_tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_gmr1_rach(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_rach_prio,\r\n{ "Priority", "gmr1.rach.priority",\r\nFT_BOOLEAN, 8, TFS(&rach_prio_tfs), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_est_cause,\r\n{ "Establishment Cause", "gmr1.rach.est_cause",\r\nFT_UINT8, BASE_HEX, VALS(rach_est_cause_vals), 0x3e,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_est_cause_moc,\r\n{ "Establishment Cause", "gmr1.rach.est_cause.moc",\r\nFT_UINT8, BASE_HEX, VALS(rach_est_cause_moc_vals), 0x20,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_est_cause_pag_resp,\r\n{ "Establishment Cause", "gmr1.rach.est_cause.pag_resp",\r\nFT_UINT8, BASE_HEX, VALS(rach_est_cause_pag_resp_vals), 0x38,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_num_plan,\r\n{ "Numbering Plan Identification", "gmr1.rach.numbering_plan",\r\nFT_UINT8, BASE_DEC, VALS(rach_num_plan_vals), 0x1e,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_chan_needed,\r\n{ "Channel Needed", "gmr1.rach.chan_needed",\r\nFT_UINT8, BASE_DEC, VALS(rach_chan_needed_vals), 0x06,\r\n"Echoed from Paging Request", HFILL }\r\n},\r\n{ &hf_rach_retry_cnt,\r\n{ "Retry Counter", "gmr1.rach.retry_counter",\r\nFT_UINT8, BASE_DEC, NULL, 0xc0,\r\n"Retransmission count for current access attempt", HFILL }\r\n},\r\n{ &hf_rach_precorr,\r\n{ "Precorrection Indication", "gmr1.rach.precorr_ind",\r\nFT_UINT8, BASE_DEC, VALS(rach_precorr_vals), 0xe0,\r\n"This is the timing correction applied to RACH while "\r\n"sending this message. See GMR 05.010.", HFILL }\r\n},\r\n{ &hf_rach_rand_ref,\r\n{ "Random Reference", "gmr1.rach.random_reference",\r\nFT_UINT8, BASE_HEX, NULL, 0x1f,\r\n"A random number of 5 bits", HFILL }\r\n},\r\n{ &hf_rach_gps_pos_cpi,\r\n{ "CPI", "gmr1.rach.gps_pos.cpi",\r\nFT_BOOLEAN, 8, TFS(&rach_gps_pos_cpi_tfs), 0x80,\r\n"Current Position Indicator", HFILL }\r\n},\r\n{ &hf_rach_gps_pos_lat,\r\n{ "Latitude", "gmr1.rach.gps_pos.latitude",\r\nFT_INT24, BASE_CUSTOM, CF_FUNC(rach_gps_pos_lat_fmt), 0x7ffff0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gps_pos_long,\r\n{ "Longitude", "gmr1.rach.gps_pos.longitude",\r\nFT_INT24, BASE_CUSTOM, CF_FUNC(rach_gps_pos_long_fmt), 0x0fffff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_mes_pwr_class,\r\n{ "MES Power Class", "gmr1.rach.mes_power_class",\r\nFT_UINT8, BASE_DEC, NULL, 0xf0,\r\n"See GMR 05.005 for infos", HFILL }\r\n},\r\n{ &hf_rach_sp_hplmn_id,\r\n{ "SP/HPLMN ID", "gmr1.rach.sp_hplmn_id",\r\nFT_UINT24, BASE_CUSTOM, CF_FUNC(rach_sp_hplmn_id_fmt), 0x0fffff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_pd,\r\n{ "PD", "gmr1.rach.pd",\r\nFT_UINT8, BASE_DEC, VALS(rach_pd_vals), 0xc0,\r\n"Protocol Discriminator", HFILL }\r\n},\r\n{ &hf_rach_number,\r\n{ "Dialed Number", "gmr1.rach.number",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_number_grp1,\r\n{ "Group 1", "gmr1.rach.number.grp1",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_dialed_num_grp1234_fmt), 0x3ff0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_number_grp2,\r\n{ "Group 2", "gmr1.rach.number.grp2",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_dialed_num_grp1234_fmt), 0x0ffc,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_number_grp3,\r\n{ "Group 3", "gmr1.rach.number.grp3",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_dialed_num_grp1234_fmt), 0x03ff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_number_grp4,\r\n{ "Group 4", "gmr1.rach.number.grp4",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_dialed_num_grp1234_fmt), 0xffc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_number_grp5,\r\n{ "Group 5", "gmr1.rach.number.grp5",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_dialed_num_grp5_fmt), 0x3ff8,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_msc_id,\r\n{ "MSC ID", "gmr1.rach.msc_id",\r\nFT_UINT8, BASE_DEC, NULL, 0x3f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gps_timestamp,\r\n{ "GPS Timestamp", "gmr1.rach.gps_timestamp",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rach_gps_timestamp_fmt), 0xffff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_software_version,\r\n{ "Software Version", "gmr1.rach.software_version",\r\nFT_UINT8, BASE_DEC, NULL, 0xfe,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_spare,\r\n{ "Spare", "gmr1.rach.spare",\r\nFT_UINT32, BASE_DEC, NULL, 0x01fffff8,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gci,\r\n{ "GCI", "gmr1.rach.gci",\r\nFT_BOOLEAN, 8, TFS(&rach_gci_tfs), 0x01,\r\n"GPS Capability Indicator", HFILL }\r\n},\r\n{ &hf_rach_r,\r\n{ "R", "gmr1.rach.r",\r\nFT_BOOLEAN, 8, TFS(&rach_r_tfs), 0x02,\r\n"See GMR 04.008 10.1.8 for full description" , HFILL }\r\n},\r\n{ &hf_rach_o,\r\n{ "O", "gmr1.rach.o",\r\nFT_BOOLEAN, 8, TFS(&rach_o_tfs), 0x04,\r\n"See GMR 04.008 10.1.8 for full description", HFILL }\r\n},\r\n{ &hf_rach_number_type,\r\n{ "Number Type", "gmr1.rach.number_type",\r\nFT_UINT8, BASE_DEC, VALS(rach_number_type_vals), 0x07,\r\n"For MO Call only", HFILL }\r\n},\r\n{ &hf_rach_gmprs_term_type,\r\n{ "GmPRS Terminal Type", "gmr1.rach.gmprs_term_type",\r\nFT_UINT8, BASE_DEC | BASE_EXT_STRING, &rach_gmprs_term_type_ext_vals, 0x00,\r\n"See GMR-1 3G 45.002 Annex C for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_radio_prio,\r\n{ "Radio Priority", "gmr1.rach.gmprs_radio_prio",\r\nFT_UINT8, BASE_DEC, VALS(rach_gmprs_radio_prio_vals), 0x18,\r\n"See GMPRS-1 04.060 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_tlli,\r\n{ "TLLI", "gmr1.rach.gmprs_tlli",\r\nFT_UINT32, BASE_HEX, NULL, 0x00,\r\n"See GMPRS-1 04.060 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_num_rlc_blks,\r\n{ "Number of RLC blocks", "gmr1.rach.gmprs_num_rlc_blks",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"See GMPRS-1 04.060 12.31 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_peak_tput,\r\n{ "Peak Throughput", "gmr1.rach.gmprs_peak_tput",\r\nFT_UINT8, BASE_DEC, NULL, 0x3c,\r\n"See GMPRS-1 04.060 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_dl_peak_tput,\r\n{ "DL Peak Throughput", "gmr1.rach.gmprs_dl_peak_tput",\r\nFT_UINT8, BASE_DEC, NULL, 0x0f,\r\n"See 3GPP TS 23.060 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_ul_peak_tput,\r\n{ "UL Peak Throughput", "gmr1.rach.gmprs_ul_peak_tput",\r\nFT_UINT8, BASE_DEC, NULL, 0x3c,\r\n"See 3GPP TS 23.060 for infos", HFILL }\r\n},\r\n{ &hf_rach_gmprs_rlc_mode,\r\n{ "RLC mode", "gmr1.rach.gmprs_rlc_mode",\r\nFT_BOOLEAN, 8, TFS(&rach_gmprs_rlc_mode_tfs), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_llc_mode,\r\n{ "LLC mode", "gmr1.rach.gmprs_llc_mode",\r\nFT_BOOLEAN, 8, TFS(&rach_gmprs_llc_mode_tfs), 0x02,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_spare1,\r\n{ "Spare", "gmr1.rach.gmprs_spare1",\r\nFT_UINT8, BASE_DEC, NULL, 0x20,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_spare2,\r\n{ "Spare", "gmr1.rach.gmprs_spare2",\r\nFT_UINT8, BASE_DEC, NULL, 0xc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_spare3,\r\n{ "Spare", "gmr1.rach.gmprs_spare3",\r\nFT_UINT8, BASE_DEC, NULL, 0x04,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_reserved1,\r\n{ "Reserved", "gmr1.rach.gmprs_reserved1",\r\nFT_UINT16, BASE_HEX, NULL, 0xffff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_req_type,\r\n{ "Request Type", "gmr1.rach.gmprs_req_type",\r\nFT_UINT8, BASE_DEC, VALS(rach_gmprs_req_type_vals), 0x1f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_req_type_pag_resp,\r\n{ "Request Type", "gmr1.rach.gmprs_req_type.pag_resp",\r\nFT_UINT8, BASE_DEC, VALS(rach_gmprs_req_type_pag_resp_vals), 0x1c,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rach_gmprs_chan_needed,\r\n{ "Channel Needed", "gmr1.rach.gmprs_chan_needed",\r\nFT_UINT8, BASE_DEC, VALS(rach_chan_needed_vals), 0x03,\r\n"Echoed from Paging Request", HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_rach_msg,\r\n&ett_rach_kls1,\r\n&ett_rach_kls2,\r\n&ett_rach_gmprs_type1_kls2,\r\n&ett_rach_gmprs_type2_kls2,\r\n&ett_rach_est_cause,\r\n&ett_rach_dialed_num,\r\n&ett_rach_gps_pos,\r\n&ett_rach_gmprs_req_type,\r\n};\r\nproto_gmr1_rach = proto_register_protocol("GEO-Mobile Radio (1) RACH", "GMR-1 RACH", "gmr1.rach");\r\nproto_register_field_array(proto_gmr1_rach, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("gmr1_rach", dissect_gmr1_rach, proto_gmr1_rach);\r\n}
