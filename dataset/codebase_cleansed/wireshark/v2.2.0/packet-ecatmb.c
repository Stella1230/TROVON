void init_mbx_header(PETHERCAT_MBOX_HEADER pMbox, tvbuff_t *tvb, gint offset)\r\n{\r\npMbox->Length = tvb_get_letohs(tvb, offset); offset+=2;\r\npMbox->Address = tvb_get_letohs(tvb, offset); offset+=2;\r\npMbox->aControlUnion.Control = tvb_get_letohs(tvb, offset);\r\n}\r\nstatic void init_eoe_header(PETHERCAT_EOE_HEADER pEoE, tvbuff_t *tvb, gint offset)\r\n{\r\npEoE->anEoeHeaderInfoUnion.Info = tvb_get_letohs(tvb, offset); offset+=2;\r\npEoE->anEoeHeaderDataUnion.Result = tvb_get_letohs(tvb, offset);\r\n}\r\nstatic void init_foe_header(PETHERCAT_FOE_HEADER pFoE, tvbuff_t *tvb, gint offset)\r\n{\r\npFoE->OpMode = tvb_get_guint8(tvb, offset++);\r\npFoE->Reserved1 = tvb_get_guint8(tvb, offset++);\r\npFoE->aFoeHeaderDataUnion.FileLength = tvb_get_letohl(tvb, offset);\r\n}\r\nstatic void init_soe_header(PETHERCAT_SOE_HEADER pSoE, tvbuff_t *tvb, gint offset)\r\n{\r\npSoE->anSoeHeaderControlUnion.v2.Control = tvb_get_guint8(tvb, offset++);\r\npSoE->anSoeHeaderControlUnion.v2.Element = tvb_get_guint8(tvb, offset++);\r\npSoE->anSoeHeaderDataUnion.FragmentsLeft = tvb_get_letohs(tvb, offset);\r\n}\r\nstatic void init_coe_header(PETHERCAT_COE_HEADER pCoE, tvbuff_t *tvb, gint offset)\r\n{\r\npCoE->header = tvb_get_letohs(tvb, offset);\r\n}\r\nstatic void init_sdo_header(PETHERCAT_SDO_HEADER pSdo, tvbuff_t *tvb, gint offset)\r\n{\r\npSdo->anSdoHeaderUnion.CS = tvb_get_guint8(tvb, offset++);\r\npSdo->Index = tvb_get_letohs(tvb, offset);offset+=2;\r\npSdo->SubIndex = tvb_get_guint8(tvb, offset++);\r\npSdo->Data = tvb_get_letohl(tvb, offset);\r\n}\r\nstatic void init_sdo_info_header(PETHERCAT_SDO_INFO_HEADER pInfo, tvbuff_t *tvb, gint offset)\r\n{\r\npInfo->anSdoControlUnion.Control = tvb_get_guint8(tvb, offset++);\r\npInfo->Reserved = tvb_get_guint8(tvb, offset);\r\npInfo->FragmentsLeft = 2;\r\n}\r\nstatic void CANopenSdoReqFormatter(PETHERCAT_SDO_HEADER pSdo, char *szText, gint nMax)\r\n{\r\nswitch ( pSdo->anSdoHeaderUnion.Idq.Ccs )\r\n{\r\ncase SDO_CCS_INITIATE_DOWNLOAD:\r\ng_snprintf ( szText, nMax, "SDO Req : 'Initiate Download' (%d) Idx=0x%x Sub=%d", pSdo->anSdoHeaderUnion.Idq.Ccs, pSdo->Index, pSdo->SubIndex);\r\nbreak;\r\ncase SDO_CCS_INITIATE_UPLOAD:\r\ng_snprintf ( szText, nMax, "SDO Req : 'Initiate Upload' (%d) Idx=0x%x Sub=%d", pSdo->anSdoHeaderUnion.Idq.Ccs, pSdo->Index, pSdo->SubIndex);\r\nbreak;\r\ncase SDO_CCS_DOWNLOAD_SEGMENT:\r\ng_snprintf ( szText, nMax, "SDO Req : 'Download Segment' (%d)", pSdo->anSdoHeaderUnion.Idq.Ccs);\r\nbreak;\r\ncase SDO_CCS_UPLOAD_SEGMENT:\r\ng_snprintf ( szText, nMax, "SDO Req : 'Upload Segment' (%d)", pSdo->anSdoHeaderUnion.Idq.Ccs);\r\nbreak;\r\ncase SDO_CCS_ABORT_TRANSFER:\r\ng_snprintf ( szText, nMax, "SDO Req : 'Abort Transfer' (%d)", pSdo->anSdoHeaderUnion.Idq.Ccs);\r\nbreak;\r\ndefault:\r\ng_snprintf ( szText, nMax, "SDO Req : Ccs %d", pSdo->anSdoHeaderUnion.Idq.Ccs);\r\n}\r\n}\r\nstatic void FoeFormatter(tvbuff_t *tvb, gint offset, char *szText, gint nMax, guint foe_length)\r\n{\r\nETHERCAT_FOE_HEADER foe;\r\nchar tmp[50];\r\nmemset(tmp, 0, sizeof(tmp));\r\ninit_foe_header(&foe, tvb, offset);\r\nswitch ( foe.OpMode )\r\n{\r\ncase ECAT_FOE_OPMODE_RRQ:\r\ncase ECAT_FOE_OPMODE_WRQ:\r\ncase ECAT_FOE_OPMODE_ERR:\r\nif ( foe_length > ETHERCAT_FOE_HEADER_LEN )\r\ntvb_memcpy(tvb, tmp, offset+ETHERCAT_FOE_HEADER_LEN, MIN(foe_length-ETHERCAT_FOE_HEADER_LEN, sizeof(tmp)-1));\r\nbreak;\r\n}\r\nswitch ( foe.OpMode )\r\n{\r\ncase ECAT_FOE_OPMODE_RRQ:\r\ng_snprintf ( szText, nMax, "FoE RRQ (%d) : '%s'", foe.aFoeHeaderDataUnion.FileLength, tmp);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_WRQ:\r\ng_snprintf ( szText, nMax, "FoE WRQ (%d) : '%s'", foe.aFoeHeaderDataUnion.FileLength, tmp);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_DATA:\r\ng_snprintf ( szText, nMax, "FoE DATA (%d) : %d Bytes", foe.aFoeHeaderDataUnion.v.PacketNo, foe_length-ETHERCAT_FOE_HEADER_LEN);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_ACK:\r\ng_snprintf ( szText, nMax, "FoE ACK (%d)", foe.aFoeHeaderDataUnion.v.PacketNo);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_ERR:\r\ng_snprintf ( szText, nMax, "FoE ERR (%d) : '%s'", foe.aFoeHeaderDataUnion.ErrorCode, tmp);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_BUSY:\r\nif ( foe.aFoeHeaderDataUnion.v2.Entire > 0 )\r\ng_snprintf ( szText, nMax, "FoE BUSY (%d%%)", ((guint32)foe.aFoeHeaderDataUnion.v2.Done*100)/foe.aFoeHeaderDataUnion.v2.Entire);\r\nelse\r\ng_snprintf ( szText, nMax, "FoE BUSY (%d/%d)", foe.aFoeHeaderDataUnion.v2.Done, foe.aFoeHeaderDataUnion.v2.Entire);\r\nbreak;\r\ndefault:\r\ng_snprintf ( szText, nMax, "FoE Unknown");\r\n}\r\n}\r\nstatic void SoEIdToString( char* txt, guint16 id, int nMax)\r\n{\r\nif ( id & 0x8000 )\r\ng_snprintf(txt, nMax, "P-%d-%04d", (id>>12) & 0x0007, id & 0x0FFF );\r\nelse\r\ng_snprintf(txt, nMax, "S-%d-%04d", id>>12, id & 0x0FFF );\r\n}\r\nstatic void SoeFormatter(tvbuff_t *tvb, gint offset, char *szText, gint nMax, guint soe_length)\r\n{\r\nETHERCAT_SOE_HEADER soe;\r\nchar tmp[50];\r\nchar elm[50];\r\nmemset(tmp, 0, sizeof(tmp));\r\ninit_soe_header(&soe, tvb, offset);\r\noffset+=ETHERCAT_SOE_HEADER_LEN;\r\nif ( !soe.anSoeHeaderControlUnion.v.Error )\r\n{\r\nif ( !soe.anSoeHeaderControlUnion.v.InComplete )\r\n{\r\nSoEIdToString(tmp, soe.anSoeHeaderDataUnion.IDN, sizeof(tmp)-1);\r\nelm[0] = '\0';\r\nif ( soe.anSoeHeaderControlUnion.v.DataState )\r\ng_strlcat(elm, "D", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Name )\r\ng_strlcat(elm, "N", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Attribute )\r\ng_strlcat(elm, "A", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Unit )\r\ng_strlcat(elm, "U", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Min )\r\ng_strlcat(elm, "I", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Max )\r\ng_strlcat(elm, "X", 50);\r\nif ( soe.anSoeHeaderControlUnion.v.Value )\r\ng_strlcat(elm, "V", 50);\r\nswitch ( soe.anSoeHeaderControlUnion.v.OpCode )\r\n{\r\ncase ECAT_SOE_OPCODE_RRQ:\r\ng_snprintf ( szText, nMax, "SoE: RRQ (%s, '%s')", tmp, elm);\r\nbreak;\r\ncase ECAT_SOE_OPCODE_RRS:\r\ng_snprintf ( szText, nMax, "SoE: RRS (%s, '%s') : %u Bytes", tmp, elm, (guint)(soe_length-ETHERCAT_SOE_HEADER_LEN));\r\nbreak;\r\ncase ECAT_SOE_OPCODE_WRS:\r\ng_snprintf ( szText, nMax, "SoE: WRS (%s, '%s')", tmp, elm);\r\nbreak;\r\ncase ECAT_SOE_OPCODE_WRQ:\r\ng_snprintf ( szText, nMax, "SoE: WRQ (%s, '%s') : %u Bytes", tmp, elm, (guint)(soe_length-ETHERCAT_SOE_HEADER_LEN));\r\nbreak;\r\ncase ECAT_SOE_OPCODE_NFC:\r\ng_snprintf ( szText, nMax, "SoE: NFC (%s, '%s') : %u Bytes", tmp, elm, (guint)(soe_length-ETHERCAT_SOE_HEADER_LEN));\r\nbreak;\r\ncase 6:\r\ng_snprintf ( szText, nMax, "SoE: EMGCY");\r\nbreak;\r\ndefault:\r\ng_snprintf ( szText, nMax, "SoE:");\r\n}\r\n}\r\nelse\r\ng_snprintf ( szText, nMax, "SoE: FragmentsLeft %d", soe.anSoeHeaderDataUnion.FragmentsLeft);\r\n}\r\nelse\r\ng_snprintf ( szText, nMax, "SoE: Error %04x", tvb_get_letohs(tvb, offset));\r\n}\r\nstatic void dissect_ecat_coe(tvbuff_t *tvb, gint offset, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *ecat_coe_tree = NULL, *ecat_sdo_tree, *ecat_coe_sdoccs_tree, *ecat_coe_sdoscs_tree;\r\nproto_item *anItem = NULL, *aparent = NULL;\r\nchar szText[200];\r\nint nMax = sizeof(szText)-1;\r\nguint coe_length = tvb_reported_length(tvb)-offset;\r\nguint16 len;\r\nif( tree )\r\n{\r\nanItem = proto_tree_add_bytes_format(tree, hf_ecat_mailbox_coe, tvb, offset, coe_length, NULL, "CoE");\r\naparent = proto_item_get_parent(anItem);\r\nproto_item_append_text(aparent,":CoE ");\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, "CoE ");\r\nif( coe_length >= ETHERCAT_COE_HEADER_LEN )\r\n{\r\nETHERCAT_COE_HEADER coe;\r\ninit_coe_header(&coe, tvb, offset);\r\nif( tree )\r\n{\r\necat_coe_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe);\r\nproto_tree_add_uint(ecat_coe_tree, hf_ecat_mailbox_coe_number, tvb, offset, ETHERCAT_COE_HEADER_LEN, coe.v.Number);\r\nproto_tree_add_uint(ecat_coe_tree, hf_ecat_mailbox_coe_type, tvb, offset, ETHERCAT_COE_HEADER_LEN, coe.v.Type);\r\n}\r\noffset += ETHERCAT_COE_HEADER_LEN;\r\nswitch (coe.v.Type)\r\n{\r\ncase ETHERCAT_COE_TYPE_SDOREQ:\r\n{\r\nETHERCAT_SDO_HEADER sdo;\r\nif( coe_length < ETHERCAT_COE_HEADER_LEN + ETHERCAT_SDO_HEADER_LEN )\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Sdo Req - invalid length");\r\nexpert_add_info_format(pinfo, ecat_coe_tree, &ei_ecat_mailbox_coe_error, "Sdo Req - invalid length");\r\nbreak;\r\n}\r\ninit_sdo_header(&sdo, tvb, offset);\r\nCANopenSdoReqFormatter(&sdo, szText, nMax);\r\ncol_append_str(pinfo->cinfo, COL_INFO, szText);\r\nif( tree )\r\n{\r\nproto_item_append_text(aparent, "%s", szText);\r\nanItem = proto_tree_add_uint(ecat_coe_tree, hf_ecat_mailbox_coe_sdoreq, tvb, offset, 1, sdo.anSdoHeaderUnion.Idq.Ccs);\r\nproto_item_set_text(anItem, "%s", szText);\r\necat_sdo_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_sdo);\r\nswitch ( sdo.anSdoHeaderUnion.Idq.Ccs )\r\n{\r\ncase SDO_CCS_INITIATE_DOWNLOAD:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoccsid, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoccs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoccs);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_sizeind, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_expedited, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_size0, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_size1, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_complete, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoidx, tvb, offset+1, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdosub, tvb, offset+3, 1, ENC_LITTLE_ENDIAN);\r\nif ( sdo.anSdoHeaderUnion.Idq.SizeInd && !sdo.anSdoHeaderUnion.Idq.Expedited )\r\n{\r\nlen = coe_length - ETHERCAT_COE_HEADER_LEN - ETHERCAT_SDO_HEADER_LEN;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdolength, tvb, offset+4, 4, ENC_LITTLE_ENDIAN);\r\noffset+=ETHERCAT_SDO_HEADER_LEN;\r\nif ( len > 0 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoldata, tvb, offset, len, ENC_NA);\r\n}\r\nelse\r\n{\r\nif ( sdo.anSdoHeaderUnion.Idq.Size == 3 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata1, tvb, offset+4, 1, ENC_LITTLE_ENDIAN);\r\nelse if ( sdo.anSdoHeaderUnion.Idq.Size == 2 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata2, tvb, offset+4, 2, ENC_LITTLE_ENDIAN);\r\nelse\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata, tvb, offset+4, 4, ENC_LITTLE_ENDIAN);\r\n}\r\nbreak;\r\ncase SDO_CCS_INITIATE_UPLOAD:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoccsiu, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoccs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoccs);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsid_complete, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoidx, tvb, offset+1, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdosub, tvb, offset+3, 1, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase SDO_CCS_DOWNLOAD_SEGMENT:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoccsds, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoccs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoccs);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsds_lastseg, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsds_size, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsds_toggle, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset+=1;\r\nif ( coe_length-offset > 0 )\r\n{\r\nanItem = proto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoldata, tvb, offset, coe_length-offset, ENC_NA);\r\nproto_item_append_text(anItem, "(len = %d)", coe_length-offset);\r\n}\r\nbreak;\r\ncase SDO_CCS_UPLOAD_SEGMENT:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoccsus, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoccs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoccs);\r\nproto_tree_add_item(ecat_coe_sdoccs_tree, hf_ecat_mailbox_coe_sdoccsus_toggle, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase SDO_CCS_ABORT_TRANSFER:\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoidx, tvb, offset+4, 4, ENC_LITTLE_ENDIAN);\r\nbreak;\r\n}\r\n}\r\n}\r\nbreak;\r\ncase ETHERCAT_COE_TYPE_SDORES:\r\n{\r\nETHERCAT_SDO_HEADER sdo;\r\nif( coe_length < ETHERCAT_COE_HEADER_LEN + ETHERCAT_SDO_HEADER_LEN )\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Sdo Res - invalid length");\r\nexpert_add_info_format(pinfo, ecat_coe_tree, &ei_ecat_mailbox_coe_error, "Sdo Res - invalid length");\r\nbreak;\r\n}\r\ninit_sdo_header(&sdo, tvb, offset);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "SDO Res: Scs %d", sdo.anSdoHeaderUnion.Ids.Scs);\r\nif( tree )\r\n{\r\nproto_tree_add_uint_format_value(ecat_coe_tree, hf_ecat_mailbox_coe_sdores, tvb, offset, 1, sdo.anSdoHeaderUnion.Ids.Scs,\r\n"Scs %d", sdo.anSdoHeaderUnion.Ids.Scs);\r\necat_sdo_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_sdo);\r\nswitch ( sdo.anSdoHeaderUnion.Ids.Scs )\r\n{\r\ncase SDO_SCS_INITIATE_DOWNLOAD:\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoidx, tvb, offset+1, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdosub, tvb, offset+3, 1, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase SDO_SCS_INITIATE_UPLOAD:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoscsiu, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoscs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoscs);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsiu_sizeind, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsiu_expedited, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsiu_size0, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsiu_size1, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsiu_complete, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoidx, tvb, offset+1, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdosub, tvb, offset+3, 1, ENC_LITTLE_ENDIAN);\r\nif ( sdo.anSdoHeaderUnion.Ius.SizeInd && !sdo.anSdoHeaderUnion.Ius.Expedited )\r\n{\r\nlen = coe_length - ETHERCAT_COE_HEADER_LEN - ETHERCAT_SDO_HEADER_LEN;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdolength, tvb, offset+4, 4, ENC_LITTLE_ENDIAN);\r\noffset+=ETHERCAT_SDO_HEADER_LEN;\r\nif ( len > 0 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoldata, tvb, offset, len, ENC_NA);\r\n}\r\nelse if ( sdo.anSdoHeaderUnion.Ius.SizeInd && sdo.anSdoHeaderUnion.Ius.Expedited && sdo.anSdoHeaderUnion.Ius.Size == 3 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata1, tvb, offset+4, 1, ENC_LITTLE_ENDIAN);\r\nelse if ( sdo.anSdoHeaderUnion.Ius.SizeInd && sdo.anSdoHeaderUnion.Ius.Expedited && sdo.anSdoHeaderUnion.Ius.Size == 2 )\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata2, tvb, offset+4, 2, ENC_LITTLE_ENDIAN);\r\nelse\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdodata, tvb, offset+4, 4, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase SDO_SCS_DOWNLOAD_SEGMENT:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoscsds, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoscs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoscs);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsds_toggle, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase SDO_SCS_UPLOAD_SEGMENT:\r\nanItem = proto_tree_add_item(ecat_sdo_tree, hf_ecat_mailbox_coe_sdoscsus, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\necat_coe_sdoscs_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_coe_sdoscs);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsus_lastseg, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsus_bytes, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_sdoscs_tree, hf_ecat_mailbox_coe_sdoscsus_toggle, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset+=1;\r\nif ( coe_length-offset> 0 )\r\n{\r\nanItem = proto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoldata, tvb, offset, coe_length-offset, ENC_NA);\r\nproto_item_append_text(anItem, "(len = %d)", coe_length-offset);\r\n}\r\nbreak;\r\n}\r\n}\r\n}\r\nbreak;\r\ncase ETHERCAT_COE_TYPE_SDOINFO:\r\n{\r\nETHERCAT_SDO_INFO_HEADER info;\r\nif( coe_length < ETHERCAT_COE_HEADER_LEN + ETHERCAT_SDO_INFO_LISTREQ_LEN )\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "Sdo Info - invalid length");\r\nexpert_add_info_format(pinfo, ecat_coe_tree, &ei_ecat_mailbox_coe_error, "Sdo Info - invalid length");\r\nbreak;\r\n}\r\nmemset(&info, 0x0, sizeof(info));\r\ninit_sdo_info_header(&info, tvb, offset);\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str(info.anSdoControlUnion.v.OpCode & 0x7F, CANopenSdoInfo, "%d (Unknown)"));\r\nif ( (info.anSdoControlUnion.v.OpCode & 0x80) != 0 )\r\ncol_append_str(pinfo->cinfo, COL_INFO, " - More Follows");\r\nif( tree )\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoopcode, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfofrag, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nswitch ( info.anSdoControlUnion.v.OpCode )\r\n{\r\ncase ECAT_COE_INFO_OPCODE_LIST_Q:\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfolisttype, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\n}\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_LIST_S:\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfolisttype, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfolist, tvb, offset, coe_length-offset, ENC_NA);\r\n}\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_OBJ_Q:\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoindex, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_OBJ_S:\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoindex, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfodatatype, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfomaxsub, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoobjcode, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoname, tvb, offset, coe_length-offset, ENC_ASCII|ENC_NA);\r\n}\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_ENTRY_Q:\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoindex, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfosubindex, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfovalueinfo, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\n}\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_ENTRY_S:\r\n{\r\nguint16 objlen;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoindex, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfosubindex, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfovalueinfo, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfodatatype, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfobitlen, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoobjaccess, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nif ( (info.anSdoInfoUnion.Entry.ValueInfo & 0x08) != 0 )\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfounittype, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\n}\r\nif ( (info.anSdoInfoUnion.Entry.ValueInfo & 0x10) != 0 )\r\n{\r\nobjlen = BIT2BYTE(info.anSdoInfoUnion.Entry.Res.BitLen);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfodefaultvalue, tvb, offset, objlen, ENC_NA);\r\noffset+=objlen;\r\n}\r\nif ( (info.anSdoInfoUnion.Entry.ValueInfo & 0x20) != 0 )\r\n{\r\nobjlen = BIT2BYTE(info.anSdoInfoUnion.Entry.Res.BitLen);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfominvalue, tvb, offset, objlen, ENC_NA);\r\noffset+=objlen;\r\n}\r\nif ( (info.anSdoInfoUnion.Entry.ValueInfo & 0x40) != 0 )\r\n{\r\nobjlen = BIT2BYTE(info.anSdoInfoUnion.Entry.Res.BitLen);\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfomaxvalue, tvb, offset, objlen, ENC_NA);\r\noffset+=objlen;\r\n}\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoname, tvb, offset, coe_length-offset, ENC_ASCII|ENC_NA);\r\n}\r\nbreak;\r\ncase ECAT_COE_INFO_OPCODE_ERROR_S:\r\n{\r\nproto_tree_add_item(ecat_coe_tree, hf_ecat_mailbox_coe_sdoinfoerrorcode, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\n}\r\nbreak;\r\n}\r\n}\r\n}\r\nbreak;\r\n}\r\n}\r\nelse\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "- invalid length");\r\nexpert_add_info(pinfo, tree, &ei_ecat_mailbox_coe_error);\r\n}\r\n}\r\nstatic void dissect_ecat_soe(tvbuff_t *tvb, gint offset, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *ecat_soeflag_tree, *ecat_soe_tree;\r\nproto_item *anItem = NULL ,*aparent = NULL;\r\nchar szText[200];\r\nint nMax = sizeof(szText)-1;\r\nguint soe_length = tvb_reported_length(tvb)-offset;\r\nif( tree )\r\n{\r\nanItem = proto_tree_add_item(tree, hf_ecat_mailbox_soe, tvb, offset, soe_length, ENC_NA);\r\naparent = proto_item_get_parent(anItem);\r\nproto_item_append_text(aparent,":SoE ");\r\n}\r\nif( soe_length >= ETHERCAT_SOE_HEADER_LEN )\r\n{\r\nSoeFormatter(tvb, offset, szText, nMax, soe_length);\r\ncol_append_str(pinfo->cinfo, COL_INFO, szText);\r\nif( tree )\r\n{\r\nETHERCAT_SOE_HEADER soe;\r\ninit_soe_header(&soe, tvb, offset);\r\nproto_item_append_text(aparent, "%s", szText);\r\nproto_item_set_text(anItem, "%s", szText);\r\necat_soe_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_soe);\r\nanItem = proto_tree_add_item(ecat_soe_tree, hf_ecat_mailbox_soe_header, tvb, offset , 2, ENC_LITTLE_ENDIAN);\r\necat_soeflag_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_soeflag);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_opcode, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_incomplete, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_error, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_driveno, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_datastate, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_name, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_attribute, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_unit, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_min, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_max, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_value, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_soeflag_tree, hf_ecat_mailbox_soe_header_reserved, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nif ( !soe.anSoeHeaderControlUnion.v.Error )\r\n{\r\nif ( !soe.anSoeHeaderControlUnion.v.InComplete )\r\n{\r\nswitch (soe.anSoeHeaderControlUnion.v.OpCode)\r\n{\r\ncase ECAT_SOE_OPCODE_RRQ:\r\ncase ECAT_SOE_OPCODE_WRS:\r\nproto_tree_add_item(ecat_soe_tree, hf_ecat_mailbox_soe_idn, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase ECAT_SOE_OPCODE_RRS:\r\ncase ECAT_SOE_OPCODE_WRQ:\r\ncase ECAT_SOE_OPCODE_NFC:\r\nproto_tree_add_item(ecat_soe_tree, hf_ecat_mailbox_soe_idn, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(tree, hf_ecat_mailbox_soe_data, tvb, offset, soe_length-offset, ENC_NA);\r\nbreak;\r\n}\r\n}\r\nelse\r\n{\r\nproto_tree_add_item(ecat_soe_tree, hf_ecat_mailbox_soe_frag, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(tree, hf_ecat_mailbox_soe_data, tvb, offset, soe_length-offset, ENC_NA);\r\n}\r\n}\r\nelse\r\n{\r\nproto_tree_add_item(ecat_soe_tree, hf_ecat_mailbox_soe_idn, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree, hf_ecat_mailbox_soe_error, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\n}\r\n}\r\n}\r\nelse\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "SoE - invalid length");\r\nexpert_add_info(pinfo, tree, &ei_ecat_mailbox_soe_error);\r\n}\r\n}\r\nstatic void dissect_ecat_eoe(tvbuff_t *tvb, gint offset, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *ecat_eoe_tree = 0, *ecat_fraghead_tree, *ecat_eoe_init_tree, *ecat_eoe_macfilter_tree,\r\n*ecat_eoe_macfilter_filter_tree;\r\ntvbuff_t *next_tvb;\r\nproto_item *anItem = NULL, *aparent = NULL;\r\nint nCnt;\r\nguint eoe_length = tvb_reported_length(tvb)-offset;\r\nif( tree )\r\n{\r\nanItem = proto_tree_add_bytes_format(tree, hf_ecat_mailbox_eoe, tvb, offset, eoe_length, NULL, "EoE Fragment");\r\naparent = proto_item_get_parent(anItem);\r\nproto_item_append_text(aparent,":EoE ");\r\n}\r\nif( eoe_length >= ETHERCAT_EOE_HEADER_LEN )\r\n{\r\nETHERCAT_EOE_HEADER eoe;\r\ninit_eoe_header(&eoe, tvb, offset);\r\nif ( eoe.anEoeHeaderInfoUnion.v.Type == EOE_TYPE_FRAME_FRAG )\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "EoE-Frag %d", eoe.anEoeHeaderDataUnion.v.Fragment);\r\nelse\r\ncol_append_str(pinfo->cinfo, COL_INFO, "EoE");\r\n{\r\necat_eoe_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_eoe);\r\nanItem = proto_tree_add_item(ecat_eoe_tree, hf_ecat_mailbox_eoe_fraghead, tvb, offset, 4, ENC_NA);\r\necat_fraghead_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_fraghead);\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_type, tvb, offset, 4, eoe.anEoeHeaderInfoUnion.v.Type);\r\nswitch ( eoe.anEoeHeaderInfoUnion.v.Type )\r\n{\r\ncase EOE_TYPE_FRAME_FRAG:\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_fragno, tvb, offset, 4, eoe.anEoeHeaderDataUnion.v.Fragment);\r\nif (eoe.anEoeHeaderDataUnion.v.Fragment == 0)\r\n{\r\nproto_tree_add_uint_format(ecat_fraghead_tree, hf_ecat_mailbox_eoe_offset, tvb, offset, 4, 32*eoe.anEoeHeaderDataUnion.v.OffsetBuffer,\r\n"BufferSize: %d", 32*eoe.anEoeHeaderDataUnion.v.OffsetBuffer);\r\n}\r\nelse\r\n{\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_offset, tvb, offset, 4, 32*eoe.anEoeHeaderDataUnion.v.OffsetBuffer);\r\n}\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_frame, tvb, offset, 4, eoe.anEoeHeaderDataUnion.v.FrameNo);\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_last, tvb, offset, 4, eoe.anEoeHeaderInfoUnion.v.LastFragment);\r\nif ( eoe.anEoeHeaderInfoUnion.v.TimeStampRequested )\r\n{\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_timestampreq, tvb, offset, 4, eoe.anEoeHeaderInfoUnion.v.TimeStampRequested);\r\n}\r\nif ( eoe.anEoeHeaderInfoUnion.v.TimeStampAppended )\r\n{\r\nproto_tree_add_uint(ecat_fraghead_tree, hf_ecat_mailbox_eoe_timestampapp, tvb, offset, 4, eoe.anEoeHeaderInfoUnion.v.TimeStampAppended);\r\n}\r\noffset+=ETHERCAT_EOE_HEADER_LEN;\r\nproto_tree_add_item(ecat_eoe_tree, hf_ecat_mailbox_eoe_fragment, tvb, offset, eoe_length-offset, ENC_NA);\r\nif ( eoe.anEoeHeaderDataUnion.v.Fragment == 0 )\r\n{\r\nnext_tvb = tvb_new_subset_length(tvb, offset, eoe_length-offset);\r\ncall_dissector( eth_handle, next_tvb, pinfo, ecat_eoe_tree);\r\n}\r\nif ( eoe.anEoeHeaderInfoUnion.v.TimeStampAppended )\r\n{\r\nproto_tree_add_item(ecat_eoe_tree, hf_ecat_mailbox_eoe_timestamp, tvb, eoe_length-ETHERCAT_EOE_TIMESTAMP_LEN, ETHERCAT_EOE_TIMESTAMP_LEN, ENC_LITTLE_ENDIAN);\r\n}\r\nbreak;\r\ncase EOE_TYPE_TIMESTAMP_RES:\r\nproto_tree_add_item(ecat_eoe_tree, hf_ecat_mailbox_eoe_timestamp, tvb, offset+ETHERCAT_EOE_HEADER_LEN, ETHERCAT_EOE_TIMESTAMP_LEN, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase EOE_TYPE_INIT_REQ:\r\noffset+=ETHERCAT_EOE_HEADER_LEN;\r\nanItem = proto_tree_add_item(ecat_fraghead_tree, hf_ecat_mailbox_eoe_init, tvb, offset, MIN(eoe_length-offset,ETHERCAT_EOE_INIT_LEN), ENC_NA);\r\nif( eoe_length-offset >= ETHERCAT_EOE_INIT_LEN )\r\n{\r\necat_eoe_init_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_eoe_init);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_macaddr, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_ipaddr, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_subnetmask, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_defaultgateway, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_dnsserver, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_contains_dnsname, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_append_timestamp, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_macaddr, tvb, offset, ETHERNET_ADDRESS_LEN, ENC_NA);\r\noffset+=ETHERNET_ADDRESS_LEN;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_ipaddr, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_subnetmask, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_defaultgateway, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_dnsserver, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_eoe_init_tree, hf_ecat_mailbox_eoe_init_dnsname, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\n}\r\nelse\r\n{\r\nproto_item_append_text(anItem, " - Invalid length!");\r\nexpert_add_info(pinfo, anItem, &ei_ecat_mailbox_eoe_error);\r\n}\r\nbreak;\r\ncase EOE_TYPE_MACFILTER_REQ:\r\n{\r\nEoeMacFilterOptionsUnion options;\r\noffset+=ETHERCAT_EOE_HEADER_LEN;\r\nanItem = proto_tree_add_item(ecat_fraghead_tree, hf_ecat_mailbox_eoe_macfilter, tvb, offset, MIN(eoe_length-offset, ETHERCAT_EOE_MACFILTER_LEN), ENC_NA);\r\nif( eoe_length-offset >= ETHERCAT_EOE_MACFILTER_LEN )\r\n{\r\nproto_tree *ecat_eoe_macfilter_filtermask_tree;\r\necat_eoe_macfilter_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_eoe_macfilter);\r\nproto_tree_add_item(ecat_eoe_macfilter_tree, hf_ecat_mailbox_eoe_macfilter_macfiltercount, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_macfilter_tree, hf_ecat_mailbox_eoe_macfilter_maskcount, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(ecat_eoe_macfilter_tree, hf_ecat_mailbox_eoe_macfilter_nobroadcasts, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noptions.Options = tvb_get_letohs(tvb, offset);\r\noffset+= 2;\r\nanItem = proto_tree_add_item(ecat_eoe_macfilter_tree, hf_ecat_mailbox_eoe_macfilter_filter, tvb, offset, 16*ETHERNET_ADDRESS_LEN, ENC_NA);\r\necat_eoe_macfilter_filter_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_eoe_macfilter_filter);\r\nfor( nCnt=0; nCnt<options.v.MacFilterCount; nCnt++)\r\nproto_tree_add_item(ecat_eoe_macfilter_filter_tree, hf_ecat_mailbox_eoe_macfilter_filters[nCnt], tvb, offset+nCnt*ETHERNET_ADDRESS_LEN, ETHERNET_ADDRESS_LEN, ENC_NA);\r\noffset+=16*ETHERNET_ADDRESS_LEN;\r\nanItem = proto_tree_add_item(ecat_eoe_macfilter_tree, hf_ecat_mailbox_eoe_macfilter_filtermask, tvb, offset, 4*4, ENC_NA);\r\necat_eoe_macfilter_filtermask_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_eoe_macfilter_filtermask);\r\nfor( nCnt=0; nCnt<options.v.MacFilterMaskCount; nCnt++)\r\nproto_tree_add_item(ecat_eoe_macfilter_filtermask_tree, hf_ecat_mailbox_eoe_macfilter_filtermasks[nCnt], tvb, offset+nCnt*4, 4, ENC_NA);\r\n}\r\nelse\r\n{\r\nproto_item_append_text(anItem, " - Invalid length!");\r\nexpert_add_info(pinfo, anItem, &ei_ecat_mailbox_eoe_error);\r\n}\r\n}\r\nbreak;\r\ncase EOE_TYPE_INIT_RES:\r\ncase EOE_TYPE_MACFILTER_RES:\r\nbreak;\r\n}\r\n}\r\ncol_prepend_fstr(pinfo->cinfo, COL_INFO, "EoE(");\r\ncol_prepend_fstr(pinfo->cinfo, COL_PROTOCOL, "EoE-");\r\n}\r\nelse\r\n{\r\nexpert_add_info(pinfo, tree, &ei_ecat_mailbox_eoe_error);\r\ncol_append_str(pinfo->cinfo, COL_INFO, "EoE - invalid length!");\r\n}\r\n}\r\nstatic void dissect_ecat_foe(tvbuff_t *tvb, gint offset, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *ecat_foe_tree,*ecat_foe_efw_tree;\r\nproto_item *anItem= NULL,*aparent = NULL;\r\nchar szText[200];\r\nint nMax = sizeof(szText)-1;\r\nguint foe_length = tvb_reported_length(tvb)-offset;\r\nif( tree )\r\n{\r\nanItem = proto_tree_add_bytes_format(tree, hf_ecat_mailbox_foe, tvb, offset, foe_length, NULL, "Foe");\r\naparent = proto_item_get_parent(anItem);\r\nproto_item_append_text(aparent,"FoE ");\r\n}\r\nif( foe_length >= ETHERCAT_FOE_HEADER_LEN )\r\n{\r\nFoeFormatter(tvb, offset, szText, nMax, foe_length);\r\ncol_append_str(pinfo->cinfo, COL_INFO, szText);\r\nif( tree )\r\n{\r\nETHERCAT_FOE_HEADER foe;\r\ninit_foe_header(&foe, tvb, offset);\r\necat_foe_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_foe);\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_opmode, tvb, offset++, 1, ENC_LITTLE_ENDIAN);\r\noffset++;\r\nswitch (foe.OpMode)\r\n{\r\ncase ECAT_FOE_OPMODE_RRQ:\r\ncase ECAT_FOE_OPMODE_WRQ:\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_filelength, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_filename, tvb, offset, foe_length-offset, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_DATA:\r\n{\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_packetno, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_data, tvb, offset, foe_length-offset, ENC_NA);\r\nif( foe_length-offset >= sizeof(TEFWUPDATE_HEADER) )\r\n{\r\nanItem = proto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_efw, tvb, offset, foe_length-offset, ENC_NA);\r\necat_foe_efw_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox_foe_efw);\r\nproto_tree_add_item(ecat_foe_efw_tree, hf_ecat_mailbox_foe_efw_cmd, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_foe_efw_tree, hf_ecat_mailbox_foe_efw_size, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_foe_efw_tree, hf_ecat_mailbox_foe_efw_addresslw, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_foe_efw_tree, hf_ecat_mailbox_foe_efw_addresshw, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_foe_efw_tree, hf_ecat_mailbox_foe_efw_data, tvb, offset, foe_length-offset, ENC_NA);\r\n}\r\n}\r\nbreak;\r\ncase ECAT_FOE_OPMODE_ACK:\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_packetno, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_ERR:\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_errcode, tvb, offset, 4, ENC_LITTLE_ENDIAN);\r\noffset+=4;\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_errtext, tvb, offset, foe_length-offset, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase ECAT_FOE_OPMODE_BUSY:\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_busydone, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_foe_tree, hf_ecat_mailbox_foe_busyentire, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\nbreak;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\ncol_append_str(pinfo->cinfo, COL_INFO, "FoE - invalid length");\r\nexpert_add_info(pinfo, tree, &ei_ecat_mailbox_foe_error);\r\n}\r\n}\r\nstatic int dissect_ecat_mailbox(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *ecat_mailbox_tree = NULL;\r\nproto_tree *ecat_mailbox_header_tree = NULL;\r\ntvbuff_t *next_tvb;\r\nproto_item *anItem;\r\ngint offset = 0;\r\ngint mailbox_length = tvb_reported_length(tvb);\r\nif( mailbox_length >= ETHERCAT_MBOX_HEADER_LEN )\r\n{\r\nETHERCAT_MBOX_HEADER hdr;\r\ninit_mbx_header(&hdr, tvb, offset);\r\ncol_append_str(pinfo->cinfo, COL_INFO, " Mbx(");\r\nanItem = proto_tree_add_item(tree, proto_ecat_mailbox, tvb, 0, ETHERCAT_MBOX_HEADER_LEN+hdr.Length, ENC_NA);\r\necat_mailbox_tree = proto_item_add_subtree(anItem, ett_ecat_mailbox);\r\necat_mailbox_header_tree = proto_tree_add_subtree(ecat_mailbox_tree, tvb, offset, ETHERCAT_MBOX_HEADER_LEN, ett_ecat_mailbox_header, NULL, "Header");\r\nproto_tree_add_item(ecat_mailbox_header_tree, hf_ecat_mailboxlength, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_mailbox_header_tree, hf_ecat_mailboxaddress, tvb, offset, 2, ENC_LITTLE_ENDIAN);\r\noffset+=2;\r\nproto_tree_add_item(ecat_mailbox_header_tree, hf_ecat_mailboxpriority, tvb, offset, 1, ENC_LITTLE_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_uint(ecat_mailbox_header_tree, hf_ecat_mailboxtype, tvb, offset, 1, hdr.aControlUnion.v.Type);\r\nproto_tree_add_uint(ecat_mailbox_header_tree, hf_ecat_mailboxcounter, tvb, offset, 1, hdr.aControlUnion.v.Counter);\r\noffset++;\r\nif( mailbox_length >= ETHERCAT_MBOX_HEADER_LEN + hdr.Length )\r\n{\r\nnext_tvb = tvb_new_subset_length (tvb, offset, hdr.Length);\r\nswitch ( hdr.aControlUnion.v.Type )\r\n{\r\ncase ETHERCAT_MBOX_TYPE_ADS:\r\ncall_dissector(ams_handle, next_tvb, pinfo, ecat_mailbox_tree);\r\nbreak;\r\ncase ETHERCAT_MBOX_TYPE_EOE:\r\ndissect_ecat_eoe(next_tvb, 0, pinfo, ecat_mailbox_tree);\r\nbreak;\r\ncase ETHERCAT_MBOX_TYPE_COE:\r\ndissect_ecat_coe(next_tvb, 0, pinfo, ecat_mailbox_tree);\r\nbreak;\r\ncase ETHERCAT_MBOX_TYPE_FOE:\r\ndissect_ecat_foe(next_tvb, 0, pinfo, ecat_mailbox_tree);\r\nbreak;\r\ncase ETHERCAT_MBOX_TYPE_SOE:\r\ndissect_ecat_soe(next_tvb, 0, pinfo, ecat_mailbox_tree);\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(ecat_mailbox_tree, hf_ecat_mailboxdata, tvb, offset, hdr.Length, ENC_NA);\r\n}\r\n}\r\nelse\r\n{\r\nanItem =proto_tree_add_item(ecat_mailbox_tree, hf_ecat_mailboxdata, tvb, offset, mailbox_length-ETHERCAT_MBOX_HEADER_LEN, ENC_NA);\r\nexpert_add_info_format(pinfo, anItem, &ei_ecat_mailbox_error,"Incorrect Mailbox data length(Expected:%d Actual:%d)", hdr.Length, mailbox_length-ETHERCAT_MBOX_HEADER_LEN);\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, ")");\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid proto_register_ecat_mailbox(void)\r\n{\r\nstatic const true_false_string flags_set_truth =\r\n{\r\n"Set",\r\n"Not set"\r\n};\r\nstatic hf_register_info hf[] =\r\n{\r\n{ &hf_ecat_mailboxlength,\r\n{ "Length", "ecat_mailbox.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailboxaddress,\r\n{ "Address", "ecat_mailbox.address",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailboxpriority,\r\n{ "Priority", "ecat_mailbox.priority",\r\nFT_UINT8, BASE_DEC, NULL, 0x03,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailboxtype,\r\n{ "Type", "ecat_mailbox.type",\r\nFT_UINT8, BASE_DEC, VALS(EcMBoxType), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailboxcounter,\r\n{ "Counter", "ecat_mailbox.counter",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe,\r\n{ "EoE Fragment", "ecat_mailbox.eoe",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_fraghead,\r\n{ "Header", "ecat_mailbox.eoe.fraghead",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_type,\r\n{ "Type", "ecat_mailbox.eoe.type",\r\nFT_UINT32, BASE_DEC, VALS(EoEType), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_fragno,\r\n{ "FragNo", "ecat_mailbox.eoe.fragno",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_offset,\r\n{ "Offset", "ecat_mailbox.eoe.offset",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL}\r\n},\r\n{ &hf_ecat_mailbox_eoe_frame,\r\n{ "FrameNo", "ecat_mailbox.eoe.frame",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_last,\r\n{ "Last Fragment", "ecat_mailbox.eoe.last",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_timestampapp,\r\n{ "Time Stamp Appended", "ecat_mailbox.eoe.timestampapp",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_timestampreq,\r\n{ "Time Stamp Requested", "ecat_mailbox.eoe.timestampreq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_fragment,\r\n{ "EoE Frag Data", "ecat_mailbox.eoe.fragment",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init,\r\n{ "Init", "ecat_mailbox.eoe.init",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_macaddr,\r\n{ "MacAddr", "ecat_mailbox.eoe.init.contains_macaddr",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000001, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_ipaddr,\r\n{ "IpAddr", "ecat_mailbox.eoe.init.contains_ipaddr",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000002, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_subnetmask,\r\n{ "SubnetMask", "ecat_mailbox.eoe.init.contains_subnetmask",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000004, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_defaultgateway,\r\n{ "DefaultGateway", "ecat_mailbox.eoe.init.contains_defaultgateway",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000008, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_dnsserver,\r\n{ "DnsServer", "ecat_mailbox.eoe.init.contains_dnsserver",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000010, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_contains_dnsname,\r\n{ "DnsName", "ecat_mailbox.eoe.init.contains_dnsname",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00000020, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_append_timestamp,\r\n{ "AppendTimeStamp", "ecat_mailbox.eoe.init.append_timestamp",\r\nFT_BOOLEAN, 32, TFS(&flags_set_truth), 0x00010000, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_macaddr,\r\n{ "Mac Addr", "ecat_mailbox.eoe.init.macaddr",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_ipaddr,\r\n{ "Ip Addr", "ecat_mailbox.eoe.init.ipaddr",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_subnetmask,\r\n{ "Subnet Mask", "ecat_mailbox.eoe.init.subnetmask",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_defaultgateway,\r\n{ "Default Gateway", "ecat_mailbox.eoe.init.defaultgateway",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_dnsserver,\r\n{ "Dns Server", "ecat_mailbox.eoe.init.dnsserver",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_init_dnsname,\r\n{ "Dns Name", "ecat_mailbox.eoe.init.dnsname",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter,\r\n{ "Mac Filter", "ecat_mailbox.eoe.macfilter",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_macfiltercount,\r\n{ "Mac Filter Count", "ecat_mailbox.eoe.macfilter.macfiltercount",\r\nFT_UINT16, BASE_DEC, NULL, 0xF000, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_maskcount,\r\n{ "Mac Filter Mask Count", "ecat_mailbox.eoe.macfilter.maskcount",\r\nFT_UINT16, BASE_DEC, NULL, 0x0C00, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_nobroadcasts,\r\n{ "No Broadcasts", "ecat_mailbox.eoe.macfilter.nobroadcasts",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x0100, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filter,\r\n{ "Filter", "ecat_mailbox.eoe.macfilter.filter",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[0],\r\n{ "Filter 0", "ecat_mailbox.eoe.macfilter.filter0",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[1],\r\n{ "Filter 1", "ecat_mailbox.eoe.macfilter.filter1",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[2],\r\n{ "Filter 2", "ecat_mailbox.eoe.macfilter.filter2",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[3],\r\n{ "Filter 3", "ecat_mailbox.eoe.macfilter.filter3",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[4],\r\n{ "Filter 4", "ecat_mailbox.eoe.macfilter.filter4",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[5],\r\n{ "Filter 5", "ecat_mailbox.eoe.macfilter.filter5",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[6],\r\n{ "Filter 6", "ecat_mailbox.eoe.macfilter.filter6",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[7],\r\n{ "Filter 7", "ecat_mailbox.eoe.macfilter.filter7",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[8],\r\n{ "Filter 8", "ecat_mailbox.eoe.macfilter.filter8",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[9],\r\n{ "Filter 9", "ecat_mailbox.eoe.macfilter.filter9",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[10],\r\n{ "Filter 10", "ecat_mailbox.eoe.macfilter.filter10",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[11],\r\n{ "Filter 11", "ecat_mailbox.eoe.macfilter.filter11",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[12],\r\n{ "Filter 12", "ecat_mailbox.eoe.macfilter.filter12",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[13],\r\n{ "Filter 13", "ecat_mailbox.eoe.macfilter.filter13",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[14],\r\n{ "Filter 14", "ecat_mailbox.eoe.macfilter.filter14",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filters[15],\r\n{ "Filter 15", "ecat_mailbox.eoe.macfilter.filter15",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filtermask,\r\n{ "Filter Mask", "ecat_mailbox.eoe.macfilter.filtermask",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filtermasks[0],\r\n{ "Mask 0", "ecat_mailbox.eoe.macfilter.filtermask0",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filtermasks[1],\r\n{ "Mask 1", "ecat_mailbox.eoe.macfilter.filtermask1",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filtermasks[2],\r\n{ "Mask 2", "ecat_mailbox.eoe.macfilter.filtermask2",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_macfilter_filtermasks[3],\r\n{ "Mask 3", "ecat_mailbox.eoe.macfilter.filtermask3",\r\nFT_ETHER, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_eoe_timestamp,\r\n{ "Time Stamp", "ecat_mailbox.eoe.timestamp",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe,\r\n{ "CoE", "ecat_mailbox.coe",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_number,\r\n{ "Number", "ecat_mailbox.coe.number",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_type,\r\n{ "Type", "ecat_mailbox.coe.type",\r\nFT_UINT16, BASE_DEC, VALS(CANopenType), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoreq,\r\n{ "SDO Req", "ecat_mailbox.coe.sdoreq",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid,\r\n{ "Initiate Download", "ecat_mailbox.coe.sdoccsid",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid_sizeind,\r\n{ "Size Ind.", "ecat_mailbox.coe.sdoccsid.sizeind",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000001,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid_expedited,\r\n{ "Expedited", "ecat_mailbox.coe.sdoccsid.expedited",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000002,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid_size0,\r\n{ "Bytes", "ecat_mailbox.coe.sdoccsid.size0",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000004,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid_size1,\r\n{ "Bytes", "ecat_mailbox.coe.sdoccsid.size1",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000008,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsid_complete,\r\n{ "Access", "ecat_mailbox.coe.sdoccsid.complete",\r\nFT_BOOLEAN, 8, TFS(&tfs_complete), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsds,\r\n{ "Download Segment", "ecat_mailbox.coe.sdoccsds",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsds_lastseg,\r\n{ "Last Segment", "ecat_mailbox.coe.sdoccsds.lastseg",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000001,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsds_size,\r\n{ "Size", "ecat_mailbox.coe.sdoccsds.size",\r\nFT_UINT8, BASE_DEC, NULL, 0x0000000E,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsds_toggle,\r\n{ "Toggle Bit", "ecat_mailbox.coe.sdoccsds.toggle",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsiu,\r\n{ "Init Upload", "ecat_mailbox.coe.sdoccsiu",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_ecat_mailbox_coe_sdoccsiu_complete,\r\n{ "Toggle Bit", "ecat_mailbox.coe.sdoccsiu_complete",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_ecat_mailbox_coe_sdoccsus,\r\n{ "Upload Segment", "ecat_mailbox.coe.sdoccsus",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoccsus_toggle,\r\n{ "Toggle Bit", "ecat_mailbox.coe.sdoccsus_toggle",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoidx,\r\n{ "Index", "ecat_mailbox.coe.sdoidx",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdosub,\r\n{ "SubIndex", "ecat_mailbox.coe.sdosub",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdodata,\r\n{ "Data", "ecat_mailbox.coe.sdodata",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdodata1,\r\n{ "Data", "ecat_mailbox.coe.sdodata",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdodata2,\r\n{ "Data", "ecat_mailbox.coe.sdodata",\r\nFT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoldata,\r\n{ "Data", "ecat_mailbox.coe.dsoldata",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdolength,\r\n{ "Length", "ecat_mailbox.coe.sdolength",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_ecat_mailbox_coe_sdoerror,\r\n{ "SDO Error", "ecat_mailbox.coe.sdoerror",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_ecat_mailbox_coe_sdores,\r\n{ "SDO Res", "ecat_mailbox.coe.sdores",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu,\r\n{ "Initiate Upload Response", "ecat_mailbox.coe.sdoscsiu",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu_sizeind,\r\n{ "Size Ind.", "ecat_mailbox.coe.sdoscsiu_sizeind",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000001,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu_expedited,\r\n{ "Expedited", "ecat_mailbox.coe.sdoscsiu_expedited",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000002,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu_size0,\r\n{ "Bytes", "ecat_mailbox.coe.sdoscsiu_size0",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000004,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu_size1,\r\n{ "Bytes", "ecat_mailbox.coe.sdoscsiu_size1",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000008,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsiu_complete,\r\n{ "Access", "ecat_mailbox.coe.sdoscsiu_complete",\r\nFT_BOOLEAN, 8, TFS(&tfs_complete), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsds,\r\n{ "Download Segment Response", "ecat_mailbox.coe.sdoscsds",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsds_toggle,\r\n{ "Toggle Bit", "ecat_mailbox.coe.sdoscsds_toggle",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsus,\r\n{ "Upload Segment", "ecat_mailbox.coe.sdoscsus",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsus_lastseg,\r\n{ "Last Segment", "ecat_mailbox.coe.sdoscsus_lastseg",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000001,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsus_bytes,\r\n{ "Bytes", "ecat_mailbox.coe.sdoscsus_bytes",\r\nFT_UINT8, BASE_DEC, NULL, 0x0000000E,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoscsus_toggle,\r\n{ "Toggle Bit", "ecat_mailbox.coe.sdoscsus_toggle",\r\nFT_BOOLEAN, 8, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoopcode,\r\n{ "Info OpCode", "ecat_mailbox.coe.sdoinfoopcode",\r\nFT_UINT8, BASE_DEC, VALS(CANopenSdoInfo), 0x0,\r\nNULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfofrag,\r\n{ "Info Frag Left", "ecat_mailbox.coe.sdoinfofrag",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfolisttype,\r\n{ "Info List Type", "ecat_mailbox.coe.sdoinfolisttype",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfolist,\r\n{ "Info List", "ecat_mailbox.coe.sdoinfolist",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoindex,\r\n{ "Info Obj Index", "ecat_mailbox.coe.sdoinfoindex",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfosubindex,\r\n{ "Info Obj SubIdx", "ecat_mailbox.coe.sdoinfosubindex",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfovalueinfo,\r\n{ "Info Obj ValueInfo", "ecat_mailbox.coe.sdoinfovalueinfo",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoerrorcode,\r\n{ "Info Error Code", "ecat_mailbox.coe.sdoinfoerrorcode",\r\nFT_UINT32, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfodatatype,\r\n{ "Info Data Type", "ecat_mailbox.coe.sdoinfodatatype",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfomaxsub,\r\n{ "Info Max SubIdx", "ecat_mailbox.coe.sdoinfomaxsub",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoobjcode,\r\n{ "Info Obj Code", "ecat_mailbox.coe.sdoinfoobjcode",\r\nFT_UINT8, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoname,\r\n{ "Info Name", "ecat_mailbox.coe.sdoinfoname",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfobitlen,\r\n{ "Info Bit Len", "ecat_mailbox.coe.sdoinfobitlen",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfoobjaccess,\r\n{ "Info Obj Access", "ecat_mailbox.coe.sdoinfoobjaccess",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfounittype,\r\n{ "Info Data Type", "ecat_mailbox.coe.sdoinfounittype",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfodefaultvalue,\r\n{ "Info Default Val", "ecat_mailbox.coe.sdoinfodefaultvalue",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfominvalue,\r\n{ "Info Min Val", "ecat_mailbox.coe.sdoinfominvalue",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailbox_coe_sdoinfomaxvalue,\r\n{ "Info Max Val", "ecat_mailbox.coe.sdoinfomaxvalue",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL },\r\n},\r\n{ &hf_ecat_mailboxdata,\r\n{ "MB Data", "ecat_mailbox.data",\r\nFT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe,\r\n{ "Foe", "ecat_mailbox.foe",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_opmode,\r\n{ "Foe OpMode", "ecat_mailbox.foe_opmode",\r\nFT_UINT8, BASE_HEX, VALS(FoEOpMode), 0x0, "Op modes", HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_filelength,\r\n{ "Foe FileLength" , "ecat_mailbox.foe_filelength",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_filename,\r\n{ "Foe FileName", "ecat_mailbox.foe_filename",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_packetno,\r\n{ "Foe PacketNo", "ecat_mailbox.foe_packetno",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_errcode,\r\n{ "Foe ErrorCode", "ecat_mailbox.foe_errcode",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_errtext,\r\n{ "Foe ErrorString", "ecat_mailbox.foe_errtext",\r\nFT_STRING, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_busydone,\r\n{ "Foe BusyDone", "ecat_mailbox.foe_busydone",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_busyentire,\r\n{ "Foe BusyEntire", "ecat_mailbox.foe_busyentire",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_data,\r\n{ "Foe Data", "ecat_mailbox.foe_busydata",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw,\r\n{ "Firmware", "ecat_mailbox.foe.efw",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw_cmd,\r\n{ "Cmd", "ecat_mailbox.foe.efw.cmd",\r\nFT_UINT16, BASE_HEX, VALS(FoEEfwCmd), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw_size,\r\n{ "Size", "ecat_mailbox.foe.efw.size",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw_addresslw,\r\n{ "AddressLW", "ecat_mailbox.foe.efw.addresslw",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw_addresshw,\r\n{ "AddressHW", "ecat_mailbox.foe.efw.addresshw",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_foe_efw_data,\r\n{ "Data", "ecat_mailbox.foe.efw.data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe,\r\n{ "Soe", "ecat_mailbox.soe",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header,\r\n{ "Soe Header", "ecat_mailbox.soe_header",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_opcode,\r\n{ "SoE OpCode", "ecat_mailbox.soe_opcode",\r\nFT_UINT16, BASE_DEC, VALS(SoeOpcode), 0x00000007, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_incomplete,\r\n{ "More Follows...", "ecat_mailbox.soe_header_incomplete",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000008, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_error,\r\n{ "Error", "ecat_mailbox.soe_header_error",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000010,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_driveno,\r\n{ "Drive No", "ecat_mailbox.soe_header_driveno",\r\nFT_UINT16, BASE_DEC, NULL, 0x000000e0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_datastate,\r\n{ "Datastate", "ecat_mailbox.soe_header_datastate",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000100,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_name,\r\n{ "Name", "ecat_mailbox.soe_header_name",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000200,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_attribute,\r\n{ "Attribute", "ecat_mailbox.soe_header_attribute",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000400,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_unit,\r\n{ "Unit", "ecat_mailbox.soe_header_unit",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00000800,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_min,\r\n{ "Min", "ecat_mailbox.soe_header_min",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00001000,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_max,\r\n{ "Max", "ecat_mailbox.soe_header_max",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00002000,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_value,\r\n{ "Value", "ecat_mailbox.soe_header_value",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00004000,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_header_reserved,\r\n{ "Reserved", "ecat_mailbox.soe_header_reserved",\r\nFT_BOOLEAN, 16, TFS(&flags_set_truth), 0x00008000,\r\nNULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_idn,\r\n{ "SoE IDN", "ecat_mailbox.soe_idn",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_data,\r\n{ "SoE Data", "ecat_mailbox.soe_data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_frag,\r\n{ "SoE FragLeft", "ecat_mailbox.soe_frag",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_ecat_mailbox_soe_error,\r\n{ "SoE Error", "ecat_mailbox.soe_error",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_ecat_mailbox,\r\n&ett_ecat_mailbox_eoe,\r\n&ett_ecat_mailbox_eoe_init,\r\n&ett_ecat_mailbox_eoe_macfilter,\r\n&ett_ecat_mailbox_eoe_macfilter_filter,\r\n&ett_ecat_mailbox_eoe_macfilter_filtermask,\r\n&ett_ecat_mailbox_coe,\r\n&ett_ecat_mailbox_sdo,\r\n&ett_ecat_mailbox_coe_sdoccs,\r\n&ett_ecat_mailbox_coe_sdoscs,\r\n&ett_ecat_mailbox_foe,\r\n&ett_ecat_mailbox_foe_efw,\r\n&ett_ecat_mailbox_soeflag,\r\n&ett_ecat_mailbox_soe,\r\n&ett_ecat_mailbox_fraghead,\r\n&ett_ecat_mailbox_header\r\n};\r\nstatic ei_register_info ei[] =\r\n{\r\n{ &ei_ecat_mailbox_error, { "ecat_mailbox.invalid", PI_MALFORMED, PI_ERROR, "Malformed mailbox data", EXPFILL } },\r\n{ &ei_ecat_mailbox_coe_error, { "ecat_mailbox.coe.invalid", PI_MALFORMED, PI_ERROR, "Malformed CoE data", EXPFILL } },\r\n{ &ei_ecat_mailbox_foe_error, { "ecat_mailbox.foe.invalid", PI_MALFORMED, PI_ERROR, "Malformed FoE data", EXPFILL } },\r\n{ &ei_ecat_mailbox_soe_error, { "ecat_mailbox.soe.invalid", PI_MALFORMED, PI_ERROR, "Malformed SoE data", EXPFILL } },\r\n{ &ei_ecat_mailbox_eoe_error, { "ecat_mailbox.eoe.invalid", PI_MALFORMED, PI_ERROR, "Malformed EoE data", EXPFILL } },\r\n};\r\nexpert_module_t *expert_module;\r\nproto_ecat_mailbox = proto_register_protocol("EtherCAT Mailbox Protocol",\r\n"ECAT_MAILBOX", "ecat_mailbox");\r\nexpert_module = expert_register_protocol(proto_ecat_mailbox);\r\nexpert_register_field_array(expert_module, ei, array_length(ei));\r\nproto_register_field_array(proto_ecat_mailbox, hf,array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("ecat_mailbox", dissect_ecat_mailbox, proto_ecat_mailbox);\r\n}\r\nvoid proto_reg_handoff_ecat_mailbox(void)\r\n{\r\ndissector_handle_t ecat_mailbox_handle;\r\necat_mailbox_handle = find_dissector("ecat_mailbox");\r\ndissector_add_uint("ecatf.type", 5, ecat_mailbox_handle);\r\neth_handle = find_dissector_add_dependency("eth_withoutfcs", proto_ecat_mailbox);\r\nams_handle = find_dissector_add_dependency("ams", proto_ecat_mailbox);\r\n}
