static int\r\ndissect_vuze_dht_address(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset, const char* addr_name)\r\n{\r\nguint8 ip_length;\r\nproto_tree *sub_tree;\r\nproto_item *ti;\r\naddress addr;\r\nip_length = tvb_get_guint8(tvb,offset);\r\nti = proto_tree_add_none_format(tree, hf_vuze_dht_address, tvb, offset, ip_length+3, "%s: ", addr_name );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_address);\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_address_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nswitch(ip_length)\r\n{\r\ncase TL_IPv4:\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_address_v4, tvb, offset, ip_length, ENC_BIG_ENDIAN);\r\nset_address_tvb( &addr, AT_IPv4, ip_length, tvb, offset);\r\nbreak;\r\ncase TL_IPv6:\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_address_v6, tvb, offset, ip_length, ENC_NA);\r\nset_address_tvb( &addr, AT_IPv6, ip_length, tvb, offset);\r\nbreak;\r\ndefault:\r\nclear_address(&addr);\r\nbreak;\r\n}\r\noffset += ip_length;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_address_port, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\nproto_item_append_text( ti, "%s:%d", address_to_str(wmem_packet_scope(), &addr ), tvb_get_ntohs(tvb,offset) );\r\noffset += TL_SHORT;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_contact(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_contact, tvb, offset, tvb_get_guint8(tvb,offset+2)+5,\r\n"%s contact, version %d",\r\nval_to_str_const( tvb_get_guint8(tvb, offset), vuze_dht_contact_type_vals, "Unknown"),\r\ntvb_get_guint8(tvb, offset+1) );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_contact);\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_contact_type, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_proto_ver, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\noffset = dissect_vuze_dht_address( tvb, pinfo, sub_tree, offset, "Contact Address" );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_contacts(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int contacts_count)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint i;\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_contacts, tvb, offset, 0, "%d contacts", contacts_count );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_contacts);\r\nfor( i=0; i<contacts_count; i++ )\r\noffset = dissect_vuze_dht_contact( tvb, pinfo, sub_tree, offset );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_key(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nguint key_len;\r\nkey_len = tvb_get_guint8( tvb, offset );\r\nti = proto_tree_add_item( tree, hf_vuze_dht_key, tvb, offset, key_len+1, ENC_NA );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_key);\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_key_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN );\r\noffset += TL_BYTE;\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_key_data, tvb, offset, key_len, ENC_NA );\r\nproto_item_append_text( ti, ": %d bytes ( %s )", key_len, tvb_bytes_to_str(wmem_packet_scope(), tvb, offset, key_len ) );\r\noffset += key_len;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_keys(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int keys_count)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint i;\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_keys, tvb, offset, 0, "%d keys", keys_count );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_keys);\r\nfor( i=0; i<keys_count; i++ )\r\noffset = dissect_vuze_dht_key( tvb, pinfo, sub_tree, offset );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_value(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint value_ver = -1;\r\nti = proto_tree_add_item( tree, hf_vuze_dht_value, tvb, offset, 0, ENC_NA );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_value);\r\nif( ver >= PV_REMOVE_DIST_ADD_VER )\r\n{\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_ver, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\nvalue_ver = tvb_get_ntohl( tvb, offset );\r\noffset += TL_INT;\r\n}\r\nif( value_ver==0 )\r\n{\r\nproto_item_append_text( ti,\r\n" (reply to STATS): %d values for the key, out of %d in total...",\r\ntvb_get_ntohl(tvb, offset), tvb_get_ntohl(tvb, offset+TL_INT) );\r\nproto_tree_add_item(tree, hf_vuze_dht_values_num, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_values_total, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_reads_per_min, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_diversification_type, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nelse\r\n{\r\nint value_bytes_count;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_created, tvb, offset, TL_LONG, ENC_BIG_ENDIAN);\r\noffset += TL_LONG;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_bytes_count, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\nvalue_bytes_count = tvb_get_ntohs(tvb, offset);\r\noffset += TL_SHORT;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_bytes, tvb, offset, value_bytes_count, ENC_NA);\r\nproto_item_append_text( ti, ": %d bytes ( %s )", value_bytes_count, tvb_bytes_to_str(wmem_packet_scope(), tvb, offset, value_bytes_count ) );\r\noffset += value_bytes_count;\r\noffset = dissect_vuze_dht_contact( tvb, pinfo, sub_tree, offset );\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_flags, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_life_hours, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nproto_tree_add_item(sub_tree, hf_vuze_dht_value_replication_factor, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_value_group(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint values_count;\r\nint i;\r\nvalues_count = tvb_get_ntohs( tvb, offset );\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_value_group, tvb, offset, 0, "%d values", values_count );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_value_group);\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_values_count, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN );\r\noffset += TL_SHORT;\r\nfor( i=0; i<values_count; i++ )\r\noffset = dissect_vuze_dht_value( tvb, pinfo, sub_tree, offset, ver );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_value_groups(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int value_groups_count, int ver)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint i;\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_value_groups, tvb, offset, 0, "%d value groups", value_groups_count );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_value_groups);\r\nfor( i=0; i<value_groups_count; i++ )\r\noffset = dissect_vuze_dht_value_group( tvb, pinfo, sub_tree, offset, ver );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_network_coordinate(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nguint coordinate_size;\r\nguint coordinate_type;\r\ncoordinate_type = tvb_get_guint8( tvb, offset );\r\ncoordinate_size = tvb_get_guint8( tvb, offset+1 );\r\nti = proto_tree_add_item( tree, hf_vuze_dht_network_coordinate, tvb, offset, coordinate_size+2, ENC_NA );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_network_coordinate);\r\nproto_item_append_text( ti, ": type %d, length %d", tvb_get_guint8(tvb,offset), tvb_get_guint8(tvb,offset+TL_BYTE) );\r\nif (coordinate_type == NC_VIVALDI) {\r\nproto_item_append_text( ti, " ( %.2f, %.2f, %.2f, %.2f )",\r\ntvb_get_ntohieee_float(tvb, offset+TL_BYTE+TL_BYTE),\r\ntvb_get_ntohieee_float(tvb, offset+TL_BYTE+TL_BYTE+TL_FLOAT),\r\ntvb_get_ntohieee_float(tvb, offset+TL_BYTE+TL_BYTE+TL_FLOAT+TL_FLOAT),\r\ntvb_get_ntohieee_float(tvb, offset+TL_BYTE+TL_BYTE+TL_FLOAT+TL_FLOAT+TL_FLOAT) );\r\n} else {\r\nproto_item_append_text( ti, " ( %s )",\r\ntvb_bytes_to_str(wmem_packet_scope(), tvb, offset+TL_BYTE+TL_BYTE, coordinate_size ) );\r\n}\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_type, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN );\r\noffset += TL_BYTE;\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_size, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN );\r\noffset += TL_BYTE;\r\nif (coordinate_type == NC_VIVALDI) {\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_x, tvb, offset, TL_FLOAT, ENC_BIG_ENDIAN );\r\noffset += TL_FLOAT;\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_y, tvb, offset, TL_FLOAT, ENC_BIG_ENDIAN );\r\noffset += TL_FLOAT;\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_height, tvb, offset, TL_FLOAT, ENC_BIG_ENDIAN );\r\noffset += TL_FLOAT;\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_error, tvb, offset, TL_FLOAT, ENC_BIG_ENDIAN );\r\noffset += TL_FLOAT;\r\n} else {\r\nproto_tree_add_item( sub_tree, hf_vuze_dht_network_coordinate_data, tvb, offset, coordinate_size, ENC_NA );\r\noffset += coordinate_size;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_network_coordinates(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nguint i;\r\nguint network_coordinates_count;\r\nif( ver >= PV_GENERIC_NETPOS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_network_coordinates_count, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nnetwork_coordinates_count = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nti = proto_tree_add_none_format( tree, hf_vuze_dht_network_coordinates, tvb, offset, 0, "%d network coordinates", network_coordinates_count );\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht_network_coordinates);\r\nfor( i=0; i<network_coordinates_count; i++ )\r\noffset = dissect_vuze_dht_network_coordinate( tvb, pinfo, sub_tree, offset );\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_request_header(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int *action, int *ver )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_connection_id, tvb, offset, TL_LONG, ENC_BIG_ENDIAN);\r\noffset += TL_LONG;\r\nproto_tree_add_item(tree, hf_vuze_dht_action, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\n*action = tvb_get_ntohl(tvb, offset);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " Action: %s", val_to_str_const( *action, vuze_dht_action_type_vals, "Unknown") );\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_transaction_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_proto_ver, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\n*ver = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nif( *ver >= PV_VENDOR_ID )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_vendor_id, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nif( *ver >= PV_NETWORKS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_network_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nif( *ver >= PV_FIX_ORIGINATOR )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_local_proto_ver, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\noffset = dissect_vuze_dht_address(tvb, pinfo, tree, offset, "Local Address");\r\nproto_tree_add_item(tree, hf_vuze_dht_instance_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_time, tvb, offset, TL_LONG, ENC_BIG_ENDIAN);\r\noffset += TL_LONG;\r\nif( *ver >= PV_PACKET_FLAGS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_generic_flags, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nif( *ver >= PV_PACKET_FLAGS2 )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_generic_flags2, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_header(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int *action, int *ver )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_action, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\n*action = tvb_get_ntohl(tvb, offset);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " Action: %s", val_to_str_const( *action, vuze_dht_action_type_vals, "Unknown") );\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_transaction_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_connection_id, tvb, offset, TL_LONG, ENC_BIG_ENDIAN);\r\noffset += TL_LONG;\r\nproto_tree_add_item(tree, hf_vuze_dht_proto_ver, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\n*ver = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nif( *ver >= PV_VENDOR_ID )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_vendor_id, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nif( *ver >= PV_NETWORKS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_network_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nproto_tree_add_item(tree, hf_vuze_dht_instance_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nif( *ver >= PV_PACKET_FLAGS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_generic_flags, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nif( *ver >= PV_PACKET_FLAGS2 )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_generic_flags2, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_ping(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nif( ver >= PV_VIVALDI )\r\n{\r\noffset = dissect_vuze_dht_network_coordinates( tvb, pinfo, tree, offset, ver );\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_request_store(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nguint8 keys_count, value_groups_count;\r\nif( ver >= PV_ANTI_SPOOF )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_spoof_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nproto_tree_add_item(tree, hf_vuze_dht_keys_count, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nkeys_count = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\noffset = dissect_vuze_dht_keys( tvb, pinfo, tree, offset, keys_count );\r\nproto_tree_add_item(tree, hf_vuze_dht_value_groups_count, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nvalue_groups_count = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\noffset = dissect_vuze_dht_value_groups( tvb, pinfo, tree, offset, value_groups_count, ver );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_store(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nif( ver >= PV_DIV_AND_CONT )\r\n{\r\nguint diversifications_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_diversifications_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\ndiversifications_len = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nproto_tree_add_item(tree, hf_vuze_dht_diversifications, tvb, offset, diversifications_len, ENC_NA);\r\noffset += diversifications_len;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_request_find_node(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nguint id_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_id_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nid_len = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nproto_tree_add_item(tree, hf_vuze_dht_id, tvb, offset, id_len, ENC_NA);\r\noffset += id_len;\r\nif( ver >= PV_MORE_NODE_STATUS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_node_status, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_size, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_find_node(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nguint contacts_count;\r\nif( ver >= PV_ANTI_SPOOF )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_spoof_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nif( ver >= PV_XFER_STATUS )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_node_type, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nif( ver >= PV_SIZE_ESTIMATE )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_size, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\n}\r\nif( ver >= PV_VIVALDI )\r\n{\r\noffset = dissect_vuze_dht_network_coordinates( tvb, pinfo, tree, offset, ver );\r\n}\r\nproto_tree_add_item(tree, hf_vuze_dht_contacts_count, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\ncontacts_count = tvb_get_ntohs( tvb, offset );\r\noffset += TL_SHORT;\r\noffset = dissect_vuze_dht_contacts( tvb, pinfo, tree, offset, contacts_count );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_request_find_value(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver _U_ )\r\n{\r\noffset = dissect_vuze_dht_key( tvb, pinfo, tree, offset );\r\nproto_tree_add_item(tree, hf_vuze_dht_flags, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nproto_tree_add_item(tree, hf_vuze_dht_max_values, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_find_value(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver )\r\n{\r\nguint8 has_values;\r\nguint contacts_count;\r\nif( ver >= PV_DIV_AND_CONT )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_has_continuation, tvb, offset, TL_BOOL, ENC_BIG_ENDIAN);\r\noffset += TL_BOOL;\r\n}\r\nproto_tree_add_item(tree, hf_vuze_dht_has_values, tvb, offset, TL_BOOL, ENC_BIG_ENDIAN);\r\nhas_values = tvb_get_guint8( tvb, offset );\r\noffset += TL_BOOL;\r\nif( has_values )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_contacts_count, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\ncontacts_count = tvb_get_ntohs( tvb, offset );\r\noffset += TL_SHORT;\r\noffset = dissect_vuze_dht_contacts( tvb, pinfo, tree, offset, contacts_count );\r\nif( ver >= PV_VIVALDI_FINDVALUE )\r\n{\r\noffset = dissect_vuze_dht_network_coordinates( tvb, pinfo, tree, offset, ver );\r\n}\r\nif( ver >= PV_DIV_AND_CONT )\r\n{\r\nproto_tree_add_item(tree, hf_vuze_dht_diversification_type, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\noffset += TL_BYTE;\r\n}\r\noffset = dissect_vuze_dht_value_group( tvb, pinfo, tree, offset, ver );\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_reply_error(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset, int ver _U_ )\r\n{\r\nguint error_type;\r\nguint8 key_block_request_len;\r\nguint signature_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_error_type, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\nerror_type = tvb_get_ntohl( tvb, offset );\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " Error: %s", val_to_str_const( error_type, vuze_dht_error_type_vals, "Unknown") );\r\noffset += TL_INT;\r\nswitch(error_type)\r\n{\r\ncase ET_WRONG_ADDRESS:\r\noffset = dissect_vuze_dht_address( tvb, pinfo, tree, offset, "Sender Address" );\r\nbreak;\r\ncase ET_KEY_BLOCKED:\r\nproto_tree_add_item(tree, hf_vuze_dht_key_block_request_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nkey_block_request_len = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nproto_tree_add_item(tree, hf_vuze_dht_key_block_request, tvb, offset, key_block_request_len, ENC_NA);\r\noffset += key_block_request_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_signature_len, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\nsignature_len = tvb_get_ntohs( tvb, offset );\r\noffset += TL_SHORT;\r\nproto_tree_add_item(tree, hf_vuze_dht_signature, tvb, offset, signature_len, ENC_NA);\r\noffset += signature_len;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht_request_key_block(tvbuff_t *tvb, packet_info _U_*pinfo, proto_tree *tree, int offset, int ver _U_ )\r\n{\r\nguint8 key_block_request_len;\r\nguint signature_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_spoof_id, tvb, offset, TL_INT, ENC_BIG_ENDIAN);\r\noffset += TL_INT;\r\nproto_tree_add_item(tree, hf_vuze_dht_key_block_request_len, tvb, offset, TL_BYTE, ENC_BIG_ENDIAN);\r\nkey_block_request_len = tvb_get_guint8( tvb, offset );\r\noffset += TL_BYTE;\r\nproto_tree_add_item(tree, hf_vuze_dht_key_block_request, tvb, offset, key_block_request_len, ENC_NA);\r\noffset += key_block_request_len;\r\nproto_tree_add_item(tree, hf_vuze_dht_signature_len, tvb, offset, TL_SHORT, ENC_BIG_ENDIAN);\r\nsignature_len = tvb_get_ntohs( tvb, offset );\r\noffset += TL_SHORT;\r\nproto_tree_add_item(tree, hf_vuze_dht_signature, tvb, offset, signature_len, ENC_NA);\r\noffset += signature_len;\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_vuze_dht(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *sub_tree;\r\nint action, proto_ver;\r\nint decoded_length = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "Vuze-DHT");\r\ncol_clear( pinfo->cinfo, COL_INFO);\r\nti = proto_tree_add_item(tree, proto_vuze_dht, tvb, 0, -1, ENC_NA);\r\nsub_tree = proto_item_add_subtree(ti, ett_vuze_dht);\r\nif( tvb_get_guint8(tvb,0) & 0x80 )\r\n{\r\ndecoded_length = dissect_vuze_dht_request_header(tvb, pinfo, sub_tree, decoded_length, &action, &proto_ver );\r\n}\r\nelse\r\n{\r\ndecoded_length = dissect_vuze_dht_reply_header(tvb, pinfo, sub_tree, decoded_length, &action, &proto_ver );\r\n}\r\nswitch( action )\r\n{\r\ncase AT_PING_REQUEST:\r\nbreak;\r\ncase AT_PING_REPLY:\r\ndecoded_length = dissect_vuze_dht_reply_ping(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_STORE_REQUEST:\r\ndecoded_length = dissect_vuze_dht_request_store(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_STORE_REPLY:\r\ndecoded_length = dissect_vuze_dht_reply_store(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_FIND_NODE_REQUEST:\r\ndecoded_length = dissect_vuze_dht_request_find_node(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_FIND_NODE_REPLY:\r\ndecoded_length = dissect_vuze_dht_reply_find_node(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_FIND_VALUE_REQUEST:\r\ndecoded_length = dissect_vuze_dht_request_find_value(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_FIND_VALUE_REPLY:\r\ndecoded_length = dissect_vuze_dht_reply_find_value(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_ERROR_REPLY:\r\ndecoded_length = dissect_vuze_dht_reply_error(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ncase AT_KEY_BLOCK_REQUEST:\r\ndecoded_length = dissect_vuze_dht_request_key_block(tvb, pinfo, sub_tree, decoded_length, proto_ver );\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn decoded_length;\r\n}\r\nvoid\r\nproto_register_vuze_dht(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_vuze_dht_address,\r\n{ "Address", "vuze-dht.address",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_address_len,\r\n{ "Address Length", "vuze-dht.address.length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_address_v4,\r\n{ "IPv4 Address", "vuze-dht.address.ipv4",\r\nFT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_address_v6,\r\n{ "IPv6 Address", "vuze-dht.address.ipv6",\r\nFT_IPv6, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_address_port,\r\n{ "Port", "vuze-dht.address.port",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_contact,\r\n{ "Contact", "vuze-dht.contact",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_contact_type,\r\n{ "Contact Type", "vuze-dht.contact.type",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_contact_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_proto_ver,\r\n{ "Protocol Version", "vuze-dht.proto_ver",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value,\r\n{ "Value", "vuze-dht.value",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_ver,\r\n{ "Value Version", "vuze-dht.value.ver",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_created,\r\n{ "Value Creation Time", "vuze-dht.value.creation_time",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_bytes_count,\r\n{ "Value Bytes Count", "vuze-dht.value.bytes_count",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_bytes,\r\n{ "Value Bytes", "vuze-dht.value.bytes",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_flags,\r\n{ "Value Flags", "vuze-dht.value.flags",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_life_hours,\r\n{ "Value Life Hours", "vuze-dht.value.life_hours",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_replication_factor,\r\n{ "Value Replication Factor", "vuze-dht.value.replication_factor",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_connection_id,\r\n{ "Connection ID", "vuze-dht.connection_id",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_action,\r\n{ "Action", "vuze-dht.action",\r\nFT_UINT32, BASE_DEC, VALS(vuze_dht_action_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_transaction_id,\r\n{ "Transaction ID", "vuze-dht.transaction_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_vendor_id,\r\n{ "Vendor ID", "vuze-dht.vendor_id",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_id,\r\n{ "Network ID", "vuze-dht.network_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_local_proto_ver,\r\n{ "Local Protocol Version", "vuze-dht.local_proto_ver",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_instance_id,\r\n{ "Instance ID", "vuze-dht.instance_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_time,\r\n{ "Time", "vuze-dht.time",\r\nFT_UINT64, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinates_count,\r\n{ "Network Coordinates Count", "vuze-dht.network_coordinates_count",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinates,\r\n{ "Network Coordinates", "vuze-dht.network_coordinates",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate,\r\n{ "Network Coordinate", "vuze-dht.network_coordinate",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_type,\r\n{ "Network Coordinate Type", "vuze-dht.network_coordinate.type",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_network_coordinate_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_size,\r\n{ "Network Coordinate Size", "vuze-dht.network_coordinate.size",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_data,\r\n{ "Network Coordinate Data", "vuze-dht.network_coordinate.data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_x,\r\n{ "Network Coordinate X", "vuze-dht.network_coordinate.x",\r\nFT_FLOAT, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_y,\r\n{ "Network Coordinate Y", "vuze-dht.network_coordinate.y",\r\nFT_FLOAT, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_height,\r\n{ "Network Coordinate Height", "vuze-dht.network_coordinate.height",\r\nFT_FLOAT, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_network_coordinate_error,\r\n{ "Network Coordinate Error", "vuze-dht.network_coordinate.error",\r\nFT_FLOAT, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_spoof_id,\r\n{ "Spoof ID", "vuze-dht.spoof_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_keys_count,\r\n{ "Keys Count", "vuze-dht.keys_count",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_keys,\r\n{ "Keys", "vuze-dht.keys",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_key,\r\n{ "Key", "vuze-dht.key",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_key_len,\r\n{ "Key Length", "vuze-dht.key.len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_key_data,\r\n{ "Key Data", "vuze-dht.key.data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_values_count,\r\n{ "Values Count", "vuze-dht.values_count",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_groups_count,\r\n{ "Value Groups Count", "vuze-dht.value_groups_count",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_group,\r\n{ "Values", "vuze-dht.values",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_value_groups,\r\n{ "Value Groups", "vuze-dht.value_groups",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_diversifications_len,\r\n{ "Diversifications Length", "vuze-dht.diversifications_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_diversifications,\r\n{ "Diversifications", "vuze-dht.diversifications",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_id_len,\r\n{ "ID Length", "vuze-dht.id_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_id,\r\n{ "ID", "vuze-dht.id",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_node_status,\r\n{ "Node Status", "vuze-dht.node_status",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_size,\r\n{ "DHT Size", "vuze-dht.dht_size",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_node_type,\r\n{ "Node Type", "vuze-dht.node_type",\r\nFT_UINT32, BASE_DEC, VALS(vuze_dht_node_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_contacts_count,\r\n{ "Contacts Count", "vuze-dht.contacts_count",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_contacts,\r\n{ "Contacts", "vuze-dht.contacts",\r\nFT_NONE, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_flags,\r\n{ "Flags", "vuze-dht.flags",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_flag_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_values_num,\r\n{ "Values Num", "vuze-dht.stats.values_num",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_values_total,\r\n{ "Values Total", "vuze-dht.stats.values_total",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_reads_per_min,\r\n{ "Reads Per Minute", "vuze-dht.stats.reads_per_min",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_diversification_type,\r\n{ "Diversification Type", "vuze-dht.stats.diversification_type",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_max_values,\r\n{ "Max values", "vuze-dht.max_values",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_has_continuation,\r\n{ "Has Continuation", "vuze-dht.has_continuation",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_bool_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_has_values,\r\n{ "Has Values", "vuze-dht.has_values",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_bool_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_error_type,\r\n{ "Error Type", "vuze-dht.error_type",\r\nFT_UINT32, BASE_DEC, VALS(vuze_dht_error_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_key_block_request_len,\r\n{ "Key Block Request Length", "vuze-dht.key_block_request_len",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_key_block_request,\r\n{ "Key Block Request", "vuze-dht.key_block_request",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_signature_len,\r\n{ "Signature Length", "vuze-dht.signature_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_signature,\r\n{ "Signature", "vuze-dht.signature",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_generic_flags,\r\n{ "Generic Flags", "vuze-dht.generic_flags",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_generic_flag_type_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_vuze_dht_generic_flags2,\r\n{ "Generic Flags 2", "vuze-dht.generic_flags2",\r\nFT_UINT8, BASE_DEC, VALS(vuze_dht_flag_type_vals), 0x0,\r\nNULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_vuze_dht,\r\n&ett_vuze_dht_address,\r\n&ett_vuze_dht_contacts,\r\n&ett_vuze_dht_contact,\r\n&ett_vuze_dht_keys,\r\n&ett_vuze_dht_key,\r\n&ett_vuze_dht_value_groups,\r\n&ett_vuze_dht_value_group,\r\n&ett_vuze_dht_value,\r\n&ett_vuze_dht_network_coordinates,\r\n&ett_vuze_dht_network_coordinate\r\n};\r\nmodule_t *vuze_dht_module;\r\nproto_vuze_dht = proto_register_protocol (\r\n"Vuze DHT Protocol",\r\n"Vuze-DHT",\r\n"vuze-dht"\r\n);\r\nproto_register_field_array(proto_vuze_dht, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nvuze_dht_handle = register_dissector("vuze-dht", dissect_vuze_dht, proto_vuze_dht);\r\nvuze_dht_module = prefs_register_protocol(proto_vuze_dht, proto_reg_handoff_vuze_dht);\r\nprefs_register_uint_preference(vuze_dht_module, "udp_port",\r\n"Vuze DHT Protocol UDP port",\r\n"Set the UDP port for Vuze DHT Protocol.",\r\n10, &global_vuze_dht_udp_port);\r\n}\r\nvoid\r\nproto_reg_handoff_vuze_dht(void)\r\n{\r\nstatic gboolean vuze_dht_prefs_initialized = FALSE;\r\nstatic guint vuze_dht_udp_port;\r\nif (!vuze_dht_prefs_initialized)\r\n{\r\nvuze_dht_prefs_initialized = TRUE;\r\n}\r\nelse\r\n{\r\ndissector_delete_uint("udp.port", vuze_dht_udp_port, vuze_dht_handle);\r\n}\r\nvuze_dht_udp_port = global_vuze_dht_udp_port;\r\ndissector_add_uint("udp.port", global_vuze_dht_udp_port, vuze_dht_handle);\r\n}
