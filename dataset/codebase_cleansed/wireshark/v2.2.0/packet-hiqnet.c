static void\r\nhiqnet_display_vdobjectaddr(proto_tree *hiqnet_tree, int hf_hiqnet, tvbuff_t *tvb, gint offset) {\r\nproto_tree_add_bytes_format_value(hiqnet_tree, hf_hiqnet, tvb, offset, 4, NULL,\r\n"%u.%u.%u.%u",\r\ntvb_get_guint8(tvb, offset),\r\ntvb_get_guint8(tvb, offset + 1),\r\ntvb_get_guint8(tvb, offset + 2),\r\ntvb_get_guint8(tvb, offset + 3));\r\n}\r\nstatic gint\r\nhiqnet_display_tcpipnetinfo(proto_tree *hiqnet_payload_tree, tvbuff_t *tvb, gint offset) {\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_macaddr, tvb, offset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_dhcp, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_ipaddr, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subnetmsk, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_gateway, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic gint\r\nhiqnet_display_rs232netinfo(proto_tree *hiqnet_payload_tree, tvbuff_t *tvb, gint offset) {\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_comid, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_baudrate, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_parity, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_stopbits, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_databits, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_flowcontrol, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nreturn offset;\r\n}\r\nstatic gint\r\nhiqnet_display_netinfo(proto_tree *hiqnet_payload_tree, tvbuff_t *tvb, gint offset) {\r\nguint netid = 0;\r\nnetid = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_netid, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nif (netid == HIQNET_TCPIP_NET) {\r\noffset = hiqnet_display_tcpipnetinfo(hiqnet_payload_tree, tvb, offset);\r\n}\r\nif (netid == HIQNET_RS232_NET) {\r\noffset = hiqnet_display_rs232netinfo(hiqnet_payload_tree, tvb, offset);\r\n}\r\nreturn offset;\r\n}\r\nstatic gint\r\nhiqnet_display_sernum(proto_tree *hiqnet_payload_tree, tvbuff_t *tvb, gint offset) {\r\ngint str_len;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_sernumlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_sernum, tvb, offset, str_len, ENC_NA);\r\noffset += str_len;\r\nreturn offset;\r\n}\r\nstatic gint\r\nhiqnet_display_paramsub(proto_tree *hiqnet_payload_tree, tvbuff_t *tvb, gint offset) {\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_pubparmid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subaddr, tvb, offset, 6, ENC_NA);\r\noffset += 6;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subparmid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_reserved0, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_reserved1, tvb, offset, 2, ENC_NA);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_sensrate, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nreturn offset;\r\n}\r\nstatic gint\r\nhiqnet_display_data(proto_tree *hiqnet_payload_tree, packet_info *pinfo, tvbuff_t *tvb, gint offset) {\r\nguint32 datatype;\r\nguint32 datalen;\r\nproto_item* ti;\r\nti = proto_tree_add_item_ret_uint(hiqnet_payload_tree, hf_hiqnet_datatype, tvb, offset, 1, ENC_BIG_ENDIAN, &datatype);\r\noffset += 1;\r\nswitch (datatype) {\r\ncase HIQNET_DATATYPE_BYTE:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_byte_value, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nbreak;\r\ncase HIQNET_DATATYPE_UBYTE:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_ubyte_value, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nbreak;\r\ncase HIQNET_DATATYPE_WORD:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_word_value, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nbreak;\r\ncase HIQNET_DATATYPE_UWORD:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_uword_value, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nbreak;\r\ncase HIQNET_DATATYPE_LONG:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_long_value, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbreak;\r\ncase HIQNET_DATATYPE_ULONG:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_ulong_value, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbreak;\r\ncase HIQNET_DATATYPE_FLOAT32:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_float32_value, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbreak;\r\ncase HIQNET_DATATYPE_FLOAT64:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_float64_value, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nbreak;\r\ncase HIQNET_DATATYPE_BLOCK:\r\nproto_tree_add_item_ret_uint(hiqnet_payload_tree, hf_hiqnet_datalen, tvb, offset, 2, ENC_BIG_ENDIAN, &datalen);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_block_value, tvb, offset, datalen, ENC_NA);\r\noffset += datalen;\r\nbreak;\r\ncase HIQNET_DATATYPE_STRING:\r\nproto_tree_add_item_ret_uint(hiqnet_payload_tree, hf_hiqnet_datalen, tvb, offset, 2, ENC_BIG_ENDIAN, &datalen);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_string_value, tvb, offset, datalen, ENC_UCS_2|ENC_BIG_ENDIAN);\r\noffset += datalen;\r\nbreak;\r\ncase HIQNET_DATATYPE_LONG64:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_long64_value, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nbreak;\r\ncase HIQNET_DATATYPE_ULONG64:\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_ulong64_value, tvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nbreak;\r\ndefault:\r\nexpert_add_info(pinfo, ti, &ei_hiqnet_datatype);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_hiqnet_pdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nguint8 headerlen = 0;\r\nguint32 messagelen = 0;\r\nguint16 srcdev = 0;\r\nguint8 srcvdaddr = 0;\r\nguint8 srcob0addr = 0;\r\nguint8 srcob1addr = 0;\r\nguint8 srcob2addr = 0;\r\nguint16 dstdev = 0;\r\nguint8 dstvdaddr = 0;\r\nguint8 dstob0addr = 0;\r\nguint8 dstob1addr = 0;\r\nguint8 dstob2addr = 0;\r\nguint16 messageid = 0;\r\nguint16 flags = 0;\r\nguint16 paramcount = 0;\r\nguint16 subcount = 0;\r\nguint16 attrcount = 0;\r\ngint str_len = 0;\r\nguint16 vdscount = 0;\r\nguint16 eventscount = 0;\r\nguint16 objcount = 0;\r\nguint16 ifacecount = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "HiQnet");\r\ncol_clear(pinfo->cinfo,COL_INFO);\r\nsrcdev = tvb_get_ntohs(tvb, 6);\r\nsrcvdaddr = tvb_get_guint8(tvb, 8);\r\nsrcob0addr = tvb_get_guint8(tvb, 9);\r\nsrcob1addr = tvb_get_guint8(tvb, 10);\r\nsrcob2addr = tvb_get_guint8(tvb, 11);\r\ndstdev = tvb_get_ntohs(tvb, 12);\r\ndstvdaddr = tvb_get_guint8(tvb, 14);\r\ndstob0addr = tvb_get_guint8(tvb, 15);\r\ndstob1addr = tvb_get_guint8(tvb, 16);\r\ndstob2addr = tvb_get_guint8(tvb, 17);\r\nmessageid = tvb_get_ntohs(tvb, 18);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "Msg: %s, Src: %u.%u.%u.%u.%u, Dst: %u.%u.%u.%u.%u",\r\nval_to_str(messageid, messageidnames, "Unknown (0x%04x)"),\r\nsrcdev, srcvdaddr, srcob0addr, srcob1addr, srcob2addr,\r\ndstdev, dstvdaddr, dstob0addr, dstob1addr, dstob2addr);\r\nif (tree) {\r\nproto_item *ti = NULL;\r\nproto_item *item = NULL;\r\nproto_tree *hiqnet_tree = NULL;\r\nproto_tree *hiqnet_header_tree = NULL;\r\nproto_tree *hiqnet_session_tree = NULL;\r\nproto_tree *hiqnet_error_tree = NULL;\r\nproto_tree *hiqnet_multipart_tree = NULL;\r\nproto_tree *hiqnet_payload_tree = NULL;\r\nproto_tree *hiqnet_parameter_tree = NULL;\r\nproto_tree *hiqnet_attribute_tree = NULL;\r\nproto_tree *hiqnet_vds_tree = NULL;\r\nproto_tree *hiqnet_event_tree = NULL;\r\nproto_tree *hiqnet_subscription_tree = NULL;\r\nproto_tree *hiqnet_object_tree = NULL;\r\nproto_tree *hiqnet_ifaces_tree = NULL;\r\ngint offset = 0;\r\nmessagelen = tvb_get_ntohl(tvb, 2);\r\nti = proto_tree_add_item(tree, proto_hiqnet, tvb, 0, messagelen, ENC_NA);\r\nproto_item_append_text(ti, ", Msg: %s",\r\nval_to_str(messageid, messageidnames, "Unknown (0x%04x)"));\r\nproto_item_append_text(ti, ", Src %u.%u.%u.%u.%u",\r\nsrcdev, srcvdaddr, srcob0addr, srcob1addr, srcob2addr);\r\nproto_item_append_text(ti, ", Dst: %u.%u.%u.%u.%u",\r\ndstdev, dstvdaddr, dstob0addr, dstob1addr, dstob2addr);\r\nhiqnet_tree = proto_item_add_subtree(ti, ett_hiqnet);\r\nheaderlen = tvb_get_guint8(tvb, 1);\r\nhiqnet_header_tree = proto_tree_add_subtree(hiqnet_tree, tvb, 0, headerlen, ett_hiqnet, NULL, "Header");\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_version, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_headerlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_messagelen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_sourcedev, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nitem = proto_tree_add_item(hiqnet_header_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nPROTO_ITEM_SET_HIDDEN(item);\r\noffset += 2;\r\nhiqnet_display_vdobjectaddr(hiqnet_header_tree, hf_hiqnet_sourceaddr, tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_destdev, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nitem = proto_tree_add_item(hiqnet_header_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nPROTO_ITEM_SET_HIDDEN(item);\r\noffset += 2;\r\nhiqnet_display_vdobjectaddr(hiqnet_header_tree, hf_hiqnet_destaddr, tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_messageid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nflags = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_bitmask(hiqnet_header_tree, tvb, offset, hf_hiqnet_flags,\r\nett_hiqnet_flags, hiqnet_flag_fields, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_hopcnt, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_header_tree, hf_hiqnet_seqnum, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (flags & HIQNET_ERROR_FLAG) {\r\nhiqnet_error_tree = proto_tree_add_subtree(hiqnet_header_tree, tvb, offset, 2, ett_hiqnet, NULL, "Error");\r\nproto_tree_add_item(hiqnet_error_tree, hf_hiqnet_errcode, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_error_tree, hf_hiqnet_errstr, tvb, offset, headerlen - offset, ENC_UCS_2|ENC_BIG_ENDIAN);\r\n}\r\nif (flags & HIQNET_MULTIPART_FLAG) {\r\nhiqnet_multipart_tree = proto_tree_add_subtree(hiqnet_header_tree, tvb, offset, 2, ett_hiqnet, NULL, "Multi-part");\r\nproto_tree_add_item(hiqnet_multipart_tree, hf_hiqnet_startseqno, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_multipart_tree, hf_hiqnet_rembytes, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\nif (flags & HIQNET_SESSION_NUMBER_FLAG) {\r\nhiqnet_session_tree = proto_tree_add_subtree(hiqnet_header_tree, tvb, offset, 2, ett_hiqnet, NULL, "Session");\r\nproto_tree_add_item(hiqnet_session_tree, hf_hiqnet_sessnum, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n}\r\noffset = headerlen;\r\nhiqnet_payload_tree = proto_tree_add_subtree(\r\nhiqnet_tree, tvb, offset, messagelen - headerlen, ett_hiqnet, NULL, "Payload");\r\nswitch(messageid) {\r\ncase HIQNET_DISCOINFO_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_cost, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\noffset = hiqnet_display_sernum(hiqnet_payload_tree, tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_maxmsgsize, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_keepaliveperiod, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nhiqnet_display_netinfo(hiqnet_payload_tree, tvb, offset);\r\nbreak;\r\ncase HIQNET_HELLO_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_sessnum, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_bitmask(hiqnet_payload_tree, tvb, offset, hf_hiqnet_flagmask,\r\nett_hiqnet_flags, hiqnet_flag_fields, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_MULTPARMGET_MSG :\r\nparamcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_paramcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (paramcount > 0) {\r\nhiqnet_parameter_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Parameter");\r\nproto_tree_add_item(hiqnet_parameter_tree, hf_hiqnet_paramid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (flags & HIQNET_INFO_FLAG) {\r\noffset = hiqnet_display_data(hiqnet_parameter_tree, pinfo, tvb, offset);\r\n}\r\nparamcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_MULTPARMSET_MSG :\r\nparamcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_paramcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (paramcount > 0) {\r\nhiqnet_parameter_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Parameter");\r\nproto_tree_add_item(hiqnet_parameter_tree, hf_hiqnet_paramid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = hiqnet_display_data(hiqnet_parameter_tree, pinfo, tvb, offset);\r\nparamcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_PARMSUBALL_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nhiqnet_display_vdobjectaddr(hiqnet_payload_tree, hf_hiqnet_vdobject, tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_sensrate, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subflags, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_PARMUNSUBALL_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nhiqnet_display_vdobjectaddr(hiqnet_payload_tree, hf_hiqnet_vdobject, tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_MULTPARMSUB_MSG :\r\nsubcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (subcount > 0) {\r\nhiqnet_subscription_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Subscription");\r\noffset = hiqnet_display_paramsub(hiqnet_subscription_tree, tvb, offset);\r\nsubcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_GOODBYE_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_GETATTR_MSG :\r\nattrcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_attrcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nif (flags & HIQNET_INFO_FLAG) {\r\nwhile (attrcount > 0) {\r\nhiqnet_attribute_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Attribute");\r\nproto_tree_add_item(hiqnet_attribute_tree, hf_hiqnet_attrid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = hiqnet_display_data(hiqnet_attribute_tree, pinfo, tvb, offset);\r\nattrcount -= 1;\r\n}\r\n} else {\r\nwhile (attrcount > 0) {\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_attrid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nattrcount -= 1;\r\n}\r\n}\r\nbreak;\r\ncase HIQNET_GETVDLIST_MSG :\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_strlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_wrkgrppath, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nif (flags & HIQNET_INFO_FLAG) {\r\nvdscount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_numvds, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (vdscount > 0) {\r\nhiqnet_vds_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Virtual Devices");\r\nproto_tree_add_item(hiqnet_vds_tree, hf_hiqnet_vdaddr, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_vds_tree, hf_hiqnet_vdclassid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nvdscount -= 1;\r\n}\r\n}\r\nbreak;\r\ncase HIQNET_STORE_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_stract, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_strnum, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_strlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_wrkgrppath, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_scope, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_RECALL_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_recact, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_recnum, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_strlen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_wrkgrppath, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_scope, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_LOCATE_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_time, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nhiqnet_display_sernum(hiqnet_payload_tree, tvb, offset);\r\nbreak;\r\ncase HIQNET_SUBEVTLOGMSGS_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_maxdatasize, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_bitmask(hiqnet_payload_tree, tvb, offset, hf_hiqnet_catfilter,\r\nett_hiqnet_cats, hiqnet_cat_fields, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_UNSUBEVTLOGMSGS_MSG :\r\nproto_tree_add_bitmask(hiqnet_payload_tree, tvb, offset, hf_hiqnet_catfilter,\r\nett_hiqnet_cats, hiqnet_cat_fields, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_REQEVTLOG_MSG :\r\nif (flags & HIQNET_INFO_FLAG) {\r\neventscount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_entrieslen, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (eventscount > 0) {\r\nhiqnet_event_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Event");\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_category, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_eventid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_priority, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_eventseqnum, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_eventtime, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_eventdate, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_event_tree, hf_hiqnet_eventinfo, tvb, offset, str_len, ENC_UCS_2);\r\noffset += str_len;\r\nstr_len = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(\r\nhiqnet_event_tree, hf_hiqnet_eventadddata, tvb, offset, str_len, ENC_NA);\r\noffset += str_len;\r\neventscount -= 1;\r\n}\r\n}\r\nbreak;\r\ncase HIQNET_MULTPARMUNSUB_MSG :\r\nsubcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (subcount > 0) {\r\nhiqnet_subscription_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Subscription");\r\nproto_tree_add_item(hiqnet_subscription_tree, hf_hiqnet_pubparmid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_subscription_tree, hf_hiqnet_subparmid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nsubcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_MULTOBJPARMSET_MSG :\r\nobjcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_objcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (objcount > 0) {\r\nhiqnet_object_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Object");\r\nhiqnet_display_vdobjectaddr(hiqnet_header_tree, hf_hiqnet_vdobject, tvb, offset);\r\noffset += 4;\r\nparamcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_object_tree, hf_hiqnet_paramcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (paramcount > 0) {\r\nhiqnet_parameter_tree = proto_tree_add_subtree(\r\nhiqnet_object_tree, tvb, offset, -1, ett_hiqnet, NULL, "Parameter");\r\nproto_tree_add_item(hiqnet_parameter_tree, hf_hiqnet_paramid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = hiqnet_display_data(hiqnet_parameter_tree, pinfo, tvb, offset);\r\nparamcount -= 1;\r\n}\r\nobjcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_PARMSETPCT_MSG :\r\nparamcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_paramcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (paramcount > 0) {\r\nhiqnet_parameter_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Parameter");\r\nproto_tree_add_item(hiqnet_parameter_tree, hf_hiqnet_paramid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(hiqnet_parameter_tree, hf_hiqnet_paramval, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nparamcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_PARMSUBPCT_MSG :\r\nsubcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_subcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (subcount > 0) {\r\nhiqnet_subscription_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Subscription");\r\noffset = hiqnet_display_paramsub(hiqnet_subscription_tree, tvb, offset);\r\nsubcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_GETNETINFO_MSG :\r\noffset = hiqnet_display_sernum(hiqnet_payload_tree, tvb, offset);\r\nif (flags & HIQNET_INFO_FLAG) {\r\nifacecount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_ifacecount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (ifacecount > 0) {\r\nhiqnet_ifaces_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Interface");\r\nproto_tree_add_item(hiqnet_ifaces_tree, hf_hiqnet_maxmsgsize, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset = hiqnet_display_netinfo(hiqnet_ifaces_tree, tvb, offset);\r\nifacecount -= 1;\r\n}\r\n}\r\nbreak;\r\ncase HIQNET_REQADDR_MSG :\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_devaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase HIQNET_SETADDR_MSG :\r\noffset = hiqnet_display_sernum(hiqnet_payload_tree, tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_newdevaddr, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nhiqnet_display_netinfo(hiqnet_payload_tree, tvb, offset);\r\nbreak;\r\ncase HIQNET_SETATTR_MSG :\r\nattrcount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(hiqnet_payload_tree, hf_hiqnet_attrcount, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nwhile (attrcount > 0) {\r\nhiqnet_attribute_tree = proto_tree_add_subtree(\r\nhiqnet_payload_tree, tvb, offset, -1, ett_hiqnet, NULL, "Attribute");\r\nproto_tree_add_item(hiqnet_attribute_tree, hf_hiqnet_attrid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\noffset = hiqnet_display_data(hiqnet_attribute_tree, pinfo, tvb, offset);\r\nattrcount -= 1;\r\n}\r\nbreak;\r\ncase HIQNET_RESERVED0_MSG:\r\ncase HIQNET_RESERVED1_MSG:\r\ncase HIQNET_ADDRUSED_MSG:\r\nbreak;\r\ndefault :\r\nbreak;\r\n}\r\n}\r\nreturn tvb_reported_length(tvb);\r\n}\r\nstatic guint\r\nget_hiqnet_pdu_len(packet_info *pinfo _U_, tvbuff_t *tvb, int offset, void *data _U_)\r\n{\r\nreturn tvb_get_ntohl(tvb, offset + 2);\r\n}\r\nstatic int\r\ndissect_hiqnet_tcp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)\r\n{\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, 6,\r\nget_hiqnet_pdu_len, dissect_hiqnet_pdu, data);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_hiqnet_udp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)\r\n{\r\ngint offset = 0;\r\ntvbuff_t *next_tvb;\r\ngint offset_before;\r\nguint plen;\r\nguint captured_length;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nplen = get_hiqnet_pdu_len(pinfo, tvb, offset, NULL);\r\ncaptured_length = tvb_captured_length_remaining(tvb, offset);\r\nif (captured_length > plen)\r\ncaptured_length = plen;\r\nnext_tvb = tvb_new_subset(tvb, offset, captured_length, plen);\r\ndissect_hiqnet_pdu(next_tvb, pinfo, tree, data);\r\noffset_before = offset;\r\noffset += plen;\r\nif (offset <= offset_before)\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_hiqnet(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_hiqnet_version,\r\n{ "Version", "hiqnet.version",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_headerlen,\r\n{ "Header length", "hiqnet.hlen",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_messagelen,\r\n{ "Message length", "hiqnet.mlen",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sourcedev,\r\n{ "Source device", "hiqnet.srcdev",\r\nFT_UINT8, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sourceaddr,\r\n{ "Source address", "hiqnet.srcaddr",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_destdev,\r\n{ "Destination device", "hiqnet.dstdev",\r\nFT_UINT8, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_destaddr,\r\n{ "Destination address", "hiqnet.dstaddr",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_messageid,\r\n{ "Message ID", "hiqnet.msgid",\r\nFT_UINT16, BASE_HEX,\r\nVALS(messageidnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_flags,\r\n{ "Flags", "hiqnet.flags",\r\nFT_UINT16, BASE_HEX,\r\nNULL, HIQNET_FLAGS_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_reqack_flag,\r\n{ "Request Acknowledgement", "hiqnet.flags.reqack",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_REQACK_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ack_flag,\r\n{ "Acknowledgement", "hiqnet.flags.ack",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_ACK_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_info_flag,\r\n{ "Information", "hiqnet.flags.info",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_INFO_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_error_flag,\r\n{ "Error", "hiqnet.flags.error",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_ERROR_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_guaranteed_flag,\r\n{ "Guaranteed", "hiqnet.flags.guar",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_GUARANTEED_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_multipart_flag,\r\n{ "Multipart", "hiqnet.flags.multi",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_MULTIPART_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_session_number_flag,\r\n{ "Session Number", "hiqnet.flags.session_number",\r\nFT_BOOLEAN, 16,\r\nNULL, HIQNET_SESSION_NUMBER_FLAG,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_hopcnt,\r\n{ "Hop count", "hiqnet.hc",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_seqnum,\r\n{ "Sequence number", "hiqnet.seqnum",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_errcode,\r\n{ "Error code", "hiqnet.errcode",\r\nFT_UINT8, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_errstr,\r\n{ "Error string", "hiqnet.errstr",\r\nFT_STRINGZ, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_startseqno,\r\n{ "Start seq. no.", "hiqnet.ssno",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_rembytes,\r\n{ "Remaining bytes", "hiqnet.rembytes",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sessnum,\r\n{ "Session number", "hiqnet.sessnum",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_cost,\r\n{ "Cost", "hiqnet.cost",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sernumlen,\r\n{ "Serial number length", "hiqnet.sernumlen",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sernum,\r\n{ "Serial number", "hiqnet.sernum",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_maxmsgsize,\r\n{ "Max message size", "hiqnet.maxmsgsize",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_keepaliveperiod,\r\n{ "Keepalive period (ms)", "hiqnet.keepaliveperiod",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_netid,\r\n{ "Network ID", "hiqnet.netid",\r\nFT_UINT8, BASE_DEC,\r\nVALS(networknames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_macaddr,\r\n{ "MAC address", "hiqnet.macaddr",\r\nFT_ETHER, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_dhcp,\r\n{ "DHCP", "hiqnet.dhcp",\r\nFT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ipaddr,\r\n{ "IP Address", "hiqnet.ipaddr",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subnetmsk,\r\n{ "Subnet mask", "hiqnet.subnetmsk",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_gateway,\r\n{ "Gateway", "hiqnet.gateway",\r\nFT_IPv4, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_flagmask,\r\n{ "Flag mask", "hiqnet.flagmask",\r\nFT_UINT16, BASE_HEX,\r\nNULL, HIQNET_FLAGS_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_paramcount,\r\n{ "Parameter count", "hiqnet.paramcount",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_paramid,\r\n{ "Parameter ID", "hiqnet.paramid",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_vdobject,\r\n{ "Virtual Device Object", "hiqnet.vdobject",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subtype,\r\n{ "Subscription Type (New Style)", "hiqnet.subtype",\r\nFT_UINT8, BASE_DEC,\r\nNULL, HIQNET_SUBSCRIPTION_TYPE_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_sensrate,\r\n{ "Sensor Rate (ms)", "hiqnet.sensrate",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subflags,\r\n{ "Subscription Flags", "hiqnet.subflags",\r\nFT_UINT16, BASE_HEX,\r\nNULL, HIQNET_SUBSCRIPTION_FLAGS_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subcount,\r\n{ "No of Subscriptions", "hiqnet.subcount",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_pubparmid,\r\n{ "Publisher Parameter ID", "hiqnet.pubparmid",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subaddr,\r\n{ "Subscriber Address", "hiqnet.subaddr",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_subparmid,\r\n{ "Subscriber Parameter ID", "hiqnet.subparmid",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_reserved0,\r\n{ "Reserved", "hiqnet.reserved0",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_reserved1,\r\n{ "Reserved", "hiqnet.reserved1",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_attrcount,\r\n{ "Attribute count", "hiqnet.attrcount",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_attrid,\r\n{ "Attribute ID", "hiqnet.attrid",\r\nFT_UINT16, BASE_DEC,\r\nVALS(device_attributes_names), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_datatype,\r\n{ "Data type", "hiqnet.datatype",\r\nFT_UINT8, BASE_HEX,\r\nVALS(datatypenames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_datalen,\r\n{ "Data length", "hiqnet.datalen",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_byte_value,\r\n{ "Value", "hiqnet.byte_value",\r\nFT_INT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ubyte_value,\r\n{ "Value", "hiqnet.ubyte_value",\r\nFT_UINT8, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_word_value,\r\n{ "Value", "hiqnet.word_value",\r\nFT_INT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_uword_value,\r\n{ "Value", "hiqnet.uword_value",\r\nFT_UINT16, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_long_value,\r\n{ "Value", "hiqnet.long_value",\r\nFT_INT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ulong_value,\r\n{ "Value", "hiqnet.ulong_value",\r\nFT_UINT32, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_float32_value,\r\n{ "Value", "hiqnet.float32_value",\r\nFT_FLOAT, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_float64_value,\r\n{ "Value", "hiqnet.float64_value",\r\nFT_DOUBLE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_block_value,\r\n{ "Value", "hiqnet.block_value",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_string_value,\r\n{ "Value", "hiqnet.string_value",\r\nFT_STRINGZ, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_long64_value,\r\n{ "Value", "hiqnet.long64_value",\r\nFT_INT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ulong64_value,\r\n{ "Value", "hiqnet.ulong64_value",\r\nFT_UINT64 , BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_wrkgrppath,\r\n{ "Workgroup Path", "hiqnet.wrkgrppath",\r\nFT_STRINGZ, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_numvds,\r\n{ "Number of Virtual Devices", "hiqnet.numvds",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_vdaddr,\r\n{ "Virtual Device Address", "hiqnet.vdaddr",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_vdclassid,\r\n{ "Virtual Device Class ID", "hiqnet.vdclassid",\r\nFT_UINT16, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_stract,\r\n{ "Store Action", "hiqnet.stract",\r\nFT_UINT8, BASE_DEC,\r\nVALS(actionnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_strnum,\r\n{ "Store Number", "hiqnet.strnum",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_scope,\r\n{ "Scope", "hiqnet.scope",\r\nFT_UINT8, BASE_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_recact,\r\n{ "Recall Action", "hiqnet.rec.act",\r\nFT_UINT8, BASE_DEC,\r\nVALS(actionnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_recnum,\r\n{ "Recall Number", "hiqnet.recnum",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_strlen,\r\n{ "String length", "hiqnet.strlen",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_time,\r\n{ "Locate time (ms)", "hiqnet.time",\r\nFT_UINT16, BASE_DEC,\r\nVALS(timenames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_maxdatasize,\r\n{ "Maximum Data Size", "hiqnet.maxdatasize",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_catfilter,\r\n{ "Category Filter", "hiqnet.catfilter",\r\nFT_UINT32, BASE_HEX,\r\nNULL, HIQNET_CATEGORIES_MASK,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_app_cat,\r\n{ "Application", "hiqnet.appcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_APPLICATION_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_conf_cat,\r\n{ "Configuration", "hiqnet.confcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_CONF_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_audionet_cat,\r\n{ "Audio Network", "hiqnet.audionetcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_AUDIONET_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ctrlnet_cat,\r\n{ "Control Network", "hiqnet.ctrlnetcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_CTRLNET_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_vendnet_cat,\r\n{ "Vendor Network", "hiqnet.vendnetcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_VENDNET_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_startup_cat,\r\n{ "Startup", "hiqnet.startupcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_STARTUP_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_dsp_cat,\r\n{ "DSP", "hiqnet.dspcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_DSP_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_misc_cat,\r\n{ "Miscellenaous", "hiqnet.misccat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_MISC_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ctrlog_cat,\r\n{ "Control Logic", "hiqnet.crtllogcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_CTRLLOG_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_foreignproto_cat,\r\n{ "Foreign Protocol", "hiqnet.foreignprotocat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_FOREIGNPROTO_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_digio_cat,\r\n{ "Digital I/O", "hiqnet.digiocat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_DIGIO_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ctrlsurf_cat,\r\n{ "Control Surface", "hiqnet.ctrlsurfcat",\r\nFT_BOOLEAN, 32,\r\nNULL, HIQNET_CTRLSURF_CAT,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_entrieslen,\r\n{ "Number of Entries", "hiqnet.entrieslen",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_category,\r\n{ "Category", "hiqnet.cat",\r\nFT_UINT16, BASE_HEX,\r\nVALS(eventcategorynames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventid,\r\n{ "Event ID", "hiqnet.eventid",\r\nFT_UINT16, BASE_DEC,\r\nVALS(eventidnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_priority,\r\n{ "Priority", "hiqnet.priority",\r\nFT_UINT8, BASE_DEC,\r\nVALS(prioritynames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventseqnum,\r\n{ "Sequence Number", "hiqnet.eventseqnum",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventtime,\r\n{ "Time", "hiqnet.eventtime",\r\nFT_STRING, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventdate,\r\n{ "Date", "hiqnet.eventdate",\r\nFT_STRING, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventinfo,\r\n{ "Information", "hiqnet.information",\r\nFT_STRING, STR_UNICODE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_eventadddata,\r\n{ "Additional Data", "hiqnet.eventadddata",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_objcount,\r\n{ "Object Count", "hiqnet.objcount",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_paramval,\r\n{ "Parameter Value (%)", "hiqnet.paramval",\r\nFT_INT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_ifacecount,\r\n{ "Interface Count", "hiqnet.ifacecount",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_comid,\r\n{ "Com Port Identifier", "hiqnet.comid",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_baudrate,\r\n{ "Baud Rate", "hiqnet.baudrate",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_parity,\r\n{ "Parity", "hiqnet.parity",\r\nFT_UINT8, BASE_DEC,\r\nVALS(paritynames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_stopbits,\r\n{ "Stop Bits", "hiqnet.stopbits",\r\nFT_UINT8, BASE_DEC,\r\nVALS(stopbitsnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_databits,\r\n{ "Data Bits", "hiqnet.databits",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_flowcontrol,\r\n{ "Flowcontrol", "hiqnet.flowcontrol",\r\nFT_UINT8, BASE_DEC,\r\nVALS(flowcontrolnames), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_devaddr,\r\n{ "Device Address", "hiqnet.device",\r\nFT_UINT16, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_hiqnet_newdevaddr,\r\n{ "New Device Address", "hiqnet.device",\r\nFT_UINT16, BASE_DEC_HEX,\r\nNULL, 0x0,\r\nNULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_hiqnet,\r\n&ett_hiqnet_flags,\r\n&ett_hiqnet_cats\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_hiqnet_datatype, { "hiqnet.datatype.invalid", PI_PROTOCOL, PI_WARN, "Invalid datatype", EXPFILL }},\r\n};\r\nexpert_module_t* expert_hiqnet;\r\nproto_hiqnet = proto_register_protocol ("Harman HiQnet", "HiQnet", "hiqnet");\r\nproto_register_field_array(proto_hiqnet, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_hiqnet = expert_register_protocol(proto_hiqnet);\r\nexpert_register_field_array(expert_hiqnet, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_hiqnet(void)\r\n{\r\nstatic dissector_handle_t hiqnet_udp_handle;\r\nstatic dissector_handle_t hiqnet_tcp_handle;\r\nhiqnet_udp_handle = create_dissector_handle(dissect_hiqnet_udp, proto_hiqnet);\r\nhiqnet_tcp_handle = create_dissector_handle(dissect_hiqnet_tcp, proto_hiqnet);\r\ndissector_add_uint("udp.port", HIQNET_PORT, hiqnet_udp_handle);\r\ndissector_add_uint("tcp.port", HIQNET_PORT, hiqnet_tcp_handle);\r\n}
