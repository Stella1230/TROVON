static void\r\nexp_pdu_file_open(exp_pdu_t *exp_pdu_tap_data)\r\n{\r\nint import_file_fd;\r\nchar *tmpname, *capfile_name;\r\nint err;\r\nimport_file_fd = create_tempfile(&tmpname, "Wireshark_PDU_", NULL);\r\ncapfile_name = g_strdup(tmpname);\r\nerr = exp_pdu_open(exp_pdu_tap_data, import_file_fd,\r\ng_strdup_printf("Dump of PDUs from %s", cfile.filename));\r\nif (err != 0) {\r\nopen_failure_alert_box(capfile_name ? capfile_name : "temporary file", err, TRUE);\r\ngoto end;\r\n}\r\ncf_retap_packets(&cfile);\r\nerr = exp_pdu_close(exp_pdu_tap_data);\r\nif (err!= 0) {\r\nwrite_failure_alert_box(capfile_name, err);\r\n}\r\nif (cf_open(&cfile, capfile_name, WTAP_TYPE_AUTO, TRUE , &err) != CF_OK) {\r\nopen_failure_alert_box(capfile_name, err, FALSE);\r\ngoto end;\r\n}\r\nswitch (cf_read(&cfile, FALSE)) {\r\ncase CF_READ_OK:\r\ncase CF_READ_ERROR:\r\nbreak;\r\ncase CF_READ_ABORTED:\r\nbreak;\r\n}\r\nend:\r\ng_free(capfile_name);\r\n}\r\ngboolean\r\ndo_export_pdu(const char *filter, gchar *tap_name, exp_pdu_t *exp_pdu_tap_data)\r\n{\r\nchar *error;\r\nerror = exp_pdu_pre_open(tap_name, filter, exp_pdu_tap_data);\r\nif (error) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "%s", error);\r\ng_free(error);\r\nreturn FALSE;\r\n}\r\nexp_pdu_file_open(exp_pdu_tap_data);\r\nreturn TRUE;\r\n}
