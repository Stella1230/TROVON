static void\r\nrr_gen_ie_seconds_fmt(gchar *s, guint32 v)\r\n{\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%u seconds", v);\r\n}\r\nstatic void\r\nrr_timing_ofs_value_fmt(gchar *s, guint32 v)\r\n{\r\ngint32 sv = (signed)v;\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%.3f symbols ( ~ %.3f ms )",\r\nsv / 40.0f, (sv / 40.0f) * (10.0f / 234.0f));\r\n}\r\nstatic void\r\nrr_freq_ofs_value_fmt(gchar *s, guint32 v)\r\n{\r\ngint32 sv = (signed)v;\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d Hz", sv);\r\n}\r\nstatic void\r\nrr_pos_upd_info_dist_fmt(gchar *s, guint32 v)\r\n{\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d km", v);\r\n}\r\nstatic void\r\nrr_pos_upd_info_time_fmt(gchar *s, guint32 v)\r\n{\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d minutes", v);\r\n}\r\nstatic void\r\nrr_gps_timestamp_fmt(gchar *s, guint32 v)\r\n{\r\nif (v == 0xffff)\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "> 65535 minutes or N/A");\r\nelse\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d minutes", v);\r\n}\r\nstatic void\r\nrr_gps_almanac_pn_fmt(gchar *s, guint32 v)\r\n{\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d", v+1);\r\n}\r\nstatic void\r\nrr_pkt_freq_prm_xx_bw_fmt(gchar *s, guint32 v)\r\n{\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%d * 31.25 kHz = %.2f kHz (%d)", v, 31.25f*v, v);\r\n}\r\nstatic void\r\nrr_pkt_pwr_ctrl_prm_par_fmt(gchar *s, guint32 v)\r\n{\r\nif (v >= 61) {\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "Escape %d (%d)", v-60, v);\r\nreturn;\r\n}\r\ng_snprintf(s, ITEM_LABEL_LENGTH, "%.1f dB (%d)", v*0.4f, v);\r\n}\r\nvoid\r\ngmr1_get_msg_rr_params(guint8 oct, int dcch, const gchar **msg_str,\r\nint *ett_tree, int *hf_idx, gmr1_msg_func_t *msg_func_p)\r\n{\r\nconst gchar *m = NULL;\r\ngint idx;\r\nif (dcch)\r\nm = try_val_to_str_idx((guint32)oct | 0x100, gmr1_msg_rr_strings, &idx);\r\nif (!m)\r\nm = try_val_to_str_idx((guint32)oct, gmr1_msg_rr_strings, &idx);\r\n*msg_str = m;\r\n*hf_idx = hf_rr_msg_type;\r\nif (m != NULL) {\r\n*ett_tree = ett_msg_rr[idx];\r\n*msg_func_p = gmr1_msg_rr_func[idx];\r\n} else {\r\n*ett_tree = -1;\r\n*msg_func_p = NULL;\r\n}\r\n}\r\nstatic int\r\ndissect_gmr1_ccch(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint32 len, offset;\r\ngmr1_msg_func_t msg_func;\r\nconst gchar *msg_str;\r\ngint ett_tree;\r\nint hf_idx;\r\nproto_item *ccch_item = NULL, *pd_item = NULL;\r\nproto_tree *ccch_tree = NULL, *pd_tree = NULL;\r\nguint32 oct[3];\r\nguint8 pd;\r\ngint ti = -1;\r\nlen = tvb_reported_length(tvb);\r\noffset = 0;\r\nif (len < 3) {\r\ngoto err;\r\n}\r\ncol_append_str(pinfo->cinfo, COL_INFO, "(CCCH) ");\r\noct[0] = tvb_get_guint8(tvb, offset++);\r\noct[1] = tvb_get_guint8(tvb, offset++);\r\nif ((oct[1] & GMR1_PD_EXT_MSK) == GMR1_PD_EXT_VAL)\r\npd = oct[1] & 0xff;\r\nelse\r\npd = oct[1] & 0x0f;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "(%s) ",\r\nval_to_str(pd, gmr1_pd_short_vals, "Unknown (%u)"));\r\nif (pd != GMR1_PD_RR)\r\ngoto err;\r\noct[2] = tvb_get_guint8(tvb, offset);\r\ngmr1_get_msg_rr_params(oct[2], 0, &msg_str, &ett_tree, &hf_idx, &msg_func);\r\nif (msg_str == NULL)\r\n{\r\nccch_item = proto_tree_add_protocol_format(\r\ntree, proto_gmr1_ccch, tvb, 0, len,\r\n"GMR-1 CCCH - Message Type (0x%02x)", oct[2]);\r\nccch_tree = proto_item_add_subtree(ccch_item, ett_msg_ccch);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "Message Type (0x%02x) ", oct[2]);\r\n}\r\nelse\r\n{\r\nccch_item = proto_tree_add_protocol_format(\r\ntree, proto_gmr1_ccch, tvb, 0, -1,\r\n"GMR-1 CCCH - %s", msg_str);\r\nccch_tree = proto_item_add_subtree(ccch_item, ett_tree);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s ", msg_str);\r\n}\r\noffset = 0;\r\noffset += elem_v(tvb, ccch_tree, pinfo, GMR1_IE_RR, GMR1_IE_RR_L2_PSEUDO_LEN, offset, NULL);\r\npd_item = proto_tree_add_uint(\r\nccch_tree, hf_rr_protocol_discriminator, tvb, 1, 1, pd);\r\npd_tree = proto_item_add_subtree(pd_item, ett_rr_pd);\r\nif (ti == -1) {\r\nproto_tree_add_item(pd_tree, hf_gmr1_skip_ind, tvb, 1, 1, ENC_BIG_ENDIAN);\r\n} else {\r\n}\r\nproto_tree_add_item(pd_tree, hf_gmr1_l3_pd, tvb, 1, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_uint_format(\r\nccch_tree, hf_idx, tvb, offset, 1, oct[2],\r\n"Message Type: %s", msg_str ? msg_str : "(Unknown)"\r\n);\r\noffset++;\r\nif (msg_func) {\r\n(*msg_func)(tvb, ccch_tree, pinfo, offset, len - offset);\r\n} else {\r\nproto_tree_add_item(ccch_tree, hf_rr_message_elements, tvb, offset, len - offset, ENC_NA);\r\n}\r\nerr:\r\ncall_data_dissector(tvb, pinfo, tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_gmr1_rr(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_rr_msg_type,\r\n{ "Radio Resources Management Message Type", "gmr1.rr.msg_type",\r\nFT_UINT8, BASE_HEX, VALS(gmr1_msg_rr_strings), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_desc_kab_loc,\r\n{ "KAB Location", "gmr1.rr.chan_desc.kab_loc",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_desc_rx_tn,\r\n{ "RX Timeslot", "gmr1.rr.chan_desc.rx_tn",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_desc_arfcn,\r\n{ "ARFCN", "gmr1.rr.chan_desc.arfcn",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_desc_tx_tn,\r\n{ "TX Timeslot", "gmr1.rr.chan_desc.tx_tn",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_desc_chan_type,\r\n{ "Channel Type", "gmr1.rr.chan_desc.chan_type",\r\nFT_UINT8, BASE_DEC, VALS(rr_chan_desc_chan_type_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_chan_mode,\r\n{ "Channel Mode", "gmr1.rr.chan_mode",\r\nFT_UINT8, BASE_DEC, VALS(rr_chan_mode_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_ciph_mode_setting_sc,\r\n{ "SC", "gmr1.rr.ciph_mode_setting.sc",\r\nFT_UINT8, BASE_DEC, VALS(rr_ciph_mode_setting_sc_vals), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_ciph_mode_setting_algo,\r\n{ "Algorithm", "gmr1.rr.ciph_mode_setting.algo",\r\nFT_UINT8, BASE_DEC, VALS(rr_ciph_mode_setting_algo_vals), 0x0e,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_ciph_resp_cr,\r\n{ "CR", "gmr1.rr.ciph_resp.cr",\r\nFT_UINT8, BASE_DEC, VALS(rr_ciph_resp_cr_vals), 0x10,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_ciph_resp_spare,\r\n{ "Spare", "gmr1.rr.ciph_resp.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0xe0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_l2_pseudo_len,\r\n{ "L2 Pseudo Length value", "gmr1.rr.l2_pseudo_len",\r\nFT_UINT8, BASE_DEC, NULL, 0xfc,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_page_mode,\r\n{ "Page Mode", "gmr1.rr.page_mode.mode",\r\nFT_UINT8, BASE_DEC, VALS(rr_page_mode_vals), 0x03,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_page_mode_spare,\r\n{ "Spare", "gmr1.rr.page_mode.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x0c,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_req_ref_est_cause,\r\n{ "Establishment cause group ID", "gmr1.rr.req_ref.est_cause",\r\nFT_UINT8, BASE_DEC, VALS(rr_req_ref_est_cause_vals), 0xe0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_req_ref_ra,\r\n{ "Random Access Information", "gmr1.rr.req_ref.ra",\r\nFT_UINT8, BASE_HEX, NULL, 0x1f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_req_ref_fn,\r\n{ "Frame Number mod 256", "gmr1.rr.req_ref.fn",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_cause,\r\n{ "RR Cause", "gmr1.rr.cause",\r\nFT_UINT8, BASE_DEC, VALS(rr_cause_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_timing_ofs_ti,\r\n{ "TI", "gmr1.rr.timing_offset.ti",\r\nFT_UINT8, BASE_DEC, VALS(rr_timing_ofs_ti_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_timing_ofs_value,\r\n{ "Timing Offset value", "gmr1.rr.timing_offset.value",\r\nFT_INT16, BASE_CUSTOM, CF_FUNC(rr_timing_ofs_value_fmt), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tmsi_ptmsi,\r\n{ "TMSI/P-TMSI Value","gmr1.rr.tmsi_ptmsi",\r\nFT_UINT32,BASE_HEX, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_wait_ind_timeout,\r\n{ "T3122/T3142 timeout", "gmr1.rr.wait_ind.timeout",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_gen_ie_seconds_fmt), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes1_ab,\r\n{ "MES1 - Assignment Type", "gmr1.rr.mes_info_flag.1.ab",\r\nFT_UINT8, BASE_DEC, VALS(rr_mif_mes1_ab_vals), 0x03,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes1_i,\r\n{ "MES1 - Idle mode position update", "gmr1.rr.mes_info_flag.1.i",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x04,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes1_d,\r\n{ "MES1 - Dedicated mode position update", "gmr1.rr.mes_info_flag.1.d",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x08,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes2,\r\n{ "MES2", "gmr1.rr.mes_info_flag.2",\r\nFT_UINT8, BASE_DEC, VALS(rr_mif_mes234_vals), 0x10,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes3,\r\n{ "MES3", "gmr1.rr.mes_info_flag.3",\r\nFT_UINT8, BASE_DEC, VALS(rr_mif_mes234_vals), 0x20,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_mes4,\r\n{ "MES4", "gmr1.rr.mes_info_flag.4",\r\nFT_UINT8, BASE_DEC, VALS(rr_mif_mes234_vals), 0x40,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_mif_pv,\r\n{ "Position Verification indicator", "gmr1.rr.mes_info_flag.pv",\r\nFT_UINT8, BASE_DEC, VALS(rr_mif_pv_vals), 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_freq_ofs_fi,\r\n{ "FI", "gmr1.rr.frequency_offset.fi",\r\nFT_UINT8, BASE_DEC, VALS(rr_freq_ofs_fi_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_freq_ofs_value,\r\n{ "Frequency Offset value", "gmr1.rr.frequency_offset.value",\r\nFT_INT16, BASE_CUSTOM, CF_FUNC(rr_freq_ofs_value_fmt), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_freq_ofs_spare,\r\n{ "Spare", "gmr1.rr.frequency_offset.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_page_info_msc_id,\r\n{ "MSC ID", "gmr1.rr.paging_info.msc_id",\r\nFT_UINT8, BASE_DEC, NULL, 0xfc,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_page_info_chan_needed,\r\n{ "Channel Needed", "gmr1.rr.paging_info.chan_needed",\r\nFT_UINT8, BASE_DEC, VALS(rr_page_info_chan_needed_vals), 0x03,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pos_display_flag,\r\n{ "Display Information Flag", "gmr1.rr.pos_display.flag",\r\nFT_UINT8, BASE_DEC, VALS(rr_pos_display_flag_vals), 0xf0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pos_display_text,\r\n{ "Country and Region name", "gmr1.rr.pos_display.text",\r\nFT_STRING, STR_UNICODE, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pos_upd_info_v,\r\n{ "Valid", "gmr1.rr.pos_upd_info.valid",\r\nFT_UINT8, BASE_DEC, VALS(rr_pos_upd_info_v_vals), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pos_upd_info_dist,\r\n{ "GPS Update Distance", "gmr1.rr.pos_upd_info.distance",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_pos_upd_info_dist_fmt), 0xfe,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pos_upd_info_time,\r\n{ "GPS Update Timer", "gmr1.rr.pos_upd_info.time",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_pos_upd_info_time_fmt), 0xff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_bcch_carrier_arfcn,\r\n{ "ARFCN", "gmr1.rr.bcch_carrier.arfcn",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_bcch_carrier_si,\r\n{ "Satellite Indication", "gmr1.rr.bcch_carrier.si",\r\nFT_UINT8, BASE_DEC, VALS(rr_bcch_carrier_si_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_bcch_carrier_ri,\r\n{ "Reselection Indication", "gmr1.rr.bcch_carrier.ri",\r\nFT_UINT8, BASE_DEC, VALS(rr_bcch_carrier_ri_vals), 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_bcch_carrier_spare,\r\n{ "Spare", "gmr1.rr.bcch_carrier.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_reject_cause,\r\n{ "Cause", "gmr1.rr.reject_cause.cause",\r\nFT_UINT8, BASE_DEC, VALS(rr_reject_cause_vals), 0xfc,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_reject_cause_b,\r\n{ "BCCH Carrier IE presence", "gmr1.rr.reject_cause.b",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_gps_timestamp,\r\n{ "GPS timestamp", "gmr1.rr.gps_timestamp",\r\nFT_UINT16, BASE_CUSTOM, CF_FUNC(rr_gps_timestamp_fmt), 0xffff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_gps_power_control_params,\r\n{ "Power Control Parameters", "gmr1.rr.power_control_params",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tmsi_avail_msk_tmsi[0],\r\n{ "TMSI 1 Presence", "gmr1.rr.tmsi_avail_msk.tmsi1",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x10,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tmsi_avail_msk_tmsi[1],\r\n{ "TMSI 2 Presence", "gmr1.rr.tmsi_avail_msk.tmsi2",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x20,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tmsi_avail_msk_tmsi[2],\r\n{ "TMSI 3 Presence", "gmr1.rr.tmsi_avail_msk.tmsi3",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x40,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tmsi_avail_msk_tmsi[3],\r\n{ "TMSI 4 Presence", "gmr1.rr.tmsi_avail_msk.tmsi4",\r\nFT_UINT8, BASE_DEC, VALS(rr_gen_ie_presence_vals), 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_pn,\r\n{ "Page Number", "gmr1.rr.gps_almanac.pn",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_gps_almanac_pn_fmt), 0xf8,\r\n"See ICD-GPS-200", HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_wn,\r\n{ "Word Number", "gmr1.rr.gps_almanac.wn",\r\nFT_UINT8, BASE_DEC, NULL, 0x07,\r\n"See ICD-GPS-200", HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_word,\r\n{ "GPS Almanac Word", "gmr1.rr.gps_almanac.word",\r\nFT_UINT24, BASE_HEX, NULL, 0x00,\r\n"See ICD-GPS-200", HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_sfn,\r\n{ "Sub Frame Number", "gmr1.rr.gps_almanac.sfn",\r\nFT_UINT8, BASE_DEC, VALS(rr_gps_almanac_sfn_vals), 0x80,\r\n"See ICD-GPS-200", HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_co,\r\n{ "CO", "gmr1.rr.gps_almanac.co",\r\nFT_UINT8, BASE_DEC, NULL, 0x40,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_gps_almanac_spare,\r\n{ "Spare", "gmr1.rr.gps_almanac.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x3f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_msc_id,\r\n{ "MSC ID", "gmr1.rr.msc_id",\r\nFT_UINT8, BASE_DEC, NULL, 0xfc,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_msc_id_spare,\r\n{ "Spare", "gmr1.rr.msc_id.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x03,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_gps_discr,\r\n{ "GPS Position field CRC-16", "gmr1.rr.gps_discriminator",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_3_prm_rlc_mode,\r\n{ "RLC Mode", "gmr1.rr.pkt_imm_ass_3_prm",\r\nFT_UINT8, BASE_DEC, VALS(rr_pkt_imm_ass_3_prm_rlc_mode_vals), 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_3_prm_spare,\r\n{ "Spare", "gmr1.rr.pkt_imm_ass_3_prm.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x1e,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_3_prm_dl_tfi,\r\n{ "Downlink TFI", "gmr1.rr.pkt_imm_ass_3_prm.tfi",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"Temporary Flow Identifier", HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_3_prm_start_fn,\r\n{ "Start Framenumber", "gmr1.rr.pkt_imm_ass_3_prm.start_fn",\r\nFT_UINT8, BASE_DEC, NULL, 0xf0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_3_prm_mac_slot_alloc,\r\n{ "MAC-slot Allocation", "gmr1.rr.pkt_imm_ass_3_prm.mac_slot_alloc",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\n"LSB=slot 0, MSB=slot 7", HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_arfcn,\r\n{ "ARFCN", "gmr1.rr.pkt_freq_prm.arfcn",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_dl_freq_plan_id,\r\n{ "Downlink Freq. Plan ID", "gmr1.rr.pkt_freq_prm.dl_freq_plan_id",\r\nFT_UINT8, BASE_DEC, VALS(rr_pkt_freq_prm_dl_freq_plan_id_vals), 0x08,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_dl_bw,\r\n{ "Downlink Bandwidth", "gmr1.rr.pkt_freq_prm.dl_bw",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_pkt_freq_prm_xx_bw_fmt), 0x70,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_ul_freq_dist,\r\n{ "Uplink Freq. Distance", "gmr1.rr.pkt_freq_prm.ul_freq_dist",\r\nFT_INT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_ul_bw,\r\n{ "Uplink Bandwidth", "gmr1.rr.pkt_freq_prm.ul_bw",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_pkt_freq_prm_xx_bw_fmt), 0x70,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_freq_prm_spare,\r\n{ "Spare", "gmr1.rr.pkt_freq_prm.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_spare1,\r\n{ "Spare", "gmr1.rr.pkt_imm_ass_2_prm.ac.spare1",\r\nFT_UINT8, BASE_DEC, NULL, 0x01,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_final_alloc,\r\n{ "Final Allocation", "gmr1.rr.pkt_imm_ass_2_prm.ac.final_alloc",\r\nFT_UINT8, BASE_DEC, NULL, 0x02,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_usf_granularity,\r\n{ "USF Granularity", "gmr1.rr.pkt_imm_ass_2_prm.ac.usf_granularity",\r\nFT_UINT8, BASE_DEC, NULL, 0x04,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_dl_ctl_mac_slot,\r\n{ "Downlink Control MAC-slot", "gmr1.rr.pkt_imm_ass_2_prm.ac.dl_ctl_mac_slot",\r\nFT_UINT8, BASE_DEC, NULL, 0x38,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_mac_mode,\r\n{ "MAC mode", "gmr1.rr.pkt_imm_ass_2_prm.ac.mac_mode",\r\nFT_UINT8, BASE_DEC, VALS(rr_pkt_imm_ass_2_prm_ac_mac_mode_vals), 0xc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_start_fn,\r\n{ "Starting Frame Number", "gmr1.rr.pkt_imm_ass_2_prm.ac.start_fn",\r\nFT_UINT8, BASE_DEC, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_rlc_dblk_gnt,\r\n{ "RLC Data Blocks Granted", "gmr1.rr.pkt_imm_ass_2_prm.ac.rlc_dblk_gnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_mcs,\r\n{ "MCS", "gmr1.rr.pkt_imm_ass_2_prm.ac.mcs",\r\nFT_UINT8, BASE_DEC, NULL, 0xf8,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_tfi,\r\n{ "TFI", "gmr1.rr.pkt_imm_ass_2_prm.ac.tfi",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_spare2,\r\n{ "Spare", "gmr1.rr.pkt_imm_ass_2_prm.ac.spare2",\r\nFT_UINT8, BASE_HEX, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_ac_mac_slot_alloc,\r\n{ "MAC-slot Allocation", "gmr1.rr.pkt_imm_ass_2_prm.ac.mac_slot_alloc",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\n"LSB=slot 0, MSB=slot 7", HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_chan_mcs_cmd,\r\n{ "Channel MCS Command", "gmr1.rr.pkt_imm_ass_2_prm.d.chan_mcs_cmd",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_chan_mcs_cmd_pnb512,\r\n{ "Channel MCS Command PNB 5,12", "gmr1.rr.pkt_imm_ass_2_prm.d.chan_mcs_cmd_pnb512",\r\nFT_UINT8, BASE_HEX, NULL, 0xf0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_spare1,\r\n{ "Spare", "gmr1.rr.pkt_imm_ass_2_prm.d.spare1",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_rlc_dblk_gnt,\r\n{ "RLC Data Blocks Granted", "gmr1.rr.pkt_imm_ass_2_prm.d.rlc_dblk_gnt",\r\nFT_UINT8, BASE_DEC, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_spare2,\r\n{ "Spare", "gmr1.rr.pkt_imm_ass_2_prm.d.spare2",\r\nFT_UINT8, BASE_HEX, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_tfi,\r\n{ "TFI", "gmr1.rr.pkt_imm_ass_2_prm.d.tfi",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_usf_granularity,\r\n{ "USF Granularity", "gmr1.rr.pkt_imm_ass_2_prm.ac.usf_granularity",\r\nFT_UINT8, BASE_DEC, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_imm_ass_2_prm_d_mac_slot_alloc,\r\n{ "MAC-slot Allocation", "gmr1.rr.pkt_imm_ass_2_prm.d.mac_slot_alloc",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\n"LSB=slot 0, MSB=slot 7", HFILL }\r\n},\r\n{ &hf_rr_usf_value,\r\n{ "Uplink state flag (USF)", "gmr1.rr.usf.value",\r\nFT_UINT8, BASE_HEX, NULL, 0x3f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_usf_spare,\r\n{ "Spare", "gmr1.rr.usf.spare",\r\nFT_UINT24, BASE_DEC, NULL, 0xffffc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_timing_adv_idx_value,\r\n{ "TAI Value", "gmr1.rr.timing_adv_idx.tai",\r\nFT_UINT8, BASE_DEC, NULL, 0x7f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_timing_adv_idx_spare,\r\n{ "Spare", "gmr1.rr.timing_adv_idx.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0x80,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_tlli,\r\n{ "TLLI", "gmr1.rr.tlli",\r\nFT_UINT32, BASE_HEX, NULL, 0x00,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_pwr_ctrl_prm_par,\r\n{ "Power Attenuation Request (PAR)", "gmr1.rr.pkt_pwr_ctrl_prm.par",\r\nFT_UINT8, BASE_CUSTOM, CF_FUNC(rr_pkt_pwr_ctrl_prm_par_fmt), 0x3f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_pkt_pwr_ctrl_prm_spare,\r\n{ "Spare", "gmr1.rr.pkt_pwr_ctrl_prm.spare",\r\nFT_UINT8, BASE_DEC, NULL, 0xc0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_persistence_lvl[0],\r\n{ "for Radio priority 1", "gmr1.rr.persistence_lvl.p1",\r\nFT_UINT8, BASE_DEC, NULL, 0xf0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_persistence_lvl[1],\r\n{ "for Radio priority 2", "gmr1.rr.persistence_lvl.p2",\r\nFT_UINT8, BASE_DEC, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_persistence_lvl[2],\r\n{ "for Radio priority 3", "gmr1.rr.persistence_lvl.p3",\r\nFT_UINT8, BASE_DEC, NULL, 0xf0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_persistence_lvl[3],\r\n{ "for Radio priority 4", "gmr1.rr.persistence_lvl.p4",\r\nFT_UINT8, BASE_DEC, NULL, 0x0f,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_protocol_discriminator,\r\n{ "Protocol Discriminator", "gmr1.rr.protocol_discriminator",\r\nFT_UINT8, BASE_DEC, VALS(gmr1_pd_vals), 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_rr_message_elements,\r\n{ "Message elements", "gmr1.rr.message_elements",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n};\r\n#define NUM_INDIVIDUAL_ELEMS 2\r\nstatic gint *ett[NUM_INDIVIDUAL_ELEMS +\r\nNUM_GMR1_IE_RR +\r\nNUM_GMR1_MSG_RR];\r\nunsigned int last_offset, i;\r\nett[0] = &ett_msg_ccch;\r\nett[1] = &ett_rr_pd;\r\nlast_offset = NUM_INDIVIDUAL_ELEMS;\r\nfor (i=0; i<NUM_GMR1_IE_RR; i++,last_offset++) {\r\nett_gmr1_ie_rr[i] = -1;\r\nett[last_offset] = &ett_gmr1_ie_rr[i];\r\n}\r\nfor (i=0; i<NUM_GMR1_MSG_RR; i++,last_offset++) {\r\nett_msg_rr[i] = -1;\r\nett[last_offset] = &ett_msg_rr[i];\r\n}\r\nproto_register_subtree_array(ett, array_length(ett));\r\nproto_gmr1_rr = proto_register_protocol("GEO-Mobile Radio (1) RR", "GMR-1 RR", "gmr1.rr");\r\nproto_register_field_array(proto_gmr1_rr, hf, array_length(hf));\r\nproto_gmr1_ccch = proto_register_protocol("GEO-Mobile Radio (1) CCCH", "GMR-1 CCCH", "gmr1.ccch");\r\nregister_dissector("gmr1_ccch", dissect_gmr1_ccch, proto_gmr1_ccch);\r\n}
