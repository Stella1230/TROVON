static int\r\ndissect_mpeg_pat(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nguint offset = 0, length = 0;\r\nguint16 prog_num, prog_pid;\r\nproto_item *ti;\r\nproto_tree *mpeg_pat_tree;\r\nproto_tree *mpeg_pat_prog_tree;\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Program Association Table (PAT)");\r\nti = proto_tree_add_item(tree, proto_mpeg_pat, tvb, offset, -1, ENC_NA);\r\nmpeg_pat_tree = proto_item_add_subtree(ti, ett_mpeg_pat);\r\noffset += packet_mpeg_sect_header(tvb, offset, mpeg_pat_tree, &length, NULL);\r\nlength -= 4;\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_transport_stream_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_reserved, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_version_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_current_next_indicator, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(mpeg_pat_tree, hf_mpeg_pat_last_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nif (offset >= length)\r\nreturn offset;\r\nwhile (offset < length) {\r\nprog_num = tvb_get_ntohs(tvb, offset);\r\nprog_pid = tvb_get_ntohs(tvb, offset + 2) & MPEG_PAT_PROGRAM_MAP_PID_MASK;\r\nmpeg_pat_prog_tree = proto_tree_add_subtree_format(mpeg_pat_tree, tvb, offset, 4,\r\nett_mpeg_pat_prog, NULL, "Program 0x%04hx -> PID 0x%04hx", prog_num, prog_pid);\r\nproto_tree_add_item(mpeg_pat_prog_tree, hf_mpeg_pat_program_number, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nproto_tree_add_item(mpeg_pat_prog_tree, hf_mpeg_pat_program_reserved, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpeg_pat_prog_tree, hf_mpeg_pat_program_map_pid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\n}\r\noffset += packet_mpeg_sect_crc(tvb, pinfo, mpeg_pat_tree, 0, offset);\r\nproto_item_set_len(ti, offset);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_mpeg_pat(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_mpeg_pat_transport_stream_id, {\r\n"Transport Stream ID", "mpeg_pat.tsid",\r\nFT_UINT16, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_reserved, {\r\n"Reserved", "mpeg_pat.reserved",\r\nFT_UINT8, BASE_HEX, NULL, MPEG_PAT_RESERVED_MASK, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_version_number, {\r\n"Version Number", "mpeg_pat.version",\r\nFT_UINT8, BASE_HEX, NULL, MPEG_PAT_VERSION_NUMBER_MASK, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_current_next_indicator, {\r\n"Current/Next Indicator", "mpeg_pat.cur_next_ind",\r\nFT_BOOLEAN, 8, TFS(&mpeg_pat_cur_next_vals), MPEG_PAT_CURRENT_NEXT_INDICATOR_MASK, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_section_number, {\r\n"Section Number", "mpeg_pat.sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_last_section_number, {\r\n"Last Section Number", "mpeg_pat.last_sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_program_number, {\r\n"Program Number", "mpeg_pat.prog_num",\r\nFT_UINT16, BASE_HEX, NULL, 0, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_program_reserved, {\r\n"Reserved", "mpeg_pat.prog_reserved",\r\nFT_UINT16, BASE_HEX, NULL, MPEG_PAT_PROGRAM_RESERVED_MASK, NULL, HFILL\r\n} },\r\n{ &hf_mpeg_pat_program_map_pid, {\r\n"Program Map PID", "mpeg_pat.prog_map_pid",\r\nFT_UINT16, BASE_HEX, NULL, MPEG_PAT_PROGRAM_MAP_PID_MASK, NULL, HFILL\r\n} },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mpeg_pat,\r\n&ett_mpeg_pat_prog\r\n};\r\nproto_mpeg_pat = proto_register_protocol("MPEG2 Program Association Table", "MPEG PAT", "mpeg_pat");\r\nproto_register_field_array(proto_mpeg_pat, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_mpeg_pat(void)\r\n{\r\ndissector_handle_t mpeg_pat_handle;\r\nmpeg_pat_handle = create_dissector_handle(dissect_mpeg_pat, proto_mpeg_pat);\r\ndissector_add_uint("mpeg_sect.tid", MPEG_PAT_TID, mpeg_pat_handle);\r\n}
