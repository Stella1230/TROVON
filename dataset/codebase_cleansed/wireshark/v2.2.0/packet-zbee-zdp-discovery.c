void\r\ndissect_zbee_zdp_req_nwk_addr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, sizeof(guint64), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_req_type, tvb, &offset, sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, sizeof(guint8), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_ext_addr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, sizeof(guint16), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_req_type, tvb, &offset, sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, sizeof(guint8), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_node_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, sizeof(guint16), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_power_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, sizeof(guint16), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\nguint8 endpt;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, sizeof(guint16), NULL);\r\nendpt = zbee_parse_uint(tree, hf_zbee_zdp_endpoint, tvb, &offset, sizeof(guint8), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x, Endpoint: %d", device, endpt);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, sizeof(guint16), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_match_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0, i;\r\nguint sizeof_cluster = (version >= ZBEE_VERSION_2007)?(int)sizeof(guint16):(int)sizeof(guint8);\r\nguint16 device;\r\nguint16 profile;\r\nguint8 in_count;\r\nguint8 out_count;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nprofile = zbee_parse_uint(tree, hf_zbee_zdp_profile, tvb, &offset, (int)sizeof(guint16), NULL);\r\nin_count = zbee_parse_uint(tree, hf_zbee_zdp_in_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (tree && in_count) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, in_count*sizeof_cluster,\r\nett_zbee_zdp_match_in, NULL, "Input Cluster List");\r\n}\r\nfor (i=0; i<in_count; i++) zbee_parse_uint(field_tree, hf_zbee_zdp_in_cluster, tvb, &offset, sizeof_cluster, NULL);\r\nout_count = zbee_parse_uint(tree, hf_zbee_zdp_out_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (tree && out_count) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, out_count*sizeof_cluster, ett_zbee_zdp_match_out, NULL, "Output Cluster List");\r\n}\r\nfor (i=0; i<out_count; i++) zbee_parse_uint(field_tree, hf_zbee_zdp_out_cluster, tvb, &offset, sizeof_cluster, NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x, Profile: 0x%04x", device, profile);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_complex_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_user_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_discovery_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_device_annce(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzdp_parse_cinfo(tree, ett_zbee_zdp_cinfo, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_parent_annce(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint n_children;\r\nguint i;\r\nguint64 ext_addr;\r\nn_children = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)1, NULL);\r\nzbee_append_info(tree, pinfo, ", # children %d :", n_children);\r\nfor (i = 0 ; i < n_children ; ++i)\r\n{\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nif (i == 0)\r\n{\r\nzbee_append_info(tree, pinfo, n_children == 1 ? " %s" : " %s ...", eui64_to_display(wmem_packet_scope(), ext_addr));\r\n}\r\n}\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_set_user_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\nguint8 user_length;\r\ngchar *user;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif (version >= ZBEE_VERSION_2007) {\r\nuser_length = zbee_parse_uint(tree, hf_zbee_zdp_user_length, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nelse {\r\nuser_length = 16;\r\n}\r\nuser = (gchar *)wmem_alloc(wmem_packet_scope(), user_length+1);\r\nuser = (gchar *)tvb_memcpy(tvb, user, offset, user_length);\r\nuser[user_length] = '\0';\r\nif (tree) {\r\nproto_tree_add_string(tree, hf_zbee_zdp_user, tvb, offset, user_length, user);\r\n}\r\noffset += user_length;\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x, Desc: \'%s\'", device, user);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_system_server_disc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nzdp_parse_server_flags(tree, ett_zbee_zdp_server, tvb, &offset);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_store_discovery(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree;\r\nguint offset = 0;\r\nguint i;\r\nguint64 ext_addr;\r\nguint8 simple_count;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_disc_node_size, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_disc_power_size, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_disc_ep_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nsimple_count= zbee_parse_uint(tree, hf_zbee_zdp_disc_simple_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, simple_count, ett_zbee_zdp_simple_sizes, NULL, "Simple Descriptor Sizes");\r\nfor (i=0; i<simple_count; i++) {\r\nzbee_parse_uint(field_tree, hf_zbee_zdp_disc_simple_size, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_store_node_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzdp_parse_node_desc(tree, ett_zbee_zdp_node, tvb, &offset, version);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_store_power_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzdp_parse_power_desc(tree, ett_zbee_zdp_power, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_store_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree;\r\nguint offset = 0;\r\nguint i;\r\nguint64 ext_addr;\r\nguint8 ep_count;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nep_count = zbee_parse_uint(tree, hf_zbee_zdp_ep_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, ep_count, ett_zbee_zdp_endpoint, NULL, "Active Endpoints");\r\nfor (i=0; i<ep_count; i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_store_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_simple_length, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzdp_parse_simple_desc(tree, ett_zbee_zdp_simple, tvb, &offset, version);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_remove_node_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_find_node_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint64 ext_addr;\r\nzbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: %s", eui64_to_display(wmem_packet_scope(), ext_addr));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_ext_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\nguint8 endpt;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nendpt = zbee_parse_uint(tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x, Endpoint: %d", device, endpt);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_req_ext_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 device;\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_nwk_addr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0;\r\nguint i;\r\nguint8 status;\r\nguint64 ext_addr;\r\nguint16 device;\r\nguint8 assoc;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif (tvb_bytes_exist(tvb, offset, 2*(int)sizeof(guint8))) {\r\nassoc = zbee_parse_uint(tree, hf_zbee_zdp_assoc_device_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif ((tree) && (assoc)) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, assoc*(int)sizeof(guint16),\r\nett_zbee_zdp_assoc_device, NULL, "Associated Device List");\r\n}\r\nfor (i=0; i<assoc; i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_assoc_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\n}\r\n}\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzbee_append_info(tree, pinfo, ", Device: %s = 0x%04x", eui64_to_display(wmem_packet_scope(), ext_addr), device);\r\n}\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_ext_addr(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0;\r\nguint i;\r\nguint8 status;\r\nguint64 ext_addr;\r\nguint16 device;\r\nguint8 assoc;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\next_addr = zbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif (tvb_bytes_exist(tvb, offset, 2*(int)sizeof(guint8))) {\r\nassoc = zbee_parse_uint(tree, hf_zbee_zdp_assoc_device_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif ((tree) && (assoc)) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, assoc*(int)sizeof(guint16),\r\nett_zbee_zdp_assoc_device, NULL, "Associated Device List");\r\n}\r\nfor (i=0; i<assoc; i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_assoc_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\n}\r\n}\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x = %s", device, eui64_to_display(wmem_packet_scope(), ext_addr));\r\n}\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_node_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint16 device;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzdp_parse_node_desc(tree, ett_zbee_zdp_node, tvb, &offset, version);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_power_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint16 device;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzdp_parse_power_desc(tree, ett_zbee_zdp_power, tvb, &offset);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint16 device;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_simple_length, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzdp_parse_simple_desc(tree, ett_zbee_zdp_simple, tvb, &offset, version);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0;\r\nguint i;\r\nguint8 status;\r\nguint16 device;\r\nguint8 ep_count;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nep_count = zbee_parse_uint(tree, hf_zbee_zdp_ep_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (tree && ep_count) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, ep_count*(int)sizeof(guint8),\r\nett_zbee_zdp_endpoint, NULL, "Active Endpoint List");\r\n}\r\nfor (i=0; i<ep_count; i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_match_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0;\r\nguint i;\r\nguint8 status;\r\nguint16 device;\r\nguint8 ep_count;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nep_count = zbee_parse_uint(tree, hf_zbee_zdp_ep_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (tree && ep_count) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, ep_count*(int)sizeof(guint8),\r\nett_zbee_zdp_endpoint, NULL, "Matching Endpoint List");\r\n}\r\nfor (i=0; i<ep_count; i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_complex_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint8 length;\r\nguint16 device;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nlength = zbee_parse_uint(tree, hf_zbee_zdp_complex_length, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (length) {\r\nzdp_parse_complex_desc(tree, -1, tvb, &offset, length);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_user_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint16 device;\r\nguint8 user_length;\r\ngchar *user;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nif ((version >= ZBEE_VERSION_2007) || (status == ZBEE_ZDP_STATUS_SUCCESS)) {\r\nuser_length = zbee_parse_uint(tree, hf_zbee_zdp_user_length, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\nelse user_length = 0;\r\nuser = tvb_get_string_enc(wmem_packet_scope(), tvb, offset, user_length, ENC_ASCII);\r\nif (tree) {\r\nproto_tree_add_string(tree, hf_zbee_zdp_user, tvb, offset, user_length, user);\r\n}\r\noffset += user_length;\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nif (status == ZBEE_ZDP_STATUS_SUCCESS) {\r\nzbee_append_info(tree, pinfo, ", Desc: \'%s\'", user);\r\n}\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_user_desc_conf(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint8 version)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nguint16 device = 0;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nif (version >= ZBEE_VERSION_2007) {\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_discovery_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_system_server_disc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzdp_parse_server_flags(tree, ett_zbee_zdp_server, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_discovery_store(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_store_node_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_store_power_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_store_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_store_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_remove_node_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint8 status;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_find_node_cache(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint16 cache;\r\nguint16 device;\r\ncache = zbee_parse_uint(tree, hf_zbee_zdp_cache, tvb, &offset, (int)sizeof(guint16), NULL);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_parse_eui64(tree, hf_zbee_zdp_ext_addr, tvb, &offset, (int)sizeof(guint64), NULL);\r\nzbee_append_info(tree, pinfo, ", Cache: 0x%04x", cache);\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_ext_simple_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0;\r\nguint i;\r\nguint sizeof_cluster = (int)sizeof(guint16);\r\nguint8 status;\r\nguint16 device;\r\nguint8 in_count;\r\nguint8 out_count;\r\nguint8 idx;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nzbee_parse_uint(tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\nin_count = zbee_parse_uint(tree, hf_zbee_zdp_in_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nout_count = zbee_parse_uint(tree, hf_zbee_zdp_out_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nidx = zbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nfor (i=idx; (i<in_count) && tvb_bytes_exist(tvb, offset, sizeof_cluster); i++) {\r\nzbee_parse_uint(tree, hf_zbee_zdp_in_cluster, tvb, &offset, sizeof_cluster, NULL);\r\n}\r\nfor (i-=in_count; (i<out_count) && tvb_bytes_exist(tvb, offset, sizeof_cluster); i++) {\r\nzbee_parse_uint(tree, hf_zbee_zdp_out_cluster, tvb, &offset, sizeof_cluster, NULL);\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}\r\nvoid\r\ndissect_zbee_zdp_rsp_ext_active_ep(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_tree *field_tree = NULL;\r\nguint offset = 0;\r\nguint i;\r\nguint8 status;\r\nguint16 device;\r\nguint8 ep_count;\r\nguint8 idx;\r\nstatus = zdp_parse_status(tree, tvb, &offset);\r\ndevice = zbee_parse_uint(tree, hf_zbee_zdp_device, tvb, &offset, (int)sizeof(guint16), NULL);\r\nep_count = zbee_parse_uint(tree, hf_zbee_zdp_ep_count, tvb, &offset, (int)sizeof(guint8), NULL);\r\nidx = zbee_parse_uint(tree, hf_zbee_zdp_index, tvb, &offset, (int)sizeof(guint8), NULL);\r\nif (tree && ep_count) {\r\nfield_tree = proto_tree_add_subtree(tree, tvb, offset, ep_count*(int)sizeof(guint8),\r\nett_zbee_zdp_endpoint, NULL, "Active Endpoint List");\r\nfor (i=idx; (i<ep_count) && tvb_bytes_exist(tvb, offset, (int)sizeof(guint8)); i++) {\r\n(void)zbee_parse_uint(field_tree, hf_zbee_zdp_endpoint, tvb, &offset, (int)sizeof(guint8), NULL);\r\n}\r\n}\r\nzbee_append_info(tree, pinfo, ", Device: 0x%04x", device);\r\nzbee_append_info(tree, pinfo, ", Status: %s", zdp_status_name(status));\r\nzdp_dump_excess(tvb, offset, pinfo, tree);\r\n}
