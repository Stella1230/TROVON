static inline double\r\nmake_fract(guint x)\r\n{\r\nif (x==0)\r\nreturn 0.0;\r\nreturn (double)(x / exp(log(10.0)*(1+floor(log((double)x)/log(10.0)))));\r\n}\r\nstatic gint\r\ndissect_mp4_mvhd_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint8 version;\r\nguint8 time_len;\r\ndouble rate, vol;\r\nguint16 fract_dec;\r\nguint32 next_tid;\r\nproto_item *next_tid_it;\r\noffset_start = offset;\r\nversion = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\ntime_len = (version==0) ? 4 : 8;\r\nproto_tree_add_item(tree, hf_mp4_mvhd_creat_time,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\nproto_tree_add_item(tree, hf_mp4_mvhd_mod_time,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\nproto_tree_add_item(tree, hf_mp4_mvhd_timescale,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_mp4_mvhd_duration,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\nrate = tvb_get_ntohs(tvb, offset);\r\nfract_dec = tvb_get_ntohs(tvb, offset+2);\r\nrate += make_fract(fract_dec);\r\nproto_tree_add_double_format_value(tree, hf_mp4_mvhd_rate,\r\ntvb, offset, 4, rate, "%f", rate);\r\noffset += 4;\r\nvol = tvb_get_guint8(tvb, offset);\r\nfract_dec = tvb_get_guint8(tvb, offset+1);\r\nvol += make_fract(fract_dec);\r\nproto_tree_add_double_format_value(tree, hf_mp4_mvhd_vol,\r\ntvb, offset, 4, vol, "%f", vol);\r\noffset += 2;\r\noffset += 2;\r\noffset += 2*4;\r\noffset += 9*4;\r\noffset += 6*4;\r\nnext_tid = tvb_get_ntohl(tvb, offset);\r\nnext_tid_it = proto_tree_add_item(tree, hf_mp4_mvhd_next_tid,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\nif (next_tid == G_MAXUINT32)\r\nexpert_add_info(pinfo, next_tid_it, &ei_mp4_mvhd_next_tid_unknown);\r\noffset += 4;\r\nreturn offset-offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_mfhd_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset_start;\r\noffset_start = offset;\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(tree, hf_mp4_mfhd_seq_num,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset-offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_tkhd_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint8 version;\r\nguint8 time_len;\r\ndouble width, height;\r\nguint16 fract_dec;\r\noffset_start = offset;\r\nversion = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\ntime_len = (version==0) ? 4 : 8;\r\nproto_tree_add_item(tree, hf_mp4_tkhd_creat_time,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\nproto_tree_add_item(tree, hf_mp4_tkhd_mod_time,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\nproto_tree_add_item(tree, hf_mp4_tkhd_track_id,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_mp4_tkhd_duration,\r\ntvb, offset, time_len, ENC_BIG_ENDIAN);\r\noffset += time_len;\r\noffset += 2*4;\r\noffset += 2;\r\noffset += 2;\r\noffset += 2;\r\noffset += 2;\r\noffset += 9*4;\r\nwidth = tvb_get_ntohs(tvb, offset);\r\nfract_dec = tvb_get_ntohs(tvb, offset+2);\r\nwidth += make_fract(fract_dec);\r\nproto_tree_add_double_format_value(tree, hf_mp4_tkhd_width,\r\ntvb, offset, 4, width, "%f", width);\r\noffset += 4;\r\nheight = tvb_get_ntohs(tvb, offset);\r\nfract_dec = tvb_get_ntohs(tvb, offset+2);\r\nheight += make_fract(fract_dec);\r\nproto_tree_add_double_format_value(tree, hf_mp4_tkhd_height,\r\ntvb, offset, 4, height, "%f", height);\r\noffset += 4;\r\nreturn offset-offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_ftyp_body(tvbuff_t *tvb, gint offset, gint len,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset_start;\r\noffset_start = offset;\r\nproto_tree_add_item(tree, hf_mp4_ftyp_brand,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_mp4_ftyp_ver,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nwhile ((offset-offset_start) < len) {\r\nproto_tree_add_item(tree, hf_mp4_ftyp_add_brand,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\n}\r\nreturn offset - offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_stsz_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint32 sample_size, sample_count, i;\r\noffset_start = offset;\r\nsample_size = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_stsz_sample_size,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nsample_count = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_stsz_sample_count,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (sample_size != 0)\r\nreturn offset - offset_start;\r\nfor (i=0; i<sample_count; i++) {\r\nproto_tree_add_item(tree, hf_mp4_stsz_entry_size,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\nreturn offset - offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_hdlr_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint hdlr_name_len;\r\noffset_start = offset;\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\noffset += 4;\r\nproto_tree_add_item(tree, hf_mp4_hdlr_type,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\noffset += 12;\r\nhdlr_name_len = tvb_strsize(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_hdlr_name,\r\ntvb, offset, hdlr_name_len, ENC_UTF_8|ENC_NA);\r\noffset += hdlr_name_len;\r\nreturn offset-offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_dref_body(tvbuff_t *tvb, gint offset, gint len _U_,\r\npacket_info *pinfo, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint32 entry_cnt, i;\r\ngint ret;\r\noffset_start = offset;\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nentry_cnt = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_dref_entry_cnt,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nfor(i=0; i<entry_cnt; i++) {\r\nret = dissect_mp4_box(BOX_TYPE_DREF, tvb, offset, pinfo, tree);\r\nif (ret<=0)\r\nbreak;\r\noffset += ret;\r\n}\r\nreturn offset-offset_start;\r\n}\r\nstatic gint\r\ndissect_mp4_url_body(tvbuff_t *tvb, gint offset, gint len,\r\npacket_info *pinfo _U_, proto_tree *tree)\r\n{\r\n#if 0\r\nguint32 flags;\r\n#endif\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\n#if 0\r\nflags = tvb_get_ntoh24(tvb, offset);\r\n#endif\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags_media_data_location, tvb, offset, 3, ENC_BIG_ENDIAN);\r\n#if 0\r\nif (flags&ENTRY_FLAG_MOVIE) {\r\n}\r\nelse {\r\n}\r\n#endif\r\nreturn len;\r\n}\r\nstatic gint\r\ndissect_mp4_stsd_body(tvbuff_t *tvb, gint offset, gint len,\r\npacket_info *pinfo, proto_tree *tree)\r\n{\r\nguint32 entry_cnt, i;\r\ngint ret;\r\nproto_tree_add_item(tree, hf_mp4_full_box_ver,\r\ntvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_mp4_full_box_flags,\r\ntvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nentry_cnt = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(tree, hf_mp4_stsd_entry_cnt,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nfor(i=0; i<entry_cnt; i++) {\r\nret = dissect_mp4_box(BOX_TYPE_STSD, tvb, offset, pinfo, tree);\r\nif (ret<=0)\r\nbreak;\r\noffset += ret;\r\n}\r\nreturn len;\r\n}\r\nstatic gint\r\ndissect_mp4_box(guint32 parent_box_type _U_,\r\ntvbuff_t *tvb, gint offset, packet_info *pinfo, proto_tree *tree)\r\n{\r\ngint offset_start;\r\nguint64 box_size;\r\nguint32 box_type;\r\nguint8 *box_type_str;\r\nproto_item *type_pi, *size_pi, *ext_size_pi = NULL;\r\nproto_tree *box_tree;\r\ngint ret;\r\ngint body_size;\r\noffset_start = offset;\r\nbox_size = (guint64)tvb_get_ntohl(tvb, offset);\r\nif ((box_size != BOX_SIZE_EXTENDED) && (box_size < MIN_BOX_SIZE))\r\nreturn -1;\r\nbox_type = tvb_get_ntohl(tvb, offset+4);\r\nbox_type_str = tvb_get_string_enc(wmem_packet_scope(), tvb,\r\noffset+4, 4, ENC_ASCII|ENC_NA);\r\nbox_tree = proto_tree_add_subtree_format(tree, tvb, offset, -1, ett_mp4_box, &type_pi, "%s (%s)",\r\nval_to_str_const(box_type, box_types, "unknown"), box_type_str);\r\nsize_pi = proto_tree_add_item(box_tree, hf_mp4_box_size,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\nif (box_size == BOX_SIZE_EXTENDED)\r\nproto_item_append_text(size_pi, " (actual size is in largesize)");\r\noffset += 4;\r\nproto_tree_add_item(box_tree, hf_mp4_box_type_str,\r\ntvb, offset, 4, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\nif (box_size == BOX_SIZE_EXTENDED) {\r\nbox_size = tvb_get_ntoh64(tvb, offset);\r\next_size_pi = proto_tree_add_item(box_tree, hf_mp4_box_largesize,\r\ntvb, offset, 8, ENC_BIG_ENDIAN);\r\noffset += 8;\r\n}\r\nif (box_size > G_MAXINT) {\r\nexpert_add_info(pinfo, ext_size_pi, &ei_mp4_box_too_large);\r\nreturn -1;\r\n}\r\nproto_item_set_len(type_pi, (gint)box_size);\r\nbody_size = (gint)box_size - (offset-offset_start);\r\nswitch (box_type) {\r\ncase BOX_TYPE_FTYP:\r\ndissect_mp4_ftyp_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_MVHD:\r\ndissect_mp4_mvhd_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_MFHD:\r\ndissect_mp4_mfhd_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_TKHD:\r\ndissect_mp4_tkhd_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_STSZ:\r\ndissect_mp4_stsz_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_HDLR:\r\ndissect_mp4_hdlr_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_DREF:\r\ndissect_mp4_dref_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_URL_:\r\ndissect_mp4_url_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_STSD:\r\ndissect_mp4_stsd_body(tvb, offset, body_size, pinfo, box_tree);\r\nbreak;\r\ncase BOX_TYPE_MOOV:\r\ncase BOX_TYPE_MOOF:\r\ncase BOX_TYPE_STBL:\r\ncase BOX_TYPE_MDIA:\r\ncase BOX_TYPE_TRAK:\r\ncase BOX_TYPE_TRAF:\r\ncase BOX_TYPE_MINF:\r\ncase BOX_TYPE_MVEX:\r\ncase BOX_TYPE_DINF:\r\ncase BOX_TYPE_UDTA:\r\nwhile (offset-offset_start < (gint)box_size) {\r\nret = dissect_mp4_box(box_type, tvb, offset, pinfo, box_tree);\r\nif (ret <= 0)\r\nbreak;\r\noffset += ret;\r\n}\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn (gint)box_size;\r\n}\r\nstatic int\r\ndissect_mp4(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\ngint offset = 0;\r\nguint32 box_type;\r\nproto_item *pi;\r\nproto_tree *mp4_tree;\r\ngint ret;\r\nif (tvb_reported_length(tvb) < MIN_BOX_SIZE)\r\nreturn 0;\r\nbox_type = tvb_get_ntohl(tvb, 4);\r\nif (try_val_to_str(box_type, box_types) == NULL)\r\nreturn 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "MP4");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\npi = proto_tree_add_protocol_format(tree, proto_mp4,\r\ntvb, 0, (gint)tvb_reported_length(tvb), "MP4");\r\nmp4_tree = proto_item_add_subtree(pi, ett_mp4);\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nret = dissect_mp4_box(BOX_TYPE_NONE, tvb, offset, pinfo, mp4_tree);\r\nif (ret <= 0)\r\nbreak;\r\noffset += ret;\r\n}\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_mp4(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_mp4_box_size,\r\n{ "Box size", "mp4.box.size", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_box_type_str,\r\n{ "Box type", "mp4.box.type_str", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_box_largesize,\r\n{ "Box size (largesize)", "mp4.box.largesize", FT_UINT64, BASE_DEC,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_full_box_ver,\r\n{ "Box version", "mp4.full_box.version", FT_UINT8, BASE_DEC,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_full_box_flags,\r\n{ "Flags", "mp4.full_box.flags", FT_UINT24, BASE_HEX,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_full_box_flags_media_data_location,\r\n{ "Media data location is defined in the movie box", "mp4.full_box.flags.media_data_location", FT_BOOLEAN, 24,\r\nNULL, ENTRY_FLAG_MOVIE, NULL, HFILL } },\r\n{ &hf_mp4_ftyp_brand,\r\n{ "Brand", "mp4.ftyp.brand", FT_STRING, BASE_NONE,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_ftyp_ver,\r\n{ "Version", "mp4.ftyp.version", FT_UINT32, BASE_DEC,\r\nNULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_ftyp_add_brand,\r\n{ "Additional brand", "mp4.ftyp.additional_brand", FT_STRING,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_stsz_sample_size,\r\n{ "Sample size", "mp4.stsz.sample_size", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_stsz_sample_count,\r\n{ "Sample count", "mp4.stsz.sample_count", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_stsz_entry_size,\r\n{ "Entry size", "mp4.stsz.entry_size", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_creat_time,\r\n{ "Creation time", "mp4.mvhd.creation_time", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_mod_time,\r\n{ "Modification time", "mp4.mvhd.modification_time", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_timescale,\r\n{ "Timescale", "mp4.mvhd.timescale", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_duration,\r\n{ "Duration", "mp4.mvhd.duration", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_rate,\r\n{ "Rate", "mp4.mvhd.rate", FT_DOUBLE,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_vol,\r\n{ "Volume", "mp4.mvhd.volume", FT_DOUBLE,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mvhd_next_tid,\r\n{ "Next Track ID", "mp4.mvhd.next_track_id", FT_UINT32,\r\nBASE_HEX, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_mfhd_seq_num,\r\n{ "Sequence number", "mp4.mfhd.sequence_number", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_creat_time,\r\n{ "Creation time", "mp4.tkhd.creation_time", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_mod_time,\r\n{ "Modification time", "mp4.tkhd.modification_time", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_track_id,\r\n{ "Track ID", "mp4.tkhd.track_id", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_duration,\r\n{ "Duration", "mp4.tkhd.duration", FT_UINT64,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_width,\r\n{ "Width", "mp4.tkhd.width", FT_DOUBLE,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_tkhd_height,\r\n{ "Height", "mp4.tkhd.height", FT_DOUBLE,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_hdlr_type,\r\n{ "Handler type", "mp4.hdlr.type", FT_STRING,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_hdlr_name,\r\n{ "Handler name", "mp4.hdlr.name", FT_STRINGZ,\r\nBASE_NONE, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_dref_entry_cnt,\r\n{ "Number of entries", "mp4.dref.entry_count", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } },\r\n{ &hf_mp4_stsd_entry_cnt,\r\n{ "Number of entries", "mp4.stsd.entry_count", FT_UINT32,\r\nBASE_DEC, NULL, 0, NULL, HFILL } }\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mp4,\r\n&ett_mp4_box\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_mp4_box_too_large,\r\n{ "mp4.box_too_large", PI_PROTOCOL, PI_WARN,\r\n"box size too large, dissection of this box is not supported", EXPFILL }},\r\n{ &ei_mp4_mvhd_next_tid_unknown,\r\n{ "mp4.mvhd.next_tid_unknown", PI_PROTOCOL, PI_CHAT,\r\n"Next track ID is unknown. Search for an unused track ID if you want to insert a new track.", EXPFILL }}\r\n};\r\nexpert_module_t *expert_mp4;\r\nproto_mp4 = proto_register_protocol("MP4 / ISOBMFF file format", "mp4", "mp4");\r\nproto_register_field_array(proto_mp4, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_mp4 = expert_register_protocol(proto_mp4);\r\nexpert_register_field_array(expert_mp4, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_mp4(void)\r\n{\r\ndissector_handle_t mp4_handle = create_dissector_handle(dissect_mp4, proto_mp4);\r\ndissector_add_string("media_type", "video/mp4", mp4_handle);\r\ndissector_add_string("media_type", "audio/mp4", mp4_handle);\r\n}
