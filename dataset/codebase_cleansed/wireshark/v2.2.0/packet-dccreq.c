static void\r\ndissect_dccreq_ds_params (tvbuff_t * tvb, proto_tree * tree, int start, guint16 len)\r\n{\r\nguint8 type, length;\r\nproto_tree *dcc_tree;\r\nint pos;\r\npos = start;\r\ndcc_tree = proto_tree_add_subtree_format( tree, tvb, start, len, ett_docsis_dccreq_ds_params, NULL,\r\n"2 DCC-REQ Downstream Params Encodings (Length = %u)", len);\r\nwhile ( pos < ( start + len) )\r\n{\r\ntype = tvb_get_guint8 (tvb, pos++);\r\nlength = tvb_get_guint8 (tvb, pos++);\r\nswitch (type)\r\n{\r\ncase DCCREQ_DS_FREQ:\r\nif (length == 4)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_freq, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_MOD_TYPE:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_mod_type, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_SYM_RATE:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_sym_rate, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_INTLV_DEPTH:\r\nif (length == 2)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_intlv_depth_i, tvb,\r\npos, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_intlv_depth_j, tvb,\r\npos + 1, 1, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_CHAN_ID:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_chan_id, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_SYNC_SUB:\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ds_sync_sub, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\nbreak;\r\n}\r\npos = pos + length;\r\n}\r\n}\r\nstatic void\r\ndissect_dccreq_sf_sub (tvbuff_t * tvb, proto_tree * tree, int start, guint16 len)\r\n{\r\nguint8 type, length;\r\nproto_tree *dcc_tree;\r\nint pos;\r\npos = start;\r\ndcc_tree = proto_tree_add_subtree_format( tree, tvb, start, len, ett_docsis_dccreq_sf_sub, NULL, "7 DCC-REQ Service Flow Substitution Encodings (Length = %u)", len);\r\nwhile ( pos < ( start + len) )\r\n{\r\ntype = tvb_get_guint8 (tvb, pos++);\r\nlength = tvb_get_guint8 (tvb, pos++);\r\nswitch (type)\r\n{\r\ncase DCCREQ_SF_SFID:\r\nif (length == 8)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_sf_sfid_cur, tvb,\r\npos, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_sf_sfid_new, tvb,\r\npos + 4, 4, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_SF_SID:\r\nif (length == 4)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_sf_sid_cur, tvb,\r\npos, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_sf_sid_new, tvb,\r\npos + 2, 2, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_SF_UNSOL_GRANT_TREF:\r\nif (length == 4)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_sf_unsol_grant_tref, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\n}\r\npos = pos + length;\r\n}\r\n}\r\nstatic int\r\ndissect_dccreq (tvbuff_t * tvb, packet_info * pinfo, proto_tree * tree, void* data _U_)\r\n{\r\nguint16 pos;\r\nguint8 type, length;\r\nproto_tree *dcc_tree;\r\nproto_item *dcc_item;\r\nguint16 len;\r\nlen = tvb_reported_length(tvb);\r\ncol_set_str(pinfo->cinfo, COL_INFO, "DCC-REQ Message: ");\r\nif (tree)\r\n{\r\ndcc_item =\r\nproto_tree_add_protocol_format (tree, proto_docsis_dccreq, tvb, 0,\r\n-1, "DCC-REQ Message");\r\ndcc_tree = proto_item_add_subtree (dcc_item, ett_docsis_dccreq);\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_tran_id, tvb, 0, 2, ENC_BIG_ENDIAN);\r\npos = 2;\r\nwhile (pos < len)\r\n{\r\ntype = tvb_get_guint8 (tvb, pos++);\r\nlength = tvb_get_guint8 (tvb, pos++);\r\nswitch (type)\r\n{\r\ncase DCCREQ_UP_CHAN_ID:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_up_chan_id, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_DS_PARAMS:\r\ndissect_dccreq_ds_params (tvb , dcc_tree , pos , length );\r\nbreak;\r\ncase DCCREQ_INIT_TECH:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_init_tech, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_UCD_SUB:\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_ucd_sub, tvb,\r\npos, length, ENC_NA);\r\nbreak;\r\ncase DCCREQ_SAID_SUB:\r\nif (length == 4)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_said_sub_cur, tvb,\r\npos, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_said_sub_new, tvb,\r\npos + 2, 2, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_SF_SUB:\r\ndissect_dccreq_sf_sub (tvb , dcc_tree , pos , length );\r\nbreak;\r\ncase DCCREQ_CMTS_MAC_ADDR:\r\nif (length == 6)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_cmts_mac_addr, tvb,\r\npos, length, ENC_NA);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_KEY_SEQ_NUM:\r\nif (length == 1)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_key_seq_num, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\ncase DCCREQ_HMAC_DIGEST:\r\nif (length == 20)\r\n{\r\nproto_tree_add_item (dcc_tree, hf_docsis_dccreq_hmac_digest, tvb,\r\npos, length, ENC_NA);\r\n}\r\nelse\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nbreak;\r\n}\r\npos = pos + length;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_docsis_dccreq (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_docsis_dccreq_tran_id ,\r\n{\r\n"Transaction ID",\r\n"docsis_dccreq.tran_id",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_up_chan_id ,\r\n{\r\n"Up Channel ID",\r\n"docsis_dccreq.up_chan_id",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_freq ,\r\n{\r\n"Frequency",\r\n"docsis_dccreq.ds_freq",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_mod_type ,\r\n{\r\n"Modulation Type",\r\n"docsis_dccreq.ds_mod_type",\r\nFT_UINT8, BASE_DEC, VALS (ds_mod_type_vals), 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_sym_rate ,\r\n{\r\n"Symbol Rate",\r\n"docsis_dccreq.ds_sym_rate",\r\nFT_UINT8, BASE_DEC, VALS (ds_sym_rate_vals), 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_intlv_depth_i ,\r\n{\r\n"Interleaver Depth I Value",\r\n"docsis_dccreq.ds_intlv_depth_i",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_intlv_depth_j ,\r\n{\r\n"Interleaver Depth J Value",\r\n"docsis_dccreq.ds_intlv_depth_j",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_chan_id ,\r\n{\r\n"Downstream Channel ID",\r\n"docsis_dccreq.ds_chan_id",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ds_sync_sub ,\r\n{\r\n"SYNC Substitution",\r\n"docsis_dccreq.ds_sync_sub",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_init_tech ,\r\n{\r\n"Initialization Technique",\r\n"docsis_dccreq.init_tech",\r\nFT_UINT8, BASE_DEC, VALS (init_tech_vals), 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_ucd_sub ,\r\n{\r\n"UCD Substitution",\r\n"docsis_dccreq.ucd_sub",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_said_sub_cur ,\r\n{\r\n"SAID Sub - Current Value",\r\n"docsis_dccreq.said_sub_cur",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_said_sub_new ,\r\n{\r\n"SAID Sub - New Value",\r\n"docsis_dccreq.said_sub_new",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_sf_sfid_cur ,\r\n{\r\n"SF Sub - SFID Current Value",\r\n"docsis_dccreq.sf_sfid_cur",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_sf_sfid_new ,\r\n{\r\n"SF Sub - SFID New Value",\r\n"docsis_dccreq.sf_sfid_new",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_sf_sid_cur ,\r\n{\r\n"SF Sub - SID Current Value",\r\n"docsis_dccreq.sf_sid_cur",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_sf_sid_new ,\r\n{\r\n"SF Sub - SID New Value",\r\n"docsis_dccreq.sf_sid_new",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_sf_unsol_grant_tref ,\r\n{\r\n"SF Sub - Unsolicited Grant Time Reference",\r\n"docsis_dccreq.sf_unsol_grant_tref",\r\nFT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_cmts_mac_addr ,\r\n{\r\n"CMTS Mac Address",\r\n"docsis_dccreq.cmts_mac_addr",\r\nFT_ETHER, BASE_NONE, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_key_seq_num ,\r\n{\r\n"Auth Key Sequence Number",\r\n"docsis_dccreq.key_seq_num",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{&hf_docsis_dccreq_hmac_digest ,\r\n{\r\n"HMAC-DigestNumber",\r\n"docsis_dccreq.hmac_digest",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_docsis_dccreq,\r\n&ett_docsis_dccreq_sf_sub,\r\n&ett_docsis_dccreq_ds_params,\r\n};\r\nproto_docsis_dccreq =\r\nproto_register_protocol ("DOCSIS Downstream Channel Change Request",\r\n"DOCSIS DCC-REQ", "docsis_dccreq");\r\nproto_register_field_array (proto_docsis_dccreq, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\nregister_dissector ("docsis_dccreq", dissect_dccreq, proto_docsis_dccreq);\r\n}\r\nvoid\r\nproto_reg_handoff_docsis_dccreq (void)\r\n{\r\ndissector_handle_t docsis_dccreq_handle;\r\ndocsis_dccreq_handle = find_dissector ("docsis_dccreq");\r\ndissector_add_uint ("docsis_mgmt", 0x17, docsis_dccreq_handle);\r\n}
