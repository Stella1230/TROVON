static int\r\ndissect_zbee_zcl_ias_ace(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nproto_tree *payload_tree;\r\nzbee_zcl_packet *zcl;\r\nguint offset = 0;\r\nguint8 cmd_id;\r\ngint rem_len;\r\nif (data == NULL)\r\nreturn 0;\r\nzcl = (zbee_zcl_packet *)data;\r\ncmd_id = zcl->cmd_id;\r\nif (zcl->direction == ZBEE_ZCL_FCF_TO_SERVER) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_ias_ace_srv_rx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_srv_rx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_ias_ace, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_ARM:\r\ndissect_zcl_ias_ace_arm(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_BYPASS:\r\ndissect_zcl_ias_ace_bypass(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_GET_ZONE_INFO:\r\ndissect_zcl_ias_ace_get_zone_info(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_EMERGENCY:\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_FIRE:\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_PANIC:\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_GET_ZONE_ID_MAP:\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nelse {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_ias_ace_srv_tx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_srv_tx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_ias_ace, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_ARM_RES:\r\ndissect_zcl_ias_ace_arm_res(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_GET_ZONE_ID_MAP_RES:\r\ndissect_zcl_ias_ace_get_zone_id_map_res(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_ACE_GET_ZONE_INFO_RES:\r\ndissect_zcl_ias_ace_get_zone_info_res(tvb, payload_tree, &offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_arm(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_arm_mode, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_bypass(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_item *zone_id_list = NULL;\r\nproto_tree *sub_tree = NULL;\r\nguint8 num, i;\r\nnum = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_no_of_zones, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\nzone_id_list = proto_tree_add_item(tree, hf_zbee_zcl_ias_ace_zone_id_list, tvb, *offset, num, ENC_NA);\r\nsub_tree = proto_item_add_subtree(zone_id_list, ett_zbee_zcl_ias_ace_zone_id);\r\nfor(i = 0; i < num; i++){\r\nproto_tree_add_item(sub_tree, hf_zbee_zcl_ias_ace_zone_id, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\n}\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_get_zone_info(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_zone_id, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_arm_res(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_arm_notif, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_get_zone_id_map_res(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nguint8 i;\r\nfor(i = 0; i < 16; i++){\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_zone_id_map_section, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\n}\r\n}\r\nstatic void\r\ndissect_zcl_ias_ace_get_zone_info_res(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_zone_id, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_zone_type, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_ace_ieee_add, tvb, *offset, 8, ENC_NA);\r\n*offset += 8;\r\n}\r\nvoid\r\nproto_register_zbee_zcl_ias_ace(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_ias_ace_arm_mode,\r\n{ "Arm Mode", "zbee_zcl_sas.ias_ace.arm_mode", FT_UINT8, BASE_DEC, VALS(arm_mode_values),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_no_of_zones,\r\n{ "Number of Zones", "zbee_zcl_sas.ias_ace.no_of_zones", FT_UINT8, BASE_DEC, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_zone_id,\r\n{ "Zone ID", "zbee_zcl_sas.ias_ace.zone_id", FT_UINT8, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_zone_id_list,\r\n{ "Zone ID List", "zbee_zcl_sas.ias_ace.zone_id_list", FT_NONE, BASE_NONE, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_arm_notif,\r\n{ "Arm Notifications", "zbee_zcl_sas.ias_ace.arm_notif", FT_UINT8, BASE_DEC, VALS(arm_notif_values),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_zone_id_map_section,\r\n{ "Zone ID Map Section", "zbee_zcl_sas.ias_ace.zone_id_map_section", FT_UINT16, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_zone_type,\r\n{ "Zone Type", "zbee_zcl_sas.ias_ace.zone_type", FT_UINT16, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_ieee_add,\r\n{ "IEEE Address", "zbee_zcl_sas.ias_ace.ieee_add", FT_BYTES, BASE_NONE, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_srv_rx_cmd_id,\r\n{ "Command", "zbee_zcl_sas.ias_ace.cmd.srv_rx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_ias_ace_srv_rx_cmd_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_ace_srv_tx_cmd_id,\r\n{ "Command", "zbee_zcl_sas.ias_ace.cmd.srv_tx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_ias_ace_srv_tx_cmd_names),\r\n0x00, NULL, HFILL } }\r\n};\r\nstatic gint *ett[ZBEE_ZCL_IAS_ACE_NUM_ETT];\r\nett[0] = &ett_zbee_zcl_ias_ace;\r\nett[1] = &ett_zbee_zcl_ias_ace_zone_id;\r\nett[2] = &ett_zbee_zcl_ias_ace_zone_id_map_sec;\r\nett[3] = &ett_zbee_zcl_ias_ace_zone_id_map_sec_elem;\r\nproto_zbee_zcl_ias_ace = proto_register_protocol("ZigBee ZCL IAS ACE", "ZCL IAS ACE", ZBEE_PROTOABBREV_ZCL_IAS_ACE);\r\nproto_register_field_array(proto_zbee_zcl_ias_ace, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_IAS_ACE, dissect_zbee_zcl_ias_ace, proto_zbee_zcl_ias_ace);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_ias_ace(void)\r\n{\r\ndissector_handle_t ias_ace_handle;\r\nias_ace_handle = find_dissector(ZBEE_PROTOABBREV_ZCL_IAS_ACE);\r\ndissector_add_uint("zbee.zcl.cluster", ZBEE_ZCL_CID_IAS_ACE, ias_ace_handle);\r\nzbee_zcl_init_cluster( proto_zbee_zcl_ias_ace,\r\nett_zbee_zcl_ias_ace,\r\nZBEE_ZCL_CID_IAS_ACE,\r\n-1,\r\nhf_zbee_zcl_ias_ace_srv_rx_cmd_id,\r\nhf_zbee_zcl_ias_ace_srv_tx_cmd_id,\r\nNULL\r\n);\r\n}\r\nstatic int\r\ndissect_zbee_zcl_ias_wd(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nproto_tree *payload_tree;\r\nzbee_zcl_packet *zcl;\r\nguint offset = 0;\r\nguint8 cmd_id;\r\ngint rem_len;\r\nif (data == NULL)\r\nreturn 0;\r\nzcl = (zbee_zcl_packet *)data;\r\ncmd_id = zcl->cmd_id;\r\nif (zcl->direction == ZBEE_ZCL_FCF_TO_SERVER) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%s, Seq: %u",\r\nval_to_str_const(cmd_id, zbee_zcl_ias_wd_srv_rx_cmd_names, "Unknown Command"),\r\nzcl->tran_seqno);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_srv_rx_cmd_id, tvb, offset, 1, cmd_id);\r\nrem_len = tvb_reported_length_remaining(tvb, ++offset);\r\nif (rem_len > 0) {\r\npayload_tree = proto_tree_add_subtree(tree, tvb, offset, rem_len, ett_zbee_zcl_ias_wd, NULL, "Payload");\r\nswitch (cmd_id) {\r\ncase ZBEE_ZCL_CMD_ID_IAS_WD_START_WARNING:\r\ndissect_zcl_ias_wd_start_warning(tvb, payload_tree, &offset);\r\nbreak;\r\ncase ZBEE_ZCL_CMD_ID_IAS_WD_SQUAWK:\r\ndissect_zcl_ias_wd_squawk(tvb, payload_tree, &offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic void\r\ndissect_zcl_ias_wd_start_warning(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_warning_mode, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_strobe_2bit, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_warning_duration, tvb, *offset, 2, ENC_LITTLE_ENDIAN);\r\n*offset += 2;\r\n}\r\nstatic void\r\ndissect_zcl_ias_wd_squawk(tvbuff_t *tvb, proto_tree *tree, guint *offset)\r\n{\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_squawk_mode, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_strobe_1bit, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\nproto_tree_add_item(tree, hf_zbee_zcl_ias_wd_squawk_level, tvb, *offset, 1, ENC_LITTLE_ENDIAN);\r\n*offset += 1;\r\n}\r\nvoid\r\ndissect_zcl_ias_wd_attr_data(proto_tree *tree, tvbuff_t *tvb, guint *offset, guint16 attr_id, guint data_type)\r\n{\r\nswitch (attr_id) {\r\ncase ZBEE_ZCL_ATTR_ID_IAS_WD_MAX_DURATION:\r\ndefault:\r\ndissect_zcl_attr_data(tvb, tree, offset, data_type);\r\nbreak;\r\n}\r\n}\r\nvoid\r\nproto_register_zbee_zcl_ias_wd(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_zbee_zcl_ias_wd_attr_id,\r\n{ "Attribute", "zbee_zcl_sas.ias_wd.attr_id", FT_UINT16, BASE_HEX, VALS(zbee_zcl_ias_wd_attr_names),\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_warning_mode,\r\n{ "Warning Mode", "zbee_zcl_sas.ias_wd.warning_mode", FT_UINT8, BASE_DEC, VALS(warning_mode_values),\r\nZBEE_ZCL_IAS_WD_WARNING_MODE_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_strobe_2bit,\r\n{ "Strobe", "zbee_zcl_sas.ias_wd.strobe", FT_UINT8, BASE_DEC, VALS(strobe_2bit_values),\r\nZBEE_ZCL_IAS_WD_STROBE_2BIT_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_squawk_mode,\r\n{ "Squawk Mode", "zbee_zcl_sas.ias_wd.squawk_mode", FT_UINT8, BASE_DEC, VALS(squawk_mode_values),\r\nZBEE_ZCL_IAS_WD_SWQUAWK_MODE_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_strobe_1bit,\r\n{ "Strobe", "zbee_zcl_sas.ias_wd.strobe", FT_UINT8, BASE_DEC, VALS(strobe_1bit_values),\r\nZBEE_ZCL_IAS_WD_STROBE_1BIT_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_warning_duration,\r\n{ "Warning Duration", "zbee_zcl_sas.ias_wd.warning_duration", FT_UINT16, BASE_HEX, NULL,\r\n0x00, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_squawk_level,\r\n{ "Squawk Level", "zbee_zcl_sas.ias_wd.squawk_level", FT_UINT8, BASE_DEC, VALS(squawk_level_values),\r\nZBEE_ZCL_IAS_WD_SWQUAWK_LEVEL_MASK, NULL, HFILL } },\r\n{ &hf_zbee_zcl_ias_wd_srv_rx_cmd_id,\r\n{ "Command", "zbee_zcl_sas.ias_wd.cmd.srv_rx.id", FT_UINT8, BASE_HEX, VALS(zbee_zcl_ias_wd_srv_rx_cmd_names),\r\n0x00, NULL, HFILL } }\r\n};\r\nstatic gint *ett[ZBEE_ZCL_IAS_WD_NUM_ETT];\r\nett[0] = &ett_zbee_zcl_ias_wd;\r\nproto_zbee_zcl_ias_wd = proto_register_protocol("ZigBee ZCL IAS WD", "ZCL IAS WD", ZBEE_PROTOABBREV_ZCL_IAS_WD);\r\nproto_register_field_array(proto_zbee_zcl_ias_wd, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector(ZBEE_PROTOABBREV_ZCL_IAS_WD, dissect_zbee_zcl_ias_wd, proto_zbee_zcl_ias_wd);\r\n}\r\nvoid\r\nproto_reg_handoff_zbee_zcl_ias_wd(void)\r\n{\r\ndissector_handle_t ias_wd_handle;\r\nias_wd_handle = find_dissector(ZBEE_PROTOABBREV_ZCL_IAS_WD);\r\ndissector_add_uint("zbee.zcl.cluster", ZBEE_ZCL_CID_IAS_WD, ias_wd_handle);\r\nzbee_zcl_init_cluster( proto_zbee_zcl_ias_wd,\r\nett_zbee_zcl_ias_wd,\r\nZBEE_ZCL_CID_IAS_WD,\r\nhf_zbee_zcl_ias_wd_attr_id,\r\nhf_zbee_zcl_ias_wd_srv_rx_cmd_id,\r\n-1,\r\n(zbee_zcl_fn_attr_data)dissect_zcl_ias_wd_attr_data\r\n);\r\n}
