static int\r\nkrb5rpc_dissect_sendto_kdc_rqst (tvbuff_t * tvb, int offset,\r\npacket_info * pinfo, proto_tree * tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 keysize, spare1, remain;\r\nproto_item *item;\r\ntvbuff_t *krb5_tvb;\r\nproto_tree *subtree;\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_rqst_keysize, &keysize);\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_rqst_spare1, &spare1);\r\nitem = proto_tree_add_item (tree, hf_krb5rpc_krb5, tvb, offset, -1, ENC_NA);\r\nsubtree = proto_item_add_subtree (item, ett_krb5rpc_krb5);\r\nremain = tvb_captured_length_remaining(tvb, offset);\r\nkrb5_tvb = tvb_new_subset (tvb, offset, remain, remain);\r\noffset = dissect_kerberos_main (krb5_tvb, pinfo, subtree, TRUE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\nkrb5rpc_dissect_sendto_kdc_resp (tvbuff_t * tvb, int offset,\r\npacket_info * pinfo, proto_tree * tree,\r\ndcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 resp_len, maxsize, spare1, keysize, remain;\r\nproto_item *item;\r\ntvbuff_t *krb5_tvb;\r\nproto_tree *subtree;\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_resp_len, &resp_len);\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_resp_max, &maxsize);\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_resp_spare1, &spare1);\r\noffset =\r\ndissect_ndr_uint32(tvb, offset, pinfo, tree, di, drep,\r\nhf_krb5rpc_sendto_kdc_resp_keysize, &keysize);\r\nitem = proto_tree_add_item (tree, hf_krb5rpc_krb5, tvb, offset, -1, ENC_NA);\r\nsubtree = proto_item_add_subtree (item, ett_krb5rpc_krb5);\r\nremain = tvb_captured_length_remaining(tvb, offset);\r\nkrb5_tvb = tvb_new_subset (tvb, offset, remain, remain);\r\noffset = dissect_kerberos_main (krb5_tvb, pinfo, subtree, TRUE, NULL);\r\noffset += 16;\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_krb5rpc (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_krb5rpc_opnum,\r\n{"Opnum", "krb5rpc.opnum", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{&hf_krb5rpc_sendto_kdc_rqst_keysize,\r\n{"Request keysize",\r\n"krb5rpc.sendto_kdc_rqst_keysize", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{&hf_krb5rpc_sendto_kdc_rqst_spare1,\r\n{"Request spare1",\r\n"krb5rpc.sendto_kdc_rqst_spare1", FT_UINT32, BASE_DEC, NULL, 0x0, NULL,\r\nHFILL}},\r\n{&hf_krb5rpc_sendto_kdc_resp_len,\r\n{"Response length", "krb5rpc.sendto_kdc_resp_len",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL}},\r\n{&hf_krb5rpc_sendto_kdc_resp_max,\r\n{"Response max", "krb5rpc.sendto_kdc_resp_max",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL}},\r\n{&hf_krb5rpc_sendto_kdc_resp_spare1,\r\n{"Response spare1",\r\n"krb5rpc.sendto_kdc_resp_spare1", FT_UINT32, BASE_DEC, NULL, 0x0, NULL,\r\nHFILL}},\r\n{&hf_krb5rpc_sendto_kdc_resp_keysize,\r\n{"Response key size",\r\n"krb5rpc.sendto_kdc_resp_keysize", FT_UINT32, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n#if 0\r\n{&hf_krb5rpc_sendto_kdc_resp_st,\r\n{"Response st", "krb5rpc.sendto_kdc_resp_st",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL}},\r\n#endif\r\n{&hf_krb5rpc_krb5,\r\n{"krb5", "krb5rpc.krb5", FT_BYTES, BASE_NONE, NULL, 0x0,\r\n"krb5 blob", HFILL}},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_krb5rpc,\r\n&ett_krb5rpc_krb5,\r\n};\r\nproto_krb5rpc =\r\nproto_register_protocol ("DCE/RPC Kerberos V", "KRB5RPC", "krb5rpc");\r\nproto_register_field_array (proto_krb5rpc, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\n}\r\nvoid\r\nproto_reg_handoff_krb5rpc (void)\r\n{\r\ndcerpc_init_uuid (proto_krb5rpc, ett_krb5rpc, &uuid_krb5rpc, ver_krb5rpc,\r\nkrb5rpc_dissectors, hf_krb5rpc_opnum);\r\n}
