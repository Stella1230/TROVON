static int\r\ndissect_oxid_simple_ping_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_setid, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_simple_ping_resp(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 u32HResult;\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)") );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_server_alive_resp(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 u32HResult;\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)") );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_complex_ping_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint16 u16SeqNum;\r\nguint16 u16AddToSet;\r\nguint16 u16DelFromSet;\r\nguint32 u32Pointer;\r\nguint32 u32ArraySize;\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_setid, NULL);\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_seqnum, &u16SeqNum);\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_addtoset, &u16AddToSet);\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_delfromset, &u16DelFromSet);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " AddToSet=%u DelFromSet=%u",\r\nu16AddToSet, u16DelFromSet);\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nwhile (u16AddToSet--) {\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_oid, NULL);\r\n}\r\n}\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nwhile (u16DelFromSet--) {\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_oid, NULL);\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_complex_ping_resp(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint16 u16PingBackoffFactor;\r\nguint32 u32HResult;\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_setid, NULL);\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_ping_backoff_factor, &u16PingBackoffFactor);\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)") );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_resolve_oxid2_rqst(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint16 u16ProtSeqs;\r\nguint32 u32ArraySize;\r\nguint32 u32ItemIdx;\r\noffset = dissect_dcom_ID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_oxid, NULL);\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_requested_protseqs, &u16ProtSeqs);\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\nu32ItemIdx = 1;\r\nwhile (u32ArraySize--) {\r\noffset = dissect_dcom_WORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_protseqs, &u16ProtSeqs);\r\nu32ItemIdx++;\r\n}\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_resolve_oxid2_resp(tvbuff_t *tvb, int offset,\r\npacket_info *pinfo, proto_tree *tree, dcerpc_info *di, guint8 *drep)\r\n{\r\nguint32 u32Pointer;\r\nguint32 u32ArraySize;\r\ne_guid_t ipid;\r\nguint32 u32AuthnHint;\r\nguint16 u16VersionMajor;\r\nguint16 u16VersionMinor;\r\nguint32 u32HResult;\r\noffset = dissect_dcom_dcerpc_pointer(tvb, offset, pinfo, tree, di, drep,\r\n&u32Pointer);\r\nif (u32Pointer) {\r\noffset = dissect_dcom_dcerpc_array_size(tvb, offset, pinfo, tree, di, drep,\r\n&u32ArraySize);\r\noffset = dissect_dcom_DUALSTRINGARRAY(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_bindings, NULL);\r\noffset = dissect_dcom_UUID(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_ipid, &ipid);\r\noffset = dissect_dcom_DWORD(tvb, offset, pinfo, tree, di, drep,\r\nhf_oxid_authn_hint, &u32AuthnHint);\r\noffset = dissect_dcom_COMVERSION(tvb, offset, pinfo, tree, di, drep,\r\n&u16VersionMajor, &u16VersionMinor);\r\n}\r\noffset = dissect_dcom_HRESULT(tvb, offset, pinfo, tree, di, drep,\r\n&u32HResult);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " -> %s",\r\nval_to_str(u32HResult, dcom_hresult_vals, "Unknown (0x%08x)") );\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_oxid_server_alive2_resp(tvbuff_t *tvb, int offset, packet_info *pinfo,\r\nproto_tree *tree, dcerpc_info *di, guint8 *drep) {\r\nguint16 u16VersionMajor;\r\nguint16 u16VersionMinor;\r\noffset = dissect_dcom_COMVERSION(tvb, offset, pinfo, tree, di, drep, &u16VersionMajor, &u16VersionMinor);\r\ndissect_dcerpc_uint64(tvb, offset, pinfo, tree, di, drep, hf_oxid_Unknown1, NULL);\r\noffset += 8;\r\noffset = dissect_dcom_DUALSTRINGARRAY(tvb, offset, pinfo, tree, di, drep, hf_oxid_ds_array, NULL);\r\ndissect_dcerpc_uint64(tvb, offset, pinfo, tree, di, drep, hf_oxid_Unknown2, NULL);\r\noffset += 8;\r\nreturn offset;\r\n}\r\nvoid\r\nproto_register_oxid (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_oxid_opnum,\r\n{ "Operation", "oxid.opnum", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_setid,\r\n{ "SetId", "oxid.setid", FT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_seqnum,\r\n{ "SeqNum", "oxid.seqnum", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_addtoset,\r\n{ "AddToSet", "oxid.addtoset", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_delfromset,\r\n{ "DelFromSet", "oxid.delfromset", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_oid,\r\n{ "OID", "oxid.oid", FT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_ping_backoff_factor,\r\n{ "PingBackoffFactor", "oxid.ping_backoff_factor", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_oxid,\r\n{ "OXID", "oxid.oxid", FT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_requested_protseqs,\r\n{ "RequestedProtSeq", "oxid.requested_protseqs", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_protseqs,\r\n{ "ProtSeq", "oxid.protseqs", FT_UINT16, BASE_DEC, VALS(dcom_protseq_vals), 0x0, NULL, HFILL }},\r\n{ &hf_oxid_bindings,\r\n{ "OxidBindings", "oxid.bindings", FT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_ipid,\r\n{ "IPID", "oxid.ipid", FT_GUID, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_authn_hint,\r\n{ "AuthnHint", "oxid.authn_hint", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_ds_array,\r\n{ "Address", "dcom.oxid.address", FT_NONE, BASE_NONE, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_Unknown1,\r\n{ "unknown 8 bytes 1", "oxid.unknown1", FT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{ &hf_oxid_Unknown2,\r\n{ "unknown 8 bytes 2", "oxid.unknown2", FT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_oxid\r\n};\r\nproto_oxid = proto_register_protocol ("DCOM OXID Resolver", "IOXIDResolver", "oxid");\r\nproto_register_field_array (proto_oxid, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\n}\r\nvoid\r\nproto_reg_handoff_oxid (void)\r\n{\r\ndcerpc_init_uuid (proto_oxid, ett_oxid, &uuid_oxid, ver_oxid, oxid_dissectors, hf_oxid_opnum);\r\n}
