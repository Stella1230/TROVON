void\r\ndecrease_childcount(struct sctp_analyse *parent)\r\n{\r\nif (parent->num_children > 0)\r\nparent->num_children--;\r\n}\r\nvoid\r\nincrease_childcount(struct sctp_analyse *parent)\r\n{\r\nparent->num_children++;\r\n}\r\nvoid\r\nset_child(struct sctp_udata *child, struct sctp_analyse *parent)\r\n{\r\nparent->children = g_list_append(parent->children, child);\r\n}\r\nvoid\r\nremove_child(struct sctp_udata *child, struct sctp_analyse *parent)\r\n{\r\nparent->children = g_list_remove(parent->children, child);\r\n}\r\nstatic void\r\non_destroy(GObject *object _U_, gpointer user_data)\r\n{\r\nstruct sctp_analyse *u_data;\r\nstruct sctp_udata *child_data;\r\nguint16 i, j;\r\nGList *list;\r\nu_data = (struct sctp_analyse*)user_data;\r\nif (u_data->window)\r\n{\r\ngtk_grab_remove(GTK_WIDGET(u_data->window));\r\ngtk_widget_destroy(GTK_WIDGET(u_data->window));\r\n}\r\nif (u_data->num_children > 0)\r\n{\r\nj = u_data->num_children;\r\nfor (i=0; i<j; i++)\r\n{\r\nlist = g_list_last(u_data->children);\r\nchild_data = (struct sctp_udata *)list->data;\r\ngtk_grab_remove(GTK_WIDGET(child_data->io->window));\r\ngtk_widget_destroy(GTK_WIDGET(child_data->io->window));\r\n}\r\ng_list_free(u_data->children);\r\nu_data->children = NULL;\r\n}\r\ng_free(u_data->analyse_nb->page2);\r\ng_free(u_data->analyse_nb->page3);\r\ng_free(u_data->analyse_nb);\r\nif (sctp_stat_get_info()->children != NULL)\r\n{\r\nremove_analyse_child(u_data);\r\ndecrease_analyse_childcount();\r\n}\r\ng_free(u_data);\r\n}\r\nstatic void\r\non_notebook_switch_page(void)\r\n{\r\n}\r\nstatic void\r\non_chunk_stat_bt(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\nsctp_assoc_info_t *assinfo;\r\nint i;\r\nassinfo = &static_assoc;\r\nassinfo->addr_chunk_count = static_assoc.addr_chunk_count;\r\nfor (i=0; i<NUM_CHUNKS; i++)\r\n{\r\nassinfo->chunk_count[i] = static_assoc.chunk_count[i];\r\nassinfo->ep1_chunk_count[i] = static_assoc.ep1_chunk_count[i];\r\nassinfo->ep2_chunk_count[i] = static_assoc.ep2_chunk_count[i];\r\n}\r\nu_data->assoc = assinfo;\r\nsctp_chunk_dlg_show(u_data);\r\n}\r\nstatic void\r\non_close_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\nif (u_data->window)\r\n{\r\ngtk_grab_remove(GTK_WIDGET(u_data->window));\r\ngtk_widget_destroy(GTK_WIDGET(u_data->window));\r\n}\r\n}\r\nstatic void\r\non_chunk1_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\nsctp_assoc_info_t *assinfo;\r\nassinfo = &static_assoc;\r\nassinfo->addr_chunk_count = static_assoc.addr_chunk_count;\r\nu_data->assoc = assinfo;\r\nsctp_chunk_stat_dlg_show(1, u_data);\r\n}\r\nstatic void on_chunk2_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\nsctp_assoc_info_t *assinfo;\r\nassinfo = &static_assoc;\r\nassinfo->addr_chunk_count = static_assoc.addr_chunk_count;\r\nu_data->assoc = assinfo;\r\nsctp_chunk_stat_dlg_show(2, u_data);\r\n}\r\nstatic void\r\non_graph1_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\ncreate_graph(1, u_data);\r\n}\r\nstatic void\r\non_graph2_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\ncreate_graph(2, u_data);\r\n}\r\nstatic void\r\non_graph_byte1_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\ncreate_byte_graph(1, u_data);\r\n}\r\nstatic void\r\non_graph_byte2_dlg(GtkWidget *widget _U_, struct sctp_analyse *u_data)\r\n{\r\ncreate_byte_graph(2, u_data);\r\n}\r\nvoid\r\nupdate_analyse_dlg(struct sctp_analyse *u_data)\r\n{\r\ngchar label_txt[50];\r\nif (u_data->assoc == NULL)\r\nreturn;\r\nif (u_data->window != NULL)\r\n{\r\ngtk_list_store_clear(GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW\r\n(u_data->analyse_nb->page2->clist))));\r\ngtk_list_store_clear(GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW\r\n(u_data->analyse_nb->page3->clist))));\r\n}\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Checksum Type: %s",\r\nu_data->assoc->checksum_type);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->checktype), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Checksum Errors: %u",\r\nu_data->assoc->n_checksum_errors);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->checksum), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Bundling Errors: %u",\r\nu_data->assoc->n_bundling_errors);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->bundling), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Padding Errors: %u",\r\nu_data->assoc->n_padding_errors);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->padding), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Length Errors: %u",\r\nu_data->assoc->n_length_errors);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->length), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Value Errors: %u",\r\nu_data->assoc->n_value_errors);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->value), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"No of Data Chunks from EP1 to EP2: %u",\r\nu_data->assoc->n_data_chunks_ep1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->chunks_ep1), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"No of Data Bytes from EP1 to EP2: %u",\r\nu_data->assoc->n_data_bytes_ep1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->bytes_ep1), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"No of Data Chunks from EP2 to EP1: %u",\r\nu_data->assoc->n_data_chunks_ep2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->chunks_ep2), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"No of Data Bytes from EP2 to EP1: %u",\r\nu_data->assoc->n_data_bytes_ep2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->bytes_ep2), label_txt);\r\nif (u_data->assoc->init == TRUE)\r\ngtk_frame_set_label(GTK_FRAME(u_data->analyse_nb->page2->addr_frame),\r\n"Complete list of IP-Addresses as provided in the INIT-Chunk");\r\nelse if ((u_data->assoc->initack == TRUE) && (u_data->assoc->initack_dir == 1))\r\ngtk_frame_set_label(GTK_FRAME(u_data->analyse_nb->page2->addr_frame),\r\n"Complete list of IP-Addresses as provided in the INITACK-Chunk");\r\nelse\r\ngtk_frame_set_label(GTK_FRAME(u_data->analyse_nb->page2->addr_frame),\r\n"List of used IP-Addresses");\r\nif (u_data->assoc->addr1 != NULL)\r\n{\r\nGList *list;\r\nlist = g_list_first(u_data->assoc->addr1);\r\nwhile (list)\r\n{\r\ngchar *field;\r\naddress *store;\r\nGtkListStore *list_store;\r\nstore = (address *)(list->data);\r\nif (store->type != AT_NONE) {\r\nif ((store->type == AT_IPv4) || (store->type == AT_IPv6))\r\n{\r\nfield = (gchar*)address_to_str(NULL, store);\r\n}\r\nelse\r\n{\r\nfield = NULL;\r\n}\r\nlist_store = GTK_LIST_STORE(\r\ngtk_tree_view_get_model(GTK_TREE_VIEW(u_data->analyse_nb->page2->clist)));\r\ngtk_list_store_insert_with_values( list_store , NULL, G_MAXINT,\r\n0, field, -1);\r\nwmem_free(NULL, field);\r\n}\r\nlist = g_list_next(list);\r\n}\r\n}\r\nelse\r\n{\r\nreturn;\r\n}\r\ng_snprintf(label_txt, sizeof(label_txt), "Port: %u", u_data->assoc->port1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->port), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt), "Sent Verification Tag: 0x%x", u_data->assoc->verification_tag1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->veritag), label_txt);\r\nif ((u_data->assoc->init == TRUE) ||\r\n((u_data->assoc->initack == TRUE) && (u_data->assoc->initack_dir == 1)))\r\n{\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Requested Number of Inbound Streams: %u",\r\nu_data->assoc->instream1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->max_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Minimum Number of Inbound Streams: %u",\r\n((u_data->assoc->instream1 > u_data->assoc->outstream2) ?\r\nu_data->assoc->outstream2 : u_data->assoc->instream1));\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->min_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Provided Number of Outbound Streams: %u",\r\nu_data->assoc->outstream1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->max_out), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Minimum Number of Outbound Streams: %u",\r\n((u_data->assoc->outstream1 > u_data->assoc->instream2) ?\r\nu_data->assoc->instream2 : u_data->assoc->outstream1));\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->min_out), label_txt);\r\n}\r\nelse\r\n{\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Used Number of Inbound Streams: %u",\r\nu_data->assoc->instream1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->max_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Used Number of Outbound Streams: %u",\r\nu_data->assoc->outstream1);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page2->max_out), label_txt);\r\n}\r\nif ((u_data->assoc->initack == TRUE) && (u_data->assoc->initack_dir == 2))\r\ngtk_frame_set_label(GTK_FRAME(u_data->analyse_nb->page3->addr_frame),\r\n"Complete list of IP-Addresses as provided in the INITACK-Chunk");\r\nelse\r\ngtk_frame_set_label(GTK_FRAME(u_data->analyse_nb->page3->addr_frame),\r\n"List of used IP-Addresses");\r\nif (u_data->assoc->addr2 != NULL)\r\n{\r\nGList *list;\r\nlist = g_list_first(u_data->assoc->addr2);\r\nwhile (list)\r\n{\r\ngchar *field;\r\naddress *store;\r\nGtkListStore *list_store;\r\nstore = (address *)(list->data);\r\nif (store->type != AT_NONE) {\r\nif ((store->type == AT_IPv4) || (store->type == AT_IPv6))\r\n{\r\nfield = (gchar*)address_to_str(NULL, store);\r\n}\r\nelse\r\n{\r\nfield = NULL;\r\n}\r\nlist_store = GTK_LIST_STORE(\r\ngtk_tree_view_get_model(GTK_TREE_VIEW(u_data->analyse_nb->page3->clist)));\r\ngtk_list_store_insert_with_values( list_store , NULL, G_MAXINT,\r\n0, field, -1);\r\nwmem_free(NULL, field);\r\n}\r\nlist = g_list_next(list);\r\n}\r\n}\r\nelse\r\n{\r\nreturn;\r\n}\r\ng_snprintf(label_txt, sizeof(label_txt), "Port: %u", u_data->assoc->port2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->port), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt), "Sent Verification Tag: 0x%x", u_data->assoc->verification_tag2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->veritag), label_txt);\r\nif (u_data->assoc->initack == TRUE)\r\n{\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Requested Number of Inbound Streams: %u",\r\nu_data->assoc->instream2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->max_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Minimum Number of Inbound Streams: %u",\r\n((u_data->assoc->instream2 > u_data->assoc->outstream1) ?\r\nu_data->assoc->outstream1 : u_data->assoc->instream2));\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->min_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Provided Number of Outbound Streams: %u",\r\nu_data->assoc->outstream2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->max_out), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Minimum Number of Outbound Streams: %u",\r\n((u_data->assoc->outstream2 > u_data->assoc->instream1) ?\r\nu_data->assoc->instream1 : u_data->assoc->outstream2));\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->min_out), label_txt);\r\n}\r\nelse\r\n{\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Used Number of Inbound Streams: %u",\r\nu_data->assoc->instream2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->max_in), label_txt);\r\ng_snprintf(label_txt, sizeof(label_txt),\r\n"Used Number of Outbound Streams: %u",\r\nu_data->assoc->outstream2);\r\ngtk_label_set_text(GTK_LABEL(u_data->analyse_nb->page3->min_out), label_txt);\r\n}\r\n}\r\nstatic void\r\nsctp_set_filter(GtkButton *button _U_, struct sctp_analyse *u_data)\r\n{\r\nsctp_assoc_info_t *selected_stream;\r\ngchar *filter_string = NULL;\r\nselected_stream = u_data->assoc;\r\nif (selected_stream == NULL)\r\nreturn;\r\nif (selected_stream->check_address == FALSE)\r\n{\r\ngchar *f_string;\r\nf_string = g_strdup_printf(\r\n"((sctp.srcport==%u && sctp.dstport==%u &&"\r\n" ((sctp.verification_tag==0x%x && sctp.verification_tag!=0x0) ||"\r\n" (sctp.verification_tag==0x0 && sctp.initiate_tag==0x%x) ||"\r\n" (sctp.verification_tag==0x%x &&"\r\n" (sctp.abort_t_bit==1 || sctp.shutdown_complete_t_bit==1)))) ||"\r\n" (sctp.srcport==%u && sctp.dstport==%u &&"\r\n" ((sctp.verification_tag==0x%x && sctp.verification_tag!=0x0) ||"\r\n" (sctp.verification_tag==0x0 && sctp.initiate_tag==0x%x) ||"\r\n" (sctp.verification_tag==0x%x &&"\r\n" (sctp.abort_t_bit==1 || sctp.shutdown_complete_t_bit==1)))))",\r\nselected_stream->port1,\r\nselected_stream->port2,\r\nselected_stream->verification_tag1,\r\nselected_stream->initiate_tag,\r\nselected_stream->verification_tag2,\r\nselected_stream->port2,\r\nselected_stream->port1,\r\nselected_stream->verification_tag2,\r\nselected_stream->initiate_tag,\r\nselected_stream->verification_tag1);\r\nfilter_string = f_string;\r\n}\r\nelse\r\n{\r\nGList *srclist, *dstlist;\r\ngchar *str;\r\nGString *gstring;\r\nstruct sockaddr_in *infosrc;\r\nstruct sockaddr_in *infodst;\r\naddress addr;\r\nchar *addr_str;\r\nsrclist = g_list_first(selected_stream->addr1);\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\ngstring = g_string_new(g_strdup_printf(\r\n"((sctp.srcport==%u && sctp.dstport==%u && (ip.src==%s",\r\nselected_stream->port1,\r\nselected_stream->port2,\r\naddr_str));\r\nsrclist = g_list_next(srclist);\r\nwmem_free(NULL, addr_str);\r\nwhile (srclist)\r\n{\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\nsrclist = g_list_next(srclist);\r\nwmem_free(NULL, addr_str);\r\n}\r\ndstlist = g_list_first(selected_stream->addr2);\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(") && (ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\ndstlist = g_list_next(dstlist);\r\nwmem_free(NULL, addr_str);\r\nwhile (dstlist)\r\n{\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\ndstlist = g_list_next(dstlist);\r\nwmem_free(NULL, addr_str);\r\n}\r\nsrclist = g_list_first(selected_stream->addr1);\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(")) || (sctp.dstport==%u && sctp.srcport==%u && (ip.dst==%s",\r\nselected_stream->port1,\r\nselected_stream->port2,\r\naddr_str);\r\ng_string_append(gstring, str);\r\nsrclist = g_list_next(srclist);\r\nwmem_free(NULL, addr_str);\r\nwhile (srclist)\r\n{\r\ninfosrc = (struct sockaddr_in *)(srclist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infosrc->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.dst==%s", addr_str);\r\ng_string_append(gstring, str);\r\nsrclist = g_list_next(srclist);\r\nwmem_free(NULL, addr_str);\r\n}\r\ndstlist = g_list_first(selected_stream->addr2);\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf(") && (ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\ndstlist = g_list_next(dstlist);\r\nwmem_free(NULL, addr_str);\r\nwhile (dstlist)\r\n{\r\ninfodst = (struct sockaddr_in *)(dstlist->data);\r\nset_address(&addr, AT_IPv4, 4, &(infodst->sin_addr.s_addr));\r\naddr_str = (char*)address_to_str(NULL, &addr);\r\nstr = g_strdup_printf("|| ip.src==%s", addr_str);\r\ng_string_append(gstring, str);\r\ndstlist = g_list_next(dstlist);\r\nwmem_free(NULL, addr_str);\r\n}\r\nstr = g_strdup(")))");\r\ng_string_append(gstring, str);\r\nfilter_string = g_string_free(gstring, FALSE);\r\n}\r\nif (filter_string != NULL) {\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), filter_string);\r\n} else {\r\ng_assert_not_reached();\r\n}\r\n}\r\nstatic void\r\nanalyse_window_set_title(struct sctp_analyse *u_data)\r\n{\r\nchar *display_name;\r\nchar *title;\r\nif (!u_data->window) {\r\nreturn;\r\n}\r\ndisplay_name = cf_get_display_name(&cfile);\r\ntitle = g_strdup_printf("SCTP Analyse Association: %s Port1 %u Port2 %u",\r\ndisplay_name, u_data->assoc->port1, u_data->assoc->port2);\r\ng_free(display_name);\r\ngtk_window_set_title(GTK_WINDOW(u_data->window), title);\r\ng_free(title);\r\n}\r\nstatic GtkWidget *\r\ncreate_list(void)\r\n{\r\nGtkListStore *list_store;\r\nGtkWidget *list;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeView *list_view;\r\nlist_store = gtk_list_store_new(1,\r\nG_TYPE_STRING\r\n);\r\nlist = gtk_tree_view_new_with_model (GTK_TREE_MODEL(list_store));\r\nlist_view = GTK_TREE_VIEW(list);\r\ngtk_tree_view_set_fixed_height_mode(list_view, TRUE);\r\ng_object_unref (G_OBJECT(list_store));\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Address", renderer,\r\n"text", 0,\r\nNULL);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 300);\r\ngtk_tree_view_append_column (list_view, column);\r\ngtk_tree_view_set_headers_visible(list_view, FALSE);\r\nreturn list;\r\n}\r\nstatic void\r\ncreate_analyse_window(struct sctp_analyse *u_data)\r\n{\r\nGtkWidget *window;\r\nGtkWidget *notebook;\r\nGtkWidget *main_vb, *page1, *page2, *page3, *hbox, *vbox_l, *vbox_r, *addr_hb, *stat_fr;\r\nGtkWidget *hbox_l1, *hbox_l2, *label, *h_button_box;\r\nGtkWidget *chunk_stat_bt, *close_bt, *graph_bt1, *graph_bt2, *chunk_bt1, *bt_filter;\r\nu_data->analyse_nb = (struct notes *)g_malloc(sizeof(struct notes));\r\nwindow = gtk_window_new (GTK_WINDOW_TOPLEVEL);\r\ngtk_window_set_position (GTK_WINDOW(window), GTK_WIN_POS_CENTER);\r\ng_signal_connect(window, "destroy", G_CALLBACK(on_destroy), u_data);\r\nmain_vb = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 2, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(main_vb), 2);\r\ngtk_container_add(GTK_CONTAINER(window), main_vb);\r\ngtk_widget_show(main_vb);\r\nnotebook = gtk_notebook_new();\r\ngtk_box_pack_start(GTK_BOX(main_vb), notebook, TRUE, TRUE, 0);\r\ng_object_set_data(G_OBJECT(window), "notebook", notebook);\r\ng_signal_connect(notebook, "switch_page", G_CALLBACK(on_notebook_switch_page), NULL);\r\npage1 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 8, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(page1), 8);\r\nu_data->analyse_nb->checktype = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->checktype, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->checktype), 0, 0);\r\nu_data->analyse_nb->checksum = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->checksum, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->checksum), 0, 0);\r\nu_data->analyse_nb->bundling = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->bundling, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->bundling), 0, 0);\r\nu_data->analyse_nb->padding = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->padding, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->padding), 0, 0);\r\nu_data->analyse_nb->length = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->length, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->length), 0, 0);\r\nu_data->analyse_nb->value = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->value, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->value), 0, 0);\r\nu_data->analyse_nb->chunks_ep1 = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->chunks_ep1, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->chunks_ep1), 0, 0);\r\nu_data->analyse_nb->bytes_ep1 = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->bytes_ep1, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->bytes_ep1), 0, 0);\r\nu_data->analyse_nb->chunks_ep2 = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->chunks_ep2, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->chunks_ep2), 0, 0);\r\nu_data->analyse_nb->bytes_ep2 = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(page1), u_data->analyse_nb->bytes_ep2, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->bytes_ep2), 0, 0);\r\nhbox = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(page1), hbox, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(hbox), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX(hbox), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX(hbox), 0);\r\ngtk_widget_show(hbox);\r\nchunk_stat_bt = gtk_button_new_with_label ("Chunk Statistics");\r\ngtk_box_pack_start(GTK_BOX(hbox), chunk_stat_bt, FALSE, FALSE, 0);\r\ngtk_widget_show(chunk_stat_bt);\r\ng_signal_connect(chunk_stat_bt, "clicked", G_CALLBACK(on_chunk_stat_bt), u_data);\r\nbt_filter = gtk_button_new_with_label ("Set filter");\r\ngtk_box_pack_start(GTK_BOX(hbox), bt_filter, FALSE, FALSE, 0);\r\ngtk_widget_show (bt_filter);\r\ng_signal_connect(bt_filter, "clicked", G_CALLBACK(sctp_set_filter), u_data);\r\nclose_bt = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_box_pack_start(GTK_BOX(hbox), close_bt, FALSE, FALSE, 0);\r\ngtk_widget_show(close_bt);\r\ng_signal_connect(close_bt, "clicked", G_CALLBACK(on_close_dlg), u_data);\r\nlabel = gtk_label_new(" Statistics ");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page1, label);\r\npage2 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 8, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(page2), 8);\r\nu_data->analyse_nb->page2 = (struct page *)g_malloc(sizeof(struct page));\r\nu_data->analyse_nb->page2->addr_frame = gtk_frame_new(NULL);\r\ngtk_box_pack_start(GTK_BOX(page2), u_data->analyse_nb->page2->addr_frame, TRUE, TRUE, 0);\r\naddr_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(addr_hb), 5);\r\ngtk_container_add(GTK_CONTAINER(u_data->analyse_nb->page2->addr_frame), addr_hb);\r\nu_data->analyse_nb->page2->scrolled_window = scrolled_window_new(NULL, NULL);\r\ngtk_widget_set_size_request(u_data->analyse_nb->page2->scrolled_window, 560, 100);\r\nu_data->analyse_nb->page2->clist = create_list();\r\ngtk_widget_show(u_data->analyse_nb->page2->clist);\r\ngtk_container_add(GTK_CONTAINER(u_data->analyse_nb->page2->scrolled_window), u_data->analyse_nb->page2->clist);\r\ngtk_box_pack_start(GTK_BOX(addr_hb), u_data->analyse_nb->page2->scrolled_window, TRUE, TRUE, 0);\r\ngtk_widget_show(u_data->analyse_nb->page2->scrolled_window);\r\nstat_fr = gtk_frame_new(NULL);\r\ngtk_box_pack_start(GTK_BOX(page2), stat_fr, TRUE, TRUE, 0);\r\nhbox = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(hbox), 5);\r\ngtk_container_add(GTK_CONTAINER(stat_fr), hbox);\r\nvbox_l = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(hbox), vbox_l, TRUE, TRUE, 0);\r\nhbox_l1 = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(vbox_l), hbox_l1, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page2->port = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(hbox_l1), u_data->analyse_nb->page2->port, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->port), 0, 0);\r\nhbox_l2 = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(vbox_l), hbox_l2, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page2->veritag = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(hbox_l2), u_data->analyse_nb->page2->veritag, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->veritag), 0, 0);\r\ngtk_widget_show(vbox_l);\r\nvbox_r = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(hbox), vbox_r, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page2->max_in = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page2->max_in, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->max_in), 0, 0);\r\nu_data->analyse_nb->page2->min_in = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page2->min_in, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->min_in), 0, 0);\r\nu_data->analyse_nb->page2->max_out = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page2->max_out, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->max_out), 0, 0);\r\nu_data->analyse_nb->page2->min_out = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page2->min_out, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page2->min_out), 0, 0);\r\ngtk_widget_show(vbox_r);\r\nh_button_box = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(page2), h_button_box, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(h_button_box), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX(h_button_box), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX(h_button_box), 0);\r\ngtk_widget_show(h_button_box);\r\nchunk_bt1 = gtk_button_new_with_label("Chunk Statistics");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), chunk_bt1, FALSE, FALSE, 0);\r\ngtk_widget_show(chunk_bt1);\r\ng_signal_connect(chunk_bt1, "clicked", G_CALLBACK(on_chunk1_dlg), u_data);\r\ngraph_bt1 = gtk_button_new_with_label("Graph TSN");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), graph_bt1, FALSE, FALSE, 0);\r\ngtk_widget_show(graph_bt1);\r\ng_signal_connect(graph_bt1, "clicked", G_CALLBACK(on_graph1_dlg), u_data);\r\ngraph_bt2 = gtk_button_new_with_label("Graph Bytes");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), graph_bt2, FALSE, FALSE, 0);\r\ngtk_widget_show(graph_bt2);\r\ng_signal_connect(graph_bt2, "clicked", G_CALLBACK(on_graph_byte1_dlg), u_data);\r\nif (u_data->assoc->n_array_tsn1 == 0)\r\n{\r\ngtk_widget_set_sensitive(graph_bt1, FALSE);\r\ngtk_widget_set_sensitive(graph_bt2, FALSE);\r\n}\r\nclose_bt = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_box_pack_start(GTK_BOX(h_button_box), close_bt, FALSE, FALSE, 0);\r\ngtk_widget_show(close_bt);\r\ng_signal_connect(close_bt, "clicked", G_CALLBACK(on_close_dlg), u_data);\r\nlabel = gtk_label_new(" Endpoint 1 ");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page2, label);\r\npage3 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 8, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(page3), 8);\r\nu_data->analyse_nb->page3 = (struct page *)g_malloc(sizeof(struct page));\r\nu_data->analyse_nb->page3->addr_frame = gtk_frame_new(NULL);\r\ngtk_box_pack_start(GTK_BOX(page3), u_data->analyse_nb->page3->addr_frame, TRUE, TRUE, 0);\r\naddr_hb = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(addr_hb), 5);\r\ngtk_container_add(GTK_CONTAINER(u_data->analyse_nb->page3->addr_frame), addr_hb);\r\nu_data->analyse_nb->page3->scrolled_window = scrolled_window_new(NULL, NULL);\r\ngtk_widget_set_size_request(u_data->analyse_nb->page3->scrolled_window, 560, 100);\r\nu_data->analyse_nb->page3->clist = create_list();\r\ngtk_widget_show(u_data->analyse_nb->page3->clist);\r\ngtk_container_add(GTK_CONTAINER(u_data->analyse_nb->page3->scrolled_window),\r\nu_data->analyse_nb->page3->clist);\r\ngtk_box_pack_start(GTK_BOX(addr_hb), u_data->analyse_nb->page3->scrolled_window, TRUE, TRUE, 0);\r\ngtk_widget_show(u_data->analyse_nb->page3->scrolled_window);\r\nstat_fr = gtk_frame_new(NULL);\r\ngtk_box_pack_start(GTK_BOX(page3), stat_fr, TRUE, TRUE, 0);\r\nhbox = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(hbox), 5);\r\ngtk_container_add(GTK_CONTAINER(stat_fr), hbox);\r\nvbox_l = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(hbox), vbox_l, TRUE, TRUE, 0);\r\nhbox_l1 = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(vbox_l), hbox_l1, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page3->port = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(hbox_l1), u_data->analyse_nb->page3->port, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->port), 0, 0);\r\nhbox_l2 = ws_gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(vbox_l), hbox_l2, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page3->veritag = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(hbox_l2), u_data->analyse_nb->page3->veritag, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->veritag), 0, 0);\r\ngtk_widget_show(vbox_l);\r\nvbox_r = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 3, FALSE);\r\ngtk_box_pack_start(GTK_BOX(hbox), vbox_r, TRUE, TRUE, 0);\r\nu_data->analyse_nb->page3->max_in = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page3->max_in, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->max_in), 0, 0);\r\nu_data->analyse_nb->page3->min_in = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page3->min_in, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->min_in), 0, 0);\r\nu_data->analyse_nb->page3->max_out = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page3->max_out, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->max_out), 0, 0);\r\nu_data->analyse_nb->page3->min_out = gtk_label_new("");\r\ngtk_box_pack_start(GTK_BOX(vbox_r), u_data->analyse_nb->page3->min_out, TRUE, TRUE, 0);\r\ngtk_misc_set_alignment (GTK_MISC(u_data->analyse_nb->page3->min_out), 0, 0);\r\ngtk_widget_show(vbox_r);\r\nh_button_box = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_box_pack_start(GTK_BOX(page3), h_button_box, FALSE, FALSE, 0);\r\ngtk_container_set_border_width(GTK_CONTAINER(h_button_box), 10);\r\ngtk_button_box_set_layout(GTK_BUTTON_BOX(h_button_box), GTK_BUTTONBOX_SPREAD);\r\ngtk_box_set_spacing(GTK_BOX(h_button_box), 0);\r\ngtk_widget_show(h_button_box);\r\nchunk_bt1 = gtk_button_new_with_label("Chunk Statistics");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), chunk_bt1, FALSE, FALSE, 0);\r\ngtk_widget_show(chunk_bt1);\r\ng_signal_connect(chunk_bt1, "clicked", G_CALLBACK(on_chunk2_dlg), u_data);\r\ngraph_bt1 = gtk_button_new_with_label("Graph TSN");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), graph_bt1, FALSE, FALSE, 0);\r\ngtk_widget_show(graph_bt1);\r\ng_signal_connect(graph_bt1, "clicked", G_CALLBACK(on_graph2_dlg), u_data);\r\ngraph_bt2 = gtk_button_new_with_label("Graph Bytes");\r\ngtk_box_pack_start(GTK_BOX(h_button_box), graph_bt2, FALSE, FALSE, 0);\r\ngtk_widget_show(graph_bt2);\r\ng_signal_connect(graph_bt2, "clicked", G_CALLBACK(on_graph_byte2_dlg), u_data);\r\nif (u_data->assoc->n_array_tsn2 == 0)\r\n{\r\ngtk_widget_set_sensitive(graph_bt1, FALSE);\r\ngtk_widget_set_sensitive(graph_bt2, FALSE);\r\n}\r\nclose_bt = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_box_pack_start(GTK_BOX(h_button_box), close_bt, FALSE, FALSE, 0);\r\ngtk_widget_show(close_bt);\r\ng_signal_connect(close_bt, "clicked", G_CALLBACK(on_close_dlg), u_data);\r\nlabel = gtk_label_new(" Endpoint 2 ");\r\ngtk_notebook_append_page(GTK_NOTEBOOK(notebook), page3, label);\r\ngtk_widget_show_all(notebook);\r\ngtk_widget_show(window);\r\nu_data->window = window;\r\nanalyse_window_set_title(u_data);\r\nupdate_analyse_dlg(u_data);\r\n}\r\nvoid\r\nassoc_analyse(sctp_assoc_info_t* assoc)\r\n{\r\nstruct sctp_analyse *u_data;\r\nint i;\r\nu_data = (struct sctp_analyse *)g_malloc(sizeof(struct sctp_analyse));\r\nu_data->assoc = assoc;\r\nu_data->assoc->addr_chunk_count = assoc->addr_chunk_count;\r\nu_data->window = NULL;\r\nu_data->analyse_nb = NULL;\r\nu_data->children = NULL;\r\nu_data->num_children = 0;\r\nstatic_assoc.addr_chunk_count = assoc->addr_chunk_count;\r\nstatic_assoc.port1 = assoc->port1;\r\nstatic_assoc.port2 = assoc->port2;\r\nfor (i=0; i<NUM_CHUNKS; i++)\r\n{\r\nstatic_assoc.chunk_count[i] = assoc->chunk_count[i];\r\nstatic_assoc.ep1_chunk_count[i] = assoc->ep1_chunk_count[i];\r\nstatic_assoc.ep2_chunk_count[i] = assoc->ep2_chunk_count[i];\r\n}\r\nset_analyse_child(u_data);\r\nincrease_analyse_childcount();\r\nstatic_assoc.addr_chunk_count = assoc->addr_chunk_count;\r\ncreate_analyse_window(u_data);\r\n}\r\nstatic void\r\nsctp_analyse_cb(struct sctp_analyse *u_data, gboolean ext)\r\n{\r\nGList *list;\r\ndfilter_t *sfcode;\r\ngchar *err_msg;\r\ncapture_file *cf;\r\nepan_dissect_t edt;\r\ngboolean frame_found = FALSE;\r\nframe_data *fdata;\r\ngchar filter_text[256];\r\ng_strlcpy(filter_text, "sctp", 250);\r\nif (!dfilter_compile(filter_text, &sfcode, &err_msg)) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "%s", err_msg);\r\ng_free(err_msg);\r\nreturn;\r\n}\r\ncf = &cfile;\r\nfdata = cf->current_frame;\r\nif (fdata == NULL)\r\nreturn;\r\nif (!cf_read_record(cf, fdata))\r\nreturn;\r\nepan_dissect_init(&edt, cf->epan, TRUE, FALSE);\r\nepan_dissect_prime_dfilter(&edt, sfcode);\r\nepan_dissect_run(&edt, cf->cd_t, &cf->phdr, frame_tvbuff_new_buffer(fdata, &cf->buf), fdata, NULL);\r\nif (!dfilter_apply_edt(sfcode, &edt)) {\r\nepan_dissect_cleanup(&edt);\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"Please choose an SCTP packet.");\r\nreturn;\r\n}\r\nlist = g_list_first(sctp_stat_get_info()->assoc_info_list);\r\nwhile (list)\r\n{\r\nsctp_assoc_info_t *assoc;\r\nGList *framelist;\r\nassoc = (sctp_assoc_info_t*)(list->data);\r\nframelist = g_list_first(assoc->frame_numbers);\r\nwhile (framelist)\r\n{\r\nguint32 *fn;\r\nfn = (guint32 *)framelist->data;\r\nif (*fn == fdata->num)\r\n{\r\nframe_found = TRUE;\r\nbreak;\r\n}\r\nframelist = g_list_next(framelist);\r\n}\r\nif (frame_found)\r\n{\r\nint i;\r\nu_data->assoc = assoc;\r\nu_data->assoc->addr_chunk_count = assoc->addr_chunk_count;\r\nstatic_assoc.addr_chunk_count = assoc->addr_chunk_count;\r\nstatic_assoc.port1 = assoc->port1;\r\nstatic_assoc.port2 = assoc->port2;\r\nfor (i=0; i<NUM_CHUNKS; i++)\r\n{\r\nstatic_assoc.chunk_count[i] = assoc->chunk_count[i];\r\nstatic_assoc.ep1_chunk_count[i] = assoc->ep1_chunk_count[i];\r\nstatic_assoc.ep2_chunk_count[i] = assoc->ep2_chunk_count[i];\r\n}\r\nif (ext == FALSE)\r\ncreate_analyse_window(u_data);\r\nreturn;\r\n}\r\nelse\r\nlist = g_list_next(list);\r\n}\r\nif (!frame_found)\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "Assoc not found.");\r\n}\r\nvoid\r\nsctp_set_assoc_filter(void)\r\n{\r\nstruct sctp_analyse *u_data;\r\nif (sctp_stat_get_info()->is_registered == FALSE)\r\nregister_tap_listener_sctp_stat();\r\nu_data = (struct sctp_analyse *)g_malloc(sizeof(struct sctp_analyse));\r\nu_data->assoc = NULL;\r\nu_data->children = NULL;\r\nu_data->analyse_nb = NULL;\r\nu_data->window = NULL;\r\nu_data->num_children = 0;\r\ncf_retap_packets(&cfile);\r\nsctp_analyse_cb(u_data, TRUE);\r\nsctp_set_filter(NULL, u_data);\r\n}\r\nvoid\r\nsctp_analyse_start(GtkAction *action _U_, gpointer user_data _U_)\r\n{\r\nstruct sctp_analyse *u_data;\r\nif (sctp_stat_get_info()->is_registered == FALSE)\r\nregister_tap_listener_sctp_stat();\r\nu_data = (struct sctp_analyse *)g_malloc(sizeof(struct sctp_analyse));\r\nu_data->assoc = NULL;\r\nu_data->children = NULL;\r\nu_data->analyse_nb = NULL;\r\nu_data->window = NULL;\r\nu_data->num_children = 0;\r\ncf_retap_packets(&cfile);\r\nsctp_analyse_cb(u_data, FALSE);\r\n}
