static void\r\ndissect_sccpmg_affected_ssn(tvbuff_t *tvb, proto_tree *sccpmg_tree)\r\n{\r\nproto_tree_add_item(sccpmg_tree, hf_sccpmg_affected_ssn, tvb,\r\nSCCPMG_AFFECTED_SSN_OFFSET, SCCPMG_SSN_LENGTH,\r\nENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_sccpmg_affected_pc(tvbuff_t *tvb, proto_tree *sccpmg_tree)\r\n{\r\nguint8 offset = SCCPMG_AFFECTED_PC_OFFSET;\r\nif (mtp3_standard == ITU_STANDARD) {\r\nproto_tree_add_item(sccpmg_tree, hf_sccpmg_affected_itu_pc, tvb,\r\noffset, ITU_PC_LENGTH, ENC_LITTLE_ENDIAN);\r\n} else if (mtp3_standard == JAPAN_STANDARD) {\r\nproto_tree_add_item(sccpmg_tree, hf_sccpmg_affected_japan_pc,\r\ntvb, offset, JAPAN_PC_LENGTH, ENC_LITTLE_ENDIAN);\r\n} else {\r\nint *hf_affected_pc;\r\nif (mtp3_standard == ANSI_STANDARD)\r\n{\r\nhf_affected_pc = &hf_sccpmg_affected_ansi_pc;\r\n} else {\r\nhf_affected_pc = &hf_sccpmg_affected_chinese_pc;\r\n}\r\ndissect_mtp3_3byte_pc(tvb, offset, sccpmg_tree,\r\nett_sccpmg_affected_pc, *hf_affected_pc,\r\nhf_sccpmg_affected_pc_network,\r\nhf_sccpmg_affected_pc_cluster,\r\nhf_sccpmg_affected_pc_member, 0, 0);\r\n}\r\n}\r\nstatic void\r\ndissect_sccpmg_smi(tvbuff_t *tvb, proto_tree *sccpmg_tree)\r\n{\r\nguint8 offset = 0;\r\nif (mtp3_standard == ITU_STANDARD || mtp3_standard == JAPAN_STANDARD)\r\noffset = ITU_SCCPMG_SMI_OFFSET;\r\nelse\r\noffset = ANSI_SCCPMG_SMI_OFFSET;\r\nproto_tree_add_item(sccpmg_tree, hf_sccpmg_smi, tvb, offset,\r\nSCCPMG_SMI_LENGTH, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_sccpmg_congestion_level(tvbuff_t *tvb, proto_tree *sccpmg_tree)\r\n{\r\nguint8 offset = 0;\r\nif (mtp3_standard == CHINESE_ITU_STANDARD)\r\noffset = CHINESE_ITU_SCCPMG_CONGESTION_OFFSET;\r\nelse\r\noffset = ITU_SCCPMG_CONGESTION_OFFSET;\r\nproto_tree_add_item(sccpmg_tree, hf_sccpmg_congestion_level, tvb,\r\noffset, ITU_SCCPMG_CONGESTION_LENGTH, ENC_BIG_ENDIAN);\r\n}\r\nstatic void\r\ndissect_sccpmg_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *sccpmg_tree)\r\n{\r\nguint8 message_type;\r\nmessage_type = tvb_get_guint8(tvb, SCCPMG_MESSAGE_TYPE_OFFSET);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s ", val_to_str_const(message_type, sccpmg_message_type_acro_values, "Unknown"));\r\nif (sccpmg_tree) {\r\nproto_tree_add_uint(sccpmg_tree, hf_sccpmg_message_type, tvb,\r\nSCCPMG_MESSAGE_TYPE_OFFSET,\r\nSCCPMG_MESSAGE_TYPE_LENGTH, message_type);\r\n}\r\nswitch(message_type) {\r\ncase SCCPMG_MESSAGE_TYPE_SBR:\r\ncase SCCPMG_MESSAGE_TYPE_SNR:\r\ncase SCCPMG_MESSAGE_TYPE_SRT:\r\nif (mtp3_standard != ANSI_STANDARD)\r\n{\r\nproto_tree_add_expert(sccpmg_tree, pinfo, &ei_sccpmg_unknown_msg, tvb, 0, -1);\r\nbreak;\r\n}\r\ncase SCCPMG_MESSAGE_TYPE_SSA:\r\ncase SCCPMG_MESSAGE_TYPE_SSP:\r\ncase SCCPMG_MESSAGE_TYPE_SST:\r\ncase SCCPMG_MESSAGE_TYPE_SOR:\r\ncase SCCPMG_MESSAGE_TYPE_SOG:\r\ndissect_sccpmg_affected_ssn(tvb, sccpmg_tree);\r\ndissect_sccpmg_affected_pc(tvb, sccpmg_tree);\r\ndissect_sccpmg_smi(tvb, sccpmg_tree);\r\nbreak;\r\ncase SCCPMG_MESSAGE_TYPE_SSC:\r\nif (mtp3_standard != ANSI_STANDARD)\r\n{\r\ndissect_sccpmg_affected_ssn(tvb, sccpmg_tree);\r\ndissect_sccpmg_affected_pc(tvb, sccpmg_tree);\r\ndissect_sccpmg_smi(tvb, sccpmg_tree);\r\ndissect_sccpmg_congestion_level(tvb, sccpmg_tree);\r\n}\r\ndefault:\r\nproto_tree_add_expert(sccpmg_tree, pinfo, &ei_sccpmg_unknown_msg, tvb, 0, -1);\r\n}\r\n}\r\nstatic int\r\ndissect_sccpmg(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *sccpmg_item;\r\nproto_tree *sccpmg_tree = NULL;\r\nswitch(mtp3_standard) {\r\ncase ITU_STANDARD:\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SCCPMG (Int. ITU)");\r\nbreak;\r\ncase ANSI_STANDARD:\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SCCPMG (ANSI)");\r\nbreak;\r\ncase CHINESE_ITU_STANDARD:\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SCCPMG (Chin. ITU)");\r\nbreak;\r\n};\r\nif (tree) {\r\nsccpmg_item = proto_tree_add_item(tree, proto_sccpmg, tvb, 0,\r\n-1, ENC_NA);\r\nsccpmg_tree = proto_item_add_subtree(sccpmg_item, ett_sccpmg);\r\n}\r\ndissect_sccpmg_message(tvb, pinfo, sccpmg_tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_sccpmg(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_sccpmg_message_type,\r\n{ "Message Type", "sccpmg.message_type",\r\nFT_UINT8, BASE_HEX, VALS(sccpmg_message_type_values), 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_ssn,\r\n{ "Affected SubSystem Number", "sccpmg.ssn",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_itu_pc,\r\n{ "Affected Point Code", "sccpmg.pc",\r\nFT_UINT16, BASE_DEC, NULL, ITU_PC_MASK,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_japan_pc,\r\n{ "Affected Point Code", "sccpmg.pc",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_ansi_pc,\r\n{ "Affected Point Code", "sccpmg.ansi_pc",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_chinese_pc,\r\n{ "Affected Point Code", "sccpmg.chinese_pc",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_pc_network,\r\n{ "Affected PC Network", "sccpmg.network",\r\nFT_UINT24, BASE_DEC, NULL, ANSI_NETWORK_MASK,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_pc_cluster,\r\n{ "Affected PC Cluster", "sccpmg.cluster",\r\nFT_UINT24, BASE_DEC, NULL, ANSI_CLUSTER_MASK,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_affected_pc_member,\r\n{ "Affected PC Member", "sccpmg.member",\r\nFT_UINT24, BASE_DEC, NULL, ANSI_MEMBER_MASK,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_smi,\r\n{ "Subsystem Multiplicity Indicator", "sccpmg.smi",\r\nFT_UINT8, BASE_DEC, NULL, SCCPMG_SMI_MASK,\r\nNULL, HFILL}},\r\n{ &hf_sccpmg_congestion_level,\r\n{ "SCCP Congestion Level (ITU)", "sccpmg.congestion",\r\nFT_UINT8, BASE_DEC, NULL, ITU_SCCPMG_CONGESTION_MASK,\r\nNULL, HFILL}}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_sccpmg,\r\n&ett_sccpmg_affected_pc\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_sccpmg_unknown_msg, { "sccpmg.unknown_msg", PI_UNDECODED, PI_WARN, "Unknown message", EXPFILL }},\r\n};\r\nexpert_module_t* expert_sccpmg;\r\nproto_sccpmg = proto_register_protocol("Signalling Connection Control Part Management",\r\n"SCCPMG", "sccpmg");\r\nproto_register_field_array(proto_sccpmg, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_sccpmg = expert_register_protocol(proto_sccpmg);\r\nexpert_register_field_array(expert_sccpmg, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_sccpmg(void)\r\n{\r\ndissector_handle_t sccpmg_handle;\r\nsccpmg_handle = create_dissector_handle(dissect_sccpmg, proto_sccpmg);\r\ndissector_add_uint("sccp.ssn", SCCPMG_SSN, sccpmg_handle);\r\n}
