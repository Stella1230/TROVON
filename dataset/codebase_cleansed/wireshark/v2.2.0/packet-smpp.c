static void\r\nsmpp_stats_tree_init(stats_tree* st)\r\n{\r\nst_smpp_ops = stats_tree_create_node(st, "SMPP Operations", 0, TRUE);\r\nst_smpp_req = stats_tree_create_node(st, "SMPP Requests", st_smpp_ops, TRUE);\r\nst_smpp_res = stats_tree_create_node(st, "SMPP Responses", st_smpp_ops, TRUE);\r\nst_smpp_res_status = stats_tree_create_node(st, "SMPP Response Status", 0, TRUE);\r\n}\r\nstatic int\r\nsmpp_stats_tree_per_packet(stats_tree *st,\r\npacket_info *pinfo _U_,\r\nepan_dissect_t *edt _U_,\r\nconst void *p)\r\n{\r\nconst smpp_tap_rec_t* tap_rec = (const smpp_tap_rec_t*)p;\r\ntick_stat_node(st, "SMPP Operations", 0, TRUE);\r\nif ((tap_rec->command_id & 0x80000000) == 0x80000000)\r\n{\r\ntick_stat_node(st, "SMPP Responses", st_smpp_ops, TRUE);\r\ntick_stat_node(st, val_to_str(tap_rec->command_id, vals_command_id, "Unknown 0x%08x"), st_smpp_res, FALSE);\r\ntick_stat_node(st, "SMPP Response Status", 0, TRUE);\r\ntick_stat_node(st, val_to_str(tap_rec->command_status, vals_command_status, "Unknown 0x%08x"), st_smpp_res_status, FALSE);\r\n}\r\nelse\r\n{\r\ntick_stat_node(st, "SMPP Requests", st_smpp_ops, TRUE);\r\ntick_stat_node(st, val_to_str(tap_rec->command_id, vals_command_id, "Unknown 0x%08x"), st_smpp_req, FALSE);\r\n}\r\nreturn 1;\r\n}\r\nstatic gboolean\r\nsmpp_mktime(const char *datestr, time_t *secs, int *nsecs)\r\n{\r\nstruct tm r_time;\r\ntime_t t_diff;\r\ngboolean relative = (datestr[15] == 'R') ? TRUE : FALSE;\r\nr_time.tm_year = 10 * (datestr[0] - '0') + (datestr[1] - '0');\r\nif (r_time.tm_year < 38)\r\nr_time.tm_year += 100;\r\nr_time.tm_mon = 10 * (datestr[2] - '0') + (datestr[3] - '0');\r\nr_time.tm_mon--;\r\nr_time.tm_mday = 10 * (datestr[4] - '0') + (datestr[5] - '0');\r\nr_time.tm_hour = 10 * (datestr[6] - '0') + (datestr[7] - '0');\r\nr_time.tm_min = 10 * (datestr[8] - '0') + (datestr[9] - '0');\r\nr_time.tm_sec = 10 * (datestr[10] - '0') + (datestr[11] - '0');\r\nr_time.tm_isdst = -1;\r\nif (relative == FALSE) {\r\nstruct tm *gm, *local_time;\r\nint gm_hour, gm_min;\r\n*secs = mktime(&r_time);\r\n*nsecs = 0;\r\nif (*secs == (time_t)(-1)) {\r\nreturn relative;\r\n}\r\n*nsecs = (datestr[12] - '0') * 100000000;\r\nt_diff = (10 * (datestr[13] - '0') + (datestr[14] - '0')) * 900;\r\nif (datestr[15] == '-')\r\n*secs += t_diff;\r\nelse if (datestr[15] == '+')\r\n*secs -= t_diff;\r\nif (((gm = gmtime(secs)) == NULL) || ((local_time = localtime(secs)) == NULL)) {\r\n*secs = (time_t)(-1);\r\n*nsecs = 0;\r\nreturn relative;\r\n}\r\ngm_hour = gm->tm_hour;\r\ngm_min = gm->tm_min;\r\n*secs -= 3600*(gm_hour - local_time->tm_hour);\r\n*secs -= 60*(gm_min - local_time->tm_min);\r\n} else {\r\n*secs = r_time.tm_sec + 60 *\r\n(r_time.tm_min + 60 *\r\n(r_time.tm_hour + 24 *\r\nr_time.tm_mday));\r\n*nsecs = 0;\r\n}\r\nreturn relative;\r\n}\r\nstatic void\r\nsmpp_handle_string(proto_tree *tree, tvbuff_t *tvb, int field, int *offset)\r\n{\r\nguint len;\r\nlen = tvb_strsize(tvb, *offset);\r\nif (len > 1) {\r\nproto_tree_add_item(tree, field, tvb, *offset, len, ENC_NA);\r\n}\r\n(*offset) += len;\r\n}\r\nstatic const char *\r\nsmpp_handle_string_return(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo, int field, int *offset)\r\n{\r\ngint len;\r\nconst char *str;\r\nlen = tvb_strsize(tvb, *offset);\r\nif (len > 1) {\r\nstr = (char *)tvb_get_stringz_enc(pinfo->pool, tvb, *offset, &len, ENC_ASCII);\r\nproto_tree_add_string(tree, field, tvb, *offset, len, str);\r\n} else {\r\nstr = "";\r\n}\r\n(*offset) += len;\r\nreturn str;\r\n}\r\nstatic void\r\nsmpp_handle_string_z(proto_tree *tree, tvbuff_t *tvb, int field, int *offset,\r\nconst char *null_string)\r\n{\r\ngint len;\r\nlen = tvb_strsize(tvb, *offset);\r\nif (len > 1) {\r\nproto_tree_add_item(tree, field, tvb, *offset, len, ENC_NA);\r\n} else {\r\nproto_tree_add_string(tree, field, tvb, *offset, len, null_string);\r\n}\r\n(*offset) += len;\r\n}\r\nstatic void\r\nsmpp_handle_int1(proto_tree *tree, tvbuff_t *tvb, int field, int *offset)\r\n{\r\nguint8 val;\r\nval = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(tree, field, tvb, *offset, 1, val);\r\n(*offset)++;\r\n}\r\nstatic void\r\nsmpp_handle_int2(proto_tree *tree, tvbuff_t *tvb, int field, int *offset)\r\n{\r\nguint val;\r\nval = tvb_get_ntohs(tvb, *offset);\r\nproto_tree_add_uint(tree, field, tvb, *offset, 2, val);\r\n(*offset) += 2;\r\n}\r\nstatic void\r\nsmpp_handle_int4(proto_tree *tree, tvbuff_t *tvb, int field, int *offset)\r\n{\r\nguint val;\r\nval = tvb_get_ntohl(tvb, *offset);\r\nproto_tree_add_uint(tree, field, tvb, *offset, 4, val);\r\n(*offset) += 4;\r\n}\r\nstatic void\r\nsmpp_handle_time(proto_tree *tree, tvbuff_t *tvb,\r\nint field, int field_R, int *offset)\r\n{\r\nchar *strval;\r\ngint len;\r\nnstime_t tmptime;\r\nstrval = (char *) tvb_get_stringz_enc(wmem_packet_scope(), tvb, *offset, &len, ENC_ASCII);\r\nif (*strval)\r\n{\r\nif (len >= 16)\r\n{\r\nif (smpp_mktime(strval, &tmptime.secs, &tmptime.nsecs))\r\nproto_tree_add_time(tree, field_R, tvb, *offset, len, &tmptime);\r\nelse\r\nproto_tree_add_time(tree, field, tvb, *offset, len, &tmptime);\r\n}\r\nelse\r\n{\r\ntmptime.secs = 0;\r\ntmptime.nsecs = 0;\r\nproto_tree_add_time_format_value(tree, field_R, tvb, *offset, len, &tmptime, "%s", strval);\r\n}\r\n}\r\n*offset += len;\r\n}\r\nstatic void\r\nsmpp_handle_dlist(proto_tree *tree, tvbuff_t *tvb, int *offset)\r\n{\r\nguint8 entries;\r\nint tmpoff = *offset;\r\nproto_tree *sub_tree = NULL;\r\nguint8 dest_flag;\r\nif ((entries = tvb_get_guint8(tvb, tmpoff++))) {\r\nproto_item *pi;\r\npi = proto_tree_add_item(tree, hf_smpp_dlist, tvb, *offset, 1, ENC_NA);\r\nsub_tree = proto_item_add_subtree(pi, ett_dlist);\r\n}\r\nwhile (entries--)\r\n{\r\ndest_flag = tvb_get_guint8(tvb, tmpoff++);\r\nif (dest_flag == 1)\r\n{\r\nsmpp_handle_int1(sub_tree, tvb, hf_smpp_dest_addr_ton, &tmpoff);\r\nsmpp_handle_int1(sub_tree, tvb, hf_smpp_dest_addr_npi, &tmpoff);\r\nsmpp_handle_string(sub_tree,tvb,hf_smpp_destination_addr,&tmpoff);\r\n}\r\nelse\r\n{\r\nsmpp_handle_string(sub_tree, tvb, hf_smpp_dl_name, &tmpoff);\r\n}\r\n}\r\n*offset = tmpoff;\r\n}\r\nstatic void\r\nsmpp_handle_dlist_resp(proto_tree *tree, tvbuff_t *tvb, int *offset)\r\n{\r\nguint8 entries;\r\nint tmpoff = *offset;\r\nproto_tree *sub_tree = NULL;\r\nif ((entries = tvb_get_guint8(tvb, tmpoff++))) {\r\nproto_item *pi;\r\npi = proto_tree_add_item(tree, hf_smpp_dlist_resp,\r\ntvb, *offset, 1, ENC_NA);\r\nsub_tree = proto_item_add_subtree(pi, ett_dlist_resp);\r\n}\r\nwhile (entries--)\r\n{\r\nsmpp_handle_int1(sub_tree, tvb, hf_smpp_dest_addr_ton, &tmpoff);\r\nsmpp_handle_int1(sub_tree, tvb, hf_smpp_dest_addr_npi, &tmpoff);\r\nsmpp_handle_string(sub_tree,tvb,hf_smpp_destination_addr,&tmpoff);\r\nsmpp_handle_int4(sub_tree, tvb, hf_smpp_error_status_code, &tmpoff);\r\n}\r\n*offset = tmpoff;\r\n}\r\nstatic void\r\nsmpp_handle_tlv(proto_tree *tree, tvbuff_t *tvb, int *offset)\r\n{\r\nproto_tree *tlvs_tree = NULL;\r\nproto_item *pi;\r\nif (tvb_reported_length_remaining(tvb, *offset) >= 1) {\r\npi = proto_tree_add_item(tree, hf_smpp_opt_params,\r\ntvb, *offset, -1, ENC_NA);\r\ntlvs_tree = proto_item_add_subtree(pi, ett_opt_params);\r\n}\r\nwhile (tvb_reported_length_remaining(tvb, *offset) >= 1)\r\n{\r\nproto_item *sub_tree;\r\nguint16 tag;\r\nguint16 length;\r\nguint8 field;\r\nguint16 field16;\r\nguint8 major, minor;\r\nchar *strval=NULL;\r\ntag = tvb_get_ntohs(tvb, *offset);\r\nlength = tvb_get_ntohs(tvb, (*offset+2));\r\npi = proto_tree_add_none_format(tlvs_tree, hf_smpp_opt_param, tvb,\r\n*offset, length+4,\r\n"Optional parameter: %s (0x%04x)",\r\nval_to_str(tag, vals_tlv_tags, "0x%04x"), tag);\r\nsub_tree = proto_item_add_subtree(pi, ett_opt_param);\r\nproto_tree_add_uint(sub_tree,hf_smpp_opt_param_tag,tvb,*offset,2,tag);\r\nproto_tree_add_uint(sub_tree,hf_smpp_opt_param_len,tvb,*offset+2,2,length);\r\n*offset += 4;\r\nswitch (tag) {\r\ncase 0x0005:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_dest_addr_subunit, offset);\r\nbreak;\r\ncase 0x0006:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_dest_network_type, offset);\r\nbreak;\r\ncase 0x0007:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_dest_bearer_type, offset);\r\nbreak;\r\ncase 0x0008:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_dest_telematics_id, offset);\r\nbreak;\r\ncase 0x000D:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_source_addr_subunit, offset);\r\nbreak;\r\ncase 0x000E:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_source_network_type, offset);\r\nbreak;\r\ncase 0x000F:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_source_bearer_type, offset);\r\nbreak;\r\ncase 0x0010:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_source_telematics_id, offset);\r\nbreak;\r\ncase 0x0017:\r\nsmpp_handle_int4(sub_tree, tvb,\r\nhf_smpp_qos_time_to_live, offset);\r\nbreak;\r\ncase 0x0019:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_payload_type, offset);\r\nbreak;\r\ncase 0x001D:\r\nsmpp_handle_string(sub_tree, tvb,\r\nhf_smpp_additional_status_info_text, offset);\r\nbreak;\r\ncase 0x001E:\r\nsmpp_handle_string(sub_tree, tvb,\r\nhf_smpp_receipted_message_id, offset);\r\nbreak;\r\ncase 0x0030:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_msg_wait_ind,\r\ntvb, *offset, 1, field);\r\nproto_tree_add_uint(sub_tree, hf_smpp_msg_wait_type,\r\ntvb, *offset, 1, field);\r\n(*offset)++;\r\nbreak;\r\ncase 0x0201:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_privacy_indicator, offset);\r\nbreak;\r\ncase 0x0202:\r\nif (length) {\r\nproto_tree_add_item(sub_tree, hf_smpp_source_subaddress,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\n}\r\nbreak;\r\ncase 0x0203:\r\nif (length) {\r\nproto_tree_add_item(sub_tree, hf_smpp_dest_subaddress,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\n}\r\nbreak;\r\ncase 0x0204:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_user_message_reference, offset);\r\nbreak;\r\ncase 0x0205:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_user_response_code, offset);\r\nbreak;\r\ncase 0x020A:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_source_port, offset);\r\nbreak;\r\ncase 0x020B:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_destination_port, offset);\r\nbreak;\r\ncase 0x020C:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_sar_msg_ref_num, offset);\r\nbreak;\r\ncase 0x020D:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_language_indicator, offset);\r\nbreak;\r\ncase 0x020E:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_sar_total_segments, offset);\r\nbreak;\r\ncase 0x020F:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_sar_segment_seqnum, offset);\r\nbreak;\r\ncase 0x0210:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nminor = field & 0x0F;\r\nmajor = (field & 0xF0) >> 4;\r\nstrval=wmem_strdup_printf(wmem_packet_scope(), "%u.%u", major, minor);\r\nproto_tree_add_string(sub_tree, hf_smpp_SC_interface_version,\r\ntvb, *offset, 1, strval);\r\n(*offset)++;\r\nbreak;\r\ncase 0x0302:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_callback_num_pres,\r\ntvb, *offset, 1, field);\r\nproto_tree_add_uint(sub_tree, hf_smpp_callback_num_scrn,\r\ntvb, *offset, 1, field);\r\n(*offset)++;\r\nbreak;\r\ncase 0x0303:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_callback_num_atag,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0304:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_number_of_messages, offset);\r\nbreak;\r\ncase 0x0381:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_callback_num,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0420:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_dpf_result, offset);\r\nbreak;\r\ncase 0x0421:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_set_dpf, offset);\r\nbreak;\r\ncase 0x0422:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_ms_availability_status, offset);\r\nbreak;\r\ncase 0x0423:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_network_error_type, offset);\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_network_error_code, offset);\r\nbreak;\r\ncase 0x0424:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_message_payload,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0425:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_delivery_failure_reason, offset);\r\nbreak;\r\ncase 0x0426:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_more_messages_to_send, offset);\r\nbreak;\r\ncase 0x0427:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_message_state, offset);\r\nbreak;\r\ncase 0x0428:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_congestion_state, offset);\r\nbreak;\r\ncase 0x0501:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_ussd_service_op, offset);\r\nbreak;\r\ncase 0x0600:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_broadcast_channel_indicator, offset);\r\nbreak;\r\ncase 0x0601:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_broadcast_content_type_nw, tvb, *offset, 1, field);\r\n(*offset)++;\r\nfield16 = tvb_get_ntohs(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_broadcast_content_type_type, tvb, *offset, 2, field16);\r\n(*offset) += 2;\r\nbreak;\r\ncase 0x0602:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_broadcast_content_type_info,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0603:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_broadcast_message_class, offset);\r\nbreak;\r\ncase 0x0604:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_broadcast_rep_num, offset);\r\nbreak;\r\ncase 0x0605:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_broadcast_frequency_interval_unit, tvb, *offset, 1, field);\r\n(*offset)++;\r\nfield16 = tvb_get_ntohs(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_broadcast_frequency_interval_value, tvb, *offset, 2, field16);\r\n(*offset) += 2;\r\nbreak;\r\ncase 0x0606:\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_broadcast_area_identifier_format, tvb, *offset, 1, field);\r\nproto_tree_add_item(sub_tree, hf_smpp_broadcast_area_identifier,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0607:\r\nsmpp_handle_int4(sub_tree, tvb,\r\nhf_smpp_broadcast_error_status, offset);\r\nbreak;\r\ncase 0x0608:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_broadcast_area_success, offset);\r\nbreak;\r\ncase 0x0609:\r\nsmpp_handle_time(sub_tree, tvb, hf_smpp_broadcast_end_time,\r\nhf_smpp_broadcast_end_time_r, offset);\r\nbreak;\r\ncase 0x060A:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_broadcast_service_group,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x060B:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_billing_identification,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x060D:\r\nsmpp_handle_string_z(sub_tree, tvb, hf_smpp_source_network_id,\r\noffset, "Empty!");\r\nbreak;\r\ncase 0x060E:\r\nsmpp_handle_string_z(sub_tree, tvb, hf_smpp_dest_network_id,\r\noffset, "Empty!");\r\nbreak;\r\ncase 0x060F:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_source_node_id,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0610:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_dest_node_id,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0611:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_dest_addr_np_resolution, offset);\r\nbreak;\r\ncase 0x0612:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_dest_addr_np_information,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x0613:\r\nif (length)\r\nproto_tree_add_item(sub_tree, hf_smpp_dest_addr_np_country,\r\ntvb, *offset, length, ENC_NA);\r\n(*offset) += length;\r\nbreak;\r\ncase 0x1201:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_display_time, offset);\r\nbreak;\r\ncase 0x1203:\r\nsmpp_handle_int2(sub_tree, tvb,\r\nhf_smpp_sms_signal, offset);\r\nbreak;\r\ncase 0x1204:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_ms_validity, offset);\r\nbreak;\r\ncase 0x130C:\r\nif (length == 0) {\r\nproto_tree_add_item(sub_tree,\r\nhf_smpp_alert_on_message_delivery_null,\r\ntvb, *offset, length, ENC_NA);\r\n} else {\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_alert_on_message_delivery_type, offset);\r\n}\r\nbreak;\r\ncase 0x1380:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_its_reply_type, offset);\r\nbreak;\r\ncase 0x1383:\r\nsmpp_handle_int1(sub_tree, tvb,\r\nhf_smpp_its_session_number, offset);\r\nfield = tvb_get_guint8(tvb, *offset);\r\nproto_tree_add_uint(sub_tree, hf_smpp_its_session_sequence,\r\ntvb, *offset, 1, field);\r\nproto_tree_add_uint(sub_tree, hf_smpp_its_session_ind,\r\ntvb, *offset, 1, field);\r\n(*offset)++;\r\nbreak;\r\ndefault:\r\nif ((tag >= 0x1400) && (tag <= 0x3FFF)) {\r\nproto_tree_add_item(sub_tree, hf_smpp_vendor_op, tvb,\r\n*offset, length, ENC_NA);\r\n} else {\r\nproto_tree_add_item(sub_tree, hf_smpp_reserved_op, tvb,\r\n*offset, length, ENC_NA);\r\n}\r\nproto_item_append_text(sub_tree,": %s", tvb_bytes_to_str(wmem_packet_scope(), tvb,*offset,length));\r\n(*offset) += length;\r\nbreak;\r\n}\r\n}\r\n}\r\nvoid\r\nsmpp_handle_dcs(proto_tree *tree, tvbuff_t *tvb, int *offset)\r\n{\r\nguint8 val;\r\nint off = *offset;\r\nproto_tree *subtree, *code_tree;\r\nproto_item *pi;\r\nval = tvb_get_guint8(tvb, off);\r\npi = proto_tree_add_uint(tree, hf_smpp_data_coding, tvb, off, 1, val);\r\nsubtree = proto_item_add_subtree(pi, ett_dcs);\r\nproto_tree_add_uint(subtree, hf_smpp_dcs, tvb, off, 1, val);\r\ncode_tree = proto_tree_add_subtree(subtree, tvb, off, 1, ett_dcs, NULL, "GSM SMS Data Coding");\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_sms_coding_group, tvb, off, 1, val);\r\nif (val>>6 == 2) {\r\n;\r\n} else if (val < 0xF0) {\r\nproto_tree_add_boolean(code_tree,\r\nhf_smpp_dcs_text_compression, tvb, off, 1, val);\r\nproto_tree_add_boolean(code_tree,\r\nhf_smpp_dcs_class_present, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_charset, tvb, off, 1, val);\r\nif (val & 0x10)\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_class, tvb, off, 1, val);\r\n} else {\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_reserved, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_charset, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_class, tvb, off, 1, val);\r\n}\r\ncode_tree = proto_tree_add_subtree(subtree, tvb, off, 1, ett_dcs, NULL,\r\n"GSM CBS Data Coding");\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_cbs_coding_group, tvb, off, 1, val);\r\nif (val < 0x40) {\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_cbs_language, tvb, off, 1, val);\r\n} else if (val>>6 == 1) {\r\nproto_tree_add_boolean(code_tree,\r\nhf_smpp_dcs_text_compression, tvb, off, 1, val);\r\nproto_tree_add_boolean(code_tree,\r\nhf_smpp_dcs_class_present, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_charset, tvb, off, 1, val);\r\nif (val & 0x10)\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_class, tvb, off, 1, val);\r\n} else if (val>>6 == 2) {\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_charset, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_class, tvb, off, 1, val);\r\n} else if (val>>4 == 14) {\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_wap_charset, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree,\r\nhf_smpp_dcs_wap_class, tvb, off, 1, val);\r\n} else if (val>>4 == 15) {\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_reserved, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_charset, tvb, off, 1, val);\r\nproto_tree_add_uint(code_tree, hf_smpp_dcs_cbs_class, tvb, off, 1, val);\r\n}\r\n(*offset)++;\r\n}\r\nstatic void\r\nbind_receiver(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 field;\r\nguint8 major, minor;\r\nchar *strval;\r\nsmpp_handle_string(tree, tvb, hf_smpp_system_id, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_password, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_system_type, &offset);\r\nfield = tvb_get_guint8(tvb, offset++);\r\nminor = field & 0x0F;\r\nmajor = (field & 0xF0) >> 4;\r\nstrval=wmem_strdup_printf(wmem_packet_scope(), "%u.%u", major, minor);\r\nproto_tree_add_string(tree, hf_smpp_interface_version, tvb,\r\noffset - 1, 1, strval);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_address_range, &offset);\r\n}\r\nstatic void\r\nquery_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\n}\r\nstatic void\r\noutbind(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_system_id, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_password, &offset);\r\n}\r\nstatic void\r\nsubmit_sm(proto_tree *tree, tvbuff_t *tvb, packet_info *pinfo,\r\nproto_tree *top_tree)\r\n{\r\ntvbuff_t *tvb_msg;\r\nint offset = 0;\r\nguint8 flag, udhi;\r\nguint8 length;\r\nconst char *src_str = NULL;\r\nconst char *dst_str = NULL;\r\naddress save_src, save_dst;\r\nnstime_t zero_time = {0, 0};\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsrc_str = smpp_handle_string_return(tree, tvb, pinfo, hf_smpp_source_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_npi, &offset);\r\ndst_str = smpp_handle_string_return(tree, tvb, pinfo, hf_smpp_destination_addr, &offset);\r\nflag = tvb_get_guint8(tvb, offset);\r\nudhi = flag & 0x40;\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_mode,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_type,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_features,\r\ntvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_protocol_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_priority_flag, &offset);\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_schedule_delivery_time,\r\nhf_smpp_schedule_delivery_time_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_schedule_delivery_time_r, tvb, offset++, 1, &zero_time, "Immediate delivery");\r\n}\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_validity_period,\r\nhf_smpp_validity_period_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_validity_period_r, tvb, offset++, 1, &zero_time, "SMSC default validity period");\r\n}\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_receipt, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_acks, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_notif, tvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_replace_if_present_flag, &offset);\r\nsmpp_handle_dcs(tree, tvb, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_sm_default_msg_id, &offset);\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_sm_length, tvb, offset++, 1, length);\r\nif (length)\r\n{\r\nproto_tree_add_item(tree, hf_smpp_short_message,\r\ntvb, offset, length, ENC_NA);\r\nif (udhi)\r\n{\r\nDebugLog(("UDHI present - set addresses\n"));\r\ncopy_address_shallow(&save_src, &pinfo->src);\r\ncopy_address_shallow(&save_dst, &pinfo->dst);\r\nset_address(&(pinfo->src), AT_STRINGZ, 1+(int)strlen(src_str), src_str);\r\nset_address(&(pinfo->dst), AT_STRINGZ, 1+(int)strlen(dst_str), dst_str);\r\ntvb_msg = tvb_new_subset (tvb, offset,\r\nMIN(length, tvb_reported_length(tvb) - offset), length);\r\ncall_dissector (gsm_sms_handle, tvb_msg, pinfo, top_tree);\r\ncopy_address_shallow(&pinfo->src, &save_src);\r\ncopy_address_shallow(&pinfo->dst, &save_dst);\r\n}\r\noffset += length;\r\n}\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nreplace_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 flag;\r\nguint8 length;\r\nnstime_t zero_time = {0, 0};\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_schedule_delivery_time,\r\nhf_smpp_schedule_delivery_time_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_schedule_delivery_time_r, tvb, offset++, 1, &zero_time, "Keep initial delivery time setting");\r\n}\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_validity_period,\r\nhf_smpp_validity_period_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_validity_period_r, tvb, offset++, 1,&zero_time, "Keep initial validity period setting");\r\n}\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_receipt, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_acks, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_notif, tvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_sm_default_msg_id, &offset);\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_sm_length, tvb, offset++, 1, length);\r\nif (length)\r\nproto_tree_add_item(tree, hf_smpp_short_message,\r\ntvb, offset, length, ENC_NA);\r\noffset += length;\r\n}\r\nstatic void\r\ncancel_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_destination_addr, &offset);\r\n}\r\nstatic void\r\nsubmit_multi(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 flag;\r\nguint8 length;\r\nnstime_t zero_time = {0, 0};\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_dlist(tree, tvb, &offset);\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_mode,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_type,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_features,\r\ntvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_protocol_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_priority_flag, &offset);\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_schedule_delivery_time,\r\nhf_smpp_schedule_delivery_time_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_schedule_delivery_time_r, tvb, offset++, 1, &zero_time, "Immediate delivery");\r\n}\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_validity_period, hf_smpp_validity_period_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_schedule_delivery_time_r, tvb, offset++, 1, &zero_time, "SMSC default validity period");\r\n}\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_receipt, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_acks, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_notif, tvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_replace_if_present_flag, &offset);\r\nsmpp_handle_dcs(tree, tvb, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_sm_default_msg_id, &offset);\r\nlength = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_sm_length, tvb, offset++, 1, length);\r\nif (length)\r\nproto_tree_add_item(tree, hf_smpp_short_message,\r\ntvb, offset, length, ENC_NA);\r\noffset += length;\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nalert_notification(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_esme_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_esme_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_esme_addr, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\ndata_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 flag;\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_dest_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_destination_addr, &offset);\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_mode,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_msg_type,\r\ntvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_esm_submit_features,\r\ntvb, offset, 1, flag);\r\noffset++;\r\nflag = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_receipt, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_acks, tvb, offset, 1, flag);\r\nproto_tree_add_uint(tree, hf_smpp_regdel_notif, tvb, offset, 1, flag);\r\noffset++;\r\nsmpp_handle_dcs(tree, tvb, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nbroadcast_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nnstime_t zero_time = {0, 0};\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_priority_flag, &offset);\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_schedule_delivery_time,\r\nhf_smpp_schedule_delivery_time_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_schedule_delivery_time_r, tvb, offset++, 1, &zero_time, "Immediate delivery");\r\n}\r\nif (tvb_get_guint8(tvb,offset)) {\r\nsmpp_handle_time(tree, tvb, hf_smpp_validity_period, hf_smpp_validity_period_r, &offset);\r\n} else {\r\nproto_tree_add_time_format_value(tree, hf_smpp_validity_period_r, tvb, offset++, 1, &zero_time, "SMSC default validity period");\r\n}\r\nsmpp_handle_int1(tree, tvb, hf_smpp_replace_if_present_flag, &offset);\r\nsmpp_handle_dcs(tree, tvb, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_sm_default_msg_id, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nquery_broadcast_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\ncancel_broadcast_sm(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string_z(tree, tvb, hf_smpp_service_type, &offset, "(Default)");\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_ton, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_source_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nbind_receiver_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_system_id, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nquery_sm_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_time(tree, tvb, hf_smpp_final_date,\r\nhf_smpp_final_date_r, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_message_state, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_smpp_error_code, &offset);\r\n}\r\nstatic void\r\nsubmit_sm_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nsubmit_multi_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_dlist_resp(tree, tvb, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\ndata_sm_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nquery_broadcast_sm_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_string(tree, tvb, hf_smpp_message_id, &offset);\r\nsmpp_handle_tlv(tree, tvb, &offset);\r\n}\r\nstatic void\r\nhuawei_auth_acc(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 version = 0;\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_version, &offset);\r\nversion = tvb_get_guint8(tvb, offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_smsc_addr, &offset);\r\nif ( version == '3' ) {\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_msc_addr_noa, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_msc_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_msc_addr, &offset);\r\n}\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_destination_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_mo_mt_flag, &offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_sm_id, &offset);\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_length_auth, &offset);\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_service_id, &offset);\r\n}\r\nstatic void\r\nhuawei_auth_acc_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_operation_result, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_notify_mode, &offset);\r\n}\r\nstatic void\r\nhuawei_sm_result_notify(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nguint8 version = 0;\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_version, &offset);\r\nversion = tvb_get_guint8(tvb, offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_smsc_addr, &offset);\r\nif ( version == '3' ) {\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_msc_addr_noa, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_msc_addr_npi, &offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_msc_addr, &offset);\r\n}\r\nsmpp_handle_string(tree, tvb, hf_smpp_source_addr, &offset);\r\nsmpp_handle_string(tree, tvb, hf_smpp_destination_addr, &offset);\r\nsmpp_handle_int1(tree, tvb, hf_huawei_smpp_mo_mt_flag, &offset);\r\nsmpp_handle_string(tree, tvb, hf_huawei_smpp_sm_id, &offset);\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_length_auth, &offset);\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_delivery_result, &offset);\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_service_id, &offset);\r\n}\r\nstatic void\r\nhuawei_sm_result_notify_resp(proto_tree *tree, tvbuff_t *tvb)\r\n{\r\nint offset = 0;\r\nsmpp_handle_int4(tree, tvb, hf_huawei_smpp_operation_result, &offset);\r\n}\r\nstatic gboolean\r\ndissect_smpp_heur(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data)\r\n{\r\nguint command_id;\r\nguint command_status;\r\nguint command_length;\r\nif (tvb_reported_length(tvb) < SMPP_MIN_LENGTH)\r\nreturn FALSE;\r\ncommand_length = tvb_get_ntohl(tvb, 0);\r\nif (command_length > 64 * 1024 || command_length < SMPP_MIN_LENGTH)\r\nreturn FALSE;\r\ncommand_id = tvb_get_ntohl(tvb, 4);\r\nif (try_val_to_str(command_id, vals_command_id) == NULL)\r\nreturn FALSE;\r\ncommand_status = tvb_get_ntohl(tvb, 8);\r\nif (try_val_to_str(command_status, vals_command_status) == NULL &&\r\ntry_rval_to_str(command_status, reserved_command_status) == NULL)\r\nreturn FALSE;\r\ndissect_smpp(tvb, pinfo, tree, data);\r\nreturn TRUE;\r\n}\r\nstatic guint\r\nget_smpp_pdu_len(packet_info *pinfo _U_, tvbuff_t *tvb, int offset, void *data _U_)\r\n{\r\nreturn tvb_get_ntohl(tvb, offset);\r\n}\r\nstatic int\r\ndissect_smpp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\nfirst = TRUE;\r\nif (pinfo->ptype == PT_TCP) {\r\ntcp_dissect_pdus(tvb, pinfo, tree,\r\nreassemble_over_tcp,\r\n16,\r\nget_smpp_pdu_len,\r\ndissect_smpp_pdu, data);\r\n} else {\r\nguint32 offset = 0;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nguint16 pdu_len = tvb_get_ntohl(tvb, offset);\r\ngint pdu_real_len = tvb_captured_length_remaining(tvb, offset);\r\ntvbuff_t *pdu_tvb;\r\nif (pdu_len < 1)\r\nTHROW(ReportedBoundsError);\r\nif (pdu_real_len <= 0)\r\nreturn offset;\r\nif (pdu_real_len > pdu_len)\r\npdu_real_len = pdu_len;\r\npdu_tvb = tvb_new_subset(tvb, offset, pdu_real_len, pdu_len);\r\ndissect_smpp_pdu(pdu_tvb, pinfo, tree, data);\r\noffset += pdu_len;\r\nfirst = FALSE;\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_smpp_pdu(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nguint command_length;\r\nguint command_id;\r\nguint command_status;\r\nguint sequence_number;\r\nsmpp_tap_rec_t *tap_rec;\r\nconst gchar *command_str;\r\nconst gchar *command_status_str = NULL;\r\nproto_item *ti;\r\nproto_tree *smpp_tree;\r\nif (tvb_reported_length(tvb) < SMPP_MIN_LENGTH)\r\nreturn 0;\r\ncommand_length = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\ncommand_id = tvb_get_ntohl(tvb, offset);\r\ncommand_str = val_to_str(command_id, vals_command_id,\r\n"(Unknown SMPP Operation 0x%08X)");\r\noffset += 4;\r\ncommand_status = tvb_get_ntohl(tvb, offset);\r\nif (command_id & 0x80000000) {\r\ncommand_status_str = try_val_to_str(command_status, vals_command_status);\r\nif (command_status_str == NULL) {\r\ncommand_status_str = (command_status >= 0x400 && command_status <= 0x4FF ?\r\nwmem_strdup_printf(wmem_packet_scope(), "Vendor-specific Error (0x%08X)", command_status) :\r\nwmem_strdup_printf(wmem_packet_scope(), "(Reserved Error 0x%08X)", command_status));\r\n}\r\n}\r\noffset += 4;\r\nsequence_number = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nif (first == TRUE) {\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SMPP");\r\n}\r\nti = proto_tree_add_item (tree, proto_smpp, tvb, 0, tvb_captured_length(tvb), ENC_NA);\r\nsmpp_tree = proto_item_add_subtree (ti, ett_smpp);\r\n{\r\ntvbuff_t *pdu_tvb;\r\nif (first == TRUE) {\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "SMPP %s", command_str);\r\nfirst = FALSE;\r\n} else {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ", %s", command_str);\r\n}\r\nif (command_id & 0x80000000) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": \"%s\"",\r\ncommand_status_str);\r\n}\r\nif (tvb_captured_length_remaining(tvb, offset - 16 + command_length) > 0) {\r\npdu_tvb = tvb_new_subset(tvb, offset - 16,\r\ncommand_length,\r\ncommand_length);\r\n} else {\r\npdu_tvb = tvb_new_subset(tvb, offset - 16,\r\ntvb_captured_length_remaining(tvb, offset - 16),\r\ncommand_length);\r\n}\r\nif (tree || (command_id == 4))\r\n{\r\nif (tree) {\r\nproto_tree_add_uint(smpp_tree, hf_smpp_command_length,\r\npdu_tvb, 0, 4, command_length);\r\nproto_tree_add_uint(smpp_tree, hf_smpp_command_id,\r\npdu_tvb, 4, 4, command_id);\r\nproto_item_append_text(ti, ", Command: %s", command_str);\r\nif (command_id & 0x80000000) {\r\nproto_tree_add_uint(smpp_tree, hf_smpp_command_status,\r\npdu_tvb, 8, 4, command_status);\r\nproto_item_append_text (ti, ", Status: \"%s\"",\r\ncommand_status_str);\r\n}\r\nproto_tree_add_uint(smpp_tree, hf_smpp_sequence_number,\r\npdu_tvb, 12, 4, sequence_number);\r\nproto_item_append_text(ti, ", Seq: %u, Len: %u",\r\nsequence_number, command_length);\r\n}\r\nif (command_length <= tvb_reported_length(pdu_tvb))\r\n{\r\ntvbuff_t *tmp_tvb = tvb_new_subset(pdu_tvb, 16,\r\n-1, command_length - 16);\r\nif (command_id & 0x80000000)\r\n{\r\nswitch (command_id & 0x7FFFFFFF) {\r\ncase 0:\r\ncase 6:\r\ncase 7:\r\ncase 8:\r\ncase 21:\r\ncase 275:\r\nbreak;\r\ncase 1:\r\nif (!command_status)\r\nbind_receiver_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 2:\r\nif (!command_status)\r\nbind_transmitter_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 3:\r\nif (!command_status)\r\nquery_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 4:\r\nif (!command_status)\r\nsubmit_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 5:\r\nif (!command_status)\r\ndeliver_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 9:\r\nif (!command_status)\r\nbind_transceiver_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 33:\r\nif (!command_status)\r\nsubmit_multi_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 259:\r\nif (!command_status)\r\ndata_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 273:\r\nif (!command_status)\r\nbroadcast_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 274:\r\nif (!command_status)\r\nquery_broadcast_sm_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 16777217:\r\nif (!command_status)\r\nhuawei_auth_acc_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 16777218:\r\nif (!command_status)\r\nhuawei_sm_result_notify_resp(smpp_tree, tmp_tvb);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nelse\r\n{\r\nswitch (command_id) {\r\ncase 1:\r\nbind_receiver(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 2:\r\nbind_transmitter(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 3:\r\nquery_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 4:\r\nsubmit_sm(smpp_tree, tmp_tvb, pinfo, tree);\r\nbreak;\r\ncase 5:\r\ndeliver_sm(smpp_tree, tmp_tvb, pinfo, tree);\r\nbreak;\r\ncase 6:\r\ncase 21:\r\nbreak;\r\ncase 7:\r\nreplace_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 8:\r\ncancel_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 9:\r\nbind_transceiver(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 11:\r\noutbind(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 33:\r\nsubmit_multi(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 258:\r\nalert_notification(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 259:\r\ndata_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 273:\r\nbroadcast_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 274:\r\nquery_broadcast_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 275:\r\ncancel_broadcast_sm(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 16777217:\r\nhuawei_auth_acc(smpp_tree, tmp_tvb);\r\nbreak;\r\ncase 16777218:\r\nhuawei_sm_result_notify(smpp_tree, tmp_tvb);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\ntap_rec = wmem_new0(wmem_packet_scope(), smpp_tap_rec_t);\r\ntap_rec->command_id = command_id;\r\ntap_rec->command_status = command_status;\r\ntap_queue_packet(smpp_tap, pinfo, tap_rec);\r\nfirst = FALSE;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_smpp(void)\r\n{\r\nmodule_t *smpp_module;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_smpp_command_length,\r\n{ "Length", "smpp.command_length",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"Total length of the SMPP PDU.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_command_id,\r\n{ "Operation", "smpp.command_id",\r\nFT_UINT32, BASE_HEX, VALS(vals_command_id), 0x00,\r\n"Defines the SMPP PDU.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_command_status,\r\n{ "Result", "smpp.command_status",\r\nFT_UINT32, BASE_HEX, VALS(vals_command_status), 0x00,\r\n"Indicates success or failure of the SMPP request.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sequence_number,\r\n{ "Sequence #", "smpp.sequence_number",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"A number to correlate requests with responses.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_system_id,\r\n{ "System ID", "smpp.system_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Identifies a system.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_password,\r\n{ "Password", "smpp.password",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Password used for authentication.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_system_type,\r\n{ "System type", "smpp.system_type",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Categorizes the system.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_interface_version,\r\n{ "Version (if)", "smpp.interface_version",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Version of SMPP interface supported.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_service_type,\r\n{ "Service type", "smpp.service_type",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"SMS application service associated with the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_addr_ton,\r\n{ "Type of number", "smpp.addr_ton",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_ton), 0x00,\r\n"Indicates the type of number, given in the address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_addr_ton,\r\n{ "Type of number (originator)", "smpp.source_addr_ton",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_ton), 0x00,\r\n"Indicates originator type of number, given in the address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_ton,\r\n{ "Type of number (recipient)", "smpp.dest_addr_ton",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_ton), 0x00,\r\n"Indicates recipient type of number, given in the address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_addr_npi,\r\n{ "Numbering plan indicator", "smpp.addr_npi",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_npi), 0x00,\r\n"Gives the numbering plan this address belongs to.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_addr_npi,\r\n{ "Numbering plan indicator (originator)", "smpp.source_addr_npi",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_npi), 0x00,\r\n"Gives originator numbering plan this address belongs to.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_npi,\r\n{ "Numbering plan indicator (recipient)", "smpp.dest_addr_npi",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_npi), 0x00,\r\n"Gives recipient numbering plan this address belongs to.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_address_range,\r\n{ "Address", "smpp.address_range",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Given address or address range.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_addr,\r\n{ "Originator address", "smpp.source_addr",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Address of SME originating this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_destination_addr,\r\n{ "Recipient address", "smpp.destination_addr",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Address of SME receiving this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esm_submit_msg_mode,\r\n{ "Messaging mode", "smpp.esm.submit.msg_mode",\r\nFT_UINT8, BASE_HEX, VALS(vals_esm_submit_msg_mode), 0x03,\r\n"Mode attribute for this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esm_submit_msg_type,\r\n{ "Message type", "smpp.esm.submit.msg_type",\r\nFT_UINT8, BASE_HEX, VALS(vals_esm_submit_msg_type), 0x3C,\r\n"Type attribute for this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esm_submit_features,\r\n{ "GSM features", "smpp.esm.submit.features",\r\nFT_UINT8, BASE_HEX, VALS(vals_esm_submit_features), 0xC0,\r\n"GSM network specific features.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_protocol_id,\r\n{ "Protocol id.", "smpp.protocol_id",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"Protocol identifier according GSM 03.40.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_priority_flag,\r\n{ "Priority level", "smpp.priority_flag",\r\nFT_UINT8, BASE_HEX, VALS(vals_priority_flag), 0x00,\r\n"The priority level of the short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_schedule_delivery_time,\r\n{ "Scheduled delivery time", "smpp.schedule_delivery_time",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x00,\r\n"Scheduled time for delivery of short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_schedule_delivery_time_r,\r\n{ "Scheduled delivery time", "smpp.schedule_delivery_time_r",\r\nFT_RELATIVE_TIME, BASE_NONE, NULL, 0x00,\r\n"Scheduled time for delivery of short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_validity_period,\r\n{ "Validity period", "smpp.validity_period",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x00,\r\n"Validity period of this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_validity_period_r,\r\n{ "Validity period", "smpp.validity_period_r",\r\nFT_RELATIVE_TIME, BASE_NONE, NULL, 0x00,\r\n"Validity period of this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_regdel_receipt,\r\n{ "Delivery receipt", "smpp.regdel.receipt",\r\nFT_UINT8, BASE_HEX, VALS(vals_regdel_receipt), 0x03,\r\n"SMSC delivery receipt request.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_regdel_acks,\r\n{ "Message type", "smpp.regdel.acks",\r\nFT_UINT8, BASE_HEX, VALS(vals_regdel_acks), 0x0C,\r\n"SME acknowledgement request.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_regdel_notif,\r\n{ "Intermediate notif", "smpp.regdel.notif",\r\nFT_UINT8, BASE_HEX, VALS(vals_regdel_notif), 0x10,\r\n"Intermediate notification request.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_replace_if_present_flag,\r\n{ "Replace", "smpp.replace_if_present_flag",\r\nFT_UINT8, BASE_HEX, VALS(vals_replace_if_present_flag), 0x01,\r\n"Replace the short message with this one or not.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_data_coding,\r\n{ "Data coding", "smpp.data_coding",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"Defines the encoding scheme of the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sm_default_msg_id,\r\n{ "Predefined message", "smpp.sm_default_msg_id",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Index of a predefined ('canned') short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sm_length,\r\n{ "Message length", "smpp.sm_length",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Length of the message content.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_short_message,\r\n{ "Message", "smpp.message",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"The actual message or data.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_message_id,\r\n{ "Message id.", "smpp.message_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Identifier of the submitted short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dlist,\r\n{ "Destination list", "smpp.dlist",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"The list of destinations for a short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dlist_resp,\r\n{ "Unsuccessful delivery list", "smpp.dlist_resp",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"The list of unsuccessful deliveries to destinations.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dl_name,\r\n{ "Distr. list name", "smpp.dl_name",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"The name of the distribution list.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_final_date,\r\n{ "Final date", "smpp.final_date",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x00,\r\n"Date-time when the queried message reached a final state.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_final_date_r,\r\n{ "Final date", "smpp.final_date_r",\r\nFT_RELATIVE_TIME, BASE_NONE, NULL, 0x00,\r\n"Date-time when the queried message reached a final state.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_message_state,\r\n{ "Message state", "smpp.message_state",\r\nFT_UINT8, BASE_DEC, VALS(vals_message_state), 0x00,\r\n"Specifies the status of the queried short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_error_code,\r\n{ "Error code", "smpp.error_code",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Network specific error code defining reason for failure.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_error_status_code,\r\n{ "Status", "smpp.error_status_code",\r\nFT_UINT32, BASE_HEX, VALS(vals_command_status), 0x00,\r\n"Indicates success/failure of request for this address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esme_addr_ton,\r\n{ "Type of number (ESME)", "smpp.esme_addr_ton",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_ton), 0x00,\r\n"Indicates recipient type of number, given in the address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esme_addr_npi,\r\n{ "Numbering plan indicator (ESME)", "smpp.esme_addr_npi",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_npi), 0x00,\r\n"Gives the numbering plan this address belongs to.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_esme_addr,\r\n{ "ESME address", "smpp.esme_addr",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Address of ESME originating this message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_subunit,\r\n{ "Subunit destination", "smpp.dest_addr_subunit",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_subunit), 0x00,\r\n"Subunit address within mobile to route message to.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_addr_subunit,\r\n{ "Subunit origin", "smpp.source_addr_subunit",\r\nFT_UINT8, BASE_HEX, VALS(vals_addr_subunit), 0x00,\r\n"Subunit address within mobile that generated the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_network_type,\r\n{ "Destination network", "smpp.dest_network_type",\r\nFT_UINT8, BASE_HEX, VALS(vals_network_type), 0x00,\r\n"Network associated with the destination address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_network_type,\r\n{ "Originator network", "smpp.source_network_type",\r\nFT_UINT8, BASE_HEX, VALS(vals_network_type), 0x00,\r\n"Network associated with the originator address.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_bearer_type,\r\n{ "Destination bearer", "smpp.dest_bearer_type",\r\nFT_UINT8, BASE_HEX, VALS(vals_bearer_type), 0x00,\r\n"Desired bearer for delivery of message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_bearer_type,\r\n{ "Originator bearer", "smpp.source_bearer_type",\r\nFT_UINT8, BASE_HEX, VALS(vals_bearer_type), 0x00,\r\n"Bearer over which the message originated.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_telematics_id,\r\n{ "Telematic interworking (dest)", "smpp.dest_telematics_id",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Telematic interworking to be used for message delivery.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_telematics_id,\r\n{ "Telematic interworking (orig)", "smpp.source_telematics_id",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"Telematic interworking used for message submission.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_qos_time_to_live,\r\n{ "Validity period", "smpp.qos_time_to_live",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"Number of seconds to retain message before expiry.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_payload_type,\r\n{ "Payload", "smpp.payload_type",\r\nFT_UINT8, BASE_DEC, VALS(vals_payload_type), 0x00,\r\n"PDU type contained in the message payload.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_additional_status_info_text,\r\n{ "Information", "smpp.additional_status_info_text",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Description of the meaning of a response PDU.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_receipted_message_id,\r\n{ "SMSC identifier", "smpp.receipted_message_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"SMSC handle of the message being received.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_privacy_indicator,\r\n{ "Privacy indicator", "smpp.privacy_indicator",\r\nFT_UINT8, BASE_DEC, VALS(vals_privacy_indicator), 0x00,\r\n"Indicates the privacy level of the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_subaddress,\r\n{ "Source Subaddress", "smpp.source_subaddress",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_subaddress,\r\n{ "Destination Subaddress", "smpp.dest_subaddress",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_user_message_reference,\r\n{ "Message reference", "smpp.user_message_reference",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Reference to the message, assigned by the user.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_user_response_code,\r\n{ "Application response code", "smpp.user_response_code",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"A response code set by the user.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_language_indicator,\r\n{ "Language", "smpp.language_indicator",\r\nFT_UINT8, BASE_DEC, VALS(vals_language_indicator), 0x00,\r\n"Indicates the language of the short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_source_port,\r\n{ "Source port", "smpp.source_port",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Application port associated with the source of the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_destination_port,\r\n{ "Destination port", "smpp.destination_port",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Application port associated with the destination of the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sar_msg_ref_num,\r\n{ "SAR reference number", "smpp.sar_msg_ref_num",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"Reference number for a concatenated short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sar_total_segments,\r\n{ "SAR size", "smpp.sar_total_segments",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"Number of segments of a concatenated short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sar_segment_seqnum,\r\n{ "SAR sequence number", "smpp.sar_segment_seqnum",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Segment number within a concatenated short message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_display_time,\r\n{ "Display time", "smpp.display_time",\r\nFT_UINT8, BASE_DEC, VALS(vals_display_time), 0x00,\r\n"Associates a display time with the message on the handset.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_sms_signal,\r\n{ "SMS signal", "smpp.sms_signal",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Alert the user according to the information contained within this information element.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_ms_validity,\r\n{ "Validity info", "smpp.ms_validity",\r\nFT_UINT8, BASE_DEC, VALS(vals_ms_validity), 0x00,\r\n"Associates validity info with the message on the handset.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dpf_result,\r\n{ "Delivery pending set?", "smpp.dpf_result",\r\nFT_UINT8, BASE_DEC, VALS(vals_dpf_result), 0x00,\r\n"Indicates whether Delivery Pending Flag was set.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_set_dpf,\r\n{ "Request DPF set", "smpp.set_dpf",\r\nFT_UINT8, BASE_DEC, VALS(vals_set_dpf), 0x00,\r\n"Request to set the DPF for certain failure scenario's.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_ms_availability_status,\r\n{ "Availability status", "smpp.ms_availability_status",\r\nFT_UINT8, BASE_DEC, VALS(vals_ms_availability_status), 0x00,\r\n"Indicates the availability state of the handset.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_delivery_failure_reason,\r\n{ "Delivery failure reason", "smpp.delivery_failure_reason",\r\nFT_UINT8, BASE_DEC, VALS(vals_delivery_failure_reason), 0x00,\r\n"Indicates the reason for a failed delivery attempt.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_more_messages_to_send,\r\n{ "More messages?", "smpp.more_messages_to_send",\r\nFT_UINT8, BASE_DEC, VALS(vals_more_messages_to_send), 0x00,\r\n"Indicates more messages pending for the same destination.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_number_of_messages,\r\n{ "Number of messages", "smpp.number_of_messages",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Indicates number of messages stored in a mailbox.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_its_reply_type,\r\n{ "Reply method", "smpp.its_reply_type",\r\nFT_UINT8, BASE_DEC, VALS(vals_its_reply_type), 0x00,\r\n"Indicates the handset reply method on message receipt.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_ussd_service_op,\r\n{ "USSD service operation", "smpp.ussd_service_op",\r\nFT_UINT8, BASE_DEC, VALS(vals_ussd_service_op), 0x00,\r\n"Indicates the USSD service operation.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_vendor_op,\r\n{ "Value", "smpp.vendor_op",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"A supplied optional parameter specific to an SMSC-vendor.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_reserved_op,\r\n{ "Value", "smpp.reserved_op",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"An optional parameter that is reserved in this version.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_msg_wait_ind,\r\n{ "Indication", "smpp.msg_wait.ind",\r\nFT_UINT8, BASE_HEX, VALS(vals_msg_wait_ind), 0x80,\r\n"Indicates to the handset that a message is waiting.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_msg_wait_type,\r\n{ "Type", "smpp.msg_wait.type",\r\nFT_UINT8, BASE_HEX, VALS(vals_msg_wait_type), 0x03,\r\n"Indicates type of message that is waiting.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_SC_interface_version,\r\n{ "SMSC-supported version", "smpp.SC_interface_version",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Version of SMPP interface supported by the SMSC.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_callback_num_pres,\r\n{ "Presentation", "smpp.callback_num.pres",\r\nFT_UINT8, BASE_HEX, VALS(vals_callback_num_pres), 0x0C,\r\n"Controls the presentation indication.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_callback_num_scrn,\r\n{ "Screening", "smpp.callback_num.scrn",\r\nFT_UINT8, BASE_HEX, VALS(vals_callback_num_scrn), 0x03,\r\n"Controls screening of the callback-number.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_callback_num_atag,\r\n{ "Callback number - alphanumeric display tag",\r\n"smpp.callback_num_atag",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"Associates an alphanumeric display with call back number.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_callback_num,\r\n{ "Callback number", "smpp.callback_num",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"Associates a call back number with the message.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_network_error_type,\r\n{ "Error type", "smpp.network_error.type",\r\nFT_UINT8, BASE_DEC, VALS(vals_network_error_type), 0x00,\r\n"Indicates the network type.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_network_error_code,\r\n{ "Error code", "smpp.network_error.code",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Gives the actual network error code.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_message_payload,\r\n{ "Payload", "smpp.message_payload",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"Short message user data.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_alert_on_message_delivery_null,\r\n{ "Alert on delivery", "smpp.alert_on_message_delivery_null",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"Instructs the handset to alert user on message delivery.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_alert_on_message_delivery_type,\r\n{ "Alert on delivery", "smpp.alert_on_message_delivery_type",\r\nFT_UINT8, BASE_DEC, VALS(vals_alert_on_message_delivery), 0x00,\r\n"Instructs the handset to alert user on message delivery.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_its_session_number,\r\n{ "Session number", "smpp.its_session.number",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\n"Session number of interactive teleservice.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_its_session_sequence,\r\n{ "Sequence number", "smpp.its_session.sequence",\r\nFT_UINT8, BASE_HEX, NULL, 0xFE,\r\n"Sequence number of the dialogue unit.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_its_session_ind,\r\n{ "Session indicator", "smpp.its_session.ind",\r\nFT_UINT8, BASE_HEX, VALS(vals_its_session_ind), 0x01,\r\n"Indicates whether this message is end of conversation.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_opt_params,\r\n{ "Optional parameters", "smpp.opt_params",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"The list of optional parameters in this operation.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_opt_param,\r\n{ "Optional parameter", "smpp.opt_param",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL,\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_opt_param_tag,\r\n{ "Tag", "smpp.opt_param_tag",\r\nFT_UINT16, BASE_HEX, NULL, 0x00,\r\n"Optional parameter identifier tag",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_opt_param_len,\r\n{ "Length", "smpp.opt_param_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"Optional parameter length",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs,\r\n{ "SMPP Data Coding Scheme", "smpp.dcs",\r\nFT_UINT8, BASE_HEX, VALS(vals_data_coding), 0x00,\r\n"Data Coding Scheme according to SMPP.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_sms_coding_group,\r\n{ "DCS Coding Group for SMS", "smpp.dcs.sms_coding_group",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_sms_coding_group), 0xF0,\r\n"Data Coding Scheme coding group for GSM Short Message Service.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_text_compression,\r\n{ "DCS Text compression", "smpp.dcs.text_compression",\r\nFT_BOOLEAN, 8, TFS(&tfs_dcs_text_compression), 0x20,\r\n"Indicates if text compression is used.", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_class_present,\r\n{ "DCS Class present", "smpp.dcs.class_present",\r\nFT_BOOLEAN, 8, TFS(&tfs_dcs_class_present), 0x10,\r\n"Indicates if the message class is present (defined).", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_reserved,\r\n{ "Reserved (should be zero)", "smpp.dcs.reserved",\r\nFT_UINT8, BASE_DEC, NULL, 0x08,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_charset,\r\n{ "DCS Character set", "smpp.dcs.charset",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_charset), 0x0C,\r\n"Specifies the character set used in the message.", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_class,\r\n{ "DCS Message class", "smpp.dcs.class",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_class), 0x03,\r\n"Specifies the message class.", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_cbs_coding_group,\r\n{ "DCS Coding Group for CBS", "smpp.dcs.cbs_coding_group",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_cbs_coding_group), 0xF0,\r\n"Data Coding Scheme coding group for GSM Cell Broadcast Service.",\r\nHFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_cbs_language,\r\n{ "DCS CBS Message language", "smpp.dcs.cbs_language",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_cbs_language), 0x3F,\r\n"Language of the GSM Cell Broadcast Service message.", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_cbs_class,\r\n{ "DCS CBS Message class", "smpp.dcs.cbs_class",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_cbs_class), 0x03,\r\n"Specifies the message class for GSM Cell Broadcast Service, for the Data coding / message handling code group.", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_wap_charset,\r\n{ "DCS Message coding", "smpp.dcs.wap_coding",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_wap_charset), 0x0C,\r\n"Specifies the used message encoding, as specified by the WAP Forum (WAP over GSM USSD).", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dcs_wap_class,\r\n{ "DCS CBS Message class", "smpp.dcs.wap_class",\r\nFT_UINT8, BASE_HEX, VALS(vals_dcs_wap_class), 0x03,\r\n"Specifies the message class for GSM Cell Broadcast Service, as specified by the WAP Forum (WAP over GSM USSD).", HFILL\r\n}\r\n},\r\n{ &hf_smpp_congestion_state,\r\n{ "Congestion State", "smpp.congestion_state",\r\nFT_UINT8, BASE_DEC | BASE_RANGE_STRING, RVALS(vals_congestion_state), 0x00,\r\n"Congestion info between ESME and MC for flow control/cong. control", HFILL\r\n}\r\n},\r\n{ &hf_smpp_billing_identification,\r\n{ "Billing Identification", "smpp.billing_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Billing identification info", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_np_country,\r\n{ "Destination Country Code", "smpp.dest_addr_np_country",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Destination Country Code (E.164 Region Code)", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_np_information,\r\n{ "Number Portability information", "smpp.dest_addr_np_info",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_addr_np_resolution,\r\n{ "Number Portability query information", "smpp.dest_addr_np_resolution",\r\nFT_UINT8, BASE_DEC, VALS(vals_dest_addr_np_resolution), 0x00,\r\n"Number Portability query information - method used to resolve number", HFILL\r\n}\r\n},\r\n{ &hf_smpp_source_network_id,\r\n{ "Source Network ID", "smpp.source_network_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Unique ID for a network or ESME operator", HFILL\r\n}\r\n},\r\n{ &hf_smpp_source_node_id,\r\n{ "Source Node ID", "smpp.source_node_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Unique ID for a ESME or MC node", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_network_id,\r\n{ "Destination Network ID", "smpp.dest_network_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"Unique ID for a network or ESME operator", HFILL\r\n}\r\n},\r\n{ &hf_smpp_dest_node_id,\r\n{ "Destination Node ID", "smpp.dest_node_id",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Unique ID for a ESME or MC node", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_channel_indicator,\r\n{ "Cell Broadcast channel", "smpp.broadcast_channel_indicator",\r\nFT_UINT8, BASE_DEC | BASE_RANGE_STRING, RVALS(vals_broadcast_channel_indicator), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_content_type_nw,\r\n{ "Broadcast Content Type - Network Tag", "smpp.broadcast_content_type.nw",\r\nFT_UINT8, BASE_DEC, VALS(vals_broadcast_content_type_nw), 0x00,\r\n"Cell Broadcast content type", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_content_type_type,\r\n{ "Broadcast Content Type - Content Type", "smpp.broadcast_content_type.type",\r\nFT_UINT16, BASE_HEX, VALS(vals_broadcast_content_type_type), 0x00,\r\n"Cell Broadcast content type", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_content_type_info,\r\n{ "Broadcast Content Type Info", "smpp.broadcast_content_type.info",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Cell Broadcast content type Info", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_message_class,\r\n{ "Broadcast Message Class", "smpp.broadcast_message_class",\r\nFT_UINT8, BASE_HEX, VALS(vals_broadcast_message_class), 0x00,\r\n"Cell Broadcast Message Class", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_rep_num,\r\n{ "Broadcast Message - Number of repetitions requested", "smpp.broadcast_rep_num",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"Cell Broadcast Message - Number of repetitions requested", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_frequency_interval_unit,\r\n{ "Broadcast Message - frequency interval - Unit", "smpp.broadcast_frequency_interval.unit",\r\nFT_UINT8, BASE_HEX, VALS(vals_broadcast_frequency_interval_unit), 0x00,\r\n"Cell Broadcast Message - frequency interval at which broadcast must be repeated", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_frequency_interval_value,\r\n{ "Broadcast Message - frequency interval - Unit", "smpp.broadcast_frequency_interval.value",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\n"Cell Broadcast Message - frequency interval at which broadcast must be repeated", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_area_identifier,\r\n{ "Broadcast Message - Area Identifier", "smpp.broadcast_area_identifier",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Cell Broadcast Message - Area Identifier", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_area_identifier_format,\r\n{ "Broadcast Message - Area Identifier Format", "smpp.broadcast_area_identifier.format",\r\nFT_UINT8, BASE_HEX | BASE_RANGE_STRING, RVALS(vals_broadcast_area_identifier_format), 0x00,\r\n"Cell Broadcast Message - Area Identifier Format", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_error_status,\r\n{ "Broadcast Message - Error Status", "smpp.broadcast_error_status",\r\nFT_UINT32, BASE_HEX, VALS(vals_command_status), 0x00,\r\n"Cell Broadcast Message - Error Status", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_area_success,\r\n{ "Broadcast Message - Area Success", "smpp.broadcast_area_success",\r\nFT_UINT8, BASE_DEC | BASE_RANGE_STRING, RVALS(vals_broadcast_area_success), 0x00,\r\n"Cell Broadcast Message - success rate indicator (ratio) - No. of BTS which accepted Message:Total BTS", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_end_time,\r\n{ "Broadcast Message - End Time", "smpp.broadcast_end_time",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_UTC, NULL, 0x00,\r\n"Cell Broadcast Message - Date and time at which MC set the state of the message to terminated", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_end_time_r,\r\n{ "Broadcast Message - End Time", "smpp.broadcast_end_time_r",\r\nFT_RELATIVE_TIME, BASE_NONE, NULL, 0x00,\r\n"Cell Broadcast Message - Date and time at which MC set the state of the message to terminated", HFILL\r\n}\r\n},\r\n{ &hf_smpp_broadcast_service_group,\r\n{ "Broadcast Message - Service Group", "smpp.broadcast_service_group",\r\nFT_BYTES, BASE_NONE, NULL, 0x00,\r\n"Cell Broadcast Message - Service Group", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_version,\r\n{ "Version of SMPP+", "smpp.smppplus_version",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\n"Indicates the SMPP+ version", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_smsc_addr,\r\n{ "SMPP+: GT of SMSC", "smpp.smsc_addr",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_msc_addr_noa,\r\n{ "SMPP+: NOA of MSC address", "smpp.msc_addr_noa",\r\nFT_UINT8, BASE_DEC, VALS(vals_msc_addr_noa), 0x00,\r\n"SMPP+: Indicates the TON of MSC address", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_msc_addr_npi,\r\n{ "SMPP+: NPI of MSC address", "smpp.msc_addr_npi",\r\nFT_UINT8, BASE_DEC, VALS(vals_msc_addr_npi), 0x00,\r\n"SMPP+: Indicates the NPI of MSC address", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_msc_addr,\r\n{ "SMPP+: GT of MSC", "smpp.msc_addr",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_mo_mt_flag,\r\n{ "SMPP+: Charge for MO or MT", "smpp.mo_mt_flag",\r\nFT_UINT8, BASE_DEC, VALS(vals_mo_mt_flag), 0x00,\r\n"SMPP+: Indicates the Charge side of MO or MT", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_sm_id,\r\n{ "SMPP+: Unique SM ID", "smpp.sm_id",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\n"SMPP+: Unique SM ID which is generated by SMSC", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_length_auth,\r\n{ "SMPP+: Length of SMS", "smpp.length_auth",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"SMPP+: Indicates the Length of SMS", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_service_id,\r\n{ "SMPP+: Service ID of SMSC", "smpp.service_id",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\n"SMPP+: Indicates the Service ID of SMSC", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_operation_result,\r\n{ "SMPP+: Authentication result of SCP", "smpp.operation_result",\r\nFT_UINT32, BASE_DEC, VALS(vals_operation_result), 0x00,\r\n"SMPP+: Indicates the Authentication result of SCP", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_notify_mode,\r\n{ "SMPP+: SMS notify mode", "smpp.notify_mode",\r\nFT_UINT8, BASE_DEC, VALS(vals_notify_mode), 0x00,\r\n"SMPP+: Indicates the SMS notify mode", HFILL\r\n}\r\n},\r\n{ &hf_huawei_smpp_delivery_result,\r\n{ "SMPP+: Delivery result of SMS", "smpp.delivery_result",\r\nFT_UINT32, BASE_DEC, VALS(vals_delivery_result), 0x00,\r\n"SMPP+: Indicates the Delivery result of SMS", HFILL\r\n}\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_smpp,\r\n&ett_dlist,\r\n&ett_dlist_resp,\r\n&ett_opt_params,\r\n&ett_opt_param,\r\n&ett_dcs,\r\n};\r\nDebugLog(("Registering SMPP dissector\n"));\r\nproto_smpp = proto_register_protocol("Short Message Peer to Peer",\r\n"SMPP", "smpp");\r\nproto_register_field_array(proto_smpp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("smpp", dissect_smpp, proto_smpp);\r\nsmpp_tap = register_tap("smpp");\r\nsmpp_module = prefs_register_protocol (proto_smpp, NULL);\r\nprefs_register_bool_preference (smpp_module,\r\n"reassemble_smpp_over_tcp",\r\n"Reassemble SMPP over TCP messages spanning multiple TCP segments",\r\n"Whether the SMPP dissector should reassemble messages spanning multiple TCP segments."\r\n" To use this option, you must also enable "\r\n"\"Allow subdissectors to reassemble TCP streams\" in the TCP protocol settings.",\r\n&reassemble_over_tcp);\r\n}\r\nvoid\r\nproto_reg_handoff_smpp(void)\r\n{\r\ndissector_handle_t smpp_handle;\r\nsmpp_handle = find_dissector("smpp");\r\ndissector_add_for_decode_as("tcp.port", smpp_handle);\r\nheur_dissector_add("tcp", dissect_smpp_heur, "SMPP over TCP", "smpp_tcp", proto_smpp, HEURISTIC_ENABLE);\r\nheur_dissector_add("x.25", dissect_smpp_heur, "SMPP over X.25", "smpp_x25", proto_smpp, HEURISTIC_ENABLE);\r\nDebugLog(("Finding gsm_sms_ud subdissector\n"));\r\ngsm_sms_handle = find_dissector_add_dependency("gsm_sms_ud", proto_smpp);\r\nDISSECTOR_ASSERT(gsm_sms_handle);\r\nstats_tree_register_with_group("smpp","smpp_commands", "SM_PP Operations", 0,\r\nsmpp_stats_tree_per_packet, smpp_stats_tree_init,\r\nNULL, REGISTER_STAT_GROUP_TELEPHONY);\r\n}
