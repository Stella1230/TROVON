static int\r\ndissect_mpeg_audio_BIT_STRING_SIZE_11(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_bit_string(tvb, offset, actx, tree, hf_index,\r\n11, 11, FALSE, NULL, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_version(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_enumerated(tvb, offset, actx, tree, hf_index,\r\n4, NULL, FALSE, 0, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_layer(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_enumerated(tvb, offset, actx, tree, hf_index,\r\n4, NULL, FALSE, 0, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_protection(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_enumerated(tvb, offset, actx, tree, hf_index,\r\n2, NULL, FALSE, 0, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_INTEGER_0_15(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_constrained_integer(tvb, offset, actx, tree, hf_index,\r\n0U, 15U, NULL, FALSE);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_INTEGER_0_3(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_constrained_integer(tvb, offset, actx, tree, hf_index,\r\n0U, 3U, NULL, FALSE);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_BOOLEAN(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_boolean(tvb, offset, actx, tree, hf_index, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_channel_mode(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_enumerated(tvb, offset, actx, tree, hf_index,\r\n4, NULL, FALSE, 0, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_emphasis(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_enumerated(tvb, offset, actx, tree, hf_index,\r\n4, NULL, FALSE, 0, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_Audio(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_sequence(tvb, offset, actx, tree, hf_index,\r\nett_mpeg_audio_Audio, Audio_sequence);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_OCTET_STRING_SIZE_3(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_octet_string(tvb, offset, actx, tree, hf_index,\r\n3, 3, FALSE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_OCTET_STRING_SIZE_30(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_octet_string(tvb, offset, actx, tree, hf_index,\r\n30, 30, FALSE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_OCTET_STRING_SIZE_4(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_octet_string(tvb, offset, actx, tree, hf_index,\r\n4, 4, FALSE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_OCTET_STRING_SIZE_28(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_octet_string(tvb, offset, actx, tree, hf_index,\r\n28, 28, FALSE, NULL);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_INTEGER_0_255(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_constrained_integer(tvb, offset, actx, tree, hf_index,\r\n0U, 255U, NULL, FALSE);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_T_genre(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_constrained_integer(tvb, offset, actx, tree, hf_index,\r\n0U, 255U, NULL, FALSE);\r\nreturn offset;\r\n}\r\nstatic int\r\ndissect_mpeg_audio_ID3v1(tvbuff_t *tvb _U_, int offset _U_, asn1_ctx_t *actx _U_, proto_tree *tree _U_, int hf_index _U_) {\r\noffset = dissect_per_sequence(tvb, offset, actx, tree, hf_index,\r\nett_mpeg_audio_ID3v1, ID3v1_sequence);\r\nreturn offset;\r\n}\r\nstatic gboolean\r\ndissect_mpeg_audio_frame(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint32 h;\r\nstruct mpa mpa;\r\nint data_size = 0;\r\nasn1_ctx_t asn1_ctx;\r\nint offset = 0;\r\nstatic const char *version_names[] = { "1", "2", "2.5" };\r\nif (!tvb_bytes_exist(tvb, 0, 4))\r\nreturn FALSE;\r\nh = tvb_get_ntohl(tvb, 0);\r\nMPA_UNMARSHAL(&mpa, h);\r\nif (!MPA_SYNC_VALID(&mpa))\r\nreturn FALSE;\r\nif (!MPA_VERSION_VALID(&mpa))\r\nreturn FALSE;\r\nif (!MPA_LAYER_VALID(&mpa))\r\nreturn FALSE;\r\ncol_add_fstr(pinfo->cinfo, COL_PROTOCOL,\r\n"MPEG-%s", version_names[mpa_version(&mpa)]);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"Audio Layer %d", mpa_layer(&mpa) + 1);\r\nif (MPA_BITRATE_VALID(&mpa) && MPA_FREQUENCY_VALID(&mpa)) {\r\ndata_size = (int)(MPA_DATA_BYTES(&mpa) - sizeof mpa);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n", %d kb/s, %g kHz",\r\nmpa_bitrate(&mpa) / 1000,\r\nmpa_frequency(&mpa) / (float)1000);\r\n}\r\nif (tree == NULL)\r\nreturn TRUE;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_PER, TRUE, pinfo);\r\noffset = dissect_mpeg_audio_Audio(tvb, offset, &asn1_ctx,\r\ntree, proto_mpeg_audio);\r\nif (data_size > 0) {\r\nunsigned int padding;\r\nproto_tree_add_item(tree, hf_mpeg_audio_data, tvb,\r\noffset / 8, data_size, ENC_NA);\r\noffset += data_size * 8;\r\npadding = mpa_padding(&mpa);\r\nif (padding > 0) {\r\nproto_tree_add_item(tree, hf_mpeg_audio_padbytes, tvb,\r\noffset / 8, padding, ENC_NA);\r\n}\r\n}\r\nreturn TRUE;\r\n}\r\nstatic void\r\ndissect_id3v1(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nasn1_ctx_t asn1_ctx;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "ID3v1");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tree == NULL)\r\nreturn;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_PER, TRUE, pinfo);\r\ndissect_mpeg_audio_ID3v1(tvb, 0, &asn1_ctx,\r\ntree, hf_id3v1);\r\n}\r\nstatic void\r\ndissect_id3v2(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "ID3v2");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nproto_tree_add_item(tree, hf_id3v2, tvb,\r\n0, -1, ENC_NA);\r\n}\r\nstatic gboolean\r\ndissect_mpeg_audio(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nint magic;\r\nif (!tvb_bytes_exist(tvb, 0, 3))\r\nreturn FALSE;\r\nmagic = tvb_get_ntoh24(tvb, 0);\r\nswitch (magic) {\r\ncase 0x544147:\r\ndissect_id3v1(tvb, pinfo, tree);\r\nreturn TRUE;\r\ncase 0x494433:\r\ndissect_id3v2(tvb, pinfo, tree);\r\nreturn TRUE;\r\ndefault:\r\nreturn dissect_mpeg_audio_frame(tvb, pinfo, tree);\r\n}\r\n}\r\nvoid\r\nproto_register_mpeg_audio(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n#line 1 "./asn1/mpeg-audio/packet-mpeg-audio-hfarr.c"\r\n{ &hf_mpeg_audio_sync,\r\n{ "sync", "mpeg-audio.sync",\r\nFT_BYTES, BASE_NONE, NULL, 0,\r\n"BIT_STRING_SIZE_11", HFILL }},\r\n{ &hf_mpeg_audio_version,\r\n{ "version", "mpeg-audio.version",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_version_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_mpeg_audio_layer,\r\n{ "layer", "mpeg-audio.layer",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_layer_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_mpeg_audio_protection,\r\n{ "protection", "mpeg-audio.protection",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_protection_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_mpeg_audio_bitrate,\r\n{ "bitrate", "mpeg-audio.bitrate",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"INTEGER_0_15", HFILL }},\r\n{ &hf_mpeg_audio_frequency,\r\n{ "frequency", "mpeg-audio.frequency",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"INTEGER_0_3", HFILL }},\r\n{ &hf_mpeg_audio_padding,\r\n{ "padding", "mpeg-audio.padding",\r\nFT_BOOLEAN, BASE_NONE, NULL, 0,\r\n"BOOLEAN", HFILL }},\r\n{ &hf_mpeg_audio_private,\r\n{ "private", "mpeg-audio.private",\r\nFT_BOOLEAN, BASE_NONE, NULL, 0,\r\n"BOOLEAN", HFILL }},\r\n{ &hf_mpeg_audio_channel_mode,\r\n{ "channel-mode", "mpeg-audio.channel_mode",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_channel_mode_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_mpeg_audio_mode_extension,\r\n{ "mode-extension", "mpeg-audio.mode_extension",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"INTEGER_0_3", HFILL }},\r\n{ &hf_mpeg_audio_copyright,\r\n{ "copyright", "mpeg-audio.copyright",\r\nFT_BOOLEAN, BASE_NONE, NULL, 0,\r\n"BOOLEAN", HFILL }},\r\n{ &hf_mpeg_audio_original,\r\n{ "original", "mpeg-audio.original",\r\nFT_BOOLEAN, BASE_NONE, NULL, 0,\r\n"BOOLEAN", HFILL }},\r\n{ &hf_mpeg_audio_emphasis,\r\n{ "emphasis", "mpeg-audio.emphasis",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_emphasis_vals), 0,\r\nNULL, HFILL }},\r\n{ &hf_mpeg_audio_tag,\r\n{ "tag", "mpeg-audio.tag",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_3", HFILL }},\r\n{ &hf_mpeg_audio_title,\r\n{ "title", "mpeg-audio.title",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_30", HFILL }},\r\n{ &hf_mpeg_audio_artist,\r\n{ "artist", "mpeg-audio.artist",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_30", HFILL }},\r\n{ &hf_mpeg_audio_album,\r\n{ "album", "mpeg-audio.album",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_30", HFILL }},\r\n{ &hf_mpeg_audio_year,\r\n{ "year", "mpeg-audio.year",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_4", HFILL }},\r\n{ &hf_mpeg_audio_comment,\r\n{ "comment", "mpeg-audio.comment",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"OCTET_STRING_SIZE_28", HFILL }},\r\n{ &hf_mpeg_audio_must_be_zero,\r\n{ "must-be-zero", "mpeg-audio.must_be_zero",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"INTEGER_0_255", HFILL }},\r\n{ &hf_mpeg_audio_track,\r\n{ "track", "mpeg-audio.track",\r\nFT_UINT32, BASE_DEC, NULL, 0,\r\n"INTEGER_0_255", HFILL }},\r\n{ &hf_mpeg_audio_genre,\r\n{ "genre", "mpeg-audio.genre",\r\nFT_UINT32, BASE_DEC, VALS(mpeg_audio_T_genre_vals), 0,\r\nNULL, HFILL }},\r\n#line 149 "./asn1/mpeg-audio/packet-mpeg-audio-template.c"\r\n{ &hf_mpeg_audio_data,\r\n{ "Data", "mpeg-audio.data",\r\nFT_BYTES, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_mpeg_audio_padbytes,\r\n{ "Padding", "mpeg-audio.padbytes",\r\nFT_BYTES, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_id3v1,\r\n{ "ID3v1", "mpeg-audio.id3v1",\r\nFT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n{ &hf_id3v2,\r\n{ "ID3v2", "mpeg-audio.id3v2",\r\nFT_NONE, BASE_NONE, NULL, 0, NULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n#line 1 "./asn1/mpeg-audio/packet-mpeg-audio-ettarr.c"\r\n&ett_mpeg_audio_Audio,\r\n&ett_mpeg_audio_ID3v1,\r\n#line 166 "./asn1/mpeg-audio/packet-mpeg-audio-template.c"\r\n};\r\nproto_mpeg_audio = proto_register_protocol(\r\n"Moving Picture Experts Group Audio", "MPEG Audio", "mpeg-audio");\r\nproto_register_field_array(proto_mpeg_audio, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_mpeg_audio(void)\r\n{\r\nheur_dissector_add("mpeg", dissect_mpeg_audio, "MPEG Audio", "mpeg_audio", proto_mpeg_audio, HEURISTIC_ENABLE);\r\n}
