static int\r\ndissect_tte_pcf(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *tte_pcf_root_item;\r\nproto_tree *tte_pcf_tree;\r\nguint8 sync_priority = 0;\r\nguint8 sync_domain = 0;\r\nif (tvb_reported_length(tvb) < TTE_PCF_LENGTH )\r\n{\r\nreturn 0;\r\n}\r\nsync_priority = tvb_get_guint8(tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH);\r\nsync_domain = tvb_get_guint8(tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH+TTE_PCF_SP_LENGTH);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PCF");\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"Sync Domain: 0x%02X Sync Priority: 0x%02X",\r\nsync_domain, sync_priority);\r\nif (tree) {\r\ntte_pcf_root_item = proto_tree_add_item(tree, proto_tte_pcf, tvb, 0,\r\nTTE_PCF_LENGTH, ENC_NA);\r\ntte_pcf_tree = proto_item_add_subtree(tte_pcf_root_item, ett_tte_pcf);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_ic, tvb, 0, TTE_PCF_IC_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_mn, tvb, TTE_PCF_IC_LENGTH, TTE_PCF_MN_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_sp, tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH, TTE_PCF_SP_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_sd, tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH+TTE_PCF_SP_LENGTH, TTE_PCF_SD_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_type, tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH+TTE_PCF_SP_LENGTH+TTE_PCF_SD_LENGTH,\r\nTTE_PCF_TYPE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tte_pcf_tree,\r\nhf_tte_pcf_tc, tvb, TTE_PCF_IC_LENGTH+TTE_PCF_MN_LENGTH+\r\nTTE_PCF_RES0_LENGTH+TTE_PCF_SP_LENGTH+TTE_PCF_SD_LENGTH+\r\nTTE_PCF_TYPE_LENGTH+TTE_PCF_RES1_LENGTH, TTE_PCF_TC_LENGTH, ENC_BIG_ENDIAN);\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_tte_pcf(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_tte_pcf_ic,\r\n{ "Integration Cycle", "tte_pcf.ic",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_tte_pcf_mn,\r\n{ "Membership New", "tte_pcf.mn",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_tte_pcf_res0,\r\n{ "Reserved 0", "tte_pcf.res0",\r\nFT_UINT32, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_tte_pcf_sp,\r\n{ "Sync Priority", "tte_pcf.sp",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_tte_pcf_sd,\r\n{ "Sync Domain", "tte_pcf.sd",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n{ &hf_tte_pcf_type,\r\n{ "Type", "tte_pcf.type",\r\nFT_UINT8, BASE_HEX, VALS(pcf_type_str_vals), 0x0F,\r\nNULL, HFILL }\r\n},\r\n#if 0\r\n{ &hf_tte_pcf_res1,\r\n{ "Reserved 1", "tte_pcf.res1",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }\r\n},\r\n#endif\r\n{ &hf_tte_pcf_tc,\r\n{ "Transparent Clock", "tte_pcf.tc",\r\nFT_UINT64, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_tte_pcf\r\n};\r\nproto_tte_pcf = proto_register_protocol("TTEthernet Protocol Control Frame",\r\n"TTE PCF", "tte_pcf");\r\nproto_register_field_array(proto_tte_pcf, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("tte_pcf", dissect_tte_pcf, proto_tte_pcf);\r\n}\r\nvoid\r\nproto_reg_handoff_tte_pcf(void)\r\n{\r\ndissector_handle_t tte_pcf_handle;\r\ntte_pcf_handle = find_dissector("tte_pcf");\r\ndissector_add_uint("ethertype", ETHERTYPE_TTE_PCF, tte_pcf_handle);\r\n}
