static int\r\ndissect_wtls(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint offset = 0;\r\nchar pdut;\r\nguint count = 0;\r\nguint offset_wtls = 0;\r\nproto_item *ti;\r\nproto_tree *wtls_tree;\r\nproto_tree *wtls_rec_tree;\r\nproto_tree *wtls_msg_type_tree;\r\nswitch ( pinfo->match_uint )\r\n{\r\ncase UDP_PORT_WTLS_WSP:\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "WTLS+WSP" );\r\nbreak;\r\ncase UDP_PORT_WTLS_WTP_WSP:\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "WTLS+WTP+WSP" );\r\nbreak;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_INFO, "WTLS");\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_wtls, tvb, offset_wtls,\r\n-1, ENC_NA);\r\nwtls_tree = proto_item_add_subtree(ti, ett_wtls);\r\nfor (offset_wtls=0; offset_wtls < (tvb_reported_length(tvb)-1);) {\r\npdut = tvb_get_guint8 (tvb, offset_wtls);\r\noffset = offset_wtls+1;\r\nif (pdut & WTLS_RECORD_TYPE_SEQUENCE) {\r\noffset+=2;\r\n}\r\nif (pdut & WTLS_RECORD_TYPE_LENGTH) {\r\ncount = tvb_get_ntohs(tvb, offset);\r\noffset+=2;\r\ncount += offset-offset_wtls;\r\n}\r\nelse {\r\ncount = tvb_reported_length_remaining (tvb, offset_wtls);\r\n}\r\nti = proto_tree_add_uint(wtls_tree, hf_wtls_record, tvb, offset_wtls,\r\ncount, pdut);\r\nwtls_rec_tree = proto_item_add_subtree(ti, ett_wtls_rec);\r\noffset = offset_wtls;\r\nproto_tree_add_item (wtls_rec_tree, hf_wtls_record_type,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\noffset_wtls += count;\r\nif (pdut & WTLS_RECORD_TYPE_SEQUENCE) {\r\nproto_tree_add_item (wtls_rec_tree, hf_wtls_record_sequence,\r\ntvb,offset,2,ENC_BIG_ENDIAN);\r\noffset+=2;\r\n}\r\nif (pdut & WTLS_RECORD_TYPE_LENGTH) {\r\ncount = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item (wtls_rec_tree, hf_wtls_record_length,\r\ntvb,offset,2,ENC_BIG_ENDIAN);\r\noffset+=2;\r\n}\r\nelse {\r\ncount = tvb_reported_length_remaining (tvb, offset);\r\n}\r\nif (pdut & WTLS_RECORD_TYPE_CIPHER_CUR) {\r\nproto_tree_add_item (wtls_rec_tree, hf_wtls_record_ciphered,\r\ntvb,offset,count,ENC_NA);\r\ncontinue;\r\n}\r\nswitch (pdut & WTLS_RECORD_CONTENT_TYPE) {\r\ncase WTLS_PLAIN_HANDSHAKE :\r\ndissect_wtls_handshake(wtls_rec_tree,tvb,offset,count);\r\nbreak;\r\ncase WTLS_ALERT :\r\nti = proto_tree_add_item(wtls_rec_tree, hf_wtls_alert, tvb, offset,\r\ncount, ENC_NA);\r\nwtls_msg_type_tree = proto_item_add_subtree(ti, ett_wtls_msg_type);\r\nproto_tree_add_item (wtls_msg_type_tree, hf_wtls_alert_level,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset+=1;\r\nproto_tree_add_item (wtls_msg_type_tree, hf_wtls_alert_description,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\nadd_text_identifier(tvbuff_t *tvb, int offset, int hf_charset,\r\nint hf_size, int hf_str, proto_tree *tree)\r\n{\r\nguint8 size;\r\nint client_size = 0;\r\nproto_tree_add_item(tree, hf_charset, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset+=2;\r\nsize = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(tree, hf_size, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(tree, hf_str, tvb, offset, size, ENC_BIG_ENDIAN);\r\nclient_size+=size+3;\r\n#ifdef DEBUG\r\nfprintf(stderr, "text id size = %d, client_size = %d\n",\r\nsize, client_size);\r\n#endif\r\nreturn client_size;\r\n}\r\nstatic int\r\nadd_session_id(proto_tree *tree, int hf, int hf_str, tvbuff_t *tvb, int offset)\r\n{\r\nguint count;\r\nguint i;\r\nguint64 session_id;\r\ncount = tvb_get_guint8(tvb, offset);\r\nif (count == 0)\r\nproto_tree_add_string (tree, hf_str, tvb, offset, count+1, "NULL");\r\nelse if (count <= 8) {\r\nsession_id = 0;\r\nfor (i = 0; i < count; i++)\r\nsession_id = (session_id << 8) | tvb_get_guint8(tvb, offset + i);\r\nproto_tree_add_uint64 (tree, hf, tvb, offset, count+1, session_id);\r\n} else {\r\nproto_tree_add_item(tree, hf, tvb, offset, count+1, ENC_NA);\r\n}\r\nreturn offset+1+count;\r\n}\r\nstatic void\r\ndissect_wtls_handshake(proto_tree *tree, tvbuff_t *tvb, guint offset, guint count)\r\n{\r\nchar pdu_msg_type;\r\nnstime_t timeValue;\r\nint client_size = 0;\r\nguint value = 0;\r\nint size = 0;\r\nguint public_key = 0;\r\nchar valStr[1024];\r\nconst char *valBulk = NULL;\r\nconst char *valMac = NULL;\r\nproto_item *ti;\r\nproto_item *cli_key_item;\r\nproto_tree *wtls_msg_type_tree;\r\nproto_tree *wtls_msg_type_item_tree;\r\nproto_tree *wtls_msg_type_item_sub_tree;\r\nproto_tree *wtls_msg_type_item_sub_sub_tree;\r\npdu_msg_type = tvb_get_guint8 (tvb, offset);\r\nti = proto_tree_add_uint(tree, hf_wtls_hands, tvb, offset,count, pdu_msg_type);\r\nwtls_msg_type_tree = proto_item_add_subtree(ti, ett_wtls_msg_type);\r\nproto_tree_add_item (wtls_msg_type_tree, hf_wtls_hands_type,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset+=1;\r\ncount = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_item (wtls_msg_type_tree, hf_wtls_hands_length,\r\ntvb,offset,2,ENC_BIG_ENDIAN);\r\noffset+=2;\r\nswitch(pdu_msg_type) {\r\ncase WTLS_HANDSHAKE_CLIENT_HELLO :\r\nti = proto_tree_add_item(wtls_msg_type_tree, hf_wtls_hands_cli_hello, tvb, offset,\r\ncount, ENC_NA);\r\nwtls_msg_type_item_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item);\r\nproto_tree_add_item (wtls_msg_type_item_tree, hf_wtls_hands_cli_hello_version,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\ntimeValue.secs = tvb_get_ntohl (tvb, offset);\r\ntimeValue.nsecs = 0;\r\nproto_tree_add_time (wtls_msg_type_item_tree, hf_wtls_hands_cli_hello_gmt, tvb,\r\noffset, 4, &timeValue);\r\noffset+=4;\r\nproto_tree_add_item (wtls_msg_type_item_tree, hf_wtls_hands_cli_hello_random,\r\ntvb,offset,12,ENC_NA);\r\noffset+=12;\r\noffset = add_session_id (wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_session,\r\nhf_wtls_hands_cli_hello_session_str,\r\ntvb, offset);\r\ncount = tvb_get_ntohs (tvb, offset);\r\nti = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_cli_key_id, tvb, offset,\r\ncount+2, ENC_NA);\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item_sub);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_cli_key_len,\r\ntvb,offset,2,ENC_BIG_ENDIAN);\r\noffset+=2;\r\nfor (;count > 0;count-=client_size) {\r\nvalue = tvb_get_guint8 (tvb, offset);\r\ncli_key_item = proto_tree_add_uint(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_key_exchange, tvb, offset,1,\r\nvalue);\r\nclient_size=1;\r\nwtls_msg_type_item_sub_sub_tree = proto_item_add_subtree(cli_key_item,\r\nett_wtls_msg_type_item_sub_sub);\r\nproto_tree_add_uint(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_exchange_suite,\r\ntvb,offset,1,value);\r\noffset++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "encryption suite = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_parameter_index,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nclient_size++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "parameter index = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nif (value == 0xff) {\r\nsize = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_parameter_set,\r\ntvb,offset,size+2,ENC_ASCII|ENC_NA);\r\noffset+=size+2;\r\nclient_size+=size+2;\r\n}\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_type,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nclient_size++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "identifier type = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nswitch(value) {\r\ncase IDENTIFIER_TEXT :\r\nsize = add_text_identifier(\r\ntvb, offset,\r\nhf_wtls_hands_cli_hello_key_identifier_charset,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\nhf_wtls_hands_cli_hello_key_identifier_str,\r\nwtls_msg_type_item_sub_sub_tree);\r\noffset += size;\r\nclient_size += size;\r\nbreak;\r\ncase IDENTIFIER_BIN :\r\nsize = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,size,ENC_NA);\r\noffset+=size;\r\nclient_size+=size+1;\r\n#ifdef DEBUG\r\nfprintf(stderr, "binary id size = %d, client_size = %d\n",\r\nsize, client_size);\r\n#endif\r\nbreak;\r\ncase IDENTIFIER_SHA_1 :\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,20,ENC_NA);\r\noffset+=20;\r\nclient_size+=20;\r\n#ifdef DEBUG\r\nfprintf(stderr, "SHA-1 hash size = 20, client_size = %d\n",\r\nclient_size);\r\n#endif\r\nbreak;\r\ncase IDENTIFIER_X509 :\r\nsize = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,size,ENC_NA);\r\noffset+=size;\r\nclient_size+=size+1;\r\n#ifdef DEBUG\r\nfprintf(stderr, "X.509 name size = %d, client_size = %d\n",\r\nsize, client_size);\r\n#endif\r\nbreak;\r\n}\r\nproto_item_set_len(cli_key_item, client_size);\r\n}\r\ncount = tvb_get_ntohs (tvb, offset);\r\nti = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_trust_key_id, tvb, offset,\r\ncount+2, ENC_NA);\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item_sub);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_cli_key_len,\r\ntvb,offset,2,ENC_BIG_ENDIAN);\r\noffset+=2;\r\nfor (;count > 0;count-=client_size) {\r\nvalue = tvb_get_guint8 (tvb, offset);\r\ncli_key_item = proto_tree_add_uint(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_key_exchange, tvb, offset,1,\r\nvalue);\r\nclient_size=1;\r\nwtls_msg_type_item_sub_sub_tree = proto_item_add_subtree(cli_key_item,\r\nett_wtls_msg_type_item_sub_sub);\r\nproto_tree_add_uint(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_exchange_suite,\r\ntvb,offset,1,value);\r\noffset++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "encryption suite = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_parameter_index,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nclient_size++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "parameter index = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nif (value == 0xff) {\r\nsize = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_parameter_set,\r\ntvb,offset,size+2,ENC_ASCII|ENC_NA);\r\noffset+=size+2;\r\nclient_size+=size+2;\r\n}\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_type,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nclient_size++;\r\n#ifdef DEBUG\r\nfprintf(stderr, "identifier type = %d, client_size = %d\n", value, client_size);\r\n#endif\r\nswitch (value) {\r\ncase IDENTIFIER_TEXT :\r\nsize = add_text_identifier(\r\ntvb, offset,\r\nhf_wtls_hands_cli_hello_key_identifier_charset,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\nhf_wtls_hands_cli_hello_key_identifier_str,\r\nwtls_msg_type_item_sub_sub_tree);\r\noffset += size;\r\nclient_size += size;\r\nbreak;\r\ncase IDENTIFIER_BIN :\r\nsize = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,size,ENC_NA);\r\noffset+=size;\r\nclient_size+=size+1;\r\n#ifdef DEBUG\r\nfprintf(stderr, "binary id size = %d, client_size = %d\n",\r\nsize, client_size);\r\n#endif\r\nbreak;\r\ncase IDENTIFIER_SHA_1 :\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,20,ENC_NA);\r\noffset+=20;\r\nclient_size+=20;\r\n#ifdef DEBUG\r\nfprintf(stderr, "SHA-1 hash size = 20, client_size = %d\n",\r\nclient_size);\r\n#endif\r\nbreak;\r\ncase IDENTIFIER_X509 :\r\nsize = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier_size,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_sub_tree,\r\nhf_wtls_hands_cli_hello_key_identifier,\r\ntvb,offset,size,ENC_NA);\r\noffset+=size;\r\nclient_size+=size+1;\r\n#ifdef DEBUG\r\nfprintf(stderr, "X.509 name size = %d, client_size = %d\n",\r\nsize, client_size);\r\n#endif\r\nbreak;\r\n}\r\nproto_item_set_len(cli_key_item, client_size);\r\n}\r\ncount = tvb_get_guint8 (tvb, offset);\r\nti = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_cipher_suite, tvb, offset,\r\ncount+1, ENC_NA);\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item_sub);\r\noffset+=1;\r\nfor (;count > 0;count-=client_size) {\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nvalBulk = try_val_to_str_ext(value, &wtls_vals_cipher_bulk_ext);\r\noffset++;\r\nclient_size=1;\r\nvalMac = try_val_to_str_ext(tvb_get_guint8 (tvb, offset), &wtls_vals_cipher_mac_ext);\r\nif (valBulk != NULL)\r\n{\r\nif (valMac != NULL)\r\n{\r\ng_snprintf(valStr,1024,"%s, %s",valBulk,valMac);\r\n}\r\nelse\r\n{\r\ng_snprintf(valStr,1024,"%s, Unknown MAC (0x%02x)",valBulk,tvb_get_guint8 (tvb, offset));\r\n}\r\n}\r\nelse\r\n{\r\nif (valMac != NULL)\r\n{\r\ng_snprintf(valStr,1024,"Unknown Bulk (0x%02x), %s",value,valMac);\r\n}\r\nelse\r\n{\r\ng_snprintf(valStr,1024,"Unknown Bulk (0x%02x), Unknown MAC (0x%02x)",value,\r\ntvb_get_guint8 (tvb, offset));\r\n}\r\n}\r\noffset++;\r\nclient_size++;\r\nproto_tree_add_string(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_cipher_suite_item, tvb, offset-2,2,\r\nvalStr);\r\n}\r\ncount = tvb_get_guint8 (tvb, offset);\r\nti = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_compression_methods, tvb, offset,\r\ncount+1, ENC_NA);\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item_sub);\r\noffset+=1;\r\nfor (;count > 0;count-=client_size) {\r\nclient_size=0;\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_cli_hello_compression, tvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\n}\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_sequence_mode, tvb, offset,\r\n1, ENC_LITTLE_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_cli_hello_key_refresh, tvb, offset,\r\n1, ENC_LITTLE_ENDIAN);\r\nbreak;\r\ncase WTLS_HANDSHAKE_SERVER_HELLO :\r\nti = proto_tree_add_item(wtls_msg_type_tree, hf_wtls_hands_serv_hello, tvb, offset,\r\ncount, ENC_NA);\r\nwtls_msg_type_item_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item);\r\nproto_tree_add_item (wtls_msg_type_item_tree, hf_wtls_hands_serv_hello_version,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\ntimeValue.secs = tvb_get_ntohl (tvb, offset);\r\ntimeValue.nsecs = 0;\r\nproto_tree_add_time (wtls_msg_type_item_tree, hf_wtls_hands_serv_hello_gmt, tvb,\r\noffset, 4, &timeValue);\r\noffset+=4;\r\nproto_tree_add_item (wtls_msg_type_item_tree, hf_wtls_hands_serv_hello_random,\r\ntvb,offset,12,ENC_NA);\r\noffset+=12;\r\noffset = add_session_id (wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_session,\r\nhf_wtls_hands_serv_hello_session_str,\r\ntvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_cli_key_id,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\ncli_key_item = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_cipher_suite_item, tvb, offset,2,\r\nENC_NA);\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(cli_key_item,\r\nett_wtls_msg_type_item_sub);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_serv_hello_cipher_bulk,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_serv_hello_cipher_mac,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_compression, tvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_sequence_mode, tvb, offset,\r\n1, ENC_LITTLE_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_serv_hello_key_refresh, tvb, offset,\r\n1, ENC_LITTLE_ENDIAN);\r\noffset++;\r\nbreak;\r\ncase WTLS_HANDSHAKE_CERTIFICATE :\r\nti = proto_tree_add_item(wtls_msg_type_tree, hf_wtls_hands_certificates,\r\ntvb, offset,count, ENC_NA);\r\nwtls_msg_type_item_tree = proto_item_add_subtree(ti, ett_wtls_msg_type_item);\r\ncount = tvb_get_ntohs (tvb, offset);\r\noffset+=2;\r\nfor (;count > 0;count-=client_size) {\r\ncli_key_item = proto_tree_add_item(wtls_msg_type_item_tree,\r\nhf_wtls_hands_certificate, tvb, offset,1,\r\nENC_NA);\r\nclient_size=0;\r\nwtls_msg_type_item_sub_tree = proto_item_add_subtree(cli_key_item,\r\nett_wtls_msg_type_item_sub);\r\nproto_item_set_len(cli_key_item, client_size);\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_type, tvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nswitch(value) {\r\ncase CERTIFICATE_WTLS:\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_version,\r\ntvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_signature_type,\r\ntvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_issuer_type,\r\ntvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nswitch (value) {\r\ncase IDENTIFIER_NULL :\r\nbreak;\r\ncase IDENTIFIER_TEXT :\r\nvalue = add_text_identifier(tvb, offset,\r\nhf_wtls_hands_certificate_wtls_issuer_charset,\r\nhf_wtls_hands_certificate_wtls_issuer_size,\r\nhf_wtls_hands_certificate_wtls_issuer_name,\r\nwtls_msg_type_item_sub_tree);\r\noffset += value;\r\nclient_size += value;\r\nbreak;\r\ncase IDENTIFIER_BIN :\r\nbreak;\r\ncase IDENTIFIER_SHA_1 :\r\nbreak;\r\ncase IDENTIFIER_X509 :\r\nbreak;\r\n}\r\ntimeValue.secs = tvb_get_ntohl (tvb, offset);\r\ntimeValue.nsecs = 0;\r\nproto_tree_add_time (wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_valid_not_before,\r\ntvb, offset, 4, &timeValue);\r\noffset+=4;\r\nclient_size+=4;\r\ntimeValue.secs = tvb_get_ntohl (tvb, offset);\r\ntimeValue.nsecs = 0;\r\nproto_tree_add_time (wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_valid_not_after,\r\ntvb, offset, 4, &timeValue);\r\noffset+=4;\r\nclient_size+=4;\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_subject_type,\r\ntvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nswitch (value) {\r\ncase IDENTIFIER_NULL :\r\nbreak;\r\ncase IDENTIFIER_TEXT :\r\nvalue = add_text_identifier(tvb, offset,\r\nhf_wtls_hands_certificate_wtls_subject_charset,\r\nhf_wtls_hands_certificate_wtls_subject_size,\r\nhf_wtls_hands_certificate_wtls_subject_name,\r\nwtls_msg_type_item_sub_tree);\r\noffset += value;\r\nclient_size += value;\r\nbreak;\r\ncase IDENTIFIER_BIN :\r\nbreak;\r\ncase IDENTIFIER_SHA_1 :\r\nbreak;\r\ncase IDENTIFIER_X509 :\r\nbreak;\r\n}\r\npublic_key = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_public_key_type,\r\ntvb, offset,1,\r\nENC_LITTLE_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nvalue = tvb_get_guint8 (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_key_parameter_index,\r\ntvb,offset,1,ENC_BIG_ENDIAN);\r\noffset++;\r\nclient_size++;\r\nif (value == 0xff) {\r\nsize = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_item(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_key_parameter_set,\r\ntvb,offset,size+2,ENC_ASCII|ENC_NA);\r\noffset+=size+2;\r\nclient_size+=size+2;\r\n}\r\nswitch (public_key) {\r\ncase PUBLIC_KEY_RSA :\r\nvalue = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_uint(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_rsa_exponent,\r\ntvb,offset,value+2,value*8);\r\noffset+=2+value;\r\nclient_size+=2+value;\r\nvalue = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_uint(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_rsa_modules,\r\ntvb,offset,value+2,value*8);\r\noffset+=2+value;\r\nclient_size+=2+value;\r\nbreak;\r\ncase PUBLIC_KEY_ECDH :\r\nbreak;\r\ncase PUBLIC_KEY_ECDSA :\r\nbreak;\r\n}\r\nvalue = tvb_get_ntohs (tvb, offset);\r\nproto_tree_add_uint(wtls_msg_type_item_sub_tree,\r\nhf_wtls_hands_certificate_wtls_signature,\r\ntvb,offset,2+value,value*8);\r\noffset+=2+value;\r\nclient_size+=2+value;\r\nbreak;\r\ncase CERTIFICATE_X509:\r\ncase CERTIFICATE_X968:\r\nvalue = tvb_get_ntohs (tvb, offset);\r\noffset+=2;\r\nclient_size+=2;\r\nclient_size += value;\r\noffset += value;\r\nbreak;\r\ncase CERTIFICATE_URL:\r\nvalue = tvb_get_guint8 (tvb, offset);\r\noffset++;\r\nclient_size++;\r\nclient_size += value;\r\noffset += value;\r\nbreak;\r\n}\r\nproto_item_set_len(cli_key_item, client_size);\r\n}\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nvoid\r\nproto_register_wtls(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_wtls_record,\r\n{ "Record",\r\n"wtls.record",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_record_type_ext, 0x0f,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_record_type,\r\n{ "Record Type",\r\n"wtls.rec_type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_record_type_ext, 0x0f,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_record_length,\r\n{ "Record Length",\r\n"wtls.rec_length",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_record_sequence,\r\n{ "Record Sequence",\r\n"wtls.rec_seq",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_record_ciphered,\r\n{ "Record Ciphered",\r\n"wtls.rec_cipher",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands,\r\n{ "Handshake",\r\n"wtls.handshake",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_handshake_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_type,\r\n{ "Type",\r\n"wtls.handshake.type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_handshake_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_length,\r\n{ "Length",\r\n"wtls.handshake.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello,\r\n{ "Client Hello",\r\n"wtls.handshake.client_hello",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_version,\r\n{ "Version",\r\n"wtls.handshake.client_hello.version",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_gmt,\r\n{ "Time GMT",\r\n"wtls.handshake.client_hello.gmt",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_random,\r\n{ "Random",\r\n"wtls.handshake.client_hello.random",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_session,\r\n{ "Session ID",\r\n"wtls.handshake.client_hello.sessionid",\r\nFT_UINT64, BASE_HEX_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_session_str,\r\n{ "Session ID",\r\n"wtls.handshake.client_hello.session.str",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_cli_key_id,\r\n{ "Client Keys",\r\n"wtls.handshake.client_hello.client_keys_id",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL , HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_cli_key_len,\r\n{ "Length",\r\n"wtls.handshake.client_hello.client_keys_len",\r\nFT_UINT16, BASE_DEC, NULL, 0x00,\r\nNULL , HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_trust_key_id,\r\n{ "Trusted Keys",\r\n"wtls.handshake.client_hello.trusted_keys_id",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL , HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_exchange,\r\n{ "Key Exchange",\r\n"wtls.handshake.client_hello.key.key_exchange",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_key_exchange_suite_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_exchange_suite,\r\n{ "Suite",\r\n"wtls.handshake.client_hello.key.key_exchange.suite",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_key_exchange_suite_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_parameter_index,\r\n{ "Parameter Index",\r\n"wtls.handshake.client_hello.parameter_index",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_parameter_set,\r\n{ "Parameter Set",\r\n"wtls.handshake.client_hello.parameter",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_identifier_type,\r\n{ "Identifier Type",\r\n"wtls.handshake.client_hello.ident_type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_identifier_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_identifier_charset,\r\n{ "Identifier CharSet",\r\n"wtls.handshake.client_hello.ident_charset",\r\nFT_UINT16, BASE_DEC|BASE_EXT_STRING, &mibenum_vals_character_sets_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_identifier_size,\r\n{ "Identifier Size",\r\n"wtls.handshake.client_hello.ident_size",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_identifier,\r\n{ "Identifier",\r\n"wtls.handshake.client_hello.identifier",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_identifier_str,\r\n{ "Identifier Name",\r\n"wtls.handshake.client_hello.ident_name",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_cipher_suite,\r\n{ "Cipher Suites",\r\n"wtls.handshake.client_hello.ciphers",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\n"Cipher Suite", HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_cipher_suite_item,\r\n{ "Cipher",\r\n"wtls.handshake.client_hello.cipher",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_compression_methods,\r\n{ "Compression Methods",\r\n"wtls.handshake.client_hello.comp_methods",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_compression,\r\n{ "Compression",\r\n"wtls.handshake.client_hello.compression",\r\nFT_UINT8, BASE_HEX, VALS ( wtls_vals_compression ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_sequence_mode,\r\n{ "Sequence Mode",\r\n"wtls.handshake.client_hello.sequence_mode",\r\nFT_UINT8, BASE_DEC, VALS ( wtls_vals_sequence_mode ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_cli_hello_key_refresh,\r\n{ "Refresh",\r\n"wtls.handshake.client_hello.refresh",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello,\r\n{ "Server Hello",\r\n"wtls.handshake.server_hello",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_version,\r\n{ "Version",\r\n"wtls.handshake.server_hello.version",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_gmt,\r\n{ "Time GMT",\r\n"wtls.handshake.server_hello.gmt",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_random,\r\n{ "Random",\r\n"wtls.handshake.server_hello.random",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_session,\r\n{ "Session ID",\r\n"wtls.handshake.server_hello.sessionid",\r\nFT_UINT64, BASE_HEX_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_session_str,\r\n{ "Session ID",\r\n"wtls.handshake.server_hello.session.str",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_cli_key_id,\r\n{ "Client Key ID",\r\n"wtls.handshake.server_hello.key",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_cipher_suite_item,\r\n{ "Cipher",\r\n"wtls.handshake.server_hello.cipher",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_cipher_bulk,\r\n{ "Cipher Bulk",\r\n"wtls.handshake.server_hello.cipher.bulk",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_cipher_bulk_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_cipher_mac,\r\n{ "Cipher MAC",\r\n"wtls.handshake.server_hello.cipher.mac",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_cipher_mac_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_compression,\r\n{ "Compression",\r\n"wtls.handshake.server_hello.compression",\r\nFT_UINT8, BASE_HEX, VALS ( wtls_vals_compression ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_sequence_mode,\r\n{ "Sequence Mode",\r\n"wtls.handshake.server_hello.sequence_mode",\r\nFT_UINT8, BASE_DEC, VALS ( wtls_vals_sequence_mode ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_serv_hello_key_refresh,\r\n{ "Refresh",\r\n"wtls.handshake.server_hello.refresh",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificates,\r\n{ "Certificates",\r\n"wtls.handshake.certificates",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate,\r\n{ "Certificate",\r\n"wtls.handshake.certificate",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_type,\r\n{ "Type",\r\n"wtls.handshake.certificate.type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_certificate_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_version,\r\n{ "Version",\r\n"wtls.handshake.certificate.version",\r\nFT_UINT8, BASE_HEX, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_signature_type,\r\n{ "Signature Type",\r\n"wtls.handshake.certificate.signature.type",\r\nFT_UINT8, BASE_DEC, VALS ( wtls_vals_certificate_signature ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_signature,\r\n{ "Signature Size",\r\n"wtls.handshake.certificate.signature.signature",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_issuer_type,\r\n{ "Issuer",\r\n"wtls.handshake.certificate.issuer.type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_identifier_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_issuer_charset,\r\n{ "Charset",\r\n"wtls.handshake.certificate.issuer.charset",\r\nFT_UINT16, BASE_DEC|BASE_EXT_STRING, &mibenum_vals_character_sets_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_issuer_size,\r\n{ "Size",\r\n"wtls.handshake.certificate.issuer.size",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_issuer_name,\r\n{ "Name",\r\n"wtls.handshake.certificate.issuer.name",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_valid_not_before,\r\n{ "Valid not before",\r\n"wtls.handshake.certificate.before",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_valid_not_after,\r\n{ "Valid not after",\r\n"wtls.handshake.certificate.after",\r\nFT_ABSOLUTE_TIME, ABSOLUTE_TIME_LOCAL, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_subject_type,\r\n{ "Subject",\r\n"wtls.handshake.certificate.subject.type",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_identifier_type_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_subject_charset,\r\n{ "Charset",\r\n"wtls.handshake.certificate.subject.charset",\r\nFT_UINT16, BASE_DEC|BASE_EXT_STRING, &mibenum_vals_character_sets_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_subject_size,\r\n{ "Size",\r\n"wtls.handshake.certificate.subject.size",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_subject_name,\r\n{ "Name",\r\n"wtls.handshake.certificate.subject.name",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_public_key_type,\r\n{ "Public Key Type",\r\n"wtls.handshake.certificate.public.type",\r\nFT_UINT8, BASE_DEC, VALS ( wtls_vals_public_key_type ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_key_parameter_index,\r\n{ "Parameter Index",\r\n"wtls.handshake.certificate.parameter_index",\r\nFT_UINT8, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_key_parameter_set,\r\n{ "Parameter Set",\r\n"wtls.handshake.certificate.parameter",\r\nFT_STRING, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_rsa_exponent,\r\n{ "RSA Exponent Size",\r\n"wtls.handshake.certificate.rsa.exponent",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_hands_certificate_wtls_rsa_modules,\r\n{ "RSA Modulus Size",\r\n"wtls.handshake.certificate.rsa.modules",\r\nFT_UINT32, BASE_DEC, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_alert,\r\n{ "Alert",\r\n"wtls.alert",\r\nFT_NONE, BASE_NONE, NULL, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_alert_level,\r\n{ "Level",\r\n"wtls.alert.level",\r\nFT_UINT8, BASE_DEC, VALS ( wtls_vals_alert_level ), 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_wtls_alert_description,\r\n{ "Description",\r\n"wtls.alert.description",\r\nFT_UINT8, BASE_DEC|BASE_EXT_STRING, &wtls_vals_alert_description_ext, 0x00,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_wtls,\r\n&ett_wtls_rec,\r\n&ett_wtls_msg_type,\r\n&ett_wtls_msg_type_item,\r\n&ett_wtls_msg_type_item_sub,\r\n&ett_wtls_msg_type_item_sub_sub,\r\n};\r\nproto_wtls = proto_register_protocol(\r\n"Wireless Transport Layer Security",\r\n"WTLS",\r\n"wtls"\r\n);\r\nproto_register_field_array(proto_wtls, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_wtls(void)\r\n{\r\ndissector_handle_t wtls_handle;\r\nwtls_handle = create_dissector_handle(dissect_wtls, proto_wtls);\r\ndissector_add_uint("udp.port", UDP_PORT_WTLS_WSP, wtls_handle);\r\ndissector_add_uint("udp.port", UDP_PORT_WTLS_WTP_WSP, wtls_handle);\r\ndissector_add_uint("udp.port", UDP_PORT_WTLS_WSP_PUSH,wtls_handle);\r\n}
