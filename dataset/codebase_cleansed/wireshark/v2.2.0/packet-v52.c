static void\r\ndissect_v52_protocol_discriminator(tvbuff_t *tvb, int offset, proto_tree *tree)\r\n{\r\nunsigned int discriminator = tvb_get_guint8(tvb, offset);\r\nif (discriminator == 0x48) {\r\nproto_tree_add_uint_format_value(tree, hf_v52_discriminator, tvb, offset, 1, discriminator,\r\n"V5.2 (0x%02X)",\r\ndiscriminator);\r\n} else {\r\nproto_tree_add_uint_format_value(tree, hf_v52_discriminator,\r\ntvb, offset, 1, discriminator,\r\n"Reserved (0x%02X)",\r\ndiscriminator);\r\n}\r\n}\r\nstatic void\r\ndissect_pstn_sequence_number(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 pstn_sequence_number_tmp;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\npstn_sequence_number_tmp = tvb_get_guint8(info_tvb, info_offset+2)-0x80;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | SN: %u", pstn_sequence_number_tmp);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_pstn_sequence_number, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_cadenced_ring(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 cadenced_ring_tmp;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncadenced_ring_tmp = tvb_get_guint8(info_tvb, info_offset+2)-0x80;\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": %u", cadenced_ring_tmp);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_cadenced_ring, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_pulsed_signal(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\ncol_append_str(pinfo->cinfo, COL_INFO, ": ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset+2), &pulse_type_values_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_pulse_type, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nif (data_length > 3) {\r\nproto_tree_add_item(info_tree, hf_v52_suppression_indicator, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_pulse_duration, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\n}\r\nif (data_length > 4) {\r\nproto_tree_add_item(info_tree, hf_v52_ack_request_indicator, info_tvb, info_offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_number_of_pulses, info_tvb, info_offset+4, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_steady_signal(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\ncol_append_str(pinfo->cinfo, COL_INFO, ": ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, &steady_signal_values_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_steady_signal, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_digit_signal(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 buffer;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_digit_ack, info_tvb, info_offset+2, 1, ENC_NA);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+2)>>4;\r\nbuffer = buffer&0x03;\r\nproto_tree_add_item(info_tree, hf_v52_digit_spare, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_digit_info, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": %u", buffer);\r\n}\r\nstatic void\r\ndissect_recognition_time(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nguint8 buffer;\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+2)&0x7f;\r\nif (buffer >= 0x6b)\r\nproto_tree_add_item(info_tree, hf_v52_pulse_type, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nelse if (buffer <= 0x1a)\r\nproto_tree_add_item(info_tree, hf_v52_steady_signal, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_duration_type, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_enable_auto_ack(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nguint8 buffer;\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+2)&0x7f;\r\nif (buffer >= 0x6b)\r\nproto_tree_add_item(info_tree, hf_v52_pulse_type, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nelse if (buffer <= 0x1a)\r\nproto_tree_add_item(info_tree, hf_v52_steady_signal, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+3)&0x7f;\r\nif (buffer >= 0x6b)\r\nproto_tree_add_item(info_tree, hf_v52_pulse_type, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\nelse if (buffer <= 0x1a)\r\nproto_tree_add_item(info_tree, hf_v52_steady_signal, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+4)) {\r\nproto_tree_add_item(info_tree, hf_v52_suppression_indicator, info_tvb, info_offset+4, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_pulse_duration, info_tvb, info_offset+4, 1, ENC_BIG_ENDIAN);\r\n}\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+5)) {\r\nproto_tree_add_item(info_tree, hf_v52_ack_request_indicator, info_tvb, info_offset+5, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_number_of_pulses, info_tvb, info_offset+5, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_disable_auto_ack(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nguint8 buffer;\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+2)&0x7f;\r\nif (buffer >= 0x6b)\r\nproto_tree_add_item(info_tree, hf_v52_pulse_type, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nelse if (buffer <= 0x1a)\r\nproto_tree_add_item(info_tree, hf_v52_steady_signal, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_cause(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\ncol_append_str(pinfo->cinfo, COL_INFO, ": ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, cause_type_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_cause_type, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+3))\r\nproto_tree_add_uint_format(info_tree, hf_v52_msg_type, info_tvb, info_offset+3, 1, tvb_get_guint8(info_tvb, info_offset+3),\r\n"Diagnostic: %s", val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset+3), &msg_type_values_ext, "unknown"));\r\n}\r\n}\r\nstatic void\r\ndissect_resource_unavailable(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_res_unavailable, info_tvb, info_offset+2, info_element_length, ENC_ASCII|ENC_NA);\r\n}\r\n}\r\nstatic void\r\ndissect_pulse_notification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_pulse_notification, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_line_information(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_line_info, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_state(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_state, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_auto_sig_sequence(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_auto_signalling_sequence, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_sequence_response(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_sequence_response, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_control_function_element(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nif (message_type_tmp != 0x11) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, control_function_element_values, "Unknown element"));\r\n}\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_control_function_element, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_control_function_id(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nif (message_type_tmp != 0x13) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, &control_function_id_values_short_ext, "Unknown layer3 element"));\r\n}\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_control_function_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_variant(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 variantValue;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nvariantValue = tvb_get_guint8(info_tvb, info_offset+2)-0x80;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | Var: %u", variantValue);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_variant, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_interface_id(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 interfaceAllIdValue;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ninterfaceAllIdValue = (tvb_get_guint8(info_tvb, info_offset+2)<<16)+(tvb_get_guint8(info_tvb, info_offset+3)<<8)+(tvb_get_guint8(info_tvb, info_offset+4));\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | Intf. ID: %u", interfaceAllIdValue);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_if_up_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_if_id, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_if_low_id, info_tvb, info_offset+4, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_if_all_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_sequence_number(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 hf_v52_sequence_number_tmp;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(info_tvb, info_offset), &info_element_values_short_ext, "Unknown element"));\r\nhf_v52_sequence_number_tmp = tvb_get_guint8(info_tvb, info_offset+2)-0x80;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, ": %u", hf_v52_sequence_number_tmp);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_sequence_number, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_physical_c_channel_id(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | Phy C-ch: %u, %u", tvb_get_guint8(info_tvb, info_offset+2), tvb_get_guint8(info_tvb, info_offset+3));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_v5_link_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_v5_time_slot, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_pp_rejection_cause(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, rejection_cause_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_rejection_cause, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_protocol_error(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, error_cause_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_error_cause, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_diagnostic_msg, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_diagnostic_element, info_tvb, info_offset+4, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_performance_grading(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset)-0xe0, performance_grading_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_performance_grading, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_cp_rejection_cause(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = 1;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset)-0xe0, cp_rejection_cause_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_cp_rejection_cause, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_user_port_identification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 buffer;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nbuffer = tvb_get_guint8(info_tvb, info_offset+2)&0x01;\r\nif (buffer == 0x01) {\r\nproto_tree_add_item(info_tree, hf_v52_pstn_user_port_id, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_pstn_user_port_id_lower, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | PSTN port: %u", (((tvb_get_guint8(info_tvb, info_offset+2)>>1)<<8)+(tvb_get_guint8(info_tvb, info_offset+3))));\r\n}\r\nelse if (buffer == 0x00) {\r\nproto_tree_add_item(info_tree, hf_v52_isdn_user_port_id, info_tvb, info_offset+2, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_isdn_user_port_id_lower, info_tvb, info_offset+3, 1, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | ISDN: %u", (((tvb_get_guint8(info_tvb, info_offset+2)>>2)<<7)+((tvb_get_guint8( info_tvb, info_offset+3)>>1))));\r\n}\r\n}\r\nstatic void\r\ndissect_isdn_port_time_slot_identification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 isdn_user_port_ts_num_tmp;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nisdn_user_port_ts_num_tmp = (tvb_get_guint8(info_tvb, info_offset+2)) - 128;\r\ncol_append_str(pinfo->cinfo, COL_INFO, ", ");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "%x", isdn_user_port_ts_num_tmp);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_isdn_user_port_ts_num, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_v5_time_slot_identification(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint8 v5_link_id_tmp;\r\nguint8 v5_time_slot_tmp;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nv5_link_id_tmp = tvb_get_guint8(info_tvb, info_offset+2);\r\nv5_time_slot_tmp = tvb_get_guint8(info_tvb, info_offset+3);\r\nif (v5_time_slot_tmp >= 64) {\r\nv5_time_slot_tmp = v5_time_slot_tmp - 64;\r\n}\r\nif (v5_time_slot_tmp >= 32) {\r\nv5_time_slot_tmp = v5_time_slot_tmp - 32;\r\n}\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | V5 Link: %u, %u ", v5_link_id_tmp, v5_time_slot_tmp);\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_v5_link_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_override, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_v5_time_slot, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_multi_slot_map(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | V5MSlink ID:%u", tvb_get_guint8(info_tvb, info_offset+2));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_v5_link_id, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+3))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+4))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+4, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+5))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+5, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+6))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+6, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+7))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+7, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+8))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+8, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+9))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+9, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+10))\r\nproto_tree_add_item(info_tree, hf_v52_v5_multi_slot_elements, info_tvb, info_offset+10, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_bcc_rejct_cause(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, reject_cause_type_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_reject_cause_type, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_bcc_protocol_error_cause(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, bcc_protocol_error_cause_type_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_bcc_protocol_error_cause, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+3))\r\nproto_tree_add_item(info_tree, hf_v52_diagnostic_message, info_tvb, info_offset+3, info_element_length, ENC_BIG_ENDIAN);\r\nif (tvb_reported_length_remaining(info_tvb, info_offset+4))\r\nproto_tree_add_item(info_tree, hf_v52_diagnostic_information, info_tvb, info_offset+4, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_connection_incomplete(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1)+2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2) & 0x80, connection_incomplete_reason_values, "Unknown element"));\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_connection_incomplete_reason, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_link_control_function(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_tree *info_tree;\r\nproto_item *ti_info;\r\nconst guint8 info_element_length = 1;\r\nguint8 info_element;\r\nguint16 data_length;\r\ntvbuff_t *info_tvb;\r\nconst int info_offset = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\ndata_length = tvb_get_guint8(tvb, offset+1) + 2;\r\ninfo_tvb = tvb_new_subset_length(tvb, offset, data_length);\r\ninfo_tree = proto_tree_add_subtree(tree, info_tvb, info_offset, -1, ett_v52_info, &ti_info, "Info Element:");\r\nif (message_type_tmp != 0x31) {\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_const(tvb_get_guint8(info_tvb, info_offset+2)-0x80, link_control_function_values, "Unknown element"));\r\n}\r\nif (info_tree != NULL) {\r\nproto_tree_add_item(info_tree, hf_v52_info_element, info_tvb, info_offset, info_element_length, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(info_tree, hf_v52_info_length, info_tvb, info_offset+1, info_element_length, ENC_BIG_ENDIAN);\r\nproto_item_append_text(ti_info, " %s (0x%x)", val_to_str_ext_const(info_element, &info_element_values_ext, "unknown info element"), info_element);\r\nproto_tree_add_item(info_tree, hf_v52_link_control_function, info_tvb, info_offset+2, info_element_length, ENC_BIG_ENDIAN);\r\n}\r\n}\r\nstatic void\r\ndissect_v52_info(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nint offset = 4;\r\nguint8 info_element, info_element_length;\r\nint singleoctet;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nsingleoctet = 0;\r\ninfo_element = tvb_get_guint8(tvb, offset);\r\nswitch (info_element) {\r\ncase PSTN_SEQUENCE_NUMBER:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_pstn_sequence_number(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase CADENCED_RINGING:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_cadenced_ring(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase PULSED_SIGNAL:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_pulsed_signal(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase STEADY_SIGNAL:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_steady_signal(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase DIGIT_SIGNAL:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_digit_signal(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase RECOGNITION_TIME:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_recognition_time(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase ENABLE_AUTO_ACK:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_enable_auto_ack(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase DISABLE_AUTO_ACK:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_disable_auto_ack(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase CAUSE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_cause(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase RESOURCE_UNAVAILABLE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_resource_unavailable(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase PULSE_NOTIFICATION:\r\ndissect_pulse_notification(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase LINE_INFORMATION:\r\ndissect_line_information(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase STATE:\r\ndissect_state(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase AUTO_SIG_SEQUENCE:\r\ndissect_auto_sig_sequence(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase SEQUENCE_RESPONSE:\r\ndissect_sequence_response(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase CONTROL_FUNCTION_ELEMENT:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_control_function_element(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase CONTROL_FUNCTION_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_control_function_id(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase VARIANT:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_variant(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase INTERFACE_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_interface_id(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase SEQUENCE_NUMBER:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_sequence_number(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase C_CHANNEL_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_physical_c_channel_id(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase PP_REJECTION_CAUSE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_pp_rejection_cause(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase PROTOCOL_ERROR:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_protocol_error(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase PERFORMANCE_GRADING:\r\ndissect_performance_grading(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase CP_REJECTION_CAUSE:\r\ndissect_cp_rejection_cause(tvb, pinfo, tree, offset);\r\nsingleoctet = 1;\r\nbreak;\r\ncase USER_PORT_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_user_port_identification(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase ISDN_PORT_TS_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_isdn_port_time_slot_identification(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase V5_TIME_SLOT_ID:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_v5_time_slot_identification(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase MULTI_SLOT_MAP:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_multi_slot_map(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase BCC_REJECT_CAUSE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_bcc_rejct_cause(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase BCC_PROTOCOL_ERROR_CAUSE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_bcc_protocol_error_cause(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase CONNECTION_INCOMPLETE:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_connection_incomplete(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ncase LINK_CONTROL_FUNCTION:\r\ninfo_element_length = tvb_get_guint8(tvb, offset+1);\r\ndissect_link_control_function(tvb, pinfo, tree, offset);\r\noffset += info_element_length+2;\r\nbreak;\r\ndefault:\r\noffset += 1;\r\nbreak;\r\n}\r\nif (singleoctet == 1) {\r\noffset += 1;\r\n}\r\n#if 0\r\nif (old_offset <= offset) {\r\nexpert_add_info_format(pinfo, NULL, PI_MALFORMED, PI_WARN, "Zero-length information element");\r\nreturn;\r\n}\r\n#endif\r\n}\r\n}\r\nstatic void\r\ndissect_v52_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nint offset = 0;\r\nproto_tree *v52_tree = NULL;\r\ngboolean addr = FALSE;\r\nguint8 bcc_all_address_tmp_up = -1;\r\nguint16 pstn_all_address_tmp, isdn_all_address_tmp, bcc_all_address_tmp;\r\nguint16 prot_all_address_tmp, link_all_address_tmp;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "V52");\r\nif (tree) {\r\nproto_item *ti;\r\nti = proto_tree_add_item(tree, proto_v52, tvb, offset, -1, ENC_NA);\r\nv52_tree = proto_item_add_subtree(ti, ett_v52);\r\ndissect_v52_protocol_discriminator(tvb, offset, v52_tree);\r\n}\r\n{\r\nmessage_type_tmp = tvb_get_guint8(tvb, MSG_TYPE_OFFSET);\r\nif ((message_type_tmp >= 0x00) && (message_type_tmp <= 0x0e)) {\r\naddr = TRUE;\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\npstn_all_address_tmp = (((tvb_get_guint8(tvb, ADDRESS_OFFSET)>>1)<<8)+(tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET)));\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | PSTN: %u", pstn_all_address_tmp);\r\n}\r\nif ((message_type_tmp >= 0x10) && (message_type_tmp <= 0x13)) {\r\naddr = TRUE;\r\nif ((tvb_get_guint8(tvb, ADDRESS_OFFSET)&0x01) == 0x1) {\r\npstn_all_address_tmp = (((tvb_get_guint8(tvb, ADDRESS_OFFSET)>>1)<<8)+(tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET)));\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | PSTN: %u", pstn_all_address_tmp);\r\n}\r\nelse {\r\nisdn_all_address_tmp = (((tvb_get_guint8(tvb, ADDRESS_OFFSET)>>2)<<7)+((tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET)>>1)));\r\nproto_tree_add_item(v52_tree, hf_v52_isdn_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_isdn_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | ISDN: %u", isdn_all_address_tmp);\r\n}\r\n}\r\nif ((message_type_tmp == 0x30) || (message_type_tmp == 0x31)) {\r\naddr = TRUE;\r\nlink_all_address_tmp = tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET);\r\nproto_tree_add_item(v52_tree, hf_v52_link_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_link_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | LinkId: %u", link_all_address_tmp);\r\n}\r\nif ((message_type_tmp >= 0x20) && (message_type_tmp <= 0x2a)) {\r\naddr = TRUE;\r\nproto_tree_add_item(v52_tree, hf_v52_bcc_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_bcc_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nbcc_all_address_tmp_up = tvb_get_guint8(tvb, ADDRESS_OFFSET);\r\nif (bcc_all_address_tmp_up >= 128) {\r\nbcc_all_address_tmp_up = bcc_all_address_tmp_up - 128;\r\n}\r\nbcc_all_address_tmp = (bcc_all_address_tmp_up<<6) + tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | ref: %u", bcc_all_address_tmp);\r\n}\r\nif ((message_type_tmp >= 0x18) && (message_type_tmp <= 0x1f)) {\r\naddr = TRUE;\r\nprot_all_address_tmp = (tvb_get_guint8(tvb, ADDRESS_OFFSET)<<8) + (tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET));\r\nproto_tree_add_item(v52_tree, hf_v52_prot_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_prot_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nif ((message_type_tmp == 0x1e) || (message_type_tmp == 0x1f)) {}\r\nelse {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | Log C-ch: %u", prot_all_address_tmp);\r\n}\r\n}\r\nif (addr == FALSE) {\r\nif ((tvb_get_guint8(tvb, ADDRESS_OFFSET)&0x01) == 0x1) {\r\npstn_all_address_tmp = (((tvb_get_guint8(tvb, ADDRESS_OFFSET)>>1)<<8)+(tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET)));\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_pstn_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | PSTN: %u", pstn_all_address_tmp);\r\n}\r\nelse {\r\nisdn_all_address_tmp = (((tvb_get_guint8(tvb, ADDRESS_OFFSET)>>2)<<7)+((tvb_get_guint8(tvb, LOW_ADDRESS_OFFSET)>>1)));\r\nproto_tree_add_item(v52_tree, hf_v52_isdn_address, tvb, ADDRESS_OFFSET, ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(v52_tree, hf_v52_isdn_low_address, tvb, LOW_ADDRESS_OFFSET, LOW_ADDRESS_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, " | ISDN: %u", isdn_all_address_tmp);\r\n}\r\n}\r\nproto_tree_add_item(v52_tree, hf_v52_msg_type, tvb, MSG_TYPE_OFFSET, MSG_TYPE_LENGTH, ENC_BIG_ENDIAN);\r\ncol_append_str(pinfo->cinfo, COL_INFO, " | ");\r\ncol_append_str(pinfo->cinfo, COL_INFO, val_to_str_ext_const(tvb_get_guint8(tvb, MSG_TYPE_OFFSET), &msg_type_values_short_ext, "Unknown msg type"));\r\ndissect_v52_info(tvb, pinfo, v52_tree);\r\n}\r\n}\r\nstatic int\r\ndissect_v52(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ndissect_v52_message(tvb, pinfo, tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_v52(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_v52_discriminator,\r\n{ "Protocol discriminator", "v52.disc", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n#if 0\r\n{ &hf_v52_address,\r\n{ "Address", "v52.address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n#endif\r\n#if 0\r\n{ &hf_v52_low_address,\r\n{ "Address Low", "v52.low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n#endif\r\n{ &hf_v52_isdn_address,\r\n{ "Address isdn", "v52.isdn_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xfc,\r\nNULL, HFILL } },\r\n{ &hf_v52_isdn_low_address,\r\n{ "Address isdn Low", "v52.isdn_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xfe,\r\nNULL, HFILL } },\r\n{ &hf_v52_pstn_address,\r\n{ "Address pstn", "v52.pstn_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xfe,\r\nNULL, HFILL } },\r\n{ &hf_v52_pstn_low_address,\r\n{ "Address pstn Low", "v52.pstn_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{ &hf_v52_link_address,\r\n{ "Address link", "v52.link_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{ &hf_v52_link_low_address,\r\n{ "Address link Low", "v52.link_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{ &hf_v52_bcc_address,\r\n{ "Address bcc", "v52.bcc_address",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{ &hf_v52_bcc_low_address,\r\n{ "Address bcc Low", "v52.bcc_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0x3f,\r\nNULL, HFILL } },\r\n{ &hf_v52_prot_address,\r\n{ "Address prot", "v52.prot_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{ &hf_v52_prot_low_address,\r\n{ "Address prot Low", "v52.prot_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n#if 0\r\n{ &hf_v52_ctrl_address,\r\n{ "Address ctrl", "v52.ctrl_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n#endif\r\n#if 0\r\n{ &hf_v52_ctrl_low_address,\r\n{ "Address ctrl Low", "v52.ctrl_low_address",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n#endif\r\n{&hf_v52_msg_type,\r\n{ "Message type", "v52.msg_type",\r\nFT_UINT8, BASE_HEX|BASE_EXT_STRING, &msg_type_values_ext, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_info_element,\r\n{ "Information element", "v52.info_element",\r\nFT_UINT8, BASE_HEX|BASE_EXT_STRING, &info_element_values_ext, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_info_length,\r\n{ "Information length", "v52.info_length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_pulse_notification,\r\n{ "Pulse notification", "v52.pulse_notification",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_pstn_sequence_number,\r\n{ "Sequence number", "v52.pstn_sequence_number",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_cadenced_ring,\r\n{ "Cadenced ring", "v52.cadenced_ring",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_pulse_type,\r\n{ "Pulse Type", "v52.pulse_type",\r\nFT_UINT8, BASE_HEX|BASE_EXT_STRING, &pulse_type_values_ext, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_suppression_indicator,\r\n{ "Suppression indicator", "v52.suppression_indicator",\r\nFT_UINT8, BASE_HEX, VALS(suppression_indication_values), 0x60,\r\nNULL, HFILL } },\r\n{&hf_v52_pulse_duration,\r\n{ "Pulse duration type", "v52.pulse_duration",\r\nFT_UINT8, BASE_HEX, NULL, 0x1f,\r\nNULL, HFILL } },\r\n{&hf_v52_ack_request_indicator,\r\n{ "Ack request indicator", "v52.ack_request_indicator",\r\nFT_UINT8, BASE_HEX, VALS(ack_request_indication_values), 0x60,\r\nNULL, HFILL } },\r\n{&hf_v52_number_of_pulses,\r\n{ "Number of pulses", "v52.number_of_pulses",\r\nFT_UINT8, BASE_DEC, NULL, 0x1f,\r\nNULL, HFILL } },\r\n{&hf_v52_steady_signal,\r\n{ "Steady Signal", "v52.steady_signal",\r\nFT_UINT8, BASE_HEX|BASE_EXT_STRING, &steady_signal_values_ext, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_digit_ack,\r\n{ "Digit ack request indication", "v52.digit_ack",\r\nFT_BOOLEAN, 8, TFS(&tfs_digit_ack_values), 0x40,\r\nNULL, HFILL } },\r\n{&hf_v52_digit_spare,\r\n{ "Digit spare", "v52.digit_spare",\r\nFT_UINT8, BASE_HEX, NULL, 0x30,\r\nNULL, HFILL } },\r\n{&hf_v52_digit_info,\r\n{ "Digit information", "v52.digit_info",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_duration_type,\r\n{ "Duration Type", "v52.duration_type",\r\nFT_UINT8, BASE_HEX, NULL, 0x3f,\r\nNULL, HFILL } },\r\n{&hf_v52_res_unavailable,\r\n{ "Resource unavailable", "v52.res_unavailable",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_line_info,\r\n{ "Line_Information", "v52.line_info",\r\nFT_UINT8, BASE_HEX, VALS(line_info_values), 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_state,\r\n{ "PSTN FSM state", "v52.state",\r\nFT_UINT8, BASE_HEX, VALS(state_values), 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_auto_signalling_sequence,\r\n{ "Autonomous signalling sequence", "v52.auto_signalling_sequence",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_sequence_response,\r\n{ "Sequence response", "v52.sequence_response",\r\nFT_UINT8, BASE_HEX, NULL, 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_control_function_element,\r\n{ "Control function element", "v52.control_function_element",\r\nFT_UINT8, BASE_HEX, VALS(control_function_element_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_control_function_id,\r\n{ "Control function ID", "v52.control_function",\r\nFT_UINT8, BASE_HEX|BASE_EXT_STRING, &control_function_id_values_ext, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_variant,\r\n{ "Variant", "v52.variant",\r\nFT_UINT8, BASE_DEC, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_if_up_id,\r\n{ "Interface up ID", "v52.interface_up_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_if_id,\r\n{ "Interface ID", "v52.interface_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_if_low_id,\r\n{ "Interface down ID", "v52.interface_low_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_if_all_id,\r\n{ "Interface all ID", "v52.interface_all_id",\r\nFT_UINT24, BASE_DEC, NULL, 0xffffff,\r\nNULL, HFILL } },\r\n{&hf_v52_sequence_number,\r\n{ "Sequence number", "v52.sequence_number",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_v5_link_id,\r\n{ "V5 2048 kbit/s Link Identifier", "v52.V5_ln_id",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_v5_multi_slot_elements,\r\n{ "Additional MS ID", "v52.add_ms_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_v5_time_slot,\r\n{ "V5 Time Slot Number", "v52.v5_time_slot",\r\nFT_UINT8, BASE_DEC, NULL, 0x1f,\r\nNULL, HFILL } },\r\n{&hf_v52_rejection_cause,\r\n{ "Rejection cause", "v52.rejection_cause",\r\nFT_UINT8, BASE_HEX, VALS(rejection_cause_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_error_cause,\r\n{ "Protocol Error Cause type", "v52.error_cause",\r\nFT_UINT8, BASE_HEX, VALS(error_cause_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_diagnostic_msg,\r\n{ "Diagnostic message", "v52.diagnostic_message",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_diagnostic_element,\r\n{ "Diagnostic element", "v52.diagnostic_element",\r\nFT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_performance_grading,\r\n{ "Performance grading", "v52.performance_grading",\r\nFT_UINT8, BASE_HEX, VALS(performance_grading_values), 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_cp_rejection_cause,\r\n{ "Rejection cp cause", "v52.cp_rejection_cause",\r\nFT_UINT8, BASE_HEX, VALS(cp_rejection_cause_values), 0x0f,\r\nNULL, HFILL } },\r\n{&hf_v52_pstn_user_port_id,\r\n{ "PSTN User Port identification Value", "v52.pstn_user_port_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xfe,\r\nNULL, HFILL } },\r\n{&hf_v52_pstn_user_port_id_lower,\r\n{ "PSTN User Port Identification Value (lower)", "v52.pstn_user_port_id_lower",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_isdn_user_port_id,\r\n{ "ISDN User Port Identification Value", "v52.isdn_user_port_id",\r\nFT_UINT8, BASE_HEX, NULL, 0xfc,\r\nNULL, HFILL } },\r\n{&hf_v52_isdn_user_port_id_lower,\r\n{ "ISDN User Port Identification Value (lower)", "v52.user_port_id_lower",\r\nFT_UINT8, BASE_HEX, NULL, 0xfe,\r\nNULL, HFILL } },\r\n{&hf_v52_isdn_user_port_ts_num,\r\n{ "ISDN user port time slot number", "v52.isdn_user_port_ts_num",\r\nFT_UINT8, BASE_HEX, NULL, 0x1f,\r\nNULL, HFILL } },\r\n{&hf_v52_override,\r\n{ "Override", "v52.override",\r\nFT_BOOLEAN, 8, NULL, 0x20,\r\nNULL, HFILL } },\r\n{&hf_v52_reject_cause_type,\r\n{ "Reject cause type", "v52.reject_cause_type",\r\nFT_UINT8, BASE_HEX, VALS(reject_cause_type_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_bcc_protocol_error_cause,\r\n{ "Protocol error cause type", "v52.bcc_protocol_cause",\r\nFT_UINT8, BASE_HEX, VALS(bcc_protocol_error_cause_type_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_diagnostic_message,\r\n{ "Diagnostic message", "v52.diagnoatic_message",\r\nFT_UINT8, BASE_HEX, NULL, 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_diagnostic_information,\r\n{ "Diagnostic information", "v52.diagnostic_inforation",\r\nFT_UINT8, BASE_HEX, NULL, 0xff,\r\nNULL, HFILL } },\r\n{&hf_v52_connection_incomplete_reason,\r\n{ "Reason", "v52.connection_incomplete_reason",\r\nFT_UINT8, BASE_HEX, VALS(connection_incomplete_reason_values), 0x0,\r\nNULL, HFILL } },\r\n{&hf_v52_link_control_function,\r\n{ "Link control function", "v52.link_control_function",\r\nFT_UINT8, BASE_HEX, VALS(link_control_function_values), 0x7f,\r\nNULL, HFILL } },\r\n{&hf_v52_cause_type,\r\n{ "Cause type", "v52.cause_type",\r\nFT_UINT8, BASE_HEX, VALS(cause_type_values), 0x7f,\r\nNULL, HFILL } }\r\n};\r\nstatic gint *ett[] = {\r\n&ett_v52,\r\n&ett_v52_info,\r\n};\r\nproto_v52 = proto_register_protocol("V5.2", "V5.2", "v52");\r\nproto_register_field_array (proto_v52, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("v52", dissect_v52, proto_v52);\r\n}
