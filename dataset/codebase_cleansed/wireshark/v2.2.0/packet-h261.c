static int\r\ndissect_h261( tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_ )\r\n{\r\nproto_item *ti = NULL;\r\nproto_tree *h261_tree = NULL;\r\nunsigned int offset = 0;\r\nstatic const int * bits[] = {\r\n&hf_h261_sbit,\r\n&hf_h261_ebit,\r\n&hf_h261_ibit,\r\n&hf_h261_vbit,\r\nNULL\r\n};\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "H.261");\r\ncol_set_str(pinfo->cinfo, COL_INFO, "H.261 message");\r\nif ( tree ) {\r\nti = proto_tree_add_item( tree, proto_h261, tvb, offset, -1, ENC_NA );\r\nh261_tree = proto_item_add_subtree( ti, ett_h261 );\r\nproto_tree_add_bitmask_list(h261_tree, tvb, offset, 1, bits, ENC_NA);\r\noffset++;\r\nproto_tree_add_uint( h261_tree, hf_h261_gobn, tvb, offset, 1, tvb_get_guint8( tvb, offset ) >> 4 );\r\nproto_tree_add_uint( h261_tree, hf_h261_mbap, tvb, offset, 1,\r\n( tvb_get_guint8( tvb, offset ) & 15 )\r\n+ ( tvb_get_guint8( tvb, offset + 1 ) >> 7 ) );\r\noffset++;\r\nproto_tree_add_uint( h261_tree, hf_h261_quant, tvb, offset, 1, tvb_get_guint8( tvb, offset ) & 124 );\r\nproto_tree_add_uint( h261_tree, hf_h261_hmvd, tvb, offset, 2,\r\n( ( tvb_get_guint8( tvb, offset ) & 0x03 ) << 3 )\r\n+ ( tvb_get_guint8( tvb, offset+1 ) >> 5 ) );\r\noffset++;\r\nproto_tree_add_uint( h261_tree, hf_h261_vmvd, tvb, offset, 1, tvb_get_guint8( tvb, offset ) & 31 );\r\noffset++;\r\nproto_tree_add_item( h261_tree, hf_h261_data, tvb, offset, -1, ENC_NA );\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_h261(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{\r\n&hf_h261_sbit,\r\n{\r\n"Start bit position",\r\n"h261.sbit",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0xe0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_ebit,\r\n{\r\n"End bit position",\r\n"h261.ebit",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x1c,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_ibit,\r\n{\r\n"Intra frame encoded data flag",\r\n"h261.i",\r\nFT_BOOLEAN,\r\n8,\r\nNULL,\r\n0x02,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_vbit,\r\n{\r\n"Motion vector flag",\r\n"h261.v",\r\nFT_BOOLEAN,\r\n8,\r\nNULL,\r\n0x01,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_gobn,\r\n{\r\n"GOB Number",\r\n"h261.gobn",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_mbap,\r\n{\r\n"Macroblock address predictor",\r\n"h261.mbap",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_quant,\r\n{\r\n"Quantizer",\r\n"h261.quant",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_hmvd,\r\n{\r\n"Horizontal motion vector data",\r\n"h261.hmvd",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_vmvd,\r\n{\r\n"Vertical motion vector data",\r\n"h261.vmvd",\r\nFT_UINT8,\r\nBASE_DEC,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_h261_data,\r\n{\r\n"H.261 stream",\r\n"h261.stream",\r\nFT_BYTES,\r\nBASE_NONE,\r\nNULL,\r\n0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] =\r\n{\r\n&ett_h261,\r\n};\r\nproto_h261 = proto_register_protocol("ITU-T Recommendation H.261",\r\n"H.261", "h261");\r\nproto_register_field_array(proto_h261, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_h261(void)\r\n{\r\ndissector_handle_t h261_handle;\r\nh261_handle = create_dissector_handle(dissect_h261, proto_h261);\r\ndissector_add_uint("rtp.pt", PT_H261, h261_handle);\r\ndissector_add_uint("iax2.codec", AST_FORMAT_H261, h261_handle);\r\n}
