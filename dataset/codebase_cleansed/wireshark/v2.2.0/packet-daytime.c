static int\r\ndissect_daytime(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_tree *daytime_tree;\r\nproto_item *ti;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "DAYTIME");\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "DAYTIME %s",\r\npinfo->srcport == pinfo->match_uint ? "Response":"Request");\r\nif (tree) {\r\nti = proto_tree_add_item(tree, hfi_daytime, tvb, 0, -1, ENC_NA);\r\ndaytime_tree = proto_item_add_subtree(ti, ett_daytime);\r\nproto_tree_add_boolean(daytime_tree, &hfi_response_request, tvb, 0, 0, pinfo->srcport==DAYTIME_PORT);\r\nif (pinfo->srcport == DAYTIME_PORT) {\r\nproto_tree_add_item(daytime_tree, &hfi_daytime_string, tvb, 0, -1, ENC_ASCII|ENC_NA);\r\n}\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_daytime(void)\r\n{\r\n#ifndef HAVE_HFI_SECTION_INIT\r\nstatic header_field_info *hfi[] = {\r\n&hfi_daytime_string,\r\n&hfi_response_request,\r\n};\r\n#endif\r\nstatic gint *ett[] = {\r\n&ett_daytime,\r\n};\r\nint proto_daytime;\r\nproto_daytime = proto_register_protocol("Daytime Protocol", "DAYTIME", "daytime");\r\nhfi_daytime = proto_registrar_get_nth(proto_daytime);\r\nproto_register_fields(proto_daytime, hfi, array_length(hfi));\r\nproto_register_subtree_array(ett, array_length(ett));\r\ndaytime_handle = create_dissector_handle(dissect_daytime, proto_daytime);\r\n}\r\nvoid\r\nproto_reg_handoff_daytime(void)\r\n{\r\ndissector_add_uint("udp.port", DAYTIME_PORT, daytime_handle);\r\ndissector_add_uint("tcp.port", DAYTIME_PORT, daytime_handle);\r\n}
