static void\r\ndissect_path_data_tlv(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset)\r\n{\r\nproto_item *ti, *flag_item;\r\nguint length_TLV, IDcount, i;\r\nguint16 type, flag;\r\nproto_tree *tlv_tree, *path_data_tree, *flag_tree;\r\nwhile (tvb_reported_length_remaining(tvb, offset) >= TLV_TL_LENGTH)\r\n{\r\ntlv_tree = proto_tree_add_subtree(tree, tvb, offset, TLV_TL_LENGTH, ett_forces_path_data_tlv, &ti, "TLV");\r\ntype = tvb_get_ntohs(tvb, offset);\r\nproto_tree_add_item(tlv_tree, hf_forces_lfbselect_tlv_type_operation_path_type,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nlength_TLV = tvb_get_ntohs(tvb, offset+2);\r\nproto_tree_add_item(tlv_tree, hf_forces_lfbselect_tlv_type_operation_path_length,\r\ntvb, offset+2, 2, ENC_BIG_ENDIAN);\r\nif (length_TLV < TLV_TL_LENGTH)\r\n{\r\nexpert_add_info_format(pinfo, ti, &ei_forces_lfbselect_tlv_type_operation_path_length, "Bogus TLV length: %u", length_TLV);\r\nbreak;\r\n}\r\nproto_item_set_len(ti, length_TLV);\r\nif (type == PATH_DATA_TLV)\r\n{\r\npath_data_tree = proto_tree_add_subtree(tree, tvb, offset+TLV_TL_LENGTH, length_TLV-TLV_TL_LENGTH,\r\nett_forces_path_data_tlv, NULL, "Path Data TLV");\r\nflag = tvb_get_ntohs(tvb, offset+TLV_TL_LENGTH);\r\nflag_item = proto_tree_add_item(path_data_tree, hf_forces_lfbselect_tlv_type_operation_path_flags,\r\ntvb, offset+TLV_TL_LENGTH, 2, ENC_BIG_ENDIAN);\r\nflag_tree = proto_item_add_subtree(flag_item, ett_forces_path_data_tlv_flags);\r\nproto_tree_add_item(flag_tree, hf_forces_lfbselect_tlv_type_operation_path_flags_selector,\r\ntvb, offset+TLV_TL_LENGTH, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(flag_tree, hf_forces_lfbselect_tlv_type_operation_path_flags_reserved,\r\ntvb, offset+TLV_TL_LENGTH, 2, ENC_BIG_ENDIAN);\r\nIDcount = tvb_get_ntohs(tvb, offset + TLV_TL_LENGTH + 2);\r\nproto_tree_add_item(path_data_tree, hf_forces_lfbselect_tlv_type_operation_path_IDcount,\r\ntvb, offset+TLV_TL_LENGTH+2, 2, ENC_BIG_ENDIAN);\r\nfor (i = 0; i < IDcount; i++)\r\nproto_tree_add_item(path_data_tree, hf_forces_lfbselect_tlv_type_operation_path_IDs,\r\ntvb, offset+TLV_TL_LENGTH+2+(i*4), 4, ENC_BIG_ENDIAN);\r\n}\r\nelse\r\n{\r\nflag = 0;\r\nproto_tree_add_item(tree, hf_forces_lfbselect_tlv_type_operation_path_data,\r\ntvb, offset+TLV_TL_LENGTH, length_TLV-TLV_TL_LENGTH, ENC_NA);\r\n}\r\nif ((flag & FLAG_SELECTOR) == 0)\r\nbreak;\r\noffset += length_TLV;\r\n}\r\n}\r\nstatic void\r\ndissect_operation_tlv(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, gint length_count)\r\n{\r\nproto_item *ti;\r\nproto_tree *oper_tree;\r\nguint type, length;\r\nwhile (tvb_reported_length_remaining(tvb, offset) >= TLV_TL_LENGTH)\r\n{\r\noper_tree = proto_tree_add_subtree(tree, tvb, offset, length_count,\r\nett_forces_lfbselect_tlv_type_operation, &ti, "Operation TLV");\r\ntype = tvb_get_ntohs(tvb,offset);\r\nti = proto_tree_add_item(oper_tree, hf_forces_lfbselect_tlv_type_operation_type,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nif (try_val_to_str(type, operation_type_vals) == NULL)\r\nexpert_add_info_format(pinfo, ti, &ei_forces_lfbselect_tlv_type_operation_type,\r\n"Bogus: ForCES Operation TLV (Type:0x%04x) is not supported", type);\r\nlength = tvb_get_ntohs(tvb, offset+2);\r\nproto_tree_add_uint_format_value(oper_tree, hf_forces_lfbselect_tlv_type_operation_length,\r\ntvb, offset+2, 2, length, "%u Bytes", length);\r\ndissect_path_data_tlv(tvb, pinfo, oper_tree, offset+TLV_TL_LENGTH);\r\nif (length == 0)\r\nbreak;\r\noffset += length;\r\n}\r\n}\r\nstatic void\r\ndissect_lfbselecttlv(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset, gint length_count)\r\n{\r\nguint tlv_length;\r\nproto_tree_add_item(tree, hf_forces_lfbselect_tlv_type_lfb_classid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_forces_lfbselect_tlv_type_lfb_instanceid, tvb, offset+4, 4, ENC_BIG_ENDIAN);\r\noffset += 8;\r\nwhile ((tvb_reported_length_remaining(tvb, offset) > TLV_TL_LENGTH) && (length_count > 12))\r\n{\r\ntlv_length = tvb_get_ntohs(tvb, offset+2);\r\ndissect_operation_tlv(tvb, pinfo, tree, offset, tlv_length);\r\nif (tlv_length == 0)\r\nbreak;\r\noffset += tlv_length;\r\n}\r\n}\r\nstatic void\r\ndissect_redirecttlv(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, gint offset)\r\n{\r\nproto_tree *meta_data_tree, *meta_data_ilv_tree, *redirect_data_tree;\r\ngint start_offset;\r\ngint length_meta, length_ilv, length_redirect;\r\nproto_item *ti;\r\naddress src_addr, src_net_addr;\r\naddress dst_addr, dst_net_addr;\r\ncopy_address_shallow(&src_addr, &pinfo->src);\r\ncopy_address_shallow(&src_net_addr, &pinfo->net_src);\r\ncopy_address_shallow(&dst_addr, &pinfo->dst);\r\ncopy_address_shallow(&dst_net_addr, &pinfo->net_dst);\r\nmeta_data_tree = proto_tree_add_subtree(tree, tvb, offset, TLV_TL_LENGTH,\r\nett_forces_redirect_tlv_meta_data_tlv, &ti, "Meta Data TLV");\r\nproto_tree_add_item(meta_data_tree, hf_forces_redirect_tlv_meta_data_tlv_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nlength_meta = tvb_get_ntohs(tvb, offset+2);\r\nproto_tree_add_uint_format_value(meta_data_tree, hf_forces_redirect_tlv_meta_data_tlv_length, tvb, offset+2, 2,\r\nlength_meta, "%u Bytes", length_meta);\r\nproto_item_set_len(ti, length_meta);\r\nstart_offset = offset;\r\nwhile ((tvb_reported_length_remaining(tvb, offset) >= 8) && (start_offset+length_meta > offset))\r\n{\r\nmeta_data_ilv_tree = proto_tree_add_subtree(tree, tvb, offset, TLV_TL_LENGTH,\r\nett_forces_redirect_tlv_meta_data_tlv_meta_data_ilv, &ti, "Meta Data ILV");\r\nproto_tree_add_item(meta_data_ilv_tree, hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv_id,\r\ntvb, offset+8, 4, ENC_BIG_ENDIAN);\r\nlength_ilv = tvb_get_ntohl(tvb, offset+12);\r\nproto_tree_add_uint_format_value(meta_data_ilv_tree, hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv_length,\r\ntvb, offset+12, 4, length_ilv, "%u Bytes", length_ilv);\r\noffset += 8;\r\nif (length_ilv > 0) {\r\nproto_tree_add_item(meta_data_ilv_tree, hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv,\r\ntvb, offset, length_ilv, ENC_NA);\r\nif (offset + length_ilv > offset) {\r\noffset += length_ilv;\r\n}\r\n}\r\nproto_item_set_len(ti, length_ilv + 8);\r\n}\r\nif (tvb_reported_length_remaining(tvb, offset) > 0)\r\n{\r\nredirect_data_tree = proto_tree_add_subtree(tree, tvb, offset, TLV_TL_LENGTH,\r\nett_forces_redirect_tlv_redirect_data_tlv, &ti, "Redirect Data TLV");\r\nproto_tree_add_item(redirect_data_tree, hf_forces_redirect_tlv_redirect_data_tlv_type,\r\ntvb, offset, 2, ENC_BIG_ENDIAN);\r\nlength_redirect = tvb_get_ntohs(tvb, offset+2);\r\nproto_tree_add_uint_format_value(redirect_data_tree, hf_forces_redirect_tlv_redirect_data_tlv_length,\r\ntvb, offset+2, 2, length_redirect, "%u Bytes", length_redirect);\r\nif (tvb_reported_length_remaining(tvb, offset) < length_redirect)\r\n{\r\nexpert_add_info_format(pinfo, ti, &ei_forces_redirect_tlv_redirect_data_tlv_length, "Bogus: Redirect Data TLV length (%u bytes) is wrong", length_redirect);\r\n}\r\nelse if (length_redirect < TLV_TL_LENGTH + MIN_IP_HEADER_LENGTH)\r\n{\r\nexpert_add_info_format(pinfo, ti, &ei_forces_redirect_tlv_redirect_data_tlv_length, "Bogus: Redirect Data TLV length (%u bytes) not big enough for IP layer", length_redirect);\r\n}\r\nelse\r\n{\r\ntvbuff_t *next_tvb;\r\nnext_tvb = tvb_new_subset_length(tvb, offset+4, length_redirect-TLV_TL_LENGTH);\r\ncall_dissector(ip_handle, next_tvb, pinfo, redirect_data_tree);\r\ncopy_address_shallow(&pinfo->src, &src_addr);\r\ncopy_address_shallow(&pinfo->net_src, &src_net_addr);\r\ncopy_address_shallow(&pinfo->dst, &dst_addr);\r\ncopy_address_shallow(&pinfo->net_dst, &dst_net_addr);\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_forces(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, guint32 offset)\r\n{\r\nproto_item *ti, *tlv_item;\r\nproto_tree *forces_tree, *forces_flags_tree;\r\nproto_tree *forces_main_header_tree, *forces_tlv_tree, *tlv_tree;\r\ngint length_count;\r\nguint8 message_type;\r\nguint16 tlv_type;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "ForCES");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nti = proto_tree_add_item(tree, proto_forces, tvb, 0, -1, ENC_NA);\r\nforces_tree = proto_item_add_subtree(ti, ett_forces);\r\nforces_main_header_tree = proto_tree_add_subtree(forces_tree, tvb, 0, ForCES_HEADER_LENGTH,\r\nett_forces_main_header, NULL, "Common Header");\r\nproto_tree_add_item(forces_main_header_tree, hf_forces_version, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_main_header_tree, hf_forces_rsvd, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nmessage_type = tvb_get_guint8(tvb, offset+1);\r\nproto_tree_add_item( forces_main_header_tree, hf_forces_messagetype, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\nlength_count = tvb_get_ntohs(tvb, offset+2) * 4;\r\nti = proto_tree_add_uint_format( forces_main_header_tree, hf_forces_length,\r\ntvb, offset+2, 2, length_count, "Length: %u Bytes", length_count);\r\nif (length_count != tvb_reported_length_remaining(tvb, offset))\r\nexpert_add_info_format(pinfo, ti, &ei_forces_length, "Bogus: ForCES Header length (%u bytes) is wrong),should be (%u bytes)",\r\nlength_count, tvb_reported_length_remaining(tvb, offset));\r\nif (length_count < 24)\r\nexpert_add_info_format(pinfo, ti, &ei_forces_length, "Bogus: ForCES Header length (%u bytes) is less than 24bytes)", length_count);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "Message Type: %s, Total Length: %u Bytes",\r\nval_to_str(message_type, message_type_vals, "Unknown messagetype 0x%x"), length_count);\r\nproto_tree_add_item( forces_main_header_tree, hf_forces_sid, tvb, offset+4, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item( forces_main_header_tree, hf_forces_did, tvb, offset+8, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item( forces_main_header_tree, hf_forces_correlator, tvb, offset+12, 8, ENC_BIG_ENDIAN);\r\nti = proto_tree_add_item(forces_main_header_tree, hf_forces_flags, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nforces_flags_tree = proto_item_add_subtree(ti, ett_forces_flags);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_ack, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_at, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_em, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_pri, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_reserved, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_rsrvd, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(forces_flags_tree, hf_forces_flags_tp, tvb, offset+20, 4, ENC_BIG_ENDIAN);\r\noffset += 24;\r\nwhile (tvb_reported_length_remaining(tvb, offset) >= TLV_TL_LENGTH)\r\n{\r\nforces_tlv_tree = proto_tree_add_subtree(forces_tree, tvb, offset, TLV_TL_LENGTH, ett_forces_tlv, &ti, "TLV");\r\ntlv_type = tvb_get_ntohs(tvb, offset);\r\ntlv_item = proto_tree_add_item(forces_tlv_tree, hf_forces_tlv_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nlength_count = tvb_get_ntohs(tvb, offset+2) * 4;\r\nproto_item_set_len(ti, length_count);\r\nti = proto_tree_add_uint_format_value(forces_tlv_tree, hf_forces_tlv_length,\r\ntvb, offset+2, 2, length_count, "%u Bytes", length_count);\r\nif (tvb_reported_length_remaining(tvb, offset) < length_count)\r\nexpert_add_info_format(pinfo, ti, &ei_forces_tlv_length, "Bogus: Main TLV length (%u bytes) is wrong", length_count);\r\nif (length_count < TLV_TL_LENGTH)\r\n{\r\nexpert_add_info_format(pinfo, ti, &ei_forces_tlv_length, "Bogus TLV length: %u", length_count);\r\nbreak;\r\n}\r\noffset += TLV_TL_LENGTH;\r\nlength_count -= TLV_TL_LENGTH;\r\nswitch(tlv_type)\r\n{\r\ncase LFBselect_TLV:\r\ntlv_tree = proto_tree_add_subtree(forces_tlv_tree, tvb, offset, length_count,\r\nett_forces_lfbselect_tlv_type, NULL, "LFB select TLV");\r\ndissect_lfbselecttlv(tvb, pinfo, tlv_tree, offset, length_count);\r\nbreak;\r\ncase REDIRECT_TLV:\r\ntlv_tree = proto_tree_add_subtree(forces_tlv_tree, tvb, offset, length_count,\r\nett_forces_redirect_tlv_type, NULL, "Redirect TLV");\r\ndissect_redirecttlv(tvb, pinfo, tlv_tree, offset);\r\nbreak;\r\ncase ASResult_TLV:\r\ntlv_tree = proto_tree_add_subtree(forces_tlv_tree, tvb, offset, length_count,\r\nett_forces_asresult_tlv, NULL, "ASResult TLV");\r\nproto_tree_add_item(tlv_tree, hf_forces_asresult_association_setup_result, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase ASTreason_TLV:\r\ntlv_tree = proto_tree_add_subtree(forces_tlv_tree, tvb, offset, length_count,\r\nett_forces_astreason_tlv, NULL, "ASTreason TLV");\r\nproto_tree_add_item(tlv_tree, hf_forces_astreason_tlv_teardown_reason, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nexpert_add_info(pinfo, tlv_item, &ei_forces_tlv_type);\r\ntlv_tree = proto_tree_add_subtree(forces_tlv_tree, tvb, offset, length_count,\r\nett_forces_unknown_tlv, NULL, "Unknown TLV");\r\nproto_tree_add_item(tlv_tree, hf_forces_unknown_tlv, tvb, offset, length_count, ENC_NA);\r\nbreak;\r\n}\r\noffset += length_count;\r\n}\r\n}\r\nstatic int\r\ndissect_forces_tcp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ndissect_forces(tvb, pinfo, tree, TCP_UDP_TML_FOCES_MESSAGE_OFFSET_TCP);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_forces_not_tcp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\ndissect_forces(tvb, pinfo, tree, 0);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_forces(void)\r\n{\r\nmodule_t *forces_module;\r\nexpert_module_t* expert_forces;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_forces_version,\r\n{ "Version", "forces.flags.version",\r\nFT_UINT8, BASE_DEC, NULL, 0xF0, NULL, HFILL }\r\n},\r\n{ &hf_forces_rsvd,\r\n{ "Rsvd", "forces.flags.rsvd",\r\nFT_UINT8, BASE_DEC, NULL, 0x0F, NULL, HFILL }\r\n},\r\n{ &hf_forces_messagetype,\r\n{ "Message Type", "forces.messagetype",\r\nFT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_length,\r\n{ "Header Length", "forces.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_sid,\r\n{ "Source ID", "forces.sid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_did,\r\n{ "Destination ID", "forces.did",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_correlator,\r\n{ "Correlator", "forces.correlator",\r\nFT_UINT64, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_tlv_type,\r\n{ "Type", "forces.tlv.type",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_tlv_length,\r\n{ "Length", "forces.tlv.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags,\r\n{ "Flags", "forces.Flags",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_ack,\r\n{ "ACK indicator", "forces.flags.ack",\r\nFT_UINT32, BASE_DEC, VALS(main_header_flags_ack_vals), 0xC0000000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_pri,\r\n{ "Priority", "forces.flags.pri",\r\nFT_UINT32, BASE_DEC, NULL, 0x38000000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_rsrvd,\r\n{ "Rsrvd", "forces.Flags",\r\nFT_UINT32, BASE_DEC,NULL, 0x07000000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_em,\r\n{ "Execution mode", "forces.flags.em",\r\nFT_UINT32, BASE_DEC, VALS(main_header_flags_em_vals), 0x00C00000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_at,\r\n{ "Atomic Transaction", "forces.flags.at",\r\nFT_UINT32, BASE_DEC, VALS(main_header_flags_at_vals), 0x00200000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_tp,\r\n{ "Transaction phase", "forces.flags.tp",\r\nFT_UINT32, BASE_DEC, VALS(main_header_flags_tp_vals), 0x00180000, NULL, HFILL }\r\n},\r\n{ &hf_forces_flags_reserved,\r\n{ "Reserved", "forces.flags.reserved",\r\nFT_UINT32, BASE_DEC,NULL, 0x0007ffff, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_lfb_classid,\r\n{ "Class ID", "forces.lfbselect.tlv.type.lfb.classid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_lfb_instanceid,\r\n{ "Instance ID", "forces.fbselect.tlv.type.lfb.instanceid",\r\nFT_IPv4, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_type,\r\n{ "Type", "forces.lfbselect.tlv.type.operation.type",\r\nFT_UINT16, BASE_DEC, VALS(operation_type_vals), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_length,\r\n{ "Length", "forces.lfbselect.tlv.type.operation.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_type,\r\n{ "Type", "forces.lfbselect.tlv.type.operation.path.type",\r\nFT_UINT16, BASE_DEC, VALS(tlv_type_vals), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_length,\r\n{ "Length", "forces.lfbselect.tlv.type.operation.path.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_data,\r\n{ "Data", "forces.lfbselect.tlv.type.operation.path.data",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_flags,\r\n{"Path Data Flags", "forces.lfbselect.tlv.type.operation.path.data.flags",\r\nFT_UINT16, BASE_HEX, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_flags_selector,\r\n{"Selector", "forces.lfbselect.tlv.type.operation.path.data.flags.selector",\r\nFT_UINT16, BASE_HEX, NULL, 0x80, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_flags_reserved,\r\n{"Reserved", "forces.lfbselect.tlv.type.operation.path.data.flags.reserved",\r\nFT_UINT16, BASE_HEX, NULL, 0x7F, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_IDcount,\r\n{ "Path Data IDcount", "forces.lfbselect.tlv.type.operation.path.data.IDcount",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_lfbselect_tlv_type_operation_path_IDs,\r\n{ "Path Data IDs", "forces.lfbselect.tlv.type.operation.path.data.IDs",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{&hf_forces_redirect_tlv_meta_data_tlv_type,\r\n{ "Type", "forces.redirect.tlv.meta.data.tlv.type",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_meta_data_tlv_length,\r\n{ "Length", "forces.redirect.tlv.meta.data.tlv.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv,\r\n{ "Meta Data ILV", "forces.redirect.tlv.meta.data.tlv.meta.data.ilv",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv_id,\r\n{ "ID", "forces.redirect.tlv.meta.data.tlv.meta.data.ilv.id",\r\nFT_UINT32, BASE_HEX_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_meta_data_tlv_meta_data_ilv_length,\r\n{ "Length", "forces.redirect.tlv.meta.data.tlv.meta.data.ilv.length",\r\nFT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_redirect_data_tlv_type,\r\n{ "Type", "forces.redirect.tlv.redirect.data.tlv.type",\r\nFT_UINT16, BASE_DEC, VALS(tlv_type_vals), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_redirect_tlv_redirect_data_tlv_length,\r\n{ "Length", "forces.redirect.tlv.redirect.data.tlv.length",\r\nFT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_asresult_association_setup_result,\r\n{ "Association Setup Result", "forces.teardown.reason",\r\nFT_UINT32, BASE_DEC, VALS(association_setup_result_at_vals), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_astreason_tlv_teardown_reason,\r\n{ "AStreason TLV TearDown Reason", "forces.astreason.tlv.teardown.reason",\r\nFT_UINT32, BASE_DEC, VALS(teardown_reason_at_vals), 0x0, NULL, HFILL }\r\n},\r\n{ &hf_forces_unknown_tlv,\r\n{ "Data", "forces.unknown.tlv",\r\nFT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL }\r\n}\r\n};\r\nstatic gint *ett[] = {\r\n&ett_forces,\r\n&ett_forces_main_header,\r\n&ett_forces_flags,\r\n&ett_forces_tlv,\r\n&ett_forces_lfbselect_tlv_type,\r\n&ett_forces_lfbselect_tlv_type_operation,\r\n&ett_forces_lfbselect_tlv_type_operation_path,\r\n&ett_forces_lfbselect_tlv_type_operation_path_data,\r\n&ett_forces_lfbselect_tlv_type_operation_path_data_path,\r\n&ett_forces_lfbselect_tlv_type_operation_path_selector,\r\n&ett_forces_path_data_tlv,\r\n&ett_forces_path_data_tlv_flags,\r\n&ett_forces_redirect_tlv_type,\r\n&ett_forces_redirect_tlv_meta_data_tlv,\r\n&ett_forces_redirect_tlv_redirect_data_tlv,\r\n&ett_forces_redirect_tlv_meta_data_tlv_meta_data_ilv,\r\n&ett_forces_asresult_tlv,\r\n&ett_forces_astreason_tlv,\r\n&ett_forces_unknown_tlv\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_forces_length, { "forces.length.bad", PI_PROTOCOL, PI_WARN, "ForCES Header length is wrong", EXPFILL }},\r\n{ &ei_forces_tlv_type, { "forces.tlv.type.unknown", PI_PROTOCOL, PI_WARN, "Bogus: The Main_TLV type is unknown", EXPFILL }},\r\n{ &ei_forces_tlv_length, { "forces.tlv.length.bad", PI_PROTOCOL, PI_WARN, "Bogus TLV length", EXPFILL }},\r\n{ &ei_forces_lfbselect_tlv_type_operation_path_length, { "forces.lfbselect.tlv.type.operation.path.length.bad", PI_PROTOCOL, PI_WARN, "Bogus TLV length", EXPFILL }},\r\n{ &ei_forces_lfbselect_tlv_type_operation_type, { "forces.lfbselect.tlv.type.operation.type.unsupported", PI_PROTOCOL, PI_WARN, "ForCES Operation TLV is not supported", EXPFILL }},\r\n{ &ei_forces_redirect_tlv_redirect_data_tlv_length, { "forces.redirect.tlv.redirect.data.tlv.length.bad", PI_PROTOCOL, PI_WARN, "Redirect Data TLV length is wrong", EXPFILL }},\r\n};\r\nproto_forces = proto_register_protocol("Forwarding and Control Element Separation Protocol", "ForCES", "forces");\r\nproto_register_field_array(proto_forces, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_forces = expert_register_protocol(proto_forces);\r\nexpert_register_field_array(expert_forces, ei, array_length(ei));\r\nforces_module = prefs_register_protocol(proto_forces,proto_reg_handoff_forces);\r\nprefs_register_uint_preference(forces_module, "tcp_alternate_port",\r\n"TCP port",\r\n"Decode packets on this TCP port as ForCES",\r\n10, &forces_alternate_tcp_port);\r\nprefs_register_uint_preference(forces_module, "udp_alternate_port",\r\n"UDP port",\r\n"Decode packets on this UDP port as ForCES",\r\n10, &forces_alternate_udp_port);\r\nprefs_register_uint_preference(forces_module, "sctp_high_prio_port",\r\n"SCTP High Priority channel port",\r\n"Decode packets on this sctp port as ForCES",\r\n10, &forces_alternate_sctp_high_prio_channel_port);\r\nprefs_register_uint_preference(forces_module, "sctp_med_prio_port",\r\n"SCTP Meidium Priority channel port",\r\n"Decode packets on this sctp port as ForCES",\r\n10, &forces_alternate_sctp_med_prio_channel_port);\r\nprefs_register_uint_preference(forces_module, "sctp_low_prio_port",\r\n"SCTP Low Priority channel port",\r\n"Decode packets on this sctp port as ForCES",\r\n10, &forces_alternate_sctp_low_prio_channel_port);\r\n}\r\nvoid\r\nproto_reg_handoff_forces(void)\r\n{\r\nstatic gboolean inited = FALSE;\r\nstatic guint alternate_tcp_port = 0;\r\nstatic guint alternate_udp_port = 0;\r\nstatic guint alternate_sctp_high_prio_channel_port = 0;\r\nstatic guint alternate_sctp_med_prio_channel_port = 0;\r\nstatic guint alternate_sctp_low_prio_channel_port = 0;\r\nstatic dissector_handle_t forces_handle_tcp, forces_handle;\r\nif (!inited) {\r\nforces_handle_tcp = create_dissector_handle(dissect_forces_tcp, proto_forces);\r\nforces_handle = create_dissector_handle(dissect_forces_not_tcp, proto_forces);\r\nip_handle = find_dissector_add_dependency("ip", proto_forces);\r\ninited = TRUE;\r\n}\r\nif ((alternate_tcp_port != 0) && (alternate_tcp_port != forces_alternate_tcp_port))\r\ndissector_delete_uint("tcp.port", alternate_tcp_port, forces_handle_tcp);\r\nif ((forces_alternate_tcp_port != 0) && (alternate_tcp_port != forces_alternate_tcp_port))\r\ndissector_add_uint("tcp.port", forces_alternate_tcp_port, forces_handle_tcp);\r\nalternate_tcp_port = forces_alternate_tcp_port;\r\nif ((alternate_udp_port != 0) && (alternate_udp_port != forces_alternate_udp_port))\r\ndissector_delete_uint("udp.port", alternate_udp_port, forces_handle);\r\nif ((forces_alternate_udp_port != 0) && (alternate_udp_port != forces_alternate_udp_port))\r\ndissector_add_uint("udp.port", forces_alternate_udp_port, forces_handle);\r\nalternate_udp_port = forces_alternate_udp_port;\r\nif ((alternate_sctp_high_prio_channel_port != 0) &&\r\n(alternate_sctp_high_prio_channel_port != forces_alternate_sctp_high_prio_channel_port))\r\ndissector_delete_uint("sctp.port", alternate_sctp_high_prio_channel_port, forces_handle);\r\nif ((forces_alternate_sctp_high_prio_channel_port != 0) &&\r\n(alternate_sctp_high_prio_channel_port != forces_alternate_sctp_high_prio_channel_port))\r\ndissector_add_uint("sctp.port", forces_alternate_sctp_high_prio_channel_port, forces_handle);\r\nalternate_sctp_high_prio_channel_port = forces_alternate_sctp_high_prio_channel_port;\r\nif ((alternate_sctp_med_prio_channel_port != 0) &&\r\n(alternate_sctp_med_prio_channel_port != forces_alternate_sctp_med_prio_channel_port))\r\ndissector_delete_uint("sctp.port", alternate_sctp_med_prio_channel_port, forces_handle);\r\nif ((forces_alternate_sctp_med_prio_channel_port != 0) &&\r\n(alternate_sctp_med_prio_channel_port != forces_alternate_sctp_med_prio_channel_port))\r\ndissector_add_uint("sctp.port", forces_alternate_sctp_med_prio_channel_port, forces_handle);\r\nalternate_sctp_med_prio_channel_port = forces_alternate_sctp_med_prio_channel_port;\r\nif ((alternate_sctp_low_prio_channel_port != 0) &&\r\n(alternate_sctp_low_prio_channel_port != forces_alternate_sctp_low_prio_channel_port))\r\ndissector_delete_uint("sctp.port", alternate_sctp_low_prio_channel_port, forces_handle);\r\nif ((forces_alternate_sctp_low_prio_channel_port != 0) &&\r\n(alternate_sctp_low_prio_channel_port != forces_alternate_sctp_low_prio_channel_port))\r\ndissector_add_uint("sctp.port", forces_alternate_sctp_low_prio_channel_port, forces_handle);\r\nalternate_sctp_low_prio_channel_port = forces_alternate_sctp_low_prio_channel_port;\r\n}
