static void\r\nset_vtp_info_col(tvbuff_t *tvb, packet_info *pinfo)\r\n{\r\nswitch (tvb_get_guint8(tvb, 1)) {\r\ncase SUMMARY_ADVERT:\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"Summary Advertisement, Revision: %u", tvb_get_ntohl(tvb, 36));\r\nif (tvb_get_guint8(tvb, 2) > 0) {\r\ncol_append_fstr(pinfo->cinfo, COL_INFO,\r\n", Followers: %u", tvb_get_guint8(tvb, 2));\r\n}\r\nbreak;\r\ncase SUBSET_ADVERT:\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"Subset Advertisement, Revision: %u, Seq: %u",\r\ntvb_get_ntohl(tvb, 36), tvb_get_guint8(tvb, 2));\r\nbreak;\r\ncase ADVERT_REQUEST:\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Advertisement Request");\r\nbreak;\r\ncase JOIN_MSG:\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Join");\r\nbreak;\r\ndefault:\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Unrecognized VTP message");\r\nbreak;\r\n}\r\n}\r\nstatic int\r\ndissect_vtp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *ti;\r\nproto_tree *vtp_tree = NULL, *vtp_pruning_tree = NULL;\r\nint offset = 0;\r\nguint8 code;\r\nguint8 *upd_timestamp;\r\nint vlan_info_len;\r\nint pruning_vlan_id;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "VTP");\r\nset_vtp_info_col(tvb, pinfo);\r\nti = proto_tree_add_item(tree, proto_vtp, tvb, offset, -1, ENC_NA);\r\nvtp_tree = proto_item_add_subtree(ti, ett_vtp);\r\nproto_tree_add_item(vtp_tree, hf_vtp_version, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\ncode = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(vtp_tree, hf_vtp_code, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nswitch (code) {\r\ncase SUMMARY_ADVERT:\r\nproto_tree_add_item(vtp_tree, hf_vtp_followers, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\noffset += 32;\r\nproto_tree_add_item(vtp_tree, hf_vtp_conf_rev_num, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(vtp_tree, hf_vtp_upd_id, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nupd_timestamp = tvb_get_string_enc(wmem_packet_scope(), tvb, offset, 12, ENC_ASCII);\r\nproto_tree_add_string_format_value(vtp_tree, hf_vtp_upd_ts, tvb,\r\noffset, 12, (gchar*)upd_timestamp,\r\n"%.2s-%.2s-%.2s %.2s:%.2s:%.2s",\r\n&upd_timestamp[0], &upd_timestamp[2], &upd_timestamp[4],\r\n&upd_timestamp[6], &upd_timestamp[8], &upd_timestamp[10]);\r\noffset += 12;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md5_digest, tvb, offset, 16, ENC_NA);\r\nbreak;\r\ncase SUBSET_ADVERT:\r\nproto_tree_add_item(vtp_tree, hf_vtp_seq_num, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\noffset += 32;\r\nproto_tree_add_item(vtp_tree, hf_vtp_conf_rev_num, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nvlan_info_len =\r\ndissect_vlan_info(tvb, pinfo, offset, vtp_tree);\r\nif (vlan_info_len <= 0)\r\nbreak;\r\noffset += vlan_info_len;\r\n}\r\nbreak;\r\ncase ADVERT_REQUEST:\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\noffset += 32;\r\nproto_tree_add_item(vtp_tree, hf_vtp_start_value, tvb, offset, 2, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase JOIN_MSG:\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(vtp_tree, hf_vtp_md, tvb, offset, 32, ENC_ASCII|ENC_NA);\r\noffset += 32;\r\nproto_tree_add_item(vtp_tree, hf_vtp_pruning_first_vid, tvb, offset, 2, ENC_BIG_ENDIAN);\r\npruning_vlan_id = tvb_get_ntohs(tvb, offset);\r\noffset += 2;\r\nproto_tree_add_item(vtp_tree, hf_vtp_pruning_last_vid, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nvtp_pruning_tree = proto_tree_add_subtree(vtp_tree, tvb, offset, -1,\r\nett_vtp_pruning, NULL, "Advertised active (i.e. not pruned) VLANs");\r\nwhile (tvb_reported_length_remaining(tvb, offset) > 0) {\r\nguint8 vlan_usage_bitmap;\r\nint shift;\r\nvlan_usage_bitmap = tvb_get_guint8(tvb, offset);\r\nfor (shift = 0; shift < 8; shift++) {\r\nif (vlan_usage_bitmap & (1<<7)) {\r\nproto_tree_add_uint(vtp_pruning_tree, hf_vtp_pruning_active_vid,\r\ntvb, offset, 1, pruning_vlan_id);\r\n}\r\npruning_vlan_id += 1;\r\nvlan_usage_bitmap <<= 1;\r\n}\r\noffset += 1;\r\n}\r\nbreak;\r\n}\r\nreturn tvb_captured_length(tvb);\r\n}\r\nstatic int\r\ndissect_vlan_info(tvbuff_t *tvb, packet_info *pinfo, int offset, proto_tree *tree)\r\n{\r\nproto_item *ti;\r\nproto_tree *vlan_info_tree;\r\nproto_tree *status_tree;\r\nguint8 vlan_info_len;\r\nint vlan_info_left;\r\nguint8 status;\r\nguint8 vlan_name_len;\r\nguint8 type;\r\nint length;\r\nproto_tree *tlv_tree;\r\nvlan_info_len = tvb_get_guint8(tvb, offset);\r\nvlan_info_tree = proto_tree_add_subtree(tree, tvb, offset, vlan_info_len,\r\nett_vtp_vlan_info, NULL, "VLAN Information");\r\nvlan_info_left = vlan_info_len;\r\nproto_tree_add_uint(vlan_info_tree, hf_vtp_vlan_info_len, tvb, offset, 1,\r\nvlan_info_len);\r\noffset += 1;\r\nvlan_info_left -= 1;\r\nstatus = tvb_get_guint8(tvb, offset);\r\nti = proto_tree_add_uint(vlan_info_tree, hf_vtp_vlan_status, tvb, offset, 1, status);\r\nif (status & VLAN_SUSPENDED)\r\nproto_item_append_text(ti, " (VLAN suspended)");\r\nstatus_tree = proto_item_add_subtree(ti, ett_vtp_vlan_status);\r\nproto_tree_add_boolean(status_tree, hf_vtp_vlan_status_vlan_susp, tvb, offset, 1,\r\nstatus);\r\noffset += 1;\r\nvlan_info_left -= 1;\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_vlan_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nvlan_info_left -= 1;\r\nvlan_name_len = tvb_get_guint8(tvb, offset);\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_vlan_name_len, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nvlan_info_left -= 1;\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_isl_vlan_id, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nvlan_info_left -= 2;\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_mtu_size, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nvlan_info_left -= 2;\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_802_10_index, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nvlan_info_left -= 4;\r\nvlan_name_len = 4*((vlan_name_len + 3)/4);\r\nproto_tree_add_item(vlan_info_tree, hf_vtp_vlan_name, tvb, offset, vlan_name_len, ENC_ASCII|ENC_NA);\r\noffset += vlan_name_len;\r\nvlan_info_left -= vlan_name_len;\r\nwhile (vlan_info_left > 0) {\r\ntype = tvb_get_guint8(tvb, offset + 0);\r\nlength = tvb_get_guint8(tvb, offset + 1);\r\ntlv_tree = proto_tree_add_subtree(vlan_info_tree, tvb, offset,\r\n2 + length*2, ett_vtp_tlv, &ti,\r\nval_to_str(type, vlan_tlv_type_vals,\r\n"Unknown TLV type: 0x%02x"));\r\nproto_tree_add_item(tlv_tree, hf_vtp_vlan_tlvtype, tvb, offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tlv_tree, hf_vtp_vlan_tlvlength, tvb, offset+1, 1, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nvlan_info_left -= 2;\r\nif (length > 0) {\r\ndissect_vlan_info_tlv(tvb, pinfo, offset, length*2, tlv_tree,\r\nti, type);\r\n}\r\noffset += length*2;\r\nvlan_info_left -= length*2;\r\n}\r\nreturn vlan_info_len;\r\n}\r\nstatic void\r\ndissect_vlan_info_tlv(tvbuff_t *tvb, packet_info *pinfo, int offset, int length,\r\nproto_tree *tree, proto_item *ti, guint8 type)\r\n{\r\nswitch (type) {\r\ncase SR_RING_NUM:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_src_route_ring_num, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Source-Routing Ring Number: Bad length %u", length);\r\n}\r\nbreak;\r\ncase SR_BRIDGE_NUM:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_src_route_bridge_num, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Source-Routing Bridge Number: Bad length %u", length);\r\n}\r\nbreak;\r\ncase STP_TYPE:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_stp_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Spanning-Tree Protocol Type: Bad length %u", length);\r\n}\r\nbreak;\r\ncase PARENT_VLAN:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_parent_vlan, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Parent VLAN: Bad length %u", length);\r\n}\r\nbreak;\r\ncase TR_BRIDGED_VLANS:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_translationally_bridged_vlans, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Translationally Bridged VLANs: Bad length %u", length);\r\n}\r\nbreak;\r\ncase PRUNING:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_pruning, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Pruning: Bad length %u", length);\r\n}\r\nbreak;\r\ncase BRIDGE_TYPE:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_bridge_type, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Bridge Type: Bad length %u", length);\r\n}\r\nbreak;\r\ncase MAX_ARE_HOP_CNT:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_max_are_hop_count, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Max ARE Hop Count: Bad length %u", length);\r\n}\r\nbreak;\r\ncase MAX_STE_HOP_CNT:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_max_ste_hop_count, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Max STE Hop Count: Bad length %u", length);\r\n}\r\nbreak;\r\ncase BACKUP_CRF_MODE:\r\nif (length == 2) {\r\nproto_tree_add_item(tree, hf_vtp_vlan_backup_crf_mode, tvb, offset, 2, ENC_BIG_ENDIAN);\r\n} else {\r\nexpert_add_info_format(pinfo, ti, &ei_vtp_vlan_tlvlength_bad, "Backup CRF Mode: Bad length %u", length);\r\n}\r\nbreak;\r\ndefault:\r\nproto_tree_add_item(tree, hf_vtp_vlan_data, tvb, offset, length, ENC_NA);\r\nbreak;\r\n}\r\n}\r\nvoid\r\nproto_register_vtp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_vtp_version,\r\n{ "Version", "vtp.version", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_code,\r\n{ "Code", "vtp.code", FT_UINT8, BASE_HEX, VALS(type_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_followers,\r\n{ "Followers", "vtp.followers", FT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Number of following Subset-Advert messages", HFILL }},\r\n{ &hf_vtp_md_len,\r\n{ "Management Domain Length", "vtp.md_len", FT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Length of management domain string", HFILL }},\r\n{ &hf_vtp_md,\r\n{ "Management Domain", "vtp.md", FT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_conf_rev_num,\r\n{ "Configuration Revision Number", "vtp.conf_rev_num", FT_UINT32, BASE_DEC, NULL, 0x0,\r\n"Revision number of the configuration information", HFILL }},\r\n{ &hf_vtp_upd_id,\r\n{ "Updater Identity", "vtp.upd_id", FT_IPv4, BASE_NONE, NULL, 0x0,\r\n"IP address of the updater", HFILL }},\r\n{ &hf_vtp_upd_ts,\r\n{ "Update Timestamp", "vtp.upd_ts", FT_STRING, BASE_NONE, NULL, 0,\r\n"Time stamp of the current configuration revision", HFILL }},\r\n{ &hf_vtp_md5_digest,\r\n{ "MD5 Digest", "vtp.md5_digest", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_seq_num,\r\n{ "Sequence Number", "vtp.seq_num", FT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Order of this frame in the sequence of Subset-Advert frames", HFILL }},\r\n{ &hf_vtp_start_value,\r\n{ "Start Value", "vtp.start_value", FT_UINT16, BASE_HEX, NULL, 0x0,\r\n"Virtual LAN ID of first VLAN for which information is requested", HFILL }},\r\n{ &hf_vtp_vlan_info_len,\r\n{ "VLAN Information Length", "vtp.vlan_info.len", FT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Length of the VLAN information field", HFILL }},\r\n{ &hf_vtp_vlan_status,\r\n{ "Status", "vtp.vlan_info.status", FT_UINT8, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_status_vlan_susp,\r\n{ "VLAN suspended", "vtp.vlan_info.status.vlan_susp", FT_BOOLEAN, 8, NULL, VLAN_SUSPENDED,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_type,\r\n{ "VLAN Type", "vtp.vlan_info.vlan_type", FT_UINT8, BASE_HEX, VALS(vlan_type_vals), 0x0,\r\n"Type of VLAN", HFILL }},\r\n{ &hf_vtp_vlan_name_len,\r\n{ "VLAN Name Length", "vtp.vlan_info.vlan_name_len", FT_UINT8, BASE_DEC, NULL, 0x0,\r\n"Length of VLAN name string", HFILL }},\r\n{ &hf_vtp_isl_vlan_id,\r\n{ "ISL VLAN ID", "vtp.vlan_info.isl_vlan_id", FT_UINT16, BASE_HEX, NULL, 0x0,\r\n"ID of this VLAN on ISL trunks", HFILL }},\r\n{ &hf_vtp_mtu_size,\r\n{ "MTU Size", "vtp.vlan_info.mtu_size", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"MTU for this VLAN", HFILL }},\r\n{ &hf_vtp_802_10_index,\r\n{ "802.10 Index", "vtp.vlan_info.802_10_index", FT_UINT32, BASE_HEX, NULL, 0x0,\r\n"IEEE 802.10 security association identifier for this VLAN", HFILL }},\r\n{ &hf_vtp_vlan_name,\r\n{ "VLAN Name", "vtp.vlan_info.vlan_name", FT_STRING, BASE_NONE, NULL, 0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_tlvtype,\r\n{ "Type", "vtp.vlan_info.tlv_type", FT_UINT8, BASE_HEX, VALS(vlan_tlv_type_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_tlvlength,\r\n{ "Length", "vtp.vlan_info.tlv_len", FT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_pruning_first_vid,\r\n{ "First VLAN ID", "vtp.pruning.first", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"First VLAN ID for which pruning information is present", HFILL }},\r\n{ &hf_vtp_pruning_last_vid,\r\n{ "Last VLAN ID", "vtp.pruning.last", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Last VLAN ID for which pruning information is present", HFILL }},\r\n{ &hf_vtp_pruning_active_vid,\r\n{ "VLAN", "vtp.pruning.active", FT_UINT16, BASE_DEC, NULL, 0x0,\r\n"Active advertised VLAN ID", HFILL }},\r\n{ &hf_vtp_vlan_src_route_ring_num,\r\n{ "Source-Routing Ring Number", "vtp.vlan_info.src_route_ring_num", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_src_route_bridge_num,\r\n{ "Source-Routing Bridge Number", "vtp.vlan_info.src_route_bridge_num", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_stp_type,\r\n{ "Spanning-Tree Protocol Type", "vtp.vlan_info.stp_type", FT_UINT16, BASE_HEX, VALS(stp_type_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_parent_vlan,\r\n{ "Parent VLAN", "vtp.vlan_info.parent_vlan", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_translationally_bridged_vlans,\r\n{ "Translationally Bridged VLANs", "vtp.vlan_info.translationally_bridged_vlans", FT_UINT16, BASE_HEX, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_pruning,\r\n{ "Pruning", "vtp.vlan_info.pruning", FT_UINT16, BASE_HEX, VALS(pruning_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_bridge_type,\r\n{ "Bridge Type", "vtp.vlan_info.bridge_type", FT_UINT16, BASE_HEX, VALS(bridge_type_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_max_are_hop_count,\r\n{ "Max ARE Hop Count", "vtp.vlan_info.max_are_hop_count", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_max_ste_hop_count,\r\n{ "Max STE Hop Count", "vtp.vlan_info.max_ste_hop_count", FT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_backup_crf_mode,\r\n{ "Backup CRF Mode", "vtp.vlan_info.backup_crf_mode", FT_UINT16, BASE_HEX, VALS(backup_crf_mode_vals), 0x0,\r\nNULL, HFILL }},\r\n{ &hf_vtp_vlan_data,\r\n{ "Data", "vtp.vlan_info.data", FT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_vtp,\r\n&ett_vtp_vlan_info,\r\n&ett_vtp_vlan_status,\r\n&ett_vtp_tlv,\r\n&ett_vtp_pruning,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_vtp_vlan_tlvlength_bad, { "vtp.vlan_info.tlv_len.bad", PI_PROTOCOL, PI_WARN, "Bad length for TLV length", EXPFILL }},\r\n};\r\nexpert_module_t* expert_vtp;\r\nproto_vtp = proto_register_protocol("VLAN Trunking Protocol", "VTP", "vtp");\r\nproto_register_field_array(proto_vtp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_vtp = expert_register_protocol(proto_vtp);\r\nexpert_register_field_array(expert_vtp, ei, array_length(ei));\r\n}\r\nvoid\r\nproto_reg_handoff_vtp(void)\r\n{\r\ndissector_handle_t vtp_handle;\r\nvtp_handle = create_dissector_handle(dissect_vtp, proto_vtp);\r\ndissector_add_uint("llc.cisco_pid", 0x2003, vtp_handle);\r\n}
