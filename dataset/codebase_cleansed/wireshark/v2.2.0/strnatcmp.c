static int\r\nnat_isdigit(nat_char a)\r\n{\r\nreturn g_ascii_isdigit(a);\r\n}\r\nstatic int\r\nnat_isspace(nat_char a)\r\n{\r\nreturn g_ascii_isspace(a);\r\n}\r\nstatic nat_char\r\nnat_toupper(nat_char a)\r\n{\r\nreturn g_ascii_toupper(a);\r\n}\r\nstatic int\r\ncompare_right(nat_char const *a, nat_char const *b)\r\n{\r\nint bias = 0;\r\nfor (;; a++, b++) {\r\nif (!nat_isdigit(*a) && !nat_isdigit(*b))\r\nreturn bias;\r\nelse if (!nat_isdigit(*a))\r\nreturn -1;\r\nelse if (!nat_isdigit(*b))\r\nreturn +1;\r\nelse if (*a < *b) {\r\nif (!bias)\r\nbias = -1;\r\n} else if (*a > *b) {\r\nif (!bias)\r\nbias = +1;\r\n} else if (!*a && !*b)\r\nreturn bias;\r\n}\r\nreturn 0;\r\n}\r\nstatic int\r\ncompare_left(nat_char const *a, nat_char const *b)\r\n{\r\nfor (;; a++, b++) {\r\nif (!nat_isdigit(*a) && !nat_isdigit(*b))\r\nreturn 0;\r\nelse if (!nat_isdigit(*a))\r\nreturn -1;\r\nelse if (!nat_isdigit(*b))\r\nreturn +1;\r\nelse if (*a < *b)\r\nreturn -1;\r\nelse if (*a > *b)\r\nreturn +1;\r\n}\r\nreturn 0;\r\n}\r\nstatic int strnatcmp0(nat_char const *a, nat_char const *b, int fold_case)\r\n{\r\nint ai, bi;\r\nnat_char ca, cb;\r\nint fractional, result;\r\nif (!a || !b) {\r\nif (!a && !b)\r\nreturn 0;\r\nif (!a)\r\nreturn -1;\r\nreturn +1;\r\n}\r\nai = bi = 0;\r\nwhile (1) {\r\nca = a[ai]; cb = b[bi];\r\nwhile (nat_isspace(ca))\r\nca = a[++ai];\r\nwhile (nat_isspace(cb))\r\ncb = b[++bi];\r\nif (nat_isdigit(ca) && nat_isdigit(cb)) {\r\nfractional = (ca == '0' || cb == '0');\r\nif (fractional) {\r\nif ((result = compare_left(a+ai, b+bi)) != 0)\r\nreturn result;\r\n} else {\r\nif ((result = compare_right(a+ai, b+bi)) != 0)\r\nreturn result;\r\n}\r\n}\r\nif (!ca && !cb) {\r\nreturn 0;\r\n}\r\nif (fold_case) {\r\nca = nat_toupper(ca);\r\ncb = nat_toupper(cb);\r\n}\r\nif (ca < cb)\r\nreturn -1;\r\nelse if (ca > cb)\r\nreturn +1;\r\n++ai; ++bi;\r\n}\r\n}\r\nint ws_ascii_strnatcmp(nat_char const *a, nat_char const *b)\r\n{\r\nreturn strnatcmp0(a, b, 0);\r\n}\r\nint ws_ascii_strnatcasecmp(nat_char const *a, nat_char const *b)\r\n{\r\nreturn strnatcmp0(a, b, 1);\r\n}
