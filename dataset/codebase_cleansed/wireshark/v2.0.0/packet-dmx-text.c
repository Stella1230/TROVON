static void\r\ndissect_dmx_text(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "DMX Text");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (tree != NULL) {\r\nguint offset = 0;\r\nguint size;\r\nproto_tree *ti = proto_tree_add_item(tree, proto_dmx_text, tvb,\r\noffset, -1, ENC_NA);\r\nproto_tree *dmx_text_tree = proto_item_add_subtree(ti, ett_dmx_text);\r\nproto_tree_add_item(dmx_text_tree, hf_dmx_text_page_nr, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nproto_tree_add_item(dmx_text_tree, hf_dmx_text_line_len, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\noffset++;\r\nsize = tvb_reported_length_remaining(tvb, offset);\r\nproto_tree_add_item(dmx_text_tree, hf_dmx_text_string, tvb,\r\noffset, size, ENC_ASCII|ENC_NA);\r\n}\r\n}\r\nvoid\r\nproto_register_dmx_text(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_dmx_text_page_nr,\r\n{ "Page Number",\r\n"dmx_text.page_nr",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_dmx_text_line_len,\r\n{ "Line Length",\r\n"dmx_text.line_length",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_dmx_text_string,\r\n{ "Text String",\r\n"dmx_text.string",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_dmx_text\r\n};\r\nproto_dmx_text = proto_register_protocol("DMX Text Frame", "DMX Text Frame", "dmx-text");\r\nproto_register_field_array(proto_dmx_text, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("dmx-text", dissect_dmx_text, proto_dmx_text);\r\n}
