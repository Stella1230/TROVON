static void dissect_vicp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *ti;\r\nproto_tree *vicp_tree;\r\nptvcursor_t* cursor;\r\nguint len;\r\nif (tvb_reported_length_remaining(tvb, 0) < 8)\r\n{\r\nreturn;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "VICP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nti = proto_tree_add_item(tree, proto_vicp, tvb, 0, -1, ENC_NA);\r\nvicp_tree = proto_item_add_subtree(ti, ett_vicp);\r\ncursor = ptvcursor_new(vicp_tree, tvb, 0);\r\nptvcursor_add(cursor, hf_vicp_operation, 1, ENC_BIG_ENDIAN);\r\nptvcursor_add(cursor, hf_vicp_version, 1, ENC_BIG_ENDIAN);\r\nptvcursor_add(cursor, hf_vicp_sequence, 1, ENC_BIG_ENDIAN);\r\nptvcursor_add(cursor, hf_vicp_unused, 1, ENC_BIG_ENDIAN);\r\nlen=tvb_get_ntohl(tvb, ptvcursor_current_offset(cursor));\r\nptvcursor_add(cursor, hf_vicp_length, 4, ENC_BIG_ENDIAN);\r\nptvcursor_add(cursor, hf_vicp_data, len, ENC_NA);\r\nptvcursor_free(cursor);\r\n}\r\nvoid proto_register_vicp(void)\r\n{\r\nstatic hf_register_info hf[] =\r\n{\r\n{ &hf_vicp_operation,\r\n{ "Operation","vicp.operation",FT_UINT8,BASE_HEX,NULL,0x0,NULL,HFILL }\r\n},\r\n{ &hf_vicp_version,\r\n{ "Protocol version","vicp.version",FT_UINT8,BASE_DEC,NULL,0x0,NULL,HFILL }\r\n},\r\n{ &hf_vicp_sequence,\r\n{ "Sequence number","vicp.sequence",FT_UINT8,BASE_DEC,NULL,0x0,NULL,HFILL }\r\n},\r\n{ &hf_vicp_unused,\r\n{ "Unused","vicp.unused",FT_UINT8,BASE_HEX,NULL,0x0,NULL,HFILL }\r\n},\r\n{ &hf_vicp_length,\r\n{ "Data length","vicp.length",FT_UINT32,BASE_DEC,NULL,0x0,NULL,HFILL }\r\n},\r\n{ &hf_vicp_data,\r\n{ "Data","vicp.data",FT_BYTES,BASE_NONE,NULL,0x0,NULL,HFILL }\r\n}\r\n};\r\nstatic gint *ett[] =\r\n{ &ett_vicp\r\n};\r\nproto_vicp = proto_register_protocol("LeCroy VICP", "VICP", "vicp");\r\nproto_register_field_array(proto_vicp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_vicp(void)\r\n{ dissector_handle_t vicp_handle;\r\nvicp_handle = create_dissector_handle(dissect_vicp, proto_vicp);\r\ndissector_add_uint("tcp.port", VICP_PORT, vicp_handle);\r\n}
