static void\r\ndissect_vsif (tvbuff_t * tvb, packet_info * pinfo _U_, proto_tree * tree)\r\n{\r\nproto_item *it;\r\nproto_tree *vsif_tree;\r\nguint8 type;\r\nguint8 length;\r\nguint32 value;\r\ngint vsif_len;\r\nvsif_len = tvb_reported_length_remaining (tvb, 0);\r\ntype = tvb_get_guint8 (tvb, 0);\r\nif (type != 0x08)\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nlength = tvb_get_guint8 (tvb, 1);\r\nif (length != 3)\r\n{\r\nTHROW (ReportedBoundsError);\r\n}\r\nvalue = tvb_get_ntoh24 (tvb, 2);\r\nif (tree)\r\n{\r\nit =\r\nproto_tree_add_protocol_format (tree, proto_docsis_vsif, tvb, 0, -1,\r\n"VSIF Encodings");\r\nvsif_tree = proto_item_add_subtree (it, ett_docsis_vsif);\r\nproto_tree_add_item (vsif_tree, hf_docsis_vsif_vendorid, tvb, 2, 3, ENC_BIG_ENDIAN);\r\nswitch (value)\r\n{\r\ncase VENDOR_CISCO:\r\nproto_item_append_text (it, " (Cisco)");\r\ndissect_cisco (tvb, vsif_tree, vsif_len);\r\nbreak;\r\ndefault:\r\nproto_item_append_text (it, " (Unknown)");\r\nproto_tree_add_item (vsif_tree, hf_docsis_vsif_vendor_unknown, tvb,\r\n0, -1, ENC_NA);\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void\r\ndissect_cisco (tvbuff_t * tvb, proto_tree * tree, gint vsif_len)\r\n{\r\nint pos = 5;\r\nguint8 type, length;\r\nproto_tree *ipprec_tree;\r\nint templen;\r\nwhile (pos < vsif_len)\r\n{\r\ntype = tvb_get_guint8 (tvb, pos++);\r\nlength = tvb_get_guint8 (tvb, pos++);\r\nswitch (type)\r\n{\r\ncase NUM_PHONES:\r\nproto_tree_add_item (tree, hf_docsis_vsif_cisco_numphones, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase IP_PREC:\r\nipprec_tree =\r\nproto_tree_add_subtree(tree, tvb, pos, length, ett_docsis_vsif_ipprec, NULL, "IP Precedence");\r\ntemplen = pos + length;\r\nwhile (pos < templen)\r\n{\r\ntype = tvb_get_guint8 (tvb, pos++);\r\nlength = tvb_get_guint8 (tvb, pos++);\r\nswitch (type)\r\n{\r\ncase IP_PREC_VAL:\r\nif (length != 1)\r\nTHROW (ReportedBoundsError);\r\nproto_tree_add_item (ipprec_tree,\r\nhf_docsis_vsif_cisco_ipprec_val, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase IP_PREC_BW:\r\nif (length != 4)\r\nTHROW (ReportedBoundsError);\r\nproto_tree_add_item (ipprec_tree,\r\nhf_docsis_vsif_cisco_ipprec_bw, tvb,\r\npos, length, ENC_BIG_ENDIAN);\r\nbreak;\r\ndefault:\r\nTHROW (ReportedBoundsError);\r\n}\r\npos += length;\r\n}\r\nbreak;\r\ncase IOS_CONFIG_FILE:\r\nproto_tree_add_item (tree, hf_docsis_vsif_cisco_config_file, tvb,\r\npos, length, ENC_ASCII|ENC_NA);\r\n}\r\npos += length;\r\n}\r\n}\r\nvoid\r\nproto_register_docsis_vsif (void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_docsis_vsif_vendorid,\r\n{"Vendor Id", "docsis_vsif.vendorid",\r\nFT_UINT24, BASE_HEX, VALS(vendorid_vals), 0x0,\r\n"Vendor Identifier", HFILL}\r\n},\r\n{&hf_docsis_vsif_vendor_unknown,\r\n{"VSIF Encodings", "docsis_vsif.unknown",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\n"Unknown Vendor", HFILL}\r\n},\r\n{&hf_docsis_vsif_cisco_numphones,\r\n{"Number of phone lines", "docsis_vsif.cisco.numphones",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}\r\n},\r\n#if 0\r\n{&hf_docsis_vsif_cisco_ipprec,\r\n{"IP Precedence Encodings", "docsis_vsif.cisco.ipprec",\r\nFT_BYTES, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}\r\n},\r\n#endif\r\n{&hf_docsis_vsif_cisco_ipprec_val,\r\n{"IP Precedence Value", "docsis_vsif.cisco.ipprec.value",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}\r\n},\r\n{&hf_docsis_vsif_cisco_ipprec_bw,\r\n{"IP Precedence Bandwidth", "docsis_vsif.cisco.ipprec.bw",\r\nFT_UINT8, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL}\r\n},\r\n{&hf_docsis_vsif_cisco_config_file,\r\n{"IOS Config File", "docsis_vsif.cisco.iosfile",\r\nFT_STRING, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_docsis_vsif,\r\n&ett_docsis_vsif_ipprec,\r\n};\r\nproto_docsis_vsif =\r\nproto_register_protocol ("DOCSIS Vendor Specific Encodings",\r\n"DOCSIS VSIF", "docsis_vsif");\r\nproto_register_field_array (proto_docsis_vsif, hf, array_length (hf));\r\nproto_register_subtree_array (ett, array_length (ett));\r\nregister_dissector ("docsis_vsif", dissect_vsif, proto_docsis_vsif);\r\n}\r\nvoid\r\nproto_reg_handoff_docsis_vsif (void)\r\n{\r\n#if 0\r\ndissector_handle_t docsis_vsif_handle;\r\ndocsis_vsif_handle = find_dissector ("docsis_vsif");\r\ndissector_add_uint ("docsis", 0xFD, docsis_vsif_handle);\r\n#endif\r\n}
