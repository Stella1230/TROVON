static gboolean\r\nabout_plugins_callback(GtkWidget *widget, GdkEventButton *event, gint id _U_)\r\n{\r\nGtkTreeSelection *tree_selection;\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\ngchar *type;\r\ngchar *file;\r\ntree_selection = gtk_tree_view_get_selection (GTK_TREE_VIEW(widget));\r\nif (gtk_tree_selection_count_selected_rows (tree_selection) == 0)\r\nreturn FALSE;\r\nif (event->type != GDK_2BUTTON_PRESS)\r\nreturn FALSE;\r\nif (gtk_tree_selection_get_selected (tree_selection, &model, &iter)) {\r\ngtk_tree_model_get (model, &iter, 2, &type, -1);\r\nif (strcmp (type, "lua script") == 0) {\r\ngtk_tree_model_get (model, &iter, 3, &file, -1);\r\nbrowser_open_data_file (file);\r\ng_free (file);\r\n}\r\ng_free (type);\r\n}\r\nreturn TRUE;\r\n}\r\nstatic void\r\nplugins_add_description(const char *name, const char *version,\r\nconst char *types, const char *filename,\r\nvoid *user_data)\r\n{\r\nGtkWidget *list = (GtkWidget *)user_data;\r\nsimple_list_append(list, 0, name, 1, version,\r\n2, types, 3, filename, -1);\r\n}\r\nstatic void\r\nplugins_scan(GtkWidget *list)\r\n{\r\n#ifdef HAVE_PLUGINS\r\nplugins_get_descriptions(plugins_add_description, list);\r\n#endif\r\n#ifdef HAVE_LUA\r\nwslua_plugins_get_descriptions(plugins_add_description, list);\r\n#endif\r\n}\r\nGtkWidget *\r\nabout_plugins_page_new(void)\r\n{\r\nGtkWidget *scrolledwindow;\r\nGtkWidget *plugins_list;\r\nstatic const gchar *titles[] = {"Name", "Version", "Type", "Path"};\r\nscrolledwindow = scrolled_window_new(NULL, NULL);\r\ngtk_scrolled_window_set_shadow_type(GTK_SCROLLED_WINDOW(scrolledwindow),\r\nGTK_SHADOW_IN);\r\nplugins_list = simple_list_new(4, titles);\r\nplugins_scan(plugins_list);\r\ng_signal_connect(plugins_list, "button_press_event",\r\nG_CALLBACK(about_plugins_callback), NULL);\r\ngtk_container_add(GTK_CONTAINER(scrolledwindow), plugins_list);\r\nreturn scrolledwindow;\r\n}
