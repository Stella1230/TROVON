guint\r\nwmem_list_count(const wmem_list_t *list)\r\n{\r\nreturn list->count;\r\n}\r\nwmem_list_frame_t *\r\nwmem_list_head(const wmem_list_t *list)\r\n{\r\nreturn list->head;\r\n}\r\nwmem_list_frame_t *\r\nwmem_list_tail(const wmem_list_t *list)\r\n{\r\nreturn list->tail;\r\n}\r\nwmem_list_frame_t *\r\nwmem_list_frame_next(const wmem_list_frame_t *frame)\r\n{\r\nreturn frame->next;\r\n}\r\nwmem_list_frame_t *\r\nwmem_list_frame_prev(const wmem_list_frame_t *frame)\r\n{\r\nreturn frame->prev;\r\n}\r\nvoid *\r\nwmem_list_frame_data(const wmem_list_frame_t *frame)\r\n{\r\nreturn frame->data;\r\n}\r\nvoid\r\nwmem_list_remove(wmem_list_t *list, void *data)\r\n{\r\nwmem_list_frame_t *frame;\r\nframe = list->head;\r\nwhile (frame && frame->data != data) {\r\nframe = frame->next;\r\n}\r\nif (frame == NULL) {\r\nreturn;\r\n}\r\nwmem_list_remove_frame(list, frame);\r\n}\r\nvoid\r\nwmem_list_remove_frame(wmem_list_t *list, wmem_list_frame_t *frame)\r\n{\r\nif (frame->prev) {\r\nframe->prev->next = frame->next;\r\n}\r\nelse {\r\nlist->head = frame->next;\r\n}\r\nif (frame->next) {\r\nframe->next->prev = frame->prev;\r\n}\r\nelse {\r\nlist->tail = frame->prev;\r\n}\r\nlist->count--;\r\nwmem_free(list->allocator, frame);\r\n}\r\nvoid\r\nwmem_list_prepend(wmem_list_t *list, void *data)\r\n{\r\nwmem_list_frame_t *new_frame;\r\nnew_frame = wmem_new(list->allocator, wmem_list_frame_t);\r\nnew_frame->data = data;\r\nnew_frame->next = list->head;\r\nnew_frame->prev = NULL;\r\nif (list->head) {\r\nlist->head->prev = new_frame;\r\n}\r\nelse {\r\nlist->tail = new_frame;\r\n}\r\nlist->head = new_frame;\r\nlist->count++;\r\n}\r\nvoid\r\nwmem_list_append(wmem_list_t *list, void *data)\r\n{\r\nwmem_list_frame_t *new_frame;\r\nnew_frame = wmem_new(list->allocator, wmem_list_frame_t);\r\nnew_frame->data = data;\r\nnew_frame->next = NULL;\r\nnew_frame->prev = list->tail;\r\nif (list->tail) {\r\nlist->tail->next = new_frame;\r\n}\r\nelse {\r\nlist->head = new_frame;\r\n}\r\nlist->tail = new_frame;\r\nlist->count++;\r\n}\r\nwmem_list_t *\r\nwmem_list_new(wmem_allocator_t *allocator)\r\n{\r\nwmem_list_t *list;\r\nlist = wmem_new(allocator, wmem_list_t);\r\nlist->count = 0;\r\nlist->head = NULL;\r\nlist->tail = NULL;\r\nlist->allocator = allocator;\r\nreturn list;\r\n}\r\nvoid\r\nwmem_destroy_list(wmem_list_t *list)\r\n{\r\nwmem_list_frame_t *cur, *next;\r\ncur = list->head;\r\nwhile (cur) {\r\nnext = cur->next;\r\nwmem_free(list->allocator, cur);\r\ncur = next;\r\n}\r\nwmem_free(list->allocator, list);\r\n}
