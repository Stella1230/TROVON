static void\r\ndissect_pingpongprotocol_ping_message(tvbuff_t *message_tvb, proto_tree *message_tree)\r\n{\r\nguint16 ping_data_length;\r\nproto_tree_add_item(message_tree, hf_ping_messageno, message_tvb, PING_MESSAGENO_OFFSET, PING_MESSAGENO_LENGTH, ENC_BIG_ENDIAN);\r\nping_data_length = tvb_get_ntohs(message_tvb, MESSAGE_LENGTH_OFFSET) - PING_DATA_OFFSET;\r\nif (ping_data_length > 0)\r\nproto_tree_add_item(message_tree, hf_ping_data, message_tvb, PING_DATA_OFFSET, ping_data_length, ENC_NA);\r\n}\r\nstatic void\r\ndissect_pingpongprotocol_pong_message(tvbuff_t *message_tvb, proto_tree *message_tree)\r\n{\r\nguint16 pong_data_length;\r\nproto_tree_add_item(message_tree, hf_pong_messageno, message_tvb, PONG_MESSAGENO_OFFSET, PONG_MESSAGENO_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(message_tree, hf_pong_replyno, message_tvb, PONG_REPLYNO_OFFSET, PONG_REPLYNO_LENGTH, ENC_BIG_ENDIAN);\r\npong_data_length = tvb_get_ntohs(message_tvb, MESSAGE_LENGTH_OFFSET) - PONG_DATA_OFFSET;\r\nif (pong_data_length > 0) {\r\nproto_tree_add_item(message_tree, hf_pong_data, message_tvb, PONG_DATA_OFFSET, pong_data_length, ENC_NA);\r\n}\r\n}\r\nstatic void\r\ndissect_pingpongprotocol_message(tvbuff_t *message_tvb, packet_info *pinfo, proto_tree *pingpongprotocol_tree)\r\n{\r\nguint8 type;\r\ntype = tvb_get_guint8(message_tvb, MESSAGE_TYPE_OFFSET);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO, "%s ", val_to_str_const(type, message_type_values, "Unknown PingPongProtocol type"));\r\nproto_tree_add_item(pingpongprotocol_tree, hf_message_type, message_tvb, MESSAGE_TYPE_OFFSET, MESSAGE_TYPE_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(pingpongprotocol_tree, hf_message_flags, message_tvb, MESSAGE_FLAGS_OFFSET, MESSAGE_FLAGS_LENGTH, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(pingpongprotocol_tree, hf_message_length, message_tvb, MESSAGE_LENGTH_OFFSET, MESSAGE_LENGTH_LENGTH, ENC_BIG_ENDIAN);\r\nswitch (type) {\r\ncase PINGPONG_PING_MESSAGE_TYPE:\r\ndissect_pingpongprotocol_ping_message(message_tvb, pingpongprotocol_tree);\r\nbreak;\r\ncase PINGPONG_PONG_MESSAGE_TYPE:\r\ndissect_pingpongprotocol_pong_message(message_tvb, pingpongprotocol_tree);\r\nbreak;\r\n}\r\n}\r\nstatic int\r\ndissect_pingpongprotocol(tvbuff_t *message_tvb, packet_info *pinfo, proto_tree *tree, void *data _U_)\r\n{\r\nproto_item *pingpongprotocol_item;\r\nproto_tree *pingpongprotocol_tree;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PingPongProtocol");\r\nif (tree) {\r\npingpongprotocol_item = proto_tree_add_item(tree, proto_pingpongprotocol, message_tvb, 0, -1, ENC_NA);\r\npingpongprotocol_tree = proto_item_add_subtree(pingpongprotocol_item, ett_pingpongprotocol);\r\n} else {\r\npingpongprotocol_tree = NULL;\r\n};\r\ndissect_pingpongprotocol_message(message_tvb, pinfo, pingpongprotocol_tree);\r\nreturn(TRUE);\r\n}\r\nvoid\r\nproto_register_pingpongprotocol(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_message_type, { "Type", "pingpongprotocol.message_type", FT_UINT8, BASE_DEC, VALS(message_type_values), 0x0, NULL, HFILL } },\r\n{ &hf_message_flags, { "Flags", "pingpongprotocol.message_flags", FT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_message_length, { "Length", "pingpongprotocol.message_length", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_ping_messageno, { "MessageNo", "pingpongprotocol.ping_messageno", FT_UINT64, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_ping_data, { "Ping_Data", "pingpongprotocol.ping_data", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_pong_messageno, { "MessageNo", "pingpongprotocol.pong_messageno", FT_UINT64, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_pong_replyno, { "ReplyNo", "pingpongprotocol.pong_replyno", FT_UINT64, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_pong_data, { "Pong_Data", "pingpongprotocol.pong_data", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pingpongprotocol\r\n};\r\nproto_pingpongprotocol = proto_register_protocol("Ping Pong Protocol", "PingPongProtocol", "pingpongprotocol");\r\nproto_register_field_array(proto_pingpongprotocol, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_pingpongprotocol(void)\r\n{\r\ndissector_handle_t pingpongprotocol_handle;\r\npingpongprotocol_handle = new_create_dissector_handle(dissect_pingpongprotocol, proto_pingpongprotocol);\r\ndissector_add_uint("sctp.ppi", PINGPONGPROTOCOL_PAYLOAD_PROTOCOL_ID_LEGACY, pingpongprotocol_handle);\r\ndissector_add_uint("sctp.ppi", PPP_PAYLOAD_PROTOCOL_ID, pingpongprotocol_handle);\r\n}
