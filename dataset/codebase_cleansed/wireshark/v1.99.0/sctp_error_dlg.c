static void\r\ndlg_destroy(GtkWidget *w _U_, gpointer user_data _U_)\r\n{\r\nsctp_error_dlg=NULL;\r\n}\r\nstatic void\r\nsctp_error_on_select_row(GtkTreeSelection *sel, gpointer user_data _U_)\r\n{\r\nGtkTreeModel *model;\r\nGtkTreeIter iter;\r\nif (gtk_tree_selection_get_selected (sel, &model, &iter)) {\r\ngtk_tree_model_get(model, &iter,\r\nFRAME_COLUMN, &(selected_packet->frame_number),\r\nTEXT_COLUMN, &(selected_packet->chunk_info),\r\nINFO_COLUMN, &(selected_packet->info_text),\r\n-1);\r\n}\r\n}\r\nstatic\r\nGtkWidget *create_list(void)\r\n{\r\nGtkListStore *list_store;\r\nGtkWidget * list;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeView *list_view;\r\nGtkTreeSelection *selection;\r\nlist_store = gtk_list_store_new(N_COLUMN,\r\nG_TYPE_UINT,\r\nG_TYPE_STRING,\r\nG_TYPE_STRING );\r\nlist = gtk_tree_view_new_with_model (GTK_TREE_MODEL (list_store));\r\nlist_view = GTK_TREE_VIEW(list);\r\ngtk_tree_view_set_fixed_height_mode(list_view, TRUE);\r\ngtk_tree_view_set_headers_clickable(list_view, TRUE);\r\ng_object_unref (G_OBJECT (list_store));\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Framenumber", renderer,\r\n"text", FRAME_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, FRAME_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Chunk Types", renderer,\r\n"text", TEXT_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, INFO_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 200);\r\ngtk_tree_view_append_column (list_view, column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Info", renderer,\r\n"text", INFO_COLUMN,\r\nNULL);\r\ngtk_tree_view_column_set_sort_column_id(column, TEXT_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 200);\r\ngtk_tree_view_append_column (list_view, column);\r\ngtk_tree_view_set_rules_hint(GTK_TREE_VIEW(list_view), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(list_view), TRUE);\r\nselection = gtk_tree_view_get_selection(GTK_TREE_VIEW(list));\r\ngtk_tree_selection_set_mode(selection, GTK_SELECTION_SINGLE);\r\ng_signal_connect(selection, "changed", G_CALLBACK(sctp_error_on_select_row), NULL);\r\nreturn list;\r\n}\r\nstatic void add_to_clist(sctp_error_info_t* errinfo)\r\n{\r\nGtkListStore *list_store = NULL;\r\nGtkTreeIter iter;\r\nlist_store = GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW (clist)));\r\ngtk_list_store_insert_with_values( list_store , &iter, G_MAXINT,\r\nFRAME_COLUMN, errinfo->frame_number,\r\nTEXT_COLUMN, errinfo->chunk_info,\r\nINFO_COLUMN, errinfo->info_text,\r\n-1);\r\n}\r\nstatic void\r\nsctp_error_on_unselect(GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\ngtk_tree_selection_unselect_all(gtk_tree_view_get_selection(GTK_TREE_VIEW(clist)));\r\n}\r\nstatic void sctp_error_dlg_update(GList *list)\r\n{\r\nGList *ilist=NULL;\r\nif (sctp_error_dlg != NULL)\r\n{\r\ngtk_list_store_clear(GTK_LIST_STORE(gtk_tree_view_get_model(GTK_TREE_VIEW(clist))));\r\nilist=list;\r\nwhile (ilist)\r\n{\r\nadd_to_clist((sctp_error_info_t*)(ilist->data));\r\nilist = g_list_next(ilist);\r\n}\r\nsctp_error_on_unselect(NULL, NULL);\r\n}\r\nlast_list = ilist;\r\n}\r\nstatic void\r\nsctp_error_on_frame (GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\nif (selected_packet==NULL)\r\nreturn;\r\nif (selected_packet)\r\ncf_goto_frame(&cfile, selected_packet->frame_number);\r\n}\r\nstatic void\r\nsctp_error_on_close (GtkButton *button _U_, gpointer user_data _U_)\r\n{\r\ngtk_grab_remove(sctp_error_dlg);\r\ngtk_widget_destroy(sctp_error_dlg);\r\n}\r\nstatic void\r\ngtk_sctperror_dlg(void)\r\n{\r\nGtkWidget *sctp_error_dlg_w;\r\nGtkWidget *vbox1;\r\nGtkWidget *scrolledwindow1;\r\nGtkWidget *hbuttonbox2;\r\nGtkWidget *bt_unselect;\r\nGtkWidget *bt_frame;\r\nGtkWidget *bt_close;\r\nsctp_error_dlg_w = window_new (GTK_WINDOW_TOPLEVEL, "Wireshark: SCTP Associations");\r\ngtk_window_set_position (GTK_WINDOW (sctp_error_dlg_w), GTK_WIN_POS_CENTER);\r\ng_signal_connect(sctp_error_dlg_w, "destroy", G_CALLBACK(dlg_destroy), NULL);\r\nvbox1 = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, 2, FALSE);\r\ngtk_container_set_border_width(GTK_CONTAINER(vbox1), 8);\r\ngtk_container_add(GTK_CONTAINER(sctp_error_dlg_w), vbox1);\r\ngtk_widget_show(vbox1);\r\nscrolledwindow1 = scrolled_window_new (NULL, NULL);\r\ngtk_widget_show (scrolledwindow1);\r\ngtk_box_pack_start (GTK_BOX (vbox1), scrolledwindow1, TRUE, TRUE, 0);\r\nclist = create_list();\r\ngtk_widget_show (clist);\r\ngtk_container_add (GTK_CONTAINER (scrolledwindow1), clist);\r\ngtk_widget_set_size_request(clist, 500, 200);\r\ngtk_widget_show(sctp_error_dlg_w);\r\nhbuttonbox2 = gtk_button_box_new(GTK_ORIENTATION_HORIZONTAL);\r\ngtk_widget_show (hbuttonbox2);\r\ngtk_box_pack_start (GTK_BOX (vbox1), hbuttonbox2, FALSE, FALSE, 0);\r\ngtk_box_set_spacing (GTK_BOX (hbuttonbox2), 5);\r\ngtk_button_box_set_layout (GTK_BUTTON_BOX (hbuttonbox2), GTK_BUTTONBOX_SPREAD);\r\nbt_unselect = gtk_button_new_with_label ("Unselect");\r\ngtk_widget_show (bt_unselect);\r\ngtk_container_add (GTK_CONTAINER (hbuttonbox2), bt_unselect);\r\nbt_frame = gtk_button_new_with_label ("Go to Frame");\r\ngtk_widget_show (bt_frame);\r\ngtk_container_add (GTK_CONTAINER (hbuttonbox2), bt_frame);\r\nbt_close = ws_gtk_button_new_from_stock(GTK_STOCK_CLOSE);\r\ngtk_widget_show (bt_close);\r\ngtk_container_add (GTK_CONTAINER (hbuttonbox2), bt_close);\r\ng_signal_connect(sctp_error_dlg_w, "destroy", G_CALLBACK(dlg_destroy), NULL);\r\ng_signal_connect(bt_unselect, "clicked", G_CALLBACK(sctp_error_on_unselect), NULL);\r\ng_signal_connect(bt_frame, "clicked", G_CALLBACK(sctp_error_on_frame), NULL);\r\ng_signal_connect(bt_close, "clicked", G_CALLBACK(sctp_error_on_close), NULL);\r\nsctp_error_dlg = sctp_error_dlg_w;\r\n}\r\nvoid sctp_error_dlg_show(sctp_assoc_info_t* assoc)\r\n{\r\nGList *list;\r\nlist =assoc->error_info_list;\r\nif (list != NULL)\r\n{\r\nif (sctp_error_dlg != NULL) {\r\nreactivate_window(sctp_error_dlg);\r\nif (list != last_list) {\r\nsctp_error_dlg_update(list);\r\n}\r\n}\r\nelse {\r\ngtk_sctperror_dlg();\r\nsctp_error_dlg_update(list);\r\n}\r\n}\r\nelse\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK,\r\n"No errors found.");\r\n}
