static gpointer\r\nfunction_new(gpointer funcdef)\r\n{\r\nfunction_t *stfuncrec;\r\ng_assert(funcdef != NULL);\r\nstfuncrec = g_new(function_t, 1);\r\nstfuncrec->magic = FUNCTION_MAGIC;\r\nstfuncrec->funcdef = (df_func_def_t *)funcdef;\r\nstfuncrec->params = NULL;\r\nreturn (gpointer) stfuncrec;\r\n}\r\nstatic gpointer\r\nfunction_dup(gconstpointer data)\r\n{\r\nconst function_t *org = (const function_t *)data;\r\nfunction_t *stfuncrec;\r\nGSList *p;\r\nstfuncrec = (function_t *)function_new(org->funcdef);\r\nfor (p = org->params; p; p = p->next) {\r\nconst stnode_t *param = (const stnode_t *)p->data;\r\nstfuncrec->params = g_slist_append(stfuncrec->params, stnode_dup(param));\r\n}\r\nreturn (gpointer) stfuncrec;\r\n}\r\nstatic void\r\nslist_stnode_free(gpointer data, gpointer user_data _U_)\r\n{\r\nstnode_free((stnode_t *)data);\r\n}\r\nvoid\r\nst_funcparams_free(GSList *params)\r\n{\r\ng_slist_foreach(params, slist_stnode_free, NULL);\r\ng_slist_free(params);\r\n}\r\nstatic void\r\nfunction_free(gpointer value)\r\n{\r\nfunction_t *stfuncrec = (function_t*)value;\r\nassert_magic(stfuncrec, FUNCTION_MAGIC);\r\nst_funcparams_free(stfuncrec->params);\r\ng_free(stfuncrec);\r\n}\r\nvoid\r\nsttype_function_set_params(stnode_t *node, GSList *params)\r\n{\r\nfunction_t *stfuncrec;\r\nstfuncrec = (function_t*)stnode_data(node);\r\nassert_magic(stfuncrec, FUNCTION_MAGIC);\r\nstfuncrec->params = params;\r\n}\r\ndf_func_def_t*\r\nsttype_function_funcdef(stnode_t *node)\r\n{\r\nfunction_t *stfuncrec;\r\nstfuncrec = (function_t*)stnode_data(node);\r\nassert_magic(stfuncrec, FUNCTION_MAGIC);\r\nreturn stfuncrec->funcdef;\r\n}\r\nGSList*\r\nsttype_function_params(stnode_t *node)\r\n{\r\nfunction_t *stfuncrec;\r\nstfuncrec = (function_t*)stnode_data(node);\r\nassert_magic(stfuncrec, FUNCTION_MAGIC);\r\nreturn stfuncrec->params;\r\n}\r\nvoid\r\nsttype_register_function(void)\r\n{\r\nstatic sttype_t function_type = {\r\nSTTYPE_FUNCTION,\r\n"FUNCTION",\r\nfunction_new,\r\nfunction_free,\r\nfunction_dup\r\n};\r\nsttype_register(&function_type);\r\n}
