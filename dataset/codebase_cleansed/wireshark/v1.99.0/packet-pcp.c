static guint get_pcp_message_len(packet_info *pinfo _U_, tvbuff_t *tvb, int offset)\r\n{\r\nreturn (guint)tvb_get_ntohl(tvb, offset);\r\n}\r\nstatic int dissect_pcp_message_creds(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nguint32 creds_length;\r\nguint32 i;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]",\r\nval_to_str(CREDS, packettypenames, "Unknown Type:0x%02x"));\r\nproto_tree_add_item(tree, hf_pcp_creds_number_of, tvb, offset, 4, ENC_BIG_ENDIAN);\r\ncreds_length = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i = 0; i < creds_length; i++) {\r\nproto_tree_add_item(tree, hf_pcp_creds_type, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_pcp_creds_vala, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_pcp_creds_valb, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(tree, hf_pcp_creds_valc, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_error(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\ngint32 error_num;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "[ERROR] ");\r\nproto_tree_add_item(tree, hf_pcp_pdu_error, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nerror_num = tvb_get_ntohl(tvb, 4);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "error=%s ",\r\nval_to_str(error_num, packettypenames_errors, "Unknown Error:%i"));\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_start(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_start_item;\r\nproto_tree *pcp_start_tree;\r\nguint32 bits_offset;\r\npcp_start_item = proto_tree_add_item(tree, hf_pcp_start, tvb, 0, -1, ENC_NA);\r\npcp_start_tree = proto_item_add_subtree(pcp_start_item, ett_pcp);\r\nbits_offset = offset*8;\r\ncol_append_str(pinfo->cinfo, COL_INFO, "[START]");\r\nproto_tree_add_item(pcp_start_tree, hf_pcp_start_status, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbits_offset += 32;\r\nproto_tree_add_bits_item(pcp_start_tree, hf_pcp_start_zero, tvb, bits_offset, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_bits_item(pcp_start_tree, hf_pcp_start_version, tvb, bits_offset+1, 7, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(pcp_start_tree, hf_pcp_start_licensed, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(pcp_start_tree, hf_pcp_start_authorize, tvb, offset, 2, ENC_BIG_ENDIAN);\r\noffset += 2;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_pmns_traverse(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_pmns_traverse_item;\r\nproto_tree *pcp_pmns_traverse_tree;\r\nguint32 name_len;\r\nguint32 padding;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]",\r\nval_to_str(PMNS_TRAVERSE, packettypenames, "Unknown Type:0x%02x"));\r\npcp_pmns_traverse_item = proto_tree_add_item(tree, hf_pcp_pmns_traverse, tvb, offset, -1, ENC_NA);\r\npcp_pmns_traverse_tree = proto_item_add_subtree(pcp_pmns_traverse_item, ett_pcp);\r\nproto_tree_add_item(pcp_pmns_traverse_tree, hf_pcp_pmns_subtype, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_traverse_tree, hf_pcp_pmns_namelen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nname_len = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_traverse_tree, hf_pcp_pmns_name, tvb, offset, name_len, ENC_ASCII|ENC_NA);\r\noffset += name_len;\r\npadding = name_len % 4;\r\nif (padding != 0) {\r\npadding = 4 - padding;\r\nproto_tree_add_item(pcp_pmns_traverse_tree, hf_pcp_pdu_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_pmns_names(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_pmns_names_item;\r\nproto_tree *pcp_pmns_names_tree;\r\nproto_item *pcp_pmns_names_name_item;\r\nproto_tree *pcp_pmns_names_name_tree;\r\nguint32 is_pmns_names_status;\r\nguint32 num_names;\r\nguint32 name_len;\r\nguint32 full_name_len;\r\nguint32 padding;\r\nguint32 i;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(PMNS_NAMES, packettypenames, "Unknown Type:0x%02x"));\r\npcp_pmns_names_item = proto_tree_add_item(tree, hf_pcp_pmns_names, tvb, offset, -1, ENC_NA);\r\npcp_pmns_names_tree = proto_item_add_subtree(pcp_pmns_names_item, ett_pcp);\r\nproto_tree_add_item(pcp_pmns_names_tree, hf_pcp_pmns_names_nstrbytes, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_names_tree, hf_pcp_pmns_names_numstatus, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nis_pmns_names_status = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_names_tree, hf_pcp_pmns_names_numnames, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_names = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i=0; i < num_names; i++) {\r\nif (is_pmns_names_status) {\r\nname_len = tvb_get_ntohl(tvb, offset+4);\r\nfull_name_len = name_len + 8;\r\n} else {\r\nname_len = tvb_get_ntohl(tvb, offset);\r\nfull_name_len = name_len + 4;\r\n}\r\npcp_pmns_names_name_item = proto_tree_add_item(pcp_pmns_names_tree, hf_pcp_pmns_names_nametree,\r\ntvb, offset, full_name_len, ENC_NA);\r\npcp_pmns_names_name_tree = proto_item_add_subtree(pcp_pmns_names_name_item, ett_pcp);\r\nif (is_pmns_names_status) {\r\nproto_tree_add_item(pcp_pmns_names_name_tree, hf_pcp_pmns_names_nametree_status,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\nproto_tree_add_item(pcp_pmns_names_name_tree, hf_pcp_pmns_names_nametree_namelen,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_names_name_tree, hf_pcp_pmns_names_nametree_name,\r\ntvb, offset, name_len, ENC_ASCII|ENC_NA);\r\noffset += name_len;\r\npadding = name_len % 4;\r\nif (padding != 0) {\r\npadding = 4 - padding;\r\nproto_tree_add_item(pcp_pmns_names_name_tree, hf_pcp_pdu_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_pmns_child(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_pmns_child_item;\r\nproto_tree *pcp_pmns_child_tree;\r\nguint32 name_len;\r\npcp_pmns_child_item = proto_tree_add_item(tree, hf_pcp_pmns_child, tvb, offset, -1, ENC_NA);\r\npcp_pmns_child_tree = proto_item_add_subtree(pcp_pmns_child_item, ett_pcp);\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(PMNS_CHILD, packettypenames, "Unknown Type:0x%02x"));\r\nproto_tree_add_item(pcp_pmns_child_tree, hf_pcp_pmns_subtype, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_child_tree, hf_pcp_pmns_namelen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nname_len = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_child_tree, hf_pcp_pmns_name, tvb, offset, name_len, ENC_ASCII|ENC_NA);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_pmns_ids(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_pmns_ids_item;\r\nproto_tree *pcp_pmns_ids_tree;\r\nguint32 num_ids;\r\nguint32 i;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]",\r\nval_to_str(PMNS_IDS, packettypenames, "Unknown Type:0x%02x"));\r\npcp_pmns_ids_item = proto_tree_add_item(tree, hf_pcp_pmns_ids, tvb, offset, -1, ENC_NA);\r\npcp_pmns_ids_tree = proto_item_add_subtree(pcp_pmns_ids_item, ett_pcp);\r\nproto_tree_add_item(pcp_pmns_ids_tree, hf_pcp_pmns_ids_status, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_pmns_ids_tree, hf_pcp_pmns_ids_numids, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_ids = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i=0; i<num_ids; i++) {\r\noffset = dissect_pcp_partial_pmid(tvb, pinfo, pcp_pmns_ids_tree, offset);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_profile(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_profile_item;\r\nproto_tree *pcp_profile_tree;\r\nproto_item *pcp_profile_profile_item;\r\nproto_tree *pcp_profile_profile_tree;\r\nguint32 num_prof;\r\nguint32 i;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(PROFILE, packettypenames, "Unknown Type:0x%02x"));\r\npcp_profile_item = proto_tree_add_item(tree, hf_pcp_profile, tvb, offset, -1, ENC_NA);\r\npcp_profile_tree = proto_item_add_subtree(pcp_profile_item, ett_pcp);\r\nproto_tree_add_item(pcp_profile_tree, hf_pcp_ctxnum, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_tree, hf_pcp_profile_g_state, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_tree, hf_pcp_profile_numprof, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_prof = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_tree, hf_pcp_pdu_padding, tvb, offset, 4, ENC_NA);\r\noffset += 4;\r\nfor (i=0; i<num_prof; i++) {\r\npcp_profile_profile_item = proto_tree_add_item(pcp_profile_tree, hf_pcp_profile_profile, tvb, offset, 32, ENC_NA);\r\npcp_profile_profile_tree = proto_item_add_subtree(pcp_profile_profile_item, ett_pcp);\r\nproto_tree_add_item(pcp_profile_profile_tree, hf_pcp_instance_indom, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_profile_tree, hf_pcp_profile_profile_state, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_profile_tree, hf_pcp_profile_profile_numinst, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_profile_tree, hf_pcp_pdu_padding, tvb, offset, 4, ENC_NA);\r\noffset += 4;\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_fetch(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_fetch_item;\r\nproto_tree *pcp_fetch_tree;\r\nguint32 num_pmid;\r\nguint32 i;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]",\r\nval_to_str(FETCH, packettypenames, "Unknown Type:0x%02x"));\r\npcp_fetch_item = proto_tree_add_item(tree, hf_pcp_fetch, tvb, offset, -1, ENC_NA);\r\npcp_fetch_tree = proto_item_add_subtree(pcp_fetch_item, ett_pcp);\r\nproto_tree_add_item(pcp_fetch_tree, hf_pcp_ctxnum, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset = dissect_pcp_partial_when(tvb, pinfo, pcp_fetch_tree, offset);\r\nproto_tree_add_item(pcp_fetch_tree, hf_pcp_fetch_numpmid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_pmid = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i=0; i<num_pmid; i++) {\r\noffset = dissect_pcp_partial_pmid(tvb, pinfo, pcp_fetch_tree, offset);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_result(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_results_item;\r\nproto_tree *pcp_results_tree;\r\nproto_item *pcp_result_item;\r\nproto_tree *pcp_result_tree;\r\nproto_item *pcp_result_instance_item;\r\nproto_tree *pcp_result_instance_tree;\r\nguint32 num_pmid;\r\nguint32 num_val;\r\nguint32 offset_start;\r\nguint32 valfmt_type;\r\nguint32 value_type;\r\nguint32 pmvalueblock_offset;\r\nguint32 pmvalueblock_value_length;\r\nguint32 i;\r\nguint32 j;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(RESULT, packettypenames, "Unknown Type:0x%02x"));\r\npcp_results_item = proto_tree_add_item(tree, hf_pcp_results, tvb, offset, -1, ENC_NA);\r\npcp_results_tree = proto_item_add_subtree(pcp_results_item, ett_pcp);\r\noffset = dissect_pcp_partial_when(tvb, pinfo, pcp_results_tree, offset);\r\nproto_tree_add_item(pcp_results_tree, hf_pcp_results_numpmid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_pmid = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i=0; i<num_pmid; i++) {\r\noffset_start = offset;\r\npcp_result_item = proto_tree_add_item(pcp_results_tree, hf_pcp_result, tvb, offset, -1, ENC_NA);\r\npcp_result_tree = proto_item_add_subtree(pcp_result_item, ett_pcp);\r\noffset = dissect_pcp_partial_pmid(tvb, pinfo, pcp_result_tree, offset);\r\nproto_tree_add_item(pcp_result_tree, hf_pcp_result_numval, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_val = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nif (num_val > 0) {\r\nproto_tree_add_item(pcp_result_tree, hf_pcp_result_valfmt, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nvalfmt_type = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (j=0; j<num_val; j++) {\r\npcp_result_instance_item = proto_tree_add_item(pcp_result_tree, hf_pcp_instance,\r\ntvb, offset, 8, ENC_NA);\r\npcp_result_instance_tree = proto_item_add_subtree(pcp_result_instance_item, ett_pcp);\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_pmid_inst, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (valfmt_type == PM_VAL_INSITU) {\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_insitu,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\n} else {\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_valoffset,\r\ntvb, offset, 4, ENC_BIG_ENDIAN);\r\npmvalueblock_offset = tvb_get_ntohl(tvb, offset);\r\npmvalueblock_offset = pmvalueblock_offset * 4;\r\nvalue_type = tvb_get_guint8(tvb, pmvalueblock_offset);\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_pmid_type,\r\ntvb, pmvalueblock_offset, 1, ENC_BIG_ENDIAN);\r\npmvalueblock_offset += 1;\r\npmvalueblock_value_length = tvb_get_ntoh24(tvb, pmvalueblock_offset);\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_vallength,\r\ntvb, pmvalueblock_offset, 3, ENC_BIG_ENDIAN);\r\npmvalueblock_offset += 3;\r\nswitch (value_type) {\r\ncase PM_TYPE_32:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_int, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_U32:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_uint, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_64:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_int64, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_U64:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_uint64, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_FLOAT:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_float, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_DOUBLE:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_double, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_BIG_ENDIAN);\r\nbreak;\r\ncase PM_TYPE_STRING:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_ptr, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_ASCII|ENC_NA);\r\nbreak;\r\ncase PM_TYPE_AGGREGATE:\r\ncase PM_TYPE_AGGREGATE_STATIC:\r\nproto_tree_add_item(pcp_result_instance_tree, hf_pcp_instance_value_aggr, tvb,\r\npmvalueblock_offset, pmvalueblock_value_length-4, ENC_NA);\r\nbreak;\r\ncase PM_TYPE_EVENT:\r\nexpert_add_info(pinfo, pcp_result_instance_tree, &ei_pcp_type_event_unimplemented);\r\nbreak;\r\ncase PM_TYPE_NOSUPPORT:\r\nexpert_add_info(pinfo, pcp_result_instance_tree, &ei_pcp_type_nosupport_unsupported);\r\nbreak;\r\ncase PM_TYPE_UNKNOWN:\r\nexpert_add_info(pinfo, pcp_result_instance_tree, &ei_pcp_type_unknown_unknown_value);\r\nbreak;\r\ndefault:\r\nexpert_add_info(pinfo, pcp_result_instance_tree, &ei_pcp_unimplemented_value);\r\nbreak;\r\n}\r\n}\r\noffset += 4;\r\n}\r\n}\r\nproto_item_set_len(pcp_result_tree, offset-offset_start);\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_desc_req(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_desc_req_item;\r\nproto_tree *pcp_desc_req_tree;\r\nproto_item *pcp_desc_req_pmid_item;\r\nproto_tree *pcp_desc_req_pmid_tree;\r\nguint32 bits_offset;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(DESC_REQ, packettypenames, "Unknown Type:0x%02x"));\r\nbits_offset = offset*8;\r\npcp_desc_req_item = proto_tree_add_item(tree, hf_pcp_desc_req, tvb, offset, -1, ENC_NA);\r\npcp_desc_req_tree = proto_item_add_subtree(pcp_desc_req_item, ett_pcp);\r\npcp_desc_req_pmid_item = proto_tree_add_item(pcp_desc_req_tree, hf_pcp_pmid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\npcp_desc_req_pmid_tree = proto_item_add_subtree(pcp_desc_req_pmid_item, ett_pcp);\r\nproto_tree_add_bits_item(pcp_desc_req_pmid_tree, hf_pcp_pmid_flag, tvb, bits_offset, 1, ENC_BIG_ENDIAN);\r\nbits_offset += 1;\r\nproto_tree_add_bits_item(pcp_desc_req_pmid_tree, hf_pcp_pmid_domain, tvb, bits_offset, 9, ENC_BIG_ENDIAN);\r\nbits_offset += 9;\r\nproto_tree_add_bits_item(pcp_desc_req_pmid_tree, hf_pcp_pmid_cluster, tvb, bits_offset, 12, ENC_BIG_ENDIAN);\r\nbits_offset += 12;\r\nproto_tree_add_bits_item(pcp_desc_req_pmid_tree, hf_pcp_pmid_item, tvb, bits_offset, 10, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_desc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_desc_item;\r\nproto_tree *pcp_desc_tree;\r\nproto_item *pcp_desc_units_item;\r\nproto_tree *pcp_desc_units_tree;\r\nguint32 bits_offset;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(DESC, packettypenames, "Unknown Type:0x%02x"));\r\npcp_desc_item = proto_tree_add_item(tree, hf_pcp_desc, tvb, offset, 4, ENC_NA);\r\npcp_desc_tree = proto_item_add_subtree(pcp_desc_item, ett_pcp);\r\noffset = dissect_pcp_partial_pmid(tvb, pinfo, pcp_desc_tree, offset);\r\nproto_tree_add_item(pcp_desc_tree, hf_pcp_pmid_type, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_desc_tree, hf_pcp_instance_indom, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_desc_tree, hf_pcp_pmid_sem, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbits_offset = offset*8;\r\npcp_desc_units_item = proto_tree_add_item(pcp_desc_tree, hf_pcp_units, tvb, offset, -1, ENC_NA);\r\npcp_desc_units_tree = proto_item_add_subtree(pcp_desc_units_item, ett_pcp);\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_dimspace, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\nbits_offset += 4;\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_dimtime, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\nbits_offset += 4;\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_dimcount, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\nbits_offset += 4;\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_scalespace, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\nbits_offset += 4;\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_scaletime, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\nbits_offset += 4;\r\nproto_tree_add_bits_item(pcp_desc_units_tree, hf_pcp_units_scalecount, tvb, bits_offset, 4, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(pcp_desc_units_tree, hf_pcp_pdu_padding, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_instance_req(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_instance_req_item;\r\nproto_tree *pcp_instance_req_tree;\r\nguint32 name_len;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(INSTANCE_REQ, packettypenames, "Unknown Type:0x%02x"));\r\npcp_instance_req_item = proto_tree_add_item(tree, hf_pcp_instance_req, tvb, offset, -1, ENC_NA);\r\npcp_instance_req_tree = proto_item_add_subtree(pcp_instance_req_item, ett_pcp);\r\nproto_tree_add_item(pcp_instance_req_tree, hf_pcp_instance_indom, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\noffset = dissect_pcp_partial_when(tvb, pinfo, pcp_instance_req_tree, offset);\r\nproto_tree_add_item(pcp_instance_req_tree, hf_pcp_pmid_inst, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_instance_req_tree, hf_pcp_instance_namelen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nname_len = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nif (name_len > 0) {\r\nproto_tree_add_item(pcp_instance_req_tree, hf_pcp_instance_name, tvb, offset, name_len, ENC_ASCII|ENC_NA);\r\noffset += name_len;\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_text_req(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_text_req_item;\r\nproto_tree *pcp_text_req_tree;\r\nproto_item *pcp_text_req_type_item;\r\nproto_tree *pcp_text_req_type_tree;\r\nguint32 bits_offset;\r\nguint32 type;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(TEXT_REQ, packettypenames, "Unknown Type:0x%02x"));\r\npcp_text_req_item = proto_tree_add_item(tree, hf_pcp_text_req, tvb, offset, -1, ENC_NA);\r\npcp_text_req_tree = proto_item_add_subtree(pcp_text_req_item, ett_pcp);\r\ntype = tvb_get_ntohl(tvb, offset + 4);\r\nif (type & PM_TEXT_PMID) {\r\noffset = dissect_pcp_partial_pmid(tvb, pinfo, pcp_text_req_tree, offset);\r\n} else if (type & PM_TEXT_INDOM) {\r\nproto_tree_add_item(pcp_text_req_tree, hf_pcp_instance_indom, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\n}\r\npcp_text_req_type_item = proto_tree_add_item(pcp_text_req_tree, hf_pcp_text_type, tvb, offset, 4, ENC_NA);\r\npcp_text_req_type_tree = proto_item_add_subtree(pcp_text_req_type_item, ett_pcp);\r\nbits_offset = offset * 8 + 28;\r\nproto_tree_add_bits_item(pcp_text_req_type_tree, hf_pcp_text_type_ident, tvb, bits_offset, 2, ENC_BIG_ENDIAN);\r\nbits_offset += 2;\r\nproto_tree_add_bits_item(pcp_text_req_type_tree, hf_pcp_text_type_format, tvb, bits_offset, 2, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_text(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_text_item;\r\nproto_tree *pcp_text_tree;\r\nguint32 buflen;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(TEXT, packettypenames, "Unknown Type:0x%02x"));\r\npcp_text_item = proto_tree_add_item(tree, hf_pcp_text, tvb, offset, -1, ENC_NA);\r\npcp_text_tree = proto_item_add_subtree(pcp_text_item, ett_pcp);\r\nproto_tree_add_item(pcp_text_tree, hf_pcp_text_ident, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nbuflen = tvb_get_ntohl(tvb, offset);\r\nproto_tree_add_item(pcp_text_tree, hf_pcp_text_buflen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_text_tree, hf_pcp_text_buffer, tvb, offset, buflen, ENC_ASCII|ENC_NA);\r\noffset += buflen;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message_instance(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_instances_item;\r\nproto_tree *pcp_instances_tree;\r\nproto_item *pcp_instance_item;\r\nproto_tree *pcp_instance_tree;\r\nguint32 num_inst;\r\nguint32 i;\r\nguint32 name_len;\r\nguint32 padding;\r\ncol_append_fstr(pinfo->cinfo, COL_INFO, "[%s]", val_to_str(INSTANCE, packettypenames, "Unknown Type:0x%02x"));\r\npcp_instances_item = proto_tree_add_item(tree, hf_pcp_instances, tvb, offset, -1, ENC_NA);\r\npcp_instances_tree = proto_item_add_subtree(pcp_instances_item, ett_pcp);\r\nproto_tree_add_item(pcp_instances_tree, hf_pcp_instance_indom, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_instances_tree, hf_pcp_instances_numinst, tvb, offset, 4, ENC_BIG_ENDIAN);\r\nnum_inst = tvb_get_ntohl(tvb, offset);\r\noffset += 4;\r\nfor (i=0; i<num_inst; i++) {\r\nname_len = tvb_get_ntohl(tvb, offset+4);\r\npcp_instance_item = proto_tree_add_item(pcp_instances_tree, hf_pcp_instance, tvb, offset, name_len+8, ENC_NA);\r\npcp_instance_tree = proto_item_add_subtree(pcp_instance_item, ett_pcp);\r\nproto_tree_add_item(pcp_instance_tree, hf_pcp_pmid_inst, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_instance_tree, hf_pcp_instance_namelen, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nif (name_len > 0) {\r\nproto_tree_add_item(pcp_instance_tree, hf_pcp_instance_name, tvb, offset, name_len, ENC_ASCII|ENC_NA);\r\noffset += name_len;\r\n}\r\npadding = name_len % 4;\r\nif (padding != 0) {\r\npadding = 4 - padding;\r\nproto_tree_add_item(pcp_instance_tree, hf_pcp_pdu_padding, tvb, offset, padding, ENC_NA);\r\noffset += padding;\r\n}\r\n}\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_partial_pmid(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_pmid_item;\r\nproto_tree *pcp_pmid_tree;\r\nguint32 bits_offset;\r\nbits_offset = offset * 8;\r\npcp_pmid_item = proto_tree_add_item(tree, hf_pcp_pmid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\npcp_pmid_tree = proto_item_add_subtree(pcp_pmid_item, ett_pcp);\r\nproto_tree_add_bits_item(pcp_pmid_tree, hf_pcp_pmid_flag, tvb, bits_offset, 1, ENC_BIG_ENDIAN);\r\nbits_offset += 1;\r\nproto_tree_add_bits_item(pcp_pmid_tree, hf_pcp_pmid_domain, tvb, bits_offset, 9, ENC_BIG_ENDIAN);\r\nbits_offset += 9;\r\nproto_tree_add_bits_item(pcp_pmid_tree, hf_pcp_pmid_cluster, tvb, bits_offset, 12, ENC_BIG_ENDIAN);\r\nbits_offset += 12;\r\nproto_tree_add_bits_item(pcp_pmid_tree, hf_pcp_pmid_item, tvb, bits_offset, 10, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_partial_when(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree, int offset)\r\n{\r\nproto_item *pcp_when_item;\r\nproto_tree *pcp_when_tree;\r\npcp_when_item = proto_tree_add_item(tree, hf_pcp_when, tvb, offset, 8, ENC_NA);\r\npcp_when_tree = proto_item_add_subtree(pcp_when_item, ett_pcp);\r\nproto_tree_add_item(pcp_when_tree, hf_pcp_when_sec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_when_tree, hf_pcp_when_usec, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nreturn offset;\r\n}\r\nstatic int dissect_pcp_message(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nproto_item *root_pcp_item;\r\nproto_tree *pcp_tree;\r\nguint32 packet_type;\r\ngint32 err_bytes;\r\nint offset = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PCP");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nroot_pcp_item = proto_tree_add_item(tree, proto_pcp, tvb, 0, -1, ENC_NA);\r\npcp_tree = proto_item_add_subtree(root_pcp_item, ett_pcp);\r\npacket_type = tvb_get_ntohl(tvb, 4);\r\nif (pinfo->srcport == PCP_PORT) {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Server > Client ");\r\n} else {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Client > Server ");\r\n}\r\nproto_tree_add_item(pcp_tree, hf_pcp_pdu_length, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_tree, hf_pcp_pdu_type, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nproto_tree_add_item(pcp_tree, hf_pcp_pdu_pid, tvb, offset, 4, ENC_BIG_ENDIAN);\r\noffset += 4;\r\nswitch (packet_type) {\r\ncase CREDS:\r\ndissect_pcp_message_creds(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase START_OR_ERROR:\r\nerr_bytes = tvb_get_ntohl(tvb, offset);\r\nif (err_bytes < 0) {\r\ndissect_pcp_message_error(tvb, pinfo, pcp_tree, offset);\r\n} else {\r\ndissect_pcp_message_start(tvb, pinfo, pcp_tree, offset);\r\n}\r\nbreak;\r\ncase PMNS_TRAVERSE:\r\ndissect_pcp_message_pmns_traverse(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase PMNS_NAMES:\r\ndissect_pcp_message_pmns_names(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase PMNS_CHILD:\r\ndissect_pcp_message_pmns_child(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase PMNS_IDS:\r\ndissect_pcp_message_pmns_ids(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase PROFILE:\r\ndissect_pcp_message_profile(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase FETCH:\r\ndissect_pcp_message_fetch(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase RESULT:\r\ndissect_pcp_message_result(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase DESC_REQ:\r\ndissect_pcp_message_desc_req(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase DESC:\r\ndissect_pcp_message_desc(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase INSTANCE_REQ:\r\ndissect_pcp_message_instance_req(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase INSTANCE:\r\ndissect_pcp_message_instance(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase TEXT_REQ:\r\ndissect_pcp_message_text_req(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ncase TEXT:\r\ndissect_pcp_message_text(tvb, pinfo, pcp_tree, offset);\r\nbreak;\r\ndefault:\r\ncol_append_str(pinfo->cinfo, COL_INFO, "[UNIMPLEMENTED TYPE]");\r\nexpert_add_info(pinfo, pcp_tree, &ei_pcp_unimplemented_packet_type);\r\nbreak;\r\n}\r\nreturn tvb_length(tvb);\r\n}\r\nstatic int dissect_pcp(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree, void* data)\r\n{\r\ntcp_dissect_pdus(tvb, pinfo, tree, TRUE, PCP_HEADER_LEN, get_pcp_message_len, dissect_pcp_message, data);\r\nreturn tvb_length(tvb);\r\n}\r\nvoid proto_register_pcp(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_pcp_pdu_length,\r\n{ "PDU Length", "pcp.length",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pdu_type,\r\n{ "Type", "pcp.type",\r\nFT_UINT32, BASE_HEX,\r\nVALS(packettypenames), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pdu_pid,\r\n{ "From", "pcp.from",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pdu_error,\r\n{ "Error", "pcp.error",\r\nFT_INT32, BASE_DEC,\r\nVALS(packettypenames_errors), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pdu_padding,\r\n{ "Padding", "pcp.padding",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_creds_number_of,\r\n{ "Number of Credentials", "pcp.creds.number",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_creds_type,\r\n{ "Credentials Type", "pcp.creds.type",\r\nFT_UINT8, BASE_DEC,\r\nVALS(packettypenames_creds), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_creds_vala,\r\n{ "Credentials Value A", "pcp.creds.vala",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_creds_valb,\r\n{ "Credentials Value B", "pcp.creds.valb",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_creds_valc,\r\n{ "Credentials Value C", "pcp.creds.valc",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start,\r\n{ "Start", "pcp.start",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start_zero,\r\n{ "Start Compatibility Bit", "pcp.start.zero",\r\nFT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start_version,\r\n{ "Version", "pcp.start.version",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start_status,\r\n{ "Start Status", "pcp.start.status",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start_licensed,\r\n{ "Licensed", "pcp.start.licensed",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_start_authorize,\r\n{ "Authorize", "pcp.start.authorize",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_traverse,\r\n{ "PMNS Traverse", "pcp.pmns_traverse",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_subtype,\r\n{ "Subtype", "pcp.pmns.subtype",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_namelen,\r\n{ "Name Length", "pcp.pmns.namelen",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_name,\r\n{ "Name", "pcp.pmns.name",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names,\r\n{ "PMNS Names", "pcp.pmns_names",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_nstrbytes,\r\n{ "String Bytes", "pcp.pmns_names.nstrbytes",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_numstatus,\r\n{ "Status", "pcp.pmns_names.numstatus",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_numnames,\r\n{ "Number of Names", "pcp.pmns_names.numnames",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_nametree,\r\n{ "Names", "pcp.pmns_names.nametree",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_nametree_status,\r\n{ "Status", "pcp.pmns_names.nametree.status",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_nametree_namelen,\r\n{ "Length", "pcp.pmns_names.nametree.namelen",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_names_nametree_name,\r\n{ "Name", "pcp.pmns_names.nametree.name",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_ids,\r\n{ "PMNS IDs", "pcp.pmns_ids",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_ids_status,\r\n{ "Status", "pcp.pmns_ids.status",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_ids_numids,\r\n{ "Number of IDs", "pcp.pmns_ids.numids",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmns_child,\r\n{ "PMID Child", "pcp.pmns.child",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid,\r\n{ "PMID", "pcp.pmid",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_flag,\r\n{ "Flag", "pcp.pmid.flag",\r\nFT_BOOLEAN, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_domain,\r\n{ "Domain", "pcp.pmid.domain",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_cluster,\r\n{ "Cluster", "pcp.pmid.cluster",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_item,\r\n{ "Item", "pcp.pmid.item",\r\nFT_UINT16, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_type,\r\n{ "Type", "pcp.pmid.type",\r\nFT_INT8, BASE_DEC,\r\nVALS(packettypenames_pm_types), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_sem,\r\n{ "Type Semantics", "pcp.pmid.sem",\r\nFT_UINT32, BASE_DEC,\r\nVALS(packettypenames_pm_types_sem), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_pmid_inst,\r\n{ "Instance", "pcp.pmid.inst",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile,\r\n{ "Profile", "pcp.profile",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_ctxnum,\r\n{ "Context Number", "pcp.ctxnum",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile_g_state,\r\n{ "Global Include/Exclude State", "pcp.profile.g_state",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile_numprof,\r\n{ "Number of Profiles", "pcp.profile.numprof",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile_profile,\r\n{ "Each Profile", "pcp.profile.profile",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile_profile_state,\r\n{ "Include/Exclude State", "pcp.profile.profile.state",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_profile_profile_numinst,\r\n{ "Number Instances to Follow", "pcp.profile.profile.numinst",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_fetch,\r\n{ "Fetch", "pcp.fetch",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_fetch_numpmid,\r\n{ "Number PMIDs", "pcp.fetch.numpmid",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_when,\r\n{ "Time Value", "pcp.when",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_when_sec,\r\n{ "Seconds", "pcp.when.sec",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_when_usec,\r\n{ "Microseconds", "pcp.when.usec",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_desc_req,\r\n{ "Description Request", "pcp.desc_req",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_desc,\r\n{ "Description Response", "pcp.desc",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units,\r\n{ "PMID Units", "pcp.units",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_dimspace,\r\n{ "Dimension Space", "pcp.units.dimspace",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_dimtime,\r\n{ "Dimension Time", "pcp.units.dimtime",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_dimcount,\r\n{ "Dimension Count", "pcp.units.dimcount",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_scalespace,\r\n{ "Scale Space", "pcp.units.scalespace",\r\nFT_UINT8, BASE_DEC,\r\nVALS(packettypenames_pm_units_space), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_scaletime,\r\n{ "Scale Time", "pcp.units.scalespace",\r\nFT_UINT8, BASE_DEC,\r\nVALS(packettypenames_pm_units_time), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_units_scalecount,\r\n{ "Scale Count", "pcp.units.scalecount",\r\nFT_UINT8, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_req,\r\n{ "Instance Request", "pcp.instance_req",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instances,\r\n{ "Instance Response", "pcp.instances",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instances_numinst,\r\n{ "Number of Instances", "pcp.instance_resp.numinst",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance,\r\n{ "Instance", "pcp.instance",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_namelen,\r\n{ "Name Length", "pcp.instance.namelen",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_name,\r\n{ "Name", "pcp.instance.name",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_indom,\r\n{ "Instance Domain", "pcp.instance.indom",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_valoffset,\r\n{ "Instance Offset", "pcp.instance.valoffset",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_vallength,\r\n{ "Instance Value Length", "pcp.instance.vallength",\r\nFT_INT24, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_insitu,\r\n{ "Instance Value", "pcp.instance.value.uint",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_ptr,\r\n{ "Instance Value", "pcp.instance.value.string",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_int,\r\n{ "Instance Value", "pcp.instance.value.int",\r\nFT_INT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_uint,\r\n{ "Instance Value", "pcp.instance.value.uint",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_int64,\r\n{ "Instance Value", "pcp.instance.value.int64",\r\nFT_INT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_uint64,\r\n{ "Instance Value", "pcp.instance.value.uint64",\r\nFT_UINT64, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_float,\r\n{ "Instance Value", "pcp.instance.value.float",\r\nFT_FLOAT, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_double,\r\n{ "Instance Value", "pcp.instance.value.float",\r\nFT_DOUBLE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_instance_value_aggr,\r\n{ "Instance Value", "pcp.instance.value.bytes",\r\nFT_BYTES, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_results,\r\n{ "Fetch Results", "pcp.results",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_results_numpmid,\r\n{ "Number of PMIDs", "pcp.results.numpmid",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_result,\r\n{ "Result", "pcp.result",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_result_numval,\r\n{ "Number of Values", "pcp.result.numval",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_result_valfmt,\r\n{ "Value Encoding Format", "pcp.result.valfmt",\r\nFT_UINT32, BASE_DEC,\r\nVALS(packettypenames_valfmt), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_req,\r\n{ "Text Request", "pcp.text_req",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_type,\r\n{ "Help Text Type", "pcp.text.type",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_type_format,\r\n{ "Text Type Format", "pcp.text.type.format",\r\nFT_UINT8, BASE_DEC,\r\nVALS(packettypenames_text_type_format), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_type_ident,\r\n{ "Text Type Ident", "pcp.text.type.ident",\r\nFT_UINT8, BASE_DEC,\r\nVALS(packettypenames_text_type_ident), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text,\r\n{ "Text Response", "pcp.text",\r\nFT_NONE, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_ident,\r\n{ "Text Ident (raw)", "pcp.text.ident",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_buflen,\r\n{ "Text Buffer Length", "pcp.text.buflen",\r\nFT_UINT32, BASE_DEC,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{ &hf_pcp_text_buffer,\r\n{ "Text Buffer", "pcp.text.buffer",\r\nFT_STRING, BASE_NONE,\r\nNULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pcp,\r\n&ett_pcp_pdu_length,\r\n&ett_pcp_pdu_type,\r\n&ett_pcp_pdu_pid,\r\n&ett_pcp_pdu_error,\r\n&ett_pcp_pdu_padding,\r\n&ett_pcp_creds_number_of,\r\n&ett_pcp_creds_type,\r\n&ett_pcp_creds_vala,\r\n&ett_pcp_creds_valb,\r\n&ett_pcp_creds_valc,\r\n&ett_pcp_start,\r\n&ett_pcp_start_status,\r\n&ett_pcp_start_zero,\r\n&ett_pcp_start_version,\r\n&ett_pcp_start_licensed,\r\n&ett_pcp_start_authorize,\r\n&ett_pcp_pmns_traverse,\r\n&ett_pcp_pmns_subtype,\r\n&ett_pcp_pmns_namelen,\r\n&ett_pcp_pmns_name,\r\n&ett_pcp_pmns_names,\r\n&ett_pcp_pmns_names_nstrbytes,\r\n&ett_pcp_pmns_names_numstatus,\r\n&ett_pcp_pmns_names_numnames,\r\n&ett_pcp_pmns_names_nametree,\r\n&ett_pcp_pmns_names_nametree_status,\r\n&ett_pcp_pmns_names_nametree_namelen,\r\n&ett_pcp_pmns_names_nametree_name,\r\n&ett_pcp_pmns_ids,\r\n&ett_pcp_pmns_ids_status,\r\n&ett_pcp_pmns_ids_numids,\r\n&ett_pcp_pmns_child,\r\n&ett_pcp_pmid,\r\n&ett_pcp_pmid_flag,\r\n&ett_pcp_pmid_domain,\r\n&ett_pcp_pmid_cluster,\r\n&ett_pcp_pmid_item,\r\n&ett_pcp_pmid_type,\r\n&ett_pcp_pmid_sem,\r\n&ett_pcp_profile,\r\n&ett_pcp_ctxnum,\r\n&ett_pcp_profile_g_state,\r\n&ett_pcp_profile_numprof,\r\n&ett_pcp_profile_profile,\r\n&ett_pcp_profile_profile_state,\r\n&ett_pcp_profile_profile_numinst,\r\n&ett_pcp_fetch,\r\n&ett_pcp_fetch_numpmid,\r\n&ett_pcp_when,\r\n&ett_pcp_when_sec,\r\n&ett_pcp_when_usec,\r\n&ett_pcp_desc_req,\r\n&ett_pcp_units,\r\n&ett_pcp_units_dimspace,\r\n&ett_pcp_units_dimtime,\r\n&ett_pcp_units_dimcount,\r\n&ett_pcp_units_scalespace,\r\n&ett_pcp_units_scaletime,\r\n&ett_pcp_units_scalecount,\r\n&ett_pcp_instance,\r\n&ett_pcp_instance_req,\r\n&ett_pcp_instance_namelen,\r\n&ett_pcp_instance_name,\r\n&ett_pcp_instance_indom,\r\n&ett_pcp_instance_inst,\r\n&ett_pcp_instance_valoffset,\r\n&ett_pcp_instance_vallength,\r\n&ett_pcp_instance_value_insitu,\r\n&ett_pcp_instance_value_ptr,\r\n&ett_pcp_instance_value_int,\r\n&ett_pcp_instance_value_uint,\r\n&ett_pcp_instance_value_int64,\r\n&ett_pcp_instance_value_uint64,\r\n&ett_pcp_instance_value_float,\r\n&ett_pcp_instance_value_double,\r\n&ett_pcp_instance_value_aggr,\r\n&ett_pcp_instances,\r\n&ett_pcp_instances_numinst,\r\n&ett_pcp_results,\r\n&ett_pcp_results_numpmid,\r\n&ett_pcp_result,\r\n&ett_pcp_result_numval,\r\n&ett_pcp_result_valfmt,\r\n&ett_pcp_text_req,\r\n&ett_pcp_text_type,\r\n&ett_pcp_text_type_format,\r\n&ett_pcp_text_type_ident,\r\n&ett_pcp_text,\r\n&ett_pcp_text_ident,\r\n&ett_pcp_text_buflen,\r\n&ett_pcp_text_buffer,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_pcp_type_event_unimplemented, { "pcp.pmid.type.event.unimplemented", PI_UNDECODED, PI_WARN, "PM_TYPE_EVENT: Unimplemented Value Type", EXPFILL }},\r\n{ &ei_pcp_type_nosupport_unsupported, { "pcp.pmid.type.nosupport.unsupported", PI_UNDECODED, PI_WARN, "PM_TYPE_NOSUPPORT: Unsupported Value Type", EXPFILL }},\r\n{ &ei_pcp_type_unknown_unknown_value, { "pcp.pmid.type.unknown.unknown_value", PI_UNDECODED, PI_WARN, "PM_TYPE_UNKNOWN: Unknown Value Type", EXPFILL }},\r\n{ &ei_pcp_unimplemented_value, { "pcp.pmid.type.unimplemented", PI_UNDECODED, PI_WARN, "Unimplemented Value Type", EXPFILL }},\r\n{ &ei_pcp_unimplemented_packet_type, { "pcp.type.unimplemented", PI_UNDECODED, PI_WARN, "Unimplemented Packet Type", EXPFILL }},\r\n};\r\nexpert_module_t* expert_pcp;\r\nexpert_pcp = expert_register_protocol(proto_pcp);\r\nexpert_register_field_array(expert_pcp, ei, array_length(ei));\r\nproto_pcp = proto_register_protocol("Performance Co-Pilot", "PCP", "pcp");\r\nproto_register_field_array(proto_pcp, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_pcp(void)\r\n{\r\ndissector_handle_t pcp_handle;\r\npcp_handle = new_create_dissector_handle(dissect_pcp, proto_pcp);\r\ndissector_add_uint("tcp.port", PCP_PORT, pcp_handle);\r\n}
