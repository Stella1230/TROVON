static void\r\ndissect_mpeg_ca(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nguint offset = 0, length = 0;\r\nproto_item *ti;\r\nproto_tree *mpeg_ca_tree;\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Conditional Access Table (CA)");\r\nti = proto_tree_add_item(tree, proto_mpeg_ca, tvb, offset, -1, ENC_NA);\r\nmpeg_ca_tree = proto_item_add_subtree(ti, ett_mpeg_ca);\r\noffset += packet_mpeg_sect_header(tvb, offset, mpeg_ca_tree, &length, NULL);\r\nlength -= 4;\r\nproto_tree_add_item(mpeg_ca_tree, hf_mpeg_ca_reserved, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpeg_ca_tree, hf_mpeg_ca_version_number, tvb, offset, 3, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(mpeg_ca_tree, hf_mpeg_ca_current_next_indicator, tvb, offset, 3, ENC_BIG_ENDIAN);\r\noffset += 3;\r\nproto_tree_add_item(mpeg_ca_tree, hf_mpeg_ca_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nproto_tree_add_item(mpeg_ca_tree, hf_mpeg_ca_last_section_number, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset += 1;\r\nwhile (offset < length)\r\noffset += proto_mpeg_descriptor_dissect(tvb, offset, mpeg_ca_tree);\r\noffset += packet_mpeg_sect_crc(tvb, pinfo, mpeg_ca_tree, 0, offset);\r\nproto_item_set_len(ti, offset);\r\n}\r\nvoid\r\nproto_register_mpeg_ca(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_mpeg_ca_reserved, {\r\n"Reserved", "mpeg_ca.reserved",\r\nFT_UINT24, BASE_HEX, NULL, MPEG_CA_RESERVED_MASK,\r\nNULL, HFILL\r\n} },\r\n{ &hf_mpeg_ca_version_number, {\r\n"Version Number", "mpeg_ca.version",\r\nFT_UINT24, BASE_HEX, NULL, MPEG_CA_VERSION_NUMBER_MASK,\r\nNULL, HFILL\r\n} },\r\n{ &hf_mpeg_ca_current_next_indicator, {\r\n"Current/Next Indicator", "mpeg_ca.cur_next_ind",\r\nFT_UINT24, BASE_HEX, VALS(mpeg_ca_cur_next_vals), MPEG_CA_CURRENT_NEXT_INDICATOR_MASK,\r\nNULL, HFILL\r\n} },\r\n{ &hf_mpeg_ca_section_number, {\r\n"Section Number", "mpeg_ca.sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL\r\n} },\r\n{ &hf_mpeg_ca_last_section_number, {\r\n"Last Section Number", "mpeg_ca.last_sect_num",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\nNULL, HFILL\r\n} },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mpeg_ca,\r\n};\r\nproto_mpeg_ca = proto_register_protocol("MPEG2 Conditional Access Table", "MPEG CA", "mpeg_ca");\r\nproto_register_field_array(proto_mpeg_ca, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_mpeg_ca(void)\r\n{\r\ndissector_handle_t mpeg_ca_handle;\r\nmpeg_ca_handle = create_dissector_handle(dissect_mpeg_ca, proto_mpeg_ca);\r\ndissector_add_uint("mpeg_sect.tid", MPEG_CA_TID, mpeg_ca_handle);\r\n}
