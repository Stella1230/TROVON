static void\r\ndissect_radio (tvbuff_t * tvb, packet_info * pinfo, proto_tree * tree)\r\n{\r\nproto_item *ti = NULL;\r\nproto_tree *radio_tree = NULL;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "Radio");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\ncol_add_fstr(pinfo->cinfo, COL_TX_RATE, "%u.%u",\r\npinfo->pseudo_header->ieee_802_11.data_rate / 2,\r\npinfo->pseudo_header->ieee_802_11.data_rate & 1 ? 5 : 0);\r\ncol_add_fstr(pinfo->cinfo, COL_RSSI, "%u%%",\r\npinfo->pseudo_header->ieee_802_11.signal_level);\r\nif (tree) {\r\nti = proto_tree_add_item(tree, proto_radio, tvb, 0, 0, ENC_NA);\r\nradio_tree = proto_item_add_subtree (ti, ett_radio);\r\nproto_tree_add_uint64_format_value(radio_tree, hf_data_rate, tvb, 0, 0,\r\n(guint64)pinfo->pseudo_header->ieee_802_11.data_rate * 500000,\r\n"%u.%u Mb/s",\r\npinfo->pseudo_header->ieee_802_11.data_rate / 2,\r\npinfo->pseudo_header->ieee_802_11.data_rate & 1 ? 5 : 0);\r\nproto_tree_add_uint(radio_tree, hf_channel, tvb, 0, 0,\r\npinfo->pseudo_header->ieee_802_11.channel);\r\nproto_tree_add_uint_format_value(radio_tree, hf_signal_strength, tvb, 0, 0,\r\npinfo->pseudo_header->ieee_802_11.signal_level,\r\n"%u%%",\r\npinfo->pseudo_header->ieee_802_11.signal_level);\r\n}\r\npinfo->current_proto = "IEEE 802.11";\r\ncall_dissector(ieee80211_handle, tvb, pinfo, tree);\r\n}\r\nvoid proto_register_ieee80211_radio(void)\r\n{\r\nproto_radio = proto_register_protocol("802.11 radio information", "Radio",\r\n"radio");\r\nproto_register_field_array(proto_radio, hf_radio, array_length(hf_radio));\r\nproto_register_subtree_array(tree_array, array_length(tree_array));\r\n}\r\nvoid proto_reg_handoff_ieee80211_radio(void)\r\n{\r\ndissector_handle_t radio_handle;\r\nradio_handle = create_dissector_handle(dissect_radio, proto_radio);\r\ndissector_add_uint("wtap_encap", WTAP_ENCAP_IEEE_802_11_WITH_RADIO,\r\nradio_handle);\r\nieee80211_handle = find_dissector("wlan");\r\n}
