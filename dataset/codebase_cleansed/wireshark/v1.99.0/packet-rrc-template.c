static gint rrc_key_cmp(gconstpointer b_ptr, gconstpointer a_ptr, gpointer ignore _U_){\r\nif( GPOINTER_TO_INT(a_ptr) > GPOINTER_TO_INT(b_ptr) ){\r\nreturn -1;\r\n}\r\nreturn GPOINTER_TO_INT(a_ptr) < GPOINTER_TO_INT(b_ptr);\r\n}\r\nstatic void rrc_free_key(gpointer key _U_){\r\n}\r\nstatic void rrc_free_value(gpointer value ){\r\ng_free(value);\r\n}\r\nstatic void\r\ndissect_rrc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *rrc_item = NULL;\r\nproto_tree *rrc_tree = NULL;\r\nstruct rrc_info *rrcinf;\r\ntop_tree = tree;\r\nrrcinf = (struct rrc_info *)p_get_proto_data(wmem_file_scope(), pinfo, proto_rrc, 0);\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "RRC");\r\nmemset(num_chans_per_flow,0,sizeof(guint8)*RRC_MAX_NUM_HSDHSCH_MACDFLOW);\r\nrrc_item = proto_tree_add_item(tree, proto_rrc, tvb, 0, -1, ENC_NA);\r\nrrc_tree = proto_item_add_subtree(rrc_item, ett_rrc);\r\nif (rrcinf) {\r\nswitch (rrcinf->msgtype[pinfo->fd->subnum]) {\r\ncase RRC_MESSAGE_TYPE_PCCH:\r\ncall_dissector(rrc_pcch_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ncase RRC_MESSAGE_TYPE_UL_CCCH:\r\ncall_dissector(rrc_ul_ccch_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ncase RRC_MESSAGE_TYPE_DL_CCCH:\r\ncall_dissector(rrc_dl_ccch_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ncase RRC_MESSAGE_TYPE_UL_DCCH:\r\ncall_dissector(rrc_ul_dcch_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ncase RRC_MESSAGE_TYPE_DL_DCCH:\r\ncall_dissector(rrc_dl_dcch_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ncase RRC_MESSAGE_TYPE_BCCH_FACH:\r\ncall_dissector(rrc_bcch_fach_handle, tvb, pinfo, rrc_tree);\r\nbreak;\r\ndefault:\r\n;\r\n}\r\n}\r\n}\r\nstatic void rrc_init(void){\r\nif(hsdsch_muxed_flows){\r\ng_tree_destroy(hsdsch_muxed_flows);\r\n}\r\nif(rrc_ciph_inf){\r\ng_tree_destroy(rrc_ciph_inf);\r\n}\r\nhsdsch_muxed_flows = g_tree_new_full(rrc_key_cmp,\r\nNULL,\r\nrrc_free_key,\r\nrrc_free_value);\r\nrrc_ciph_inf = g_tree_new_full(rrc_key_cmp,\r\nNULL,\r\nNULL,\r\nrrc_free_value);\r\n}\r\nvoid proto_register_rrc(void) {\r\nstatic hf_register_info hf[] = {\r\n#include "packet-rrc-hfarr.c"\r\n{ &hf_test,\r\n{ "RAB Test", "rrc.RAB.test",\r\nFT_UINT8, BASE_DEC, NULL, 0,\r\n"rrc.RAB_Info_r6", HFILL }},\r\n{ &hf_rrc_eutra_feat_group_ind_1,\r\n{ "Indicator 1", "rrc.eutra_feat_group_ind_1",\r\nFT_BOOLEAN, BASE_NONE, TFS(&rrc_eutra_feat_group_ind_1_val), 0,\r\n"EUTRA Feature Group Indicator 1", HFILL }},\r\n{ &hf_rrc_eutra_feat_group_ind_2,\r\n{ "Indicator 2", "rrc.eutra_feat_group_ind_2",\r\nFT_BOOLEAN, BASE_NONE, TFS(&rrc_eutra_feat_group_ind_2_val), 0,\r\n"EUTRA Feature Group Indicator 2", HFILL }},\r\n{ &hf_rrc_eutra_feat_group_ind_3,\r\n{ "Indicator 3", "rrc.eutra_feat_group_ind_3",\r\nFT_BOOLEAN, BASE_NONE, TFS(&rrc_eutra_feat_group_ind_3_val), 0,\r\n"EUTRA Feature Group Indicator 3", HFILL }},\r\n{ &hf_rrc_eutra_feat_group_ind_4,\r\n{ "Indicator 4", "rrc.eutra_feat_group_ind_4",\r\nFT_BOOLEAN, BASE_NONE, TFS(&rrc_eutra_feat_group_ind_4_val), 0,\r\n"EUTRA Feature Group Indicator 4", HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_rrc,\r\n#include "packet-rrc-ettarr.c"\r\n&ett_rrc_eutraFeatureGroupIndicators,\r\n&ett_rrc_cn_CommonGSM_MAP_NAS_SysInfo,\r\n};\r\nstatic ei_register_info ei[] = {\r\n{ &ei_rrc_no_hrnti, { "rrc.no_hrnti", PI_SEQUENCE, PI_NOTE, "Did not detect any H-RNTI", EXPFILL }},\r\n};\r\nexpert_module_t* expert_rrc;\r\nproto_rrc = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_rrc, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nexpert_rrc = expert_register_protocol(proto_rrc);\r\nexpert_register_field_array(expert_rrc, ei, array_length(ei));\r\nregister_dissector("rrc", dissect_rrc, proto_rrc);\r\n#include "packet-rrc-dis-reg.c"\r\nregister_init_routine(rrc_init);\r\n}\r\nvoid\r\nproto_reg_handoff_rrc(void)\r\n{\r\ngsm_a_dtap_handle = find_dissector("gsm_a_dtap");\r\nrrc_pcch_handle = find_dissector("rrc.pcch");\r\nrrc_ul_ccch_handle = find_dissector("rrc.ul.ccch");\r\nrrc_dl_ccch_handle = find_dissector("rrc.dl.ccch");\r\nrrc_ul_dcch_handle = find_dissector("rrc.ul.dcch");\r\nrrc_dl_dcch_handle = find_dissector("rrc.dl.dcch");\r\nrrc_ue_radio_access_cap_info_handle = find_dissector("rrc.ue_radio_access_cap_info");\r\nrrc_dl_dcch_handle = find_dissector("rrc.dl.dcch");\r\nlte_rrc_ue_eutra_cap_handle = find_dissector("lte-rrc.ue_eutra_cap");\r\nlte_rrc_dl_dcch_handle = find_dissector("lte-rrc.dl.dcch");\r\nrrc_bcch_fach_handle = find_dissector("rrc.bcch.fach");\r\ngsm_rlcmac_dl_handle = find_dissector("gsm_rlcmac_dl");\r\n}
