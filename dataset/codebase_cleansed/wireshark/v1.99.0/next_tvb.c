void next_tvb_init(next_tvb_list_t *list) {\r\nlist->first = NULL;\r\nlist->last = NULL;\r\nlist->count = 0;\r\n}\r\nvoid next_tvb_add_handle(next_tvb_list_t *list, tvbuff_t *tvb, proto_tree *tree, dissector_handle_t handle) {\r\nnext_tvb_item_t *item;\r\nitem = ep_new(next_tvb_item_t);\r\nitem->type = NTVB_HANDLE;\r\nitem->handle = handle;\r\nitem->tvb = tvb;\r\nitem->tree = tree;\r\nif (list->last) {\r\nlist->last->next = item;\r\n} else {\r\nlist->first = item;\r\n}\r\nitem->next = NULL;\r\nitem->previous = list->last;\r\nlist->last = item;\r\nlist->count++;\r\n}\r\nvoid next_tvb_add_uint(next_tvb_list_t *list, tvbuff_t *tvb, proto_tree *tree, dissector_table_t table, guint32 uint_val) {\r\nnext_tvb_item_t *item;\r\nitem = ep_new(next_tvb_item_t);\r\nitem->type = NTVB_UINT;\r\nitem->table = table;\r\nitem->uint_val = uint_val;\r\nitem->tvb = tvb;\r\nitem->tree = tree;\r\nif (list->last) {\r\nlist->last->next = item;\r\n} else {\r\nlist->first = item;\r\n}\r\nitem->next = NULL;\r\nitem->previous = list->last;\r\nlist->last = item;\r\nlist->count++;\r\n}\r\nvoid next_tvb_add_string(next_tvb_list_t *list, tvbuff_t *tvb, proto_tree *tree, dissector_table_t table, const gchar *string) {\r\nnext_tvb_item_t *item;\r\nitem = ep_new(next_tvb_item_t);\r\nitem->type = NTVB_STRING;\r\nitem->table = table;\r\nitem->string = string;\r\nitem->tvb = tvb;\r\nitem->tree = tree;\r\nif (list->last) {\r\nlist->last->next = item;\r\n} else {\r\nlist->first = item;\r\n}\r\nitem->next = NULL;\r\nitem->previous = list->last;\r\nlist->last = item;\r\nlist->count++;\r\n}\r\nvoid next_tvb_call(next_tvb_list_t *list, packet_info *pinfo, proto_tree *tree, dissector_handle_t handle, dissector_handle_t data_handle) {\r\nnext_tvb_item_t *item;\r\nitem = list->first;\r\nwhile (item) {\r\nif (item->tvb && tvb_length(item->tvb)) {\r\nswitch (item->type) {\r\ncase NTVB_HANDLE:\r\ncall_dissector((item->handle) ? item->handle : ((handle) ? handle : data_handle), item->tvb, pinfo, (item->tree) ? item->tree : tree);\r\nbreak;\r\ncase NTVB_UINT:\r\ndissector_try_uint(item->table, item->uint_val, item->tvb, pinfo, (item->tree) ? item->tree : tree);\r\nbreak;\r\ncase NTVB_STRING:\r\ndissector_try_string(item->table, item->string, item->tvb, pinfo, (item->tree) ? item->tree : tree, NULL);\r\nbreak;\r\n}\r\n}\r\nitem = item->next;\r\n}\r\n}
