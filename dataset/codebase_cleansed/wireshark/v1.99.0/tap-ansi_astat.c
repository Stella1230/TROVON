static int\r\nansi_a_stat_packet(\r\nvoid *tapdata,\r\npacket_info *pinfo _U_,\r\nepan_dissect_t *edt _U_,\r\nconst void *data)\r\n{\r\nansi_a_stat_t *stat_p = (ansi_a_stat_t *)tapdata;\r\nconst ansi_a_tap_rec_t *tap_p = (const ansi_a_tap_rec_t *)data;\r\nswitch (tap_p->pdu_type)\r\n{\r\ncase BSSAP_PDU_TYPE_BSMAP:\r\nstat_p->bsmap_message_type[tap_p->message_type]++;\r\nbreak;\r\ncase BSSAP_PDU_TYPE_DTAP:\r\nstat_p->dtap_message_type[tap_p->message_type]++;\r\nbreak;\r\ndefault:\r\nreturn(0);\r\n}\r\nreturn(1);\r\n}\r\nstatic void\r\nansi_a_stat_draw(\r\nvoid *tapdata)\r\n{\r\nansi_a_stat_t *stat_p = (ansi_a_stat_t *)tapdata;\r\nguint8 i;\r\nprintf("\n");\r\nprintf("=========== ANSI A-i/f Statistics ============================\n");\r\nprintf("BSMAP\n");\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (ansi_a_ios401_bsmap_strings[i].strptr)\r\n{\r\nif (stat_p->bsmap_message_type[ansi_a_ios401_bsmap_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\nansi_a_ios401_bsmap_strings[i].value,\r\nansi_a_ios401_bsmap_strings[i].strptr,\r\nstat_p->bsmap_message_type[ansi_a_ios401_bsmap_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("\nDTAP\n");\r\nprintf("Message (ID)Type Number\n");\r\ni = 0;\r\nwhile (ansi_a_ios401_dtap_strings[i].strptr)\r\n{\r\nif (stat_p->dtap_message_type[ansi_a_ios401_dtap_strings[i].value] > 0)\r\n{\r\nprintf("0x%02x %-50s%d\n",\r\nansi_a_ios401_dtap_strings[i].value,\r\nansi_a_ios401_dtap_strings[i].strptr,\r\nstat_p->dtap_message_type[ansi_a_ios401_dtap_strings[i].value]);\r\n}\r\ni++;\r\n}\r\nprintf("==============================================================\n");\r\n}\r\nstatic void\r\nansi_a_stat_init(const char *opt_arg _U_, void* userdata _U_)\r\n{\r\nansi_a_stat_t *stat_p;\r\nGString *err_p;\r\nstat_p = (ansi_a_stat_t *)g_malloc(sizeof(ansi_a_stat_t));\r\nmemset(stat_p, 0, sizeof(ansi_a_stat_t));\r\nerr_p =\r\nregister_tap_listener("ansi_a", stat_p, NULL, 0,\r\nNULL,\r\nansi_a_stat_packet,\r\nansi_a_stat_draw);\r\nif (err_p != NULL)\r\n{\r\ng_free(stat_p);\r\ng_string_free(err_p, TRUE);\r\nexit(1);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_ansi_astat(void)\r\n{\r\nregister_stat_cmd_arg("ansi_a,", ansi_a_stat_init,NULL);\r\n}
