static void\r\ndissect_symantec(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *ti;\r\nproto_tree *symantec_tree;\r\nguint16 etypev2, etypev3;\r\ntvbuff_t *next_tvb;\r\netypev2 = tvb_get_ntohs(tvb, 6);\r\netypev3 = tvb_get_ntohs(tvb, 10);\r\nif ((etypev2 == 0) == (etypev3 == 0))\r\nreturn;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "Symantec");\r\nif (etypev3 == 0) {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Symantec Enterprise Firewall");\r\nti = proto_tree_add_protocol_format(tree, proto_symantec, tvb,\r\n0, 44, "Symantec firewall");\r\nsymantec_tree = proto_item_add_subtree(ti, ett_symantec);\r\nproto_tree_add_item(symantec_tree, hf_symantec_if, tvb,\r\n0, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_uint(symantec_tree, hf_symantec_etype, tvb,\r\n6, 2, etypev2);\r\nnext_tvb = tvb_new_subset_remaining(tvb, 44);\r\ndissector_try_uint(ethertype_dissector_table, etypev2, next_tvb, pinfo,\r\ntree);\r\n}\r\nif (etypev2 == 0) {\r\ncol_set_str(pinfo->cinfo, COL_INFO, "Symantec SGS v3");\r\nti = proto_tree_add_protocol_format(tree, proto_symantec, tvb,\r\n0, 56, "Symantec SGSv3");\r\nsymantec_tree = proto_item_add_subtree(ti, ett_symantec);\r\nproto_tree_add_item(symantec_tree, hf_symantec_if, tvb,\r\n0, 4, ENC_BIG_ENDIAN);\r\nproto_tree_add_uint(symantec_tree, hf_symantec_etype, tvb,\r\n10, 2, etypev3);\r\nnext_tvb = tvb_new_subset_remaining(tvb, 56);\r\ndissector_try_uint(ethertype_dissector_table, etypev3, next_tvb, pinfo,\r\ntree);\r\n}\r\n}\r\nvoid\r\nproto_register_symantec(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_symantec_if,\r\n{ "Interface", "symantec.if", FT_IPv4, BASE_NONE, NULL, 0x0,\r\nNULL, HFILL }},\r\n{ &hf_symantec_etype,\r\n{ "Type", "symantec.type", FT_UINT16, BASE_HEX, VALS(etype_vals), 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_symantec,\r\n};\r\nproto_symantec = proto_register_protocol("Symantec Enterprise Firewall",\r\n"Symantec", "symantec");\r\nproto_register_field_array(proto_symantec, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_symantec(void)\r\n{\r\ndissector_handle_t symantec_handle;\r\nethertype_dissector_table = find_dissector_table("ethertype");\r\nsymantec_handle = create_dissector_handle(dissect_symantec,\r\nproto_symantec);\r\ndissector_add_uint("wtap_encap", WTAP_ENCAP_SYMANTEC, symantec_handle);\r\n}
