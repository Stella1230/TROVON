void *\r\ncodec_sbc_init(void)\r\n{\r\nsbc_t *sbc;\r\nsbc = (sbc_t *) g_malloc(sizeof(sbc_t));\r\nsbc_init(sbc, 0L);\r\nreturn sbc;\r\n}\r\nvoid\r\ncodec_sbc_release(void *ctx)\r\n{\r\nsbc_t *sbc = (sbc_t *) ctx;\r\nsbc_finish(sbc);\r\ng_free(sbc);\r\n}\r\nint\r\ncodec_sbc_get_channels(void *ctx)\r\n{\r\nsbc_t *sbc = (sbc_t *) ctx;\r\nif (sbc->mode == SBC_MODE_MONO)\r\nreturn 1;\r\nreturn 2;\r\n}\r\nint\r\ncodec_sbc_get_frequency(void *ctx)\r\n{\r\nsbc_t *sbc = (sbc_t *) ctx;\r\nint frequency;\r\nswitch (sbc->frequency) {\r\ncase SBC_FREQ_16000:\r\nfrequency = 16000;\r\nbreak;\r\ncase SBC_FREQ_32000:\r\nfrequency = 32000;\r\nbreak;\r\ncase SBC_FREQ_44100:\r\nfrequency = 44100;\r\nbreak;\r\ncase SBC_FREQ_48000:\r\nfrequency = 48000;\r\nbreak;\r\ndefault:\r\nfrequency = 0;\r\n}\r\nreturn frequency;\r\n}\r\nint\r\ncodec_sbc_decode(void *ctx, const void *input, int inputSizeBytes, void *output,\r\nint *outputSizeBytes)\r\n{\r\nsize_t size_in = (size_t) inputSizeBytes;\r\nsize_t size_out = SBC_BUFFER;\r\nsize_t len;\r\nint framelen;\r\nint xframe_pos = 0;\r\nconst guint8 *data_in = (const guint8 *) input;\r\nguint8 *data_out = (guint8 *) output;\r\nsbc_t *sbc = (sbc_t *) ctx;\r\nguint8 *i_data;\r\nguint8 tmp;\r\nif (!output || !outputSizeBytes) {\r\nreturn size_out;\r\n}\r\nsbc->endian = SBC_BE;\r\nframelen = 0;\r\n*outputSizeBytes = 0;\r\nwhile (xframe_pos < inputSizeBytes) {\r\nframelen = sbc_decode(sbc, data_in, size_in, data_out, size_out, &len);\r\nxframe_pos += framelen;\r\ndata_in += framelen;\r\n*outputSizeBytes += len;\r\nfor (i_data = data_out; i_data < data_out + len; i_data += 2) {\r\ntmp = i_data[0];\r\ni_data[0] = i_data[1];\r\ni_data[1] = tmp;\r\n}\r\ndata_out += len;\r\n}\r\nreturn *outputSizeBytes;\r\n}
