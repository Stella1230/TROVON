void nstime_set_zero(nstime_t *nstime)\r\n{\r\nnstime->secs = 0;\r\nnstime->nsecs = 0;\r\n}\r\ngboolean nstime_is_zero(nstime_t *nstime)\r\n{\r\nif(nstime->secs == 0 && nstime->nsecs == 0) {\r\nreturn TRUE;\r\n} else {\r\nreturn FALSE;\r\n}\r\n}\r\nvoid nstime_set_unset(nstime_t *nstime)\r\n{\r\nnstime->secs = 0;\r\nnstime->nsecs = G_MAXINT;\r\n}\r\ngboolean nstime_is_unset(const nstime_t *nstime)\r\n{\r\nif(nstime->secs == 0 && nstime->nsecs == G_MAXINT) {\r\nreturn TRUE;\r\n} else {\r\nreturn FALSE;\r\n}\r\n}\r\nvoid nstime_copy(nstime_t *a, const nstime_t *b)\r\n{\r\na->secs = b->secs;\r\na->nsecs = b->nsecs;\r\n}\r\nvoid nstime_delta(nstime_t *delta, const nstime_t *b, const nstime_t *a )\r\n{\r\nif (b->secs == a->secs) {\r\ndelta->secs = 0;\r\ndelta->nsecs = b->nsecs - a->nsecs;\r\n} else if (b->secs <= a->secs) {\r\ndelta->secs = b->secs - a->secs;\r\ndelta->nsecs = b->nsecs - a->nsecs;\r\nif(delta->nsecs > 0) {\r\ndelta->nsecs -= NS_PER_S;\r\ndelta->secs ++;\r\n}\r\n} else {\r\ndelta->secs = b->secs - a->secs;\r\ndelta->nsecs = b->nsecs - a->nsecs;\r\nif(delta->nsecs < 0) {\r\ndelta->nsecs += NS_PER_S;\r\ndelta->secs --;\r\n}\r\n}\r\n}\r\nvoid nstime_sum(nstime_t *sum, const nstime_t *a, const nstime_t *b)\r\n{\r\nsum->secs = a->secs + b->secs;\r\nsum->nsecs = a->nsecs + b->nsecs;\r\nif(sum->nsecs>=NS_PER_S || (sum->nsecs>0 && sum->secs<0)){\r\nsum->nsecs-=NS_PER_S;\r\nsum->secs++;\r\n} else if(sum->nsecs<=-NS_PER_S || (sum->nsecs<0 && sum->secs>0)) {\r\nsum->nsecs+=NS_PER_S;\r\nsum->secs--;\r\n}\r\n}\r\nint nstime_cmp (const nstime_t *a, const nstime_t *b )\r\n{\r\nif (G_UNLIKELY(nstime_is_unset(a))) {\r\nif (G_UNLIKELY(nstime_is_unset(b))) {\r\nreturn 0;\r\n} else {\r\nreturn -1;\r\n}\r\n} else {\r\nif (G_UNLIKELY(nstime_is_unset(b))) {\r\nreturn 1;\r\n}\r\n}\r\nif (a->secs == b->secs) {\r\nreturn a->nsecs - b->nsecs;\r\n} else {\r\nreturn (int) (a->secs - b->secs);\r\n}\r\n}\r\ndouble nstime_to_msec(const nstime_t *nstime)\r\n{\r\nreturn ((double)nstime->secs*1000 + (double)nstime->nsecs/1000000);\r\n}\r\ndouble nstime_to_sec(const nstime_t *nstime)\r\n{\r\nreturn ((double)nstime->secs + (double)nstime->nsecs/1000000000);\r\n}
