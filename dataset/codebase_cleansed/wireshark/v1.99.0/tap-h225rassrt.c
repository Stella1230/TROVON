static void\r\nh225rassrt_reset(void *phs)\r\n{\r\nh225rassrt_t *hs=(h225rassrt_t *)phs;\r\nint i;\r\nfor(i=0;i<NUM_RAS_STATS;i++) {\r\nhs->ras_rtd[i].stats.num = 0;\r\nhs->ras_rtd[i].stats.min_num = 0;\r\nhs->ras_rtd[i].stats.max_num = 0;\r\nhs->ras_rtd[i].stats.min.secs = 0;\r\nhs->ras_rtd[i].stats.min.nsecs = 0;\r\nhs->ras_rtd[i].stats.max.secs = 0;\r\nhs->ras_rtd[i].stats.max.nsecs = 0;\r\nhs->ras_rtd[i].stats.tot.secs = 0;\r\nhs->ras_rtd[i].stats.tot.nsecs = 0;\r\nhs->ras_rtd[i].open_req_num = 0;\r\nhs->ras_rtd[i].disc_rsp_num = 0;\r\nhs->ras_rtd[i].req_dup_num = 0;\r\nhs->ras_rtd[i].rsp_dup_num = 0;\r\n}\r\n}\r\nstatic int\r\nh225rassrt_packet(void *phs, packet_info *pinfo _U_, epan_dissect_t *edt _U_, const void *phi)\r\n{\r\nh225rassrt_t *hs=(h225rassrt_t *)phs;\r\nconst h225_packet_info *pi=(const h225_packet_info *)phi;\r\nras_type rasmsg_type = RAS_OTHER;\r\nras_category rascategory = RAS_OTHERS;\r\nif (pi->msg_type != H225_RAS || pi->msg_tag == -1) {\r\nreturn 0;\r\n}\r\nif (pi->msg_tag < 21) {\r\nrascategory = (ras_category)(pi->msg_tag / 3);\r\nrasmsg_type = (ras_type)(pi->msg_tag % 3);\r\n}\r\nelse {\r\nreturn 0;\r\n}\r\nswitch(rasmsg_type) {\r\ncase RAS_REQUEST:\r\nif(pi->is_duplicate){\r\nhs->ras_rtd[rascategory].req_dup_num++;\r\n}\r\nelse {\r\nhs->ras_rtd[rascategory].open_req_num++;\r\n}\r\nbreak;\r\ncase RAS_CONFIRM:\r\ncase RAS_REJECT:\r\nif(pi->is_duplicate){\r\nhs->ras_rtd[rascategory].rsp_dup_num++;\r\n}\r\nelse if (!pi->request_available) {\r\nhs->ras_rtd[rascategory].disc_rsp_num++;\r\n}\r\nelse {\r\nhs->ras_rtd[rascategory].open_req_num--;\r\ntime_stat_update(&(hs->ras_rtd[rascategory].stats),&(pi->delta_time), pinfo);\r\n}\r\nbreak;\r\ndefault:\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nstatic void\r\nh225rassrt_draw(void *phs)\r\n{\r\nh225rassrt_t *hs=(h225rassrt_t *)phs;\r\nint i;\r\ntimestat_t *rtd_temp;\r\nprintf("======================================== H225 RAS Service Response Time ========================================\n");\r\nprintf("H225 RAS Service Response Time (SRT) Statistics:\n");\r\nprintf("RAS-Messages | Measurements | Min SRT | Max SRT | Avg SRT | Min in Frame | Max in Frame |\n");\r\nfor(i=0;i<NUM_RAS_STATS;i++) {\r\nrtd_temp = &(hs->ras_rtd[i].stats);\r\nif(rtd_temp->num){\r\nprintf("%s | %10u | %9.2f msec | %9.2f msec | %9.2f msec | %10u | %10u |\n",\r\nval_to_str(i,ras_message_category,"Unknown "),rtd_temp->num,\r\nnstime_to_msec(&(rtd_temp->min)), nstime_to_msec(&(rtd_temp->max)),\r\nget_average(&(rtd_temp->tot), rtd_temp->num),\r\nrtd_temp->min_num, rtd_temp->max_num\r\n);\r\n}\r\n}\r\nprintf("================================================================================================================\n");\r\nprintf("RAS-Messages | Open REQ | Discarded RSP | Repeated REQ | Repeated RSP |\n");\r\nfor(i=0;i<NUM_RAS_STATS;i++) {\r\nrtd_temp = &(hs->ras_rtd[i].stats);\r\nif(rtd_temp->num){\r\nprintf("%s | %10u | %10u | %10u | %10u |\n",\r\nval_to_str(i,ras_message_category,"Unknown "),\r\nhs->ras_rtd[i].open_req_num, hs->ras_rtd[i].disc_rsp_num,\r\nhs->ras_rtd[i].req_dup_num, hs->ras_rtd[i].rsp_dup_num\r\n);\r\n}\r\n}\r\nprintf("================================================================================================================\n");\r\n}\r\nstatic void\r\nh225rassrt_init(const char *opt_arg, void* userdata _U_)\r\n{\r\nh225rassrt_t *hs;\r\nGString *error_string;\r\nhs = g_new(h225rassrt_t,1);\r\nif(!strncmp(opt_arg,"h225,srt,",9)){\r\nhs->filter=g_strdup(opt_arg+9);\r\n} else {\r\nhs->filter=NULL;\r\n}\r\nh225rassrt_reset(hs);\r\nerror_string=register_tap_listener("h225", hs, hs->filter, 0, NULL, h225rassrt_packet, h225rassrt_draw);\r\nif(error_string){\r\ng_free(hs->filter);\r\ng_free(hs);\r\nfprintf(stderr, "tshark: Couldn't register h225,srt tap: %s\n",\r\nerror_string->str);\r\ng_string_free(error_string, TRUE);\r\nexit(1);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_h225rassrt(void)\r\n{\r\nregister_stat_cmd_arg("h225,srt", h225rassrt_init,NULL);\r\n}
