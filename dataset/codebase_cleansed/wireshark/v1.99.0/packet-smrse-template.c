static int\r\ndissect_smrse(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void *data _U_)\r\n{\r\nproto_item *item = NULL;\r\nproto_tree *tree = NULL;\r\nguint8 reserved, tag;\r\nint offset=0;\r\nasn1_ctx_t asn1_ctx;\r\nasn1_ctx_init(&asn1_ctx, ASN1_ENC_BER, TRUE, pinfo);\r\nreserved=tvb_get_guint8(tvb, 0);\r\ntag=tvb_get_guint8(tvb, 3);\r\nif( reserved!= 126 )\r\nreturn 0;\r\nif( (tag<1)||(tag>11) )\r\nreturn 0;\r\nif(parent_tree){\r\nitem = proto_tree_add_item(parent_tree, proto_smrse, tvb, 0, -1, ENC_NA);\r\ntree = proto_item_add_subtree(item, ett_smrse);\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "SMRSE");\r\ncol_add_str(pinfo->cinfo, COL_INFO, val_to_str(tag, tag_vals,"Unknown Tag:0x%02x"));\r\nproto_tree_add_item(tree, hf_smrse_reserved, tvb, 0, 1, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_smrse_length, tvb, 1, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(tree, hf_smrse_tag, tvb, 3, 1, ENC_BIG_ENDIAN);\r\nswitch(tag){\r\ncase 1:\r\ncase 2:\r\noffset=4;\r\nbreak;\r\ncase 3:\r\noffset=dissect_smrse_SMR_Bind(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 4:\r\noffset=dissect_smrse_SMR_Bind_Confirm(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 5:\r\noffset=dissect_smrse_SMR_Bind_Failure(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 6:\r\noffset=dissect_smrse_SMR_Unbind(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 7:\r\noffset=dissect_smrse_RPDataMT(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 8:\r\noffset=dissect_smrse_RPDataMO(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 9:\r\noffset=dissect_smrse_RPAck(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 10:\r\noffset=dissect_smrse_RPError(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\ncase 11:\r\noffset=dissect_smrse_RPAlertSC(FALSE, tvb, 4, &asn1_ctx, tree, -1);\r\nbreak;\r\n}\r\nreturn offset;\r\n}\r\nvoid proto_register_smrse(void) {\r\nstatic hf_register_info hf[] = {\r\n{ &hf_smrse_reserved, {\r\n"Reserved", "smrse.reserved", FT_UINT8, BASE_DEC,\r\nNULL, 0, "Reserved byte, must be 126", HFILL }},\r\n{ &hf_smrse_tag, {\r\n"Tag", "smrse.tag", FT_UINT8, BASE_DEC,\r\nVALS(tag_vals), 0, NULL, HFILL }},\r\n{ &hf_smrse_length, {\r\n"Length", "smrse.length", FT_UINT16, BASE_DEC,\r\nNULL, 0, "Length of SMRSE PDU", HFILL }},\r\n{ &hf_smrse_Octet_Format,\r\n{ "octet-Format", "smrse.octet_Format",\r\nFT_STRING, BASE_NONE, NULL, 0,\r\n"SMS-Address/address-value/octet-format", HFILL }},\r\n#include "packet-smrse-hfarr.c"\r\n};\r\nstatic gint *ett[] = {\r\n&ett_smrse,\r\n#include "packet-smrse-ettarr.c"\r\n};\r\nproto_smrse = proto_register_protocol(PNAME, PSNAME, PFNAME);\r\nproto_register_field_array(proto_smrse, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid proto_reg_handoff_smrse(void) {\r\ndissector_handle_t smrse_handle;\r\nsmrse_handle = new_create_dissector_handle(dissect_smrse, proto_smrse);\r\ndissector_add_uint("tcp.port",TCP_PORT_SMRSE, smrse_handle);\r\n}
