static int\r\nsmbsids_packet(void *pss _U_, packet_info *pinfo _U_, epan_dissect_t *edt _U_, const void *psi _U_)\r\n{\r\nreturn 1;\r\n}\r\nstatic void\r\nenum_sids(gpointer key _U_, gpointer value, gpointer userdata _U_)\r\n{\r\nsid_name *sn=(sid_name *)value;\r\nprintf("%-60s %s\n", sn->sid, sn->name);\r\nreturn;\r\n}\r\nstatic void\r\nsmbsids_draw(void *pss _U_)\r\n{\r\nprintf("\n");\r\nprintf("===================================================================\n");\r\nprintf("SMB SID List:\n");\r\ng_hash_table_foreach(sid_name_table, enum_sids, NULL);\r\nprintf("===================================================================\n");\r\n}\r\nstatic void\r\nsmbsids_init(const char *opt_arg _U_, void* userdata _U_)\r\n{\r\nGString *error_string;\r\nif(!sid_name_snooping){\r\nfprintf(stderr,"The -z smb,sids function needs SMB/SID-Snooping to be enabled.\n");\r\nfprintf(stderr,"Either enable Edit/Preferences/Protocols/SMB/Snoop SID name mappings in wireshark\n");\r\nfprintf(stderr,"or override the preference file by specifying\n");\r\nfprintf(stderr," -o \"smb.sid_name_snooping=TRUE\"\n");\r\nfprintf(stderr,"on the tshark command line.\n");\r\nexit(1);\r\n}\r\nerror_string=register_tap_listener("smb", NULL, NULL, 0, NULL, smbsids_packet, smbsids_draw);\r\nif(error_string){\r\nfprintf(stderr, "tshark: Couldn't register smb,sids tap:%s\n",\r\nerror_string->str);\r\ng_string_free(error_string, TRUE);\r\nexit(1);\r\n}\r\n}\r\nvoid\r\nregister_tap_listener_smbsids(void)\r\n{\r\nregister_stat_cmd_arg("smb,sids", smbsids_init,NULL);\r\n}
