static int si_cmp(const stock_item_t * a, const stock_item_t * b) {\r\nreturn strcmp(a->name, b->name);\r\n}\r\nvoid stock_icons_init(void) {\r\nguint32 i;\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nGtkIconFactory * factory;\r\nGtkIconSet *icon_set;\r\nGtkIconSource *source16;\r\n#endif\r\nstatic const stock_pixbuf_t pixbufs[] = {\r\n{ WIRESHARK_STOCK_ABOUT, wsicon_16_pb_data, wsicon_24_pb_data },\r\n{ WIRESHARK_STOCK_CAPTURE_INTERFACES, capture_interfaces_16_pb_data, capture_interfaces_24_pb_data },\r\n{ WIRESHARK_STOCK_CAPTURE_OPTIONS, capture_options_alt1_16_pb_data, capture_options_alt1_24_pb_data },\r\n{ WIRESHARK_STOCK_CAPTURE_RESTART, capture_restart_16_pb_data, capture_restart_24_pb_data },\r\n{ WIRESHARK_STOCK_CAPTURE_START, capture_start_16_pb_data, capture_start_24_pb_data },\r\n{ WIRESHARK_STOCK_CAPTURE_STOP, capture_stop_16_pb_data, capture_stop_24_pb_data },\r\n{ WIRESHARK_STOCK_SAVE, toolbar_wireshark_file_16_pb_data, toolbar_wireshark_file_24_pb_data},\r\n{ WIRESHARK_STOCK_WIKI, gnome_emblem_web_16_pb_data, gnome_emblem_web_24_pb_data },\r\n{ NULL, NULL, NULL }\r\n};\r\nstatic const stock_pixmap_t pixmaps[] = {\r\n{ WIRESHARK_STOCK_CAPTURE_FILTER, capture_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_CAPTURE_FILTER_ENTRY, capture_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_CAPTURE_DETAILS, capture_details_24_xpm, 24},\r\n#ifdef HAVE_GEOIP\r\n{ WIRESHARK_STOCK_MAP, internet_24_xpm, 24},\r\n#endif\r\n{ WIRESHARK_STOCK_DISPLAY_FILTER, display_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_DISPLAY_FILTER_ENTRY, display_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_COLORIZE, colorize_24_xpm, 24},\r\n{ WIRESHARK_STOCK_AUTOSCROLL, autoscroll_24_xpm, 24},\r\n{ WIRESHARK_STOCK_RESIZE_COLUMNS, resize_columns_24_xpm, 24},\r\n{ WIRESHARK_STOCK_TIME, time_24_xpm, 24},\r\n{ WIRESHARK_STOCK_INTERNET, internet_24_xpm, 24},\r\n{ WIRESHARK_STOCK_WEB_SUPPORT, web_support_24_xpm, 24},\r\n{ WIRESHARK_STOCK_CONVERSATIONS, conversations_16_xpm, 16},\r\n{ WIRESHARK_STOCK_ENDPOINTS, endpoints_16_xpm, 16},\r\n{ WIRESHARK_STOCK_EXPERT_INFO, expert_info_16_xpm, 16},\r\n{ WIRESHARK_STOCK_GRAPHS, graphs_16_xpm, 16},\r\n{ WIRESHARK_STOCK_FLOW_GRAPH, flow_graph_16_xpm, 16},\r\n{ WIRESHARK_STOCK_TELEPHONY, telephony_16_xpm, 16},\r\n{ WIRESHARK_STOCK_DECODE_AS, decode_as_16_xpm, 16},\r\n{ WIRESHARK_STOCK_CHECKBOX, checkbox_16_xpm, 16},\r\n{ WIRESHARK_STOCK_FILE_SET_LIST, file_set_list_16_xpm, 16},\r\n{ WIRESHARK_STOCK_FILE_SET_NEXT, file_set_next_16_xpm, 16},\r\n{ WIRESHARK_STOCK_FILE_SET_PREVIOUS, file_set_previous_16_xpm, 16},\r\n{ WIRESHARK_STOCK_FILTER_OUT_STREAM, display_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_ENABLE, checkbox_16_xpm, 16},\r\n{ WIRESHARK_STOCK_COLOR1, icon_color_1_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR2, icon_color_2_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR3, icon_color_3_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR4, icon_color_4_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR5, icon_color_5_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR6, icon_color_6_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR7, icon_color_7_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR8, icon_color_8_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR9, icon_color_9_xpm, 24},\r\n{ WIRESHARK_STOCK_COLOR0, icon_color_0_xpm, 24},\r\n{ WIRESHARK_STOCK_DECODE, decode_24_xpm, 24},\r\n{ WIRESHARK_STOCK_AUDIO_PLAYER, audio_player_24_xpm, 24},\r\n{ WIRESHARK_STOCK_VOIP_FLOW, voip_flow_24_xpm, 24},\r\n{ WIRESHARK_STOCK_TELEPHONE, telephone_16_xpm, 16},\r\n{ WIRESHARK_STOCK_PREPARE_FILTER, display_filter_24_xpm, 24},\r\n{ WIRESHARK_STOCK_ANALYZE, analyze_24_xpm, 24},\r\n{ NULL, NULL, 0}\r\n};\r\nqsort(ws_stock_items, sizeof(ws_stock_items)/sizeof(ws_stock_items[0]),\r\nsizeof(ws_stock_items[0]), (int (*)(const void *, const void *))si_cmp);\r\nqsort(gtk_stock_items, sizeof(gtk_stock_items)/sizeof(gtk_stock_items[0]),\r\nsizeof(gtk_stock_items[0]), (int (*)(const void *, const void *))si_cmp);\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nfor (i = 0; i < (sizeof(ws_stock_items) / sizeof(ws_stock_items[0])) ; i++) {\r\nGtkStockItem stock_item =\r\n{(char *)ws_stock_items[i].name,\r\n(char *)ws_stock_items[i].label,\r\n(GdkModifierType)0, 0, NULL};\r\ngtk_stock_add(&stock_item, 1);\r\n}\r\nfactory = gtk_icon_factory_new();\r\ngtk_icon_factory_add_default(factory);\r\n#endif\r\nfor (i = 0; pixmaps[i].name != NULL; i++) {\r\nGdkPixbuf * pixbuf = gdk_pixbuf_new_from_xpm_data((const char **) (pixmaps[i].xpm_data));\r\ng_assert(pixbuf);\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nicon_set = gtk_icon_set_new_from_pixbuf (pixbuf);\r\ngtk_icon_factory_add (factory, pixmaps[i].name, icon_set);\r\ngtk_icon_set_unref (icon_set);\r\n#endif\r\ngtk_icon_theme_add_builtin_icon(pixmaps[i].name, pixmaps[i].size, pixbuf);\r\ng_object_unref (G_OBJECT (pixbuf));\r\n}\r\nfor (i = 0; pixbufs[i].name != NULL; i++) {\r\nGdkPixbuf * pixbuf24 = gdk_pixbuf_new_from_inline(-1, pixbufs[i].pb_data24, FALSE, NULL);\r\ng_assert(pixbuf24);\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nicon_set = gtk_icon_set_new_from_pixbuf(pixbuf24);\r\ngtk_icon_factory_add (factory, pixbufs[i].name, icon_set);\r\ngtk_icon_set_unref (icon_set);\r\n#endif\r\ngtk_icon_theme_add_builtin_icon(pixbufs[i].name, 24, pixbuf24);\r\nif (pixbufs[i].pb_data16) {\r\nGdkPixbuf * pixbuf16 = gdk_pixbuf_new_from_inline(-1, pixbufs[i].pb_data16, FALSE, NULL);\r\ng_assert(pixbuf16);\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nsource16 = gtk_icon_source_new();\r\ngtk_icon_source_set_pixbuf(source16, pixbuf16);\r\ngtk_icon_source_set_size_wildcarded(source16, FALSE);\r\ngtk_icon_source_set_size(source16, GTK_ICON_SIZE_MENU);\r\nsource16 = gtk_icon_source_new();\r\ngtk_icon_source_set_pixbuf(source16, pixbuf16);\r\ngtk_icon_source_set_size_wildcarded(source16, FALSE);\r\ngtk_icon_source_set_size(source16, GTK_ICON_SIZE_SMALL_TOOLBAR);\r\n#else\r\ngtk_icon_theme_add_builtin_icon(pixbufs[i].name, 16, pixbuf16);\r\n#endif\r\ng_object_unref (G_OBJECT (pixbuf16));\r\n}\r\ng_object_unref (G_OBJECT (pixbuf24));\r\n}\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nfor (i = 0; i < (sizeof(ws_stock_items) / sizeof(ws_stock_items[0])) ; i++) {\r\nstock_item_t * fallback_item = NULL;\r\nif (NULL != (fallback_item = BS(ws_stock_items[i].icon, gtk_stock_items))) {\r\nicon_set = gtk_icon_factory_lookup_default(fallback_item->name);\r\ngtk_icon_factory_add(factory, ws_stock_items[i].name, icon_set);\r\n}\r\n}\r\n#endif\r\n}\r\nGtkWidget * ws_gtk_button_new_from_stock(const gchar *stock_id) {\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nreturn gtk_button_new_from_stock(stock_id);\r\n#else\r\nGtkWidget * b;\r\nstock_item_t * i = NULL;\r\nif (NULL != (i = BS(stock_id, gtk_stock_items))) {\r\nreturn gtk_button_new_with_mnemonic(i->label);\r\n} else if (NULL != (i = BS(stock_id, ws_stock_items))) {\r\nstock_item_t * fallback_item;\r\nif (NULL != (fallback_item = BS(i->icon, gtk_stock_items))) {\r\nb = gtk_button_new_from_icon_name(fallback_item->icon, GTK_ICON_SIZE_BUTTON);\r\n} else {\r\nb = gtk_button_new_from_icon_name(i->icon, GTK_ICON_SIZE_BUTTON);\r\n}\r\ngtk_button_set_label(GTK_BUTTON(b), i->label);\r\ngtk_button_set_use_underline(GTK_BUTTON(b), TRUE);\r\nreturn b;\r\n}\r\nreturn NULL;\r\n#endif\r\n}\r\nGtkToolItem * ws_gtk_tool_button_new_from_stock(const gchar *stock_id) {\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nreturn gtk_tool_button_new_from_stock(stock_id);\r\n#else\r\nGtkToolItem * b = NULL;\r\nstock_item_t * i = NULL;\r\nif (NULL != (i = BS(stock_id, gtk_stock_items))) {\r\nb = gtk_tool_button_new(NULL, i->label);\r\ngtk_tool_button_set_use_underline(GTK_TOOL_BUTTON(b), TRUE);\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON (b), i->icon);\r\n} else if (NULL != (i = BS(stock_id, ws_stock_items))) {\r\nstock_item_t * fallback_item;\r\nif (NULL != (fallback_item = BS(i->icon, gtk_stock_items))) {\r\nb = gtk_tool_button_new(NULL, i->label);\r\ngtk_tool_button_set_use_underline(GTK_TOOL_BUTTON(b), TRUE);\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON(b), fallback_item->icon);\r\n} else {\r\nb = gtk_tool_button_new(NULL, i->label);\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON(b), i->icon);\r\n}\r\n}\r\nreturn b;\r\n#endif\r\n}\r\nGtkToolItem * ws_gtk_toggle_tool_button_new_from_stock(const gchar *stock_id) {\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nreturn gtk_toggle_tool_button_new_from_stock(stock_id);\r\n#else\r\nGtkToolItem * b = NULL;\r\nstock_item_t * i = NULL;\r\nif (NULL != (i = BS(stock_id, gtk_stock_items))) {\r\nb = gtk_toggle_tool_button_new();\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON (b), i->icon);\r\nLBL_UNDERLINE(GTK_TOOL_BUTTON, b, i);\r\n} else if (NULL != (i = BS(stock_id, ws_stock_items))) {\r\nstock_item_t * fallback_item;\r\nif (NULL != (fallback_item = BS(i->icon, gtk_stock_items))) {\r\nb = gtk_toggle_tool_button_new();\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON (b), fallback_item->icon);\r\nLBL_UNDERLINE(GTK_TOOL_BUTTON, b, i);\r\n} else {\r\nb = gtk_toggle_tool_button_new();\r\ngtk_tool_button_set_icon_name(GTK_TOOL_BUTTON (b), i->icon);\r\nLBL_UNDERLINE(GTK_TOOL_BUTTON, b, i);\r\n}\r\n}\r\nreturn b;\r\n#endif\r\n}\r\nGtkWidget * ws_gtk_image_new_from_stock(const gchar *stock_id, GtkIconSize size) {\r\n#if !GTK_CHECK_VERSION(3, WS_GTK3_MINOR_STOCK_DEPRECATION_STARTS, 0)\r\nreturn gtk_image_new_from_stock(stock_id, size);\r\n#else\r\nstock_item_t * i = NULL;\r\nif (NULL != (i = BS(stock_id, gtk_stock_items))) {\r\nreturn gtk_image_new_from_icon_name(i->icon, size);\r\n} else if (NULL != (i = BS(stock_id, ws_stock_items))) {\r\nstock_item_t * fallback_item;\r\nif (NULL != (fallback_item = BS(i->icon, gtk_stock_items))) {\r\nreturn gtk_image_new_from_icon_name(fallback_item->icon, size);\r\n} else {\r\nreturn gtk_image_new_from_icon_name(i->icon, size);\r\n}\r\n}\r\nreturn NULL;\r\n#endif\r\n}
