static void\r\nguid_fvalue_set_guid(fvalue_t *fv, const e_guid_t *value)\r\n{\r\nfv->value.guid = *value;\r\n}\r\nstatic gpointer\r\nvalue_get(fvalue_t *fv)\r\n{\r\nreturn &(fv->value.guid);\r\n}\r\nstatic gboolean\r\nget_guid(const char *s, e_guid_t *guid)\r\n{\r\nsize_t i, n;\r\nconst char *p;\r\nchar digits[9];\r\nstatic const char fmt[] = "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX";\r\nn = strlen(s);\r\nif (n != strlen(fmt))\r\nreturn FALSE;\r\nfor (i=0; i<n; i++) {\r\nif (fmt[i] == 'X') {\r\nif (!isxdigit((guchar)s[i]))\r\nreturn FALSE;\r\n} else {\r\nif (s[i] != fmt[i])\r\nreturn FALSE;\r\n}\r\n}\r\np = s;\r\nstrncpy(digits, p, 8);\r\ndigits[8] = '\0';\r\nguid->data1 = (guint32)strtoul(digits, NULL, 16);\r\np += 9;\r\nstrncpy(digits, p, 4);\r\ndigits[4] = '\0';\r\nguid->data2 = (guint16)strtoul(digits, NULL, 16);\r\np += 5;\r\nstrncpy(digits, p, 4);\r\ndigits[4] = '\0';\r\nguid->data3 = (guint16)strtoul(digits, NULL, 16);\r\np += 5;\r\nfor (i=0; i < sizeof(guid->data4); i++) {\r\nif (*p == '-') p++;\r\ndigits[0] = *(p++);\r\ndigits[1] = *(p++);\r\ndigits[2] = '\0';\r\nguid->data4[i] = (guint8)strtoul(digits, NULL, 16);\r\n}\r\nreturn TRUE;\r\n}\r\nstatic gboolean\r\nguid_from_unparsed(fvalue_t *fv, const char *s, gboolean allow_partial_value _U_, LogFunc logfunc)\r\n{\r\ne_guid_t guid;\r\nif (!get_guid(s, &guid)) {\r\nlogfunc("\"%s\" is not a valid GUID.", s);\r\nreturn FALSE;\r\n}\r\nfv->value.guid = guid;\r\nreturn TRUE;\r\n}\r\nstatic int\r\nguid_repr_len(fvalue_t *fv _U_, ftrepr_t rtype _U_)\r\n{\r\nreturn GUID_STR_LEN;\r\n}\r\nstatic void\r\nguid_to_repr(fvalue_t *fv, ftrepr_t rtype _U_, char *buf)\r\n{\r\nguid_to_str_buf(&fv->value.guid, buf, GUID_STR_LEN);\r\n}\r\nstatic gboolean\r\ncmp_eq(const fvalue_t *a, const fvalue_t *b)\r\n{\r\nreturn memcmp(&a->value.guid, &b->value.guid, sizeof(e_guid_t)) == 0;\r\n}\r\nstatic gboolean\r\ncmp_ne(const fvalue_t *a, const fvalue_t *b)\r\n{\r\nreturn memcmp(&a->value.guid, &b->value.guid, sizeof(e_guid_t)) != 0;\r\n}\r\nvoid\r\nftype_register_guid(void)\r\n{\r\nstatic ftype_t guid_type = {\r\nFT_GUID,\r\n"FT_GUID",\r\n"Globally Unique Identifier",\r\nGUID_LEN,\r\nNULL,\r\nNULL,\r\nguid_from_unparsed,\r\nNULL,\r\nguid_to_repr,\r\nguid_repr_len,\r\nNULL,\r\nNULL,\r\nguid_fvalue_set_guid,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nvalue_get,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\ncmp_eq,\r\ncmp_ne,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\nNULL,\r\n};\r\nftype_register(FT_GUID, &guid_type);\r\n}
