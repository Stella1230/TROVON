static dvb_encoding_e\r\ndvb_analyze_string_charset0(guint8 byte0)\r\n{\r\nswitch (byte0) {\r\ncase 0x01:\r\nreturn DVB_ENCODING_ISO_8859_5;\r\ncase 0x02:\r\nreturn DVB_ENCODING_ISO_8859_6;\r\ncase 0x03:\r\nreturn DVB_ENCODING_ISO_8859_7;\r\ncase 0x04:\r\nreturn DVB_ENCODING_ISO_8859_8;\r\ncase 0x05:\r\nreturn DVB_ENCODING_ISO_8859_9;\r\ncase 0x06:\r\nreturn DVB_ENCODING_ISO_8859_10;\r\ncase 0x07:\r\nreturn DVB_ENCODING_ISO_8859_11;\r\ncase 0x08:\r\nreturn DVB_ENCODING_RESERVED;\r\ncase 0x09:\r\nreturn DVB_ENCODING_ISO_8859_13;\r\ncase 0x0A:\r\nreturn DVB_ENCODING_ISO_8859_14;\r\ncase 0x0B:\r\nreturn DVB_ENCODING_ISO_8859_15;\r\ncase 0x11:\r\nreturn DVB_ENCODING_ISO_10646_BMP;\r\ncase 0x12:\r\nreturn DVB_ENCODING_KSX_1001;\r\ncase 0x13:\r\nreturn DVB_ENCODING_GB_2312;\r\ncase 0x14:\r\nreturn DVB_ENCODING_ISO_10646_BIG5;\r\ncase 0x15:\r\nreturn DVB_ENCODING_ISO_10646_UTF8_BMP;\r\ndefault:\r\nreturn DVB_ENCODING_UNKNOWN;\r\n}\r\n}\r\nstatic dvb_encoding_e\r\ndvb_analyze_string_charset0_10(guint16 byte12)\r\n{\r\nswitch (byte12) {\r\ncase 0x0000:\r\nreturn DVB_ENCODING_RESERVED;\r\ncase 0x0001:\r\nreturn DVB_ENCODING_ISO_8859_1;\r\ncase 0x0002:\r\nreturn DVB_ENCODING_ISO_8859_2;\r\ncase 0x0003:\r\nreturn DVB_ENCODING_ISO_8859_3;\r\ncase 0x0004:\r\nreturn DVB_ENCODING_ISO_8859_4;\r\ncase 0x0005:\r\nreturn DVB_ENCODING_ISO_8859_5;\r\ncase 0x0006:\r\nreturn DVB_ENCODING_ISO_8859_6;\r\ncase 0x0007:\r\nreturn DVB_ENCODING_ISO_8859_7;\r\ncase 0x0008:\r\nreturn DVB_ENCODING_ISO_8859_8;\r\ncase 0x0009:\r\nreturn DVB_ENCODING_ISO_8859_9;\r\ncase 0x000A:\r\nreturn DVB_ENCODING_ISO_8859_10;\r\ncase 0x000B:\r\nreturn DVB_ENCODING_ISO_8859_11;\r\ncase 0x000C:\r\nreturn DVB_ENCODING_RESERVED;\r\ncase 0x000D:\r\nreturn DVB_ENCODING_ISO_8859_13;\r\ncase 0x000E:\r\nreturn DVB_ENCODING_ISO_8859_14;\r\ncase 0x000F:\r\nreturn DVB_ENCODING_ISO_8859_15;\r\ndefault:\r\nreturn DVB_ENCODING_UNKNOWN;\r\n}\r\n}\r\nstatic dvb_encoding_e\r\ndvb_analyze_string_charset0_1F(guint8 byte1)\r\n{\r\nswitch (byte1) {\r\ncase 0x00:\r\nreturn DVB_ENCODING_RESERVED;\r\ncase 0x01:\r\ncase 0x02:\r\ncase 0x03:\r\ncase 0x04:\r\nreturn DVB_ENCODING_RESERVED;\r\ncase 0x05:\r\ncase 0x06:\r\nreturn DVB_ENCODING_RESERVED;\r\ndefault:\r\nreturn DVB_ENCODING_RESERVED;\r\n}\r\n}\r\nguint\r\ndvb_analyze_string_charset(tvbuff_t *tvb, int offset, int length, dvb_encoding_e *encoding)\r\n{\r\nif (length >= 1) {\r\nguint8 byte0 = tvb_get_guint8(tvb, offset + 0);\r\nif (byte0 >= 0x20) {\r\n*encoding = DVB_ENCODING_LATIN;\r\nreturn 0;\r\n} else if (byte0 == 0x1F) {\r\nif (length >= 2) {\r\n*encoding = dvb_analyze_string_charset0_1F(tvb_get_guint8(tvb, offset + 1));\r\nreturn 2;\r\n}\r\n*encoding = DVB_ENCODING_INVALID;\r\nreturn 1;\r\n} else if (byte0 >= 0x16) {\r\n*encoding = DVB_ENCODING_RESERVED;\r\nreturn 1;\r\n} else if (byte0 == 0x10) {\r\nif (length >= 3) {\r\n*encoding = dvb_analyze_string_charset0_10(tvb_get_ntohs(tvb, offset + 1));\r\nreturn 3;\r\n}\r\n*encoding = DVB_ENCODING_INVALID;\r\nreturn 1;\r\n} else if ((byte0 >= 0x0C && byte0 <= 0x0F)) {\r\n*encoding = DVB_ENCODING_RESERVED;\r\nreturn 1;\r\n} else {\r\n*encoding = dvb_analyze_string_charset0(byte0);\r\nreturn 1;\r\n}\r\n} else\r\n*encoding = DVB_ENCODING_LATIN;\r\nreturn 0;\r\n}\r\nguint\r\ndvb_enc_to_item_enc(dvb_encoding_e encoding)\r\n{\r\nswitch (encoding) {\r\ncase DVB_ENCODING_ISO_8859_1:\r\nreturn ENC_ISO_8859_1 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_2:\r\nreturn ENC_ISO_8859_2 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_3:\r\nreturn ENC_ISO_8859_3 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_4:\r\nreturn ENC_ISO_8859_4 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_5:\r\nreturn ENC_ISO_8859_5 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_6:\r\nreturn ENC_ISO_8859_6 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_7:\r\nreturn ENC_ISO_8859_7 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_8:\r\nreturn ENC_ISO_8859_8 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_9:\r\nreturn ENC_ISO_8859_9 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_10:\r\nreturn ENC_ISO_8859_10 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_11:\r\nreturn ENC_ISO_8859_11 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_13:\r\nreturn ENC_ISO_8859_13 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_14:\r\nreturn ENC_ISO_8859_14 | ENC_NA;\r\ncase DVB_ENCODING_ISO_8859_15:\r\nreturn ENC_ISO_8859_15 | ENC_NA;\r\ncase DVB_ENCODING_ISO_10646_UTF8_BMP:\r\nreturn ENC_UTF_8 | ENC_NA;\r\ndefault:\r\nreturn ENC_ASCII | ENC_NA;\r\n}\r\n}\r\nvoid\r\ndvb_add_chartbl(proto_tree *tree, int hf,\r\ntvbuff_t *tvb, gint offset, gint length, dvb_encoding_e encoding)\r\n{\r\nif (length==0) {\r\nproto_item *pi;\r\npi = proto_tree_add_text(tree, NULL, 0, 0,\r\n"Default character table (Latin)");\r\nPROTO_ITEM_SET_GENERATED(pi);\r\n}\r\nelse {\r\nproto_tree_add_bytes_format_value(tree, hf,\r\ntvb, offset, length, NULL, "%s (%s)",\r\nval_to_str_const(encoding, dvb_string_encoding_vals, "Unknown"),\r\nbytes_to_ep_str_punct(\r\ntvb_get_ptr(tvb, offset, length), length, ' '));\r\n}\r\n}
