static void\r\nproto_data_func (GtkTreeViewColumn *column _U_,\r\nGtkCellRenderer *renderer,\r\nGtkTreeModel *model,\r\nGtkTreeIter *iter,\r\ngpointer user_data)\r\n{\r\ngchar *str = NULL;\r\ngchar *grp = NULL;\r\ngint data_column = GPOINTER_TO_INT(user_data);\r\ngtk_tree_model_get(model, iter, data_column, &str, -1);\r\ngtk_tree_model_get(model, iter, GROUP_COLUMN, &grp, -1);\r\ng_object_set(renderer, "text", str, NULL);\r\nif (grp == packet) {\r\ng_object_set(renderer, "xalign", 1.0, NULL);\r\n}\r\nelse {\r\ng_object_set(renderer, "xalign", 0.0, NULL);\r\n}\r\ng_free(str);\r\n}\r\nstatic gint\r\nproto_sort_func(GtkTreeModel *model,\r\nGtkTreeIter *a,\r\nGtkTreeIter *b,\r\ngpointer user_data)\r\n{\r\ngchar *str_a = NULL;\r\ngchar *str_b = NULL;\r\ngchar *grp = NULL;\r\ngint ret = 0;\r\ngint data_column = GPOINTER_TO_INT(user_data);\r\ngtk_tree_model_get(model, a, data_column, &str_a, -1);\r\ngtk_tree_model_get(model, b, data_column, &str_b, -1);\r\ngtk_tree_model_get(model, a, GROUP_COLUMN, &grp, -1);\r\nif (str_a == str_b) {\r\nret = 0;\r\n}\r\nelse if (str_a == NULL || str_b == NULL) {\r\nret = (str_a == NULL) ? -1 : 1;\r\n}\r\nelse {\r\nif (grp == packet) {\r\ngint int_a = atoi(str_a);\r\ngint int_b = atoi(str_b);\r\nif (int_a == int_b)\r\nret = 0;\r\nelse if (int_a < int_b)\r\nret = -1;\r\nelse\r\nret = 1;\r\n}\r\nelse\r\nret = g_ascii_strcasecmp(str_a,str_b);\r\n}\r\ng_free(str_a);\r\ng_free(str_b);\r\nreturn ret;\r\n}\r\nstatic gint find_summary_data(error_equiv_table *err, const expert_info_t *expert_data)\r\n{\r\nguint i;\r\nerror_procedure_t *procedure;\r\nif (err->num_procs==0) {\r\nreturn -1;\r\n}\r\nfor (i=0;i<err->num_procs;i++) {\r\nprocedure = &g_array_index(err->procs_array, error_procedure_t, i);\r\nif (strcmp(procedure->entries[0], expert_data->protocol) == 0 &&\r\nstrcmp(procedure->entries[1], expert_data->summary) == 0) {\r\nreturn i;\r\n}\r\n}\r\nreturn -1;\r\n}\r\nstatic void\r\nerror_select_filter_cb(GtkWidget *widget _U_, gpointer callback_data, guint callback_action)\r\n{\r\nint action, type, selection;\r\nerror_equiv_table *err = (error_equiv_table *)callback_data;\r\nchar str[512];\r\nconst char *current_filter;\r\nerror_procedure_t *procedure;\r\nGtkTreeIter iter;\r\nGtkTreeModel *model;\r\nexpert_info_t expert_data;\r\ngchar *grp;\r\naction=FILTER_ACTION(callback_action);\r\ntype=FILTER_ACTYPE(callback_action);\r\nif(!gtk_tree_selection_get_selected(err->select, &model, &iter)){\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "No selection made or the table is empty");\r\nreturn;\r\n}\r\ngtk_tree_model_get (model, &iter,\r\nGROUP_COLUMN, &grp,\r\nPROTOCOL_COLUMN, &expert_data.protocol,\r\nSUMMARY_COLUMN, &expert_data.summary,\r\n-1);\r\nif (strcmp(grp, packet)==0) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "You cannot filter or search for packet number. Click on a valid item header.");\r\ng_free(expert_data.summary);\r\nreturn;\r\n}\r\nselection = find_summary_data(err, &expert_data);\r\ng_free(expert_data.summary);\r\nif(selection>=(int)err->num_procs){\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "No items are selected");\r\nreturn;\r\n}\r\ncurrent_filter=gtk_entry_get_text(GTK_ENTRY(main_display_filter_widget));\r\nprocedure = &g_array_index(err->procs_array, error_procedure_t, selection);\r\nif (action != ACTION_WEB_LOOKUP && action != ACTION_COPY) {\r\nchar *msg;\r\nif (0 ) {\r\nif (action != ACTION_FIND_FRAME && action != ACTION_FIND_NEXT && action != ACTION_FIND_PREVIOUS) {\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "Wireshark cannot create a filter on this item - %s, try using find instead.",\r\nprocedure->entries[1]);\r\nreturn;\r\n}\r\n}\r\nmsg = (char *)g_malloc(escape_string_len(procedure->entries[1]));\r\nescape_string(msg, procedure->entries[1]);\r\nswitch(type){\r\ncase ACTYPE_SELECTED:\r\nif (procedure->fvalue_value==NULL) {\r\ng_snprintf(str, sizeof(str), "expert.message==%s", msg);\r\n}\r\nelse\r\n{\r\ng_strlcpy(str, procedure->fvalue_value, sizeof(str));\r\n}\r\nbreak;\r\ncase ACTYPE_NOT_SELECTED:\r\nif (procedure->fvalue_value==NULL) {\r\ng_snprintf(str, sizeof(str), "!(expert.message==%s)", msg);\r\n}\r\nelse\r\n{\r\ng_snprintf(str, sizeof(str), "!(%s)", procedure->fvalue_value);\r\n}\r\nbreak;\r\ncase ACTYPE_AND_SELECTED:\r\nif ((!current_filter) || (0 == strlen(current_filter)))\r\ng_snprintf(str, sizeof(str), "expert.message==%s", msg);\r\nelse\r\ng_snprintf(str, sizeof(str), "(%s) && (expert.message==%s)", current_filter, msg);\r\nbreak;\r\ncase ACTYPE_OR_SELECTED:\r\nif ((!current_filter) || (0 == strlen(current_filter)))\r\ng_snprintf(str, sizeof(str), "expert.message==%s", msg);\r\nelse\r\ng_snprintf(str, sizeof(str), "(%s) || (expert.message==%s)", current_filter, msg);\r\nbreak;\r\ncase ACTYPE_AND_NOT_SELECTED:\r\nif ((!current_filter) || (0 == strlen(current_filter)))\r\ng_snprintf(str, sizeof(str), "!(expert.message==%s)", msg);\r\nelse\r\ng_snprintf(str, sizeof(str), "(%s) && !(expert.message==%s)", current_filter, msg);\r\nbreak;\r\ncase ACTYPE_OR_NOT_SELECTED:\r\nif ((!current_filter) || (0 == strlen(current_filter)))\r\ng_snprintf(str, sizeof(str), "!(expert.message==%s)", msg);\r\nelse\r\ng_snprintf(str, sizeof(str), "(%s) || !(expert.message==%s)", current_filter, msg);\r\nbreak;\r\ndefault:\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "Can't find menu type - %u", type);\r\n}\r\ng_free(msg);\r\n}\r\nswitch(action){\r\ncase ACTION_MATCH:\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), str);\r\nmain_filter_packets(&cfile, str, FALSE);\r\ngdk_window_raise(gtk_widget_get_window(top_level));\r\nbreak;\r\ncase ACTION_PREPARE:\r\ngtk_entry_set_text(GTK_ENTRY(main_display_filter_widget), str);\r\nbreak;\r\ncase ACTION_FIND_FRAME:\r\nfind_frame_with_filter(str);\r\nbreak;\r\ncase ACTION_FIND_NEXT:\r\ncase ACTION_FIND_PREVIOUS:\r\nif (procedure->fvalue_value==NULL) {\r\nfind_frame_with_filter(str);\r\n}\r\nelse\r\n{\r\ncf_find_packet_dfilter_string(&cfile, str, SD_FORWARD);\r\n}\r\nbreak;\r\ncase ACTION_COLORIZE:\r\ncolor_display_with_filter(str);\r\nbreak;\r\ncase ACTION_WEB_LOOKUP:\r\ng_snprintf(str, sizeof(str), "http://www.google.com/search?hl=en&q=%s+'%s'", procedure->entries[0], procedure->entries[1]);\r\nbrowser_open_url(str);\r\nbreak;\r\ncase ACTION_COPY:\r\n{\r\nGString *copyString = g_string_sized_new(0);\r\ng_string_printf(copyString, "%s: %s",\r\nprocedure->entries[0], procedure->entries[1]);\r\ncopy_to_clipboard(copyString);\r\ng_string_free(copyString, TRUE);\r\n}\r\nbreak;\r\ndefault:\r\nsimple_dialog(ESD_TYPE_ERROR, ESD_BTN_OK, "Can't find menu action - %u", action);\r\n}\r\n}\r\nstatic gboolean\r\nerror_show_popup_menu_cb(void *widg _U_, GdkEvent *event, gpointer user_data)\r\n{\r\nerror_equiv_table *err = (error_equiv_table *)user_data;\r\nGdkEventButton *bevent = (GdkEventButton *)event;\r\nif(event->type==GDK_BUTTON_PRESS && bevent->button==3){\r\ngtk_menu_popup(GTK_MENU(err->menu), NULL, NULL, NULL, NULL,\r\nbevent->button, bevent->time);\r\n}\r\nreturn FALSE;\r\n}\r\nstatic void\r\napply_as_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\napply_as_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\napply_as_and_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_AND_SELECTED, 0));\r\n}\r\nstatic void\r\napply_as_or_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_OR_SELECTED, 0));\r\n}\r\nstatic void\r\napply_as_and_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_AND_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\napply_as_or_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_MATCH(ACTYPE_OR_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_and_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_AND_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_or_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_OR_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_and_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_AND_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nprep_as_or_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_PREPARE(ACTYPE_OR_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_FRAME(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_FRAME(ACTYPE_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_prev_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_PREVIOUS(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_prev_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_PREVIOUS(ACTYPE_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_next_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_NEXT(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\nfind_next_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_FIND_NEXT(ACTYPE_NOT_SELECTED, 0));\r\n}\r\nstatic void\r\ncolor_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_COLORIZE(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\ncolor_not_selected_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_COLORIZE(ACTYPE_SELECTED, 0));\r\n}\r\nstatic void\r\ninternet_search_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_WEB_LOOKUP);\r\n}\r\nstatic void\r\ncopy_cb(GtkWidget *widget, gpointer user_data)\r\n{\r\nerror_select_filter_cb( widget , user_data, CALLBACK_COPY);\r\n}\r\nstatic void\r\nexpert_goto_pkt_cb (GtkTreeSelection *selection, gpointer data _U_)\r\n{\r\nGtkTreeIter iter;\r\nGtkTreeModel *model;\r\ngchar *pkt;\r\ngchar *grp;\r\nif (gtk_tree_selection_get_selected (selection, &model, &iter))\r\n{\r\ngselection_count++;\r\ngtk_tree_model_get (model, &iter,\r\nPROTOCOL_COLUMN, &pkt,\r\nGROUP_COLUMN, &grp,\r\n-1);\r\nif (strcmp(grp, packet)==0) {\r\ncf_goto_frame(&cfile, atoi(pkt));\r\n}\r\ng_free (pkt);\r\n}\r\n}\r\nstatic void\r\nerror_create_popup_menu(error_equiv_table *err)\r\n{\r\nGtkUIManager *ui_manager;\r\nGtkActionGroup *action_group;\r\nGError *error = NULL;\r\nerr->select = gtk_tree_view_get_selection (GTK_TREE_VIEW (err->tree_view));\r\ngtk_tree_selection_set_mode (err->select, GTK_SELECTION_SINGLE);\r\ng_signal_connect (G_OBJECT (err->select), "changed", G_CALLBACK(expert_goto_pkt_cb), NULL);\r\naction_group = gtk_action_group_new ("ExpertFilterPopupActionGroup");\r\ngtk_action_group_add_actions (action_group,\r\n(GtkActionEntry *)expert_popup_entries,\r\nG_N_ELEMENTS(expert_popup_entries),\r\nerr);\r\nui_manager = gtk_ui_manager_new ();\r\ngtk_ui_manager_insert_action_group (ui_manager, action_group, 0);\r\ngtk_ui_manager_add_ui_from_string (ui_manager,ui_desc_expert_filter_popup, -1, &error);\r\nif (error != NULL)\r\n{\r\nfprintf (stderr, "Warning: building expert filter popup failed: %s\n",\r\nerror->message);\r\ng_error_free (error);\r\nerror = NULL;\r\n}\r\nerr->menu = gtk_ui_manager_get_widget(ui_manager, "/ExpertFilterPopup");\r\ng_signal_connect(err->tree_view, "button_press_event", G_CALLBACK(error_show_popup_menu_cb), err);\r\n}\r\nvoid\r\ninit_error_table(error_equiv_table *err, guint num_procs, GtkWidget *vbox)\r\n{\r\nGtkTreeStore *store;\r\nGtkWidget *tree;\r\nGtkTreeViewColumn *column;\r\nGtkCellRenderer *renderer;\r\nGtkTreeSortable *sortable;\r\nstore = gtk_tree_store_new (4,\r\nG_TYPE_POINTER,\r\nG_TYPE_STRING,\r\nG_TYPE_STRING,\r\nG_TYPE_INT);\r\ntree = gtk_tree_view_new_with_model (GTK_TREE_MODEL (store));\r\nerr->tree_view = GTK_TREE_VIEW(tree);\r\nsortable = GTK_TREE_SORTABLE(store);\r\ngtk_tree_view_set_fixed_height_mode(err->tree_view, TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW (tree), FALSE);\r\ng_object_unref (G_OBJECT (store));\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Group", renderer, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, GROUP_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_cell_data_func(column, renderer, str_ptr_data_func,\r\nGINT_TO_POINTER(GROUP_COLUMN), NULL);\r\ngtk_tree_sortable_set_sort_func(sortable, GROUP_COLUMN, str_ptr_sort_func,\r\nGINT_TO_POINTER(GROUP_COLUMN), NULL);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_column_set_fixed_width(column, 80);\r\ngtk_tree_view_append_column (GTK_TREE_VIEW (err->tree_view), column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Protocol", renderer, "text", PROTOCOL_COLUMN, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, PROTOCOL_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_cell_data_func(column, renderer, proto_data_func,\r\nGINT_TO_POINTER(PROTOCOL_COLUMN), NULL);\r\ngtk_tree_sortable_set_sort_func(sortable, PROTOCOL_COLUMN, proto_sort_func,\r\nGINT_TO_POINTER(PROTOCOL_COLUMN), NULL);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_column_set_fixed_width(column, 100);\r\ngtk_tree_view_append_column (GTK_TREE_VIEW (err->tree_view), column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Summary", renderer, "text", SUMMARY_COLUMN, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, SUMMARY_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 300);\r\ngtk_tree_view_column_set_fixed_width(column,\r\n700 -\r\n(80 + 100 + 80 +\r\n24 + 22 ));\r\ngtk_tree_view_append_column (GTK_TREE_VIEW (err->tree_view), column);\r\nrenderer = gtk_cell_renderer_text_new ();\r\ng_object_set(G_OBJECT(renderer), "xalign", 1.0, NULL);\r\ncolumn = gtk_tree_view_column_new_with_attributes ("Count", renderer, "text", COUNT_COLUMN, NULL);\r\ngtk_tree_view_column_set_sort_column_id(column, COUNT_COLUMN);\r\ngtk_tree_view_column_set_resizable(column, TRUE);\r\ngtk_tree_view_column_set_sizing(column, GTK_TREE_VIEW_COLUMN_FIXED);\r\ngtk_tree_view_column_set_min_width(column, 80);\r\ngtk_tree_view_append_column (GTK_TREE_VIEW (err->tree_view), column);\r\nerr->scrolled_window=scrolled_window_new(NULL, NULL);\r\ngtk_container_add(GTK_CONTAINER(err->scrolled_window), GTK_WIDGET (err->tree_view));\r\ngtk_box_pack_start(GTK_BOX(vbox), err->scrolled_window, TRUE, TRUE, 0);\r\ngtk_tree_view_set_search_column (err->tree_view, SUMMARY_COLUMN);\r\ngtk_tree_view_set_reorderable (err->tree_view, TRUE);\r\ngtk_tree_view_set_rules_hint(GTK_TREE_VIEW(err->tree_view), TRUE);\r\ngtk_tree_view_set_headers_clickable(GTK_TREE_VIEW(err->tree_view), TRUE);\r\ngtk_widget_show(err->scrolled_window);\r\nerr->num_procs=num_procs;\r\nerr->text = g_string_chunk_new(100);\r\nerr->procs_array = g_array_sized_new(FALSE, FALSE, sizeof(error_procedure_t), num_procs);\r\nerror_create_popup_menu(err);\r\n}\r\nvoid\r\ninit_error_table_row(error_equiv_table *err, const expert_info_t *expert_data)\r\n{\r\nguint old_num_procs=err->num_procs;\r\ngint row;\r\nerror_procedure_t *procedure;\r\nGtkTreeStore *store;\r\nGtkTreeIter new_iter;\r\ngchar num[10];\r\nrow = find_summary_data(err, expert_data);\r\nif(row==-1){\r\nerror_procedure_t new_procedure;\r\nrow = old_num_procs;\r\nnew_procedure.count=0;\r\nnew_procedure.fvalue_value = NULL;\r\ng_array_append_val(err->procs_array, new_procedure);\r\nprocedure = &g_array_index(err->procs_array, error_procedure_t, row);\r\nprocedure->entries[0]=(char *)g_string_chunk_insert_const(err->text, expert_data->protocol);\r\nprocedure->entries[1]=(char *)g_string_chunk_insert_const(err->text, expert_data->summary);\r\nstore = GTK_TREE_STORE(gtk_tree_view_get_model(err->tree_view));\r\ngtk_tree_store_append (store, &procedure->iter, NULL);\r\ngtk_tree_store_set (store, &procedure->iter,\r\nGROUP_COLUMN, try_val_to_str(expert_data->group, expert_group_vals),\r\nPROTOCOL_COLUMN, procedure->entries[0],\r\nSUMMARY_COLUMN, procedure->entries[1], -1);\r\nif (expert_data->pitem) {\r\nchar *filter;\r\ng_assert(PITEM_FINFO(expert_data->pitem));\r\nfilter = proto_construct_match_selected_string(PITEM_FINFO(expert_data->pitem), NULL);\r\nif (filter != NULL)\r\nprocedure->fvalue_value = g_string_chunk_insert_const(err->text, filter);\r\n}\r\nerr->num_procs = ++old_num_procs;\r\n}\r\nprocedure = &g_array_index(err->procs_array, error_procedure_t, row);\r\nprocedure->count++;\r\nstore = GTK_TREE_STORE(gtk_tree_view_get_model(err->tree_view));\r\ngtk_tree_store_set(store, &procedure->iter,\r\nCOUNT_COLUMN, procedure->count,\r\n-1);\r\ng_snprintf(num, sizeof(num), "%d", expert_data->packet_num);\r\n#if 0\r\nThis does not have a big performance improvment :(\r\ngtk_tree_store_insert_with_values (store,\r\n&new_iter,\r\n&procedure->iter,\r\nG_MAXINT,\r\n#else\r\nif (procedure->count > 1000) {\r\ngtk_tree_store_prepend(store, &new_iter, &procedure->iter);\r\n}\r\nelse {\r\ngtk_tree_store_append(store, &new_iter, &procedure->iter);\r\n}\r\ngtk_tree_store_set(store, &new_iter,\r\n#endif\r\nGROUP_COLUMN, packet,\r\nPROTOCOL_COLUMN, num,\r\nCOUNT_COLUMN, 1,\r\n-1);\r\n}\r\nvoid\r\nreset_error_table_data(error_equiv_table *err)\r\n{\r\nGtkTreeStore *store;\r\nstore = GTK_TREE_STORE(gtk_tree_view_get_model(err->tree_view));\r\ngtk_tree_store_clear(store);\r\nerr->num_procs = 0;\r\ng_string_chunk_free(err->text);\r\nerr->text = g_string_chunk_new(100);\r\ng_array_set_size(err->procs_array, 0);\r\n}\r\nvoid\r\nfree_error_table_data(error_equiv_table *err)\r\n{\r\nerr->num_procs=0;\r\ng_string_chunk_free(err->text);\r\ng_array_free(err->procs_array, TRUE);\r\n}
