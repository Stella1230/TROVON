int\r\nssl_session_key_count(void)\r\n{\r\nreturn g_hash_table_size(ssl_session_hash);\r\n}\r\nstatic void\r\nssl_export_sessions_func(gpointer key, gpointer value, gpointer user_data)\r\n{\r\nguint i;\r\nStringInfo* sslid = (StringInfo*)key;\r\nStringInfo* mastersecret = (StringInfo*)value;\r\nGString* keylist = (GString*)user_data;\r\ng_string_append(keylist, "RSA Session-ID:");\r\nfor( i=0; i<sslid->data_len; i++) {\r\ng_string_append_printf(keylist, "%.2x", sslid->data[i]&255);\r\n}\r\ng_string_append(keylist, " Master-Key:");\r\nfor( i=0; i<mastersecret->data_len; i++) {\r\ng_string_append_printf(keylist, "%.2x", mastersecret->data[i]&255);\r\n}\r\ng_string_append_c(keylist, '\n');\r\n}\r\ngchar*\r\nssl_export_sessions(void)\r\n{\r\nGString* keylist = g_string_new("");\r\ngchar *session_keys;\r\ng_hash_table_foreach(ssl_session_hash, ssl_export_sessions_func, (gpointer)keylist);\r\nsession_keys = keylist->str;\r\ng_string_free(keylist, FALSE);\r\nreturn session_keys;\r\n}
