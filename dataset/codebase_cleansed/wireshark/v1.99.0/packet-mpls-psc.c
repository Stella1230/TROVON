static void\r\ndissect_mpls_psc(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *ti;\r\nproto_tree *psc_tree;\r\nguint32 offset = 0;\r\nguint8 req;\r\nguint8 fpath;\r\nguint8 path;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PSC");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nreq = (tvb_get_guint8(tvb, offset) & 0x3C) >> 2;\r\nfpath = tvb_get_guint8(tvb, offset + 2);\r\npath = tvb_get_guint8(tvb, offset + 3);\r\ncol_add_fstr(pinfo->cinfo, COL_INFO,\r\n"%s(%u,%u)",\r\nval_to_str_const(req, mpls_psc_req_short_vals, "Unknown-Request"),\r\nfpath, path);\r\nif (!tree) {\r\nreturn;\r\n}\r\nti = proto_tree_add_item(tree, proto_mpls_psc, tvb, 0, -1, ENC_NA);\r\npsc_tree = proto_item_add_subtree(ti, ett_mpls_psc);\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_ver, tvb, offset, 1, ENC_NA);\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_req, tvb, offset, 1, ENC_NA);\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_pt, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_rev, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_fpath, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_dpath, tvb, offset, 1, ENC_NA);\r\noffset += 1;\r\nproto_tree_add_item(psc_tree, hf_mpls_psc_tlvlen, tvb, offset, 1, ENC_BIG_ENDIAN);\r\n}\r\nvoid\r\nproto_register_mpls_psc(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{\r\n&hf_mpls_psc_ver,\r\n{\r\n"Version", "mpls_psc.ver",\r\nFT_UINT8, BASE_DEC, NULL, 0xC0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_req,\r\n{\r\n"Request", "mpls_psc.req",\r\nFT_UINT8, BASE_RANGE_STRING | BASE_DEC, RVALS(mpls_psc_req_rvals), 0x3C,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_pt,\r\n{\r\n"Protection Type", "mpls_psc.pt",\r\nFT_UINT8, BASE_RANGE_STRING | BASE_DEC, RVALS(mpls_psc_pt_rvals), 0x03,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_rev,\r\n{\r\n"R", "mpls_psc.rev",\r\nFT_UINT8, BASE_RANGE_STRING | BASE_DEC, RVALS(mpls_psc_rev_rvals), 0x80,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_fpath,\r\n{\r\n"Fault Path", "mpls_psc.fpath",\r\nFT_UINT8, BASE_RANGE_STRING | BASE_DEC, RVALS(mpls_psc_fpath_rvals), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_dpath,\r\n{\r\n"Data Path", "mpls_psc.dpath",\r\nFT_UINT8, BASE_RANGE_STRING | BASE_DEC, RVALS(mpls_psc_dpath_rvals), 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n{\r\n&hf_mpls_psc_tlvlen,\r\n{\r\n"TLV Length", "mpls_psc.tlvlen",\r\nFT_UINT16, BASE_DEC, NULL, 0x0,\r\nNULL, HFILL\r\n}\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_mpls_psc,\r\n};\r\nproto_mpls_psc =\r\nproto_register_protocol("PSC", "MPLS[-TP] Protection State "\r\n"Coordination (PSC) Protocol",\r\n"mpls_psc");\r\nproto_register_field_array(proto_mpls_psc, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\nregister_dissector("mpls_psc", dissect_mpls_psc, proto_mpls_psc);\r\n}
