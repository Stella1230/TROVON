static int\r\ndissect_pulse(tvbuff_t *tvb, packet_info *pinfo, proto_tree *parent_tree, void* data _U_)\r\n{\r\nproto_item *item;\r\nproto_tree *tree;\r\nguint32 magic;\r\nconst char* magic_str;\r\nguint little_endian;\r\nif (tvb_length(tvb) < 4)\r\nreturn 0;\r\nlittle_endian = ENC_LITTLE_ENDIAN;\r\nmagic = tvb_get_letohl(tvb, 0);\r\nmagic_str = try_val_to_str(magic, pulse_magic_type);\r\nif (magic_str == NULL) {\r\nmagic = tvb_get_ntohl(tvb, 0);\r\nmagic_str = try_val_to_str(magic, pulse_magic_type);\r\nif (magic_str == NULL) {\r\nreturn 0;\r\n}\r\nlittle_endian = ENC_BIG_ENDIAN;\r\n}\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PULSE");\r\ncol_set_str(pinfo->cinfo, COL_INFO, magic_str);\r\nif (parent_tree) {\r\nitem = proto_tree_add_item(parent_tree, proto_pulse, tvb, 0,\r\n-1, little_endian);\r\ntree = proto_item_add_subtree(item, ett_pulse);\r\nproto_tree_add_item(tree, hf_pulse_magic, tvb, 0, 4, little_endian);\r\n}\r\nreturn 4;\r\n}\r\nvoid\r\nproto_register_pulse(void)\r\n{\r\nmodule_t *pulse_module;\r\nstatic hf_register_info hf[] = {\r\n{ &hf_pulse_magic,\r\n{ "Magic", "pulse.magic",\r\nFT_UINT32, BASE_HEX, VALS(pulse_magic_type), 0x0,\r\nNULL, HFILL }},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pulse,\r\n};\r\nproto_pulse = proto_register_protocol("PULSE protocol for Linux Virtual Server redundancy",\r\n"PULSE",\r\n"pulse");\r\nproto_register_field_array(proto_pulse, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\npulse_module = prefs_register_protocol(proto_pulse, proto_reg_handoff_pulse);\r\nprefs_register_uint_preference(pulse_module, "udp.port",\r\n"UDP Port",\r\n"Set the UDP port for pulse",\r\n10,\r\n&pulse_port);\r\n}\r\nvoid\r\nproto_reg_handoff_pulse(void)\r\n{\r\nstatic gboolean initialized = FALSE;\r\nstatic int port = 0;\r\nstatic dissector_handle_t pulse_handle;\r\nif (initialized)\r\n{\r\ndissector_delete_uint("udp.port", port, pulse_handle);\r\n}\r\nelse\r\n{\r\npulse_handle = new_create_dissector_handle(dissect_pulse,\r\nproto_pulse);\r\ninitialized = TRUE;\r\n}\r\nport = pulse_port;\r\ndissector_add_uint("udp.port", port, pulse_handle);\r\n}
