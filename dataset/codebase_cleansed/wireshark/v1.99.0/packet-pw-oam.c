static void\r\ndissect_pw_status_tlv (tvbuff_t *tvb, proto_tree *tree, gint offset)\r\n{\r\nproto_item *ti;\r\nproto_tree *pw_oam_tlv_tree;\r\nti = proto_tree_add_protocol_format (tree, proto_pw_oam, tvb, offset, 8,\r\n"Pseudo-Wire Status TLV");\r\nif (!tree)\r\nreturn;\r\npw_oam_tlv_tree = proto_item_add_subtree (ti, ett_pw_oam_tlv_tree);\r\nproto_tree_add_item (pw_oam_tlv_tree, hf_pw_oam_tlv_reserved, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item (pw_oam_tlv_tree, hf_pw_oam_tlv_type, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset = offset + 2;\r\nproto_tree_add_item (pw_oam_tlv_tree, hf_pw_oam_tlv_len, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset = offset + 2;\r\nproto_tree_add_item (pw_oam_tlv_tree, hf_pw_oam_code, tvb, offset,\r\n4, ENC_BIG_ENDIAN);\r\nreturn ;\r\n}\r\nstatic void\r\ndissect_pw_oam(tvbuff_t *tvb, packet_info *pinfo, proto_tree *tree)\r\n{\r\nproto_item *ti = NULL, *ti_flags = NULL;\r\nproto_tree *pw_oam_tree = NULL, *pw_oam_flags = NULL;\r\nguint8 offset = 0;\r\nguint16 pw_tlv_type = 0;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "PW OAM");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nif (!tree)\r\nreturn;\r\nti = proto_tree_add_item(tree, proto_pw_oam, tvb, 0, -1, ENC_NA);\r\npw_oam_tree = proto_item_add_subtree (ti, ett_pw_oam);\r\nproto_tree_add_item (pw_oam_tree, hf_pw_oam_refresh_timer, tvb, offset,\r\n2, ENC_BIG_ENDIAN);\r\noffset = offset + 2;\r\nproto_tree_add_item (pw_oam_tree, hf_pw_oam_total_tlv_len, tvb, offset,\r\n1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\nti_flags = proto_tree_add_item (pw_oam_tree, hf_pw_oam_flags, tvb,\r\noffset, 1, ENC_BIG_ENDIAN);\r\npw_oam_flags = proto_item_add_subtree(ti_flags, ett_pw_oam_flags);\r\nproto_tree_add_item (pw_oam_flags, hf_pw_oam_flags_a, tvb, offset, 1, ENC_BIG_ENDIAN);\r\noffset = offset + 1;\r\npw_tlv_type = tvb_get_ntohs (tvb, offset);\r\nswitch (pw_tlv_type)\r\n{\r\ncase 0x096A:\r\ndissect_pw_status_tlv (tvb, tree, offset);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn;\r\n}\r\nvoid\r\nproto_register_pw_oam(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{&hf_pw_oam_refresh_timer,\r\n{"Refresh-Timer", "pw_oam.refresh-timer", FT_UINT16,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_pw_oam_total_tlv_len,\r\n{"TLV Length", "pw_oam.total-tlv-len", FT_UINT8,\r\nBASE_HEX, NULL, 0x0, NULL, HFILL }},\r\n{&hf_pw_oam_flags,\r\n{"Flags", "pw_oam.flags", FT_UINT8,\r\nBASE_HEX, NULL, 0x0000, "OAM Flags", HFILL }},\r\n{&hf_pw_oam_flags_a,\r\n{"Acknowledgement", "pw_oam.flags_a",\r\nFT_BOOLEAN, 8, NULL, 0x0080, "ACK bit", HFILL}\r\n},\r\n{&hf_pw_oam_tlv_reserved,\r\n{"Reserved", "pw_oam.tlv-reserved",\r\nFT_UINT16, BASE_HEX, NULL, 0xC000, NULL, HFILL}\r\n},\r\n{&hf_pw_oam_tlv_type,\r\n{"TLV Type", "pw_oam.tlv-type",\r\nFT_UINT16, BASE_HEX, NULL, 0x3FFF, NULL, HFILL}\r\n},\r\n{&hf_pw_oam_tlv_len,\r\n{"TLV Length", "pw_oam.tlv-len",\r\nFT_UINT16, BASE_HEX, NULL, 0x00, NULL, HFILL}\r\n},\r\n{&hf_pw_oam_code,\r\n{"Status code", "pw_oam.code", FT_UINT16,\r\nBASE_HEX, VALS(pw_oam_code), 0x0, "PW Status Code", HFILL }\r\n},\r\n};\r\nstatic gint *ett[] = {\r\n&ett_pw_oam,\r\n&ett_pw_oam_tlv_tree,\r\n&ett_pw_oam_flags,\r\n};\r\nproto_pw_oam =\r\nproto_register_protocol("Pseudo-Wire OAM", "PW-OAM "\r\n"Pseudo-Wire OAM Protocol",\r\n"pw_oam");\r\nproto_register_field_array (proto_pw_oam, hf, array_length(hf));\r\nproto_register_subtree_array (ett, array_length(ett));\r\nregister_dissector("pw_oam", dissect_pw_oam, proto_pw_oam);\r\n}
