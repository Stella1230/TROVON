static int\r\ndissect_swipe(tvbuff_t *tvb, packet_info * pinfo, proto_tree *tree, void* data _U_)\r\n{\r\nint header_len, offset = 0;\r\nproto_tree *swipe_tree;\r\nproto_item *ti;\r\ntvbuff_t *next_tvb;\r\ncol_set_str(pinfo->cinfo, COL_PROTOCOL, "swIPe");\r\ncol_clear(pinfo->cinfo, COL_INFO);\r\nheader_len = tvb_get_guint8(tvb, offset + 1);\r\nif (tree)\r\n{\r\nti = proto_tree_add_item(tree, proto_swipe, tvb, offset, header_len, ENC_NA);\r\nswipe_tree = proto_item_add_subtree(ti, ett_swipe);\r\nproto_tree_add_item(swipe_tree, hf_swipe_packet_type, tvb, offset, 1, ENC_NA);\r\nproto_tree_add_item(swipe_tree, hf_swipe_len, tvb, offset + 1, 1, ENC_NA);\r\nproto_tree_add_item(swipe_tree, hf_swipe_policy_id, tvb, offset + 2, 2, ENC_BIG_ENDIAN);\r\nproto_tree_add_item(swipe_tree, hf_swipe_packet_seq, tvb, offset + 4, 4, ENC_BIG_ENDIAN);\r\nif (header_len > 8)\r\nproto_tree_add_item(swipe_tree, hf_swipe_authenticator, tvb, offset + 8, header_len - 8, ENC_NA);\r\n}\r\nnext_tvb = tvb_new_subset_remaining(tvb, header_len);\r\ncall_dissector(ipv6_handle, next_tvb, pinfo, tree);\r\nreturn tvb_captured_length(tvb);\r\n}\r\nvoid\r\nproto_register_swipe(void)\r\n{\r\nstatic hf_register_info hf[] = {\r\n{ &hf_swipe_packet_type, { "Packet type", "swipe.packet_type", FT_UINT8, BASE_DEC, VALS(swipe_packet_type_vals), 0x0, NULL, HFILL } },\r\n{ &hf_swipe_len, { "Header Length", "swipe.len", FT_UINT8, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_swipe_policy_id, { "Policy identifier", "swipe.policy_id", FT_UINT16, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_swipe_packet_seq, { "Packet sequence number", "swipe.packet_seq", FT_UINT32, BASE_DEC, NULL, 0x0, NULL, HFILL } },\r\n{ &hf_swipe_authenticator, { "Authenticator", "swipe.authenticator", FT_BYTES, BASE_NONE, NULL, 0x0, NULL, HFILL } },\r\n};\r\nstatic gint *ett[] = {\r\n&ett_swipe\r\n};\r\nproto_swipe = proto_register_protocol("swIPe IP Security Protocol", "swIPe", "swipe");\r\nproto_register_field_array(proto_swipe, hf, array_length(hf));\r\nproto_register_subtree_array(ett, array_length(ett));\r\n}\r\nvoid\r\nproto_reg_handoff_swipe(void)\r\n{\r\ndissector_handle_t swipe_handle;\r\nswipe_handle = new_create_dissector_handle(dissect_swipe, proto_swipe );\r\ndissector_add_uint("ip.proto", IP_PROTO_SWIPE, swipe_handle);\r\nipv6_handle = find_dissector("ipv6");\r\n}
