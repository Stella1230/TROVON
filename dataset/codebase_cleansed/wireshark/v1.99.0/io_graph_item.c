int get_io_graph_index(packet_info *pinfo, int interval) {\r\nnstime_t time_delta;\r\ntime_delta = pinfo->rel_ts;\r\nif (time_delta.nsecs<0) {\r\ntime_delta.secs--;\r\ntime_delta.nsecs += 1000000000;\r\n}\r\nif (time_delta.secs<0) {\r\nreturn -1;\r\n}\r\nreturn (int) ((time_delta.secs*1000 + time_delta.nsecs/1000000) / interval);\r\n}\r\nGString *check_field_unit(const char *field_name, int *hf_index, io_graph_item_unit_t item_unit)\r\n{\r\nGString *err_str = NULL;\r\nif (item_unit >= IOG_ITEM_UNIT_CALC_SUM) {\r\nheader_field_info *hfi;\r\nconst char *item_unit_names[NUM_IOG_ITEM_UNITS] = {\r\n"Packets",\r\n"Bytes",\r\n"Bits",\r\n"SUM",\r\n"COUNT FRAMES",\r\n"COUNT FIELDS",\r\n"MAX",\r\n"MIN",\r\n"AVG",\r\n"LOAD"\r\n};\r\nif ((field_name == NULL) || (field_name[0] == 0)) {\r\nerr_str = g_string_new("You didn't specify a field name.");\r\nreturn err_str;\r\n}\r\nhfi = proto_registrar_get_byname(field_name);\r\nif (hfi == NULL) {\r\nerr_str = g_string_new("");\r\ng_string_printf(err_str, "There is no field named '%s'.", field_name);\r\nreturn err_str;\r\n}\r\nif (hf_index) *hf_index = hfi->id;\r\nswitch (hfi->type) {\r\ncase FT_UINT8:\r\ncase FT_UINT16:\r\ncase FT_UINT24:\r\ncase FT_UINT32:\r\ncase FT_UINT64:\r\ncase FT_INT8:\r\ncase FT_INT16:\r\ncase FT_INT24:\r\ncase FT_INT32:\r\ncase FT_INT64:\r\ncase FT_FLOAT:\r\ncase FT_DOUBLE:\r\nswitch (item_unit) {\r\ncase IOG_ITEM_UNIT_CALC_LOAD:\r\nerr_str = g_string_new("LOAD is only supported for relative-time fields.");\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase FT_RELATIVE_TIME:\r\nswitch (item_unit) {\r\ncase IOG_ITEM_UNIT_CALC_SUM:\r\ncase IOG_ITEM_UNIT_CALC_FRAMES:\r\ncase IOG_ITEM_UNIT_CALC_FIELDS:\r\ncase IOG_ITEM_UNIT_CALC_MAX:\r\ncase IOG_ITEM_UNIT_CALC_MIN:\r\ncase IOG_ITEM_UNIT_CALC_AVERAGE:\r\ncase IOG_ITEM_UNIT_CALC_LOAD:\r\nbreak;\r\ndefault:\r\nerr_str = g_string_new("");\r\ng_string_printf(err_str, "\"%s\" is a relative-time field. %s calculations are not supported on it.",\r\nfield_name,\r\nitem_unit_names[item_unit]);\r\n}\r\nbreak;\r\ndefault:\r\nif ((item_unit != IOG_ITEM_UNIT_CALC_FRAMES) &&\r\n(item_unit != IOG_ITEM_UNIT_CALC_FIELDS)) {\r\nerr_str = g_string_new("");\r\ng_string_printf(err_str, "\"%s\" doesn't have integral or float values. %s calculations are not supported on it.",\r\nfield_name,\r\nitem_unit_names[item_unit]);\r\n}\r\nbreak;\r\n}\r\n}\r\nreturn err_str;\r\n}
