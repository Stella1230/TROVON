void\r\natm_guess_traffic_type(struct wtap_pkthdr *phdr, const guint8 *pd)\r\n{\r\nphdr->pseudo_header.atm.aal = AAL_5;\r\nphdr->pseudo_header.atm.type = TRAF_UNKNOWN;\r\nphdr->pseudo_header.atm.subtype = TRAF_ST_UNKNOWN;\r\nif (phdr->pseudo_header.atm.vpi == 0) {\r\nswitch (phdr->pseudo_header.atm.vci) {\r\ncase 5:\r\nphdr->pseudo_header.atm.aal = AAL_SIGNALLING;\r\nreturn;\r\ncase 16:\r\nphdr->pseudo_header.atm.type = TRAF_ILMI;\r\nreturn;\r\n}\r\n}\r\nif (phdr->caplen >= 3) {\r\nif (pd[0] == 0xaa && pd[1] == 0xaa && pd[2] == 0x03) {\r\nphdr->pseudo_header.atm.type = TRAF_LLCMX;\r\n} else if ((phdr->pseudo_header.atm.aal5t_len && phdr->pseudo_header.atm.aal5t_len < 16) ||\r\nphdr->caplen < 16) {\r\nphdr->pseudo_header.atm.aal = AAL_SIGNALLING;\r\n} else if (pd[0] == 0x83 || pd[0] == 0x81) {\r\nphdr->pseudo_header.atm.aal = AAL_SIGNALLING;\r\n} else {\r\nphdr->pseudo_header.atm.type = TRAF_LANE;\r\natm_guess_lane_type(phdr, pd);\r\n}\r\n} else {\r\nphdr->pseudo_header.atm.aal = AAL_SIGNALLING;\r\n}\r\n}\r\nvoid\r\natm_guess_lane_type(struct wtap_pkthdr *phdr, const guint8 *pd)\r\n{\r\nif (phdr->caplen >= 2) {\r\nif (pd[0] == 0xff && pd[1] == 0x00) {\r\nphdr->pseudo_header.atm.subtype = TRAF_ST_LANE_LE_CTRL;\r\n} else {\r\nphdr->pseudo_header.atm.subtype = TRAF_ST_LANE_802_3;\r\n}\r\n}\r\n}
