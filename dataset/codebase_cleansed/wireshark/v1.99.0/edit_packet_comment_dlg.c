static void\r\npkt_comment_text_buff_ok_cb(GtkWidget *w _U_, GtkWidget *view)\r\n{\r\nGtkTextBuffer *buffer;\r\nGtkTextIter start_iter;\r\nGtkTextIter end_iter;\r\ngchar *new_packet_comment;\r\nbuffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));\r\ngtk_text_buffer_get_start_iter (buffer, &start_iter);\r\ngtk_text_buffer_get_end_iter (buffer, &end_iter);\r\nnew_packet_comment = gtk_text_buffer_get_text (buffer, &start_iter, &end_iter, FALSE );\r\npacket_list_update_packet_comment(new_packet_comment);\r\nexpert_comp_packet_comment_updated();\r\nstatus_expert_update();\r\nwindow_destroy(edit_or_add_pkt_comment_dlg);\r\n}\r\nstatic void\r\ncapture_comment_text_buff_ok_cb(GtkWidget *w _U_, GtkWidget *view)\r\n{\r\nGtkTextBuffer *buffer;\r\nGtkTextIter start_iter;\r\nGtkTextIter end_iter;\r\ngchar *new_capture_comment;\r\nbuffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));\r\ngtk_text_buffer_get_start_iter (buffer, &start_iter);\r\ngtk_text_buffer_get_end_iter (buffer, &end_iter);\r\nnew_capture_comment = gtk_text_buffer_get_text (buffer, &start_iter, &end_iter, FALSE );\r\ncf_update_capture_comment(&cfile, new_capture_comment);\r\nmain_update_for_unsaved_changes(&cfile);\r\nstatus_capture_comment_update();\r\nwindow_destroy(edit_or_add_capture_comment_dlg);\r\n}\r\nvoid\r\nedit_packet_comment_dlg (GtkAction *action _U_, gpointer data _U_)\r\n{\r\nGtkWidget *vbox;\r\nGtkWidget *view;\r\nGtkWidget *scroll;\r\nGtkWidget *bbox;\r\nGtkWidget *ok_bt, *cancel_bt, *help_bt;\r\nGtkTextBuffer *buffer;\r\ngchar *opt_comment;\r\nedit_or_add_pkt_comment_dlg = dlg_window_new ("Edit or Add Packet Comments");\r\ngtk_widget_set_size_request (edit_or_add_pkt_comment_dlg, 500, 160);\r\ngtk_window_set_resizable (GTK_WINDOW (edit_or_add_pkt_comment_dlg), TRUE);\r\ngtk_container_set_border_width (GTK_CONTAINER (edit_or_add_pkt_comment_dlg), DLG_OUTER_MARGIN);\r\nvbox = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, DLG_UNRELATED_SPACING, FALSE);\r\ngtk_container_add (GTK_CONTAINER (edit_or_add_pkt_comment_dlg), vbox);\r\ngtk_widget_show (vbox);\r\nview = gtk_text_view_new ();\r\ngtk_text_view_set_wrap_mode(GTK_TEXT_VIEW(view), GTK_WRAP_WORD);\r\nbuffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));\r\ngtk_widget_show (view);\r\nscroll = gtk_scrolled_window_new(NULL, NULL);\r\ngtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(scroll),\r\nGTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC);\r\ngtk_container_add(GTK_CONTAINER(scroll), view);\r\ngtk_widget_show(scroll);\r\ngtk_box_pack_start(GTK_BOX (vbox), scroll, TRUE, TRUE, 0);\r\nopt_comment = packet_list_get_packet_comment();\r\nif(opt_comment){\r\ngtk_text_buffer_set_text(buffer, opt_comment, -1);\r\ng_free(opt_comment);\r\n}\r\nbbox = dlg_button_row_new (GTK_STOCK_OK, GTK_STOCK_CANCEL, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_end (GTK_BOX(vbox), bbox, FALSE, FALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_OK);\r\ng_signal_connect (ok_bt, "clicked", G_CALLBACK(pkt_comment_text_buff_ok_cb), view);\r\ngtk_widget_set_sensitive (ok_bt, TRUE);\r\ncancel_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_CANCEL);\r\nwindow_set_cancel_button (edit_or_add_pkt_comment_dlg, cancel_bt, window_cancel_button_cb);\r\nhelp_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_HELP);\r\n#if 0\r\ng_signal_connect (help_bt, "clicked",NULL, NULL);\r\n#endif\r\ngtk_widget_set_sensitive (help_bt, FALSE);\r\ngtk_widget_grab_default (ok_bt);\r\ng_signal_connect (edit_or_add_pkt_comment_dlg, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ngtk_widget_show (edit_or_add_pkt_comment_dlg);\r\n}\r\nstatic void\r\nedit_capture_comment_destroy_cb(GtkWidget *win _U_, gpointer user_data _U_)\r\n{\r\nedit_or_add_capture_comment_dlg = NULL;\r\n}\r\nvoid\r\nedit_capture_comment_dlg_launch (void)\r\n{\r\nGtkWidget *vbox;\r\nGtkWidget *view;\r\nGtkWidget *scroll;\r\nGtkWidget *bbox;\r\nGtkWidget *ok_bt, *cancel_bt, *help_bt;\r\nGtkTextBuffer *buffer = NULL;\r\nconst gchar *comment_str = NULL;\r\ngchar *buf_str;\r\nif (edit_or_add_capture_comment_dlg != NULL) {\r\nreactivate_window(edit_or_add_capture_comment_dlg);\r\nreturn;\r\n}\r\nedit_or_add_capture_comment_dlg = dlg_window_new ("Edit or Add Capture Comments");\r\ngtk_widget_set_size_request (edit_or_add_capture_comment_dlg, 500, 160);\r\ngtk_window_set_resizable (GTK_WINDOW (edit_or_add_capture_comment_dlg), TRUE);\r\ngtk_container_set_border_width (GTK_CONTAINER (edit_or_add_capture_comment_dlg), DLG_OUTER_MARGIN);\r\ng_signal_connect(edit_or_add_capture_comment_dlg, "destroy",\r\nG_CALLBACK(edit_capture_comment_destroy_cb), NULL);\r\nvbox = ws_gtk_box_new(GTK_ORIENTATION_VERTICAL, DLG_UNRELATED_SPACING, FALSE);\r\ngtk_container_add (GTK_CONTAINER (edit_or_add_capture_comment_dlg), vbox);\r\ngtk_widget_show (vbox);\r\nview = gtk_text_view_new ();\r\ngtk_text_view_set_wrap_mode(GTK_TEXT_VIEW(view), GTK_WRAP_WORD);\r\nbuffer = gtk_text_view_get_buffer (GTK_TEXT_VIEW (view));\r\ngtk_widget_show (view);\r\nscroll = gtk_scrolled_window_new(NULL, NULL);\r\ngtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(scroll),\r\nGTK_POLICY_NEVER, GTK_POLICY_AUTOMATIC);\r\ngtk_container_add(GTK_CONTAINER(scroll), view);\r\ngtk_widget_show(scroll);\r\ngtk_box_pack_start(GTK_BOX (vbox), scroll, TRUE, TRUE, 0);\r\ncomment_str = cf_read_shb_comment(&cfile);\r\nif(comment_str != NULL){\r\nbuf_str = g_strdup_printf("%s", comment_str);\r\ngtk_text_buffer_set_text (buffer, buf_str, -1);\r\ng_free(buf_str);\r\n}\r\nbbox = dlg_button_row_new (GTK_STOCK_OK, GTK_STOCK_CANCEL, GTK_STOCK_HELP, NULL);\r\ngtk_box_pack_end (GTK_BOX(vbox), bbox, FALSE, FALSE, 0);\r\nok_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_OK);\r\ng_signal_connect (ok_bt, "clicked", G_CALLBACK(capture_comment_text_buff_ok_cb), view);\r\ngtk_widget_set_sensitive (ok_bt, TRUE);\r\ncancel_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_CANCEL);\r\nwindow_set_cancel_button (edit_or_add_capture_comment_dlg, cancel_bt, window_cancel_button_cb);\r\nhelp_bt = (GtkWidget *)g_object_get_data (G_OBJECT(bbox), GTK_STOCK_HELP);\r\n#if 0\r\ng_signal_connect (help_bt, "clicked",NULL, NULL);\r\n#endif\r\ngtk_widget_set_sensitive (help_bt, FALSE);\r\ngtk_widget_grab_default (ok_bt);\r\ng_signal_connect (edit_or_add_capture_comment_dlg, "delete_event", G_CALLBACK(window_delete_event_cb), NULL);\r\ngtk_widget_show (edit_or_add_capture_comment_dlg);\r\n}\r\nvoid\r\nedit_capture_comment_dlg_hide(void)\r\n{\r\nwindow_destroy(edit_or_add_capture_comment_dlg);\r\n}
