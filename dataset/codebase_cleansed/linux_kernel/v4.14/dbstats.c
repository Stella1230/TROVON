static void acpi_db_list_info(struct acpi_memory_list *list)\r\n{\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nu32 outstanding;\r\n#endif\r\nacpi_os_printf("\n%s\n", list->list_name);\r\nif (list->max_depth > 0) {\r\nacpi_os_printf\r\n(" Cache: [Depth MaxD Avail Size] "\r\n"%8.2X %8.2X %8.2X %8.2X\n", list->current_depth,\r\nlist->max_depth, list->max_depth - list->current_depth,\r\n(list->current_depth * list->object_size));\r\n}\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nif (list->max_depth > 0) {\r\nacpi_os_printf\r\n(" Cache: [Requests Hits Misses ObjSize] "\r\n"%8.2X %8.2X %8.2X %8.2X\n", list->requests, list->hits,\r\nlist->requests - list->hits, list->object_size);\r\n}\r\noutstanding = acpi_db_get_cache_info(list);\r\nif (list->object_size) {\r\nacpi_os_printf\r\n(" Mem: [Alloc Free Max CurSize Outstanding] "\r\n"%8.2X %8.2X %8.2X %8.2X %8.2X\n", list->total_allocated,\r\nlist->total_freed, list->max_occupied,\r\noutstanding * list->object_size, outstanding);\r\n} else {\r\nacpi_os_printf\r\n(" Mem: [Alloc Free Max CurSize Outstanding Total] "\r\n"%8.2X %8.2X %8.2X %8.2X %8.2X %8.2X\n",\r\nlist->total_allocated, list->total_freed,\r\nlist->max_occupied, list->current_total_size, outstanding,\r\nlist->total_size);\r\n}\r\n#endif\r\n}\r\nstatic void acpi_db_enumerate_object(union acpi_operand_object *obj_desc)\r\n{\r\nu32 i;\r\nif (!obj_desc) {\r\nreturn;\r\n}\r\nacpi_gbl_num_objects++;\r\nif (obj_desc->common.type > ACPI_TYPE_NS_NODE_MAX) {\r\nacpi_gbl_obj_type_count_misc++;\r\n} else {\r\nacpi_gbl_obj_type_count[obj_desc->common.type]++;\r\n}\r\nswitch (obj_desc->common.type) {\r\ncase ACPI_TYPE_PACKAGE:\r\nfor (i = 0; i < obj_desc->package.count; i++) {\r\nacpi_db_enumerate_object(obj_desc->package.elements[i]);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_DEVICE:\r\nacpi_db_enumerate_object(obj_desc->device.notify_list[0]);\r\nacpi_db_enumerate_object(obj_desc->device.notify_list[1]);\r\nacpi_db_enumerate_object(obj_desc->device.handler);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\nif (acpi_ns_get_secondary_object(obj_desc)) {\r\nacpi_gbl_obj_type_count[ACPI_TYPE_BUFFER_FIELD]++;\r\n}\r\nbreak;\r\ncase ACPI_TYPE_REGION:\r\nacpi_gbl_obj_type_count[ACPI_TYPE_LOCAL_REGION_FIELD]++;\r\nacpi_db_enumerate_object(obj_desc->region.handler);\r\nbreak;\r\ncase ACPI_TYPE_POWER:\r\nacpi_db_enumerate_object(obj_desc->power_resource.\r\nnotify_list[0]);\r\nacpi_db_enumerate_object(obj_desc->power_resource.\r\nnotify_list[1]);\r\nbreak;\r\ncase ACPI_TYPE_PROCESSOR:\r\nacpi_db_enumerate_object(obj_desc->processor.notify_list[0]);\r\nacpi_db_enumerate_object(obj_desc->processor.notify_list[1]);\r\nacpi_db_enumerate_object(obj_desc->processor.handler);\r\nbreak;\r\ncase ACPI_TYPE_THERMAL:\r\nacpi_db_enumerate_object(obj_desc->thermal_zone.notify_list[0]);\r\nacpi_db_enumerate_object(obj_desc->thermal_zone.notify_list[1]);\r\nacpi_db_enumerate_object(obj_desc->thermal_zone.handler);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nstatic acpi_status\r\nacpi_db_classify_one_object(acpi_handle obj_handle,\r\nu32 nesting_level,\r\nvoid *context, void **return_value)\r\n{\r\nstruct acpi_namespace_node *node;\r\nunion acpi_operand_object *obj_desc;\r\nu32 type;\r\nacpi_gbl_num_nodes++;\r\nnode = (struct acpi_namespace_node *)obj_handle;\r\nobj_desc = acpi_ns_get_attached_object(node);\r\nacpi_db_enumerate_object(obj_desc);\r\ntype = node->type;\r\nif (type > ACPI_TYPE_NS_NODE_MAX) {\r\nacpi_gbl_node_type_count_misc++;\r\n} else {\r\nacpi_gbl_node_type_count[type]++;\r\n}\r\nreturn (AE_OK);\r\n#ifdef ACPI_FUTURE_IMPLEMENTATION\r\nif (acpi_ps_is_named_op(op->opcode)) {\r\nnum_nodes++;\r\n}\r\nif (is_method) {\r\nnum_method_elements++;\r\n}\r\nnum_grammar_elements++;\r\nop = acpi_ps_get_depth_next(root, op);\r\nsize_of_parse_tree = (num_grammar_elements - num_method_elements) *\r\n(u32)sizeof(union acpi_parse_object);\r\nsize_of_method_trees =\r\nnum_method_elements * (u32)sizeof(union acpi_parse_object);\r\nsize_of_node_entries =\r\nnum_nodes * (u32)sizeof(struct acpi_namespace_node);\r\nsize_of_acpi_objects =\r\nnum_nodes * (u32)sizeof(union acpi_operand_object);\r\n#endif\r\n}\r\nstatic void acpi_db_count_namespace_objects(void)\r\n{\r\nu32 i;\r\nacpi_gbl_num_nodes = 0;\r\nacpi_gbl_num_objects = 0;\r\nacpi_gbl_obj_type_count_misc = 0;\r\nfor (i = 0; i < (ACPI_TYPE_NS_NODE_MAX - 1); i++) {\r\nacpi_gbl_obj_type_count[i] = 0;\r\nacpi_gbl_node_type_count[i] = 0;\r\n}\r\n(void)acpi_ns_walk_namespace(ACPI_TYPE_ANY, ACPI_ROOT_OBJECT,\r\nACPI_UINT32_MAX, FALSE,\r\nacpi_db_classify_one_object, NULL, NULL,\r\nNULL);\r\n}\r\nacpi_status acpi_db_display_statistics(char *type_arg)\r\n{\r\nu32 i;\r\nu32 temp;\r\nacpi_ut_strupr(type_arg);\r\ntemp = acpi_db_match_argument(type_arg, acpi_db_stat_types);\r\nif (temp == ACPI_TYPE_NOT_FOUND) {\r\nacpi_os_printf("Invalid or unsupported argument\n");\r\nreturn (AE_OK);\r\n}\r\nswitch (temp) {\r\ncase CMD_STAT_ALLOCATIONS:\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nacpi_ut_dump_allocation_info();\r\n#endif\r\nbreak;\r\ncase CMD_STAT_TABLES:\r\nacpi_os_printf("ACPI Table Information (not implemented):\n\n");\r\nbreak;\r\ncase CMD_STAT_OBJECTS:\r\nacpi_db_count_namespace_objects();\r\nacpi_os_printf\r\n("\nObjects defined in the current namespace:\n\n");\r\nacpi_os_printf("%16.16s %10.10s %10.10s\n",\r\n"ACPI_TYPE", "NODES", "OBJECTS");\r\nfor (i = 0; i < ACPI_TYPE_NS_NODE_MAX; i++) {\r\nacpi_os_printf("%16.16s % 10ld% 10ld\n",\r\nacpi_ut_get_type_name(i),\r\nacpi_gbl_node_type_count[i],\r\nacpi_gbl_obj_type_count[i]);\r\n}\r\nacpi_os_printf("%16.16s % 10ld% 10ld\n", "Misc/Unknown",\r\nacpi_gbl_node_type_count_misc,\r\nacpi_gbl_obj_type_count_misc);\r\nacpi_os_printf("%16.16s % 10ld% 10ld\n", "TOTALS:",\r\nacpi_gbl_num_nodes, acpi_gbl_num_objects);\r\nbreak;\r\ncase CMD_STAT_MEMORY:\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nacpi_os_printf\r\n("\n----Object Statistics (all in hex)---------\n");\r\nacpi_db_list_info(acpi_gbl_global_list);\r\nacpi_db_list_info(acpi_gbl_ns_node_list);\r\n#endif\r\n#ifdef ACPI_USE_LOCAL_CACHE\r\nacpi_os_printf\r\n("\n----Cache Statistics (all in hex)---------\n");\r\nacpi_db_list_info(acpi_gbl_operand_cache);\r\nacpi_db_list_info(acpi_gbl_ps_node_cache);\r\nacpi_db_list_info(acpi_gbl_ps_node_ext_cache);\r\nacpi_db_list_info(acpi_gbl_state_cache);\r\n#endif\r\nbreak;\r\ncase CMD_STAT_MISC:\r\nacpi_os_printf("\nMiscellaneous Statistics:\n\n");\r\nacpi_os_printf("Calls to AcpiPsFind:.. ........% 7ld\n",\r\nacpi_gbl_ps_find_count);\r\nacpi_os_printf("Calls to AcpiNsLookup:..........% 7ld\n",\r\nacpi_gbl_ns_lookup_count);\r\nacpi_os_printf("\n");\r\nacpi_os_printf("Mutex usage:\n\n");\r\nfor (i = 0; i < ACPI_NUM_MUTEX; i++) {\r\nacpi_os_printf("%-28s: % 7ld\n",\r\nacpi_ut_get_mutex_name(i),\r\nacpi_gbl_mutex_info[i].use_count);\r\n}\r\nbreak;\r\ncase CMD_STAT_SIZES:\r\nacpi_os_printf("\nInternal object sizes:\n\n");\r\nacpi_os_printf("Common %3d\n",\r\nsizeof(struct acpi_object_common));\r\nacpi_os_printf("Number %3d\n",\r\nsizeof(struct acpi_object_integer));\r\nacpi_os_printf("String %3d\n",\r\nsizeof(struct acpi_object_string));\r\nacpi_os_printf("Buffer %3d\n",\r\nsizeof(struct acpi_object_buffer));\r\nacpi_os_printf("Package %3d\n",\r\nsizeof(struct acpi_object_package));\r\nacpi_os_printf("BufferField %3d\n",\r\nsizeof(struct acpi_object_buffer_field));\r\nacpi_os_printf("Device %3d\n",\r\nsizeof(struct acpi_object_device));\r\nacpi_os_printf("Event %3d\n",\r\nsizeof(struct acpi_object_event));\r\nacpi_os_printf("Method %3d\n",\r\nsizeof(struct acpi_object_method));\r\nacpi_os_printf("Mutex %3d\n",\r\nsizeof(struct acpi_object_mutex));\r\nacpi_os_printf("Region %3d\n",\r\nsizeof(struct acpi_object_region));\r\nacpi_os_printf("PowerResource %3d\n",\r\nsizeof(struct acpi_object_power_resource));\r\nacpi_os_printf("Processor %3d\n",\r\nsizeof(struct acpi_object_processor));\r\nacpi_os_printf("ThermalZone %3d\n",\r\nsizeof(struct acpi_object_thermal_zone));\r\nacpi_os_printf("RegionField %3d\n",\r\nsizeof(struct acpi_object_region_field));\r\nacpi_os_printf("BankField %3d\n",\r\nsizeof(struct acpi_object_bank_field));\r\nacpi_os_printf("IndexField %3d\n",\r\nsizeof(struct acpi_object_index_field));\r\nacpi_os_printf("Reference %3d\n",\r\nsizeof(struct acpi_object_reference));\r\nacpi_os_printf("Notify %3d\n",\r\nsizeof(struct acpi_object_notify_handler));\r\nacpi_os_printf("AddressSpace %3d\n",\r\nsizeof(struct acpi_object_addr_handler));\r\nacpi_os_printf("Extra %3d\n",\r\nsizeof(struct acpi_object_extra));\r\nacpi_os_printf("Data %3d\n",\r\nsizeof(struct acpi_object_data));\r\nacpi_os_printf("\n");\r\nacpi_os_printf("ParseObject %3d\n",\r\nsizeof(struct acpi_parse_obj_common));\r\nacpi_os_printf("ParseObjectNamed %3d\n",\r\nsizeof(struct acpi_parse_obj_named));\r\nacpi_os_printf("ParseObjectAsl %3d\n",\r\nsizeof(struct acpi_parse_obj_asl));\r\nacpi_os_printf("OperandObject %3d\n",\r\nsizeof(union acpi_operand_object));\r\nacpi_os_printf("NamespaceNode %3d\n",\r\nsizeof(struct acpi_namespace_node));\r\nacpi_os_printf("AcpiObject %3d\n",\r\nsizeof(union acpi_object));\r\nacpi_os_printf("\n");\r\nacpi_os_printf("Generic State %3d\n",\r\nsizeof(union acpi_generic_state));\r\nacpi_os_printf("Common State %3d\n",\r\nsizeof(struct acpi_common_state));\r\nacpi_os_printf("Control State %3d\n",\r\nsizeof(struct acpi_control_state));\r\nacpi_os_printf("Update State %3d\n",\r\nsizeof(struct acpi_update_state));\r\nacpi_os_printf("Scope State %3d\n",\r\nsizeof(struct acpi_scope_state));\r\nacpi_os_printf("Parse Scope %3d\n",\r\nsizeof(struct acpi_pscope_state));\r\nacpi_os_printf("Package State %3d\n",\r\nsizeof(struct acpi_pkg_state));\r\nacpi_os_printf("Thread State %3d\n",\r\nsizeof(struct acpi_thread_state));\r\nacpi_os_printf("Result Values %3d\n",\r\nsizeof(struct acpi_result_values));\r\nacpi_os_printf("Notify Info %3d\n",\r\nsizeof(struct acpi_notify_info));\r\nbreak;\r\ncase CMD_STAT_STACK:\r\n#if defined(ACPI_DEBUG_OUTPUT)\r\ntemp =\r\n(u32)ACPI_PTR_DIFF(acpi_gbl_entry_stack_pointer,\r\nacpi_gbl_lowest_stack_pointer);\r\nacpi_os_printf("\nSubsystem Stack Usage:\n\n");\r\nacpi_os_printf("Entry Stack Pointer %p\n",\r\nacpi_gbl_entry_stack_pointer);\r\nacpi_os_printf("Lowest Stack Pointer %p\n",\r\nacpi_gbl_lowest_stack_pointer);\r\nacpi_os_printf("Stack Use %X (%u)\n", temp,\r\ntemp);\r\nacpi_os_printf("Deepest Procedure Nesting %u\n",\r\nacpi_gbl_deepest_nesting);\r\n#endif\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nacpi_os_printf("\n");\r\nreturn (AE_OK);\r\n}
