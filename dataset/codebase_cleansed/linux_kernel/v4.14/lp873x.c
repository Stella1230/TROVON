static int lp873x_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *ids)\r\n{\r\nstruct lp873x *lp873;\r\nint ret;\r\nunsigned int otpid;\r\nlp873 = devm_kzalloc(&client->dev, sizeof(*lp873), GFP_KERNEL);\r\nif (!lp873)\r\nreturn -ENOMEM;\r\nlp873->dev = &client->dev;\r\nlp873->regmap = devm_regmap_init_i2c(client, &lp873x_regmap_config);\r\nif (IS_ERR(lp873->regmap)) {\r\nret = PTR_ERR(lp873->regmap);\r\ndev_err(lp873->dev,\r\n"Failed to initialize register map: %d\n", ret);\r\nreturn ret;\r\n}\r\nret = regmap_read(lp873->regmap, LP873X_REG_OTP_REV, &otpid);\r\nif (ret) {\r\ndev_err(lp873->dev, "Failed to read OTP ID\n");\r\nreturn ret;\r\n}\r\nlp873->rev = otpid & LP873X_OTP_REV_OTP_ID;\r\ni2c_set_clientdata(client, lp873);\r\nret = mfd_add_devices(lp873->dev, PLATFORM_DEVID_AUTO, lp873x_cells,\r\nARRAY_SIZE(lp873x_cells), NULL, 0, NULL);\r\nreturn ret;\r\n}
