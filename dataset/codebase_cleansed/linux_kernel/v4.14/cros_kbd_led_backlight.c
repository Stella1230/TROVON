static void keyboard_led_set_brightness(struct led_classdev *cdev,\r\nenum led_brightness brightness)\r\n{\r\nunion acpi_object param;\r\nstruct acpi_object_list input;\r\nacpi_status status;\r\nparam.type = ACPI_TYPE_INTEGER;\r\nparam.integer.value = brightness;\r\ninput.count = 1;\r\ninput.pointer = &param;\r\nstatus = acpi_evaluate_object(NULL, ACPI_KEYBOARD_BACKLIGHT_WRITE,\r\n&input, NULL);\r\nif (ACPI_FAILURE(status))\r\ndev_err(cdev->dev, "Error setting keyboard LED value: %d\n",\r\nstatus);\r\n}\r\nstatic enum led_brightness\r\nkeyboard_led_get_brightness(struct led_classdev *cdev)\r\n{\r\nunsigned long long brightness;\r\nacpi_status status;\r\nstatus = acpi_evaluate_integer(NULL, ACPI_KEYBOARD_BACKLIGHT_READ,\r\nNULL, &brightness);\r\nif (ACPI_FAILURE(status)) {\r\ndev_err(cdev->dev, "Error getting keyboard LED value: %d\n",\r\nstatus);\r\nreturn -EIO;\r\n}\r\nreturn brightness;\r\n}\r\nstatic int keyboard_led_probe(struct platform_device *pdev)\r\n{\r\nstruct led_classdev *cdev;\r\nacpi_handle handle;\r\nacpi_status status;\r\nint error;\r\nstatus = acpi_get_handle(ACPI_ROOT_OBJECT,\r\nACPI_KEYBOARD_BACKLIGHT_DEVICE,\r\n&handle);\r\nif (ACPI_FAILURE(status)) {\r\ndev_err(&pdev->dev, "Unable to find ACPI device %s: %d\n",\r\nACPI_KEYBOARD_BACKLIGHT_DEVICE, status);\r\nreturn -ENXIO;\r\n}\r\ncdev = devm_kzalloc(&pdev->dev, sizeof(*cdev), GFP_KERNEL);\r\nif (!cdev)\r\nreturn -ENOMEM;\r\ncdev->name = "chromeos::kbd_backlight";\r\ncdev->max_brightness = ACPI_KEYBOARD_BACKLIGHT_MAX;\r\ncdev->flags |= LED_CORE_SUSPENDRESUME;\r\ncdev->brightness_set = keyboard_led_set_brightness;\r\ncdev->brightness_get = keyboard_led_get_brightness;\r\nerror = devm_led_classdev_register(&pdev->dev, cdev);\r\nif (error)\r\nreturn error;\r\nreturn 0;\r\n}
