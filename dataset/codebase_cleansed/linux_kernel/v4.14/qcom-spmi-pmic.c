static void pmic_spmi_show_revid(struct regmap *map, struct device *dev)\r\n{\r\nunsigned int rev2, minor, major, type, subtype;\r\nconst char *name = "unknown";\r\nint ret, i;\r\nret = regmap_read(map, PMIC_TYPE, &type);\r\nif (ret < 0)\r\nreturn;\r\nif (type != PMIC_TYPE_VALUE)\r\nreturn;\r\nret = regmap_read(map, PMIC_SUBTYPE, &subtype);\r\nif (ret < 0)\r\nreturn;\r\nfor (i = 0; i < ARRAY_SIZE(pmic_spmi_id_table); i++) {\r\nif (subtype == (unsigned long)pmic_spmi_id_table[i].data)\r\nbreak;\r\n}\r\nif (i != ARRAY_SIZE(pmic_spmi_id_table))\r\nname = pmic_spmi_id_table[i].compatible;\r\nret = regmap_read(map, PMIC_REV2, &rev2);\r\nif (ret < 0)\r\nreturn;\r\nret = regmap_read(map, PMIC_REV3, &minor);\r\nif (ret < 0)\r\nreturn;\r\nret = regmap_read(map, PMIC_REV4, &major);\r\nif (ret < 0)\r\nreturn;\r\nif ((subtype == PM8941_SUBTYPE || subtype == PM8226_SUBTYPE) &&\r\nmajor < 0x02)\r\nmajor++;\r\nif (subtype == PM8110_SUBTYPE)\r\nminor = rev2;\r\ndev_dbg(dev, "%x: %s v%d.%d\n", subtype, name, major, minor);\r\n}\r\nstatic int pmic_spmi_probe(struct spmi_device *sdev)\r\n{\r\nstruct regmap *regmap;\r\nregmap = devm_regmap_init_spmi_ext(sdev, &spmi_regmap_config);\r\nif (IS_ERR(regmap))\r\nreturn PTR_ERR(regmap);\r\nif (sdev->usid % 2 == 0)\r\npmic_spmi_show_revid(regmap, &sdev->dev);\r\nreturn devm_of_platform_populate(&sdev->dev);\r\n}
