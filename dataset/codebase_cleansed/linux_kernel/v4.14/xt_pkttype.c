static bool\r\npkttype_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nconst struct xt_pkttype_info *info = par->matchinfo;\r\nu_int8_t type;\r\nif (skb->pkt_type != PACKET_LOOPBACK)\r\ntype = skb->pkt_type;\r\nelse if (xt_family(par) == NFPROTO_IPV4 &&\r\nipv4_is_multicast(ip_hdr(skb)->daddr))\r\ntype = PACKET_MULTICAST;\r\nelse if (xt_family(par) == NFPROTO_IPV6)\r\ntype = PACKET_MULTICAST;\r\nelse\r\ntype = PACKET_BROADCAST;\r\nreturn (type == info->pkttype) ^ info->invert;\r\n}\r\nstatic int __init pkttype_mt_init(void)\r\n{\r\nreturn xt_register_match(&pkttype_mt_reg);\r\n}\r\nstatic void __exit pkttype_mt_exit(void)\r\n{\r\nxt_unregister_match(&pkttype_mt_reg);\r\n}
