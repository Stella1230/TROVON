void ODM_EdcaTurboInit(void *pDM_VOID)\r\n{\r\nPDM_ODM_T pDM_Odm = (PDM_ODM_T)pDM_VOID;\r\nstruct adapter *Adapter = pDM_Odm->Adapter;\r\npDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = false;\r\npDM_Odm->DM_EDCA_Table.bIsCurRDLState = false;\r\nAdapter->recvpriv.bIsAnyNonBEPkts = false;\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("Orginial VO PARAM: 0x%x\n",\r\nrtw_read32(pDM_Odm->Adapter, ODM_EDCA_VO_PARAM)));\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("Orginial VI PARAM: 0x%x\n",\r\nrtw_read32(pDM_Odm->Adapter, ODM_EDCA_VI_PARAM)));\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("Orginial BE PARAM: 0x%x\n",\r\nrtw_read32(pDM_Odm->Adapter, ODM_EDCA_BE_PARAM)));\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("Orginial BK PARAM: 0x%x\n",\r\nrtw_read32(pDM_Odm->Adapter, ODM_EDCA_BK_PARAM)));\r\n}\r\nvoid odm_EdcaTurboCheck(void *pDM_VOID)\r\n{\r\nPDM_ODM_T pDM_Odm = (PDM_ODM_T)pDM_VOID;\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("odm_EdcaTurboCheck ========================>\n"));\r\nif (!(pDM_Odm->SupportAbility & ODM_MAC_EDCA_TURBO))\r\nreturn;\r\nodm_EdcaTurboCheckCE(pDM_Odm);\r\nODM_RT_TRACE(pDM_Odm, ODM_COMP_EDCA_TURBO, ODM_DBG_LOUD,\r\n("<========================odm_EdcaTurboCheck\n"));\r\n}\r\nvoid odm_EdcaTurboCheckCE(void *pDM_VOID)\r\n{\r\nPDM_ODM_T pDM_Odm = (PDM_ODM_T)pDM_VOID;\r\nstruct adapter *Adapter = pDM_Odm->Adapter;\r\nstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(Adapter);\r\nstruct recv_priv *precvpriv = &(Adapter->recvpriv);\r\nstruct registry_priv *pregpriv = &Adapter->registrypriv;\r\nstruct mlme_ext_priv *pmlmeext = &(Adapter->mlmeextpriv);\r\nstruct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);\r\nu32 EDCA_BE_UL = 0x5ea42b;\r\nu32 EDCA_BE_DL = 0x5ea42b;\r\nu32 iot_peer = 0;\r\nu8 wirelessmode = 0xFF;\r\nu32 trafficIndex;\r\nu32 edca_param;\r\nu64 cur_tx_bytes = 0;\r\nu64 cur_rx_bytes = 0;\r\nu8 bbtchange = false;\r\nu8 biasonrx = false;\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\r\nif (!pDM_Odm->bLinked) {\r\nprecvpriv->bIsAnyNonBEPkts = false;\r\nreturn;\r\n}\r\nif ((pregpriv->wifi_spec == 1)) {\r\nprecvpriv->bIsAnyNonBEPkts = false;\r\nreturn;\r\n}\r\nif (pDM_Odm->pwirelessmode)\r\nwirelessmode = *(pDM_Odm->pwirelessmode);\r\niot_peer = pmlmeinfo->assoc_AP_vendor;\r\nif (iot_peer >= HT_IOT_PEER_MAX) {\r\nprecvpriv->bIsAnyNonBEPkts = false;\r\nreturn;\r\n}\r\nif ((bbtchange) || (!precvpriv->bIsAnyNonBEPkts)) {\r\ncur_tx_bytes = pdvobjpriv->traffic_stat.cur_tx_bytes;\r\ncur_rx_bytes = pdvobjpriv->traffic_stat.cur_rx_bytes;\r\nif (biasonrx) {\r\nif (cur_tx_bytes > (cur_rx_bytes << 2)) {\r\ntrafficIndex = UP_LINK;\r\n} else {\r\ntrafficIndex = DOWN_LINK;\r\n}\r\n} else {\r\nif (cur_rx_bytes > (cur_tx_bytes << 2)) {\r\ntrafficIndex = DOWN_LINK;\r\n} else {\r\ntrafficIndex = UP_LINK;\r\n}\r\n}\r\nif ((iot_peer == HT_IOT_PEER_CISCO) &&\r\n(wirelessmode == ODM_WM_N24G)) {\r\nEDCA_BE_DL = edca_setting_DL[iot_peer];\r\nEDCA_BE_UL = edca_setting_UL[iot_peer];\r\n} else if ((iot_peer == HT_IOT_PEER_CISCO) &&\r\n((wirelessmode == ODM_WM_G) ||\r\n(wirelessmode == (ODM_WM_B | ODM_WM_G)) ||\r\n(wirelessmode == ODM_WM_A) ||\r\n(wirelessmode == ODM_WM_B))) {\r\nEDCA_BE_DL = edca_setting_DL_GMode[iot_peer];\r\n} else if ((iot_peer == HT_IOT_PEER_AIRGO) &&\r\n((wirelessmode == ODM_WM_G) ||\r\n(wirelessmode == ODM_WM_A))) {\r\nEDCA_BE_DL = 0xa630;\r\n} else if (iot_peer == HT_IOT_PEER_MARVELL) {\r\nEDCA_BE_DL = edca_setting_DL[iot_peer];\r\nEDCA_BE_UL = edca_setting_UL[iot_peer];\r\n} else if (iot_peer == HT_IOT_PEER_ATHEROS) {\r\nEDCA_BE_DL = edca_setting_DL[iot_peer];\r\n}\r\nif (trafficIndex == DOWN_LINK)\r\nedca_param = EDCA_BE_DL;\r\nelse\r\nedca_param = EDCA_BE_UL;\r\nrtw_write32(Adapter, REG_EDCA_BE_PARAM, edca_param);\r\npDM_Odm->DM_EDCA_Table.prv_traffic_idx = trafficIndex;\r\npDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = true;\r\n} else {\r\nif (pDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA) {\r\nrtw_write32(Adapter, REG_EDCA_BE_PARAM, pHalData->AcParam_BE);\r\npDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = false;\r\n}\r\n}\r\n}
