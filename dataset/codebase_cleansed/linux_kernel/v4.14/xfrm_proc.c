static int xfrm_statistics_seq_show(struct seq_file *seq, void *v)\r\n{\r\nunsigned long buff[LINUX_MIB_XFRMMAX];\r\nstruct net *net = seq->private;\r\nint i;\r\nmemset(buff, 0, sizeof(unsigned long) * LINUX_MIB_XFRMMAX);\r\nsnmp_get_cpu_field_batch(buff, xfrm_mib_list,\r\nnet->mib.xfrm_statistics);\r\nfor (i = 0; xfrm_mib_list[i].name; i++)\r\nseq_printf(seq, "%-24s\t%lu\n", xfrm_mib_list[i].name,\r\nbuff[i]);\r\nreturn 0;\r\n}\r\nstatic int xfrm_statistics_seq_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open_net(inode, file, xfrm_statistics_seq_show);\r\n}\r\nint __net_init xfrm_proc_init(struct net *net)\r\n{\r\nif (!proc_create("xfrm_stat", S_IRUGO, net->proc_net,\r\n&xfrm_statistics_seq_fops))\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}\r\nvoid xfrm_proc_fini(struct net *net)\r\n{\r\nremove_proc_entry("xfrm_stat", net->proc_net);\r\n}
