int owl_sps_set_pg(void __iomem *base, u32 pwr_mask, u32 ack_mask, bool enable)\r\n{\r\nu32 val;\r\nbool ack;\r\nint timeout;\r\nval = readl(base + OWL_SPS_PG_CTL);\r\nack = val & ack_mask;\r\nif (ack == enable)\r\nreturn 0;\r\nif (enable)\r\nval |= pwr_mask;\r\nelse\r\nval &= ~pwr_mask;\r\nwritel(val, base + OWL_SPS_PG_CTL);\r\nfor (timeout = 5000; timeout > 0; timeout -= 50) {\r\nval = readl(base + OWL_SPS_PG_CTL);\r\nif ((val & ack_mask) == (enable ? ack_mask : 0))\r\nbreak;\r\nudelay(50);\r\n}\r\nif (timeout <= 0)\r\nreturn -ETIMEDOUT;\r\nudelay(10);\r\nreturn 0;\r\n}
