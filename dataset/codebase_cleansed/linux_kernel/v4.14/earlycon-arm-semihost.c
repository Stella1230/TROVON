static void smh_putc(struct uart_port *port, int c)\r\n{\r\n#ifdef CONFIG_ARM64\r\nasm volatile("mov x1, %0\n"\r\n"mov x0, #3\n"\r\n"hlt 0xf000\n"\r\n: : "r" (&c) : "x0", "x1", "memory");\r\n#else\r\nasm volatile("mov r1, %0\n"\r\n"mov r0, #3\n"\r\n"svc " SEMIHOST_SWI "\n"\r\n: : "r" (&c) : "r0", "r1", "memory");\r\n#endif\r\n}\r\nstatic void smh_write(struct console *con, const char *s, unsigned n)\r\n{\r\nstruct earlycon_device *dev = con->data;\r\nuart_console_write(&dev->port, s, n, smh_putc);\r\n}\r\nstatic int\r\n__init early_smh_setup(struct earlycon_device *device, const char *opt)\r\n{\r\ndevice->con->write = smh_write;\r\nreturn 0;\r\n}
