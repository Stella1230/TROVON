__init int ima_mok_init(void)\r\n{\r\nstruct key_restriction *restriction;\r\npr_notice("Allocating IMA blacklist keyring.\n");\r\nrestriction = kzalloc(sizeof(struct key_restriction), GFP_KERNEL);\r\nif (!restriction)\r\npanic("Can't allocate IMA blacklist restriction.");\r\nrestriction->check = restrict_link_by_builtin_trusted;\r\nima_blacklist_keyring = keyring_alloc(".ima_blacklist",\r\nKUIDT_INIT(0), KGIDT_INIT(0), current_cred(),\r\n(KEY_POS_ALL & ~KEY_POS_SETATTR) |\r\nKEY_USR_VIEW | KEY_USR_READ |\r\nKEY_USR_WRITE | KEY_USR_SEARCH,\r\nKEY_ALLOC_NOT_IN_QUOTA,\r\nrestriction, NULL);\r\nif (IS_ERR(ima_blacklist_keyring))\r\npanic("Can't allocate IMA blacklist keyring.");\r\nset_bit(KEY_FLAG_KEEP, &ima_blacklist_keyring->flags);\r\nreturn 0;\r\n}
