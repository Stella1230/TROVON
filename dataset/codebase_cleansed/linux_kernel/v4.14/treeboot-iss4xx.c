static void iss_4xx_fixups(void)\r\n{\r\nvoid *memory;\r\nu32 reg[3];\r\nmemory = finddevice("/memory");\r\nif (!memory)\r\nfatal("Can't find memory node\n");\r\ngetprop(memory, "reg", reg, sizeof(reg));\r\nif (reg[2])\r\nibm4xx_memstart = reg[1];\r\nelse\r\nibm4xx_sdram_fixup_memsize();\r\n}\r\nstatic void *iss_4xx_vmlinux_alloc(unsigned long size)\r\n{\r\nreturn (void *)ibm4xx_memstart;\r\n}\r\nvoid platform_init(void)\r\n{\r\nunsigned long end_of_ram = 0x08000000;\r\nunsigned long avail_ram = end_of_ram - (unsigned long)_end;\r\nu32 pir_reg;\r\nsimple_alloc_init(_end, avail_ram, 128, 64);\r\nplatform_ops.fixups = iss_4xx_fixups;\r\nplatform_ops.vmlinux_alloc = iss_4xx_vmlinux_alloc;\r\nplatform_ops.exit = ibm44x_dbcr_reset;\r\npir_reg = mfspr(SPRN_PIR);\r\nfdt_set_boot_cpuid_phys(_dtb_start, pir_reg);\r\nfdt_init(_dtb_start);\r\nserial_console_init();\r\n}
