static int broadwell_rt286_codec_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_codec *codec = rtd->codec;\r\nint ret = 0;\r\nret = snd_soc_card_jack_new(rtd->card, "Headset",\r\nSND_JACK_HEADSET | SND_JACK_BTN_0, &broadwell_headset,\r\nbroadwell_headset_pins, ARRAY_SIZE(broadwell_headset_pins));\r\nif (ret)\r\nreturn ret;\r\nrt286_mic_detect(codec, &broadwell_headset);\r\nreturn 0;\r\n}\r\nstatic int broadwell_ssp0_fixup(struct snd_soc_pcm_runtime *rtd,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_interval *rate = hw_param_interval(params,\r\nSNDRV_PCM_HW_PARAM_RATE);\r\nstruct snd_interval *channels = hw_param_interval(params,\r\nSNDRV_PCM_HW_PARAM_CHANNELS);\r\nrate->min = rate->max = 48000;\r\nchannels->min = channels->max = 2;\r\nparams_set_format(params, SNDRV_PCM_FORMAT_S16_LE);\r\nreturn 0;\r\n}\r\nstatic int broadwell_rt286_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nint ret;\r\nret = snd_soc_dai_set_sysclk(codec_dai, RT286_SCLK_S_PLL, 24000000,\r\nSND_SOC_CLOCK_IN);\r\nif (ret < 0) {\r\ndev_err(rtd->dev, "can't set codec sysclk configuration\n");\r\nreturn ret;\r\n}\r\nreturn ret;\r\n}\r\nstatic int broadwell_rtd_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct sst_pdata *pdata = dev_get_platdata(rtd->platform->dev);\r\nstruct sst_hsw *broadwell = pdata->dsp;\r\nint ret;\r\nret = sst_hsw_device_set_config(broadwell, SST_HSW_DEVICE_SSP_0,\r\nSST_HSW_DEVICE_MCLK_FREQ_24_MHZ,\r\nSST_HSW_DEVICE_CLOCK_MASTER, 9);\r\nif (ret < 0) {\r\ndev_err(rtd->dev, "error: failed to set device config\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int broadwell_suspend(struct snd_soc_card *card){\r\nstruct snd_soc_component *component;\r\nlist_for_each_entry(component, &card->component_dev_list, card_list) {\r\nif (!strcmp(component->name, "i2c-INT343A:00")) {\r\nstruct snd_soc_codec *codec = snd_soc_component_to_codec(component);\r\ndev_dbg(codec->dev, "disabling jack detect before going to suspend.\n");\r\nrt286_mic_detect(codec, NULL);\r\nbreak;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int broadwell_resume(struct snd_soc_card *card){\r\nstruct snd_soc_component *component;\r\nlist_for_each_entry(component, &card->component_dev_list, card_list) {\r\nif (!strcmp(component->name, "i2c-INT343A:00")) {\r\nstruct snd_soc_codec *codec = snd_soc_component_to_codec(component);\r\ndev_dbg(codec->dev, "enabling jack detect for resume.\n");\r\nrt286_mic_detect(codec, &broadwell_headset);\r\nbreak;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int broadwell_audio_probe(struct platform_device *pdev)\r\n{\r\nbroadwell_rt286.dev = &pdev->dev;\r\nreturn devm_snd_soc_register_card(&pdev->dev, &broadwell_rt286);\r\n}
