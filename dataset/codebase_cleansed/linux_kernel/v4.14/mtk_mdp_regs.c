static int32_t mtk_mdp_map_color_format(int v4l2_format)\r\n{\r\nswitch (v4l2_format) {\r\ncase V4L2_PIX_FMT_NV12M:\r\ncase V4L2_PIX_FMT_NV12:\r\nreturn MDP_COLOR_NV12;\r\ncase V4L2_PIX_FMT_MT21C:\r\nreturn MDP_COLOR_420_MT21;\r\ncase V4L2_PIX_FMT_YUV420M:\r\ncase V4L2_PIX_FMT_YUV420:\r\nreturn MDP_COLOR_I420;\r\ncase V4L2_PIX_FMT_YVU420:\r\nreturn MDP_COLOR_YV12;\r\n}\r\nmtk_mdp_err("Unknown format 0x%x", v4l2_format);\r\nreturn MDP_COLOR_UNKNOWN;\r\n}\r\nvoid mtk_mdp_hw_set_input_addr(struct mtk_mdp_ctx *ctx,\r\nstruct mtk_mdp_addr *addr)\r\n{\r\nstruct mdp_buffer *src_buf = &ctx->vpu.vsi->src_buffer;\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(addr->addr); i++)\r\nsrc_buf->addr_mva[i] = (uint64_t)addr->addr[i];\r\n}\r\nvoid mtk_mdp_hw_set_output_addr(struct mtk_mdp_ctx *ctx,\r\nstruct mtk_mdp_addr *addr)\r\n{\r\nstruct mdp_buffer *dst_buf = &ctx->vpu.vsi->dst_buffer;\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(addr->addr); i++)\r\ndst_buf->addr_mva[i] = (uint64_t)addr->addr[i];\r\n}\r\nvoid mtk_mdp_hw_set_in_size(struct mtk_mdp_ctx *ctx)\r\n{\r\nstruct mtk_mdp_frame *frame = &ctx->s_frame;\r\nstruct mdp_config *config = &ctx->vpu.vsi->src_config;\r\nconfig->crop_x = frame->crop.left;\r\nconfig->crop_y = frame->crop.top;\r\nconfig->crop_w = frame->crop.width;\r\nconfig->crop_h = frame->crop.height;\r\nconfig->x = 0;\r\nconfig->y = 0;\r\nconfig->w = frame->width;\r\nconfig->h = frame->height;\r\n}\r\nvoid mtk_mdp_hw_set_in_image_format(struct mtk_mdp_ctx *ctx)\r\n{\r\nunsigned int i;\r\nstruct mtk_mdp_frame *frame = &ctx->s_frame;\r\nstruct mdp_config *config = &ctx->vpu.vsi->src_config;\r\nstruct mdp_buffer *src_buf = &ctx->vpu.vsi->src_buffer;\r\nsrc_buf->plane_num = frame->fmt->num_comp;\r\nconfig->format = mtk_mdp_map_color_format(frame->fmt->pixelformat);\r\nconfig->w_stride = 0;\r\nconfig->h_stride = 0;\r\nfor (i = 0; i < src_buf->plane_num; i++)\r\nsrc_buf->plane_size[i] = frame->payload[i];\r\n}\r\nvoid mtk_mdp_hw_set_out_size(struct mtk_mdp_ctx *ctx)\r\n{\r\nstruct mtk_mdp_frame *frame = &ctx->d_frame;\r\nstruct mdp_config *config = &ctx->vpu.vsi->dst_config;\r\nconfig->crop_x = frame->crop.left;\r\nconfig->crop_y = frame->crop.top;\r\nconfig->crop_w = frame->crop.width;\r\nconfig->crop_h = frame->crop.height;\r\nconfig->x = 0;\r\nconfig->y = 0;\r\nconfig->w = frame->width;\r\nconfig->h = frame->height;\r\n}\r\nvoid mtk_mdp_hw_set_out_image_format(struct mtk_mdp_ctx *ctx)\r\n{\r\nunsigned int i;\r\nstruct mtk_mdp_frame *frame = &ctx->d_frame;\r\nstruct mdp_config *config = &ctx->vpu.vsi->dst_config;\r\nstruct mdp_buffer *dst_buf = &ctx->vpu.vsi->dst_buffer;\r\ndst_buf->plane_num = frame->fmt->num_comp;\r\nconfig->format = mtk_mdp_map_color_format(frame->fmt->pixelformat);\r\nconfig->w_stride = 0;\r\nconfig->h_stride = 0;\r\nfor (i = 0; i < dst_buf->plane_num; i++)\r\ndst_buf->plane_size[i] = frame->payload[i];\r\n}\r\nvoid mtk_mdp_hw_set_rotation(struct mtk_mdp_ctx *ctx)\r\n{\r\nstruct mdp_config_misc *misc = &ctx->vpu.vsi->misc;\r\nmisc->orientation = ctx->ctrls.rotate->val;\r\nmisc->hflip = ctx->ctrls.hflip->val;\r\nmisc->vflip = ctx->ctrls.vflip->val;\r\n}\r\nvoid mtk_mdp_hw_set_global_alpha(struct mtk_mdp_ctx *ctx)\r\n{\r\nstruct mdp_config_misc *misc = &ctx->vpu.vsi->misc;\r\nmisc->alpha = ctx->ctrls.global_alpha->val;\r\n}
