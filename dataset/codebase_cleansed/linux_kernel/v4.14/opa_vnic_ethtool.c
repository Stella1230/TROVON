static void vnic_get_drvinfo(struct net_device *netdev,\r\nstruct ethtool_drvinfo *drvinfo)\r\n{\r\nstrlcpy(drvinfo->driver, opa_vnic_driver_name, sizeof(drvinfo->driver));\r\nstrlcpy(drvinfo->version, opa_vnic_driver_version,\r\nsizeof(drvinfo->version));\r\nstrlcpy(drvinfo->bus_info, dev_name(netdev->dev.parent),\r\nsizeof(drvinfo->bus_info));\r\n}\r\nstatic int vnic_get_sset_count(struct net_device *netdev, int sset)\r\n{\r\nreturn (sset == ETH_SS_STATS) ? VNIC_STATS_LEN : -EOPNOTSUPP;\r\n}\r\nstatic void vnic_get_ethtool_stats(struct net_device *netdev,\r\nstruct ethtool_stats *stats, u64 *data)\r\n{\r\nstruct opa_vnic_adapter *adapter = opa_vnic_priv(netdev);\r\nstruct opa_vnic_stats vstats;\r\nint i;\r\nmemset(&vstats, 0, sizeof(vstats));\r\nspin_lock(&adapter->stats_lock);\r\nadapter->rn_ops->ndo_get_stats64(netdev, &vstats.netstats);\r\nspin_unlock(&adapter->stats_lock);\r\nfor (i = 0; i < VNIC_STATS_LEN; i++) {\r\nchar *p = (char *)&vstats + vnic_gstrings_stats[i].stat_offset;\r\ndata[i] = (vnic_gstrings_stats[i].sizeof_stat ==\r\nsizeof(u64)) ? *(u64 *)p : *(u32 *)p;\r\n}\r\n}\r\nstatic void vnic_get_strings(struct net_device *netdev, u32 stringset, u8 *data)\r\n{\r\nint i;\r\nif (stringset != ETH_SS_STATS)\r\nreturn;\r\nfor (i = 0; i < VNIC_STATS_LEN; i++)\r\nmemcpy(data + i * ETH_GSTRING_LEN,\r\nvnic_gstrings_stats[i].stat_string,\r\nETH_GSTRING_LEN);\r\n}\r\nvoid opa_vnic_set_ethtool_ops(struct net_device *netdev)\r\n{\r\nnetdev->ethtool_ops = &opa_vnic_ethtool_ops;\r\n}
