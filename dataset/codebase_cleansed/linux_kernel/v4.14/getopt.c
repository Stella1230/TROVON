int acpi_getopt_argument(int argc, char **argv)\r\n{\r\nacpi_gbl_optind--;\r\ncurrent_char_ptr++;\r\nif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\0') {\r\nacpi_gbl_optarg =\r\n&argv[acpi_gbl_optind++][(int)(current_char_ptr + 1)];\r\n} else if (++acpi_gbl_optind >= argc) {\r\nACPI_OPTION_ERROR("\nOption requires an argument", 0);\r\ncurrent_char_ptr = 1;\r\nreturn (-1);\r\n} else {\r\nacpi_gbl_optarg = argv[acpi_gbl_optind++];\r\n}\r\ncurrent_char_ptr = 1;\r\nreturn (0);\r\n}\r\nint acpi_getopt(int argc, char **argv, char *opts)\r\n{\r\nint current_char;\r\nchar *opts_ptr;\r\nif (current_char_ptr == 1) {\r\nif (acpi_gbl_optind >= argc ||\r\nargv[acpi_gbl_optind][0] != '-' ||\r\nargv[acpi_gbl_optind][1] == '\0') {\r\nreturn (ACPI_OPT_END);\r\n} else if (strcmp(argv[acpi_gbl_optind], "--") == 0) {\r\nacpi_gbl_optind++;\r\nreturn (ACPI_OPT_END);\r\n}\r\n}\r\ncurrent_char = argv[acpi_gbl_optind][current_char_ptr];\r\nif (current_char == ':' ||\r\n(opts_ptr = strchr(opts, current_char)) == NULL) {\r\nACPI_OPTION_ERROR("Illegal option: -", current_char);\r\nif (argv[acpi_gbl_optind][++current_char_ptr] == '\0') {\r\nacpi_gbl_optind++;\r\ncurrent_char_ptr = 1;\r\n}\r\nreturn ('?');\r\n}\r\nif (*++opts_ptr == ':') {\r\nif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\0') {\r\nacpi_gbl_optarg =\r\n&argv[acpi_gbl_optind++][(int)\r\n(current_char_ptr + 1)];\r\n} else if (++acpi_gbl_optind >= argc) {\r\nACPI_OPTION_ERROR("Option requires an argument: -",\r\ncurrent_char);\r\ncurrent_char_ptr = 1;\r\nreturn ('?');\r\n} else {\r\nacpi_gbl_optarg = argv[acpi_gbl_optind++];\r\n}\r\ncurrent_char_ptr = 1;\r\n}\r\nelse if (*opts_ptr == '+') {\r\nif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\0') {\r\nacpi_gbl_optarg =\r\n&argv[acpi_gbl_optind++][(int)\r\n(current_char_ptr + 1)];\r\n} else if (++acpi_gbl_optind >= argc) {\r\nacpi_gbl_optarg = NULL;\r\n} else {\r\nacpi_gbl_optarg = argv[acpi_gbl_optind++];\r\n}\r\ncurrent_char_ptr = 1;\r\n}\r\nelse if (*opts_ptr == '^') {\r\nif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\0') {\r\nacpi_gbl_optarg =\r\n&argv[acpi_gbl_optind][(int)(current_char_ptr + 1)];\r\n} else {\r\nacpi_gbl_optarg = "^";\r\n}\r\nacpi_gbl_sub_opt_char = acpi_gbl_optarg[0];\r\nacpi_gbl_optind++;\r\ncurrent_char_ptr = 1;\r\n}\r\nelse if (*opts_ptr == '|') {\r\nif (argv[acpi_gbl_optind][(int)(current_char_ptr + 1)] != '\0') {\r\nacpi_gbl_optarg =\r\n&argv[acpi_gbl_optind][(int)(current_char_ptr + 1)];\r\n} else {\r\nACPI_OPTION_ERROR\r\n("Option requires a single-character suboption: -",\r\ncurrent_char);\r\ncurrent_char_ptr = 1;\r\nreturn ('?');\r\n}\r\nacpi_gbl_sub_opt_char = acpi_gbl_optarg[0];\r\nacpi_gbl_optind++;\r\ncurrent_char_ptr = 1;\r\n}\r\nelse {\r\nif (argv[acpi_gbl_optind][++current_char_ptr] == '\0') {\r\ncurrent_char_ptr = 1;\r\nacpi_gbl_optind++;\r\n}\r\nacpi_gbl_optarg = NULL;\r\n}\r\nreturn (current_char);\r\n}
