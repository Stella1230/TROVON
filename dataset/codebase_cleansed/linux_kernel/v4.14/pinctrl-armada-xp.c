static int armada_xp_pinctrl_suspend(struct platform_device *pdev,\r\npm_message_t state)\r\n{\r\nstruct mvebu_pinctrl_soc_info *soc =\r\nplatform_get_drvdata(pdev);\r\nint i, nregs;\r\nnregs = DIV_ROUND_UP(soc->nmodes, MVEBU_MPPS_PER_REG);\r\nfor (i = 0; i < nregs; i++)\r\nmpp_saved_regs[i] = readl(soc->control_data[0].base + i * 4);\r\nreturn 0;\r\n}\r\nstatic int armada_xp_pinctrl_resume(struct platform_device *pdev)\r\n{\r\nstruct mvebu_pinctrl_soc_info *soc =\r\nplatform_get_drvdata(pdev);\r\nint i, nregs;\r\nnregs = DIV_ROUND_UP(soc->nmodes, MVEBU_MPPS_PER_REG);\r\nfor (i = 0; i < nregs; i++)\r\nwritel(mpp_saved_regs[i], soc->control_data[0].base + i * 4);\r\nreturn 0;\r\n}\r\nstatic int armada_xp_pinctrl_probe(struct platform_device *pdev)\r\n{\r\nstruct mvebu_pinctrl_soc_info *soc = &armada_xp_pinctrl_info;\r\nconst struct of_device_id *match =\r\nof_match_device(armada_xp_pinctrl_of_match, &pdev->dev);\r\nint nregs;\r\nif (!match)\r\nreturn -ENODEV;\r\nsoc->variant = (unsigned) match->data & 0xff;\r\nswitch (soc->variant) {\r\ncase V_MV78230:\r\nsoc->controls = mv78230_mpp_controls;\r\nsoc->ncontrols = ARRAY_SIZE(mv78230_mpp_controls);\r\nsoc->modes = armada_xp_mpp_modes;\r\nsoc->nmodes = mv78230_mpp_controls[0].npins;\r\nsoc->gpioranges = mv78230_mpp_gpio_ranges;\r\nsoc->ngpioranges = ARRAY_SIZE(mv78230_mpp_gpio_ranges);\r\nbreak;\r\ncase V_MV78260:\r\nsoc->controls = mv78260_mpp_controls;\r\nsoc->ncontrols = ARRAY_SIZE(mv78260_mpp_controls);\r\nsoc->modes = armada_xp_mpp_modes;\r\nsoc->nmodes = mv78260_mpp_controls[0].npins;\r\nsoc->gpioranges = mv78260_mpp_gpio_ranges;\r\nsoc->ngpioranges = ARRAY_SIZE(mv78260_mpp_gpio_ranges);\r\nbreak;\r\ncase V_MV78460:\r\nsoc->controls = mv78460_mpp_controls;\r\nsoc->ncontrols = ARRAY_SIZE(mv78460_mpp_controls);\r\nsoc->modes = armada_xp_mpp_modes;\r\nsoc->nmodes = mv78460_mpp_controls[0].npins;\r\nsoc->gpioranges = mv78460_mpp_gpio_ranges;\r\nsoc->ngpioranges = ARRAY_SIZE(mv78460_mpp_gpio_ranges);\r\nbreak;\r\ncase V_98DX3236:\r\ncase V_98DX3336:\r\ncase V_98DX4251:\r\nsoc->controls = mv98dx3236_mpp_controls;\r\nsoc->ncontrols = ARRAY_SIZE(mv98dx3236_mpp_controls);\r\nsoc->modes = mv98dx3236_mpp_modes;\r\nsoc->nmodes = mv98dx3236_mpp_controls[0].npins;\r\nsoc->gpioranges = mv98dx3236_mpp_gpio_ranges;\r\nsoc->ngpioranges = ARRAY_SIZE(mv98dx3236_mpp_gpio_ranges);\r\nbreak;\r\n}\r\nnregs = DIV_ROUND_UP(soc->nmodes, MVEBU_MPPS_PER_REG);\r\nmpp_saved_regs = devm_kmalloc(&pdev->dev, nregs * sizeof(u32),\r\nGFP_KERNEL);\r\nif (!mpp_saved_regs)\r\nreturn -ENOMEM;\r\npdev->dev.platform_data = soc;\r\nreturn mvebu_pinctrl_simple_mmio_probe(pdev);\r\n}
