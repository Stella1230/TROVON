static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nif (par->gpio.cs != -1)\r\ngpio_set_value(par->gpio.cs, 0);\r\nbt &= 0x07;\r\nvc &= 0x07;\r\nvrh &= 0x0f;\r\nvdv &= 0x1f;\r\nvcm &= 0x3f;\r\nwrite_reg(par, 0x00E3, 0x3008);\r\nwrite_reg(par, 0x00E7, 0x0012);\r\nwrite_reg(par, 0x00EF, 0x1231);\r\nwrite_reg(par, 0x0001, 0x0100);\r\nwrite_reg(par, 0x0002, 0x0700);\r\nwrite_reg(par, 0x0004, 0x0000);\r\nwrite_reg(par, 0x0008, 0x0207);\r\nwrite_reg(par, 0x0009, 0x0000);\r\nwrite_reg(par, 0x000A, 0x0000);\r\nwrite_reg(par, 0x000C, 0x0000);\r\nwrite_reg(par, 0x000D, 0x0000);\r\nwrite_reg(par, 0x000F, 0x0000);\r\nwrite_reg(par, 0x0010, 0x0000);\r\nwrite_reg(par, 0x0011, 0x0007);\r\nwrite_reg(par, 0x0012, 0x0000);\r\nwrite_reg(par, 0x0013, 0x0000);\r\nmdelay(200);\r\nwrite_reg(par, 0x0010,\r\nBIT(12) | (bt << 8) | BIT(7) | BIT(4));\r\nwrite_reg(par, 0x0011, 0x220 | vc);\r\nmdelay(50);\r\nwrite_reg(par, 0x0012, vrh);\r\nmdelay(50);\r\nwrite_reg(par, 0x0013, vdv << 8);\r\nwrite_reg(par, 0x0029, vcm);\r\nwrite_reg(par, 0x002B, 0x000C);\r\nmdelay(50);\r\nwrite_reg(par, 0x0020, 0x0000);\r\nwrite_reg(par, 0x0021, 0x0000);\r\nwrite_reg(par, 0x0050, 0x0000);\r\nwrite_reg(par, 0x0051, 0x00EF);\r\nwrite_reg(par, 0x0052, 0x0000);\r\nwrite_reg(par, 0x0053, 0x013F);\r\nwrite_reg(par, 0x0060, 0xA700);\r\nwrite_reg(par, 0x0061, 0x0001);\r\nwrite_reg(par, 0x006A, 0x0000);\r\nwrite_reg(par, 0x0080, 0x0000);\r\nwrite_reg(par, 0x0081, 0x0000);\r\nwrite_reg(par, 0x0082, 0x0000);\r\nwrite_reg(par, 0x0083, 0x0000);\r\nwrite_reg(par, 0x0084, 0x0000);\r\nwrite_reg(par, 0x0085, 0x0000);\r\nwrite_reg(par, 0x0090, 0x0010);\r\nwrite_reg(par, 0x0092, 0x0600);\r\nwrite_reg(par, 0x0007, 0x0133);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, 0x0020, xs);\r\nwrite_reg(par, 0x0021, ys);\r\nbreak;\r\ncase 180:\r\nwrite_reg(par, 0x0020, WIDTH - 1 - xs);\r\nwrite_reg(par, 0x0021, HEIGHT - 1 - ys);\r\nbreak;\r\ncase 270:\r\nwrite_reg(par, 0x0020, WIDTH - 1 - ys);\r\nwrite_reg(par, 0x0021, xs);\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, 0x0020, ys);\r\nwrite_reg(par, 0x0021, HEIGHT - 1 - xs);\r\nbreak;\r\n}\r\nwrite_reg(par, 0x0022);\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, 0x03, 0x0030 | (par->bgr << 12));\r\nbreak;\r\ncase 180:\r\nwrite_reg(par, 0x03, 0x0000 | (par->bgr << 12));\r\nbreak;\r\ncase 270:\r\nwrite_reg(par, 0x03, 0x0028 | (par->bgr << 12));\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, 0x03, 0x0018 | (par->bgr << 12));\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, u32 *curves)\r\n{\r\nunsigned long mask[] = {\r\n0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\r\n0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\r\n};\r\nint i, j;\r\nfor (i = 0; i < 2; i++)\r\nfor (j = 0; j < 10; j++)\r\nCURVE(i, j) &= mask[i * par->gamma.num_values + j];\r\nwrite_reg(par, 0x0030, CURVE(0, 5) << 8 | CURVE(0, 4));\r\nwrite_reg(par, 0x0031, CURVE(0, 7) << 8 | CURVE(0, 6));\r\nwrite_reg(par, 0x0032, CURVE(0, 9) << 8 | CURVE(0, 8));\r\nwrite_reg(par, 0x0035, CURVE(0, 3) << 8 | CURVE(0, 2));\r\nwrite_reg(par, 0x0036, CURVE(0, 1) << 8 | CURVE(0, 0));\r\nwrite_reg(par, 0x0037, CURVE(1, 5) << 8 | CURVE(1, 4));\r\nwrite_reg(par, 0x0038, CURVE(1, 7) << 8 | CURVE(1, 6));\r\nwrite_reg(par, 0x0039, CURVE(1, 9) << 8 | CURVE(1, 8));\r\nwrite_reg(par, 0x003C, CURVE(1, 3) << 8 | CURVE(1, 2));\r\nwrite_reg(par, 0x003D, CURVE(1, 1) << 8 | CURVE(1, 0));\r\nreturn 0;\r\n}
