static int get_temp_8996(struct tsens_device *tmdev, int id, int *temp)\r\n{\r\nstruct tsens_sensor *s = &tmdev->sensor[id];\r\nu32 code;\r\nunsigned int sensor_addr;\r\nint last_temp = 0, last_temp2 = 0, last_temp3 = 0, ret;\r\nsensor_addr = STATUS_OFFSET + s->hw_id * 4;\r\nret = regmap_read(tmdev->map, sensor_addr, &code);\r\nif (ret)\r\nreturn ret;\r\nlast_temp = code & LAST_TEMP_MASK;\r\nif (code & STATUS_VALID_BIT)\r\ngoto done;\r\nret = regmap_read(tmdev->map, sensor_addr, &code);\r\nif (ret)\r\nreturn ret;\r\nif (code & STATUS_VALID_BIT) {\r\nlast_temp = code & LAST_TEMP_MASK;\r\ngoto done;\r\n} else {\r\nlast_temp2 = code & LAST_TEMP_MASK;\r\n}\r\nret = regmap_read(tmdev->map, sensor_addr, &code);\r\nif (ret)\r\nreturn ret;\r\nif (code & STATUS_VALID_BIT) {\r\nlast_temp = code & LAST_TEMP_MASK;\r\ngoto done;\r\n} else {\r\nlast_temp3 = code & LAST_TEMP_MASK;\r\n}\r\nif (last_temp == last_temp2)\r\nlast_temp = last_temp2;\r\nelse if (last_temp2 == last_temp3)\r\nlast_temp = last_temp3;\r\ndone:\r\nif (last_temp & CODE_SIGN_BIT)\r\nlast_temp |= ~CODE_SIGN_BIT;\r\n*temp = last_temp * 100;\r\nreturn 0;\r\n}
