static int tps65086_gpio_get_direction(struct gpio_chip *chip,\r\nunsigned offset)\r\n{\r\nreturn 0;\r\n}\r\nstatic int tps65086_gpio_direction_input(struct gpio_chip *chip,\r\nunsigned offset)\r\n{\r\nreturn -EINVAL;\r\n}\r\nstatic int tps65086_gpio_direction_output(struct gpio_chip *chip,\r\nunsigned offset, int value)\r\n{\r\nstruct tps65086_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->tps->regmap, TPS65086_GPOCTRL,\r\nBIT(4 + offset), value ? BIT(4 + offset) : 0);\r\nreturn 0;\r\n}\r\nstatic int tps65086_gpio_get(struct gpio_chip *chip, unsigned offset)\r\n{\r\nstruct tps65086_gpio *gpio = gpiochip_get_data(chip);\r\nint ret, val;\r\nret = regmap_read(gpio->tps->regmap, TPS65086_GPOCTRL, &val);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn val & BIT(4 + offset);\r\n}\r\nstatic void tps65086_gpio_set(struct gpio_chip *chip, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65086_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->tps->regmap, TPS65086_GPOCTRL,\r\nBIT(4 + offset), value ? BIT(4 + offset) : 0);\r\n}\r\nstatic int tps65086_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65086_gpio *gpio;\r\nint ret;\r\ngpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(pdev, gpio);\r\ngpio->tps = dev_get_drvdata(pdev->dev.parent);\r\ngpio->chip = template_chip;\r\ngpio->chip.parent = gpio->tps->dev;\r\nret = gpiochip_add_data(&gpio->chip, gpio);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Could not register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int tps65086_gpio_remove(struct platform_device *pdev)\r\n{\r\nstruct tps65086_gpio *gpio = platform_get_drvdata(pdev);\r\ngpiochip_remove(&gpio->chip);\r\nreturn 0;\r\n}
