void __init omap2_set_globals_cm(void __iomem *cm, void __iomem *cm2)\r\n{\r\ncm_base.va = cm;\r\ncm2_base.va = cm2;\r\n}\r\nint cm_split_idlest_reg(struct clk_omap_reg *idlest_reg, s16 *prcm_inst,\r\nu8 *idlest_reg_id)\r\n{\r\nif (!cm_ll_data->split_idlest_reg) {\r\nWARN_ONCE(1, "cm: %s: no low-level function defined\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\nreturn cm_ll_data->split_idlest_reg(idlest_reg, prcm_inst,\r\nidlest_reg_id);\r\n}\r\nint omap_cm_wait_module_ready(u8 part, s16 prcm_mod, u16 idlest_reg,\r\nu8 idlest_shift)\r\n{\r\nif (!cm_ll_data->wait_module_ready) {\r\nWARN_ONCE(1, "cm: %s: no low-level function defined\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\nreturn cm_ll_data->wait_module_ready(part, prcm_mod, idlest_reg,\r\nidlest_shift);\r\n}\r\nint omap_cm_wait_module_idle(u8 part, s16 prcm_mod, u16 idlest_reg,\r\nu8 idlest_shift)\r\n{\r\nif (!cm_ll_data->wait_module_idle) {\r\nWARN_ONCE(1, "cm: %s: no low-level function defined\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\nreturn cm_ll_data->wait_module_idle(part, prcm_mod, idlest_reg,\r\nidlest_shift);\r\n}\r\nint omap_cm_module_enable(u8 mode, u8 part, u16 inst, u16 clkctrl_offs)\r\n{\r\nif (!cm_ll_data->module_enable) {\r\nWARN_ONCE(1, "cm: %s: no low-level function defined\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\ncm_ll_data->module_enable(mode, part, inst, clkctrl_offs);\r\nreturn 0;\r\n}\r\nint omap_cm_module_disable(u8 part, u16 inst, u16 clkctrl_offs)\r\n{\r\nif (!cm_ll_data->module_disable) {\r\nWARN_ONCE(1, "cm: %s: no low-level function defined\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\ncm_ll_data->module_disable(part, inst, clkctrl_offs);\r\nreturn 0;\r\n}\r\nint cm_register(struct cm_ll_data *cld)\r\n{\r\nif (!cld)\r\nreturn -EINVAL;\r\nif (cm_ll_data != &null_cm_ll_data)\r\nreturn -EEXIST;\r\ncm_ll_data = cld;\r\nreturn 0;\r\n}\r\nint cm_unregister(struct cm_ll_data *cld)\r\n{\r\nif (!cld || cm_ll_data != cld)\r\nreturn -EINVAL;\r\ncm_ll_data = &null_cm_ll_data;\r\nreturn 0;\r\n}\r\nint __init omap2_cm_base_init(void)\r\n{\r\nstruct device_node *np;\r\nconst struct of_device_id *match;\r\nstruct omap_prcm_init_data *data;\r\nstruct resource res;\r\nint ret;\r\nstruct omap_domain_base *mem = NULL;\r\nfor_each_matching_node_and_match(np, omap_cm_dt_match_table, &match) {\r\ndata = (struct omap_prcm_init_data *)match->data;\r\nret = of_address_to_resource(np, 0, &res);\r\nif (ret)\r\nreturn ret;\r\nif (data->index == TI_CLKM_CM)\r\nmem = &cm_base;\r\nif (data->index == TI_CLKM_CM2)\r\nmem = &cm2_base;\r\ndata->mem = ioremap(res.start, resource_size(&res));\r\nif (mem) {\r\nmem->pa = res.start + data->offset;\r\nmem->va = data->mem + data->offset;\r\n}\r\ndata->np = np;\r\nif (data->init && (data->flags & CM_SINGLE_INSTANCE ||\r\n(cm_base.va && cm2_base.va)))\r\ndata->init(data);\r\n}\r\nreturn 0;\r\n}\r\nint __init omap_cm_init(void)\r\n{\r\nstruct device_node *np;\r\nconst struct of_device_id *match;\r\nconst struct omap_prcm_init_data *data;\r\nint ret;\r\nfor_each_matching_node_and_match(np, omap_cm_dt_match_table, &match) {\r\ndata = match->data;\r\nif (data->flags & CM_NO_CLOCKS)\r\ncontinue;\r\nret = omap2_clk_provider_init(np, data->index, NULL, data->mem);\r\nif (ret)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
