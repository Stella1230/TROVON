static int ahci_octeon_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct device_node *node = dev->of_node;\r\nstruct resource *res;\r\nvoid __iomem *base;\r\nu64 cfg;\r\nint ret;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nbase = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(base))\r\nreturn PTR_ERR(base);\r\ncfg = cvmx_readq_csr(base + CVMX_SATA_UCTL_SHIM_CFG);\r\ncfg &= ~(SATA_UCTL_ENDIAN_MODE_MASK << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT);\r\ncfg &= ~(SATA_UCTL_ENDIAN_MODE_MASK << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT);\r\n#ifdef __BIG_ENDIAN\r\ncfg |= SATA_UCTL_ENDIAN_MODE_BIG << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT;\r\ncfg |= SATA_UCTL_ENDIAN_MODE_BIG << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT;\r\n#else\r\ncfg |= SATA_UCTL_ENDIAN_MODE_LITTLE << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT;\r\ncfg |= SATA_UCTL_ENDIAN_MODE_LITTLE << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT;\r\n#endif\r\ncfg |= 1 << SATA_UCTL_DMA_READ_CMD_SHIFT;\r\ncvmx_writeq_csr(base + CVMX_SATA_UCTL_SHIM_CFG, cfg);\r\nif (!node) {\r\ndev_err(dev, "no device node, failed to add octeon sata\n");\r\nreturn -ENODEV;\r\n}\r\nret = of_platform_populate(node, NULL, NULL, dev);\r\nif (ret) {\r\ndev_err(dev, "failed to add ahci-platform core\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ahci_octeon_remove(struct platform_device *pdev)\r\n{\r\nreturn 0;\r\n}
