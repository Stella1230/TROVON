static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nwrite_reg(par, 0x21);\r\nwrite_reg(par, 0x04 | (tc & 0x3));\r\nwrite_reg(par, 0x10 | (bs & 0x7));\r\nwrite_reg(par, 0x22);\r\nwrite_reg(par, 0x08 | 4);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, 0x80);\r\nwrite_reg(par, 0x40);\r\n}\r\nstatic int write_vmem(struct fbtft_par *par, size_t offset, size_t len)\r\n{\r\nu16 *vmem16 = (u16 *)par->info->screen_buffer;\r\nu8 *buf = par->txbuf.buf;\r\nint x, y, i;\r\nint ret = 0;\r\nfor (x = 0; x < 84; x++) {\r\nfor (y = 0; y < 6; y++) {\r\n*buf = 0x00;\r\nfor (i = 0; i < 8; i++)\r\n*buf |= (vmem16[(y * 8 + i) * 84 + x] ?\r\n1 : 0) << i;\r\nbuf++;\r\n}\r\n}\r\ngpio_set_value(par->gpio.dc, 1);\r\nret = par->fbtftops.write(par, par->txbuf.buf, 6 * 84);\r\nif (ret < 0)\r\ndev_err(par->info->device, "write failed and returned: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, u32 *curves)\r\n{\r\ncurves[0] &= 0x7F;\r\nwrite_reg(par, 0x23);\r\nwrite_reg(par, 0x80 | curves[0]);\r\nwrite_reg(par, 0x22);\r\nreturn 0;\r\n}
