int netup_eeprom_read(struct i2c_adapter *i2c_adap, u8 addr)\r\n{\r\nint ret;\r\nunsigned char buf[2];\r\nstruct i2c_msg msg[] = {\r\n{\r\n.addr = EEPROM_I2C_ADDR,\r\n.flags = 0,\r\n.buf = &buf[0],\r\n.len = 1\r\n}, {\r\n.addr = EEPROM_I2C_ADDR,\r\n.flags = I2C_M_RD,\r\n.buf = &buf[1],\r\n.len = 1\r\n}\r\n};\r\nbuf[0] = addr;\r\nbuf[1] = 0x0;\r\nret = i2c_transfer(i2c_adap, msg, 2);\r\nif (ret != 2) {\r\npr_err("eeprom i2c read error, status=%d\n", ret);\r\nreturn -1;\r\n}\r\nreturn buf[1];\r\n}\r\nint netup_eeprom_write(struct i2c_adapter *i2c_adap, u8 addr, u8 data)\r\n{\r\nint ret;\r\nunsigned char bufw[2];\r\nstruct i2c_msg msg[] = {\r\n{\r\n.addr = EEPROM_I2C_ADDR,\r\n.flags = 0,\r\n.buf = &bufw[0],\r\n.len = 2\r\n}\r\n};\r\nbufw[0] = addr;\r\nbufw[1] = data;\r\nret = i2c_transfer(i2c_adap, msg, 1);\r\nif (ret != 1) {\r\npr_err("eeprom i2c write error, status=%d\n", ret);\r\nreturn -1;\r\n}\r\nmdelay(10);\r\nreturn 0;\r\n}\r\nvoid netup_get_card_info(struct i2c_adapter *i2c_adap,\r\nstruct netup_card_info *cinfo)\r\n{\r\nint i, j;\r\ncinfo->rev = netup_eeprom_read(i2c_adap, 63);\r\nfor (i = 64, j = 0; i < 70; i++, j++)\r\ncinfo->port[0].mac[j] = netup_eeprom_read(i2c_adap, i);\r\nfor (i = 70, j = 0; i < 76; i++, j++)\r\ncinfo->port[1].mac[j] = netup_eeprom_read(i2c_adap, i);\r\n}
