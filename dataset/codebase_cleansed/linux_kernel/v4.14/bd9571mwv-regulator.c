static int bd9571mwv_avs_get_moni_state(struct regulator_dev *rdev)\r\n{\r\nunsigned int val;\r\nint ret;\r\nret = regmap_read(rdev->regmap, BD9571MWV_AVS_SET_MONI, &val);\r\nif (ret != 0)\r\nreturn ret;\r\nreturn val & BD9571MWV_AVS_SET_MONI_MASK;\r\n}\r\nstatic int bd9571mwv_avs_set_voltage_sel_regmap(struct regulator_dev *rdev,\r\nunsigned int sel)\r\n{\r\nint ret;\r\nret = bd9571mwv_avs_get_moni_state(rdev);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn regmap_write_bits(rdev->regmap, BD9571MWV_AVS_VD09_VID(ret),\r\nrdev->desc->vsel_mask, sel);\r\n}\r\nstatic int bd9571mwv_avs_get_voltage_sel_regmap(struct regulator_dev *rdev)\r\n{\r\nunsigned int val;\r\nint ret;\r\nret = bd9571mwv_avs_get_moni_state(rdev);\r\nif (ret < 0)\r\nreturn ret;\r\nret = regmap_read(rdev->regmap, BD9571MWV_AVS_VD09_VID(ret), &val);\r\nif (ret != 0)\r\nreturn ret;\r\nval &= rdev->desc->vsel_mask;\r\nval >>= ffs(rdev->desc->vsel_mask) - 1;\r\nreturn val;\r\n}\r\nstatic int bd9571mwv_reg_set_voltage_sel_regmap(struct regulator_dev *rdev,\r\nunsigned int sel)\r\n{\r\nreturn regmap_write_bits(rdev->regmap, BD9571MWV_DVFS_SETVID,\r\nrdev->desc->vsel_mask, sel);\r\n}\r\nstatic int bd9571mwv_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct bd9571mwv *bd = dev_get_drvdata(pdev->dev.parent);\r\nstruct regulator_config config = { };\r\nstruct regulator_dev *rdev;\r\nint i;\r\nplatform_set_drvdata(pdev, bd);\r\nconfig.dev = &pdev->dev;\r\nconfig.dev->of_node = bd->dev->of_node;\r\nconfig.driver_data = bd;\r\nconfig.regmap = bd->regmap;\r\nfor (i = 0; i < ARRAY_SIZE(regulators); i++) {\r\nrdev = devm_regulator_register(&pdev->dev, &regulators[i],\r\n&config);\r\nif (IS_ERR(rdev)) {\r\ndev_err(bd->dev, "failed to register %s regulator\n",\r\npdev->name);\r\nreturn PTR_ERR(rdev);\r\n}\r\n}\r\nreturn 0;\r\n}
