void ccu_gate_helper_disable(struct ccu_common *common, u32 gate)\r\n{\r\nunsigned long flags;\r\nu32 reg;\r\nif (!gate)\r\nreturn;\r\nspin_lock_irqsave(common->lock, flags);\r\nreg = readl(common->base + common->reg);\r\nwritel(reg & ~gate, common->base + common->reg);\r\nspin_unlock_irqrestore(common->lock, flags);\r\n}\r\nstatic void ccu_gate_disable(struct clk_hw *hw)\r\n{\r\nstruct ccu_gate *cg = hw_to_ccu_gate(hw);\r\nreturn ccu_gate_helper_disable(&cg->common, cg->enable);\r\n}\r\nint ccu_gate_helper_enable(struct ccu_common *common, u32 gate)\r\n{\r\nunsigned long flags;\r\nu32 reg;\r\nif (!gate)\r\nreturn 0;\r\nspin_lock_irqsave(common->lock, flags);\r\nreg = readl(common->base + common->reg);\r\nwritel(reg | gate, common->base + common->reg);\r\nspin_unlock_irqrestore(common->lock, flags);\r\nreturn 0;\r\n}\r\nstatic int ccu_gate_enable(struct clk_hw *hw)\r\n{\r\nstruct ccu_gate *cg = hw_to_ccu_gate(hw);\r\nreturn ccu_gate_helper_enable(&cg->common, cg->enable);\r\n}\r\nint ccu_gate_helper_is_enabled(struct ccu_common *common, u32 gate)\r\n{\r\nif (!gate)\r\nreturn 1;\r\nreturn readl(common->base + common->reg) & gate;\r\n}\r\nstatic int ccu_gate_is_enabled(struct clk_hw *hw)\r\n{\r\nstruct ccu_gate *cg = hw_to_ccu_gate(hw);\r\nreturn ccu_gate_helper_is_enabled(&cg->common, cg->enable);\r\n}\r\nstatic unsigned long ccu_gate_recalc_rate(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nstruct ccu_gate *cg = hw_to_ccu_gate(hw);\r\nunsigned long rate = parent_rate;\r\nif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\r\nrate /= cg->common.prediv;\r\nreturn rate;\r\n}\r\nstatic long ccu_gate_round_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long *prate)\r\n{\r\nstruct ccu_gate *cg = hw_to_ccu_gate(hw);\r\nint div = 1;\r\nif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\r\ndiv = cg->common.prediv;\r\nif (clk_hw_get_flags(hw) & CLK_SET_RATE_PARENT) {\r\nunsigned long best_parent = rate;\r\nif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\r\nbest_parent *= div;\r\n*prate = clk_hw_round_rate(clk_hw_get_parent(hw), best_parent);\r\n}\r\nreturn *prate / div;\r\n}\r\nstatic int ccu_gate_set_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate)\r\n{\r\nreturn 0;\r\n}
