static int drv_event(struct snd_soc_dapm_widget *w,\r\nstruct snd_kcontrol *control, int event)\r\n{\r\nstruct snd_soc_component *c = snd_soc_dapm_to_component(w->dapm);\r\nstruct dio2125 *priv = snd_soc_component_get_drvdata(c);\r\nint val;\r\nswitch (event) {\r\ncase SND_SOC_DAPM_POST_PMU:\r\nval = 1;\r\nbreak;\r\ncase SND_SOC_DAPM_PRE_PMD:\r\nval = 0;\r\nbreak;\r\ndefault:\r\nWARN(1, "Unexpected event");\r\nreturn -EINVAL;\r\n}\r\ngpiod_set_value_cansleep(priv->gpiod_enable, val);\r\nreturn 0;\r\n}\r\nstatic int dio2125_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct dio2125 *priv;\r\nint err;\r\npriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\r\nif (priv == NULL)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(pdev, priv);\r\npriv->gpiod_enable = devm_gpiod_get(dev, "enable", GPIOD_OUT_LOW);\r\nif (IS_ERR(priv->gpiod_enable)) {\r\nerr = PTR_ERR(priv->gpiod_enable);\r\nif (err != -EPROBE_DEFER)\r\ndev_err(dev, "Failed to get 'enable' gpio: %d", err);\r\nreturn err;\r\n}\r\nreturn devm_snd_soc_register_component(dev, &dio2125_component_driver,\r\nNULL, 0);\r\n}
