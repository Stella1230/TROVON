static int tps65912_gpio_get_direction(struct gpio_chip *gc,\r\nunsigned offset)\r\n{\r\nstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\r\nint ret, val;\r\nret = regmap_read(gpio->tps->regmap, TPS65912_GPIO1 + offset, &val);\r\nif (ret)\r\nreturn ret;\r\nif (val & GPIO_CFG_MASK)\r\nreturn GPIOF_DIR_OUT;\r\nelse\r\nreturn GPIOF_DIR_IN;\r\n}\r\nstatic int tps65912_gpio_direction_input(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\r\nreturn regmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\r\nGPIO_CFG_MASK, 0);\r\n}\r\nstatic int tps65912_gpio_direction_output(struct gpio_chip *gc,\r\nunsigned offset, int value)\r\n{\r\nstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\r\nregmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\r\nGPIO_SET_MASK, value ? GPIO_SET_MASK : 0);\r\nreturn regmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\r\nGPIO_CFG_MASK, GPIO_CFG_MASK);\r\n}\r\nstatic int tps65912_gpio_get(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\r\nint ret, val;\r\nret = regmap_read(gpio->tps->regmap, TPS65912_GPIO1 + offset, &val);\r\nif (ret)\r\nreturn ret;\r\nif (val & GPIO_STS_MASK)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic void tps65912_gpio_set(struct gpio_chip *gc, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\r\nregmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\r\nGPIO_SET_MASK, value ? GPIO_SET_MASK : 0);\r\n}\r\nstatic int tps65912_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65912 *tps = dev_get_drvdata(pdev->dev.parent);\r\nstruct tps65912_gpio *gpio;\r\nint ret;\r\ngpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\ngpio->tps = dev_get_drvdata(pdev->dev.parent);\r\ngpio->gpio_chip = template_chip;\r\ngpio->gpio_chip.parent = tps->dev;\r\nret = devm_gpiochip_add_data(&pdev->dev, &gpio->gpio_chip,\r\ngpio);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Could not register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nplatform_set_drvdata(pdev, gpio);\r\nreturn 0;\r\n}
