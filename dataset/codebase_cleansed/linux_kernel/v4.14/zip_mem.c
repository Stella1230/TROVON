int zip_cmd_qbuf_alloc(struct zip_device *zip, int q)\r\n{\r\nzip->iq[q].sw_head = (u64 *)__get_free_pages((GFP_KERNEL | GFP_DMA),\r\nget_order(ZIP_CMD_QBUF_SIZE));\r\nif (!zip->iq[q].sw_head)\r\nreturn -ENOMEM;\r\nmemset(zip->iq[q].sw_head, 0, ZIP_CMD_QBUF_SIZE);\r\nzip_dbg("cmd_qbuf_alloc[%d] Success : %p\n", q, zip->iq[q].sw_head);\r\nreturn 0;\r\n}\r\nvoid zip_cmd_qbuf_free(struct zip_device *zip, int q)\r\n{\r\nzip_dbg("Freeing cmd_qbuf 0x%lx\n", zip->iq[q].sw_tail);\r\nfree_pages((u64)zip->iq[q].sw_tail, get_order(ZIP_CMD_QBUF_SIZE));\r\n}\r\nu8 *zip_data_buf_alloc(u64 size)\r\n{\r\nu8 *ptr;\r\nptr = (u8 *)__get_free_pages((GFP_KERNEL | GFP_DMA),\r\nget_order(size));\r\nif (!ptr)\r\nreturn NULL;\r\nmemset(ptr, 0, size);\r\nzip_dbg("Data buffer allocation success\n");\r\nreturn ptr;\r\n}\r\nvoid zip_data_buf_free(u8 *ptr, u64 size)\r\n{\r\nzip_dbg("Freeing data buffer 0x%lx\n", ptr);\r\nfree_pages((u64)ptr, get_order(size));\r\n}
