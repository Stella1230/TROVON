void calc_runnable_avg_yN_inv(void)\r\n{\r\nint i;\r\nunsigned int x;\r\nprintf("static const u32 runnable_avg_yN_inv[] = {");\r\nfor (i = 0; i < HALFLIFE; i++) {\r\nx = ((1UL<<32)-1)*pow(y, i);\r\nif (i % 6 == 0) printf("\n\t");\r\nprintf("0x%8x, ", x);\r\n}\r\nprintf("\n};\n\n");\r\n}\r\nvoid calc_runnable_avg_yN_sum(void)\r\n{\r\nint i;\r\nprintf("static const u32 runnable_avg_yN_sum[] = {\n\t 0,");\r\nfor (i = 1; i <= HALFLIFE; i++) {\r\nif (i == 1)\r\nsum *= y;\r\nelse\r\nsum = sum*y + 1024*y;\r\nif (i % 11 == 0)\r\nprintf("\n\t");\r\nprintf("%5d,", sum);\r\n}\r\nprintf("\n};\n\n");\r\n}\r\nvoid calc_converged_max(void)\r\n{\r\nlong last = 0, y_inv = ((1UL<<32)-1)*y;\r\nfor (; ; n++) {\r\nif (n > -1)\r\nmax = ((max*y_inv)>>SHIFT) + 1024;\r\nif (last == max)\r\nbreak;\r\nlast = max;\r\n}\r\nn--;\r\nprintf("#define LOAD_AVG_PERIOD %d\n", HALFLIFE);\r\nprintf("#define LOAD_AVG_MAX %ld\n", max);\r\n}\r\nvoid calc_accumulated_sum_32(void)\r\n{\r\nint i, x = sum;\r\nprintf("static const u32 __accumulated_sum_N32[] = {\n\t 0,");\r\nfor (i = 1; i <= n/HALFLIFE+1; i++) {\r\nif (i > 1)\r\nx = x/2 + sum;\r\nif (i % 6 == 0)\r\nprintf("\n\t");\r\nprintf("%6d,", x);\r\n}\r\nprintf("\n};\n\n");\r\n}\r\nvoid main(void)\r\n{\r\nprintf("/* Generated by Documentation/scheduler/sched-pelt; do not modify. */\n\n");\r\ny = pow(0.5, 1/(double)HALFLIFE);\r\ncalc_runnable_avg_yN_inv();\r\ncalc_converged_max();\r\n}
