static void amiga_irq_enable(struct irq_data *data)\r\n{\r\namiga_custom.intena = IF_SETCLR | (1 << (data->irq - IRQ_USER));\r\n}\r\nstatic void amiga_irq_disable(struct irq_data *data)\r\n{\r\namiga_custom.intena = 1 << (data->irq - IRQ_USER);\r\n}\r\nstatic void ami_int1(struct irq_desc *desc)\r\n{\r\nunsigned short ints = amiga_custom.intreqr & amiga_custom.intenar;\r\nif (ints & IF_TBE) {\r\namiga_custom.intreq = IF_TBE;\r\ngeneric_handle_irq(IRQ_AMIGA_TBE);\r\n}\r\nif (ints & IF_DSKBLK) {\r\namiga_custom.intreq = IF_DSKBLK;\r\ngeneric_handle_irq(IRQ_AMIGA_DSKBLK);\r\n}\r\nif (ints & IF_SOFT) {\r\namiga_custom.intreq = IF_SOFT;\r\ngeneric_handle_irq(IRQ_AMIGA_SOFT);\r\n}\r\n}\r\nstatic void ami_int3(struct irq_desc *desc)\r\n{\r\nunsigned short ints = amiga_custom.intreqr & amiga_custom.intenar;\r\nif (ints & IF_BLIT) {\r\namiga_custom.intreq = IF_BLIT;\r\ngeneric_handle_irq(IRQ_AMIGA_BLIT);\r\n}\r\nif (ints & IF_COPER) {\r\namiga_custom.intreq = IF_COPER;\r\ngeneric_handle_irq(IRQ_AMIGA_COPPER);\r\n}\r\nif (ints & IF_VERTB) {\r\namiga_custom.intreq = IF_VERTB;\r\ngeneric_handle_irq(IRQ_AMIGA_VERTB);\r\n}\r\n}\r\nstatic void ami_int4(struct irq_desc *desc)\r\n{\r\nunsigned short ints = amiga_custom.intreqr & amiga_custom.intenar;\r\nif (ints & IF_AUD0) {\r\namiga_custom.intreq = IF_AUD0;\r\ngeneric_handle_irq(IRQ_AMIGA_AUD0);\r\n}\r\nif (ints & IF_AUD1) {\r\namiga_custom.intreq = IF_AUD1;\r\ngeneric_handle_irq(IRQ_AMIGA_AUD1);\r\n}\r\nif (ints & IF_AUD2) {\r\namiga_custom.intreq = IF_AUD2;\r\ngeneric_handle_irq(IRQ_AMIGA_AUD2);\r\n}\r\nif (ints & IF_AUD3) {\r\namiga_custom.intreq = IF_AUD3;\r\ngeneric_handle_irq(IRQ_AMIGA_AUD3);\r\n}\r\n}\r\nstatic void ami_int5(struct irq_desc *desc)\r\n{\r\nunsigned short ints = amiga_custom.intreqr & amiga_custom.intenar;\r\nif (ints & IF_RBF) {\r\ngeneric_handle_irq(IRQ_AMIGA_RBF);\r\n}\r\nif (ints & IF_DSKSYN) {\r\namiga_custom.intreq = IF_DSKSYN;\r\ngeneric_handle_irq(IRQ_AMIGA_DSKSYN);\r\n}\r\n}\r\nvoid __init amiga_init_IRQ(void)\r\n{\r\nm68k_setup_irq_controller(&amiga_irq_chip, handle_simple_irq, IRQ_USER,\r\nAMI_STD_IRQS);\r\nirq_set_chained_handler(IRQ_AUTO_1, ami_int1);\r\nirq_set_chained_handler(IRQ_AUTO_3, ami_int3);\r\nirq_set_chained_handler(IRQ_AUTO_4, ami_int4);\r\nirq_set_chained_handler(IRQ_AUTO_5, ami_int5);\r\nif (AMIGAHW_PRESENT(PCMCIA))\r\ngayle.inten = GAYLE_IRQ_IDE;\r\namiga_custom.intena = 0x7fff;\r\namiga_custom.intreq = 0x7fff;\r\namiga_custom.intena = IF_SETCLR | IF_INTEN;\r\ncia_init_IRQ(&ciaa_base);\r\ncia_init_IRQ(&ciab_base);\r\n}
