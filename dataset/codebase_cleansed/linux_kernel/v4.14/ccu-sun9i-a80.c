static void sun9i_a80_cpu_pll_fixup(void __iomem *reg)\r\n{\r\nu32 val = readl(reg);\r\nif (!(val & BIT(SUN9I_A80_PLL_P_SHIFT)))\r\nreturn;\r\nval &= ~GENMASK(SUN9I_A80_PLL_N_SHIFT + SUN9I_A80_PLL_N_WIDTH - 1,\r\nSUN9I_A80_PLL_N_SHIFT);\r\nval |= 17 << SUN9I_A80_PLL_N_SHIFT;\r\nval &= ~BIT(SUN9I_A80_PLL_P_SHIFT);\r\nwritel(val, reg);\r\n}\r\nstatic int sun9i_a80_ccu_probe(struct platform_device *pdev)\r\n{\r\nstruct resource *res;\r\nvoid __iomem *reg;\r\nu32 val;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nreg = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(reg))\r\nreturn PTR_ERR(reg);\r\nval = readl(reg + SUN9I_A80_PLL_AUDIO_REG);\r\nval &= (BIT(16) & BIT(18));\r\nwritel(val, reg + SUN9I_A80_PLL_AUDIO_REG);\r\nsun9i_a80_cpu_pll_fixup(reg + SUN9I_A80_PLL_C0CPUX_REG);\r\nsun9i_a80_cpu_pll_fixup(reg + SUN9I_A80_PLL_C1CPUX_REG);\r\nreturn sunxi_ccu_probe(pdev->dev.of_node, reg, &sun9i_a80_ccu_desc);\r\n}
