static inline unsigned\r\nsh_css_elems_bytes_from_info (unsigned raw_bit_depth)\r\n{\r\nreturn CEIL_DIV(raw_bit_depth,8);\r\n}\r\nstatic enum sh_stream_format\r\ncss2isp_stream_format(enum ia_css_stream_format from)\r\n{\r\nswitch (from) {\r\ncase IA_CSS_STREAM_FORMAT_YUV420_8_LEGACY:\r\nreturn sh_stream_format_yuv420_legacy;\r\ncase IA_CSS_STREAM_FORMAT_YUV420_8:\r\ncase IA_CSS_STREAM_FORMAT_YUV420_10:\r\ncase IA_CSS_STREAM_FORMAT_YUV420_16:\r\nreturn sh_stream_format_yuv420;\r\ncase IA_CSS_STREAM_FORMAT_YUV422_8:\r\ncase IA_CSS_STREAM_FORMAT_YUV422_10:\r\ncase IA_CSS_STREAM_FORMAT_YUV422_16:\r\nreturn sh_stream_format_yuv422;\r\ncase IA_CSS_STREAM_FORMAT_RGB_444:\r\ncase IA_CSS_STREAM_FORMAT_RGB_555:\r\ncase IA_CSS_STREAM_FORMAT_RGB_565:\r\ncase IA_CSS_STREAM_FORMAT_RGB_666:\r\ncase IA_CSS_STREAM_FORMAT_RGB_888:\r\nreturn sh_stream_format_rgb;\r\ncase IA_CSS_STREAM_FORMAT_RAW_6:\r\ncase IA_CSS_STREAM_FORMAT_RAW_7:\r\ncase IA_CSS_STREAM_FORMAT_RAW_8:\r\ncase IA_CSS_STREAM_FORMAT_RAW_10:\r\ncase IA_CSS_STREAM_FORMAT_RAW_12:\r\ncase IA_CSS_STREAM_FORMAT_RAW_14:\r\ncase IA_CSS_STREAM_FORMAT_RAW_16:\r\nreturn sh_stream_format_raw;\r\ncase IA_CSS_STREAM_FORMAT_BINARY_8:\r\ndefault:\r\nreturn sh_stream_format_raw;\r\n}\r\n}\r\nvoid\r\nia_css_raw_config(\r\nstruct sh_css_isp_raw_isp_config *to,\r\nconst struct ia_css_raw_configuration *from,\r\nunsigned size)\r\n{\r\nunsigned elems_a = ISP_VEC_NELEMS;\r\nconst struct ia_css_frame_info *in_info = from->in_info;\r\nconst struct ia_css_frame_info *internal_info = from->internal_info;\r\n(void)size;\r\n#if !defined(USE_INPUT_SYSTEM_VERSION_2401)\r\nin_info = internal_info;\r\n#else\r\nif (in_info)\r\n(void)internal_info;\r\nelse\r\nin_info = internal_info;\r\n#endif\r\nia_css_dma_configure_from_info(&to->port_b, in_info);\r\nassert((in_info->format == IA_CSS_FRAME_FORMAT_RAW_PACKED) ||\r\n(elems_a % to->port_b.elems == 0));\r\nto->width_a_over_b = elems_a / to->port_b.elems;\r\nto->inout_port_config = from->pipe->inout_port_config;\r\nto->format = in_info->format;\r\nto->required_bds_factor = from->pipe->required_bds_factor;\r\nto->two_ppc = from->two_ppc;\r\nto->stream_format = css2isp_stream_format(from->stream_format);\r\nto->deinterleaved = from->deinterleaved;\r\n#if (defined(USE_INPUT_SYSTEM_VERSION_2401) || defined(CONFIG_CSI2_PLUS))\r\nto->start_column = in_info->crop_info.start_column;\r\nto->start_line = in_info->crop_info.start_line;\r\nto->enable_left_padding = from->enable_left_padding;\r\n#endif\r\n}\r\nvoid\r\nia_css_raw_configure(\r\nconst struct sh_css_sp_pipeline *pipe,\r\nconst struct ia_css_binary *binary,\r\nconst struct ia_css_frame_info *in_info,\r\nconst struct ia_css_frame_info *internal_info,\r\nbool two_ppc,\r\nbool deinterleaved)\r\n{\r\nuint8_t enable_left_padding = (uint8_t)((binary->left_padding) ? 1 : 0);\r\nstruct ia_css_raw_configuration config = default_config;\r\nconfig.pipe = pipe;\r\nconfig.in_info = in_info;\r\nconfig.internal_info = internal_info;\r\nconfig.two_ppc = two_ppc;\r\nconfig.stream_format = binary->input_format;\r\nconfig.deinterleaved = deinterleaved;\r\nconfig.enable_left_padding = enable_left_padding;\r\nia_css_configure_raw(binary, &config);\r\n}
