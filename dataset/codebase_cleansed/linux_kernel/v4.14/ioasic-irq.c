static void unmask_ioasic_irq(struct irq_data *d)\r\n{\r\nu32 simr;\r\nsimr = ioasic_read(IO_REG_SIMR);\r\nsimr |= (1 << (d->irq - ioasic_irq_base));\r\nioasic_write(IO_REG_SIMR, simr);\r\n}\r\nstatic void mask_ioasic_irq(struct irq_data *d)\r\n{\r\nu32 simr;\r\nsimr = ioasic_read(IO_REG_SIMR);\r\nsimr &= ~(1 << (d->irq - ioasic_irq_base));\r\nioasic_write(IO_REG_SIMR, simr);\r\n}\r\nstatic void ack_ioasic_irq(struct irq_data *d)\r\n{\r\nmask_ioasic_irq(d);\r\nfast_iob();\r\n}\r\nstatic void clear_ioasic_dma_irq(struct irq_data *d)\r\n{\r\nu32 sir;\r\nsir = ~(1 << (d->irq - ioasic_irq_base));\r\nioasic_write(IO_REG_SIR, sir);\r\nfast_iob();\r\n}\r\nvoid __init init_ioasic_irqs(int base)\r\n{\r\nint i;\r\nioasic_write(IO_REG_SIMR, 0);\r\nfast_iob();\r\nfor (i = base; i < base + IO_INR_DMA; i++)\r\nirq_set_chip_and_handler(i, &ioasic_irq_type,\r\nhandle_level_irq);\r\nfor (; i < base + IO_IRQ_LINES; i++)\r\nirq_set_chip_and_handler(i, &ioasic_dma_irq_type,\r\n1 << (i - base) & IO_IRQ_DMA_INFO ?\r\nhandle_edge_irq : handle_fasteoi_irq);\r\nioasic_irq_base = base;\r\n}
