void input_system_get_state(\r\nconst input_system_ID_t ID,\r\ninput_system_state_t *state)\r\n{\r\nsub_system_ID_t sub_id;\r\nassert(ID < N_INPUT_SYSTEM_ID);\r\nassert(state != NULL);\r\nstate->str_multicastA_sel = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_A_IDX);\r\nstate->str_multicastB_sel = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_B_IDX);\r\nstate->str_multicastC_sel = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_C_IDX);\r\nstate->str_mux_sel = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MUX_IDX);\r\nstate->str_mon_status = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_STRMON_STAT_IDX);\r\nstate->str_mon_irq_cond = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_STRMON_COND_IDX);\r\nstate->str_mon_irq_en = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_STRMON_IRQ_EN_IDX);\r\nstate->isys_srst = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_SRST_IDX);\r\nstate->isys_slv_reg_srst = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_SLV_REG_SRST_IDX);\r\nstate->str_deint_portA_cnt = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_REG_PORT_A_IDX);\r\nstate->str_deint_portB_cnt = input_system_sub_system_reg_load(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_REG_PORT_B_IDX);\r\nfor (sub_id = CAPTURE_UNIT0_ID; sub_id < CAPTURE_UNIT0_ID + N_CAPTURE_UNIT_ID; sub_id++) {\r\ncapture_unit_get_state(ID, sub_id,\r\n&(state->capture_unit[sub_id - CAPTURE_UNIT0_ID]));\r\n}\r\nfor (sub_id = ACQUISITION_UNIT0_ID; sub_id < ACQUISITION_UNIT0_ID + N_ACQUISITION_UNIT_ID; sub_id++) {\r\nacquisition_unit_get_state(ID, sub_id,\r\n&(state->acquisition_unit[sub_id - ACQUISITION_UNIT0_ID]));\r\n}\r\nfor (sub_id = CTRL_UNIT0_ID; sub_id < CTRL_UNIT0_ID + N_CTRL_UNIT_ID; sub_id++) {\r\nctrl_unit_get_state(ID, sub_id,\r\n&(state->ctrl_unit_state[sub_id - CTRL_UNIT0_ID]));\r\n}\r\nreturn;\r\n}\r\nvoid receiver_get_state(\r\nconst rx_ID_t ID,\r\nreceiver_state_t *state)\r\n{\r\nmipi_port_ID_t port_id;\r\nunsigned int ch_id;\r\nassert(ID < N_RX_ID);\r\nassert(state != NULL);\r\nstate->fs_to_ls_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_FS_TO_LS_DELAY_REG_IDX);\r\nstate->ls_to_data_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_LS_TO_DATA_DELAY_REG_IDX);\r\nstate->data_to_le_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_DATA_TO_LE_DELAY_REG_IDX);\r\nstate->le_to_fe_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_LE_TO_FE_DELAY_REG_IDX);\r\nstate->fe_to_fs_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_FE_TO_FS_DELAY_REG_IDX);\r\nstate->le_to_fs_delay = (uint8_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_LE_TO_LS_DELAY_REG_IDX);\r\nstate->is_two_ppc = (bool)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_TWO_PIXEL_EN_REG_IDX);\r\nstate->backend_rst = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BACKEND_RST_REG_IDX);\r\nstate->raw18 = (uint16_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_RAW18_REG_IDX);\r\nstate->force_raw8 = (bool)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_FORCE_RAW8_REG_IDX);\r\nstate->raw16 = (uint16_t)receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_RAW16_REG_IDX);\r\nfor (port_id = (mipi_port_ID_t)0; port_id < N_MIPI_PORT_ID; port_id++) {\r\nmipi_port_get_state(ID, port_id,\r\n&(state->mipi_port_state[port_id]));\r\n}\r\nfor (ch_id = (unsigned int)0; ch_id < N_RX_CHANNEL_ID; ch_id++) {\r\nrx_channel_get_state(ID, ch_id,\r\n&(state->rx_channel_state[ch_id]));\r\n}\r\nstate->be_gsp_acc_ovl = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_GSP_ACC_OVL_REG_IDX);\r\nstate->be_srst = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_SRST_REG_IDX);\r\nstate->be_is_two_ppc = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_TWO_PPC_REG_IDX);\r\nstate->be_comp_format0 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_COMP_FORMAT_REG0_IDX);\r\nstate->be_comp_format1 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_COMP_FORMAT_REG1_IDX);\r\nstate->be_comp_format2 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_COMP_FORMAT_REG2_IDX);\r\nstate->be_comp_format3 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_COMP_FORMAT_REG3_IDX);\r\nstate->be_sel = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_SEL_REG_IDX);\r\nstate->be_raw16_config = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_RAW16_CONFIG_REG_IDX);\r\nstate->be_raw18_config = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_RAW18_CONFIG_REG_IDX);\r\nstate->be_force_raw8 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_FORCE_RAW8_REG_IDX);\r\nstate->be_irq_status = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_IRQ_STATUS_REG_IDX);\r\nstate->be_irq_clear = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_BE_IRQ_CLEAR_REG_IDX);\r\nreturn;\r\n}\r\nbool is_mipi_format_yuv420(\r\nconst mipi_format_t mipi_format)\r\n{\r\nbool is_yuv420 = (\r\n(mipi_format == MIPI_FORMAT_YUV420_8) ||\r\n(mipi_format == MIPI_FORMAT_YUV420_10) ||\r\n(mipi_format == MIPI_FORMAT_YUV420_8_SHIFT) ||\r\n(mipi_format == MIPI_FORMAT_YUV420_10_SHIFT));\r\nreturn is_yuv420;\r\n}\r\nvoid receiver_set_compression(\r\nconst rx_ID_t ID,\r\nconst unsigned int cfg_ID,\r\nconst mipi_compressor_t comp,\r\nconst mipi_predictor_t pred)\r\n{\r\nconst unsigned int field_id = cfg_ID % N_MIPI_FORMAT_CUSTOM;\r\nconst unsigned int ch_id = cfg_ID / N_MIPI_FORMAT_CUSTOM;\r\nhrt_data val;\r\nhrt_address addr = 0;\r\nhrt_data reg;\r\nassert(ID < N_RX_ID);\r\nassert(cfg_ID < N_MIPI_COMPRESSOR_CONTEXT);\r\nassert(field_id < N_MIPI_FORMAT_CUSTOM);\r\nassert(ch_id < N_RX_CHANNEL_ID);\r\nassert(comp < N_MIPI_COMPRESSOR_METHODS);\r\nassert(pred < N_MIPI_PREDICTOR_TYPES);\r\nval = (((uint8_t)pred) << 3) | comp;\r\nswitch (ch_id) {\r\ncase 0: addr = ((field_id<6)?_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC0_REG0_IDX:_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC0_REG1_IDX);\r\nbreak;\r\ncase 1: addr = ((field_id<6)?_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC1_REG0_IDX:_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC1_REG1_IDX);\r\nbreak;\r\ncase 2: addr = ((field_id<6)?_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC2_REG0_IDX:_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC2_REG1_IDX);\r\nbreak;\r\ncase 3: addr = ((field_id<6)?_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC3_REG0_IDX:_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC3_REG1_IDX);\r\nbreak;\r\ndefault:\r\nassert(false);\r\nreturn;\r\n}\r\nreg = ((field_id < 6)?(val << (field_id * 5)):(val << ((field_id - 6) * 5)));\r\nreceiver_reg_store(ID, addr, reg);\r\nreturn;\r\n}\r\nvoid receiver_port_enable(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID,\r\nconst bool cnd)\r\n{\r\nhrt_data reg = receiver_port_reg_load(ID, port_ID,\r\n_HRT_CSS_RECEIVER_DEVICE_READY_REG_IDX);\r\nif (cnd) {\r\nreg |= 0x01;\r\n} else {\r\nreg &= ~0x01;\r\n}\r\nreceiver_port_reg_store(ID, port_ID,\r\n_HRT_CSS_RECEIVER_DEVICE_READY_REG_IDX, reg);\r\nreturn;\r\n}\r\nbool is_receiver_port_enabled(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID)\r\n{\r\nhrt_data reg = receiver_port_reg_load(ID, port_ID,\r\n_HRT_CSS_RECEIVER_DEVICE_READY_REG_IDX);\r\nreturn ((reg & 0x01) != 0);\r\n}\r\nvoid receiver_irq_enable(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID,\r\nconst rx_irq_info_t irq_info)\r\n{\r\nreceiver_port_reg_store(ID,\r\nport_ID, _HRT_CSS_RECEIVER_IRQ_ENABLE_REG_IDX, irq_info);\r\nreturn;\r\n}\r\nrx_irq_info_t receiver_get_irq_info(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID)\r\n{\r\nreturn receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_IRQ_STATUS_REG_IDX);\r\n}\r\nvoid receiver_irq_clear(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID,\r\nconst rx_irq_info_t irq_info)\r\n{\r\nreceiver_port_reg_store(ID,\r\nport_ID, _HRT_CSS_RECEIVER_IRQ_STATUS_REG_IDX, irq_info);\r\nreturn;\r\n}\r\nSTORAGE_CLASS_INLINE void capture_unit_get_state(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\ncapture_unit_state_t *state)\r\n{\r\nassert( (sub_id <= CAPTURE_UNIT2_ID));\r\nassert(state != NULL);\r\nstate->StartMode = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_START_MODE_REG_ID);\r\nstate->Start_Addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_START_ADDR_REG_ID);\r\nstate->Mem_Region_Size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_MEM_REGION_SIZE_REG_ID);\r\nstate->Num_Mem_Regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_NUM_MEM_REGIONS_REG_ID);\r\nstate->Packet_Length = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_PACKET_LENGTH_REG_ID);\r\nstate->Received_Length = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_RECEIVED_LENGTH_REG_ID);\r\nstate->Received_Short_Packets = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_RECEIVED_SHORT_PACKETS_REG_ID);\r\nstate->Received_Long_Packets = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_RECEIVED_LONG_PACKETS_REG_ID);\r\nstate->Last_Command = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_LAST_COMMAND_REG_ID);\r\nstate->Next_Command = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_NEXT_COMMAND_REG_ID);\r\nstate->Last_Acknowledge = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_LAST_ACKNOWLEDGE_REG_ID);\r\nstate->Next_Acknowledge = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_NEXT_ACKNOWLEDGE_REG_ID);\r\nstate->FSM_State_Info = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nCAPT_FSM_STATE_INFO_REG_ID);\r\nreturn;\r\n}\r\nSTORAGE_CLASS_INLINE void acquisition_unit_get_state(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\nacquisition_unit_state_t *state)\r\n{\r\nassert(sub_id == ACQUISITION_UNIT0_ID);\r\nassert(state != NULL);\r\nstate->Start_Addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_START_ADDR_REG_ID);\r\nstate->Mem_Region_Size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_MEM_REGION_SIZE_REG_ID);\r\nstate->Num_Mem_Regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_NUM_MEM_REGIONS_REG_ID);\r\nstate->Received_Short_Packets = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_RECEIVED_SHORT_PACKETS_REG_ID);\r\nstate->Received_Long_Packets = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_RECEIVED_LONG_PACKETS_REG_ID);\r\nstate->Last_Command = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_LAST_COMMAND_REG_ID);\r\nstate->Next_Command = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_NEXT_COMMAND_REG_ID);\r\nstate->Last_Acknowledge = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_LAST_ACKNOWLEDGE_REG_ID);\r\nstate->Next_Acknowledge = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_NEXT_ACKNOWLEDGE_REG_ID);\r\nstate->FSM_State_Info = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_FSM_STATE_INFO_REG_ID);\r\nstate->Int_Cntr_Info = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nACQ_INT_CNTR_INFO_REG_ID);\r\nreturn;\r\n}\r\nSTORAGE_CLASS_INLINE void ctrl_unit_get_state(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\nctrl_unit_state_t *state)\r\n{\r\nassert(sub_id == CTRL_UNIT0_ID);\r\nassert(state != NULL);\r\nstate->captA_start_addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_A_REG_ID);\r\nstate->captB_start_addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_B_REG_ID);\r\nstate->captC_start_addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_C_REG_ID);\r\nstate->captA_mem_region_size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_A_REG_ID);\r\nstate->captB_mem_region_size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_B_REG_ID);\r\nstate->captC_mem_region_size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_C_REG_ID);\r\nstate->captA_num_mem_regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_A_REG_ID);\r\nstate->captB_num_mem_regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_B_REG_ID);\r\nstate->captC_num_mem_regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_C_REG_ID);\r\nstate->acq_start_addr = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_START_ADDR_REG_ID);\r\nstate->acq_mem_region_size = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_MEM_REGION_SIZE_REG_ID);\r\nstate->acq_num_mem_regions = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_NUM_MEM_REGIONS_REG_ID);\r\nstate->last_cmd = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_LAST_COMMAND_REG_ID);\r\nstate->next_cmd = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_NEXT_COMMAND_REG_ID);\r\nstate->last_ack = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_LAST_ACKNOWLEDGE_REG_ID);\r\nstate->next_ack = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_NEXT_ACKNOWLEDGE_REG_ID);\r\nstate->top_fsm_state = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_FSM_STATE_INFO_REG_ID);\r\nstate->captA_fsm_state = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_A_FSM_STATE_INFO_REG_ID);\r\nstate->captB_fsm_state = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_B_FSM_STATE_INFO_REG_ID);\r\nstate->captC_fsm_state = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_C_FSM_STATE_INFO_REG_ID);\r\nstate->acq_fsm_state = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_FSM_STATE_INFO_REG_ID);\r\nstate->capt_reserve_one_mem_region = input_system_sub_system_reg_load(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_RESERVE_ONE_MEM_REGION_REG_ID);\r\nreturn;\r\n}\r\nSTORAGE_CLASS_INLINE void mipi_port_get_state(\r\nconst rx_ID_t ID,\r\nconst mipi_port_ID_t port_ID,\r\nmipi_port_state_t *state)\r\n{\r\nint i;\r\nassert(ID < N_RX_ID);\r\nassert(port_ID < N_MIPI_PORT_ID);\r\nassert(state != NULL);\r\nstate->device_ready = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_DEVICE_READY_REG_IDX);\r\nstate->irq_status = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_IRQ_STATUS_REG_IDX);\r\nstate->irq_enable = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_IRQ_ENABLE_REG_IDX);\r\nstate->timeout_count = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_TIMEOUT_COUNT_REG_IDX);\r\nstate->init_count = (uint16_t)receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_INIT_COUNT_REG_IDX);\r\nstate->raw16_18 = (uint16_t)receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_RAW16_18_DATAID_REG_IDX);\r\nstate->sync_count = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_SYNC_COUNT_REG_IDX);\r\nstate->rx_count = receiver_port_reg_load(ID,\r\nport_ID, _HRT_CSS_RECEIVER_RX_COUNT_REG_IDX);\r\nfor (i = 0; i < MIPI_4LANE_CFG ; i++) {\r\nstate->lane_sync_count[i] = (uint8_t)((state->sync_count)>>(i*8));\r\nstate->lane_rx_count[i] = (uint8_t)((state->rx_count)>>(i*8));\r\n}\r\nreturn;\r\n}\r\nSTORAGE_CLASS_INLINE void rx_channel_get_state(\r\nconst rx_ID_t ID,\r\nconst unsigned int ch_id,\r\nrx_channel_state_t *state)\r\n{\r\nint i;\r\nassert(ID < N_RX_ID);\r\nassert(ch_id < N_RX_CHANNEL_ID);\r\nassert(state != NULL);\r\nswitch (ch_id) {\r\ncase 0:\r\nstate->comp_scheme0 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC0_REG0_IDX);\r\nstate->comp_scheme1 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC0_REG1_IDX);\r\nbreak;\r\ncase 1:\r\nstate->comp_scheme0 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC1_REG0_IDX);\r\nstate->comp_scheme1 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC1_REG1_IDX);\r\nbreak;\r\ncase 2:\r\nstate->comp_scheme0 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC2_REG0_IDX);\r\nstate->comp_scheme1 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC2_REG1_IDX);\r\nbreak;\r\ncase 3:\r\nstate->comp_scheme0 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC3_REG0_IDX);\r\nstate->comp_scheme1 = receiver_reg_load(ID,\r\n_HRT_CSS_RECEIVER_2400_COMP_SCHEME_VC3_REG1_IDX);\r\nbreak;\r\n}\r\nfor (i = 0; i < 6; i++) {\r\nuint8_t val = (uint8_t)((state->comp_scheme0)>>(i*5)) & 0x1f;\r\nstate->comp[i] = (mipi_compressor_t)(val & 0x07);\r\nstate->pred[i] = (mipi_predictor_t)((val & 0x18) >> 3);\r\n}\r\nfor (i = 6; i < N_MIPI_FORMAT_CUSTOM; i++) {\r\nuint8_t val = (uint8_t)((state->comp_scheme0)>>((i-6)*5)) & 0x1f;\r\nstate->comp[i] = (mipi_compressor_t)(val & 0x07);\r\nstate->pred[i] = (mipi_predictor_t)((val & 0x18) >> 3);\r\n}\r\nreturn;\r\n}\r\nstatic void receiver_rst(\r\nconst rx_ID_t ID)\r\n{\r\nmipi_port_ID_t port_id;\r\nassert(ID < N_RX_ID);\r\nfor (port_id = MIPI_PORT0_ID; port_id < N_MIPI_PORT_ID; port_id++) {\r\nreceiver_port_enable(ID, port_id, false);\r\n}\r\nreturn;\r\n}\r\nstatic void gp_device_rst(const gp_device_ID_t ID)\r\n{\r\nassert(ID < N_GP_DEVICE_ID);\r\ngp_device_reg_store(ID, _REG_GP_SYNCGEN_ENABLE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_LFSR_ENABLE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_LFSR_ENABLE_B_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_LFSR_RESET_VALUE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_ENABLE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_ENABLE_B_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_HOR_CNT_MASK_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_VER_CNT_MASK_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_XY_CNT_MASK_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_HOR_CNT_DELTA_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_VER_CNT_DELTA_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_MODE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_RED1_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_GREEN1_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_BLUE1_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_RED2_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_GREEN2_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_TPG_BLUE2_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_DATA_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SBAND_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SYNC_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_SOFT_RESET_ADDR, ZERO);\r\nreturn;\r\n}\r\nstatic void input_selector_cfg_for_sensor(const gp_device_ID_t ID)\r\n{\r\nassert(ID < N_GP_DEVICE_ID);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SOF_ADDR, ONE);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_EOF_ADDR, ONE);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SOL_ADDR, ONE);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_EOL_ADDR, ONE);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_CH_ID_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_FMT_TYPE_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_DATA_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SBAND_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_ISEL_SYNC_SEL_ADDR, ZERO);\r\ngp_device_reg_store(ID, _REG_GP_SOFT_RESET_ADDR, ZERO);\r\nreturn;\r\n}\r\nstatic void input_switch_rst(const gp_device_ID_t ID)\r\n{\r\nint addr;\r\nassert(ID < N_GP_DEVICE_ID);\r\nfor (addr = _REG_GP_IFMT_input_switch_lut_reg0;\r\naddr <= _REG_GP_IFMT_input_switch_lut_reg7; addr += SIZEOF_HRT_REG) {\r\ngp_device_reg_store(ID, addr, ZERO);\r\n}\r\ngp_device_reg_store(ID,\r\n_REG_GP_IFMT_input_switch_fsync_lut,\r\nZERO);\r\nreturn;\r\n}\r\nstatic void input_switch_cfg(\r\nconst gp_device_ID_t ID,\r\nconst input_switch_cfg_t * const cfg)\r\n{\r\nint addr_offset;\r\nassert(ID < N_GP_DEVICE_ID);\r\nassert(cfg != NULL);\r\nfor (addr_offset = 0; addr_offset < N_RX_CHANNEL_ID * 2; addr_offset++) {\r\nassert(addr_offset * SIZEOF_HRT_REG + _REG_GP_IFMT_input_switch_lut_reg0 <= _REG_GP_IFMT_input_switch_lut_reg7);\r\ngp_device_reg_store(ID,\r\n_REG_GP_IFMT_input_switch_lut_reg0 + addr_offset * SIZEOF_HRT_REG,\r\ncfg->hsync_data_reg[addr_offset]);\r\n}\r\ngp_device_reg_store(ID,\r\n_REG_GP_IFMT_input_switch_fsync_lut,\r\ncfg->vsync_data_reg);\r\nreturn;\r\n}\r\nstatic void input_system_network_rst(const input_system_ID_t ID)\r\n{\r\nunsigned int sub_id;\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_A_IDX,\r\nINPUT_SYSTEM_DISCARD_ALL);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_B_IDX,\r\nINPUT_SYSTEM_DISCARD_ALL);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_C_IDX,\r\nINPUT_SYSTEM_DISCARD_ALL);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MUX_IDX,\r\nN_INPUT_SYSTEM_MULTIPLEX);\r\nfor (sub_id = CAPTURE_UNIT0_ID; sub_id < CAPTURE_UNIT0_ID + N_CAPTURE_UNIT_ID; sub_id++) {\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nCAPT_INIT_REG_ID,\r\n1U << CAPT_INIT_RST_REG_BIT);\r\n}\r\nfor (sub_id = ACQUISITION_UNIT0_ID; sub_id < ACQUISITION_UNIT0_ID + N_ACQUISITION_UNIT_ID; sub_id++) {\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nACQ_INIT_REG_ID,\r\n1U << ACQ_INIT_RST_REG_BIT);\r\n}\r\nfor (sub_id = CTRL_UNIT0_ID; sub_id < CTRL_UNIT0_ID + N_CTRL_UNIT_ID; sub_id++) {\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_INIT_REG_ID,\r\n1U);\r\n}\r\nreturn;\r\n}\r\ninput_system_error_t input_system_configuration_reset(void)\r\n{\r\nunsigned int i;\r\nreceiver_rst(RX0_ID);\r\ninput_system_network_rst(INPUT_SYSTEM0_ID);\r\ngp_device_rst(INPUT_SYSTEM0_ID);\r\ninput_switch_rst(INPUT_SYSTEM0_ID);\r\nfor (i = 0; i < N_CHANNELS; i++ ) {\r\nconfig.ch_flags[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.target_isp_flags[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.target_sp_flags[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.target_strm2mem_flags[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\n}\r\nfor (i = 0; i < N_CSI_PORTS; i++ ) {\r\nconfig.csi_buffer_flags[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.multicast[i] = INPUT_SYSTEM_CFG_FLAG_RESET;\r\n}\r\nconfig.source_type_flags = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.acquisition_buffer_unique_flags = INPUT_SYSTEM_CFG_FLAG_RESET;\r\nconfig.unallocated_ib_mem_words = IB_CAPACITY_IN_WORDS;\r\nconfig.session_flags = INPUT_SYSTEM_CFG_FLAG_REQUIRED;\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic input_system_error_t input_system_configure_channel(\r\nconst channel_cfg_t channel)\r\n{\r\ninput_system_error_t error = INPUT_SYSTEM_ERR_NO_ERROR;\r\nif (config.ch_flags[channel.ch_id] & INPUT_SYSTEM_CFG_FLAG_SET){\r\nreturn INPUT_SYSTEM_ERR_CHANNEL_ALREADY_SET;\r\n} else {\r\nswitch (channel.source_type){\r\ncase INPUT_SYSTEM_SOURCE_SENSOR :\r\nerror = input_system_configure_channel_sensor(channel);\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_TPG :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_PRBS :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_FIFO :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ndefault :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\n}\r\nif (error != INPUT_SYSTEM_ERR_NO_ERROR) return error;\r\nconfig.input_switch_cfg.hsync_data_reg[channel.source_cfg.csi_cfg.csi_port * 2] =\r\nchannel.target_cfg.input_switch_channel_cfg.hsync_data_reg[0];\r\nconfig.input_switch_cfg.hsync_data_reg[channel.source_cfg.csi_cfg.csi_port * 2 + 1] =\r\nchannel.target_cfg.input_switch_channel_cfg.hsync_data_reg[1];\r\nconfig.input_switch_cfg.vsync_data_reg |=\r\n(channel.target_cfg.input_switch_channel_cfg.vsync_data_reg & 0x7) << (channel.source_cfg.csi_cfg.csi_port * 3);\r\nconfig.target_isp[channel.source_cfg.csi_cfg.csi_port] = channel.target_cfg.target_isp_cfg;\r\nconfig.target_sp[channel.source_cfg.csi_cfg.csi_port] = channel.target_cfg.target_sp_cfg;\r\nconfig.target_strm2mem[channel.source_cfg.csi_cfg.csi_port] = channel.target_cfg.target_strm2mem_cfg;\r\nconfig.target_isp_flags[channel.source_cfg.csi_cfg.csi_port] |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nconfig.target_sp_flags[channel.source_cfg.csi_cfg.csi_port] |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nconfig.target_strm2mem_flags[channel.source_cfg.csi_cfg.csi_port] |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nconfig.ch_flags[channel.ch_id] = INPUT_SYSTEM_CFG_FLAG_SET;\r\n}\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic input_system_error_t input_buffer_configuration(void)\r\n{\r\nuint32_t current_address = 0;\r\nuint32_t unallocated_memory = IB_CAPACITY_IN_WORDS;\r\nib_buffer_t candidate_buffer_acq = IB_BUFFER_NULL;\r\nuint32_t size_requested;\r\ninput_system_config_flags_t acq_already_specified = INPUT_SYSTEM_CFG_FLAG_RESET;\r\ninput_system_csi_port_t port;\r\nfor (port = INPUT_SYSTEM_PORT_A; port < N_INPUT_SYSTEM_PORTS; port++) {\r\ncsi_cfg_t source = config.csi_value[port];\r\nif ( config.csi_flags[port] & INPUT_SYSTEM_CFG_FLAG_SET) {\r\nswitch (source.buffering_mode) {\r\ncase INPUT_SYSTEM_FIFO_CAPTURE :\r\ncase INPUT_SYSTEM_XMEM_ACQUIRE :\r\nconfig.csi_buffer_flags[port] = INPUT_SYSTEM_CFG_FLAG_BLOCKED;\r\nbreak;\r\ncase INPUT_SYSTEM_FIFO_CAPTURE_WITH_COUNTING :\r\ncase INPUT_SYSTEM_SRAM_BUFFERING :\r\ncase INPUT_SYSTEM_XMEM_BUFFERING :\r\ncase INPUT_SYSTEM_XMEM_CAPTURE :\r\nsize_requested = source.csi_buffer.mem_reg_size * source.csi_buffer.nof_mem_regs;\r\nif (source.csi_buffer.mem_reg_size > 0\r\n&& source.csi_buffer.nof_mem_regs >0\r\n&& size_requested <= unallocated_memory\r\n) {\r\nconfig.csi_buffer[port].mem_reg_addr = current_address;\r\nconfig.csi_buffer[port].mem_reg_size = source.csi_buffer.mem_reg_size;\r\nconfig.csi_buffer[port].nof_mem_regs = source.csi_buffer.nof_mem_regs;\r\ncurrent_address += size_requested;\r\nunallocated_memory -= size_requested;\r\nconfig.csi_buffer_flags[port] = INPUT_SYSTEM_CFG_FLAG_SET;\r\n} else {\r\nconfig.csi_buffer_flags[port] |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\nbreak;\r\ndefault :\r\nconfig.csi_buffer_flags[port] |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\n}\r\nswitch (source.buffering_mode) {\r\ncase INPUT_SYSTEM_FIFO_CAPTURE :\r\ncase INPUT_SYSTEM_SRAM_BUFFERING :\r\ncase INPUT_SYSTEM_XMEM_CAPTURE :\r\nbreak;\r\ncase INPUT_SYSTEM_FIFO_CAPTURE_WITH_COUNTING :\r\ncase INPUT_SYSTEM_XMEM_BUFFERING :\r\ncase INPUT_SYSTEM_XMEM_ACQUIRE :\r\nif (acq_already_specified == INPUT_SYSTEM_CFG_FLAG_RESET) {\r\nsize_requested = source.acquisition_buffer.mem_reg_size\r\n* source.acquisition_buffer.nof_mem_regs;\r\nif (source.acquisition_buffer.mem_reg_size > 0\r\n&& source.acquisition_buffer.nof_mem_regs >0\r\n&& size_requested <= unallocated_memory\r\n) {\r\ncandidate_buffer_acq = source.acquisition_buffer;\r\nacq_already_specified = INPUT_SYSTEM_CFG_FLAG_SET;\r\n}\r\n} else {\r\nif (source.acquisition_buffer.mem_reg_size != candidate_buffer_acq.mem_reg_size\r\n|| source.acquisition_buffer.nof_mem_regs != candidate_buffer_acq.nof_mem_regs\r\n) {\r\nconfig.acquisition_buffer_unique_flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\n}\r\nbreak;\r\ndefault :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\n}\r\n} else {\r\nconfig.csi_buffer_flags[port] = INPUT_SYSTEM_CFG_FLAG_BLOCKED;\r\n}\r\n}\r\nsize_requested = candidate_buffer_acq.mem_reg_size * candidate_buffer_acq.nof_mem_regs;\r\nif (acq_already_specified == INPUT_SYSTEM_CFG_FLAG_SET\r\n&& size_requested <= unallocated_memory) {\r\nconfig.acquisition_buffer_unique.mem_reg_addr = current_address;\r\nconfig.acquisition_buffer_unique.mem_reg_size = candidate_buffer_acq.mem_reg_size;\r\nconfig.acquisition_buffer_unique.nof_mem_regs = candidate_buffer_acq.nof_mem_regs;\r\ncurrent_address += size_requested;\r\nunallocated_memory -= size_requested;\r\nconfig.acquisition_buffer_unique_flags = INPUT_SYSTEM_CFG_FLAG_SET;\r\nassert(current_address <= IB_CAPACITY_IN_WORDS);\r\n}\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic void capture_unit_configure(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\nconst ib_buffer_t* const cfg)\r\n{\r\nassert(ID < N_INPUT_SYSTEM_ID);\r\nassert( (sub_id <= CAPTURE_UNIT2_ID));\r\nassert(cfg != NULL);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nCAPT_START_ADDR_REG_ID,\r\ncfg->mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nCAPT_MEM_REGION_SIZE_REG_ID,\r\ncfg->mem_reg_size);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nCAPT_NUM_MEM_REGIONS_REG_ID,\r\ncfg->nof_mem_regs);\r\nreturn;\r\n}\r\nstatic void acquisition_unit_configure(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\nconst ib_buffer_t* const cfg)\r\n{\r\nassert(ID < N_INPUT_SYSTEM_ID);\r\nassert(sub_id == ACQUISITION_UNIT0_ID);\r\nassert(cfg != NULL);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nACQ_START_ADDR_REG_ID,\r\ncfg->mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nACQ_NUM_MEM_REGIONS_REG_ID,\r\ncfg->nof_mem_regs);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nACQ_MEM_REGION_SIZE_REG_ID,\r\ncfg->mem_reg_size);\r\nreturn;\r\n}\r\nstatic void ctrl_unit_configure(\r\nconst input_system_ID_t ID,\r\nconst sub_system_ID_t sub_id,\r\nconst ctrl_unit_cfg_t* const cfg)\r\n{\r\nassert(ID < N_INPUT_SYSTEM_ID);\r\nassert(sub_id == CTRL_UNIT0_ID);\r\nassert(cfg != NULL);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_A_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT0_ID].mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_A_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT0_ID].mem_reg_size);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_A_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT0_ID].nof_mem_regs);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_B_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT1_ID].mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_B_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT1_ID].mem_reg_size);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_B_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT1_ID].nof_mem_regs);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_START_ADDR_C_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT2_ID].mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_MEM_REGION_SIZE_C_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT2_ID].mem_reg_size);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_NUM_MEM_REGIONS_C_REG_ID,\r\ncfg->buffer_mipi[CAPTURE_UNIT2_ID].nof_mem_regs);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_START_ADDR_REG_ID,\r\ncfg->buffer_acquire[ACQUISITION_UNIT0_ID - ACQUISITION_UNIT0_ID].mem_reg_addr);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_MEM_REGION_SIZE_REG_ID,\r\ncfg->buffer_acquire[ACQUISITION_UNIT0_ID - ACQUISITION_UNIT0_ID].mem_reg_size);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_ACQ_NUM_MEM_REGIONS_REG_ID,\r\ncfg->buffer_acquire[ACQUISITION_UNIT0_ID - ACQUISITION_UNIT0_ID].nof_mem_regs);\r\ninput_system_sub_system_reg_store(ID,\r\nsub_id,\r\nISYS_CTRL_CAPT_RESERVE_ONE_MEM_REGION_REG_ID,\r\n0);\r\nreturn;\r\n}\r\nstatic void input_system_network_configure(\r\nconst input_system_ID_t ID,\r\nconst input_system_network_cfg_t * const cfg)\r\n{\r\nuint32_t sub_id;\r\nassert(ID < N_INPUT_SYSTEM_ID);\r\nassert(cfg != NULL);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_A_IDX,\r\ncfg->multicast_cfg[CAPTURE_UNIT0_ID]);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_B_IDX,\r\ncfg->multicast_cfg[CAPTURE_UNIT1_ID]);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MULTICAST_C_IDX,\r\ncfg->multicast_cfg[CAPTURE_UNIT2_ID]);\r\ninput_system_sub_system_reg_store(ID,\r\nGPREGS_UNIT0_ID,\r\nHIVE_ISYS_GPREG_MUX_IDX,\r\ncfg->mux_cfg);\r\nfor (sub_id = CAPTURE_UNIT0_ID; sub_id < CAPTURE_UNIT0_ID + N_CAPTURE_UNIT_ID; sub_id++) {\r\ncapture_unit_configure(ID,\r\nsub_id,\r\n&(cfg->ctrl_unit_cfg[ID].buffer_mipi[sub_id - CAPTURE_UNIT0_ID]));\r\n}\r\nfor (sub_id = ACQUISITION_UNIT0_ID; sub_id < ACQUISITION_UNIT0_ID + N_ACQUISITION_UNIT_ID; sub_id++) {\r\nacquisition_unit_configure(ID,\r\nsub_id,\r\n&(cfg->ctrl_unit_cfg[sub_id - ACQUISITION_UNIT0_ID].buffer_acquire[sub_id - ACQUISITION_UNIT0_ID]));\r\n}\r\nfor (sub_id = CTRL_UNIT0_ID; sub_id < CTRL_UNIT0_ID + N_CTRL_UNIT_ID; sub_id++) {\r\nctrl_unit_configure(ID,\r\nsub_id,\r\n&(cfg->ctrl_unit_cfg[sub_id - CTRL_UNIT0_ID]));\r\n}\r\nreturn;\r\n}\r\nstatic input_system_error_t configuration_to_registers(void)\r\n{\r\ninput_system_network_cfg_t input_system_network_cfg;\r\nint i;\r\nassert(config.source_type_flags & INPUT_SYSTEM_CFG_FLAG_SET);\r\nswitch (config.source_type) {\r\ncase INPUT_SYSTEM_SOURCE_SENSOR :\r\nfor (i = MIPI_PORT0_ID; i < N_MIPI_PORT_ID; i++) {\r\nif (config.csi_flags[i] & INPUT_SYSTEM_CFG_FLAG_SET) {\r\nswitch (config.csi_value[i].buffering_mode) {\r\ncase INPUT_SYSTEM_FIFO_CAPTURE:\r\nconfig.multicast[i] = INPUT_SYSTEM_CSI_BACKEND;\r\nbreak;\r\ncase INPUT_SYSTEM_XMEM_CAPTURE:\r\ncase INPUT_SYSTEM_SRAM_BUFFERING:\r\ncase INPUT_SYSTEM_XMEM_BUFFERING:\r\nconfig.multicast[i] = INPUT_SYSTEM_INPUT_BUFFER;\r\nbreak;\r\ncase INPUT_SYSTEM_FIFO_CAPTURE_WITH_COUNTING:\r\nconfig.multicast[i] = INPUT_SYSTEM_MULTICAST;\r\nbreak;\r\ncase INPUT_SYSTEM_XMEM_ACQUIRE:\r\nconfig.multicast[i] = INPUT_SYSTEM_DISCARD_ALL;\r\nbreak;\r\ndefault:\r\nconfig.multicast[i] = INPUT_SYSTEM_DISCARD_ALL;\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\n}\r\n} else {\r\nconfig.multicast[i]= INPUT_SYSTEM_DISCARD_ALL;\r\n}\r\ninput_system_network_cfg.multicast_cfg[i] = config.multicast[i];\r\n}\r\ninput_system_network_cfg.mux_cfg = config.multiplexer;\r\ninput_system_network_cfg.ctrl_unit_cfg[CTRL_UNIT0_ID - CTRL_UNIT0_ID].buffer_mipi[CAPTURE_UNIT0_ID] = config.csi_buffer[MIPI_PORT0_ID];\r\ninput_system_network_cfg.ctrl_unit_cfg[CTRL_UNIT0_ID - CTRL_UNIT0_ID].buffer_mipi[CAPTURE_UNIT1_ID] = config.csi_buffer[MIPI_PORT1_ID];\r\ninput_system_network_cfg.ctrl_unit_cfg[CTRL_UNIT0_ID - CTRL_UNIT0_ID].buffer_mipi[CAPTURE_UNIT2_ID] = config.csi_buffer[MIPI_PORT2_ID];\r\ninput_system_network_cfg.ctrl_unit_cfg[CTRL_UNIT0_ID - CTRL_UNIT0_ID].buffer_acquire[ACQUISITION_UNIT0_ID - ACQUISITION_UNIT0_ID] =\r\nconfig.acquisition_buffer_unique;\r\ninput_system_network_configure(INPUT_SYSTEM0_ID, &input_system_network_cfg);\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_TPG :\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_PRBS :\r\nbreak;\r\ncase INPUT_SYSTEM_SOURCE_FIFO :\r\nbreak;\r\ndefault :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\n}\r\ninput_selector_cfg_for_sensor(INPUT_SYSTEM0_ID);\r\ninput_switch_cfg(INPUT_SYSTEM0_ID, &config.input_switch_cfg);\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\ninput_system_error_t input_system_configuration_commit(void)\r\n{\r\ninput_system_error_t error = input_buffer_configuration();\r\nif (error != INPUT_SYSTEM_ERR_NO_ERROR) {\r\nreturn error;\r\n}\r\nerror = configuration_to_registers();\r\nif (error != INPUT_SYSTEM_ERR_NO_ERROR) {\r\nreturn error;\r\n}\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\ninput_system_error_t input_system_csi_fifo_channel_cfg(\r\nuint32_t ch_id,\r\ninput_system_csi_port_t port,\r\nbackend_channel_cfg_t backend_ch,\r\ntarget_cfg2400_t target\r\n)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.backend_ch = backend_ch;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_FIFO_CAPTURE;\r\nchannel.source_cfg.csi_cfg.csi_buffer = IB_BUFFER_NULL;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer = IB_BUFFER_NULL;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = 0;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_csi_fifo_channel_with_counting_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\ninput_system_csi_port_t port,\r\nbackend_channel_cfg_t backend_ch,\r\nuint32_t csi_mem_reg_size,\r\nuint32_t csi_nof_mem_regs,\r\ntarget_cfg2400_t target\r\n)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.backend_ch = backend_ch;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_FIFO_CAPTURE_WITH_COUNTING;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_size = csi_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.csi_buffer.nof_mem_regs = csi_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer = IB_BUFFER_NULL;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = nof_frames;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_csi_sram_channel_cfg(\r\nuint32_t ch_id,\r\ninput_system_csi_port_t port,\r\nbackend_channel_cfg_t backend_ch,\r\nuint32_t csi_mem_reg_size,\r\nuint32_t csi_nof_mem_regs,\r\ntarget_cfg2400_t target\r\n)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.backend_ch = backend_ch;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_SRAM_BUFFERING;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_size = csi_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.csi_buffer.nof_mem_regs = csi_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer = IB_BUFFER_NULL;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = 0;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_csi_xmem_channel_cfg(\r\nuint32_t ch_id,\r\ninput_system_csi_port_t port,\r\nbackend_channel_cfg_t backend_ch,\r\nuint32_t csi_mem_reg_size,\r\nuint32_t csi_nof_mem_regs,\r\nuint32_t acq_mem_reg_size,\r\nuint32_t acq_nof_mem_regs,\r\ntarget_cfg2400_t target,\r\nuint32_t nof_xmem_buffers\r\n)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.backend_ch = backend_ch;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_XMEM_BUFFERING;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_size = csi_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.csi_buffer.nof_mem_regs = csi_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_size = acq_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.nof_mem_regs = acq_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = nof_xmem_buffers;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_csi_xmem_acquire_only_channel_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\ninput_system_csi_port_t port,\r\nbackend_channel_cfg_t backend_ch,\r\nuint32_t acq_mem_reg_size,\r\nuint32_t acq_nof_mem_regs,\r\ntarget_cfg2400_t target)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.backend_ch = backend_ch;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_XMEM_ACQUIRE;\r\nchannel.source_cfg.csi_cfg.csi_buffer = IB_BUFFER_NULL;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_size = acq_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.nof_mem_regs = acq_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = nof_frames;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_csi_xmem_capture_only_channel_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\ninput_system_csi_port_t port,\r\nuint32_t csi_mem_reg_size,\r\nuint32_t csi_nof_mem_regs,\r\nuint32_t acq_mem_reg_size,\r\nuint32_t acq_nof_mem_regs,\r\ntarget_cfg2400_t target)\r\n{\r\nchannel_cfg_t channel;\r\nchannel.ch_id = ch_id;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_SENSOR;\r\nchannel.source_cfg.csi_cfg.csi_port = port;\r\nchannel.source_cfg.csi_cfg.buffering_mode = INPUT_SYSTEM_XMEM_CAPTURE;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_size = csi_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.csi_buffer.nof_mem_regs = csi_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.csi_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_size = acq_mem_reg_size;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.nof_mem_regs = acq_nof_mem_regs;\r\nchannel.source_cfg.csi_cfg.acquisition_buffer.mem_reg_addr = 0;\r\nchannel.source_cfg.csi_cfg.nof_xmem_buffers = nof_frames;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_prbs_channel_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\nuint32_t seed,\r\nuint32_t sync_gen_width,\r\nuint32_t sync_gen_height,\r\nuint32_t sync_gen_hblank_cycles,\r\nuint32_t sync_gen_vblank_cycles,\r\ntarget_cfg2400_t target\r\n)\r\n{\r\nchannel_cfg_t channel;\r\n(void)nof_frames;\r\nchannel.ch_id = ch_id;\r\nchannel.source_type= INPUT_SYSTEM_SOURCE_PRBS;\r\nchannel.source_cfg.prbs_cfg.seed = seed;\r\nchannel.source_cfg.prbs_cfg.sync_gen_cfg.width = sync_gen_width;\r\nchannel.source_cfg.prbs_cfg.sync_gen_cfg.height = sync_gen_height;\r\nchannel.source_cfg.prbs_cfg.sync_gen_cfg.hblank_cycles = sync_gen_hblank_cycles;\r\nchannel.source_cfg.prbs_cfg.sync_gen_cfg.vblank_cycles = sync_gen_vblank_cycles;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_tpg_channel_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\nuint32_t x_mask,\r\nuint32_t y_mask,\r\nuint32_t x_delta,\r\nuint32_t y_delta,\r\nuint32_t xy_mask,\r\nuint32_t sync_gen_width,\r\nuint32_t sync_gen_height,\r\nuint32_t sync_gen_hblank_cycles,\r\nuint32_t sync_gen_vblank_cycles,\r\ntarget_cfg2400_t target\r\n)\r\n{\r\nchannel_cfg_t channel;\r\n(void)nof_frames;\r\nchannel.ch_id = ch_id;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_TPG;\r\nchannel.source_cfg.tpg_cfg.x_mask = x_mask;\r\nchannel.source_cfg.tpg_cfg.y_mask = y_mask;\r\nchannel.source_cfg.tpg_cfg.x_delta = x_delta;\r\nchannel.source_cfg.tpg_cfg.y_delta = y_delta;\r\nchannel.source_cfg.tpg_cfg.xy_mask = xy_mask;\r\nchannel.source_cfg.tpg_cfg.sync_gen_cfg.width = sync_gen_width;\r\nchannel.source_cfg.tpg_cfg.sync_gen_cfg.height = sync_gen_height;\r\nchannel.source_cfg.tpg_cfg.sync_gen_cfg.hblank_cycles = sync_gen_hblank_cycles;\r\nchannel.source_cfg.tpg_cfg.sync_gen_cfg.vblank_cycles = sync_gen_vblank_cycles;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\ninput_system_error_t input_system_gpfifo_channel_cfg(\r\nuint32_t ch_id,\r\nuint32_t nof_frames,\r\ntarget_cfg2400_t target)\r\n{\r\nchannel_cfg_t channel;\r\n(void)nof_frames;\r\nchannel.ch_id = ch_id;\r\nchannel.source_type = INPUT_SYSTEM_SOURCE_FIFO;\r\nchannel.target_cfg = target;\r\nreturn input_system_configure_channel(channel);\r\n}\r\nstatic input_system_error_t input_system_configure_channel_sensor(\r\nconst channel_cfg_t channel)\r\n{\r\nconst uint32_t port = channel.source_cfg.csi_cfg.csi_port;\r\ninput_system_error_t status = INPUT_SYSTEM_ERR_NO_ERROR;\r\ninput_system_multiplex_t mux;\r\nif (port >= N_INPUT_SYSTEM_PORTS)\r\nreturn INPUT_SYSTEM_ERR_GENERIC;\r\nstatus = set_source_type(&(config.source_type), channel.source_type, &config.source_type_flags);\r\nif (status != INPUT_SYSTEM_ERR_NO_ERROR) return status;\r\nstatus = set_csi_cfg(&(config.csi_value[port]), &channel.source_cfg.csi_cfg, &(config.csi_flags[port]));\r\nif (status != INPUT_SYSTEM_ERR_NO_ERROR) return status;\r\nswitch (channel.source_cfg.csi_cfg.buffering_mode){\r\ncase INPUT_SYSTEM_FIFO_CAPTURE:\r\nmux = INPUT_SYSTEM_MIPI_PORT0 + port;\r\nstatus = input_system_multiplexer_cfg(&config.multiplexer, mux, &config.multiplexer_flags);\r\nif (status != INPUT_SYSTEM_ERR_NO_ERROR) return status;\r\nconfig.multicast[port] = INPUT_SYSTEM_CSI_BACKEND;\r\nbreak;\r\ncase INPUT_SYSTEM_SRAM_BUFFERING :\r\nmux = INPUT_SYSTEM_ACQUISITION_UNIT;\r\nstatus = input_system_multiplexer_cfg(&config.multiplexer, mux, &config.multiplexer_flags);\r\nif (status != INPUT_SYSTEM_ERR_NO_ERROR) return status;\r\nconfig.multicast[port] = INPUT_SYSTEM_INPUT_BUFFER;\r\nbreak;\r\ncase INPUT_SYSTEM_XMEM_BUFFERING :\r\nmux = INPUT_SYSTEM_ACQUISITION_UNIT;\r\nstatus = input_system_multiplexer_cfg(&config.multiplexer, mux, &config.multiplexer_flags);\r\nif (status != INPUT_SYSTEM_ERR_NO_ERROR) return status;\r\nconfig.multicast[port] = INPUT_SYSTEM_INPUT_BUFFER;\r\nbreak;\r\ncase INPUT_SYSTEM_FIFO_CAPTURE_WITH_COUNTING :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ncase INPUT_SYSTEM_XMEM_CAPTURE :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ncase INPUT_SYSTEM_XMEM_ACQUIRE :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\ndefault :\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\nbreak;\r\n}\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic input_system_error_t set_source_type(\r\ninput_system_source_t * const lhs,\r\nconst input_system_source_t rhs,\r\ninput_system_config_flags_t * const flags)\r\n{\r\nassert(lhs != NULL);\r\nassert(flags != NULL);\r\nif ((*flags) & INPUT_SYSTEM_CFG_FLAG_BLOCKED) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\nif ((*flags) & INPUT_SYSTEM_CFG_FLAG_SET) {\r\nif ((*lhs) == (rhs)) {\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nelse {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\n}\r\nif (rhs >= N_INPUT_SYSTEM_SOURCE) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\n*lhs = rhs;\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic input_system_error_t set_csi_cfg(\r\ncsi_cfg_t* const lhs,\r\nconst csi_cfg_t* const rhs,\r\ninput_system_config_flags_t * const flags)\r\n{\r\nuint32_t memory_required;\r\nuint32_t acq_memory_required;\r\nassert(lhs != NULL);\r\nassert(flags != NULL);\r\nif ((*flags) & INPUT_SYSTEM_CFG_FLAG_BLOCKED) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\nif (*flags & INPUT_SYSTEM_CFG_FLAG_SET) {\r\nif ( lhs->buffering_mode == rhs->buffering_mode\r\n&& lhs->csi_buffer.mem_reg_size == rhs->csi_buffer.mem_reg_size\r\n&& lhs->csi_buffer.nof_mem_regs == rhs->csi_buffer.nof_mem_regs\r\n&& lhs->acquisition_buffer.mem_reg_size == rhs->acquisition_buffer.mem_reg_size\r\n&& lhs->acquisition_buffer.nof_mem_regs == rhs->acquisition_buffer.nof_mem_regs\r\n&& lhs->nof_xmem_buffers == rhs->nof_xmem_buffers\r\n) {\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nelse {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\n}\r\nmemory_required = rhs->csi_buffer.mem_reg_size * rhs->csi_buffer.nof_mem_regs;\r\nacq_memory_required = rhs->acquisition_buffer.mem_reg_size * rhs->acquisition_buffer.nof_mem_regs;\r\nif (rhs->buffering_mode >= N_INPUT_SYSTEM_BUFFERING_MODE\r\n||\r\n(memory_required + acq_memory_required )> config.unallocated_ib_mem_words\r\n) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\nlhs->buffering_mode = rhs->buffering_mode;\r\nlhs->nof_xmem_buffers = rhs->nof_xmem_buffers;\r\nlhs->csi_buffer.mem_reg_size = rhs->csi_buffer.mem_reg_size;\r\nlhs->csi_buffer.nof_mem_regs = rhs->csi_buffer.nof_mem_regs;\r\nlhs->acquisition_buffer.mem_reg_size = rhs->acquisition_buffer.mem_reg_size;\r\nlhs->acquisition_buffer.nof_mem_regs = rhs->acquisition_buffer.nof_mem_regs;\r\nconfig.unallocated_ib_mem_words -= memory_required;\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nstatic input_system_error_t input_system_multiplexer_cfg(\r\ninput_system_multiplex_t* const lhs,\r\nconst input_system_multiplex_t rhs,\r\ninput_system_config_flags_t* const flags)\r\n{\r\nassert(lhs != NULL);\r\nassert(flags != NULL);\r\nif ((*flags) & INPUT_SYSTEM_CFG_FLAG_BLOCKED) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\nif ((*flags) & INPUT_SYSTEM_CFG_FLAG_SET) {\r\nif ((*lhs) == (rhs)) {\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}\r\nelse {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_CONFLICT_ON_RESOURCE;\r\n}\r\n}\r\nif (rhs >= N_INPUT_SYSTEM_MULTIPLEX) {\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_CONFLICT;\r\nreturn INPUT_SYSTEM_ERR_PARAMETER_NOT_SUPPORTED;\r\n}\r\n*lhs = rhs;\r\n*flags |= INPUT_SYSTEM_CFG_FLAG_SET;\r\nreturn INPUT_SYSTEM_ERR_NO_ERROR;\r\n}
