static const struct exception_table_entry *check_exception_ranges(unsigned long addr)\r\n{\r\nif ((addr >= (unsigned long)&copy_user_memcpy) &&\r\n(addr <= (unsigned long)&copy_user_memcpy_end))\r\nreturn &__copy_user_fixup_ex;\r\nreturn NULL;\r\n}\r\nstatic int cmp_ex_search(const void *key, const void *elt)\r\n{\r\nconst struct exception_table_entry *_elt = elt;\r\nunsigned long _key = *(unsigned long *)key;\r\nif (_key > _elt->insn)\r\nreturn 1;\r\nif (_key < _elt->insn)\r\nreturn -1;\r\nreturn 0;\r\n}\r\nconst struct exception_table_entry *\r\nsearch_extable(const struct exception_table_entry *base,\r\nconst size_t num,\r\nunsigned long value)\r\n{\r\nconst struct exception_table_entry *mid;\r\nmid = check_exception_ranges(value);\r\nif (mid)\r\nreturn mid;\r\nreturn bsearch(&value, base, num,\r\nsizeof(struct exception_table_entry), cmp_ex_search);\r\n}\r\nint fixup_exception(struct pt_regs *regs)\r\n{\r\nconst struct exception_table_entry *fixup;\r\nfixup = search_exception_tables(regs->pc);\r\nif (fixup) {\r\nregs->pc = fixup->fixup;\r\nreturn 1;\r\n}\r\nreturn 0;\r\n}
