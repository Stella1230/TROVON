static int read_reset_stat(struct ctl_table *table, int write,\r\nvoid __user *buffer, size_t *lenp,\r\nloff_t *ppos)\r\n{\r\natomic_t *stat = (atomic_t *)table->data;\r\nif (!stat)\r\nreturn -EINVAL;\r\nif (write)\r\natomic_set(stat, 0);\r\nelse {\r\nchar str_buf[32];\r\nchar *data;\r\nint len = snprintf(str_buf, 32, "%d\n", atomic_read(stat));\r\nif (len >= 32)\r\nreturn -EFAULT;\r\nlen = strlen(str_buf);\r\nif (*ppos > len) {\r\n*lenp = 0;\r\nreturn 0;\r\n}\r\ndata = &str_buf[*ppos];\r\nlen -= *ppos;\r\nif (len > *lenp)\r\nlen = *lenp;\r\nif (len && copy_to_user(buffer, str_buf, len))\r\nreturn -EFAULT;\r\n*lenp = len;\r\n*ppos += len;\r\n}\r\nreturn 0;\r\n}\r\nvoid svc_rdma_cleanup(void)\r\n{\r\ndprintk("SVCRDMA Module Removed, deregister RPC RDMA transport\n");\r\ndestroy_workqueue(svc_rdma_wq);\r\nif (svcrdma_table_header) {\r\nunregister_sysctl_table(svcrdma_table_header);\r\nsvcrdma_table_header = NULL;\r\n}\r\n#if defined(CONFIG_SUNRPC_BACKCHANNEL)\r\nsvc_unreg_xprt_class(&svc_rdma_bc_class);\r\n#endif\r\nsvc_unreg_xprt_class(&svc_rdma_class);\r\n}\r\nint svc_rdma_init(void)\r\n{\r\ndprintk("SVCRDMA Module Init, register RPC RDMA transport\n");\r\ndprintk("\tsvcrdma_ord : %d\n", svcrdma_ord);\r\ndprintk("\tmax_requests : %u\n", svcrdma_max_requests);\r\ndprintk("\tmax_bc_requests : %u\n", svcrdma_max_bc_requests);\r\ndprintk("\tmax_inline : %d\n", svcrdma_max_req_size);\r\nsvc_rdma_wq = alloc_workqueue("svc_rdma", 0, 0);\r\nif (!svc_rdma_wq)\r\nreturn -ENOMEM;\r\nif (!svcrdma_table_header)\r\nsvcrdma_table_header =\r\nregister_sysctl_table(svcrdma_root_table);\r\nsvc_reg_xprt_class(&svc_rdma_class);\r\n#if defined(CONFIG_SUNRPC_BACKCHANNEL)\r\nsvc_reg_xprt_class(&svc_rdma_bc_class);\r\n#endif\r\nreturn 0;\r\n}
