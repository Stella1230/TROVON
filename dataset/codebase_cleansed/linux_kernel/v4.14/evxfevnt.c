acpi_status acpi_enable(void)\r\n{\r\nacpi_status status;\r\nint retry;\r\nACPI_FUNCTION_TRACE(acpi_enable);\r\nif (acpi_gbl_fadt_index == ACPI_INVALID_TABLE_INDEX) {\r\nreturn_ACPI_STATUS(AE_NO_ACPI_TABLES);\r\n}\r\nif (acpi_gbl_reduced_hardware) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (acpi_hw_get_mode() == ACPI_SYS_MODE_ACPI) {\r\nACPI_DEBUG_PRINT((ACPI_DB_INIT,\r\n"System is already in ACPI mode\n"));\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nstatus = acpi_hw_set_mode(ACPI_SYS_MODE_ACPI);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_ERROR((AE_INFO,\r\n"Could not transition to ACPI mode"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nfor (retry = 0; retry < 30000; ++retry) {\r\nif (acpi_hw_get_mode() == ACPI_SYS_MODE_ACPI) {\r\nif (retry != 0)\r\nACPI_WARNING((AE_INFO,\r\n"Platform took > %d00 usec to enter ACPI mode", retry));\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_os_stall(100);\r\n}\r\nACPI_ERROR((AE_INFO, "Hardware did not enter ACPI mode"));\r\nreturn_ACPI_STATUS(AE_NO_HARDWARE_RESPONSE);\r\n}\r\nacpi_status acpi_disable(void)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(acpi_disable);\r\nif (acpi_gbl_reduced_hardware) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (acpi_hw_get_mode() == ACPI_SYS_MODE_LEGACY) {\r\nACPI_DEBUG_PRINT((ACPI_DB_INIT,\r\n"System is already in legacy (non-ACPI) mode\n"));\r\n} else {\r\nstatus = acpi_hw_set_mode(ACPI_SYS_MODE_LEGACY);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_ERROR((AE_INFO,\r\n"Could not exit ACPI mode to legacy mode"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_INIT, "ACPI mode disabled\n"));\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_enable_event(u32 event, u32 flags)\r\n{\r\nacpi_status status = AE_OK;\r\nu32 value;\r\nACPI_FUNCTION_TRACE(acpi_enable_event);\r\nif (acpi_gbl_reduced_hardware) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (event > ACPI_EVENT_MAX) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus =\r\nacpi_write_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id, ACPI_ENABLE_EVENT);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus =\r\nacpi_read_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id, &value);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (value != 1) {\r\nACPI_ERROR((AE_INFO,\r\n"Could not enable %s event",\r\nacpi_ut_get_event_name(event)));\r\nreturn_ACPI_STATUS(AE_NO_HARDWARE_RESPONSE);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_disable_event(u32 event, u32 flags)\r\n{\r\nacpi_status status = AE_OK;\r\nu32 value;\r\nACPI_FUNCTION_TRACE(acpi_disable_event);\r\nif (acpi_gbl_reduced_hardware) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (event > ACPI_EVENT_MAX) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus =\r\nacpi_write_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id, ACPI_DISABLE_EVENT);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus =\r\nacpi_read_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id, &value);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (value != 0) {\r\nACPI_ERROR((AE_INFO,\r\n"Could not disable %s events",\r\nacpi_ut_get_event_name(event)));\r\nreturn_ACPI_STATUS(AE_NO_HARDWARE_RESPONSE);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_clear_event(u32 event)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(acpi_clear_event);\r\nif (acpi_gbl_reduced_hardware) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (event > ACPI_EVENT_MAX) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus =\r\nacpi_write_bit_register(acpi_gbl_fixed_event_info[event].\r\nstatus_register_id, ACPI_CLEAR_STATUS);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_get_event_status(u32 event, acpi_event_status * event_status)\r\n{\r\nacpi_status status;\r\nacpi_event_status local_event_status = 0;\r\nu32 in_byte;\r\nACPI_FUNCTION_TRACE(acpi_get_event_status);\r\nif (!event_status) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nif (event > ACPI_EVENT_MAX) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nif (acpi_gbl_fixed_event_handlers[event].handler) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_HAS_HANDLER;\r\n}\r\nstatus =\r\nacpi_read_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id, &in_byte);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (in_byte) {\r\nlocal_event_status |=\r\n(ACPI_EVENT_FLAG_ENABLED | ACPI_EVENT_FLAG_ENABLE_SET);\r\n}\r\nstatus =\r\nacpi_read_bit_register(acpi_gbl_fixed_event_info[event].\r\nstatus_register_id, &in_byte);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (in_byte) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_STATUS_SET;\r\n}\r\n(*event_status) = local_event_status;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}
