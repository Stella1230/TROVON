static\r\nint read_usb_vudc_device(struct udev_device *sdev, struct usbip_usb_device *dev)\r\n{\r\nconst char *path, *name;\r\nchar filepath[SYSFS_PATH_MAX];\r\nstruct usb_device_descriptor descr;\r\nunsigned i;\r\nFILE *fd = NULL;\r\nstruct udev_device *plat;\r\nconst char *speed;\r\nint ret = 0;\r\nplat = udev_device_get_parent(sdev);\r\npath = udev_device_get_syspath(plat);\r\nsnprintf(filepath, SYSFS_PATH_MAX, "%s/%s",\r\npath, VUDC_DEVICE_DESCR_FILE);\r\nfd = fopen(filepath, "r");\r\nif (!fd)\r\nreturn -1;\r\nret = fread((char *) &descr, sizeof(descr), 1, fd);\r\nif (ret < 0)\r\nreturn -1;\r\nfclose(fd);\r\ncopy_descr_attr(dev, &descr, bDeviceClass);\r\ncopy_descr_attr(dev, &descr, bDeviceSubClass);\r\ncopy_descr_attr(dev, &descr, bDeviceProtocol);\r\ncopy_descr_attr(dev, &descr, bNumConfigurations);\r\ncopy_descr_attr16(dev, &descr, idVendor);\r\ncopy_descr_attr16(dev, &descr, idProduct);\r\ncopy_descr_attr16(dev, &descr, bcdDevice);\r\nstrncpy(dev->path, path, SYSFS_PATH_MAX);\r\ndev->speed = USB_SPEED_UNKNOWN;\r\nspeed = udev_device_get_sysattr_value(sdev, "current_speed");\r\nif (speed) {\r\nfor (i = 0; i < ARRAY_SIZE(speed_names); i++) {\r\nif (!strcmp(speed_names[i].name, speed)) {\r\ndev->speed = speed_names[i].speed;\r\nbreak;\r\n}\r\n}\r\n}\r\ndev->bNumInterfaces = 0;\r\ndev->bConfigurationValue = 0;\r\ndev->busnum = 0;\r\nname = udev_device_get_sysname(plat);\r\nstrncpy(dev->busid, name, SYSFS_BUS_ID_SIZE);\r\nreturn 0;\r\n}\r\nstatic int is_my_device(struct udev_device *dev)\r\n{\r\nconst char *driver;\r\ndriver = udev_device_get_property_value(dev, "USB_UDC_NAME");\r\nreturn driver != NULL && !strcmp(driver, USBIP_DEVICE_DRV_NAME);\r\n}\r\nstatic int usbip_device_driver_open(struct usbip_host_driver *hdriver)\r\n{\r\nint ret;\r\nhdriver->ndevs = 0;\r\nINIT_LIST_HEAD(&hdriver->edev_list);\r\nret = usbip_generic_driver_open(hdriver);\r\nif (ret)\r\nerr("please load " USBIP_CORE_MOD_NAME ".ko and "\r\nUSBIP_DEVICE_DRV_NAME ".ko!");\r\nreturn ret;\r\n}
