static void __init rk3399_clk_init(struct device_node *np)\r\n{\r\nstruct rockchip_clk_provider *ctx;\r\nvoid __iomem *reg_base;\r\nstruct clk *clk;\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base) {\r\npr_err("%s: could not map cru region\n", __func__);\r\nreturn;\r\n}\r\nctx = rockchip_clk_init(np, reg_base, CLK_NR_CLKS);\r\nif (IS_ERR(ctx)) {\r\npr_err("%s: rockchip clk init failed\n", __func__);\r\niounmap(reg_base);\r\nreturn;\r\n}\r\nclk = clk_register_fixed_factor(NULL, "pclk_wdt", "pclk_alive", 0, 1, 1);\r\nif (IS_ERR(clk))\r\npr_warn("%s: could not register clock pclk_wdt: %ld\n",\r\n__func__, PTR_ERR(clk));\r\nelse\r\nrockchip_clk_add_lookup(ctx, clk, PCLK_WDT);\r\nrockchip_clk_register_plls(ctx, rk3399_pll_clks,\r\nARRAY_SIZE(rk3399_pll_clks), -1);\r\nrockchip_clk_register_branches(ctx, rk3399_clk_branches,\r\nARRAY_SIZE(rk3399_clk_branches));\r\nrockchip_clk_protect_critical(rk3399_cru_critical_clocks,\r\nARRAY_SIZE(rk3399_cru_critical_clocks));\r\nrockchip_clk_register_armclk(ctx, ARMCLKL, "armclkl",\r\nmux_armclkl_p, ARRAY_SIZE(mux_armclkl_p),\r\n&rk3399_cpuclkl_data, rk3399_cpuclkl_rates,\r\nARRAY_SIZE(rk3399_cpuclkl_rates));\r\nrockchip_clk_register_armclk(ctx, ARMCLKB, "armclkb",\r\nmux_armclkb_p, ARRAY_SIZE(mux_armclkb_p),\r\n&rk3399_cpuclkb_data, rk3399_cpuclkb_rates,\r\nARRAY_SIZE(rk3399_cpuclkb_rates));\r\nrockchip_register_softrst(np, 21, reg_base + RK3399_SOFTRST_CON(0),\r\nROCKCHIP_SOFTRST_HIWORD_MASK);\r\nrockchip_register_restart_notifier(ctx, RK3399_GLB_SRST_FST, NULL);\r\nrockchip_clk_of_add_provider(np, ctx);\r\n}\r\nstatic void __init rk3399_pmu_clk_init(struct device_node *np)\r\n{\r\nstruct rockchip_clk_provider *ctx;\r\nvoid __iomem *reg_base;\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base) {\r\npr_err("%s: could not map cru pmu region\n", __func__);\r\nreturn;\r\n}\r\nctx = rockchip_clk_init(np, reg_base, CLKPMU_NR_CLKS);\r\nif (IS_ERR(ctx)) {\r\npr_err("%s: rockchip pmu clk init failed\n", __func__);\r\niounmap(reg_base);\r\nreturn;\r\n}\r\nrockchip_clk_register_plls(ctx, rk3399_pmu_pll_clks,\r\nARRAY_SIZE(rk3399_pmu_pll_clks), -1);\r\nrockchip_clk_register_branches(ctx, rk3399_clk_pmu_branches,\r\nARRAY_SIZE(rk3399_clk_pmu_branches));\r\nrockchip_clk_protect_critical(rk3399_pmucru_critical_clocks,\r\nARRAY_SIZE(rk3399_pmucru_critical_clocks));\r\nrockchip_register_softrst(np, 2, reg_base + RK3399_PMU_SOFTRST_CON(0),\r\nROCKCHIP_SOFTRST_HIWORD_MASK);\r\nrockchip_clk_of_add_provider(np, ctx);\r\n}
