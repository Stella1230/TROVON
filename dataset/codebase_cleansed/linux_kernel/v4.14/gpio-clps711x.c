static int clps711x_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nvoid __iomem *dat, *dir;\r\nstruct gpio_chip *gc;\r\nstruct resource *res;\r\nint err, id;\r\nif (!np)\r\nreturn -ENODEV;\r\nid = of_alias_get_id(np, "gpio");\r\nif ((id < 0) || (id > 4))\r\nreturn -ENODEV;\r\ngc = devm_kzalloc(&pdev->dev, sizeof(*gc), GFP_KERNEL);\r\nif (!gc)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\ndat = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(dat))\r\nreturn PTR_ERR(dat);\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 1);\r\ndir = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(dir))\r\nreturn PTR_ERR(dir);\r\nswitch (id) {\r\ncase 3:\r\nerr = bgpio_init(gc, &pdev->dev, 1, dat, NULL, NULL,\r\nNULL, dir, 0);\r\nbreak;\r\ndefault:\r\nerr = bgpio_init(gc, &pdev->dev, 1, dat, NULL, NULL,\r\ndir, NULL, 0);\r\nbreak;\r\n}\r\nif (err)\r\nreturn err;\r\nswitch (id) {\r\ncase 4:\r\ngc->ngpio = 3;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\ngc->base = -1;\r\ngc->owner = THIS_MODULE;\r\nplatform_set_drvdata(pdev, gc);\r\nreturn devm_gpiochip_add_data(&pdev->dev, gc, NULL);\r\n}
