void ptrace_disable(struct task_struct *child)\r\n{\r\n}\r\nstatic inline long get_reg(struct task_struct *task, int regno)\r\n{\r\nlong *addr = (long *)task_pt_regs(task);\r\nif (regno == PT_TSR || regno == PT_CSR)\r\nreturn 0;\r\nreturn addr[regno];\r\n}\r\nstatic inline int put_reg(struct task_struct *task,\r\nint regno,\r\nunsigned long data)\r\n{\r\nunsigned long *addr = (unsigned long *)task_pt_regs(task);\r\nif (regno != PT_TSR && regno != PT_CSR)\r\naddr[regno] = data;\r\nreturn 0;\r\n}\r\nstatic int gpr_get(struct task_struct *target,\r\nconst struct user_regset *regset,\r\nunsigned int pos, unsigned int count,\r\nvoid *kbuf, void __user *ubuf)\r\n{\r\nstruct pt_regs *regs = task_pt_regs(target);\r\nreturn user_regset_copyout(&pos, &count, &kbuf, &ubuf,\r\nregs,\r\n0, sizeof(*regs));\r\n}\r\nconst struct user_regset_view *task_user_regset_view(struct task_struct *task)\r\n{\r\nreturn &user_c6x_native_view;\r\n}\r\nlong arch_ptrace(struct task_struct *child, long request,\r\nunsigned long addr, unsigned long data)\r\n{\r\nint ret = 0;\r\nswitch (request) {\r\ncase PTRACE_POKETEXT:\r\nret = generic_ptrace_pokedata(child, addr, data);\r\nif (ret == 0 && request == PTRACE_POKETEXT)\r\nflush_icache_range(addr, addr + 4);\r\nbreak;\r\ndefault:\r\nret = ptrace_request(child, request, addr, data);\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nasmlinkage unsigned long syscall_trace_entry(struct pt_regs *regs)\r\n{\r\nif (tracehook_report_syscall_entry(regs))\r\nreturn ULONG_MAX;\r\nreturn regs->b0;\r\n}\r\nasmlinkage void syscall_trace_exit(struct pt_regs *regs)\r\n{\r\ntracehook_report_syscall_exit(regs, 0);\r\n}
