static void *crypto842_alloc_ctx(struct crypto_scomp *tfm)\r\n{\r\nvoid *ctx;\r\nctx = kmalloc(SW842_MEM_COMPRESS, GFP_KERNEL);\r\nif (!ctx)\r\nreturn ERR_PTR(-ENOMEM);\r\nreturn ctx;\r\n}\r\nstatic int crypto842_init(struct crypto_tfm *tfm)\r\n{\r\nstruct crypto842_ctx *ctx = crypto_tfm_ctx(tfm);\r\nctx->wmem = crypto842_alloc_ctx(NULL);\r\nif (IS_ERR(ctx->wmem))\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}\r\nstatic void crypto842_free_ctx(struct crypto_scomp *tfm, void *ctx)\r\n{\r\nkfree(ctx);\r\n}\r\nstatic void crypto842_exit(struct crypto_tfm *tfm)\r\n{\r\nstruct crypto842_ctx *ctx = crypto_tfm_ctx(tfm);\r\ncrypto842_free_ctx(NULL, ctx->wmem);\r\n}\r\nstatic int crypto842_compress(struct crypto_tfm *tfm,\r\nconst u8 *src, unsigned int slen,\r\nu8 *dst, unsigned int *dlen)\r\n{\r\nstruct crypto842_ctx *ctx = crypto_tfm_ctx(tfm);\r\nreturn sw842_compress(src, slen, dst, dlen, ctx->wmem);\r\n}\r\nstatic int crypto842_scompress(struct crypto_scomp *tfm,\r\nconst u8 *src, unsigned int slen,\r\nu8 *dst, unsigned int *dlen, void *ctx)\r\n{\r\nreturn sw842_compress(src, slen, dst, dlen, ctx);\r\n}\r\nstatic int crypto842_decompress(struct crypto_tfm *tfm,\r\nconst u8 *src, unsigned int slen,\r\nu8 *dst, unsigned int *dlen)\r\n{\r\nreturn sw842_decompress(src, slen, dst, dlen);\r\n}\r\nstatic int crypto842_sdecompress(struct crypto_scomp *tfm,\r\nconst u8 *src, unsigned int slen,\r\nu8 *dst, unsigned int *dlen, void *ctx)\r\n{\r\nreturn sw842_decompress(src, slen, dst, dlen);\r\n}\r\nstatic int __init crypto842_mod_init(void)\r\n{\r\nint ret;\r\nret = crypto_register_alg(&alg);\r\nif (ret)\r\nreturn ret;\r\nret = crypto_register_scomp(&scomp);\r\nif (ret) {\r\ncrypto_unregister_alg(&alg);\r\nreturn ret;\r\n}\r\nreturn ret;\r\n}\r\nstatic void __exit crypto842_mod_exit(void)\r\n{\r\ncrypto_unregister_alg(&alg);\r\ncrypto_unregister_scomp(&scomp);\r\n}
