static int\r\nqxl_debugfs_irq_received(struct seq_file *m, void *data)\r\n{\r\nstruct drm_info_node *node = (struct drm_info_node *) m->private;\r\nstruct qxl_device *qdev = node->minor->dev->dev_private;\r\nseq_printf(m, "%d\n", atomic_read(&qdev->irq_received));\r\nseq_printf(m, "%d\n", atomic_read(&qdev->irq_received_display));\r\nseq_printf(m, "%d\n", atomic_read(&qdev->irq_received_cursor));\r\nseq_printf(m, "%d\n", atomic_read(&qdev->irq_received_io_cmd));\r\nseq_printf(m, "%d\n", qdev->irq_received_error);\r\nreturn 0;\r\n}\r\nstatic int\r\nqxl_debugfs_buffers_info(struct seq_file *m, void *data)\r\n{\r\nstruct drm_info_node *node = (struct drm_info_node *) m->private;\r\nstruct qxl_device *qdev = node->minor->dev->dev_private;\r\nstruct qxl_bo *bo;\r\nlist_for_each_entry(bo, &qdev->gem.objects, list) {\r\nstruct reservation_object_list *fobj;\r\nint rel;\r\nrcu_read_lock();\r\nfobj = rcu_dereference(bo->tbo.resv->fence);\r\nrel = fobj ? fobj->shared_count : 0;\r\nrcu_read_unlock();\r\nseq_printf(m, "size %ld, pc %d, num releases %d\n",\r\n(unsigned long)bo->gem_base.size,\r\nbo->pin_count, rel);\r\n}\r\nreturn 0;\r\n}\r\nint\r\nqxl_debugfs_init(struct drm_minor *minor)\r\n{\r\n#if defined(CONFIG_DEBUG_FS)\r\nint r;\r\nstruct qxl_device *dev =\r\n(struct qxl_device *) minor->dev->dev_private;\r\ndrm_debugfs_create_files(qxl_debugfs_list, QXL_DEBUGFS_ENTRIES,\r\nminor->debugfs_root, minor);\r\nr = qxl_ttm_debugfs_init(dev);\r\nif (r) {\r\nDRM_ERROR("Failed to init TTM debugfs\n");\r\nreturn r;\r\n}\r\n#endif\r\nreturn 0;\r\n}\r\nint qxl_debugfs_add_files(struct qxl_device *qdev,\r\nstruct drm_info_list *files,\r\nunsigned nfiles)\r\n{\r\nunsigned i;\r\nfor (i = 0; i < qdev->debugfs_count; i++) {\r\nif (qdev->debugfs[i].files == files) {\r\nreturn 0;\r\n}\r\n}\r\ni = qdev->debugfs_count + 1;\r\nif (i > QXL_DEBUGFS_MAX_COMPONENTS) {\r\nDRM_ERROR("Reached maximum number of debugfs components.\n");\r\nDRM_ERROR("Report so we increase QXL_DEBUGFS_MAX_COMPONENTS.\n");\r\nreturn -EINVAL;\r\n}\r\nqdev->debugfs[qdev->debugfs_count].files = files;\r\nqdev->debugfs[qdev->debugfs_count].num_files = nfiles;\r\nqdev->debugfs_count = i;\r\n#if defined(CONFIG_DEBUG_FS)\r\ndrm_debugfs_create_files(files, nfiles,\r\nqdev->ddev.primary->debugfs_root,\r\nqdev->ddev.primary);\r\n#endif\r\nreturn 0;\r\n}
