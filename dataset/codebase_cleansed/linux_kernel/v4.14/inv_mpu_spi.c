static int inv_mpu_i2c_disable(struct iio_dev *indio_dev)\r\n{\r\nstruct inv_mpu6050_state *st = iio_priv(indio_dev);\r\nint ret = 0;\r\nret = inv_mpu6050_set_power_itg(st, true);\r\nif (ret)\r\nreturn ret;\r\nret = regmap_write(st->map, INV_MPU6050_REG_USER_CTRL,\r\nINV_MPU6050_BIT_I2C_IF_DIS);\r\nif (ret) {\r\ninv_mpu6050_set_power_itg(st, false);\r\nreturn ret;\r\n}\r\nreturn inv_mpu6050_set_power_itg(st, false);\r\n}\r\nstatic int inv_mpu_probe(struct spi_device *spi)\r\n{\r\nstruct regmap *regmap;\r\nconst struct spi_device_id *spi_id;\r\nconst struct acpi_device_id *acpi_id;\r\nconst char *name = NULL;\r\nenum inv_devices chip_type;\r\nif ((spi_id = spi_get_device_id(spi))) {\r\nchip_type = (enum inv_devices)spi_id->driver_data;\r\nname = spi_id->name;\r\n} else if ((acpi_id = acpi_match_device(spi->dev.driver->acpi_match_table, &spi->dev))) {\r\nchip_type = (enum inv_devices)acpi_id->driver_data;\r\n} else {\r\nreturn -ENODEV;\r\n}\r\nregmap = devm_regmap_init_spi(spi, &inv_mpu_regmap_config);\r\nif (IS_ERR(regmap)) {\r\ndev_err(&spi->dev, "Failed to register spi regmap %d\n",\r\n(int)PTR_ERR(regmap));\r\nreturn PTR_ERR(regmap);\r\n}\r\nreturn inv_mpu_core_probe(regmap, spi->irq, name,\r\ninv_mpu_i2c_disable, chip_type);\r\n}\r\nstatic int inv_mpu_remove(struct spi_device *spi)\r\n{\r\nreturn inv_mpu_core_remove(&spi->dev);\r\n}
