static u8 halbtc8723b2ant_BtRssiState(\r\nu8 levelNum, u8 rssiThresh, u8 rssiThresh1\r\n)\r\n{\r\ns32 btRssi = 0;\r\nu8 btRssiState = pCoexSta->preBtRssiState;\r\nbtRssi = pCoexSta->btRssi;\r\nif (levelNum == 2) {\r\nif (\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW)\r\n) {\r\nif (btRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nbtRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to High\n"));\r\n} else {\r\nbtRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Low\n"));\r\n}\r\n} else {\r\nif (btRssi < rssiThresh) {\r\nbtRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Low\n"));\r\n} else {\r\nbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at High\n"));\r\n}\r\n}\r\n} else if (levelNum == 3) {\r\nif (rssiThresh > rssiThresh1) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi thresh error!!\n"));\r\nreturn pCoexSta->preBtRssiState;\r\n}\r\nif (\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW)\r\n) {\r\nif (btRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nbtRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Medium\n"));\r\n} else {\r\nbtRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Low\n"));\r\n}\r\n} else if (\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_MEDIUM) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_MEDIUM)\r\n) {\r\nif (btRssi >= (rssiThresh1+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nbtRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to High\n"));\r\n} else if (btRssi < rssiThresh) {\r\nbtRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Low\n"));\r\n} else {\r\nbtRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Medium\n"));\r\n}\r\n} else {\r\nif (btRssi < rssiThresh1) {\r\nbtRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Medium\n"));\r\n} else {\r\nbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at High\n"));\r\n}\r\n}\r\n}\r\npCoexSta->preBtRssiState = btRssiState;\r\nreturn btRssiState;\r\n}\r\nstatic u8 halbtc8723b2ant_WifiRssiState(\r\nPBTC_COEXIST pBtCoexist,\r\nu8 index,\r\nu8 levelNum,\r\nu8 rssiThresh,\r\nu8 rssiThresh1\r\n)\r\n{\r\ns32 wifiRssi = 0;\r\nu8 wifiRssiState = pCoexSta->preWifiRssiState[index];\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_S4_WIFI_RSSI, &wifiRssi);\r\nif (levelNum == 2) {\r\nif (\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW)\r\n) {\r\nif (wifiRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nwifiRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to High\n"));\r\n} else {\r\nwifiRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Low\n"));\r\n}\r\n} else {\r\nif (wifiRssi < rssiThresh) {\r\nwifiRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Low\n"));\r\n} else {\r\nwifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at High\n"));\r\n}\r\n}\r\n} else if (levelNum == 3) {\r\nif (rssiThresh > rssiThresh1) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI thresh error!!\n"));\r\nreturn pCoexSta->preWifiRssiState[index];\r\n}\r\nif (\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW)\r\n) {\r\nif (wifiRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nwifiRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Medium\n"));\r\n} else {\r\nwifiRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Low\n"));\r\n}\r\n} else if (\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_MEDIUM) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_MEDIUM)\r\n) {\r\nif (wifiRssi >= (rssiThresh1+BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\r\nwifiRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to High\n"));\r\n} else if (wifiRssi < rssiThresh) {\r\nwifiRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Low\n"));\r\n} else {\r\nwifiRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Medium\n"));\r\n}\r\n} else {\r\nif (wifiRssi < rssiThresh1) {\r\nwifiRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Medium\n"));\r\n} else {\r\nwifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at High\n"));\r\n}\r\n}\r\n}\r\npCoexSta->preWifiRssiState[index] = wifiRssiState;\r\nreturn wifiRssiState;\r\n}\r\nstatic void halbtc8723b2ant_LimitedRx(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bForceExec,\r\nbool bRejApAggPkt,\r\nbool bBtCtrlAggBufSize,\r\nu8 aggBufSize\r\n)\r\n{\r\nbool bRejectRxAgg = bRejApAggPkt;\r\nbool bBtCtrlRxAggSize = bBtCtrlAggBufSize;\r\nu8 rxAggSize = aggBufSize;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_TO_REJ_AP_AGG_PKT, &bRejectRxAgg);\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_CTRL_AGG_SIZE, &bBtCtrlRxAggSize);\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_U1_AGG_BUF_SIZE, &rxAggSize);\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_AGGREGATE_CTRL, NULL);\r\n}\r\nstatic void halbtc8723b2ant_MonitorBtCtr(PBTC_COEXIST pBtCoexist)\r\n{\r\nu32 regHPTxRx, regLPTxRx, u4Tmp;\r\nu32 regHPTx = 0, regHPRx = 0, regLPTx = 0, regLPRx = 0;\r\nregHPTxRx = 0x770;\r\nregLPTxRx = 0x774;\r\nu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, regHPTxRx);\r\nregHPTx = u4Tmp & bMaskLWord;\r\nregHPRx = (u4Tmp & bMaskHWord)>>16;\r\nu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, regLPTxRx);\r\nregLPTx = u4Tmp & bMaskLWord;\r\nregLPRx = (u4Tmp & bMaskHWord)>>16;\r\npCoexSta->highPriorityTx = regHPTx;\r\npCoexSta->highPriorityRx = regHPRx;\r\npCoexSta->lowPriorityTx = regLPTx;\r\npCoexSta->lowPriorityRx = regLPRx;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_BT_MONITOR,\r\n(\r\n"[BTCoex], High Priority Tx/Rx (reg 0x%x) = 0x%x(%d)/0x%x(%d)\n",\r\nregHPTxRx,\r\nregHPTx,\r\nregHPTx,\r\nregHPRx,\r\nregHPRx\r\n)\r\n);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_BT_MONITOR,\r\n(\r\n"[BTCoex], Low Priority Tx/Rx (reg 0x%x) = 0x%x(%d)/0x%x(%d)\n",\r\nregLPTxRx,\r\nregLPTx,\r\nregLPTx,\r\nregLPRx,\r\nregLPRx\r\n)\r\n);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0xc);\r\n}\r\nstatic void halbtc8723b2ant_QueryBtInfo(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 H2C_Parameter[1] = {0};\r\npCoexSta->bC2hBtInfoReqSent = true;\r\nH2C_Parameter[0] |= BIT0;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n("[BTCoex], Query Bt Info, FW write 0x61 = 0x%x\n", H2C_Parameter[0])\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x61, 1, H2C_Parameter);\r\n}\r\nstatic bool halbtc8723b2ant_IsWifiStatusChanged(PBTC_COEXIST pBtCoexist)\r\n{\r\nstatic bool bPreWifiBusy, bPreUnder4way, bPreBtHsOn;\r\nbool bWifiBusy = false, bUnder4way = false, bBtHsOn = false;\r\nbool bWifiConnected = false;\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_4_WAY_PROGRESS, &bUnder4way);\r\nif (bWifiConnected) {\r\nif (bWifiBusy != bPreWifiBusy) {\r\nbPreWifiBusy = bWifiBusy;\r\nreturn true;\r\n}\r\nif (bUnder4way != bPreUnder4way) {\r\nbPreUnder4way = bUnder4way;\r\nreturn true;\r\n}\r\nif (bBtHsOn != bPreBtHsOn) {\r\nbPreBtHsOn = bBtHsOn;\r\nreturn true;\r\n}\r\n}\r\nreturn false;\r\n}\r\nstatic void halbtc8723b2ant_UpdateBtLinkInfo(PBTC_COEXIST pBtCoexist)\r\n{\r\nPBTC_BT_LINK_INFO pBtLinkInfo = &pBtCoexist->btLinkInfo;\r\nbool bBtHsOn = false;\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npBtLinkInfo->bBtLinkExist = pCoexSta->bBtLinkExist;\r\npBtLinkInfo->bScoExist = pCoexSta->bScoExist;\r\npBtLinkInfo->bA2dpExist = pCoexSta->bA2dpExist;\r\npBtLinkInfo->bPanExist = pCoexSta->bPanExist;\r\npBtLinkInfo->bHidExist = pCoexSta->bHidExist;\r\nif (bBtHsOn) {\r\npBtLinkInfo->bPanExist = true;\r\npBtLinkInfo->bBtLinkExist = true;\r\n}\r\nif (\r\npBtLinkInfo->bScoExist &&\r\n!pBtLinkInfo->bA2dpExist &&\r\n!pBtLinkInfo->bPanExist &&\r\n!pBtLinkInfo->bHidExist\r\n)\r\npBtLinkInfo->bScoOnly = true;\r\nelse\r\npBtLinkInfo->bScoOnly = false;\r\nif (\r\n!pBtLinkInfo->bScoExist &&\r\npBtLinkInfo->bA2dpExist &&\r\n!pBtLinkInfo->bPanExist &&\r\n!pBtLinkInfo->bHidExist\r\n)\r\npBtLinkInfo->bA2dpOnly = true;\r\nelse\r\npBtLinkInfo->bA2dpOnly = false;\r\nif (\r\n!pBtLinkInfo->bScoExist &&\r\n!pBtLinkInfo->bA2dpExist &&\r\npBtLinkInfo->bPanExist &&\r\n!pBtLinkInfo->bHidExist\r\n)\r\npBtLinkInfo->bPanOnly = true;\r\nelse\r\npBtLinkInfo->bPanOnly = false;\r\nif (\r\n!pBtLinkInfo->bScoExist &&\r\n!pBtLinkInfo->bA2dpExist &&\r\n!pBtLinkInfo->bPanExist &&\r\npBtLinkInfo->bHidExist\r\n)\r\npBtLinkInfo->bHidOnly = true;\r\nelse\r\npBtLinkInfo->bHidOnly = false;\r\n}\r\nstatic u8 halbtc8723b2ant_ActionAlgorithm(PBTC_COEXIST pBtCoexist)\r\n{\r\nPBTC_BT_LINK_INFO pBtLinkInfo = &pBtCoexist->btLinkInfo;\r\nbool bBtHsOn = false;\r\nu8 algorithm = BT_8723B_2ANT_COEX_ALGO_UNDEFINED;\r\nu8 numOfDiffProfile = 0;\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\nif (!pBtLinkInfo->bBtLinkExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], No BT link exists!!!\n"));\r\nreturn algorithm;\r\n}\r\nif (pBtLinkInfo->bScoExist)\r\nnumOfDiffProfile++;\r\nif (pBtLinkInfo->bHidExist)\r\nnumOfDiffProfile++;\r\nif (pBtLinkInfo->bPanExist)\r\nnumOfDiffProfile++;\r\nif (pBtLinkInfo->bA2dpExist)\r\nnumOfDiffProfile++;\r\nif (numOfDiffProfile == 1) {\r\nif (pBtLinkInfo->bScoExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO only\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_SCO;\r\n} else {\r\nif (pBtLinkInfo->bHidExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID only\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_HID;\r\n} else if (pBtLinkInfo->bA2dpExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP only\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_A2DP;\r\n} else if (pBtLinkInfo->bPanExist) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN(HS) only\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANHS;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN(EDR) only\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR;\r\n}\r\n}\r\n}\r\n} else if (numOfDiffProfile == 2) {\r\nif (pBtLinkInfo->bScoExist) {\r\nif (pBtLinkInfo->bHidExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n} else if (pBtLinkInfo->bA2dpExist) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP ==> SCO\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n} else if (pBtLinkInfo->bPanExist) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + PAN(HS)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_SCO;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + PAN(EDR)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n} else {\r\nif (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP;\r\n} else if (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bPanExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + PAN(HS)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_HID;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + PAN(EDR)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n} else if (\r\npBtLinkInfo->bPanExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_A2DP_PANHS;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP + PAN(EDR)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_A2DP;\r\n}\r\n}\r\n}\r\n} else if (numOfDiffProfile == 3) {\r\nif (pBtLinkInfo->bScoExist) {\r\nif (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE,\r\n("[BTCoex], SCO + HID + A2DP ==> HID\n")\r\n);\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n} else if (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bPanExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE,\r\n("[BTCoex], SCO + HID + PAN(HS)\n")\r\n);\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n} else {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE,\r\n("[BTCoex], SCO + HID + PAN(EDR)\n")\r\n);\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n} else if (\r\npBtLinkInfo->bPanExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP + PAN(EDR) ==> HID\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n} else {\r\nif (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bPanExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP;\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP + PAN(EDR)\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP_PANEDR;\r\n}\r\n}\r\n}\r\n} else if (numOfDiffProfile >= 3) {\r\nif (pBtLinkInfo->bScoExist) {\r\nif (\r\npBtLinkInfo->bHidExist &&\r\npBtLinkInfo->bPanExist &&\r\npBtLinkInfo->bA2dpExist\r\n) {\r\nif (bBtHsOn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Error!!! SCO + HID + A2DP + PAN(HS)\n"));\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID + A2DP + PAN(EDR) ==>PAN(EDR)+HID\n"));\r\nalgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n}\r\n}\r\nreturn algorithm;\r\n}\r\nstatic void halbtc8723b2ant_SetFwDacSwingLevel(\r\nPBTC_COEXIST pBtCoexist, u8 dacSwingLvl\r\n)\r\n{\r\nu8 H2C_Parameter[1] = {0};\r\nH2C_Parameter[0] = dacSwingLvl;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n("[BTCoex], Set Dac Swing Level = 0x%x\n", dacSwingLvl)\r\n);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n("[BTCoex], FW write 0x64 = 0x%x\n", H2C_Parameter[0])\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x64, 1, H2C_Parameter);\r\n}\r\nstatic void halbtc8723b2ant_SetFwDecBtPwr(\r\nPBTC_COEXIST pBtCoexist, u8 decBtPwrLvl\r\n)\r\n{\r\nu8 H2C_Parameter[1] = {0};\r\nH2C_Parameter[0] = decBtPwrLvl;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n(\r\n"[BTCoex], decrease Bt Power level = %d, FW write 0x62 = 0x%x\n",\r\ndecBtPwrLvl,\r\nH2C_Parameter[0]\r\n)\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x62, 1, H2C_Parameter);\r\n}\r\nstatic void halbtc8723b2ant_DecBtPwr(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, u8 decBtPwrLvl\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW,\r\n(\r\n"[BTCoex], %s Dec BT power level = %d\n",\r\n(bForceExec ? "force to" : ""),\r\ndecBtPwrLvl\r\n)\r\n);\r\npCoexDm->curBtDecPwrLvl = decBtPwrLvl;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], preBtDecPwrLvl =%d, curBtDecPwrLvl =%d\n",\r\npCoexDm->preBtDecPwrLvl,\r\npCoexDm->curBtDecPwrLvl\r\n)\r\n);\r\nif (pCoexDm->preBtDecPwrLvl == pCoexDm->curBtDecPwrLvl)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetFwDecBtPwr(pBtCoexist, pCoexDm->curBtDecPwrLvl);\r\npCoexDm->preBtDecPwrLvl = pCoexDm->curBtDecPwrLvl;\r\n}\r\nstatic void halbtc8723b2ant_FwDacSwingLvl(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, u8 fwDacSwingLvl\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW,\r\n(\r\n"[BTCoex], %s set FW Dac Swing level = %d\n",\r\n(bForceExec ? "force to" : ""),\r\nfwDacSwingLvl\r\n)\r\n);\r\npCoexDm->curFwDacSwingLvl = fwDacSwingLvl;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], preFwDacSwingLvl =%d, curFwDacSwingLvl =%d\n",\r\npCoexDm->preFwDacSwingLvl,\r\npCoexDm->curFwDacSwingLvl\r\n)\r\n);\r\nif (pCoexDm->preFwDacSwingLvl == pCoexDm->curFwDacSwingLvl)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetFwDacSwingLevel(pBtCoexist, pCoexDm->curFwDacSwingLvl);\r\npCoexDm->preFwDacSwingLvl = pCoexDm->curFwDacSwingLvl;\r\n}\r\nstatic void halbtc8723b2ant_SetSwRfRxLpfCorner(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bRxRfShrinkOn\r\n)\r\n{\r\nif (bRxRfShrinkOn) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], Shrink RF Rx LPF corner!!\n")\r\n);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, 0xffffc);\r\n} else {\r\nif (pBtCoexist->bInitilized) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Resume RF Rx LPF corner!!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, pCoexDm->btRf0x1eBackup);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_RfShrink(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, bool bRxRfShrinkOn\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW,\r\n(\r\n"[BTCoex], %s turn Rx RF Shrink = %s\n",\r\n(bForceExec ? "force to" : ""),\r\n(bRxRfShrinkOn ? "ON" : "OFF")\r\n)\r\n);\r\npCoexDm->bCurRfRxLpfShrink = bRxRfShrinkOn;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], bPreRfRxLpfShrink =%d, bCurRfRxLpfShrink =%d\n",\r\npCoexDm->bPreRfRxLpfShrink,\r\npCoexDm->bCurRfRxLpfShrink\r\n)\r\n);\r\nif (pCoexDm->bPreRfRxLpfShrink == pCoexDm->bCurRfRxLpfShrink)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetSwRfRxLpfCorner(pBtCoexist, pCoexDm->bCurRfRxLpfShrink);\r\npCoexDm->bPreRfRxLpfShrink = pCoexDm->bCurRfRxLpfShrink;\r\n}\r\nstatic void halbtc8723b2ant_SetSwPenaltyTxRateAdaptive(\r\nPBTC_COEXIST pBtCoexist, bool bLowPenaltyRa\r\n)\r\n{\r\nu8 H2C_Parameter[6] = {0};\r\nH2C_Parameter[0] = 0x6;\r\nif (bLowPenaltyRa) {\r\nH2C_Parameter[1] |= BIT0;\r\nH2C_Parameter[2] = 0x00;\r\nH2C_Parameter[3] = 0xf7;\r\nH2C_Parameter[4] = 0xf8;\r\nH2C_Parameter[5] = 0xf9;\r\n}\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n(\r\n"[BTCoex], set WiFi Low-Penalty Retry: %s",\r\n(bLowPenaltyRa ? "ON!!" : "OFF!!")\r\n)\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x69, 6, H2C_Parameter);\r\n}\r\nstatic void halbtc8723b2ant_LowPenaltyRa(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, bool bLowPenaltyRa\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW,\r\n(\r\n"[BTCoex], %s turn LowPenaltyRA = %s\n",\r\n(bForceExec ? "force to" : ""),\r\n(bLowPenaltyRa ? "ON" : "OFF")\r\n)\r\n);\r\npCoexDm->bCurLowPenaltyRa = bLowPenaltyRa;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], bPreLowPenaltyRa =%d, bCurLowPenaltyRa =%d\n",\r\npCoexDm->bPreLowPenaltyRa,\r\npCoexDm->bCurLowPenaltyRa\r\n)\r\n);\r\nif (pCoexDm->bPreLowPenaltyRa == pCoexDm->bCurLowPenaltyRa)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetSwPenaltyTxRateAdaptive(pBtCoexist, pCoexDm->bCurLowPenaltyRa);\r\npCoexDm->bPreLowPenaltyRa = pCoexDm->bCurLowPenaltyRa;\r\n}\r\nstatic void halbtc8723b2ant_SetDacSwingReg(PBTC_COEXIST pBtCoexist, u32 level)\r\n{\r\nu8 val = (u8)level;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], Write SwDacSwing = 0x%x\n", level)\r\n);\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x883, 0x3e, val);\r\n}\r\nstatic void halbtc8723b2ant_SetSwFullTimeDacSwing(\r\nPBTC_COEXIST pBtCoexist, bool bSwDacSwingOn, u32 swDacSwingLvl\r\n)\r\n{\r\nif (bSwDacSwingOn)\r\nhalbtc8723b2ant_SetDacSwingReg(pBtCoexist, swDacSwingLvl);\r\nelse\r\nhalbtc8723b2ant_SetDacSwingReg(pBtCoexist, 0x18);\r\n}\r\nstatic void halbtc8723b2ant_DacSwing(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bForceExec,\r\nbool bDacSwingOn,\r\nu32 dacSwingLvl\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW,\r\n(\r\n"[BTCoex], %s turn DacSwing =%s, dacSwingLvl = 0x%x\n",\r\n(bForceExec ? "force to" : ""),\r\n(bDacSwingOn ? "ON" : "OFF"),\r\ndacSwingLvl\r\n)\r\n);\r\npCoexDm->bCurDacSwingOn = bDacSwingOn;\r\npCoexDm->curDacSwingLvl = dacSwingLvl;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], bPreDacSwingOn =%d, preDacSwingLvl = 0x%x, bCurDacSwingOn =%d, curDacSwingLvl = 0x%x\n",\r\npCoexDm->bPreDacSwingOn,\r\npCoexDm->preDacSwingLvl,\r\npCoexDm->bCurDacSwingOn,\r\npCoexDm->curDacSwingLvl\r\n)\r\n);\r\nif ((pCoexDm->bPreDacSwingOn == pCoexDm->bCurDacSwingOn) &&\r\n(pCoexDm->preDacSwingLvl == pCoexDm->curDacSwingLvl))\r\nreturn;\r\n}\r\nmdelay(30);\r\nhalbtc8723b2ant_SetSwFullTimeDacSwing(pBtCoexist, bDacSwingOn, dacSwingLvl);\r\npCoexDm->bPreDacSwingOn = pCoexDm->bCurDacSwingOn;\r\npCoexDm->preDacSwingLvl = pCoexDm->curDacSwingLvl;\r\n}\r\nstatic void halbtc8723b2ant_SetAgcTable(\r\nPBTC_COEXIST pBtCoexist, bool bAgcTableEn\r\n)\r\n{\r\nu8 rssiAdjustVal = 0;\r\nif (bAgcTableEn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], BB Agc Table On!\n"));\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6e1A0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6d1B0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6c1C0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6b1D0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6a1E0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x691F0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x68200001);\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], BB Agc Table Off!\n"));\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xaa1A0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa91B0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa81C0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa71D0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa61E0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa51F0001);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa4200001);\r\n}\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xef, 0xfffff, 0x02000);\r\nif (bAgcTableEn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table On!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x38fff);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x38ffe);\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table Off!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x380c3);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x28ce6);\r\n}\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xef, 0xfffff, 0x0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xed, 0xfffff, 0x1);\r\nif (bAgcTableEn) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table On!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x38fff);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x38ffe);\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table Off!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x380c3);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x28ce6);\r\n}\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xed, 0xfffff, 0x0);\r\nif (bAgcTableEn)\r\nrssiAdjustVal = 8;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_U1_RSSI_ADJ_VAL_FOR_AGC_TABLE_ON, &rssiAdjustVal);\r\n}\r\nstatic void halbtc8723b2ant_AgcTable(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, bool bAgcTableEn\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW,\r\n(\r\n"[BTCoex], %s %s Agc Table\n",\r\n(bForceExec ? "force to" : ""),\r\n(bAgcTableEn ? "Enable" : "Disable")\r\n)\r\n);\r\npCoexDm->bCurAgcTableEn = bAgcTableEn;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], bPreAgcTableEn =%d, bCurAgcTableEn =%d\n",\r\npCoexDm->bPreAgcTableEn,\r\npCoexDm->bCurAgcTableEn\r\n)\r\n);\r\nif (pCoexDm->bPreAgcTableEn == pCoexDm->bCurAgcTableEn)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetAgcTable(pBtCoexist, bAgcTableEn);\r\npCoexDm->bPreAgcTableEn = pCoexDm->bCurAgcTableEn;\r\n}\r\nstatic void halbtc8723b2ant_SetCoexTable(\r\nPBTC_COEXIST pBtCoexist,\r\nu32 val0x6c0,\r\nu32 val0x6c4,\r\nu32 val0x6c8,\r\nu8 val0x6cc\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], set coex table, set 0x6c0 = 0x%x\n", val0x6c0)\r\n);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c0, val0x6c0);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], set coex table, set 0x6c4 = 0x%x\n", val0x6c4)\r\n);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c4, val0x6c4);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], set coex table, set 0x6c8 = 0x%x\n", val0x6c8)\r\n);\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c8, val0x6c8);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_EXEC,\r\n("[BTCoex], set coex table, set 0x6cc = 0x%x\n", val0x6cc)\r\n);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x6cc, val0x6cc);\r\n}\r\nstatic void halbtc8723b2ant_CoexTable(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bForceExec,\r\nu32 val0x6c0,\r\nu32 val0x6c4,\r\nu32 val0x6c8,\r\nu8 val0x6cc\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW,\r\n(\r\n"[BTCoex], %s write Coex Table 0x6c0 = 0x%x, 0x6c4 = 0x%x, 0x6c8 = 0x%x, 0x6cc = 0x%x\n",\r\n(bForceExec ? "force to" : ""),\r\nval0x6c0,\r\nval0x6c4,\r\nval0x6c8,\r\nval0x6cc\r\n)\r\n);\r\npCoexDm->curVal0x6c0 = val0x6c0;\r\npCoexDm->curVal0x6c4 = val0x6c4;\r\npCoexDm->curVal0x6c8 = val0x6c8;\r\npCoexDm->curVal0x6cc = val0x6cc;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], preVal0x6c0 = 0x%x, preVal0x6c4 = 0x%x, preVal0x6c8 = 0x%x, preVal0x6cc = 0x%x !!\n",\r\npCoexDm->preVal0x6c0,\r\npCoexDm->preVal0x6c4,\r\npCoexDm->preVal0x6c8,\r\npCoexDm->preVal0x6cc\r\n)\r\n);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_SW_DETAIL,\r\n(\r\n"[BTCoex], curVal0x6c0 = 0x%x, curVal0x6c4 = 0x%x, curVal0x6c8 = 0x%x, curVal0x6cc = 0x%x !!\n",\r\npCoexDm->curVal0x6c0,\r\npCoexDm->curVal0x6c4,\r\npCoexDm->curVal0x6c8,\r\npCoexDm->curVal0x6cc\r\n)\r\n);\r\nif (\r\n(pCoexDm->preVal0x6c0 == pCoexDm->curVal0x6c0) &&\r\n(pCoexDm->preVal0x6c4 == pCoexDm->curVal0x6c4) &&\r\n(pCoexDm->preVal0x6c8 == pCoexDm->curVal0x6c8) &&\r\n(pCoexDm->preVal0x6cc == pCoexDm->curVal0x6cc)\r\n)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetCoexTable(pBtCoexist, val0x6c0, val0x6c4, val0x6c8, val0x6cc);\r\npCoexDm->preVal0x6c0 = pCoexDm->curVal0x6c0;\r\npCoexDm->preVal0x6c4 = pCoexDm->curVal0x6c4;\r\npCoexDm->preVal0x6c8 = pCoexDm->curVal0x6c8;\r\npCoexDm->preVal0x6cc = pCoexDm->curVal0x6cc;\r\n}\r\nstatic void halbtc8723b2ant_CoexTableWithType(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, u8 type\r\n)\r\n{\r\nswitch (type) {\r\ncase 0:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55555555, 0x55555555, 0xffff, 0x3);\r\nbreak;\r\ncase 1:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55555555, 0x5afa5afa, 0xffff, 0x3);\r\nbreak;\r\ncase 2:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5a5a5a5a, 0x5a5a5a5a, 0xffff, 0x3);\r\nbreak;\r\ncase 3:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0xaaaaaaaa, 0xaaaaaaaa, 0xffff, 0x3);\r\nbreak;\r\ncase 4:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0xffffffff, 0xffffffff, 0xffff, 0x3);\r\nbreak;\r\ncase 5:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5fff5fff, 0x5fff5fff, 0xffff, 0x3);\r\nbreak;\r\ncase 6:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5a5a5a5a, 0xffff, 0x3);\r\nbreak;\r\ncase 7:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0xfafafafa, 0xffff, 0x3);\r\nbreak;\r\ncase 8:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5aea5aea, 0x5aea5aea, 0xffff, 0x3);\r\nbreak;\r\ncase 9:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5aea5aea, 0xffff, 0x3);\r\nbreak;\r\ncase 10:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5aff5aff, 0xffff, 0x3);\r\nbreak;\r\ncase 11:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5a5f5a5f, 0xffff, 0x3);\r\nbreak;\r\ncase 12:\r\nhalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5f5f5f5f, 0xffff, 0x3);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nstatic void halbtc8723b2ant_SetFwIgnoreWlanAct(\r\nPBTC_COEXIST pBtCoexist, bool bEnable\r\n)\r\n{\r\nu8 H2C_Parameter[1] = {0};\r\nif (bEnable)\r\nH2C_Parameter[0] |= BIT0;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n(\r\n"[BTCoex], set FW for BT Ignore Wlan_Act, FW write 0x63 = 0x%x\n",\r\nH2C_Parameter[0]\r\n)\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x63, 1, H2C_Parameter);\r\n}\r\nstatic void halbtc8723b2ant_IgnoreWlanAct(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, bool bEnable\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW,\r\n(\r\n"[BTCoex], %s turn Ignore WlanAct %s\n",\r\n(bForceExec ? "force to" : ""),\r\n(bEnable ? "ON" : "OFF")\r\n)\r\n);\r\npCoexDm->bCurIgnoreWlanAct = bEnable;\r\nif (!bForceExec) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], bPreIgnoreWlanAct = %d, bCurIgnoreWlanAct = %d!!\n",\r\npCoexDm->bPreIgnoreWlanAct, pCoexDm->bCurIgnoreWlanAct));\r\nif (pCoexDm->bPreIgnoreWlanAct == pCoexDm->bCurIgnoreWlanAct)\r\nreturn;\r\n}\r\nhalbtc8723b2ant_SetFwIgnoreWlanAct(pBtCoexist, bEnable);\r\npCoexDm->bPreIgnoreWlanAct = pCoexDm->bCurIgnoreWlanAct;\r\n}\r\nstatic void halbtc8723b2ant_SetFwPstdma(\r\nPBTC_COEXIST pBtCoexist,\r\nu8 byte1,\r\nu8 byte2,\r\nu8 byte3,\r\nu8 byte4,\r\nu8 byte5\r\n)\r\n{\r\nu8 H2C_Parameter[5] = {0};\r\nH2C_Parameter[0] = byte1;\r\nH2C_Parameter[1] = byte2;\r\nH2C_Parameter[2] = byte3;\r\nH2C_Parameter[3] = byte4;\r\nH2C_Parameter[4] = byte5;\r\npCoexDm->psTdmaPara[0] = byte1;\r\npCoexDm->psTdmaPara[1] = byte2;\r\npCoexDm->psTdmaPara[2] = byte3;\r\npCoexDm->psTdmaPara[3] = byte4;\r\npCoexDm->psTdmaPara[4] = byte5;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n(\r\n"[BTCoex], FW write 0x60(5bytes) = 0x%x%08x\n",\r\nH2C_Parameter[0],\r\nH2C_Parameter[1]<<24|\r\nH2C_Parameter[2]<<16|\r\nH2C_Parameter[3]<<8|\r\nH2C_Parameter[4]\r\n)\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x60, 5, H2C_Parameter);\r\n}\r\nstatic void halbtc8723b2ant_SwMechanism1(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bShrinkRxLPF,\r\nbool bLowPenaltyRA,\r\nbool bLimitedDIG,\r\nbool bBTLNAConstrain\r\n)\r\n{\r\nhalbtc8723b2ant_RfShrink(pBtCoexist, NORMAL_EXEC, bShrinkRxLPF);\r\nhalbtc8723b2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, bLowPenaltyRA);\r\n}\r\nstatic void halbtc8723b2ant_SwMechanism2(\r\nPBTC_COEXIST pBtCoexist,\r\nbool bAGCTableShift,\r\nbool bADCBackOff,\r\nbool bSWDACSwing,\r\nu32 dacSwingLvl\r\n)\r\n{\r\nhalbtc8723b2ant_AgcTable(pBtCoexist, NORMAL_EXEC, bAGCTableShift);\r\nhalbtc8723b2ant_DacSwing(pBtCoexist, NORMAL_EXEC, bSWDACSwing, dacSwingLvl);\r\n}\r\nstatic void halbtc8723b2ant_SetAntPath(\r\nPBTC_COEXIST pBtCoexist, u8 antPosType, bool bInitHwCfg, bool bWifiOff\r\n)\r\n{\r\nPBTC_BOARD_INFO pBoardInfo = &pBtCoexist->boardInfo;\r\nu32 fwVer = 0, u4Tmp = 0;\r\nbool bPgExtSwitch = false;\r\nbool bUseExtSwitch = false;\r\nu8 H2C_Parameter[2] = {0};\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_EXT_SWITCH, &bPgExtSwitch);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\r\nif ((fwVer > 0 && fwVer < 0xc0000) || bPgExtSwitch)\r\nbUseExtSwitch = true;\r\nif (bInitHwCfg) {\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x39, 0x8, 0x1);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x974, 0xff);\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x944, 0x3, 0x3);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x930, 0x77);\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x1);\r\nif (fwVer >= 0x180000) {\r\nH2C_Parameter[0] = 0;\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x6E, 1, H2C_Parameter);\r\n} else {\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x0);\r\n}\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\npBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x01);\r\nif (pBoardInfo->btdmAntPos == BTC_ANTENNA_AT_MAIN_PORT) {\r\nH2C_Parameter[0] = 0;\r\n} else {\r\nH2C_Parameter[0] = 1;\r\n}\r\nif (bUseExtSwitch) {\r\nH2C_Parameter[1] = 1;\r\n} else {\r\nH2C_Parameter[1] = 0;\r\n}\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x65, 2, H2C_Parameter);\r\n}\r\nif (bUseExtSwitch) {\r\nif (bInitHwCfg) {\r\nu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x4c);\r\nu4Tmp &= ~BIT23;\r\nu4Tmp |= BIT24;\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x4c, u4Tmp);\r\n}\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\r\nswitch (antPosType) {\r\ncase BTC_ANT_WIFI_AT_MAIN:\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x92c, 0x3, 0x1);\r\nbreak;\r\ncase BTC_ANT_WIFI_AT_AUX:\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x92c, 0x3, 0x2);\r\nbreak;\r\n}\r\n} else {\r\nif (bInitHwCfg) {\r\nu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x4c);\r\nu4Tmp |= BIT23;\r\nu4Tmp &= ~BIT24;\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x4c, u4Tmp);\r\n}\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x64, 0x1, 0x0);\r\nswitch (antPosType) {\r\ncase BTC_ANT_WIFI_AT_MAIN:\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\r\nbreak;\r\ncase BTC_ANT_WIFI_AT_AUX:\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x280);\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_PsTdma(\r\nPBTC_COEXIST pBtCoexist, bool bForceExec, bool bTurnOn, u8 type\r\n)\r\n{\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW,\r\n(\r\n"[BTCoex], %s turn %s PS TDMA, type =%d\n",\r\n(bForceExec ? "force to" : ""),\r\n(bTurnOn ? "ON" : "OFF"),\r\ntype\r\n)\r\n);\r\npCoexDm->bCurPsTdmaOn = bTurnOn;\r\npCoexDm->curPsTdma = type;\r\nif (!bForceExec) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], bPrePsTdmaOn = %d, bCurPsTdmaOn = %d!!\n",\r\npCoexDm->bPrePsTdmaOn,\r\npCoexDm->bCurPsTdmaOn\r\n)\r\n);\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], prePsTdma = %d, curPsTdma = %d!!\n",\r\npCoexDm->prePsTdma, pCoexDm->curPsTdma\r\n)\r\n);\r\nif (\r\n(pCoexDm->bPrePsTdmaOn == pCoexDm->bCurPsTdmaOn) &&\r\n(pCoexDm->prePsTdma == pCoexDm->curPsTdma)\r\n)\r\nreturn;\r\n}\r\nif (bTurnOn) {\r\nswitch (type) {\r\ncase 1:\r\ndefault:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\r\nbreak;\r\ncase 2:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x90);\r\nbreak;\r\ncase 3:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1c, 0x3, 0xf1, 0x90);\r\nbreak;\r\ncase 4:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x10, 0x03, 0xf1, 0x90);\r\nbreak;\r\ncase 5:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x90);\r\nbreak;\r\ncase 6:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x90);\r\nbreak;\r\ncase 7:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1c, 0x3, 0x70, 0x90);\r\nbreak;\r\ncase 8:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x10, 0x3, 0x70, 0x90);\r\nbreak;\r\ncase 9:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\r\nbreak;\r\ncase 10:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x90);\r\nbreak;\r\ncase 11:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0xe1, 0x90);\r\nbreak;\r\ncase 12:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x90);\r\nbreak;\r\ncase 13:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x90);\r\nbreak;\r\ncase 14:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x90);\r\nbreak;\r\ncase 15:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0x60, 0x90);\r\nbreak;\r\ncase 16:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0x60, 0x90);\r\nbreak;\r\ncase 17:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x2f, 0x2f, 0x60, 0x90);\r\nbreak;\r\ncase 18:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x90);\r\nbreak;\r\ncase 19:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0xe1, 0x90);\r\nbreak;\r\ncase 20:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0x60, 0x90);\r\nbreak;\r\ncase 21:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x15, 0x03, 0x70, 0x90);\r\nbreak;\r\ncase 71:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\r\nbreak;\r\n}\r\n} else {\r\nswitch (type) {\r\ncase 0:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x40, 0x0);\r\nbreak;\r\ncase 1:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x48, 0x0);\r\nbreak;\r\ndefault:\r\nhalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x40, 0x0);\r\nbreak;\r\n}\r\n}\r\npCoexDm->bPrePsTdmaOn = pCoexDm->bCurPsTdmaOn;\r\npCoexDm->prePsTdma = pCoexDm->curPsTdma;\r\n}\r\nstatic void halbtc8723b2ant_CoexAllOff(PBTC_COEXIST pBtCoexist)\r\n{\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\n}\r\nstatic void halbtc8723b2ant_InitCoexDm(PBTC_COEXIST pBtCoexist)\r\n{\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, FORCE_EXEC, false, 1);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, FORCE_EXEC, 6);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, FORCE_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\nstatic void halbtc8723b2ant_ActionBtInquiry(PBTC_COEXIST pBtCoexist)\r\n{\r\nbool bWifiConnected = false;\r\nbool bLowPwrDisable = true;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\nif (bWifiConnected) {\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\n} else {\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\n}\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, FORCE_EXEC, 6);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\npCoexDm->bNeedRecover0x948 = true;\r\npCoexDm->backup0x948 = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x948);\r\nhalbtc8723b2ant_SetAntPath(pBtCoexist, BTC_ANT_WIFI_AT_AUX, false, false);\r\n}\r\nstatic bool halbtc8723b2ant_IsCommonAction(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 btRssiState = BTC_RSSI_STATE_HIGH;\r\nbool bCommon = false, bWifiConnected = false, bWifiBusy = false;\r\nbool bBtHsOn = false, bLowPwrDisable = false;\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\r\nif (!bWifiConnected) {\r\nbLowPwrDisable = false;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi non-connected idle!!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\nbCommon = true;\r\n} else {\r\nif (BT_8723B_2ANT_BT_STATUS_NON_CONNECTED_IDLE == pCoexDm->btStatus) {\r\nbLowPwrDisable = false;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi connected + BT non connected-idle!!\n"));\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\nbCommon = true;\r\n} else if (BT_8723B_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus) {\r\nbLowPwrDisable = true;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\nif (bBtHsOn)\r\nreturn false;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi connected + BT connected-idle!!\n"));\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\nbCommon = true;\r\n} else {\r\nbLowPwrDisable = true;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\nif (bWifiBusy) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi Connected-Busy + BT Busy!!\n"));\r\nbCommon = false;\r\n} else {\r\nif (bBtHsOn)\r\nreturn false;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi Connected-Idle + BT Busy!!\n"));\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 21);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\nbCommon = true;\r\n}\r\n}\r\n}\r\nreturn bCommon;\r\n}\r\nstatic void halbtc8723b2ant_TdmaDurationAdjust(\r\nPBTC_COEXIST pBtCoexist, bool bScoHid, bool bTxPause, u8 maxInterval\r\n)\r\n{\r\nstatic s32 up, dn, m, n, WaitCount;\r\ns32 result;\r\nu8 retryCount = 0;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], TdmaDurationAdjust()\n"));\r\nif (!pCoexDm->bAutoTdmaAdjust) {\r\npCoexDm->bAutoTdmaAdjust = true;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], first run TdmaDurationAdjust()!!\n"));\r\n{\r\nif (bScoHid) {\r\nif (bTxPause) {\r\nif (maxInterval == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n} else if (maxInterval == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (maxInterval == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\n} else {\r\nif (maxInterval == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n} else if (maxInterval == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (maxInterval == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\n}\r\n} else {\r\nif (bTxPause) {\r\nif (maxInterval == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n} else if (maxInterval == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (maxInterval == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\n} else {\r\nif (maxInterval == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n} else if (maxInterval == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (maxInterval == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\n}\r\n}\r\n}\r\nup = 0;\r\ndn = 0;\r\nm = 1;\r\nn = 3;\r\nresult = 0;\r\nWaitCount = 0;\r\n} else {\r\nretryCount = pCoexSta->btRetryCnt;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], retryCount = %d\n", retryCount));\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], up =%d, dn =%d, m =%d, n =%d, WaitCount =%d\n",\r\nup, dn, m, n, WaitCount\r\n)\r\n);\r\nresult = 0;\r\nWaitCount++;\r\nif (retryCount == 0) {\r\nup++;\r\ndn--;\r\nif (dn <= 0)\r\ndn = 0;\r\nif (up >= n) {\r\nWaitCount = 0;\r\nn = 3;\r\nup = 0;\r\ndn = 0;\r\nresult = 1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Increase wifi duration!!\n"));\r\n}\r\n} else if (retryCount <= 3) {\r\nup--;\r\ndn++;\r\nif (up <= 0)\r\nup = 0;\r\nif (dn == 2) {\r\nif (WaitCount <= 2)\r\nm++;\r\nelse\r\nm = 1;\r\nif (m >= 20)\r\nm = 20;\r\nn = 3*m;\r\nup = 0;\r\ndn = 0;\r\nWaitCount = 0;\r\nresult = -1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Decrease wifi duration for retryCounter<3!!\n"));\r\n}\r\n} else {\r\nif (WaitCount == 1)\r\nm++;\r\nelse\r\nm = 1;\r\nif (m >= 20)\r\nm = 20;\r\nn = 3*m;\r\nup = 0;\r\ndn = 0;\r\nWaitCount = 0;\r\nresult = -1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Decrease wifi duration for retryCounter>3!!\n"));\r\n}\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], max Interval = %d\n", maxInterval));\r\nif (maxInterval == 1) {\r\nif (bTxPause) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif (pCoexDm->curPsTdma == 71) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n} else if (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n} else if (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n}\r\n}\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 71);\r\npCoexDm->psTdmaDuAdjType = 71;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 71) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n} else if (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n} else if (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n} else if (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 71);\r\npCoexDm->psTdmaDuAdjType = 71;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n}\r\n}\r\n}\r\n} else if (maxInterval == 2) {\r\nif (bTxPause) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n} else if (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\n}\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n} else if (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\n}\r\n}\r\n} else if (maxInterval == 3) {\r\nif (bTxPause) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n} else if (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\n}\r\n} else {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif (pCoexDm->curPsTdma == 5) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 6) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 7) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 8) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif (pCoexDm->curPsTdma == 13) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 14) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 15) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 16) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif (result == -1) {\r\nif (pCoexDm->curPsTdma == 1) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n} else if (pCoexDm->curPsTdma == 9) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n} else if (result == 1) {\r\nif (pCoexDm->curPsTdma == 4) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 3) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 2) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n} else if (pCoexDm->curPsTdma == 12) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 11) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n} else if (pCoexDm->curPsTdma == 10) {\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\n}\r\n}\r\n}\r\n}\r\nif (pCoexDm->curPsTdma != pCoexDm->psTdmaDuAdjType) {\r\nbool bScan = false, bLink = false, bRoam = false;\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_DETAIL,\r\n(\r\n"[BTCoex], PsTdma type dismatch!!!, curPsTdma =%d, recordPsTdma =%d\n",\r\npCoexDm->curPsTdma,\r\npCoexDm->psTdmaDuAdjType\r\n)\r\n);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\r\nif (!bScan && !bLink && !bRoam)\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, pCoexDm->psTdmaDuAdjType);\r\nelse {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], roaming/link/scan is under progress, will adjust next time!!!\n"));\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionSco(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 4);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_LEGACY == wifiBw)\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 8);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 0);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x4);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, true, 0x4);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x4);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, true, 0x4);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionHid(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_LEGACY == wifiBw)\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nelse\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 9);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n)\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\nelse\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionA2dp(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, wifiRssiState1, btRssiState;\r\nu32 wifiBw;\r\nu8 apNum = 0;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nwifiRssiState1 = halbtc8723b2ant_WifiRssiState(pBtCoexist, 1, 2, 40, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\r\nif (apNum >= 10 && BTC_RSSI_HIGH(wifiRssiState1)) {\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x18);\r\n}\r\nreturn;\r\n}\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n)\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, false, 1);\r\nelse\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 1);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionA2dpPanHs(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 2);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionPanEdr(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 10);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n)\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\nelse\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionPanHs(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nhalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionPanEdrA2dp(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 12);\r\nif (BTC_WIFI_BW_HT40 == wifiBw)\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 3);\r\nelse\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, false, 3);\r\n} else {\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 3);\r\n}\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionPanEdrHid(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 3);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 11);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x780);\r\n} else {\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\n}\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 2);\r\n} else {\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 11);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\r\n}\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionHidA2dpPanEdr(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nif (BTC_WIFI_BW_HT40 == wifiBw)\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\r\nelse\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 3);\r\n} else\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 3);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_ActionHidA2dp(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 wifiRssiState, btRssiState;\r\nu32 wifiBw;\r\nu8 apNum = 0;\r\nwifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\r\nbtRssiState = halbtc8723b2ant_BtRssiState(3, 29, 37);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\r\nhalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, true, 0x5);\r\nhalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_LEGACY == wifiBw) {\r\nif (BTC_RSSI_HIGH(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse if (BTC_RSSI_MEDIUM(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\n} else {\r\nif (BTC_RSSI_HIGH(btRssiState)) {\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\r\nif (apNum < 10)\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 4);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\n} else if (BTC_RSSI_MEDIUM(btRssiState))\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\r\nelse\r\nhalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\r\n}\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\r\nif (\r\n(btRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n)\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 2);\r\nelse\r\nhalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\r\nif (BTC_WIFI_BW_HT40 == wifiBw) {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n} else {\r\nif (\r\n(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\r\n) {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\r\n} else {\r\nhalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\r\nhalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\r\n}\r\n}\r\n}\r\nstatic void halbtc8723b2ant_RunCoexistMechanism(PBTC_COEXIST pBtCoexist)\r\n{\r\nu8 algorithm = 0;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], RunCoexistMechanism() ===>\n"));\r\nif (pBtCoexist->bManualControl) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], RunCoexistMechanism(), return for Manual CTRL <===\n"));\r\nreturn;\r\n}\r\nif (pCoexSta->bUnderIps) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], wifi is under IPS !!!\n"));\r\nreturn;\r\n}\r\nalgorithm = halbtc8723b2ant_ActionAlgorithm(pBtCoexist);\r\nif (pCoexSta->bC2hBtInquiryPage && (BT_8723B_2ANT_COEX_ALGO_PANHS != algorithm)) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BT is under inquiry/page scan !!\n"));\r\nhalbtc8723b2ant_ActionBtInquiry(pBtCoexist);\r\nreturn;\r\n} else {\r\nif (pCoexDm->bNeedRecover0x948) {\r\npCoexDm->bNeedRecover0x948 = false;\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, pCoexDm->backup0x948);\r\n}\r\n}\r\npCoexDm->curAlgorithm = algorithm;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Algorithm = %d\n", pCoexDm->curAlgorithm));\r\nif (halbtc8723b2ant_IsCommonAction(pBtCoexist)) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant common.\n"));\r\npCoexDm->bAutoTdmaAdjust = false;\r\n} else {\r\nif (pCoexDm->curAlgorithm != pCoexDm->preAlgorithm) {\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE,\r\n(\r\n"[BTCoex], preAlgorithm =%d, curAlgorithm =%d\n",\r\npCoexDm->preAlgorithm,\r\npCoexDm->curAlgorithm\r\n)\r\n);\r\npCoexDm->bAutoTdmaAdjust = false;\r\n}\r\nswitch (pCoexDm->curAlgorithm) {\r\ncase BT_8723B_2ANT_COEX_ALGO_SCO:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = SCO.\n"));\r\nhalbtc8723b2ant_ActionSco(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_HID:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID.\n"));\r\nhalbtc8723b2ant_ActionHid(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = A2DP.\n"));\r\nhalbtc8723b2ant_ActionA2dp(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_A2DP_PANHS:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = A2DP+PAN(HS).\n"));\r\nhalbtc8723b2ant_ActionA2dpPanHs(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_PANEDR:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN(EDR).\n"));\r\nhalbtc8723b2ant_ActionPanEdr(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_PANHS:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HS mode.\n"));\r\nhalbtc8723b2ant_ActionPanHs(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_PANEDR_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN+A2DP.\n"));\r\nhalbtc8723b2ant_ActionPanEdrA2dp(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_PANEDR_HID:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN(EDR)+HID.\n"));\r\nhalbtc8723b2ant_ActionPanEdrHid(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_HID_A2DP_PANEDR:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID+A2DP+PAN.\n"));\r\nhalbtc8723b2ant_ActionHidA2dpPanEdr(pBtCoexist);\r\nbreak;\r\ncase BT_8723B_2ANT_COEX_ALGO_HID_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID+A2DP.\n"));\r\nhalbtc8723b2ant_ActionHidA2dp(pBtCoexist);\r\nbreak;\r\ndefault:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = coexist All Off!!\n"));\r\nhalbtc8723b2ant_CoexAllOff(pBtCoexist);\r\nbreak;\r\n}\r\npCoexDm->preAlgorithm = pCoexDm->curAlgorithm;\r\n}\r\n}\r\nstatic void halbtc8723b2ant_WifiOffHwCfg(PBTC_COEXIST pBtCoexist)\r\n{\r\nbool bIsInMpMode = false;\r\nu8 H2C_Parameter[2] = {0};\r\nu32 fwVer = 0;\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0x4);\r\npBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x780);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\r\nif (fwVer >= 0x180000) {\r\nH2C_Parameter[0] = 1;\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x6E, 1, H2C_Parameter);\r\n} else\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x18);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_IS_IN_MP_MODE, &bIsInMpMode);\r\nif (!bIsInMpMode)\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x0);\r\nelse\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x1);\r\n}\r\nstatic void halbtc8723b2ant_InitHwConfig(PBTC_COEXIST pBtCoexist, bool bBackUp)\r\n{\r\nu8 u1Tmp = 0;\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], 2Ant Init HW Config!!\n"));\r\npCoexDm->btRf0x1eBackup =\r\npBtCoexist->fBtcGetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff);\r\nu1Tmp = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x790);\r\nu1Tmp &= 0xc0;\r\nu1Tmp |= 0x5;\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x790, u1Tmp);\r\nhalbtc8723b2ant_SetAntPath(pBtCoexist, BTC_ANT_WIFI_AT_MAIN, true, false);\r\nhalbtc8723b2ant_CoexTableWithType(pBtCoexist, FORCE_EXEC, 0);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0xc);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x778, 0x3);\r\npBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x40, 0x20, 0x1);\r\n}\r\nvoid EXhalbtc8723b2ant_PowerOnSetting(PBTC_COEXIST pBtCoexist)\r\n{\r\nPBTC_BOARD_INFO pBoardInfo = &pBtCoexist->boardInfo;\r\nu8 u1Tmp = 0x4;\r\nu16 u2Tmp = 0x0;\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x67, 0x20);\r\nu2Tmp = pBtCoexist->fBtcRead2Byte(pBtCoexist, 0x2);\r\npBtCoexist->fBtcWrite2Byte(pBtCoexist, 0x2, u2Tmp|BIT0|BIT1);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x18);\r\npBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0x4);\r\nif (pBtCoexist->chipInterface == BTC_INTF_USB) {\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\r\nu1Tmp |= 0x1;\r\npBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0xfe08, u1Tmp);\r\npBoardInfo->btdmAntPos = BTC_ANTENNA_AT_AUX_PORT;\r\n} else {\r\nif (pBoardInfo->singleAntPath == 0) {\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x280);\r\npBoardInfo->btdmAntPos = BTC_ANTENNA_AT_MAIN_PORT;\r\n} else if (pBoardInfo->singleAntPath == 1) {\r\npBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\r\nu1Tmp |= 0x1;\r\npBoardInfo->btdmAntPos = BTC_ANTENNA_AT_AUX_PORT;\r\n}\r\nif (pBtCoexist->chipInterface == BTC_INTF_PCI)\r\npBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0x384, u1Tmp);\r\nelse if (pBtCoexist->chipInterface == BTC_INTF_SDIO)\r\npBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0x60, u1Tmp);\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_InitHwConfig(PBTC_COEXIST pBtCoexist, bool bWifiOnly)\r\n{\r\nhalbtc8723b2ant_InitHwConfig(pBtCoexist, true);\r\n}\r\nvoid EXhalbtc8723b2ant_InitCoexDm(PBTC_COEXIST pBtCoexist)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], Coex Mechanism Init!!\n"));\r\nhalbtc8723b2ant_InitCoexDm(pBtCoexist);\r\n}\r\nvoid EXhalbtc8723b2ant_DisplayCoexInfo(PBTC_COEXIST pBtCoexist)\r\n{\r\nPBTC_BOARD_INFO pBoardInfo = &pBtCoexist->boardInfo;\r\nPBTC_STACK_INFO pStackInfo = &pBtCoexist->stackInfo;\r\nPBTC_BT_LINK_INFO pBtLinkInfo = &pBtCoexist->btLinkInfo;\r\nu8 *cliBuf = pBtCoexist->cliBuf;\r\nu8 u1Tmp[4], i, btInfoExt, psTdmaCase = 0;\r\nu32 u4Tmp[4];\r\nbool bRoam = false, bScan = false, bLink = false, bWifiUnder5G = false;\r\nbool bBtHsOn = false, bWifiBusy = false;\r\ns32 wifiRssi = 0, btHsRssi = 0;\r\nu32 wifiBw, wifiTrafficDir, faOfdm, faCck;\r\nu8 wifiDot11Chnl, wifiHsChnl;\r\nu32 fwVer = 0, btPatchVer = 0;\r\nu8 apNum = 0;\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n ============[BT Coexist info]============");\r\nCL_PRINTF(cliBuf);\r\nif (pBtCoexist->bManualControl) {\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n ============[Under Manual Control]============");\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n ==========================================");\r\nCL_PRINTF(cliBuf);\r\n}\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d ", "Ant PG number/ Ant mechanism:", \\r\npBoardInfo->pgAntNum,\r\npBoardInfo->btdmAntNum\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %s / %d", "BT stack/ hci ext ver", \\r\n(pStackInfo->bProfileNotified ? "Yes" : "No"),\r\npStackInfo->hciVersion\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_BT_PATCH_VER, &btPatchVer);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d_%x/ 0x%x/ 0x%x(%d)", "CoexVer/ FwVer/ PatchVer", \\r\nGLCoexVerDate8723b2Ant, GLCoexVer8723b2Ant, fwVer, btPatchVer, btPatchVer);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_WIFI_DOT11_CHNL, &wifiDot11Chnl);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_WIFI_HS_CHNL, &wifiHsChnl);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d / %d(%d)", "Dot11 channel / HsChnl(HsMode)", \\r\nwifiDot11Chnl,\r\nwifiHsChnl,\r\nbBtHsOn\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %02x %02x %02x ", "H2C Wifi inform bt chnl Info", \\r\npCoexDm->wifiChnlInfo[0],\r\npCoexDm->wifiChnlInfo[1],\r\npCoexDm->wifiChnlInfo[2]\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_S4_WIFI_RSSI, &wifiRssi);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_S4_HS_RSSI, &btHsRssi);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d/ %d", "Wifi rssi/ HS rssi/ AP#", \\r\nwifiRssi,\r\nbtHsRssi,\r\napNum\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d/ %d ", "Wifi bLink/ bRoam/ bScan", \\r\nbLink,\r\nbRoam,\r\nbScan\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_UNDER_5G, &bWifiUnder5G);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_TRAFFIC_DIRECTION, &wifiTrafficDir);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %s / %s/ %s ", "Wifi status", \\r\n(bWifiUnder5G ? "5G" : "2.4G"),\r\n((BTC_WIFI_BW_LEGACY == wifiBw) ? "Legacy" : (((BTC_WIFI_BW_HT40 == wifiBw) ? "HT40" : "HT20"))),\r\n((!bWifiBusy) ? "idle" : ((BTC_WIFI_TRAFFIC_TX == wifiTrafficDir) ? "uplink" : "downlink"))\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = [%s/ %d/ %d] ", "BT [status/ rssi/ retryCnt]", \\r\n((pBtCoexist->btInfo.bBtDisabled) ? ("disabled") : ((pCoexSta->bC2hBtInquiryPage) ? ("inquiry/page scan") : ((BT_8723B_2ANT_BT_STATUS_NON_CONNECTED_IDLE == pCoexDm->btStatus) ? "non-connected idle" :\r\n((BT_8723B_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus) ? "connected-idle" : "busy")))),\r\npCoexSta->btRssi,\r\npCoexSta->btRetryCnt\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d / %d / %d / %d", "SCO/HID/PAN/A2DP", \\r\npBtLinkInfo->bScoExist,\r\npBtLinkInfo->bHidExist,\r\npBtLinkInfo->bPanExist,\r\npBtLinkInfo->bA2dpExist\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcDispDbgMsg(pBtCoexist, BTC_DBG_DISP_BT_LINK_INFO);\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %s", "BT Info A2DP rate", \\r\n(btInfoExt&BIT0) ? "Basic rate" : "EDR rate"\r\n);\r\nCL_PRINTF(cliBuf);\r\nfor (i = 0; i < BT_INFO_SRC_8723B_2ANT_MAX; i++) {\r\nif (pCoexSta->btInfoC2hCnt[i]) {\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %02x %02x %02x %02x %02x %02x %02x(%d)", GLBtInfoSrc8723b2Ant[i], \\r\npCoexSta->btInfoC2h[i][0],\r\npCoexSta->btInfoC2h[i][1],\r\npCoexSta->btInfoC2h[i][2],\r\npCoexSta->btInfoC2h[i][3],\r\npCoexSta->btInfoC2h[i][4],\r\npCoexSta->btInfoC2h[i][5],\r\npCoexSta->btInfoC2h[i][6],\r\npCoexSta->btInfoC2hCnt[i]\r\n);\r\nCL_PRINTF(cliBuf);\r\n}\r\n}\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %s/%s", "PS state, IPS/LPS", \\r\n((pCoexSta->bUnderIps ? "IPS ON" : "IPS OFF")),\r\n((pCoexSta->bUnderLps ? "LPS ON" : "LPS OFF"))\r\n);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->fBtcDispDbgMsg(pBtCoexist, BTC_DBG_DISP_FW_PWR_MODE_CMD);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s", "============[Sw mechanism]============"\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d/ %d ", "SM1[ShRf/ LpRA/ LimDig]", \\r\npCoexDm->bCurRfRxLpfShrink,\r\npCoexDm->bCurLowPenaltyRa,\r\npCoexDm->bLimitedDig\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d/ %d(0x%x) ",\r\n"SM2[AgcT/ AdcB/ SwDacSwing(lvl)]", \\r\npCoexDm->bCurAgcTableEn,\r\npCoexDm->bCurAdcBackOff,\r\npCoexDm->bCurDacSwingOn,\r\npCoexDm->curDacSwingLvl\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "============[Fw mechanism]============");\r\nCL_PRINTF(cliBuf);\r\npsTdmaCase = pCoexDm->curPsTdma;\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %02x %02x %02x %02x %02x case-%d (auto:%d)", "PS TDMA", \\r\npCoexDm->psTdmaPara[0],\r\npCoexDm->psTdmaPara[1],\r\npCoexDm->psTdmaPara[2],\r\npCoexDm->psTdmaPara[3],\r\npCoexDm->psTdmaPara[4],\r\npsTdmaCase, pCoexDm->bAutoTdmaAdjust\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d ", "DecBtPwr/ IgnWlanAct", \\r\npCoexDm->curBtDecPwrLvl,\r\npCoexDm->bCurIgnoreWlanAct\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "============[Hw setting]============");\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x", "RF-A, 0x1e initVal", \\r\npCoexDm->btRf0x1eBackup\r\n);\r\nCL_PRINTF(cliBuf);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x778);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x880);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x", "0x778/0x880[29:25]", \\r\nu1Tmp[0],\r\n(u4Tmp[0]&0x3e000000) >> 25\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x948);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x67);\r\nu1Tmp[1] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x765);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x/ 0x%x", "0x948/ 0x67[5] / 0x765", \\r\nu4Tmp[0],\r\n((u1Tmp[0]&0x20)>>5),\r\nu1Tmp[1]\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x92c);\r\nu4Tmp[1] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x930);\r\nu4Tmp[2] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x944);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x/ 0x%x", "0x92c[1:0]/ 0x930[7:0]/0x944[1:0]", \\r\nu4Tmp[0]&0x3,\r\nu4Tmp[1]&0xff,\r\nu4Tmp[2]&0x3\r\n);\r\nCL_PRINTF(cliBuf);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x39);\r\nu1Tmp[1] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x40);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x4c);\r\nu1Tmp[2] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x64);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x/ 0x%x/ 0x%x", "0x38[11]/0x40/0x4c[24:23]/0x64[0]", \\r\n((u1Tmp[0] & 0x8)>>3),\r\nu1Tmp[1],\r\n((u4Tmp[0]&0x01800000)>>23),\r\nu1Tmp[2]&0x1\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x550);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x522);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x", "0x550(bcn ctrl)/0x522", \\r\nu4Tmp[0],\r\nu1Tmp[0]\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0xc50);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x49c);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x", "0xc50(dig)/0x49c(null-drop)", \\r\nu4Tmp[0]&0xff,\r\nu1Tmp[0]\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0xda0);\r\nu4Tmp[1] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0xda4);\r\nu4Tmp[2] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0xda8);\r\nu4Tmp[3] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0xcf0);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0xa5b);\r\nu1Tmp[1] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0xa5c);\r\nfaOfdm =\r\n((u4Tmp[0]&0xffff0000) >> 16) +\r\n((u4Tmp[1]&0xffff0000) >> 16) +\r\n(u4Tmp[1] & 0xffff) + (u4Tmp[2] & 0xffff) + \\r\n((u4Tmp[3]&0xffff0000) >> 16) +\r\n(u4Tmp[3] & 0xffff);\r\nfaCck = (u1Tmp[0] << 8) + u1Tmp[1];\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x/ 0x%x", "OFDM-CCA/OFDM-FA/CCK-FA", \\r\nu4Tmp[0]&0xffff,\r\nfaOfdm,\r\nfaCck\r\n);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x6c0);\r\nu4Tmp[1] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x6c4);\r\nu4Tmp[2] = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x6c8);\r\nu1Tmp[0] = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x6cc);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = 0x%x/ 0x%x/ 0x%x/ 0x%x", "0x6c0/0x6c4/0x6c8/0x6cc(coexTable)", \\r\nu4Tmp[0],\r\nu4Tmp[1],\r\nu4Tmp[2],\r\nu1Tmp[0]\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d", "0x770(high-pri rx/tx)", \\r\npCoexSta->highPriorityRx,\r\npCoexSta->highPriorityTx\r\n);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(\r\ncliBuf,\r\nBT_TMP_BUF_SIZE,\r\n"\r\n %-35s = %d/ %d", "0x774(low-pri rx/tx)", \\r\npCoexSta->lowPriorityRx,\r\npCoexSta->lowPriorityTx\r\n);\r\nCL_PRINTF(cliBuf);\r\nhalbtc8723b2ant_MonitorBtCtr(pBtCoexist);\r\npBtCoexist->fBtcDispDbgMsg(pBtCoexist, BTC_DBG_DISP_COEX_STATISTICS);\r\n}\r\nvoid EXhalbtc8723b2ant_IpsNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nif (BTC_IPS_ENTER == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], IPS ENTER notify\n"));\r\npCoexSta->bUnderIps = true;\r\nhalbtc8723b2ant_WifiOffHwCfg(pBtCoexist);\r\nhalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, true);\r\nhalbtc8723b2ant_CoexAllOff(pBtCoexist);\r\n} else if (BTC_IPS_LEAVE == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], IPS LEAVE notify\n"));\r\npCoexSta->bUnderIps = false;\r\nhalbtc8723b2ant_InitHwConfig(pBtCoexist, false);\r\nhalbtc8723b2ant_InitCoexDm(pBtCoexist);\r\nhalbtc8723b2ant_QueryBtInfo(pBtCoexist);\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_LpsNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nif (BTC_LPS_ENABLE == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], LPS ENABLE notify\n"));\r\npCoexSta->bUnderLps = true;\r\n} else if (BTC_LPS_DISABLE == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], LPS DISABLE notify\n"));\r\npCoexSta->bUnderLps = false;\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_ScanNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nif (BTC_SCAN_START == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], SCAN START notify\n"));\r\n} else if (BTC_SCAN_FINISH == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], SCAN FINISH notify\n"));\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_ConnectNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nif (BTC_ASSOCIATE_START == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], CONNECT START notify\n"));\r\n} else if (BTC_ASSOCIATE_FINISH == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], CONNECT FINISH notify\n"));\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_MediaStatusNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nu8 H2C_Parameter[3] = {0};\r\nu32 wifiBw;\r\nu8 wifiCentralChnl;\r\nu8 apNum = 0;\r\nif (BTC_MEDIA_CONNECT == type) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], MEDIA connect notify\n"));\r\n} else {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], MEDIA disconnect notify\n"));\r\n}\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_WIFI_CENTRAL_CHNL, &wifiCentralChnl);\r\nif ((BTC_MEDIA_CONNECT == type) && (wifiCentralChnl <= 14)) {\r\nH2C_Parameter[0] = 0x1;\r\nH2C_Parameter[1] = wifiCentralChnl;\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif (BTC_WIFI_BW_HT40 == wifiBw)\r\nH2C_Parameter[2] = 0x30;\r\nelse {\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\r\nif (apNum < 10)\r\nH2C_Parameter[2] = 0x30;\r\nelse\r\nH2C_Parameter[2] = 0x20;\r\n}\r\n}\r\npCoexDm->wifiChnlInfo[0] = H2C_Parameter[0];\r\npCoexDm->wifiChnlInfo[1] = H2C_Parameter[1];\r\npCoexDm->wifiChnlInfo[2] = H2C_Parameter[2];\r\nBTC_PRINT(\r\nBTC_MSG_ALGORITHM,\r\nALGO_TRACE_FW_EXEC,\r\n(\r\n"[BTCoex], FW write 0x66 = 0x%x\n",\r\nH2C_Parameter[0]<<16|H2C_Parameter[1]<<8|H2C_Parameter[2]\r\n)\r\n);\r\npBtCoexist->fBtcFillH2c(pBtCoexist, 0x66, 3, H2C_Parameter);\r\n}\r\nvoid EXhalbtc8723b2ant_SpecialPacketNotify(PBTC_COEXIST pBtCoexist, u8 type)\r\n{\r\nif (type == BTC_PACKET_DHCP) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], DHCP Packet notify\n"));\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_BtInfoNotify(\r\nPBTC_COEXIST pBtCoexist, u8 *tmpBuf, u8 length\r\n)\r\n{\r\nu8 btInfo = 0;\r\nu8 i, rspSource = 0;\r\nbool bBtBusy = false, bLimitedDig = false;\r\nbool bWifiConnected = false;\r\npCoexSta->bC2hBtInfoReqSent = false;\r\nrspSource = tmpBuf[0]&0xf;\r\nif (rspSource >= BT_INFO_SRC_8723B_2ANT_MAX)\r\nrspSource = BT_INFO_SRC_8723B_2ANT_WIFI_FW;\r\npCoexSta->btInfoC2hCnt[rspSource]++;\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Bt info[%d], length =%d, hex data =[", rspSource, length));\r\nfor (i = 0; i < length; i++) {\r\npCoexSta->btInfoC2h[rspSource][i] = tmpBuf[i];\r\nif (i == 1)\r\nbtInfo = tmpBuf[i];\r\nif (i == length-1) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("0x%02x]\n", tmpBuf[i]));\r\n} else {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("0x%02x, ", tmpBuf[i]));\r\n}\r\n}\r\nif (pBtCoexist->bManualControl) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), return for Manual CTRL<===\n"));\r\nreturn;\r\n}\r\nif (BT_INFO_SRC_8723B_2ANT_WIFI_FW != rspSource) {\r\npCoexSta->btRetryCnt = pCoexSta->btInfoC2h[rspSource][2]&0xf;\r\npCoexSta->btRssi = pCoexSta->btInfoC2h[rspSource][3]*2+10;\r\npCoexSta->btInfoExt = pCoexSta->btInfoC2h[rspSource][4];\r\npCoexSta->bBtTxRxMask = (pCoexSta->btInfoC2h[rspSource][2]&0x40);\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_TX_RX_MASK, &pCoexSta->bBtTxRxMask);\r\nif (pCoexSta->bBtTxRxMask) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Switch BT TRx Mask since BT RF REG 0x3C != 0x01\n"));\r\npBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x01);\r\n}\r\nif ((pCoexSta->btInfoExt & BIT1)) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BT ext info bit1 check, send wifi BW&Chnl to BT!!\n"));\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\nif (bWifiConnected)\r\nEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_CONNECT);\r\nelse\r\nEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_DISCONNECT);\r\n}\r\nif ((pCoexSta->btInfoExt & BIT3)) {\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BT ext info bit3 check, set BT NOT to ignore Wlan active!!\n"));\r\nhalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, false);\r\n} else {\r\n}\r\n}\r\nif (btInfo & BT_INFO_8723B_2ANT_B_INQ_PAGE)\r\npCoexSta->bC2hBtInquiryPage = true;\r\nelse\r\npCoexSta->bC2hBtInquiryPage = false;\r\nif (!(btInfo&BT_INFO_8723B_2ANT_B_CONNECTION)) {\r\npCoexSta->bBtLinkExist = false;\r\npCoexSta->bPanExist = false;\r\npCoexSta->bA2dpExist = false;\r\npCoexSta->bHidExist = false;\r\npCoexSta->bScoExist = false;\r\n} else {\r\npCoexSta->bBtLinkExist = true;\r\nif (btInfo & BT_INFO_8723B_2ANT_B_FTP)\r\npCoexSta->bPanExist = true;\r\nelse\r\npCoexSta->bPanExist = false;\r\nif (btInfo & BT_INFO_8723B_2ANT_B_A2DP)\r\npCoexSta->bA2dpExist = true;\r\nelse\r\npCoexSta->bA2dpExist = false;\r\nif (btInfo & BT_INFO_8723B_2ANT_B_HID)\r\npCoexSta->bHidExist = true;\r\nelse\r\npCoexSta->bHidExist = false;\r\nif (btInfo & BT_INFO_8723B_2ANT_B_SCO_ESCO)\r\npCoexSta->bScoExist = true;\r\nelse\r\npCoexSta->bScoExist = false;\r\n}\r\nhalbtc8723b2ant_UpdateBtLinkInfo(pBtCoexist);\r\nif (!(btInfo&BT_INFO_8723B_2ANT_B_CONNECTION)) {\r\npCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_NON_CONNECTED_IDLE;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), BT Non-Connected idle!!!\n"));\r\n} else if (btInfo == BT_INFO_8723B_2ANT_B_CONNECTION) {\r\npCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_CONNECTED_IDLE;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), BT Connected-idle!!!\n"));\r\n} else if (\r\n(btInfo&BT_INFO_8723B_2ANT_B_SCO_ESCO) ||\r\n(btInfo&BT_INFO_8723B_2ANT_B_SCO_BUSY)\r\n) {\r\npCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_SCO_BUSY;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), BT SCO busy!!!\n"));\r\n} else if (btInfo&BT_INFO_8723B_2ANT_B_ACL_BUSY) {\r\npCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_ACL_BUSY;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), BT ACL busy!!!\n"));\r\n} else {\r\npCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_MAX;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], BtInfoNotify(), BT Non-Defined state!!!\n"));\r\n}\r\nif (\r\n(BT_8723B_2ANT_BT_STATUS_ACL_BUSY == pCoexDm->btStatus) ||\r\n(BT_8723B_2ANT_BT_STATUS_SCO_BUSY == pCoexDm->btStatus) ||\r\n(BT_8723B_2ANT_BT_STATUS_ACL_SCO_BUSY == pCoexDm->btStatus)\r\n) {\r\nbBtBusy = true;\r\nbLimitedDig = true;\r\n} else {\r\nbBtBusy = false;\r\nbLimitedDig = false;\r\n}\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_TRAFFIC_BUSY, &bBtBusy);\r\npCoexDm->bLimitedDig = bLimitedDig;\r\npBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_LIMITED_DIG, &bLimitedDig);\r\nhalbtc8723b2ant_RunCoexistMechanism(pBtCoexist);\r\n}\r\nvoid EXhalbtc8723b2ant_HaltNotify(PBTC_COEXIST pBtCoexist)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Halt notify\n"));\r\nhalbtc8723b2ant_WifiOffHwCfg(pBtCoexist);\r\npBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x15);\r\nhalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, true);\r\nEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_DISCONNECT);\r\n}\r\nvoid EXhalbtc8723b2ant_PnpNotify(PBTC_COEXIST pBtCoexist, u8 pnpState)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Pnp notify\n"));\r\nif (BTC_WIFI_PNP_SLEEP == pnpState) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Pnp notify to SLEEP\n"));\r\n} else if (BTC_WIFI_PNP_WAKE_UP == pnpState) {\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Pnp notify to WAKE UP\n"));\r\nhalbtc8723b2ant_InitHwConfig(pBtCoexist, false);\r\nhalbtc8723b2ant_InitCoexDm(pBtCoexist);\r\nhalbtc8723b2ant_QueryBtInfo(pBtCoexist);\r\n}\r\n}\r\nvoid EXhalbtc8723b2ant_Periodical(PBTC_COEXIST pBtCoexist)\r\n{\r\nstatic u8 disVerInfoCnt;\r\nu32 fwVer = 0, btPatchVer = 0;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], ==========================Periodical ===========================\n"));\r\nif (disVerInfoCnt <= 5) {\r\ndisVerInfoCnt += 1;\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], ****************************************************************\n"));\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_BT_PATCH_VER, &btPatchVer);\r\npBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], CoexVer/ FwVer/ PatchVer = %d_%x/ 0x%x/ 0x%x(%d)\n", \\r\nGLCoexVerDate8723b2Ant, GLCoexVer8723b2Ant, fwVer, btPatchVer, btPatchVer));\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], ****************************************************************\n"));\r\n}\r\nif (\r\nhalbtc8723b2ant_IsWifiStatusChanged(pBtCoexist) ||\r\npCoexDm->bAutoTdmaAdjust\r\n)\r\nhalbtc8723b2ant_RunCoexistMechanism(pBtCoexist);\r\n}
