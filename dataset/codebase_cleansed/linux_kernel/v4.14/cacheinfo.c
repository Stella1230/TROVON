static int __init_cache_level(unsigned int cpu)\r\n{\r\nstruct cpuinfo_mips *c = &current_cpu_data;\r\nstruct cpu_cacheinfo *this_cpu_ci = get_cpu_cacheinfo(cpu);\r\nint levels = 0, leaves = 0;\r\nif (c->dcache.waysize)\r\nlevels += 1;\r\nelse\r\nreturn -ENOENT;\r\nleaves += (c->icache.waysize) ? 2 : 1;\r\nif (c->scache.waysize) {\r\nlevels++;\r\nleaves++;\r\n}\r\nif (c->tcache.waysize) {\r\nlevels++;\r\nleaves++;\r\n}\r\nthis_cpu_ci->num_levels = levels;\r\nthis_cpu_ci->num_leaves = leaves;\r\nreturn 0;\r\n}\r\nstatic int __populate_cache_leaves(unsigned int cpu)\r\n{\r\nstruct cpuinfo_mips *c = &current_cpu_data;\r\nstruct cpu_cacheinfo *this_cpu_ci = get_cpu_cacheinfo(cpu);\r\nstruct cacheinfo *this_leaf = this_cpu_ci->info_list;\r\nif (c->icache.waysize) {\r\npopulate_cache(dcache, this_leaf, 1, CACHE_TYPE_DATA);\r\npopulate_cache(icache, this_leaf, 1, CACHE_TYPE_INST);\r\n} else {\r\npopulate_cache(dcache, this_leaf, 1, CACHE_TYPE_UNIFIED);\r\n}\r\nif (c->scache.waysize)\r\npopulate_cache(scache, this_leaf, 2, CACHE_TYPE_UNIFIED);\r\nif (c->tcache.waysize)\r\npopulate_cache(tcache, this_leaf, 3, CACHE_TYPE_UNIFIED);\r\nreturn 0;\r\n}
