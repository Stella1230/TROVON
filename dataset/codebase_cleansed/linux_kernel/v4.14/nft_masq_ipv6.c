static void nft_masq_ipv6_eval(const struct nft_expr *expr,\r\nstruct nft_regs *regs,\r\nconst struct nft_pktinfo *pkt)\r\n{\r\nstruct nft_masq *priv = nft_expr_priv(expr);\r\nstruct nf_nat_range range;\r\nmemset(&range, 0, sizeof(range));\r\nrange.flags = priv->flags;\r\nif (priv->sreg_proto_min) {\r\nrange.min_proto.all = (__force __be16)nft_reg_load16(\r\n&regs->data[priv->sreg_proto_min]);\r\nrange.max_proto.all = (__force __be16)nft_reg_load16(\r\n&regs->data[priv->sreg_proto_max]);\r\n}\r\nregs->verdict.code = nf_nat_masquerade_ipv6(pkt->skb, &range,\r\nnft_out(pkt));\r\n}\r\nstatic void\r\nnft_masq_ipv6_destroy(const struct nft_ctx *ctx, const struct nft_expr *expr)\r\n{\r\nnf_ct_netns_put(ctx->net, NFPROTO_IPV6);\r\n}\r\nstatic int __init nft_masq_ipv6_module_init(void)\r\n{\r\nint ret;\r\nret = nft_register_expr(&nft_masq_ipv6_type);\r\nif (ret < 0)\r\nreturn ret;\r\nnf_nat_masquerade_ipv6_register_notifier();\r\nreturn ret;\r\n}\r\nstatic void __exit nft_masq_ipv6_module_exit(void)\r\n{\r\nnft_unregister_expr(&nft_masq_ipv6_type);\r\nnf_nat_masquerade_ipv6_unregister_notifier();\r\n}
