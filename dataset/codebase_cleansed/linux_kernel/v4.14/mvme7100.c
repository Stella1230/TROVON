static void __init mvme7100_setup_arch(void)\r\n{\r\nstruct device_node *bcsr_node;\r\nvoid __iomem *mvme7100_regs = NULL;\r\nu8 reg;\r\nif (ppc_md.progress)\r\nppc_md.progress("mvme7100_setup_arch()", 0);\r\n#ifdef CONFIG_SMP\r\nmpc86xx_smp_init();\r\n#endif\r\nfsl_pci_assign_primary();\r\nbcsr_node = of_find_compatible_node(NULL, NULL,\r\n"artesyn,mvme7100-bcsr");\r\nif (bcsr_node) {\r\nmvme7100_regs = of_iomap(bcsr_node, 0);\r\nof_node_put(bcsr_node);\r\n}\r\nif (mvme7100_regs) {\r\nreg = readb(mvme7100_regs + MVME7100_INTERRUPT_REG_2_OFFSET);\r\nreg |= MVME7100_DS1375_MASK | MVME7100_MAX6649_MASK\r\n| MVME7100_ABORT_MASK;\r\nwriteb(reg, mvme7100_regs + MVME7100_INTERRUPT_REG_2_OFFSET);\r\n} else\r\npr_warn("Unable to map board registers\n");\r\npr_info("MVME7100 board from Artesyn\n");\r\n}\r\nstatic int __init mvme7100_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nreturn of_flat_dt_is_compatible(root, "artesyn,MVME7100");\r\n}\r\nstatic void mvme7100_usb_host_fixup(struct pci_dev *pdev)\r\n{\r\nunsigned int val;\r\nif (!machine_is(mvme7100))\r\nreturn;\r\npci_read_config_dword(pdev, 0xe0, &val);\r\npci_write_config_dword(pdev, 0xe0, (val & ~7) | 0x2);\r\npci_write_config_dword(pdev, 0xe4, 1 << 5);\r\n}
