int dibusb_dib3000mc_frontend_attach(struct dvb_usb_adapter *adap)\r\n{\r\nif (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_LITEON &&\r\nle16_to_cpu(adap->dev->udev->descriptor.idProduct) ==\r\nUSB_PID_LITEON_DVB_T_WARM) {\r\nmsleep(1000);\r\n}\r\nadap->fe_adap[0].fe = dvb_attach(dib3000mc_attach,\r\n&adap->dev->i2c_adap,\r\nDEFAULT_DIB3000P_I2C_ADDRESS,\r\n&mod3000p_dib3000p_config);\r\nif ((adap->fe_adap[0].fe) == NULL)\r\nadap->fe_adap[0].fe = dvb_attach(dib3000mc_attach,\r\n&adap->dev->i2c_adap,\r\nDEFAULT_DIB3000MC_I2C_ADDRESS,\r\n&mod3000p_dib3000p_config);\r\nif ((adap->fe_adap[0].fe) != NULL) {\r\nif (adap->priv != NULL) {\r\nstruct dibusb_state *st = adap->priv;\r\nst->ops.pid_parse = dib3000mc_pid_parse;\r\nst->ops.pid_ctrl = dib3000mc_pid_control;\r\n}\r\nreturn 0;\r\n}\r\nreturn -ENODEV;\r\n}\r\nint dibusb_dib3000mc_tuner_attach(struct dvb_usb_adapter *adap)\r\n{\r\nstruct dibusb_state *st = adap->priv;\r\nu8 a,b;\r\nu16 if1 = 1220;\r\nstruct i2c_adapter *tun_i2c;\r\nif (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_LITEON &&\r\nle16_to_cpu(adap->dev->udev->descriptor.idProduct) == USB_PID_LITEON_DVB_T_WARM) {\r\ndibusb_read_eeprom_byte(adap->dev,0x7E,&a);\r\ndibusb_read_eeprom_byte(adap->dev,0x7F,&b);\r\nif (a == 0x00)\r\nif1 += b;\r\nelse if (a == 0x80)\r\nif1 -= b;\r\nelse\r\nwarn("LITE-ON DVB-T: Strange IF1 calibration :%2X %2X\n", a, b);\r\n} else if (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_DIBCOM &&\r\nle16_to_cpu(adap->dev->udev->descriptor.idProduct) == USB_PID_DIBCOM_MOD3001_WARM) {\r\nu8 desc;\r\ndibusb_read_eeprom_byte(adap->dev, 7, &desc);\r\nif (desc == 2) {\r\na = 127;\r\ndo {\r\ndibusb_read_eeprom_byte(adap->dev, a, &desc);\r\na--;\r\n} while (a > 7 && (desc == 0xff || desc == 0x00));\r\nif (desc & 0x80)\r\nif1 -= (0xff - desc);\r\nelse\r\nif1 += desc;\r\n}\r\n}\r\ntun_i2c = dib3000mc_get_tuner_i2c_master(adap->fe_adap[0].fe, 1);\r\nif (dvb_attach(mt2060_attach, adap->fe_adap[0].fe, tun_i2c, &stk3000p_mt2060_config, if1) == NULL) {\r\nif (dvb_attach(dvb_pll_attach, adap->fe_adap[0].fe, 0x60, tun_i2c, DVB_PLL_ENV57H1XD5) == NULL)\r\nreturn -ENOMEM;\r\n} else {\r\nst->mt2060_present = 1;\r\ndib3000mc_set_config(adap->fe_adap[0].fe, &stk3000p_dib3000p_config);\r\n}\r\nreturn 0;\r\n}
