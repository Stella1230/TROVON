static void pxa25x_cpu_pm_save(unsigned long *sleep_save)\r\n{\r\nSAVE(PSTR);\r\n}\r\nstatic void pxa25x_cpu_pm_restore(unsigned long *sleep_save)\r\n{\r\nRESTORE(PSTR);\r\n}\r\nstatic void pxa25x_cpu_pm_enter(suspend_state_t state)\r\n{\r\nRCSR = RCSR_HWR | RCSR_WDR | RCSR_SMR | RCSR_GPR;\r\nswitch (state) {\r\ncase PM_SUSPEND_MEM:\r\ncpu_suspend(PWRMODE_SLEEP, pxa25x_finish_suspend);\r\nbreak;\r\n}\r\n}\r\nstatic int pxa25x_cpu_pm_prepare(void)\r\n{\r\nPSPR = __pa_symbol(cpu_resume);\r\nreturn 0;\r\n}\r\nstatic void pxa25x_cpu_pm_finish(void)\r\n{\r\nPSPR = 0;\r\n}\r\nstatic void __init pxa25x_init_pm(void)\r\n{\r\npxa_cpu_pm_fns = &pxa25x_cpu_pm_fns;\r\n}\r\nstatic inline void pxa25x_init_pm(void) {}\r\nstatic int pxa25x_set_wake(struct irq_data *d, unsigned int on)\r\n{\r\nint gpio = pxa_irq_to_gpio(d->irq);\r\nuint32_t mask = 0;\r\nif (gpio >= 0 && gpio < 85)\r\nreturn gpio_set_wake(gpio, on);\r\nif (d->irq == IRQ_RTCAlrm) {\r\nmask = PWER_RTC;\r\ngoto set_pwer;\r\n}\r\nreturn -EINVAL;\r\nset_pwer:\r\nif (on)\r\nPWER |= mask;\r\nelse\r\nPWER &=~mask;\r\nreturn 0;\r\n}\r\nvoid __init pxa25x_init_irq(void)\r\n{\r\npxa_init_irq(32, pxa25x_set_wake);\r\n}\r\nvoid __init pxa26x_init_irq(void)\r\n{\r\npxa_init_irq(32, pxa25x_set_wake);\r\n}\r\nstatic int __init __init\r\npxa25x_dt_init_irq(struct device_node *node, struct device_node *parent)\r\n{\r\npxa_dt_irq_init(pxa25x_set_wake);\r\nset_handle_irq(icip_handle_irq);\r\nreturn 0;\r\n}\r\nvoid __init pxa25x_map_io(void)\r\n{\r\npxa_map_io();\r\niotable_init(ARRAY_AND_SIZE(pxa25x_io_desc));\r\npxa25x_get_clk_frequency_khz(1);\r\n}\r\nstatic int __init pxa25x_init(void)\r\n{\r\nint ret = 0;\r\nif (cpu_is_pxa25x()) {\r\nreset_status = RCSR;\r\npxa25x_init_pm();\r\nregister_syscore_ops(&pxa_irq_syscore_ops);\r\nregister_syscore_ops(&pxa2xx_mfp_syscore_ops);\r\nif (!of_have_populated_dt()) {\r\npxa2xx_set_dmac_info(16, 40);\r\npxa_register_device(&pxa25x_device_gpio, &pxa25x_gpio_info);\r\nret = platform_add_devices(pxa25x_devices,\r\nARRAY_SIZE(pxa25x_devices));\r\n}\r\n}\r\nreturn ret;\r\n}
