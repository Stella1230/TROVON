int coreboot_table_find(int tag, void *data, size_t data_size)\r\n{\r\nstruct coreboot_table_header header;\r\nstruct coreboot_table_entry entry;\r\nvoid *ptr_entry;\r\nint i;\r\nif (!ptr_header)\r\nreturn -EPROBE_DEFER;\r\nmemcpy_fromio(&header, ptr_header, sizeof(header));\r\nif (strncmp(header.signature, "LBIO", sizeof(header.signature))) {\r\npr_warn("coreboot_table: coreboot table missing or corrupt!\n");\r\nreturn -ENODEV;\r\n}\r\nptr_entry = (void *)ptr_header + header.header_bytes;\r\nfor (i = 0; i < header.table_entries; i++) {\r\nmemcpy_fromio(&entry, ptr_entry, sizeof(entry));\r\nif (entry.tag == tag) {\r\nif (data_size < entry.size)\r\nreturn -EINVAL;\r\nmemcpy_fromio(data, ptr_entry, entry.size);\r\nreturn 0;\r\n}\r\nptr_entry += entry.size;\r\n}\r\nreturn -ENOENT;\r\n}\r\nint coreboot_table_init(void __iomem *ptr)\r\n{\r\nptr_header = ptr;\r\nreturn 0;\r\n}\r\nint coreboot_table_exit(void)\r\n{\r\nif (ptr_header)\r\niounmap(ptr_header);\r\nreturn 0;\r\n}
