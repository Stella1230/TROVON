long compat_keyctl_dh_compute(struct keyctl_dh_params __user *params,\r\nchar __user *buffer, size_t buflen,\r\nstruct compat_keyctl_kdf_params __user *kdf)\r\n{\r\nstruct keyctl_kdf_params kdfcopy;\r\nstruct compat_keyctl_kdf_params compat_kdfcopy;\r\nif (!kdf)\r\nreturn __keyctl_dh_compute(params, buffer, buflen, NULL);\r\nif (copy_from_user(&compat_kdfcopy, kdf, sizeof(compat_kdfcopy)) != 0)\r\nreturn -EFAULT;\r\nkdfcopy.hashname = compat_ptr(compat_kdfcopy.hashname);\r\nkdfcopy.otherinfo = compat_ptr(compat_kdfcopy.otherinfo);\r\nkdfcopy.otherinfolen = compat_kdfcopy.otherinfolen;\r\nmemcpy(kdfcopy.__spare, compat_kdfcopy.__spare,\r\nsizeof(kdfcopy.__spare));\r\nreturn __keyctl_dh_compute(params, buffer, buflen, &kdfcopy);\r\n}
