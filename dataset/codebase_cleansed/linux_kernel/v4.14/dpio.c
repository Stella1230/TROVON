int dpio_open(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nint dpio_id,\r\nu16 *token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dpio_cmd_open *dpio_cmd;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_OPEN,\r\ncmd_flags,\r\n0);\r\ndpio_cmd = (struct dpio_cmd_open *)cmd.params;\r\ndpio_cmd->dpio_id = cpu_to_le32(dpio_id);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\n*token = mc_cmd_hdr_read_token(&cmd);\r\nreturn 0;\r\n}\r\nint dpio_close(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_CLOSE,\r\ncmd_flags,\r\ntoken);\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dpio_enable(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_ENABLE,\r\ncmd_flags,\r\ntoken);\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dpio_disable(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_DISABLE,\r\ncmd_flags,\r\ntoken);\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dpio_get_attributes(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nstruct dpio_attr *attr)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dpio_rsp_get_attr *dpio_rsp;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_GET_ATTR,\r\ncmd_flags,\r\ntoken);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\ndpio_rsp = (struct dpio_rsp_get_attr *)cmd.params;\r\nattr->id = le32_to_cpu(dpio_rsp->id);\r\nattr->qbman_portal_id = le16_to_cpu(dpio_rsp->qbman_portal_id);\r\nattr->num_priorities = dpio_rsp->num_priorities;\r\nattr->channel_mode = dpio_rsp->channel_mode & DPIO_CHANNEL_MODE_MASK;\r\nattr->qbman_portal_ce_offset =\r\nle64_to_cpu(dpio_rsp->qbman_portal_ce_addr);\r\nattr->qbman_portal_ci_offset =\r\nle64_to_cpu(dpio_rsp->qbman_portal_ci_addr);\r\nattr->qbman_version = le32_to_cpu(dpio_rsp->qbman_version);\r\nreturn 0;\r\n}\r\nint dpio_get_api_version(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 *major_ver,\r\nu16 *minor_ver)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPIO_CMDID_GET_API_VERSION,\r\ncmd_flags, 0);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nmc_cmd_read_api_version(&cmd, major_ver, minor_ver);\r\nreturn 0;\r\n}
