void __init paging_init(void)\r\n{\r\nunsigned long end_mem = memory_end & PAGE_MASK;\r\nunsigned long zones_size[MAX_NR_ZONES] = {\r\n[0] = 0,\r\n[ZONE_DMA] = (end_mem - CONFIG_PHY_RAM_BASE_ADDRESS) >> PAGE_SHIFT,\r\n[ZONE_NORMAL] = 0,\r\n#ifdef CONFIG_HIGHMEM\r\n[ZONE_HIGHMEM] = 0,\r\n#endif\r\n};\r\nset_fs(KERNEL_DS);\r\npr_debug("free_area_init -> start_mem is %#lx virtual_end is %#lx\n",\r\nPAGE_ALIGN(memory_start), end_mem);\r\nfree_area_init_node(0, zones_size,\r\nCONFIG_PHY_RAM_BASE_ADDRESS >> PAGE_SHIFT, NULL);\r\n}\r\nasmlinkage void __init init_pda(void)\r\n{\r\nunsigned int cpu = raw_smp_processor_id();\r\nearly_shadow_stamp();\r\nmemset(&cpu_pda[cpu], 0, sizeof(cpu_pda[cpu]));\r\n#ifdef CONFIG_EXCEPTION_L1_SCRATCH\r\ncpu_pda[cpu].ex_stack = (unsigned long *)(L1_SCRATCH_START + \\r\nL1_SCRATCH_LENGTH);\r\n#else\r\ncpu_pda[cpu].ex_stack = exception_stack[cpu + 1];\r\n#endif\r\n#ifdef CONFIG_SMP\r\ncpu_pda[cpu].imask = 0x1f;\r\n#endif\r\n}\r\nvoid __init mem_init(void)\r\n{\r\nchar buf[64];\r\nhigh_memory = (void *)(memory_end & PAGE_MASK);\r\nmax_mapnr = MAP_NR(high_memory);\r\nprintk(KERN_DEBUG "Kernel managed physical pages: %lu\n", max_mapnr);\r\nfree_all_bootmem();\r\nsnprintf(buf, sizeof(buf) - 1, "%uK DMA", DMA_UNCACHED_REGION >> 10);\r\nmem_init_print_info(buf);\r\n}\r\nvoid __init free_initrd_mem(unsigned long start, unsigned long end)\r\n{\r\n#ifndef CONFIG_MPU\r\nfree_reserved_area((void *)start, (void *)end, -1, "initrd");\r\n#endif\r\n}\r\nvoid __ref free_initmem(void)\r\n{\r\n#if defined CONFIG_RAMKERNEL && !defined CONFIG_MPU\r\nfree_initmem_default(-1);\r\nif (memory_start == (unsigned long)(&__init_end))\r\nmemory_start = (unsigned long)(&__init_begin);\r\n#endif\r\n}
