static int vdec_op_s_ctrl(struct v4l2_ctrl *ctrl)\r\n{\r\nstruct venus_inst *inst = ctrl_to_inst(ctrl);\r\nstruct vdec_controls *ctr = &inst->controls.dec;\r\nswitch (ctrl->id) {\r\ncase V4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER:\r\nctr->post_loop_deb_mode = ctrl->val;\r\nbreak;\r\ncase V4L2_CID_MPEG_VIDEO_H264_PROFILE:\r\ncase V4L2_CID_MPEG_VIDEO_MPEG4_PROFILE:\r\ncase V4L2_CID_MPEG_VIDEO_VPX_PROFILE:\r\nctr->profile = ctrl->val;\r\nbreak;\r\ncase V4L2_CID_MPEG_VIDEO_H264_LEVEL:\r\ncase V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL:\r\nctr->level = ctrl->val;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int vdec_op_g_volatile_ctrl(struct v4l2_ctrl *ctrl)\r\n{\r\nstruct venus_inst *inst = ctrl_to_inst(ctrl);\r\nstruct vdec_controls *ctr = &inst->controls.dec;\r\nunion hfi_get_property hprop;\r\nu32 ptype = HFI_PROPERTY_PARAM_PROFILE_LEVEL_CURRENT;\r\nint ret;\r\nswitch (ctrl->id) {\r\ncase V4L2_CID_MPEG_VIDEO_H264_PROFILE:\r\ncase V4L2_CID_MPEG_VIDEO_MPEG4_PROFILE:\r\ncase V4L2_CID_MPEG_VIDEO_VPX_PROFILE:\r\nret = hfi_session_get_property(inst, ptype, &hprop);\r\nif (!ret)\r\nctr->profile = hprop.profile_level.profile;\r\nctrl->val = ctr->profile;\r\nbreak;\r\ncase V4L2_CID_MPEG_VIDEO_H264_LEVEL:\r\ncase V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL:\r\nret = hfi_session_get_property(inst, ptype, &hprop);\r\nif (!ret)\r\nctr->level = hprop.profile_level.level;\r\nctrl->val = ctr->level;\r\nbreak;\r\ncase V4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER:\r\nctrl->val = ctr->post_loop_deb_mode;\r\nbreak;\r\ncase V4L2_CID_MIN_BUFFERS_FOR_CAPTURE:\r\nctrl->val = inst->num_output_bufs;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n};\r\nreturn 0;\r\n}\r\nint vdec_ctrl_init(struct venus_inst *inst)\r\n{\r\nstruct v4l2_ctrl *ctrl;\r\nint ret;\r\nret = v4l2_ctrl_handler_init(&inst->ctrl_handler, 7);\r\nif (ret)\r\nreturn ret;\r\nctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_MPEG4_PROFILE,\r\nV4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_CODING_EFFICIENCY,\r\n~((1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE) |\r\n(1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_SIMPLE)),\r\nV4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_MPEG4_LEVEL,\r\nV4L2_MPEG_VIDEO_MPEG4_LEVEL_5,\r\n0, V4L2_MPEG_VIDEO_MPEG4_LEVEL_0);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_H264_PROFILE,\r\nV4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH,\r\n~((1 << V4L2_MPEG_VIDEO_H264_PROFILE_BASELINE) |\r\n(1 << V4L2_MPEG_VIDEO_H264_PROFILE_CONSTRAINED_BASELINE) |\r\n(1 << V4L2_MPEG_VIDEO_H264_PROFILE_MAIN) |\r\n(1 << V4L2_MPEG_VIDEO_H264_PROFILE_HIGH) |\r\n(1 << V4L2_MPEG_VIDEO_H264_PROFILE_STEREO_HIGH) |\r\n(1 << V4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH)),\r\nV4L2_MPEG_VIDEO_H264_PROFILE_BASELINE);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_H264_LEVEL,\r\nV4L2_MPEG_VIDEO_H264_LEVEL_5_1,\r\n0, V4L2_MPEG_VIDEO_H264_LEVEL_1_0);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nctrl = v4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_VPX_PROFILE, 0, 3, 1, 0);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nv4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER, 0, 1, 1, 0);\r\nctrl = v4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\r\nV4L2_CID_MIN_BUFFERS_FOR_CAPTURE, 1, 32, 1, 1);\r\nif (ctrl)\r\nctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\r\nret = inst->ctrl_handler.error;\r\nif (ret) {\r\nv4l2_ctrl_handler_free(&inst->ctrl_handler);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nvoid vdec_ctrl_deinit(struct venus_inst *inst)\r\n{\r\nv4l2_ctrl_handler_free(&inst->ctrl_handler);\r\n}
