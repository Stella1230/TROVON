static void __init *max7315_platform_data(void *info)\r\n{\r\nstatic struct pca953x_platform_data max7315_pdata[MAX7315_NUM];\r\nstatic int nr;\r\nstruct pca953x_platform_data *max7315 = &max7315_pdata[nr];\r\nstruct i2c_board_info *i2c_info = info;\r\nint gpio_base, intr;\r\nchar base_pin_name[SFI_NAME_LEN + 1];\r\nchar intr_pin_name[SFI_NAME_LEN + 1];\r\nif (nr == MAX7315_NUM) {\r\npr_err("too many max7315s, we only support %d\n",\r\nMAX7315_NUM);\r\nreturn NULL;\r\n}\r\nstrcpy(i2c_info->type, "max7315");\r\nif (nr++) {\r\nsnprintf(base_pin_name, sizeof(base_pin_name),\r\n"max7315_%d_base", nr);\r\nsnprintf(intr_pin_name, sizeof(intr_pin_name),\r\n"max7315_%d_int", nr);\r\n} else {\r\nstrcpy(base_pin_name, "max7315_base");\r\nstrcpy(intr_pin_name, "max7315_int");\r\n}\r\ngpio_base = get_gpio_by_name(base_pin_name);\r\nintr = get_gpio_by_name(intr_pin_name);\r\nif (gpio_base < 0)\r\nreturn NULL;\r\nmax7315->gpio_base = gpio_base;\r\nif (intr != -1) {\r\ni2c_info->irq = intr + INTEL_MID_IRQ_OFFSET;\r\nmax7315->irq_base = gpio_base + INTEL_MID_IRQ_OFFSET;\r\n} else {\r\ni2c_info->irq = -1;\r\nmax7315->irq_base = -1;\r\n}\r\nreturn max7315;\r\n}
