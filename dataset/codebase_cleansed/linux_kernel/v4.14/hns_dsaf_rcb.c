void hns_rcb_wait_fbd_clean(struct hnae_queue **qs, int q_num, u32 flag)\r\n{\r\nint i, wait_cnt;\r\nu32 fbd_num;\r\nfor (wait_cnt = i = 0; i < q_num; wait_cnt++) {\r\nusleep_range(200, 300);\r\nfbd_num = 0;\r\nif (flag & RCB_INT_FLAG_TX)\r\nfbd_num += dsaf_read_dev(qs[i],\r\nRCB_RING_TX_RING_FBDNUM_REG);\r\nif (flag & RCB_INT_FLAG_RX)\r\nfbd_num += dsaf_read_dev(qs[i],\r\nRCB_RING_RX_RING_FBDNUM_REG);\r\nif (!fbd_num)\r\ni++;\r\nif (wait_cnt >= 10000)\r\nbreak;\r\n}\r\nif (i < q_num)\r\ndev_err(qs[i]->handle->owner_dev,\r\n"queue(%d) wait fbd(%d) clean fail!!\n", i, fbd_num);\r\n}\r\nvoid hns_rcb_reset_ring_hw(struct hnae_queue *q)\r\n{\r\nu32 wait_cnt;\r\nu32 try_cnt = 0;\r\nu32 could_ret;\r\nu32 tx_fbd_num;\r\nwhile (try_cnt++ < RCB_RESET_TRY_TIMES) {\r\nusleep_range(100, 200);\r\ntx_fbd_num = dsaf_read_dev(q, RCB_RING_TX_RING_FBDNUM_REG);\r\nif (tx_fbd_num)\r\ncontinue;\r\ndsaf_write_dev(q, RCB_RING_PREFETCH_EN_REG, 0);\r\ndsaf_write_dev(q, RCB_RING_T0_BE_RST, 1);\r\nmsleep(20);\r\ncould_ret = dsaf_read_dev(q, RCB_RING_COULD_BE_RST);\r\nwait_cnt = 0;\r\nwhile (!could_ret && (wait_cnt < RCB_RESET_WAIT_TIMES)) {\r\ndsaf_write_dev(q, RCB_RING_T0_BE_RST, 0);\r\ndsaf_write_dev(q, RCB_RING_T0_BE_RST, 1);\r\nmsleep(20);\r\ncould_ret = dsaf_read_dev(q, RCB_RING_COULD_BE_RST);\r\nwait_cnt++;\r\n}\r\ndsaf_write_dev(q, RCB_RING_T0_BE_RST, 0);\r\nif (could_ret)\r\nbreak;\r\n}\r\nif (try_cnt >= RCB_RESET_TRY_TIMES)\r\ndev_err(q->dev->dev, "port%d reset ring fail\n",\r\nhns_ae_get_vf_cb(q->handle)->port_index);\r\n}\r\nvoid hns_rcb_int_ctrl_hw(struct hnae_queue *q, u32 flag, u32 mask)\r\n{\r\nu32 int_mask_en = !!mask;\r\nif (flag & RCB_INT_FLAG_TX) {\r\ndsaf_write_dev(q, RCB_RING_INTMSK_TXWL_REG, int_mask_en);\r\ndsaf_write_dev(q, RCB_RING_INTMSK_TX_OVERTIME_REG,\r\nint_mask_en);\r\n}\r\nif (flag & RCB_INT_FLAG_RX) {\r\ndsaf_write_dev(q, RCB_RING_INTMSK_RXWL_REG, int_mask_en);\r\ndsaf_write_dev(q, RCB_RING_INTMSK_RX_OVERTIME_REG,\r\nint_mask_en);\r\n}\r\n}\r\nvoid hns_rcb_int_clr_hw(struct hnae_queue *q, u32 flag)\r\n{\r\nif (flag & RCB_INT_FLAG_TX) {\r\ndsaf_write_dev(q, RCB_RING_INTSTS_TX_RING_REG, 1);\r\ndsaf_write_dev(q, RCB_RING_INTSTS_TX_OVERTIME_REG, 1);\r\n}\r\nif (flag & RCB_INT_FLAG_RX) {\r\ndsaf_write_dev(q, RCB_RING_INTSTS_RX_RING_REG, 1);\r\ndsaf_write_dev(q, RCB_RING_INTSTS_RX_OVERTIME_REG, 1);\r\n}\r\n}\r\nvoid hns_rcbv2_int_ctrl_hw(struct hnae_queue *q, u32 flag, u32 mask)\r\n{\r\nu32 int_mask_en = !!mask;\r\nif (flag & RCB_INT_FLAG_TX)\r\ndsaf_write_dev(q, RCB_RING_INTMSK_TXWL_REG, int_mask_en);\r\nif (flag & RCB_INT_FLAG_RX)\r\ndsaf_write_dev(q, RCB_RING_INTMSK_RXWL_REG, int_mask_en);\r\n}\r\nvoid hns_rcbv2_int_clr_hw(struct hnae_queue *q, u32 flag)\r\n{\r\nif (flag & RCB_INT_FLAG_TX)\r\ndsaf_write_dev(q, RCBV2_TX_RING_INT_STS_REG, 1);\r\nif (flag & RCB_INT_FLAG_RX)\r\ndsaf_write_dev(q, RCBV2_RX_RING_INT_STS_REG, 1);\r\n}\r\nvoid hns_rcb_ring_enable_hw(struct hnae_queue *q, u32 val)\r\n{\r\ndsaf_write_dev(q, RCB_RING_PREFETCH_EN_REG, !!val);\r\n}\r\nvoid hns_rcb_start(struct hnae_queue *q, u32 val)\r\n{\r\nhns_rcb_ring_enable_hw(q, val);\r\n}\r\nvoid hns_rcb_common_init_commit_hw(struct rcb_common_cb *rcb_common)\r\n{\r\nwmb();\r\ndsaf_write_dev(rcb_common, RCB_COM_CFG_SYS_FSH_REG, 1);\r\nwmb();\r\n}\r\nvoid hns_rcb_set_tx_ring_bs(struct hnae_queue *q, u32 buf_size)\r\n{\r\nu32 bd_size_type = hns_rcb_buf_size2type(buf_size);\r\ndsaf_write_dev(q, RCB_RING_TX_RING_BD_LEN_REG,\r\nbd_size_type);\r\n}\r\nvoid hns_rcb_set_rx_ring_bs(struct hnae_queue *q, u32 buf_size)\r\n{\r\nu32 bd_size_type = hns_rcb_buf_size2type(buf_size);\r\ndsaf_write_dev(q, RCB_RING_RX_RING_BD_LEN_REG,\r\nbd_size_type);\r\n}\r\nstatic void hns_rcb_ring_init(struct ring_pair_cb *ring_pair, int ring_type)\r\n{\r\nstruct hnae_queue *q = &ring_pair->q;\r\nstruct hnae_ring *ring =\r\n(ring_type == RX_RING) ? &q->rx_ring : &q->tx_ring;\r\ndma_addr_t dma = ring->desc_dma_addr;\r\nif (ring_type == RX_RING) {\r\ndsaf_write_dev(q, RCB_RING_RX_RING_BASEADDR_L_REG,\r\n(u32)dma);\r\ndsaf_write_dev(q, RCB_RING_RX_RING_BASEADDR_H_REG,\r\n(u32)((dma >> 31) >> 1));\r\nhns_rcb_set_rx_ring_bs(q, ring->buf_size);\r\ndsaf_write_dev(q, RCB_RING_RX_RING_BD_NUM_REG,\r\nring_pair->port_id_in_comm);\r\ndsaf_write_dev(q, RCB_RING_RX_RING_PKTLINE_REG,\r\nring_pair->port_id_in_comm);\r\n} else {\r\ndsaf_write_dev(q, RCB_RING_TX_RING_BASEADDR_L_REG,\r\n(u32)dma);\r\ndsaf_write_dev(q, RCB_RING_TX_RING_BASEADDR_H_REG,\r\n(u32)((dma >> 31) >> 1));\r\nhns_rcb_set_tx_ring_bs(q, ring->buf_size);\r\ndsaf_write_dev(q, RCB_RING_TX_RING_BD_NUM_REG,\r\nring_pair->port_id_in_comm);\r\ndsaf_write_dev(q, RCB_RING_TX_RING_PKTLINE_REG,\r\nring_pair->port_id_in_comm + HNS_RCB_TX_PKTLINE_OFFSET);\r\n}\r\n}\r\nvoid hns_rcb_init_hw(struct ring_pair_cb *ring)\r\n{\r\nhns_rcb_ring_init(ring, RX_RING);\r\nhns_rcb_ring_init(ring, TX_RING);\r\n}\r\nstatic void hns_rcb_set_port_desc_cnt(struct rcb_common_cb *rcb_common,\r\nu32 port_idx, u32 desc_cnt)\r\n{\r\ndsaf_write_dev(rcb_common, RCB_CFG_BD_NUM_REG + port_idx * 4,\r\ndesc_cnt);\r\n}\r\nstatic void hns_rcb_set_port_timeout(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx, u32 timeout)\r\n{\r\nif (AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver)) {\r\ndsaf_write_dev(rcb_common, RCB_CFG_OVERTIME_REG,\r\ntimeout * HNS_RCB_CLK_FREQ_MHZ);\r\n} else if (!HNS_DSAF_IS_DEBUG(rcb_common->dsaf_dev)) {\r\nif (timeout > HNS_RCB_DEF_GAP_TIME_USECS)\r\ndsaf_write_dev(rcb_common,\r\nRCB_PORT_INT_GAPTIME_REG + port_idx * 4,\r\nHNS_RCB_DEF_GAP_TIME_USECS);\r\nelse\r\ndsaf_write_dev(rcb_common,\r\nRCB_PORT_INT_GAPTIME_REG + port_idx * 4,\r\ntimeout);\r\ndsaf_write_dev(rcb_common,\r\nRCB_PORT_CFG_OVERTIME_REG + port_idx * 4,\r\ntimeout);\r\n} else {\r\ndsaf_write_dev(rcb_common,\r\nRCB_PORT_CFG_OVERTIME_REG + port_idx * 4,\r\ntimeout);\r\n}\r\n}\r\nstatic int hns_rcb_common_get_port_num(struct rcb_common_cb *rcb_common)\r\n{\r\nif (!HNS_DSAF_IS_DEBUG(rcb_common->dsaf_dev))\r\nreturn HNS_RCB_SERVICE_NW_ENGINE_NUM;\r\nelse\r\nreturn HNS_RCB_DEBUG_NW_ENGINE_NUM;\r\n}\r\nstatic void hns_rcb_comm_exc_irq_en(\r\nstruct rcb_common_cb *rcb_common, int en)\r\n{\r\nu32 clr_vlue = 0xfffffffful;\r\nu32 msk_vlue = en ? 0 : 0xfffffffful;\r\ndsaf_write_dev(rcb_common, RCB_COM_INTSTS_ECC_ERR_REG, clr_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_SF_CFG_RING_STS, clr_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_SF_CFG_BD_RINT_STS, clr_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_RINT_TX_PKT_REG, clr_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_AXI_ERR_STS, clr_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_INTMASK_ECC_ERR_REG, msk_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_SF_CFG_INTMASK_RING, msk_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_SF_CFG_INTMASK_BD, msk_vlue | 2);\r\ndsaf_write_dev(rcb_common, RCB_COM_INTMSK_TX_PKT_REG, msk_vlue);\r\ndsaf_write_dev(rcb_common, RCB_COM_AXI_WR_ERR_INTMASK, msk_vlue);\r\n}\r\nint hns_rcb_common_init_hw(struct rcb_common_cb *rcb_common)\r\n{\r\nu32 reg_val;\r\nint i;\r\nint port_num = hns_rcb_common_get_port_num(rcb_common);\r\nhns_rcb_comm_exc_irq_en(rcb_common, 0);\r\nreg_val = dsaf_read_dev(rcb_common, RCB_COM_CFG_INIT_FLAG_REG);\r\nif (0x1 != (reg_val & 0x1)) {\r\ndev_err(rcb_common->dsaf_dev->dev,\r\n"RCB_COM_CFG_INIT_FLAG_REG reg = 0x%x\n", reg_val);\r\nreturn -EBUSY;\r\n}\r\nfor (i = 0; i < port_num; i++) {\r\nhns_rcb_set_port_desc_cnt(rcb_common, i, rcb_common->desc_num);\r\nhns_rcb_set_rx_coalesced_frames(\r\nrcb_common, i, HNS_RCB_DEF_RX_COALESCED_FRAMES);\r\nif (!AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver) &&\r\n!HNS_DSAF_IS_DEBUG(rcb_common->dsaf_dev))\r\nhns_rcb_set_tx_coalesced_frames(\r\nrcb_common, i, HNS_RCB_DEF_TX_COALESCED_FRAMES);\r\nhns_rcb_set_port_timeout(\r\nrcb_common, i, HNS_RCB_DEF_COALESCED_USECS);\r\n}\r\ndsaf_write_dev(rcb_common, RCB_COM_CFG_ENDIAN_REG,\r\nHNS_RCB_COMMON_ENDIAN);\r\nif (AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver)) {\r\ndsaf_write_dev(rcb_common, RCB_COM_CFG_FNA_REG, 0x0);\r\ndsaf_write_dev(rcb_common, RCB_COM_CFG_FA_REG, 0x1);\r\n} else {\r\ndsaf_set_dev_bit(rcb_common, RCBV2_COM_CFG_USER_REG,\r\nRCB_COM_CFG_FNA_B, false);\r\ndsaf_set_dev_bit(rcb_common, RCBV2_COM_CFG_USER_REG,\r\nRCB_COM_CFG_FA_B, true);\r\ndsaf_set_dev_bit(rcb_common, RCBV2_COM_CFG_TSO_MODE_REG,\r\nRCB_COM_TSO_MODE_B, HNS_TSO_MODE_8BD_32K);\r\n}\r\nreturn 0;\r\n}\r\nint hns_rcb_buf_size2type(u32 buf_size)\r\n{\r\nint bd_size_type;\r\nswitch (buf_size) {\r\ncase 512:\r\nbd_size_type = HNS_BD_SIZE_512_TYPE;\r\nbreak;\r\ncase 1024:\r\nbd_size_type = HNS_BD_SIZE_1024_TYPE;\r\nbreak;\r\ncase 2048:\r\nbd_size_type = HNS_BD_SIZE_2048_TYPE;\r\nbreak;\r\ncase 4096:\r\nbd_size_type = HNS_BD_SIZE_4096_TYPE;\r\nbreak;\r\ndefault:\r\nbd_size_type = -EINVAL;\r\n}\r\nreturn bd_size_type;\r\n}\r\nstatic void hns_rcb_ring_get_cfg(struct hnae_queue *q, int ring_type)\r\n{\r\nstruct hnae_ring *ring;\r\nstruct rcb_common_cb *rcb_common;\r\nstruct ring_pair_cb *ring_pair_cb;\r\nu16 desc_num, mdnum_ppkt;\r\nbool irq_idx, is_ver1;\r\nring_pair_cb = container_of(q, struct ring_pair_cb, q);\r\nis_ver1 = AE_IS_VER1(ring_pair_cb->rcb_common->dsaf_dev->dsaf_ver);\r\nif (ring_type == RX_RING) {\r\nring = &q->rx_ring;\r\nring->io_base = ring_pair_cb->q.io_base;\r\nirq_idx = HNS_RCB_IRQ_IDX_RX;\r\nmdnum_ppkt = HNS_RCB_RING_MAX_BD_PER_PKT;\r\n} else {\r\nring = &q->tx_ring;\r\nring->io_base = (u8 __iomem *)ring_pair_cb->q.io_base +\r\nHNS_RCB_TX_REG_OFFSET;\r\nirq_idx = HNS_RCB_IRQ_IDX_TX;\r\nmdnum_ppkt = is_ver1 ? HNS_RCB_RING_MAX_TXBD_PER_PKT :\r\nHNS_RCBV2_RING_MAX_TXBD_PER_PKT;\r\n}\r\nrcb_common = ring_pair_cb->rcb_common;\r\ndesc_num = rcb_common->dsaf_dev->desc_num;\r\nring->desc = NULL;\r\nring->desc_cb = NULL;\r\nring->irq = ring_pair_cb->virq[irq_idx];\r\nring->desc_dma_addr = 0;\r\nring->buf_size = RCB_DEFAULT_BUFFER_SIZE;\r\nring->desc_num = desc_num;\r\nring->max_desc_num_per_pkt = mdnum_ppkt;\r\nring->max_raw_data_sz_per_desc = HNS_RCB_MAX_PKT_SIZE;\r\nring->max_pkt_size = HNS_RCB_MAX_PKT_SIZE;\r\nring->next_to_use = 0;\r\nring->next_to_clean = 0;\r\n}\r\nstatic void hns_rcb_ring_pair_get_cfg(struct ring_pair_cb *ring_pair_cb)\r\n{\r\nring_pair_cb->q.handle = NULL;\r\nhns_rcb_ring_get_cfg(&ring_pair_cb->q, RX_RING);\r\nhns_rcb_ring_get_cfg(&ring_pair_cb->q, TX_RING);\r\n}\r\nstatic int hns_rcb_get_port_in_comm(\r\nstruct rcb_common_cb *rcb_common, int ring_idx)\r\n{\r\nreturn ring_idx / (rcb_common->max_q_per_vf * rcb_common->max_vfn);\r\n}\r\nstatic int hns_rcb_get_base_irq_idx(struct rcb_common_cb *rcb_common)\r\n{\r\nbool is_ver1 = AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver);\r\nif (!HNS_DSAF_IS_DEBUG(rcb_common->dsaf_dev))\r\nreturn SERVICE_RING_IRQ_IDX(is_ver1);\r\nelse\r\nreturn HNS_DEBUG_RING_IRQ_IDX;\r\n}\r\nint hns_rcb_get_cfg(struct rcb_common_cb *rcb_common)\r\n{\r\nstruct ring_pair_cb *ring_pair_cb;\r\nu32 i;\r\nu32 ring_num = rcb_common->ring_num;\r\nint base_irq_idx = hns_rcb_get_base_irq_idx(rcb_common);\r\nstruct platform_device *pdev =\r\nto_platform_device(rcb_common->dsaf_dev->dev);\r\nbool is_ver1 = AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver);\r\nfor (i = 0; i < ring_num; i++) {\r\nring_pair_cb = &rcb_common->ring_pair_cb[i];\r\nring_pair_cb->rcb_common = rcb_common;\r\nring_pair_cb->dev = rcb_common->dsaf_dev->dev;\r\nring_pair_cb->index = i;\r\nring_pair_cb->q.io_base =\r\nRCB_COMM_BASE_TO_RING_BASE(rcb_common->io_base, i);\r\nring_pair_cb->port_id_in_comm =\r\nhns_rcb_get_port_in_comm(rcb_common, i);\r\nring_pair_cb->virq[HNS_RCB_IRQ_IDX_TX] =\r\nis_ver1 ? platform_get_irq(pdev, base_irq_idx + i * 2) :\r\nplatform_get_irq(pdev, base_irq_idx + i * 3 + 1);\r\nring_pair_cb->virq[HNS_RCB_IRQ_IDX_RX] =\r\nis_ver1 ? platform_get_irq(pdev, base_irq_idx + i * 2 + 1) :\r\nplatform_get_irq(pdev, base_irq_idx + i * 3);\r\nif ((ring_pair_cb->virq[HNS_RCB_IRQ_IDX_TX] == -EPROBE_DEFER) ||\r\n(ring_pair_cb->virq[HNS_RCB_IRQ_IDX_RX] == -EPROBE_DEFER))\r\nreturn -EPROBE_DEFER;\r\nring_pair_cb->q.phy_base =\r\nRCB_COMM_BASE_TO_RING_BASE(rcb_common->phy_base, i);\r\nhns_rcb_ring_pair_get_cfg(ring_pair_cb);\r\n}\r\nreturn 0;\r\n}\r\nu32 hns_rcb_get_rx_coalesced_frames(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx)\r\n{\r\nreturn dsaf_read_dev(rcb_common, RCB_CFG_PKTLINE_REG + port_idx * 4);\r\n}\r\nu32 hns_rcb_get_tx_coalesced_frames(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx)\r\n{\r\nu64 reg;\r\nreg = RCB_CFG_PKTLINE_REG + (port_idx + HNS_RCB_TX_PKTLINE_OFFSET) * 4;\r\nreturn dsaf_read_dev(rcb_common, reg);\r\n}\r\nu32 hns_rcb_get_coalesce_usecs(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx)\r\n{\r\nif (AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver))\r\nreturn dsaf_read_dev(rcb_common, RCB_CFG_OVERTIME_REG) /\r\nHNS_RCB_CLK_FREQ_MHZ;\r\nelse\r\nreturn dsaf_read_dev(rcb_common,\r\nRCB_PORT_CFG_OVERTIME_REG + port_idx * 4);\r\n}\r\nint hns_rcb_set_coalesce_usecs(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx, u32 timeout)\r\n{\r\nu32 old_timeout = hns_rcb_get_coalesce_usecs(rcb_common, port_idx);\r\nif (timeout == old_timeout)\r\nreturn 0;\r\nif (AE_IS_VER1(rcb_common->dsaf_dev->dsaf_ver)) {\r\nif (!HNS_DSAF_IS_DEBUG(rcb_common->dsaf_dev)) {\r\ndev_err(rcb_common->dsaf_dev->dev,\r\n"error: not support coalesce_usecs setting!\n");\r\nreturn -EINVAL;\r\n}\r\n}\r\nif (timeout > HNS_RCB_MAX_COALESCED_USECS || timeout == 0) {\r\ndev_err(rcb_common->dsaf_dev->dev,\r\n"error: coalesce_usecs setting supports 1~1023us\n");\r\nreturn -EINVAL;\r\n}\r\nhns_rcb_set_port_timeout(rcb_common, port_idx, timeout);\r\nreturn 0;\r\n}\r\nint hns_rcb_set_tx_coalesced_frames(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx, u32 coalesced_frames)\r\n{\r\nu32 old_waterline =\r\nhns_rcb_get_tx_coalesced_frames(rcb_common, port_idx);\r\nu64 reg;\r\nif (coalesced_frames == old_waterline)\r\nreturn 0;\r\nif (coalesced_frames != 1) {\r\ndev_err(rcb_common->dsaf_dev->dev,\r\n"error: not support tx coalesce_frames setting!\n");\r\nreturn -EINVAL;\r\n}\r\nreg = RCB_CFG_PKTLINE_REG + (port_idx + HNS_RCB_TX_PKTLINE_OFFSET) * 4;\r\ndsaf_write_dev(rcb_common, reg, coalesced_frames);\r\nreturn 0;\r\n}\r\nint hns_rcb_set_rx_coalesced_frames(\r\nstruct rcb_common_cb *rcb_common, u32 port_idx, u32 coalesced_frames)\r\n{\r\nu32 old_waterline =\r\nhns_rcb_get_rx_coalesced_frames(rcb_common, port_idx);\r\nif (coalesced_frames == old_waterline)\r\nreturn 0;\r\nif (coalesced_frames >= rcb_common->desc_num ||\r\ncoalesced_frames > HNS_RCB_MAX_COALESCED_FRAMES ||\r\ncoalesced_frames < HNS_RCB_MIN_COALESCED_FRAMES) {\r\ndev_err(rcb_common->dsaf_dev->dev,\r\n"error: not support coalesce_frames setting!\n");\r\nreturn -EINVAL;\r\n}\r\ndsaf_write_dev(rcb_common, RCB_CFG_PKTLINE_REG + port_idx * 4,\r\ncoalesced_frames);\r\nreturn 0;\r\n}\r\nvoid hns_rcb_get_queue_mode(enum dsaf_mode dsaf_mode, u16 *max_vfn,\r\nu16 *max_q_per_vf)\r\n{\r\nswitch (dsaf_mode) {\r\ncase DSAF_MODE_DISABLE_6PORT_0VM:\r\n*max_vfn = 1;\r\n*max_q_per_vf = 16;\r\nbreak;\r\ncase DSAF_MODE_DISABLE_FIX:\r\ncase DSAF_MODE_DISABLE_SP:\r\n*max_vfn = 1;\r\n*max_q_per_vf = 1;\r\nbreak;\r\ncase DSAF_MODE_DISABLE_2PORT_64VM:\r\n*max_vfn = 64;\r\n*max_q_per_vf = 1;\r\nbreak;\r\ncase DSAF_MODE_DISABLE_6PORT_16VM:\r\n*max_vfn = 16;\r\n*max_q_per_vf = 1;\r\nbreak;\r\ndefault:\r\n*max_vfn = 1;\r\n*max_q_per_vf = 16;\r\nbreak;\r\n}\r\n}\r\nint hns_rcb_get_ring_num(struct dsaf_device *dsaf_dev)\r\n{\r\nswitch (dsaf_dev->dsaf_mode) {\r\ncase DSAF_MODE_ENABLE_FIX:\r\ncase DSAF_MODE_DISABLE_SP:\r\nreturn 1;\r\ncase DSAF_MODE_DISABLE_FIX:\r\nreturn 6;\r\ncase DSAF_MODE_ENABLE_0VM:\r\nreturn 32;\r\ncase DSAF_MODE_DISABLE_6PORT_0VM:\r\ncase DSAF_MODE_ENABLE_16VM:\r\ncase DSAF_MODE_DISABLE_6PORT_2VM:\r\ncase DSAF_MODE_DISABLE_6PORT_16VM:\r\ncase DSAF_MODE_DISABLE_6PORT_4VM:\r\ncase DSAF_MODE_ENABLE_8VM:\r\nreturn 96;\r\ncase DSAF_MODE_DISABLE_2PORT_16VM:\r\ncase DSAF_MODE_DISABLE_2PORT_8VM:\r\ncase DSAF_MODE_ENABLE_32VM:\r\ncase DSAF_MODE_DISABLE_2PORT_64VM:\r\ncase DSAF_MODE_ENABLE_128VM:\r\nreturn 128;\r\ndefault:\r\ndev_warn(dsaf_dev->dev,\r\n"get ring num fail,use default!dsaf_mode=%d\n",\r\ndsaf_dev->dsaf_mode);\r\nreturn 128;\r\n}\r\n}\r\nvoid __iomem *hns_rcb_common_get_vaddr(struct rcb_common_cb *rcb_common)\r\n{\r\nstruct dsaf_device *dsaf_dev = rcb_common->dsaf_dev;\r\nreturn dsaf_dev->ppe_base + RCB_COMMON_REG_OFFSET;\r\n}\r\nstatic phys_addr_t hns_rcb_common_get_paddr(struct rcb_common_cb *rcb_common)\r\n{\r\nstruct dsaf_device *dsaf_dev = rcb_common->dsaf_dev;\r\nreturn dsaf_dev->ppe_paddr + RCB_COMMON_REG_OFFSET;\r\n}\r\nint hns_rcb_common_get_cfg(struct dsaf_device *dsaf_dev,\r\nint comm_index)\r\n{\r\nstruct rcb_common_cb *rcb_common;\r\nenum dsaf_mode dsaf_mode = dsaf_dev->dsaf_mode;\r\nu16 max_vfn;\r\nu16 max_q_per_vf;\r\nint ring_num = hns_rcb_get_ring_num(dsaf_dev);\r\nrcb_common =\r\ndevm_kzalloc(dsaf_dev->dev, sizeof(*rcb_common) +\r\nring_num * sizeof(struct ring_pair_cb), GFP_KERNEL);\r\nif (!rcb_common) {\r\ndev_err(dsaf_dev->dev, "rcb common devm_kzalloc fail!\n");\r\nreturn -ENOMEM;\r\n}\r\nrcb_common->comm_index = comm_index;\r\nrcb_common->ring_num = ring_num;\r\nrcb_common->dsaf_dev = dsaf_dev;\r\nrcb_common->desc_num = dsaf_dev->desc_num;\r\nhns_rcb_get_queue_mode(dsaf_mode, &max_vfn, &max_q_per_vf);\r\nrcb_common->max_vfn = max_vfn;\r\nrcb_common->max_q_per_vf = max_q_per_vf;\r\nrcb_common->io_base = hns_rcb_common_get_vaddr(rcb_common);\r\nrcb_common->phy_base = hns_rcb_common_get_paddr(rcb_common);\r\ndsaf_dev->rcb_common[comm_index] = rcb_common;\r\nreturn 0;\r\n}\r\nvoid hns_rcb_common_free_cfg(struct dsaf_device *dsaf_dev,\r\nu32 comm_index)\r\n{\r\ndsaf_dev->rcb_common[comm_index] = NULL;\r\n}\r\nvoid hns_rcb_update_stats(struct hnae_queue *queue)\r\n{\r\nstruct ring_pair_cb *ring =\r\ncontainer_of(queue, struct ring_pair_cb, q);\r\nstruct dsaf_device *dsaf_dev = ring->rcb_common->dsaf_dev;\r\nstruct ppe_common_cb *ppe_common\r\n= dsaf_dev->ppe_common[ring->rcb_common->comm_index];\r\nstruct hns_ring_hw_stats *hw_stats = &ring->hw_stats;\r\nhw_stats->rx_pkts += dsaf_read_dev(queue,\r\nRCB_RING_RX_RING_PKTNUM_RECORD_REG);\r\ndsaf_write_dev(queue, RCB_RING_RX_RING_PKTNUM_RECORD_REG, 0x1);\r\nhw_stats->ppe_rx_ok_pkts += dsaf_read_dev(ppe_common,\r\nPPE_COM_HIS_RX_PKT_QID_OK_CNT_REG + 4 * ring->index);\r\nhw_stats->ppe_rx_drop_pkts += dsaf_read_dev(ppe_common,\r\nPPE_COM_HIS_RX_PKT_QID_DROP_CNT_REG + 4 * ring->index);\r\nhw_stats->tx_pkts += dsaf_read_dev(queue,\r\nRCB_RING_TX_RING_PKTNUM_RECORD_REG);\r\ndsaf_write_dev(queue, RCB_RING_TX_RING_PKTNUM_RECORD_REG, 0x1);\r\nhw_stats->ppe_tx_ok_pkts += dsaf_read_dev(ppe_common,\r\nPPE_COM_HIS_TX_PKT_QID_OK_CNT_REG + 4 * ring->index);\r\nhw_stats->ppe_tx_drop_pkts += dsaf_read_dev(ppe_common,\r\nPPE_COM_HIS_TX_PKT_QID_ERR_CNT_REG + 4 * ring->index);\r\n}\r\nvoid hns_rcb_get_stats(struct hnae_queue *queue, u64 *data)\r\n{\r\nu64 *regs_buff = data;\r\nstruct ring_pair_cb *ring =\r\ncontainer_of(queue, struct ring_pair_cb, q);\r\nstruct hns_ring_hw_stats *hw_stats = &ring->hw_stats;\r\nregs_buff[0] = hw_stats->tx_pkts;\r\nregs_buff[1] = hw_stats->ppe_tx_ok_pkts;\r\nregs_buff[2] = hw_stats->ppe_tx_drop_pkts;\r\nregs_buff[3] =\r\ndsaf_read_dev(queue, RCB_RING_TX_RING_FBDNUM_REG);\r\nregs_buff[4] = queue->tx_ring.stats.tx_pkts;\r\nregs_buff[5] = queue->tx_ring.stats.tx_bytes;\r\nregs_buff[6] = queue->tx_ring.stats.tx_err_cnt;\r\nregs_buff[7] = queue->tx_ring.stats.io_err_cnt;\r\nregs_buff[8] = queue->tx_ring.stats.sw_err_cnt;\r\nregs_buff[9] = queue->tx_ring.stats.seg_pkt_cnt;\r\nregs_buff[10] = queue->tx_ring.stats.restart_queue;\r\nregs_buff[11] = queue->tx_ring.stats.tx_busy;\r\nregs_buff[12] = hw_stats->rx_pkts;\r\nregs_buff[13] = hw_stats->ppe_rx_ok_pkts;\r\nregs_buff[14] = hw_stats->ppe_rx_drop_pkts;\r\nregs_buff[15] =\r\ndsaf_read_dev(queue, RCB_RING_RX_RING_FBDNUM_REG);\r\nregs_buff[16] = queue->rx_ring.stats.rx_pkts;\r\nregs_buff[17] = queue->rx_ring.stats.rx_bytes;\r\nregs_buff[18] = queue->rx_ring.stats.rx_err_cnt;\r\nregs_buff[19] = queue->rx_ring.stats.io_err_cnt;\r\nregs_buff[20] = queue->rx_ring.stats.sw_err_cnt;\r\nregs_buff[21] = queue->rx_ring.stats.seg_pkt_cnt;\r\nregs_buff[22] = queue->rx_ring.stats.reuse_pg_cnt;\r\nregs_buff[23] = queue->rx_ring.stats.err_pkt_len;\r\nregs_buff[24] = queue->rx_ring.stats.non_vld_descs;\r\nregs_buff[25] = queue->rx_ring.stats.err_bd_num;\r\nregs_buff[26] = queue->rx_ring.stats.l2_err;\r\nregs_buff[27] = queue->rx_ring.stats.l3l4_csum_err;\r\n}\r\nint hns_rcb_get_ring_sset_count(int stringset)\r\n{\r\nif (stringset == ETH_SS_STATS || stringset == ETH_SS_PRIV_FLAGS)\r\nreturn HNS_RING_STATIC_REG_NUM;\r\nreturn 0;\r\n}\r\nint hns_rcb_get_common_regs_count(void)\r\n{\r\nreturn HNS_RCB_COMMON_DUMP_REG_NUM;\r\n}\r\nint hns_rcb_get_ring_regs_count(void)\r\n{\r\nreturn HNS_RCB_RING_DUMP_REG_NUM;\r\n}\r\nvoid hns_rcb_get_strings(int stringset, u8 *data, int index)\r\n{\r\nchar *buff = (char *)data;\r\nif (stringset != ETH_SS_STATS)\r\nreturn;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_rcb_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_ppe_tx_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_ppe_drop_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_fbd_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_bytes", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_err_cnt", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_io_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_sw_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_seg_pkt", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_restart_queue", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "tx_ring%d_tx_busy", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_rcb_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_ppe_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_ppe_drop_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_fbd_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_pkt_num", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_bytes", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_err_cnt", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_io_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_sw_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_seg_pkt", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_reuse_pg", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_len_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_non_vld_desc_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_bd_num_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_l2_err", index);\r\nbuff = buff + ETH_GSTRING_LEN;\r\nsnprintf(buff, ETH_GSTRING_LEN, "rx_ring%d_l3l4csum_err", index);\r\n}\r\nvoid hns_rcb_get_common_regs(struct rcb_common_cb *rcb_com, void *data)\r\n{\r\nu32 *regs = data;\r\nbool is_ver1 = AE_IS_VER1(rcb_com->dsaf_dev->dsaf_ver);\r\nbool is_dbg = HNS_DSAF_IS_DEBUG(rcb_com->dsaf_dev);\r\nu32 reg_tmp;\r\nu32 reg_num_tmp;\r\nu32 i = 0;\r\nregs[0] = dsaf_read_dev(rcb_com, RCB_COM_CFG_ENDIAN_REG);\r\nregs[1] = dsaf_read_dev(rcb_com, RCB_COM_CFG_SYS_FSH_REG);\r\nregs[2] = dsaf_read_dev(rcb_com, RCB_COM_CFG_INIT_FLAG_REG);\r\nregs[3] = dsaf_read_dev(rcb_com, RCB_COM_CFG_PKT_REG);\r\nregs[4] = dsaf_read_dev(rcb_com, RCB_COM_CFG_RINVLD_REG);\r\nregs[5] = dsaf_read_dev(rcb_com, RCB_COM_CFG_FNA_REG);\r\nregs[6] = dsaf_read_dev(rcb_com, RCB_COM_CFG_FA_REG);\r\nregs[7] = dsaf_read_dev(rcb_com, RCB_COM_CFG_PKT_TC_BP_REG);\r\nregs[8] = dsaf_read_dev(rcb_com, RCB_COM_CFG_PPE_TNL_CLKEN_REG);\r\nregs[9] = dsaf_read_dev(rcb_com, RCB_COM_INTMSK_TX_PKT_REG);\r\nregs[10] = dsaf_read_dev(rcb_com, RCB_COM_RINT_TX_PKT_REG);\r\nregs[11] = dsaf_read_dev(rcb_com, RCB_COM_INTMASK_ECC_ERR_REG);\r\nregs[12] = dsaf_read_dev(rcb_com, RCB_COM_INTSTS_ECC_ERR_REG);\r\nregs[13] = dsaf_read_dev(rcb_com, RCB_COM_EBD_SRAM_ERR_REG);\r\nregs[14] = dsaf_read_dev(rcb_com, RCB_COM_RXRING_ERR_REG);\r\nregs[15] = dsaf_read_dev(rcb_com, RCB_COM_TXRING_ERR_REG);\r\nregs[16] = dsaf_read_dev(rcb_com, RCB_COM_TX_FBD_ERR_REG);\r\nregs[17] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK_EN_REG);\r\nregs[18] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK0_REG);\r\nregs[19] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK1_REG);\r\nregs[20] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK2_REG);\r\nregs[21] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK3_REG);\r\nregs[22] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK4_REG);\r\nregs[23] = dsaf_read_dev(rcb_com, RCB_SRAM_ECC_CHK5_REG);\r\nregs[24] = dsaf_read_dev(rcb_com, RCB_ECC_ERR_ADDR0_REG);\r\nregs[25] = dsaf_read_dev(rcb_com, RCB_ECC_ERR_ADDR3_REG);\r\nregs[26] = dsaf_read_dev(rcb_com, RCB_ECC_ERR_ADDR4_REG);\r\nregs[27] = dsaf_read_dev(rcb_com, RCB_ECC_ERR_ADDR5_REG);\r\nregs[28] = dsaf_read_dev(rcb_com, RCB_COM_SF_CFG_INTMASK_RING);\r\nregs[29] = dsaf_read_dev(rcb_com, RCB_COM_SF_CFG_RING_STS);\r\nregs[30] = dsaf_read_dev(rcb_com, RCB_COM_SF_CFG_RING);\r\nregs[31] = dsaf_read_dev(rcb_com, RCB_COM_SF_CFG_INTMASK_BD);\r\nregs[32] = dsaf_read_dev(rcb_com, RCB_COM_SF_CFG_BD_RINT_STS);\r\nregs[33] = dsaf_read_dev(rcb_com, RCB_COM_RCB_RD_BD_BUSY);\r\nregs[34] = dsaf_read_dev(rcb_com, RCB_COM_RCB_FBD_CRT_EN);\r\nregs[35] = dsaf_read_dev(rcb_com, RCB_COM_AXI_WR_ERR_INTMASK);\r\nregs[36] = dsaf_read_dev(rcb_com, RCB_COM_AXI_ERR_STS);\r\nregs[37] = dsaf_read_dev(rcb_com, RCB_COM_CHK_TX_FBD_NUM_REG);\r\nfor (i = 0; i < 16; i++) {\r\nregs[38 + i]\r\n= dsaf_read_dev(rcb_com, RCB_CFG_BD_NUM_REG + 4 * i);\r\nregs[54 + i]\r\n= dsaf_read_dev(rcb_com, RCB_CFG_PKTLINE_REG + 4 * i);\r\n}\r\nreg_tmp = is_ver1 ? RCB_CFG_OVERTIME_REG : RCB_PORT_CFG_OVERTIME_REG;\r\nreg_num_tmp = (is_ver1 || is_dbg) ? 1 : 6;\r\nfor (i = 0; i < reg_num_tmp; i++)\r\nregs[70 + i] = dsaf_read_dev(rcb_com, reg_tmp);\r\nregs[76] = dsaf_read_dev(rcb_com, RCB_CFG_PKTLINE_INT_NUM_REG);\r\nregs[77] = dsaf_read_dev(rcb_com, RCB_CFG_OVERTIME_INT_NUM_REG);\r\nfor (i = 78; i < 80; i++)\r\nregs[i] = 0xcccccccc;\r\n}\r\nvoid hns_rcb_get_ring_regs(struct hnae_queue *queue, void *data)\r\n{\r\nu32 *regs = data;\r\nstruct ring_pair_cb *ring_pair\r\n= container_of(queue, struct ring_pair_cb, q);\r\nu32 i = 0;\r\nregs[0] = dsaf_read_dev(queue, RCB_RING_RX_RING_BASEADDR_L_REG);\r\nregs[1] = dsaf_read_dev(queue, RCB_RING_RX_RING_BASEADDR_H_REG);\r\nregs[2] = dsaf_read_dev(queue, RCB_RING_RX_RING_BD_NUM_REG);\r\nregs[3] = dsaf_read_dev(queue, RCB_RING_RX_RING_BD_LEN_REG);\r\nregs[4] = dsaf_read_dev(queue, RCB_RING_RX_RING_PKTLINE_REG);\r\nregs[5] = dsaf_read_dev(queue, RCB_RING_RX_RING_TAIL_REG);\r\nregs[6] = dsaf_read_dev(queue, RCB_RING_RX_RING_HEAD_REG);\r\nregs[7] = dsaf_read_dev(queue, RCB_RING_RX_RING_FBDNUM_REG);\r\nregs[8] = dsaf_read_dev(queue, RCB_RING_RX_RING_PKTNUM_RECORD_REG);\r\nregs[9] = dsaf_read_dev(queue, RCB_RING_TX_RING_BASEADDR_L_REG);\r\nregs[10] = dsaf_read_dev(queue, RCB_RING_TX_RING_BASEADDR_H_REG);\r\nregs[11] = dsaf_read_dev(queue, RCB_RING_TX_RING_BD_NUM_REG);\r\nregs[12] = dsaf_read_dev(queue, RCB_RING_TX_RING_BD_LEN_REG);\r\nregs[13] = dsaf_read_dev(queue, RCB_RING_TX_RING_PKTLINE_REG);\r\nregs[15] = dsaf_read_dev(queue, RCB_RING_TX_RING_TAIL_REG);\r\nregs[16] = dsaf_read_dev(queue, RCB_RING_TX_RING_HEAD_REG);\r\nregs[17] = dsaf_read_dev(queue, RCB_RING_TX_RING_FBDNUM_REG);\r\nregs[18] = dsaf_read_dev(queue, RCB_RING_TX_RING_OFFSET_REG);\r\nregs[19] = dsaf_read_dev(queue, RCB_RING_TX_RING_PKTNUM_RECORD_REG);\r\nregs[20] = dsaf_read_dev(queue, RCB_RING_PREFETCH_EN_REG);\r\nregs[21] = dsaf_read_dev(queue, RCB_RING_CFG_VF_NUM_REG);\r\nregs[22] = dsaf_read_dev(queue, RCB_RING_ASID_REG);\r\nregs[23] = dsaf_read_dev(queue, RCB_RING_RX_VM_REG);\r\nregs[24] = dsaf_read_dev(queue, RCB_RING_T0_BE_RST);\r\nregs[25] = dsaf_read_dev(queue, RCB_RING_COULD_BE_RST);\r\nregs[26] = dsaf_read_dev(queue, RCB_RING_WRR_WEIGHT_REG);\r\nregs[27] = dsaf_read_dev(queue, RCB_RING_INTMSK_RXWL_REG);\r\nregs[28] = dsaf_read_dev(queue, RCB_RING_INTSTS_RX_RING_REG);\r\nregs[29] = dsaf_read_dev(queue, RCB_RING_INTMSK_TXWL_REG);\r\nregs[30] = dsaf_read_dev(queue, RCB_RING_INTSTS_TX_RING_REG);\r\nregs[31] = dsaf_read_dev(queue, RCB_RING_INTMSK_RX_OVERTIME_REG);\r\nregs[32] = dsaf_read_dev(queue, RCB_RING_INTSTS_RX_OVERTIME_REG);\r\nregs[33] = dsaf_read_dev(queue, RCB_RING_INTMSK_TX_OVERTIME_REG);\r\nregs[34] = dsaf_read_dev(queue, RCB_RING_INTSTS_TX_OVERTIME_REG);\r\nfor (i = 35; i < 40; i++)\r\nregs[i] = 0xcccccc00 + ring_pair->index;\r\n}
