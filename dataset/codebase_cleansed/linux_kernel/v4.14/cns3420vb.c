static void __init cns3420_early_serial_setup(void)\r\n{\r\n#ifdef CONFIG_SERIAL_8250_CONSOLE\r\nstatic struct uart_port cns3420_serial_port = {\r\n.membase = (void __iomem *)CNS3XXX_UART0_BASE_VIRT,\r\n.mapbase = CNS3XXX_UART0_BASE,\r\n.irq = IRQ_CNS3XXX_UART0,\r\n.iotype = UPIO_MEM,\r\n.flags = UPF_BOOT_AUTOCONF | UPF_FIXED_TYPE,\r\n.regshift = 2,\r\n.uartclk = 24000000,\r\n.line = 0,\r\n.type = PORT_16550A,\r\n.fifosize = 16,\r\n};\r\nearly_serial_setup(&cns3420_serial_port);\r\n#endif\r\n}\r\nstatic int csn3xxx_usb_power_on(struct platform_device *pdev)\r\n{\r\nif (atomic_inc_return(&usb_pwr_ref) == 1) {\r\ncns3xxx_pwr_power_up(1 << PM_PLL_HM_PD_CTRL_REG_OFFSET_PLL_USB);\r\ncns3xxx_pwr_clk_en(1 << PM_CLK_GATE_REG_OFFSET_USB_HOST);\r\ncns3xxx_pwr_soft_rst(1 << PM_SOFT_RST_REG_OFFST_USB_HOST);\r\n__raw_writel((__raw_readl(MISC_CHIP_CONFIG_REG) | (0X2 << 24)),\r\nMISC_CHIP_CONFIG_REG);\r\n}\r\nreturn 0;\r\n}\r\nstatic void csn3xxx_usb_power_off(struct platform_device *pdev)\r\n{\r\nif (atomic_dec_return(&usb_pwr_ref) == 0)\r\ncns3xxx_pwr_clk_dis(1 << PM_CLK_GATE_REG_OFFSET_USB_HOST);\r\n}\r\nstatic void __init cns3420_init(void)\r\n{\r\ncns3xxx_l2x0_init();\r\nplatform_add_devices(cns3420_pdevs, ARRAY_SIZE(cns3420_pdevs));\r\ncns3xxx_ahci_init();\r\ncns3xxx_sdhci_init();\r\npm_power_off = cns3xxx_power_off;\r\n}\r\nstatic void __init cns3420_map_io(void)\r\n{\r\ncns3xxx_map_io();\r\niotable_init(cns3420_io_desc, ARRAY_SIZE(cns3420_io_desc));\r\ncns3420_early_serial_setup();\r\n}
