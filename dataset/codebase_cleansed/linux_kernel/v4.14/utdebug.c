void acpi_ut_init_stack_ptr_trace(void)\r\n{\r\nacpi_size current_sp;\r\nacpi_gbl_entry_stack_pointer = &current_sp;\r\n}\r\nvoid acpi_ut_track_stack_ptr(void)\r\n{\r\nacpi_size current_sp;\r\nif (&current_sp < acpi_gbl_lowest_stack_pointer) {\r\nacpi_gbl_lowest_stack_pointer = &current_sp;\r\n}\r\nif (acpi_gbl_nesting_level > acpi_gbl_deepest_nesting) {\r\nacpi_gbl_deepest_nesting = acpi_gbl_nesting_level;\r\n}\r\n}\r\nstatic const char *acpi_ut_trim_function_name(const char *function_name)\r\n{\r\nif (*(ACPI_CAST_PTR(u32, function_name)) == ACPI_PREFIX_MIXED) {\r\nreturn (function_name + 4);\r\n}\r\nif (*(ACPI_CAST_PTR(u32, function_name)) == ACPI_PREFIX_LOWER) {\r\nreturn (function_name + 5);\r\n}\r\nreturn (function_name);\r\n}\r\nvoid ACPI_INTERNAL_VAR_XFACE\r\nacpi_debug_print(u32 requested_debug_level,\r\nu32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, const char *format, ...)\r\n{\r\nacpi_thread_id thread_id;\r\nva_list args;\r\nif (!ACPI_IS_DEBUG_ENABLED(requested_debug_level, component_id)) {\r\nreturn;\r\n}\r\nthread_id = acpi_os_get_thread_id();\r\nif (thread_id != acpi_gbl_previous_thread_id) {\r\nif (ACPI_LV_THREADS & acpi_dbg_level) {\r\nacpi_os_printf\r\n("\n**** Context Switch from TID %u to TID %u ****\n\n",\r\n(u32)acpi_gbl_previous_thread_id, (u32)thread_id);\r\n}\r\nacpi_gbl_previous_thread_id = thread_id;\r\nacpi_gbl_nesting_level = 0;\r\n}\r\nacpi_os_printf("%9s-%04ld ", module_name, line_number);\r\n#ifdef ACPI_APPLICATION\r\nif (ACPI_LV_THREADS & acpi_dbg_level) {\r\nacpi_os_printf("[%u] ", (u32)thread_id);\r\n}\r\nacpi_os_printf("[%02ld] ", acpi_gbl_nesting_level);\r\n#endif\r\nacpi_os_printf("%-22.22s: ", acpi_ut_trim_function_name(function_name));\r\nva_start(args, format);\r\nacpi_os_vprintf(format, args);\r\nva_end(args);\r\n}\r\nvoid ACPI_INTERNAL_VAR_XFACE\r\nacpi_debug_print_raw(u32 requested_debug_level,\r\nu32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, const char *format, ...)\r\n{\r\nva_list args;\r\nif (!ACPI_IS_DEBUG_ENABLED(requested_debug_level, component_id)) {\r\nreturn;\r\n}\r\nva_start(args, format);\r\nacpi_os_vprintf(format, args);\r\nva_end(args);\r\n}\r\nvoid\r\nacpi_ut_trace(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s\n",\r\nacpi_gbl_function_entry_prefix);\r\n}\r\n}\r\nvoid\r\nacpi_ut_trace_ptr(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, const void *pointer)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %p\n",\r\nacpi_gbl_function_entry_prefix, pointer);\r\n}\r\n}\r\nvoid\r\nacpi_ut_trace_str(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, const char *string)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %s\n",\r\nacpi_gbl_function_entry_prefix, string);\r\n}\r\n}\r\nvoid\r\nacpi_ut_trace_u32(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u32 integer)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %08X\n",\r\nacpi_gbl_function_entry_prefix, integer);\r\n}\r\n}\r\nvoid\r\nacpi_ut_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id)\r\n{\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s\n",\r\nacpi_gbl_function_exit_prefix);\r\n}\r\nif (acpi_gbl_nesting_level) {\r\nacpi_gbl_nesting_level--;\r\n}\r\n}\r\nvoid\r\nacpi_ut_status_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, acpi_status status)\r\n{\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nif (ACPI_SUCCESS(status)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name,\r\nmodule_name, component_id, "%s %s\n",\r\nacpi_gbl_function_exit_prefix,\r\nacpi_format_exception(status));\r\n} else {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name,\r\nmodule_name, component_id,\r\n"%s ****Exception****: %s\n",\r\nacpi_gbl_function_exit_prefix,\r\nacpi_format_exception(status));\r\n}\r\n}\r\nif (acpi_gbl_nesting_level) {\r\nacpi_gbl_nesting_level--;\r\n}\r\n}\r\nvoid\r\nacpi_ut_value_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u64 value)\r\n{\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %8.8X%8.8X\n",\r\nacpi_gbl_function_exit_prefix,\r\nACPI_FORMAT_UINT64(value));\r\n}\r\nif (acpi_gbl_nesting_level) {\r\nacpi_gbl_nesting_level--;\r\n}\r\n}\r\nvoid\r\nacpi_ut_ptr_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u8 *ptr)\r\n{\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %p\n",\r\nacpi_gbl_function_exit_prefix, ptr);\r\n}\r\nif (acpi_gbl_nesting_level) {\r\nacpi_gbl_nesting_level--;\r\n}\r\n}\r\nvoid\r\nacpi_ut_str_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, const char *string)\r\n{\r\nif (ACPI_IS_DEBUG_ENABLED(ACPI_LV_FUNCTIONS, component_id)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %s\n",\r\nacpi_gbl_function_exit_prefix, string);\r\n}\r\nif (acpi_gbl_nesting_level) {\r\nacpi_gbl_nesting_level--;\r\n}\r\n}\r\nvoid\r\nacpi_trace_point(acpi_trace_event_type type, u8 begin, u8 *aml, char *pathname)\r\n{\r\nACPI_FUNCTION_ENTRY();\r\nacpi_ex_trace_point(type, begin, aml, pathname);\r\n#ifdef ACPI_USE_SYSTEM_TRACER\r\nacpi_os_trace_point(type, begin, aml, pathname);\r\n#endif\r\n}
