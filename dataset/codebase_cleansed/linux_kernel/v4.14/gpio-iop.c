static int iop3xx_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct resource *res;\r\nstruct gpio_chip *gc;\r\nvoid __iomem *base;\r\nint err;\r\ngc = devm_kzalloc(&pdev->dev, sizeof(*gc), GFP_KERNEL);\r\nif (!gc)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nbase = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(base))\r\nreturn PTR_ERR(base);\r\nerr = bgpio_init(gc, &pdev->dev, 1, base + IOP3XX_GPID,\r\nbase + IOP3XX_GPOD, NULL, NULL, base + IOP3XX_GPOE, 0);\r\nif (err)\r\nreturn err;\r\ngc->base = 0;\r\ngc->owner = THIS_MODULE;\r\nreturn devm_gpiochip_add_data(&pdev->dev, gc, NULL);\r\n}\r\nstatic int __init iop3xx_gpio_init(void)\r\n{\r\nreturn platform_driver_register(&iop3xx_gpio_driver);\r\n}
