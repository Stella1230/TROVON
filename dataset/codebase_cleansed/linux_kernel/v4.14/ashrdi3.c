DItype __ashrdi3(DItype u, word_type b)\r\n{\r\nunion DIunion w;\r\nunion DIunion uu;\r\nword_type bm;\r\nif (b == 0)\r\nreturn u;\r\nuu.ll = u;\r\nbm = (sizeof(SItype) * BITS_PER_UNIT) - b;\r\nif (bm <= 0) {\r\nw.s.high = uu.s.high >> (sizeof(SItype) * BITS_PER_UNIT - 1);\r\nw.s.low = uu.s.high >> -bm;\r\n} else {\r\nUSItype carries = (USItype)uu.s.high << bm;\r\nw.s.high = uu.s.high >> b;\r\nw.s.low = ((USItype)uu.s.low >> b) | carries;\r\n}\r\nreturn w.ll;\r\n}
