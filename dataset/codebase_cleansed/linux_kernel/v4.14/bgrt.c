static ssize_t show_version(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", bgrt_tab.version);\r\n}\r\nstatic ssize_t show_status(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", bgrt_tab.status);\r\n}\r\nstatic ssize_t show_type(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", bgrt_tab.image_type);\r\n}\r\nstatic ssize_t show_xoffset(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", bgrt_tab.image_offset_x);\r\n}\r\nstatic ssize_t show_yoffset(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", bgrt_tab.image_offset_y);\r\n}\r\nstatic ssize_t image_read(struct file *file, struct kobject *kobj,\r\nstruct bin_attribute *attr, char *buf, loff_t off, size_t count)\r\n{\r\nmemcpy(buf, attr->private + off, count);\r\nreturn count;\r\n}\r\nint __init acpi_parse_bgrt(struct acpi_table_header *table)\r\n{\r\nefi_bgrt_init(table);\r\nreturn 0;\r\n}\r\nstatic int __init bgrt_init(void)\r\n{\r\nint ret;\r\nif (!bgrt_tab.image_address)\r\nreturn -ENODEV;\r\nbgrt_image = memremap(bgrt_tab.image_address, bgrt_image_size,\r\nMEMREMAP_WB);\r\nif (!bgrt_image) {\r\npr_notice("Ignoring BGRT: failed to map image memory\n");\r\nreturn -ENOMEM;\r\n}\r\nbin_attr_image.private = bgrt_image;\r\nbin_attr_image.size = bgrt_image_size;\r\nbgrt_kobj = kobject_create_and_add("bgrt", acpi_kobj);\r\nif (!bgrt_kobj) {\r\nret = -EINVAL;\r\ngoto out_memmap;\r\n}\r\nret = sysfs_create_group(bgrt_kobj, &bgrt_attribute_group);\r\nif (ret)\r\ngoto out_kobject;\r\nreturn 0;\r\nout_kobject:\r\nkobject_put(bgrt_kobj);\r\nout_memmap:\r\nmemunmap(bgrt_image);\r\nreturn ret;\r\n}
