int i2c_register_board_info(int busnum, struct i2c_board_info const *info, unsigned len)\r\n{\r\nint status;\r\ndown_write(&__i2c_board_lock);\r\nif (busnum >= __i2c_first_dynamic_bus_num)\r\n__i2c_first_dynamic_bus_num = busnum + 1;\r\nfor (status = 0; len; len--, info++) {\r\nstruct i2c_devinfo *devinfo;\r\ndevinfo = kzalloc(sizeof(*devinfo), GFP_KERNEL);\r\nif (!devinfo) {\r\npr_debug("i2c-core: can't register boardinfo!\n");\r\nstatus = -ENOMEM;\r\nbreak;\r\n}\r\ndevinfo->busnum = busnum;\r\ndevinfo->board_info = *info;\r\nif (info->properties) {\r\ndevinfo->board_info.properties =\r\nproperty_entries_dup(info->properties);\r\nif (IS_ERR(devinfo->board_info.properties)) {\r\nstatus = PTR_ERR(devinfo->board_info.properties);\r\nbreak;\r\n}\r\n}\r\nif (info->resources) {\r\ndevinfo->board_info.resources =\r\nkmemdup(info->resources,\r\ninfo->num_resources *\r\nsizeof(*info->resources),\r\nGFP_KERNEL);\r\nif (!devinfo->board_info.resources) {\r\nstatus = -ENOMEM;\r\nbreak;\r\n}\r\n}\r\nlist_add_tail(&devinfo->list, &__i2c_board_list);\r\n}\r\nup_write(&__i2c_board_lock);\r\nreturn status;\r\n}
