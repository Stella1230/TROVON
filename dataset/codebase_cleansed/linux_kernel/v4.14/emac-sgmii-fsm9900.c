static void emac_reg_write_all(void __iomem *base,\r\nconst struct emac_reg_write *itr, size_t size)\r\n{\r\nsize_t i;\r\nfor (i = 0; i < size; ++itr, ++i)\r\nwritel(itr->val, base + itr->offset);\r\n}\r\nint emac_sgmii_init_fsm9900(struct emac_adapter *adpt)\r\n{\r\nstruct emac_sgmii *phy = &adpt->phy;\r\nunsigned int i;\r\nemac_reg_write_all(phy->base, physical_coding_sublayer_programming,\r\nARRAY_SIZE(physical_coding_sublayer_programming));\r\nemac_reg_write_all(phy->base, sysclk_refclk_setting,\r\nARRAY_SIZE(sysclk_refclk_setting));\r\nemac_reg_write_all(phy->base, pll_setting, ARRAY_SIZE(pll_setting));\r\nemac_reg_write_all(phy->base, cdr_setting, ARRAY_SIZE(cdr_setting));\r\nemac_reg_write_all(phy->base, tx_rx_setting, ARRAY_SIZE(tx_rx_setting));\r\nwritel(SERDES_START, phy->base + EMAC_SGMII_PHY_SERDES_START);\r\nfor (i = 0; i < SERDES_START_WAIT_TIMES; i++) {\r\nif (readl(phy->base + EMAC_QSERDES_COM_RESET_SM) & READY)\r\nbreak;\r\nusleep_range(100, 200);\r\n}\r\nif (i == SERDES_START_WAIT_TIMES) {\r\nnetdev_err(adpt->netdev, "error: ser/des failed to start\n");\r\nreturn -EIO;\r\n}\r\nwritel(0, phy->base + EMAC_SGMII_PHY_INTERRUPT_MASK);\r\nreturn 0;\r\n}
