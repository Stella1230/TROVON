static int __init litelink_sir_init(void)\r\n{\r\nreturn irda_register_dongle(&litelink);\r\n}\r\nstatic void __exit litelink_sir_cleanup(void)\r\n{\r\nirda_unregister_dongle(&litelink);\r\n}\r\nstatic int litelink_open(struct sir_dev *dev)\r\n{\r\nstruct qos_info *qos = &dev->qos;\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nqos->baud_rate.bits &= IR_115200|IR_57600|IR_38400|IR_19200|IR_9600;\r\nqos->min_turn_time.bits = 0x7f;\r\nirda_qos_bits_to_value(qos);\r\nreturn 0;\r\n}\r\nstatic int litelink_close(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, FALSE, FALSE);\r\nreturn 0;\r\n}\r\nstatic int litelink_change_speed(struct sir_dev *dev, unsigned speed)\r\n{\r\nint i;\r\nfor (i = 0; baud_rates[i] != speed; i++) {\r\nif (baud_rates[i] == 9600)\r\nbreak;\r\nsirdev_set_dtr_rts(dev, FALSE, TRUE);\r\nudelay(MIN_DELAY);\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nudelay(MIN_DELAY);\r\n}\r\ndev->speed = baud_rates[i];\r\nreturn (dev->speed == speed) ? 0 : -EINVAL;\r\n}\r\nstatic int litelink_reset(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nudelay(MIN_DELAY);\r\nsirdev_set_dtr_rts(dev, TRUE, FALSE);\r\nudelay(MIN_DELAY);\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nudelay(MIN_DELAY);\r\ndev->speed = 115200;\r\nreturn 0;\r\n}
