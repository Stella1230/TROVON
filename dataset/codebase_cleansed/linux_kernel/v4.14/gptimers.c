void set_gptimer_pwidth(unsigned int timer_id, uint32_t value)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&timer_regs[timer_id]->width, value);\r\nSSYNC();\r\n}\r\nuint32_t get_gptimer_pwidth(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn bfin_read(&timer_regs[timer_id]->width);\r\n}\r\nvoid set_gptimer_period(unsigned int timer_id, uint32_t period)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&timer_regs[timer_id]->period, period);\r\nSSYNC();\r\n}\r\nuint32_t get_gptimer_period(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn bfin_read(&timer_regs[timer_id]->period);\r\n}\r\nuint32_t get_gptimer_count(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn bfin_read(&timer_regs[timer_id]->counter);\r\n}\r\nvoid set_gptimer_delay(unsigned int timer_id, uint32_t delay)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&timer_regs[timer_id]->delay, delay);\r\nSSYNC();\r\n}\r\nuint32_t get_gptimer_delay(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn bfin_read(&timer_regs[timer_id]->delay);\r\n}\r\nint get_gptimer_intr(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(bfin_read(&group_regs[BFIN_TIMER_OCTET(timer_id)]->data_ilat) & timil_mask[timer_id]);\r\n}\r\nvoid clear_gptimer_intr(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&group_regs[BFIN_TIMER_OCTET(timer_id)]->data_ilat, timil_mask[timer_id]);\r\n}\r\nint get_gptimer_over(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(bfin_read(&group_regs[BFIN_TIMER_OCTET(timer_id)]->stat_ilat) & tovf_mask[timer_id]);\r\n}\r\nvoid clear_gptimer_over(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&group_regs[BFIN_TIMER_OCTET(timer_id)]->stat_ilat, tovf_mask[timer_id]);\r\n}\r\nint get_gptimer_run(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(bfin_read(&group_regs[BFIN_TIMER_OCTET(timer_id)]->run) & trun_mask[timer_id]);\r\n}\r\nuint32_t get_gptimer_status(unsigned int group)\r\n{\r\ntassert(group < BFIN_TIMER_NUM_GROUP);\r\nreturn bfin_read(&group_regs[group]->data_ilat);\r\n}\r\nvoid set_gptimer_status(unsigned int group, uint32_t value)\r\n{\r\ntassert(group < BFIN_TIMER_NUM_GROUP);\r\nbfin_write(&group_regs[group]->data_ilat, value);\r\nSSYNC();\r\n}\r\nuint32_t get_gptimer_status(unsigned int group)\r\n{\r\ntassert(group < BFIN_TIMER_NUM_GROUP);\r\nreturn bfin_read(&group_regs[group]->status);\r\n}\r\nvoid set_gptimer_status(unsigned int group, uint32_t value)\r\n{\r\ntassert(group < BFIN_TIMER_NUM_GROUP);\r\nbfin_write(&group_regs[group]->status, value);\r\nSSYNC();\r\n}\r\nstatic uint32_t read_gptimer_status(unsigned int timer_id)\r\n{\r\nreturn bfin_read(&group_regs[BFIN_TIMER_OCTET(timer_id)]->status);\r\n}\r\nint get_gptimer_intr(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(read_gptimer_status(timer_id) & timil_mask[timer_id]);\r\n}\r\nvoid clear_gptimer_intr(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&group_regs[BFIN_TIMER_OCTET(timer_id)]->status, timil_mask[timer_id]);\r\n}\r\nint get_gptimer_over(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(read_gptimer_status(timer_id) & tovf_mask[timer_id]);\r\n}\r\nvoid clear_gptimer_over(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&group_regs[BFIN_TIMER_OCTET(timer_id)]->status, tovf_mask[timer_id]);\r\n}\r\nint get_gptimer_run(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn !!(read_gptimer_status(timer_id) & trun_mask[timer_id]);\r\n}\r\nvoid set_gptimer_config(unsigned int timer_id, uint16_t config)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write(&timer_regs[timer_id]->config, config);\r\nSSYNC();\r\n}\r\nuint16_t get_gptimer_config(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nreturn bfin_read(&timer_regs[timer_id]->config);\r\n}\r\nvoid enable_gptimers(uint16_t mask)\r\n{\r\nint i;\r\n#ifdef CONFIG_BF60x\r\nuint16_t imask;\r\nimask = bfin_read16(TIMER_DATA_IMSK);\r\nimask &= ~mask;\r\nbfin_write16(TIMER_DATA_IMSK, imask);\r\n#endif\r\ntassert((mask & ~BLACKFIN_GPTIMER_IDMASK) == 0);\r\nfor (i = 0; i < BFIN_TIMER_NUM_GROUP; ++i) {\r\nbfin_write(&group_regs[i]->enable, mask & 0xFF);\r\nmask >>= 8;\r\n}\r\nSSYNC();\r\n}\r\nstatic void _disable_gptimers(uint16_t mask)\r\n{\r\nint i;\r\nuint16_t m = mask;\r\ntassert((mask & ~BLACKFIN_GPTIMER_IDMASK) == 0);\r\nfor (i = 0; i < BFIN_TIMER_NUM_GROUP; ++i) {\r\nbfin_write(&group_regs[i]->disable, m & 0xFF);\r\nm >>= 8;\r\n}\r\n}\r\nvoid disable_gptimers(uint16_t mask)\r\n{\r\n#ifndef CONFIG_BF60x\r\nint i;\r\n_disable_gptimers(mask);\r\nfor (i = 0; i < MAX_BLACKFIN_GPTIMERS; ++i)\r\nif (mask & (1 << i))\r\nbfin_write(&group_regs[BFIN_TIMER_OCTET(i)]->status, trun_mask[i]);\r\nSSYNC();\r\n#else\r\n_disable_gptimers(mask);\r\n#endif\r\n}\r\nvoid disable_gptimers_sync(uint16_t mask)\r\n{\r\n_disable_gptimers(mask);\r\nSSYNC();\r\n}\r\nvoid set_gptimer_pulse_hi(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write_or(&timer_regs[timer_id]->config, TIMER_PULSE_HI);\r\nSSYNC();\r\n}\r\nvoid clear_gptimer_pulse_hi(unsigned int timer_id)\r\n{\r\ntassert(timer_id < MAX_BLACKFIN_GPTIMERS);\r\nbfin_write_and(&timer_regs[timer_id]->config, ~TIMER_PULSE_HI);\r\nSSYNC();\r\n}\r\nuint16_t get_enabled_gptimers(void)\r\n{\r\nint i;\r\nuint16_t result = 0;\r\nfor (i = 0; i < BFIN_TIMER_NUM_GROUP; ++i)\r\nresult |= (bfin_read(&group_regs[i]->enable) << (i << 3));\r\nreturn result;\r\n}
