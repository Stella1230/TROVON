u8 HalPwrSeqCmdParsing(\r\nstruct adapter *padapter,\r\nu8 CutVersion,\r\nu8 FabVersion,\r\nu8 InterfaceType,\r\nWLAN_PWR_CFG PwrSeqCmd[]\r\n)\r\n{\r\nWLAN_PWR_CFG PwrCfgCmd = {0};\r\nu8 bPollingBit = false;\r\nu32 AryIdx = 0;\r\nu8 value = 0;\r\nu32 offset = 0;\r\nu32 pollingCount = 0;\r\nu32 maxPollingCnt = 5000;\r\ndo {\r\nPwrCfgCmd = PwrSeqCmd[AryIdx];\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n(\r\n"HalPwrSeqCmdParsing: offset(%#x) cut_msk(%#x) fab_msk(%#x) interface_msk(%#x) base(%#x) cmd(%#x) msk(%#x) value(%#x)\n",\r\nGET_PWR_CFG_OFFSET(PwrCfgCmd),\r\nGET_PWR_CFG_CUT_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_FAB_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_INTF_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_BASE(PwrCfgCmd),\r\nGET_PWR_CFG_CMD(PwrCfgCmd),\r\nGET_PWR_CFG_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_VALUE(PwrCfgCmd)\r\n)\r\n);\r\nif (\r\n(GET_PWR_CFG_FAB_MASK(PwrCfgCmd) & FabVersion) &&\r\n(GET_PWR_CFG_CUT_MASK(PwrCfgCmd) & CutVersion) &&\r\n(GET_PWR_CFG_INTF_MASK(PwrCfgCmd) & InterfaceType)\r\n) {\r\nswitch (GET_PWR_CFG_CMD(PwrCfgCmd)) {\r\ncase PWR_CMD_READ:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n("HalPwrSeqCmdParsing: PWR_CMD_READ\n")\r\n);\r\nbreak;\r\ncase PWR_CMD_WRITE:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n("HalPwrSeqCmdParsing: PWR_CMD_WRITE\n")\r\n);\r\noffset = GET_PWR_CFG_OFFSET(PwrCfgCmd);\r\nif (GET_PWR_CFG_BASE(PwrCfgCmd) == PWR_BASEADDR_SDIO) {\r\nvalue = SdioLocalCmd52Read1Byte(padapter, offset);\r\nvalue &= ~(GET_PWR_CFG_MASK(PwrCfgCmd));\r\nvalue |= (\r\nGET_PWR_CFG_VALUE(PwrCfgCmd) &\r\nGET_PWR_CFG_MASK(PwrCfgCmd)\r\n);\r\nSdioLocalCmd52Write1Byte(padapter, offset, value);\r\n} else {\r\nvalue = rtw_read8(padapter, offset);\r\nvalue &= (~(GET_PWR_CFG_MASK(PwrCfgCmd)));\r\nvalue |= (\r\nGET_PWR_CFG_VALUE(PwrCfgCmd)\r\n&GET_PWR_CFG_MASK(PwrCfgCmd)\r\n);\r\nrtw_write8(padapter, offset, value);\r\n}\r\nbreak;\r\ncase PWR_CMD_POLLING:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n("HalPwrSeqCmdParsing: PWR_CMD_POLLING\n")\r\n);\r\nbPollingBit = false;\r\noffset = GET_PWR_CFG_OFFSET(PwrCfgCmd);\r\ndo {\r\nif (GET_PWR_CFG_BASE(PwrCfgCmd) == PWR_BASEADDR_SDIO)\r\nvalue = SdioLocalCmd52Read1Byte(padapter, offset);\r\nelse\r\nvalue = rtw_read8(padapter, offset);\r\nvalue = value&GET_PWR_CFG_MASK(PwrCfgCmd);\r\nif (\r\nvalue == (GET_PWR_CFG_VALUE(PwrCfgCmd) &\r\nGET_PWR_CFG_MASK(PwrCfgCmd))\r\n)\r\nbPollingBit = true;\r\nelse\r\nudelay(10);\r\nif (pollingCount++ > maxPollingCnt) {\r\nDBG_871X(\r\n"Fail to polling Offset[%#x]=%02x\n",\r\noffset,\r\nvalue\r\n);\r\nreturn false;\r\n}\r\n} while (!bPollingBit);\r\nbreak;\r\ncase PWR_CMD_DELAY:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n("HalPwrSeqCmdParsing: PWR_CMD_DELAY\n")\r\n);\r\nif (GET_PWR_CFG_VALUE(PwrCfgCmd) == PWRSEQ_DELAY_US)\r\nudelay(GET_PWR_CFG_OFFSET(PwrCfgCmd));\r\nelse\r\nudelay(GET_PWR_CFG_OFFSET(PwrCfgCmd)*1000);\r\nbreak;\r\ncase PWR_CMD_END:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_info_,\r\n("HalPwrSeqCmdParsing: PWR_CMD_END\n")\r\n);\r\nreturn true;\r\ndefault:\r\nRT_TRACE(\r\n_module_hal_init_c_,\r\n_drv_err_,\r\n("HalPwrSeqCmdParsing: Unknown CMD!!\n")\r\n);\r\nbreak;\r\n}\r\n}\r\nAryIdx++;\r\n} while (1);\r\nreturn true;\r\n}
