static const struct cpu_operations * __init cpu_get_ops(const char *name)\r\n{\r\nconst struct cpu_operations **ops;\r\nops = acpi_disabled ? dt_supported_cpu_ops : acpi_supported_cpu_ops;\r\nwhile (*ops) {\r\nif (!strcmp(name, (*ops)->name))\r\nreturn *ops;\r\nops++;\r\n}\r\nreturn NULL;\r\n}\r\nstatic const char *__init cpu_read_enable_method(int cpu)\r\n{\r\nconst char *enable_method;\r\nif (acpi_disabled) {\r\nstruct device_node *dn = of_get_cpu_node(cpu, NULL);\r\nif (!dn) {\r\nif (!cpu)\r\npr_err("Failed to find device node for boot cpu\n");\r\nreturn NULL;\r\n}\r\nenable_method = of_get_property(dn, "enable-method", NULL);\r\nif (!enable_method) {\r\nif (cpu != 0)\r\npr_err("%pOF: missing enable-method property\n",\r\ndn);\r\n}\r\n} else {\r\nenable_method = acpi_get_enable_method(cpu);\r\nif (!enable_method) {\r\nif (cpu != 0)\r\npr_err("Unsupported ACPI enable-method\n");\r\n}\r\n}\r\nreturn enable_method;\r\n}\r\nint __init cpu_read_ops(int cpu)\r\n{\r\nconst char *enable_method = cpu_read_enable_method(cpu);\r\nif (!enable_method)\r\nreturn -ENODEV;\r\ncpu_ops[cpu] = cpu_get_ops(enable_method);\r\nif (!cpu_ops[cpu]) {\r\npr_warn("Unsupported enable-method: %s\n", enable_method);\r\nreturn -EOPNOTSUPP;\r\n}\r\nreturn 0;\r\n}
