static int mc9s08dz60_gpiochip_match(struct gpio_chip *chip, void *data)\r\n{\r\nreturn !strcmp(chip->label, data);\r\n}\r\nstatic void mx35_3ds_lcd_set_power(\r\nstruct plat_lcd_data *pd, unsigned int power)\r\n{\r\nstruct gpio_chip *chip;\r\nif (!gpio_is_valid(lcd_power_gpio)) {\r\nchip = gpiochip_find(\r\n"mc9s08dz60", mc9s08dz60_gpiochip_match);\r\nif (chip) {\r\nlcd_power_gpio =\r\nchip->base + GPIO_MC9S08DZ60_LCD_ENABLE;\r\nif (gpio_request(lcd_power_gpio, "lcd_power") < 0) {\r\npr_err("error: gpio already requested!\n");\r\nlcd_power_gpio = -ENXIO;\r\n}\r\n} else {\r\npr_err("error: didn't find mc9s08dz60 gpio chip\n");\r\n}\r\n}\r\nif (gpio_is_valid(lcd_power_gpio))\r\ngpio_set_value_cansleep(lcd_power_gpio, power);\r\n}\r\nstatic void __init imx35_3ds_init_mc13892(void)\r\n{\r\nint ret = gpio_request_one(GPIO_PMIC_INT, GPIOF_DIR_IN, "pmic irq");\r\nif (ret) {\r\npr_err("failed to get pmic irq: %d\n", ret);\r\nreturn;\r\n}\r\nmx35_3ds_i2c_mc13892.irq = gpio_to_irq(GPIO_PMIC_INT);\r\ni2c_register_board_info(0, &mx35_3ds_i2c_mc13892, 1);\r\n}\r\nstatic int mx35_3ds_otg_init(struct platform_device *pdev)\r\n{\r\nreturn mx35_initialize_usb_hw(pdev->id, MXC_EHCI_INTERNAL_PHY);\r\n}\r\nstatic int mx35_3ds_usbh_init(struct platform_device *pdev)\r\n{\r\nreturn mx35_initialize_usb_hw(pdev->id, MXC_EHCI_INTERFACE_SINGLE_UNI |\r\nMXC_EHCI_INTERNAL_PHY);\r\n}\r\nstatic int __init mx35_3ds_otg_mode(char *options)\r\n{\r\nif (!strcmp(options, "host"))\r\notg_mode_host = true;\r\nelse if (!strcmp(options, "device"))\r\notg_mode_host = false;\r\nelse\r\npr_info("otg_mode neither \"host\" nor \"device\". "\r\n"Defaulting to device\n");\r\nreturn 1;\r\n}\r\nstatic void __init mx35_3ds_init(void)\r\n{\r\nimx35_soc_init();\r\nmxc_iomux_v3_setup_multiple_pads(mx35pdk_pads, ARRAY_SIZE(mx35pdk_pads));\r\nimx35_add_fec(NULL);\r\nimx35_add_imx2_wdt();\r\nimx35_add_mxc_rtc();\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\nimx35_add_imx_uart0(&uart_pdata);\r\nif (otg_mode_host)\r\nimx35_add_mxc_ehci_otg(&otg_pdata);\r\nimx35_add_mxc_ehci_hs(&usb_host_pdata);\r\nif (!otg_mode_host)\r\nimx35_add_fsl_usb2_udc(&usb_otg_pdata);\r\nimx35_add_mxc_nand(&mx35pdk_nand_board_info);\r\nimx35_add_sdhci_esdhc_imx(0, NULL);\r\nimx35_add_imx_i2c0(&mx35_3ds_i2c0_data);\r\ni2c_register_board_info(\r\n0, i2c_devices_3ds, ARRAY_SIZE(i2c_devices_3ds));\r\nimx35_add_ipu_core();\r\n}\r\nstatic void __init mx35_3ds_late_init(void)\r\n{\r\nstruct platform_device *imx35_fb_pdev;\r\nif (mxc_expio_init(MX35_CS5_BASE_ADDR, IMX_GPIO_NR(1, 1)))\r\npr_warn("Init of the debugboard failed, all "\r\n"devices on the debugboard are unusable.\n");\r\nimx35_fb_pdev = imx35_add_mx3_sdc_fb(&mx3fb_pdata);\r\nmx35_3ds_lcd.dev.parent = &imx35_fb_pdev->dev;\r\nplatform_device_register(&mx35_3ds_lcd);\r\nimx35_3ds_init_mc13892();\r\n}\r\nstatic void __init mx35pdk_timer_init(void)\r\n{\r\nmx35_clocks_init();\r\n}
