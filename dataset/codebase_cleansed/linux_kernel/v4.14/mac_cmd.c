static int mac802154_mlme_start_req(struct net_device *dev,\r\nstruct ieee802154_addr *addr,\r\nu8 channel, u8 page,\r\nu8 bcn_ord, u8 sf_ord,\r\nu8 pan_coord, u8 blx,\r\nu8 coord_realign)\r\n{\r\nstruct ieee802154_llsec_params params;\r\nint changed = 0;\r\nASSERT_RTNL();\r\nBUG_ON(addr->mode != IEEE802154_ADDR_SHORT);\r\ndev->ieee802154_ptr->pan_id = addr->pan_id;\r\ndev->ieee802154_ptr->short_addr = addr->short_addr;\r\nmac802154_dev_set_page_channel(dev, page, channel);\r\nparams.pan_id = addr->pan_id;\r\nchanged |= IEEE802154_LLSEC_PARAM_PAN_ID;\r\nparams.hwaddr = ieee802154_devaddr_from_raw(dev->dev_addr);\r\nchanged |= IEEE802154_LLSEC_PARAM_HWADDR;\r\nparams.coord_hwaddr = params.hwaddr;\r\nchanged |= IEEE802154_LLSEC_PARAM_COORD_HWADDR;\r\nparams.coord_shortaddr = addr->short_addr;\r\nchanged |= IEEE802154_LLSEC_PARAM_COORD_SHORTADDR;\r\nreturn mac802154_set_params(dev, &params, changed);\r\n}\r\nstatic int mac802154_set_mac_params(struct net_device *dev,\r\nconst struct ieee802154_mac_params *params)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nstruct ieee802154_local *local = sdata->local;\r\nstruct wpan_dev *wpan_dev = &sdata->wpan_dev;\r\nint ret;\r\nASSERT_RTNL();\r\nwpan_dev->wpan_phy->transmit_power = params->transmit_power;\r\nwpan_dev->wpan_phy->cca = params->cca;\r\nwpan_dev->wpan_phy->cca_ed_level = params->cca_ed_level;\r\nwpan_dev->min_be = params->min_be;\r\nwpan_dev->max_be = params->max_be;\r\nwpan_dev->csma_retries = params->csma_retries;\r\nwpan_dev->frame_retries = params->frame_retries;\r\nwpan_dev->lbt = params->lbt;\r\nif (local->hw.phy->flags & WPAN_PHY_FLAG_TXPOWER) {\r\nret = drv_set_tx_power(local, params->transmit_power);\r\nif (ret < 0)\r\nreturn ret;\r\n}\r\nif (local->hw.phy->flags & WPAN_PHY_FLAG_CCA_MODE) {\r\nret = drv_set_cca_mode(local, &params->cca);\r\nif (ret < 0)\r\nreturn ret;\r\n}\r\nif (local->hw.phy->flags & WPAN_PHY_FLAG_CCA_ED_LEVEL) {\r\nret = drv_set_cca_ed_level(local, params->cca_ed_level);\r\nif (ret < 0)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void mac802154_get_mac_params(struct net_device *dev,\r\nstruct ieee802154_mac_params *params)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nstruct wpan_dev *wpan_dev = &sdata->wpan_dev;\r\nASSERT_RTNL();\r\nparams->transmit_power = wpan_dev->wpan_phy->transmit_power;\r\nparams->cca = wpan_dev->wpan_phy->cca;\r\nparams->cca_ed_level = wpan_dev->wpan_phy->cca_ed_level;\r\nparams->min_be = wpan_dev->min_be;\r\nparams->max_be = wpan_dev->max_be;\r\nparams->csma_retries = wpan_dev->csma_retries;\r\nparams->frame_retries = wpan_dev->frame_retries;\r\nparams->lbt = wpan_dev->lbt;\r\n}
