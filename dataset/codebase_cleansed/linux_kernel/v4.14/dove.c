static u32 __init dove_get_tclk_freq(void __iomem *sar)\r\n{\r\nu32 opt = (readl(sar) >> SAR_DOVE_TCLK_FREQ) &\r\nSAR_DOVE_TCLK_FREQ_MASK;\r\nreturn dove_tclk_freqs[opt];\r\n}\r\nstatic u32 __init dove_get_cpu_freq(void __iomem *sar)\r\n{\r\nu32 opt = (readl(sar) >> SAR_DOVE_CPU_FREQ) &\r\nSAR_DOVE_CPU_FREQ_MASK;\r\nreturn dove_cpu_freqs[opt];\r\n}\r\nstatic void __init dove_get_clk_ratio(\r\nvoid __iomem *sar, int id, int *mult, int *div)\r\n{\r\nswitch (id) {\r\ncase DOVE_CPU_TO_L2:\r\n{\r\nu32 opt = (readl(sar) >> SAR_DOVE_L2_RATIO) &\r\nSAR_DOVE_L2_RATIO_MASK;\r\n*mult = dove_cpu_l2_ratios[opt][0];\r\n*div = dove_cpu_l2_ratios[opt][1];\r\nbreak;\r\n}\r\ncase DOVE_CPU_TO_DDR:\r\n{\r\nu32 opt = (readl(sar) >> SAR_DOVE_DDR_RATIO) &\r\nSAR_DOVE_DDR_RATIO_MASK;\r\n*mult = dove_cpu_ddr_ratios[opt][0];\r\n*div = dove_cpu_ddr_ratios[opt][1];\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void __init dove_clk_init(struct device_node *np)\r\n{\r\nstruct device_node *cgnp =\r\nof_find_compatible_node(NULL, NULL, "marvell,dove-gating-clock");\r\nstruct device_node *ddnp =\r\nof_find_compatible_node(NULL, NULL, "marvell,dove-divider-clock");\r\nmvebu_coreclk_setup(np, &dove_coreclks);\r\nif (ddnp)\r\ndove_divider_clk_init(ddnp);\r\nif (cgnp)\r\nmvebu_clk_gating_setup(cgnp, dove_gating_desc);\r\n}
