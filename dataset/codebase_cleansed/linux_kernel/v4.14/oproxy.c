static int\r\nnvkm_oproxy_mthd(struct nvkm_object *object, u32 mthd, void *data, u32 size)\r\n{\r\nreturn nvkm_object_mthd(nvkm_oproxy(object)->object, mthd, data, size);\r\n}\r\nstatic int\r\nnvkm_oproxy_ntfy(struct nvkm_object *object, u32 mthd,\r\nstruct nvkm_event **pevent)\r\n{\r\nreturn nvkm_object_ntfy(nvkm_oproxy(object)->object, mthd, pevent);\r\n}\r\nstatic int\r\nnvkm_oproxy_map(struct nvkm_object *object, u64 *addr, u32 *size)\r\n{\r\nreturn nvkm_object_map(nvkm_oproxy(object)->object, addr, size);\r\n}\r\nstatic int\r\nnvkm_oproxy_rd08(struct nvkm_object *object, u64 addr, u8 *data)\r\n{\r\nreturn nvkm_object_rd08(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_rd16(struct nvkm_object *object, u64 addr, u16 *data)\r\n{\r\nreturn nvkm_object_rd16(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_rd32(struct nvkm_object *object, u64 addr, u32 *data)\r\n{\r\nreturn nvkm_object_rd32(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_wr08(struct nvkm_object *object, u64 addr, u8 data)\r\n{\r\nreturn nvkm_object_wr08(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_wr16(struct nvkm_object *object, u64 addr, u16 data)\r\n{\r\nreturn nvkm_object_wr16(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_wr32(struct nvkm_object *object, u64 addr, u32 data)\r\n{\r\nreturn nvkm_object_wr32(nvkm_oproxy(object)->object, addr, data);\r\n}\r\nstatic int\r\nnvkm_oproxy_bind(struct nvkm_object *object, struct nvkm_gpuobj *parent,\r\nint align, struct nvkm_gpuobj **pgpuobj)\r\n{\r\nreturn nvkm_object_bind(nvkm_oproxy(object)->object,\r\nparent, align, pgpuobj);\r\n}\r\nstatic int\r\nnvkm_oproxy_sclass(struct nvkm_object *object, int index,\r\nstruct nvkm_oclass *oclass)\r\n{\r\nstruct nvkm_oproxy *oproxy = nvkm_oproxy(object);\r\noclass->parent = oproxy->object;\r\nif (!oproxy->object->func->sclass)\r\nreturn -ENODEV;\r\nreturn oproxy->object->func->sclass(oproxy->object, index, oclass);\r\n}\r\nstatic int\r\nnvkm_oproxy_fini(struct nvkm_object *object, bool suspend)\r\n{\r\nstruct nvkm_oproxy *oproxy = nvkm_oproxy(object);\r\nint ret;\r\nif (oproxy->func->fini[0]) {\r\nret = oproxy->func->fini[0](oproxy, suspend);\r\nif (ret && suspend)\r\nreturn ret;\r\n}\r\nif (oproxy->object->func->fini) {\r\nret = oproxy->object->func->fini(oproxy->object, suspend);\r\nif (ret && suspend)\r\nreturn ret;\r\n}\r\nif (oproxy->func->fini[1]) {\r\nret = oproxy->func->fini[1](oproxy, suspend);\r\nif (ret && suspend)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int\r\nnvkm_oproxy_init(struct nvkm_object *object)\r\n{\r\nstruct nvkm_oproxy *oproxy = nvkm_oproxy(object);\r\nint ret;\r\nif (oproxy->func->init[0]) {\r\nret = oproxy->func->init[0](oproxy);\r\nif (ret)\r\nreturn ret;\r\n}\r\nif (oproxy->object->func->init) {\r\nret = oproxy->object->func->init(oproxy->object);\r\nif (ret)\r\nreturn ret;\r\n}\r\nif (oproxy->func->init[1]) {\r\nret = oproxy->func->init[1](oproxy);\r\nif (ret)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void *\r\nnvkm_oproxy_dtor(struct nvkm_object *object)\r\n{\r\nstruct nvkm_oproxy *oproxy = nvkm_oproxy(object);\r\nif (oproxy->func->dtor[0])\r\noproxy->func->dtor[0](oproxy);\r\nnvkm_object_del(&oproxy->object);\r\nif (oproxy->func->dtor[1])\r\noproxy->func->dtor[1](oproxy);\r\nreturn oproxy;\r\n}\r\nvoid\r\nnvkm_oproxy_ctor(const struct nvkm_oproxy_func *func,\r\nconst struct nvkm_oclass *oclass, struct nvkm_oproxy *oproxy)\r\n{\r\nnvkm_object_ctor(&nvkm_oproxy_func, oclass, &oproxy->base);\r\noproxy->func = func;\r\n}\r\nint\r\nnvkm_oproxy_new_(const struct nvkm_oproxy_func *func,\r\nconst struct nvkm_oclass *oclass, struct nvkm_oproxy **poproxy)\r\n{\r\nif (!(*poproxy = kzalloc(sizeof(**poproxy), GFP_KERNEL)))\r\nreturn -ENOMEM;\r\nnvkm_oproxy_ctor(func, oclass, *poproxy);\r\nreturn 0;\r\n}
