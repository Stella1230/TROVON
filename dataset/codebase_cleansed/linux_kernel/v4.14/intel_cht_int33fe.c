static int cht_int33fe_probe(struct i2c_client *client)\r\n{\r\nstruct device *dev = &client->dev;\r\nstruct i2c_board_info board_info;\r\nstruct cht_int33fe_data *data;\r\nunsigned long long ptyp;\r\nacpi_status status;\r\nint fusb302_irq;\r\nstatus = acpi_evaluate_integer(ACPI_HANDLE(dev), "PTYP", NULL, &ptyp);\r\nif (ACPI_FAILURE(status)) {\r\ndev_err(dev, "Error getting PTYPE\n");\r\nreturn -ENODEV;\r\n}\r\nif (ptyp != EXPECTED_PTYPE)\r\nreturn -ENODEV;\r\nfusb302_irq = acpi_dev_gpio_irq_get(ACPI_COMPANION(dev), 1);\r\nif (fusb302_irq < 0) {\r\nif (fusb302_irq != -EPROBE_DEFER)\r\ndev_err(dev, "Error getting FUSB302 irq\n");\r\nreturn fusb302_irq;\r\n}\r\ndata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\r\nif (!data)\r\nreturn -ENOMEM;\r\nmemset(&board_info, 0, sizeof(board_info));\r\nstrlcpy(board_info.type, "max17047", I2C_NAME_SIZE);\r\nboard_info.properties = max17047_props;\r\ndata->max17047 = i2c_acpi_new_device(dev, 1, &board_info);\r\nif (!data->max17047)\r\nreturn -EPROBE_DEFER;\r\nmemset(&board_info, 0, sizeof(board_info));\r\nstrlcpy(board_info.type, "fusb302", I2C_NAME_SIZE);\r\nboard_info.irq = fusb302_irq;\r\ndata->fusb302 = i2c_acpi_new_device(dev, 2, &board_info);\r\nif (!data->fusb302)\r\ngoto out_unregister_max17047;\r\nmemset(&board_info, 0, sizeof(board_info));\r\nstrlcpy(board_info.type, "pi3usb30532", I2C_NAME_SIZE);\r\ndata->pi3usb30532 = i2c_acpi_new_device(dev, 3, &board_info);\r\nif (!data->pi3usb30532)\r\ngoto out_unregister_fusb302;\r\ni2c_set_clientdata(client, data);\r\nreturn 0;\r\nout_unregister_fusb302:\r\ni2c_unregister_device(data->fusb302);\r\nout_unregister_max17047:\r\ni2c_unregister_device(data->max17047);\r\nreturn -EPROBE_DEFER;\r\n}\r\nstatic int cht_int33fe_remove(struct i2c_client *i2c)\r\n{\r\nstruct cht_int33fe_data *data = i2c_get_clientdata(i2c);\r\ni2c_unregister_device(data->pi3usb30532);\r\ni2c_unregister_device(data->fusb302);\r\ni2c_unregister_device(data->max17047);\r\nreturn 0;\r\n}
