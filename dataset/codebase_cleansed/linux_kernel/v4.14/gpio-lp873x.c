static int lp873x_gpio_get_direction(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nreturn 0;\r\n}\r\nstatic int lp873x_gpio_direction_input(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nreturn -EINVAL;\r\n}\r\nstatic int lp873x_gpio_direction_output(struct gpio_chip *chip,\r\nunsigned int offset, int value)\r\n{\r\nstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\r\nreturn regmap_update_bits(gpio->lp873->regmap, LP873X_REG_GPO_CTRL,\r\nBIT(offset * BITS_PER_GPO),\r\nvalue ? BIT(offset * BITS_PER_GPO) : 0);\r\n}\r\nstatic int lp873x_gpio_get(struct gpio_chip *chip, unsigned int offset)\r\n{\r\nstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\r\nint ret, val;\r\nret = regmap_read(gpio->lp873->regmap, LP873X_REG_GPO_CTRL, &val);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn val & BIT(offset * BITS_PER_GPO);\r\n}\r\nstatic void lp873x_gpio_set(struct gpio_chip *chip, unsigned int offset,\r\nint value)\r\n{\r\nstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->lp873->regmap, LP873X_REG_GPO_CTRL,\r\nBIT(offset * BITS_PER_GPO),\r\nvalue ? BIT(offset * BITS_PER_GPO) : 0);\r\n}\r\nstatic int lp873x_gpio_request(struct gpio_chip *gc, unsigned int offset)\r\n{\r\nstruct lp873x_gpio *gpio = gpiochip_get_data(gc);\r\nint ret;\r\nswitch (offset) {\r\ncase 0:\r\nbreak;\r\ncase 1:\r\nret = regmap_update_bits(gpio->lp873->regmap, LP873X_REG_CONFIG,\r\nLP873X_CONFIG_CLKIN_PIN_SEL, 0);\r\nif (ret)\r\nreturn ret;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int lp873x_gpio_set_config(struct gpio_chip *gc, unsigned offset,\r\nunsigned long config)\r\n{\r\nstruct lp873x_gpio *gpio = gpiochip_get_data(gc);\r\nswitch (pinconf_to_config_param(config)) {\r\ncase PIN_CONFIG_DRIVE_OPEN_DRAIN:\r\nreturn regmap_update_bits(gpio->lp873->regmap,\r\nLP873X_REG_GPO_CTRL,\r\nBIT(offset * BITS_PER_GPO +\r\nLP873X_GPO_CTRL_OD),\r\nBIT(offset * BITS_PER_GPO +\r\nLP873X_GPO_CTRL_OD));\r\ncase PIN_CONFIG_DRIVE_PUSH_PULL:\r\nreturn regmap_update_bits(gpio->lp873->regmap,\r\nLP873X_REG_GPO_CTRL,\r\nBIT(offset * BITS_PER_GPO +\r\nLP873X_GPO_CTRL_OD), 0);\r\ndefault:\r\nreturn -ENOTSUPP;\r\n}\r\n}\r\nstatic int lp873x_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct lp873x_gpio *gpio;\r\nint ret;\r\ngpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(pdev, gpio);\r\ngpio->lp873 = dev_get_drvdata(pdev->dev.parent);\r\ngpio->chip = template_chip;\r\ngpio->chip.parent = gpio->lp873->dev;\r\nret = devm_gpiochip_add_data(&pdev->dev, &gpio->chip, gpio);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Could not register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
