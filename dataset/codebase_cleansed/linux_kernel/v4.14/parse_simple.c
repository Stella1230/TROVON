int handle_ingress(struct __sk_buff *skb)\r\n{\r\nvoid *data = (void *)(long)skb->data;\r\nstruct eth_hdr *eth = data;\r\nstruct iphdr *iph = data + sizeof(*eth);\r\nstruct udphdr *udp = data + sizeof(*eth) + sizeof(*iph);\r\nvoid *data_end = (void *)(long)skb->data_end;\r\nif (data + sizeof(*eth) + sizeof(*iph) + sizeof(*udp) > data_end)\r\nreturn 0;\r\nif (eth->h_proto != htons(ETH_P_IP))\r\nreturn 0;\r\nif (iph->protocol != IPPROTO_UDP || iph->ihl != 5)\r\nreturn 0;\r\nif (ip_is_fragment(iph))\r\nreturn 0;\r\nif (udp->dest == htons(DEFAULT_PKTGEN_UDP_PORT))\r\nreturn TC_ACT_SHOT;\r\nreturn 0;\r\n}
