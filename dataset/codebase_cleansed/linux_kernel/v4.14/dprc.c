int dprc_open(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nint container_id,\r\nu16 *token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_open *cmd_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_OPEN, cmd_flags,\r\n0);\r\ncmd_params = (struct dprc_cmd_open *)cmd.params;\r\ncmd_params->container_id = cpu_to_le32(container_id);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\n*token = mc_cmd_hdr_read_token(&cmd);\r\nreturn 0;\r\n}\r\nint dprc_close(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token)\r\n{\r\nstruct mc_command cmd = { 0 };\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_CLOSE, cmd_flags,\r\ntoken);\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_irq(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nint *type,\r\nstruct dprc_irq_cfg *irq_cfg)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_irq *cmd_params;\r\nstruct dprc_rsp_get_irq *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_IRQ,\r\ncmd_flags,\r\ntoken);\r\ncmd_params = (struct dprc_cmd_get_irq *)cmd.params;\r\ncmd_params->irq_index = irq_index;\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_irq *)cmd.params;\r\nirq_cfg->val = le32_to_cpu(rsp_params->irq_val);\r\nirq_cfg->paddr = le64_to_cpu(rsp_params->irq_addr);\r\nirq_cfg->irq_num = le32_to_cpu(rsp_params->irq_num);\r\n*type = le32_to_cpu(rsp_params->type);\r\nreturn 0;\r\n}\r\nint dprc_set_irq(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nstruct dprc_irq_cfg *irq_cfg)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_set_irq *cmd_params;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_SET_IRQ,\r\ncmd_flags,\r\ntoken);\r\ncmd_params = (struct dprc_cmd_set_irq *)cmd.params;\r\ncmd_params->irq_val = cpu_to_le32(irq_cfg->val);\r\ncmd_params->irq_index = irq_index;\r\ncmd_params->irq_addr = cpu_to_le64(irq_cfg->paddr);\r\ncmd_params->irq_num = cpu_to_le32(irq_cfg->irq_num);\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_irq_enable(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu8 *en)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_irq_enable *cmd_params;\r\nstruct dprc_rsp_get_irq_enable *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_IRQ_ENABLE,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_get_irq_enable *)cmd.params;\r\ncmd_params->irq_index = irq_index;\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_irq_enable *)cmd.params;\r\n*en = rsp_params->enabled & DPRC_ENABLE;\r\nreturn 0;\r\n}\r\nint dprc_set_irq_enable(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu8 en)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_set_irq_enable *cmd_params;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_SET_IRQ_ENABLE,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_set_irq_enable *)cmd.params;\r\ncmd_params->enable = en & DPRC_ENABLE;\r\ncmd_params->irq_index = irq_index;\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_irq_mask(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu32 *mask)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_irq_mask *cmd_params;\r\nstruct dprc_rsp_get_irq_mask *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_IRQ_MASK,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_get_irq_mask *)cmd.params;\r\ncmd_params->irq_index = irq_index;\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_irq_mask *)cmd.params;\r\n*mask = le32_to_cpu(rsp_params->mask);\r\nreturn 0;\r\n}\r\nint dprc_set_irq_mask(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu32 mask)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_set_irq_mask *cmd_params;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_SET_IRQ_MASK,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_set_irq_mask *)cmd.params;\r\ncmd_params->mask = cpu_to_le32(mask);\r\ncmd_params->irq_index = irq_index;\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_irq_status(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu32 *status)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_irq_status *cmd_params;\r\nstruct dprc_rsp_get_irq_status *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_IRQ_STATUS,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_get_irq_status *)cmd.params;\r\ncmd_params->status = cpu_to_le32(*status);\r\ncmd_params->irq_index = irq_index;\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_irq_status *)cmd.params;\r\n*status = le32_to_cpu(rsp_params->status);\r\nreturn 0;\r\n}\r\nint dprc_clear_irq_status(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nu8 irq_index,\r\nu32 status)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_clear_irq_status *cmd_params;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_CLEAR_IRQ_STATUS,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_clear_irq_status *)cmd.params;\r\ncmd_params->status = cpu_to_le32(status);\r\ncmd_params->irq_index = irq_index;\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_attributes(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nstruct dprc_attributes *attr)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_rsp_get_attributes *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_ATTR,\r\ncmd_flags,\r\ntoken);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_attributes *)cmd.params;\r\nattr->container_id = le32_to_cpu(rsp_params->container_id);\r\nattr->icid = le16_to_cpu(rsp_params->icid);\r\nattr->options = le32_to_cpu(rsp_params->options);\r\nattr->portal_id = le32_to_cpu(rsp_params->portal_id);\r\nreturn 0;\r\n}\r\nint dprc_get_obj_count(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nint *obj_count)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_rsp_get_obj_count *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_OBJ_COUNT,\r\ncmd_flags, token);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_obj_count *)cmd.params;\r\n*obj_count = le32_to_cpu(rsp_params->obj_count);\r\nreturn 0;\r\n}\r\nint dprc_get_obj(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nint obj_index,\r\nstruct fsl_mc_obj_desc *obj_desc)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_obj *cmd_params;\r\nstruct dprc_rsp_get_obj *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_OBJ,\r\ncmd_flags,\r\ntoken);\r\ncmd_params = (struct dprc_cmd_get_obj *)cmd.params;\r\ncmd_params->obj_index = cpu_to_le32(obj_index);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_obj *)cmd.params;\r\nobj_desc->id = le32_to_cpu(rsp_params->id);\r\nobj_desc->vendor = le16_to_cpu(rsp_params->vendor);\r\nobj_desc->irq_count = rsp_params->irq_count;\r\nobj_desc->region_count = rsp_params->region_count;\r\nobj_desc->state = le32_to_cpu(rsp_params->state);\r\nobj_desc->ver_major = le16_to_cpu(rsp_params->version_major);\r\nobj_desc->ver_minor = le16_to_cpu(rsp_params->version_minor);\r\nobj_desc->flags = le16_to_cpu(rsp_params->flags);\r\nstrncpy(obj_desc->type, rsp_params->type, 16);\r\nobj_desc->type[15] = '\0';\r\nstrncpy(obj_desc->label, rsp_params->label, 16);\r\nobj_desc->label[15] = '\0';\r\nreturn 0;\r\n}\r\nint dprc_set_obj_irq(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nchar *obj_type,\r\nint obj_id,\r\nu8 irq_index,\r\nstruct dprc_irq_cfg *irq_cfg)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_set_obj_irq *cmd_params;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_SET_OBJ_IRQ,\r\ncmd_flags,\r\ntoken);\r\ncmd_params = (struct dprc_cmd_set_obj_irq *)cmd.params;\r\ncmd_params->irq_val = cpu_to_le32(irq_cfg->val);\r\ncmd_params->irq_index = irq_index;\r\ncmd_params->irq_addr = cpu_to_le64(irq_cfg->paddr);\r\ncmd_params->irq_num = cpu_to_le32(irq_cfg->irq_num);\r\ncmd_params->obj_id = cpu_to_le32(obj_id);\r\nstrncpy(cmd_params->obj_type, obj_type, 16);\r\ncmd_params->obj_type[15] = '\0';\r\nreturn mc_send_command(mc_io, &cmd);\r\n}\r\nint dprc_get_obj_irq(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nchar *obj_type,\r\nint obj_id,\r\nu8 irq_index,\r\nint *type,\r\nstruct dprc_irq_cfg *irq_cfg)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_obj_irq *cmd_params;\r\nstruct dprc_rsp_get_obj_irq *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_OBJ_IRQ,\r\ncmd_flags,\r\ntoken);\r\ncmd_params = (struct dprc_cmd_get_obj_irq *)cmd.params;\r\ncmd_params->obj_id = cpu_to_le32(obj_id);\r\ncmd_params->irq_index = irq_index;\r\nstrncpy(cmd_params->obj_type, obj_type, 16);\r\ncmd_params->obj_type[15] = '\0';\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_obj_irq *)cmd.params;\r\nirq_cfg->val = le32_to_cpu(rsp_params->irq_val);\r\nirq_cfg->paddr = le64_to_cpu(rsp_params->irq_addr);\r\nirq_cfg->irq_num = le32_to_cpu(rsp_params->irq_num);\r\n*type = le32_to_cpu(rsp_params->type);\r\nreturn 0;\r\n}\r\nint dprc_get_res_count(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nchar *type,\r\nint *res_count)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_res_count *cmd_params;\r\nstruct dprc_rsp_get_res_count *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_RES_COUNT,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_get_res_count *)cmd.params;\r\nstrncpy(cmd_params->type, type, 16);\r\ncmd_params->type[15] = '\0';\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_res_count *)cmd.params;\r\n*res_count = le32_to_cpu(rsp_params->res_count);\r\nreturn 0;\r\n}\r\nint dprc_get_obj_region(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 token,\r\nchar *obj_type,\r\nint obj_id,\r\nu8 region_index,\r\nstruct dprc_region_desc *region_desc)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nstruct dprc_cmd_get_obj_region *cmd_params;\r\nstruct dprc_rsp_get_obj_region *rsp_params;\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_OBJ_REG,\r\ncmd_flags, token);\r\ncmd_params = (struct dprc_cmd_get_obj_region *)cmd.params;\r\ncmd_params->obj_id = cpu_to_le32(obj_id);\r\ncmd_params->region_index = region_index;\r\nstrncpy(cmd_params->obj_type, obj_type, 16);\r\ncmd_params->obj_type[15] = '\0';\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nrsp_params = (struct dprc_rsp_get_obj_region *)cmd.params;\r\nregion_desc->base_offset = le64_to_cpu(rsp_params->base_addr);\r\nregion_desc->size = le32_to_cpu(rsp_params->size);\r\nreturn 0;\r\n}\r\nint dprc_get_api_version(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nu16 *major_ver,\r\nu16 *minor_ver)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_API_VERSION,\r\ncmd_flags, 0);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\nmc_cmd_read_api_version(&cmd, major_ver, minor_ver);\r\nreturn 0;\r\n}\r\nint dprc_get_container_id(struct fsl_mc_io *mc_io,\r\nu32 cmd_flags,\r\nint *container_id)\r\n{\r\nstruct mc_command cmd = { 0 };\r\nint err;\r\ncmd.header = mc_encode_cmd_header(DPRC_CMDID_GET_CONT_ID,\r\ncmd_flags,\r\n0);\r\nerr = mc_send_command(mc_io, &cmd);\r\nif (err)\r\nreturn err;\r\n*container_id = (int)mc_cmd_read_object_id(&cmd);\r\nreturn 0;\r\n}
