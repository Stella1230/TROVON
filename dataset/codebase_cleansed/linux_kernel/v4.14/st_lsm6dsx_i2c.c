static int st_lsm6dsx_i2c_read(struct device *dev, u8 addr, int len, u8 *data)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nstruct i2c_msg msg[2];\r\nmsg[0].addr = client->addr;\r\nmsg[0].flags = client->flags;\r\nmsg[0].len = 1;\r\nmsg[0].buf = &addr;\r\nmsg[1].addr = client->addr;\r\nmsg[1].flags = client->flags | I2C_M_RD;\r\nmsg[1].len = len;\r\nmsg[1].buf = data;\r\nreturn i2c_transfer(client->adapter, msg, 2);\r\n}\r\nstatic int st_lsm6dsx_i2c_write(struct device *dev, u8 addr, int len, u8 *data)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nstruct i2c_msg msg;\r\nu8 send[len + 1];\r\nsend[0] = addr;\r\nmemcpy(&send[1], data, len * sizeof(u8));\r\nmsg.addr = client->addr;\r\nmsg.flags = client->flags;\r\nmsg.len = len + 1;\r\nmsg.buf = send;\r\nreturn i2c_transfer(client->adapter, &msg, 1);\r\n}\r\nstatic int st_lsm6dsx_i2c_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nreturn st_lsm6dsx_probe(&client->dev, client->irq,\r\n(int)id->driver_data, id->name,\r\n&st_lsm6dsx_transfer_fn);\r\n}
