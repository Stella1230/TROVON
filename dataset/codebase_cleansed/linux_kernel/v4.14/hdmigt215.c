void\r\ngt215_hdmi_ctrl(struct nvkm_ior *ior, int head, bool enable, u8 max_ac_packet,\r\nu8 rekey, u8 *avi, u8 avi_size, u8 *vendor, u8 vendor_size)\r\n{\r\nstruct nvkm_device *device = ior->disp->engine.subdev.device;\r\nconst u32 ctrl = 0x40000000 * enable |\r\n0x1f000000 |\r\nmax_ac_packet << 16 |\r\nrekey;\r\nconst u32 soff = nv50_ior_base(ior);\r\nstruct packed_hdmi_infoframe avi_infoframe;\r\nstruct packed_hdmi_infoframe vendor_infoframe;\r\npack_hdmi_infoframe(&avi_infoframe, avi, avi_size);\r\npack_hdmi_infoframe(&vendor_infoframe, vendor, vendor_size);\r\nif (!(ctrl & 0x40000000)) {\r\nnvkm_mask(device, 0x61c5a4 + soff, 0x40000000, 0x00000000);\r\nnvkm_mask(device, 0x61c53c + soff, 0x00000001, 0x00000000);\r\nnvkm_mask(device, 0x61c520 + soff, 0x00000001, 0x00000000);\r\nnvkm_mask(device, 0x61c500 + soff, 0x00000001, 0x00000000);\r\nreturn;\r\n}\r\nnvkm_mask(device, 0x61c520 + soff, 0x00000001, 0x00000000);\r\nif (avi_size) {\r\nnvkm_wr32(device, 0x61c528 + soff, avi_infoframe.header);\r\nnvkm_wr32(device, 0x61c52c + soff, avi_infoframe.subpack0_low);\r\nnvkm_wr32(device, 0x61c530 + soff, avi_infoframe.subpack0_high);\r\nnvkm_wr32(device, 0x61c534 + soff, avi_infoframe.subpack1_low);\r\nnvkm_wr32(device, 0x61c538 + soff, avi_infoframe.subpack1_high);\r\nnvkm_mask(device, 0x61c520 + soff, 0x00000001, 0x00000001);\r\n}\r\nnvkm_mask(device, 0x61c500 + soff, 0x00000001, 0x00000000);\r\nnvkm_wr32(device, 0x61c508 + soff, 0x000a0184);\r\nnvkm_wr32(device, 0x61c50c + soff, 0x00000071);\r\nnvkm_wr32(device, 0x61c510 + soff, 0x00000000);\r\nnvkm_mask(device, 0x61c500 + soff, 0x00000001, 0x00000001);\r\nnvkm_mask(device, 0x61c53c + soff, 0x00010001, 0x00010000);\r\nif (vendor_size) {\r\nnvkm_wr32(device, 0x61c544 + soff, vendor_infoframe.header);\r\nnvkm_wr32(device, 0x61c548 + soff, vendor_infoframe.subpack0_low);\r\nnvkm_wr32(device, 0x61c54c + soff, vendor_infoframe.subpack0_high);\r\nnvkm_mask(device, 0x61c53c + soff, 0x00010001, 0x00010001);\r\n}\r\nnvkm_mask(device, 0x61c5d0 + soff, 0x00070001, 0x00010001);\r\nnvkm_mask(device, 0x61c568 + soff, 0x00010101, 0x00000000);\r\nnvkm_mask(device, 0x61c578 + soff, 0x80000000, 0x80000000);\r\nnvkm_mask(device, 0x61733c, 0x00100000, 0x00100000);\r\nnvkm_mask(device, 0x61733c, 0x10000000, 0x10000000);\r\nnvkm_mask(device, 0x61733c, 0x00100000, 0x00000000);\r\nnvkm_mask(device, 0x61c5a4 + soff, 0x5f1f007f, ctrl);\r\n}
