void ia_css_debug_dtrace(unsigned int level, const char *fmt, ...)\r\n{\r\nva_list ap;\r\nva_start(ap, fmt);\r\nia_css_debug_vdtrace(level, fmt, ap);\r\nva_end(ap);\r\n}\r\nstatic void debug_dump_long_array_formatted(\r\nconst sp_ID_t sp_id,\r\nhrt_address stack_sp_addr,\r\nunsigned stack_size)\r\n{\r\nunsigned int i;\r\nuint32_t val;\r\nuint32_t addr = (uint32_t) stack_sp_addr;\r\nuint32_t stack_size_words = CEIL_DIV(stack_size, sizeof(uint32_t));\r\nfor (i = 0; i < stack_size_words; i++) {\r\nval = sp_dmem_load_uint32(sp_id, (hrt_address)addr);\r\nif ((i%8) == 0)\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "\n");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "0x%08x ", val);\r\naddr += sizeof(uint32_t);\r\n}\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "\n");\r\n}\r\nstatic void debug_dump_sp_stack_info(\r\nconst sp_ID_t sp_id)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nunsigned int HIVE_ADDR_sp_threads_stack;\r\nunsigned int HIVE_ADDR_sp_threads_stack_size;\r\nuint32_t stack_sizes[MAX_THREAD_NUM];\r\nuint32_t stack_sp_addr[MAX_THREAD_NUM];\r\nunsigned int i;\r\nfw = &sh_css_sp_fw;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "sp_id(%u) stack info\n", sp_id);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"from objects stack_addr_offset:0x%x stack_size_offset:0x%x\n",\r\nfw->info.sp.threads_stack,\r\nfw->info.sp.threads_stack_size);\r\nHIVE_ADDR_sp_threads_stack = fw->info.sp.threads_stack;\r\nHIVE_ADDR_sp_threads_stack_size = fw->info.sp.threads_stack_size;\r\nif (fw->info.sp.threads_stack == 0 ||\r\nfw->info.sp.threads_stack_size == 0)\r\nreturn;\r\n(void) HIVE_ADDR_sp_threads_stack;\r\n(void) HIVE_ADDR_sp_threads_stack_size;\r\nsp_dmem_load(sp_id,\r\n(unsigned int)sp_address_of(sp_threads_stack),\r\n&stack_sp_addr, sizeof(stack_sp_addr));\r\nsp_dmem_load(sp_id,\r\n(unsigned int)sp_address_of(sp_threads_stack_size),\r\n&stack_sizes, sizeof(stack_sizes));\r\nfor (i = 0 ; i < MAX_THREAD_NUM; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"thread: %u stack_addr: 0x%08x stack_size: %u\n",\r\ni, stack_sp_addr[i], stack_sizes[i]);\r\ndebug_dump_long_array_formatted(sp_id, (hrt_address)stack_sp_addr[i],\r\nstack_sizes[i]);\r\n}\r\n}\r\nvoid ia_css_debug_dump_sp_stack_info(void)\r\n{\r\ndebug_dump_sp_stack_info(SP0_ID);\r\n}\r\nvoid ia_css_debug_set_dtrace_level(const unsigned int trace_level)\r\n{\r\nia_css_debug_trace_level = trace_level;\r\nreturn;\r\n}\r\nunsigned int ia_css_debug_get_dtrace_level(void)\r\n{\r\nreturn ia_css_debug_trace_level;\r\n}\r\nstatic const char *debug_stream_format2str(const enum ia_css_stream_format stream_format)\r\n{\r\nswitch (stream_format) {\r\ncase IA_CSS_STREAM_FORMAT_YUV420_8_LEGACY:\r\nreturn "yuv420-8-legacy";\r\ncase IA_CSS_STREAM_FORMAT_YUV420_8:\r\nreturn "yuv420-8";\r\ncase IA_CSS_STREAM_FORMAT_YUV420_10:\r\nreturn "yuv420-10";\r\ncase IA_CSS_STREAM_FORMAT_YUV420_16:\r\nreturn "yuv420-16";\r\ncase IA_CSS_STREAM_FORMAT_YUV422_8:\r\nreturn "yuv422-8";\r\ncase IA_CSS_STREAM_FORMAT_YUV422_10:\r\nreturn "yuv422-10";\r\ncase IA_CSS_STREAM_FORMAT_YUV422_16:\r\nreturn "yuv422-16";\r\ncase IA_CSS_STREAM_FORMAT_RGB_444:\r\nreturn "rgb444";\r\ncase IA_CSS_STREAM_FORMAT_RGB_555:\r\nreturn "rgb555";\r\ncase IA_CSS_STREAM_FORMAT_RGB_565:\r\nreturn "rgb565";\r\ncase IA_CSS_STREAM_FORMAT_RGB_666:\r\nreturn "rgb666";\r\ncase IA_CSS_STREAM_FORMAT_RGB_888:\r\nreturn "rgb888";\r\ncase IA_CSS_STREAM_FORMAT_RAW_6:\r\nreturn "raw6";\r\ncase IA_CSS_STREAM_FORMAT_RAW_7:\r\nreturn "raw7";\r\ncase IA_CSS_STREAM_FORMAT_RAW_8:\r\nreturn "raw8";\r\ncase IA_CSS_STREAM_FORMAT_RAW_10:\r\nreturn "raw10";\r\ncase IA_CSS_STREAM_FORMAT_RAW_12:\r\nreturn "raw12";\r\ncase IA_CSS_STREAM_FORMAT_RAW_14:\r\nreturn "raw14";\r\ncase IA_CSS_STREAM_FORMAT_RAW_16:\r\nreturn "raw16";\r\ncase IA_CSS_STREAM_FORMAT_BINARY_8:\r\nreturn "binary8";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT1:\r\nreturn "generic-short1";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT2:\r\nreturn "generic-short2";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT3:\r\nreturn "generic-short3";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT4:\r\nreturn "generic-short4";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT5:\r\nreturn "generic-short5";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT6:\r\nreturn "generic-short6";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT7:\r\nreturn "generic-short7";\r\ncase IA_CSS_STREAM_FORMAT_GENERIC_SHORT8:\r\nreturn "generic-short8";\r\ncase IA_CSS_STREAM_FORMAT_YUV420_8_SHIFT:\r\nreturn "yuv420-8-shift";\r\ncase IA_CSS_STREAM_FORMAT_YUV420_10_SHIFT:\r\nreturn "yuv420-10-shift";\r\ncase IA_CSS_STREAM_FORMAT_EMBEDDED:\r\nreturn "embedded-8";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF1:\r\nreturn "user-def-8-type-1";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF2:\r\nreturn "user-def-8-type-2";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF3:\r\nreturn "user-def-8-type-3";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF4:\r\nreturn "user-def-8-type-4";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF5:\r\nreturn "user-def-8-type-5";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF6:\r\nreturn "user-def-8-type-6";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF7:\r\nreturn "user-def-8-type-7";\r\ncase IA_CSS_STREAM_FORMAT_USER_DEF8:\r\nreturn "user-def-8-type-8";\r\ndefault:\r\nassert(!"Unknown stream format");\r\nreturn "unknown-stream-format";\r\n}\r\n}\r\nstatic const char *debug_frame_format2str(const enum ia_css_frame_format frame_format)\r\n{\r\nswitch (frame_format) {\r\ncase IA_CSS_FRAME_FORMAT_NV11:\r\nreturn "NV11";\r\ncase IA_CSS_FRAME_FORMAT_NV12:\r\nreturn "NV12";\r\ncase IA_CSS_FRAME_FORMAT_NV12_16:\r\nreturn "NV12_16";\r\ncase IA_CSS_FRAME_FORMAT_NV12_TILEY:\r\nreturn "NV12_TILEY";\r\ncase IA_CSS_FRAME_FORMAT_NV16:\r\nreturn "NV16";\r\ncase IA_CSS_FRAME_FORMAT_NV21:\r\nreturn "NV21";\r\ncase IA_CSS_FRAME_FORMAT_NV61:\r\nreturn "NV61";\r\ncase IA_CSS_FRAME_FORMAT_YV12:\r\nreturn "YV12";\r\ncase IA_CSS_FRAME_FORMAT_YV16:\r\nreturn "YV16";\r\ncase IA_CSS_FRAME_FORMAT_YUV420:\r\nreturn "YUV420";\r\ncase IA_CSS_FRAME_FORMAT_YUV420_16:\r\nreturn "YUV420_16";\r\ncase IA_CSS_FRAME_FORMAT_YUV422:\r\nreturn "YUV422";\r\ncase IA_CSS_FRAME_FORMAT_YUV422_16:\r\nreturn "YUV422_16";\r\ncase IA_CSS_FRAME_FORMAT_UYVY:\r\nreturn "UYVY";\r\ncase IA_CSS_FRAME_FORMAT_YUYV:\r\nreturn "YUYV";\r\ncase IA_CSS_FRAME_FORMAT_YUV444:\r\nreturn "YUV444";\r\ncase IA_CSS_FRAME_FORMAT_YUV_LINE:\r\nreturn "YUV_LINE";\r\ncase IA_CSS_FRAME_FORMAT_RAW:\r\nreturn "RAW";\r\ncase IA_CSS_FRAME_FORMAT_RGB565:\r\nreturn "RGB565";\r\ncase IA_CSS_FRAME_FORMAT_PLANAR_RGB888:\r\nreturn "PLANAR_RGB888";\r\ncase IA_CSS_FRAME_FORMAT_RGBA888:\r\nreturn "RGBA888";\r\ncase IA_CSS_FRAME_FORMAT_QPLANE6:\r\nreturn "QPLANE6";\r\ncase IA_CSS_FRAME_FORMAT_BINARY_8:\r\nreturn "BINARY_8";\r\ncase IA_CSS_FRAME_FORMAT_MIPI:\r\nreturn "MIPI";\r\ncase IA_CSS_FRAME_FORMAT_RAW_PACKED:\r\nreturn "RAW_PACKED";\r\ncase IA_CSS_FRAME_FORMAT_CSI_MIPI_YUV420_8:\r\nreturn "CSI_MIPI_YUV420_8";\r\ncase IA_CSS_FRAME_FORMAT_CSI_MIPI_LEGACY_YUV420_8:\r\nreturn "CSI_MIPI_LEGACY_YUV420_8";\r\ncase IA_CSS_FRAME_FORMAT_CSI_MIPI_YUV420_10:\r\nreturn "CSI_MIPI_YUV420_10";\r\ndefault:\r\nassert(!"Unknown frame format");\r\nreturn "unknown-frame-format";\r\n}\r\n}\r\nstatic void debug_print_sp_state(const sp_state_t *state, const char *cell)\r\n{\r\nassert(cell != NULL);\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "%s state:\n", cell);\r\nia_css_debug_dtrace(2, "\t%-32s: 0x%X\n", "PC", state->pc);\r\nia_css_debug_dtrace(2, "\t%-32s: 0x%X\n", "Status register",\r\nstate->status_register);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is broken", state->is_broken);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is idle", state->is_idle);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is sleeping",\r\nstate->is_sleeping);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is stalling",\r\nstate->is_stalling);\r\nreturn;\r\n}\r\nstatic void debug_print_isp_state(const isp_state_t *state, const char *cell)\r\n{\r\nassert(state != NULL);\r\nassert(cell != NULL);\r\nia_css_debug_dtrace(2, "%s state:\n", cell);\r\nia_css_debug_dtrace(2, "\t%-32s: 0x%X\n", "PC", state->pc);\r\nia_css_debug_dtrace(2, "\t%-32s: 0x%X\n", "Status register",\r\nstate->status_register);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is broken", state->is_broken);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is idle", state->is_idle);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is sleeping",\r\nstate->is_sleeping);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "Is stalling",\r\nstate->is_stalling);\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_isp_state(void)\r\n{\r\nisp_state_t state;\r\nisp_stall_t stall;\r\nisp_get_state(ISP0_ID, &state, &stall);\r\ndebug_print_isp_state(&state, "ISP");\r\nif (state.is_stalling) {\r\n#if !defined(HAS_NO_INPUT_FORMATTER)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"[0] if_prim_a_FIFO stalled", stall.fifo0);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"[1] if_prim_b_FIFO stalled", stall.fifo1);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "[2] dma_FIFO stalled",\r\nstall.fifo2);\r\n#if defined(HAS_ISP_2400_MAMOIADA) || defined(HAS_ISP_2401_MAMOIADA) || defined(IS_ISP_2500_SYSTEM)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "[3] gdc0_FIFO stalled",\r\nstall.fifo3);\r\n#if !defined(IS_ISP_2500_SYSTEM)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "[4] gdc1_FIFO stalled",\r\nstall.fifo4);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "[5] gpio_FIFO stalled",\r\nstall.fifo5);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "[6] sp_FIFO stalled",\r\nstall.fifo6);\r\n#else\r\n#error "ia_css_debug: ISP cell must be one of {2400_MAMOIADA,, 2401_MAMOIADA, 2500_SKYCAM}"\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"status & control stalled",\r\nstall.stat_ctrl);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "dmem stalled",\r\nstall.dmem);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "vmem stalled",\r\nstall.vmem);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "vamem1 stalled",\r\nstall.vamem1);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "vamem2 stalled",\r\nstall.vamem2);\r\n#if defined(HAS_ISP_2400_MAMOIADA) || defined(HAS_ISP_2401_MAMOIADA)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "vamem3 stalled",\r\nstall.vamem3);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "hmem stalled",\r\nstall.hmem);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "pmem stalled",\r\nstall.pmem);\r\n#endif\r\n}\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_sp_state(void)\r\n{\r\nsp_state_t state;\r\nsp_stall_t stall;\r\nsp_get_state(SP0_ID, &state, &stall);\r\ndebug_print_sp_state(&state, "SP");\r\nif (state.is_stalling) {\r\n#if defined(HAS_SP_2400) || defined(IS_ISP_2500_SYSTEM)\r\n#if !defined(HAS_NO_INPUT_SYSTEM)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "isys_FIFO stalled",\r\nstall.fifo0);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "if_sec_FIFO stalled",\r\nstall.fifo1);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"str_to_mem_FIFO stalled", stall.fifo2);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "dma_FIFO stalled",\r\nstall.fifo3);\r\n#if !defined(HAS_NO_INPUT_FORMATTER)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"if_prim_a_FIFO stalled", stall.fifo4);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "isp_FIFO stalled",\r\nstall.fifo5);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "gp_FIFO stalled",\r\nstall.fifo6);\r\n#if !defined(HAS_NO_INPUT_FORMATTER)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"if_prim_b_FIFO stalled", stall.fifo7);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "gdc0_FIFO stalled",\r\nstall.fifo8);\r\n#if !defined(IS_ISP_2500_SYSTEM)\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "gdc1_FIFO stalled",\r\nstall.fifo9);\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "irq FIFO stalled",\r\nstall.fifoa);\r\n#else\r\n#error "ia_css_debug: SP cell must be one of {SP2400, SP2500}"\r\n#endif\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "dmem stalled",\r\nstall.dmem);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"control master stalled",\r\nstall.control_master);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n",\r\n"i-cache master stalled",\r\nstall.icache_master);\r\n}\r\nia_css_debug_dump_trace();\r\nreturn;\r\n}\r\nstatic void debug_print_fifo_channel_state(const fifo_channel_state_t *state,\r\nconst char *descr)\r\n{\r\nassert(state != NULL);\r\nassert(descr != NULL);\r\nia_css_debug_dtrace(2, "FIFO channel: %s\n", descr);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "source valid",\r\nstate->src_valid);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "fifo accept",\r\nstate->fifo_accept);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "fifo valid",\r\nstate->fifo_valid);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "sink accept",\r\nstate->sink_accept);\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_pif_a_isp_fifo_state(void)\r\n{\r\nfifo_channel_state_t pif_to_isp, isp_to_pif;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_IF0_TO_ISP0, &pif_to_isp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_ISP0_TO_IF0, &isp_to_pif);\r\ndebug_print_fifo_channel_state(&pif_to_isp, "Primary IF A to ISP");\r\ndebug_print_fifo_channel_state(&isp_to_pif, "ISP to Primary IF A");\r\n}\r\nvoid ia_css_debug_dump_pif_b_isp_fifo_state(void)\r\n{\r\nfifo_channel_state_t pif_to_isp, isp_to_pif;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_IF1_TO_ISP0, &pif_to_isp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_ISP0_TO_IF1, &isp_to_pif);\r\ndebug_print_fifo_channel_state(&pif_to_isp, "Primary IF B to ISP");\r\ndebug_print_fifo_channel_state(&isp_to_pif, "ISP to Primary IF B");\r\n}\r\nvoid ia_css_debug_dump_str2mem_sp_fifo_state(void)\r\n{\r\nfifo_channel_state_t s2m_to_sp, sp_to_s2m;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_STREAM2MEM0_TO_SP0, &s2m_to_sp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_SP0_TO_STREAM2MEM0, &sp_to_s2m);\r\ndebug_print_fifo_channel_state(&s2m_to_sp, "Stream-to-memory to SP");\r\ndebug_print_fifo_channel_state(&sp_to_s2m, "SP to stream-to-memory");\r\n}\r\nstatic void debug_print_if_state(input_formatter_state_t *state, const char *id)\r\n{\r\nunsigned int val;\r\n#if defined(HAS_INPUT_FORMATTER_VERSION_1)\r\nconst char *st_reset = (state->reset ? "Active" : "Not active");\r\n#endif\r\nconst char *st_vsync_active_low =\r\n(state->vsync_active_low ? "low" : "high");\r\nconst char *st_hsync_active_low =\r\n(state->hsync_active_low ? "low" : "high");\r\nconst char *fsm_sync_status_str = "unknown";\r\nconst char *fsm_crop_status_str = "unknown";\r\nconst char *fsm_padding_status_str = "unknown";\r\nint st_stline = state->start_line;\r\nint st_stcol = state->start_column;\r\nint st_crpht = state->cropped_height;\r\nint st_crpwd = state->cropped_width;\r\nint st_verdcm = state->ver_decimation;\r\nint st_hordcm = state->hor_decimation;\r\nint st_ver_deinterleaving = state->ver_deinterleaving;\r\nint st_hor_deinterleaving = state->hor_deinterleaving;\r\nint st_leftpd = state->left_padding;\r\nint st_eoloff = state->eol_offset;\r\nint st_vmstartaddr = state->vmem_start_address;\r\nint st_vmendaddr = state->vmem_end_address;\r\nint st_vmincr = state->vmem_increment;\r\nint st_yuv420 = state->is_yuv420;\r\nint st_allow_fifo_overflow = state->allow_fifo_overflow;\r\nint st_block_fifo_when_no_req = state->block_fifo_when_no_req;\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "InputFormatter State (%s):\n", id);\r\nia_css_debug_dtrace(2, "\tConfiguration:\n");\r\n#if defined(HAS_INPUT_FORMATTER_VERSION_1)\r\nia_css_debug_dtrace(2, "\t\t%-32s: %s\n", "Software reset", st_reset);\r\n#endif\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Start line", st_stline);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Start column", st_stcol);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Cropped height", st_crpht);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Cropped width", st_crpwd);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Ver decimation", st_verdcm);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Hor decimation", st_hordcm);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Ver deinterleaving", st_ver_deinterleaving);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Hor deinterleaving", st_hor_deinterleaving);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Left padding", st_leftpd);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"EOL offset (bytes)", st_eoloff);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%06X\n",\r\n"VMEM start address", st_vmstartaddr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%06X\n",\r\n"VMEM end address", st_vmendaddr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%06X\n",\r\n"VMEM increment", st_vmincr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "YUV 420 format", st_yuv420);\r\nia_css_debug_dtrace(2, "\t\t%-32s: Active %s\n",\r\n"Vsync", st_vsync_active_low);\r\nia_css_debug_dtrace(2, "\t\t%-32s: Active %s\n",\r\n"Hsync", st_hsync_active_low);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Allow FIFO overflow", st_allow_fifo_overflow);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Block when no request", st_block_fifo_when_no_req);\r\n#if defined(HAS_INPUT_FORMATTER_VERSION_2)\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"IF_BLOCKED_FIFO_NO_REQ_ADDRESS",\r\ninput_formatter_reg_load(INPUT_FORMATTER0_ID,\r\nHIVE_IF_BLOCK_FIFO_NO_REQ_ADDRESS)\r\n);\r\nia_css_debug_dtrace(2, "\t%-32s:\n", "InputSwitch State");\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg0",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg0));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg1",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg1));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg2",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg2));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg3",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg3));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg4",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg4));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg5",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg5));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg6",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg6));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_lut_reg7",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_lut_reg7));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_input_switch_fsync_lut",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_input_switch_fsync_lut));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_srst",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_srst));\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"_REG_GP_IFMT_slv_reg_srst",\r\ngp_device_reg_load(GP_DEVICE0_ID,\r\n_REG_GP_IFMT_slv_reg_srst));\r\n#endif\r\nia_css_debug_dtrace(2, "\tFSM Status:\n");\r\nval = state->fsm_sync_status;\r\nif (val > 7)\r\nfsm_sync_status_str = "ERROR";\r\nswitch (val & 0x7) {\r\ncase 0:\r\nfsm_sync_status_str = "idle";\r\nbreak;\r\ncase 1:\r\nfsm_sync_status_str = "request frame";\r\nbreak;\r\ncase 2:\r\nfsm_sync_status_str = "request lines";\r\nbreak;\r\ncase 3:\r\nfsm_sync_status_str = "request vectors";\r\nbreak;\r\ncase 4:\r\nfsm_sync_status_str = "send acknowledge";\r\nbreak;\r\ndefault:\r\nfsm_sync_status_str = "unknown";\r\nbreak;\r\n}\r\nia_css_debug_dtrace(2, "\t\t%-32s: (0x%X: %s)\n",\r\n"FSM Synchronization Status", val,\r\nfsm_sync_status_str);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM Synchronization Counter",\r\nstate->fsm_sync_counter);\r\nval = state->fsm_crop_status;\r\nif (val > 7)\r\nfsm_crop_status_str = "ERROR";\r\nswitch (val & 0x7) {\r\ncase 0:\r\nfsm_crop_status_str = "idle";\r\nbreak;\r\ncase 1:\r\nfsm_crop_status_str = "wait line";\r\nbreak;\r\ncase 2:\r\nfsm_crop_status_str = "crop line";\r\nbreak;\r\ncase 3:\r\nfsm_crop_status_str = "crop pixel";\r\nbreak;\r\ncase 4:\r\nfsm_crop_status_str = "pass pixel";\r\nbreak;\r\ncase 5:\r\nfsm_crop_status_str = "pass line";\r\nbreak;\r\ncase 6:\r\nfsm_crop_status_str = "lost line";\r\nbreak;\r\ndefault:\r\nfsm_crop_status_str = "unknown";\r\nbreak;\r\n}\r\nia_css_debug_dtrace(2, "\t\t%-32s: (0x%X: %s)\n",\r\n"FSM Crop Status", val, fsm_crop_status_str);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM Crop Line Counter",\r\nstate->fsm_crop_line_counter);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM Crop Pixel Counter",\r\nstate->fsm_crop_pixel_counter);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM Deinterleaving idx buffer",\r\nstate->fsm_deinterleaving_index);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM H decimation counter",\r\nstate->fsm_dec_h_counter);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM V decimation counter",\r\nstate->fsm_dec_v_counter);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM block V decimation counter",\r\nstate->fsm_dec_block_v_counter);\r\nval = state->fsm_padding_status;\r\nif (val > 7)\r\nfsm_padding_status_str = "ERROR";\r\nswitch (val & 0x7) {\r\ncase 0:\r\nfsm_padding_status_str = "idle";\r\nbreak;\r\ncase 1:\r\nfsm_padding_status_str = "left pad";\r\nbreak;\r\ncase 2:\r\nfsm_padding_status_str = "write";\r\nbreak;\r\ncase 3:\r\nfsm_padding_status_str = "right pad";\r\nbreak;\r\ncase 4:\r\nfsm_padding_status_str = "send end of line";\r\nbreak;\r\ndefault:\r\nfsm_padding_status_str = "unknown";\r\nbreak;\r\n}\r\nia_css_debug_dtrace(2, "\t\t%-32s: (0x%X: %s)\n", "FSM Padding Status",\r\nval, fsm_padding_status_str);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM Padding element idx counter",\r\nstate->fsm_padding_elem_counter);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Vector support error",\r\nstate->fsm_vector_support_error);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Vector support buf full",\r\nstate->fsm_vector_buffer_full);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Vector support",\r\nstate->vector_support);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Fifo sensor data lost",\r\nstate->sensor_data_lost);\r\nreturn;\r\n}\r\nstatic void debug_print_if_bin_state(input_formatter_bin_state_t *state)\r\n{\r\nia_css_debug_dtrace(2, "Stream-to-memory state:\n");\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "reset", state->reset);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "input endianness",\r\nstate->input_endianness);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "output endianness",\r\nstate->output_endianness);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "bitswap", state->bitswap);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "block_synch",\r\nstate->block_synch);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "packet_synch",\r\nstate->packet_synch);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "readpostwrite_sync",\r\nstate->readpostwrite_synch);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "is_2ppc", state->is_2ppc);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "en_status_update",\r\nstate->en_status_update);\r\n}\r\nvoid ia_css_debug_dump_if_state(void)\r\n{\r\ninput_formatter_state_t if_state;\r\ninput_formatter_bin_state_t if_bin_state;\r\ninput_formatter_get_state(INPUT_FORMATTER0_ID, &if_state);\r\ndebug_print_if_state(&if_state, "Primary IF A");\r\nia_css_debug_dump_pif_a_isp_fifo_state();\r\ninput_formatter_get_state(INPUT_FORMATTER1_ID, &if_state);\r\ndebug_print_if_state(&if_state, "Primary IF B");\r\nia_css_debug_dump_pif_b_isp_fifo_state();\r\ninput_formatter_bin_get_state(INPUT_FORMATTER3_ID, &if_bin_state);\r\ndebug_print_if_bin_state(&if_bin_state);\r\nia_css_debug_dump_str2mem_sp_fifo_state();\r\n}\r\nvoid ia_css_debug_dump_dma_state(void)\r\n{\r\nstatic dma_state_t state;\r\nint i, ch_id;\r\nconst char *fsm_cmd_st_lbl = "FSM Command flag state";\r\nconst char *fsm_ctl_st_lbl = "FSM Control flag state";\r\nconst char *fsm_ctl_state = NULL;\r\nconst char *fsm_ctl_flag = NULL;\r\nconst char *fsm_pack_st = NULL;\r\nconst char *fsm_read_st = NULL;\r\nconst char *fsm_write_st = NULL;\r\nchar last_cmd_str[64];\r\ndma_get_state(DMA0_ID, &state);\r\nia_css_debug_dtrace(2, "DMA dump status:\n");\r\nif (state.fsm_command_idle)\r\nia_css_debug_dtrace(2, "\t%-32s: %s\n", fsm_cmd_st_lbl, "IDLE");\r\nif (state.fsm_command_run)\r\nia_css_debug_dtrace(2, "\t%-32s: %s\n", fsm_cmd_st_lbl, "RUN");\r\nif (state.fsm_command_stalling)\r\nia_css_debug_dtrace(2, "\t%-32s: %s\n", fsm_cmd_st_lbl,\r\n"STALL");\r\nif (state.fsm_command_error)\r\nia_css_debug_dtrace(2, "\t%-32s: %s\n", fsm_cmd_st_lbl,\r\n"ERROR");\r\nch_id = state.last_command_channel;\r\nswitch (state.last_command) {\r\ncase DMA_COMMAND_READ:\r\nsnprintf(last_cmd_str, 64,\r\n"Read 2D Block [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_WRITE:\r\nsnprintf(last_cmd_str, 64,\r\n"Write 2D Block [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_SET_CHANNEL:\r\nsnprintf(last_cmd_str, 64, "Set Channel [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_SET_PARAM:\r\nsnprintf(last_cmd_str, 64,\r\n"Set Param: %d [Channel: %d]",\r\nstate.last_command_param, ch_id);\r\nbreak;\r\ncase DMA_COMMAND_READ_SPECIFIC:\r\nsnprintf(last_cmd_str, 64,\r\n"Read Specific 2D Block [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_WRITE_SPECIFIC:\r\nsnprintf(last_cmd_str, 64,\r\n"Write Specific 2D Block [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_INIT:\r\nsnprintf(last_cmd_str, 64,\r\n"Init 2D Block on Device A [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_INIT_SPECIFIC:\r\nsnprintf(last_cmd_str, 64,\r\n"Init Specific 2D Block [Channel: %d]", ch_id);\r\nbreak;\r\ncase DMA_COMMAND_RST:\r\nsnprintf(last_cmd_str, 64, "DMA SW Reset");\r\nbreak;\r\ncase N_DMA_COMMANDS:\r\nsnprintf(last_cmd_str, 64, "UNKNOWN");\r\nbreak;\r\ndefault:\r\nsnprintf(last_cmd_str, 64,\r\n"unknown [Channel: %d]", ch_id);\r\nbreak;\r\n}\r\nia_css_debug_dtrace(2, "\t%-32s: (0x%X : %s)\n",\r\n"last command received", state.last_command,\r\nlast_cmd_str);\r\nia_css_debug_dtrace(2, "\t%-32s\n",\r\n"DMA registers, connection group 0");\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "Cmd Fifo Command",\r\nstate.current_command);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "Cmd Fifo Address A",\r\nstate.current_addr_a);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "Cmd Fifo Address B",\r\nstate.current_addr_b);\r\nif (state.fsm_ctrl_idle)\r\nfsm_ctl_flag = "IDLE";\r\nelse if (state.fsm_ctrl_run)\r\nfsm_ctl_flag = "RUN";\r\nelse if (state.fsm_ctrl_stalling)\r\nfsm_ctl_flag = "STAL";\r\nelse if (state.fsm_ctrl_error)\r\nfsm_ctl_flag = "ERROR";\r\nelse\r\nfsm_ctl_flag = "UNKNOWN";\r\nswitch (state.fsm_ctrl_state) {\r\ncase DMA_CTRL_STATE_IDLE:\r\nfsm_ctl_state = "Idle state";\r\nbreak;\r\ncase DMA_CTRL_STATE_REQ_RCV:\r\nfsm_ctl_state = "Req Rcv state";\r\nbreak;\r\ncase DMA_CTRL_STATE_RCV:\r\nfsm_ctl_state = "Rcv state";\r\nbreak;\r\ncase DMA_CTRL_STATE_RCV_REQ:\r\nfsm_ctl_state = "Rcv Req state";\r\nbreak;\r\ncase DMA_CTRL_STATE_INIT:\r\nfsm_ctl_state = "Init state";\r\nbreak;\r\ncase N_DMA_CTRL_STATES:\r\nfsm_ctl_state = "Unknown";\r\nbreak;\r\n}\r\nia_css_debug_dtrace(2, "\t\t%-32s: %s -> %s\n", fsm_ctl_st_lbl,\r\nfsm_ctl_flag, fsm_ctl_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl source dev",\r\nstate.fsm_ctrl_source_dev);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "FSM Ctrl source addr",\r\nstate.fsm_ctrl_source_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "FSM Ctrl source stride",\r\nstate.fsm_ctrl_source_stride);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl source width",\r\nstate.fsm_ctrl_source_width);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl source height",\r\nstate.fsm_ctrl_source_height);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack source dev",\r\nstate.fsm_ctrl_pack_source_dev);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack dest dev",\r\nstate.fsm_ctrl_pack_dest_dev);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "FSM Ctrl dest addr",\r\nstate.fsm_ctrl_dest_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "FSM Ctrl dest stride",\r\nstate.fsm_ctrl_dest_stride);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack source width",\r\nstate.fsm_ctrl_pack_source_width);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack dest height",\r\nstate.fsm_ctrl_pack_dest_height);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack dest width",\r\nstate.fsm_ctrl_pack_dest_width);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack source elems",\r\nstate.fsm_ctrl_pack_source_elems);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack dest elems",\r\nstate.fsm_ctrl_pack_dest_elems);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Ctrl pack extension",\r\nstate.fsm_ctrl_pack_extension);\r\nif (state.pack_idle)\r\nfsm_pack_st = "IDLE";\r\nif (state.pack_run)\r\nfsm_pack_st = "RUN";\r\nif (state.pack_stalling)\r\nfsm_pack_st = "STALL";\r\nif (state.pack_error)\r\nfsm_pack_st = "ERROR";\r\nia_css_debug_dtrace(2, "\t\t%-32s: %s\n", "FSM Pack flag state",\r\nfsm_pack_st);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Pack cnt height",\r\nstate.pack_cnt_height);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Pack src cnt width",\r\nstate.pack_src_cnt_width);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Pack dest cnt width",\r\nstate.pack_dest_cnt_width);\r\nif (state.read_state == DMA_RW_STATE_IDLE)\r\nfsm_read_st = "Idle state";\r\nif (state.read_state == DMA_RW_STATE_REQ)\r\nfsm_read_st = "Req state";\r\nif (state.read_state == DMA_RW_STATE_NEXT_LINE)\r\nfsm_read_st = "Next line";\r\nif (state.read_state == DMA_RW_STATE_UNLOCK_CHANNEL)\r\nfsm_read_st = "Unlock channel";\r\nia_css_debug_dtrace(2, "\t\t%-32s: %s\n", "FSM Read state",\r\nfsm_read_st);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Read cnt height",\r\nstate.read_cnt_height);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Read cnt width",\r\nstate.read_cnt_width);\r\nif (state.write_state == DMA_RW_STATE_IDLE)\r\nfsm_write_st = "Idle state";\r\nif (state.write_state == DMA_RW_STATE_REQ)\r\nfsm_write_st = "Req state";\r\nif (state.write_state == DMA_RW_STATE_NEXT_LINE)\r\nfsm_write_st = "Next line";\r\nif (state.write_state == DMA_RW_STATE_UNLOCK_CHANNEL)\r\nfsm_write_st = "Unlock channel";\r\nia_css_debug_dtrace(2, "\t\t%-32s: %s\n", "FSM Write state",\r\nfsm_write_st);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Write height",\r\nstate.write_height);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "FSM Write width",\r\nstate.write_width);\r\nfor (i = 0; i < HIVE_ISP_NUM_DMA_CONNS; i++) {\r\ndma_port_state_t *port = &(state.port_states[i]);\r\nia_css_debug_dtrace(2, "\tDMA device interface %d\n", i);\r\nia_css_debug_dtrace(2, "\t\tDMA internal side state\n");\r\nia_css_debug_dtrace(2,\r\n"\t\t\tCS:%d - We_n:%d - Run:%d - Ack:%d\n",\r\nport->req_cs, port->req_we_n, port->req_run,\r\nport->req_ack);\r\nia_css_debug_dtrace(2, "\t\tMaster Output side state\n");\r\nia_css_debug_dtrace(2,\r\n"\t\t\tCS:%d - We_n:%d - Run:%d - Ack:%d\n",\r\nport->send_cs, port->send_we_n,\r\nport->send_run, port->send_ack);\r\nia_css_debug_dtrace(2, "\t\tFifo state\n");\r\nif (port->fifo_state == DMA_FIFO_STATE_WILL_BE_FULL)\r\nia_css_debug_dtrace(2, "\t\t\tFiFo will be full\n");\r\nelse if (port->fifo_state == DMA_FIFO_STATE_FULL)\r\nia_css_debug_dtrace(2, "\t\t\tFifo Full\n");\r\nelse if (port->fifo_state == DMA_FIFO_STATE_EMPTY)\r\nia_css_debug_dtrace(2, "\t\t\tFifo Empty\n");\r\nelse\r\nia_css_debug_dtrace(2, "\t\t\tFifo state unknown\n");\r\nia_css_debug_dtrace(2, "\t\tFifo counter %d\n\n",\r\nport->fifo_counter);\r\n}\r\nfor (i = 0; i < HIVE_DMA_NUM_CHANNELS; i++) {\r\ndma_channel_state_t *ch = &(state.channel_states[i]);\r\nia_css_debug_dtrace(2, "\t%-32s: %d\n", "DMA channel register",\r\ni);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Connection",\r\nch->connection);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Sign extend",\r\nch->sign_extend);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "Stride Dev A",\r\nch->stride_a);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Elems Dev A",\r\nch->elems_a);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Cropping Dev A",\r\nch->cropping_a);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Width Dev A",\r\nch->width_a);\r\nia_css_debug_dtrace(2, "\t\t%-32s: 0x%X\n", "Stride Dev B",\r\nch->stride_b);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Elems Dev B",\r\nch->elems_b);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Cropping Dev B",\r\nch->cropping_b);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Width Dev B",\r\nch->width_b);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "Height", ch->height);\r\n}\r\nia_css_debug_dtrace(2, "\n");\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_dma_sp_fifo_state(void)\r\n{\r\nfifo_channel_state_t dma_to_sp, sp_to_dma;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_DMA0_TO_SP0, &dma_to_sp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_SP0_TO_DMA0, &sp_to_dma);\r\ndebug_print_fifo_channel_state(&dma_to_sp, "DMA to SP");\r\ndebug_print_fifo_channel_state(&sp_to_dma, "SP to DMA");\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_dma_isp_fifo_state(void)\r\n{\r\nfifo_channel_state_t dma_to_isp, isp_to_dma;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_DMA0_TO_ISP0, &dma_to_isp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_ISP0_TO_DMA0, &isp_to_dma);\r\ndebug_print_fifo_channel_state(&dma_to_isp, "DMA to ISP");\r\ndebug_print_fifo_channel_state(&isp_to_dma, "ISP to DMA");\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_isp_sp_fifo_state(void)\r\n{\r\nfifo_channel_state_t sp_to_isp, isp_to_sp;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_SP0_TO_ISP0, &sp_to_isp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_ISP0_TO_SP0, &isp_to_sp);\r\ndebug_print_fifo_channel_state(&sp_to_isp, "SP to ISP");\r\ndebug_print_fifo_channel_state(&isp_to_sp, "ISP to SP");\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_isp_gdc_fifo_state(void)\r\n{\r\nfifo_channel_state_t gdc_to_isp, isp_to_gdc;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_GDC0_TO_ISP0, &gdc_to_isp);\r\nfifo_channel_get_state(FIFO_MONITOR0_ID,\r\nFIFO_CHANNEL_ISP0_TO_GDC0, &isp_to_gdc);\r\ndebug_print_fifo_channel_state(&gdc_to_isp, "GDC to ISP");\r\ndebug_print_fifo_channel_state(&isp_to_gdc, "ISP to GDC");\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_all_fifo_state(void)\r\n{\r\nint i;\r\nfifo_monitor_state_t state;\r\nfifo_monitor_get_state(FIFO_MONITOR0_ID, &state);\r\nfor (i = 0; i < N_FIFO_CHANNEL; i++)\r\ndebug_print_fifo_channel_state(&(state.fifo_channels[i]),\r\n"squepfstqkt");\r\nreturn;\r\n}\r\nstatic void debug_binary_info_print(const struct ia_css_binary_xinfo *info)\r\n{\r\nassert(info != NULL);\r\nia_css_debug_dtrace(2, "id = %d\n", info->sp.id);\r\nia_css_debug_dtrace(2, "mode = %d\n", info->sp.pipeline.mode);\r\nia_css_debug_dtrace(2, "max_input_width = %d\n", info->sp.input.max_width);\r\nia_css_debug_dtrace(2, "min_output_width = %d\n",\r\ninfo->sp.output.min_width);\r\nia_css_debug_dtrace(2, "max_output_width = %d\n",\r\ninfo->sp.output.max_width);\r\nia_css_debug_dtrace(2, "top_cropping = %d\n", info->sp.pipeline.top_cropping);\r\nia_css_debug_dtrace(2, "left_cropping = %d\n", info->sp.pipeline.left_cropping);\r\nia_css_debug_dtrace(2, "xmem_addr = %d\n", info->xmem_addr);\r\nia_css_debug_dtrace(2, "enable_vf_veceven = %d\n",\r\ninfo->sp.enable.vf_veceven);\r\nia_css_debug_dtrace(2, "enable_dis = %d\n", info->sp.enable.dis);\r\nia_css_debug_dtrace(2, "enable_uds = %d\n", info->sp.enable.uds);\r\nia_css_debug_dtrace(2, "enable ds = %d\n", info->sp.enable.ds);\r\nia_css_debug_dtrace(2, "s3atbl_use_dmem = %d\n", info->sp.s3a.s3atbl_use_dmem);\r\nreturn;\r\n}\r\nvoid ia_css_debug_binary_print(const struct ia_css_binary *bi)\r\n{\r\nunsigned int i;\r\ndebug_binary_info_print(bi->info);\r\nia_css_debug_dtrace(2,\r\n"input: %dx%d, format = %d, padded width = %d\n",\r\nbi->in_frame_info.res.width,\r\nbi->in_frame_info.res.height,\r\nbi->in_frame_info.format,\r\nbi->in_frame_info.padded_width);\r\nia_css_debug_dtrace(2,\r\n"internal :%dx%d, format = %d, padded width = %d\n",\r\nbi->internal_frame_info.res.width,\r\nbi->internal_frame_info.res.height,\r\nbi->internal_frame_info.format,\r\nbi->internal_frame_info.padded_width);\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++) {\r\nif (bi->out_frame_info[i].res.width != 0) {\r\nia_css_debug_dtrace(2,\r\n"out%d: %dx%d, format = %d, padded width = %d\n",\r\ni,\r\nbi->out_frame_info[i].res.width,\r\nbi->out_frame_info[i].res.height,\r\nbi->out_frame_info[i].format,\r\nbi->out_frame_info[i].padded_width);\r\n}\r\n}\r\nia_css_debug_dtrace(2,\r\n"vf out: %dx%d, format = %d, padded width = %d\n",\r\nbi->vf_frame_info.res.width,\r\nbi->vf_frame_info.res.height,\r\nbi->vf_frame_info.format,\r\nbi->vf_frame_info.padded_width);\r\nia_css_debug_dtrace(2, "online = %d\n", bi->online);\r\nia_css_debug_dtrace(2, "input_buf_vectors = %d\n",\r\nbi->input_buf_vectors);\r\nia_css_debug_dtrace(2, "deci_factor_log2 = %d\n", bi->deci_factor_log2);\r\nia_css_debug_dtrace(2, "vf_downscale_log2 = %d\n",\r\nbi->vf_downscale_log2);\r\nia_css_debug_dtrace(2, "dis_deci_factor_log2 = %d\n",\r\nbi->dis.deci_factor_log2);\r\nia_css_debug_dtrace(2, "dis hor coef num = %d\n",\r\nbi->dis.coef.pad.width);\r\nia_css_debug_dtrace(2, "dis ver coef num = %d\n",\r\nbi->dis.coef.pad.height);\r\nia_css_debug_dtrace(2, "dis hor proj num = %d\n",\r\nbi->dis.proj.pad.height);\r\nia_css_debug_dtrace(2, "sctbl_width_per_color = %d\n",\r\nbi->sctbl_width_per_color);\r\nia_css_debug_dtrace(2, "s3atbl_width = %d\n", bi->s3atbl_width);\r\nia_css_debug_dtrace(2, "s3atbl_height = %d\n", bi->s3atbl_height);\r\nreturn;\r\n}\r\nvoid ia_css_debug_frame_print(const struct ia_css_frame *frame,\r\nconst char *descr)\r\n{\r\nchar *data = NULL;\r\nassert(frame != NULL);\r\nassert(descr != NULL);\r\ndata = (char *)HOST_ADDRESS(frame->data);\r\nia_css_debug_dtrace(2, "frame %s (%p):\n", descr, frame);\r\nia_css_debug_dtrace(2, " resolution = %dx%d\n",\r\nframe->info.res.width, frame->info.res.height);\r\nia_css_debug_dtrace(2, " padded width = %d\n",\r\nframe->info.padded_width);\r\nia_css_debug_dtrace(2, " format = %d\n", frame->info.format);\r\nia_css_debug_dtrace(2, " is contiguous = %s\n",\r\nframe->contiguous ? "yes" : "no");\r\nswitch (frame->info.format) {\r\ncase IA_CSS_FRAME_FORMAT_NV12:\r\ncase IA_CSS_FRAME_FORMAT_NV16:\r\ncase IA_CSS_FRAME_FORMAT_NV21:\r\ncase IA_CSS_FRAME_FORMAT_NV61:\r\nia_css_debug_dtrace(2, " Y = %p\n",\r\ndata + frame->planes.nv.y.offset);\r\nia_css_debug_dtrace(2, " UV = %p\n",\r\ndata + frame->planes.nv.uv.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_YUYV:\r\ncase IA_CSS_FRAME_FORMAT_UYVY:\r\ncase IA_CSS_FRAME_FORMAT_CSI_MIPI_YUV420_8:\r\ncase IA_CSS_FRAME_FORMAT_CSI_MIPI_LEGACY_YUV420_8:\r\ncase IA_CSS_FRAME_FORMAT_YUV_LINE:\r\nia_css_debug_dtrace(2, " YUYV = %p\n",\r\ndata + frame->planes.yuyv.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_YUV420:\r\ncase IA_CSS_FRAME_FORMAT_YUV422:\r\ncase IA_CSS_FRAME_FORMAT_YUV444:\r\ncase IA_CSS_FRAME_FORMAT_YV12:\r\ncase IA_CSS_FRAME_FORMAT_YV16:\r\ncase IA_CSS_FRAME_FORMAT_YUV420_16:\r\ncase IA_CSS_FRAME_FORMAT_YUV422_16:\r\nia_css_debug_dtrace(2, " Y = %p\n",\r\ndata + frame->planes.yuv.y.offset);\r\nia_css_debug_dtrace(2, " U = %p\n",\r\ndata + frame->planes.yuv.u.offset);\r\nia_css_debug_dtrace(2, " V = %p\n",\r\ndata + frame->planes.yuv.v.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_RAW_PACKED:\r\nia_css_debug_dtrace(2, " RAW PACKED = %p\n",\r\ndata + frame->planes.raw.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_RAW:\r\nia_css_debug_dtrace(2, " RAW = %p\n",\r\ndata + frame->planes.raw.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_RGBA888:\r\ncase IA_CSS_FRAME_FORMAT_RGB565:\r\nia_css_debug_dtrace(2, " RGB = %p\n",\r\ndata + frame->planes.rgb.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_QPLANE6:\r\nia_css_debug_dtrace(2, " R = %p\n",\r\ndata + frame->planes.plane6.r.offset);\r\nia_css_debug_dtrace(2, " RatB = %p\n",\r\ndata + frame->planes.plane6.r_at_b.offset);\r\nia_css_debug_dtrace(2, " Gr = %p\n",\r\ndata + frame->planes.plane6.gr.offset);\r\nia_css_debug_dtrace(2, " Gb = %p\n",\r\ndata + frame->planes.plane6.gb.offset);\r\nia_css_debug_dtrace(2, " B = %p\n",\r\ndata + frame->planes.plane6.b.offset);\r\nia_css_debug_dtrace(2, " BatR = %p\n",\r\ndata + frame->planes.plane6.b_at_r.offset);\r\nbreak;\r\ncase IA_CSS_FRAME_FORMAT_BINARY_8:\r\nia_css_debug_dtrace(2, " Binary data = %p\n",\r\ndata + frame->planes.binary.data.offset);\r\nbreak;\r\ndefault:\r\nia_css_debug_dtrace(2, " unknown frame type\n");\r\nbreak;\r\n}\r\nreturn;\r\n}\r\nvoid ia_css_debug_print_sp_debug_state(const struct sh_css_sp_debug_state\r\n*state)\r\n{\r\n#endif\r\n#if SP_DEBUG == SP_DEBUG_DUMP\r\nassert(state != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"current SP software counter: %d\n",\r\nstate->debug[0]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty output buffer queue head: 0x%x\n",\r\nstate->debug[1]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty output buffer queue tail: 0x%x\n",\r\nstate->debug[2]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a buffer queue head: 0x%x\n",\r\nstate->debug[3]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a buffer queue tail: 0x%x\n",\r\nstate->debug[4]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"full output buffer queue head: 0x%x\n",\r\nstate->debug[5]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"full output buffer queue tail: 0x%x\n",\r\nstate->debug[6]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"full s3a buffer queue head: 0x%x\n",\r\nstate->debug[7]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"full s3a buffer queue tail: 0x%x\n",\r\nstate->debug[8]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "event queue head: 0x%x\n",\r\nstate->debug[9]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "event queue tail: 0x%x\n",\r\nstate->debug[10]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"num of stages of current pipeline: 0x%x\n",\r\nstate->debug[11]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "DDR address of stage 1: 0x%x\n",\r\nstate->debug[12]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "DDR address of stage 2: 0x%x\n",\r\nstate->debug[13]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"current stage out_vf buffer idx: 0x%x\n",\r\nstate->debug[14]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"current stage output buffer idx: 0x%x\n",\r\nstate->debug[15]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"current stage s3a buffer idx: 0x%x\n",\r\nstate->debug[16]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first char of current stage name: 0x%x\n",\r\nstate->debug[17]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "current SP thread id: 0x%x\n",\r\nstate->debug[18]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty output buffer address 1: 0x%x\n",\r\nstate->debug[19]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty output buffer address 2: 0x%x\n",\r\nstate->debug[20]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty out_vf buffer address 1: 0x%x\n",\r\nstate->debug[21]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty out_vf buffer address 2: 0x%x\n",\r\nstate->debug[22]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a_hi buffer address 1: 0x%x\n",\r\nstate->debug[23]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a_hi buffer address 2: 0x%x\n",\r\nstate->debug[24]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a_lo buffer address 1: 0x%x\n",\r\nstate->debug[25]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty s3a_lo buffer address 2: 0x%x\n",\r\nstate->debug[26]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty dis_hor buffer address 1: 0x%x\n",\r\nstate->debug[27]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty dis_hor buffer address 2: 0x%x\n",\r\nstate->debug[28]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty dis_ver buffer address 1: 0x%x\n",\r\nstate->debug[29]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty dis_ver buffer address 2: 0x%x\n",\r\nstate->debug[30]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"empty param buffer address: 0x%x\n",\r\nstate->debug[31]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect frame address: 0x%x\n",\r\nstate->debug[32]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect frame container address: 0x%x\n",\r\nstate->debug[33]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect frame container payload: 0x%x\n",\r\nstate->debug[34]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_hi address: 0x%x\n",\r\nstate->debug[35]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_hi container address: 0x%x\n",\r\nstate->debug[36]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_hi container payload: 0x%x\n",\r\nstate->debug[37]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_lo address: 0x%x\n",\r\nstate->debug[38]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_lo container address: 0x%x\n",\r\nstate->debug[39]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"first incorrect s3a_lo container payload: 0x%x\n",\r\nstate->debug[40]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"number of calling flash start function: 0x%x\n",\r\nstate->debug[41]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"number of calling flash close function: 0x%x\n",\r\nstate->debug[42]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "number of flashed frame: 0x%x\n",\r\nstate->debug[43]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "flash in use flag: 0x%x\n",\r\nstate->debug[44]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"number of update frame flashed flag: 0x%x\n",\r\nstate->debug[46]);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"number of active threads: 0x%x\n",\r\nstate->debug[45]);\r\n#elif SP_DEBUG == SP_DEBUG_COPY\r\nstatic int last_index;\r\nint sp_index = state->index;\r\nint n;\r\nassert(state != NULL);\r\nif (sp_index < last_index) {\r\nlast_index = 0;\r\n}\r\nif (last_index == 0) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"copy-trace init: sp_dbg_if_start_line=%d, "\r\n"sp_dbg_if_start_column=%d, "\r\n"sp_dbg_if_cropped_height=%d, "\r\n"sp_debg_if_cropped_width=%d\n",\r\nstate->if_start_line,\r\nstate->if_start_column,\r\nstate->if_cropped_height,\r\nstate->if_cropped_width);\r\n}\r\nif ((last_index + SH_CSS_SP_DBG_TRACE_DEPTH) < sp_index) {\r\nlast_index = sp_index - SH_CSS_SP_DBG_TRACE_DEPTH;\r\n}\r\nfor (n = last_index; n < sp_index; n++) {\r\nint i = n % SH_CSS_SP_DBG_TRACE_DEPTH;\r\nif (state->trace[i].frame != 0) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"copy-trace: frame=%d, line=%d, "\r\n"pixel_distance=%d, "\r\n"mipi_used_dword=%d, "\r\n"sp_index=%d\n",\r\nstate->trace[i].frame,\r\nstate->trace[i].line,\r\nstate->trace[i].pixel_distance,\r\nstate->trace[i].mipi_used_dword,\r\nstate->trace[i].sp_index);\r\n}\r\n}\r\nlast_index = sp_index;\r\n#elif SP_DEBUG == SP_DEBUG_TRACE\r\nstatic char const * const id2filename[8] = {\r\n"param_buffer.sp.c | tagger.sp.c | pipe_data.sp.c",\r\n"isp_init.sp.c",\r\n"sp_raw_copy.hive.c",\r\n"dma_configure.sp.c",\r\n"sp.hive.c",\r\n"event_proxy_sp.hive.c",\r\n"circular_buffer.sp.c",\r\n"frame_buffer.sp.c"\r\n};\r\n#if 1\r\nstatic char const *trace_name[SH_CSS_SP_DBG_NR_OF_TRACES] = {\r\n"default"\r\n};\r\n#else\r\nstatic char const *trace_name[SH_CSS_SP_DBG_NR_OF_TRACES] = {\r\n"copy", "preview/video", "capture", "acceleration"\r\n};\r\n#endif\r\nstatic int host_index_last[SH_CSS_SP_DBG_NR_OF_TRACES] = { 0 };\r\nint t, n;\r\nassert(state != NULL);\r\nfor (t = 0; t < SH_CSS_SP_DBG_NR_OF_TRACES; t++) {\r\nint sp_index_last = state->index_last[t];\r\nif (sp_index_last < host_index_last[t]) {\r\nhost_index_last[t] = 0;\r\n}\r\nif ((host_index_last[t] + SH_CSS_SP_DBG_TRACE_DEPTH) <\r\nsp_index_last) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"Warning: trace %s has gap of %d "\r\n"traces\n",\r\ntrace_name[t],\r\n(sp_index_last -\r\n(host_index_last[t] +\r\nSH_CSS_SP_DBG_TRACE_DEPTH)));\r\nhost_index_last[t] =\r\nsp_index_last - SH_CSS_SP_DBG_TRACE_DEPTH;\r\n}\r\nfor (n = host_index_last[t]; n < sp_index_last; n++) {\r\nint i = n % SH_CSS_SP_DBG_TRACE_DEPTH;\r\nint l = state->trace[t][i].location &\r\n((1 << SH_CSS_SP_DBG_TRACE_FILE_ID_BIT_POS) - 1);\r\nint fid = state->trace[t][i].location >>\r\nSH_CSS_SP_DBG_TRACE_FILE_ID_BIT_POS;\r\nint ts = state->trace[t][i].time_stamp;\r\nif (ts) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"%05d trace=%s, file=%s:%d, "\r\n"data=0x%08x\n",\r\nts,\r\ntrace_name[t],\r\nid2filename[fid], l,\r\nstate->trace[t][i].data);\r\n}\r\n}\r\nhost_index_last[t] = sp_index_last;\r\n}\r\n#elif SP_DEBUG == SP_DEBUG_MINIMAL\r\nint i;\r\nint base = 0;\r\nint limit = SH_CSS_NUM_SP_DEBUG;\r\nint step = 1;\r\nassert(state != NULL);\r\nfor (i = base; i < limit; i += step) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"sp_dbg_trace[%d] = %d\n",\r\ni, state->debug[i]);\r\n}\r\n#endif\r\n#if SP_DEBUG != SP_DEBUG_NONE\r\nreturn;\r\n}\r\nstatic void debug_print_rx_mipi_port_state(mipi_port_state_t *state)\r\n{\r\nint i;\r\nunsigned int bits, infos;\r\nassert(state != NULL);\r\nbits = state->irq_status;\r\ninfos = ia_css_isys_rx_translate_irq_infos(bits);\r\nia_css_debug_dtrace(2, "\t\t%-32s: (irq reg = 0x%X)\n",\r\n"receiver errors", bits);\r\nif (infos & IA_CSS_RX_IRQ_INFO_BUFFER_OVERRUN)\r\nia_css_debug_dtrace(2, "\t\t\tbuffer overrun\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_SOT)\r\nia_css_debug_dtrace(2, "\t\t\tstart-of-transmission error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_SOT_SYNC)\r\nia_css_debug_dtrace(2, "\t\t\tstart-of-transmission sync error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_CONTROL)\r\nia_css_debug_dtrace(2, "\t\t\tcontrol error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_ECC_DOUBLE)\r\nia_css_debug_dtrace(2, "\t\t\t2 or more ECC errors\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_CRC)\r\nia_css_debug_dtrace(2, "\t\t\tCRC mismatch\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_UNKNOWN_ID)\r\nia_css_debug_dtrace(2, "\t\t\tunknown error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_FRAME_SYNC)\r\nia_css_debug_dtrace(2, "\t\t\tframe sync error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_FRAME_DATA)\r\nia_css_debug_dtrace(2, "\t\t\tframe data error\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_DATA_TIMEOUT)\r\nia_css_debug_dtrace(2, "\t\t\tdata timeout\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_UNKNOWN_ESC)\r\nia_css_debug_dtrace(2, "\t\t\tunknown escape command entry\n");\r\nif (infos & IA_CSS_RX_IRQ_INFO_ERR_LINE_SYNC)\r\nia_css_debug_dtrace(2, "\t\t\tline sync error\n");\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"device_ready", state->device_ready);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_status", state->irq_status);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_enable", state->irq_enable);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"timeout_count", state->timeout_count);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"init_count", state->init_count);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "raw16_18", state->raw16_18);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"sync_count", state->sync_count);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "rx_count", state->rx_count);\r\nfor (i = 0; i < MIPI_4LANE_CFG; i++) {\r\nia_css_debug_dtrace(2, "\t\t%-32s%d%-32s: %d\n",\r\n"lane_sync_count[", i, "]",\r\nstate->lane_sync_count[i]);\r\n}\r\nfor (i = 0; i < MIPI_4LANE_CFG; i++) {\r\nia_css_debug_dtrace(2, "\t\t%-32s%d%-32s: %d\n",\r\n"lane_rx_count[", i, "]",\r\nstate->lane_rx_count[i]);\r\n}\r\nreturn;\r\n}\r\nstatic void debug_print_rx_channel_state(rx_channel_state_t *state)\r\n{\r\nint i;\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"compression_scheme0", state->comp_scheme0);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"compression_scheme1", state->comp_scheme1);\r\nfor (i = 0; i < N_MIPI_FORMAT_CUSTOM; i++) {\r\nia_css_debug_dtrace(2, "\t\t%-32s%d: %d\n",\r\n"MIPI Predictor ", i, state->pred[i]);\r\n}\r\nfor (i = 0; i < N_MIPI_FORMAT_CUSTOM; i++) {\r\nia_css_debug_dtrace(2, "\t\t%-32s%d: %d\n",\r\n"MIPI Compressor ", i, state->comp[i]);\r\n}\r\nreturn;\r\n}\r\nstatic void debug_print_rx_state(receiver_state_t *state)\r\n{\r\nint i;\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "CSI Receiver State:\n");\r\nia_css_debug_dtrace(2, "\tConfiguration:\n");\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"fs_to_ls_delay", state->fs_to_ls_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"ls_to_data_delay", state->ls_to_data_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"data_to_le_delay", state->data_to_le_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"le_to_fe_delay", state->le_to_fe_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"fe_to_fs_delay", state->fe_to_fs_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"le_to_fs_delay", state->le_to_fs_delay);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"is_two_ppc", state->is_two_ppc);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"backend_rst", state->backend_rst);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "raw18", state->raw18);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"force_raw8", state->force_raw8);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "raw16", state->raw16);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_gsp_acc_ovl", state->be_gsp_acc_ovl);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "be_srst", state->be_srst);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_is_two_ppc", state->be_is_two_ppc);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_comp_format0", state->be_comp_format0);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_comp_format1", state->be_comp_format1);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_comp_format2", state->be_comp_format2);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_comp_format3", state->be_comp_format3);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "be_sel", state->be_sel);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_raw16_config", state->be_raw16_config);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_raw18_config", state->be_raw18_config);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_force_raw8", state->be_force_raw8);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_irq_status", state->be_irq_status);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"be_irq_clear", state->be_irq_clear);\r\nfor (i = 0; i < N_MIPI_PORT_ID; i++) {\r\nia_css_debug_dtrace(2, "\tMIPI Port %d State:\n", i);\r\ndebug_print_rx_mipi_port_state(&state->mipi_port_state[i]);\r\n}\r\nfor (i = 0; i < N_RX_CHANNEL_ID; i++) {\r\nia_css_debug_dtrace(2, "\tRX Channel %d State:\n", i);\r\ndebug_print_rx_channel_state(&state->rx_channel_state[i]);\r\n}\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_rx_state(void)\r\n{\r\n#if defined(HAS_INPUT_FORMATTER_VERSION_2) && !defined(HAS_NO_INPUT_FORMATTER)\r\nreceiver_state_t state;\r\nreceiver_get_state(RX0_ID, &state);\r\ndebug_print_rx_state(&state);\r\n#endif\r\n}\r\nvoid ia_css_debug_dump_sp_sw_debug_info(void)\r\n{\r\n#if SP_DEBUG != SP_DEBUG_NONE\r\nstruct sh_css_sp_debug_state state;\r\nsh_css_sp_get_debug_state(&state);\r\nia_css_debug_print_sp_debug_state(&state);\r\n#endif\r\nia_css_bufq_dump_queue_info();\r\nia_css_pipeline_dump_thread_map_info();\r\nreturn;\r\n}\r\nstatic void debug_print_isys_capture_unit_state(capture_unit_state_t *state)\r\n{\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Packet_Length", state->Packet_Length);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Received_Length", state->Received_Length);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Received_Short_Packets",\r\nstate->Received_Short_Packets);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Received_Long_Packets",\r\nstate->Received_Long_Packets);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Last_Command", state->Last_Command);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Next_Command", state->Next_Command);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Last_Acknowledge", state->Last_Acknowledge);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Next_Acknowledge", state->Next_Acknowledge);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM_State_Info", state->FSM_State_Info);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"StartMode", state->StartMode);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Start_Addr", state->Start_Addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Mem_Region_Size", state->Mem_Region_Size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Num_Mem_Regions", state->Num_Mem_Regions);\r\nreturn;\r\n}\r\nstatic void debug_print_isys_acquisition_unit_state(\r\nacquisition_unit_state_t *state)\r\n{\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Received_Short_Packets",\r\nstate->Received_Short_Packets);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Received_Long_Packets",\r\nstate->Received_Long_Packets);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Last_Command", state->Last_Command);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Next_Command", state->Next_Command);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Last_Acknowledge", state->Last_Acknowledge);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Next_Acknowledge", state->Next_Acknowledge);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"FSM_State_Info", state->FSM_State_Info);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Int_Cntr_Info", state->Int_Cntr_Info);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Start_Addr", state->Start_Addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Mem_Region_Size", state->Mem_Region_Size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"Num_Mem_Regions", state->Num_Mem_Regions);\r\n}\r\nstatic void debug_print_isys_ctrl_unit_state(ctrl_unit_state_t *state)\r\n{\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "last_cmd", state->last_cmd);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "next_cmd", state->next_cmd);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "last_ack", state->last_ack);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n", "next_ack", state->next_ack);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"top_fsm_state", state->top_fsm_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captA_fsm_state", state->captA_fsm_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captB_fsm_state", state->captB_fsm_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captC_fsm_state", state->captC_fsm_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"acq_fsm_state", state->acq_fsm_state);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captA_start_addr", state->captA_start_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captB_start_addr", state->captB_start_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captC_start_addr", state->captC_start_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captA_mem_region_size",\r\nstate->captA_mem_region_size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captB_mem_region_size",\r\nstate->captB_mem_region_size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captC_mem_region_size",\r\nstate->captC_mem_region_size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captA_num_mem_regions",\r\nstate->captA_num_mem_regions);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captB_num_mem_regions",\r\nstate->captB_num_mem_regions);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"captC_num_mem_regions",\r\nstate->captC_num_mem_regions);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"acq_start_addr", state->acq_start_addr);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"acq_mem_region_size", state->acq_mem_region_size);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"acq_num_mem_regions", state->acq_num_mem_regions);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"capt_reserve_one_mem_region",\r\nstate->capt_reserve_one_mem_region);\r\nreturn;\r\n}\r\nstatic void debug_print_isys_state(input_system_state_t *state)\r\n{\r\nint i;\r\nassert(state != NULL);\r\nia_css_debug_dtrace(2, "InputSystem State:\n");\r\nia_css_debug_dtrace(2, "\tConfiguration:\n");\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_multiCastA_sel", state->str_multicastA_sel);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_multicastB_sel", state->str_multicastB_sel);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_multicastC_sel", state->str_multicastC_sel);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_mux_sel", state->str_mux_sel);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_mon_status", state->str_mon_status);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_mon_irq_cond", state->str_mon_irq_cond);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_mon_irq_en", state->str_mon_irq_en);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"isys_srst", state->isys_srst);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"isys_slv_reg_srst", state->isys_slv_reg_srst);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_deint_portA_cnt", state->str_deint_portA_cnt);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"str_deint_portB_cnd", state->str_deint_portB_cnt);\r\nfor (i = 0; i < N_CAPTURE_UNIT_ID; i++) {\r\ncapture_unit_state_t *capture_unit_state;\r\nia_css_debug_dtrace(2, "\tCaptureUnit %d State:\n", i);\r\ncapture_unit_state = &state->capture_unit[i];\r\ndebug_print_isys_capture_unit_state(capture_unit_state);\r\n}\r\nfor (i = 0; i < N_ACQUISITION_UNIT_ID; i++) {\r\nacquisition_unit_state_t *acquisition_unit_state;\r\nia_css_debug_dtrace(2, "\tAcquisitionUnit %d State:\n", i);\r\nacquisition_unit_state = &state->acquisition_unit[i];\r\ndebug_print_isys_acquisition_unit_state(acquisition_unit_state);\r\n}\r\nfor (i = 0; i < N_CTRL_UNIT_ID; i++) {\r\nia_css_debug_dtrace(2, "\tControlUnit %d State:\n", i);\r\ndebug_print_isys_ctrl_unit_state(&state->ctrl_unit_state[i]);\r\n}\r\n}\r\nvoid ia_css_debug_dump_isys_state(void)\r\n{\r\ninput_system_state_t state;\r\ninput_system_get_state(INPUT_SYSTEM0_ID, &state);\r\ndebug_print_isys_state(&state);\r\nreturn;\r\n}\r\nvoid ia_css_debug_dump_isys_state(void)\r\n{\r\nstatic input_system_state_t state;\r\ninput_system_get_state(INPUT_SYSTEM0_ID, &state);\r\ninput_system_dump_state(INPUT_SYSTEM0_ID, &state);\r\n}\r\nvoid ia_css_debug_dump_debug_info(const char *context)\r\n{\r\nif (context == NULL)\r\ncontext = "No Context provided";\r\nia_css_debug_dtrace(2, "CSS Debug Info dump [Context = %s]\n", context);\r\n#if !defined(HAS_NO_INPUT_SYSTEM) && defined(USE_INPUT_SYSTEM_VERSION_2)\r\nia_css_debug_dump_rx_state();\r\n#endif\r\n#if !defined(HAS_NO_INPUT_FORMATTER) && defined(USE_INPUT_SYSTEM_VERSION_2)\r\nia_css_debug_dump_if_state();\r\n#endif\r\nia_css_debug_dump_isp_state();\r\nia_css_debug_dump_isp_sp_fifo_state();\r\nia_css_debug_dump_isp_gdc_fifo_state();\r\nia_css_debug_dump_sp_state();\r\nia_css_debug_dump_perf_counters();\r\n#ifdef HAS_WATCHDOG_SP_THREAD_DEBUG\r\nsh_css_dump_thread_wait_info();\r\nsh_css_dump_pipe_stage_info();\r\nsh_css_dump_pipe_stripe_info();\r\n#endif\r\nia_css_debug_dump_dma_isp_fifo_state();\r\nia_css_debug_dump_dma_sp_fifo_state();\r\nia_css_debug_dump_dma_state();\r\n#if defined(USE_INPUT_SYSTEM_VERSION_2)\r\nia_css_debug_dump_isys_state();\r\n{\r\nirq_controller_state_t state;\r\nirq_controller_get_state(IRQ2_ID, &state);\r\nia_css_debug_dtrace(2, "\t%-32s:\n",\r\n"Input System IRQ Controller State");\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_edge", state.irq_edge);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_mask", state.irq_mask);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_status", state.irq_status);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_enable", state.irq_enable);\r\nia_css_debug_dtrace(2, "\t\t%-32s: %d\n",\r\n"irq_level_not_pulse",\r\nstate.irq_level_not_pulse);\r\n}\r\n#endif\r\n#if !defined(HAS_NO_INPUT_SYSTEM) && defined(USE_INPUT_SYSTEM_VERSION_2401)\r\nia_css_debug_dump_isys_state();\r\n#endif\r\n#if defined(USE_INPUT_SYSTEM_VERSION_2) || defined(USE_INPUT_SYSTEM_VERSION_2401)\r\nia_css_debug_tagger_state();\r\n#endif\r\nreturn;\r\n}\r\nvoid ia_css_debug_enable_sp_sleep_mode(enum ia_css_sp_sleep_mode mode)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nunsigned int HIVE_ADDR_sp_sleep_mode;\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_sp_sleep_mode = fw->info.sp.sleep_mode;\r\n(void)HIVE_ADDR_sp_sleep_mode;\r\nsp_dmem_store_uint32(SP0_ID,\r\n(unsigned int)sp_address_of(sp_sleep_mode),\r\n(uint32_t) mode);\r\n}\r\nvoid ia_css_debug_wake_up_sp(void)\r\n{\r\nsp_ctrl_setbit(SP0_ID, SP_SC_REG, SP_START_BIT);\r\n}\r\nstatic char *\r\nfindf_dmem_params(struct ia_css_stream *stream, short idx)\r\n{\r\nint i;\r\nfor (i = 0; i < stream->num_pipes; i++) {\r\nstruct ia_css_pipe *pipe = stream->pipes[i];\r\nstruct ia_css_pipeline *pipeline = ia_css_pipe_get_pipeline(pipe);\r\nstruct ia_css_pipeline_stage *stage;\r\nfor (stage = pipeline->stages; stage; stage = stage->next) {\r\nstruct ia_css_binary *binary = stage->binary;\r\nshort *offsets = (short *)&binary->info->mem_offsets.offsets.param->dmem;\r\nshort dmem_offset = offsets[idx];\r\nconst struct ia_css_host_data *isp_data =\r\nia_css_isp_param_get_mem_init(&binary->mem_params,\r\nIA_CSS_PARAM_CLASS_PARAM, IA_CSS_ISP_DMEM0);\r\nif (dmem_offset < 0)\r\ncontinue;\r\nreturn &isp_data->address[dmem_offset];\r\n}\r\n}\r\nreturn NULL;\r\n}\r\nvoid ia_css_debug_dump_isp_params(struct ia_css_stream *stream,\r\nunsigned int enable)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "ISP PARAMETERS:\n");\r\n#if defined(IS_ISP_2500_SYSTEM)\r\n(void)enable;\r\n(void)stream;\r\n#else\r\nassert(stream != NULL);\r\nif ((enable & IA_CSS_DEBUG_DUMP_FPN)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_fpn_dump(FIND_DMEM_PARAMS(stream, fpn), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_OB)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_ob_dump(FIND_DMEM_PARAMS(stream, ob), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_SC)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_sc_dump(FIND_DMEM_PARAMS(stream, sc), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_WB)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_wb_dump(FIND_DMEM_PARAMS(stream, wb), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_DP)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_dp_dump(FIND_DMEM_PARAMS(stream, dp), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_BNR)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_bnr_dump(FIND_DMEM_PARAMS(stream, bnr), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_S3A)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_s3a_dump(FIND_DMEM_PARAMS(stream, s3a), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_DE)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_de_dump(FIND_DMEM_PARAMS(stream, de), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_YNR)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_nr_dump(FIND_DMEM_PARAMS_TYPE(stream, nr, ynr), IA_CSS_DEBUG_VERBOSE);\r\nia_css_yee_dump(FIND_DMEM_PARAMS(stream, yee), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_CSC)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_csc_dump(FIND_DMEM_PARAMS(stream, csc), IA_CSS_DEBUG_VERBOSE);\r\nia_css_yuv2rgb_dump(FIND_DMEM_PARAMS_TYPE(stream, yuv2rgb, csc), IA_CSS_DEBUG_VERBOSE);\r\nia_css_rgb2yuv_dump(FIND_DMEM_PARAMS_TYPE(stream, rgb2yuv, csc), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_GC)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_gc_dump(FIND_DMEM_PARAMS(stream, gc), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_TNR)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_tnr_dump(FIND_DMEM_PARAMS(stream, tnr), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_ANR)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_anr_dump(FIND_DMEM_PARAMS(stream, anr), IA_CSS_DEBUG_VERBOSE);\r\n}\r\nif ((enable & IA_CSS_DEBUG_DUMP_CE)\r\n|| (enable & IA_CSS_DEBUG_DUMP_ALL)) {\r\nia_css_ce_dump(FIND_DMEM_PARAMS(stream, ce), IA_CSS_DEBUG_VERBOSE);\r\n}\r\n#endif\r\n}\r\nvoid sh_css_dump_sp_raw_copy_linecount(bool reduced)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nunsigned int HIVE_ADDR_raw_copy_line_count;\r\nint32_t raw_copy_line_count;\r\nstatic int32_t prev_raw_copy_line_count = -1;\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_raw_copy_line_count =\r\nfw->info.sp.raw_copy_line_count;\r\n(void)HIVE_ADDR_raw_copy_line_count;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(raw_copy_line_count),\r\n&raw_copy_line_count,\r\nsizeof(raw_copy_line_count));\r\nif (reduced)\r\nraw_copy_line_count = (raw_copy_line_count < 0)?raw_copy_line_count:1;\r\nif (prev_raw_copy_line_count != raw_copy_line_count) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"sh_css_dump_sp_raw_copy_linecount() "\r\n"line_count=%d\n",\r\nraw_copy_line_count);\r\nprev_raw_copy_line_count = raw_copy_line_count;\r\n}\r\n}\r\nvoid ia_css_debug_dump_isp_binary(void)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nunsigned int HIVE_ADDR_pipeline_sp_curr_binary_id;\r\nuint32_t curr_binary_id;\r\nstatic uint32_t prev_binary_id = 0xFFFFFFFF;\r\nstatic uint32_t sample_count;\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_pipeline_sp_curr_binary_id = fw->info.sp.curr_binary_id;\r\n(void)HIVE_ADDR_pipeline_sp_curr_binary_id;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(pipeline_sp_curr_binary_id),\r\n&curr_binary_id,\r\nsizeof(curr_binary_id));\r\nsample_count++;\r\nif (prev_binary_id != curr_binary_id) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"sh_css_dump_isp_binary() "\r\n"pipe_id=%d, binary_id=%d, sample_count=%d\n",\r\n(curr_binary_id >> 16),\r\n(curr_binary_id & 0x0ffff),\r\nsample_count);\r\nsample_count = 0;\r\nprev_binary_id = curr_binary_id;\r\n}\r\n}\r\nvoid ia_css_debug_dump_perf_counters(void)\r\n{\r\n#if !defined(HAS_NO_INPUT_SYSTEM) && defined(USE_INPUT_SYSTEM_VERSION_2)\r\nconst struct ia_css_fw_info *fw;\r\nint i;\r\nunsigned int HIVE_ADDR_ia_css_isys_sp_error_cnt;\r\nint32_t ia_css_sp_input_system_error_cnt[N_MIPI_PORT_ID + 1];\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "Input System Error Counters:\n");\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_ia_css_isys_sp_error_cnt = fw->info.sp.perf_counter_input_system_error;\r\n(void)HIVE_ADDR_ia_css_isys_sp_error_cnt;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(ia_css_isys_sp_error_cnt),\r\n&ia_css_sp_input_system_error_cnt,\r\nsizeof(ia_css_sp_input_system_error_cnt));\r\nfor (i = 0; i < N_MIPI_PORT_ID + 1; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "\tport[%d] = %d\n",\r\ni, ia_css_sp_input_system_error_cnt[i]);\r\n}\r\n#endif\r\n}\r\nbool ia_css_debug_mode_init(void)\r\n{\r\nbool rc;\r\nrc = sh_css_sp_init_dma_sw_reg(0);\r\nreturn rc;\r\n}\r\nbool\r\nia_css_debug_mode_disable_dma_channel(int dma_id,\r\nint channel_id, int request_type)\r\n{\r\nbool rc;\r\nrc = sh_css_sp_set_dma_sw_reg(dma_id, channel_id, request_type, false);\r\nreturn rc;\r\n}\r\nbool\r\nia_css_debug_mode_enable_dma_channel(int dma_id,\r\nint channel_id, int request_type)\r\n{\r\nbool rc;\r\nrc = sh_css_sp_set_dma_sw_reg(dma_id, channel_id, request_type, true);\r\nreturn rc;\r\n}\r\nvoid dtrace_dot(const char *fmt, ...)\r\n{\r\nva_list ap;\r\nassert(fmt != NULL);\r\nva_start(ap, fmt);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_INFO, "%s", DPG_START);\r\nia_css_debug_vdtrace(IA_CSS_DEBUG_INFO, fmt, ap);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_INFO, "%s", DPG_END);\r\nva_end(ap);\r\n}\r\nvoid sh_css_dump_thread_wait_info(void)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nint i;\r\nunsigned int HIVE_ADDR_sp_thread_wait;\r\nint32_t sp_thread_wait[MAX_THREAD_NUM];\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "SEM WAITS:\n");\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_sp_thread_wait =\r\nfw->info.sp.debug_wait;\r\n(void)HIVE_ADDR_sp_thread_wait;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(sp_thread_wait),\r\n&sp_thread_wait,\r\nsizeof(sp_thread_wait));\r\nfor (i = 0; i < MAX_THREAD_NUM; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"\twait[%d] = 0x%X\n",\r\ni, sp_thread_wait[i]);\r\n}\r\n}\r\nvoid sh_css_dump_pipe_stage_info(void)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nint i;\r\nunsigned int HIVE_ADDR_sp_pipe_stage;\r\nint32_t sp_pipe_stage[MAX_THREAD_NUM];\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "PIPE STAGE:\n");\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_sp_pipe_stage =\r\nfw->info.sp.debug_stage;\r\n(void)HIVE_ADDR_sp_pipe_stage;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(sp_pipe_stage),\r\n&sp_pipe_stage,\r\nsizeof(sp_pipe_stage));\r\nfor (i = 0; i < MAX_THREAD_NUM; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"\tstage[%d] = %d\n",\r\ni, sp_pipe_stage[i]);\r\n}\r\n}\r\nvoid sh_css_dump_pipe_stripe_info(void)\r\n{\r\nconst struct ia_css_fw_info *fw;\r\nint i;\r\nunsigned int HIVE_ADDR_sp_pipe_stripe;\r\nint32_t sp_pipe_stripe[MAX_THREAD_NUM];\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE, "PIPE STRIPE:\n");\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_sp_pipe_stripe =\r\nfw->info.sp.debug_stripe;\r\n(void)HIVE_ADDR_sp_pipe_stripe;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(sp_pipe_stripe),\r\n&sp_pipe_stripe,\r\nsizeof(sp_pipe_stripe));\r\nfor (i = 0; i < MAX_THREAD_NUM; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_VERBOSE,\r\n"\tstripe[%d] = %d\n",\r\ni, sp_pipe_stripe[i]);\r\n}\r\n}\r\nstatic void\r\nia_css_debug_pipe_graph_dump_frame(\r\nstruct ia_css_frame *frame,\r\nenum ia_css_pipe_id id,\r\nchar const *blob_name,\r\nchar const *frame_name,\r\nbool in_frame)\r\n{\r\nchar bufinfo[100];\r\nif (frame->dynamic_queue_id == SH_CSS_INVALID_QUEUE_ID) {\r\nsnprintf(bufinfo, sizeof(bufinfo), "Internal");\r\n} else {\r\nsnprintf(bufinfo, sizeof(bufinfo), "Queue: %s %s",\r\npipe_id_to_str[id],\r\nqueue_id_to_str[frame->dynamic_queue_id]);\r\n}\r\ndtrace_dot(\r\n"node [shape = box, "\r\n"fixedsize=true, width=2, height=0.7]; \"0x%08lx\" "\r\n"[label = \"%s\\n%d(%d) x %d, %dbpp\\n%s\"];",\r\nHOST_ADDRESS(frame),\r\ndebug_frame_format2str(frame->info.format),\r\nframe->info.res.width,\r\nframe->info.padded_width,\r\nframe->info.res.height,\r\nframe->info.raw_bit_depth,\r\nbufinfo);\r\nif (in_frame) {\r\ndtrace_dot(\r\n"\"0x%08lx\"->\"%s(pipe%d)\" "\r\n"[label = %s_frame];",\r\nHOST_ADDRESS(frame),\r\nblob_name, id, frame_name);\r\n} else {\r\ndtrace_dot(\r\n"\"%s(pipe%d)\"->\"0x%08lx\" "\r\n"[label = %s_frame];",\r\nblob_name, id,\r\nHOST_ADDRESS(frame),\r\nframe_name);\r\n}\r\n}\r\nvoid\r\nia_css_debug_pipe_graph_dump_prologue(void)\r\n{\r\ndtrace_dot("digraph sh_css_pipe_graph {");\r\ndtrace_dot("rankdir=LR;");\r\ndtrace_dot("fontsize=9;");\r\ndtrace_dot("label = \"\\nEnable options: rp=reduced pipe, vfve=vf_veceven, "\r\n"dvse=dvs_envelope, dvs6=dvs_6axis, bo=block_out, "\r\n"fbds=fixed_bayer_ds, bf6=bayer_fir_6db, "\r\n"rawb=raw_binning, cont=continuous, disc=dis_crop\\n"\r\n"dp2a=dp_2adjacent, outp=output, outt=out_table, "\r\n"reff=ref_frame, par=params, gam=gamma, "\r\n"cagdc=ca_gdc, ispa=isp_addresses, inf=in_frame, "\r\n"outf=out_frame, hs=high_speed, inpc=input_chunking\"");\r\n}\r\nvoid ia_css_debug_pipe_graph_dump_epilogue(void)\r\n{\r\nif (strlen(ring_buffer) > 0) {\r\ndtrace_dot(ring_buffer);\r\n}\r\nif (pg_inst.stream_format != N_IA_CSS_STREAM_FORMAT) {\r\ndtrace_dot(\r\n"node [shape = doublecircle, "\r\n"fixedsize=true, width=2.5]; \"input_system\" "\r\n"[label = \"Input system\"];");\r\ndtrace_dot(\r\n"\"input_system\"->\"%s\" "\r\n"[label = \"%s\"];",\r\ndot_id_input_bin, debug_stream_format2str(pg_inst.stream_format));\r\ndtrace_dot(\r\n"node [shape = doublecircle, "\r\n"fixedsize=true, width=2.5]; \"sensor\" "\r\n"[label = \"Sensor\"];");\r\ndtrace_dot(\r\n"\"sensor\"->\"input_system\" "\r\n"[label = \"%s\\n%d x %d\\n(%d x %d)\"];",\r\ndebug_stream_format2str(pg_inst.stream_format),\r\npg_inst.width, pg_inst.height,\r\npg_inst.eff_width, pg_inst.eff_height);\r\n}\r\ndtrace_dot("}");\r\nmemset(dot_id_input_bin, 0, sizeof(dot_id_input_bin));\r\nmemset(ring_buffer, 0, sizeof(ring_buffer));\r\npg_inst.do_init = true;\r\npg_inst.width = 0;\r\npg_inst.height = 0;\r\npg_inst.eff_width = 0;\r\npg_inst.eff_height = 0;\r\npg_inst.stream_format = N_IA_CSS_STREAM_FORMAT;\r\n}\r\nvoid\r\nia_css_debug_pipe_graph_dump_sp_raw_copy(\r\nstruct ia_css_frame *out_frame)\r\n{\r\nassert(out_frame != NULL);\r\nif (pg_inst.do_init) {\r\nia_css_debug_pipe_graph_dump_prologue();\r\npg_inst.do_init = false;\r\n}\r\ndtrace_dot("node [shape = circle, fixedsize=true, width=2.5, "\r\n"label=\"%s\\n%s\"]; \"%s(pipe%d)\"",\r\n"sp-binary", "sp_raw_copy", "sp_raw_copy", 1);\r\nsnprintf(ring_buffer, sizeof(ring_buffer),\r\n"node [shape = box, "\r\n"fixedsize=true, width=2, height=0.7]; \"0x%08lx\" "\r\n"[label = \"%s\\n%d(%d) x %d\\nRingbuffer\"];",\r\nHOST_ADDRESS(out_frame),\r\ndebug_frame_format2str(out_frame->info.format),\r\nout_frame->info.res.width,\r\nout_frame->info.padded_width,\r\nout_frame->info.res.height);\r\ndtrace_dot(ring_buffer);\r\ndtrace_dot(\r\n"\"%s(pipe%d)\"->\"0x%08lx\" "\r\n"[label = out_frame];",\r\n"sp_raw_copy", 1, HOST_ADDRESS(out_frame));\r\nsnprintf(dot_id_input_bin, sizeof(dot_id_input_bin), "%s(pipe%d)", "sp_raw_copy", 1);\r\n}\r\nvoid\r\nia_css_debug_pipe_graph_dump_stream_config(\r\nconst struct ia_css_stream_config *stream_config)\r\n{\r\npg_inst.width = stream_config->input_config.input_res.width;\r\npg_inst.height = stream_config->input_config.input_res.height;\r\npg_inst.eff_width = stream_config->input_config.effective_res.width;\r\npg_inst.eff_height = stream_config->input_config.effective_res.height;\r\npg_inst.stream_format = stream_config->input_config.format;\r\n}\r\nvoid\r\nia_css_debug_dump_resolution(\r\nconst struct ia_css_resolution *res,\r\nconst char *label)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s: =%d x =%d\n",\r\nlabel, res->width, res->height);\r\n}\r\nvoid\r\nia_css_debug_dump_frame_info(\r\nconst struct ia_css_frame_info *info,\r\nconst char *label)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s\n", label);\r\nia_css_debug_dump_resolution(&info->res, "res");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "padded_width: %d\n",\r\ninfo->padded_width);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "format: %d\n", info->format);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "raw_bit_depth: %d\n",\r\ninfo->raw_bit_depth);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "raw_bayer_order: %d\n",\r\ninfo->raw_bayer_order);\r\n}\r\nvoid\r\nia_css_debug_dump_capture_config(\r\nconst struct ia_css_capture_config *config)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s\n", __func__);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "mode: %d\n", config->mode);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "enable_xnr: %d\n",\r\nconfig->enable_xnr);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "enable_raw_output: %d\n",\r\nconfig->enable_raw_output);\r\n}\r\nvoid\r\nia_css_debug_dump_pipe_extra_config(\r\nconst struct ia_css_pipe_extra_config *extra_config)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s\n", __func__);\r\nif (extra_config) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"enable_raw_binning: %d\n",\r\nextra_config->enable_raw_binning);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "enable_yuv_ds: %d\n",\r\nextra_config->enable_yuv_ds);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"enable_high_speed: %d\n",\r\nextra_config->enable_high_speed);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"enable_dvs_6axis: %d\n",\r\nextra_config->enable_dvs_6axis);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"enable_reduced_pipe: %d\n",\r\nextra_config->enable_reduced_pipe);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"enable_fractional_ds: %d\n",\r\nextra_config->enable_fractional_ds);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "disable_vf_pp: %d\n",\r\nextra_config->disable_vf_pp);\r\n}\r\n}\r\nvoid\r\nia_css_debug_dump_pipe_config(\r\nconst struct ia_css_pipe_config *config)\r\n{\r\nunsigned int i;\r\nIA_CSS_ENTER_PRIVATE("config = %p", config);\r\nif (!config) {\r\nIA_CSS_ERROR("NULL input parameter");\r\nIA_CSS_LEAVE_PRIVATE("");\r\nreturn;\r\n}\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "mode: %d\n", config->mode);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "isp_pipe_version: %d\n",\r\nconfig->isp_pipe_version);\r\nia_css_debug_dump_resolution(&config->bayer_ds_out_res,\r\n"bayer_ds_out_res");\r\nia_css_debug_dump_resolution(&config->capt_pp_in_res,\r\n"capt_pp_in_res");\r\nia_css_debug_dump_resolution(&config->vf_pp_in_res, "vf_pp_in_res");\r\n#ifdef ISP2401\r\nia_css_debug_dump_resolution(&config->output_system_in_res,\r\n"output_system_in_res");\r\n#endif\r\nia_css_debug_dump_resolution(&config->dvs_crop_out_res,\r\n"dvs_crop_out_res");\r\nfor (i = 0; i < IA_CSS_PIPE_MAX_OUTPUT_STAGE; i++) {\r\nia_css_debug_dump_frame_info(&config->output_info[i], "output_info");\r\nia_css_debug_dump_frame_info(&config->vf_output_info[i],\r\n"vf_output_info");\r\n}\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "acc_extension: %p\n",\r\nconfig->acc_extension);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "num_acc_stages: %d\n",\r\nconfig->num_acc_stages);\r\nia_css_debug_dump_capture_config(&config->default_capture_config);\r\nia_css_debug_dump_resolution(&config->dvs_envelope, "dvs_envelope");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "dvs_frame_delay: %d\n",\r\nconfig->dvs_frame_delay);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "acc_num_execs: %d\n",\r\nconfig->acc_num_execs);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "enable_dz: %d\n",\r\nconfig->enable_dz);\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid\r\nia_css_debug_dump_stream_config_source(\r\nconst struct ia_css_stream_config *config)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s()\n", __func__);\r\nswitch (config->mode) {\r\ncase IA_CSS_INPUT_MODE_SENSOR:\r\ncase IA_CSS_INPUT_MODE_BUFFERED_SENSOR:\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "source.port\n");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "port: %d\n",\r\nconfig->source.port.port);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "num_lanes: %d\n",\r\nconfig->source.port.num_lanes);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "timeout: %d\n",\r\nconfig->source.port.timeout);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "compression: %d\n",\r\nconfig->source.port.compression.type);\r\nbreak;\r\ncase IA_CSS_INPUT_MODE_TPG:\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "source.tpg\n");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "id: %d\n",\r\nconfig->source.tpg.id);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "mode: %d\n",\r\nconfig->source.tpg.mode);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "x_mask: 0x%x\n",\r\nconfig->source.tpg.x_mask);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "x_delta: %d\n",\r\nconfig->source.tpg.x_delta);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "y_mask: 0x%x\n",\r\nconfig->source.tpg.y_mask);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "y_delta: %d\n",\r\nconfig->source.tpg.y_delta);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "xy_mask: 0x%x\n",\r\nconfig->source.tpg.xy_mask);\r\nbreak;\r\ncase IA_CSS_INPUT_MODE_PRBS:\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "source.prbs\n");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "id: %d\n",\r\nconfig->source.prbs.id);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "h_blank: %d\n",\r\nconfig->source.prbs.h_blank);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "v_blank: %d\n",\r\nconfig->source.prbs.v_blank);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "seed: 0x%x\n",\r\nconfig->source.prbs.seed);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "seed1: 0x%x\n",\r\nconfig->source.prbs.seed1);\r\nbreak;\r\ndefault:\r\ncase IA_CSS_INPUT_MODE_FIFO:\r\ncase IA_CSS_INPUT_MODE_MEMORY:\r\nbreak;\r\n}\r\n}\r\nvoid\r\nia_css_debug_dump_mipi_buffer_config(\r\nconst struct ia_css_mipi_buffer_config *config)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s()\n", __func__);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "size_mem_words: %d\n",\r\nconfig->size_mem_words);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "nof_mipi_buffers: %d\n",\r\nconfig->nof_mipi_buffers);\r\n}\r\nvoid\r\nia_css_debug_dump_metadata_config(\r\nconst struct ia_css_metadata_config *config)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s()\n", __func__);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "data_type: %d\n",\r\nconfig->data_type);\r\nia_css_debug_dump_resolution(&config->resolution, "resolution");\r\n}\r\nvoid\r\nia_css_debug_dump_stream_config(\r\nconst struct ia_css_stream_config *config,\r\nint num_pipes)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "%s()\n", __func__);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "num_pipes: %d\n", num_pipes);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "mode: %d\n", config->mode);\r\nia_css_debug_dump_stream_config_source(config);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "channel_id: %d\n",\r\nconfig->channel_id);\r\nia_css_debug_dump_resolution(&config->input_config.input_res, "input_res");\r\nia_css_debug_dump_resolution(&config->input_config.effective_res, "effective_res");\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "format: %d\n",\r\nconfig->input_config.format);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "bayer_order: %d\n",\r\nconfig->input_config.bayer_order);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "sensor_binning_factor: %d\n",\r\nconfig->sensor_binning_factor);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "pixels_per_clock: %d\n",\r\nconfig->pixels_per_clock);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "online: %d\n",\r\nconfig->online);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "init_num_cont_raw_buf: %d\n",\r\nconfig->init_num_cont_raw_buf);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"target_num_cont_raw_buf: %d\n",\r\nconfig->target_num_cont_raw_buf);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "pack_raw_pixels: %d\n",\r\nconfig->pack_raw_pixels);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "continuous: %d\n",\r\nconfig->continuous);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "flash_gpio_pin: %d\n",\r\nconfig->flash_gpio_pin);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "left_padding: %d\n",\r\nconfig->left_padding);\r\nia_css_debug_dump_mipi_buffer_config(&config->mipi_buffer_config);\r\nia_css_debug_dump_metadata_config(&config->metadata_config);\r\n}\r\nvoid ia_css_debug_dump_trace(void)\r\n{\r\n#if TRACE_ENABLE_SP0\r\ndebug_dump_one_trace(TRACE_SP0_ID);\r\n#endif\r\n#if TRACE_ENABLE_SP1\r\ndebug_dump_one_trace(TRACE_SP1_ID);\r\n#endif\r\n#if TRACE_ENABLE_ISP\r\ndebug_dump_one_trace(TRACE_ISP_ID);\r\n#endif\r\n}\r\nvoid ia_css_debug_tagger_state(void)\r\n{\r\nunsigned int i;\r\nunsigned int HIVE_ADDR_tagger_frames;\r\nia_css_tagger_buf_sp_elem_t tbuf_frames[MAX_CB_ELEMS_FOR_TAGGER];\r\nHIVE_ADDR_tagger_frames = sh_css_sp_fw.info.sp.tagger_frames_addr;\r\n(void)HIVE_ADDR_tagger_frames;\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(tagger_frames),\r\ntbuf_frames,\r\nsizeof(tbuf_frames));\r\nia_css_debug_dtrace(2, "Tagger Info:\n");\r\nfor (i = 0; i < MAX_CB_ELEMS_FOR_TAGGER; i++) {\r\nia_css_debug_dtrace(2, "\t tagger frame[%d]: exp_id=%d, marked=%d, locked=%d\n",\r\ni, tbuf_frames[i].exp_id, tbuf_frames[i].mark, tbuf_frames[i].lock);\r\n}\r\n}\r\nvoid ia_css_debug_pc_dump(sp_ID_t id, unsigned int num_of_dumps)\r\n{\r\nunsigned int pc;\r\nunsigned int i;\r\nhrt_data sc = sp_ctrl_load(id, SP_SC_REG);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "SP%-1d Status reg: 0x%X\n", id, sc);\r\nsc = sp_ctrl_load(id, SP_CTRL_SINK_REG);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "SP%-1d Stall reg: 0x%X\n", id, sc);\r\nfor (i = 0; i < num_of_dumps; i++) {\r\npc = sp_ctrl_load(id, SP_PC_REG);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "SP%-1d PC: 0x%X\n", id, pc);\r\n}\r\n}
