int gb_audio_gb_get_topology(struct gb_connection *connection,\r\nstruct gb_audio_topology **topology)\r\n{\r\nstruct gb_audio_get_topology_size_response size_resp;\r\nstruct gb_audio_topology *topo;\r\nu16 size;\r\nint ret;\r\nret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_TOPOLOGY_SIZE,\r\nNULL, 0, &size_resp, sizeof(size_resp));\r\nif (ret)\r\nreturn ret;\r\nsize = le16_to_cpu(size_resp.size);\r\nif (size < sizeof(*topo))\r\nreturn -ENODATA;\r\ntopo = kzalloc(size, GFP_KERNEL);\r\nif (!topo)\r\nreturn -ENOMEM;\r\nret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_TOPOLOGY, NULL, 0,\r\ntopo, size);\r\nif (ret) {\r\nkfree(topo);\r\nreturn ret;\r\n}\r\n*topology = topo;\r\nreturn 0;\r\n}\r\nint gb_audio_gb_get_control(struct gb_connection *connection,\r\nu8 control_id, u8 index,\r\nstruct gb_audio_ctl_elem_value *value)\r\n{\r\nstruct gb_audio_get_control_request req;\r\nstruct gb_audio_get_control_response resp;\r\nint ret;\r\nreq.control_id = control_id;\r\nreq.index = index;\r\nret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_CONTROL,\r\n&req, sizeof(req), &resp, sizeof(resp));\r\nif (ret)\r\nreturn ret;\r\nmemcpy(value, &resp.value, sizeof(*value));\r\nreturn 0;\r\n}\r\nint gb_audio_gb_set_control(struct gb_connection *connection,\r\nu8 control_id, u8 index,\r\nstruct gb_audio_ctl_elem_value *value)\r\n{\r\nstruct gb_audio_set_control_request req;\r\nreq.control_id = control_id;\r\nreq.index = index;\r\nmemcpy(&req.value, value, sizeof(req.value));\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_CONTROL,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_enable_widget(struct gb_connection *connection,\r\nu8 widget_id)\r\n{\r\nstruct gb_audio_enable_widget_request req;\r\nreq.widget_id = widget_id;\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_ENABLE_WIDGET,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_disable_widget(struct gb_connection *connection,\r\nu8 widget_id)\r\n{\r\nstruct gb_audio_disable_widget_request req;\r\nreq.widget_id = widget_id;\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_DISABLE_WIDGET,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_get_pcm(struct gb_connection *connection, u16 data_cport,\r\nu32 *format, u32 *rate, u8 *channels,\r\nu8 *sig_bits)\r\n{\r\nstruct gb_audio_get_pcm_request req;\r\nstruct gb_audio_get_pcm_response resp;\r\nint ret;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_PCM,\r\n&req, sizeof(req), &resp, sizeof(resp));\r\nif (ret)\r\nreturn ret;\r\n*format = le32_to_cpu(resp.format);\r\n*rate = le32_to_cpu(resp.rate);\r\n*channels = resp.channels;\r\n*sig_bits = resp.sig_bits;\r\nreturn 0;\r\n}\r\nint gb_audio_gb_set_pcm(struct gb_connection *connection, u16 data_cport,\r\nu32 format, u32 rate, u8 channels,\r\nu8 sig_bits)\r\n{\r\nstruct gb_audio_set_pcm_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreq.format = cpu_to_le32(format);\r\nreq.rate = cpu_to_le32(rate);\r\nreq.channels = channels;\r\nreq.sig_bits = sig_bits;\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_PCM,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_set_tx_data_size(struct gb_connection *connection,\r\nu16 data_cport, u16 size)\r\n{\r\nstruct gb_audio_set_tx_data_size_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreq.size = cpu_to_le16(size);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_TX_DATA_SIZE,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_activate_tx(struct gb_connection *connection,\r\nu16 data_cport)\r\n{\r\nstruct gb_audio_activate_tx_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_ACTIVATE_TX,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_deactivate_tx(struct gb_connection *connection,\r\nu16 data_cport)\r\n{\r\nstruct gb_audio_deactivate_tx_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_DEACTIVATE_TX,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_set_rx_data_size(struct gb_connection *connection,\r\nu16 data_cport, u16 size)\r\n{\r\nstruct gb_audio_set_rx_data_size_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreq.size = cpu_to_le16(size);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_RX_DATA_SIZE,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_activate_rx(struct gb_connection *connection,\r\nu16 data_cport)\r\n{\r\nstruct gb_audio_activate_rx_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_ACTIVATE_RX,\r\n&req, sizeof(req), NULL, 0);\r\n}\r\nint gb_audio_gb_deactivate_rx(struct gb_connection *connection,\r\nu16 data_cport)\r\n{\r\nstruct gb_audio_deactivate_rx_request req;\r\nreq.data_cport = cpu_to_le16(data_cport);\r\nreturn gb_operation_sync(connection, GB_AUDIO_TYPE_DEACTIVATE_RX,\r\n&req, sizeof(req), NULL, 0);\r\n}
