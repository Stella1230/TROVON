static int __init config_pcmcia_cs(unsigned int cs,\r\nu32 base, unsigned int size)\r\n{\r\nint ret;\r\nret = bcm63xx_set_cs_status(cs, 0);\r\nif (!ret)\r\nret = bcm63xx_set_cs_base(cs, base, size);\r\nif (!ret)\r\nret = bcm63xx_set_cs_status(cs, 1);\r\nreturn ret;\r\n}\r\nint __init bcm63xx_pcmcia_register(void)\r\n{\r\nint ret, i;\r\nif (!BCMCPU_IS_6348() && !BCMCPU_IS_6358())\r\nreturn 0;\r\nswitch (bcm63xx_get_cpu_id()) {\r\ncase BCM6348_CPU_ID:\r\npd.ready_gpio = 22;\r\nbreak;\r\ncase BCM6358_CPU_ID:\r\npd.ready_gpio = 18;\r\nbreak;\r\ndefault:\r\nreturn -ENODEV;\r\n}\r\npcmcia_resources[0].start = bcm63xx_regset_address(RSET_PCMCIA);\r\npcmcia_resources[0].end = pcmcia_resources[0].start +\r\nRSET_PCMCIA_SIZE - 1;\r\npcmcia_resources[4].start = bcm63xx_get_irq_number(IRQ_PCMCIA);\r\nfor (i = 0; i < 3; i++) {\r\nret = config_pcmcia_cs(pcmcia_cs[i].cs,\r\npcmcia_cs[i].base,\r\npcmcia_cs[i].size);\r\nif (ret)\r\ngoto out_err;\r\n}\r\nreturn platform_device_register(&bcm63xx_pcmcia_device);\r\nout_err:\r\npr_err("unable to set pcmcia chip select\n");\r\nreturn ret;\r\n}
