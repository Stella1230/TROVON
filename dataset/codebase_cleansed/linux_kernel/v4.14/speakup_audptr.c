static void synth_flush(struct spk_synth *synth)\r\n{\r\nsynth->io_ops->flush_buffer();\r\nsynth->io_ops->send_xchar(SYNTH_CLEAR);\r\nsynth->io_ops->synth_out(synth, PROCSPEECH);\r\n}\r\nstatic void synth_version(struct spk_synth *synth)\r\n{\r\nunsigned char test = 0;\r\nchar synth_id[40] = "";\r\nsynth->synth_immediate(synth, "\x05[Q]");\r\nsynth_id[test] = synth->io_ops->synth_in();\r\nif (synth_id[test] == 'A') {\r\ndo {\r\nsynth_id[++test] = synth->io_ops->synth_in();\r\n} while (synth_id[test] != '\n' && test < 32);\r\nsynth_id[++test] = 0x00;\r\n}\r\nif (synth_id[0] == 'A')\r\npr_info("%s version: %s", synth->long_name, synth_id);\r\n}\r\nstatic int synth_probe(struct spk_synth *synth)\r\n{\r\nint failed;\r\nfailed = spk_ttyio_synth_probe(synth);\r\nif (failed == 0)\r\nsynth_version(synth);\r\nsynth->alive = !failed;\r\nreturn 0;\r\n}
