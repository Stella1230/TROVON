static void hi3660_clk_iomcu_init(struct device_node *np)\r\n{\r\nstruct hisi_clock_data *clk_data;\r\nint nr = ARRAY_SIZE(hi3660_iomcu_gate_sep_clks);\r\nclk_data = hisi_clk_init(np, nr);\r\nif (!clk_data)\r\nreturn;\r\nhisi_clk_register_gate_sep(hi3660_iomcu_gate_sep_clks,\r\nARRAY_SIZE(hi3660_iomcu_gate_sep_clks),\r\nclk_data);\r\n}\r\nstatic void hi3660_clk_pmuctrl_init(struct device_node *np)\r\n{\r\nstruct hisi_clock_data *clk_data;\r\nint nr = ARRAY_SIZE(hi3660_pmu_gate_clks);\r\nclk_data = hisi_clk_init(np, nr);\r\nif (!clk_data)\r\nreturn;\r\nhisi_clk_register_gate(hi3660_pmu_gate_clks,\r\nARRAY_SIZE(hi3660_pmu_gate_clks), clk_data);\r\n}\r\nstatic void hi3660_clk_pctrl_init(struct device_node *np)\r\n{\r\nstruct hisi_clock_data *clk_data;\r\nint nr = ARRAY_SIZE(hi3660_pctrl_gate_clks);\r\nclk_data = hisi_clk_init(np, nr);\r\nif (!clk_data)\r\nreturn;\r\nhisi_clk_register_gate(hi3660_pctrl_gate_clks,\r\nARRAY_SIZE(hi3660_pctrl_gate_clks), clk_data);\r\n}\r\nstatic void hi3660_clk_sctrl_init(struct device_node *np)\r\n{\r\nstruct hisi_clock_data *clk_data;\r\nint nr = ARRAY_SIZE(hi3660_sctrl_gate_clks) +\r\nARRAY_SIZE(hi3660_sctrl_gate_sep_clks) +\r\nARRAY_SIZE(hi3660_sctrl_mux_clks) +\r\nARRAY_SIZE(hi3660_sctrl_divider_clks);\r\nclk_data = hisi_clk_init(np, nr);\r\nif (!clk_data)\r\nreturn;\r\nhisi_clk_register_gate(hi3660_sctrl_gate_clks,\r\nARRAY_SIZE(hi3660_sctrl_gate_clks), clk_data);\r\nhisi_clk_register_gate_sep(hi3660_sctrl_gate_sep_clks,\r\nARRAY_SIZE(hi3660_sctrl_gate_sep_clks),\r\nclk_data);\r\nhisi_clk_register_mux(hi3660_sctrl_mux_clks,\r\nARRAY_SIZE(hi3660_sctrl_mux_clks), clk_data);\r\nhisi_clk_register_divider(hi3660_sctrl_divider_clks,\r\nARRAY_SIZE(hi3660_sctrl_divider_clks),\r\nclk_data);\r\n}\r\nstatic void hi3660_clk_crgctrl_early_init(struct device_node *np)\r\n{\r\nint nr = ARRAY_SIZE(hi3660_fixed_rate_clks) +\r\nARRAY_SIZE(hi3660_crgctrl_gate_sep_clks) +\r\nARRAY_SIZE(hi3660_crgctrl_gate_clks) +\r\nARRAY_SIZE(hi3660_crgctrl_mux_clks) +\r\nARRAY_SIZE(hi3660_crg_fixed_factor_clks) +\r\nARRAY_SIZE(hi3660_crgctrl_divider_clks);\r\nint i;\r\nclk_crgctrl_data = hisi_clk_init(np, nr);\r\nif (!clk_crgctrl_data)\r\nreturn;\r\nfor (i = 0; i < nr; i++)\r\nclk_crgctrl_data->clk_data.clks[i] = ERR_PTR(-EPROBE_DEFER);\r\nhisi_clk_register_fixed_rate(hi3660_fixed_rate_clks,\r\nARRAY_SIZE(hi3660_fixed_rate_clks),\r\nclk_crgctrl_data);\r\n}\r\nstatic void hi3660_clk_crgctrl_init(struct device_node *np)\r\n{\r\nstruct clk **clks;\r\nint i;\r\nif (!clk_crgctrl_data)\r\nhi3660_clk_crgctrl_early_init(np);\r\nif (!clk_crgctrl_data)\r\nreturn;\r\nhisi_clk_register_gate_sep(hi3660_crgctrl_gate_sep_clks,\r\nARRAY_SIZE(hi3660_crgctrl_gate_sep_clks),\r\nclk_crgctrl_data);\r\nhisi_clk_register_gate(hi3660_crgctrl_gate_clks,\r\nARRAY_SIZE(hi3660_crgctrl_gate_clks),\r\nclk_crgctrl_data);\r\nhisi_clk_register_mux(hi3660_crgctrl_mux_clks,\r\nARRAY_SIZE(hi3660_crgctrl_mux_clks),\r\nclk_crgctrl_data);\r\nhisi_clk_register_fixed_factor(hi3660_crg_fixed_factor_clks,\r\nARRAY_SIZE(hi3660_crg_fixed_factor_clks),\r\nclk_crgctrl_data);\r\nhisi_clk_register_divider(hi3660_crgctrl_divider_clks,\r\nARRAY_SIZE(hi3660_crgctrl_divider_clks),\r\nclk_crgctrl_data);\r\nclks = clk_crgctrl_data->clk_data.clks;\r\nfor (i = 0; i < clk_crgctrl_data->clk_data.clk_num; i++) {\r\nif (IS_ERR(clks[i]) && PTR_ERR(clks[i]) != -EPROBE_DEFER)\r\npr_err("Failed to register crgctrl clock[%d] err=%ld\n",\r\ni, PTR_ERR(clks[i]));\r\n}\r\n}\r\nstatic int hi3660_clk_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct device_node *np = pdev->dev.of_node;\r\nvoid (*init_func)(struct device_node *np);\r\ninit_func = of_device_get_match_data(dev);\r\nif (!init_func)\r\nreturn -ENODEV;\r\ninit_func(np);\r\nreturn 0;\r\n}\r\nstatic int __init hi3660_clk_init(void)\r\n{\r\nreturn platform_driver_register(&hi3660_clk_driver);\r\n}
