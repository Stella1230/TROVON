static irqreturn_t sigio_interrupt(int irq, void *data)\r\n{\r\nchar c;\r\nos_read_file(sigio_irq_fd, &c, sizeof(c));\r\nreactivate_fd(sigio_irq_fd, SIGIO_WRITE_IRQ);\r\nreturn IRQ_HANDLED;\r\n}\r\nint write_sigio_irq(int fd)\r\n{\r\nint err;\r\nerr = um_request_irq(SIGIO_WRITE_IRQ, fd, IRQ_READ, sigio_interrupt,\r\n0, "write sigio", NULL);\r\nif (err) {\r\nprintk(KERN_ERR "write_sigio_irq : um_request_irq failed, "\r\n"err = %d\n", err);\r\nreturn -1;\r\n}\r\nsigio_irq_fd = fd;\r\nreturn 0;\r\n}\r\nvoid sigio_lock(void)\r\n{\r\nspin_lock(&sigio_spinlock);\r\n}\r\nvoid sigio_unlock(void)\r\n{\r\nspin_unlock(&sigio_spinlock);\r\n}
