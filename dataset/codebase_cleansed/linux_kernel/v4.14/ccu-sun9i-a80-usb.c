static int sun9i_a80_usb_clk_probe(struct platform_device *pdev)\r\n{\r\nstruct resource *res;\r\nstruct clk *bus_clk;\r\nvoid __iomem *reg;\r\nint ret;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nreg = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(reg))\r\nreturn PTR_ERR(reg);\r\nbus_clk = devm_clk_get(&pdev->dev, "bus");\r\nif (IS_ERR(bus_clk)) {\r\nret = PTR_ERR(bus_clk);\r\nif (ret != -EPROBE_DEFER)\r\ndev_err(&pdev->dev, "Couldn't get bus clk: %d\n", ret);\r\nreturn ret;\r\n}\r\nret = clk_prepare_enable(bus_clk);\r\nif (ret) {\r\ndev_err(&pdev->dev, "Couldn't enable bus clk: %d\n", ret);\r\nreturn ret;\r\n}\r\nret = sunxi_ccu_probe(pdev->dev.of_node, reg,\r\n&sun9i_a80_usb_clk_desc);\r\nif (ret)\r\ngoto err_disable_clk;\r\nreturn 0;\r\nerr_disable_clk:\r\nclk_disable_unprepare(bus_clk);\r\nreturn ret;\r\n}
