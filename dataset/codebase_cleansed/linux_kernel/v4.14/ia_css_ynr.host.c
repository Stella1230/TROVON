void\r\nia_css_nr_encode(\r\nstruct sh_css_isp_ynr_params *to,\r\nconst struct ia_css_nr_config *from,\r\nunsigned size)\r\n{\r\n(void)size;\r\nto->threshold =\r\nuDIGIT_FITTING((unsigned)8192, 16, SH_CSS_BAYER_BITS);\r\nto->gain_all =\r\nuDIGIT_FITTING(from->ynr_gain, 16, SH_CSS_YNR_GAIN_SHIFT);\r\nto->gain_dir =\r\nuDIGIT_FITTING(from->ynr_gain, 16, SH_CSS_YNR_GAIN_SHIFT);\r\nto->threshold_cb =\r\nuDIGIT_FITTING(from->threshold_cb, 16, SH_CSS_BAYER_BITS);\r\nto->threshold_cr =\r\nuDIGIT_FITTING(from->threshold_cr, 16, SH_CSS_BAYER_BITS);\r\n}\r\nvoid\r\nia_css_yee_encode(\r\nstruct sh_css_isp_yee_params *to,\r\nconst struct ia_css_yee_config *from,\r\nunsigned size)\r\n{\r\nint asiWk1 = (int) from->ee.gain;\r\nint asiWk2 = asiWk1 / 8;\r\nint asiWk3 = asiWk1 / 4;\r\n(void)size;\r\nto->dirthreshold_s =\r\nmin((uDIGIT_FITTING(from->nr.direction, 16, SH_CSS_BAYER_BITS)\r\n<< 1),\r\nSH_CSS_BAYER_MAXVAL);\r\nto->dirthreshold_g =\r\nmin((uDIGIT_FITTING(from->nr.direction, 16, SH_CSS_BAYER_BITS)\r\n<< 4),\r\nSH_CSS_BAYER_MAXVAL);\r\nto->dirthreshold_width_log2 =\r\nuFRACTION_BITS_FITTING(8);\r\nto->dirthreshold_width =\r\n1 << to->dirthreshold_width_log2;\r\nto->detailgain =\r\nuDIGIT_FITTING(from->ee.detail_gain, 11,\r\nSH_CSS_YEE_DETAIL_GAIN_SHIFT);\r\nto->coring_s =\r\n(uDIGIT_FITTING((unsigned)56, 16, SH_CSS_BAYER_BITS) *\r\nfrom->ee.threshold) >> 8;\r\nto->coring_g =\r\n(uDIGIT_FITTING((unsigned)224, 16, SH_CSS_BAYER_BITS) *\r\nfrom->ee.threshold) >> 8;\r\nto->scale_plus_s =\r\n(asiWk1 + asiWk2) >> (11 - SH_CSS_YEE_SCALE_SHIFT);\r\nto->scale_plus_g =\r\n(0 - asiWk3) >> (11 - SH_CSS_YEE_SCALE_SHIFT);\r\nto->scale_minus_s =\r\n(asiWk1 - asiWk2) >> (11 - SH_CSS_YEE_SCALE_SHIFT);\r\nto->scale_minus_g =\r\n(asiWk3) >> (11 - SH_CSS_YEE_SCALE_SHIFT);\r\nto->clip_plus_s =\r\nuDIGIT_FITTING((unsigned)32760, 16, SH_CSS_BAYER_BITS);\r\nto->clip_plus_g = 0;\r\nto->clip_minus_s =\r\nuDIGIT_FITTING((unsigned)504, 16, SH_CSS_BAYER_BITS);\r\nto->clip_minus_g =\r\nuDIGIT_FITTING((unsigned)32256, 16, SH_CSS_BAYER_BITS);\r\nto->Yclip = SH_CSS_BAYER_MAXVAL;\r\n}\r\nvoid\r\nia_css_nr_dump(\r\nconst struct sh_css_isp_ynr_params *ynr,\r\nunsigned level)\r\n{\r\nif (!ynr) return;\r\nia_css_debug_dtrace(level,\r\n"Y Noise Reduction:\n");\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynr_threshold", ynr->threshold);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynr_gain_all", ynr->gain_all);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynr_gain_dir", ynr->gain_dir);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynr_threshold_cb", ynr->threshold_cb);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynr_threshold_cr", ynr->threshold_cr);\r\n}\r\nvoid\r\nia_css_yee_dump(\r\nconst struct sh_css_isp_yee_params *yee,\r\nunsigned level)\r\n{\r\nia_css_debug_dtrace(level,\r\n"Y Edge Enhancement:\n");\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynryee_dirthreshold_s",\r\nyee->dirthreshold_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynryee_dirthreshold_g",\r\nyee->dirthreshold_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynryee_dirthreshold_width_log2",\r\nyee->dirthreshold_width_log2);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynryee_dirthreshold_width",\r\nyee->dirthreshold_width);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_detailgain",\r\nyee->detailgain);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_coring_s",\r\nyee->coring_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_coring_g",\r\nyee->coring_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_scale_plus_s",\r\nyee->scale_plus_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_scale_plus_g",\r\nyee->scale_plus_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_scale_minus_s",\r\nyee->scale_minus_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_scale_minus_g",\r\nyee->scale_minus_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_clip_plus_s",\r\nyee->clip_plus_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_clip_plus_g",\r\nyee->clip_plus_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_clip_minus_s",\r\nyee->clip_minus_s);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"yee_clip_minus_g",\r\nyee->clip_minus_g);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n",\r\n"ynryee_Yclip",\r\nyee->Yclip);\r\n}\r\nvoid\r\nia_css_nr_debug_dtrace(\r\nconst struct ia_css_nr_config *config,\r\nunsigned level)\r\n{\r\nia_css_debug_dtrace(level,\r\n"config.direction=%d, "\r\n"config.bnr_gain=%d, config.ynr_gain=%d, "\r\n"config.threshold_cb=%d, config.threshold_cr=%d\n",\r\nconfig->direction,\r\nconfig->bnr_gain, config->ynr_gain,\r\nconfig->threshold_cb, config->threshold_cr);\r\n}\r\nvoid\r\nia_css_ee_debug_dtrace(\r\nconst struct ia_css_ee_config *config,\r\nunsigned level)\r\n{\r\nia_css_debug_dtrace(level,\r\n"config.threshold=%d, config.gain=%d, config.detail_gain=%d\n",\r\nconfig->threshold, config->gain, config->detail_gain);\r\n}\r\nvoid\r\nia_css_init_ynr_state(\r\nvoid *state,\r\nsize_t size)\r\n{\r\nmemset(state, 0, size);\r\n}
