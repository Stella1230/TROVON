static void pipe_binarydesc_get_offline(\r\nstruct ia_css_pipe const * const pipe,\r\nconst int mode,\r\nstruct ia_css_binary_descr *descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info[],\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nunsigned int i;\r\nassert(pipe != NULL);\r\nassert(descr != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE,\r\n"pipe_binarydesc_get_offline() enter:\n");\r\ndescr->mode = mode;\r\ndescr->online = false;\r\ndescr->continuous = pipe->stream->config.continuous;\r\ndescr->striped = false;\r\ndescr->two_ppc = false;\r\ndescr->enable_yuv_ds = false;\r\ndescr->enable_high_speed = false;\r\ndescr->enable_dvs_6axis = false;\r\ndescr->enable_reduced_pipe = false;\r\ndescr->enable_dz = true;\r\ndescr->enable_xnr = false;\r\ndescr->enable_dpc = false;\r\n#ifdef ISP2401\r\ndescr->enable_luma_only = false;\r\ndescr->enable_tnr = false;\r\n#endif\r\ndescr->enable_capture_pp_bli = false;\r\ndescr->enable_fractional_ds = false;\r\ndescr->dvs_env.width = 0;\r\ndescr->dvs_env.height = 0;\r\ndescr->stream_format = pipe->stream->config.input_config.format;\r\ndescr->in_info = in_info;\r\ndescr->bds_out_info = NULL;\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\ndescr->out_info[i] = out_info[i];\r\ndescr->vf_info = vf_info;\r\ndescr->isp_pipe_version = pipe->config.isp_pipe_version;\r\ndescr->required_bds_factor = SH_CSS_BDS_FACTOR_1_00;\r\ndescr->stream_config_left_padding = -1;\r\n}\r\nvoid ia_css_pipe_get_copy_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *copy_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nunsigned int i;\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_COPY,\r\ncopy_descr, in_info, out_infos, vf_info);\r\ncopy_descr->online = true;\r\ncopy_descr->continuous = false;\r\ncopy_descr->two_ppc = (pipe->stream->config.pixels_per_clock == 2);\r\ncopy_descr->enable_dz = false;\r\ncopy_descr->isp_pipe_version = IA_CSS_PIPE_VERSION_1;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_vfpp_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *vf_pp_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nunsigned int i;\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\nin_info->raw_bit_depth = 0;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_VF_PP,\r\nvf_pp_descr, in_info, out_infos, NULL);\r\nvf_pp_descr->enable_fractional_ds = true;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nenum ia_css_err sh_css_bds_factor_get_numerator_denominator(\r\nunsigned int bds_factor,\r\nunsigned int *bds_factor_numerator,\r\nunsigned int *bds_factor_denominator)\r\n{\r\nunsigned int i;\r\nunsigned int bds_list_size = sizeof(bds_factors_list) /\r\nsizeof(struct sh_css_bds_factor);\r\nfor (i = 0; i < bds_list_size; i++) {\r\nif (bds_factors_list[i].bds_factor == bds_factor) {\r\n*bds_factor_numerator = bds_factors_list[i].numerator;\r\n*bds_factor_denominator = bds_factors_list[i].denominator;\r\nreturn IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn IA_CSS_ERR_INVALID_ARGUMENTS;\r\n}\r\nenum ia_css_err binarydesc_calculate_bds_factor(\r\nstruct ia_css_resolution input_res,\r\nstruct ia_css_resolution output_res,\r\nunsigned int *bds_factor)\r\n{\r\nunsigned int i;\r\nunsigned int bds_list_size = sizeof(bds_factors_list) /\r\nsizeof(struct sh_css_bds_factor);\r\nunsigned int in_w = input_res.width,\r\nin_h = input_res.height,\r\nout_w = output_res.width, out_h = output_res.height;\r\nunsigned int max_bds_factor = 8;\r\nunsigned int max_rounding_margin = 2;\r\nunsigned int delta = max_bds_factor * max_rounding_margin;\r\nassert(in_w != 0 && in_h != 0);\r\nassert(out_w != 0 && out_h != 0);\r\nfor (i = 0; i < bds_list_size; i++) {\r\nunsigned num = bds_factors_list[i].numerator;\r\nunsigned den = bds_factors_list[i].denominator;\r\nbool cond = (out_w * num / den + delta > in_w) &&\r\n(out_w * num / den <= in_w) &&\r\n(out_h * num / den + delta > in_h) &&\r\n(out_h * num / den <= in_h);\r\nif (cond) {\r\n*bds_factor = bds_factors_list[i].bds_factor;\r\nreturn IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn IA_CSS_ERR_INVALID_ARGUMENTS;\r\n}\r\nenum ia_css_err ia_css_pipe_get_preview_binarydesc(\r\nstruct ia_css_pipe * const pipe,\r\nstruct ia_css_binary_descr *preview_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *bds_out_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nenum ia_css_err err;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nint mode = IA_CSS_BINARY_MODE_PREVIEW;\r\nunsigned int i;\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nassert(vf_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\nin_info->res = pipe->config.input_effective_res;\r\nin_info->padded_width = in_info->res.width;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\r\nmode = IA_CSS_BINARY_MODE_COPY;\r\nelse\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, mode,\r\npreview_descr, in_info, out_infos, vf_info);\r\nif (pipe->stream->config.online) {\r\npreview_descr->online = pipe->stream->config.online;\r\npreview_descr->two_ppc =\r\n(pipe->stream->config.pixels_per_clock == 2);\r\n}\r\npreview_descr->stream_format = pipe->stream->config.input_config.format;\r\n*bds_out_info = *in_info;\r\nif (pipe->extra_config.enable_raw_binning) {\r\nif (pipe->config.bayer_ds_out_res.width != 0 &&\r\npipe->config.bayer_ds_out_res.height != 0) {\r\nbds_out_info->res.width =\r\npipe->config.bayer_ds_out_res.width;\r\nbds_out_info->res.height =\r\npipe->config.bayer_ds_out_res.height;\r\nbds_out_info->padded_width =\r\npipe->config.bayer_ds_out_res.width;\r\nerr =\r\nbinarydesc_calculate_bds_factor(in_info->res,\r\nbds_out_info->res,\r\n&preview_descr->required_bds_factor);\r\nif (err != IA_CSS_SUCCESS)\r\nreturn err;\r\n} else {\r\nbds_out_info->res.width = in_info->res.width / 2;\r\nbds_out_info->res.height = in_info->res.height / 2;\r\nbds_out_info->padded_width = in_info->padded_width / 2;\r\npreview_descr->required_bds_factor =\r\nSH_CSS_BDS_FACTOR_2_00;\r\n}\r\n} else {\r\nbds_out_info->res.width = in_info->res.width;\r\nbds_out_info->res.height = in_info->res.height;\r\nbds_out_info->padded_width = in_info->padded_width;\r\npreview_descr->required_bds_factor = SH_CSS_BDS_FACTOR_1_00;\r\n}\r\npipe->required_bds_factor = preview_descr->required_bds_factor;\r\nif (!pipe->extra_config.enable_fractional_ds)\r\npreview_descr->bds_out_info = bds_out_info;\r\nelse\r\npreview_descr->bds_out_info = NULL;\r\n*out_info = *vf_info;\r\nif (!pipe->extra_config.enable_fractional_ds) {\r\nout_info->res.width = bds_out_info->res.width;\r\nout_info->res.height = bds_out_info->res.height;\r\nout_info->padded_width = bds_out_info->padded_width;\r\n}\r\npreview_descr->enable_fractional_ds =\r\npipe->extra_config.enable_fractional_ds;\r\npreview_descr->enable_dpc = pipe->config.enable_dpc;\r\npreview_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_ERR_PRIVATE(IA_CSS_SUCCESS);\r\nreturn IA_CSS_SUCCESS;\r\n}\r\nenum ia_css_err ia_css_pipe_get_video_binarydesc(\r\nstruct ia_css_pipe * const pipe,\r\nstruct ia_css_binary_descr *video_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *bds_out_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info,\r\nint stream_config_left_padding)\r\n{\r\nint mode = IA_CSS_BINARY_MODE_VIDEO;\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nenum ia_css_err err = IA_CSS_SUCCESS;\r\nbool stream_dz_config = false;\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\nif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\r\nmode = IA_CSS_BINARY_MODE_COPY;\r\nin_info->res = pipe->config.input_effective_res;\r\nin_info->padded_width = in_info->res.width;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, mode,\r\nvideo_descr, in_info, out_infos, vf_info);\r\nif (pipe->stream->config.online) {\r\nvideo_descr->online = pipe->stream->config.online;\r\nvideo_descr->two_ppc =\r\n(pipe->stream->config.pixels_per_clock == 2);\r\n}\r\nif (mode == IA_CSS_BINARY_MODE_VIDEO) {\r\nstream_dz_config =\r\n((pipe->stream->isp_params_configs->dz_config.dx !=\r\nHRT_GDC_N)\r\n|| (pipe->stream->isp_params_configs->dz_config.dy !=\r\nHRT_GDC_N));\r\nvideo_descr->enable_dz = pipe->config.enable_dz\r\n|| stream_dz_config;\r\nvideo_descr->dvs_env = pipe->config.dvs_envelope;\r\nvideo_descr->enable_yuv_ds = pipe->extra_config.enable_yuv_ds;\r\nvideo_descr->enable_high_speed =\r\npipe->extra_config.enable_high_speed;\r\nvideo_descr->enable_dvs_6axis =\r\npipe->extra_config.enable_dvs_6axis;\r\nvideo_descr->enable_reduced_pipe =\r\npipe->extra_config.enable_reduced_pipe;\r\nvideo_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nvideo_descr->enable_fractional_ds =\r\npipe->extra_config.enable_fractional_ds;\r\nvideo_descr->enable_dpc =\r\npipe->config.enable_dpc;\r\n#ifdef ISP2401\r\nvideo_descr->enable_luma_only =\r\npipe->config.enable_luma_only;\r\nvideo_descr->enable_tnr =\r\npipe->config.enable_tnr;\r\n#endif\r\nif (pipe->extra_config.enable_raw_binning) {\r\nif (pipe->config.bayer_ds_out_res.width != 0 &&\r\npipe->config.bayer_ds_out_res.height != 0) {\r\nbds_out_info->res.width =\r\npipe->config.bayer_ds_out_res.width;\r\nbds_out_info->res.height =\r\npipe->config.bayer_ds_out_res.height;\r\nbds_out_info->padded_width =\r\npipe->config.bayer_ds_out_res.width;\r\nerr =\r\nbinarydesc_calculate_bds_factor(\r\nin_info->res, bds_out_info->res,\r\n&video_descr->required_bds_factor);\r\nif (err != IA_CSS_SUCCESS)\r\nreturn err;\r\n} else {\r\nbds_out_info->res.width =\r\nin_info->res.width / 2;\r\nbds_out_info->res.height =\r\nin_info->res.height / 2;\r\nbds_out_info->padded_width =\r\nin_info->padded_width / 2;\r\nvideo_descr->required_bds_factor =\r\nSH_CSS_BDS_FACTOR_2_00;\r\n}\r\n} else {\r\nbds_out_info->res.width = in_info->res.width;\r\nbds_out_info->res.height = in_info->res.height;\r\nbds_out_info->padded_width = in_info->padded_width;\r\nvideo_descr->required_bds_factor =\r\nSH_CSS_BDS_FACTOR_1_00;\r\n}\r\npipe->required_bds_factor = video_descr->required_bds_factor;\r\nif (!pipe->extra_config.enable_fractional_ds)\r\nvideo_descr->bds_out_info = bds_out_info;\r\nelse\r\nvideo_descr->bds_out_info = NULL;\r\nvideo_descr->enable_fractional_ds =\r\npipe->extra_config.enable_fractional_ds;\r\nvideo_descr->stream_config_left_padding = stream_config_left_padding;\r\n}\r\nIA_CSS_LEAVE_ERR_PRIVATE(err);\r\nreturn err;\r\n}\r\nvoid ia_css_pipe_get_yuvscaler_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *yuv_scaler_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *internal_out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nstruct ia_css_frame_info *this_vf_info = NULL;\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(IA_CSS_BINARY_MAX_OUTPUT_PORTS == 2);\r\nIA_CSS_ENTER_PRIVATE("");\r\nin_info->padded_width = in_info->res.width;\r\nin_info->raw_bit_depth = 0;\r\nia_css_frame_info_set_width(in_info, in_info->res.width, 0);\r\nout_infos[0] = out_info;\r\nout_infos[1] = internal_out_info;\r\nif (vf_info) {\r\nthis_vf_info = (vf_info->res.width == 0 &&\r\nvf_info->res.height == 0) ? NULL : vf_info;\r\n}\r\npipe_binarydesc_get_offline(pipe,\r\nIA_CSS_BINARY_MODE_CAPTURE_PP,\r\nyuv_scaler_descr,\r\nin_info, out_infos, this_vf_info);\r\nyuv_scaler_descr->enable_fractional_ds = true;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_capturepp_binarydesc(\r\nstruct ia_css_pipe * const pipe,\r\nstruct ia_css_binary_descr *capture_pp_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(vf_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\nif (pipe->out_yuv_ds_input_info.res.width)\r\n*in_info = pipe->out_yuv_ds_input_info;\r\nelse\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_YUV420;\r\nin_info->raw_bit_depth = 0;\r\nia_css_frame_info_set_width(in_info, in_info->res.width, 0);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe,\r\nIA_CSS_BINARY_MODE_CAPTURE_PP,\r\ncapture_pp_descr,\r\nin_info, out_infos, vf_info);\r\ncapture_pp_descr->enable_capture_pp_bli =\r\npipe->config.default_capture_config.enable_capture_pp_bli;\r\ncapture_pp_descr->enable_fractional_ds = true;\r\ncapture_pp_descr->enable_xnr =\r\npipe->config.default_capture_config.enable_xnr != 0;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_primary_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *prim_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info,\r\nunsigned int stage_idx)\r\n{\r\nenum ia_css_pipe_version pipe_version = pipe->config.isp_pipe_version;\r\nint mode;\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nassert(stage_idx < NUM_PRIMARY_HQ_STAGES);\r\nIA_CSS_ENTER_PRIVATE("");\r\nif (pipe_version == IA_CSS_PIPE_VERSION_2_6_1)\r\nmode = primary_hq_binary_modes[stage_idx];\r\nelse\r\nmode = IA_CSS_BINARY_MODE_PRIMARY;\r\nif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\r\nmode = IA_CSS_BINARY_MODE_COPY;\r\nin_info->res = pipe->config.input_effective_res;\r\nin_info->padded_width = in_info->res.width;\r\n#if !defined(HAS_NO_PACKED_RAW_PIXELS)\r\nif (pipe->stream->config.pack_raw_pixels)\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW_PACKED;\r\nelse\r\n#endif\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, mode,\r\nprim_descr, in_info, out_infos, vf_info);\r\nif (pipe->stream->config.online &&\r\npipe->stream->config.mode != IA_CSS_INPUT_MODE_MEMORY) {\r\nprim_descr->online = true;\r\nprim_descr->two_ppc =\r\n(pipe->stream->config.pixels_per_clock == 2);\r\nprim_descr->stream_format = pipe->stream->config.input_config.format;\r\n}\r\nif (mode == IA_CSS_BINARY_MODE_PRIMARY) {\r\nprim_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nprim_descr->enable_fractional_ds =\r\npipe->extra_config.enable_fractional_ds;\r\n#ifdef ISP2401\r\nprim_descr->enable_luma_only =\r\npipe->config.enable_luma_only;\r\n#endif\r\nif (pipe_version == IA_CSS_PIPE_VERSION_2_6_1)\r\nprim_descr->striped = false;\r\nelse\r\n#ifndef ISP2401\r\nprim_descr->striped = prim_descr->continuous && (!pipe->stream->stop_copy_preview || !pipe->stream->disable_cont_vf);\r\n#else\r\nprim_descr->striped = prim_descr->continuous && !pipe->stream->disable_cont_vf;\r\nif ((pipe->config.default_capture_config.enable_xnr != 0) &&\r\n(pipe->extra_config.enable_dvs_6axis == true))\r\nprim_descr->enable_xnr = true;\r\n#endif\r\n}\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_pre_gdc_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *pre_gdc_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\r\npre_gdc_descr, in_info, out_infos, NULL);\r\npre_gdc_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_gdc_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *gdc_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_QPLANE6;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_GDC,\r\ngdc_descr, in_info, out_infos, NULL);\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_post_gdc_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *post_gdc_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nassert(vf_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_YUV420_16;\r\nin_info->raw_bit_depth = 16;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_POST_ISP,\r\npost_gdc_descr, in_info, out_infos, vf_info);\r\npost_gdc_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_pre_de_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *pre_de_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\nif (pipe->config.isp_pipe_version == IA_CSS_PIPE_VERSION_1)\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\r\npre_de_descr, in_info, out_infos, NULL);\r\nelse if (pipe->config.isp_pipe_version == IA_CSS_PIPE_VERSION_2_2) {\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_DE,\r\npre_de_descr, in_info, out_infos, NULL);\r\n}\r\nif (pipe->stream->config.online) {\r\npre_de_descr->online = true;\r\npre_de_descr->two_ppc =\r\n(pipe->stream->config.pixels_per_clock == 2);\r\npre_de_descr->stream_format = pipe->stream->config.input_config.format;\r\n}\r\npre_de_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_pre_anr_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *pre_anr_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\r\npre_anr_descr, in_info, out_infos, NULL);\r\nif (pipe->stream->config.online) {\r\npre_anr_descr->online = true;\r\npre_anr_descr->two_ppc =\r\n(pipe->stream->config.pixels_per_clock == 2);\r\npre_anr_descr->stream_format = pipe->stream->config.input_config.format;\r\n}\r\npre_anr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_anr_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *anr_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ANR_ELEMENT_BITS;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_ANR,\r\nanr_descr, in_info, out_infos, NULL);\r\nanr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_post_anr_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *post_anr_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info,\r\nstruct ia_css_frame_info *vf_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nassert(vf_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n*in_info = *out_info;\r\nin_info->format = IA_CSS_FRAME_FORMAT_RAW;\r\nin_info->raw_bit_depth = ANR_ELEMENT_BITS;\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_POST_ISP,\r\npost_anr_descr, in_info, out_infos, vf_info);\r\npost_anr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}\r\nvoid ia_css_pipe_get_ldc_binarydesc(\r\nstruct ia_css_pipe const * const pipe,\r\nstruct ia_css_binary_descr *ldc_descr,\r\nstruct ia_css_frame_info *in_info,\r\nstruct ia_css_frame_info *out_info)\r\n{\r\nunsigned int i;\r\nstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nassert(pipe != NULL);\r\nassert(in_info != NULL);\r\nassert(out_info != NULL);\r\nIA_CSS_ENTER_PRIVATE("");\r\n#ifndef ISP2401\r\n*in_info = *out_info;\r\n#else\r\nif (pipe->out_yuv_ds_input_info.res.width)\r\n*in_info = pipe->out_yuv_ds_input_info;\r\nelse\r\n*in_info = *out_info;\r\n#endif\r\nin_info->format = IA_CSS_FRAME_FORMAT_YUV420;\r\nin_info->raw_bit_depth = 0;\r\nia_css_frame_info_set_width(in_info, in_info->res.width, 0);\r\nout_infos[0] = out_info;\r\nfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nout_infos[i] = NULL;\r\npipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_CAPTURE_PP,\r\nldc_descr, in_info, out_infos, NULL);\r\nldc_descr->enable_dvs_6axis =\r\npipe->extra_config.enable_dvs_6axis;\r\nIA_CSS_LEAVE_PRIVATE("");\r\n}
