int inet_add_protocol(const struct net_protocol *prot, unsigned char protocol)\r\n{\r\nif (!prot->netns_ok) {\r\npr_err("Protocol %u is not namespace aware, cannot register.\n",\r\nprotocol);\r\nreturn -EINVAL;\r\n}\r\nreturn !cmpxchg((const struct net_protocol **)&inet_protos[protocol],\r\nNULL, prot) ? 0 : -1;\r\n}\r\nint inet_add_offload(const struct net_offload *prot, unsigned char protocol)\r\n{\r\nreturn !cmpxchg((const struct net_offload **)&inet_offloads[protocol],\r\nNULL, prot) ? 0 : -1;\r\n}\r\nint inet_del_protocol(const struct net_protocol *prot, unsigned char protocol)\r\n{\r\nint ret;\r\nret = (cmpxchg((const struct net_protocol **)&inet_protos[protocol],\r\nprot, NULL) == prot) ? 0 : -1;\r\nsynchronize_net();\r\nreturn ret;\r\n}\r\nint inet_del_offload(const struct net_offload *prot, unsigned char protocol)\r\n{\r\nint ret;\r\nret = (cmpxchg((const struct net_offload **)&inet_offloads[protocol],\r\nprot, NULL) == prot) ? 0 : -1;\r\nsynchronize_net();\r\nreturn ret;\r\n}
