void qla4xxx_dump_buffer(void *b, uint32_t size)\r\n{\r\nuint32_t cnt;\r\nuint8_t *c = b;\r\nprintk(" 0 1 2 3 4 5 6 7 8 9 Ah Bh Ch Dh Eh "\r\n"Fh\n");\r\nprintk("------------------------------------------------------------"\r\n"--\n");\r\nfor (cnt = 0; cnt < size; c++) {\r\nprintk("%02x", *c);\r\nif (!(++cnt % 16))\r\nprintk("\n");\r\nelse\r\nprintk(" ");\r\n}\r\nprintk(KERN_INFO "\n");\r\n}\r\nvoid qla4xxx_dump_registers(struct scsi_qla_host *ha)\r\n{\r\nuint8_t i;\r\nif (is_qla8022(ha)) {\r\nfor (i = 1; i < MBOX_REG_COUNT; i++)\r\nprintk(KERN_INFO "mailbox[%d] = 0x%08X\n",\r\ni, readl(&ha->qla4_82xx_reg->mailbox_in[i]));\r\nreturn;\r\n}\r\nfor (i = 0; i < MBOX_REG_COUNT; i++) {\r\nprintk(KERN_INFO "0x%02X mailbox[%d] = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, mailbox[i]), i,\r\nreadw(&ha->reg->mailbox[i]));\r\n}\r\nprintk(KERN_INFO "0x%02X flash_address = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, flash_address),\r\nreadw(&ha->reg->flash_address));\r\nprintk(KERN_INFO "0x%02X flash_data = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, flash_data),\r\nreadw(&ha->reg->flash_data));\r\nprintk(KERN_INFO "0x%02X ctrl_status = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, ctrl_status),\r\nreadw(&ha->reg->ctrl_status));\r\nif (is_qla4010(ha)) {\r\nprintk(KERN_INFO "0x%02X nvram = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u1.isp4010.nvram),\r\nreadw(&ha->reg->u1.isp4010.nvram));\r\n} else if (is_qla4022(ha) | is_qla4032(ha)) {\r\nprintk(KERN_INFO "0x%02X intr_mask = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u1.isp4022.intr_mask),\r\nreadw(&ha->reg->u1.isp4022.intr_mask));\r\nprintk(KERN_INFO "0x%02X nvram = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u1.isp4022.nvram),\r\nreadw(&ha->reg->u1.isp4022.nvram));\r\nprintk(KERN_INFO "0x%02X semaphore = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u1.isp4022.semaphore),\r\nreadw(&ha->reg->u1.isp4022.semaphore));\r\n}\r\nprintk(KERN_INFO "0x%02X req_q_in = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, req_q_in),\r\nreadw(&ha->reg->req_q_in));\r\nprintk(KERN_INFO "0x%02X rsp_q_out = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, rsp_q_out),\r\nreadw(&ha->reg->rsp_q_out));\r\nif (is_qla4010(ha)) {\r\nprintk(KERN_INFO "0x%02X ext_hw_conf = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.ext_hw_conf),\r\nreadw(&ha->reg->u2.isp4010.ext_hw_conf));\r\nprintk(KERN_INFO "0x%02X port_ctrl = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.port_ctrl),\r\nreadw(&ha->reg->u2.isp4010.port_ctrl));\r\nprintk(KERN_INFO "0x%02X port_status = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.port_status),\r\nreadw(&ha->reg->u2.isp4010.port_status));\r\nprintk(KERN_INFO "0x%02X req_q_out = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.req_q_out),\r\nreadw(&ha->reg->u2.isp4010.req_q_out));\r\nprintk(KERN_INFO "0x%02X gp_out = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.gp_out),\r\nreadw(&ha->reg->u2.isp4010.gp_out));\r\nprintk(KERN_INFO "0x%02X gp_in = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4010.gp_in),\r\nreadw(&ha->reg->u2.isp4010.gp_in));\r\nprintk(KERN_INFO "0x%02X port_err_status = 0x%08X\n", (uint8_t)\r\noffsetof(struct isp_reg, u2.isp4010.port_err_status),\r\nreadw(&ha->reg->u2.isp4010.port_err_status));\r\n} else if (is_qla4022(ha) | is_qla4032(ha)) {\r\nprintk(KERN_INFO "Page 0 Registers:\n");\r\nprintk(KERN_INFO "0x%02X ext_hw_conf = 0x%08X\n", (uint8_t)\r\noffsetof(struct isp_reg, u2.isp4022.p0.ext_hw_conf),\r\nreadw(&ha->reg->u2.isp4022.p0.ext_hw_conf));\r\nprintk(KERN_INFO "0x%02X port_ctrl = 0x%08X\n", (uint8_t)\r\noffsetof(struct isp_reg, u2.isp4022.p0.port_ctrl),\r\nreadw(&ha->reg->u2.isp4022.p0.port_ctrl));\r\nprintk(KERN_INFO "0x%02X port_status = 0x%08X\n", (uint8_t)\r\noffsetof(struct isp_reg, u2.isp4022.p0.port_status),\r\nreadw(&ha->reg->u2.isp4022.p0.port_status));\r\nprintk(KERN_INFO "0x%02X gp_out = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4022.p0.gp_out),\r\nreadw(&ha->reg->u2.isp4022.p0.gp_out));\r\nprintk(KERN_INFO "0x%02X gp_in = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4022.p0.gp_in),\r\nreadw(&ha->reg->u2.isp4022.p0.gp_in));\r\nprintk(KERN_INFO "0x%02X port_err_status = 0x%08X\n", (uint8_t)\r\noffsetof(struct isp_reg, u2.isp4022.p0.port_err_status),\r\nreadw(&ha->reg->u2.isp4022.p0.port_err_status));\r\nprintk(KERN_INFO "Page 1 Registers:\n");\r\nwritel(HOST_MEM_CFG_PAGE & set_rmask(CSR_SCSI_PAGE_SELECT),\r\n&ha->reg->ctrl_status);\r\nprintk(KERN_INFO "0x%02X req_q_out = 0x%08X\n",\r\n(uint8_t) offsetof(struct isp_reg, u2.isp4022.p1.req_q_out),\r\nreadw(&ha->reg->u2.isp4022.p1.req_q_out));\r\nwritel(PORT_CTRL_STAT_PAGE & set_rmask(CSR_SCSI_PAGE_SELECT),\r\n&ha->reg->ctrl_status);\r\n}\r\n}\r\nvoid qla4_8xxx_dump_peg_reg(struct scsi_qla_host *ha)\r\n{\r\nuint32_t halt_status1, halt_status2;\r\nhalt_status1 = qla4_8xxx_rd_direct(ha, QLA8XXX_PEG_HALT_STATUS1);\r\nhalt_status2 = qla4_8xxx_rd_direct(ha, QLA8XXX_PEG_HALT_STATUS2);\r\nif (is_qla8022(ha)) {\r\nql4_printk(KERN_INFO, ha,\r\n"scsi(%ld): %s, ISP%04x Dumping hw/fw registers:\n"\r\n" PEG_HALT_STATUS1: 0x%x, PEG_HALT_STATUS2: 0x%x,\n"\r\n" PEG_NET_0_PC: 0x%x, PEG_NET_1_PC: 0x%x,\n"\r\n" PEG_NET_2_PC: 0x%x, PEG_NET_3_PC: 0x%x,\n"\r\n" PEG_NET_4_PC: 0x%x\n", ha->host_no, __func__,\r\nha->pdev->device, halt_status1, halt_status2,\r\nqla4_82xx_rd_32(ha, QLA82XX_CRB_PEG_NET_0 + 0x3c),\r\nqla4_82xx_rd_32(ha, QLA82XX_CRB_PEG_NET_1 + 0x3c),\r\nqla4_82xx_rd_32(ha, QLA82XX_CRB_PEG_NET_2 + 0x3c),\r\nqla4_82xx_rd_32(ha, QLA82XX_CRB_PEG_NET_3 + 0x3c),\r\nqla4_82xx_rd_32(ha, QLA82XX_CRB_PEG_NET_4 + 0x3c));\r\n} else if (is_qla8032(ha) || is_qla8042(ha)) {\r\nql4_printk(KERN_INFO, ha,\r\n"scsi(%ld): %s, ISP%04x Dumping hw/fw registers:\n"\r\n" PEG_HALT_STATUS1: 0x%x, PEG_HALT_STATUS2: 0x%x,\n",\r\nha->host_no, __func__, ha->pdev->device,\r\nhalt_status1, halt_status2);\r\n}\r\n}
