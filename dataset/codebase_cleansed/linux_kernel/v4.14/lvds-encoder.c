static int lvds_encoder_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *port;\r\nstruct device_node *endpoint;\r\nstruct device_node *panel_node;\r\nstruct drm_panel *panel;\r\nstruct drm_bridge *bridge;\r\nport = of_graph_get_port_by_id(pdev->dev.of_node, 1);\r\nif (!port) {\r\ndev_dbg(&pdev->dev, "port 1 not found\n");\r\nreturn -ENXIO;\r\n}\r\nendpoint = of_get_child_by_name(port, "endpoint");\r\nof_node_put(port);\r\nif (!endpoint) {\r\ndev_dbg(&pdev->dev, "no endpoint for port 1\n");\r\nreturn -ENXIO;\r\n}\r\npanel_node = of_graph_get_remote_port_parent(endpoint);\r\nof_node_put(endpoint);\r\nif (!panel_node) {\r\ndev_dbg(&pdev->dev, "no remote endpoint for port 1\n");\r\nreturn -ENXIO;\r\n}\r\npanel = of_drm_find_panel(panel_node);\r\nof_node_put(panel_node);\r\nif (!panel) {\r\ndev_dbg(&pdev->dev, "panel not found, deferring probe\n");\r\nreturn -EPROBE_DEFER;\r\n}\r\nbridge = drm_panel_bridge_add(panel, DRM_MODE_CONNECTOR_LVDS);\r\nif (IS_ERR(bridge))\r\nreturn PTR_ERR(bridge);\r\nplatform_set_drvdata(pdev, bridge);\r\nreturn 0;\r\n}\r\nstatic int lvds_encoder_remove(struct platform_device *pdev)\r\n{\r\nstruct drm_bridge *bridge = platform_get_drvdata(pdev);\r\ndrm_bridge_remove(bridge);\r\nreturn 0;\r\n}
