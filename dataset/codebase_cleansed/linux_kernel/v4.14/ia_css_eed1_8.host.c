void\r\nia_css_eed1_8_vmem_encode(\r\nstruct eed1_8_vmem_params *to,\r\nconst struct ia_css_eed1_8_config *from,\r\nsize_t size)\r\n{\r\nunsigned i, j, base;\r\nconst unsigned total_blocks = 4;\r\nconst unsigned shuffle_block = 16;\r\n(void)size;\r\nfor (i = 0; i < ISP_VEC_NELEMS; i++) {\r\nto->e_dew_enh_x[0][i] = 0;\r\nto->e_dew_enh_y[0][i] = 0;\r\nto->e_dew_enh_a[0][i] = 0;\r\nto->e_dew_enh_f[0][i] = 0;\r\nto->chgrinv_x[0][i] = 0;\r\nto->chgrinv_a[0][i] = 0;\r\nto->chgrinv_b[0][i] = 0;\r\nto->chgrinv_c[0][i] = 0;\r\nto->tcinv_x[0][i] = 0;\r\nto->tcinv_a[0][i] = 0;\r\nto->tcinv_b[0][i] = 0;\r\nto->tcinv_c[0][i] = 0;\r\nto->fcinv_x[0][i] = 0;\r\nto->fcinv_a[0][i] = 0;\r\nto->fcinv_b[0][i] = 0;\r\nto->fcinv_c[0][i] = 0;\r\n}\r\nfor (j = 0; j < IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS; j++) {\r\nassert(from->dew_enhance_seg_x[j] > -1);\r\nassert(from->dew_enhance_seg_y[j] > -1);\r\n}\r\nfor (j = 1; j < IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS; j++) {\r\nassert(from->dew_enhance_seg_x[j] > from->dew_enhance_seg_x[j-1]);\r\nassert(from->dew_enhance_seg_y[j] > from->dew_enhance_seg_y[j-1]);\r\n}\r\nassert(from->dew_enhance_seg_x[0] == 0);\r\nassert(from->dew_enhance_seg_y[0] == 0);\r\nassert(chgrinv_x[0] == 0);\r\nassert(tcinv_x[0] == 0);\r\nassert(fcinv_x[0] == 0);\r\nfor (j = 1; j < NUMBER_OF_CHGRINV_POINTS; j++) {\r\nassert(chgrinv_x[j] > chgrinv_x[j-1]);\r\n}\r\nfor (j = 1; j < NUMBER_OF_TCINV_POINTS; j++) {\r\nassert(tcinv_x[j] > tcinv_x[j-1]);\r\n}\r\nfor (j = 1; j < NUMBER_OF_FCINV_POINTS; j++) {\r\nassert(fcinv_x[j] > fcinv_x[j-1]);\r\n}\r\nfor(i = 0; i < total_blocks; i++) {\r\nbase = shuffle_block * i;\r\nfor (j = 0; j < IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS; j++) {\r\nto->e_dew_enh_x[0][base + j] = min(max(from->dew_enhance_seg_x[j], 0), 8191);\r\nto->e_dew_enh_y[0][base + j] = min(max(from->dew_enhance_seg_y[j], -8192), 8191);\r\n}\r\nfor (j = 0; j < (IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS - 1); j++) {\r\nto->e_dew_enh_a[0][base + j] = min(max(from->dew_enhance_seg_slope[j], -8192), 8191);\r\nto->e_dew_enh_f[0][base + j] = (min(max(from->dew_enhance_seg_exp[j], 0), 13) > 0);\r\n}\r\nto->e_dew_enh_a[0][base + (IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS - 1)] = 0;\r\nto->e_dew_enh_f[0][base + (IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS - 1)] = 0;\r\nfor (j = 0; j < NUMBER_OF_CHGRINV_POINTS; j++) {\r\nto->chgrinv_x[0][base + j] = chgrinv_x[j];\r\nto->chgrinv_a[0][base + j] = chgrinv_a[j];\r\nto->chgrinv_b[0][base + j] = chgrinv_b[j];\r\nto->chgrinv_c[0][base + j] = chgrinv_c[j];\r\n}\r\nfor (j = 0; j < NUMBER_OF_TCINV_POINTS; j++) {\r\nto->tcinv_x[0][base + j] = tcinv_x[j];\r\nto->tcinv_a[0][base + j] = tcinv_a[j];\r\nto->tcinv_b[0][base + j] = tcinv_b[j];\r\nto->tcinv_c[0][base + j] = tcinv_c[j];\r\n}\r\nfor (j = 0; j < NUMBER_OF_FCINV_POINTS; j++) {\r\nto->fcinv_x[0][base + j] = fcinv_x[j];\r\nto->fcinv_a[0][base + j] = fcinv_a[j];\r\nto->fcinv_b[0][base + j] = fcinv_b[j];\r\nto->fcinv_c[0][base + j] = fcinv_c[j];\r\n}\r\n}\r\n}\r\nvoid\r\nia_css_eed1_8_encode(\r\nstruct eed1_8_dmem_params *to,\r\nconst struct ia_css_eed1_8_config *from,\r\nsize_t size)\r\n{\r\nint i;\r\nint min_exp = 0;\r\n(void)size;\r\nto->rbzp_strength = from->rbzp_strength;\r\nto->fcstrength = from->fcstrength;\r\nto->fcthres_0 = from->fcthres_0;\r\nto->fc_sat_coef = from->fc_sat_coef;\r\nto->fc_coring_prm = from->fc_coring_prm;\r\nto->fc_slope = from->fcthres_1 - from->fcthres_0;\r\nto->aerel_thres0 = from->aerel_thres0;\r\nto->aerel_gain0 = from->aerel_gain0;\r\nto->aerel_thres_diff = from->aerel_thres1 - from->aerel_thres0;\r\nto->aerel_gain_diff = from->aerel_gain1 - from->aerel_gain0;\r\nto->derel_thres0 = from->derel_thres0;\r\nto->derel_gain0 = from->derel_gain0;\r\nto->derel_thres_diff = (from->derel_thres1 - from->derel_thres0);\r\nto->derel_gain_diff = (from->derel_gain1 - from->derel_gain0);\r\nto->coring_pos0 = from->coring_pos0;\r\nto->coring_pos_diff = (from->coring_pos1 - from->coring_pos0);\r\nto->coring_neg0 = from->coring_neg0;\r\nto->coring_neg_diff = (from->coring_neg1 - from->coring_neg0);\r\nto->gain_exp = (13 - from->gain_exp);\r\nto->gain_pos0 = from->gain_pos0;\r\nto->gain_pos_diff = (from->gain_pos1 - from->gain_pos0);\r\nto->gain_neg0 = from->gain_neg0;\r\nto->gain_neg_diff = (from->gain_neg1 - from->gain_neg0);\r\nto->margin_pos0 = from->pos_margin0;\r\nto->margin_pos_diff = (from->pos_margin1 - from->pos_margin0);\r\nto->margin_neg0 = from->neg_margin0;\r\nto->margin_neg_diff = (from->neg_margin1 - from->neg_margin0);\r\nfor (i = 0; i < (IA_CSS_NUMBER_OF_DEW_ENHANCE_SEGMENTS - 1); i++) {\r\nmin_exp = max(min_exp, from->dew_enhance_seg_exp[i]);\r\n}\r\nto->e_dew_enh_asr = 13 - min(max(min_exp, 0), 13);\r\nto->dedgew_max = from->dedgew_max;\r\n}\r\nvoid\r\nia_css_init_eed1_8_state(\r\nvoid *state,\r\nsize_t size)\r\n{\r\nmemset(state, 0, size);\r\n}\r\nvoid\r\nia_css_eed1_8_debug_dtrace(\r\nconst struct ia_css_eed1_8_config *eed,\r\nunsigned level)\r\n{\r\nif (!eed)\r\nreturn;\r\nia_css_debug_dtrace(level, "Edge Enhancing Demosaic 1.8:\n");\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "rbzp_strength", eed->rbzp_strength);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "fcstrength", eed->fcstrength);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "fcthres_0", eed->fcthres_0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "fcthres_1", eed->fcthres_1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "fc_sat_coef", eed->fc_sat_coef);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "fc_coring_prm", eed->fc_coring_prm);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "aerel_thres0", eed->aerel_thres0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "aerel_gain0", eed->aerel_gain0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "aerel_thres1", eed->aerel_thres1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "aerel_gain1", eed->aerel_gain1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "derel_thres0", eed->derel_thres0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "derel_gain0", eed->derel_gain0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "derel_thres1", eed->derel_thres1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "derel_gain1", eed->derel_gain1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "coring_pos0", eed->coring_pos0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "coring_pos1", eed->coring_pos1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "coring_neg0", eed->coring_neg0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "coring_neg1", eed->coring_neg1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "gain_exp", eed->gain_exp);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "gain_pos0", eed->gain_pos0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "gain_pos1", eed->gain_pos1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "gain_neg0", eed->gain_neg0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "gain_neg1", eed->gain_neg1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "pos_margin0", eed->pos_margin0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "pos_margin1", eed->pos_margin1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "neg_margin0", eed->neg_margin0);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "neg_margin1", eed->neg_margin1);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "dedgew_max", eed->dedgew_max);\r\n}
