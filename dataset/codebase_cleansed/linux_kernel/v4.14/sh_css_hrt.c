bool sh_css_hrt_system_is_idle(void)\r\n{\r\nbool not_idle = false, idle;\r\nfifo_channel_t ch;\r\nidle = sp_ctrl_getbit(SP0_ID, SP_SC_REG, SP_IDLE_BIT);\r\nnot_idle |= !idle;\r\nif (!idle)\r\nIA_CSS_WARNING("SP not idle");\r\nidle = isp_ctrl_getbit(ISP0_ID, ISP_SC_REG, ISP_IDLE_BIT);\r\nnot_idle |= !idle;\r\nif (!idle)\r\nIA_CSS_WARNING("ISP not idle");\r\nfor (ch=0; ch<N_FIFO_CHANNEL; ch++) {\r\nfifo_channel_state_t state;\r\nfifo_channel_get_state(FIFO_MONITOR0_ID, ch, &state);\r\nif (state.fifo_valid) {\r\nIA_CSS_WARNING("FIFO channel %d is not empty", ch);\r\nnot_idle = true;\r\n}\r\n}\r\nreturn !not_idle;\r\n}\r\nenum ia_css_err sh_css_hrt_sp_wait(void)\r\n{\r\n#if defined(HAS_IRQ_MAP_VERSION_2)\r\nirq_sw_channel_id_t irq_id = IRQ_SW_CHANNEL0_ID;\r\n#else\r\nirq_sw_channel_id_t irq_id = IRQ_SW_CHANNEL2_ID;\r\n#endif\r\nwhile (!sp_ctrl_getbit(SP0_ID, SP_SC_REG, SP_IDLE_BIT) &&\r\n((irq_reg_load(IRQ0_ID,\r\n_HRT_IRQ_CONTROLLER_STATUS_REG_IDX) &\r\n(1U<<(irq_id + IRQ_SW_CHANNEL_OFFSET))) == 0)) {\r\nhrt_sleep();\r\n}\r\nreturn IA_CSS_SUCCESS;\r\n}
