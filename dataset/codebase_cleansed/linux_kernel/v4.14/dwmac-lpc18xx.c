static int lpc18xx_dwmac_probe(struct platform_device *pdev)\r\n{\r\nstruct plat_stmmacenet_data *plat_dat;\r\nstruct stmmac_resources stmmac_res;\r\nstruct regmap *reg;\r\nu8 ethmode;\r\nint ret;\r\nret = stmmac_get_platform_resources(pdev, &stmmac_res);\r\nif (ret)\r\nreturn ret;\r\nplat_dat = stmmac_probe_config_dt(pdev, &stmmac_res.mac);\r\nif (IS_ERR(plat_dat))\r\nreturn PTR_ERR(plat_dat);\r\nplat_dat->has_gmac = true;\r\nreg = syscon_regmap_lookup_by_compatible("nxp,lpc1850-creg");\r\nif (IS_ERR(reg)) {\r\ndev_err(&pdev->dev, "syscon lookup failed\n");\r\nret = PTR_ERR(reg);\r\ngoto err_remove_config_dt;\r\n}\r\nif (plat_dat->interface == PHY_INTERFACE_MODE_MII) {\r\nethmode = LPC18XX_CREG_CREG6_ETHMODE_MII;\r\n} else if (plat_dat->interface == PHY_INTERFACE_MODE_RMII) {\r\nethmode = LPC18XX_CREG_CREG6_ETHMODE_RMII;\r\n} else {\r\ndev_err(&pdev->dev, "Only MII and RMII mode supported\n");\r\nret = -EINVAL;\r\ngoto err_remove_config_dt;\r\n}\r\nregmap_update_bits(reg, LPC18XX_CREG_CREG6,\r\nLPC18XX_CREG_CREG6_ETHMODE_MASK, ethmode);\r\nret = stmmac_dvr_probe(&pdev->dev, plat_dat, &stmmac_res);\r\nif (ret)\r\ngoto err_remove_config_dt;\r\nreturn 0;\r\nerr_remove_config_dt:\r\nstmmac_remove_config_dt(pdev, plat_dat);\r\nreturn ret;\r\n}
