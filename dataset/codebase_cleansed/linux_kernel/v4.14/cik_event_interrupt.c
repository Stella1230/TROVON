static bool cik_event_interrupt_isr(struct kfd_dev *dev,\r\nconst uint32_t *ih_ring_entry)\r\n{\r\nunsigned int pasid;\r\nconst struct cik_ih_ring_entry *ihre =\r\n(const struct cik_ih_ring_entry *)ih_ring_entry;\r\npasid = (ihre->ring_id & 0xffff0000) >> 16;\r\nreturn (pasid != 0) &&\r\n(ihre->source_id == CIK_INTSRC_CP_END_OF_PIPE ||\r\nihre->source_id == CIK_INTSRC_SQ_INTERRUPT_MSG ||\r\nihre->source_id == CIK_INTSRC_CP_BAD_OPCODE);\r\n}\r\nstatic void cik_event_interrupt_wq(struct kfd_dev *dev,\r\nconst uint32_t *ih_ring_entry)\r\n{\r\nunsigned int pasid;\r\nconst struct cik_ih_ring_entry *ihre =\r\n(const struct cik_ih_ring_entry *)ih_ring_entry;\r\npasid = (ihre->ring_id & 0xffff0000) >> 16;\r\nif (pasid == 0)\r\nreturn;\r\nif (ihre->source_id == CIK_INTSRC_CP_END_OF_PIPE)\r\nkfd_signal_event_interrupt(pasid, 0, 0);\r\nelse if (ihre->source_id == CIK_INTSRC_SQ_INTERRUPT_MSG)\r\nkfd_signal_event_interrupt(pasid, ihre->data & 0xFF, 8);\r\nelse if (ihre->source_id == CIK_INTSRC_CP_BAD_OPCODE)\r\nkfd_signal_hw_exception_event(pasid);\r\n}
