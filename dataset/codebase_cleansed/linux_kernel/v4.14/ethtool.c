static void xge_mac_get_extd_stats(struct xge_pdata *pdata)\r\n{\r\nu32 data;\r\nint i;\r\nfor (i = 0; i < XGE_EXTD_STATS_LEN; i++) {\r\ndata = xge_rd_csr(pdata, gstrings_extd_stats[i].addr);\r\ngstrings_extd_stats[i].value += data;\r\n}\r\n}\r\nstatic void xge_get_drvinfo(struct net_device *ndev,\r\nstruct ethtool_drvinfo *info)\r\n{\r\nstruct xge_pdata *pdata = netdev_priv(ndev);\r\nstruct platform_device *pdev = pdata->pdev;\r\nstrcpy(info->driver, "xgene-enet-v2");\r\nstrcpy(info->version, XGENE_ENET_V2_VERSION);\r\nsnprintf(info->fw_version, ETHTOOL_FWVERS_LEN, "N/A");\r\nsprintf(info->bus_info, "%s", pdev->name);\r\n}\r\nstatic void xge_get_strings(struct net_device *ndev, u32 stringset, u8 *data)\r\n{\r\nu8 *p = data;\r\nint i;\r\nif (stringset != ETH_SS_STATS)\r\nreturn;\r\nfor (i = 0; i < XGE_STATS_LEN; i++) {\r\nmemcpy(p, gstrings_stats[i].name, ETH_GSTRING_LEN);\r\np += ETH_GSTRING_LEN;\r\n}\r\nfor (i = 0; i < XGE_EXTD_STATS_LEN; i++) {\r\nmemcpy(p, gstrings_extd_stats[i].name, ETH_GSTRING_LEN);\r\np += ETH_GSTRING_LEN;\r\n}\r\n}\r\nstatic int xge_get_sset_count(struct net_device *ndev, int sset)\r\n{\r\nif (sset != ETH_SS_STATS)\r\nreturn -EINVAL;\r\nreturn XGE_STATS_LEN + XGE_EXTD_STATS_LEN;\r\n}\r\nstatic void xge_get_ethtool_stats(struct net_device *ndev,\r\nstruct ethtool_stats *dummy,\r\nu64 *data)\r\n{\r\nvoid *pdata = netdev_priv(ndev);\r\nint i;\r\nfor (i = 0; i < XGE_STATS_LEN; i++)\r\n*data++ = *(u64 *)(pdata + gstrings_stats[i].offset);\r\nxge_mac_get_extd_stats(pdata);\r\nfor (i = 0; i < XGE_EXTD_STATS_LEN; i++)\r\n*data++ = gstrings_extd_stats[i].value;\r\n}\r\nstatic int xge_get_link_ksettings(struct net_device *ndev,\r\nstruct ethtool_link_ksettings *cmd)\r\n{\r\nstruct phy_device *phydev = ndev->phydev;\r\nif (!phydev)\r\nreturn -ENODEV;\r\nphy_ethtool_ksettings_get(phydev, cmd);\r\nreturn 0;\r\n}\r\nstatic int xge_set_link_ksettings(struct net_device *ndev,\r\nconst struct ethtool_link_ksettings *cmd)\r\n{\r\nstruct phy_device *phydev = ndev->phydev;\r\nif (!phydev)\r\nreturn -ENODEV;\r\nreturn phy_ethtool_ksettings_set(phydev, cmd);\r\n}\r\nvoid xge_set_ethtool_ops(struct net_device *ndev)\r\n{\r\nndev->ethtool_ops = &xge_ethtool_ops;\r\n}
