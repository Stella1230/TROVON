static int tpmrm_open(struct inode *inode, struct file *file)\r\n{\r\nstruct tpm_chip *chip;\r\nstruct tpmrm_priv *priv;\r\nint rc;\r\nchip = container_of(inode->i_cdev, struct tpm_chip, cdevs);\r\npriv = kzalloc(sizeof(*priv), GFP_KERNEL);\r\nif (priv == NULL)\r\nreturn -ENOMEM;\r\nrc = tpm2_init_space(&priv->space);\r\nif (rc) {\r\nkfree(priv);\r\nreturn -ENOMEM;\r\n}\r\ntpm_common_open(file, chip, &priv->priv);\r\nreturn 0;\r\n}\r\nstatic int tpmrm_release(struct inode *inode, struct file *file)\r\n{\r\nstruct file_priv *fpriv = file->private_data;\r\nstruct tpmrm_priv *priv = container_of(fpriv, struct tpmrm_priv, priv);\r\ntpm_common_release(file, fpriv);\r\ntpm2_del_space(fpriv->chip, &priv->space);\r\nkfree(priv);\r\nreturn 0;\r\n}\r\nstatic ssize_t tpmrm_write(struct file *file, const char __user *buf,\r\nsize_t size, loff_t *off)\r\n{\r\nstruct file_priv *fpriv = file->private_data;\r\nstruct tpmrm_priv *priv = container_of(fpriv, struct tpmrm_priv, priv);\r\nreturn tpm_common_write(file, buf, size, off, &priv->space);\r\n}
