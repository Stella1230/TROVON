static void grantpt_cb(void *arg)\r\n{\r\nstruct grantpt_info *info = arg;\r\ninfo->res = grantpt(info->fd);\r\ninfo->err = errno;\r\n}\r\nint get_pty(void)\r\n{\r\nstruct grantpt_info info;\r\nint fd, err;\r\nfd = open("/dev/ptmx", O_RDWR);\r\nif (fd < 0) {\r\nerr = -errno;\r\nprintk(UM_KERN_ERR "get_pty : Couldn't open /dev/ptmx - "\r\n"err = %d\n", errno);\r\nreturn err;\r\n}\r\ninfo.fd = fd;\r\ninitial_thread_cb(grantpt_cb, &info);\r\nif (info.res < 0) {\r\nerr = -info.err;\r\nprintk(UM_KERN_ERR "get_pty : Couldn't grant pty - "\r\n"errno = %d\n", -info.err);\r\ngoto out;\r\n}\r\nif (unlockpt(fd) < 0) {\r\nerr = -errno;\r\nprintk(UM_KERN_ERR "get_pty : Couldn't unlock pty - "\r\n"errno = %d\n", errno);\r\ngoto out;\r\n}\r\nreturn fd;\r\nout:\r\nclose(fd);\r\nreturn err;\r\n}
