static void print_opcodek(unsigned char opcode)\r\n{\r\nconst char **table = commands[ group(opcode) ];\r\nswitch ((unsigned long) table) {\r\ncase RESERVED_GROUP:\r\nprintk("%s[%02x] ", reserved, opcode);\r\nbreak;\r\ncase NOTEXT_GROUP:\r\nprintk("%s(notext)[%02x] ", unknown, opcode);\r\nbreak;\r\ncase VENDOR_GROUP:\r\nprintk("%s[%02x] ", vendor, opcode);\r\nbreak;\r\ndefault:\r\nif (table[opcode & 0x1f] != unknown)\r\nprintk("%s[%02x] ", table[opcode & 0x1f], opcode);\r\nelse\r\nprintk("%s[%02x] ", unknown, opcode);\r\nbreak;\r\n}\r\n}\r\nstatic void print_commandk (unsigned char *command)\r\n{\r\nint i, s;\r\nprintk(KERN_DEBUG);\r\nprint_opcodek(command[0]);\r\nif ((command[0] >> 5) == 6 ||\r\n(command[0] >> 5) == 7 ) {\r\ns = 12;\r\n} else {\r\ns = COMMAND_SIZE(command[0]);\r\n}\r\nfor ( i = 1; i < s; ++i) {\r\nprintk("%02x ", command[i]);\r\n}\r\nswitch (s) {\r\ncase 6:\r\nprintk("LBA=%d len=%d",\r\n(((unsigned int)command[1] & 0x0f) << 16) |\r\n( (unsigned int)command[2] << 8) |\r\n( (unsigned int)command[3] ),\r\n(unsigned int)command[4]\r\n);\r\nbreak;\r\ncase 10:\r\nprintk("LBA=%d len=%d",\r\n((unsigned int)command[2] << 24) |\r\n((unsigned int)command[3] << 16) |\r\n((unsigned int)command[4] << 8) |\r\n((unsigned int)command[5] ),\r\n((unsigned int)command[7] << 8) |\r\n((unsigned int)command[8] )\r\n);\r\nbreak;\r\ncase 12:\r\nprintk("LBA=%d len=%d",\r\n((unsigned int)command[2] << 24) |\r\n((unsigned int)command[3] << 16) |\r\n((unsigned int)command[4] << 8) |\r\n((unsigned int)command[5] ),\r\n((unsigned int)command[6] << 24) |\r\n((unsigned int)command[7] << 16) |\r\n((unsigned int)command[8] << 8) |\r\n((unsigned int)command[9] )\r\n);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nprintk("\n");\r\n}\r\nstatic void show_command(struct scsi_cmnd *SCpnt)\r\n{\r\nprint_commandk(SCpnt->cmnd);\r\n}\r\nstatic void show_phase(struct scsi_cmnd *SCpnt)\r\n{\r\nint i = SCpnt->SCp.phase;\r\nchar *ph[] = {\r\n"PH_UNDETERMINED",\r\n"PH_ARBSTART",\r\n"PH_SELSTART",\r\n"PH_SELECTED",\r\n"PH_COMMAND",\r\n"PH_DATA",\r\n"PH_STATUS",\r\n"PH_MSG_IN",\r\n"PH_MSG_OUT",\r\n"PH_DISCONNECT",\r\n"PH_RESELECT"\r\n};\r\nif ( i < PH_UNDETERMINED || i > PH_RESELECT ) {\r\nprintk(KERN_DEBUG "scsi phase: unknown(%d)\n", i);\r\nreturn;\r\n}\r\nprintk(KERN_DEBUG "scsi phase: %s\n", ph[i]);\r\nreturn;\r\n}\r\nstatic void show_busphase(unsigned char stat)\r\n{\r\nswitch(stat) {\r\ncase BUSPHASE_COMMAND:\r\nprintk(KERN_DEBUG "BUSPHASE_COMMAND\n");\r\nbreak;\r\ncase BUSPHASE_MESSAGE_IN:\r\nprintk(KERN_DEBUG "BUSPHASE_MESSAGE_IN\n");\r\nbreak;\r\ncase BUSPHASE_MESSAGE_OUT:\r\nprintk(KERN_DEBUG "BUSPHASE_MESSAGE_OUT\n");\r\nbreak;\r\ncase BUSPHASE_DATA_IN:\r\nprintk(KERN_DEBUG "BUSPHASE_DATA_IN\n");\r\nbreak;\r\ncase BUSPHASE_DATA_OUT:\r\nprintk(KERN_DEBUG "BUSPHASE_DATA_OUT\n");\r\nbreak;\r\ncase BUSPHASE_STATUS:\r\nprintk(KERN_DEBUG "BUSPHASE_STATUS\n");\r\nbreak;\r\ncase BUSPHASE_SELECT:\r\nprintk(KERN_DEBUG "BUSPHASE_SELECT\n");\r\nbreak;\r\ndefault:\r\nprintk(KERN_DEBUG "BUSPHASE_other\n");\r\nbreak;\r\n}\r\n}\r\nstatic void show_message(nsp_hw_data *data)\r\n{\r\nint i;\r\nprintk(KERN_DEBUG "msg:");\r\nfor(i=0; i < data->MsgLen; i++) {\r\nprintk(" %02x", data->MsgBuffer[i]);\r\n}\r\nprintk("\n");\r\n}
