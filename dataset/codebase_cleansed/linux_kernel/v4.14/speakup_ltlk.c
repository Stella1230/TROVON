static void synth_interrogate(struct spk_synth *synth)\r\n{\r\nunsigned char *t, i;\r\nunsigned char buf[50], rom_v[20];\r\nsynth->synth_immediate(synth, "\x18\x01?");\r\nfor (i = 0; i < 50; i++) {\r\nbuf[i] = synth->io_ops->synth_in();\r\nif (i > 2 && buf[i] == 0x7f)\r\nbreak;\r\n}\r\nt = buf + 2;\r\nfor (i = 0; *t != '\r'; t++) {\r\nrom_v[i] = *t;\r\nif (++i >= 19)\r\nbreak;\r\n}\r\nrom_v[i] = 0;\r\npr_info("%s: ROM version: %s\n", synth->long_name, rom_v);\r\n}\r\nstatic int synth_probe(struct spk_synth *synth)\r\n{\r\nint failed = 0;\r\nfailed = spk_ttyio_synth_probe(synth);\r\nif (failed == 0)\r\nsynth_interrogate(synth);\r\nsynth->alive = !failed;\r\nreturn failed;\r\n}
