static int tps65086_of_parse_cb(struct device_node *node,\r\nconst struct regulator_desc *desc,\r\nstruct regulator_config *config)\r\n{\r\nint ret;\r\nif (of_property_read_bool(node, "ti,regulator-step-size-25mv")) {\r\nswitch (desc->id) {\r\ncase BUCK1:\r\ncase BUCK2:\r\ncase BUCK6:\r\nregulators[desc->id].desc.linear_ranges =\r\ntps65086_buck126_25mv_ranges;\r\nregulators[desc->id].desc.n_linear_ranges =\r\nARRAY_SIZE(tps65086_buck126_25mv_ranges);\r\nbreak;\r\ncase BUCK3:\r\ncase BUCK4:\r\ncase BUCK5:\r\nregulators[desc->id].desc.linear_ranges =\r\ntps65086_buck345_25mv_ranges;\r\nregulators[desc->id].desc.n_linear_ranges =\r\nARRAY_SIZE(tps65086_buck345_25mv_ranges);\r\nbreak;\r\ndefault:\r\ndev_warn(config->dev, "25mV step mode only valid for BUCK regulators\n");\r\n}\r\n}\r\nif (desc->id <= BUCK6 && of_property_read_bool(node, "ti,regulator-decay")) {\r\nret = regmap_write_bits(config->regmap,\r\nregulators[desc->id].decay_reg,\r\nregulators[desc->id].decay_mask,\r\nregulators[desc->id].decay_mask);\r\nif (ret) {\r\ndev_err(config->dev, "Error setting decay\n");\r\nreturn ret;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int tps65086_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65086 *tps = dev_get_drvdata(pdev->dev.parent);\r\nstruct regulator_config config = { };\r\nstruct regulator_dev *rdev;\r\nint i;\r\nplatform_set_drvdata(pdev, tps);\r\nconfig.dev = &pdev->dev;\r\nconfig.dev->of_node = tps->dev->of_node;\r\nconfig.driver_data = tps;\r\nconfig.regmap = tps->regmap;\r\nfor (i = 0; i < ARRAY_SIZE(regulators); i++) {\r\nrdev = devm_regulator_register(&pdev->dev, &regulators[i].desc,\r\n&config);\r\nif (IS_ERR(rdev)) {\r\ndev_err(tps->dev, "failed to register %s regulator\n",\r\npdev->name);\r\nreturn PTR_ERR(rdev);\r\n}\r\n}\r\nreturn 0;\r\n}
