static int qdf2xxx_pinctrl_probe(struct platform_device *pdev)\r\n{\r\nstruct pinctrl_pin_desc *pins;\r\nstruct msm_pingroup *groups;\r\nchar (*names)[NAME_SIZE];\r\nunsigned int i;\r\nu32 num_gpios;\r\nint ret;\r\nret = device_property_read_u32(&pdev->dev, "num-gpios", &num_gpios);\r\nif (ret < 0) {\r\ndev_warn(&pdev->dev, "missing num-gpios property\n");\r\nreturn ret;\r\n}\r\nif (!num_gpios || num_gpios > MAX_GPIOS) {\r\ndev_warn(&pdev->dev, "invalid num-gpios property\n");\r\nreturn -ENODEV;\r\n}\r\npins = devm_kcalloc(&pdev->dev, num_gpios,\r\nsizeof(struct pinctrl_pin_desc), GFP_KERNEL);\r\ngroups = devm_kcalloc(&pdev->dev, num_gpios,\r\nsizeof(struct msm_pingroup), GFP_KERNEL);\r\nnames = devm_kcalloc(&pdev->dev, num_gpios, NAME_SIZE, GFP_KERNEL);\r\nif (!pins || !groups || !names)\r\nreturn -ENOMEM;\r\nfor (i = 0; i < num_gpios; i++) {\r\nsnprintf(names[i], NAME_SIZE, "gpio%u", i);\r\npins[i].number = i;\r\npins[i].name = names[i];\r\ngroups[i].npins = 1;\r\ngroups[i].name = names[i];\r\ngroups[i].pins = &pins[i].number;\r\ngroups[i].ctl_reg = 0x10000 * i;\r\ngroups[i].io_reg = 0x04 + 0x10000 * i;\r\ngroups[i].intr_cfg_reg = 0x08 + 0x10000 * i;\r\ngroups[i].intr_status_reg = 0x0c + 0x10000 * i;\r\ngroups[i].intr_target_reg = 0x08 + 0x10000 * i;\r\ngroups[i].mux_bit = 2;\r\ngroups[i].pull_bit = 0;\r\ngroups[i].drv_bit = 6;\r\ngroups[i].oe_bit = 9;\r\ngroups[i].in_bit = 0;\r\ngroups[i].out_bit = 1;\r\ngroups[i].intr_enable_bit = 0;\r\ngroups[i].intr_status_bit = 0;\r\ngroups[i].intr_target_bit = 5;\r\ngroups[i].intr_target_kpss_val = 1;\r\ngroups[i].intr_raw_status_bit = 4;\r\ngroups[i].intr_polarity_bit = 1;\r\ngroups[i].intr_detection_bit = 2;\r\ngroups[i].intr_detection_width = 2;\r\n}\r\nqdf2xxx_pinctrl.pins = pins;\r\nqdf2xxx_pinctrl.groups = groups;\r\nqdf2xxx_pinctrl.npins = num_gpios;\r\nqdf2xxx_pinctrl.ngroups = num_gpios;\r\nqdf2xxx_pinctrl.ngpios = num_gpios;\r\nreturn msm_pinctrl_probe(pdev, &qdf2xxx_pinctrl);\r\n}\r\nstatic int __init qdf2xxx_pinctrl_init(void)\r\n{\r\nreturn platform_driver_register(&qdf2xxx_pinctrl_driver);\r\n}\r\nstatic void __exit qdf2xxx_pinctrl_exit(void)\r\n{\r\nplatform_driver_unregister(&qdf2xxx_pinctrl_driver);\r\n}
