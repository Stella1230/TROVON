static int rpmsg_sample_cb(struct rpmsg_device *rpdev, void *data, int len,\r\nvoid *priv, u32 src)\r\n{\r\nint ret;\r\nstruct instance_data *idata = dev_get_drvdata(&rpdev->dev);\r\ndev_info(&rpdev->dev, "incoming msg %d (src: 0x%x)\n",\r\n++idata->rx_count, src);\r\nprint_hex_dump(KERN_DEBUG, __func__, DUMP_PREFIX_NONE, 16, 1,\r\ndata, len, true);\r\nif (idata->rx_count >= MSG_LIMIT) {\r\ndev_info(&rpdev->dev, "goodbye!\n");\r\nreturn 0;\r\n}\r\nret = rpmsg_send(rpdev->ept, MSG, strlen(MSG));\r\nif (ret)\r\ndev_err(&rpdev->dev, "rpmsg_send failed: %d\n", ret);\r\nreturn 0;\r\n}\r\nstatic int rpmsg_sample_probe(struct rpmsg_device *rpdev)\r\n{\r\nint ret;\r\nstruct instance_data *idata;\r\ndev_info(&rpdev->dev, "new channel: 0x%x -> 0x%x!\n",\r\nrpdev->src, rpdev->dst);\r\nidata = devm_kzalloc(&rpdev->dev, sizeof(*idata), GFP_KERNEL);\r\nif (!idata)\r\nreturn -ENOMEM;\r\ndev_set_drvdata(&rpdev->dev, idata);\r\nret = rpmsg_send(rpdev->ept, MSG, strlen(MSG));\r\nif (ret) {\r\ndev_err(&rpdev->dev, "rpmsg_send failed: %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void rpmsg_sample_remove(struct rpmsg_device *rpdev)\r\n{\r\ndev_info(&rpdev->dev, "rpmsg sample client driver is removed\n");\r\n}
