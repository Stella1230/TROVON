static int tps65023_dcdc_get_voltage_sel(struct regulator_dev *dev)\r\n{\r\nstruct tps_pmic *tps = rdev_get_drvdata(dev);\r\nint dcdc = rdev_get_id(dev);\r\nif (dcdc < TPS65023_DCDC_1 || dcdc > TPS65023_DCDC_3)\r\nreturn -EINVAL;\r\nif (dcdc != tps->driver_data->core_regulator)\r\nreturn 0;\r\nreturn regulator_get_voltage_sel_regmap(dev);\r\n}\r\nstatic int tps65023_dcdc_set_voltage_sel(struct regulator_dev *dev,\r\nunsigned selector)\r\n{\r\nstruct tps_pmic *tps = rdev_get_drvdata(dev);\r\nint dcdc = rdev_get_id(dev);\r\nif (dcdc != tps->driver_data->core_regulator)\r\nreturn -EINVAL;\r\nreturn regulator_set_voltage_sel_regmap(dev, selector);\r\n}\r\nstatic int tps_65023_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct regulator_init_data *init_data = dev_get_platdata(&client->dev);\r\nstruct regulator_config config = { };\r\nstruct tps_pmic *tps;\r\nint i;\r\nint error;\r\ntps = devm_kzalloc(&client->dev, sizeof(*tps), GFP_KERNEL);\r\nif (!tps)\r\nreturn -ENOMEM;\r\ntps->driver_data = (struct tps_driver_data *)id->driver_data;\r\ntps->regmap = devm_regmap_init_i2c(client, &tps65023_regmap_config);\r\nif (IS_ERR(tps->regmap)) {\r\nerror = PTR_ERR(tps->regmap);\r\ndev_err(&client->dev, "Failed to allocate register map: %d\n",\r\nerror);\r\nreturn error;\r\n}\r\nconfig.dev = &client->dev;\r\nconfig.driver_data = tps;\r\nconfig.regmap = tps->regmap;\r\nfor (i = 0; i < TPS65023_NUM_REGULATOR; i++) {\r\nif (init_data)\r\nconfig.init_data = &init_data[i];\r\ntps->rdev[i] = devm_regulator_register(&client->dev,\r\n&tps->driver_data->desc[i], &config);\r\nif (IS_ERR(tps->rdev[i])) {\r\ndev_err(&client->dev, "failed to register %s\n",\r\nid->name);\r\nreturn PTR_ERR(tps->rdev[i]);\r\n}\r\n}\r\ni2c_set_clientdata(client, tps);\r\nregmap_update_bits(tps->regmap, TPS65023_REG_CON_CTRL2,\r\nTPS65023_REG_CTRL2_CORE_ADJ, 0);\r\nreturn 0;\r\n}\r\nstatic int __init tps_65023_init(void)\r\n{\r\nreturn i2c_add_driver(&tps_65023_i2c_driver);\r\n}\r\nstatic void __exit tps_65023_cleanup(void)\r\n{\r\ni2c_del_driver(&tps_65023_i2c_driver);\r\n}
