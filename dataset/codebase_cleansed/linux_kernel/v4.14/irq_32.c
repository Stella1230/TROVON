void notrace arch_local_irq_restore(unsigned long flags)\r\n{\r\nunsigned long __dummy0, __dummy1;\r\nif (flags == ARCH_IRQ_DISABLED) {\r\n__asm__ __volatile__ (\r\n"stc sr, %0\n\t"\r\n"or #0xf0, %0\n\t"\r\n"ldc %0, sr\n\t"\r\n: "=&z" (__dummy0)\r\n:\r\n: "memory"\r\n);\r\n} else {\r\n__asm__ __volatile__ (\r\n"stc sr, %0\n\t"\r\n"and %1, %0\n\t"\r\n#ifdef CONFIG_CPU_HAS_SR_RB\r\n"stc r6_bank, %1\n\t"\r\n"or %1, %0\n\t"\r\n#endif\r\n"ldc %0, sr\n\t"\r\n: "=&r" (__dummy0), "=r" (__dummy1)\r\n: "1" (~ARCH_IRQ_DISABLED)\r\n: "memory"\r\n);\r\n}\r\n}\r\nunsigned long notrace arch_local_save_flags(void)\r\n{\r\nunsigned long flags;\r\n__asm__ __volatile__ (\r\n"stc sr, %0\n\t"\r\n"and #0xf0, %0\n\t"\r\n: "=&z" (flags)\r\n:\r\n: "memory"\r\n);\r\nreturn flags;\r\n}
