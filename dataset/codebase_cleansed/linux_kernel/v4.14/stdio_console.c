static void stdio_announce(char *dev_name, int dev)\r\n{\r\nprintk(KERN_INFO "Virtual console %d assigned device '%s'\n", dev,\r\ndev_name);\r\n}\r\nstatic int con_config(char *str, char **error_out)\r\n{\r\nreturn line_config(vts, ARRAY_SIZE(vts), str, &opts, error_out);\r\n}\r\nstatic int con_get_config(char *dev, char *str, int size, char **error_out)\r\n{\r\nreturn line_get_config(dev, vts, ARRAY_SIZE(vts), str, size, error_out);\r\n}\r\nstatic int con_remove(int n, char **error_out)\r\n{\r\nreturn line_remove(vts, ARRAY_SIZE(vts), n, error_out);\r\n}\r\nstatic int con_install(struct tty_driver *driver, struct tty_struct *tty)\r\n{\r\nreturn line_install(driver, tty, &vts[tty->index]);\r\n}\r\nstatic void uml_console_write(struct console *console, const char *string,\r\nunsigned len)\r\n{\r\nstruct line *line = &vts[console->index];\r\nunsigned long flags;\r\nspin_lock_irqsave(&line->lock, flags);\r\nconsole_write_chan(line->chan_out, string, len);\r\nspin_unlock_irqrestore(&line->lock, flags);\r\n}\r\nstatic struct tty_driver *uml_console_device(struct console *c, int *index)\r\n{\r\n*index = c->index;\r\nreturn driver.driver;\r\n}\r\nstatic int uml_console_setup(struct console *co, char *options)\r\n{\r\nstruct line *line = &vts[co->index];\r\nreturn console_open_chan(line, co);\r\n}\r\nstatic int stdio_init(void)\r\n{\r\nchar *new_title;\r\nint err;\r\nint i;\r\nerr = register_lines(&driver, &console_ops, vts,\r\nARRAY_SIZE(vts));\r\nif (err)\r\nreturn err;\r\nprintk(KERN_INFO "Initialized stdio console driver\n");\r\nnew_title = add_xterm_umid(opts.xterm_title);\r\nif(new_title != NULL)\r\nopts.xterm_title = new_title;\r\nfor (i = 0; i < MAX_TTYS; i++) {\r\nchar *error;\r\nchar *s = vt_conf[i];\r\nif (!s)\r\ns = def_conf;\r\nif (!s)\r\ns = i ? CONFIG_CON_CHAN : CONFIG_CON_ZERO_CHAN;\r\nif (setup_one_line(vts, i, s, &opts, &error))\r\nprintk(KERN_ERR "setup_one_line failed for "\r\n"device %d : %s\n", i, error);\r\n}\r\ncon_init_done = 1;\r\nregister_console(&stdiocons);\r\nreturn 0;\r\n}\r\nstatic void console_exit(void)\r\n{\r\nif (!con_init_done)\r\nreturn;\r\nclose_lines(vts, ARRAY_SIZE(vts));\r\n}\r\nstatic int console_chan_setup(char *str)\r\n{\r\nif (!strncmp(str, "sole=", 5))\r\nreturn 0;\r\nline_setup(vt_conf, MAX_TTYS, &def_conf, str, "console");\r\nreturn 1;\r\n}
