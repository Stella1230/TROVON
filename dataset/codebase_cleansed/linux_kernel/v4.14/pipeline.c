void ia_css_pipeline_init(void)\r\n{\r\npipeline_init_sp_thread_map();\r\n}\r\nenum ia_css_err ia_css_pipeline_create(\r\nstruct ia_css_pipeline *pipeline,\r\nenum ia_css_pipe_id pipe_id,\r\nunsigned int pipe_num,\r\nunsigned int dvs_frame_delay)\r\n{\r\nassert(pipeline != NULL);\r\nIA_CSS_ENTER_PRIVATE("pipeline = %p, pipe_id = %d, pipe_num = %d, dvs_frame_delay = %d",\r\npipeline, pipe_id, pipe_num, dvs_frame_delay);\r\nif (pipeline == NULL) {\r\nIA_CSS_LEAVE_ERR_PRIVATE(IA_CSS_ERR_INVALID_ARGUMENTS);\r\nreturn IA_CSS_ERR_INVALID_ARGUMENTS;\r\n}\r\npipeline_init_defaults(pipeline, pipe_id, pipe_num, dvs_frame_delay);\r\nIA_CSS_LEAVE_ERR_PRIVATE(IA_CSS_SUCCESS);\r\nreturn IA_CSS_SUCCESS;\r\n}\r\nvoid ia_css_pipeline_map(unsigned int pipe_num, bool map)\r\n{\r\nassert(pipe_num < IA_CSS_PIPELINE_NUM_MAX);\r\nIA_CSS_ENTER_PRIVATE("pipe_num = %d, map = %d", pipe_num, map);\r\nif (pipe_num >= IA_CSS_PIPELINE_NUM_MAX) {\r\nIA_CSS_ERROR("Invalid pipe number");\r\nIA_CSS_LEAVE_PRIVATE("void");\r\nreturn;\r\n}\r\nif (map)\r\npipeline_map_num_to_sp_thread(pipe_num);\r\nelse\r\npipeline_unmap_num_to_sp_thread(pipe_num);\r\nIA_CSS_LEAVE_PRIVATE("void");\r\n}\r\nvoid ia_css_pipeline_destroy(struct ia_css_pipeline *pipeline)\r\n{\r\nassert(pipeline != NULL);\r\nIA_CSS_ENTER_PRIVATE("pipeline = %p", pipeline);\r\nif (pipeline == NULL) {\r\nIA_CSS_ERROR("NULL input parameter");\r\nIA_CSS_LEAVE_PRIVATE("void");\r\nreturn;\r\n}\r\nIA_CSS_LOG("pipe_num = %d", pipeline->pipe_num);\r\nia_css_pipeline_clean(pipeline);\r\nIA_CSS_LEAVE_PRIVATE("void");\r\n}\r\nvoid ia_css_pipeline_start(enum ia_css_pipe_id pipe_id,\r\nstruct ia_css_pipeline *pipeline)\r\n{\r\nuint8_t pipe_num = 0;\r\nunsigned int thread_id;\r\nassert(pipeline != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_start() enter: pipe_id=%d, pipeline=%p\n",\r\npipe_id, pipeline);\r\npipeline->pipe_id = pipe_id;\r\nsh_css_sp_init_pipeline(pipeline, pipe_id, pipe_num,\r\nfalse, false, false, true, SH_CSS_BDS_FACTOR_1_00,\r\nSH_CSS_PIPE_CONFIG_OVRD_NO_OVRD,\r\n#ifndef ISP2401\r\nIA_CSS_INPUT_MODE_MEMORY, NULL, NULL\r\n#else\r\nIA_CSS_INPUT_MODE_MEMORY, NULL, NULL,\r\n#endif\r\n#if !defined(HAS_NO_INPUT_SYSTEM)\r\n#ifndef ISP2401\r\n, (mipi_port_ID_t) 0\r\n#else\r\n(mipi_port_ID_t) 0,\r\n#endif\r\n#endif\r\n#ifndef ISP2401\r\n);\r\n#else\r\nNULL, NULL);\r\nvoid ia_css_pipeline_dump_thread_map_info(void)\r\n{\r\nunsigned int i;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"pipeline_num_to_sp_thread_map:\n");\r\nfor (i = 0; i < IA_CSS_PIPELINE_NUM_MAX; i++) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"pipe_num: %u, tid: 0x%x\n", i, pipeline_num_to_sp_thread_map[i]);\r\n}\r\n}\r\nenum ia_css_err ia_css_pipeline_request_stop(struct ia_css_pipeline *pipeline)\r\n{\r\nenum ia_css_err err = IA_CSS_SUCCESS;\r\nunsigned int thread_id;\r\nassert(pipeline != NULL);\r\nif (pipeline == NULL)\r\nreturn IA_CSS_ERR_INVALID_ARGUMENTS;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_request_stop() enter: pipeline=%p\n",\r\npipeline);\r\npipeline->stop_requested = true;\r\nia_css_pipeline_get_sp_thread_id(pipeline->pipe_num, &thread_id);\r\nif (!sh_css_sp_is_running())\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_request_stop() leaving\n");\r\nreturn IA_CSS_ERR_RESOURCE_NOT_AVAILABLE;\r\n}\r\nia_css_bufq_enqueue_psys_event(IA_CSS_PSYS_SW_EVENT_STOP_STREAM,\r\n(uint8_t)thread_id,\r\n0,\r\n0);\r\nsh_css_sp_uninit_pipeline(pipeline->pipe_num);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_request_stop() leave: return_err=%d\n",\r\nerr);\r\nreturn err;\r\n}\r\nvoid ia_css_pipeline_clean(struct ia_css_pipeline *pipeline)\r\n{\r\nstruct ia_css_pipeline_stage *s;\r\nassert(pipeline != NULL);\r\nIA_CSS_ENTER_PRIVATE("pipeline = %p", pipeline);\r\nif (pipeline == NULL) {\r\nIA_CSS_ERROR("NULL input parameter");\r\nIA_CSS_LEAVE_PRIVATE("void");\r\nreturn;\r\n}\r\ns = pipeline->stages;\r\nwhile (s) {\r\nstruct ia_css_pipeline_stage *next = s->next;\r\npipeline_stage_destroy(s);\r\ns = next;\r\n}\r\npipeline_init_defaults(pipeline, pipeline->pipe_id, pipeline->pipe_num, pipeline->dvs_frame_delay);\r\nIA_CSS_LEAVE_PRIVATE("void");\r\n}\r\nenum ia_css_err ia_css_pipeline_create_and_add_stage(\r\nstruct ia_css_pipeline *pipeline,\r\nstruct ia_css_pipeline_stage_desc *stage_desc,\r\nstruct ia_css_pipeline_stage **stage)\r\n{\r\nstruct ia_css_pipeline_stage *last, *new_stage = NULL;\r\nenum ia_css_err err;\r\nassert(pipeline != NULL);\r\nassert(stage_desc != NULL);\r\nlast = pipeline->stages;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_create_and_add_stage() enter:\n");\r\nif (!stage_desc->binary && !stage_desc->firmware\r\n&& (stage_desc->sp_func == IA_CSS_PIPELINE_NO_FUNC)) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_create_and_add_stage() done:"\r\n" Invalid args\n");\r\nreturn IA_CSS_ERR_INTERNAL_ERROR;\r\n}\r\nwhile (last && last->next)\r\nlast = last->next;\r\nif ((stage_desc->sp_func == IA_CSS_PIPELINE_NO_FUNC)\r\n&& (!stage_desc->in_frame)\r\n&& (!stage_desc->firmware)\r\n&& (!stage_desc->binary->online)) {\r\nif (last && last->args.out_frame[0])\r\nstage_desc->in_frame = last->args.out_frame[0];\r\nif (!stage_desc->in_frame)\r\nreturn IA_CSS_ERR_INTERNAL_ERROR;\r\n}\r\nerr = pipeline_stage_create(stage_desc, &new_stage);\r\nif (err != IA_CSS_SUCCESS) {\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_create_and_add_stage() done:"\r\n" stage_create_failed\n");\r\nreturn err;\r\n}\r\nif (last)\r\nlast->next = new_stage;\r\nelse\r\npipeline->stages = new_stage;\r\nif (stage)\r\n*stage = new_stage;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_create_and_add_stage() done:\n");\r\nreturn IA_CSS_SUCCESS;\r\n}\r\nvoid ia_css_pipeline_finalize_stages(struct ia_css_pipeline *pipeline,\r\nbool continuous)\r\n{\r\nunsigned i = 0;\r\nstruct ia_css_pipeline_stage *stage;\r\nassert(pipeline != NULL);\r\nfor (stage = pipeline->stages; stage; stage = stage->next) {\r\nstage->stage_num = i;\r\ni++;\r\n}\r\npipeline->num_stages = i;\r\nia_css_pipeline_set_zoom_stage(pipeline);\r\nia_css_pipeline_configure_inout_port(pipeline, continuous);\r\n}\r\nenum ia_css_err ia_css_pipeline_get_stage(struct ia_css_pipeline *pipeline,\r\nint mode,\r\nstruct ia_css_pipeline_stage **stage)\r\n{\r\nstruct ia_css_pipeline_stage *s;\r\nassert(pipeline != NULL);\r\nassert(stage != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_get_stage() enter:\n");\r\nfor (s = pipeline->stages; s; s = s->next) {\r\nif (s->mode == mode) {\r\n*stage = s;\r\nreturn IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn IA_CSS_ERR_INTERNAL_ERROR;\r\n}\r\nenum ia_css_err ia_css_pipeline_get_stage_from_fw(struct ia_css_pipeline *pipeline,\r\nuint32_t fw_handle,\r\nstruct ia_css_pipeline_stage **stage)\r\n{\r\nstruct ia_css_pipeline_stage *s;\r\nassert(pipeline != NULL);\r\nassert(stage != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,"%s() \n",__func__);\r\nfor (s = pipeline->stages; s; s = s->next) {\r\nif ((s->firmware) && (s->firmware->handle == fw_handle)) {\r\n*stage = s;\r\nreturn IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn IA_CSS_ERR_INTERNAL_ERROR;\r\n}\r\nenum ia_css_err ia_css_pipeline_get_fw_from_stage(struct ia_css_pipeline *pipeline,\r\nuint32_t stage_num,\r\nuint32_t *fw_handle)\r\n{\r\nstruct ia_css_pipeline_stage *s;\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,"%s() \n",__func__);\r\nif ((pipeline == NULL) || (fw_handle == NULL))\r\nreturn IA_CSS_ERR_INVALID_ARGUMENTS;\r\nfor (s = pipeline->stages; s; s = s->next) {\r\nif((s->stage_num == stage_num) && (s->firmware)) {\r\n*fw_handle = s->firmware->handle;\r\nreturn IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn IA_CSS_ERR_INTERNAL_ERROR;\r\n}\r\nenum ia_css_err ia_css_pipeline_get_output_stage(\r\nstruct ia_css_pipeline *pipeline,\r\nint mode,\r\nstruct ia_css_pipeline_stage **stage)\r\n{\r\nstruct ia_css_pipeline_stage *s;\r\nassert(pipeline != NULL);\r\nassert(stage != NULL);\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\r\n"ia_css_pipeline_get_output_stage() enter:\n");\r\n*stage = NULL;\r\nfor (s = pipeline->stages; s; s = s->next) {\r\nif (s->firmware && s->mode == mode &&\r\ns->firmware->info.isp.sp.enable.output)\r\n*stage = s;\r\n}\r\nif (*stage)\r\nreturn IA_CSS_SUCCESS;\r\nreturn ia_css_pipeline_get_stage(pipeline, mode, stage);\r\n}\r\nbool ia_css_pipeline_has_stopped(struct ia_css_pipeline *pipeline)\r\n{\r\nstatic struct sh_css_sp_group sp_group;\r\nunsigned int thread_id;\r\nconst struct ia_css_fw_info *fw;\r\nunsigned int HIVE_ADDR_sp_group;\r\nfw = &sh_css_sp_fw;\r\nHIVE_ADDR_sp_group = fw->info.sp.group;\r\nia_css_pipeline_get_sp_thread_id(pipeline->pipe_num, &thread_id);\r\nsp_dmem_load(SP0_ID,\r\n(unsigned int)sp_address_of(sp_group),\r\n&sp_group, sizeof(struct sh_css_sp_group));\r\nreturn sp_group.pipe[thread_id].num_stages == 0;\r\n}\r\nstruct sh_css_sp_pipeline_io_status *ia_css_pipeline_get_pipe_io_status(void)\r\n{\r\nreturn(&sh_css_sp_group.pipe_io_status);\r\n}\r\nbool ia_css_pipeline_is_mapped(unsigned int key)\r\n{\r\nbool ret = false;\r\nIA_CSS_ENTER_PRIVATE("key = %d", key);\r\nif ((key >= IA_CSS_PIPELINE_NUM_MAX) || (key >= IA_CSS_PIPE_ID_NUM)) {\r\nIA_CSS_ERROR("Invalid key!!");\r\nIA_CSS_LEAVE_PRIVATE("return = %d", false);\r\nreturn false;\r\n}\r\nret = (bool)(pipeline_num_to_sp_thread_map[key] != (unsigned)PIPELINE_NUM_UNMAPPED);\r\nIA_CSS_LEAVE_PRIVATE("return = %d", ret);\r\nreturn ret;\r\n}\r\nstatic void pipeline_stage_destroy(struct ia_css_pipeline_stage *stage)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++) {\r\nif (stage->out_frame_allocated[i]) {\r\nia_css_frame_free(stage->args.out_frame[i]);\r\nstage->args.out_frame[i] = NULL;\r\n}\r\n}\r\nif (stage->vf_frame_allocated) {\r\nia_css_frame_free(stage->args.out_vf_frame);\r\nstage->args.out_vf_frame = NULL;\r\n}\r\nsh_css_free(stage);\r\n}\r\nstatic void pipeline_init_sp_thread_map(void)\r\n{\r\nunsigned int i;\r\nfor (i = 1; i < SH_CSS_MAX_SP_THREADS; i++)\r\npipeline_sp_thread_list[i] = PIPELINE_SP_THREAD_EMPTY_TOKEN;\r\nfor (i = 0; i < IA_CSS_PIPELINE_NUM_MAX; i++)\r\npipeline_num_to_sp_thread_map[i] = PIPELINE_NUM_UNMAPPED;\r\n}\r\nstatic void pipeline_map_num_to_sp_thread(unsigned int pipe_num)\r\n{\r\nunsigned int i;\r\nbool found_sp_thread = false;\r\nassert(pipeline_num_to_sp_thread_map[pipe_num]\r\n== (unsigned)PIPELINE_NUM_UNMAPPED);\r\nfor (i = 0; i < SH_CSS_MAX_SP_THREADS; i++) {\r\nif (pipeline_sp_thread_list[i] ==\r\nPIPELINE_SP_THREAD_EMPTY_TOKEN) {\r\npipeline_sp_thread_list[i] =\r\nPIPELINE_SP_THREAD_RESERVED_TOKEN;\r\npipeline_num_to_sp_thread_map[pipe_num] = i;\r\nfound_sp_thread = true;\r\nbreak;\r\n}\r\n}\r\nassert(found_sp_thread != false);\r\n}\r\nstatic void pipeline_unmap_num_to_sp_thread(unsigned int pipe_num)\r\n{\r\nunsigned int thread_id;\r\nassert(pipeline_num_to_sp_thread_map[pipe_num]\r\n!= (unsigned)PIPELINE_NUM_UNMAPPED);\r\nthread_id = pipeline_num_to_sp_thread_map[pipe_num];\r\npipeline_num_to_sp_thread_map[pipe_num] = PIPELINE_NUM_UNMAPPED;\r\npipeline_sp_thread_list[thread_id] = PIPELINE_SP_THREAD_EMPTY_TOKEN;\r\n}\r\nstatic enum ia_css_err pipeline_stage_create(\r\nstruct ia_css_pipeline_stage_desc *stage_desc,\r\nstruct ia_css_pipeline_stage **new_stage)\r\n{\r\nenum ia_css_err err = IA_CSS_SUCCESS;\r\nstruct ia_css_pipeline_stage *stage = NULL;\r\nstruct ia_css_binary *binary;\r\nstruct ia_css_frame *vf_frame;\r\nstruct ia_css_frame *out_frame[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\r\nconst struct ia_css_fw_info *firmware;\r\nunsigned int i;\r\nif (!(stage_desc->in_frame) && !(stage_desc->firmware)\r\n&& (stage_desc->binary) && !(stage_desc->binary->online)) {\r\nerr = IA_CSS_ERR_INTERNAL_ERROR;\r\ngoto ERR;\r\n}\r\nbinary = stage_desc->binary;\r\nfirmware = stage_desc->firmware;\r\nvf_frame = stage_desc->vf_frame;\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++) {\r\nout_frame[i] = stage_desc->out_frame[i];\r\n}\r\nstage = sh_css_malloc(sizeof(*stage));\r\nif (stage == NULL) {\r\nerr = IA_CSS_ERR_CANNOT_ALLOCATE_MEMORY;\r\ngoto ERR;\r\n}\r\nmemset(stage, 0, sizeof(*stage));\r\nif (firmware) {\r\nstage->binary = NULL;\r\nstage->binary_info =\r\n(struct ia_css_binary_info *)&firmware->info.isp;\r\n} else {\r\nstage->binary = binary;\r\nif (binary)\r\nstage->binary_info =\r\n(struct ia_css_binary_info *)binary->info;\r\nelse\r\nstage->binary_info = NULL;\r\n}\r\nstage->firmware = firmware;\r\nstage->sp_func = stage_desc->sp_func;\r\nstage->max_input_width = stage_desc->max_input_width;\r\nstage->mode = stage_desc->mode;\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nstage->out_frame_allocated[i] = false;\r\nstage->vf_frame_allocated = false;\r\nstage->next = NULL;\r\nsh_css_binary_args_reset(&stage->args);\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++) {\r\nif (!(out_frame[i]) && (binary)\r\n&& (binary->out_frame_info[i].res.width)) {\r\nerr = ia_css_frame_allocate_from_info(&out_frame[i],\r\n&binary->out_frame_info[i]);\r\nif (err != IA_CSS_SUCCESS)\r\ngoto ERR;\r\nstage->out_frame_allocated[i] = true;\r\n}\r\n}\r\nif (!vf_frame) {\r\nif ((binary && binary->vf_frame_info.res.width) ||\r\n(firmware && firmware->info.isp.sp.enable.vf_veceven)\r\n) {\r\nerr = ia_css_frame_allocate_from_info(&vf_frame,\r\n&binary->vf_frame_info);\r\nif (err != IA_CSS_SUCCESS)\r\ngoto ERR;\r\nstage->vf_frame_allocated = true;\r\n}\r\n} else if (vf_frame && binary && binary->vf_frame_info.res.width\r\n&& !firmware) {\r\nif (vf_frame->data != mmgr_NULL)\r\nstage->vf_frame_allocated = true;\r\n}\r\nstage->args.in_frame = stage_desc->in_frame;\r\nfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\r\nstage->args.out_frame[i] = out_frame[i];\r\nstage->args.out_vf_frame = vf_frame;\r\n*new_stage = stage;\r\nreturn err;\r\nERR:\r\nif (stage != NULL)\r\npipeline_stage_destroy(stage);\r\nreturn err;\r\n}\r\nstatic void pipeline_init_defaults(\r\nstruct ia_css_pipeline *pipeline,\r\nenum ia_css_pipe_id pipe_id,\r\nunsigned int pipe_num,\r\nunsigned int dvs_frame_delay)\r\n{\r\nstruct ia_css_frame init_frame = DEFAULT_FRAME;\r\nunsigned int i;\r\npipeline->pipe_id = pipe_id;\r\npipeline->stages = NULL;\r\npipeline->stop_requested = false;\r\npipeline->current_stage = NULL;\r\npipeline->in_frame = init_frame;\r\nfor (i = 0; i < IA_CSS_PIPE_MAX_OUTPUT_STAGE; i++) {\r\npipeline->out_frame[i] = init_frame;\r\npipeline->vf_frame[i] = init_frame;\r\n}\r\npipeline->num_execs = -1;\r\npipeline->acquire_isp_each_stage = true;\r\npipeline->pipe_num = (uint8_t)pipe_num;\r\npipeline->dvs_frame_delay = dvs_frame_delay;\r\n}\r\nstatic void ia_css_pipeline_set_zoom_stage(struct ia_css_pipeline *pipeline)\r\n{\r\nstruct ia_css_pipeline_stage *stage = NULL;\r\nenum ia_css_err err = IA_CSS_SUCCESS;\r\nassert(pipeline != NULL);\r\nif (pipeline->pipe_id == IA_CSS_PIPE_ID_PREVIEW) {\r\nerr = ia_css_pipeline_get_stage(pipeline, IA_CSS_BINARY_MODE_VF_PP, &stage);\r\nif (err == IA_CSS_SUCCESS)\r\nstage->enable_zoom = true;\r\n} else if (pipeline->pipe_id == IA_CSS_PIPE_ID_CAPTURE) {\r\nerr = ia_css_pipeline_get_stage(pipeline, IA_CSS_BINARY_MODE_CAPTURE_PP, &stage);\r\nif (err == IA_CSS_SUCCESS)\r\nstage->enable_zoom = true;\r\n} else if (pipeline->pipe_id == IA_CSS_PIPE_ID_VIDEO) {\r\nerr = ia_css_pipeline_get_stage(pipeline, IA_CSS_BINARY_MODE_VIDEO, &stage);\r\nif (err == IA_CSS_SUCCESS)\r\nstage->enable_zoom = true;\r\n} else if (pipeline->pipe_id == IA_CSS_PIPE_ID_YUVPP) {\r\nerr = ia_css_pipeline_get_stage(pipeline, IA_CSS_BINARY_MODE_CAPTURE_PP, &stage);\r\nif (err == IA_CSS_SUCCESS)\r\nstage->enable_zoom = true;\r\n}\r\n}\r\nstatic void\r\nia_css_pipeline_configure_inout_port(struct ia_css_pipeline *me, bool continuous)\r\n{\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE,\r\n"ia_css_pipeline_configure_inout_port() enter: pipe_id(%d) continuous(%d)\n",\r\nme->pipe_id, continuous);\r\nswitch (me->pipe_id) {\r\ncase IA_CSS_PIPE_ID_PREVIEW:\r\ncase IA_CSS_PIPE_ID_VIDEO:\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_INPUT,\r\n(uint8_t)(continuous ? SH_CSS_COPYSINK_TYPE : SH_CSS_HOST_TYPE), 1);\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nbreak;\r\ncase IA_CSS_PIPE_ID_COPY:\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_INPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nif (continuous) {\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_COPYSINK_TYPE, 1);\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_TAGGERSINK_TYPE, 1);\r\n} else {\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\n}\r\nbreak;\r\ncase IA_CSS_PIPE_ID_CAPTURE:\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_INPUT,\r\n(uint8_t)(continuous ? SH_CSS_TAGGERSINK_TYPE : SH_CSS_HOST_TYPE),\r\n1);\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nbreak;\r\ncase IA_CSS_PIPE_ID_YUVPP:\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_INPUT,\r\n(uint8_t)(SH_CSS_HOST_TYPE), 1);\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nbreak;\r\ncase IA_CSS_PIPE_ID_ACC:\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_INPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nSH_CSS_PIPE_PORT_CONFIG_SET(me->inout_port_config,\r\n(uint8_t)SH_CSS_PORT_OUTPUT,\r\n(uint8_t)SH_CSS_HOST_TYPE, 1);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE,\r\n"ia_css_pipeline_configure_inout_port() leave: inout_port_config(%x)\n",\r\nme->inout_port_config);\r\n}
