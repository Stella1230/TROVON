static int __init ep405_device_probe(void)\r\n{\r\nof_platform_bus_probe(NULL, ep405_of_bus, NULL);\r\nreturn 0;\r\n}\r\nstatic void __init ep405_init_bcsr(void)\r\n{\r\nconst u8 *irq_routing;\r\nint i;\r\nbcsr_node = of_find_compatible_node(NULL, NULL, "ep405-bcsr");\r\nif (bcsr_node == NULL) {\r\nprintk(KERN_ERR "EP405 BCSR not found !\n");\r\nreturn;\r\n}\r\nbcsr_regs = of_iomap(bcsr_node, 0);\r\nif (bcsr_regs == NULL) {\r\nprintk(KERN_ERR "EP405 BCSR failed to map !\n");\r\nreturn;\r\n}\r\nirq_routing = of_get_property(bcsr_node, "irq-routing", NULL);\r\nif (irq_routing == NULL)\r\nreturn;\r\nfor (i = 0; i < 16; i++) {\r\nu8 irq = irq_routing[i];\r\nout_8(bcsr_regs + BCSR_XIRQ_SELECT, i);\r\nout_8(bcsr_regs + BCSR_XIRQ_ROUTING, irq);\r\n}\r\nin_8(bcsr_regs + BCSR_XIRQ_SELECT);\r\nmb();\r\nout_8(bcsr_regs + BCSR_GPIO_IRQ_PAR_CTRL, 0xfe);\r\n}\r\nstatic void __init ep405_setup_arch(void)\r\n{\r\nep405_init_bcsr();\r\npci_set_flags(PCI_REASSIGN_ALL_RSRC);\r\n}\r\nstatic int __init ep405_probe(void)\r\n{\r\nif (!of_machine_is_compatible("ep405"))\r\nreturn 0;\r\nreturn 1;\r\n}
