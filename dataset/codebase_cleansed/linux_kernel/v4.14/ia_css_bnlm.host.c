static inline void\r\nbnlm_lut_encode(struct bnlm_lut *lut, const int32_t *lut_thr, const int32_t *lut_val, const uint32_t lut_size)\r\n{\r\nu32 blk, i;\r\nconst u32 block_size = 16;\r\nconst u32 total_blocks = ISP_VEC_NELEMS / block_size;\r\nassert((lut_size >= 2) && (lut_size <= block_size));\r\nfor (i = 0; i < lut_size-2; i++) {\r\nassert(lut_thr[i] <= lut_thr[i+1]);\r\n}\r\nfor (i = 0; i < total_blocks * block_size; i++) {\r\nlut->thr[0][i] = 0;\r\nlut->val[0][i] = 0;\r\n}\r\nfor (i = 0; i < lut_size - 1; i++) {\r\nlut->thr[0][i] = lut_thr[i];\r\nlut->val[0][i] = lut_val[i];\r\n}\r\nlut->val[0][i] = lut_val[i];\r\nfor (blk = 1; blk < total_blocks; blk++) {\r\nu32 blk_offset = blk * block_size;\r\nfor (i = 1; i < lut_size; i++) {\r\nlut->thr[0][blk_offset + i] = lut->thr[0][i];\r\nlut->val[0][blk_offset + i] = lut->val[0][i];\r\n}\r\n}\r\n}\r\nvoid\r\nia_css_bnlm_vmem_encode(\r\nstruct bnlm_vmem_params *to,\r\nconst struct ia_css_bnlm_config *from,\r\nsize_t size)\r\n{\r\nint i;\r\n(void)size;\r\nbnlm_lut_encode(&to->mu_root_lut, from->mu_root_lut_thr, from->mu_root_lut_val, 16);\r\nbnlm_lut_encode(&to->sad_norm_lut, from->sad_norm_lut_thr, from->sad_norm_lut_val, 16);\r\nbnlm_lut_encode(&to->sig_detail_lut, from->sig_detail_lut_thr, from->sig_detail_lut_val, 16);\r\nbnlm_lut_encode(&to->sig_rad_lut, from->sig_rad_lut_thr, from->sig_rad_lut_val, 16);\r\nbnlm_lut_encode(&to->rad_pow_lut, from->rad_pow_lut_thr, from->rad_pow_lut_val, 16);\r\nbnlm_lut_encode(&to->nl_0_lut, from->nl_0_lut_thr, from->nl_0_lut_val, 16);\r\nbnlm_lut_encode(&to->nl_1_lut, from->nl_1_lut_thr, from->nl_1_lut_val, 16);\r\nbnlm_lut_encode(&to->nl_2_lut, from->nl_2_lut_thr, from->nl_2_lut_val, 16);\r\nbnlm_lut_encode(&to->nl_3_lut, from->nl_3_lut_thr, from->nl_3_lut_val, 16);\r\nmemset(to->nl_th, 0, sizeof(to->nl_th));\r\nto->nl_th[0][0] = from->nl_th[0];\r\nto->nl_th[0][1] = from->nl_th[1];\r\nto->nl_th[0][2] = from->nl_th[2];\r\nmemset(to->match_quality_max_idx, 0, sizeof(to->match_quality_max_idx));\r\nto->match_quality_max_idx[0][0] = from->match_quality_max_idx[0];\r\nto->match_quality_max_idx[0][1] = from->match_quality_max_idx[1];\r\nto->match_quality_max_idx[0][2] = from->match_quality_max_idx[2];\r\nto->match_quality_max_idx[0][3] = from->match_quality_max_idx[3];\r\nbnlm_lut_encode(&to->div_lut, div_lut_nearests, div_lut_slopes, BNLM_DIV_LUT_SIZE);\r\nmemset(to->div_lut_intercepts, 0, sizeof(to->div_lut_intercepts));\r\nfor(i = 0; i < BNLM_DIV_LUT_SIZE; i++) {\r\nto->div_lut_intercepts[0][i] = div_lut_intercepts[i];\r\n}\r\nmemset(to->power_of_2, 0, sizeof(to->power_of_2));\r\nfor (i = 0; i < (ISP_VEC_ELEMBITS-1); i++) {\r\nto->power_of_2[0][i] = 1 << i;\r\n}\r\n}\r\nvoid\r\nia_css_bnlm_encode(\r\nstruct bnlm_dmem_params *to,\r\nconst struct ia_css_bnlm_config *from,\r\nsize_t size)\r\n{\r\n(void)size;\r\nto->rad_enable = from->rad_enable;\r\nto->rad_x_origin = from->rad_x_origin;\r\nto->rad_y_origin = from->rad_y_origin;\r\nto->avg_min_th = from->avg_min_th;\r\nto->max_min_th = from->max_min_th;\r\nto->exp_coeff_a = from->exp_coeff_a;\r\nto->exp_coeff_b = from->exp_coeff_b;\r\nto->exp_coeff_c = from->exp_coeff_c;\r\nto->exp_exponent = from->exp_exponent;\r\n}\r\nvoid\r\nia_css_bnlm_debug_trace(\r\nconst struct ia_css_bnlm_config *config,\r\nunsigned level)\r\n{\r\nif (!config)\r\nreturn;\r\n#ifndef IA_CSS_NO_DEBUG\r\nia_css_debug_dtrace(level, "BNLM:\n");\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "rad_enable", config->rad_enable);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "rad_x_origin", config->rad_x_origin);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "rad_y_origin", config->rad_y_origin);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "avg_min_th", config->avg_min_th);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "max_min_th", config->max_min_th);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_coeff_a", config->exp_coeff_a);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_coeff_b", config->exp_coeff_b);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_coeff_c", config->exp_coeff_c);\r\nia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_exponent", config->exp_exponent);\r\n#endif\r\n}
