void speakup_start_ttys(void)\r\n{\r\nint i;\r\nfor (i = 0; i < MAX_NR_CONSOLES; i++) {\r\nif (speakup_console[i] && speakup_console[i]->tty_stopped)\r\ncontinue;\r\nif ((vc_cons[i].d) && (vc_cons[i].d->port.tty))\r\nstart_tty(vc_cons[i].d->port.tty);\r\n}\r\n}\r\nstatic void speakup_stop_ttys(void)\r\n{\r\nint i;\r\nfor (i = 0; i < MAX_NR_CONSOLES; i++)\r\nif ((vc_cons[i].d && (vc_cons[i].d->port.tty)))\r\nstop_tty(vc_cons[i].d->port.tty);\r\n}\r\nstatic int synth_buffer_free(void)\r\n{\r\nint chars_free;\r\nif (buff_in >= buff_out)\r\nchars_free = SYNTH_BUF_SIZE - (buff_in - buff_out);\r\nelse\r\nchars_free = buff_out - buff_in;\r\nreturn chars_free;\r\n}\r\nint synth_buffer_empty(void)\r\n{\r\nreturn (buff_in == buff_out);\r\n}\r\nvoid synth_buffer_add(u16 ch)\r\n{\r\nif (!synth->alive) {\r\nreturn;\r\n}\r\nif (synth_buffer_free() <= 100) {\r\nsynth_start();\r\nspeakup_stop_ttys();\r\n}\r\nif (synth_buffer_free() <= 1)\r\nreturn;\r\n*buff_in++ = ch;\r\nif (buff_in > buffer_end)\r\nbuff_in = synth_buffer;\r\n}\r\nu16 synth_buffer_getc(void)\r\n{\r\nu16 ch;\r\nif (buff_out == buff_in)\r\nreturn 0;\r\nch = *buff_out++;\r\nif (buff_out > buffer_end)\r\nbuff_out = synth_buffer;\r\nreturn ch;\r\n}\r\nu16 synth_buffer_peek(void)\r\n{\r\nif (buff_out == buff_in)\r\nreturn 0;\r\nreturn *buff_out;\r\n}\r\nvoid synth_buffer_skip_nonlatin1(void)\r\n{\r\nwhile (buff_out != buff_in) {\r\nif (*buff_out < 0x100)\r\nreturn;\r\nbuff_out++;\r\nif (buff_out > buffer_end)\r\nbuff_out = synth_buffer;\r\n}\r\n}\r\nvoid synth_buffer_clear(void)\r\n{\r\nbuff_in = synth_buffer;\r\nbuff_out = synth_buffer;\r\n}
