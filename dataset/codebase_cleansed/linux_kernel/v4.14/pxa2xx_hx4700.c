static int hx4700_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nint ret;\r\nret = gpio_request_array(gpios, ARRAY_SIZE(gpios));\r\nif (ret)\r\ngoto out;\r\nirq_set_irq_type(gpio_to_irq(GPIOD4_CF_nCD), IRQ_TYPE_EDGE_BOTH);\r\nskt->stat[SOC_STAT_CD].gpio = GPIOD4_CF_nCD;\r\nskt->stat[SOC_STAT_CD].name = "PCMCIA CD";\r\nskt->stat[SOC_STAT_RDY].gpio = GPIO60_HX4700_CF_RNB;\r\nskt->stat[SOC_STAT_RDY].name = "PCMCIA Ready";\r\nout:\r\nreturn ret;\r\n}\r\nstatic void hx4700_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\r\n{\r\ngpio_free_array(gpios, ARRAY_SIZE(gpios));\r\n}\r\nstatic void hx4700_pcmcia_socket_state(struct soc_pcmcia_socket *skt,\r\nstruct pcmcia_state *state)\r\n{\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nstatic int hx4700_pcmcia_configure_socket(struct soc_pcmcia_socket *skt,\r\nconst socket_state_t *state)\r\n{\r\nswitch (state->Vcc) {\r\ncase 0:\r\ngpio_set_value(EGPIO4_CF_3V3_ON, 0);\r\nbreak;\r\ncase 33:\r\ngpio_set_value(EGPIO4_CF_3V3_ON, 1);\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "pcmcia: Unsupported Vcc: %d\n", state->Vcc);\r\nreturn -EINVAL;\r\n}\r\ngpio_set_value(GPIO114_HX4700_CF_RESET, (state->flags & SS_RESET) != 0);\r\nreturn 0;\r\n}\r\nstatic int __init hx4700_pcmcia_init(void)\r\n{\r\nstruct platform_device *pdev;\r\nif (!machine_is_h4700())\r\nreturn -ENODEV;\r\npdev = platform_device_register_data(NULL, "pxa2xx-pcmcia", -1,\r\n&hx4700_pcmcia_ops, sizeof(hx4700_pcmcia_ops));\r\nif (IS_ERR(pdev))\r\nreturn PTR_ERR(pdev);\r\nhx4700_pcmcia_device = pdev;\r\nreturn 0;\r\n}\r\nstatic void __exit hx4700_pcmcia_exit(void)\r\n{\r\nplatform_device_unregister(hx4700_pcmcia_device);\r\n}
