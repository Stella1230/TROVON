uint oid_null_function(struct oid_par_priv *poid_par_priv)\r\n{\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_wireless_mode_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid == SET_OID) {\r\nif (poid_par_priv->information_buf_len >= sizeof(u8))\r\nAdapter->registrypriv.wireless_mode =\r\n*(u8 *)poid_par_priv->information_buf;\r\nelse\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n} else if (poid_par_priv->type_of_oid == QUERY_OID) {\r\nif (poid_par_priv->information_buf_len >= sizeof(u8)) {\r\n*(u8 *)poid_par_priv->information_buf =\r\nAdapter->registrypriv.wireless_mode;\r\n*poid_par_priv->bytes_rw =\r\npoid_par_priv->information_buf_len;\r\n} else {\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n}\r\n} else {\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_pro_write_bb_reg_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nstruct bb_reg_param *pbbreg;\r\nu16 offset;\r\nu32 value;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(struct bb_reg_param))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\npbbreg = (struct bb_reg_param *)(poid_par_priv->information_buf);\r\noffset = (u16)(pbbreg->offset) & 0xFFF;\r\nif (offset < BB_REG_BASE_ADDR)\r\noffset |= BB_REG_BASE_ADDR;\r\nvalue = pbbreg->value;\r\nr8712_bb_reg_write(Adapter, offset, value);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_read_bb_reg_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nstruct bb_reg_param *pbbreg;\r\nu16 offset;\r\nu32 value;\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(struct bb_reg_param))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\npbbreg = (struct bb_reg_param *)(poid_par_priv->information_buf);\r\noffset = (u16)(pbbreg->offset) & 0xFFF;\r\nif (offset < BB_REG_BASE_ADDR)\r\noffset |= BB_REG_BASE_ADDR;\r\nvalue = r8712_bb_reg_read(Adapter, offset);\r\npbbreg->value = value;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_write_rf_reg_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nstruct rf_reg_param *pbbreg;\r\nu8 path;\r\nu8 offset;\r\nu32 value;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(struct rf_reg_param))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\npbbreg = (struct rf_reg_param *)(poid_par_priv->information_buf);\r\npath = (u8)pbbreg->path;\r\nif (path > RF_PATH_B)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\noffset = (u8)pbbreg->offset;\r\nvalue = pbbreg->value;\r\nr8712_rf_reg_write(Adapter, path, offset, value);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_read_rf_reg_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nstruct rf_reg_param *pbbreg;\r\nu8 path;\r\nu8 offset;\r\nu32 value;\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(struct rf_reg_param))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\npbbreg = (struct rf_reg_param *)(poid_par_priv->information_buf);\r\npath = (u8)pbbreg->path;\r\nif (path > RF_PATH_B)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\noffset = (u8)pbbreg->offset;\r\nvalue = r8712_rf_reg_read(Adapter, path, offset);\r\npbbreg->value = value;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nstatic int mp_start_test(struct _adapter *padapter)\r\n{\r\nstruct mp_priv *pmppriv = &padapter->mppriv;\r\nstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\r\nstruct wlan_network *tgt_network = &pmlmepriv->cur_network;\r\nstruct wlan_bssid_ex bssid;\r\nstruct sta_info *psta;\r\nunsigned long length;\r\nunsigned long irqL;\r\nint res = _SUCCESS;\r\nmemcpy(bssid.MacAddress, pmppriv->network_macaddr, ETH_ALEN);\r\nbssid.Ssid.SsidLength = 16;\r\nmemcpy(bssid.Ssid.Ssid, (unsigned char *)"mp_pseudo_adhoc",\r\nbssid.Ssid.SsidLength);\r\nbssid.InfrastructureMode = Ndis802_11IBSS;\r\nbssid.NetworkTypeInUse = Ndis802_11DS;\r\nbssid.IELength = 0;\r\nlength = r8712_get_wlan_bssid_ex_sz(&bssid);\r\nif (length % 4) {\r\nbssid.Length = ((length >> 2) + 1) << 2;\r\n} else {\r\nbssid.Length = length;\r\n}\r\nspin_lock_irqsave(&pmlmepriv->lock, irqL);\r\nif (check_fwstate(pmlmepriv, WIFI_MP_STATE))\r\ngoto end_of_mp_start_test;\r\npmppriv->prev_fw_state = get_fwstate(pmlmepriv);\r\npmlmepriv->fw_state = WIFI_MP_STATE;\r\nif (pmppriv->mode == _LOOPBOOK_MODE_)\r\nset_fwstate(pmlmepriv, WIFI_MP_LPBK_STATE);\r\nset_fwstate(pmlmepriv, _FW_UNDER_LINKING);\r\npsta = r8712_get_stainfo(&padapter->stapriv,\r\ntgt_network->network.MacAddress);\r\nif (psta)\r\nr8712_free_stainfo(padapter, psta);\r\npsta = r8712_alloc_stainfo(&padapter->stapriv, bssid.MacAddress);\r\nif (psta == NULL) {\r\nres = _FAIL;\r\ngoto end_of_mp_start_test;\r\n}\r\ntgt_network->join_res = 1;\r\ntgt_network->aid = psta->aid = 1;\r\nmemcpy(&tgt_network->network, &bssid, length);\r\n_clr_fwstate_(pmlmepriv, _FW_UNDER_LINKING);\r\nr8712_os_indicate_connect(padapter);\r\nset_fwstate(pmlmepriv, _FW_LINKED);\r\nend_of_mp_start_test:\r\nspin_unlock_irqrestore(&pmlmepriv->lock, irqL);\r\nreturn res;\r\n}\r\nstatic int mp_stop_test(struct _adapter *padapter)\r\n{\r\nstruct mp_priv *pmppriv = &padapter->mppriv;\r\nstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\r\nstruct wlan_network *tgt_network = &pmlmepriv->cur_network;\r\nstruct sta_info *psta;\r\nunsigned long irqL;\r\nspin_lock_irqsave(&pmlmepriv->lock, irqL);\r\nif (!check_fwstate(pmlmepriv, WIFI_MP_STATE))\r\ngoto end_of_mp_stop_test;\r\nr8712_os_indicate_disconnect(padapter);\r\npsta = r8712_get_stainfo(&padapter->stapriv,\r\ntgt_network->network.MacAddress);\r\nif (psta)\r\nr8712_free_stainfo(padapter, psta);\r\npmlmepriv->fw_state = pmppriv->prev_fw_state;\r\nmemset(tgt_network, 0, sizeof(struct wlan_network));\r\nend_of_mp_stop_test:\r\nspin_unlock_irqrestore(&pmlmepriv->lock, irqL);\r\nreturn _SUCCESS;\r\n}\r\nint mp_start_joinbss(struct _adapter *padapter, struct ndis_802_11_ssid *pssid)\r\n{\r\nstruct mp_priv *pmppriv = &padapter->mppriv;\r\nstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\r\nunsigned char res = _SUCCESS;\r\nif (!check_fwstate(pmlmepriv, WIFI_MP_STATE))\r\nreturn _FAIL;\r\nif (!check_fwstate(pmlmepriv, _FW_LINKED))\r\nreturn _FAIL;\r\n_clr_fwstate_(pmlmepriv, _FW_LINKED);\r\nres = r8712_setassocsta_cmd(padapter, pmppriv->network_macaddr);\r\nset_fwstate(pmlmepriv, _FW_UNDER_LINKING);\r\nreturn res;\r\n}\r\nuint oid_rt_pro_set_data_rate_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 ratevalue;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nratevalue = *((u32 *)poid_par_priv->information_buf);\r\nif (ratevalue >= MPT_RATE_LAST)\r\nreturn RNDIS_STATUS_INVALID_DATA;\r\nAdapter->mppriv.curr_rateidx = ratevalue;\r\nr8712_SetDataRate(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_start_test_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nu32 mode;\r\nu8 val8;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nmode = *((u32 *)poid_par_priv->information_buf);\r\nAdapter->mppriv.mode = mode;\r\nif (mp_start_test(Adapter) == _FAIL)\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nr8712_write8(Adapter, MSR, 1);\r\nr8712_write8(Adapter, RCR, 0);\r\nr8712_write8(Adapter, RCR + 2, 0x57);\r\nr8712_write16(Adapter, RXFLTMAP0, 0x0);\r\nval8 = r8712_read8(Adapter, EE_9346CR);\r\nif (!(val8 & _9356SEL)) {\r\nr8712_efuse_reg_init(Adapter);\r\nr8712_efuse_change_max_size(Adapter);\r\nr8712_efuse_reg_uninit(Adapter);\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_pro_stop_test_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (mp_stop_test(Adapter) == _FAIL)\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nreturn status;\r\n}\r\nuint oid_rt_pro_set_channel_direct_call_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 Channel;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nChannel = *((u32 *)poid_par_priv->information_buf);\r\nif (Channel > 14)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nAdapter->mppriv.curr_ch = Channel;\r\nr8712_SetChannel(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_antenna_bb_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 antenna;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nantenna = *((u32 *)poid_par_priv->information_buf);\r\nAdapter->mppriv.antenna_tx = (u16)((antenna & 0xFFFF0000) >> 16);\r\nAdapter->mppriv.antenna_rx = (u16)(antenna & 0x0000FFFF);\r\nr8712_SwitchAntenna(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_tx_power_control_hdl(\r\nstruct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 tx_pwr_idx;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\ntx_pwr_idx = *((u32 *)poid_par_priv->information_buf);\r\nif (tx_pwr_idx > MAX_TX_PWR_INDEX_N_MODE)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nAdapter->mppriv.curr_txpoweridx = (u8)tx_pwr_idx;\r\nr8712_SetTxPower(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_query_tx_packet_sent_hdl(\r\nstruct oid_par_priv *poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID) {\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nreturn status;\r\n}\r\nif (poid_par_priv->information_buf_len == sizeof(u32)) {\r\n*(u32 *)poid_par_priv->information_buf =\r\nAdapter->mppriv.tx_pktcount;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\n} else {\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_pro_query_rx_packet_received_hdl(\r\nstruct oid_par_priv *poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID) {\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nreturn status;\r\n}\r\nif (poid_par_priv->information_buf_len == sizeof(u32)) {\r\n*(u32 *)poid_par_priv->information_buf =\r\nAdapter->mppriv.rx_pktcount;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\n} else {\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_pro_query_rx_packet_crc32_error_hdl(\r\nstruct oid_par_priv *poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID) {\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nreturn status;\r\n}\r\nif (poid_par_priv->information_buf_len == sizeof(u32)) {\r\n*(u32 *)poid_par_priv->information_buf =\r\nAdapter->mppriv.rx_crcerrpktcount;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\n} else {\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_pro_reset_tx_packet_sent_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nAdapter->mppriv.tx_pktcount = 0;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_reset_rx_packet_received_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len == sizeof(u32)) {\r\nAdapter->mppriv.rx_pktcount = 0;\r\nAdapter->mppriv.rx_crcerrpktcount = 0;\r\n} else {\r\nstatus = RNDIS_STATUS_INVALID_LENGTH;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_reset_phy_rx_packet_count_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nr8712_ResetPhyRxPktCount(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_get_phy_rx_packet_received_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\n*(u32 *)poid_par_priv->information_buf =\r\nr8712_GetPhyRxPktReceived(Adapter);\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_get_phy_rx_packet_crc32_error_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len != sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\n*(u32 *)poid_par_priv->information_buf =\r\nr8712_GetPhyRxPktCRC32Error(Adapter);\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_modulation_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nAdapter->mppriv.curr_modem = *((u8 *)poid_par_priv->information_buf);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_continuous_tx_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 bStartTest;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nbStartTest = *((u32 *)poid_par_priv->information_buf);\r\nr8712_SetContinuousTx(Adapter, (u8)bStartTest);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_single_carrier_tx_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 bStartTest;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nbStartTest = *((u32 *)poid_par_priv->information_buf);\r\nr8712_SetSingleCarrierTx(Adapter, (u8)bStartTest);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_carrier_suppression_tx_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 bStartTest;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nbStartTest = *((u32 *)poid_par_priv->information_buf);\r\nr8712_SetCarrierSuppressionTx(Adapter, (u8)bStartTest);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_set_single_tone_tx_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 bStartTest;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nbStartTest = *((u32 *)poid_par_priv->information_buf);\r\nr8712_SetSingleToneTx(Adapter, (u8)bStartTest);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_read_register_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct mp_rw_reg *RegRWStruct;\r\nu16 offset;\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nRegRWStruct = (struct mp_rw_reg *)poid_par_priv->information_buf;\r\nif ((RegRWStruct->offset >= 0x10250800) &&\r\n(RegRWStruct->offset <= 0x10250FFF)) {\r\noffset = (u16)(RegRWStruct->offset) & 0xFFF;\r\nRegRWStruct->value = r8712_bb_reg_read(Adapter, offset);\r\n} else {\r\nswitch (RegRWStruct->width) {\r\ncase 1:\r\nRegRWStruct->value = r8712_read8(Adapter,\r\nRegRWStruct->offset);\r\nbreak;\r\ncase 2:\r\nRegRWStruct->value = r8712_read16(Adapter,\r\nRegRWStruct->offset);\r\nbreak;\r\ncase 4:\r\nRegRWStruct->value = r8712_read32(Adapter,\r\nRegRWStruct->offset);\r\nbreak;\r\ndefault:\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nbreak;\r\n}\r\n}\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn status;\r\n}\r\nuint oid_rt_pro_write_register_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct mp_rw_reg *RegRWStruct;\r\nu16 offset;\r\nu32 value;\r\nu32 oldValue = 0;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nRegRWStruct = (struct mp_rw_reg *)poid_par_priv->information_buf;\r\nif ((RegRWStruct->offset >= 0x10250800) &&\r\n(RegRWStruct->offset <= 0x10250FFF)) {\r\noffset = (u16)(RegRWStruct->offset) & 0xFFF;\r\nvalue = RegRWStruct->value;\r\nswitch (RegRWStruct->width) {\r\ncase 1:\r\noldValue = r8712_bb_reg_read(Adapter, offset);\r\noldValue &= 0xFFFFFF00;\r\nvalue &= 0x000000FF;\r\nvalue |= oldValue;\r\nbreak;\r\ncase 2:\r\noldValue = r8712_bb_reg_read(Adapter, offset);\r\noldValue &= 0xFFFF0000;\r\nvalue &= 0x0000FFFF;\r\nvalue |= oldValue;\r\nbreak;\r\n}\r\nr8712_bb_reg_write(Adapter, offset, value);\r\n} else {\r\nswitch (RegRWStruct->width) {\r\ncase 1:\r\nr8712_write8(Adapter, RegRWStruct->offset,\r\n(unsigned char)RegRWStruct->value);\r\nbreak;\r\ncase 2:\r\nr8712_write16(Adapter, RegRWStruct->offset,\r\n(unsigned short)RegRWStruct->value);\r\nbreak;\r\ncase 4:\r\nr8712_write32(Adapter, RegRWStruct->offset,\r\n(unsigned int)RegRWStruct->value);\r\nbreak;\r\ndefault:\r\nstatus = RNDIS_STATUS_NOT_ACCEPTED;\r\nbreak;\r\n}\r\nif ((status == RNDIS_STATUS_SUCCESS) &&\r\n(RegRWStruct->offset == HIMR) &&\r\n(RegRWStruct->width == 4))\r\nAdapter->ImrContent = RegRWStruct->value;\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_get_thermal_meter_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (Adapter->mppriv.act_in_progress)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(u8))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nAdapter->mppriv.act_in_progress = true;\r\nAdapter->mppriv.workparam.bcompleted = false;\r\nAdapter->mppriv.workparam.act_type = MPT_GET_THERMAL_METER;\r\nAdapter->mppriv.workparam.io_offset = 0;\r\nAdapter->mppriv.workparam.io_value = 0xFFFFFFFF;\r\nr8712_GetThermalMeter(Adapter, &Adapter->mppriv.workparam.io_value);\r\nAdapter->mppriv.workparam.bcompleted = true;\r\nAdapter->mppriv.act_in_progress = false;\r\n*(u32 *)poid_par_priv->information_buf =\r\nAdapter->mppriv.workparam.io_value;\r\n*poid_par_priv->bytes_rw = sizeof(u32);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_read_efuse_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct EFUSE_ACCESS_STRUCT *pefuse;\r\nu8 *data;\r\nu16 addr = 0, cnts = 0;\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len <\r\nsizeof(struct EFUSE_ACCESS_STRUCT))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\npefuse = (struct EFUSE_ACCESS_STRUCT *)poid_par_priv->information_buf;\r\naddr = pefuse->start_addr;\r\ncnts = pefuse->cnts;\r\ndata = pefuse->data;\r\nmemset(data, 0xFF, cnts);\r\nif ((addr > 511) || (cnts < 1) || (cnts > 512) || (addr + cnts) >\r\nEFUSE_MAX_SIZE)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (!r8712_efuse_access(Adapter, true, addr, cnts, data))\r\nstatus = RNDIS_STATUS_FAILURE;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn status;\r\n}\r\nuint oid_rt_pro_write_efuse_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nstruct EFUSE_ACCESS_STRUCT *pefuse;\r\nu8 *data;\r\nu16 addr = 0, cnts = 0;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\npefuse = (struct EFUSE_ACCESS_STRUCT *)poid_par_priv->information_buf;\r\naddr = pefuse->start_addr;\r\ncnts = pefuse->cnts;\r\ndata = pefuse->data;\r\nif ((addr > 511) || (cnts < 1) || (cnts > 512) ||\r\n(addr + cnts) > r8712_efuse_get_max_size(Adapter))\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (!r8712_efuse_access(Adapter, false, addr, cnts, data))\r\nstatus = RNDIS_STATUS_FAILURE;\r\nreturn status;\r\n}\r\nuint oid_rt_get_efuse_current_size_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(int))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nr8712_efuse_reg_init(Adapter);\r\n*(int *)poid_par_priv->information_buf =\r\nr8712_efuse_get_current_size(Adapter);\r\nr8712_efuse_reg_uninit(Adapter);\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_get_efuse_max_size_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\n*(int *)poid_par_priv->information_buf =\r\nr8712_efuse_get_max_size(Adapter);\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_pro_efuse_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nif (poid_par_priv->type_of_oid == QUERY_OID)\r\nstatus = oid_rt_pro_read_efuse_hdl(poid_par_priv);\r\nelse\r\nstatus = oid_rt_pro_write_efuse_hdl(poid_par_priv);\r\nreturn status;\r\n}\r\nuint oid_rt_pro_efuse_map_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nuint status = RNDIS_STATUS_SUCCESS;\r\nu8 *data;\r\n*poid_par_priv->bytes_rw = 0;\r\nif (poid_par_priv->information_buf_len < EFUSE_MAP_MAX_SIZE)\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\ndata = (u8 *)poid_par_priv->information_buf;\r\nif (poid_par_priv->type_of_oid == QUERY_OID) {\r\nif (r8712_efuse_map_read(Adapter, 0, EFUSE_MAP_MAX_SIZE, data))\r\n*poid_par_priv->bytes_rw = EFUSE_MAP_MAX_SIZE;\r\nelse\r\nstatus = RNDIS_STATUS_FAILURE;\r\n} else {\r\nif (r8712_efuse_reg_init(Adapter)) {\r\nif (r8712_efuse_map_write(Adapter, 0,\r\nEFUSE_MAP_MAX_SIZE, data))\r\n*poid_par_priv->bytes_rw = EFUSE_MAP_MAX_SIZE;\r\nelse\r\nstatus = RNDIS_STATUS_FAILURE;\r\nr8712_efuse_reg_uninit(Adapter);\r\n} else {\r\nstatus = RNDIS_STATUS_FAILURE;\r\n}\r\n}\r\nreturn status;\r\n}\r\nuint oid_rt_set_bandwidth_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu32 bandwidth;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nbandwidth = *((u32 *)poid_par_priv->information_buf);\r\nif (bandwidth != HT_CHANNEL_WIDTH_20)\r\nbandwidth = HT_CHANNEL_WIDTH_40;\r\nAdapter->mppriv.curr_bandwidth = (u8)bandwidth;\r\nr8712_SwitchBandwidth(Adapter);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_set_rx_packet_type_hdl(struct oid_par_priv\r\n*poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nu8 rx_pkt_type;\r\nu32 rcr_val32;\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(u8))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\nrx_pkt_type = *((u8 *)poid_par_priv->information_buf);\r\nrcr_val32 = r8712_read32(Adapter, RCR);\r\nrcr_val32 &= ~(RCR_CBSSID | RCR_AB | RCR_AM | RCR_APM | RCR_AAP);\r\nswitch (rx_pkt_type) {\r\ncase RX_PKT_BROADCAST:\r\nrcr_val32 |= (RCR_AB | RCR_AM | RCR_APM | RCR_AAP | RCR_ACRC32);\r\nbreak;\r\ncase RX_PKT_DEST_ADDR:\r\nrcr_val32 |= (RCR_AB | RCR_AM | RCR_APM | RCR_AAP | RCR_ACRC32);\r\nbreak;\r\ncase RX_PKT_PHY_MATCH:\r\nrcr_val32 |= (RCR_APM | RCR_ACRC32);\r\nbreak;\r\ndefault:\r\nrcr_val32 &= ~(RCR_AAP |\r\nRCR_APM |\r\nRCR_AM |\r\nRCR_AB |\r\nRCR_ACRC32);\r\nbreak;\r\n}\r\nif (rx_pkt_type == RX_PKT_DEST_ADDR)\r\nAdapter->mppriv.check_mp_pkt = 1;\r\nelse\r\nAdapter->mppriv.check_mp_pkt = 0;\r\nr8712_write32(Adapter, RCR, rcr_val32);\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nunsigned int mp_ioctl_xmit_packet_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nreturn _SUCCESS;\r\n}\r\nuint oid_rt_set_power_down_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nif (poid_par_priv->type_of_oid != SET_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}\r\nuint oid_rt_get_power_mode_hdl(struct oid_par_priv *poid_par_priv)\r\n{\r\nstruct _adapter *Adapter = (struct _adapter *)\r\n(poid_par_priv->adapter_context);\r\nif (poid_par_priv->type_of_oid != QUERY_OID)\r\nreturn RNDIS_STATUS_NOT_ACCEPTED;\r\nif (poid_par_priv->information_buf_len < sizeof(u32))\r\nreturn RNDIS_STATUS_INVALID_LENGTH;\r\n*(int *)poid_par_priv->information_buf =\r\nAdapter->registrypriv.low_power ? POWER_LOW : POWER_NORMAL;\r\n*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\r\nreturn RNDIS_STATUS_SUCCESS;\r\n}
