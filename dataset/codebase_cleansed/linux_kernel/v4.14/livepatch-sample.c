static int livepatch_cmdline_proc_show(struct seq_file *m, void *v)\r\n{\r\nseq_printf(m, "%s\n", "this has been live patched");\r\nreturn 0;\r\n}\r\nstatic int livepatch_init(void)\r\n{\r\nint ret;\r\nif (!klp_have_reliable_stack() && !patch.immediate) {\r\npatch.immediate = true;\r\npr_notice("The consistency model isn't supported for your architecture. Bypassing safety mechanisms and applying the patch immediately.\n");\r\n}\r\nret = klp_register_patch(&patch);\r\nif (ret)\r\nreturn ret;\r\nret = klp_enable_patch(&patch);\r\nif (ret) {\r\nWARN_ON(klp_unregister_patch(&patch));\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void livepatch_exit(void)\r\n{\r\nWARN_ON(klp_unregister_patch(&patch));\r\n}
