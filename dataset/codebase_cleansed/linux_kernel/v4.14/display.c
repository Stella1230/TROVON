void omapdss_default_get_timings(struct omap_dss_device *dssdev,\r\nstruct videomode *vm)\r\n{\r\n*vm = dssdev->panel.vm;\r\n}\r\nint omapdss_register_display(struct omap_dss_device *dssdev)\r\n{\r\nstruct omap_dss_driver *drv = dssdev->driver;\r\nstruct list_head *cur;\r\nint id;\r\nid = of_alias_get_id(dssdev->dev->of_node, "display");\r\nif (id < 0)\r\nid = disp_num_counter++;\r\nsnprintf(dssdev->alias, sizeof(dssdev->alias), "display%d", id);\r\nof_property_read_string(dssdev->dev->of_node, "label", &dssdev->name);\r\nif (dssdev->name == NULL)\r\ndssdev->name = dssdev->alias;\r\nif (drv && drv->get_timings == NULL)\r\ndrv->get_timings = omapdss_default_get_timings;\r\nmutex_lock(&panel_list_mutex);\r\nlist_for_each(cur, &panel_list) {\r\nstruct omap_dss_device *ldev = list_entry(cur,\r\nstruct omap_dss_device,\r\npanel_list);\r\nif (strcmp(ldev->alias, dssdev->alias) > 0)\r\nbreak;\r\n}\r\nlist_add_tail(&dssdev->panel_list, cur);\r\nmutex_unlock(&panel_list_mutex);\r\nreturn 0;\r\n}\r\nvoid omapdss_unregister_display(struct omap_dss_device *dssdev)\r\n{\r\nmutex_lock(&panel_list_mutex);\r\nlist_del(&dssdev->panel_list);\r\nmutex_unlock(&panel_list_mutex);\r\n}\r\nbool omapdss_component_is_display(struct device_node *node)\r\n{\r\nstruct omap_dss_device *dssdev;\r\nbool found = false;\r\nmutex_lock(&panel_list_mutex);\r\nlist_for_each_entry(dssdev, &panel_list, panel_list) {\r\nif (dssdev->dev->of_node == node) {\r\nfound = true;\r\ngoto out;\r\n}\r\n}\r\nout:\r\nmutex_unlock(&panel_list_mutex);\r\nreturn found;\r\n}\r\nstruct omap_dss_device *omap_dss_get_device(struct omap_dss_device *dssdev)\r\n{\r\nif (!try_module_get(dssdev->owner))\r\nreturn NULL;\r\nif (get_device(dssdev->dev) == NULL) {\r\nmodule_put(dssdev->owner);\r\nreturn NULL;\r\n}\r\nreturn dssdev;\r\n}\r\nvoid omap_dss_put_device(struct omap_dss_device *dssdev)\r\n{\r\nput_device(dssdev->dev);\r\nmodule_put(dssdev->owner);\r\n}\r\nstruct omap_dss_device *omap_dss_get_next_device(struct omap_dss_device *from)\r\n{\r\nstruct list_head *l;\r\nstruct omap_dss_device *dssdev;\r\nmutex_lock(&panel_list_mutex);\r\nif (list_empty(&panel_list)) {\r\ndssdev = NULL;\r\ngoto out;\r\n}\r\nif (from == NULL) {\r\ndssdev = list_first_entry(&panel_list, struct omap_dss_device,\r\npanel_list);\r\nomap_dss_get_device(dssdev);\r\ngoto out;\r\n}\r\nomap_dss_put_device(from);\r\nlist_for_each(l, &panel_list) {\r\ndssdev = list_entry(l, struct omap_dss_device, panel_list);\r\nif (dssdev == from) {\r\nif (list_is_last(l, &panel_list)) {\r\ndssdev = NULL;\r\ngoto out;\r\n}\r\ndssdev = list_entry(l->next, struct omap_dss_device,\r\npanel_list);\r\nomap_dss_get_device(dssdev);\r\ngoto out;\r\n}\r\n}\r\nWARN(1, "'from' dssdev not found\n");\r\ndssdev = NULL;\r\nout:\r\nmutex_unlock(&panel_list_mutex);\r\nreturn dssdev;\r\n}\r\nstruct omap_dss_device *omap_dss_find_device(void *data,\r\nint (*match)(struct omap_dss_device *dssdev, void *data))\r\n{\r\nstruct omap_dss_device *dssdev = NULL;\r\nwhile ((dssdev = omap_dss_get_next_device(dssdev)) != NULL) {\r\nif (match(dssdev, data))\r\nreturn dssdev;\r\n}\r\nreturn NULL;\r\n}
