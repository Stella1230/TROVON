void ia_css_isys_dma_channel_rmgr_init(void)\r\n{\r\nmemset(&isys_dma_rsrc, 0, sizeof(isys_dma_rsrc_t));\r\n}\r\nvoid ia_css_isys_dma_channel_rmgr_uninit(void)\r\n{\r\nmemset(&isys_dma_rsrc, 0, sizeof(isys_dma_rsrc_t));\r\n}\r\nbool ia_css_isys_dma_channel_rmgr_acquire(\r\nisys2401_dma_ID_t dma_id,\r\nisys2401_dma_channel *channel)\r\n{\r\nbool retval = false;\r\nisys2401_dma_channel i;\r\nisys2401_dma_channel max_dma_channel;\r\nisys_dma_rsrc_t *cur_rsrc = NULL;\r\nassert(dma_id < N_ISYS2401_DMA_ID);\r\nassert(channel != NULL);\r\nmax_dma_channel = N_ISYS2401_DMA_CHANNEL_PROCS[dma_id];\r\ncur_rsrc = &isys_dma_rsrc[dma_id];\r\nif (cur_rsrc->num_active < max_dma_channel) {\r\nfor (i = ISYS2401_DMA_CHANNEL_0; i < N_ISYS2401_DMA_CHANNEL; i++) {\r\nif (bitop_getbit(cur_rsrc->active_table, i) == 0) {\r\nbitop_setbit(cur_rsrc->active_table, i);\r\n*channel = i;\r\ncur_rsrc->num_active++;\r\nretval = true;\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn retval;\r\n}\r\nvoid ia_css_isys_dma_channel_rmgr_release(\r\nisys2401_dma_ID_t dma_id,\r\nisys2401_dma_channel *channel)\r\n{\r\nisys2401_dma_channel max_dma_channel;\r\nisys_dma_rsrc_t *cur_rsrc = NULL;\r\nassert(dma_id < N_ISYS2401_DMA_ID);\r\nassert(channel != NULL);\r\nmax_dma_channel = N_ISYS2401_DMA_CHANNEL_PROCS[dma_id];\r\ncur_rsrc = &isys_dma_rsrc[dma_id];\r\nif ((*channel < max_dma_channel) && (cur_rsrc->num_active > 0)) {\r\nif (bitop_getbit(cur_rsrc->active_table, *channel) == 1) {\r\nbitop_clearbit(cur_rsrc->active_table, *channel);\r\ncur_rsrc->num_active--;\r\n}\r\n}\r\n}
