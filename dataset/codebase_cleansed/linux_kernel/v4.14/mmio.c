static inline struct clocksource_mmio *to_mmio_clksrc(struct clocksource *c)\r\n{\r\nreturn container_of(c, struct clocksource_mmio, clksrc);\r\n}\r\nu64 clocksource_mmio_readl_up(struct clocksource *c)\r\n{\r\nreturn (u64)readl_relaxed(to_mmio_clksrc(c)->reg);\r\n}\r\nu64 clocksource_mmio_readl_down(struct clocksource *c)\r\n{\r\nreturn ~(u64)readl_relaxed(to_mmio_clksrc(c)->reg) & c->mask;\r\n}\r\nu64 clocksource_mmio_readw_up(struct clocksource *c)\r\n{\r\nreturn (u64)readw_relaxed(to_mmio_clksrc(c)->reg);\r\n}\r\nu64 clocksource_mmio_readw_down(struct clocksource *c)\r\n{\r\nreturn ~(u64)readw_relaxed(to_mmio_clksrc(c)->reg) & c->mask;\r\n}\r\nint __init clocksource_mmio_init(void __iomem *base, const char *name,\r\nunsigned long hz, int rating, unsigned bits,\r\nu64 (*read)(struct clocksource *))\r\n{\r\nstruct clocksource_mmio *cs;\r\nif (bits > 64 || bits < 16)\r\nreturn -EINVAL;\r\ncs = kzalloc(sizeof(struct clocksource_mmio), GFP_KERNEL);\r\nif (!cs)\r\nreturn -ENOMEM;\r\ncs->reg = base;\r\ncs->clksrc.name = name;\r\ncs->clksrc.rating = rating;\r\ncs->clksrc.read = read;\r\ncs->clksrc.mask = CLOCKSOURCE_MASK(bits);\r\ncs->clksrc.flags = CLOCK_SOURCE_IS_CONTINUOUS;\r\nreturn clocksource_register_hz(&cs->clksrc, hz);\r\n}
