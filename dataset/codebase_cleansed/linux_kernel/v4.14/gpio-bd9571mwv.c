static int bd9571mwv_gpio_get_direction(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nstruct bd9571mwv_gpio *gpio = gpiochip_get_data(chip);\r\nint ret, val;\r\nret = regmap_read(gpio->bd->regmap, BD9571MWV_GPIO_DIR, &val);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn val & BIT(offset);\r\n}\r\nstatic int bd9571mwv_gpio_direction_input(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nstruct bd9571mwv_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->bd->regmap, BD9571MWV_GPIO_DIR,\r\nBIT(offset), 0);\r\nreturn 0;\r\n}\r\nstatic int bd9571mwv_gpio_direction_output(struct gpio_chip *chip,\r\nunsigned int offset, int value)\r\n{\r\nstruct bd9571mwv_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->bd->regmap, BD9571MWV_GPIO_OUT,\r\nBIT(offset), value ? BIT(offset) : 0);\r\nregmap_update_bits(gpio->bd->regmap, BD9571MWV_GPIO_DIR,\r\nBIT(offset), BIT(offset));\r\nreturn 0;\r\n}\r\nstatic int bd9571mwv_gpio_get(struct gpio_chip *chip, unsigned int offset)\r\n{\r\nstruct bd9571mwv_gpio *gpio = gpiochip_get_data(chip);\r\nint ret, val;\r\nret = regmap_read(gpio->bd->regmap, BD9571MWV_GPIO_IN, &val);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn val & BIT(offset);\r\n}\r\nstatic void bd9571mwv_gpio_set(struct gpio_chip *chip, unsigned int offset,\r\nint value)\r\n{\r\nstruct bd9571mwv_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->bd->regmap, BD9571MWV_GPIO_OUT,\r\nBIT(offset), value ? BIT(offset) : 0);\r\n}\r\nstatic int bd9571mwv_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct bd9571mwv_gpio *gpio;\r\nint ret;\r\ngpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(pdev, gpio);\r\ngpio->bd = dev_get_drvdata(pdev->dev.parent);\r\ngpio->chip = template_chip;\r\ngpio->chip.parent = gpio->bd->dev;\r\nret = devm_gpiochip_add_data(&pdev->dev, &gpio->chip, gpio);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Could not register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
