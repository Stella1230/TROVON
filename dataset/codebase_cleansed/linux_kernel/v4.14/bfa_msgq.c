static void\r\ncmdq_sm_stopped_entry(struct bfa_msgq_cmdq *cmdq)\r\n{\r\nstruct bfa_msgq_cmd_entry *cmdq_ent;\r\ncmdq->producer_index = 0;\r\ncmdq->consumer_index = 0;\r\ncmdq->flags = 0;\r\ncmdq->token = 0;\r\ncmdq->offset = 0;\r\ncmdq->bytes_to_copy = 0;\r\nwhile (!list_empty(&cmdq->pending_q)) {\r\ncmdq_ent = list_first_entry(&cmdq->pending_q,\r\nstruct bfa_msgq_cmd_entry, qe);\r\nlist_del(&cmdq_ent->qe);\r\ncall_cmdq_ent_cbfn(cmdq_ent, BFA_STATUS_FAILED);\r\n}\r\n}\r\nstatic void\r\ncmdq_sm_stopped(struct bfa_msgq_cmdq *cmdq, enum cmdq_event event)\r\n{\r\nswitch (event) {\r\ncase CMDQ_E_START:\r\nbfa_fsm_set_state(cmdq, cmdq_sm_init_wait);\r\nbreak;\r\ncase CMDQ_E_STOP:\r\ncase CMDQ_E_FAIL:\r\nbreak;\r\ncase CMDQ_E_POST:\r\ncmdq->flags |= BFA_MSGQ_CMDQ_F_DB_UPDATE;\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\ncmdq_sm_init_wait_entry(struct bfa_msgq_cmdq *cmdq)\r\n{\r\nbfa_wc_down(&cmdq->msgq->init_wc);\r\n}\r\nstatic void\r\ncmdq_sm_init_wait(struct bfa_msgq_cmdq *cmdq, enum cmdq_event event)\r\n{\r\nswitch (event) {\r\ncase CMDQ_E_STOP:\r\ncase CMDQ_E_FAIL:\r\nbfa_fsm_set_state(cmdq, cmdq_sm_stopped);\r\nbreak;\r\ncase CMDQ_E_POST:\r\ncmdq->flags |= BFA_MSGQ_CMDQ_F_DB_UPDATE;\r\nbreak;\r\ncase CMDQ_E_INIT_RESP:\r\nif (cmdq->flags & BFA_MSGQ_CMDQ_F_DB_UPDATE) {\r\ncmdq->flags &= ~BFA_MSGQ_CMDQ_F_DB_UPDATE;\r\nbfa_fsm_set_state(cmdq, cmdq_sm_dbell_wait);\r\n} else\r\nbfa_fsm_set_state(cmdq, cmdq_sm_ready);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\ncmdq_sm_ready_entry(struct bfa_msgq_cmdq *cmdq)\r\n{\r\n}\r\nstatic void\r\ncmdq_sm_ready(struct bfa_msgq_cmdq *cmdq, enum cmdq_event event)\r\n{\r\nswitch (event) {\r\ncase CMDQ_E_STOP:\r\ncase CMDQ_E_FAIL:\r\nbfa_fsm_set_state(cmdq, cmdq_sm_stopped);\r\nbreak;\r\ncase CMDQ_E_POST:\r\nbfa_fsm_set_state(cmdq, cmdq_sm_dbell_wait);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\ncmdq_sm_dbell_wait_entry(struct bfa_msgq_cmdq *cmdq)\r\n{\r\nbfa_msgq_cmdq_dbell(cmdq);\r\n}\r\nstatic void\r\ncmdq_sm_dbell_wait(struct bfa_msgq_cmdq *cmdq, enum cmdq_event event)\r\n{\r\nswitch (event) {\r\ncase CMDQ_E_STOP:\r\ncase CMDQ_E_FAIL:\r\nbfa_fsm_set_state(cmdq, cmdq_sm_stopped);\r\nbreak;\r\ncase CMDQ_E_POST:\r\ncmdq->flags |= BFA_MSGQ_CMDQ_F_DB_UPDATE;\r\nbreak;\r\ncase CMDQ_E_DB_READY:\r\nif (cmdq->flags & BFA_MSGQ_CMDQ_F_DB_UPDATE) {\r\ncmdq->flags &= ~BFA_MSGQ_CMDQ_F_DB_UPDATE;\r\nbfa_fsm_set_state(cmdq, cmdq_sm_dbell_wait);\r\n} else\r\nbfa_fsm_set_state(cmdq, cmdq_sm_ready);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_dbell_ready(void *arg)\r\n{\r\nstruct bfa_msgq_cmdq *cmdq = (struct bfa_msgq_cmdq *)arg;\r\nbfa_fsm_send_event(cmdq, CMDQ_E_DB_READY);\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_dbell(struct bfa_msgq_cmdq *cmdq)\r\n{\r\nstruct bfi_msgq_h2i_db *dbell =\r\n(struct bfi_msgq_h2i_db *)(&cmdq->dbell_mb.msg[0]);\r\nmemset(dbell, 0, sizeof(struct bfi_msgq_h2i_db));\r\nbfi_h2i_set(dbell->mh, BFI_MC_MSGQ, BFI_MSGQ_H2I_DOORBELL_PI, 0);\r\ndbell->mh.mtag.i2htok = 0;\r\ndbell->idx.cmdq_pi = htons(cmdq->producer_index);\r\nif (!bfa_nw_ioc_mbox_queue(cmdq->msgq->ioc, &cmdq->dbell_mb,\r\nbfa_msgq_cmdq_dbell_ready, cmdq)) {\r\nbfa_msgq_cmdq_dbell_ready(cmdq);\r\n}\r\n}\r\nstatic void\r\n__cmd_copy(struct bfa_msgq_cmdq *cmdq, struct bfa_msgq_cmd_entry *cmd)\r\n{\r\nsize_t len = cmd->msg_size;\r\nint num_entries = 0;\r\nsize_t to_copy;\r\nu8 *src, *dst;\r\nsrc = (u8 *)cmd->msg_hdr;\r\ndst = (u8 *)cmdq->addr.kva;\r\ndst += (cmdq->producer_index * BFI_MSGQ_CMD_ENTRY_SIZE);\r\nwhile (len) {\r\nto_copy = (len < BFI_MSGQ_CMD_ENTRY_SIZE) ?\r\nlen : BFI_MSGQ_CMD_ENTRY_SIZE;\r\nmemcpy(dst, src, to_copy);\r\nlen -= to_copy;\r\nsrc += BFI_MSGQ_CMD_ENTRY_SIZE;\r\nBFA_MSGQ_INDX_ADD(cmdq->producer_index, 1, cmdq->depth);\r\ndst = (u8 *)cmdq->addr.kva;\r\ndst += (cmdq->producer_index * BFI_MSGQ_CMD_ENTRY_SIZE);\r\nnum_entries++;\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_ci_update(struct bfa_msgq_cmdq *cmdq, struct bfi_mbmsg *mb)\r\n{\r\nstruct bfi_msgq_i2h_db *dbell = (struct bfi_msgq_i2h_db *)mb;\r\nstruct bfa_msgq_cmd_entry *cmd;\r\nint posted = 0;\r\ncmdq->consumer_index = ntohs(dbell->idx.cmdq_ci);\r\nwhile (!list_empty(&cmdq->pending_q)) {\r\ncmd = list_first_entry(&cmdq->pending_q,\r\nstruct bfa_msgq_cmd_entry, qe);\r\nif (ntohs(cmd->msg_hdr->num_entries) <=\r\nBFA_MSGQ_FREE_CNT(cmdq)) {\r\nlist_del(&cmd->qe);\r\n__cmd_copy(cmdq, cmd);\r\nposted = 1;\r\ncall_cmdq_ent_cbfn(cmd, BFA_STATUS_OK);\r\n} else {\r\nbreak;\r\n}\r\n}\r\nif (posted)\r\nbfa_fsm_send_event(cmdq, CMDQ_E_POST);\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_copy_next(void *arg)\r\n{\r\nstruct bfa_msgq_cmdq *cmdq = (struct bfa_msgq_cmdq *)arg;\r\nif (cmdq->bytes_to_copy)\r\nbfa_msgq_cmdq_copy_rsp(cmdq);\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_copy_req(struct bfa_msgq_cmdq *cmdq, struct bfi_mbmsg *mb)\r\n{\r\nstruct bfi_msgq_i2h_cmdq_copy_req *req =\r\n(struct bfi_msgq_i2h_cmdq_copy_req *)mb;\r\ncmdq->token = 0;\r\ncmdq->offset = ntohs(req->offset);\r\ncmdq->bytes_to_copy = ntohs(req->len);\r\nbfa_msgq_cmdq_copy_rsp(cmdq);\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_copy_rsp(struct bfa_msgq_cmdq *cmdq)\r\n{\r\nstruct bfi_msgq_h2i_cmdq_copy_rsp *rsp =\r\n(struct bfi_msgq_h2i_cmdq_copy_rsp *)&cmdq->copy_mb.msg[0];\r\nint copied;\r\nu8 *addr = (u8 *)cmdq->addr.kva;\r\nmemset(rsp, 0, sizeof(struct bfi_msgq_h2i_cmdq_copy_rsp));\r\nbfi_h2i_set(rsp->mh, BFI_MC_MSGQ, BFI_MSGQ_H2I_CMDQ_COPY_RSP, 0);\r\nrsp->mh.mtag.i2htok = htons(cmdq->token);\r\ncopied = (cmdq->bytes_to_copy >= BFI_CMD_COPY_SZ) ? BFI_CMD_COPY_SZ :\r\ncmdq->bytes_to_copy;\r\naddr += cmdq->offset;\r\nmemcpy(rsp->data, addr, copied);\r\ncmdq->token++;\r\ncmdq->offset += copied;\r\ncmdq->bytes_to_copy -= copied;\r\nif (!bfa_nw_ioc_mbox_queue(cmdq->msgq->ioc, &cmdq->copy_mb,\r\nbfa_msgq_cmdq_copy_next, cmdq)) {\r\nbfa_msgq_cmdq_copy_next(cmdq);\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_cmdq_attach(struct bfa_msgq_cmdq *cmdq, struct bfa_msgq *msgq)\r\n{\r\ncmdq->depth = BFA_MSGQ_CMDQ_NUM_ENTRY;\r\nINIT_LIST_HEAD(&cmdq->pending_q);\r\ncmdq->msgq = msgq;\r\nbfa_fsm_set_state(cmdq, cmdq_sm_stopped);\r\n}\r\nstatic void\r\nrspq_sm_stopped_entry(struct bfa_msgq_rspq *rspq)\r\n{\r\nrspq->producer_index = 0;\r\nrspq->consumer_index = 0;\r\nrspq->flags = 0;\r\n}\r\nstatic void\r\nrspq_sm_stopped(struct bfa_msgq_rspq *rspq, enum rspq_event event)\r\n{\r\nswitch (event) {\r\ncase RSPQ_E_START:\r\nbfa_fsm_set_state(rspq, rspq_sm_init_wait);\r\nbreak;\r\ncase RSPQ_E_STOP:\r\ncase RSPQ_E_FAIL:\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\nrspq_sm_init_wait_entry(struct bfa_msgq_rspq *rspq)\r\n{\r\nbfa_wc_down(&rspq->msgq->init_wc);\r\n}\r\nstatic void\r\nrspq_sm_init_wait(struct bfa_msgq_rspq *rspq, enum rspq_event event)\r\n{\r\nswitch (event) {\r\ncase RSPQ_E_FAIL:\r\ncase RSPQ_E_STOP:\r\nbfa_fsm_set_state(rspq, rspq_sm_stopped);\r\nbreak;\r\ncase RSPQ_E_INIT_RESP:\r\nbfa_fsm_set_state(rspq, rspq_sm_ready);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\nrspq_sm_ready_entry(struct bfa_msgq_rspq *rspq)\r\n{\r\n}\r\nstatic void\r\nrspq_sm_ready(struct bfa_msgq_rspq *rspq, enum rspq_event event)\r\n{\r\nswitch (event) {\r\ncase RSPQ_E_STOP:\r\ncase RSPQ_E_FAIL:\r\nbfa_fsm_set_state(rspq, rspq_sm_stopped);\r\nbreak;\r\ncase RSPQ_E_RESP:\r\nbfa_fsm_set_state(rspq, rspq_sm_dbell_wait);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\nrspq_sm_dbell_wait_entry(struct bfa_msgq_rspq *rspq)\r\n{\r\nif (!bfa_nw_ioc_is_disabled(rspq->msgq->ioc))\r\nbfa_msgq_rspq_dbell(rspq);\r\n}\r\nstatic void\r\nrspq_sm_dbell_wait(struct bfa_msgq_rspq *rspq, enum rspq_event event)\r\n{\r\nswitch (event) {\r\ncase RSPQ_E_STOP:\r\ncase RSPQ_E_FAIL:\r\nbfa_fsm_set_state(rspq, rspq_sm_stopped);\r\nbreak;\r\ncase RSPQ_E_RESP:\r\nrspq->flags |= BFA_MSGQ_RSPQ_F_DB_UPDATE;\r\nbreak;\r\ncase RSPQ_E_DB_READY:\r\nif (rspq->flags & BFA_MSGQ_RSPQ_F_DB_UPDATE) {\r\nrspq->flags &= ~BFA_MSGQ_RSPQ_F_DB_UPDATE;\r\nbfa_fsm_set_state(rspq, rspq_sm_dbell_wait);\r\n} else\r\nbfa_fsm_set_state(rspq, rspq_sm_ready);\r\nbreak;\r\ndefault:\r\nbfa_sm_fault(event);\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_rspq_dbell_ready(void *arg)\r\n{\r\nstruct bfa_msgq_rspq *rspq = (struct bfa_msgq_rspq *)arg;\r\nbfa_fsm_send_event(rspq, RSPQ_E_DB_READY);\r\n}\r\nstatic void\r\nbfa_msgq_rspq_dbell(struct bfa_msgq_rspq *rspq)\r\n{\r\nstruct bfi_msgq_h2i_db *dbell =\r\n(struct bfi_msgq_h2i_db *)(&rspq->dbell_mb.msg[0]);\r\nmemset(dbell, 0, sizeof(struct bfi_msgq_h2i_db));\r\nbfi_h2i_set(dbell->mh, BFI_MC_MSGQ, BFI_MSGQ_H2I_DOORBELL_CI, 0);\r\ndbell->mh.mtag.i2htok = 0;\r\ndbell->idx.rspq_ci = htons(rspq->consumer_index);\r\nif (!bfa_nw_ioc_mbox_queue(rspq->msgq->ioc, &rspq->dbell_mb,\r\nbfa_msgq_rspq_dbell_ready, rspq)) {\r\nbfa_msgq_rspq_dbell_ready(rspq);\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_rspq_pi_update(struct bfa_msgq_rspq *rspq, struct bfi_mbmsg *mb)\r\n{\r\nstruct bfi_msgq_i2h_db *dbell = (struct bfi_msgq_i2h_db *)mb;\r\nstruct bfi_msgq_mhdr *msghdr;\r\nint num_entries;\r\nint mc;\r\nu8 *rspq_qe;\r\nrspq->producer_index = ntohs(dbell->idx.rspq_pi);\r\nwhile (rspq->consumer_index != rspq->producer_index) {\r\nrspq_qe = (u8 *)rspq->addr.kva;\r\nrspq_qe += (rspq->consumer_index * BFI_MSGQ_RSP_ENTRY_SIZE);\r\nmsghdr = (struct bfi_msgq_mhdr *)rspq_qe;\r\nmc = msghdr->msg_class;\r\nnum_entries = ntohs(msghdr->num_entries);\r\nif ((mc >= BFI_MC_MAX) || (rspq->rsphdlr[mc].cbfn == NULL))\r\nbreak;\r\n(rspq->rsphdlr[mc].cbfn)(rspq->rsphdlr[mc].cbarg, msghdr);\r\nBFA_MSGQ_INDX_ADD(rspq->consumer_index, num_entries,\r\nrspq->depth);\r\n}\r\nbfa_fsm_send_event(rspq, RSPQ_E_RESP);\r\n}\r\nstatic void\r\nbfa_msgq_rspq_attach(struct bfa_msgq_rspq *rspq, struct bfa_msgq *msgq)\r\n{\r\nrspq->depth = BFA_MSGQ_RSPQ_NUM_ENTRY;\r\nrspq->msgq = msgq;\r\nbfa_fsm_set_state(rspq, rspq_sm_stopped);\r\n}\r\nstatic void\r\nbfa_msgq_init_rsp(struct bfa_msgq *msgq,\r\nstruct bfi_mbmsg *mb)\r\n{\r\nbfa_fsm_send_event(&msgq->cmdq, CMDQ_E_INIT_RESP);\r\nbfa_fsm_send_event(&msgq->rspq, RSPQ_E_INIT_RESP);\r\n}\r\nstatic void\r\nbfa_msgq_init(void *arg)\r\n{\r\nstruct bfa_msgq *msgq = (struct bfa_msgq *)arg;\r\nstruct bfi_msgq_cfg_req *msgq_cfg =\r\n(struct bfi_msgq_cfg_req *)&msgq->init_mb.msg[0];\r\nmemset(msgq_cfg, 0, sizeof(struct bfi_msgq_cfg_req));\r\nbfi_h2i_set(msgq_cfg->mh, BFI_MC_MSGQ, BFI_MSGQ_H2I_INIT_REQ, 0);\r\nmsgq_cfg->mh.mtag.i2htok = 0;\r\nbfa_dma_be_addr_set(msgq_cfg->cmdq.addr, msgq->cmdq.addr.pa);\r\nmsgq_cfg->cmdq.q_depth = htons(msgq->cmdq.depth);\r\nbfa_dma_be_addr_set(msgq_cfg->rspq.addr, msgq->rspq.addr.pa);\r\nmsgq_cfg->rspq.q_depth = htons(msgq->rspq.depth);\r\nbfa_nw_ioc_mbox_queue(msgq->ioc, &msgq->init_mb, NULL, NULL);\r\n}\r\nstatic void\r\nbfa_msgq_isr(void *cbarg, struct bfi_mbmsg *msg)\r\n{\r\nstruct bfa_msgq *msgq = (struct bfa_msgq *)cbarg;\r\nswitch (msg->mh.msg_id) {\r\ncase BFI_MSGQ_I2H_INIT_RSP:\r\nbfa_msgq_init_rsp(msgq, msg);\r\nbreak;\r\ncase BFI_MSGQ_I2H_DOORBELL_PI:\r\nbfa_msgq_rspq_pi_update(&msgq->rspq, msg);\r\nbreak;\r\ncase BFI_MSGQ_I2H_DOORBELL_CI:\r\nbfa_msgq_cmdq_ci_update(&msgq->cmdq, msg);\r\nbreak;\r\ncase BFI_MSGQ_I2H_CMDQ_COPY_REQ:\r\nbfa_msgq_cmdq_copy_req(&msgq->cmdq, msg);\r\nbreak;\r\ndefault:\r\nBUG_ON(1);\r\n}\r\n}\r\nstatic void\r\nbfa_msgq_notify(void *cbarg, enum bfa_ioc_event event)\r\n{\r\nstruct bfa_msgq *msgq = (struct bfa_msgq *)cbarg;\r\nswitch (event) {\r\ncase BFA_IOC_E_ENABLED:\r\nbfa_wc_init(&msgq->init_wc, bfa_msgq_init, msgq);\r\nbfa_wc_up(&msgq->init_wc);\r\nbfa_fsm_send_event(&msgq->cmdq, CMDQ_E_START);\r\nbfa_wc_up(&msgq->init_wc);\r\nbfa_fsm_send_event(&msgq->rspq, RSPQ_E_START);\r\nbfa_wc_wait(&msgq->init_wc);\r\nbreak;\r\ncase BFA_IOC_E_DISABLED:\r\nbfa_fsm_send_event(&msgq->cmdq, CMDQ_E_STOP);\r\nbfa_fsm_send_event(&msgq->rspq, RSPQ_E_STOP);\r\nbreak;\r\ncase BFA_IOC_E_FAILED:\r\nbfa_fsm_send_event(&msgq->cmdq, CMDQ_E_FAIL);\r\nbfa_fsm_send_event(&msgq->rspq, RSPQ_E_FAIL);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nu32\r\nbfa_msgq_meminfo(void)\r\n{\r\nreturn roundup(BFA_MSGQ_CMDQ_SIZE, BFA_DMA_ALIGN_SZ) +\r\nroundup(BFA_MSGQ_RSPQ_SIZE, BFA_DMA_ALIGN_SZ);\r\n}\r\nvoid\r\nbfa_msgq_memclaim(struct bfa_msgq *msgq, u8 *kva, u64 pa)\r\n{\r\nmsgq->cmdq.addr.kva = kva;\r\nmsgq->cmdq.addr.pa = pa;\r\nkva += roundup(BFA_MSGQ_CMDQ_SIZE, BFA_DMA_ALIGN_SZ);\r\npa += roundup(BFA_MSGQ_CMDQ_SIZE, BFA_DMA_ALIGN_SZ);\r\nmsgq->rspq.addr.kva = kva;\r\nmsgq->rspq.addr.pa = pa;\r\n}\r\nvoid\r\nbfa_msgq_attach(struct bfa_msgq *msgq, struct bfa_ioc *ioc)\r\n{\r\nmsgq->ioc = ioc;\r\nbfa_msgq_cmdq_attach(&msgq->cmdq, msgq);\r\nbfa_msgq_rspq_attach(&msgq->rspq, msgq);\r\nbfa_nw_ioc_mbox_regisr(msgq->ioc, BFI_MC_MSGQ, bfa_msgq_isr, msgq);\r\nbfa_ioc_notify_init(&msgq->ioc_notify, bfa_msgq_notify, msgq);\r\nbfa_nw_ioc_notify_register(msgq->ioc, &msgq->ioc_notify);\r\n}\r\nvoid\r\nbfa_msgq_regisr(struct bfa_msgq *msgq, enum bfi_mclass mc,\r\nbfa_msgq_mcfunc_t cbfn, void *cbarg)\r\n{\r\nmsgq->rspq.rsphdlr[mc].cbfn = cbfn;\r\nmsgq->rspq.rsphdlr[mc].cbarg = cbarg;\r\n}\r\nvoid\r\nbfa_msgq_cmd_post(struct bfa_msgq *msgq, struct bfa_msgq_cmd_entry *cmd)\r\n{\r\nif (ntohs(cmd->msg_hdr->num_entries) <=\r\nBFA_MSGQ_FREE_CNT(&msgq->cmdq)) {\r\n__cmd_copy(&msgq->cmdq, cmd);\r\ncall_cmdq_ent_cbfn(cmd, BFA_STATUS_OK);\r\nbfa_fsm_send_event(&msgq->cmdq, CMDQ_E_POST);\r\n} else {\r\nlist_add_tail(&cmd->qe, &msgq->cmdq.pending_q);\r\n}\r\n}\r\nvoid\r\nbfa_msgq_rsp_copy(struct bfa_msgq *msgq, u8 *buf, size_t buf_len)\r\n{\r\nstruct bfa_msgq_rspq *rspq = &msgq->rspq;\r\nsize_t len = buf_len;\r\nsize_t to_copy;\r\nint ci;\r\nu8 *src, *dst;\r\nci = rspq->consumer_index;\r\nsrc = (u8 *)rspq->addr.kva;\r\nsrc += (ci * BFI_MSGQ_RSP_ENTRY_SIZE);\r\ndst = buf;\r\nwhile (len) {\r\nto_copy = (len < BFI_MSGQ_RSP_ENTRY_SIZE) ?\r\nlen : BFI_MSGQ_RSP_ENTRY_SIZE;\r\nmemcpy(dst, src, to_copy);\r\nlen -= to_copy;\r\ndst += BFI_MSGQ_RSP_ENTRY_SIZE;\r\nBFA_MSGQ_INDX_ADD(ci, 1, rspq->depth);\r\nsrc = (u8 *)rspq->addr.kva;\r\nsrc += (ci * BFI_MSGQ_RSP_ENTRY_SIZE);\r\n}\r\n}
