enum emulation_result kvm_mips_emul_hypcall(struct kvm_vcpu *vcpu,\r\nunion mips_instruction inst)\r\n{\r\nunsigned int code = (inst.co_format.code >> 5) & 0x3ff;\r\nkvm_debug("[%#lx] HYPCALL %#03x\n", vcpu->arch.pc, code);\r\nswitch (code) {\r\ncase 0:\r\nreturn EMULATE_HYPERCALL;\r\ndefault:\r\nreturn EMULATE_FAIL;\r\n};\r\n}\r\nstatic int kvm_mips_hypercall(struct kvm_vcpu *vcpu, unsigned long num,\r\nconst unsigned long *args, unsigned long *hret)\r\n{\r\n*hret = -KVM_ENOSYS;\r\nreturn RESUME_GUEST;\r\n}\r\nint kvm_mips_handle_hypcall(struct kvm_vcpu *vcpu)\r\n{\r\nunsigned long num, args[MAX_HYPCALL_ARGS];\r\nnum = vcpu->arch.gprs[2];\r\nargs[0] = vcpu->arch.gprs[4];\r\nargs[1] = vcpu->arch.gprs[5];\r\nargs[2] = vcpu->arch.gprs[6];\r\nargs[3] = vcpu->arch.gprs[7];\r\nreturn kvm_mips_hypercall(vcpu, num,\r\nargs, &vcpu->arch.gprs[2] );\r\n}
