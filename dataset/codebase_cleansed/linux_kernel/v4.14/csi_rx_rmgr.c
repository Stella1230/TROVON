void ia_css_isys_csi_rx_lut_rmgr_init(void)\r\n{\r\nmemset(isys_csi_rx_rsrc, 0, sizeof(isys_csi_rx_rsrc));\r\n}\r\nvoid ia_css_isys_csi_rx_lut_rmgr_uninit(void)\r\n{\r\nmemset(isys_csi_rx_rsrc, 0, sizeof(isys_csi_rx_rsrc));\r\n}\r\nbool ia_css_isys_csi_rx_lut_rmgr_acquire(\r\ncsi_rx_backend_ID_t backend,\r\ncsi_mipi_packet_type_t packet_type,\r\ncsi_rx_backend_lut_entry_t *entry)\r\n{\r\nbool retval = false;\r\nuint32_t max_num_packets_of_type;\r\nuint32_t num_active_of_type;\r\nisys_csi_rx_rsrc_t *cur_rsrc = NULL;\r\nuint16_t i;\r\nassert(backend < N_CSI_RX_BACKEND_ID);\r\nassert((packet_type == CSI_MIPI_PACKET_TYPE_LONG) || (packet_type == CSI_MIPI_PACKET_TYPE_SHORT));\r\nassert(entry != NULL);\r\nif ((backend < N_CSI_RX_BACKEND_ID) && (entry != NULL)) {\r\ncur_rsrc = &isys_csi_rx_rsrc[backend];\r\nif (packet_type == CSI_MIPI_PACKET_TYPE_LONG) {\r\nmax_num_packets_of_type = N_LONG_PACKET_LUT_ENTRIES[backend];\r\nnum_active_of_type = cur_rsrc->num_long_packets;\r\n} else {\r\nmax_num_packets_of_type = N_SHORT_PACKET_LUT_ENTRIES[backend];\r\nnum_active_of_type = cur_rsrc->num_short_packets;\r\n}\r\nif (num_active_of_type < max_num_packets_of_type) {\r\nfor (i = 0; i < max_num_packets_of_type; i++) {\r\nif (bitop_getbit(cur_rsrc->active_table, i) == 0) {\r\nbitop_setbit(cur_rsrc->active_table, i);\r\nif (packet_type == CSI_MIPI_PACKET_TYPE_LONG) {\r\nentry->long_packet_entry = i;\r\nentry->short_packet_entry = 0;\r\ncur_rsrc->num_long_packets++;\r\n} else {\r\nentry->long_packet_entry = 0;\r\nentry->short_packet_entry = i;\r\ncur_rsrc->num_short_packets++;\r\n}\r\ncur_rsrc->num_active++;\r\nretval = true;\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\nreturn retval;\r\n}\r\nvoid ia_css_isys_csi_rx_lut_rmgr_release(\r\ncsi_rx_backend_ID_t backend,\r\ncsi_mipi_packet_type_t packet_type,\r\ncsi_rx_backend_lut_entry_t *entry)\r\n{\r\nuint32_t max_num_packets;\r\nisys_csi_rx_rsrc_t *cur_rsrc = NULL;\r\nuint32_t packet_entry = 0;\r\nassert(backend < N_CSI_RX_BACKEND_ID);\r\nassert(entry != NULL);\r\nassert((packet_type >= CSI_MIPI_PACKET_TYPE_LONG) || (packet_type <= CSI_MIPI_PACKET_TYPE_SHORT));\r\nif ((backend < N_CSI_RX_BACKEND_ID) && (entry != NULL)) {\r\nif (packet_type == CSI_MIPI_PACKET_TYPE_LONG) {\r\nmax_num_packets = N_LONG_PACKET_LUT_ENTRIES[backend];\r\npacket_entry = entry->long_packet_entry;\r\n} else {\r\nmax_num_packets = N_SHORT_PACKET_LUT_ENTRIES[backend];\r\npacket_entry = entry->short_packet_entry;\r\n}\r\ncur_rsrc = &isys_csi_rx_rsrc[backend];\r\nif ((packet_entry < max_num_packets) && (cur_rsrc->num_active > 0)) {\r\nif (bitop_getbit(cur_rsrc->active_table, packet_entry) == 1) {\r\nbitop_clearbit(cur_rsrc->active_table, packet_entry);\r\nif (packet_type == CSI_MIPI_PACKET_TYPE_LONG)\r\ncur_rsrc->num_long_packets--;\r\nelse\r\ncur_rsrc->num_short_packets--;\r\ncur_rsrc->num_active--;\r\n}\r\n}\r\n}\r\n}\r\nenum ia_css_err ia_css_isys_csi_rx_register_stream(\r\nenum ia_css_csi2_port port,\r\nuint32_t isys_stream_id)\r\n{\r\nenum ia_css_err retval = IA_CSS_ERR_INTERNAL_ERROR;\r\nif ((port < N_INPUT_SYSTEM_CSI_PORT) &&\r\n(isys_stream_id < SH_CSS_MAX_ISYS_CHANNEL_NODES)) {\r\nstruct sh_css_sp_pipeline_io_status *pipe_io_status;\r\npipe_io_status = ia_css_pipeline_get_pipe_io_status();\r\nif (bitop_getbit(pipe_io_status->active[port], isys_stream_id) == 0) {\r\nbitop_setbit(pipe_io_status->active[port], isys_stream_id);\r\npipe_io_status->running[port] = 0;\r\nretval = IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn retval;\r\n}\r\nenum ia_css_err ia_css_isys_csi_rx_unregister_stream(\r\nenum ia_css_csi2_port port,\r\nuint32_t isys_stream_id)\r\n{\r\nenum ia_css_err retval = IA_CSS_ERR_INTERNAL_ERROR;\r\nif ((port < N_INPUT_SYSTEM_CSI_PORT) &&\r\n(isys_stream_id < SH_CSS_MAX_ISYS_CHANNEL_NODES)) {\r\nstruct sh_css_sp_pipeline_io_status *pipe_io_status;\r\npipe_io_status = ia_css_pipeline_get_pipe_io_status();\r\nif (bitop_getbit(pipe_io_status->active[port], isys_stream_id) == 1) {\r\nbitop_clearbit(pipe_io_status->active[port], isys_stream_id);\r\nretval = IA_CSS_SUCCESS;\r\n}\r\n}\r\nreturn retval;\r\n}
