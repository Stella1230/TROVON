static int st_lsm6dsx_spi_read(struct device *dev, u8 addr, int len,\r\nu8 *data)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nstruct st_lsm6dsx_hw *hw = spi_get_drvdata(spi);\r\nint err;\r\nstruct spi_transfer xfers[] = {\r\n{\r\n.tx_buf = hw->tb.tx_buf,\r\n.bits_per_word = 8,\r\n.len = 1,\r\n},\r\n{\r\n.rx_buf = hw->tb.rx_buf,\r\n.bits_per_word = 8,\r\n.len = len,\r\n}\r\n};\r\nhw->tb.tx_buf[0] = addr | SENSORS_SPI_READ;\r\nerr = spi_sync_transfer(spi, xfers, ARRAY_SIZE(xfers));\r\nif (err < 0)\r\nreturn err;\r\nmemcpy(data, hw->tb.rx_buf, len * sizeof(u8));\r\nreturn len;\r\n}\r\nstatic int st_lsm6dsx_spi_write(struct device *dev, u8 addr, int len,\r\nu8 *data)\r\n{\r\nstruct st_lsm6dsx_hw *hw;\r\nstruct spi_device *spi;\r\nif (len >= ST_LSM6DSX_TX_MAX_LENGTH)\r\nreturn -ENOMEM;\r\nspi = to_spi_device(dev);\r\nhw = spi_get_drvdata(spi);\r\nhw->tb.tx_buf[0] = addr;\r\nmemcpy(&hw->tb.tx_buf[1], data, len);\r\nreturn spi_write(spi, hw->tb.tx_buf, len + 1);\r\n}\r\nstatic int st_lsm6dsx_spi_probe(struct spi_device *spi)\r\n{\r\nconst struct spi_device_id *id = spi_get_device_id(spi);\r\nreturn st_lsm6dsx_probe(&spi->dev, spi->irq,\r\n(int)id->driver_data, id->name,\r\n&st_lsm6dsx_transfer_fn);\r\n}
