static bool altr_a10sr_reg_readable(struct device *dev, unsigned int reg)\r\n{\r\nswitch (reg) {\r\ncase ALTR_A10SR_VERSION_READ:\r\ncase ALTR_A10SR_LED_REG:\r\ncase ALTR_A10SR_PBDSW_REG:\r\ncase ALTR_A10SR_PBDSW_IRQ_REG:\r\ncase ALTR_A10SR_PWR_GOOD1_REG:\r\ncase ALTR_A10SR_PWR_GOOD2_REG:\r\ncase ALTR_A10SR_PWR_GOOD3_REG:\r\ncase ALTR_A10SR_FMCAB_REG:\r\ncase ALTR_A10SR_HPS_RST_REG:\r\ncase ALTR_A10SR_USB_QSPI_REG:\r\ncase ALTR_A10SR_SFPA_REG:\r\ncase ALTR_A10SR_SFPB_REG:\r\ncase ALTR_A10SR_I2C_M_REG:\r\ncase ALTR_A10SR_WARM_RST_REG:\r\ncase ALTR_A10SR_WR_KEY_REG:\r\ncase ALTR_A10SR_PMBUS_REG:\r\nreturn true;\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic bool altr_a10sr_reg_writeable(struct device *dev, unsigned int reg)\r\n{\r\nswitch (reg) {\r\ncase ALTR_A10SR_LED_REG:\r\ncase ALTR_A10SR_PBDSW_IRQ_REG:\r\ncase ALTR_A10SR_FMCAB_REG:\r\ncase ALTR_A10SR_HPS_RST_REG:\r\ncase ALTR_A10SR_USB_QSPI_REG:\r\ncase ALTR_A10SR_SFPA_REG:\r\ncase ALTR_A10SR_SFPB_REG:\r\ncase ALTR_A10SR_WARM_RST_REG:\r\ncase ALTR_A10SR_WR_KEY_REG:\r\ncase ALTR_A10SR_PMBUS_REG:\r\nreturn true;\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic bool altr_a10sr_reg_volatile(struct device *dev, unsigned int reg)\r\n{\r\nswitch (reg) {\r\ncase ALTR_A10SR_PBDSW_REG:\r\ncase ALTR_A10SR_PBDSW_IRQ_REG:\r\ncase ALTR_A10SR_PWR_GOOD1_REG:\r\ncase ALTR_A10SR_PWR_GOOD2_REG:\r\ncase ALTR_A10SR_PWR_GOOD3_REG:\r\ncase ALTR_A10SR_HPS_RST_REG:\r\ncase ALTR_A10SR_I2C_M_REG:\r\ncase ALTR_A10SR_WARM_RST_REG:\r\ncase ALTR_A10SR_WR_KEY_REG:\r\ncase ALTR_A10SR_PMBUS_REG:\r\nreturn true;\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic int altr_a10sr_spi_probe(struct spi_device *spi)\r\n{\r\nint ret;\r\nstruct altr_a10sr *a10sr;\r\na10sr = devm_kzalloc(&spi->dev, sizeof(*a10sr),\r\nGFP_KERNEL);\r\nif (!a10sr)\r\nreturn -ENOMEM;\r\nspi->mode = SPI_MODE_3;\r\nspi->bits_per_word = 8;\r\nspi_setup(spi);\r\na10sr->dev = &spi->dev;\r\nspi_set_drvdata(spi, a10sr);\r\na10sr->regmap = devm_regmap_init_spi(spi, &altr_a10sr_regmap_config);\r\nif (IS_ERR(a10sr->regmap)) {\r\nret = PTR_ERR(a10sr->regmap);\r\ndev_err(&spi->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\nret = devm_mfd_add_devices(a10sr->dev, PLATFORM_DEVID_AUTO,\r\naltr_a10sr_subdev_info,\r\nARRAY_SIZE(altr_a10sr_subdev_info),\r\nNULL, 0, NULL);\r\nif (ret)\r\ndev_err(a10sr->dev, "Failed to register sub-devices: %d\n",\r\nret);\r\nreturn ret;\r\n}
