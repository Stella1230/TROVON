static int ufs_intel_disable_lcc(struct ufs_hba *hba)\r\n{\r\nu32 attr = UIC_ARG_MIB(PA_LOCAL_TX_LCC_ENABLE);\r\nu32 lcc_enable = 0;\r\nufshcd_dme_get(hba, attr, &lcc_enable);\r\nif (lcc_enable)\r\nufshcd_dme_set(hba, attr, 0);\r\nreturn 0;\r\n}\r\nstatic int ufs_intel_link_startup_notify(struct ufs_hba *hba,\r\nenum ufs_notify_change_status status)\r\n{\r\nint err = 0;\r\nswitch (status) {\r\ncase PRE_CHANGE:\r\nerr = ufs_intel_disable_lcc(hba);\r\nbreak;\r\ncase POST_CHANGE:\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn err;\r\n}\r\nstatic int ufshcd_pci_suspend(struct device *dev)\r\n{\r\nreturn ufshcd_system_suspend(dev_get_drvdata(dev));\r\n}\r\nstatic int ufshcd_pci_resume(struct device *dev)\r\n{\r\nreturn ufshcd_system_resume(dev_get_drvdata(dev));\r\n}\r\nstatic int ufshcd_pci_runtime_suspend(struct device *dev)\r\n{\r\nreturn ufshcd_runtime_suspend(dev_get_drvdata(dev));\r\n}\r\nstatic int ufshcd_pci_runtime_resume(struct device *dev)\r\n{\r\nreturn ufshcd_runtime_resume(dev_get_drvdata(dev));\r\n}\r\nstatic int ufshcd_pci_runtime_idle(struct device *dev)\r\n{\r\nreturn ufshcd_runtime_idle(dev_get_drvdata(dev));\r\n}\r\nstatic void ufshcd_pci_shutdown(struct pci_dev *pdev)\r\n{\r\nufshcd_shutdown((struct ufs_hba *)pci_get_drvdata(pdev));\r\n}\r\nstatic void ufshcd_pci_remove(struct pci_dev *pdev)\r\n{\r\nstruct ufs_hba *hba = pci_get_drvdata(pdev);\r\npm_runtime_forbid(&pdev->dev);\r\npm_runtime_get_noresume(&pdev->dev);\r\nufshcd_remove(hba);\r\nufshcd_dealloc_host(hba);\r\n}\r\nstatic int\r\nufshcd_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)\r\n{\r\nstruct ufs_hba *hba;\r\nvoid __iomem *mmio_base;\r\nint err;\r\nerr = pcim_enable_device(pdev);\r\nif (err) {\r\ndev_err(&pdev->dev, "pcim_enable_device failed\n");\r\nreturn err;\r\n}\r\npci_set_master(pdev);\r\nerr = pcim_iomap_regions(pdev, 1 << 0, UFSHCD);\r\nif (err < 0) {\r\ndev_err(&pdev->dev, "request and iomap failed\n");\r\nreturn err;\r\n}\r\nmmio_base = pcim_iomap_table(pdev)[0];\r\nerr = ufshcd_alloc_host(&pdev->dev, &hba);\r\nif (err) {\r\ndev_err(&pdev->dev, "Allocation failed\n");\r\nreturn err;\r\n}\r\nhba->vops = (struct ufs_hba_variant_ops *)id->driver_data;\r\nerr = ufshcd_init(hba, mmio_base, pdev->irq);\r\nif (err) {\r\ndev_err(&pdev->dev, "Initialization failed\n");\r\nufshcd_dealloc_host(hba);\r\nreturn err;\r\n}\r\npci_set_drvdata(pdev, hba);\r\npm_runtime_put_noidle(&pdev->dev);\r\npm_runtime_allow(&pdev->dev);\r\nreturn 0;\r\n}
