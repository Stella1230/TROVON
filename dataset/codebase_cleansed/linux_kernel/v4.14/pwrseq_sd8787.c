static void mmc_pwrseq_sd8787_pre_power_on(struct mmc_host *host)\r\n{\r\nstruct mmc_pwrseq_sd8787 *pwrseq = to_pwrseq_sd8787(host->pwrseq);\r\ngpiod_set_value_cansleep(pwrseq->reset_gpio, 1);\r\nmsleep(300);\r\ngpiod_set_value_cansleep(pwrseq->pwrdn_gpio, 1);\r\n}\r\nstatic void mmc_pwrseq_sd8787_power_off(struct mmc_host *host)\r\n{\r\nstruct mmc_pwrseq_sd8787 *pwrseq = to_pwrseq_sd8787(host->pwrseq);\r\ngpiod_set_value_cansleep(pwrseq->pwrdn_gpio, 0);\r\ngpiod_set_value_cansleep(pwrseq->reset_gpio, 0);\r\n}\r\nstatic int mmc_pwrseq_sd8787_probe(struct platform_device *pdev)\r\n{\r\nstruct mmc_pwrseq_sd8787 *pwrseq;\r\nstruct device *dev = &pdev->dev;\r\npwrseq = devm_kzalloc(dev, sizeof(*pwrseq), GFP_KERNEL);\r\nif (!pwrseq)\r\nreturn -ENOMEM;\r\npwrseq->pwrdn_gpio = devm_gpiod_get(dev, "powerdown", GPIOD_OUT_LOW);\r\nif (IS_ERR(pwrseq->pwrdn_gpio))\r\nreturn PTR_ERR(pwrseq->pwrdn_gpio);\r\npwrseq->reset_gpio = devm_gpiod_get(dev, "reset", GPIOD_OUT_LOW);\r\nif (IS_ERR(pwrseq->reset_gpio))\r\nreturn PTR_ERR(pwrseq->reset_gpio);\r\npwrseq->pwrseq.dev = dev;\r\npwrseq->pwrseq.ops = &mmc_pwrseq_sd8787_ops;\r\npwrseq->pwrseq.owner = THIS_MODULE;\r\nplatform_set_drvdata(pdev, pwrseq);\r\nreturn mmc_pwrseq_register(&pwrseq->pwrseq);\r\n}\r\nstatic int mmc_pwrseq_sd8787_remove(struct platform_device *pdev)\r\n{\r\nstruct mmc_pwrseq_sd8787 *pwrseq = platform_get_drvdata(pdev);\r\nmmc_pwrseq_unregister(&pwrseq->pwrseq);\r\nreturn 0;\r\n}
