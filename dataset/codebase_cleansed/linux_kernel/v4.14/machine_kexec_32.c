void default_machine_kexec(struct kimage *image)\r\n{\r\nextern const unsigned char relocate_new_kernel[];\r\nextern const unsigned int relocate_new_kernel_size;\r\nunsigned long page_list;\r\nunsigned long reboot_code_buffer, reboot_code_buffer_phys;\r\nrelocate_new_kernel_t rnk;\r\nlocal_irq_disable();\r\nmachine_kexec_mask_interrupts();\r\npage_list = image->head;\r\nreboot_code_buffer =\r\n(unsigned long)page_address(image->control_code_page);\r\nreboot_code_buffer_phys = virt_to_phys((void *)reboot_code_buffer);\r\nmemcpy((void *)reboot_code_buffer, relocate_new_kernel,\r\nrelocate_new_kernel_size);\r\nflush_icache_range(reboot_code_buffer,\r\nreboot_code_buffer + KEXEC_CONTROL_PAGE_SIZE);\r\nprintk(KERN_INFO "Bye!\n");\r\nrnk = (relocate_new_kernel_t) reboot_code_buffer;\r\n(*rnk)(page_list, reboot_code_buffer_phys, image->start);\r\n}\r\nint default_machine_kexec_prepare(struct kimage *image)\r\n{\r\nreturn 0;\r\n}
