u32 cm_get_file_size(ACPI_FILE file)\r\n{\r\nlong file_size;\r\nlong current_offset;\r\nacpi_status status;\r\ncurrent_offset = ftell(file);\r\nif (current_offset < 0) {\r\ngoto offset_error;\r\n}\r\nstatus = fseek(file, 0, SEEK_END);\r\nif (ACPI_FAILURE(status)) {\r\ngoto seek_error;\r\n}\r\nfile_size = ftell(file);\r\nif (file_size < 0) {\r\ngoto offset_error;\r\n}\r\nstatus = fseek(file, current_offset, SEEK_SET);\r\nif (ACPI_FAILURE(status)) {\r\ngoto seek_error;\r\n}\r\nreturn ((u32)file_size);\r\noffset_error:\r\nfprintf(stderr, "Could not get file offset\n");\r\nreturn (ACPI_UINT32_MAX);\r\nseek_error:\r\nfprintf(stderr, "Could not set file offset\n");\r\nreturn (ACPI_UINT32_MAX);\r\n}
