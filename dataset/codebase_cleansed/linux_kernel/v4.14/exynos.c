void __init exynos_sysram_init(void)\r\n{\r\nstruct device_node *node;\r\nfor_each_compatible_node(node, NULL, "samsung,exynos4210-sysram") {\r\nif (!of_device_is_available(node))\r\ncontinue;\r\nsysram_base_addr = of_iomap(node, 0);\r\nbreak;\r\n}\r\nfor_each_compatible_node(node, NULL, "samsung,exynos4210-sysram-ns") {\r\nif (!of_device_is_available(node))\r\ncontinue;\r\nsysram_ns_base_addr = of_iomap(node, 0);\r\nbreak;\r\n}\r\n}\r\nstatic void __init exynos_init_late(void)\r\n{\r\nif (of_machine_is_compatible("samsung,exynos5440"))\r\nreturn;\r\nexynos_pm_init();\r\n}\r\nstatic int __init exynos_fdt_map_chipid(unsigned long node, const char *uname,\r\nint depth, void *data)\r\n{\r\nstruct map_desc iodesc;\r\nconst __be32 *reg;\r\nint len;\r\nif (!of_flat_dt_is_compatible(node, "samsung,exynos4210-chipid") &&\r\n!of_flat_dt_is_compatible(node, "samsung,exynos5440-clock"))\r\nreturn 0;\r\nreg = of_get_flat_dt_prop(node, "reg", &len);\r\nif (reg == NULL || len != (sizeof(unsigned long) * 2))\r\nreturn 0;\r\niodesc.pfn = __phys_to_pfn(be32_to_cpu(reg[0]));\r\niodesc.length = be32_to_cpu(reg[1]) - 1;\r\niodesc.virtual = (unsigned long)S5P_VA_CHIPID;\r\niodesc.type = MT_DEVICE;\r\niotable_init(&iodesc, 1);\r\nreturn 1;\r\n}\r\nstatic void __init exynos_map_io(void)\r\n{\r\nif (soc_is_exynos4())\r\niotable_init(exynos4_iodesc, ARRAY_SIZE(exynos4_iodesc));\r\n}\r\nstatic void __init exynos_init_io(void)\r\n{\r\ndebug_ll_io_init();\r\nof_scan_flat_dt(exynos_fdt_map_chipid, NULL);\r\ns5p_init_cpu(S5P_VA_CHIPID);\r\nexynos_map_io();\r\n}\r\nvoid exynos_set_delayed_reset_assertion(bool enable)\r\n{\r\nif (of_machine_is_compatible("samsung,exynos4")) {\r\nunsigned int tmp, core_id;\r\nfor (core_id = 0; core_id < num_possible_cpus(); core_id++) {\r\ntmp = pmu_raw_readl(EXYNOS_ARM_CORE_OPTION(core_id));\r\nif (enable)\r\ntmp |= S5P_USE_DELAYED_RESET_ASSERTION;\r\nelse\r\ntmp &= ~(S5P_USE_DELAYED_RESET_ASSERTION);\r\npmu_raw_writel(tmp, EXYNOS_ARM_CORE_OPTION(core_id));\r\n}\r\n}\r\n}\r\nstatic void exynos_map_pmu(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_matching_node(NULL, exynos_dt_pmu_match);\r\nif (np)\r\npmu_base_addr = of_iomap(np, 0);\r\n}\r\nstatic void __init exynos_init_irq(void)\r\n{\r\nirqchip_init();\r\nexynos_map_pmu();\r\n}\r\nstatic void __init exynos_dt_machine_init(void)\r\n{\r\nif (!IS_ENABLED(CONFIG_SMP))\r\nexynos_sysram_init();\r\n#if defined(CONFIG_SMP) && defined(CONFIG_ARM_EXYNOS_CPUIDLE)\r\nif (of_machine_is_compatible("samsung,exynos4210") ||\r\nof_machine_is_compatible("samsung,exynos3250"))\r\nexynos_cpuidle.dev.platform_data = &cpuidle_coupled_exynos_data;\r\n#endif\r\nif (of_machine_is_compatible("samsung,exynos4210") ||\r\nof_machine_is_compatible("samsung,exynos4212") ||\r\n(of_machine_is_compatible("samsung,exynos4412") &&\r\nof_machine_is_compatible("samsung,trats2")) ||\r\nof_machine_is_compatible("samsung,exynos3250") ||\r\nof_machine_is_compatible("samsung,exynos5250"))\r\nplatform_device_register(&exynos_cpuidle);\r\n}\r\nstatic void __init exynos_dt_fixup(void)\r\n{\r\nof_fdt_limit_memory(8);\r\n}
