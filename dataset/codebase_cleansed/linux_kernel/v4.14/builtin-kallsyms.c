static int __cmd_kallsyms(int argc, const char **argv)\r\n{\r\nint i;\r\nstruct machine *machine = machine__new_kallsyms();\r\nif (machine == NULL) {\r\npr_err("Couldn't read /proc/kallsyms\n");\r\nreturn -1;\r\n}\r\nfor (i = 0; i < argc; ++i) {\r\nstruct map *map;\r\nstruct symbol *symbol = machine__find_kernel_function_by_name(machine, argv[i], &map);\r\nif (symbol == NULL) {\r\nprintf("%s: not found\n", argv[i]);\r\ncontinue;\r\n}\r\nprintf("%s: %s %s %#" PRIx64 "-%#" PRIx64 " (%#" PRIx64 "-%#" PRIx64")\n",\r\nsymbol->name, map->dso->short_name, map->dso->long_name,\r\nmap->unmap_ip(map, symbol->start), map->unmap_ip(map, symbol->end),\r\nsymbol->start, symbol->end);\r\n}\r\nmachine__delete(machine);\r\nreturn 0;\r\n}\r\nint cmd_kallsyms(int argc, const char **argv)\r\n{\r\nconst struct option options[] = {\r\nOPT_INCR('v', "verbose", &verbose, "be more verbose (show counter open errors, etc)"),\r\nOPT_END()\r\n};\r\nconst char * const kallsyms_usage[] = {\r\n"perf kallsyms [<options>] symbol_name",\r\nNULL\r\n};\r\nargc = parse_options(argc, argv, options, kallsyms_usage, 0);\r\nif (argc < 1)\r\nusage_with_options(kallsyms_usage, options);\r\nsymbol_conf.sort_by_name = true;\r\nsymbol_conf.try_vmlinux_path = (symbol_conf.vmlinux_name == NULL);\r\nif (symbol__init(NULL) < 0)\r\nreturn -1;\r\nreturn __cmd_kallsyms(argc, argv);\r\n}
