acpi_status\r\nacpi_ns_search_one_scope(u32 target_name,\r\nstruct acpi_namespace_node *parent_node,\r\nacpi_object_type type,\r\nstruct acpi_namespace_node **return_node)\r\n{\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(ns_search_one_scope);\r\n#ifdef ACPI_DEBUG_OUTPUT\r\nif (ACPI_LV_NAMES & acpi_dbg_level) {\r\nchar *scope_name;\r\nscope_name = acpi_ns_get_normalized_pathname(parent_node, TRUE);\r\nif (scope_name) {\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"Searching %s (%p) For [%4.4s] (%s)\n",\r\nscope_name, parent_node,\r\nACPI_CAST_PTR(char, &target_name),\r\nacpi_ut_get_type_name(type)));\r\nACPI_FREE(scope_name);\r\n}\r\n}\r\n#endif\r\nnode = parent_node->child;\r\nwhile (node) {\r\nif (node->name.integer == target_name) {\r\nif (acpi_ns_get_type(node) ==\r\nACPI_TYPE_LOCAL_METHOD_ALIAS) {\r\nnode =\r\nACPI_CAST_PTR(struct acpi_namespace_node,\r\nnode->object);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"Name [%4.4s] (%s) %p found in scope [%4.4s] %p\n",\r\nACPI_CAST_PTR(char, &target_name),\r\nacpi_ut_get_type_name(node->type),\r\nnode,\r\nacpi_ut_get_node_name(parent_node),\r\nparent_node));\r\n*return_node = node;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nnode = node->peer;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"Name [%4.4s] (%s) not found in search in scope [%4.4s] "\r\n"%p first child %p\n",\r\nACPI_CAST_PTR(char, &target_name),\r\nacpi_ut_get_type_name(type),\r\nacpi_ut_get_node_name(parent_node), parent_node,\r\nparent_node->child));\r\nreturn_ACPI_STATUS(AE_NOT_FOUND);\r\n}\r\nstatic acpi_status\r\nacpi_ns_search_parent_tree(u32 target_name,\r\nstruct acpi_namespace_node *node,\r\nacpi_object_type type,\r\nstruct acpi_namespace_node **return_node)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *parent_node;\r\nACPI_FUNCTION_TRACE(ns_search_parent_tree);\r\nparent_node = node->parent;\r\nif (!parent_node) {\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES, "[%4.4s] has no parent\n",\r\nACPI_CAST_PTR(char, &target_name)));\r\nreturn_ACPI_STATUS(AE_NOT_FOUND);\r\n}\r\nif (acpi_ns_local(type)) {\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"[%4.4s] type [%s] must be local to this scope (no parent search)\n",\r\nACPI_CAST_PTR(char, &target_name),\r\nacpi_ut_get_type_name(type)));\r\nreturn_ACPI_STATUS(AE_NOT_FOUND);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"Searching parent [%4.4s] for [%4.4s]\n",\r\nacpi_ut_get_node_name(parent_node),\r\nACPI_CAST_PTR(char, &target_name)));\r\nwhile (parent_node) {\r\nstatus =\r\nacpi_ns_search_one_scope(target_name, parent_node,\r\nACPI_TYPE_ANY, return_node);\r\nif (ACPI_SUCCESS(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nparent_node = parent_node->parent;\r\n}\r\nreturn_ACPI_STATUS(AE_NOT_FOUND);\r\n}\r\nacpi_status\r\nacpi_ns_search_and_enter(u32 target_name,\r\nstruct acpi_walk_state *walk_state,\r\nstruct acpi_namespace_node *node,\r\nacpi_interpreter_mode interpreter_mode,\r\nacpi_object_type type,\r\nu32 flags, struct acpi_namespace_node **return_node)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *new_node;\r\nACPI_FUNCTION_TRACE(ns_search_and_enter);\r\nif (!node || !target_name || !return_node) {\r\nACPI_ERROR((AE_INFO,\r\n"Null parameter: Node %p Name 0x%X ReturnNode %p",\r\nnode, target_name, return_node));\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nacpi_ut_repair_name(ACPI_CAST_PTR(char, &target_name));\r\n*return_node = ACPI_ENTRY_NOT_FOUND;\r\nstatus = acpi_ns_search_one_scope(target_name, node, type, return_node);\r\nif (status != AE_NOT_FOUND) {\r\nif (status == AE_OK) {\r\nif (flags & ACPI_NS_OVERRIDE_IF_FOUND) {\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"Namespace override: %4.4s pass %u type %X Owner %X\n",\r\nACPI_CAST_PTR(char,\r\n&target_name),\r\ninterpreter_mode,\r\n(*return_node)->type,\r\nwalk_state->owner_id));\r\nacpi_ns_delete_children(*return_node);\r\nif (acpi_gbl_runtime_namespace_override) {\r\nacpi_ut_remove_reference((*return_node)->object);\r\n(*return_node)->object = NULL;\r\n(*return_node)->owner_id =\r\nwalk_state->owner_id;\r\n} else {\r\nacpi_ns_remove_node(*return_node);\r\n*return_node = ACPI_ENTRY_NOT_FOUND;\r\n}\r\n}\r\nelse if (flags & ACPI_NS_ERROR_IF_FOUND) {\r\nstatus = AE_ALREADY_EXISTS;\r\n}\r\n}\r\n#ifdef ACPI_ASL_COMPILER\r\nif (*return_node && (*return_node)->type == ACPI_TYPE_ANY) {\r\n(*return_node)->flags |= ANOBJ_IS_EXTERNAL;\r\n}\r\n#endif\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif ((interpreter_mode != ACPI_IMODE_LOAD_PASS1) &&\r\n(flags & ACPI_NS_SEARCH_PARENT)) {\r\nstatus =\r\nacpi_ns_search_parent_tree(target_name, node, type,\r\nreturn_node);\r\nif (ACPI_SUCCESS(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\n}\r\nif (interpreter_mode == ACPI_IMODE_EXECUTE) {\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"%4.4s Not found in %p [Not adding]\n",\r\nACPI_CAST_PTR(char, &target_name), node));\r\nreturn_ACPI_STATUS(AE_NOT_FOUND);\r\n}\r\nnew_node = acpi_ns_create_node(target_name);\r\nif (!new_node) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\n#ifdef ACPI_ASL_COMPILER\r\nif (flags & ACPI_NS_EXTERNAL ||\r\n(walk_state && walk_state->opcode == AML_SCOPE_OP)) {\r\nnew_node->flags |= ANOBJ_IS_EXTERNAL;\r\n}\r\n#endif\r\nif (flags & ACPI_NS_TEMPORARY) {\r\nnew_node->flags |= ANOBJ_TEMPORARY;\r\n}\r\nacpi_ns_install_node(walk_state, node, new_node, type);\r\n*return_node = new_node;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}
