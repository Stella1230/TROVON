static u32\r\nprom_read(void *data, u32 offset, u32 length, struct nvkm_bios *bios)\r\n{\r\nstruct nvkm_device *device = data;\r\nu32 i;\r\nif (offset + length <= 0x00100000) {\r\nfor (i = offset; i < offset + length; i += 4)\r\n*(u32 *)&bios->data[i] = nvkm_rd32(device, 0x300000 + i);\r\nreturn length;\r\n}\r\nreturn 0;\r\n}\r\nstatic void\r\nprom_fini(void *data)\r\n{\r\nstruct nvkm_device *device = data;\r\nnvkm_pci_rom_shadow(device->pci, true);\r\n}\r\nstatic void *\r\nprom_init(struct nvkm_bios *bios, const char *name)\r\n{\r\nstruct nvkm_device *device = bios->subdev.device;\r\nif (device->card_type == NV_40 && device->chipset >= 0x4c)\r\nreturn ERR_PTR(-ENODEV);\r\nnvkm_pci_rom_shadow(device->pci, false);\r\nreturn device;\r\n}
