const struct mlxfw_mfa2_tlv *\r\nmlxfw_mfa2_tlv_multi_child(const struct mlxfw_mfa2_file *mfa2_file,\r\nconst struct mlxfw_mfa2_tlv_multi *multi)\r\n{\r\nsize_t multi_len;\r\nmulti_len = NLA_ALIGN(sizeof(struct mlxfw_mfa2_tlv_multi));\r\nreturn mlxfw_mfa2_tlv_get(mfa2_file, (void *) multi + multi_len);\r\n}\r\nconst struct mlxfw_mfa2_tlv *\r\nmlxfw_mfa2_tlv_next(const struct mlxfw_mfa2_file *mfa2_file,\r\nconst struct mlxfw_mfa2_tlv *tlv)\r\n{\r\nconst struct mlxfw_mfa2_tlv_multi *multi;\r\nu16 tlv_len;\r\nvoid *next;\r\ntlv_len = MLXFW_MFA2_TLV_TOTAL_SIZE(tlv);\r\nif (tlv->type == MLXFW_MFA2_TLV_MULTI_PART) {\r\nmulti = mlxfw_mfa2_tlv_multi_get(mfa2_file, tlv);\r\ntlv_len = NLA_ALIGN(tlv_len + be16_to_cpu(multi->total_len));\r\n}\r\nnext = (void *) tlv + tlv_len;\r\nreturn mlxfw_mfa2_tlv_get(mfa2_file, next);\r\n}\r\nconst struct mlxfw_mfa2_tlv *\r\nmlxfw_mfa2_tlv_advance(const struct mlxfw_mfa2_file *mfa2_file,\r\nconst struct mlxfw_mfa2_tlv *from_tlv, u16 count)\r\n{\r\nconst struct mlxfw_mfa2_tlv *tlv;\r\nu16 idx;\r\nmlxfw_mfa2_tlv_foreach(mfa2_file, tlv, idx, from_tlv, count)\r\nif (!tlv)\r\nreturn NULL;\r\nreturn tlv;\r\n}\r\nconst struct mlxfw_mfa2_tlv *\r\nmlxfw_mfa2_tlv_multi_child_find(const struct mlxfw_mfa2_file *mfa2_file,\r\nconst struct mlxfw_mfa2_tlv_multi *multi,\r\nenum mlxfw_mfa2_tlv_type type, u16 index)\r\n{\r\nconst struct mlxfw_mfa2_tlv *tlv;\r\nu16 skip = 0;\r\nu16 idx;\r\nmlxfw_mfa2_tlv_multi_foreach(mfa2_file, tlv, idx, multi) {\r\nif (!tlv) {\r\npr_err("TLV parsing error\n");\r\nreturn NULL;\r\n}\r\nif (tlv->type == type)\r\nif (skip++ == index)\r\nreturn tlv;\r\n}\r\nreturn NULL;\r\n}\r\nint mlxfw_mfa2_tlv_multi_child_count(const struct mlxfw_mfa2_file *mfa2_file,\r\nconst struct mlxfw_mfa2_tlv_multi *multi,\r\nenum mlxfw_mfa2_tlv_type type,\r\nu16 *p_count)\r\n{\r\nconst struct mlxfw_mfa2_tlv *tlv;\r\nu16 count = 0;\r\nu16 idx;\r\nmlxfw_mfa2_tlv_multi_foreach(mfa2_file, tlv, idx, multi) {\r\nif (!tlv) {\r\npr_err("TLV parsing error\n");\r\nreturn -EINVAL;\r\n}\r\nif (tlv->type == type)\r\ncount++;\r\n}\r\n*p_count = count;\r\nreturn 0;\r\n}
