void odm_DynamicBBPowerSavingInit(void *pDM_VOID)\r\n{\r\nPDM_ODM_T pDM_Odm = (PDM_ODM_T)pDM_VOID;\r\npPS_T pDM_PSTable = &pDM_Odm->DM_PSTable;\r\npDM_PSTable->PreCCAState = CCA_MAX;\r\npDM_PSTable->CurCCAState = CCA_MAX;\r\npDM_PSTable->PreRFState = RF_MAX;\r\npDM_PSTable->CurRFState = RF_MAX;\r\npDM_PSTable->Rssi_val_min = 0;\r\npDM_PSTable->initialize = 0;\r\n}\r\nvoid ODM_RF_Saving(void *pDM_VOID, u8 bForceInNormal)\r\n{\r\nPDM_ODM_T pDM_Odm = (PDM_ODM_T)pDM_VOID;\r\npPS_T pDM_PSTable = &pDM_Odm->DM_PSTable;\r\nu8 Rssi_Up_bound = 30;\r\nu8 Rssi_Low_bound = 25;\r\nif (pDM_Odm->PatchID == 40) {\r\nRssi_Up_bound = 50;\r\nRssi_Low_bound = 45;\r\n}\r\nif (pDM_PSTable->initialize == 0) {\r\npDM_PSTable->Reg874 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0x874, bMaskDWord)&0x1CC000)>>14;\r\npDM_PSTable->RegC70 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0xc70, bMaskDWord)&BIT3)>>3;\r\npDM_PSTable->Reg85C = (PHY_QueryBBReg(pDM_Odm->Adapter, 0x85c, bMaskDWord)&0xFF000000)>>24;\r\npDM_PSTable->RegA74 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0xa74, bMaskDWord)&0xF000)>>12;\r\npDM_PSTable->initialize = 1;\r\n}\r\nif (!bForceInNormal) {\r\nif (pDM_Odm->RSSI_Min != 0xFF) {\r\nif (pDM_PSTable->PreRFState == RF_Normal) {\r\nif (pDM_Odm->RSSI_Min >= Rssi_Up_bound)\r\npDM_PSTable->CurRFState = RF_Save;\r\nelse\r\npDM_PSTable->CurRFState = RF_Normal;\r\n} else {\r\nif (pDM_Odm->RSSI_Min <= Rssi_Low_bound)\r\npDM_PSTable->CurRFState = RF_Normal;\r\nelse\r\npDM_PSTable->CurRFState = RF_Save;\r\n}\r\n} else\r\npDM_PSTable->CurRFState = RF_MAX;\r\n} else\r\npDM_PSTable->CurRFState = RF_Normal;\r\nif (pDM_PSTable->PreRFState != pDM_PSTable->CurRFState) {\r\nif (pDM_PSTable->CurRFState == RF_Save) {\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0x1C0000, 0x2);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0xc70, BIT3, 0);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x85c, 0xFF000000, 0x63);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0xC000, 0x2);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0xa74, 0xF000, 0x3);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x0);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x1);\r\n} else {\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0x1CC000, pDM_PSTable->Reg874);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0xc70, BIT3, pDM_PSTable->RegC70);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x85c, 0xFF000000, pDM_PSTable->Reg85C);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0xa74, 0xF000, pDM_PSTable->RegA74);\r\nPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x0);\r\n}\r\npDM_PSTable->PreRFState = pDM_PSTable->CurRFState;\r\n}\r\n}
