u8 rtw_hal_sdio_max_txoqt_free_space(struct adapter *padapter)\r\n{\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\r\nif (pHalData->SdioTxOQTMaxFreeSpace < 8)\r\npHalData->SdioTxOQTMaxFreeSpace = 8;\r\nreturn pHalData->SdioTxOQTMaxFreeSpace;\r\n}\r\nu8 rtw_hal_sdio_query_tx_freepage(\r\nstruct adapter *padapter, u8 PageIdx, u8 RequiredPageNum\r\n)\r\n{\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\r\nif ((pHalData->SdioTxFIFOFreePage[PageIdx]+pHalData->SdioTxFIFOFreePage[PUBLIC_QUEUE_IDX]) >= (RequiredPageNum))\r\nreturn true;\r\nelse\r\nreturn false;\r\n}\r\nvoid rtw_hal_sdio_update_tx_freepage(\r\nstruct adapter *padapter, u8 PageIdx, u8 RequiredPageNum\r\n)\r\n{\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\r\nu8 DedicatedPgNum = 0;\r\nu8 RequiredPublicFreePgNum = 0;\r\nDedicatedPgNum = pHalData->SdioTxFIFOFreePage[PageIdx];\r\nif (RequiredPageNum <= DedicatedPgNum) {\r\npHalData->SdioTxFIFOFreePage[PageIdx] -= RequiredPageNum;\r\n} else {\r\npHalData->SdioTxFIFOFreePage[PageIdx] = 0;\r\nRequiredPublicFreePgNum = RequiredPageNum - DedicatedPgNum;\r\npHalData->SdioTxFIFOFreePage[PUBLIC_QUEUE_IDX] -= RequiredPublicFreePgNum;\r\n}\r\n}\r\nvoid rtw_hal_set_sdio_tx_max_length(\r\nstruct adapter *padapter, u8 numHQ, u8 numNQ, u8 numLQ, u8 numPubQ\r\n)\r\n{\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\r\nu32 page_size;\r\nu32 lenHQ, lenNQ, lenLQ;\r\nrtw_hal_get_def_var(padapter, HAL_DEF_TX_PAGE_SIZE, &page_size);\r\nlenHQ = ((numHQ + numPubQ) >> 1) * page_size;\r\nlenNQ = ((numNQ + numPubQ) >> 1) * page_size;\r\nlenLQ = ((numLQ + numPubQ) >> 1) * page_size;\r\npHalData->sdio_tx_max_len[HI_QUEUE_IDX] =\r\n(lenHQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenHQ;\r\npHalData->sdio_tx_max_len[MID_QUEUE_IDX] =\r\n(lenNQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenNQ;\r\npHalData->sdio_tx_max_len[LOW_QUEUE_IDX] =\r\n(lenLQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenLQ;\r\n}\r\nu32 rtw_hal_get_sdio_tx_max_length(struct adapter *padapter, u8 queue_idx)\r\n{\r\nstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(padapter);\r\nstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\r\nu32 deviceId, max_len;\r\ndeviceId = ffaddr2deviceId(pdvobjpriv, queue_idx);\r\nswitch (deviceId) {\r\ncase WLAN_TX_HIQ_DEVICE_ID:\r\nmax_len = pHalData->sdio_tx_max_len[HI_QUEUE_IDX];\r\nbreak;\r\ncase WLAN_TX_MIQ_DEVICE_ID:\r\nmax_len = pHalData->sdio_tx_max_len[MID_QUEUE_IDX];\r\nbreak;\r\ncase WLAN_TX_LOQ_DEVICE_ID:\r\nmax_len = pHalData->sdio_tx_max_len[LOW_QUEUE_IDX];\r\nbreak;\r\ndefault:\r\nmax_len = pHalData->sdio_tx_max_len[MID_QUEUE_IDX];\r\nbreak;\r\n}\r\nreturn max_len;\r\n}
