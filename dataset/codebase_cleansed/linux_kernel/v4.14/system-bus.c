static int ps3_is_device(struct ps3_system_bus_device *dev, u64 bus_id,\r\nu64 dev_id)\r\n{\r\nreturn dev->bus_id == bus_id && dev->dev_id == dev_id;\r\n}\r\nstatic int ps3_open_hv_device_sb(struct ps3_system_bus_device *dev)\r\n{\r\nint result;\r\nBUG_ON(!dev->bus_id);\r\nmutex_lock(&usage_hack.mutex);\r\nif (ps3_is_device(dev, 1, 1)) {\r\nusage_hack.sb_11++;\r\nif (usage_hack.sb_11 > 1) {\r\nresult = 0;\r\ngoto done;\r\n}\r\n}\r\nif (ps3_is_device(dev, 1, 2)) {\r\nusage_hack.sb_12++;\r\nif (usage_hack.sb_12 > 1) {\r\nresult = 0;\r\ngoto done;\r\n}\r\n}\r\nresult = lv1_open_device(dev->bus_id, dev->dev_id, 0);\r\nif (result) {\r\npr_debug("%s:%d: lv1_open_device failed: %s\n", __func__,\r\n__LINE__, ps3_result(result));\r\nresult = -EPERM;\r\n}\r\ndone:\r\nmutex_unlock(&usage_hack.mutex);\r\nreturn result;\r\n}\r\nstatic int ps3_close_hv_device_sb(struct ps3_system_bus_device *dev)\r\n{\r\nint result;\r\nBUG_ON(!dev->bus_id);\r\nmutex_lock(&usage_hack.mutex);\r\nif (ps3_is_device(dev, 1, 1)) {\r\nusage_hack.sb_11--;\r\nif (usage_hack.sb_11) {\r\nresult = 0;\r\ngoto done;\r\n}\r\n}\r\nif (ps3_is_device(dev, 1, 2)) {\r\nusage_hack.sb_12--;\r\nif (usage_hack.sb_12) {\r\nresult = 0;\r\ngoto done;\r\n}\r\n}\r\nresult = lv1_close_device(dev->bus_id, dev->dev_id);\r\nBUG_ON(result);\r\ndone:\r\nmutex_unlock(&usage_hack.mutex);\r\nreturn result;\r\n}\r\nstatic int ps3_open_hv_device_gpu(struct ps3_system_bus_device *dev)\r\n{\r\nint result;\r\nmutex_lock(&usage_hack.mutex);\r\nusage_hack.gpu++;\r\nif (usage_hack.gpu > 1) {\r\nresult = 0;\r\ngoto done;\r\n}\r\nresult = lv1_gpu_open(0);\r\nif (result) {\r\npr_debug("%s:%d: lv1_gpu_open failed: %s\n", __func__,\r\n__LINE__, ps3_result(result));\r\nresult = -EPERM;\r\n}\r\ndone:\r\nmutex_unlock(&usage_hack.mutex);\r\nreturn result;\r\n}\r\nstatic int ps3_close_hv_device_gpu(struct ps3_system_bus_device *dev)\r\n{\r\nint result;\r\nmutex_lock(&usage_hack.mutex);\r\nusage_hack.gpu--;\r\nif (usage_hack.gpu) {\r\nresult = 0;\r\ngoto done;\r\n}\r\nresult = lv1_gpu_close();\r\nBUG_ON(result);\r\ndone:\r\nmutex_unlock(&usage_hack.mutex);\r\nreturn result;\r\n}\r\nint ps3_open_hv_device(struct ps3_system_bus_device *dev)\r\n{\r\nBUG_ON(!dev);\r\npr_debug("%s:%d: match_id: %u\n", __func__, __LINE__, dev->match_id);\r\nswitch (dev->match_id) {\r\ncase PS3_MATCH_ID_EHCI:\r\ncase PS3_MATCH_ID_OHCI:\r\ncase PS3_MATCH_ID_GELIC:\r\ncase PS3_MATCH_ID_STOR_DISK:\r\ncase PS3_MATCH_ID_STOR_ROM:\r\ncase PS3_MATCH_ID_STOR_FLASH:\r\nreturn ps3_open_hv_device_sb(dev);\r\ncase PS3_MATCH_ID_SOUND:\r\ncase PS3_MATCH_ID_GPU:\r\nreturn ps3_open_hv_device_gpu(dev);\r\ncase PS3_MATCH_ID_AV_SETTINGS:\r\ncase PS3_MATCH_ID_SYSTEM_MANAGER:\r\npr_debug("%s:%d: unsupported match_id: %u\n", __func__,\r\n__LINE__, dev->match_id);\r\npr_debug("%s:%d: bus_id: %llu\n", __func__, __LINE__,\r\ndev->bus_id);\r\nBUG();\r\nreturn -EINVAL;\r\ndefault:\r\nbreak;\r\n}\r\npr_debug("%s:%d: unknown match_id: %u\n", __func__, __LINE__,\r\ndev->match_id);\r\nBUG();\r\nreturn -ENODEV;\r\n}\r\nint ps3_close_hv_device(struct ps3_system_bus_device *dev)\r\n{\r\nBUG_ON(!dev);\r\npr_debug("%s:%d: match_id: %u\n", __func__, __LINE__, dev->match_id);\r\nswitch (dev->match_id) {\r\ncase PS3_MATCH_ID_EHCI:\r\ncase PS3_MATCH_ID_OHCI:\r\ncase PS3_MATCH_ID_GELIC:\r\ncase PS3_MATCH_ID_STOR_DISK:\r\ncase PS3_MATCH_ID_STOR_ROM:\r\ncase PS3_MATCH_ID_STOR_FLASH:\r\nreturn ps3_close_hv_device_sb(dev);\r\ncase PS3_MATCH_ID_SOUND:\r\ncase PS3_MATCH_ID_GPU:\r\nreturn ps3_close_hv_device_gpu(dev);\r\ncase PS3_MATCH_ID_AV_SETTINGS:\r\ncase PS3_MATCH_ID_SYSTEM_MANAGER:\r\npr_debug("%s:%d: unsupported match_id: %u\n", __func__,\r\n__LINE__, dev->match_id);\r\npr_debug("%s:%d: bus_id: %llu\n", __func__, __LINE__,\r\ndev->bus_id);\r\nBUG();\r\nreturn -EINVAL;\r\ndefault:\r\nbreak;\r\n}\r\npr_debug("%s:%d: unknown match_id: %u\n", __func__, __LINE__,\r\ndev->match_id);\r\nBUG();\r\nreturn -ENODEV;\r\n}\r\nstatic void _dump_mmio_region(const struct ps3_mmio_region* r,\r\nconst char* func, int line)\r\n{\r\npr_debug("%s:%d: dev %llu:%llu\n", func, line, r->dev->bus_id,\r\nr->dev->dev_id);\r\npr_debug("%s:%d: bus_addr %lxh\n", func, line, r->bus_addr);\r\npr_debug("%s:%d: len %lxh\n", func, line, r->len);\r\npr_debug("%s:%d: lpar_addr %lxh\n", func, line, r->lpar_addr);\r\n}\r\nstatic int ps3_sb_mmio_region_create(struct ps3_mmio_region *r)\r\n{\r\nint result;\r\nu64 lpar_addr;\r\nresult = lv1_map_device_mmio_region(r->dev->bus_id, r->dev->dev_id,\r\nr->bus_addr, r->len, r->page_size, &lpar_addr);\r\nr->lpar_addr = lpar_addr;\r\nif (result) {\r\npr_debug("%s:%d: lv1_map_device_mmio_region failed: %s\n",\r\n__func__, __LINE__, ps3_result(result));\r\nr->lpar_addr = 0;\r\n}\r\ndump_mmio_region(r);\r\nreturn result;\r\n}\r\nstatic int ps3_ioc0_mmio_region_create(struct ps3_mmio_region *r)\r\n{\r\nreturn 0;\r\n}\r\nint ps3_mmio_region_create(struct ps3_mmio_region *r)\r\n{\r\nreturn r->mmio_ops->create(r);\r\n}\r\nstatic int ps3_sb_free_mmio_region(struct ps3_mmio_region *r)\r\n{\r\nint result;\r\ndump_mmio_region(r);\r\nresult = lv1_unmap_device_mmio_region(r->dev->bus_id, r->dev->dev_id,\r\nr->lpar_addr);\r\nif (result)\r\npr_debug("%s:%d: lv1_unmap_device_mmio_region failed: %s\n",\r\n__func__, __LINE__, ps3_result(result));\r\nr->lpar_addr = 0;\r\nreturn result;\r\n}\r\nstatic int ps3_ioc0_free_mmio_region(struct ps3_mmio_region *r)\r\n{\r\nreturn 0;\r\n}\r\nint ps3_free_mmio_region(struct ps3_mmio_region *r)\r\n{\r\nreturn r->mmio_ops->free(r);\r\n}\r\nint ps3_mmio_region_init(struct ps3_system_bus_device *dev,\r\nstruct ps3_mmio_region *r, unsigned long bus_addr, unsigned long len,\r\nenum ps3_mmio_page_size page_size)\r\n{\r\nr->dev = dev;\r\nr->bus_addr = bus_addr;\r\nr->len = len;\r\nr->page_size = page_size;\r\nswitch (dev->dev_type) {\r\ncase PS3_DEVICE_TYPE_SB:\r\nr->mmio_ops = &ps3_mmio_sb_region_ops;\r\nbreak;\r\ncase PS3_DEVICE_TYPE_IOC0:\r\nr->mmio_ops = &ps3_mmio_ioc0_region_ops;\r\nbreak;\r\ndefault:\r\nBUG();\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ps3_system_bus_match(struct device *_dev,\r\nstruct device_driver *_drv)\r\n{\r\nint result;\r\nstruct ps3_system_bus_driver *drv = ps3_drv_to_system_bus_drv(_drv);\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nif (!dev->match_sub_id)\r\nresult = dev->match_id == drv->match_id;\r\nelse\r\nresult = dev->match_sub_id == drv->match_sub_id &&\r\ndev->match_id == drv->match_id;\r\nif (result)\r\npr_info("%s:%d: dev=%u.%u(%s), drv=%u.%u(%s): match\n",\r\n__func__, __LINE__,\r\ndev->match_id, dev->match_sub_id, dev_name(&dev->core),\r\ndrv->match_id, drv->match_sub_id, drv->core.name);\r\nelse\r\npr_debug("%s:%d: dev=%u.%u(%s), drv=%u.%u(%s): miss\n",\r\n__func__, __LINE__,\r\ndev->match_id, dev->match_sub_id, dev_name(&dev->core),\r\ndrv->match_id, drv->match_sub_id, drv->core.name);\r\nreturn result;\r\n}\r\nstatic int ps3_system_bus_probe(struct device *_dev)\r\n{\r\nint result = 0;\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nstruct ps3_system_bus_driver *drv;\r\nBUG_ON(!dev);\r\ndev_dbg(_dev, "%s:%d\n", __func__, __LINE__);\r\ndrv = ps3_system_bus_dev_to_system_bus_drv(dev);\r\nBUG_ON(!drv);\r\nif (drv->probe)\r\nresult = drv->probe(dev);\r\nelse\r\npr_debug("%s:%d: %s no probe method\n", __func__, __LINE__,\r\ndev_name(&dev->core));\r\npr_debug(" <- %s:%d: %s\n", __func__, __LINE__, dev_name(&dev->core));\r\nreturn result;\r\n}\r\nstatic int ps3_system_bus_remove(struct device *_dev)\r\n{\r\nint result = 0;\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nstruct ps3_system_bus_driver *drv;\r\nBUG_ON(!dev);\r\ndev_dbg(_dev, "%s:%d\n", __func__, __LINE__);\r\ndrv = ps3_system_bus_dev_to_system_bus_drv(dev);\r\nBUG_ON(!drv);\r\nif (drv->remove)\r\nresult = drv->remove(dev);\r\nelse\r\ndev_dbg(&dev->core, "%s:%d %s: no remove method\n",\r\n__func__, __LINE__, drv->core.name);\r\npr_debug(" <- %s:%d: %s\n", __func__, __LINE__, dev_name(&dev->core));\r\nreturn result;\r\n}\r\nstatic void ps3_system_bus_shutdown(struct device *_dev)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nstruct ps3_system_bus_driver *drv;\r\nBUG_ON(!dev);\r\ndev_dbg(&dev->core, " -> %s:%d: match_id %d\n", __func__, __LINE__,\r\ndev->match_id);\r\nif (!dev->core.driver) {\r\ndev_dbg(&dev->core, "%s:%d: no driver bound\n", __func__,\r\n__LINE__);\r\nreturn;\r\n}\r\ndrv = ps3_system_bus_dev_to_system_bus_drv(dev);\r\nBUG_ON(!drv);\r\ndev_dbg(&dev->core, "%s:%d: %s -> %s\n", __func__, __LINE__,\r\ndev_name(&dev->core), drv->core.name);\r\nif (drv->shutdown)\r\ndrv->shutdown(dev);\r\nelse if (drv->remove) {\r\ndev_dbg(&dev->core, "%s:%d %s: no shutdown, calling remove\n",\r\n__func__, __LINE__, drv->core.name);\r\ndrv->remove(dev);\r\n} else {\r\ndev_dbg(&dev->core, "%s:%d %s: no shutdown method\n",\r\n__func__, __LINE__, drv->core.name);\r\nBUG();\r\n}\r\ndev_dbg(&dev->core, " <- %s:%d\n", __func__, __LINE__);\r\n}\r\nstatic int ps3_system_bus_uevent(struct device *_dev, struct kobj_uevent_env *env)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nif (add_uevent_var(env, "MODALIAS=ps3:%d:%d", dev->match_id,\r\ndev->match_sub_id))\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}\r\nstatic ssize_t modalias_show(struct device *_dev, struct device_attribute *a,\r\nchar *buf)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nint len = snprintf(buf, PAGE_SIZE, "ps3:%d:%d\n", dev->match_id,\r\ndev->match_sub_id);\r\nreturn (len >= PAGE_SIZE) ? (PAGE_SIZE - 1) : len;\r\n}\r\nstatic int __init ps3_system_bus_init(void)\r\n{\r\nint result;\r\nif (!firmware_has_feature(FW_FEATURE_PS3_LV1))\r\nreturn -ENODEV;\r\npr_debug(" -> %s:%d\n", __func__, __LINE__);\r\nmutex_init(&usage_hack.mutex);\r\nresult = device_register(&ps3_system_bus);\r\nBUG_ON(result);\r\nresult = bus_register(&ps3_system_bus_type);\r\nBUG_ON(result);\r\npr_debug(" <- %s:%d\n", __func__, __LINE__);\r\nreturn result;\r\n}\r\nstatic void * ps3_alloc_coherent(struct device *_dev, size_t size,\r\ndma_addr_t *dma_handle, gfp_t flag,\r\nunsigned long attrs)\r\n{\r\nint result;\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nunsigned long virt_addr;\r\nflag &= ~(__GFP_DMA | __GFP_HIGHMEM);\r\nflag |= __GFP_ZERO;\r\nvirt_addr = __get_free_pages(flag, get_order(size));\r\nif (!virt_addr) {\r\npr_debug("%s:%d: get_free_pages failed\n", __func__, __LINE__);\r\ngoto clean_none;\r\n}\r\nresult = ps3_dma_map(dev->d_region, virt_addr, size, dma_handle,\r\nCBE_IOPTE_PP_W | CBE_IOPTE_PP_R |\r\nCBE_IOPTE_SO_RW | CBE_IOPTE_M);\r\nif (result) {\r\npr_debug("%s:%d: ps3_dma_map failed (%d)\n",\r\n__func__, __LINE__, result);\r\nBUG_ON("check region type");\r\ngoto clean_alloc;\r\n}\r\nreturn (void*)virt_addr;\r\nclean_alloc:\r\nfree_pages(virt_addr, get_order(size));\r\nclean_none:\r\ndma_handle = NULL;\r\nreturn NULL;\r\n}\r\nstatic void ps3_free_coherent(struct device *_dev, size_t size, void *vaddr,\r\ndma_addr_t dma_handle, unsigned long attrs)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nps3_dma_unmap(dev->d_region, dma_handle, size);\r\nfree_pages((unsigned long)vaddr, get_order(size));\r\n}\r\nstatic dma_addr_t ps3_sb_map_page(struct device *_dev, struct page *page,\r\nunsigned long offset, size_t size, enum dma_data_direction direction,\r\nunsigned long attrs)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nint result;\r\ndma_addr_t bus_addr;\r\nvoid *ptr = page_address(page) + offset;\r\nresult = ps3_dma_map(dev->d_region, (unsigned long)ptr, size,\r\n&bus_addr,\r\nCBE_IOPTE_PP_R | CBE_IOPTE_PP_W |\r\nCBE_IOPTE_SO_RW | CBE_IOPTE_M);\r\nif (result) {\r\npr_debug("%s:%d: ps3_dma_map failed (%d)\n",\r\n__func__, __LINE__, result);\r\n}\r\nreturn bus_addr;\r\n}\r\nstatic dma_addr_t ps3_ioc0_map_page(struct device *_dev, struct page *page,\r\nunsigned long offset, size_t size,\r\nenum dma_data_direction direction,\r\nunsigned long attrs)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nint result;\r\ndma_addr_t bus_addr;\r\nu64 iopte_flag;\r\nvoid *ptr = page_address(page) + offset;\r\niopte_flag = CBE_IOPTE_M;\r\nswitch (direction) {\r\ncase DMA_BIDIRECTIONAL:\r\niopte_flag |= CBE_IOPTE_PP_R | CBE_IOPTE_PP_W | CBE_IOPTE_SO_RW;\r\nbreak;\r\ncase DMA_TO_DEVICE:\r\niopte_flag |= CBE_IOPTE_PP_R | CBE_IOPTE_SO_R;\r\nbreak;\r\ncase DMA_FROM_DEVICE:\r\niopte_flag |= CBE_IOPTE_PP_W | CBE_IOPTE_SO_RW;\r\nbreak;\r\ndefault:\r\nBUG();\r\n};\r\nresult = ps3_dma_map(dev->d_region, (unsigned long)ptr, size,\r\n&bus_addr, iopte_flag);\r\nif (result) {\r\npr_debug("%s:%d: ps3_dma_map failed (%d)\n",\r\n__func__, __LINE__, result);\r\n}\r\nreturn bus_addr;\r\n}\r\nstatic void ps3_unmap_page(struct device *_dev, dma_addr_t dma_addr,\r\nsize_t size, enum dma_data_direction direction, unsigned long attrs)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nint result;\r\nresult = ps3_dma_unmap(dev->d_region, dma_addr, size);\r\nif (result) {\r\npr_debug("%s:%d: ps3_dma_unmap failed (%d)\n",\r\n__func__, __LINE__, result);\r\n}\r\n}\r\nstatic int ps3_sb_map_sg(struct device *_dev, struct scatterlist *sgl,\r\nint nents, enum dma_data_direction direction, unsigned long attrs)\r\n{\r\n#if defined(CONFIG_PS3_DYNAMIC_DMA)\r\nBUG_ON("do");\r\nreturn -EPERM;\r\n#else\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nstruct scatterlist *sg;\r\nint i;\r\nfor_each_sg(sgl, sg, nents, i) {\r\nint result = ps3_dma_map(dev->d_region, sg_phys(sg),\r\nsg->length, &sg->dma_address, 0);\r\nif (result) {\r\npr_debug("%s:%d: ps3_dma_map failed (%d)\n",\r\n__func__, __LINE__, result);\r\nreturn -EINVAL;\r\n}\r\nsg->dma_length = sg->length;\r\n}\r\nreturn nents;\r\n#endif\r\n}\r\nstatic int ps3_ioc0_map_sg(struct device *_dev, struct scatterlist *sg,\r\nint nents,\r\nenum dma_data_direction direction,\r\nunsigned long attrs)\r\n{\r\nBUG();\r\nreturn 0;\r\n}\r\nstatic void ps3_sb_unmap_sg(struct device *_dev, struct scatterlist *sg,\r\nint nents, enum dma_data_direction direction, unsigned long attrs)\r\n{\r\n#if defined(CONFIG_PS3_DYNAMIC_DMA)\r\nBUG_ON("do");\r\n#endif\r\n}\r\nstatic void ps3_ioc0_unmap_sg(struct device *_dev, struct scatterlist *sg,\r\nint nents, enum dma_data_direction direction,\r\nunsigned long attrs)\r\n{\r\nBUG();\r\n}\r\nstatic int ps3_dma_supported(struct device *_dev, u64 mask)\r\n{\r\nreturn mask >= DMA_BIT_MASK(32);\r\n}\r\nstatic u64 ps3_dma_get_required_mask(struct device *_dev)\r\n{\r\nreturn DMA_BIT_MASK(32);\r\n}\r\nstatic void ps3_system_bus_release_device(struct device *_dev)\r\n{\r\nstruct ps3_system_bus_device *dev = ps3_dev_to_system_bus_dev(_dev);\r\nkfree(dev);\r\n}\r\nint ps3_system_bus_device_register(struct ps3_system_bus_device *dev)\r\n{\r\nint result;\r\nstatic unsigned int dev_ioc0_count;\r\nstatic unsigned int dev_sb_count;\r\nstatic unsigned int dev_vuart_count;\r\nstatic unsigned int dev_lpm_count;\r\nif (!dev->core.parent)\r\ndev->core.parent = &ps3_system_bus;\r\ndev->core.bus = &ps3_system_bus_type;\r\ndev->core.release = ps3_system_bus_release_device;\r\nswitch (dev->dev_type) {\r\ncase PS3_DEVICE_TYPE_IOC0:\r\ndev->core.dma_ops = &ps3_ioc0_dma_ops;\r\ndev_set_name(&dev->core, "ioc0_%02x", ++dev_ioc0_count);\r\nbreak;\r\ncase PS3_DEVICE_TYPE_SB:\r\ndev->core.dma_ops = &ps3_sb_dma_ops;\r\ndev_set_name(&dev->core, "sb_%02x", ++dev_sb_count);\r\nbreak;\r\ncase PS3_DEVICE_TYPE_VUART:\r\ndev_set_name(&dev->core, "vuart_%02x", ++dev_vuart_count);\r\nbreak;\r\ncase PS3_DEVICE_TYPE_LPM:\r\ndev_set_name(&dev->core, "lpm_%02x", ++dev_lpm_count);\r\nbreak;\r\ndefault:\r\nBUG();\r\n};\r\ndev->core.of_node = NULL;\r\nset_dev_node(&dev->core, 0);\r\npr_debug("%s:%d add %s\n", __func__, __LINE__, dev_name(&dev->core));\r\nresult = device_register(&dev->core);\r\nreturn result;\r\n}\r\nint ps3_system_bus_driver_register(struct ps3_system_bus_driver *drv)\r\n{\r\nint result;\r\npr_debug(" -> %s:%d: %s\n", __func__, __LINE__, drv->core.name);\r\nif (!firmware_has_feature(FW_FEATURE_PS3_LV1))\r\nreturn -ENODEV;\r\ndrv->core.bus = &ps3_system_bus_type;\r\nresult = driver_register(&drv->core);\r\npr_debug(" <- %s:%d: %s\n", __func__, __LINE__, drv->core.name);\r\nreturn result;\r\n}\r\nvoid ps3_system_bus_driver_unregister(struct ps3_system_bus_driver *drv)\r\n{\r\npr_debug(" -> %s:%d: %s\n", __func__, __LINE__, drv->core.name);\r\ndriver_unregister(&drv->core);\r\npr_debug(" <- %s:%d: %s\n", __func__, __LINE__, drv->core.name);\r\n}
