static struct vmw_stream *\r\nvmw_stream(struct vmw_resource *res)\r\n{\r\nreturn container_of(res, struct vmw_stream, sres.res);\r\n}\r\nstatic void vmw_stream_hw_destroy(struct vmw_resource *res)\r\n{\r\nstruct vmw_private *dev_priv = res->dev_priv;\r\nstruct vmw_stream *stream = vmw_stream(res);\r\nint ret;\r\nret = vmw_overlay_unref(dev_priv, stream->stream_id);\r\nWARN_ON_ONCE(ret != 0);\r\n}\r\nstatic int vmw_stream_init(struct vmw_resource *res, void *data)\r\n{\r\nstruct vmw_stream *stream = vmw_stream(res);\r\nreturn vmw_overlay_claim(res->dev_priv, &stream->stream_id);\r\n}\r\nstatic void vmw_stream_set_arg_handle(void *data, u32 handle)\r\n{\r\nstruct drm_vmw_stream_arg *arg = (struct drm_vmw_stream_arg *)data;\r\narg->stream_id = handle;\r\n}\r\nint vmw_stream_unref_ioctl(struct drm_device *dev, void *data,\r\nstruct drm_file *file_priv)\r\n{\r\nstruct drm_vmw_stream_arg *arg = (struct drm_vmw_stream_arg *)data;\r\nreturn ttm_ref_object_base_unref(vmw_fpriv(file_priv)->tfile,\r\narg->stream_id, TTM_REF_USAGE);\r\n}\r\nint vmw_stream_claim_ioctl(struct drm_device *dev, void *data,\r\nstruct drm_file *file_priv)\r\n{\r\nreturn vmw_simple_resource_create_ioctl(dev, data, file_priv,\r\n&va_stream_func);\r\n}\r\nint vmw_user_stream_lookup(struct vmw_private *dev_priv,\r\nstruct ttm_object_file *tfile,\r\nuint32_t *inout_id, struct vmw_resource **out)\r\n{\r\nstruct vmw_stream *stream;\r\nstruct vmw_resource *res =\r\nvmw_simple_resource_lookup(tfile, *inout_id, &va_stream_func);\r\nif (IS_ERR(res))\r\nreturn PTR_ERR(res);\r\nstream = vmw_stream(res);\r\n*inout_id = stream->stream_id;\r\n*out = res;\r\nreturn 0;\r\n}
