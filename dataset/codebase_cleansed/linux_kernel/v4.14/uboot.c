static void __init parse_uboot_commandline(char *commandp, int size)\r\n{\r\nextern unsigned long _init_sp;\r\nunsigned long *sp;\r\nunsigned long uboot_kbd;\r\nunsigned long uboot_initrd_start, uboot_initrd_end;\r\nunsigned long uboot_cmd_start, uboot_cmd_end;\r\nsp = (unsigned long *)_init_sp;\r\nuboot_kbd = sp[1];\r\nuboot_initrd_start = sp[2];\r\nuboot_initrd_end = sp[3];\r\nuboot_cmd_start = sp[4];\r\nuboot_cmd_end = sp[5];\r\nif (uboot_cmd_start && uboot_cmd_end)\r\nstrncpy(commandp, (const char *)uboot_cmd_start, size);\r\n#if defined(CONFIG_BLK_DEV_INITRD)\r\nif (uboot_initrd_start && uboot_initrd_end &&\r\n(uboot_initrd_end > uboot_initrd_start)) {\r\ninitrd_start = uboot_initrd_start;\r\ninitrd_end = uboot_initrd_end;\r\nROOT_DEV = Root_RAM0;\r\npr_info("initrd at 0x%lx:0x%lx\n", initrd_start, initrd_end);\r\n}\r\n#endif\r\n}\r\n__init void process_uboot_commandline(char *commandp, int size)\r\n{\r\nint len, n;\r\nn = strnlen(commandp, size);\r\ncommandp += n;\r\nlen = size - n;\r\nif (len) {\r\n*commandp++ = ' ';\r\nlen--;\r\n}\r\nparse_uboot_commandline(commandp, len);\r\ncommandp[size - 1] = 0;\r\n}
