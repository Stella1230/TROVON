static __net_init int rxrpc_init_net(struct net *net)\r\n{\r\nstruct rxrpc_net *rxnet = rxrpc_net(net);\r\nint ret;\r\nget_random_bytes(&rxnet->epoch, sizeof(rxnet->epoch));\r\nrxnet->epoch |= RXRPC_RANDOM_EPOCH;\r\nINIT_LIST_HEAD(&rxnet->calls);\r\nrwlock_init(&rxnet->call_lock);\r\nINIT_LIST_HEAD(&rxnet->conn_proc_list);\r\nINIT_LIST_HEAD(&rxnet->service_conns);\r\nrwlock_init(&rxnet->conn_lock);\r\nINIT_DELAYED_WORK(&rxnet->service_conn_reaper,\r\nrxrpc_service_connection_reaper);\r\nrxnet->nr_client_conns = 0;\r\nrxnet->nr_active_client_conns = 0;\r\nrxnet->kill_all_client_conns = false;\r\nspin_lock_init(&rxnet->client_conn_cache_lock);\r\nspin_lock_init(&rxnet->client_conn_discard_lock);\r\nINIT_LIST_HEAD(&rxnet->waiting_client_conns);\r\nINIT_LIST_HEAD(&rxnet->active_client_conns);\r\nINIT_LIST_HEAD(&rxnet->idle_client_conns);\r\nINIT_DELAYED_WORK(&rxnet->client_conn_reaper,\r\nrxrpc_discard_expired_client_conns);\r\nINIT_LIST_HEAD(&rxnet->local_endpoints);\r\nmutex_init(&rxnet->local_mutex);\r\nhash_init(rxnet->peer_hash);\r\nspin_lock_init(&rxnet->peer_hash_lock);\r\nret = -ENOMEM;\r\nrxnet->proc_net = proc_net_mkdir(net, "rxrpc", net->proc_net);\r\nif (!rxnet->proc_net)\r\ngoto err_proc;\r\nproc_create("calls", 0444, rxnet->proc_net, &rxrpc_call_seq_fops);\r\nproc_create("conns", 0444, rxnet->proc_net, &rxrpc_connection_seq_fops);\r\nreturn 0;\r\nerr_proc:\r\nreturn ret;\r\n}\r\nstatic __net_exit void rxrpc_exit_net(struct net *net)\r\n{\r\nstruct rxrpc_net *rxnet = rxrpc_net(net);\r\nrxrpc_destroy_all_calls(rxnet);\r\nrxrpc_destroy_all_connections(rxnet);\r\nrxrpc_destroy_all_locals(rxnet);\r\nproc_remove(rxnet->proc_net);\r\n}
