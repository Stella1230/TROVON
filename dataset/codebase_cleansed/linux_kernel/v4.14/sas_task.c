void sas_ssp_task_response(struct device *dev, struct sas_task *task,\r\nstruct ssp_response_iu *iu)\r\n{\r\nstruct task_status_struct *tstat = &task->task_status;\r\ntstat->resp = SAS_TASK_COMPLETE;\r\nif (iu->datapres == 0)\r\ntstat->stat = iu->status;\r\nelse if (iu->datapres == 1)\r\ntstat->stat = iu->resp_data[3];\r\nelse if (iu->datapres == 2) {\r\ntstat->stat = SAM_STAT_CHECK_CONDITION;\r\ntstat->buf_valid_size =\r\nmin_t(int, SAS_STATUS_BUF_SIZE,\r\nbe32_to_cpu(iu->sense_data_len));\r\nmemcpy(tstat->buf, iu->sense_data, tstat->buf_valid_size);\r\nif (iu->status != SAM_STAT_CHECK_CONDITION)\r\ndev_printk(KERN_WARNING, dev,\r\n"dev %llx sent sense data, but "\r\n"stat(%x) is not CHECK CONDITION\n",\r\nSAS_ADDR(task->dev->sas_addr),\r\niu->status);\r\n}\r\nelse\r\ntstat->stat = SAM_STAT_CHECK_CONDITION;\r\n}
