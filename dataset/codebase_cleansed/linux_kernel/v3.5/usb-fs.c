static inline void udc_device_init(struct omap_usb_config *pdata)\r\n{\r\npdata->udc_device = &udc_device;\r\n}\r\nstatic inline void udc_device_init(struct omap_usb_config *pdata)\r\n{\r\n}\r\nstatic inline void ohci_device_init(struct omap_usb_config *pdata)\r\n{\r\npdata->ohci_device = &ohci_device;\r\n}\r\nstatic inline void ohci_device_init(struct omap_usb_config *pdata)\r\n{\r\n}\r\nstatic inline void otg_device_init(struct omap_usb_config *pdata)\r\n{\r\npdata->otg_device = &otg_device;\r\n}\r\nstatic inline void otg_device_init(struct omap_usb_config *pdata)\r\n{\r\n}\r\nstatic void omap2_usb_devconf_clear(u8 port, u32 mask)\r\n{\r\nu32 r;\r\nr = omap_ctrl_readl(OMAP2_CONTROL_DEVCONF0);\r\nr &= ~USBTXWRMODEI(port, mask);\r\nomap_ctrl_writel(r, OMAP2_CONTROL_DEVCONF0);\r\n}\r\nstatic void omap2_usb_devconf_set(u8 port, u32 mask)\r\n{\r\nu32 r;\r\nr = omap_ctrl_readl(OMAP2_CONTROL_DEVCONF0);\r\nr |= USBTXWRMODEI(port, mask);\r\nomap_ctrl_writel(r, OMAP2_CONTROL_DEVCONF0);\r\n}\r\nstatic void omap2_usb2_disable_5pinbitll(void)\r\n{\r\nu32 r;\r\nr = omap_ctrl_readl(OMAP2_CONTROL_DEVCONF0);\r\nr &= ~(USBTXWRMODEI(2, USB_BIDIR_TLL) | USBT2TLL5PI);\r\nomap_ctrl_writel(r, OMAP2_CONTROL_DEVCONF0);\r\n}\r\nstatic void omap2_usb2_enable_5pinunitll(void)\r\n{\r\nu32 r;\r\nr = omap_ctrl_readl(OMAP2_CONTROL_DEVCONF0);\r\nr |= USBTXWRMODEI(2, USB_UNIDIR_TLL) | USBT2TLL5PI;\r\nomap_ctrl_writel(r, OMAP2_CONTROL_DEVCONF0);\r\n}\r\nstatic u32 __init omap2_usb0_init(unsigned nwires, unsigned is_device)\r\n{\r\nu32 syscon1 = 0;\r\nomap2_usb_devconf_clear(0, USB_BIDIR_TLL);\r\nif (nwires == 0)\r\nreturn 0;\r\nif (is_device)\r\nomap_mux_init_signal("usb0_puen", 0);\r\nomap_mux_init_signal("usb0_dat", 0);\r\nomap_mux_init_signal("usb0_txen", 0);\r\nomap_mux_init_signal("usb0_se0", 0);\r\nif (nwires != 3)\r\nomap_mux_init_signal("usb0_rcv", 0);\r\nswitch (nwires) {\r\ncase 3:\r\nsyscon1 = 2;\r\nomap2_usb_devconf_set(0, USB_BIDIR);\r\nbreak;\r\ncase 4:\r\nsyscon1 = 1;\r\nomap2_usb_devconf_set(0, USB_BIDIR);\r\nbreak;\r\ncase 6:\r\nsyscon1 = 3;\r\nomap_mux_init_signal("usb0_vp", 0);\r\nomap_mux_init_signal("usb0_vm", 0);\r\nomap2_usb_devconf_set(0, USB_UNIDIR);\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "illegal usb%d %d-wire transceiver\n",\r\n0, nwires);\r\n}\r\nreturn syscon1 << 16;\r\n}\r\nstatic u32 __init omap2_usb1_init(unsigned nwires)\r\n{\r\nu32 syscon1 = 0;\r\nomap2_usb_devconf_clear(1, USB_BIDIR_TLL);\r\nif (nwires == 0)\r\nreturn 0;\r\nswitch (nwires) {\r\ncase 2:\r\nsyscon1 = 1;\r\nomap2_usb_devconf_set(1, USB_BIDIR_TLL);\r\nbreak;\r\ncase 3:\r\nsyscon1 = 2;\r\nomap2_usb_devconf_set(1, USB_BIDIR);\r\nbreak;\r\ncase 4:\r\nsyscon1 = 1;\r\nomap2_usb_devconf_set(1, USB_BIDIR);\r\nbreak;\r\ncase 6:\r\ndefault:\r\nprintk(KERN_ERR "illegal usb%d %d-wire transceiver\n",\r\n1, nwires);\r\n}\r\nreturn syscon1 << 20;\r\n}\r\nstatic u32 __init omap2_usb2_init(unsigned nwires, unsigned alt_pingroup)\r\n{\r\nu32 syscon1 = 0;\r\nomap2_usb2_disable_5pinbitll();\r\nalt_pingroup = 0;\r\nif (alt_pingroup || nwires == 0)\r\nreturn 0;\r\nomap_mux_init_signal("usb2_dat", 0);\r\nomap_mux_init_signal("usb2_se0", 0);\r\nif (nwires > 2)\r\nomap_mux_init_signal("usb2_txen", 0);\r\nif (nwires > 3)\r\nomap_mux_init_signal("usb2_rcv", 0);\r\nswitch (nwires) {\r\ncase 2:\r\nsyscon1 = 1;\r\nomap2_usb_devconf_set(2, USB_BIDIR_TLL);\r\nbreak;\r\ncase 3:\r\nsyscon1 = 2;\r\nomap2_usb_devconf_set(2, USB_BIDIR);\r\nbreak;\r\ncase 4:\r\nsyscon1 = 1;\r\nomap2_usb_devconf_set(2, USB_BIDIR);\r\nbreak;\r\ncase 5:\r\nsyscon1 = 3;\r\nomap2_usb2_enable_5pinunitll();\r\nbreak;\r\ncase 6:\r\ndefault:\r\nprintk(KERN_ERR "illegal usb%d %d-wire transceiver\n",\r\n2, nwires);\r\n}\r\nreturn syscon1 << 24;\r\n}\r\nvoid __init omap2_usbfs_init(struct omap_usb_config *pdata)\r\n{\r\nstruct clk *ick;\r\nif (!cpu_is_omap24xx())\r\nreturn;\r\nick = clk_get(NULL, "usb_l4_ick");\r\nif (IS_ERR(ick))\r\nreturn;\r\nclk_enable(ick);\r\npdata->usb0_init = omap2_usb0_init;\r\npdata->usb1_init = omap2_usb1_init;\r\npdata->usb2_init = omap2_usb2_init;\r\nudc_device_init(pdata);\r\nohci_device_init(pdata);\r\notg_device_init(pdata);\r\nomap_otg_init(pdata);\r\nclk_disable(ick);\r\nclk_put(ick);\r\n}
