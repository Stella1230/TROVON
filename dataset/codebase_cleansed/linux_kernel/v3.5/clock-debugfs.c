static int jz4740_clock_debugfs_show_enabled(void *data, uint64_t *value)\r\n{\r\nstruct clk *clk = data;\r\n*value = clk_is_enabled(clk);\r\nreturn 0;\r\n}\r\nstatic int jz4740_clock_debugfs_set_enabled(void *data, uint64_t value)\r\n{\r\nstruct clk *clk = data;\r\nif (value)\r\nreturn clk_enable(clk);\r\nelse\r\nclk_disable(clk);\r\nreturn 0;\r\n}\r\nstatic int jz4740_clock_debugfs_show_rate(void *data, uint64_t *value)\r\n{\r\nstruct clk *clk = data;\r\n*value = clk_get_rate(clk);\r\nreturn 0;\r\n}\r\nvoid jz4740_clock_debugfs_add_clk(struct clk *clk)\r\n{\r\nif (!jz4740_clock_debugfs)\r\nreturn;\r\nclk->debugfs_entry = debugfs_create_dir(clk->name, jz4740_clock_debugfs);\r\ndebugfs_create_file("rate", S_IWUGO | S_IRUGO, clk->debugfs_entry, clk,\r\n&jz4740_clock_debugfs_ops_rate);\r\ndebugfs_create_file("enabled", S_IRUGO, clk->debugfs_entry, clk,\r\n&jz4740_clock_debugfs_ops_enabled);\r\nif (clk->parent) {\r\nchar parent_path[100];\r\nsnprintf(parent_path, 100, "../%s", clk->parent->name);\r\nclk->debugfs_parent_entry = debugfs_create_symlink("parent",\r\nclk->debugfs_entry,\r\nparent_path);\r\n}\r\n}\r\nvoid jz4740_clock_debugfs_update_parent(struct clk *clk)\r\n{\r\nif (clk->debugfs_parent_entry)\r\ndebugfs_remove(clk->debugfs_parent_entry);\r\nif (clk->parent) {\r\nchar parent_path[100];\r\nsnprintf(parent_path, 100, "../%s", clk->parent->name);\r\nclk->debugfs_parent_entry = debugfs_create_symlink("parent",\r\nclk->debugfs_entry,\r\nparent_path);\r\n} else {\r\nclk->debugfs_parent_entry = NULL;\r\n}\r\n}\r\nvoid jz4740_clock_debugfs_init(void)\r\n{\r\njz4740_clock_debugfs = debugfs_create_dir("jz4740-clock", NULL);\r\nif (IS_ERR(jz4740_clock_debugfs))\r\njz4740_clock_debugfs = NULL;\r\n}
