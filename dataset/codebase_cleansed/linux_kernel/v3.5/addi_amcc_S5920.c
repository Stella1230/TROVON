int i_AddiHeaderRW_ReadEeprom(int i_NbOfWordsToRead,\r\nunsigned int dw_PCIBoardEepromAddress,\r\nunsigned short w_EepromStartAddress, unsigned short *pw_DataRead)\r\n{\r\nunsigned int dw_eeprom_busy = 0;\r\nint i_Counter = 0;\r\nint i_WordCounter;\r\nint i;\r\nunsigned char pb_ReadByte[1];\r\nunsigned char b_ReadLowByte = 0;\r\nunsigned char b_ReadHighByte = 0;\r\nunsigned char b_SelectedAddressLow = 0;\r\nunsigned char b_SelectedAddressHigh = 0;\r\nunsigned short w_ReadWord = 0;\r\nfor (i_WordCounter = 0; i_WordCounter < i_NbOfWordsToRead;\r\ni_WordCounter++) {\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\nfor (i_Counter = 0; i_Counter < 2; i_Counter++) {\r\nb_SelectedAddressLow = (w_EepromStartAddress + i_Counter) % 256;\r\nb_SelectedAddressHigh = (w_EepromStartAddress + i_Counter) / 256;\r\noutb(NVCMD_LOAD_LOW,\r\ndw_PCIBoardEepromAddress + AMCC_OP_REG_MCSR +\r\n3);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\noutb(b_SelectedAddressLow,\r\ndw_PCIBoardEepromAddress + AMCC_OP_REG_MCSR +\r\n2);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\noutb(NVCMD_LOAD_HIGH,\r\ndw_PCIBoardEepromAddress + AMCC_OP_REG_MCSR +\r\n3);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\noutb(b_SelectedAddressHigh,\r\ndw_PCIBoardEepromAddress + AMCC_OP_REG_MCSR +\r\n2);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\noutb(NVCMD_BEGIN_READ,\r\ndw_PCIBoardEepromAddress + AMCC_OP_REG_MCSR +\r\n3);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\n*pb_ReadByte =\r\ninb(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR + 2);\r\ndo {\r\ndw_eeprom_busy =\r\ninl(dw_PCIBoardEepromAddress +\r\nAMCC_OP_REG_MCSR);\r\ndw_eeprom_busy = dw_eeprom_busy & EEPROM_BUSY;\r\n} while (dw_eeprom_busy == EEPROM_BUSY);\r\nif (i_Counter == 0)\r\nb_ReadLowByte = pb_ReadByte[0];\r\nelse\r\nb_ReadHighByte = pb_ReadByte[0];\r\nmsleep(1);\r\n}\r\nw_ReadWord =\r\n(b_ReadLowByte | (((unsigned short)b_ReadHighByte) *\r\n256));\r\npw_DataRead[i_WordCounter] = w_ReadWord;\r\nw_EepromStartAddress += 2;\r\n}\r\nreturn 0;\r\n}
