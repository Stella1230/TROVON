void __init udbg_early_init(void)\r\n{\r\n#if defined(CONFIG_PPC_EARLY_DEBUG_LPAR)\r\nudbg_init_debug_lpar();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_LPAR_HVSI)\r\nudbg_init_debug_lpar_hvsi();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_G5)\r\nudbg_init_pmac_realmode();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_RTAS_PANEL)\r\nudbg_init_rtas_panel();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_RTAS_CONSOLE)\r\nudbg_init_rtas_console();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_MAPLE)\r\nudbg_init_maple_realmode();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_BEAT)\r\nudbg_init_debug_beat();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_PAS_REALMODE)\r\nudbg_init_pas_realmode();\r\n#elif defined(CONFIG_BOOTX_TEXT)\r\nudbg_init_btext();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_44x)\r\nudbg_init_44x_as1();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_40x)\r\nudbg_init_40x_realmode();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_CPM)\r\nudbg_init_cpm();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_USBGECKO)\r\nudbg_init_usbgecko();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_WSP)\r\nudbg_init_wsp();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_EHV_BC)\r\nudbg_init_ehv_bc();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_PS3GELIC)\r\nudbg_init_ps3gelic();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_OPAL_RAW)\r\nudbg_init_debug_opal_raw();\r\n#elif defined(CONFIG_PPC_EARLY_DEBUG_OPAL_HVSI)\r\nudbg_init_debug_opal_hvsi();\r\n#endif\r\n#ifdef CONFIG_PPC_EARLY_DEBUG\r\nconsole_loglevel = 10;\r\nregister_early_udbg_console();\r\n#endif\r\n}\r\nvoid udbg_puts(const char *s)\r\n{\r\nif (udbg_putc) {\r\nchar c;\r\nif (s && *s != '\0') {\r\nwhile ((c = *s++) != '\0')\r\nudbg_putc(c);\r\n}\r\nif (udbg_flush)\r\nudbg_flush();\r\n}\r\n#if 0\r\nelse {\r\nprintk("%s", s);\r\n}\r\n#endif\r\n}\r\nint udbg_write(const char *s, int n)\r\n{\r\nint remain = n;\r\nchar c;\r\nif (!udbg_putc)\r\nreturn 0;\r\nif (s && *s != '\0') {\r\nwhile (((c = *s++) != '\0') && (remain-- > 0)) {\r\nudbg_putc(c);\r\n}\r\n}\r\nif (udbg_flush)\r\nudbg_flush();\r\nreturn n - remain;\r\n}\r\nint udbg_read(char *buf, int buflen)\r\n{\r\nchar *p = buf;\r\nint i, c;\r\nif (!udbg_getc)\r\nreturn 0;\r\nfor (i = 0; i < buflen; ++i) {\r\ndo {\r\nc = udbg_getc();\r\nif (c == -1 && i == 0)\r\nreturn -1;\r\n} while (c == 0x11 || c == 0x13);\r\nif (c == 0 || c == -1)\r\nbreak;\r\n*p++ = c;\r\n}\r\nreturn i;\r\n}\r\nvoid udbg_printf(const char *fmt, ...)\r\n{\r\nchar buf[UDBG_BUFSIZE];\r\nva_list args;\r\nva_start(args, fmt);\r\nvsnprintf(buf, UDBG_BUFSIZE, fmt, args);\r\nudbg_puts(buf);\r\nva_end(args);\r\n}\r\nvoid __init udbg_progress(char *s, unsigned short hex)\r\n{\r\nudbg_puts(s);\r\nudbg_puts("\n");\r\n}\r\nstatic void udbg_console_write(struct console *con, const char *s,\r\nunsigned int n)\r\n{\r\nudbg_write(s, n);\r\n}\r\nvoid __init register_early_udbg_console(void)\r\n{\r\nif (early_console_initialized)\r\nreturn;\r\nif (!udbg_putc)\r\nreturn;\r\nif (strstr(boot_command_line, "udbg-immortal")) {\r\nprintk(KERN_INFO "early console immortal !\n");\r\nudbg_console.flags &= ~CON_BOOT;\r\n}\r\nearly_console_initialized = 1;\r\nregister_console(&udbg_console);\r\n}
