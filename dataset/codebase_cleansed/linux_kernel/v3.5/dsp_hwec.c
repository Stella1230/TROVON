void dsp_hwec_enable(struct dsp *dsp, const char *arg)\r\n{\r\nint deftaps = 128,\r\nlen;\r\nstruct mISDN_ctrl_req cq;\r\nif (!dsp) {\r\nprintk(KERN_ERR "%s: failed to enable hwec: dsp is NULL\n",\r\n__func__);\r\nreturn;\r\n}\r\nif (!arg)\r\ngoto _do;\r\nlen = strlen(arg);\r\nif (!len)\r\ngoto _do;\r\n{\r\nchar _dup[len + 1];\r\nchar *dup, *tok, *name, *val;\r\nint tmp;\r\nstrcpy(_dup, arg);\r\ndup = _dup;\r\nwhile ((tok = strsep(&dup, ","))) {\r\nif (!strlen(tok))\r\ncontinue;\r\nname = strsep(&tok, "=");\r\nval = tok;\r\nif (!val)\r\ncontinue;\r\nif (!strcmp(name, "deftaps")) {\r\nif (sscanf(val, "%d", &tmp) == 1)\r\ndeftaps = tmp;\r\n}\r\n}\r\n}\r\n_do:\r\nprintk(KERN_DEBUG "%s: enabling hwec with deftaps=%d\n",\r\n__func__, deftaps);\r\nmemset(&cq, 0, sizeof(cq));\r\ncq.op = MISDN_CTRL_HFC_ECHOCAN_ON;\r\ncq.p1 = deftaps;\r\nif (!dsp->ch.peer->ctrl(&dsp->ch, CONTROL_CHANNEL, &cq)) {\r\nprintk(KERN_DEBUG "%s: CONTROL_CHANNEL failed\n",\r\n__func__);\r\nreturn;\r\n}\r\n}\r\nvoid dsp_hwec_disable(struct dsp *dsp)\r\n{\r\nstruct mISDN_ctrl_req cq;\r\nif (!dsp) {\r\nprintk(KERN_ERR "%s: failed to disable hwec: dsp is NULL\n",\r\n__func__);\r\nreturn;\r\n}\r\nprintk(KERN_DEBUG "%s: disabling hwec\n", __func__);\r\nmemset(&cq, 0, sizeof(cq));\r\ncq.op = MISDN_CTRL_HFC_ECHOCAN_OFF;\r\nif (!dsp->ch.peer->ctrl(&dsp->ch, CONTROL_CHANNEL, &cq)) {\r\nprintk(KERN_DEBUG "%s: CONTROL_CHANNEL failed\n",\r\n__func__);\r\nreturn;\r\n}\r\n}\r\nint dsp_hwec_init(void)\r\n{\r\nmISDN_dsp_element_register(dsp_hwec);\r\nreturn 0;\r\n}\r\nvoid dsp_hwec_exit(void)\r\n{\r\nmISDN_dsp_element_unregister(dsp_hwec);\r\n}
