static int mop500_sdi0_ios_handler(struct device *dev, struct mmc_ios *ios)\r\n{\r\nswitch (ios->power_mode) {\r\ncase MMC_POWER_UP:\r\ncase MMC_POWER_ON:\r\ngpio_direction_output(sdi0_vsel, 0);\r\ngpio_direction_output(sdi0_en, 1);\r\nbreak;\r\ncase MMC_POWER_OFF:\r\ngpio_direction_output(sdi0_vsel, 0);\r\ngpio_direction_output(sdi0_en, 0);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic void sdi0_configure(struct device *parent)\r\n{\r\nint ret;\r\nret = gpio_request(sdi0_en, "level shifter enable");\r\nif (!ret)\r\nret = gpio_request(sdi0_vsel,\r\n"level shifter 1v8-3v select");\r\nif (ret) {\r\npr_warning("unable to config sdi0 gpios for level shifter.\n");\r\nreturn;\r\n}\r\ngpio_direction_output(sdi0_vsel, 0);\r\ngpio_direction_output(sdi0_en, 1);\r\ndb8500_add_sdi0(parent, &mop500_sdi0_data, U8500_SDI_V2_PERIPHID);\r\n}\r\nvoid mop500_sdi_tc35892_init(struct device *parent)\r\n{\r\nmop500_sdi0_data.gpio_cd = GPIO_SDMMC_CD;\r\nsdi0_en = GPIO_SDMMC_EN;\r\nsdi0_vsel = GPIO_SDMMC_1V8_3V_SEL;\r\nsdi0_configure(parent);\r\n}\r\nvoid __init mop500_sdi_init(struct device *parent)\r\n{\r\ndb8500_add_sdi2(parent, &mop500_sdi2_data, U8500_SDI_V2_PERIPHID);\r\ndb8500_add_sdi4(parent, &mop500_sdi4_data, U8500_SDI_V2_PERIPHID);\r\n}\r\nvoid __init snowball_sdi_init(struct device *parent)\r\n{\r\nmop500_sdi0_data.capabilities &= ~MMC_CAP_SD_HIGHSPEED;\r\ndb8500_add_sdi4(parent, &mop500_sdi4_data, U8500_SDI_V2_PERIPHID);\r\nmop500_sdi0_data.gpio_cd = SNOWBALL_SDMMC_CD_GPIO;\r\nmop500_sdi0_data.cd_invert = true;\r\nsdi0_en = SNOWBALL_SDMMC_EN_GPIO;\r\nsdi0_vsel = SNOWBALL_SDMMC_1V8_3V_GPIO;\r\nsdi0_configure(parent);\r\n}\r\nvoid __init hrefv60_sdi_init(struct device *parent)\r\n{\r\ndb8500_add_sdi2(parent, &mop500_sdi2_data, U8500_SDI_V2_PERIPHID);\r\ndb8500_add_sdi4(parent, &mop500_sdi4_data, U8500_SDI_V2_PERIPHID);\r\nmop500_sdi0_data.gpio_cd = HREFV60_SDMMC_CD_GPIO;\r\nsdi0_en = HREFV60_SDMMC_EN_GPIO;\r\nsdi0_vsel = HREFV60_SDMMC_1V8_3V_GPIO;\r\nsdi0_configure(parent);\r\ndb8500_add_sdi1(parent, &mop500_sdi1_data, U8500_SDI_V2_PERIPHID);\r\n}
