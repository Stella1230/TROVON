int mpi_getbyte(const MPI a, unsigned idx)\r\n{\r\nint i, j;\r\nunsigned n;\r\nmpi_ptr_t ap;\r\nmpi_limb_t limb;\r\nap = a->d;\r\nfor (n = 0, i = 0; i < a->nlimbs; i++) {\r\nlimb = ap[i];\r\nfor (j = 0; j < BYTES_PER_MPI_LIMB; j++, n++)\r\nif (n == idx)\r\nreturn (limb >> j * 8) & 0xff;\r\n}\r\nreturn -1;\r\n}\r\nvoid mpi_putbyte(MPI a, unsigned idx, int xc)\r\n{\r\nint i, j;\r\nunsigned n;\r\nmpi_ptr_t ap;\r\nmpi_limb_t limb, c;\r\nc = xc & 0xff;\r\nap = a->d;\r\nfor (n = 0, i = 0; i < a->alloced; i++) {\r\nlimb = ap[i];\r\nfor (j = 0; j < BYTES_PER_MPI_LIMB; j++, n++)\r\nif (n == idx) {\r\n#if BYTES_PER_MPI_LIMB == 4\r\nif (j == 0)\r\nlimb = (limb & 0xffffff00) | c;\r\nelse if (j == 1)\r\nlimb = (limb & 0xffff00ff) | (c << 8);\r\nelse if (j == 2)\r\nlimb = (limb & 0xff00ffff) | (c << 16);\r\nelse\r\nlimb = (limb & 0x00ffffff) | (c << 24);\r\n#elif BYTES_PER_MPI_LIMB == 8\r\nif (j == 0)\r\nlimb = (limb & 0xffffffffffffff00) | c;\r\nelse if (j == 1)\r\nlimb =\r\n(limb & 0xffffffffffff00ff) | (c <<\r\n8);\r\nelse if (j == 2)\r\nlimb =\r\n(limb & 0xffffffffff00ffff) | (c <<\r\n16);\r\nelse if (j == 3)\r\nlimb =\r\n(limb & 0xffffffff00ffffff) | (c <<\r\n24);\r\nelse if (j == 4)\r\nlimb =\r\n(limb & 0xffffff00ffffffff) | (c <<\r\n32);\r\nelse if (j == 5)\r\nlimb =\r\n(limb & 0xffff00ffffffffff) | (c <<\r\n40);\r\nelse if (j == 6)\r\nlimb =\r\n(limb & 0xff00ffffffffffff) | (c <<\r\n48);\r\nelse\r\nlimb =\r\n(limb & 0x00ffffffffffffff) | (c <<\r\n56);\r\n#else\r\n#error please enhance this function, its ugly - i know.\r\n#endif\r\nif (a->nlimbs <= i)\r\na->nlimbs = i + 1;\r\nap[i] = limb;\r\nreturn;\r\n}\r\n}\r\nlog_bug("index out of range\n");\r\n}\r\nunsigned mpi_trailing_zeros(const MPI a)\r\n{\r\nunsigned n, count = 0;\r\nfor (n = 0; n < a->nlimbs; n++) {\r\nif (a->d[n]) {\r\nunsigned nn;\r\nmpi_limb_t alimb = a->d[n];\r\ncount_trailing_zeros(nn, alimb);\r\ncount += nn;\r\nbreak;\r\n}\r\ncount += BITS_PER_MPI_LIMB;\r\n}\r\nreturn count;\r\n}
