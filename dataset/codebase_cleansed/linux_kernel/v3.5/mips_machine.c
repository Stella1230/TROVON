__init void mips_set_machine_name(const char *name)\r\n{\r\nchar *p;\r\nif (name == NULL)\r\nreturn;\r\np = kstrdup(name, GFP_KERNEL);\r\nif (!p)\r\npr_err("MIPS: no memory for machine_name\n");\r\nmips_machine_name = p;\r\n}\r\nchar *mips_get_machine_name(void)\r\n{\r\nreturn mips_machine_name;\r\n}\r\n__init int mips_machtype_setup(char *id)\r\n{\r\nstruct mips_machine *mach;\r\nfor_each_machine(mach) {\r\nif (mach->mach_id == NULL)\r\ncontinue;\r\nif (strcmp(mach->mach_id, id) == 0) {\r\nmips_machtype = mach->mach_type;\r\nreturn 0;\r\n}\r\n}\r\npr_err("MIPS: no machine found for id '%s', supported machines:\n", id);\r\npr_err("%-24s %s\n", "id", "name");\r\nfor_each_machine(mach)\r\npr_err("%-24s %s\n", mach->mach_id, mach->mach_name);\r\nreturn 1;\r\n}\r\n__init void mips_machine_setup(void)\r\n{\r\nstruct mips_machine *mach;\r\nfor_each_machine(mach) {\r\nif (mips_machtype == mach->mach_type) {\r\nmips_machine = mach;\r\nbreak;\r\n}\r\n}\r\nif (!mips_machine)\r\nreturn;\r\nmips_set_machine_name(mips_machine->mach_name);\r\npr_info("MIPS: machine is %s\n", mips_machine_name);\r\nif (mips_machine->mach_setup)\r\nmips_machine->mach_setup();\r\n}
