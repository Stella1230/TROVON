static int fscache_histogram_show(struct seq_file *m, void *v)\r\n{\r\nunsigned long index;\r\nunsigned n[5], t;\r\nswitch ((unsigned long) v) {\r\ncase 1:\r\nseq_puts(m, "JIFS SECS OBJ INST OP RUNS OBJ RUNS "\r\n" RETRV DLY RETRIEVLS\n");\r\nreturn 0;\r\ncase 2:\r\nseq_puts(m, "===== ===== ========= ========= ========="\r\n" ========= =========\n");\r\nreturn 0;\r\ndefault:\r\nindex = (unsigned long) v - 3;\r\nn[0] = atomic_read(&fscache_obj_instantiate_histogram[index]);\r\nn[1] = atomic_read(&fscache_ops_histogram[index]);\r\nn[2] = atomic_read(&fscache_objs_histogram[index]);\r\nn[3] = atomic_read(&fscache_retrieval_delay_histogram[index]);\r\nn[4] = atomic_read(&fscache_retrieval_histogram[index]);\r\nif (!(n[0] | n[1] | n[2] | n[3] | n[4]))\r\nreturn 0;\r\nt = (index * 1000) / HZ;\r\nseq_printf(m, "%4lu 0.%03u %9u %9u %9u %9u %9u\n",\r\nindex, t, n[0], n[1], n[2], n[3], n[4]);\r\nreturn 0;\r\n}\r\n}\r\nstatic void *fscache_histogram_start(struct seq_file *m, loff_t *_pos)\r\n{\r\nif ((unsigned long long)*_pos >= HZ + 2)\r\nreturn NULL;\r\nif (*_pos == 0)\r\n*_pos = 1;\r\nreturn (void *)(unsigned long) *_pos;\r\n}\r\nstatic void *fscache_histogram_next(struct seq_file *m, void *v, loff_t *pos)\r\n{\r\n(*pos)++;\r\nreturn (unsigned long long)*pos > HZ + 2 ?\r\nNULL : (void *)(unsigned long) *pos;\r\n}\r\nstatic void fscache_histogram_stop(struct seq_file *m, void *v)\r\n{\r\n}\r\nstatic int fscache_histogram_open(struct inode *inode, struct file *file)\r\n{\r\nreturn seq_open(file, &fscache_histogram_ops);\r\n}
