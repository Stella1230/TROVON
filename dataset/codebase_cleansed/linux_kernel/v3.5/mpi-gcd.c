int mpi_gcd(MPI g, const MPI xa, const MPI xb)\r\n{\r\nMPI a = NULL, b = NULL;\r\nif (mpi_copy(&a, xa) < 0)\r\ngoto nomem;\r\nif (mpi_copy(&b, xb) < 0)\r\ngoto nomem;\r\na->sign = 0;\r\nb->sign = 0;\r\nwhile (mpi_cmp_ui(b, 0)) {\r\nif (mpi_fdiv_r(g, a, b) < 0)\r\ngoto nomem;\r\nif (mpi_set(a, b) < 0)\r\ngoto nomem;\r\nif (mpi_set(b, g) < 0)\r\ngoto nomem;\r\n}\r\nif (mpi_set(g, a) < 0)\r\ngoto nomem;\r\nmpi_free(a);\r\nmpi_free(b);\r\nreturn !mpi_cmp_ui(g, 1);\r\nnomem:\r\nmpi_free(a);\r\nmpi_free(b);\r\nreturn -ENOMEM;\r\n}
