static void platform_fixups(void)\r\n{\r\nu64 val;\r\nvoid *nvrtc;\r\ndt_fixup_memory(0, mem_size);\r\nplanetcore_set_mac_addrs(table);\r\nif (!planetcore_get_decimal(table, PLANETCORE_KEY_CRYSTAL_HZ, &val)) {\r\nprintf("No PlanetCore crystal frequency key.\r\n");\r\nreturn;\r\n}\r\nibm405gp_fixup_clocks(val, 0xa8c000);\r\nibm4xx_quiesce_eth((u32 *)0xef600800, NULL);\r\nibm4xx_fixup_ebc_ranges("/plb/ebc");\r\nif (!planetcore_get_decimal(table, PLANETCORE_KEY_KB_NVRAM, &val)) {\r\nprintf("No PlanetCore NVRAM size key.\r\n");\r\nreturn;\r\n}\r\nnvrtc = finddevice("/plb/ebc/nvrtc@4,200000");\r\nif (nvrtc != NULL) {\r\nu32 reg[3] = { 4, 0x200000, 0};\r\ngetprop(nvrtc, "reg", reg, 3);\r\nreg[2] = (val << 10) & 0xffffffff;\r\nsetprop(nvrtc, "reg", reg, 3);\r\n}\r\n}\r\nvoid platform_init(unsigned long r3, unsigned long r4, unsigned long r5,\r\nunsigned long r6, unsigned long r7)\r\n{\r\ntable = (char *)r3;\r\nplanetcore_prepare_table(table);\r\nif (!planetcore_get_decimal(table, PLANETCORE_KEY_MB_RAM, &mem_size))\r\nreturn;\r\nmem_size *= 1024 * 1024;\r\nsimple_alloc_init(_end, mem_size - (unsigned long)_end, 32, 64);\r\nfdt_init(_dtb_start);\r\nplanetcore_set_stdout_path(table);\r\nserial_console_init();\r\nplatform_ops.fixups = platform_fixups;\r\n}
