asmlinkage int\r\nsys_cacheflush (unsigned long addr, int scope, int cache, unsigned long len)\r\n{\r\nreturn -EINVAL;\r\n}\r\nasmlinkage int sys_getpagesize(void)\r\n{\r\nreturn PAGE_SIZE;\r\n}\r\nasmlinkage void syscall_print(void *dummy,...)\r\n{\r\nstruct pt_regs *regs = (struct pt_regs *) ((unsigned char *)&dummy-4);\r\nprintk("call %06lx:%ld 1:%08lx,2:%08lx,3:%08lx,ret:%08lx\n",\r\n((regs->pc)&0xffffff)-2,regs->orig_er0,regs->er1,regs->er2,regs->er3,regs->er0);\r\n}\r\nint kernel_execve(const char *filename,\r\nconst char *const argv[],\r\nconst char *const envp[])\r\n{\r\nregister long res __asm__("er0");\r\nregister const char *const *_c __asm__("er3") = envp;\r\nregister const char *const *_b __asm__("er2") = argv;\r\nregister const char * _a __asm__("er1") = filename;\r\n__asm__ __volatile__ ("mov.l %1,er0\n\t"\r\n"trapa #0\n\t"\r\n: "=r" (res)\r\n: "g" (__NR_execve),\r\n"g" (_a),\r\n"g" (_b),\r\n"g" (_c)\r\n: "cc", "memory");\r\nreturn res;\r\n}
