static inline void s3c2443_irq_demux(unsigned int irq, unsigned int len)\r\n{\r\nunsigned int subsrc, submsk;\r\nunsigned int end;\r\nsubsrc = __raw_readl(S3C2410_SUBSRCPND);\r\nsubmsk = __raw_readl(S3C2410_INTSUBMSK);\r\nsubsrc &= ~submsk;\r\nsubsrc >>= (irq - S3C2410_IRQSUB(0));\r\nsubsrc &= (1 << len)-1;\r\nend = len + irq;\r\nfor (; irq < end && subsrc; irq++) {\r\nif (subsrc & 1)\r\ngeneric_handle_irq(irq);\r\nsubsrc >>= 1;\r\n}\r\n}\r\nstatic void s3c2443_irq_demux_wdtac97(unsigned int irq, struct irq_desc *desc)\r\n{\r\ns3c2443_irq_demux(IRQ_S3C2443_WDT, 4);\r\n}\r\nstatic void s3c2443_irq_wdtac97_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_WDTAC97, SUBMSK_WDTAC97);\r\n}\r\nstatic void s3c2443_irq_wdtac97_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_WDTAC97);\r\n}\r\nstatic void s3c2443_irq_wdtac97_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_WDTAC97, SUBMSK_WDTAC97);\r\n}\r\nstatic void s3c2443_irq_demux_lcd(unsigned int irq, struct irq_desc *desc)\r\n{\r\ns3c2443_irq_demux(IRQ_S3C2443_LCD1, 4);\r\n}\r\nstatic void s3c2443_irq_lcd_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_LCD, SUBMSK_LCD);\r\n}\r\nstatic void s3c2443_irq_lcd_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_LCD);\r\n}\r\nstatic void s3c2443_irq_lcd_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_LCD, SUBMSK_LCD);\r\n}\r\nstatic void s3c2443_irq_demux_dma(unsigned int irq, struct irq_desc *desc)\r\n{\r\ns3c2443_irq_demux(IRQ_S3C2443_DMA0, 6);\r\n}\r\nstatic void s3c2443_irq_dma_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_DMA, SUBMSK_DMA);\r\n}\r\nstatic void s3c2443_irq_dma_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_DMA);\r\n}\r\nstatic void s3c2443_irq_dma_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_DMA, SUBMSK_DMA);\r\n}\r\nstatic void s3c2443_irq_demux_uart3(unsigned int irq, struct irq_desc *desc)\r\n{\r\ns3c2443_irq_demux(IRQ_S3C2443_RX3, 3);\r\n}\r\nstatic void s3c2443_irq_uart3_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_UART3, SUBMSK_UART3);\r\n}\r\nstatic void s3c2443_irq_uart3_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_UART3);\r\n}\r\nstatic void s3c2443_irq_uart3_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_UART3, SUBMSK_UART3);\r\n}\r\nstatic void s3c2443_irq_demux_cam(unsigned int irq, struct irq_desc *desc)\r\n{\r\ns3c2443_irq_demux(IRQ_S3C2440_CAM_C, 4);\r\n}\r\nstatic void s3c2443_irq_cam_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_CAM, SUBMSK_CAM);\r\n}\r\nstatic void s3c2443_irq_cam_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_CAM);\r\n}\r\nstatic void s3c2443_irq_cam_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_CAM, SUBMSK_CAM);\r\n}\r\nstatic int __init s3c2443_add_sub(unsigned int base,\r\nvoid (*demux)(unsigned int,\r\nstruct irq_desc *),\r\nstruct irq_chip *chip,\r\nunsigned int start, unsigned int end)\r\n{\r\nunsigned int irqno;\r\nirq_set_chip_and_handler(base, &s3c_irq_level_chip, handle_level_irq);\r\nirq_set_chained_handler(base, demux);\r\nfor (irqno = start; irqno <= end; irqno++) {\r\nirq_set_chip_and_handler(irqno, chip, handle_level_irq);\r\nset_irq_flags(irqno, IRQF_VALID);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init s3c2443_irq_add(struct device *dev,\r\nstruct subsys_interface *sif)\r\n{\r\nprintk("S3C2443: IRQ Support\n");\r\ns3c2443_add_sub(IRQ_CAM, s3c2443_irq_demux_cam, &s3c2443_irq_cam,\r\nIRQ_S3C2440_CAM_C, IRQ_S3C2440_CAM_P);\r\ns3c2443_add_sub(IRQ_LCD, s3c2443_irq_demux_lcd, &s3c2443_irq_lcd,\r\nIRQ_S3C2443_LCD1, IRQ_S3C2443_LCD4);\r\ns3c2443_add_sub(IRQ_S3C2443_DMA, s3c2443_irq_demux_dma,\r\n&s3c2443_irq_dma, IRQ_S3C2443_DMA0, IRQ_S3C2443_DMA5);\r\ns3c2443_add_sub(IRQ_S3C2443_UART3, s3c2443_irq_demux_uart3,\r\n&s3c2443_irq_uart3,\r\nIRQ_S3C2443_RX3, IRQ_S3C2443_ERR3);\r\ns3c2443_add_sub(IRQ_WDT, s3c2443_irq_demux_wdtac97,\r\n&s3c2443_irq_wdtac97,\r\nIRQ_S3C2443_WDT, IRQ_S3C2443_AC97);\r\nreturn 0;\r\n}\r\nstatic int __init s3c2443_irq_init(void)\r\n{\r\nreturn subsys_interface_register(&s3c2443_irq_interface);\r\n}
