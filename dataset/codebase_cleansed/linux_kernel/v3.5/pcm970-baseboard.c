static int pcm970_sdhc2_get_ro(struct device *dev)\r\n{\r\nreturn gpio_get_value(GPIO_PORTC + 28);\r\n}\r\nstatic int pcm970_sdhc2_init(struct device *dev, irq_handler_t detect_irq, void *data)\r\n{\r\nint ret;\r\nret = request_irq(IRQ_GPIOC(29), detect_irq, IRQF_TRIGGER_FALLING,\r\n"imx-mmc-detect", data);\r\nif (ret)\r\nreturn ret;\r\nret = gpio_request(GPIO_PORTC + 28, "imx-mmc-ro");\r\nif (ret) {\r\nfree_irq(IRQ_GPIOC(29), data);\r\nreturn ret;\r\n}\r\ngpio_direction_input(GPIO_PORTC + 28);\r\nreturn 0;\r\n}\r\nstatic void pcm970_sdhc2_exit(struct device *dev, void *data)\r\n{\r\nfree_irq(IRQ_GPIOC(29), data);\r\ngpio_free(GPIO_PORTC + 28);\r\n}\r\nvoid __init pcm970_baseboard_init(void)\r\n{\r\nmxc_gpio_setup_multiple_pins(pcm970_pins, ARRAY_SIZE(pcm970_pins),\r\n"PCM970");\r\nimx27_add_imx_fb(&pcm038_fb_data);\r\nmxc_gpio_mode(GPIO_PORTC | 28 | GPIO_GPIO | GPIO_IN);\r\nimx27_add_mxc_mmc(1, &sdhc_pdata);\r\nplatform_device_register(&pcm970_sja1000);\r\n}
