void nlm_hal_init(void)\r\n{\r\nnlm_io_base = CKSEG1ADDR(XLP_DEFAULT_IO_BASE);\r\nnlm_sys_base = nlm_get_sys_regbase(0);\r\nnlm_pic_base = nlm_get_pic_regbase(0);\r\n}\r\nint nlm_irq_to_irt(int irq)\r\n{\r\nif (!PIC_IRQ_IS_IRT(irq))\r\nreturn -1;\r\nswitch (irq) {\r\ncase PIC_UART_0_IRQ:\r\nreturn PIC_IRT_UART_0_INDEX;\r\ncase PIC_UART_1_IRQ:\r\nreturn PIC_IRT_UART_1_INDEX;\r\ndefault:\r\nreturn -1;\r\n}\r\n}\r\nint nlm_irt_to_irq(int irt)\r\n{\r\nswitch (irt) {\r\ncase PIC_IRT_UART_0_INDEX:\r\nreturn PIC_UART_0_IRQ;\r\ncase PIC_IRT_UART_1_INDEX:\r\nreturn PIC_UART_1_IRQ;\r\ndefault:\r\nreturn -1;\r\n}\r\n}\r\nunsigned int nlm_get_core_frequency(int core)\r\n{\r\nunsigned int pll_divf, pll_divr, dfs_div, ext_div;\r\nunsigned int rstval, dfsval, denom;\r\nuint64_t num;\r\nrstval = nlm_read_sys_reg(nlm_sys_base, SYS_POWER_ON_RESET_CFG);\r\ndfsval = nlm_read_sys_reg(nlm_sys_base, SYS_CORE_DFS_DIV_VALUE);\r\npll_divf = ((rstval >> 10) & 0x7f) + 1;\r\npll_divr = ((rstval >> 8) & 0x3) + 1;\r\next_div = ((rstval >> 30) & 0x3) + 1;\r\ndfs_div = ((dfsval >> (core * 4)) & 0xf) + 1;\r\nnum = 800000000ULL * pll_divf;\r\ndenom = 3 * pll_divr * ext_div * dfs_div;\r\ndo_div(num, denom);\r\nreturn (unsigned int)num;\r\n}\r\nunsigned int nlm_get_cpu_frequency(void)\r\n{\r\nreturn nlm_get_core_frequency(0);\r\n}
