acpi_status acpi_set_firmware_waking_vector(u32 physical_address)\r\n{\r\nACPI_FUNCTION_TRACE(acpi_set_firmware_waking_vector);\r\nacpi_gbl_FACS->firmware_waking_vector = physical_address;\r\nif ((acpi_gbl_FACS->length > 32) && (acpi_gbl_FACS->version >= 1)) {\r\nacpi_gbl_FACS->xfirmware_waking_vector = 0;\r\n}\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status acpi_set_firmware_waking_vector64(u64 physical_address)\r\n{\r\nACPI_FUNCTION_TRACE(acpi_set_firmware_waking_vector64);\r\nif ((acpi_gbl_FACS->length <= 32) || (acpi_gbl_FACS->version < 1)) {\r\nreturn_ACPI_STATUS(AE_NOT_EXIST);\r\n}\r\nacpi_gbl_FACS->firmware_waking_vector = 0;\r\nacpi_gbl_FACS->xfirmware_waking_vector = physical_address;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status asmlinkage acpi_enter_sleep_state_s4bios(void)\r\n{\r\nu32 in_value;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_enter_sleep_state_s4bios);\r\nstatus =\r\nacpi_write_bit_register(ACPI_BITREG_WAKE_STATUS, ACPI_CLEAR_STATUS);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_hw_clear_acpi_status();\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_hw_disable_all_gpes();\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_gbl_system_awake_and_running = FALSE;\r\nstatus = acpi_hw_enable_all_wakeup_gpes();\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nACPI_FLUSH_CPU_CACHE();\r\nstatus = acpi_hw_write_port(acpi_gbl_FADT.smi_command,\r\n(u32)acpi_gbl_FADT.S4bios_request, 8);\r\ndo {\r\nacpi_os_stall(1000);\r\nstatus =\r\nacpi_read_bit_register(ACPI_BITREG_WAKE_STATUS, &in_value);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\n} while (!in_value);\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nstatic acpi_status\r\nacpi_hw_sleep_dispatch(u8 sleep_state, u8 flags, u32 function_id)\r\n{\r\nacpi_status status;\r\nstruct acpi_sleep_functions *sleep_functions =\r\n&acpi_sleep_dispatch[function_id];\r\n#if (!ACPI_REDUCED_HARDWARE)\r\nif (acpi_gbl_reduced_hardware || acpi_gbl_FADT.sleep_control.address) {\r\nstatus = sleep_functions->extended_function(sleep_state, flags);\r\n} else {\r\nstatus = sleep_functions->legacy_function(sleep_state, flags);\r\n}\r\nreturn (status);\r\n#else\r\nstatus = sleep_functions->extended_function(sleep_state, flags);\r\nreturn (status);\r\n#endif\r\n}\r\nacpi_status acpi_enter_sleep_state_prep(u8 sleep_state)\r\n{\r\nacpi_status status;\r\nstruct acpi_object_list arg_list;\r\nunion acpi_object arg;\r\nu32 sst_value;\r\nACPI_FUNCTION_TRACE(acpi_enter_sleep_state_prep);\r\nstatus = acpi_get_sleep_type_data(sleep_state,\r\n&acpi_gbl_sleep_type_a,\r\n&acpi_gbl_sleep_type_b);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\narg_list.count = 1;\r\narg_list.pointer = &arg;\r\narg.type = ACPI_TYPE_INTEGER;\r\narg.integer.value = sleep_state;\r\nstatus =\r\nacpi_evaluate_object(NULL, METHOD_PATHNAME__PTS, &arg_list, NULL);\r\nif (ACPI_FAILURE(status) && status != AE_NOT_FOUND) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nswitch (sleep_state) {\r\ncase ACPI_STATE_S0:\r\nsst_value = ACPI_SST_WORKING;\r\nbreak;\r\ncase ACPI_STATE_S1:\r\ncase ACPI_STATE_S2:\r\ncase ACPI_STATE_S3:\r\nsst_value = ACPI_SST_SLEEPING;\r\nbreak;\r\ncase ACPI_STATE_S4:\r\nsst_value = ACPI_SST_SLEEP_CONTEXT;\r\nbreak;\r\ndefault:\r\nsst_value = ACPI_SST_INDICATOR_OFF;\r\nbreak;\r\n}\r\nacpi_hw_execute_sleep_method(METHOD_PATHNAME__SST, sst_value);\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status asmlinkage acpi_enter_sleep_state(u8 sleep_state, u8 flags)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_enter_sleep_state);\r\nif ((acpi_gbl_sleep_type_a > ACPI_SLEEP_TYPE_MAX) ||\r\n(acpi_gbl_sleep_type_b > ACPI_SLEEP_TYPE_MAX)) {\r\nACPI_ERROR((AE_INFO, "Sleep values out of range: A=0x%X B=0x%X",\r\nacpi_gbl_sleep_type_a, acpi_gbl_sleep_type_b));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_VALUE);\r\n}\r\nstatus =\r\nacpi_hw_sleep_dispatch(sleep_state, flags, ACPI_SLEEP_FUNCTION_ID);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_leave_sleep_state_prep(u8 sleep_state, u8 flags)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_leave_sleep_state_prep);\r\nstatus =\r\nacpi_hw_sleep_dispatch(sleep_state, flags,\r\nACPI_WAKE_PREP_FUNCTION_ID);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_leave_sleep_state(u8 sleep_state)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_leave_sleep_state);\r\nstatus = acpi_hw_sleep_dispatch(sleep_state, 0, ACPI_WAKE_FUNCTION_ID);\r\nreturn_ACPI_STATUS(status);\r\n}
