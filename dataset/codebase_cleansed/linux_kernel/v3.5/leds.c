short sequoia_read(int addr) {\r\noutw(addr,0x24);\r\nreturn inw(0x26);\r\n}\r\nvoid sequoia_write(short value,short addr) {\r\noutw(addr,0x24);\r\noutw(value,0x26);\r\n}\r\nstatic void sequoia_leds_event(led_event_t evt)\r\n{\r\nunsigned long flags;\r\nraw_spin_lock_irqsave(&leds_lock, flags);\r\nhw_led_state = sequoia_read(0x09);\r\nswitch (evt) {\r\ncase led_start:\r\nhw_led_state |= SEQUOIA_LED_GREEN;\r\nhw_led_state |= SEQUOIA_LED_AMBER;\r\n#ifdef CONFIG_LEDS_CPU\r\nhw_led_state |= SEQUOIA_LED_BACK;\r\n#else\r\nhw_led_state &= ~SEQUOIA_LED_BACK;\r\n#endif\r\nled_state |= LED_STATE_ENABLED;\r\nbreak;\r\ncase led_stop:\r\nhw_led_state &= ~SEQUOIA_LED_BACK;\r\nhw_led_state |= SEQUOIA_LED_GREEN;\r\nhw_led_state |= SEQUOIA_LED_AMBER;\r\nled_state &= ~LED_STATE_ENABLED;\r\nbreak;\r\ncase led_claim:\r\nled_state |= LED_STATE_CLAIMED;\r\nsaved_state = hw_led_state;\r\nhw_led_state &= ~SEQUOIA_LED_BACK;\r\nhw_led_state |= SEQUOIA_LED_GREEN;\r\nhw_led_state |= SEQUOIA_LED_AMBER;\r\nbreak;\r\ncase led_release:\r\nled_state &= ~LED_STATE_CLAIMED;\r\nhw_led_state = saved_state;\r\nbreak;\r\n#ifdef CONFIG_LEDS_TIMER\r\ncase led_timer:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state ^= SEQUOIA_LED_GREEN;\r\nbreak;\r\n#endif\r\n#ifdef CONFIG_LEDS_CPU\r\ncase led_idle_start:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state &= ~SEQUOIA_LED_BACK;\r\nbreak;\r\ncase led_idle_end:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state |= SEQUOIA_LED_BACK;\r\nbreak;\r\n#endif\r\ncase led_green_on:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state &= ~SEQUOIA_LED_GREEN;\r\nbreak;\r\ncase led_green_off:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state |= SEQUOIA_LED_GREEN;\r\nbreak;\r\ncase led_amber_on:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state &= ~SEQUOIA_LED_AMBER;\r\nbreak;\r\ncase led_amber_off:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state |= SEQUOIA_LED_AMBER;\r\nbreak;\r\ncase led_red_on:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state |= SEQUOIA_LED_BACK;\r\nbreak;\r\ncase led_red_off:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state &= ~SEQUOIA_LED_BACK;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (led_state & LED_STATE_ENABLED)\r\nsequoia_write(hw_led_state,0x09);\r\nraw_spin_unlock_irqrestore(&leds_lock, flags);\r\n}\r\nstatic int __init leds_init(void)\r\n{\r\nextern void (*leds_event)(led_event_t);\r\nshort temp;\r\nleds_event = sequoia_leds_event;\r\nrequest_region(0x24,4,"sequoia");\r\ntemp = sequoia_read(0x09);\r\ntemp |= 1<<10;\r\nsequoia_write(temp,0x09);\r\nleds_event(led_start);\r\nreturn 0;\r\n}
