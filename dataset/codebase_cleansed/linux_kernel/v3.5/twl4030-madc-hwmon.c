static ssize_t madc_read(struct device *dev,\r\nstruct device_attribute *devattr, char *buf)\r\n{\r\nstruct sensor_device_attribute *attr = to_sensor_dev_attr(devattr);\r\nstruct twl4030_madc_request req;\r\nlong val;\r\nreq.channels = (1 << attr->index);\r\nreq.method = TWL4030_MADC_SW2;\r\nreq.func_cb = NULL;\r\nval = twl4030_madc_conversion(&req);\r\nif (val < 0)\r\nreturn val;\r\nreturn sprintf(buf, "%d\n", req.rbuf[attr->index]);\r\n}\r\nstatic int __devinit twl4030_madc_hwmon_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nstruct device *hwmon;\r\nret = sysfs_create_group(&pdev->dev.kobj, &twl4030_madc_group);\r\nif (ret)\r\ngoto err_sysfs;\r\nhwmon = hwmon_device_register(&pdev->dev);\r\nif (IS_ERR(hwmon)) {\r\ndev_err(&pdev->dev, "hwmon_device_register failed.\n");\r\nret = PTR_ERR(hwmon);\r\ngoto err_reg;\r\n}\r\nreturn 0;\r\nerr_reg:\r\nsysfs_remove_group(&pdev->dev.kobj, &twl4030_madc_group);\r\nerr_sysfs:\r\nreturn ret;\r\n}\r\nstatic int __devexit twl4030_madc_hwmon_remove(struct platform_device *pdev)\r\n{\r\nhwmon_device_unregister(&pdev->dev);\r\nsysfs_remove_group(&pdev->dev.kobj, &twl4030_madc_group);\r\nreturn 0;\r\n}
