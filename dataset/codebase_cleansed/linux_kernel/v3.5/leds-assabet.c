void assabet_leds_event(led_event_t evt)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nswitch (evt) {\r\ncase led_start:\r\nhw_led_state = ASSABET_BCR_LED_RED | ASSABET_BCR_LED_GREEN;\r\nled_state = LED_STATE_ENABLED;\r\nbreak;\r\ncase led_stop:\r\nled_state &= ~LED_STATE_ENABLED;\r\nhw_led_state = ASSABET_BCR_LED_RED | ASSABET_BCR_LED_GREEN;\r\nASSABET_BCR_frob(ASSABET_BCR_LED_MASK, hw_led_state);\r\nbreak;\r\ncase led_claim:\r\nled_state |= LED_STATE_CLAIMED;\r\nhw_led_state = ASSABET_BCR_LED_RED | ASSABET_BCR_LED_GREEN;\r\nbreak;\r\ncase led_release:\r\nled_state &= ~LED_STATE_CLAIMED;\r\nhw_led_state = ASSABET_BCR_LED_RED | ASSABET_BCR_LED_GREEN;\r\nbreak;\r\n#ifdef CONFIG_LEDS_TIMER\r\ncase led_timer:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state ^= ASSABET_BCR_LED_GREEN;\r\nbreak;\r\n#endif\r\n#ifdef CONFIG_LEDS_CPU\r\ncase led_idle_start:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state |= ASSABET_BCR_LED_RED;\r\nbreak;\r\ncase led_idle_end:\r\nif (!(led_state & LED_STATE_CLAIMED))\r\nhw_led_state &= ~ASSABET_BCR_LED_RED;\r\nbreak;\r\n#endif\r\ncase led_halted:\r\nbreak;\r\ncase led_green_on:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state &= ~ASSABET_BCR_LED_GREEN;\r\nbreak;\r\ncase led_green_off:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state |= ASSABET_BCR_LED_GREEN;\r\nbreak;\r\ncase led_amber_on:\r\nbreak;\r\ncase led_amber_off:\r\nbreak;\r\ncase led_red_on:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state &= ~ASSABET_BCR_LED_RED;\r\nbreak;\r\ncase led_red_off:\r\nif (led_state & LED_STATE_CLAIMED)\r\nhw_led_state |= ASSABET_BCR_LED_RED;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (led_state & LED_STATE_ENABLED)\r\nASSABET_BCR_frob(ASSABET_BCR_LED_MASK, hw_led_state);\r\nlocal_irq_restore(flags);\r\n}
