static void __init ath79_usb_setup(void)\r\n{\r\nvoid __iomem *usb_ctrl_base;\r\nath79_device_reset_set(AR71XX_USB_RESET_MASK);\r\nmdelay(1000);\r\nath79_device_reset_clear(AR71XX_USB_RESET_MASK);\r\nusb_ctrl_base = ioremap(AR71XX_USB_CTRL_BASE, AR71XX_USB_CTRL_SIZE);\r\n__raw_writel(0xf0000, usb_ctrl_base + AR71XX_USB_CTRL_REG_CONFIG);\r\n__raw_writel(0x20c00, usb_ctrl_base + AR71XX_USB_CTRL_REG_FLADJ);\r\niounmap(usb_ctrl_base);\r\nmdelay(900);\r\nath79_ohci_resources[0].start = AR71XX_OHCI_BASE;\r\nath79_ohci_resources[0].end = AR71XX_OHCI_BASE + AR71XX_OHCI_SIZE - 1;\r\nplatform_device_register(&ath79_ohci_device);\r\nath79_ehci_resources[0].start = AR71XX_EHCI_BASE;\r\nath79_ehci_resources[0].end = AR71XX_EHCI_BASE + AR71XX_EHCI_SIZE - 1;\r\nath79_ehci_device.dev.platform_data = &ath79_ehci_pdata_v1;\r\nplatform_device_register(&ath79_ehci_device);\r\n}\r\nstatic void __init ar7240_usb_setup(void)\r\n{\r\nvoid __iomem *usb_ctrl_base;\r\nath79_device_reset_clear(AR7240_RESET_OHCI_DLL);\r\nath79_device_reset_set(AR7240_RESET_USB_HOST);\r\nmdelay(1000);\r\nath79_device_reset_set(AR7240_RESET_OHCI_DLL);\r\nath79_device_reset_clear(AR7240_RESET_USB_HOST);\r\nusb_ctrl_base = ioremap(AR7240_USB_CTRL_BASE, AR7240_USB_CTRL_SIZE);\r\n__raw_writel(0x3, usb_ctrl_base + AR71XX_USB_CTRL_REG_FLADJ);\r\niounmap(usb_ctrl_base);\r\nath79_ohci_resources[0].start = AR7240_OHCI_BASE;\r\nath79_ohci_resources[0].end = AR7240_OHCI_BASE + AR7240_OHCI_SIZE - 1;\r\nplatform_device_register(&ath79_ohci_device);\r\n}\r\nstatic void __init ar724x_usb_setup(void)\r\n{\r\nath79_device_reset_set(AR724X_RESET_USBSUS_OVERRIDE);\r\nmdelay(10);\r\nath79_device_reset_clear(AR724X_RESET_USB_HOST);\r\nmdelay(10);\r\nath79_device_reset_clear(AR724X_RESET_USB_PHY);\r\nmdelay(10);\r\nath79_ehci_resources[0].start = AR724X_EHCI_BASE;\r\nath79_ehci_resources[0].end = AR724X_EHCI_BASE + AR724X_EHCI_SIZE - 1;\r\nath79_ehci_device.dev.platform_data = &ath79_ehci_pdata_v2;\r\nplatform_device_register(&ath79_ehci_device);\r\n}\r\nstatic void __init ar913x_usb_setup(void)\r\n{\r\nath79_device_reset_set(AR913X_RESET_USBSUS_OVERRIDE);\r\nmdelay(10);\r\nath79_device_reset_clear(AR913X_RESET_USB_HOST);\r\nmdelay(10);\r\nath79_device_reset_clear(AR913X_RESET_USB_PHY);\r\nmdelay(10);\r\nath79_ehci_resources[0].start = AR913X_EHCI_BASE;\r\nath79_ehci_resources[0].end = AR913X_EHCI_BASE + AR913X_EHCI_SIZE - 1;\r\nath79_ehci_device.dev.platform_data = &ath79_ehci_pdata_v2;\r\nplatform_device_register(&ath79_ehci_device);\r\n}\r\nstatic void __init ar933x_usb_setup(void)\r\n{\r\nath79_device_reset_set(AR933X_RESET_USBSUS_OVERRIDE);\r\nmdelay(10);\r\nath79_device_reset_clear(AR933X_RESET_USB_HOST);\r\nmdelay(10);\r\nath79_device_reset_clear(AR933X_RESET_USB_PHY);\r\nmdelay(10);\r\nath79_ehci_resources[0].start = AR933X_EHCI_BASE;\r\nath79_ehci_resources[0].end = AR933X_EHCI_BASE + AR933X_EHCI_SIZE - 1;\r\nath79_ehci_device.dev.platform_data = &ath79_ehci_pdata_v2;\r\nplatform_device_register(&ath79_ehci_device);\r\n}\r\nvoid __init ath79_register_usb(void)\r\n{\r\nif (soc_is_ar71xx())\r\nath79_usb_setup();\r\nelse if (soc_is_ar7240())\r\nar7240_usb_setup();\r\nelse if (soc_is_ar7241() || soc_is_ar7242())\r\nar724x_usb_setup();\r\nelse if (soc_is_ar913x())\r\nar913x_usb_setup();\r\nelse if (soc_is_ar933x())\r\nar933x_usb_setup();\r\nelse\r\nBUG();\r\n}
