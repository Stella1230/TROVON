int s5p_mfc_init_shm(struct s5p_mfc_ctx *ctx)\r\n{\r\nstruct s5p_mfc_dev *dev = ctx->dev;\r\nvoid *shm_alloc_ctx = dev->alloc_ctx[MFC_BANK1_ALLOC_CTX];\r\nctx->shm_alloc = vb2_dma_contig_memops.alloc(shm_alloc_ctx,\r\nSHARED_BUF_SIZE);\r\nif (IS_ERR(ctx->shm_alloc)) {\r\nmfc_err("failed to allocate shared memory\n");\r\nreturn PTR_ERR(ctx->shm_alloc);\r\n}\r\nctx->shm_ofs = s5p_mfc_mem_cookie(shm_alloc_ctx, ctx->shm_alloc)\r\n- dev->bank1;\r\nBUG_ON(ctx->shm_ofs & ((1 << MFC_BANK1_ALIGN_ORDER) - 1));\r\nctx->shm = vb2_dma_contig_memops.vaddr(ctx->shm_alloc);\r\nif (!ctx->shm) {\r\nvb2_dma_contig_memops.put(ctx->shm_alloc);\r\nctx->shm_ofs = 0;\r\nctx->shm_alloc = NULL;\r\nmfc_err("failed to virt addr of shared memory\n");\r\nreturn -ENOMEM;\r\n}\r\nmemset((void *)ctx->shm, 0, SHARED_BUF_SIZE);\r\nwmb();\r\nreturn 0;\r\n}
