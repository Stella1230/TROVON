acpi_status acpi_hw_set_mode(u32 mode)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(hw_set_mode);\r\nif (!acpi_gbl_FADT.smi_command) {\r\nACPI_ERROR((AE_INFO,\r\n"No SMI_CMD in FADT, mode transition failed"));\r\nreturn_ACPI_STATUS(AE_NO_HARDWARE_RESPONSE);\r\n}\r\nif (!acpi_gbl_FADT.acpi_enable && !acpi_gbl_FADT.acpi_disable) {\r\nACPI_ERROR((AE_INFO,\r\n"No ACPI mode transition supported in this system "\r\n"(enable/disable both zero)"));\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nswitch (mode) {\r\ncase ACPI_SYS_MODE_ACPI:\r\nstatus = acpi_hw_write_port(acpi_gbl_FADT.smi_command,\r\n(u32) acpi_gbl_FADT.acpi_enable, 8);\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"Attempting to enable ACPI mode\n"));\r\nbreak;\r\ncase ACPI_SYS_MODE_LEGACY:\r\nstatus = acpi_hw_write_port(acpi_gbl_FADT.smi_command,\r\n(u32) acpi_gbl_FADT.acpi_disable,\r\n8);\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"Attempting to enable Legacy (non-ACPI) mode\n"));\r\nbreak;\r\ndefault:\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Could not write ACPI mode change"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nu32 acpi_hw_get_mode(void)\r\n{\r\nacpi_status status;\r\nu32 value;\r\nACPI_FUNCTION_TRACE(hw_get_mode);\r\nif (!acpi_gbl_FADT.smi_command) {\r\nreturn_UINT32(ACPI_SYS_MODE_ACPI);\r\n}\r\nstatus = acpi_read_bit_register(ACPI_BITREG_SCI_ENABLE, &value);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_UINT32(ACPI_SYS_MODE_LEGACY);\r\n}\r\nif (value) {\r\nreturn_UINT32(ACPI_SYS_MODE_ACPI);\r\n} else {\r\nreturn_UINT32(ACPI_SYS_MODE_LEGACY);\r\n}\r\n}
