static int mx27_3ds_sdhc1_init(struct device *dev, irq_handler_t detect_irq,\r\nvoid *data)\r\n{\r\nreturn request_irq(gpio_to_irq(SD1_CD), detect_irq,\r\nIRQF_TRIGGER_FALLING | IRQF_TRIGGER_RISING, "sdhc1-card-detect", data);\r\n}\r\nstatic void mx27_3ds_sdhc1_exit(struct device *dev, void *data)\r\n{\r\nfree_irq(gpio_to_irq(SD1_CD), data);\r\n}\r\nstatic void mx27_3ds_sdhc1_enable_level_translator(void)\r\n{\r\ngpio_request(SD1_EN_GPIO, "sd1_enable");\r\ngpio_direction_output(SD1_EN_GPIO, 1);\r\n}\r\nstatic int otg_phy_init(void)\r\n{\r\ngpio_request(OTG_PHY_RESET_GPIO, "usb-otg-reset");\r\ngpio_direction_output(OTG_PHY_RESET_GPIO, 0);\r\nmdelay(1);\r\ngpio_set_value(OTG_PHY_RESET_GPIO, 1);\r\nreturn 0;\r\n}\r\nstatic int mx27_3ds_otg_init(struct platform_device *pdev)\r\n{\r\nreturn mx27_initialize_usb_hw(pdev->id, MXC_EHCI_INTERFACE_DIFF_UNI);\r\n}\r\nstatic int __init mx27_3ds_otg_mode(char *options)\r\n{\r\nif (!strcmp(options, "host"))\r\notg_mode_host = 1;\r\nelse if (!strcmp(options, "device"))\r\notg_mode_host = 0;\r\nelse\r\npr_info("otg_mode neither \"host\" nor \"device\". "\r\n"Defaulting to device\n");\r\nreturn 0;\r\n}\r\nstatic int mx27_3ds_camera_power(struct device *dev, int on)\r\n{\r\npr_debug("%s: %s the camera\n", __func__, on ? "ENABLE" : "DISABLE");\r\ngpio_set_value(CSI_PWRDWN, on ? 0 : 1);\r\nif (!on)\r\ngoto out;\r\ngpio_set_value(CSI_RESET, 0);\r\nmsleep(20);\r\ngpio_set_value(CSI_RESET, 1);\r\nmsleep(100);\r\nout:\r\nreturn 0;\r\n}\r\nstatic void __init mx27pdk_init(void)\r\n{\r\nint ret;\r\nimx27_soc_init();\r\nmxc_gpio_setup_multiple_pins(mx27pdk_pins, ARRAY_SIZE(mx27pdk_pins),\r\n"mx27pdk");\r\nmx27_3ds_sdhc1_enable_level_translator();\r\nimx27_add_imx_uart0(&uart_pdata);\r\nimx27_add_fec(NULL);\r\nimx27_add_imx_keypad(&mx27_3ds_keymap_data);\r\nimx27_add_mxc_mmc(0, &sdhc1_pdata);\r\nimx27_add_imx2_wdt(NULL);\r\notg_phy_init();\r\nif (otg_mode_host) {\r\notg_pdata.otg = imx_otg_ulpi_create(ULPI_OTG_DRVVBUS |\r\nULPI_OTG_DRVVBUS_EXT);\r\nif (otg_pdata.otg)\r\nimx27_add_mxc_ehci_otg(&otg_pdata);\r\n}\r\nif (!otg_mode_host)\r\nimx27_add_fsl_usb2_udc(&otg_device_pdata);\r\nimx27_add_spi_imx1(&spi2_pdata);\r\nimx27_add_spi_imx0(&spi1_pdata);\r\nspi_register_board_info(mx27_3ds_spi_devs,\r\nARRAY_SIZE(mx27_3ds_spi_devs));\r\nif (mxc_expio_init(MX27_CS5_BASE_ADDR, EXPIO_PARENT_INT))\r\npr_warn("Init of the debugboard failed, all devices on the debugboard are unusable.\n");\r\nimx27_add_imx_i2c(0, &mx27_3ds_i2c0_data);\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\nimx27_add_imx_fb(&mx27_3ds_fb_data);\r\nret = gpio_request_array(mx27_3ds_camera_gpios,\r\nARRAY_SIZE(mx27_3ds_camera_gpios));\r\nif (ret) {\r\npr_err("Failed to request camera gpios");\r\niclink_ov2640.power = NULL;\r\n}\r\nimx27_add_mx2_camera(&mx27_3ds_cam_pdata);\r\n}\r\nstatic void __init mx27pdk_timer_init(void)\r\n{\r\nmx27_clocks_init(26000000);\r\n}
