static inline void mac0_int_dispatch(void) { do_IRQ(MSP_INT_MAC0); }\r\nstatic inline void mac1_int_dispatch(void) { do_IRQ(MSP_INT_MAC1); }\r\nstatic inline void mac2_int_dispatch(void) { do_IRQ(MSP_INT_SAR); }\r\nstatic inline void usb_int_dispatch(void) { do_IRQ(MSP_INT_USB); }\r\nstatic inline void sec_int_dispatch(void) { do_IRQ(MSP_INT_SEC); }\r\nasmlinkage void plat_irq_dispatch(struct pt_regs *regs)\r\n{\r\nu32 pending;\r\npending = read_c0_status() & read_c0_cause();\r\n#ifdef CONFIG_IRQ_MSP_CIC\r\nif (pending & C_IRQ4)\r\nmsp_cic_irq_dispatch();\r\nelse if (pending & C_IRQ0)\r\ndo_IRQ(MSP_INT_MAC0);\r\nelse if (pending & C_IRQ1)\r\ndo_IRQ(MSP_INT_MAC1);\r\nelse if (pending & C_IRQ2)\r\ndo_IRQ(MSP_INT_USB);\r\nelse if (pending & C_IRQ3)\r\ndo_IRQ(MSP_INT_SAR);\r\nelse if (pending & C_IRQ5)\r\ndo_IRQ(MSP_INT_SEC);\r\n#else\r\nif (pending & C_IRQ5)\r\ndo_IRQ(MSP_INT_TIMER);\r\nelse if (pending & C_IRQ0)\r\ndo_IRQ(MSP_INT_MAC0);\r\nelse if (pending & C_IRQ1)\r\ndo_IRQ(MSP_INT_MAC1);\r\nelse if (pending & C_IRQ3)\r\ndo_IRQ(MSP_INT_VE);\r\nelse if (pending & C_IRQ4)\r\nmsp_slp_irq_dispatch();\r\n#endif\r\nelse if (pending & C_SW0)\r\ndo_IRQ(MSP_INT_SW0);\r\nelse if (pending & C_SW1)\r\ndo_IRQ(MSP_INT_SW1);\r\n}\r\nvoid __init arch_init_irq(void)\r\n{\r\n#ifdef CONFIG_MIPS_MT\r\nBUG_ON(!cpu_has_vint);\r\n#endif\r\nmips_cpu_irq_init();\r\n#ifdef CONFIG_IRQ_MSP_CIC\r\nmsp_cic_irq_init();\r\n#ifdef CONFIG_MIPS_MT\r\nset_vi_handler(MSP_INT_CIC, msp_cic_irq_dispatch);\r\nset_vi_handler(MSP_INT_MAC0, mac0_int_dispatch);\r\nset_vi_handler(MSP_INT_MAC1, mac1_int_dispatch);\r\nset_vi_handler(MSP_INT_SAR, mac2_int_dispatch);\r\nset_vi_handler(MSP_INT_USB, usb_int_dispatch);\r\nset_vi_handler(MSP_INT_SEC, sec_int_dispatch);\r\n#ifdef CONFIG_MIPS_MT_SMP\r\nmsp_vsmp_int_init();\r\n#elif defined CONFIG_MIPS_MT_SMTC\r\nirq_hwmask[MSP_INT_MAC0] = C_IRQ0;\r\nirq_hwmask[MSP_INT_MAC1] = C_IRQ1;\r\nirq_hwmask[MSP_INT_USB] = C_IRQ2;\r\nirq_hwmask[MSP_INT_SAR] = C_IRQ3;\r\nirq_hwmask[MSP_INT_SEC] = C_IRQ5;\r\n#endif\r\n#endif\r\nsetup_irq(MSP_INT_CIC, &cic_cascade_msp);\r\nsetup_irq(MSP_INT_PER, &per_cascade_msp);\r\n#else\r\nmsp_slp_irq_init();\r\nsetup_irq(MSP_INT_SLP, &cic_cascade_msp);\r\nsetup_irq(MSP_INT_PER, &per_cascade_msp);\r\n#endif\r\n}
