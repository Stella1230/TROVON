acpi_status acpi_ex_system_wait_semaphore(acpi_semaphore semaphore, u16 timeout)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ex_system_wait_semaphore);\r\nstatus = acpi_os_wait_semaphore(semaphore, 1, ACPI_DO_NOT_WAIT);\r\nif (ACPI_SUCCESS(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (status == AE_TIME) {\r\nacpi_ex_relinquish_interpreter();\r\nstatus = acpi_os_wait_semaphore(semaphore, 1, timeout);\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"*** Thread awake after blocking, %s\n",\r\nacpi_format_exception(status)));\r\nacpi_ex_reacquire_interpreter();\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_system_wait_mutex(acpi_mutex mutex, u16 timeout)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ex_system_wait_mutex);\r\nstatus = acpi_os_acquire_mutex(mutex, ACPI_DO_NOT_WAIT);\r\nif (ACPI_SUCCESS(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (status == AE_TIME) {\r\nacpi_ex_relinquish_interpreter();\r\nstatus = acpi_os_acquire_mutex(mutex, timeout);\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"*** Thread awake after blocking, %s\n",\r\nacpi_format_exception(status)));\r\nacpi_ex_reacquire_interpreter();\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_system_do_stall(u32 how_long)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_ENTRY();\r\nif (how_long > 255) {\r\nACPI_ERROR((AE_INFO, "Time parameter is too large (%u)",\r\nhow_long));\r\nstatus = AE_AML_OPERAND_VALUE;\r\n} else {\r\nacpi_os_stall(how_long);\r\n}\r\nreturn (status);\r\n}\r\nacpi_status acpi_ex_system_do_sleep(u64 how_long)\r\n{\r\nACPI_FUNCTION_ENTRY();\r\nacpi_ex_relinquish_interpreter();\r\nif (how_long > ACPI_MAX_SLEEP) {\r\nhow_long = ACPI_MAX_SLEEP;\r\n}\r\nacpi_os_sleep(how_long);\r\nacpi_ex_reacquire_interpreter();\r\nreturn (AE_OK);\r\n}\r\nacpi_status acpi_ex_system_signal_event(union acpi_operand_object * obj_desc)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(ex_system_signal_event);\r\nif (obj_desc) {\r\nstatus =\r\nacpi_os_signal_semaphore(obj_desc->event.os_semaphore, 1);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_system_wait_event(union acpi_operand_object *time_desc,\r\nunion acpi_operand_object *obj_desc)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(ex_system_wait_event);\r\nif (obj_desc) {\r\nstatus =\r\nacpi_ex_system_wait_semaphore(obj_desc->event.os_semaphore,\r\n(u16) time_desc->integer.\r\nvalue);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_system_reset_event(union acpi_operand_object *obj_desc)\r\n{\r\nacpi_status status = AE_OK;\r\nacpi_semaphore temp_semaphore;\r\nACPI_FUNCTION_ENTRY();\r\nstatus =\r\nacpi_os_create_semaphore(ACPI_NO_UNIT_LIMIT, 0, &temp_semaphore);\r\nif (ACPI_SUCCESS(status)) {\r\n(void)acpi_os_delete_semaphore(obj_desc->event.os_semaphore);\r\nobj_desc->event.os_semaphore = temp_semaphore;\r\n}\r\nreturn (status);\r\n}
