static void vt8500_power_off(void)\r\n{\r\nlocal_irq_disable();\r\nwritew(5, pmc_hiber);\r\nasm("mcr%? p15, 0, %0, c7, c0, 4" : : "r" (0));\r\n}\r\nvoid __init wm8505_7in_init(void)\r\n{\r\n#ifdef CONFIG_FB_WM8505\r\nvoid __iomem *gpio_mux_reg = ioremap(wmt_gpio_base + 0x200, 4);\r\nif (gpio_mux_reg) {\r\nwritel(readl(gpio_mux_reg) | 0x80000000, gpio_mux_reg);\r\niounmap(gpio_mux_reg);\r\n} else {\r\nprintk(KERN_ERR "Could not remap the GPIO mux register, display may not work properly!\n");\r\n}\r\n#endif\r\npmc_hiber = ioremap(wmt_pmc_base + 0x12, 2);\r\nif (pmc_hiber)\r\npm_power_off = &vt8500_power_off;\r\nelse\r\nprintk(KERN_ERR "PMC Hibernation register could not be remapped, not enabling power off!\n");\r\nwm8505_set_resources();\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\nvt8500_gpio_init();\r\n}
