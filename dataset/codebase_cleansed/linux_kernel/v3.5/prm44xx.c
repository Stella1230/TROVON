u32 omap4_prm_read_inst_reg(s16 inst, u16 reg)\r\n{\r\nreturn __raw_readl(OMAP44XX_PRM_REGADDR(inst, reg));\r\n}\r\nvoid omap4_prm_write_inst_reg(u32 val, s16 inst, u16 reg)\r\n{\r\n__raw_writel(val, OMAP44XX_PRM_REGADDR(inst, reg));\r\n}\r\nu32 omap4_prm_rmw_inst_reg_bits(u32 mask, u32 bits, s16 inst, s16 reg)\r\n{\r\nu32 v;\r\nv = omap4_prm_read_inst_reg(inst, reg);\r\nv &= ~mask;\r\nv |= bits;\r\nomap4_prm_write_inst_reg(v, inst, reg);\r\nreturn v;\r\n}\r\nu32 omap4_prm_vp_check_txdone(u8 vp_id)\r\n{\r\nstruct omap4_vp *vp = &omap4_vp[vp_id];\r\nu32 irqstatus;\r\nirqstatus = omap4_prminst_read_inst_reg(OMAP4430_PRM_PARTITION,\r\nOMAP4430_PRM_OCP_SOCKET_INST,\r\nvp->irqstatus_mpu);\r\nreturn irqstatus & vp->tranxdone_status;\r\n}\r\nvoid omap4_prm_vp_clear_txdone(u8 vp_id)\r\n{\r\nstruct omap4_vp *vp = &omap4_vp[vp_id];\r\nomap4_prminst_write_inst_reg(vp->tranxdone_status,\r\nOMAP4430_PRM_PARTITION,\r\nOMAP4430_PRM_OCP_SOCKET_INST,\r\nvp->irqstatus_mpu);\r\n}\r\nu32 omap4_prm_vcvp_read(u8 offset)\r\n{\r\nreturn omap4_prminst_read_inst_reg(OMAP4430_PRM_PARTITION,\r\nOMAP4430_PRM_DEVICE_INST, offset);\r\n}\r\nvoid omap4_prm_vcvp_write(u32 val, u8 offset)\r\n{\r\nomap4_prminst_write_inst_reg(val, OMAP4430_PRM_PARTITION,\r\nOMAP4430_PRM_DEVICE_INST, offset);\r\n}\r\nu32 omap4_prm_vcvp_rmw(u32 mask, u32 bits, u8 offset)\r\n{\r\nreturn omap4_prminst_rmw_inst_reg_bits(mask, bits,\r\nOMAP4430_PRM_PARTITION,\r\nOMAP4430_PRM_DEVICE_INST,\r\noffset);\r\n}\r\nstatic inline u32 _read_pending_irq_reg(u16 irqen_offs, u16 irqst_offs)\r\n{\r\nu32 mask, st;\r\nmask = omap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST,\r\nirqen_offs);\r\nst = omap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST, irqst_offs);\r\nreturn mask & st;\r\n}\r\nvoid omap44xx_prm_read_pending_irqs(unsigned long *events)\r\n{\r\nevents[0] = _read_pending_irq_reg(OMAP4_PRM_IRQENABLE_MPU_OFFSET,\r\nOMAP4_PRM_IRQSTATUS_MPU_OFFSET);\r\nevents[1] = _read_pending_irq_reg(OMAP4_PRM_IRQENABLE_MPU_2_OFFSET,\r\nOMAP4_PRM_IRQSTATUS_MPU_2_OFFSET);\r\n}\r\nvoid omap44xx_prm_ocp_barrier(void)\r\n{\r\nomap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_REVISION_PRM_OFFSET);\r\n}\r\nvoid omap44xx_prm_save_and_clear_irqen(u32 *saved_mask)\r\n{\r\nsaved_mask[0] =\r\nomap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQSTATUS_MPU_OFFSET);\r\nsaved_mask[1] =\r\nomap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQSTATUS_MPU_2_OFFSET);\r\nomap4_prm_write_inst_reg(0, OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQENABLE_MPU_OFFSET);\r\nomap4_prm_write_inst_reg(0, OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQENABLE_MPU_2_OFFSET);\r\nomap4_prm_read_inst_reg(OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_REVISION_PRM_OFFSET);\r\n}\r\nvoid omap44xx_prm_restore_irqen(u32 *saved_mask)\r\n{\r\nomap4_prm_write_inst_reg(saved_mask[0], OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQENABLE_MPU_OFFSET);\r\nomap4_prm_write_inst_reg(saved_mask[1], OMAP4430_PRM_OCP_SOCKET_INST,\r\nOMAP4_PRM_IRQENABLE_MPU_2_OFFSET);\r\n}\r\nstatic int __init omap4xxx_prcm_init(void)\r\n{\r\nif (cpu_is_omap44xx())\r\nreturn omap_prcm_register_chain_handler(&omap4_prcm_irq_setup);\r\nreturn 0;\r\n}
