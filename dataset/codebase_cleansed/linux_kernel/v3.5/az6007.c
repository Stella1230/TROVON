static int drxk_gate_ctrl(struct dvb_frontend *fe, int enable)\r\n{\r\nstruct dvb_usb_adapter *adap = fe->sec_priv;\r\nstruct az6007_device_state *st;\r\nint status = 0;\r\ndeb_info("%s: %s\n", __func__, enable ? "enable" : "disable");\r\nif (!adap)\r\nreturn -EINVAL;\r\nst = adap->dev->priv;\r\nif (!st)\r\nreturn -EINVAL;\r\nif (enable)\r\nstatus = st->gate_ctrl(fe, 1);\r\nelse\r\nstatus = st->gate_ctrl(fe, 0);\r\nreturn status;\r\n}\r\nstatic int __az6007_read(struct usb_device *udev, u8 req, u16 value,\r\nu16 index, u8 *b, int blen)\r\n{\r\nint ret;\r\nret = usb_control_msg(udev,\r\nusb_rcvctrlpipe(udev, 0),\r\nreq,\r\nUSB_TYPE_VENDOR | USB_DIR_IN,\r\nvalue, index, b, blen, 5000);\r\nif (ret < 0) {\r\nwarn("usb read operation failed. (%d)", ret);\r\nreturn -EIO;\r\n}\r\ndeb_xfer("in: req. %02x, val: %04x, ind: %04x, buffer: ", req, value,\r\nindex);\r\ndebug_dump(b, blen, deb_xfer);\r\nreturn ret;\r\n}\r\nstatic int az6007_read(struct dvb_usb_device *d, u8 req, u16 value,\r\nu16 index, u8 *b, int blen)\r\n{\r\nstruct az6007_device_state *st = d->priv;\r\nint ret;\r\nif (mutex_lock_interruptible(&st->mutex) < 0)\r\nreturn -EAGAIN;\r\nret = __az6007_read(d->udev, req, value, index, b, blen);\r\nmutex_unlock(&st->mutex);\r\nreturn ret;\r\n}\r\nstatic int __az6007_write(struct usb_device *udev, u8 req, u16 value,\r\nu16 index, u8 *b, int blen)\r\n{\r\nint ret;\r\ndeb_xfer("out: req. %02x, val: %04x, ind: %04x, buffer: ", req, value,\r\nindex);\r\ndebug_dump(b, blen, deb_xfer);\r\nif (blen > 64) {\r\nerr("az6007: tried to write %d bytes, but I2C max size is 64 bytes\n",\r\nblen);\r\nreturn -EOPNOTSUPP;\r\n}\r\nret = usb_control_msg(udev,\r\nusb_sndctrlpipe(udev, 0),\r\nreq,\r\nUSB_TYPE_VENDOR | USB_DIR_OUT,\r\nvalue, index, b, blen, 5000);\r\nif (ret != blen) {\r\nerr("usb write operation failed. (%d)", ret);\r\nreturn -EIO;\r\n}\r\nreturn 0;\r\n}\r\nstatic int az6007_write(struct dvb_usb_device *d, u8 req, u16 value,\r\nu16 index, u8 *b, int blen)\r\n{\r\nstruct az6007_device_state *st = d->priv;\r\nint ret;\r\nif (mutex_lock_interruptible(&st->mutex) < 0)\r\nreturn -EAGAIN;\r\nret = __az6007_write(d->udev, req, value, index, b, blen);\r\nmutex_unlock(&st->mutex);\r\nreturn ret;\r\n}\r\nstatic int az6007_streaming_ctrl(struct dvb_usb_adapter *adap, int onoff)\r\n{\r\nstruct dvb_usb_device *d = adap->dev;\r\ndeb_info("%s: %s", __func__, onoff ? "enable" : "disable");\r\nreturn az6007_write(d, 0xbc, onoff, 0, NULL, 0);\r\n}\r\nstatic int az6007_rc_query(struct dvb_usb_device *d)\r\n{\r\nstruct az6007_device_state *st = d->priv;\r\nunsigned code = 0;\r\naz6007_read(d, AZ6007_READ_IR, 0, 0, st->data, 10);\r\nif (st->data[1] == 0x44)\r\nreturn 0;\r\nif ((st->data[1] ^ st->data[2]) == 0xff)\r\ncode = st->data[1];\r\nelse\r\ncode = st->data[1] << 8 | st->data[2];\r\nif ((st->data[3] ^ st->data[4]) == 0xff)\r\ncode = code << 8 | st->data[3];\r\nelse\r\ncode = code << 16 | st->data[3] << 8 | st->data[4];\r\nrc_keydown(d->rc_dev, code, st->data[5]);\r\nreturn 0;\r\n}\r\nstatic int az6007_ci_read_attribute_mem(struct dvb_ca_en50221 *ca,\r\nint slot,\r\nint address)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\nu8 *b;\r\nif (slot != 0)\r\nreturn -EINVAL;\r\nb = kmalloc(12, GFP_KERNEL);\r\nif (!b)\r\nreturn -ENOMEM;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC1;\r\nvalue = address;\r\nindex = 0;\r\nblen = 1;\r\nret = az6007_read(d, req, value, index, b, blen);\r\nif (ret < 0) {\r\nwarn("usb in operation failed. (%d)", ret);\r\nret = -EINVAL;\r\n} else {\r\nret = b[0];\r\n}\r\nmutex_unlock(&state->ca_mutex);\r\nkfree(b);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_write_attribute_mem(struct dvb_ca_en50221 *ca,\r\nint slot,\r\nint address,\r\nu8 value)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value1;\r\nu16 index;\r\nint blen;\r\ndeb_info("%s %d", __func__, slot);\r\nif (slot != 0)\r\nreturn -EINVAL;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC2;\r\nvalue1 = address;\r\nindex = value;\r\nblen = 0;\r\nret = az6007_write(d, req, value1, index, NULL, blen);\r\nif (ret != 0)\r\nwarn("usb out operation failed. (%d)", ret);\r\nmutex_unlock(&state->ca_mutex);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_read_cam_control(struct dvb_ca_en50221 *ca,\r\nint slot,\r\nu8 address)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\nu8 *b;\r\nif (slot != 0)\r\nreturn -EINVAL;\r\nb = kmalloc(12, GFP_KERNEL);\r\nif (!b)\r\nreturn -ENOMEM;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC3;\r\nvalue = address;\r\nindex = 0;\r\nblen = 2;\r\nret = az6007_read(d, req, value, index, b, blen);\r\nif (ret < 0) {\r\nwarn("usb in operation failed. (%d)", ret);\r\nret = -EINVAL;\r\n} else {\r\nif (b[0] == 0)\r\nwarn("Read CI IO error");\r\nret = b[1];\r\ndeb_info("read cam data = %x from 0x%x", b[1], value);\r\n}\r\nmutex_unlock(&state->ca_mutex);\r\nkfree(b);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_write_cam_control(struct dvb_ca_en50221 *ca,\r\nint slot,\r\nu8 address,\r\nu8 value)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value1;\r\nu16 index;\r\nint blen;\r\nif (slot != 0)\r\nreturn -EINVAL;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC4;\r\nvalue1 = address;\r\nindex = value;\r\nblen = 0;\r\nret = az6007_write(d, req, value1, index, NULL, blen);\r\nif (ret != 0) {\r\nwarn("usb out operation failed. (%d)", ret);\r\ngoto failed;\r\n}\r\nfailed:\r\nmutex_unlock(&state->ca_mutex);\r\nreturn ret;\r\n}\r\nstatic int CI_CamReady(struct dvb_ca_en50221 *ca, int slot)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nint ret;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\nu8 *b;\r\nb = kmalloc(12, GFP_KERNEL);\r\nif (!b)\r\nreturn -ENOMEM;\r\nreq = 0xC8;\r\nvalue = 0;\r\nindex = 0;\r\nblen = 1;\r\nret = az6007_read(d, req, value, index, b, blen);\r\nif (ret < 0) {\r\nwarn("usb in operation failed. (%d)", ret);\r\nret = -EIO;\r\n} else{\r\nret = b[0];\r\n}\r\nkfree(b);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_slot_reset(struct dvb_ca_en50221 *ca, int slot)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret, i;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC6;\r\nvalue = 1;\r\nindex = 0;\r\nblen = 0;\r\nret = az6007_write(d, req, value, index, NULL, blen);\r\nif (ret != 0) {\r\nwarn("usb out operation failed. (%d)", ret);\r\ngoto failed;\r\n}\r\nmsleep(500);\r\nreq = 0xC6;\r\nvalue = 0;\r\nindex = 0;\r\nblen = 0;\r\nret = az6007_write(d, req, value, index, NULL, blen);\r\nif (ret != 0) {\r\nwarn("usb out operation failed. (%d)", ret);\r\ngoto failed;\r\n}\r\nfor (i = 0; i < 15; i++) {\r\nmsleep(100);\r\nif (CI_CamReady(ca, slot)) {\r\ndeb_info("CAM Ready");\r\nbreak;\r\n}\r\n}\r\nmsleep(5000);\r\nfailed:\r\nmutex_unlock(&state->ca_mutex);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_slot_shutdown(struct dvb_ca_en50221 *ca, int slot)\r\n{\r\nreturn 0;\r\n}\r\nstatic int az6007_ci_slot_ts_enable(struct dvb_ca_en50221 *ca, int slot)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\ndeb_info("%s", __func__);\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC7;\r\nvalue = 1;\r\nindex = 0;\r\nblen = 0;\r\nret = az6007_write(d, req, value, index, NULL, blen);\r\nif (ret != 0) {\r\nwarn("usb out operation failed. (%d)", ret);\r\ngoto failed;\r\n}\r\nfailed:\r\nmutex_unlock(&state->ca_mutex);\r\nreturn ret;\r\n}\r\nstatic int az6007_ci_poll_slot_status(struct dvb_ca_en50221 *ca, int slot, int open)\r\n{\r\nstruct dvb_usb_device *d = (struct dvb_usb_device *)ca->data;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\nu8 req;\r\nu16 value;\r\nu16 index;\r\nint blen;\r\nu8 *b;\r\nb = kmalloc(12, GFP_KERNEL);\r\nif (!b)\r\nreturn -ENOMEM;\r\nmutex_lock(&state->ca_mutex);\r\nreq = 0xC5;\r\nvalue = 0;\r\nindex = 0;\r\nblen = 1;\r\nret = az6007_read(d, req, value, index, b, blen);\r\nif (ret < 0) {\r\nwarn("usb in operation failed. (%d)", ret);\r\nret = -EIO;\r\n} else\r\nret = 0;\r\nif (!ret && b[0] == 1) {\r\nret = DVB_CA_EN50221_POLL_CAM_PRESENT |\r\nDVB_CA_EN50221_POLL_CAM_READY;\r\n}\r\nmutex_unlock(&state->ca_mutex);\r\nkfree(b);\r\nreturn ret;\r\n}\r\nstatic void az6007_ci_uninit(struct dvb_usb_device *d)\r\n{\r\nstruct az6007_device_state *state;\r\ndeb_info("%s", __func__);\r\nif (NULL == d)\r\nreturn;\r\nstate = (struct az6007_device_state *)d->priv;\r\nif (NULL == state)\r\nreturn;\r\nif (NULL == state->ca.data)\r\nreturn;\r\ndvb_ca_en50221_release(&state->ca);\r\nmemset(&state->ca, 0, sizeof(state->ca));\r\n}\r\nstatic int az6007_ci_init(struct dvb_usb_adapter *a)\r\n{\r\nstruct dvb_usb_device *d = a->dev;\r\nstruct az6007_device_state *state = (struct az6007_device_state *)d->priv;\r\nint ret;\r\ndeb_info("%s", __func__);\r\nmutex_init(&state->ca_mutex);\r\nstate->ca.owner = THIS_MODULE;\r\nstate->ca.read_attribute_mem = az6007_ci_read_attribute_mem;\r\nstate->ca.write_attribute_mem = az6007_ci_write_attribute_mem;\r\nstate->ca.read_cam_control = az6007_ci_read_cam_control;\r\nstate->ca.write_cam_control = az6007_ci_write_cam_control;\r\nstate->ca.slot_reset = az6007_ci_slot_reset;\r\nstate->ca.slot_shutdown = az6007_ci_slot_shutdown;\r\nstate->ca.slot_ts_enable = az6007_ci_slot_ts_enable;\r\nstate->ca.poll_slot_status = az6007_ci_poll_slot_status;\r\nstate->ca.data = d;\r\nret = dvb_ca_en50221_init(&a->dvb_adap,\r\n&state->ca,\r\n0,\r\n1);\r\nif (ret != 0) {\r\nerr("Cannot initialize CI: Error %d.", ret);\r\nmemset(&state->ca, 0, sizeof(state->ca));\r\nreturn ret;\r\n}\r\ndeb_info("CI initialized.");\r\nreturn 0;\r\n}\r\nstatic int az6007_read_mac_addr(struct dvb_usb_device *d, u8 mac[6])\r\n{\r\nstruct az6007_device_state *st = d->priv;\r\nint ret;\r\nret = az6007_read(d, AZ6007_READ_DATA, 6, 0, st->data, 6);\r\nmemcpy(mac, st->data, sizeof(mac));\r\nif (ret > 0)\r\ndeb_info("%s: mac is %02x:%02x:%02x:%02x:%02x:%02x\n",\r\n__func__, mac[0], mac[1], mac[2],\r\nmac[3], mac[4], mac[5]);\r\nreturn ret;\r\n}\r\nstatic int az6007_frontend_attach(struct dvb_usb_adapter *adap)\r\n{\r\nstruct az6007_device_state *st = adap->dev->priv;\r\ndeb_info("attaching demod drxk");\r\nadap->fe_adap[0].fe = dvb_attach(drxk_attach, &terratec_h7_drxk,\r\n&adap->dev->i2c_adap);\r\nif (!adap->fe_adap[0].fe)\r\nreturn -EINVAL;\r\nadap->fe_adap[0].fe->sec_priv = adap;\r\nst->gate_ctrl = adap->fe_adap[0].fe->ops.i2c_gate_ctrl;\r\nadap->fe_adap[0].fe->ops.i2c_gate_ctrl = drxk_gate_ctrl;\r\naz6007_ci_init(adap);\r\nreturn 0;\r\n}\r\nstatic int az6007_tuner_attach(struct dvb_usb_adapter *adap)\r\n{\r\ndeb_info("attaching tuner mt2063");\r\nif (adap->fe_adap[0].fe->ops.i2c_gate_ctrl)\r\nadap->fe_adap[0].fe->ops.i2c_gate_ctrl(adap->fe_adap[0].fe, 1);\r\nif (!dvb_attach(mt2063_attach, adap->fe_adap[0].fe,\r\n&az6007_mt2063_config,\r\n&adap->dev->i2c_adap))\r\nreturn -EINVAL;\r\nif (adap->fe_adap[0].fe->ops.i2c_gate_ctrl)\r\nadap->fe_adap[0].fe->ops.i2c_gate_ctrl(adap->fe_adap[0].fe, 0);\r\nreturn 0;\r\n}\r\nint az6007_power_ctrl(struct dvb_usb_device *d, int onoff)\r\n{\r\nstruct az6007_device_state *st = d->priv;\r\nint ret;\r\ndeb_info("%s()\n", __func__);\r\nif (!st->warm) {\r\nmutex_init(&st->mutex);\r\nret = az6007_write(d, AZ6007_POWER, 0, 2, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(60);\r\nret = az6007_write(d, AZ6007_POWER, 1, 4, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(100);\r\nret = az6007_write(d, AZ6007_POWER, 1, 3, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(20);\r\nret = az6007_write(d, AZ6007_POWER, 1, 4, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(400);\r\nret = az6007_write(d, FX2_SCON1, 0, 3, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(150);\r\nret = az6007_write(d, FX2_SCON1, 1, 3, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nmsleep(430);\r\nret = az6007_write(d, AZ6007_POWER, 0, 0, NULL, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nst->warm = true;\r\nreturn 0;\r\n}\r\nif (!onoff)\r\nreturn 0;\r\naz6007_write(d, AZ6007_POWER, 0, 0, NULL, 0);\r\naz6007_write(d, AZ6007_TS_THROUGH, 0, 0, NULL, 0);\r\nreturn 0;\r\n}\r\nstatic int az6007_i2c_xfer(struct i2c_adapter *adap, struct i2c_msg msgs[],\r\nint num)\r\n{\r\nstruct dvb_usb_device *d = i2c_get_adapdata(adap);\r\nstruct az6007_device_state *st = d->priv;\r\nint i, j, len;\r\nint ret = 0;\r\nu16 index;\r\nu16 value;\r\nint length;\r\nu8 req, addr;\r\nif (mutex_lock_interruptible(&st->mutex) < 0)\r\nreturn -EAGAIN;\r\nfor (i = 0; i < num; i++) {\r\naddr = msgs[i].addr << 1;\r\nif (((i + 1) < num)\r\n&& (msgs[i].len == 1)\r\n&& (!msgs[i].flags & I2C_M_RD)\r\n&& (msgs[i + 1].flags & I2C_M_RD)\r\n&& (msgs[i].addr == msgs[i + 1].addr)) {\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_DEBUG\r\n"az6007 I2C xfer write+read addr=0x%x len=%d/%d: ",\r\naddr, msgs[i].len, msgs[i + 1].len);\r\nreq = AZ6007_I2C_RD;\r\nindex = msgs[i].buf[0];\r\nvalue = addr | (1 << 8);\r\nlength = 6 + msgs[i + 1].len;\r\nlen = msgs[i + 1].len;\r\nret = __az6007_read(d->udev, req, value, index,\r\nst->data, length);\r\nif (ret >= len) {\r\nfor (j = 0; j < len; j++) {\r\nmsgs[i + 1].buf[j] = st->data[j + 5];\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_CONT\r\n"0x%02x ",\r\nmsgs[i + 1].buf[j]);\r\n}\r\n} else\r\nret = -EIO;\r\ni++;\r\n} else if (!(msgs[i].flags & I2C_M_RD)) {\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_DEBUG\r\n"az6007 I2C xfer write addr=0x%x len=%d: ",\r\naddr, msgs[i].len);\r\nreq = AZ6007_I2C_WR;\r\nindex = msgs[i].buf[0];\r\nvalue = addr | (1 << 8);\r\nlength = msgs[i].len - 1;\r\nlen = msgs[i].len - 1;\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_CONT "(0x%02x) ", msgs[i].buf[0]);\r\nfor (j = 0; j < len; j++) {\r\nst->data[j] = msgs[i].buf[j + 1];\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_CONT "0x%02x ",\r\nst->data[j]);\r\n}\r\nret = __az6007_write(d->udev, req, value, index,\r\nst->data, length);\r\n} else {\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_DEBUG\r\n"az6007 I2C xfer read addr=0x%x len=%d: ",\r\naddr, msgs[i].len);\r\nreq = AZ6007_I2C_RD;\r\nindex = msgs[i].buf[0];\r\nvalue = addr;\r\nlength = msgs[i].len + 6;\r\nlen = msgs[i].len;\r\nret = __az6007_read(d->udev, req, value, index,\r\nst->data, length);\r\nfor (j = 0; j < len; j++) {\r\nmsgs[i].buf[j] = st->data[j + 5];\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_CONT\r\n"0x%02x ", st->data[j + 5]);\r\n}\r\n}\r\nif (dvb_usb_az6007_debug & 2)\r\nprintk(KERN_CONT "\n");\r\nif (ret < 0)\r\ngoto err;\r\n}\r\nerr:\r\nmutex_unlock(&st->mutex);\r\nif (ret < 0) {\r\ninfo("%s ERROR: %i", __func__, ret);\r\nreturn ret;\r\n}\r\nreturn num;\r\n}\r\nstatic u32 az6007_i2c_func(struct i2c_adapter *adapter)\r\n{\r\nreturn I2C_FUNC_I2C;\r\n}\r\nint az6007_identify_state(struct usb_device *udev,\r\nstruct dvb_usb_device_properties *props,\r\nstruct dvb_usb_device_description **desc, int *cold)\r\n{\r\nint ret;\r\nu8 *mac;\r\nmac = kmalloc(6, GFP_ATOMIC);\r\nif (!mac)\r\nreturn -ENOMEM;\r\nret = __az6007_read(udev, AZ6007_READ_DATA, 6, 0, mac, 6);\r\nif (ret == 6)\r\n*cold = 0;\r\nelse\r\n*cold = 1;\r\nkfree(mac);\r\nif (*cold) {\r\n__az6007_write(udev, 0x09, 1, 0, NULL, 0);\r\n__az6007_write(udev, 0x00, 0, 0, NULL, 0);\r\n__az6007_write(udev, 0x00, 0, 0, NULL, 0);\r\n}\r\ndeb_info("Device is on %s state\n", *cold ? "warm" : "cold");\r\nreturn 0;\r\n}\r\nstatic void az6007_usb_disconnect(struct usb_interface *intf)\r\n{\r\nstruct dvb_usb_device *d = usb_get_intfdata(intf);\r\naz6007_ci_uninit(d);\r\ndvb_usb_device_exit(intf);\r\n}\r\nstatic int az6007_usb_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nreturn dvb_usb_device_init(intf, &az6007_properties,\r\nTHIS_MODULE, NULL, adapter_nr);\r\n}\r\nstatic int __init az6007_usb_module_init(void)\r\n{\r\nint result;\r\ndeb_info("az6007 usb module init\n");\r\nresult = usb_register(&az6007_usb_driver);\r\nif (result) {\r\nerr("usb_register failed. (%d)", result);\r\nreturn result;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit az6007_usb_module_exit(void)\r\n{\r\ndeb_info("az6007 usb module exit\n");\r\nusb_deregister(&az6007_usb_driver);\r\n}
