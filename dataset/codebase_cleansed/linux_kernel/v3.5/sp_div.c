ieee754sp ieee754sp_div(ieee754sp x, ieee754sp y)\r\n{\r\nCOMPXSP;\r\nCOMPYSP;\r\nEXPLODEXSP;\r\nEXPLODEYSP;\r\nCLEARCX;\r\nFLUSHXSP;\r\nFLUSHYSP;\r\nswitch (CLPAIR(xc, yc)) {\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_INF):\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_nanxcpt(ieee754sp_indef(), "div", x, y);\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_QNAN):\r\nreturn y;\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_INF):\r\nreturn x;\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_INF):\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_xcpt(ieee754sp_indef(), "div", x, y);\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_INF):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_INF):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_INF):\r\nreturn ieee754sp_zero(xs ^ ys);\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_DNORM):\r\nreturn ieee754sp_inf(xs ^ ys);\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_ZERO):\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_xcpt(ieee754sp_indef(), "div", x, y);\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_ZERO):\r\nSETCX(IEEE754_ZERO_DIVIDE);\r\nreturn ieee754sp_xcpt(ieee754sp_inf(xs ^ ys), "div", x, y);\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_DNORM):\r\nreturn ieee754sp_zero(xs == ys ? 0 : 1);\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_DNORM):\r\nSPDNORMX;\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_DNORM):\r\nSPDNORMY;\r\nbreak;\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_NORM):\r\nSPDNORMX;\r\nbreak;\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_NORM):\r\nbreak;\r\n}\r\nassert(xm & SP_HIDDEN_BIT);\r\nassert(ym & SP_HIDDEN_BIT);\r\nxm <<= 3;\r\nym <<= 3;\r\n{\r\nunsigned rm = 0;\r\nint re = xe - ye;\r\nunsigned bm;\r\nfor (bm = SP_MBIT(SP_MBITS + 2); bm; bm >>= 1) {\r\nif (xm >= ym) {\r\nxm -= ym;\r\nrm |= bm;\r\nif (xm == 0)\r\nbreak;\r\n}\r\nxm <<= 1;\r\n}\r\nrm <<= 1;\r\nif (xm)\r\nrm |= 1;\r\nassert(rm);\r\nwhile ((rm >> (SP_MBITS + 3)) == 0) {\r\nrm <<= 1;\r\nre--;\r\n}\r\nSPNORMRET2(xs == ys ? 0 : 1, re, rm, "div", x, y);\r\n}\r\n}
