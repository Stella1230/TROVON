static int dm644x_venc_setup_clock(enum vpbe_enc_timings_type type,\r\nunsigned int mode)\r\n{\r\nint ret = 0;\r\nu32 v = DM644X_VPSS_VENCLKEN;\r\nswitch (type) {\r\ncase VPBE_ENC_STD:\r\nv |= DM644X_VPSS_DACCLKEN;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\nbreak;\r\ncase VPBE_ENC_DV_PRESET:\r\nswitch (mode) {\r\ncase V4L2_DV_480P59_94:\r\ncase V4L2_DV_576P50:\r\nv |= DM644X_VPSS_MUXSEL_PLL2_MODE |\r\nDM644X_VPSS_DACCLKEN;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\nbreak;\r\ncase V4L2_DV_720P60:\r\ncase V4L2_DV_1080I60:\r\ncase V4L2_DV_1080P30:\r\nv |= DM644X_VPSS_MUXSEL_VPBECLK_MODE;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\nbreak;\r\ndefault:\r\nret = -EINVAL;\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nvoid __init dm644x_init_asp(struct snd_platform_data *pdata)\r\n{\r\ndavinci_cfg_reg(DM644X_MCBSP);\r\ndm644x_asp_device.dev.platform_data = pdata;\r\nplatform_device_register(&dm644x_asp_device);\r\n}\r\nvoid __init dm644x_init(void)\r\n{\r\ndavinci_common_init(&davinci_soc_info_dm644x);\r\ndavinci_map_sysmod();\r\n}\r\nint __init dm644x_init_video(struct vpfe_config *vpfe_cfg,\r\nstruct vpbe_config *vpbe_cfg)\r\n{\r\nif (vpfe_cfg || vpbe_cfg)\r\nplatform_device_register(&dm644x_vpss_device);\r\nif (vpfe_cfg) {\r\ndm644x_vpfe_dev.dev.platform_data = vpfe_cfg;\r\nplatform_device_register(&dm644x_ccdc_dev);\r\nplatform_device_register(&dm644x_vpfe_dev);\r\nclk_add_alias("master", dm644x_ccdc_dev.name,\r\n"vpss_master", NULL);\r\nclk_add_alias("slave", dm644x_ccdc_dev.name,\r\n"vpss_slave", NULL);\r\n}\r\nif (vpbe_cfg) {\r\ndm644x_vpbe_dev.dev.platform_data = vpbe_cfg;\r\nplatform_device_register(&dm644x_osd_dev);\r\nplatform_device_register(&dm644x_venc_dev);\r\nplatform_device_register(&dm644x_vpbe_dev);\r\nplatform_device_register(&dm644x_vpbe_display);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init dm644x_init_devices(void)\r\n{\r\nif (!cpu_is_davinci_dm644x())\r\nreturn 0;\r\nplatform_device_register(&dm644x_edma_device);\r\nplatform_device_register(&dm644x_mdio_device);\r\nplatform_device_register(&dm644x_emac_device);\r\nclk_add_alias(NULL, dev_name(&dm644x_mdio_device.dev),\r\nNULL, &dm644x_emac_device.dev);\r\nreturn 0;\r\n}
