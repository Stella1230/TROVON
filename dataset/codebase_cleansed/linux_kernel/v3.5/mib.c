void STAvClearAllCounter (PSStatCounter pStatistic)\r\n{\r\nmemset(pStatistic, 0, sizeof(SStatCounter));\r\n}\r\nvoid STAvUpdateIsrStatCounter (PSStatCounter pStatistic, BYTE byIsr0, BYTE byIsr1)\r\n{\r\nif (byIsr0 == 0) {\r\npStatistic->ISRStat.dwIsrUnknown++;\r\nreturn;\r\n}\r\nif (byIsr0 & ISR_ACTX)\r\npStatistic->ISRStat.dwIsrTx0OK++;\r\nif (byIsr0 & ISR_BNTX)\r\npStatistic->ISRStat.dwIsrBeaconTxOK++;\r\nif (byIsr0 & ISR_RXDMA0)\r\npStatistic->ISRStat.dwIsrRx0OK++;\r\nif (byIsr0 & ISR_TBTT)\r\npStatistic->ISRStat.dwIsrTBTTInt++;\r\nif (byIsr0 & ISR_SOFTTIMER)\r\npStatistic->ISRStat.dwIsrSTIMERInt++;\r\nif (byIsr0 & ISR_WATCHDOG)\r\npStatistic->ISRStat.dwIsrWatchDog++;\r\nif (byIsr1 & ISR_FETALERR)\r\npStatistic->ISRStat.dwIsrUnrecoverableError++;\r\nif (byIsr1 & ISR_SOFTINT)\r\npStatistic->ISRStat.dwIsrSoftInterrupt++;\r\nif (byIsr1 & ISR_MIBNEARFULL)\r\npStatistic->ISRStat.dwIsrMIBNearfull++;\r\nif (byIsr1 & ISR_RXNOBUF)\r\npStatistic->ISRStat.dwIsrRxNoBuf++;\r\n}\r\nvoid STAvUpdateRDStatCounter(PSStatCounter pStatistic,\r\nBYTE byRSR, BYTE byNewRSR,\r\nBYTE byRxSts, BYTE byRxRate,\r\nPBYTE pbyBuffer, unsigned int cbFrameLength)\r\n{\r\nPS802_11Header pHeader = (PS802_11Header)pbyBuffer;\r\nif (byRSR & RSR_ADDROK)\r\npStatistic->dwRsrADDROk++;\r\nif (byRSR & RSR_CRCOK) {\r\npStatistic->dwRsrCRCOk++;\r\npStatistic->ullRsrOK++;\r\nif (cbFrameLength >= ETH_ALEN) {\r\nif (byRSR & RSR_ADDRBROAD) {\r\npStatistic->ullRxBroadcastFrames++;\r\npStatistic->ullRxBroadcastBytes +=\r\n(unsigned long long) cbFrameLength;\r\n}\r\nelse if (byRSR & RSR_ADDRMULTI) {\r\npStatistic->ullRxMulticastFrames++;\r\npStatistic->ullRxMulticastBytes +=\r\n(unsigned long long) cbFrameLength;\r\n}\r\nelse {\r\npStatistic->ullRxDirectedFrames++;\r\npStatistic->ullRxDirectedBytes +=\r\n(unsigned long long) cbFrameLength;\r\n}\r\n}\r\n}\r\nif(byRxRate==22) {\r\npStatistic->CustomStat.ullRsr11M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr11MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "11M: ALL[%d], OK[%d]:[%02x]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr11M,\r\n(signed int) pStatistic->CustomStat.ullRsr11MCRCOk, byRSR);\r\n}\r\nelse if(byRxRate==11) {\r\npStatistic->CustomStat.ullRsr5M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr5MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO " 5M: ALL[%d], OK[%d]:[%02x]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr5M,\r\n(signed int) pStatistic->CustomStat.ullRsr5MCRCOk, byRSR);\r\n}\r\nelse if(byRxRate==4) {\r\npStatistic->CustomStat.ullRsr2M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr2MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO " 2M: ALL[%d], OK[%d]:[%02x]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr2M,\r\n(signed int) pStatistic->CustomStat.ullRsr2MCRCOk, byRSR);\r\n}\r\nelse if(byRxRate==2){\r\npStatistic->CustomStat.ullRsr1M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr1MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO " 1M: ALL[%d], OK[%d]:[%02x]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr1M,\r\n(signed int) pStatistic->CustomStat.ullRsr1MCRCOk, byRSR);\r\n}\r\nelse if(byRxRate==12){\r\npStatistic->CustomStat.ullRsr6M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr6MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO " 6M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr6M,\r\n(signed int) pStatistic->CustomStat.ullRsr6MCRCOk);\r\n}\r\nelse if(byRxRate==18){\r\npStatistic->CustomStat.ullRsr9M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr9MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO " 9M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr9M,\r\n(signed int) pStatistic->CustomStat.ullRsr9MCRCOk);\r\n}\r\nelse if(byRxRate==24){\r\npStatistic->CustomStat.ullRsr12M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr12MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "12M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr12M,\r\n(signed int) pStatistic->CustomStat.ullRsr12MCRCOk);\r\n}\r\nelse if(byRxRate==36){\r\npStatistic->CustomStat.ullRsr18M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr18MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "18M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr18M,\r\n(signed int) pStatistic->CustomStat.ullRsr18MCRCOk);\r\n}\r\nelse if(byRxRate==48){\r\npStatistic->CustomStat.ullRsr24M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr24MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "24M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr24M,\r\n(signed int) pStatistic->CustomStat.ullRsr24MCRCOk);\r\n}\r\nelse if(byRxRate==72){\r\npStatistic->CustomStat.ullRsr36M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr36MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "36M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr36M,\r\n(signed int) pStatistic->CustomStat.ullRsr36MCRCOk);\r\n}\r\nelse if(byRxRate==96){\r\npStatistic->CustomStat.ullRsr48M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr48MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "48M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr48M,\r\n(signed int) pStatistic->CustomStat.ullRsr48MCRCOk);\r\n}\r\nelse if(byRxRate==108){\r\npStatistic->CustomStat.ullRsr54M++;\r\nif(byRSR & RSR_CRCOK) {\r\npStatistic->CustomStat.ullRsr54MCRCOk++;\r\n}\r\nDBG_PRT(MSG_LEVEL_DEBUG, KERN_INFO "54M: ALL[%d], OK[%d]\n",\r\n(signed int) pStatistic->CustomStat.ullRsr54M,\r\n(signed int) pStatistic->CustomStat.ullRsr54MCRCOk);\r\n}\r\nelse {\r\nDBG_PRT(MSG_LEVEL_DEBUG,\r\nKERN_INFO "Unknown: Total[%d], CRCOK[%d]\n",\r\n(signed int) pStatistic->dwRsrRxPacket+1,\r\n(signed int)pStatistic->dwRsrCRCOk);\r\n}\r\nif (byRSR & RSR_BSSIDOK)\r\npStatistic->dwRsrBSSIDOk++;\r\nif (byRSR & RSR_BCNSSIDOK)\r\npStatistic->dwRsrBCNSSIDOk++;\r\nif (byRSR & RSR_IVLDLEN)\r\npStatistic->dwRsrLENErr++;\r\nif (byRSR & RSR_IVLDTYP)\r\npStatistic->dwRsrTYPErr++;\r\nif ((byRSR & (RSR_IVLDTYP | RSR_IVLDLEN)) || !(byRSR & RSR_CRCOK))\r\npStatistic->dwRsrErr++;\r\nif (byNewRSR & NEWRSR_DECRYPTOK)\r\npStatistic->dwNewRsrDECRYPTOK++;\r\nif (byNewRSR & NEWRSR_CFPIND)\r\npStatistic->dwNewRsrCFP++;\r\nif (byNewRSR & NEWRSR_HWUTSF)\r\npStatistic->dwNewRsrUTSF++;\r\nif (byNewRSR & NEWRSR_BCNHITAID)\r\npStatistic->dwNewRsrHITAID++;\r\nif (byNewRSR & NEWRSR_BCNHITAID0)\r\npStatistic->dwNewRsrHITAID0++;\r\npStatistic->dwRsrRxPacket++;\r\npStatistic->dwRsrRxOctet += cbFrameLength;\r\nif (IS_TYPE_DATA(pbyBuffer)) {\r\npStatistic->dwRsrRxData++;\r\n} else if (IS_TYPE_MGMT(pbyBuffer)){\r\npStatistic->dwRsrRxManage++;\r\n} else if (IS_TYPE_CONTROL(pbyBuffer)){\r\npStatistic->dwRsrRxControl++;\r\n}\r\nif (byRSR & RSR_ADDRBROAD)\r\npStatistic->dwRsrBroadcast++;\r\nelse if (byRSR & RSR_ADDRMULTI)\r\npStatistic->dwRsrMulticast++;\r\nelse\r\npStatistic->dwRsrDirected++;\r\nif (WLAN_GET_FC_MOREFRAG(pHeader->wFrameCtl))\r\npStatistic->dwRsrRxFragment++;\r\nif (cbFrameLength < ETH_ZLEN + 4) {\r\npStatistic->dwRsrRunt++;\r\n} else if (cbFrameLength == ETH_ZLEN + 4) {\r\npStatistic->dwRsrRxFrmLen64++;\r\n}\r\nelse if ((65 <= cbFrameLength) && (cbFrameLength <= 127)) {\r\npStatistic->dwRsrRxFrmLen65_127++;\r\n}\r\nelse if ((128 <= cbFrameLength) && (cbFrameLength <= 255)) {\r\npStatistic->dwRsrRxFrmLen128_255++;\r\n}\r\nelse if ((256 <= cbFrameLength) && (cbFrameLength <= 511)) {\r\npStatistic->dwRsrRxFrmLen256_511++;\r\n}\r\nelse if ((512 <= cbFrameLength) && (cbFrameLength <= 1023)) {\r\npStatistic->dwRsrRxFrmLen512_1023++;\r\n} else if ((1024 <= cbFrameLength) &&\r\n(cbFrameLength <= ETH_FRAME_LEN + 4)) {\r\npStatistic->dwRsrRxFrmLen1024_1518++;\r\n} else if (cbFrameLength > ETH_FRAME_LEN + 4) {\r\npStatistic->dwRsrLong++;\r\n}\r\n}\r\nvoid\r\nSTAvUpdateRDStatCounterEx (\r\nPSStatCounter pStatistic,\r\nBYTE byRSR,\r\nBYTE byNewRSR,\r\nBYTE byRxSts,\r\nBYTE byRxRate,\r\nPBYTE pbyBuffer,\r\nunsigned int cbFrameLength\r\n)\r\n{\r\nSTAvUpdateRDStatCounter(\r\npStatistic,\r\nbyRSR,\r\nbyNewRSR,\r\nbyRxSts,\r\nbyRxRate,\r\npbyBuffer,\r\ncbFrameLength\r\n);\r\npStatistic->dwCntRxFrmLength = cbFrameLength;\r\nmemcpy(pStatistic->abyCntRxPattern, (PBYTE)pbyBuffer, 10);\r\n}\r\nvoid\r\nSTAvUpdateTDStatCounter (\r\nPSStatCounter pStatistic,\r\nBYTE byPktNum,\r\nBYTE byRate,\r\nBYTE byTSR\r\n)\r\n{\r\nBYTE byRetyCnt;\r\npStatistic->dwTsrTxPacket++;\r\nbyRetyCnt = (byTSR & 0xF0) >> 4;\r\nif (byRetyCnt != 0) {\r\npStatistic->dwTsrRetry++;\r\npStatistic->dwTsrTotalRetry += byRetyCnt;\r\npStatistic->dwTxFail[byRate]+= byRetyCnt;\r\npStatistic->dwTxFail[MAX_RATE] += byRetyCnt;\r\nif ( byRetyCnt == 0x1)\r\npStatistic->dwTsrOnceRetry++;\r\nelse\r\npStatistic->dwTsrMoreThanOnceRetry++;\r\nif (byRetyCnt <= 8)\r\npStatistic->dwTxRetryCount[byRetyCnt-1]++;\r\n}\r\nif ( !(byTSR & (TSR_TMO | TSR_RETRYTMO))) {\r\nif (byRetyCnt < 2)\r\npStatistic->TxNoRetryOkCount ++;\r\nelse\r\npStatistic->TxRetryOkCount ++;\r\npStatistic->ullTsrOK++;\r\npStatistic->CustomStat.ullTsrAllOK++;\r\npStatistic->dwTxOk[byRate]++;\r\npStatistic->dwTxOk[MAX_RATE]++;\r\nif ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_BROAD ) {\r\npStatistic->ullTxBroadcastFrames++;\r\npStatistic->ullTxBroadcastBytes += pStatistic->abyTxPktInfo[byPktNum].wLength;\r\n} else if ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_MULTI ) {\r\npStatistic->ullTxMulticastFrames++;\r\npStatistic->ullTxMulticastBytes += pStatistic->abyTxPktInfo[byPktNum].wLength;\r\n} else if ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_UNI ) {\r\npStatistic->ullTxDirectedFrames++;\r\npStatistic->ullTxDirectedBytes += pStatistic->abyTxPktInfo[byPktNum].wLength;\r\n}\r\n}\r\nelse {\r\npStatistic->TxFailCount ++;\r\npStatistic->dwTsrErr++;\r\nif (byTSR & TSR_RETRYTMO)\r\npStatistic->dwTsrRetryTimeout++;\r\nif (byTSR & TSR_TMO)\r\npStatistic->dwTsrTransmitTimeout++;\r\n}\r\nif ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_BROAD ) {\r\npStatistic->dwTsrBroadcast++;\r\n} else if ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_MULTI ) {\r\npStatistic->dwTsrMulticast++;\r\n} else if ( pStatistic->abyTxPktInfo[byPktNum].byBroadMultiUni == TX_PKT_UNI ) {\r\npStatistic->dwTsrDirected++;\r\n}\r\n}\r\nvoid\r\nSTAvUpdate802_11Counter(\r\nPSDot11Counters p802_11Counter,\r\nPSStatCounter pStatistic,\r\nBYTE byRTSSuccess,\r\nBYTE byRTSFail,\r\nBYTE byACKFail,\r\nBYTE byFCSErr\r\n)\r\n{\r\np802_11Counter->MulticastTransmittedFrameCount =\r\n(unsigned long long) (pStatistic->dwTsrBroadcast +\r\npStatistic->dwTsrMulticast);\r\np802_11Counter->FailedCount = (unsigned long long) (pStatistic->dwTsrErr);\r\np802_11Counter->RetryCount = (unsigned long long) (pStatistic->dwTsrRetry);\r\np802_11Counter->MultipleRetryCount =\r\n(unsigned long long) (pStatistic->dwTsrMoreThanOnceRetry);\r\np802_11Counter->RTSSuccessCount += (unsigned long long) byRTSSuccess;\r\np802_11Counter->RTSFailureCount += (unsigned long long) byRTSFail;\r\np802_11Counter->ACKFailureCount += (unsigned long long) byACKFail;\r\np802_11Counter->FCSErrorCount += (unsigned long long) byFCSErr;\r\np802_11Counter->MulticastReceivedFrameCount =\r\n(unsigned long long) (pStatistic->dwRsrBroadcast +\r\npStatistic->dwRsrMulticast);\r\n}\r\nvoid\r\nSTAvClear802_11Counter(PSDot11Counters p802_11Counter)\r\n{\r\nmemset(p802_11Counter, 0, sizeof(SDot11Counters));\r\n}\r\nvoid STAvUpdateUSBCounter(PSUSBCounter pUsbCounter, int ntStatus)\r\n{\r\npUsbCounter->dwCrc++;\r\n}
