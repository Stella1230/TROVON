int __init omap2430_clk_init(void)\r\n{\r\nconst struct prcm_config *prcm;\r\nstruct omap_clk *c;\r\nu32 clkrate;\r\nprcm_clksrc_ctrl = OMAP2430_PRCM_CLKSRC_CTRL;\r\ncm_idlest_pll = OMAP_CM_REGADDR(PLL_MOD, CM_IDLEST);\r\ncpu_mask = RATE_IN_243X;\r\nrate_table = omap2430_rate_table;\r\nclk_init(&omap2_clk_functions);\r\nfor (c = omap2430_clks; c < omap2430_clks + ARRAY_SIZE(omap2430_clks);\r\nc++)\r\nclk_preinit(c->lk.clk);\r\nosc_ck.rate = omap2_osc_clk_recalc(&osc_ck);\r\npropagate_rate(&osc_ck);\r\nsys_ck.rate = omap2xxx_sys_clk_recalc(&sys_ck);\r\npropagate_rate(&sys_ck);\r\nfor (c = omap2430_clks; c < omap2430_clks + ARRAY_SIZE(omap2430_clks);\r\nc++) {\r\nclkdev_add(&c->lk);\r\nclk_register(c->lk.clk);\r\nomap2_init_clk_clkdm(c->lk.clk);\r\n}\r\nomap_clk_disable_autoidle_all();\r\nclkrate = omap2xxx_clk_get_core_rate(&dpll_ck);\r\nfor (prcm = rate_table; prcm->mpu_speed; prcm++) {\r\nif (!(prcm->flags & cpu_mask))\r\ncontinue;\r\nif (prcm->xtal_speed != sys_ck.rate)\r\ncontinue;\r\nif (prcm->dpll_speed <= clkrate)\r\nbreak;\r\n}\r\ncurr_prcm_set = prcm;\r\nrecalculate_root_clocks();\r\npr_info("Clocking rate (Crystal/DPLL/MPU): %ld.%01ld/%ld/%ld MHz\n",\r\n(sys_ck.rate / 1000000), (sys_ck.rate / 100000) % 10,\r\n(dpll_ck.rate / 1000000), (mpu_ck.rate / 1000000)) ;\r\nclk_enable_init_clocks();\r\nvclk = clk_get(NULL, "virt_prcm_set");\r\nsclk = clk_get(NULL, "sys_ck");\r\ndclk = clk_get(NULL, "dpll_ck");\r\nreturn 0;\r\n}
