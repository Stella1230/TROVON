static void netcell_quirkproc(ide_drive_t *drive)\r\n{\r\ndrive->id[ATA_ID_CSF_DEFAULT] |= 0x4000;\r\n}\r\nstatic int __devinit generic_init_one(struct pci_dev *dev, const struct pci_device_id *id)\r\n{\r\nconst struct ide_port_info *d = &generic_chipsets[id->driver_data];\r\nint ret = -ENODEV;\r\nif (id->driver_data == 0 && ide_generic_all == 0)\r\ngoto out;\r\nswitch (dev->vendor) {\r\ncase PCI_VENDOR_ID_UMC:\r\nif (dev->device == PCI_DEVICE_ID_UMC_UM8886A &&\r\n!(PCI_FUNC(dev->devfn) & 1))\r\ngoto out;\r\nbreak;\r\ncase PCI_VENDOR_ID_OPTI:\r\nif (dev->device == PCI_DEVICE_ID_OPTI_82C558 &&\r\n!(PCI_FUNC(dev->devfn) & 1))\r\ngoto out;\r\nbreak;\r\ncase PCI_VENDOR_ID_JMICRON:\r\nif (dev->device != PCI_DEVICE_ID_JMICRON_JMB368 &&\r\nPCI_FUNC(dev->devfn) != 1)\r\ngoto out;\r\nbreak;\r\ncase PCI_VENDOR_ID_NS:\r\nif (dev->device == PCI_DEVICE_ID_NS_87410 &&\r\n(dev->class >> 8) != PCI_CLASS_STORAGE_IDE)\r\ngoto out;\r\nbreak;\r\n}\r\nif (dev->vendor != PCI_VENDOR_ID_JMICRON) {\r\nu16 command;\r\npci_read_config_word(dev, PCI_COMMAND, &command);\r\nif (!(command & PCI_COMMAND_IO)) {\r\nprintk(KERN_INFO "%s %s: skipping disabled "\r\n"controller\n", d->name, pci_name(dev));\r\ngoto out;\r\n}\r\n}\r\nret = ide_pci_init_one(dev, d, NULL);\r\nout:\r\nreturn ret;\r\n}\r\nstatic int __init generic_ide_init(void)\r\n{\r\nreturn ide_pci_register_driver(&generic_pci_driver);\r\n}\r\nstatic void __exit generic_ide_exit(void)\r\n{\r\npci_unregister_driver(&generic_pci_driver);\r\n}
