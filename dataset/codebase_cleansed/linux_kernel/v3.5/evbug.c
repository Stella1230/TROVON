static void evbug_event(struct input_handle *handle, unsigned int type, unsigned int code, int value)\r\n{\r\nprintk(KERN_DEBUG pr_fmt("Event. Dev: %s, Type: %d, Code: %d, Value: %d\n"),\r\ndev_name(&handle->dev->dev), type, code, value);\r\n}\r\nstatic int evbug_connect(struct input_handler *handler, struct input_dev *dev,\r\nconst struct input_device_id *id)\r\n{\r\nstruct input_handle *handle;\r\nint error;\r\nhandle = kzalloc(sizeof(struct input_handle), GFP_KERNEL);\r\nif (!handle)\r\nreturn -ENOMEM;\r\nhandle->dev = dev;\r\nhandle->handler = handler;\r\nhandle->name = "evbug";\r\nerror = input_register_handle(handle);\r\nif (error)\r\ngoto err_free_handle;\r\nerror = input_open_device(handle);\r\nif (error)\r\ngoto err_unregister_handle;\r\nprintk(KERN_DEBUG pr_fmt("Connected device: %s (%s at %s)\n"),\r\ndev_name(&dev->dev),\r\ndev->name ?: "unknown",\r\ndev->phys ?: "unknown");\r\nreturn 0;\r\nerr_unregister_handle:\r\ninput_unregister_handle(handle);\r\nerr_free_handle:\r\nkfree(handle);\r\nreturn error;\r\n}\r\nstatic void evbug_disconnect(struct input_handle *handle)\r\n{\r\nprintk(KERN_DEBUG pr_fmt("Disconnected device: %s\n"),\r\ndev_name(&handle->dev->dev));\r\ninput_close_device(handle);\r\ninput_unregister_handle(handle);\r\nkfree(handle);\r\n}\r\nstatic int __init evbug_init(void)\r\n{\r\nreturn input_register_handler(&evbug_handler);\r\n}\r\nstatic void __exit evbug_exit(void)\r\n{\r\ninput_unregister_handler(&evbug_handler);\r\n}
