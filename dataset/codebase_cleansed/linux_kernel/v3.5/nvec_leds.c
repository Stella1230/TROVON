static void nvec_led_brightness_set(struct led_classdev *led_cdev,\r\nenum led_brightness value)\r\n{\r\nstruct nvec_led *led = to_nvec_led(led_cdev);\r\nunsigned char buf[] = NVEC_LED_REQ;\r\nbuf[4] = value;\r\nnvec_write_async(led->nvec, buf, sizeof(buf));\r\nled->cdev.brightness = value;\r\n}\r\nstatic int __devinit nvec_led_probe(struct platform_device *pdev)\r\n{\r\nstruct nvec_chip *nvec = dev_get_drvdata(pdev->dev.parent);\r\nstruct nvec_led *led;\r\nint ret = 0;\r\nled = kzalloc(sizeof(*led), GFP_KERNEL);\r\nif (led == NULL)\r\nreturn -ENOMEM;\r\nled->cdev.max_brightness = NVEC_LED_MAX;\r\nled->cdev.brightness_set = nvec_led_brightness_set;\r\nled->cdev.name = "nvec-led";\r\nled->cdev.flags |= LED_CORE_SUSPENDRESUME;\r\nled->nvec = nvec;\r\nplatform_set_drvdata(pdev, led);\r\nret = led_classdev_register(&pdev->dev, &led->cdev);\r\nif (ret < 0)\r\ngoto err_led;\r\nled->cdev.brightness = 0;\r\nreturn 0;\r\nerr_led:\r\nkfree(led);\r\nreturn ret;\r\n}\r\nstatic int __devexit nvec_led_remove(struct platform_device *pdev)\r\n{\r\nstruct nvec_led *led = platform_get_drvdata(pdev);\r\nled_classdev_unregister(&led->cdev);\r\nkfree(led);\r\nreturn 0;\r\n}\r\nstatic int __init nvec_led_init(void)\r\n{\r\nreturn platform_driver_register(&nvec_led_driver);\r\n}\r\nstatic void __exit nvec_led_exit(void)\r\n{\r\nplatform_driver_unregister(&nvec_led_driver);\r\n}
