asmlinkage void mmc_loader(unsigned char *buf, unsigned long len)\r\n{\r\nmmc_init_progress();\r\nmmc_update_progress(MMC_PROGRESS_ENTER);\r\n__raw_writeb(0x04, PORT84CR);\r\n__raw_writeb(0x04, PORT85CR);\r\n__raw_writeb(0x04, PORT86CR);\r\n__raw_writeb(0x04, PORT87CR);\r\n__raw_writeb(0x04, PORT88CR);\r\n__raw_writeb(0x04, PORT89CR);\r\n__raw_writeb(0x04, PORT90CR);\r\n__raw_writeb(0x04, PORT91CR);\r\n__raw_writeb(0x04, PORT92CR);\r\n__raw_writeb(0x14, PORT99CR);\r\n__raw_writel(__raw_readl(SMSTPCR3) & ~(1 << 12), SMSTPCR3);\r\nmmc_update_progress(MMC_PROGRESS_INIT);\r\nsh_mmcif_boot_init(MMCIF_BASE);\r\nmmc_update_progress(MMC_PROGRESS_LOAD);\r\nsh_mmcif_boot_do_read(MMCIF_BASE, 2,\r\n(len + SH_MMCIF_BBS - 1) / SH_MMCIF_BBS, buf);\r\n__raw_writel(__raw_readl(SMSTPCR3) | (1 << 12), SMSTPCR3);\r\nmmc_update_progress(MMC_PROGRESS_DONE);\r\n}
