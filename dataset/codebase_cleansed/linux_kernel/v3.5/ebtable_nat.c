static int check(const struct ebt_table_info *info, unsigned int valid_hooks)\r\n{\r\nif (valid_hooks & ~NAT_VALID_HOOKS)\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic unsigned int\r\nebt_nat_in(unsigned int hook, struct sk_buff *skb, const struct net_device *in\r\n, const struct net_device *out, int (*okfn)(struct sk_buff *))\r\n{\r\nreturn ebt_do_table(hook, skb, in, out, dev_net(in)->xt.frame_nat);\r\n}\r\nstatic unsigned int\r\nebt_nat_out(unsigned int hook, struct sk_buff *skb, const struct net_device *in\r\n, const struct net_device *out, int (*okfn)(struct sk_buff *))\r\n{\r\nreturn ebt_do_table(hook, skb, in, out, dev_net(out)->xt.frame_nat);\r\n}\r\nstatic int __net_init frame_nat_net_init(struct net *net)\r\n{\r\nnet->xt.frame_nat = ebt_register_table(net, &frame_nat);\r\nif (IS_ERR(net->xt.frame_nat))\r\nreturn PTR_ERR(net->xt.frame_nat);\r\nreturn 0;\r\n}\r\nstatic void __net_exit frame_nat_net_exit(struct net *net)\r\n{\r\nebt_unregister_table(net, net->xt.frame_nat);\r\n}\r\nstatic int __init ebtable_nat_init(void)\r\n{\r\nint ret;\r\nret = register_pernet_subsys(&frame_nat_net_ops);\r\nif (ret < 0)\r\nreturn ret;\r\nret = nf_register_hooks(ebt_ops_nat, ARRAY_SIZE(ebt_ops_nat));\r\nif (ret < 0)\r\nunregister_pernet_subsys(&frame_nat_net_ops);\r\nreturn ret;\r\n}\r\nstatic void __exit ebtable_nat_fini(void)\r\n{\r\nnf_unregister_hooks(ebt_ops_nat, ARRAY_SIZE(ebt_ops_nat));\r\nunregister_pernet_subsys(&frame_nat_net_ops);\r\n}
