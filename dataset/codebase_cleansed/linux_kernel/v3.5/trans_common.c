void p9_release_pages(struct page **pages, int nr_pages)\r\n{\r\nint i = 0;\r\nwhile (pages[i] && nr_pages--) {\r\nput_page(pages[i]);\r\ni++;\r\n}\r\n}\r\nint p9_nr_pages(char *data, int len)\r\n{\r\nunsigned long start_page, end_page;\r\nstart_page = (unsigned long)data >> PAGE_SHIFT;\r\nend_page = ((unsigned long)data + len + PAGE_SIZE - 1) >> PAGE_SHIFT;\r\nreturn end_page - start_page;\r\n}\r\nint p9_payload_gup(char *data, int *nr_pages, struct page **pages, int write)\r\n{\r\nint nr_mapped_pages;\r\nnr_mapped_pages = get_user_pages_fast((unsigned long)data,\r\n*nr_pages, write, pages);\r\nif (nr_mapped_pages <= 0)\r\nreturn nr_mapped_pages;\r\n*nr_pages = nr_mapped_pages;\r\nreturn 0;\r\n}
