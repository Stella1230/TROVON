static int vxge_ethtool_sset(struct net_device *dev, struct ethtool_cmd *info)\r\n{\r\nif ((info->autoneg == AUTONEG_ENABLE) ||\r\n(ethtool_cmd_speed(info) != SPEED_10000) ||\r\n(info->duplex != DUPLEX_FULL))\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic int vxge_ethtool_gset(struct net_device *dev, struct ethtool_cmd *info)\r\n{\r\ninfo->supported = (SUPPORTED_10000baseT_Full | SUPPORTED_FIBRE);\r\ninfo->advertising = (ADVERTISED_10000baseT_Full | ADVERTISED_FIBRE);\r\ninfo->port = PORT_FIBRE;\r\ninfo->transceiver = XCVR_EXTERNAL;\r\nif (netif_carrier_ok(dev)) {\r\nethtool_cmd_speed_set(info, SPEED_10000);\r\ninfo->duplex = DUPLEX_FULL;\r\n} else {\r\nethtool_cmd_speed_set(info, -1);\r\ninfo->duplex = -1;\r\n}\r\ninfo->autoneg = AUTONEG_DISABLE;\r\nreturn 0;\r\n}\r\nstatic void vxge_ethtool_gdrvinfo(struct net_device *dev,\r\nstruct ethtool_drvinfo *info)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstrlcpy(info->driver, VXGE_DRIVER_NAME, sizeof(VXGE_DRIVER_NAME));\r\nstrlcpy(info->version, DRV_VERSION, sizeof(DRV_VERSION));\r\nstrlcpy(info->fw_version, vdev->fw_version, VXGE_HW_FW_STRLEN);\r\nstrlcpy(info->bus_info, pci_name(vdev->pdev), sizeof(info->bus_info));\r\ninfo->regdump_len = sizeof(struct vxge_hw_vpath_reg)\r\n* vdev->no_of_vpath;\r\ninfo->n_stats = STAT_LEN;\r\n}\r\nstatic void vxge_ethtool_gregs(struct net_device *dev,\r\nstruct ethtool_regs *regs, void *space)\r\n{\r\nint index, offset;\r\nenum vxge_hw_status status;\r\nu64 reg;\r\nu64 *reg_space = (u64 *)space;\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstruct __vxge_hw_device *hldev = vdev->devh;\r\nregs->len = sizeof(struct vxge_hw_vpath_reg) * vdev->no_of_vpath;\r\nregs->version = vdev->pdev->subsystem_device;\r\nfor (index = 0; index < vdev->no_of_vpath; index++) {\r\nfor (offset = 0; offset < sizeof(struct vxge_hw_vpath_reg);\r\noffset += 8) {\r\nstatus = vxge_hw_mgmt_reg_read(hldev,\r\nvxge_hw_mgmt_reg_type_vpath,\r\nvdev->vpaths[index].device_id,\r\noffset, &reg);\r\nif (status != VXGE_HW_OK) {\r\nvxge_debug_init(VXGE_ERR,\r\n"%s:%d Getting reg dump Failed",\r\n__func__, __LINE__);\r\nreturn;\r\n}\r\n*reg_space++ = reg;\r\n}\r\n}\r\n}\r\nstatic int vxge_ethtool_idnic(struct net_device *dev,\r\nenum ethtool_phys_id_state state)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstruct __vxge_hw_device *hldev = vdev->devh;\r\nswitch (state) {\r\ncase ETHTOOL_ID_ACTIVE:\r\nvxge_hw_device_flick_link_led(hldev, VXGE_FLICKER_ON);\r\nbreak;\r\ncase ETHTOOL_ID_INACTIVE:\r\nvxge_hw_device_flick_link_led(hldev, VXGE_FLICKER_OFF);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic void vxge_ethtool_getpause_data(struct net_device *dev,\r\nstruct ethtool_pauseparam *ep)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstruct __vxge_hw_device *hldev = vdev->devh;\r\nvxge_hw_device_getpause_data(hldev, 0, &ep->tx_pause, &ep->rx_pause);\r\n}\r\nstatic int vxge_ethtool_setpause_data(struct net_device *dev,\r\nstruct ethtool_pauseparam *ep)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstruct __vxge_hw_device *hldev = vdev->devh;\r\nvxge_hw_device_setpause_data(hldev, 0, ep->tx_pause, ep->rx_pause);\r\nvdev->config.tx_pause_enable = ep->tx_pause;\r\nvdev->config.rx_pause_enable = ep->rx_pause;\r\nreturn 0;\r\n}\r\nstatic void vxge_get_ethtool_stats(struct net_device *dev,\r\nstruct ethtool_stats *estats, u64 *tmp_stats)\r\n{\r\nint j, k;\r\nenum vxge_hw_status status;\r\nenum vxge_hw_status swstatus;\r\nstruct vxge_vpath *vpath = NULL;\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nstruct __vxge_hw_device *hldev = vdev->devh;\r\nstruct vxge_hw_xmac_stats *xmac_stats;\r\nstruct vxge_hw_device_stats_sw_info *sw_stats;\r\nstruct vxge_hw_device_stats_hw_info *hw_stats;\r\nu64 *ptr = tmp_stats;\r\nmemset(tmp_stats, 0,\r\nvxge_ethtool_get_sset_count(dev, ETH_SS_STATS) * sizeof(u64));\r\nxmac_stats = kzalloc(sizeof(struct vxge_hw_xmac_stats), GFP_KERNEL);\r\nif (xmac_stats == NULL) {\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d Memory Allocation failed for xmac_stats",\r\n__func__, __LINE__);\r\nreturn;\r\n}\r\nsw_stats = kzalloc(sizeof(struct vxge_hw_device_stats_sw_info),\r\nGFP_KERNEL);\r\nif (sw_stats == NULL) {\r\nkfree(xmac_stats);\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d Memory Allocation failed for sw_stats",\r\n__func__, __LINE__);\r\nreturn;\r\n}\r\nhw_stats = kzalloc(sizeof(struct vxge_hw_device_stats_hw_info),\r\nGFP_KERNEL);\r\nif (hw_stats == NULL) {\r\nkfree(xmac_stats);\r\nkfree(sw_stats);\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d Memory Allocation failed for hw_stats",\r\n__func__, __LINE__);\r\nreturn;\r\n}\r\n*ptr++ = 0;\r\nstatus = vxge_hw_device_xmac_stats_get(hldev, xmac_stats);\r\nif (status != VXGE_HW_OK) {\r\nif (status != VXGE_HW_ERR_PRIVILAGED_OPEARATION) {\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d Failure in getting xmac stats",\r\n__func__, __LINE__);\r\n}\r\n}\r\nswstatus = vxge_hw_driver_stats_get(hldev, sw_stats);\r\nif (swstatus != VXGE_HW_OK) {\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d Failure in getting sw stats",\r\n__func__, __LINE__);\r\n}\r\nstatus = vxge_hw_device_stats_get(hldev, hw_stats);\r\nif (status != VXGE_HW_OK) {\r\nvxge_debug_init(VXGE_ERR,\r\n"%s : %d hw_stats_get error", __func__, __LINE__);\r\n}\r\nfor (k = 0; k < vdev->no_of_vpath; k++) {\r\nstruct vxge_hw_vpath_stats_hw_info *vpath_info;\r\nvpath = &vdev->vpaths[k];\r\nj = vpath->device_id;\r\nvpath_info = hw_stats->vpath_info[j];\r\nif (!vpath_info) {\r\nmemset(ptr, 0, (VXGE_HW_VPATH_TX_STATS_LEN +\r\nVXGE_HW_VPATH_RX_STATS_LEN) * sizeof(u64));\r\nptr += (VXGE_HW_VPATH_TX_STATS_LEN +\r\nVXGE_HW_VPATH_RX_STATS_LEN);\r\ncontinue;\r\n}\r\n*ptr++ = vpath_info->tx_stats.tx_ttl_eth_frms;\r\n*ptr++ = vpath_info->tx_stats.tx_ttl_eth_octets;\r\n*ptr++ = vpath_info->tx_stats.tx_data_octets;\r\n*ptr++ = vpath_info->tx_stats.tx_mcast_frms;\r\n*ptr++ = vpath_info->tx_stats.tx_bcast_frms;\r\n*ptr++ = vpath_info->tx_stats.tx_ucast_frms;\r\n*ptr++ = vpath_info->tx_stats.tx_tagged_frms;\r\n*ptr++ = vpath_info->tx_stats.tx_vld_ip;\r\n*ptr++ = vpath_info->tx_stats.tx_vld_ip_octets;\r\n*ptr++ = vpath_info->tx_stats.tx_icmp;\r\n*ptr++ = vpath_info->tx_stats.tx_tcp;\r\n*ptr++ = vpath_info->tx_stats.tx_rst_tcp;\r\n*ptr++ = vpath_info->tx_stats.tx_udp;\r\n*ptr++ = vpath_info->tx_stats.tx_unknown_protocol;\r\n*ptr++ = vpath_info->tx_stats.tx_lost_ip;\r\n*ptr++ = vpath_info->tx_stats.tx_parse_error;\r\n*ptr++ = vpath_info->tx_stats.tx_tcp_offload;\r\n*ptr++ = vpath_info->tx_stats.tx_retx_tcp_offload;\r\n*ptr++ = vpath_info->tx_stats.tx_lost_ip_offload;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_eth_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_vld_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_offload_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_eth_octets;\r\n*ptr++ = vpath_info->rx_stats.rx_data_octets;\r\n*ptr++ = vpath_info->rx_stats.rx_offload_octets;\r\n*ptr++ = vpath_info->rx_stats.rx_vld_mcast_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_vld_bcast_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_accepted_ucast_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_accepted_nucast_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_tagged_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_long_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_usized_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_osized_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_frag_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_jabber_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_64_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_65_127_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_128_255_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_256_511_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_512_1023_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_1024_1518_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_1519_4095_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_4096_8191_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_8192_max_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ttl_gt_max_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_ip;\r\n*ptr++ = vpath_info->rx_stats.rx_accepted_ip;\r\n*ptr++ = vpath_info->rx_stats.rx_ip_octets;\r\n*ptr++ = vpath_info->rx_stats.rx_err_ip;\r\n*ptr++ = vpath_info->rx_stats.rx_icmp;\r\n*ptr++ = vpath_info->rx_stats.rx_tcp;\r\n*ptr++ = vpath_info->rx_stats.rx_udp;\r\n*ptr++ = vpath_info->rx_stats.rx_err_tcp;\r\n*ptr++ = vpath_info->rx_stats.rx_lost_frms;\r\n*ptr++ = vpath_info->rx_stats.rx_lost_ip;\r\n*ptr++ = vpath_info->rx_stats.rx_lost_ip_offload;\r\n*ptr++ = vpath_info->rx_stats.rx_various_discard;\r\n*ptr++ = vpath_info->rx_stats.rx_sleep_discard;\r\n*ptr++ = vpath_info->rx_stats.rx_red_discard;\r\n*ptr++ = vpath_info->rx_stats.rx_queue_full_discard;\r\n*ptr++ = vpath_info->rx_stats.rx_mpa_ok_frms;\r\n}\r\n*ptr++ = 0;\r\nfor (k = 0; k < vdev->max_config_port; k++) {\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_data_octets;\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_mcast_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_bcast_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_discarded_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].tx_errored_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_data_octets;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_mcast_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_bcast_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_discarded_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_errored_frms;\r\n*ptr++ = xmac_stats->aggr_stats[k].rx_unknown_slow_proto_frms;\r\n}\r\n*ptr++ = 0;\r\nfor (k = 0; k < vdev->max_config_port; k++) {\r\n*ptr++ = xmac_stats->port_stats[k].tx_ttl_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_ttl_octets;\r\n*ptr++ = xmac_stats->port_stats[k].tx_data_octets;\r\n*ptr++ = xmac_stats->port_stats[k].tx_mcast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_bcast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_ucast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_tagged_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_vld_ip;\r\n*ptr++ = xmac_stats->port_stats[k].tx_vld_ip_octets;\r\n*ptr++ = xmac_stats->port_stats[k].tx_icmp;\r\n*ptr++ = xmac_stats->port_stats[k].tx_tcp;\r\n*ptr++ = xmac_stats->port_stats[k].tx_rst_tcp;\r\n*ptr++ = xmac_stats->port_stats[k].tx_udp;\r\n*ptr++ = xmac_stats->port_stats[k].tx_parse_error;\r\n*ptr++ = xmac_stats->port_stats[k].tx_unknown_protocol;\r\n*ptr++ = xmac_stats->port_stats[k].tx_pause_ctrl_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_marker_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_lacpdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_drop_ip;\r\n*ptr++ = xmac_stats->port_stats[k].tx_marker_resp_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_xgmii_char2_match;\r\n*ptr++ = xmac_stats->port_stats[k].tx_xgmii_char1_match;\r\n*ptr++ = xmac_stats->port_stats[k].tx_xgmii_column2_match;\r\n*ptr++ = xmac_stats->port_stats[k].tx_xgmii_column1_match;\r\n*ptr++ = xmac_stats->port_stats[k].tx_any_err_frms;\r\n*ptr++ = xmac_stats->port_stats[k].tx_drop_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_vld_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_offload_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_octets;\r\n*ptr++ = xmac_stats->port_stats[k].rx_data_octets;\r\n*ptr++ = xmac_stats->port_stats[k].rx_offload_octets;\r\n*ptr++ = xmac_stats->port_stats[k].rx_vld_mcast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_vld_bcast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_accepted_ucast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_accepted_nucast_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_tagged_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_long_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_usized_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_osized_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_frag_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_jabber_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_64_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_65_127_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_128_255_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_256_511_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_512_1023_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_1024_1518_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_1519_4095_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_4096_8191_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_8192_max_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ttl_gt_max_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ip;\r\n*ptr++ = xmac_stats->port_stats[k].rx_accepted_ip;\r\n*ptr++ = xmac_stats->port_stats[k].rx_ip_octets;\r\n*ptr++ = xmac_stats->port_stats[k].rx_err_ip;\r\n*ptr++ = xmac_stats->port_stats[k].rx_icmp;\r\n*ptr++ = xmac_stats->port_stats[k].rx_tcp;\r\n*ptr++ = xmac_stats->port_stats[k].rx_udp;\r\n*ptr++ = xmac_stats->port_stats[k].rx_err_tcp;\r\n*ptr++ = xmac_stats->port_stats[k].rx_pause_count;\r\n*ptr++ = xmac_stats->port_stats[k].rx_pause_ctrl_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_unsup_ctrl_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_fcs_err_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_in_rng_len_err_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_out_rng_len_err_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_drop_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_discarded_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_drop_ip;\r\n*ptr++ = xmac_stats->port_stats[k].rx_drop_udp;\r\n*ptr++ = xmac_stats->port_stats[k].rx_marker_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_lacpdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_unknown_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_marker_resp_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_fcs_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_illegal_pdu_frms;\r\n*ptr++ = xmac_stats->port_stats[k].rx_switch_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_len_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_rpa_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_l2_mgmt_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_rts_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_trash_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_buff_full_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_red_discard;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_ctrl_err_cnt;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_data_err_cnt;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_char1_match;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_err_sym;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_column1_match;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_char2_match;\r\n*ptr++ = xmac_stats->port_stats[k].rx_local_fault;\r\n*ptr++ = xmac_stats->port_stats[k].rx_xgmii_column2_match;\r\n*ptr++ = xmac_stats->port_stats[k].rx_jettison;\r\n*ptr++ = xmac_stats->port_stats[k].rx_remote_fault;\r\n}\r\n*ptr++ = 0;\r\nfor (k = 0; k < vdev->no_of_vpath; k++) {\r\nstruct vxge_hw_vpath_stats_sw_info *vpath_info;\r\nvpath = &vdev->vpaths[k];\r\nj = vpath->device_id;\r\nvpath_info = (struct vxge_hw_vpath_stats_sw_info *)\r\n&sw_stats->vpath_info[j];\r\n*ptr++ = vpath_info->soft_reset_cnt;\r\n*ptr++ = vpath_info->error_stats.unknown_alarms;\r\n*ptr++ = vpath_info->error_stats.network_sustained_fault;\r\n*ptr++ = vpath_info->error_stats.network_sustained_ok;\r\n*ptr++ = vpath_info->error_stats.kdfcctl_fifo0_overwrite;\r\n*ptr++ = vpath_info->error_stats.kdfcctl_fifo0_poison;\r\n*ptr++ = vpath_info->error_stats.kdfcctl_fifo0_dma_error;\r\n*ptr++ = vpath_info->error_stats.dblgen_fifo0_overflow;\r\n*ptr++ = vpath_info->error_stats.statsb_pif_chain_error;\r\n*ptr++ = vpath_info->error_stats.statsb_drop_timeout;\r\n*ptr++ = vpath_info->error_stats.target_illegal_access;\r\n*ptr++ = vpath_info->error_stats.ini_serr_det;\r\n*ptr++ = vpath_info->error_stats.prc_ring_bumps;\r\n*ptr++ = vpath_info->error_stats.prc_rxdcm_sc_err;\r\n*ptr++ = vpath_info->error_stats.prc_rxdcm_sc_abort;\r\n*ptr++ = vpath_info->error_stats.prc_quanta_size_err;\r\n*ptr++ = vpath_info->ring_stats.common_stats.full_cnt;\r\n*ptr++ = vpath_info->ring_stats.common_stats.usage_cnt;\r\n*ptr++ = vpath_info->ring_stats.common_stats.usage_max;\r\n*ptr++ = vpath_info->ring_stats.common_stats.\r\nreserve_free_swaps_cnt;\r\n*ptr++ = vpath_info->ring_stats.common_stats.total_compl_cnt;\r\nfor (j = 0; j < VXGE_HW_DTR_MAX_T_CODE; j++)\r\n*ptr++ = vpath_info->ring_stats.rxd_t_code_err_cnt[j];\r\n*ptr++ = vpath_info->fifo_stats.common_stats.full_cnt;\r\n*ptr++ = vpath_info->fifo_stats.common_stats.usage_cnt;\r\n*ptr++ = vpath_info->fifo_stats.common_stats.usage_max;\r\n*ptr++ = vpath_info->fifo_stats.common_stats.\r\nreserve_free_swaps_cnt;\r\n*ptr++ = vpath_info->fifo_stats.common_stats.total_compl_cnt;\r\n*ptr++ = vpath_info->fifo_stats.total_posts;\r\n*ptr++ = vpath_info->fifo_stats.total_buffers;\r\nfor (j = 0; j < VXGE_HW_DTR_MAX_T_CODE; j++)\r\n*ptr++ = vpath_info->fifo_stats.txd_t_code_err_cnt[j];\r\n}\r\n*ptr++ = 0;\r\nfor (k = 0; k < vdev->no_of_vpath; k++) {\r\nstruct vxge_hw_vpath_stats_hw_info *vpath_info;\r\nvpath = &vdev->vpaths[k];\r\nj = vpath->device_id;\r\nvpath_info = hw_stats->vpath_info[j];\r\nif (!vpath_info) {\r\nmemset(ptr, 0, VXGE_HW_VPATH_STATS_LEN * sizeof(u64));\r\nptr += VXGE_HW_VPATH_STATS_LEN;\r\ncontinue;\r\n}\r\n*ptr++ = vpath_info->ini_num_mwr_sent;\r\n*ptr++ = vpath_info->ini_num_mrd_sent;\r\n*ptr++ = vpath_info->ini_num_cpl_rcvd;\r\n*ptr++ = vpath_info->ini_num_mwr_byte_sent;\r\n*ptr++ = vpath_info->ini_num_cpl_byte_rcvd;\r\n*ptr++ = vpath_info->wrcrdtarb_xoff;\r\n*ptr++ = vpath_info->rdcrdtarb_xoff;\r\n*ptr++ = vpath_info->vpath_genstats_count0;\r\n*ptr++ = vpath_info->vpath_genstats_count1;\r\n*ptr++ = vpath_info->vpath_genstats_count2;\r\n*ptr++ = vpath_info->vpath_genstats_count3;\r\n*ptr++ = vpath_info->vpath_genstats_count4;\r\n*ptr++ = vpath_info->vpath_genstats_count5;\r\n*ptr++ = vpath_info->prog_event_vnum0;\r\n*ptr++ = vpath_info->prog_event_vnum1;\r\n*ptr++ = vpath_info->prog_event_vnum2;\r\n*ptr++ = vpath_info->prog_event_vnum3;\r\n*ptr++ = vpath_info->rx_multi_cast_frame_discard;\r\n*ptr++ = vpath_info->rx_frm_transferred;\r\n*ptr++ = vpath_info->rxd_returned;\r\n*ptr++ = vpath_info->rx_mpa_len_fail_frms;\r\n*ptr++ = vpath_info->rx_mpa_mrk_fail_frms;\r\n*ptr++ = vpath_info->rx_mpa_crc_fail_frms;\r\n*ptr++ = vpath_info->rx_permitted_frms;\r\n*ptr++ = vpath_info->rx_vp_reset_discarded_frms;\r\n*ptr++ = vpath_info->rx_wol_frms;\r\n*ptr++ = vpath_info->tx_vp_reset_discarded_frms;\r\n}\r\n*ptr++ = 0;\r\n*ptr++ = vdev->stats.vpaths_open;\r\n*ptr++ = vdev->stats.vpath_open_fail;\r\n*ptr++ = vdev->stats.link_up;\r\n*ptr++ = vdev->stats.link_down;\r\nfor (k = 0; k < vdev->no_of_vpath; k++) {\r\n*ptr += vdev->vpaths[k].fifo.stats.tx_frms;\r\n*(ptr + 1) += vdev->vpaths[k].fifo.stats.tx_errors;\r\n*(ptr + 2) += vdev->vpaths[k].fifo.stats.tx_bytes;\r\n*(ptr + 3) += vdev->vpaths[k].fifo.stats.txd_not_free;\r\n*(ptr + 4) += vdev->vpaths[k].fifo.stats.txd_out_of_desc;\r\n*(ptr + 5) += vdev->vpaths[k].ring.stats.rx_frms;\r\n*(ptr + 6) += vdev->vpaths[k].ring.stats.rx_errors;\r\n*(ptr + 7) += vdev->vpaths[k].ring.stats.rx_bytes;\r\n*(ptr + 8) += vdev->vpaths[k].ring.stats.rx_mcast;\r\n*(ptr + 9) += vdev->vpaths[k].fifo.stats.pci_map_fail +\r\nvdev->vpaths[k].ring.stats.pci_map_fail;\r\n*(ptr + 10) += vdev->vpaths[k].ring.stats.skb_alloc_fail;\r\n}\r\nptr += 12;\r\nkfree(xmac_stats);\r\nkfree(sw_stats);\r\nkfree(hw_stats);\r\n}\r\nstatic void vxge_ethtool_get_strings(struct net_device *dev, u32 stringset,\r\nu8 *data)\r\n{\r\nint stat_size = 0;\r\nint i, j;\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nswitch (stringset) {\r\ncase ETH_SS_STATS:\r\nvxge_add_string("VPATH STATISTICS%s\t\t\t",\r\n&stat_size, data, "");\r\nfor (i = 0; i < vdev->no_of_vpath; i++) {\r\nvxge_add_string("tx_ttl_eth_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_ttl_eth_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_mcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_bcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_ucast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_tagged_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_vld_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_vld_ip_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_icmp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_tcp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_rst_tcp_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_udp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_unknown_proto_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_lost_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_parse_error_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_tcp_offload_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_retx_tcp_offload_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_lost_ip_offload_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_eth_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_offload_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_eth_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_offload_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_mcast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_bcast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_ucast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_nucast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_tagged_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_long_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_usized_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_osized_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_frag_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_jabber_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_64_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_65_127_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_128_255_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_256_511_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_512_1023_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_1024_1518_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_1519_4095_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_4096_8191_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_8192_max_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_gt_max_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ip%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ip_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_err_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_icmp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_tcp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_udp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_err_tcp_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_lost_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_lost_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_lost_ip_offload_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_various_discard_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_sleep_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_red_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_queue_full_discard_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_mpa_ok_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\n}\r\nvxge_add_string("\nAGGR STATISTICS%s\t\t\t\t",\r\n&stat_size, data, "");\r\nfor (i = 0; i < vdev->max_config_port; i++) {\r\nvxge_add_string("tx_frms_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_mcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_bcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_discarded_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_errored_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_frms_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_mcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_bcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_discarded_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_errored_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_unknown_slow_proto_frms_%d\t",\r\n&stat_size, data, i);\r\n}\r\nvxge_add_string("\nPORT STATISTICS%s\t\t\t\t",\r\n&stat_size, data, "");\r\nfor (i = 0; i < vdev->max_config_port; i++) {\r\nvxge_add_string("tx_ttl_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_ttl_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_mcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_bcast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_ucast_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_tagged_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_vld_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_vld_ip_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_icmp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_tcp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_rst_tcp_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_udp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_parse_error_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_unknown_protocol_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_pause_ctrl_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_marker_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_lacpdu_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_drop_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_marker_resp_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_xgmii_char2_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_xgmii_char1_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_xgmii_column2_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_xgmii_column1_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_any_err_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_drop_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_offload_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_data_octects_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_offload_octects_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_mcast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vld_bcast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_ucast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_nucast_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_tagged_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_long_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_usized_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_osized_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_frag_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_jabber_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_64_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_65_127_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_128_255_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_256_511_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_512_1023_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_1024_1518_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_1519_4095_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_4096_8191_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_8192_max_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ttl_gt_max_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ip_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_accepted_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_ip_octets_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_err_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_icmp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_tcp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_udp_%d\t\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_err_tcp_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_pause_count_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_pause_ctrl_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_unsup_ctrl_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_fcs_err_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_in_rng_len_err_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_out_rng_len_err_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_drop_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_discard_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_drop_ip_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_drop_udp_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_marker_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_lacpdu_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_unknown_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_marker_resp_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_fcs_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_illegal_pdu_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_switch_discard_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_len_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_rpa_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_l2_mgmt_discard_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_rts_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_trash_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_buff_full_discard_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_red_discard_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_ctrl_err_cnt_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_data_err_cnt_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_char1_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_err_sym_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_column1_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_char2_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_local_fault_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_xgmii_column2_match_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_jettison_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_remote_fault_%d\t\t\t",\r\n&stat_size, data, i);\r\n}\r\nvxge_add_string("\n SOFTWARE STATISTICS%s\t\t\t",\r\n&stat_size, data, "");\r\nfor (i = 0; i < vdev->no_of_vpath; i++) {\r\nvxge_add_string("soft_reset_cnt_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("unknown_alarms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("network_sustained_fault_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("network_sustained_ok_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("kdfcctl_fifo0_overwrite_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("kdfcctl_fifo0_poison_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("kdfcctl_fifo0_dma_error_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("dblgen_fifo0_overflow_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("statsb_pif_chain_error_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("statsb_drop_timeout_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("target_illegal_access_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ini_serr_det_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prc_ring_bumps_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prc_rxdcm_sc_err_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prc_rxdcm_sc_abort_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prc_quanta_size_err_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ring_full_cnt_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ring_usage_cnt_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ring_usage_max_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ring_reserve_free_swaps_cnt_%d\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ring_total_compl_cnt_%d\t\t",\r\n&stat_size, data, i);\r\nfor (j = 0; j < VXGE_HW_DTR_MAX_T_CODE; j++)\r\nvxge_add_string("rxd_t_code_err_cnt%d_%d\t\t",\r\n&stat_size, data, j, i);\r\nvxge_add_string("fifo_full_cnt_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_usage_cnt_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_usage_max_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_reserve_free_swaps_cnt_%d\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_total_compl_cnt_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_total_posts_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("fifo_total_buffers_%d\t\t",\r\n&stat_size, data, i);\r\nfor (j = 0; j < VXGE_HW_DTR_MAX_T_CODE; j++)\r\nvxge_add_string("txd_t_code_err_cnt%d_%d\t\t",\r\n&stat_size, data, j, i);\r\n}\r\nvxge_add_string("\n HARDWARE STATISTICS%s\t\t\t",\r\n&stat_size, data, "");\r\nfor (i = 0; i < vdev->no_of_vpath; i++) {\r\nvxge_add_string("ini_num_mwr_sent_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ini_num_mrd_sent_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ini_num_cpl_rcvd_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ini_num_mwr_byte_sent_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("ini_num_cpl_byte_rcvd_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("wrcrdtarb_xoff_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rdcrdtarb_xoff_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count0_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count1_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count2_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count3_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count4_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("vpath_genstats_count5_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prog_event_vnum0_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prog_event_vnum1_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prog_event_vnum2_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("prog_event_vnum3_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_multi_cast_frame_discard_%d\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_frm_transferred_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rxd_returned_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_mpa_len_fail_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_mpa_mrk_fail_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_mpa_crc_fail_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_permitted_frms_%d\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_vp_reset_discarded_frms_%d\t",\r\n&stat_size, data, i);\r\nvxge_add_string("rx_wol_frms_%d\t\t\t",\r\n&stat_size, data, i);\r\nvxge_add_string("tx_vp_reset_discarded_frms_%d\t",\r\n&stat_size, data, i);\r\n}\r\nmemcpy(data + stat_size, &ethtool_driver_stats_keys,\r\nsizeof(ethtool_driver_stats_keys));\r\n}\r\n}\r\nstatic int vxge_ethtool_get_regs_len(struct net_device *dev)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nreturn sizeof(struct vxge_hw_vpath_reg) * vdev->no_of_vpath;\r\n}\r\nstatic int vxge_ethtool_get_sset_count(struct net_device *dev, int sset)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nswitch (sset) {\r\ncase ETH_SS_STATS:\r\nreturn VXGE_TITLE_LEN +\r\n(vdev->no_of_vpath * VXGE_HW_VPATH_STATS_LEN) +\r\n(vdev->max_config_port * VXGE_HW_AGGR_STATS_LEN) +\r\n(vdev->max_config_port * VXGE_HW_PORT_STATS_LEN) +\r\n(vdev->no_of_vpath * VXGE_HW_VPATH_TX_STATS_LEN) +\r\n(vdev->no_of_vpath * VXGE_HW_VPATH_RX_STATS_LEN) +\r\n(vdev->no_of_vpath * VXGE_SW_STATS_LEN) +\r\nDRIVER_STAT_LEN;\r\ndefault:\r\nreturn -EOPNOTSUPP;\r\n}\r\n}\r\nstatic int vxge_fw_flash(struct net_device *dev, struct ethtool_flash *parms)\r\n{\r\nstruct vxgedev *vdev = netdev_priv(dev);\r\nif (vdev->max_vpath_supported != VXGE_HW_MAX_VIRTUAL_PATHS) {\r\nprintk(KERN_INFO "Single Function Mode is required to flash the"\r\n" firmware\n");\r\nreturn -EINVAL;\r\n}\r\nif (netif_running(dev)) {\r\nprintk(KERN_INFO "Interface %s must be down to flash the "\r\n"firmware\n", dev->name);\r\nreturn -EBUSY;\r\n}\r\nreturn vxge_fw_upgrade(vdev, parms->data, 1);\r\n}\r\nvoid vxge_initialize_ethtool_ops(struct net_device *ndev)\r\n{\r\nSET_ETHTOOL_OPS(ndev, &vxge_ethtool_ops);\r\n}
