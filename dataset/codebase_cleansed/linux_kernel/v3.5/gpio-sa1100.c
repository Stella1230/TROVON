static int sa1100_gpio_get(struct gpio_chip *chip, unsigned offset)\r\n{\r\nreturn GPLR & GPIO_GPIO(offset);\r\n}\r\nstatic void sa1100_gpio_set(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\nif (value)\r\nGPSR = GPIO_GPIO(offset);\r\nelse\r\nGPCR = GPIO_GPIO(offset);\r\n}\r\nstatic int sa1100_direction_input(struct gpio_chip *chip, unsigned offset)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nGPDR &= ~GPIO_GPIO(offset);\r\nlocal_irq_restore(flags);\r\nreturn 0;\r\n}\r\nstatic int sa1100_direction_output(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nsa1100_gpio_set(chip, offset, value);\r\nGPDR |= GPIO_GPIO(offset);\r\nlocal_irq_restore(flags);\r\nreturn 0;\r\n}\r\nstatic int sa1100_to_irq(struct gpio_chip *chip, unsigned offset)\r\n{\r\nreturn offset < 11 ? (IRQ_GPIO0 + offset) : (IRQ_GPIO11 - 11 + offset);\r\n}\r\nvoid __init sa1100_init_gpio(void)\r\n{\r\ngpiochip_add(&sa1100_gpio_chip);\r\n}
