static inline void unmask_rm9k_irq(struct irq_data *d)\r\n{\r\nset_c0_intcontrol(0x1000 << (d->irq - RM9K_CPU_IRQ_BASE));\r\n}\r\nstatic inline void mask_rm9k_irq(struct irq_data *d)\r\n{\r\nclear_c0_intcontrol(0x1000 << (d->irq - RM9K_CPU_IRQ_BASE));\r\n}\r\nstatic inline void rm9k_cpu_irq_enable(struct irq_data *d)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nunmask_rm9k_irq(d);\r\nlocal_irq_restore(flags);\r\n}\r\nstatic void local_rm9k_perfcounter_irq_startup(void *args)\r\n{\r\nrm9k_cpu_irq_enable(args);\r\n}\r\nstatic unsigned int rm9k_perfcounter_irq_startup(struct irq_data *d)\r\n{\r\non_each_cpu(local_rm9k_perfcounter_irq_startup, d, 1);\r\nreturn 0;\r\n}\r\nstatic void local_rm9k_perfcounter_irq_shutdown(void *args)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nmask_rm9k_irq(args);\r\nlocal_irq_restore(flags);\r\n}\r\nstatic void rm9k_perfcounter_irq_shutdown(struct irq_data *d)\r\n{\r\non_each_cpu(local_rm9k_perfcounter_irq_shutdown, d, 1);\r\n}\r\nvoid __init rm9k_cpu_irq_init(void)\r\n{\r\nint base = RM9K_CPU_IRQ_BASE;\r\nint i;\r\nclear_c0_intcontrol(0x0000f000);\r\nfor (i = base; i < base + 4; i++)\r\nirq_set_chip_and_handler(i, &rm9k_irq_controller,\r\nhandle_level_irq);\r\nrm9000_perfcount_irq = base + 1;\r\nirq_set_chip_and_handler(rm9000_perfcount_irq, &rm9k_perfcounter_irq,\r\nhandle_percpu_irq);\r\n}
