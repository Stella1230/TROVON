static int __s5p_mipi_phy_control(struct platform_device *pdev,\r\nbool on, u32 reset)\r\n{\r\nstatic DEFINE_SPINLOCK(lock);\r\nvoid __iomem *addr;\r\nunsigned long flags;\r\nint pid;\r\nu32 cfg;\r\nif (!pdev)\r\nreturn -EINVAL;\r\npid = (pdev->id == -1) ? 0 : pdev->id;\r\nif (pid != 0 && pid != 1)\r\nreturn -EINVAL;\r\naddr = S5P_MIPI_DPHY_CONTROL(pid);\r\nspin_lock_irqsave(&lock, flags);\r\ncfg = __raw_readl(addr);\r\ncfg = on ? (cfg | reset) : (cfg & ~reset);\r\n__raw_writel(cfg, addr);\r\nif (on) {\r\ncfg |= S5P_MIPI_DPHY_ENABLE;\r\n} else if (!(cfg & (S5P_MIPI_DPHY_SRESETN |\r\nS5P_MIPI_DPHY_MRESETN) & ~reset)) {\r\ncfg &= ~S5P_MIPI_DPHY_ENABLE;\r\n}\r\n__raw_writel(cfg, addr);\r\nspin_unlock_irqrestore(&lock, flags);\r\nreturn 0;\r\n}\r\nint s5p_csis_phy_enable(struct platform_device *pdev, bool on)\r\n{\r\nreturn __s5p_mipi_phy_control(pdev, on, S5P_MIPI_DPHY_SRESETN);\r\n}\r\nint s5p_dsim_phy_enable(struct platform_device *pdev, bool on)\r\n{\r\nreturn __s5p_mipi_phy_control(pdev, on, S5P_MIPI_DPHY_MRESETN);\r\n}
