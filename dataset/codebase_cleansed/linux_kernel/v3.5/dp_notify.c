static int dp_device_event(struct notifier_block *unused, unsigned long event,\r\nvoid *ptr)\r\n{\r\nstruct net_device *dev = ptr;\r\nstruct vport *vport;\r\nif (ovs_is_internal_dev(dev))\r\nvport = ovs_internal_dev_get_vport(dev);\r\nelse\r\nvport = ovs_netdev_get_vport(dev);\r\nif (!vport)\r\nreturn NOTIFY_DONE;\r\nswitch (event) {\r\ncase NETDEV_UNREGISTER:\r\nif (!ovs_is_internal_dev(dev)) {\r\nstruct sk_buff *notify;\r\nnotify = ovs_vport_cmd_build_info(vport, 0, 0,\r\nOVS_VPORT_CMD_DEL);\r\novs_dp_detach_port(vport);\r\nif (IS_ERR(notify)) {\r\nnetlink_set_err(init_net.genl_sock, 0,\r\novs_dp_vport_multicast_group.id,\r\nPTR_ERR(notify));\r\nbreak;\r\n}\r\ngenlmsg_multicast(notify, 0, ovs_dp_vport_multicast_group.id,\r\nGFP_KERNEL);\r\n}\r\nbreak;\r\n}\r\nreturn NOTIFY_DONE;\r\n}
