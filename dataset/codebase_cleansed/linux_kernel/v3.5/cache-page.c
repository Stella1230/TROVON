void flush_dcache_page(struct page *page)\r\n{\r\nunsigned long dampr2;\r\nvoid *vaddr;\r\ndampr2 = __get_DAMPR(2);\r\nvaddr = kmap_atomic_primary(page, __KM_CACHE);\r\nfrv_dcache_writeback((unsigned long) vaddr, (unsigned long) vaddr + PAGE_SIZE);\r\nkunmap_atomic_primary(vaddr, __KM_CACHE);\r\nif (dampr2) {\r\n__set_DAMPR(2, dampr2);\r\n__set_IAMPR(2, dampr2);\r\n}\r\n}\r\nvoid flush_icache_user_range(struct vm_area_struct *vma, struct page *page,\r\nunsigned long start, unsigned long len)\r\n{\r\nunsigned long dampr2;\r\nvoid *vaddr;\r\ndampr2 = __get_DAMPR(2);\r\nvaddr = kmap_atomic_primary(page, __KM_CACHE);\r\nstart = (start & ~PAGE_MASK) | (unsigned long) vaddr;\r\nfrv_cache_wback_inv(start, start + len);\r\nkunmap_atomic_primary(vaddr, __KM_CACHE);\r\nif (dampr2) {\r\n__set_DAMPR(2, dampr2);\r\n__set_IAMPR(2, dampr2);\r\n}\r\n}
