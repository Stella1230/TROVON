static ssize_t snd_gf1_mem_proc_dump(struct snd_info_entry *entry,\r\nvoid *file_private_data,\r\nstruct file *file, char __user *buf,\r\nsize_t count, loff_t pos)\r\n{\r\nstruct gus_proc_private *priv = entry->private_data;\r\nstruct snd_gus_card *gus = priv->gus;\r\nint err;\r\nerr = snd_gus_dram_read(gus, buf, pos, count, priv->rom);\r\nif (err < 0)\r\nreturn err;\r\nreturn count;\r\n}\r\nstatic void snd_gf1_mem_proc_free(struct snd_info_entry *entry)\r\n{\r\nstruct gus_proc_private *priv = entry->private_data;\r\nkfree(priv);\r\n}\r\nint snd_gf1_mem_proc_init(struct snd_gus_card * gus)\r\n{\r\nint idx;\r\nchar name[16];\r\nstruct gus_proc_private *priv;\r\nstruct snd_info_entry *entry;\r\nfor (idx = 0; idx < 4; idx++) {\r\nif (gus->gf1.mem_alloc.banks_8[idx].size > 0) {\r\npriv = kzalloc(sizeof(*priv), GFP_KERNEL);\r\nif (priv == NULL)\r\nreturn -ENOMEM;\r\npriv->gus = gus;\r\nsprintf(name, "gus-ram-%i", idx);\r\nif (! snd_card_proc_new(gus->card, name, &entry)) {\r\nentry->content = SNDRV_INFO_CONTENT_DATA;\r\nentry->private_data = priv;\r\nentry->private_free = snd_gf1_mem_proc_free;\r\nentry->c.ops = &snd_gf1_mem_proc_ops;\r\npriv->address = gus->gf1.mem_alloc.banks_8[idx].address;\r\npriv->size = entry->size = gus->gf1.mem_alloc.banks_8[idx].size;\r\n}\r\n}\r\n}\r\nfor (idx = 0; idx < 4; idx++) {\r\nif (gus->gf1.rom_present & (1 << idx)) {\r\npriv = kzalloc(sizeof(*priv), GFP_KERNEL);\r\nif (priv == NULL)\r\nreturn -ENOMEM;\r\npriv->rom = 1;\r\npriv->gus = gus;\r\nsprintf(name, "gus-rom-%i", idx);\r\nif (! snd_card_proc_new(gus->card, name, &entry)) {\r\nentry->content = SNDRV_INFO_CONTENT_DATA;\r\nentry->private_data = priv;\r\nentry->private_free = snd_gf1_mem_proc_free;\r\nentry->c.ops = &snd_gf1_mem_proc_ops;\r\npriv->address = idx * 4096 * 1024;\r\npriv->size = entry->size = gus->gf1.rom_memory;\r\n}\r\n}\r\n}\r\nreturn 0;\r\n}
