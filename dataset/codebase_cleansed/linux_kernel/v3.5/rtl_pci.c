static void rtl8192_parse_pci_configuration(struct pci_dev *pdev,\r\nstruct net_device *dev)\r\n{\r\nstruct r8192_priv *priv = (struct r8192_priv *)rtllib_priv(dev);\r\nu8 tmp;\r\nint pos;\r\nu8 LinkCtrlReg;\r\npos = pci_find_capability(priv->pdev, PCI_CAP_ID_EXP);\r\npci_read_config_byte(priv->pdev, pos + PCI_EXP_LNKCTL, &LinkCtrlReg);\r\npriv->NdisAdapter.LinkCtrlReg = LinkCtrlReg;\r\nRT_TRACE(COMP_INIT, "Link Control Register =%x\n",\r\npriv->NdisAdapter.LinkCtrlReg);\r\npci_read_config_byte(pdev, 0x98, &tmp);\r\ntmp |= BIT4;\r\npci_write_config_byte(pdev, 0x98, tmp);\r\ntmp = 0x17;\r\npci_write_config_byte(pdev, 0x70f, tmp);\r\n}\r\nbool rtl8192_pci_findadapter(struct pci_dev *pdev, struct net_device *dev)\r\n{\r\nstruct r8192_priv *priv = (struct r8192_priv *)rtllib_priv(dev);\r\nu16 VenderID;\r\nu16 DeviceID;\r\nu8 RevisionID;\r\nu16 IrqLine;\r\nVenderID = pdev->vendor;\r\nDeviceID = pdev->device;\r\nRevisionID = pdev->revision;\r\npci_read_config_word(pdev, 0x3C, &IrqLine);\r\npriv->card_8192 = priv->ops->nic_type;\r\nif (DeviceID == 0x8172) {\r\nswitch (RevisionID) {\r\ncase HAL_HW_PCI_REVISION_ID_8192PCIE:\r\nprintk(KERN_INFO "Adapter(8192 PCI-E) is found - "\r\n"DeviceID=%x\n", DeviceID);\r\npriv->card_8192 = NIC_8192E;\r\nbreak;\r\ncase HAL_HW_PCI_REVISION_ID_8192SE:\r\nprintk(KERN_INFO "Adapter(8192SE) is found - "\r\n"DeviceID=%x\n", DeviceID);\r\npriv->card_8192 = NIC_8192SE;\r\nbreak;\r\ndefault:\r\nprintk(KERN_INFO "UNKNOWN nic type(%4x:%4x)\n",\r\npdev->vendor, pdev->device);\r\npriv->card_8192 = NIC_UNKNOWN;\r\nreturn false;\r\n}\r\n}\r\nif (priv->ops->nic_type != priv->card_8192) {\r\nprintk(KERN_INFO "Detect info(%x) and hardware info(%x) not match!\n",\r\npriv->ops->nic_type, priv->card_8192);\r\nprintk(KERN_INFO "Please select proper driver before install!!!!\n");\r\nreturn false;\r\n}\r\nrtl8192_parse_pci_configuration(pdev, dev);\r\nreturn true;\r\n}
