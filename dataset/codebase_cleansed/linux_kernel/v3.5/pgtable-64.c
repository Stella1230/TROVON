void pgd_init(unsigned long page)\r\n{\r\nunsigned long *p, *end;\r\nunsigned long entry;\r\n#ifdef __PAGETABLE_PMD_FOLDED\r\nentry = (unsigned long)invalid_pte_table;\r\n#else\r\nentry = (unsigned long)invalid_pmd_table;\r\n#endif\r\np = (unsigned long *) page;\r\nend = p + PTRS_PER_PGD;\r\nwhile (p < end) {\r\np[0] = entry;\r\np[1] = entry;\r\np[2] = entry;\r\np[3] = entry;\r\np[4] = entry;\r\np[5] = entry;\r\np[6] = entry;\r\np[7] = entry;\r\np += 8;\r\n}\r\n}\r\nvoid pmd_init(unsigned long addr, unsigned long pagetable)\r\n{\r\nunsigned long *p, *end;\r\np = (unsigned long *) addr;\r\nend = p + PTRS_PER_PMD;\r\nwhile (p < end) {\r\np[0] = pagetable;\r\np[1] = pagetable;\r\np[2] = pagetable;\r\np[3] = pagetable;\r\np[4] = pagetable;\r\np[5] = pagetable;\r\np[6] = pagetable;\r\np[7] = pagetable;\r\np += 8;\r\n}\r\n}\r\nvoid __init pagetable_init(void)\r\n{\r\nunsigned long vaddr;\r\npgd_t *pgd_base;\r\npgd_init((unsigned long)swapper_pg_dir);\r\n#ifndef __PAGETABLE_PMD_FOLDED\r\npmd_init((unsigned long)invalid_pmd_table, (unsigned long)invalid_pte_table);\r\n#endif\r\npgd_base = swapper_pg_dir;\r\nvaddr = __fix_to_virt(__end_of_fixed_addresses - 1) & PMD_MASK;\r\nfixrange_init(vaddr, vaddr + FIXADDR_SIZE, pgd_base);\r\n}
