static void regulator_fixed_release(struct device *dev)\r\n{\r\nstruct fixed_regulator_data *data = container_of(dev,\r\nstruct fixed_regulator_data, pdev.dev);\r\nkfree(data);\r\n}\r\nstruct platform_device *regulator_register_fixed(int id,\r\nstruct regulator_consumer_supply *supplies, int num_supplies)\r\n{\r\nstruct fixed_regulator_data *data;\r\ndata = kzalloc(sizeof(*data), GFP_KERNEL);\r\nif (!data)\r\nreturn NULL;\r\ndata->cfg.supply_name = "fixed-dummy";\r\ndata->cfg.microvolts = 0;\r\ndata->cfg.gpio = -EINVAL;\r\ndata->cfg.enabled_at_boot = 1;\r\ndata->cfg.init_data = &data->init_data;\r\ndata->init_data.constraints.always_on = 1;\r\ndata->init_data.consumer_supplies = supplies;\r\ndata->init_data.num_consumer_supplies = num_supplies;\r\ndata->pdev.name = "reg-fixed-voltage";\r\ndata->pdev.id = id;\r\ndata->pdev.dev.platform_data = &data->cfg;\r\ndata->pdev.dev.release = regulator_fixed_release;\r\nplatform_device_register(&data->pdev);\r\nreturn &data->pdev;\r\n}
