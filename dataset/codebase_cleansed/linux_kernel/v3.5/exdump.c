static void\r\nacpi_ex_dump_object(union acpi_operand_object *obj_desc,\r\nstruct acpi_exdump_info *info)\r\n{\r\nu8 *target;\r\nchar *name;\r\nu8 count;\r\nif (!info) {\r\nacpi_os_printf\r\n("ExDumpObject: Display not implemented for object type %s\n",\r\nacpi_ut_get_object_type_name(obj_desc));\r\nreturn;\r\n}\r\ncount = info->offset;\r\nwhile (count) {\r\ntarget = ACPI_ADD_PTR(u8, obj_desc, info->offset);\r\nname = info->name;\r\nswitch (info->opcode) {\r\ncase ACPI_EXD_INIT:\r\nbreak;\r\ncase ACPI_EXD_TYPE:\r\nacpi_ex_out_string("Type",\r\nacpi_ut_get_object_type_name\r\n(obj_desc));\r\nbreak;\r\ncase ACPI_EXD_UINT8:\r\nacpi_os_printf("%20s : %2.2X\n", name, *target);\r\nbreak;\r\ncase ACPI_EXD_UINT16:\r\nacpi_os_printf("%20s : %4.4X\n", name,\r\nACPI_GET16(target));\r\nbreak;\r\ncase ACPI_EXD_UINT32:\r\nacpi_os_printf("%20s : %8.8X\n", name,\r\nACPI_GET32(target));\r\nbreak;\r\ncase ACPI_EXD_UINT64:\r\nacpi_os_printf("%20s : %8.8X%8.8X\n", "Value",\r\nACPI_FORMAT_UINT64(ACPI_GET64(target)));\r\nbreak;\r\ncase ACPI_EXD_POINTER:\r\ncase ACPI_EXD_ADDRESS:\r\nacpi_ex_out_pointer(name,\r\n*ACPI_CAST_PTR(void *, target));\r\nbreak;\r\ncase ACPI_EXD_STRING:\r\nacpi_ut_print_string(obj_desc->string.pointer,\r\nACPI_UINT8_MAX);\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_EXD_BUFFER:\r\nACPI_DUMP_BUFFER(obj_desc->buffer.pointer,\r\nobj_desc->buffer.length);\r\nbreak;\r\ncase ACPI_EXD_PACKAGE:\r\nacpi_os_printf("\nPackage Contents:\n");\r\nacpi_ex_dump_package_obj(obj_desc, 0, 0);\r\nbreak;\r\ncase ACPI_EXD_FIELD:\r\nacpi_ex_dump_object(obj_desc,\r\nacpi_ex_dump_field_common);\r\nbreak;\r\ncase ACPI_EXD_REFERENCE:\r\nacpi_ex_out_string("Class Name",\r\nACPI_CAST_PTR(char,\r\nacpi_ut_get_reference_name\r\n(obj_desc)));\r\nacpi_ex_dump_reference_obj(obj_desc);\r\nbreak;\r\ndefault:\r\nacpi_os_printf("**** Invalid table opcode [%X] ****\n",\r\ninfo->opcode);\r\nreturn;\r\n}\r\ninfo++;\r\ncount--;\r\n}\r\n}\r\nvoid acpi_ex_dump_operand(union acpi_operand_object *obj_desc, u32 depth)\r\n{\r\nu32 length;\r\nu32 index;\r\nACPI_FUNCTION_NAME(ex_dump_operand)\r\nif (!((ACPI_LV_EXEC & acpi_dbg_level)\r\n&& (_COMPONENT & acpi_dbg_layer))) {\r\nreturn;\r\n}\r\nif (!obj_desc) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "Null Object Descriptor\n"));\r\nreturn;\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) == ACPI_DESC_TYPE_NAMED) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "%p Namespace Node: ",\r\nobj_desc));\r\nACPI_DUMP_ENTRY(obj_desc, ACPI_LV_EXEC);\r\nreturn;\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) != ACPI_DESC_TYPE_OPERAND) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"%p is not a node or operand object: [%s]\n",\r\nobj_desc,\r\nacpi_ut_get_descriptor_name(obj_desc)));\r\nACPI_DUMP_BUFFER(obj_desc, sizeof(union acpi_operand_object));\r\nreturn;\r\n}\r\nif (depth > 0) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "%*s[%u] %p ",\r\ndepth, " ", depth, obj_desc));\r\n} else {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "%p ", obj_desc));\r\n}\r\nswitch (obj_desc->common.type) {\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nacpi_os_printf("Reference: [%s] ",\r\nacpi_ut_get_reference_name(obj_desc));\r\nswitch (obj_desc->reference.class) {\r\ncase ACPI_REFCLASS_DEBUG:\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_REFCLASS_INDEX:\r\nacpi_os_printf("%p\n", obj_desc->reference.object);\r\nbreak;\r\ncase ACPI_REFCLASS_TABLE:\r\nacpi_os_printf("Table Index %X\n",\r\nobj_desc->reference.value);\r\nbreak;\r\ncase ACPI_REFCLASS_REFOF:\r\nacpi_os_printf("%p [%s]\n", obj_desc->reference.object,\r\nacpi_ut_get_type_name(((union\r\nacpi_operand_object\r\n*)\r\nobj_desc->\r\nreference.\r\nobject)->common.\r\ntype));\r\nbreak;\r\ncase ACPI_REFCLASS_NAME:\r\nacpi_os_printf("- [%4.4s]\n",\r\nobj_desc->reference.node->name.ascii);\r\nbreak;\r\ncase ACPI_REFCLASS_ARG:\r\ncase ACPI_REFCLASS_LOCAL:\r\nacpi_os_printf("%X\n", obj_desc->reference.value);\r\nbreak;\r\ndefault:\r\nacpi_os_printf("%2.2X\n", obj_desc->reference.class);\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nacpi_os_printf("Buffer length %.2X @ %p\n",\r\nobj_desc->buffer.length,\r\nobj_desc->buffer.pointer);\r\nif (obj_desc->buffer.pointer) {\r\nlength = obj_desc->buffer.length;\r\nif (length > 128) {\r\nlength = 128;\r\n}\r\nacpi_os_printf\r\n("Buffer Contents: (displaying length 0x%.2X)\n",\r\nlength);\r\nACPI_DUMP_BUFFER(obj_desc->buffer.pointer, length);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf("Integer %8.8X%8.8X\n",\r\nACPI_FORMAT_UINT64(obj_desc->integer.value));\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nacpi_os_printf("Package [Len %X] ElementArray %p\n",\r\nobj_desc->package.count,\r\nobj_desc->package.elements);\r\nif (obj_desc->package.count &&\r\nobj_desc->package.elements && acpi_dbg_level > 1) {\r\nfor (index = 0; index < obj_desc->package.count;\r\nindex++) {\r\nacpi_ex_dump_operand(obj_desc->package.\r\nelements[index],\r\ndepth + 1);\r\n}\r\n}\r\nbreak;\r\ncase ACPI_TYPE_REGION:\r\nacpi_os_printf("Region %s (%X)",\r\nacpi_ut_get_region_name(obj_desc->region.\r\nspace_id),\r\nobj_desc->region.space_id);\r\nif (!(obj_desc->region.flags & AOPOBJ_DATA_VALID)) {\r\nacpi_os_printf("\n");\r\n} else {\r\nacpi_os_printf(" base %8.8X%8.8X Length %X\n",\r\nACPI_FORMAT_NATIVE_UINT(obj_desc->region.\r\naddress),\r\nobj_desc->region.length);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf("String length %X @ %p ",\r\nobj_desc->string.length,\r\nobj_desc->string.pointer);\r\nacpi_ut_print_string(obj_desc->string.pointer, ACPI_UINT8_MAX);\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\nacpi_os_printf("BankField\n");\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\nacpi_os_printf\r\n("RegionField: Bits=%X AccWidth=%X Lock=%X Update=%X at "\r\n"byte=%X bit=%X of below:\n", obj_desc->field.bit_length,\r\nobj_desc->field.access_byte_width,\r\nobj_desc->field.field_flags & AML_FIELD_LOCK_RULE_MASK,\r\nobj_desc->field.field_flags & AML_FIELD_UPDATE_RULE_MASK,\r\nobj_desc->field.base_byte_offset,\r\nobj_desc->field.start_field_bit_offset);\r\nacpi_ex_dump_operand(obj_desc->field.region_obj, depth + 1);\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nacpi_os_printf("IndexField\n");\r\nbreak;\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\nacpi_os_printf("BufferField: %X bits at byte %X bit %X of\n",\r\nobj_desc->buffer_field.bit_length,\r\nobj_desc->buffer_field.base_byte_offset,\r\nobj_desc->buffer_field.start_field_bit_offset);\r\nif (!obj_desc->buffer_field.buffer_obj) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "*NULL*\n"));\r\n} else if ((obj_desc->buffer_field.buffer_obj)->common.type !=\r\nACPI_TYPE_BUFFER) {\r\nacpi_os_printf("*not a Buffer*\n");\r\n} else {\r\nacpi_ex_dump_operand(obj_desc->buffer_field.buffer_obj,\r\ndepth + 1);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_EVENT:\r\nacpi_os_printf("Event\n");\r\nbreak;\r\ncase ACPI_TYPE_METHOD:\r\nacpi_os_printf("Method(%X) @ %p:%X\n",\r\nobj_desc->method.param_count,\r\nobj_desc->method.aml_start,\r\nobj_desc->method.aml_length);\r\nbreak;\r\ncase ACPI_TYPE_MUTEX:\r\nacpi_os_printf("Mutex\n");\r\nbreak;\r\ncase ACPI_TYPE_DEVICE:\r\nacpi_os_printf("Device\n");\r\nbreak;\r\ncase ACPI_TYPE_POWER:\r\nacpi_os_printf("Power\n");\r\nbreak;\r\ncase ACPI_TYPE_PROCESSOR:\r\nacpi_os_printf("Processor\n");\r\nbreak;\r\ncase ACPI_TYPE_THERMAL:\r\nacpi_os_printf("Thermal\n");\r\nbreak;\r\ndefault:\r\nacpi_os_printf("Unknown Type %X\n", obj_desc->common.type);\r\nbreak;\r\n}\r\nreturn;\r\n}\r\nvoid\r\nacpi_ex_dump_operands(union acpi_operand_object **operands,\r\nconst char *opcode_name, u32 num_operands)\r\n{\r\nACPI_FUNCTION_NAME(ex_dump_operands);\r\nif (!opcode_name) {\r\nopcode_name = "UNKNOWN";\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"**** Start operand dump for opcode [%s], %u operands\n",\r\nopcode_name, num_operands));\r\nif (num_operands == 0) {\r\nnum_operands = 1;\r\n}\r\nwhile (num_operands) {\r\nacpi_ex_dump_operand(*operands, 0);\r\noperands++;\r\nnum_operands--;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"**** End operand dump for [%s]\n", opcode_name));\r\nreturn;\r\n}\r\nstatic void acpi_ex_out_string(char *title, char *value)\r\n{\r\nacpi_os_printf("%20s : %s\n", title, value);\r\n}\r\nstatic void acpi_ex_out_pointer(char *title, void *value)\r\n{\r\nacpi_os_printf("%20s : %p\n", title, value);\r\n}\r\nvoid acpi_ex_dump_namespace_node(struct acpi_namespace_node *node, u32 flags)\r\n{\r\nACPI_FUNCTION_ENTRY();\r\nif (!flags) {\r\nif (!((ACPI_LV_OBJECTS & acpi_dbg_level)\r\n&& (_COMPONENT & acpi_dbg_layer))) {\r\nreturn;\r\n}\r\n}\r\nacpi_os_printf("%20s : %4.4s\n", "Name", acpi_ut_get_node_name(node));\r\nacpi_ex_out_string("Type", acpi_ut_get_type_name(node->type));\r\nacpi_ex_out_pointer("Attached Object",\r\nacpi_ns_get_attached_object(node));\r\nacpi_ex_out_pointer("Parent", node->parent);\r\nacpi_ex_dump_object(ACPI_CAST_PTR(union acpi_operand_object, node),\r\nacpi_ex_dump_node);\r\n}\r\nstatic void acpi_ex_dump_reference_obj(union acpi_operand_object *obj_desc)\r\n{\r\nstruct acpi_buffer ret_buf;\r\nacpi_status status;\r\nret_buf.length = ACPI_ALLOCATE_LOCAL_BUFFER;\r\nif (obj_desc->reference.class == ACPI_REFCLASS_NAME) {\r\nacpi_os_printf(" %p ", obj_desc->reference.node);\r\nstatus =\r\nacpi_ns_handle_to_pathname(obj_desc->reference.node,\r\n&ret_buf);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_os_printf(" Could not convert name to pathname\n");\r\n} else {\r\nacpi_os_printf("%s\n", (char *)ret_buf.pointer);\r\nACPI_FREE(ret_buf.pointer);\r\n}\r\n} else if (obj_desc->reference.object) {\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) ==\r\nACPI_DESC_TYPE_OPERAND) {\r\nacpi_os_printf(" Target: %p",\r\nobj_desc->reference.object);\r\nif (obj_desc->reference.class == ACPI_REFCLASS_TABLE) {\r\nacpi_os_printf(" Table Index: %X\n",\r\nobj_desc->reference.value);\r\n} else {\r\nacpi_os_printf(" Target: %p [%s]\n",\r\nobj_desc->reference.object,\r\nacpi_ut_get_type_name(((union\r\nacpi_operand_object\r\n*)\r\nobj_desc->\r\nreference.\r\nobject)->\r\ncommon.\r\ntype));\r\n}\r\n} else {\r\nacpi_os_printf(" Target: %p\n",\r\nobj_desc->reference.object);\r\n}\r\n}\r\n}\r\nstatic void\r\nacpi_ex_dump_package_obj(union acpi_operand_object *obj_desc,\r\nu32 level, u32 index)\r\n{\r\nu32 i;\r\nif (level > 0) {\r\nfor (i = 0; i < level; i++) {\r\nacpi_os_printf(" ");\r\n}\r\nacpi_os_printf("[%.2d] ", index);\r\n}\r\nacpi_os_printf("%p ", obj_desc);\r\nif (!obj_desc) {\r\nacpi_os_printf("[Null Object]\n");\r\nreturn;\r\n}\r\nswitch (obj_desc->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf("[Integer] = %8.8X%8.8X\n",\r\nACPI_FORMAT_UINT64(obj_desc->integer.value));\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf("[String] Value: ");\r\nfor (i = 0; i < obj_desc->string.length; i++) {\r\nacpi_os_printf("%c", obj_desc->string.pointer[i]);\r\n}\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nacpi_os_printf("[Buffer] Length %.2X = ",\r\nobj_desc->buffer.length);\r\nif (obj_desc->buffer.length) {\r\nacpi_ut_dump_buffer(ACPI_CAST_PTR\r\n(u8, obj_desc->buffer.pointer),\r\nobj_desc->buffer.length,\r\nDB_DWORD_DISPLAY, _COMPONENT);\r\n} else {\r\nacpi_os_printf("\n");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nacpi_os_printf("[Package] Contains %u Elements:\n",\r\nobj_desc->package.count);\r\nfor (i = 0; i < obj_desc->package.count; i++) {\r\nacpi_ex_dump_package_obj(obj_desc->package.elements[i],\r\nlevel + 1, i);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nacpi_os_printf("[Object Reference] Type [%s] %2.2X",\r\nacpi_ut_get_reference_name(obj_desc),\r\nobj_desc->reference.class);\r\nacpi_ex_dump_reference_obj(obj_desc);\r\nbreak;\r\ndefault:\r\nacpi_os_printf("[Unknown Type] %X\n", obj_desc->common.type);\r\nbreak;\r\n}\r\n}\r\nvoid\r\nacpi_ex_dump_object_descriptor(union acpi_operand_object *obj_desc, u32 flags)\r\n{\r\nACPI_FUNCTION_TRACE(ex_dump_object_descriptor);\r\nif (!obj_desc) {\r\nreturn_VOID;\r\n}\r\nif (!flags) {\r\nif (!((ACPI_LV_OBJECTS & acpi_dbg_level)\r\n&& (_COMPONENT & acpi_dbg_layer))) {\r\nreturn_VOID;\r\n}\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) == ACPI_DESC_TYPE_NAMED) {\r\nacpi_ex_dump_namespace_node((struct acpi_namespace_node *)\r\nobj_desc, flags);\r\nacpi_os_printf("\nAttached Object (%p):\n",\r\n((struct acpi_namespace_node *)obj_desc)->\r\nobject);\r\nacpi_ex_dump_object_descriptor(((struct acpi_namespace_node *)\r\nobj_desc)->object, flags);\r\nreturn_VOID;\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) != ACPI_DESC_TYPE_OPERAND) {\r\nacpi_os_printf\r\n("ExDumpObjectDescriptor: %p is not an ACPI operand object: [%s]\n",\r\nobj_desc, acpi_ut_get_descriptor_name(obj_desc));\r\nreturn_VOID;\r\n}\r\nif (obj_desc->common.type > ACPI_TYPE_NS_NODE_MAX) {\r\nreturn_VOID;\r\n}\r\nacpi_ex_dump_object(obj_desc, acpi_ex_dump_common);\r\nacpi_ex_dump_object(obj_desc, acpi_ex_dump_info[obj_desc->common.type]);\r\nreturn_VOID;\r\n}
