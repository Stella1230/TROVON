static int omap4_hdmi_dai_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nint i;\r\nstruct omap_overlay_manager *mgr = NULL;\r\nstruct device *dev = substream->pcm->card->dev;\r\nfor (i = 0; i < omap_dss_get_num_overlay_managers(); i++) {\r\nmgr = omap_dss_get_overlay_manager(i);\r\nif (mgr && mgr->device\r\n&& mgr->device->type == OMAP_DISPLAY_TYPE_HDMI)\r\nbreak;\r\n}\r\nif (i == omap_dss_get_num_overlay_managers()) {\r\ndev_err(dev, "HDMI display device not found!\n");\r\nreturn -ENODEV;\r\n}\r\nif (mgr->device->state != OMAP_DSS_DISPLAY_ACTIVE) {\r\ndev_err(dev, "HDMI display is not active!\n");\r\nreturn -EIO;\r\n}\r\nreturn 0;\r\n}\r\nstatic __devinit int omap4_hdmi_probe(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = &snd_soc_omap4_hdmi;\r\nint ret;\r\ncard->dev = &pdev->dev;\r\nret = snd_soc_register_card(card);\r\nif (ret) {\r\ndev_err(&pdev->dev, "snd_soc_register_card failed (%d)\n", ret);\r\ncard->dev = NULL;\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __devexit omap4_hdmi_remove(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = platform_get_drvdata(pdev);\r\nsnd_soc_unregister_card(card);\r\ncard->dev = NULL;\r\nreturn 0;\r\n}
