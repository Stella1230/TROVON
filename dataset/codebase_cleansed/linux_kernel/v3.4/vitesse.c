int vsc824x_add_skew(struct phy_device *phydev)\r\n{\r\nint err;\r\nint extcon;\r\nextcon = phy_read(phydev, MII_VSC8244_EXT_CON1);\r\nif (extcon < 0)\r\nreturn extcon;\r\nextcon &= ~(MII_VSC8244_EXTCON1_TX_SKEW_MASK |\r\nMII_VSC8244_EXTCON1_RX_SKEW_MASK);\r\nextcon |= (MII_VSC8244_EXTCON1_TX_SKEW |\r\nMII_VSC8244_EXTCON1_RX_SKEW);\r\nerr = phy_write(phydev, MII_VSC8244_EXT_CON1, extcon);\r\nreturn err;\r\n}\r\nstatic int vsc824x_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_VSC8244_AUX_CONSTAT,\r\nMII_VSC8244_AUXCONSTAT_INIT);\r\nif (err < 0)\r\nreturn err;\r\nif (phydev->interface == PHY_INTERFACE_MODE_RGMII_ID)\r\nerr = vsc824x_add_skew(phydev);\r\nreturn err;\r\n}\r\nstatic int vsc824x_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err = 0;\r\nif (phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_read(phydev, MII_VSC8244_ISTAT);\r\nreturn (err < 0) ? err : 0;\r\n}\r\nstatic int vsc82xx_config_intr(struct phy_device *phydev)\r\n{\r\nint err;\r\nif (phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_write(phydev, MII_VSC8244_IMASK,\r\nphydev->drv->phy_id == PHY_ID_VSC8244 ?\r\nMII_VSC8244_IMASK_MASK :\r\nMII_VSC8221_IMASK_MASK);\r\nelse {\r\nerr = phy_read(phydev, MII_VSC8244_ISTAT);\r\nif (err < 0)\r\nreturn err;\r\nerr = phy_write(phydev, MII_VSC8244_IMASK, 0);\r\n}\r\nreturn err;\r\n}\r\nstatic int vsc8221_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_VSC8244_AUX_CONSTAT,\r\nMII_VSC8221_AUXCONSTAT_INIT);\r\nreturn err;\r\n}\r\nstatic int __init vsc82xx_init(void)\r\n{\r\nint err;\r\nerr = phy_driver_register(&vsc8244_driver);\r\nif (err < 0)\r\nreturn err;\r\nerr = phy_driver_register(&vsc8221_driver);\r\nif (err < 0)\r\nphy_driver_unregister(&vsc8244_driver);\r\nreturn err;\r\n}\r\nstatic void __exit vsc82xx_exit(void)\r\n{\r\nphy_driver_unregister(&vsc8244_driver);\r\nphy_driver_unregister(&vsc8221_driver);\r\n}
