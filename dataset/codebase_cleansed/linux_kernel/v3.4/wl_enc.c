int wl_wep_code( char *szCrypt, char *szDest, void *Data, int nLen )\r\n{\r\nint i;\r\nint t;\r\nint k ;\r\nchar bits;\r\nchar *szData = (char *) Data;\r\nfor( i = bits = 0 ; i < MACADDRESS_STR_LEN; i++ ) {\r\nbits ^= szCrypt[i];\r\nbits += szCrypt[i];\r\n}\r\nfor( i = t = *szDest = 0; i < nLen; i++, t++ ) {\r\nk = szData[i] ^ ( bits + i );\r\nswitch( i % 3 ) {\r\ncase 0 :\r\nszDest[t] = ((k & 0xFC) >> 2) + CH_START ;\r\nszDest[t+1] = ((k & 0x03) << 4) + CH_START ;\r\nszDest[t+2] = '\0';\r\nbreak;\r\ncase 1 :\r\nszDest[t] += (( k & 0xF0 ) >> 4 );\r\nszDest[t+1] = (( k & 0x0F ) << 2 ) + CH_START ;\r\nszDest[t+2] = '\0';\r\nbreak;\r\ncase 2 :\r\nszDest[t] += (( k & 0xC0 ) >> 6 );\r\nszDest[t+1] = ( k & 0x3F ) + CH_START ;\r\nszDest[t+2] = '\0';\r\nt++;\r\nbreak;\r\n}\r\n}\r\nreturn( strlen( szDest )) ;\r\n}\r\nint wl_wep_decode( char *szCrypt, void *Dest, char *szData )\r\n{\r\nint i;\r\nint t;\r\nint nLen;\r\nchar bits;\r\nchar *szDest = Dest;\r\nfor( i = bits = 0 ; i < 12; i++ ) {\r\nbits ^= szCrypt[i] ;\r\nbits += szCrypt[i] ;\r\n}\r\nnLen = ( strlen( szData ) * 3) / 4 ;\r\nfor( i = t = 0; i < nLen; i++, t++ ) {\r\nswitch( i % 3 ) {\r\ncase 0 :\r\nszDest[i] = ((( szData[t]-CH_START ) & 0x3f ) << 2 ) +\r\n((( szData[t+1]-CH_START ) & 0x30 ) >> 4 );\r\nbreak;\r\ncase 1 :\r\nszDest[i] = ((( szData[t]-CH_START ) & 0x0f ) << 4 ) +\r\n((( szData[t+1]-CH_START ) & 0x3c ) >> 2 );\r\nbreak;\r\ncase 2 :\r\nszDest[i] = ((( szData[t]-CH_START ) & 0x03 ) << 6 ) +\r\n(( szData[t+1]-CH_START ) & 0x3f );\r\nt++;\r\nbreak;\r\n}\r\nszDest[i] ^= ( bits + i ) ;\r\n}\r\nreturn( i ) ;\r\n}
