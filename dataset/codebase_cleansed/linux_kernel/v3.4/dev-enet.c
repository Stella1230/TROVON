int __init bcm63xx_enet_register(int unit,\r\nconst struct bcm63xx_enet_platform_data *pd)\r\n{\r\nstruct platform_device *pdev;\r\nstruct bcm63xx_enet_platform_data *dpd;\r\nint ret;\r\nif (unit > 1)\r\nreturn -ENODEV;\r\nif (unit == 1 && BCMCPU_IS_6338())\r\nreturn -ENODEV;\r\nif (!shared_device_registered) {\r\nshared_res[0].start = bcm63xx_regset_address(RSET_ENETDMA);\r\nshared_res[0].end = shared_res[0].start;\r\nif (BCMCPU_IS_6338())\r\nshared_res[0].end += (RSET_ENETDMA_SIZE / 2) - 1;\r\nelse\r\nshared_res[0].end += (RSET_ENETDMA_SIZE) - 1;\r\nret = platform_device_register(&bcm63xx_enet_shared_device);\r\nif (ret)\r\nreturn ret;\r\nshared_device_registered = 1;\r\n}\r\nif (unit == 0) {\r\nenet0_res[0].start = bcm63xx_regset_address(RSET_ENET0);\r\nenet0_res[0].end = enet0_res[0].start;\r\nenet0_res[0].end += RSET_ENET_SIZE - 1;\r\nenet0_res[1].start = bcm63xx_get_irq_number(IRQ_ENET0);\r\nenet0_res[2].start = bcm63xx_get_irq_number(IRQ_ENET0_RXDMA);\r\nenet0_res[3].start = bcm63xx_get_irq_number(IRQ_ENET0_TXDMA);\r\npdev = &bcm63xx_enet0_device;\r\n} else {\r\nenet1_res[0].start = bcm63xx_regset_address(RSET_ENET1);\r\nenet1_res[0].end = enet1_res[0].start;\r\nenet1_res[0].end += RSET_ENET_SIZE - 1;\r\nenet1_res[1].start = bcm63xx_get_irq_number(IRQ_ENET1);\r\nenet1_res[2].start = bcm63xx_get_irq_number(IRQ_ENET1_RXDMA);\r\nenet1_res[3].start = bcm63xx_get_irq_number(IRQ_ENET1_TXDMA);\r\npdev = &bcm63xx_enet1_device;\r\n}\r\ndpd = pdev->dev.platform_data;\r\nmemcpy(dpd, pd, sizeof(*pd));\r\nif (dpd->use_internal_phy) {\r\nif (unit == 1)\r\nreturn -ENODEV;\r\ndpd->phy_id = 1;\r\ndpd->has_phy_interrupt = 1;\r\ndpd->phy_interrupt = bcm63xx_get_irq_number(IRQ_ENET_PHY);\r\n}\r\nret = platform_device_register(pdev);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}
