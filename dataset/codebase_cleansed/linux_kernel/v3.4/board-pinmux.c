static void tegra_board_pinmux_setup_gpios(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(confs); i++) {\r\nif (!confs[i])\r\ncontinue;\r\ntegra_gpio_config(confs[i]->gpios, confs[i]->gpio_count);\r\n}\r\n}\r\nstatic void tegra_board_pinmux_setup_pinmux(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(confs); i++) {\r\nif (!confs[i])\r\ncontinue;\r\ntegra_pinmux_config_table(confs[i]->pgs, confs[i]->pg_count);\r\nif (confs[i]->drives)\r\ntegra_drive_pinmux_config_table(confs[i]->drives,\r\nconfs[i]->drive_count);\r\n}\r\n}\r\nstatic int tegra_board_pinmux_bus_notify(struct notifier_block *nb,\r\nunsigned long event, void *vdev)\r\n{\r\nstatic bool had_gpio;\r\nstatic bool had_pinmux;\r\nstruct device *dev = vdev;\r\nconst char *devname;\r\nif (event != BUS_NOTIFY_BOUND_DRIVER)\r\nreturn NOTIFY_DONE;\r\ndevname = dev_name(dev);\r\nif (!had_gpio && !strcmp(devname, GPIO_DEV)) {\r\ntegra_board_pinmux_setup_gpios();\r\nhad_gpio = true;\r\n} else if (!had_pinmux && !strcmp(devname, PINMUX_DEV)) {\r\ntegra_board_pinmux_setup_pinmux();\r\nhad_pinmux = true;\r\n}\r\nif (had_gpio && had_pinmux)\r\nreturn NOTIFY_STOP_MASK;\r\nelse\r\nreturn NOTIFY_DONE;\r\n}\r\nvoid tegra_board_pinmux_init(struct tegra_board_pinmux_conf *conf_a,\r\nstruct tegra_board_pinmux_conf *conf_b)\r\n{\r\nconfs[0] = conf_a;\r\nconfs[1] = conf_b;\r\nbus_register_notifier(&platform_bus_type, &nb);\r\nif (!of_machine_is_compatible("nvidia,tegra20"))\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\n}
