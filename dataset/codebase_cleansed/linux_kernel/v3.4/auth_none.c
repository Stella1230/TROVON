static void reset(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nxi->starting = true;\r\nxi->built_authorizer = false;\r\n}\r\nstatic void destroy(struct ceph_auth_client *ac)\r\n{\r\nkfree(ac->private);\r\nac->private = NULL;\r\n}\r\nstatic int is_authenticated(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nreturn !xi->starting;\r\n}\r\nstatic int should_authenticate(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nreturn xi->starting;\r\n}\r\nstatic int handle_reply(struct ceph_auth_client *ac, int result,\r\nvoid *buf, void *end)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nxi->starting = false;\r\nreturn result;\r\n}\r\nstatic int ceph_auth_none_create_authorizer(\r\nstruct ceph_auth_client *ac, int peer_type,\r\nstruct ceph_authorizer **a,\r\nvoid **buf, size_t *len,\r\nvoid **reply_buf, size_t *reply_len)\r\n{\r\nstruct ceph_auth_none_info *ai = ac->private;\r\nstruct ceph_none_authorizer *au = &ai->au;\r\nvoid *p, *end;\r\nint ret;\r\nif (!ai->built_authorizer) {\r\np = au->buf;\r\nend = p + sizeof(au->buf);\r\nceph_encode_8(&p, 1);\r\nret = ceph_entity_name_encode(ac->name, &p, end - 8);\r\nif (ret < 0)\r\ngoto bad;\r\nceph_decode_need(&p, end, sizeof(u64), bad2);\r\nceph_encode_64(&p, ac->global_id);\r\nau->buf_len = p - (void *)au->buf;\r\nai->built_authorizer = true;\r\ndout("built authorizer len %d\n", au->buf_len);\r\n}\r\n*a = (struct ceph_authorizer *)au;\r\n*buf = au->buf;\r\n*len = au->buf_len;\r\n*reply_buf = au->reply_buf;\r\n*reply_len = sizeof(au->reply_buf);\r\nreturn 0;\r\nbad2:\r\nret = -ERANGE;\r\nbad:\r\nreturn ret;\r\n}\r\nstatic void ceph_auth_none_destroy_authorizer(struct ceph_auth_client *ac,\r\nstruct ceph_authorizer *a)\r\n{\r\n}\r\nint ceph_auth_none_init(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi;\r\ndout("ceph_auth_none_init %p\n", ac);\r\nxi = kzalloc(sizeof(*xi), GFP_NOFS);\r\nif (!xi)\r\nreturn -ENOMEM;\r\nxi->starting = true;\r\nxi->built_authorizer = false;\r\nac->protocol = CEPH_AUTH_NONE;\r\nac->private = xi;\r\nac->ops = &ceph_auth_none_ops;\r\nreturn 0;\r\n}
