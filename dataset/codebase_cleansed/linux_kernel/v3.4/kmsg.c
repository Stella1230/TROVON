static int kmsg_open(struct inode * inode, struct file * file)\r\n{\r\nreturn do_syslog(SYSLOG_ACTION_OPEN, NULL, 0, SYSLOG_FROM_FILE);\r\n}\r\nstatic int kmsg_release(struct inode * inode, struct file * file)\r\n{\r\n(void) do_syslog(SYSLOG_ACTION_CLOSE, NULL, 0, SYSLOG_FROM_FILE);\r\nreturn 0;\r\n}\r\nstatic ssize_t kmsg_read(struct file *file, char __user *buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nif ((file->f_flags & O_NONBLOCK) &&\r\n!do_syslog(SYSLOG_ACTION_SIZE_UNREAD, NULL, 0, SYSLOG_FROM_FILE))\r\nreturn -EAGAIN;\r\nreturn do_syslog(SYSLOG_ACTION_READ, buf, count, SYSLOG_FROM_FILE);\r\n}\r\nstatic unsigned int kmsg_poll(struct file *file, poll_table *wait)\r\n{\r\npoll_wait(file, &log_wait, wait);\r\nif (do_syslog(SYSLOG_ACTION_SIZE_UNREAD, NULL, 0, SYSLOG_FROM_FILE))\r\nreturn POLLIN | POLLRDNORM;\r\nreturn 0;\r\n}\r\nstatic int __init proc_kmsg_init(void)\r\n{\r\nproc_create("kmsg", S_IRUSR, NULL, &proc_kmsg_operations);\r\nreturn 0;\r\n}
