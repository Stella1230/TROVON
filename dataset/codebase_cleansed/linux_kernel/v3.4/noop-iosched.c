static void noop_merged_requests(struct request_queue *q, struct request *rq,\r\nstruct request *next)\r\n{\r\nlist_del_init(&next->queuelist);\r\n}\r\nstatic int noop_dispatch(struct request_queue *q, int force)\r\n{\r\nstruct noop_data *nd = q->elevator->elevator_data;\r\nif (!list_empty(&nd->queue)) {\r\nstruct request *rq;\r\nrq = list_entry(nd->queue.next, struct request, queuelist);\r\nlist_del_init(&rq->queuelist);\r\nelv_dispatch_sort(q, rq);\r\nreturn 1;\r\n}\r\nreturn 0;\r\n}\r\nstatic void noop_add_request(struct request_queue *q, struct request *rq)\r\n{\r\nstruct noop_data *nd = q->elevator->elevator_data;\r\nlist_add_tail(&rq->queuelist, &nd->queue);\r\n}\r\nstatic struct request *\r\nnoop_former_request(struct request_queue *q, struct request *rq)\r\n{\r\nstruct noop_data *nd = q->elevator->elevator_data;\r\nif (rq->queuelist.prev == &nd->queue)\r\nreturn NULL;\r\nreturn list_entry(rq->queuelist.prev, struct request, queuelist);\r\n}\r\nstatic struct request *\r\nnoop_latter_request(struct request_queue *q, struct request *rq)\r\n{\r\nstruct noop_data *nd = q->elevator->elevator_data;\r\nif (rq->queuelist.next == &nd->queue)\r\nreturn NULL;\r\nreturn list_entry(rq->queuelist.next, struct request, queuelist);\r\n}\r\nstatic void *noop_init_queue(struct request_queue *q)\r\n{\r\nstruct noop_data *nd;\r\nnd = kmalloc_node(sizeof(*nd), GFP_KERNEL, q->node);\r\nif (!nd)\r\nreturn NULL;\r\nINIT_LIST_HEAD(&nd->queue);\r\nreturn nd;\r\n}\r\nstatic void noop_exit_queue(struct elevator_queue *e)\r\n{\r\nstruct noop_data *nd = e->elevator_data;\r\nBUG_ON(!list_empty(&nd->queue));\r\nkfree(nd);\r\n}\r\nstatic int __init noop_init(void)\r\n{\r\nreturn elv_register(&elevator_noop);\r\n}\r\nstatic void __exit noop_exit(void)\r\n{\r\nelv_unregister(&elevator_noop);\r\n}
