bool default_stop_ok(struct device *dev)\r\n{\r\nstruct gpd_timing_data *td = &dev_gpd_data(dev)->td;\r\ndev_dbg(dev, "%s()\n", __func__);\r\nif (dev->power.max_time_suspended_ns < 0 || td->break_even_ns == 0)\r\nreturn true;\r\nreturn td->stop_latency_ns + td->start_latency_ns < td->break_even_ns\r\n&& td->break_even_ns < dev->power.max_time_suspended_ns;\r\n}\r\nstatic bool default_power_down_ok(struct dev_pm_domain *pd)\r\n{\r\nstruct generic_pm_domain *genpd = pd_to_genpd(pd);\r\nstruct gpd_link *link;\r\nstruct pm_domain_data *pdd;\r\ns64 min_dev_off_time_ns;\r\ns64 off_on_time_ns;\r\nktime_t time_now = ktime_get();\r\noff_on_time_ns = genpd->power_off_latency_ns +\r\ngenpd->power_on_latency_ns;\r\nlist_for_each_entry(pdd, &genpd->dev_list, list_node) {\r\nif (pdd->dev->driver)\r\noff_on_time_ns +=\r\nto_gpd_data(pdd)->td.save_state_latency_ns;\r\n}\r\nlist_for_each_entry(link, &genpd->master_links, master_node) {\r\nstruct generic_pm_domain *sd = link->slave;\r\ns64 sd_max_off_ns = sd->max_off_time_ns;\r\nif (sd_max_off_ns < 0)\r\ncontinue;\r\nsd_max_off_ns -= ktime_to_ns(ktime_sub(time_now,\r\nsd->power_off_time));\r\nif (sd_max_off_ns <= off_on_time_ns)\r\nreturn false;\r\n}\r\nmin_dev_off_time_ns = -1;\r\nlist_for_each_entry(pdd, &genpd->dev_list, list_node) {\r\nstruct gpd_timing_data *td;\r\nstruct device *dev = pdd->dev;\r\ns64 dev_off_time_ns;\r\nif (!dev->driver || dev->power.max_time_suspended_ns < 0)\r\ncontinue;\r\ntd = &to_gpd_data(pdd)->td;\r\ndev_off_time_ns = dev->power.max_time_suspended_ns -\r\n(td->start_latency_ns + td->restore_state_latency_ns +\r\nktime_to_ns(ktime_sub(time_now,\r\ndev->power.suspend_time)));\r\nif (dev_off_time_ns <= off_on_time_ns)\r\nreturn false;\r\nif (min_dev_off_time_ns > dev_off_time_ns\r\n|| min_dev_off_time_ns < 0)\r\nmin_dev_off_time_ns = dev_off_time_ns;\r\n}\r\nif (min_dev_off_time_ns < 0) {\r\ngenpd->max_off_time_ns = -1;\r\nreturn true;\r\n}\r\nmin_dev_off_time_ns -= genpd->power_on_latency_ns;\r\nif (genpd->break_even_ns >\r\nmin_dev_off_time_ns - genpd->power_off_latency_ns)\r\nreturn false;\r\ngenpd->max_off_time_ns = min_dev_off_time_ns;\r\nreturn true;\r\n}\r\nstatic bool always_on_power_down_ok(struct dev_pm_domain *domain)\r\n{\r\nreturn false;\r\n}\r\nbool default_stop_ok(struct device *dev)\r\n{\r\nreturn false;\r\n}
