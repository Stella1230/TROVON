static int __devinit\r\nct_card_probe(struct pci_dev *pci, const struct pci_device_id *pci_id)\r\n{\r\nstatic int dev;\r\nstruct snd_card *card;\r\nstruct ct_atc *atc;\r\nint err;\r\nif (dev >= SNDRV_CARDS)\r\nreturn -ENODEV;\r\nif (!enable[dev]) {\r\ndev++;\r\nreturn -ENOENT;\r\n}\r\nerr = snd_card_create(index[dev], id[dev], THIS_MODULE, 0, &card);\r\nif (err)\r\nreturn err;\r\nif ((reference_rate != 48000) && (reference_rate != 44100)) {\r\nprintk(KERN_ERR "ctxfi: Invalid reference_rate value %u!!!\n",\r\nreference_rate);\r\nprintk(KERN_ERR "ctxfi: The valid values for reference_rate "\r\n"are 48000 and 44100, Value 48000 is assumed.\n");\r\nreference_rate = 48000;\r\n}\r\nif ((multiple != 1) && (multiple != 2) && (multiple != 4)) {\r\nprintk(KERN_ERR "ctxfi: Invalid multiple value %u!!!\n",\r\nmultiple);\r\nprintk(KERN_ERR "ctxfi: The valid values for multiple are "\r\n"1, 2 and 4, Value 2 is assumed.\n");\r\nmultiple = 2;\r\n}\r\nerr = ct_atc_create(card, pci, reference_rate, multiple,\r\npci_id->driver_data, subsystem[dev], &atc);\r\nif (err < 0)\r\ngoto error;\r\ncard->private_data = atc;\r\nerr = ct_atc_create_alsa_devs(atc);\r\nif (err < 0)\r\ngoto error;\r\nstrcpy(card->driver, "SB-XFi");\r\nstrcpy(card->shortname, "Creative X-Fi");\r\nsnprintf(card->longname, sizeof(card->longname), "%s %s %s",\r\ncard->shortname, atc->chip_name, atc->model_name);\r\nerr = snd_card_register(card);\r\nif (err < 0)\r\ngoto error;\r\npci_set_drvdata(pci, card);\r\ndev++;\r\nreturn 0;\r\nerror:\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\nstatic void __devexit ct_card_remove(struct pci_dev *pci)\r\n{\r\nsnd_card_free(pci_get_drvdata(pci));\r\npci_set_drvdata(pci, NULL);\r\n}\r\nstatic int ct_card_suspend(struct pci_dev *pci, pm_message_t state)\r\n{\r\nstruct snd_card *card = pci_get_drvdata(pci);\r\nstruct ct_atc *atc = card->private_data;\r\nreturn atc->suspend(atc, state);\r\n}\r\nstatic int ct_card_resume(struct pci_dev *pci)\r\n{\r\nstruct snd_card *card = pci_get_drvdata(pci);\r\nstruct ct_atc *atc = card->private_data;\r\nreturn atc->resume(atc);\r\n}\r\nstatic int __init ct_card_init(void)\r\n{\r\nreturn pci_register_driver(&ct_driver);\r\n}\r\nstatic void __exit ct_card_exit(void)\r\n{\r\npci_unregister_driver(&ct_driver);\r\n}
