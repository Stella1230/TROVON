acpi_status\r\nacpi_ut_evaluate_object(struct acpi_namespace_node *prefix_node,\r\nchar *path,\r\nu32 expected_return_btypes,\r\nunion acpi_operand_object **return_desc)\r\n{\r\nstruct acpi_evaluate_info *info;\r\nacpi_status status;\r\nu32 return_btype;\r\nACPI_FUNCTION_TRACE(ut_evaluate_object);\r\ninfo = ACPI_ALLOCATE_ZEROED(sizeof(struct acpi_evaluate_info));\r\nif (!info) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\ninfo->prefix_node = prefix_node;\r\ninfo->pathname = path;\r\nstatus = acpi_ns_evaluate(info);\r\nif (ACPI_FAILURE(status)) {\r\nif (status == AE_NOT_FOUND) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"[%4.4s.%s] was not found\n",\r\nacpi_ut_get_node_name(prefix_node),\r\npath));\r\n} else {\r\nACPI_ERROR_METHOD("Method execution failed",\r\nprefix_node, path, status);\r\n}\r\ngoto cleanup;\r\n}\r\nif (!info->return_object) {\r\nif (expected_return_btypes) {\r\nACPI_ERROR_METHOD("No object was returned from",\r\nprefix_node, path, AE_NOT_EXIST);\r\nstatus = AE_NOT_EXIST;\r\n}\r\ngoto cleanup;\r\n}\r\nswitch ((info->return_object)->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nreturn_btype = ACPI_BTYPE_INTEGER;\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nreturn_btype = ACPI_BTYPE_BUFFER;\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nreturn_btype = ACPI_BTYPE_STRING;\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nreturn_btype = ACPI_BTYPE_PACKAGE;\r\nbreak;\r\ndefault:\r\nreturn_btype = 0;\r\nbreak;\r\n}\r\nif ((acpi_gbl_enable_interpreter_slack) && (!expected_return_btypes)) {\r\nacpi_ut_remove_reference(info->return_object);\r\ngoto cleanup;\r\n}\r\nif (!(expected_return_btypes & return_btype)) {\r\nACPI_ERROR_METHOD("Return object type is incorrect",\r\nprefix_node, path, AE_TYPE);\r\nACPI_ERROR((AE_INFO,\r\n"Type returned from %s was incorrect: %s, expected Btypes: 0x%X",\r\npath,\r\nacpi_ut_get_object_type_name(info->return_object),\r\nexpected_return_btypes));\r\nacpi_ut_remove_reference(info->return_object);\r\nstatus = AE_TYPE;\r\ngoto cleanup;\r\n}\r\n*return_desc = info->return_object;\r\ncleanup:\r\nACPI_FREE(info);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ut_evaluate_numeric_object(char *object_name,\r\nstruct acpi_namespace_node *device_node,\r\nu64 *value)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_evaluate_numeric_object);\r\nstatus = acpi_ut_evaluate_object(device_node, object_name,\r\nACPI_BTYPE_INTEGER, &obj_desc);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\n*value = obj_desc->integer.value;\r\nacpi_ut_remove_reference(obj_desc);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ut_execute_STA(struct acpi_namespace_node *device_node, u32 * flags)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_execute_STA);\r\nstatus = acpi_ut_evaluate_object(device_node, METHOD_NAME__STA,\r\nACPI_BTYPE_INTEGER, &obj_desc);\r\nif (ACPI_FAILURE(status)) {\r\nif (AE_NOT_FOUND == status) {\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"_STA on %4.4s was not found, assuming device is present\n",\r\nacpi_ut_get_node_name(device_node)));\r\n*flags = ACPI_UINT32_MAX;\r\nstatus = AE_OK;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\n*flags = (u32) obj_desc->integer.value;\r\nacpi_ut_remove_reference(obj_desc);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ut_execute_power_methods(struct acpi_namespace_node *device_node,\r\nconst char **method_names,\r\nu8 method_count, u8 *out_values)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nacpi_status status;\r\nacpi_status final_status = AE_NOT_FOUND;\r\nu32 i;\r\nACPI_FUNCTION_TRACE(ut_execute_power_methods);\r\nfor (i = 0; i < method_count; i++) {\r\nstatus = acpi_ut_evaluate_object(device_node,\r\nACPI_CAST_PTR(char,\r\nmethod_names[i]),\r\nACPI_BTYPE_INTEGER, &obj_desc);\r\nif (ACPI_SUCCESS(status)) {\r\nout_values[i] = (u8)obj_desc->integer.value;\r\nacpi_ut_remove_reference(obj_desc);\r\nfinal_status = AE_OK;\r\ncontinue;\r\n}\r\nout_values[i] = ACPI_UINT8_MAX;\r\nif (status == AE_NOT_FOUND) {\r\ncontinue;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"Failed %s on Device %4.4s, %s\n",\r\nACPI_CAST_PTR(char, method_names[i]),\r\nacpi_ut_get_node_name(device_node),\r\nacpi_format_exception(status)));\r\n}\r\nreturn_ACPI_STATUS(final_status);\r\n}
