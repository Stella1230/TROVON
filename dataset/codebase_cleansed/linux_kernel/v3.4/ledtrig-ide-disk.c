void ledtrig_ide_activity(void)\r\n{\r\nide_activity++;\r\nif (!timer_pending(&ledtrig_ide_timer))\r\nmod_timer(&ledtrig_ide_timer, jiffies + msecs_to_jiffies(10));\r\n}\r\nstatic void ledtrig_ide_timerfunc(unsigned long data)\r\n{\r\nif (ide_lastactivity != ide_activity) {\r\nide_lastactivity = ide_activity;\r\nled_trigger_event(ledtrig_ide, INT_MAX);\r\nmod_timer(&ledtrig_ide_timer, jiffies + msecs_to_jiffies(10));\r\n} else {\r\nled_trigger_event(ledtrig_ide, LED_OFF);\r\n}\r\n}\r\nstatic int __init ledtrig_ide_init(void)\r\n{\r\nled_trigger_register_simple("ide-disk", &ledtrig_ide);\r\nreturn 0;\r\n}\r\nstatic void __exit ledtrig_ide_exit(void)\r\n{\r\nled_trigger_unregister_simple(ledtrig_ide);\r\n}
