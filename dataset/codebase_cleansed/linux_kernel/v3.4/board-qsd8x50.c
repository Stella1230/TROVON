static int __init msm_init_smc91x(void)\r\n{\r\nif (machine_is_qsd8x50_surf()) {\r\nsmc91x_resources[0].start = qsd8x50_surf_smc91x_base;\r\nsmc91x_resources[0].end = qsd8x50_surf_smc91x_base + 0xff;\r\nsmc91x_resources[1].start =\r\ngpio_to_irq(qsd8x50_surf_smc91x_gpio);\r\nsmc91x_resources[1].end =\r\ngpio_to_irq(qsd8x50_surf_smc91x_gpio);\r\nplatform_device_register(&smc91x_device);\r\n}\r\nreturn 0;\r\n}\r\nstatic uint32_t msm_sdcc_setup_power(struct device *dv, unsigned int vdd)\r\n{\r\nint rc = 0;\r\nstruct platform_device *pdev;\r\npdev = container_of(dv, struct platform_device, dev);\r\nif (vdd == 0) {\r\nif (!vreg_sts)\r\nreturn 0;\r\nclear_bit(pdev->id, &vreg_sts);\r\nif (!vreg_sts) {\r\nrc = vreg_disable(vreg_mmc);\r\nif (rc)\r\npr_err("vreg_mmc disable failed for slot "\r\n"%d: %d\n", pdev->id, rc);\r\n}\r\nreturn 0;\r\n}\r\nif (!vreg_sts) {\r\nrc = vreg_set_level(vreg_mmc, 2900);\r\nif (rc)\r\npr_err("vreg_mmc set level failed for slot %d: %d\n",\r\npdev->id, rc);\r\nrc = vreg_enable(vreg_mmc);\r\nif (rc)\r\npr_err("vreg_mmc enable failed for slot %d: %d\n",\r\npdev->id, rc);\r\n}\r\nset_bit(pdev->id, &vreg_sts);\r\nreturn 0;\r\n}\r\nstatic void __init qsd8x50_init_mmc(void)\r\n{\r\nvreg_mmc = vreg_get(NULL, "gp5");\r\nif (IS_ERR(vreg_mmc)) {\r\npr_err("vreg get for vreg_mmc failed (%ld)\n",\r\nPTR_ERR(vreg_mmc));\r\nreturn;\r\n}\r\nmsm_add_sdcc(1, &qsd8x50_sdc1_data, 0, 0);\r\n}\r\nstatic void __init qsd8x50_map_io(void)\r\n{\r\nmsm_map_qsd8x50_io();\r\nmsm_clock_init(msm_clocks_8x50, msm_num_clocks_8x50);\r\n}\r\nstatic void __init qsd8x50_init_irq(void)\r\n{\r\nmsm_init_irq();\r\nmsm_init_sirc();\r\n}\r\nstatic void __init qsd8x50_init(void)\r\n{\r\nmsm_device_otg.dev.platform_data = &msm_otg_pdata;\r\nmsm_device_hsusb.dev.parent = &msm_device_otg.dev;\r\nmsm_device_hsusb_host.dev.parent = &msm_device_otg.dev;\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\nqsd8x50_init_mmc();\r\n}
