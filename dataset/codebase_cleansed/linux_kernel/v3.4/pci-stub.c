static int pci_stub_probe(struct pci_dev *dev, const struct pci_device_id *id)\r\n{\r\ndev_printk(KERN_INFO, &dev->dev, "claimed by stub\n");\r\nreturn 0;\r\n}\r\nstatic int __init pci_stub_init(void)\r\n{\r\nchar *p, *id;\r\nint rc;\r\nrc = pci_register_driver(&stub_driver);\r\nif (rc)\r\nreturn rc;\r\nif (ids[0] == '\0')\r\nreturn 0;\r\np = ids;\r\nwhile ((id = strsep(&p, ","))) {\r\nunsigned int vendor, device, subvendor = PCI_ANY_ID,\r\nsubdevice = PCI_ANY_ID, class=0, class_mask=0;\r\nint fields;\r\nif (!strlen(id))\r\ncontinue;\r\nfields = sscanf(id, "%x:%x:%x:%x:%x:%x",\r\n&vendor, &device, &subvendor, &subdevice,\r\n&class, &class_mask);\r\nif (fields < 2) {\r\nprintk(KERN_WARNING\r\n"pci-stub: invalid id string \"%s\"\n", id);\r\ncontinue;\r\n}\r\nprintk(KERN_INFO\r\n"pci-stub: add %04X:%04X sub=%04X:%04X cls=%08X/%08X\n",\r\nvendor, device, subvendor, subdevice, class, class_mask);\r\nrc = pci_add_dynid(&stub_driver, vendor, device,\r\nsubvendor, subdevice, class, class_mask, 0);\r\nif (rc)\r\nprintk(KERN_WARNING\r\n"pci-stub: failed to add dynamic id (%d)\n", rc);\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit pci_stub_exit(void)\r\n{\r\npci_unregister_driver(&stub_driver);\r\n}
