void __init setup_trampolines(void)\r\n{\r\nphys_addr_t mem;\r\nsize_t size = PAGE_ALIGN(x86_trampoline_end - x86_trampoline_start);\r\nmem = memblock_find_in_range(0, 1<<20, size, PAGE_SIZE);\r\nif (!mem)\r\npanic("Cannot allocate trampoline\n");\r\nx86_trampoline_base = __va(mem);\r\nmemblock_reserve(mem, size);\r\nprintk(KERN_DEBUG "Base memory trampoline at [%p] %llx size %zu\n",\r\nx86_trampoline_base, (unsigned long long)mem, size);\r\nmemcpy(x86_trampoline_base, x86_trampoline_start, size);\r\n}\r\nstatic int __init configure_trampolines(void)\r\n{\r\nsize_t size = PAGE_ALIGN(x86_trampoline_end - x86_trampoline_start);\r\nset_memory_x((unsigned long)x86_trampoline_base, size >> PAGE_SHIFT);\r\nreturn 0;\r\n}
