void *memmove(void *v_dst, const void *v_src, __kernel_size_t c)\r\n{\r\nconst char *src = v_src;\r\nchar *dst = v_dst;\r\nif (!c)\r\nreturn v_dst;\r\nif (v_dst <= v_src)\r\nreturn memcpy(v_dst, v_src, c);\r\nsrc += c;\r\ndst += c;\r\nwhile (c--)\r\n*--dst = *--src;\r\nreturn v_dst;\r\n}\r\nvoid *memmove(void *v_dst, const void *v_src, __kernel_size_t c)\r\n{\r\nconst char *src = v_src;\r\nchar *dst = v_dst;\r\nconst uint32_t *i_src;\r\nuint32_t *i_dst;\r\nif (!c)\r\nreturn v_dst;\r\nif (v_dst <= v_src)\r\nreturn memcpy(v_dst, v_src, c);\r\ndst += c;\r\nsrc += c;\r\nif (c >= 4) {\r\nunsigned value, buf_hold;\r\nswitch ((unsigned long)dst & 3) {\r\ncase 3:\r\n*--dst = *--src;\r\n--c;\r\ncase 2:\r\n*--dst = *--src;\r\n--c;\r\ncase 1:\r\n*--dst = *--src;\r\n--c;\r\n}\r\ni_dst = (void *)dst;\r\nswitch ((unsigned long)src & 3) {\r\ncase 0x0:\r\ni_src = (const void *)src;\r\nfor (; c >= 4; c -= 4)\r\n*--i_dst = *--i_src;\r\nsrc = (const void *)i_src;\r\nbreak;\r\ncase 0x1:\r\ni_src = (const void *) (((unsigned)src + 4) & ~3);\r\n#ifndef __MICROBLAZEEL__\r\nbuf_hold = *--i_src >> 24;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold << 8 | value;\r\nbuf_hold = value >> 24;\r\n}\r\n#else\r\nbuf_hold = (*--i_src & 0xFF) << 24;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold | ((value & 0xFFFFFF00)>>8);\r\nbuf_hold = (value & 0xFF) << 24;\r\n}\r\n#endif\r\nsrc = (const void *)i_src;\r\nsrc += 1;\r\nbreak;\r\ncase 0x2:\r\ni_src = (const void *) (((unsigned)src + 4) & ~3);\r\n#ifndef __MICROBLAZEEL__\r\nbuf_hold = *--i_src >> 16;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold << 16 | value;\r\nbuf_hold = value >> 16;\r\n}\r\n#else\r\nbuf_hold = (*--i_src & 0xFFFF) << 16;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold | ((value & 0xFFFF0000)>>16);\r\nbuf_hold = (value & 0xFFFF) << 16;\r\n}\r\n#endif\r\nsrc = (const void *)i_src;\r\nsrc += 2;\r\nbreak;\r\ncase 0x3:\r\ni_src = (const void *) (((unsigned)src + 4) & ~3);\r\n#ifndef __MICROBLAZEEL__\r\nbuf_hold = *--i_src >> 8;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold << 24 | value;\r\nbuf_hold = value >> 8;\r\n}\r\n#else\r\nbuf_hold = (*--i_src & 0xFFFFFF) << 8;\r\nfor (; c >= 4; c -= 4) {\r\nvalue = *--i_src;\r\n*--i_dst = buf_hold | ((value & 0xFF000000)>> 24);\r\nbuf_hold = (value & 0xFFFFFF) << 8;\r\n}\r\n#endif\r\nsrc = (const void *)i_src;\r\nsrc += 3;\r\nbreak;\r\n}\r\ndst = (void *)i_dst;\r\n}\r\nswitch (c) {\r\ncase 4:\r\n*--dst = *--src;\r\ncase 3:\r\n*--dst = *--src;\r\ncase 2:\r\n*--dst = *--src;\r\ncase 1:\r\n*--dst = *--src;\r\n}\r\nreturn v_dst;\r\n}
