static int acs5k_pca9555_setup(struct i2c_client *client,\r\nunsigned gpio_base, unsigned ngpio,\r\nvoid *context)\r\n{\r\nstatic int acs5k_gpio_value[] = {\r\n-1, -1, -1, -1, -1, -1, -1, 0, 1, 1, -1, 0, 1, 0, -1, -1\r\n};\r\nint n;\r\nfor (n = 0; n < ARRAY_SIZE(acs5k_gpio_value); ++n) {\r\ngpio_request(gpio_base + n, "ACS-5000 GPIO Expander");\r\nif (acs5k_gpio_value[n] < 0)\r\ngpio_direction_input(gpio_base + n);\r\nelse\r\ngpio_direction_output(gpio_base + n,\r\nacs5k_gpio_value[n]);\r\ngpio_export(gpio_base + n, 0);\r\n}\r\nreturn 0;\r\n}\r\nstatic void __devinit acs5k_i2c_init(void)\r\n{\r\nplatform_device_register(&acs5k_i2c_device);\r\ni2c_register_board_info(0, acs5k_i2c_devs,\r\nARRAY_SIZE(acs5k_i2c_devs));\r\n}\r\nstatic void __init acs5k_register_nor(void)\r\n{\r\nint ret;\r\nif (acs5k_nor_partitions[0].mask_flags == 0)\r\nprintk(KERN_WARNING "Warning: Unprotecting bootloader and configuration partition\n");\r\nret = platform_device_register(&acs5k_device_nor);\r\nif (ret < 0)\r\nprintk(KERN_ERR "failed to register physmap-flash device\n");\r\n}\r\nstatic int __init acs5k_protection_setup(char *s)\r\n{\r\nif (strcmp(s, "no") == 0)\r\nacs5k_nor_partitions[0].mask_flags = 0;\r\nreturn 1;\r\n}\r\nstatic void __init acs5k_init_gpio(void)\r\n{\r\nint i;\r\nks8695_register_gpios();\r\nfor (i = 0; i < 4; ++i)\r\ngpio_request(i, "ACS5K IRQ");\r\ngpio_request(7, "ACS5K KS_FRDY");\r\nfor (i = 8; i < 16; ++i)\r\ngpio_request(i, "ACS5K Unused");\r\ngpio_request(3, "ACS5K CAN Control");\r\ngpio_request(6, "ACS5K Heartbeat");\r\ngpio_direction_output(3, 1);\r\ngpio_direction_output(6, 0);\r\ngpio_export(3, 0);\r\ngpio_export(6, 0);\r\n}\r\nstatic void __init acs5k_init(void)\r\n{\r\nacs5k_init_gpio();\r\nks8695_add_device_lan();\r\nks8695_add_device_wan();\r\nacs5k_register_nor();\r\nacs5k_i2c_init();\r\n}
