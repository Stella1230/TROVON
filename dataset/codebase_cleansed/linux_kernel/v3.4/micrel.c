static int kszphy_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint rc;\r\nrc = phy_read(phydev, MII_KSZPHY_INTCS);\r\nreturn (rc < 0) ? rc : 0;\r\n}\r\nstatic int kszphy_set_interrupt(struct phy_device *phydev)\r\n{\r\nint temp;\r\ntemp = (PHY_INTERRUPT_ENABLED == phydev->interrupts) ?\r\nKSZPHY_INTCS_ALL : 0;\r\nreturn phy_write(phydev, MII_KSZPHY_INTCS, temp);\r\n}\r\nstatic int kszphy_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KSZPHY_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int ksz9021_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KSZ9021_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int ks8737_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KS8737_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int kszphy_config_init(struct phy_device *phydev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int ks8051_config_init(struct phy_device *phydev)\r\n{\r\nint regval;\r\nif (phydev->dev_flags & MICREL_PHY_50MHZ_CLK) {\r\nregval = phy_read(phydev, MII_KSZPHY_CTRL);\r\nregval |= KSZ8051_RMII_50MHZ_CLK;\r\nphy_write(phydev, MII_KSZPHY_CTRL, regval);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init ksphy_init(void)\r\n{\r\nint ret;\r\nret = phy_driver_register(&ks8001_driver);\r\nif (ret)\r\ngoto err1;\r\nret = phy_driver_register(&ksz9021_driver);\r\nif (ret)\r\ngoto err2;\r\nret = phy_driver_register(&ks8737_driver);\r\nif (ret)\r\ngoto err3;\r\nret = phy_driver_register(&ks8041_driver);\r\nif (ret)\r\ngoto err4;\r\nret = phy_driver_register(&ks8051_driver);\r\nif (ret)\r\ngoto err5;\r\nreturn 0;\r\nerr5:\r\nphy_driver_unregister(&ks8041_driver);\r\nerr4:\r\nphy_driver_unregister(&ks8737_driver);\r\nerr3:\r\nphy_driver_unregister(&ksz9021_driver);\r\nerr2:\r\nphy_driver_unregister(&ks8001_driver);\r\nerr1:\r\nreturn ret;\r\n}\r\nstatic void __exit ksphy_exit(void)\r\n{\r\nphy_driver_unregister(&ks8001_driver);\r\nphy_driver_unregister(&ks8737_driver);\r\nphy_driver_unregister(&ksz9021_driver);\r\nphy_driver_unregister(&ks8041_driver);\r\nphy_driver_unregister(&ks8051_driver);\r\n}
