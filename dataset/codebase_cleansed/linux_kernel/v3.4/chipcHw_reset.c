void chipcHw_reset(uint32_t mask)\r\n{\r\nint i = 0;\r\nRUNFUNC runFunc = (RUNFUNC) (unsigned long)MM_ADDR_IO_ARAM;\r\nintcHw_irq_disable(INTCHW_INTC0, 0xffffffff);\r\nintcHw_irq_disable(INTCHW_INTC1, 0xffffffff);\r\nintcHw_irq_disable(INTCHW_SINTC, 0xffffffff);\r\n{\r\nREG_LOCAL_IRQ_SAVE;\r\nif (mask & chipcHw_REG_SOFT_RESET_CHIP_SOFT) {\r\nchipcHw_softReset(chipcHw_REG_SOFT_RESET_CHIP_SOFT);\r\n}\r\npChipcHw->UARTClock |= chipcHw_REG_PLL_CLOCK_BYPASS_SELECT;\r\npChipcHw->SPIClock |= chipcHw_REG_PLL_CLOCK_BYPASS_SELECT;\r\ndo {\r\n((uint32_t *) MM_IO_BASE_ARAM)[i] =\r\n((uint32_t *) &chipcHw_reset_run_from_aram)[i];\r\ni++;\r\n} while (((uint32_t *) MM_IO_BASE_ARAM)[i - 1] != 0xe1a0f00f);\r\nCSP_CACHE_FLUSH_ALL;\r\nrunFunc();\r\nREG_LOCAL_IRQ_RESTORE;\r\n}\r\n}\r\nvoid chipcHw_reset_run_from_aram(void)\r\n{\r\n__asm (" nop \n\t"\r\n" nop \n\t"\r\n#if defined(__KERNEL__) && !defined(STANDALONE)\r\n" MRC p15,#0x0,r0,c1,c0,#0 \n\t"\r\n" BIC r0,r0,#0xd \n\t"\r\n" MCR p15,#0x0,r0,c1,c0,#0 \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n#endif\r\n" nop \n\t"\r\n" nop \n\t"\r\n" MOV r2,#0x80000000 \n\t"\r\n" LDR r3,[r2,#8] \n\t"\r\n" ORR r3,r3,#0x20000 \n\t"\r\n" STR r3,[r2,#8] \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" nop \n\t"\r\n" MOV r3,#0x2 \n\t"\r\n" STR r3,[r2,#0x80] \n\t"\r\n" MOV pc,pc \n\t");
