static int err_inject_cpu_callback(struct notifier_block *nfb,\r\nunsigned long action, void *hcpu)\r\n{\r\nint err = 0;\r\nswitch (action) {\r\ncase CPU_UP_PREPARE:\r\ncase CPU_UP_PREPARE_FROZEN:\r\nerr = cpu_up_prepare_error;\r\nbreak;\r\ncase CPU_DOWN_PREPARE:\r\ncase CPU_DOWN_PREPARE_FROZEN:\r\nerr = cpu_down_prepare_error;\r\nbreak;\r\n}\r\nif (err)\r\nprintk(KERN_INFO "Injecting error (%d) at cpu notifier\n", err);\r\nreturn notifier_from_errno(err);\r\n}\r\nstatic int err_inject_init(void)\r\n{\r\nerr_inject_cpu_notifier.priority = priority;\r\nreturn register_hotcpu_notifier(&err_inject_cpu_notifier);\r\n}\r\nstatic void err_inject_exit(void)\r\n{\r\nunregister_hotcpu_notifier(&err_inject_cpu_notifier);\r\n}
