static void __init cnb20le_res(u8 bus, u8 slot, u8 func)\r\n{\r\nstruct pci_root_info *info;\r\nstruct resource res;\r\nu16 word1, word2;\r\nu8 fbus, lbus;\r\nint i;\r\ninfo = &pci_root_info[pci_root_num];\r\npci_root_num++;\r\nfbus = read_pci_config_byte(bus, slot, func, 0x44);\r\nlbus = read_pci_config_byte(bus, slot, func, 0x45);\r\ninfo->bus_min = fbus;\r\ninfo->bus_max = lbus;\r\nif (fbus == 0) {\r\nupdate_res(info, 0x01f0, 0x01f7, IORESOURCE_IO, 0);\r\nupdate_res(info, 0x03f6, 0x03f6, IORESOURCE_IO, 0);\r\nupdate_res(info, 0x0170, 0x0177, IORESOURCE_IO, 0);\r\nupdate_res(info, 0x0376, 0x0376, IORESOURCE_IO, 0);\r\nupdate_res(info, 0xffa0, 0xffaf, IORESOURCE_IO, 0);\r\n}\r\nword1 = read_pci_config_16(bus, slot, func, 0xc0);\r\nword2 = read_pci_config_16(bus, slot, func, 0xc2);\r\nif (word1 != word2) {\r\nres.start = (word1 << 16) | 0x0000;\r\nres.end = (word2 << 16) | 0xffff;\r\nres.flags = IORESOURCE_MEM;\r\nupdate_res(info, res.start, res.end, res.flags, 0);\r\n}\r\nword1 = read_pci_config_16(bus, slot, func, 0xc4);\r\nword2 = read_pci_config_16(bus, slot, func, 0xc6);\r\nif (word1 != word2) {\r\nres.start = (word1 << 16) | 0x0000;\r\nres.end = (word2 << 16) | 0xffff;\r\nres.flags = IORESOURCE_MEM | IORESOURCE_PREFETCH;\r\nupdate_res(info, res.start, res.end, res.flags, 0);\r\n}\r\nword1 = read_pci_config_16(bus, slot, func, 0xd0);\r\nword2 = read_pci_config_16(bus, slot, func, 0xd2);\r\nif (word1 != word2) {\r\nres.start = word1;\r\nres.end = word2;\r\nres.flags = IORESOURCE_IO;\r\nupdate_res(info, res.start, res.end, res.flags, 0);\r\n}\r\nres.start = fbus;\r\nres.end = lbus;\r\nres.flags = IORESOURCE_BUS;\r\nprintk(KERN_INFO "CNB20LE PCI Host Bridge (domain 0000 %pR)\n", &res);\r\nfor (i = 0; i < info->res_num; i++)\r\nprintk(KERN_INFO "host bridge window %pR\n", &info->res[i]);\r\n}\r\nstatic int __init broadcom_postcore_init(void)\r\n{\r\nu8 bus = 0, slot = 0;\r\nu32 id;\r\nu16 vendor, device;\r\n#ifdef CONFIG_ACPI\r\nif (acpi_os_get_root_pointer())\r\nreturn 0;\r\n#endif\r\nid = read_pci_config(bus, slot, 0, PCI_VENDOR_ID);\r\nvendor = id & 0xffff;\r\ndevice = (id >> 16) & 0xffff;\r\nif (vendor == PCI_VENDOR_ID_SERVERWORKS &&\r\ndevice == PCI_DEVICE_ID_SERVERWORKS_LE) {\r\ncnb20le_res(bus, slot, 0);\r\ncnb20le_res(bus, slot, 1);\r\n}\r\nreturn 0;\r\n}
