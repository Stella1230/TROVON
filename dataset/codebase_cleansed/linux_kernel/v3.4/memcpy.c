void *memcpy(void *to, const void *from, size_t n)\r\n{\r\nvoid *xto = to;\r\nsize_t temp, temp1;\r\nif (!n)\r\nreturn xto;\r\nif ((long)to & 1) {\r\nchar *cto = to;\r\nconst char *cfrom = from;\r\n*cto++ = *cfrom++;\r\nto = cto;\r\nfrom = cfrom;\r\nn--;\r\n}\r\n#if defined(CONFIG_M68000)\r\nif ((long)from & 1) {\r\nchar *cto = to;\r\nconst char *cfrom = from;\r\nfor (; n; n--)\r\n*cto++ = *cfrom++;\r\nreturn xto;\r\n}\r\n#endif\r\nif (n > 2 && (long)to & 2) {\r\nshort *sto = to;\r\nconst short *sfrom = from;\r\n*sto++ = *sfrom++;\r\nto = sto;\r\nfrom = sfrom;\r\nn -= 2;\r\n}\r\ntemp = n >> 2;\r\nif (temp) {\r\nlong *lto = to;\r\nconst long *lfrom = from;\r\n#if defined(CONFIG_M68000) || defined(CONFIG_COLDFIRE)\r\nfor (; temp; temp--)\r\n*lto++ = *lfrom++;\r\n#else\r\nasm volatile (\r\n" movel %2,%3\n"\r\n" andw #7,%3\n"\r\n" lsrl #3,%2\n"\r\n" negw %3\n"\r\n" jmp %%pc@(1f,%3:w:2)\n"\r\n"4: movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n" movel %0@+,%1@+\n"\r\n"1: dbra %2,4b\n"\r\n" clrw %2\n"\r\n" subql #1,%2\n"\r\n" jpl 4b"\r\n: "=a" (lfrom), "=a" (lto), "=d" (temp), "=&d" (temp1)\r\n: "0" (lfrom), "1" (lto), "2" (temp));\r\n#endif\r\nto = lto;\r\nfrom = lfrom;\r\n}\r\nif (n & 2) {\r\nshort *sto = to;\r\nconst short *sfrom = from;\r\n*sto++ = *sfrom++;\r\nto = sto;\r\nfrom = sfrom;\r\n}\r\nif (n & 1) {\r\nchar *cto = to;\r\nconst char *cfrom = from;\r\n*cto = *cfrom;\r\n}\r\nreturn xto;\r\n}
