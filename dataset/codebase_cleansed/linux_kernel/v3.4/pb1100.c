const char *get_system_type(void)\r\n{\r\nreturn "PB1100";\r\n}\r\nvoid __init board_setup(void)\r\n{\r\nvolatile void __iomem *base = (volatile void __iomem *)0xac000000UL;\r\nbcsr_init(DB1000_BCSR_PHYS_ADDR,\r\nDB1000_BCSR_PHYS_ADDR + DB1000_BCSR_HEXLED_OFS);\r\nau_writel(8, SYS_AUXPLL);\r\nalchemy_gpio1_input_enable();\r\nudelay(100);\r\n#if defined(CONFIG_USB_OHCI_HCD) || defined(CONFIG_USB_OHCI_HCD_MODULE)\r\n{\r\nu32 pin_func, sys_freqctrl, sys_clksrc;\r\npin_func = au_readl(SYS_PINFUNC) & ~SYS_PF_UR3;\r\nsys_freqctrl = au_readl(SYS_FREQCTRL0);\r\nsys_freqctrl &= ~0xFFF00000;\r\nau_writel(sys_freqctrl, SYS_FREQCTRL0);\r\nsys_clksrc = au_readl(SYS_CLKSRC);\r\nsys_clksrc &= ~(SYS_CS_CIR | SYS_CS_DIR | SYS_CS_MIR_MASK);\r\nau_writel(sys_clksrc, SYS_CLKSRC);\r\nsys_freqctrl = au_readl(SYS_FREQCTRL0);\r\nsys_freqctrl &= ~0xFFF00000;\r\nsys_clksrc = au_readl(SYS_CLKSRC);\r\nsys_clksrc &= ~(SYS_CS_CIR | SYS_CS_DIR | SYS_CS_MIR_MASK);\r\nsys_freqctrl |= (0 << SYS_FC_FRDIV2_BIT) |\r\nSYS_FC_FE2 | SYS_FC_FS2;\r\nau_writel(sys_freqctrl, SYS_FREQCTRL0);\r\nsys_clksrc |= SYS_CS_MUX_FQ2 << SYS_CS_MIR_BIT;\r\nau_writel(sys_clksrc, SYS_CLKSRC);\r\nau_writel(0x00000002, MEM_STCFG3);\r\nau_writel(0x280E3D07, MEM_STTIME3);\r\nau_writel(0x10000000, MEM_STADDR3);\r\npin_func = au_readl(SYS_PINFUNC) & ~SYS_PF_USB;\r\npin_func |= SYS_PF_USB;\r\nau_writel(pin_func, SYS_PINFUNC);\r\n}\r\n#endif\r\nau_writel(au_readl(SYS_POWERCTRL) | (0x3 << 5), SYS_POWERCTRL);\r\nif (!(readb(base + 0x28) & 0x20)) {\r\nwriteb(readb(base + 0x28) | 0x20, base + 0x28);\r\nau_sync();\r\n}\r\nif (readb(base + 0x2C) & 0x4) {\r\nwriteb(readb(base + 0x2c) & ~0x4, base + 0x2c);\r\nau_sync();\r\n}\r\n}\r\nstatic int __init pb1100_dev_init(void)\r\n{\r\nint swapped;\r\nirq_set_irq_type(AU1100_GPIO9_INT, IRQF_TRIGGER_LOW);\r\nirq_set_irq_type(AU1100_GPIO10_INT, IRQF_TRIGGER_LOW);\r\nirq_set_irq_type(AU1100_GPIO11_INT, IRQF_TRIGGER_LOW);\r\nirq_set_irq_type(AU1100_GPIO13_INT, IRQF_TRIGGER_LOW);\r\ndb1x_register_pcmcia_socket(\r\nAU1000_PCMCIA_ATTR_PHYS_ADDR,\r\nAU1000_PCMCIA_ATTR_PHYS_ADDR + 0x000400000 - 1,\r\nAU1000_PCMCIA_MEM_PHYS_ADDR,\r\nAU1000_PCMCIA_MEM_PHYS_ADDR + 0x000400000 - 1,\r\nAU1000_PCMCIA_IO_PHYS_ADDR,\r\nAU1000_PCMCIA_IO_PHYS_ADDR + 0x000010000 - 1,\r\nAU1100_GPIO11_INT, AU1100_GPIO9_INT,\r\n0, 0, 0);\r\nswapped = bcsr_read(BCSR_STATUS) & BCSR_STATUS_DB1000_SWAPBOOT;\r\ndb1x_register_norflash(64 * 1024 * 1024, 4, swapped);\r\nplatform_device_register(&au1100_lcd_device);\r\nreturn 0;\r\n}
