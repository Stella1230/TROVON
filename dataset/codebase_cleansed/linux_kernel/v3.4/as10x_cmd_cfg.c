int as10x_cmd_get_context(struct as10x_bus_adapter_t *adap, uint16_t tag,\r\nuint32_t *pvalue)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\nENTER();\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.context.req));\r\npcmd->body.context.req.proc_id = cpu_to_le16(CONTROL_PROC_CONTEXT);\r\npcmd->body.context.req.tag = cpu_to_le16(tag);\r\npcmd->body.context.req.type = cpu_to_le16(GET_CONTEXT_DATA);\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap,\r\n(uint8_t *) pcmd,\r\nsizeof(pcmd->body.context.req)\r\n+ HEADER_SIZE,\r\n(uint8_t *) prsp,\r\nsizeof(prsp->body.context.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_context_rsp_parse(prsp, CONTROL_PROC_CONTEXT_RSP);\r\nif (error == 0) {\r\n*pvalue = le32_to_cpu(prsp->body.context.rsp.reg_val.u.value32);\r\n}\r\nout:\r\nLEAVE();\r\nreturn error;\r\n}\r\nint as10x_cmd_set_context(struct as10x_bus_adapter_t *adap, uint16_t tag,\r\nuint32_t value)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\nENTER();\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.context.req));\r\npcmd->body.context.req.proc_id = cpu_to_le16(CONTROL_PROC_CONTEXT);\r\npcmd->body.context.req.reg_val.u.value32 = cpu_to_le32(value);\r\npcmd->body.context.req.tag = cpu_to_le16(tag);\r\npcmd->body.context.req.type = cpu_to_le16(SET_CONTEXT_DATA);\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap,\r\n(uint8_t *) pcmd,\r\nsizeof(pcmd->body.context.req)\r\n+ HEADER_SIZE,\r\n(uint8_t *) prsp,\r\nsizeof(prsp->body.context.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_context_rsp_parse(prsp, CONTROL_PROC_CONTEXT_RSP);\r\nout:\r\nLEAVE();\r\nreturn error;\r\n}\r\nint as10x_cmd_eLNA_change_mode(struct as10x_bus_adapter_t *adap, uint8_t mode)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\nENTER();\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.cfg_change_mode.req));\r\npcmd->body.cfg_change_mode.req.proc_id =\r\ncpu_to_le16(CONTROL_PROC_ELNA_CHANGE_MODE);\r\npcmd->body.cfg_change_mode.req.mode = mode;\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\r\nsizeof(pcmd->body.cfg_change_mode.req)\r\n+ HEADER_SIZE, (uint8_t *) prsp,\r\nsizeof(prsp->body.cfg_change_mode.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_rsp_parse(prsp, CONTROL_PROC_ELNA_CHANGE_MODE_RSP);\r\nout:\r\nLEAVE();\r\nreturn error;\r\n}\r\nint as10x_context_rsp_parse(struct as10x_cmd_t *prsp, uint16_t proc_id)\r\n{\r\nint err;\r\nerr = prsp->body.context.rsp.error;\r\nif ((err == 0) &&\r\n(le16_to_cpu(prsp->body.context.rsp.proc_id) == proc_id)) {\r\nreturn 0;\r\n}\r\nreturn AS10X_CMD_ERROR;\r\n}
