static int sysfs__fprintf_build_id(FILE *fp)\r\n{\r\nu8 kallsyms_build_id[BUILD_ID_SIZE];\r\nchar sbuild_id[BUILD_ID_SIZE * 2 + 1];\r\nif (sysfs__read_build_id("/sys/kernel/notes", kallsyms_build_id,\r\nsizeof(kallsyms_build_id)) != 0)\r\nreturn -1;\r\nbuild_id__sprintf(kallsyms_build_id, sizeof(kallsyms_build_id),\r\nsbuild_id);\r\nfprintf(fp, "%s\n", sbuild_id);\r\nreturn 0;\r\n}\r\nstatic int filename__fprintf_build_id(const char *name, FILE *fp)\r\n{\r\nu8 build_id[BUILD_ID_SIZE];\r\nchar sbuild_id[BUILD_ID_SIZE * 2 + 1];\r\nif (filename__read_build_id(name, build_id,\r\nsizeof(build_id)) != sizeof(build_id))\r\nreturn 0;\r\nbuild_id__sprintf(build_id, sizeof(build_id), sbuild_id);\r\nreturn fprintf(fp, "%s\n", sbuild_id);\r\n}\r\nstatic int perf_session__list_build_ids(void)\r\n{\r\nstruct perf_session *session;\r\nelf_version(EV_CURRENT);\r\nsession = perf_session__new(input_name, O_RDONLY, force, false,\r\n&build_id__mark_dso_hit_ops);\r\nif (session == NULL)\r\nreturn -1;\r\nif (filename__fprintf_build_id(session->filename, stdout))\r\ngoto out;\r\nif (with_hits)\r\nperf_session__process_events(session, &build_id__mark_dso_hit_ops);\r\nperf_session__fprintf_dsos_buildid(session, stdout, with_hits);\r\nout:\r\nperf_session__delete(session);\r\nreturn 0;\r\n}\r\nstatic int __cmd_buildid_list(void)\r\n{\r\nif (show_kernel)\r\nreturn sysfs__fprintf_build_id(stdout);\r\nreturn perf_session__list_build_ids();\r\n}\r\nint cmd_buildid_list(int argc, const char **argv, const char *prefix __used)\r\n{\r\nargc = parse_options(argc, argv, options, buildid_list_usage, 0);\r\nsetup_pager();\r\nreturn __cmd_buildid_list();\r\n}
