static int titan_read_config(struct pci_bus *bus, unsigned int devfn, int reg,\r\nint size, u32 * val)\r\n{\r\nuint32_t address, tmp;\r\nint dev, busno, func;\r\nbusno = bus->number;\r\ndev = PCI_SLOT(devfn);\r\nfunc = PCI_FUNC(devfn);\r\naddress = (busno << 16) | (dev << 11) | (func << 8) |\r\n(reg & 0xfc) | 0x80000000;\r\nocd_writel(address, TITAN_PCI_0_CONFIG_ADDRESS);\r\ntmp = ocd_readl(TITAN_PCI_0_CONFIG_DATA) >> ((reg & 3) << 3);\r\nswitch (size) {\r\ncase 1:\r\ntmp &= 0xff;\r\ncase 2:\r\ntmp &= 0xffff;\r\n}\r\n*val = tmp;\r\nreturn PCIBIOS_SUCCESSFUL;\r\n}\r\nstatic int titan_write_config(struct pci_bus *bus, unsigned int devfn, int reg,\r\nint size, u32 val)\r\n{\r\nuint32_t address;\r\nint dev, busno, func;\r\nbusno = bus->number;\r\ndev = PCI_SLOT(devfn);\r\nfunc = PCI_FUNC(devfn);\r\naddress = (busno << 16) | (dev << 11) | (func << 8) |\r\n(reg & 0xfc) | 0x80000000;\r\nocd_writel(address, TITAN_PCI_0_CONFIG_ADDRESS);\r\nswitch (size) {\r\ncase 1:\r\nocd_writeb(val, TITAN_PCI_0_CONFIG_DATA + (~reg & 0x3));\r\nbreak;\r\ncase 2:\r\nocd_writew(val, TITAN_PCI_0_CONFIG_DATA + (~reg & 0x2));\r\nbreak;\r\ncase 4:\r\nocd_writel(val, TITAN_PCI_0_CONFIG_DATA);\r\nbreak;\r\n}\r\nreturn PCIBIOS_SUCCESSFUL;\r\n}
