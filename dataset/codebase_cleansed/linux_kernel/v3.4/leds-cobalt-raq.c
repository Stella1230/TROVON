static void raq_web_led_set(struct led_classdev *led_cdev,\r\nenum led_brightness brightness)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&led_value_lock, flags);\r\nif (brightness)\r\nled_value |= LED_WEB;\r\nelse\r\nled_value &= ~LED_WEB;\r\nwriteb(led_value, led_port);\r\nspin_unlock_irqrestore(&led_value_lock, flags);\r\n}\r\nstatic void raq_power_off_led_set(struct led_classdev *led_cdev,\r\nenum led_brightness brightness)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&led_value_lock, flags);\r\nif (brightness)\r\nled_value |= LED_POWER_OFF;\r\nelse\r\nled_value &= ~LED_POWER_OFF;\r\nwriteb(led_value, led_port);\r\nspin_unlock_irqrestore(&led_value_lock, flags);\r\n}\r\nstatic int __devinit cobalt_raq_led_probe(struct platform_device *pdev)\r\n{\r\nstruct resource *res;\r\nint retval;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nif (!res)\r\nreturn -EBUSY;\r\nled_port = ioremap(res->start, resource_size(res));\r\nif (!led_port)\r\nreturn -ENOMEM;\r\nretval = led_classdev_register(&pdev->dev, &raq_power_off_led);\r\nif (retval)\r\ngoto err_iounmap;\r\nretval = led_classdev_register(&pdev->dev, &raq_web_led);\r\nif (retval)\r\ngoto err_unregister;\r\nreturn 0;\r\nerr_unregister:\r\nled_classdev_unregister(&raq_power_off_led);\r\nerr_iounmap:\r\niounmap(led_port);\r\nled_port = NULL;\r\nreturn retval;\r\n}\r\nstatic int __devexit cobalt_raq_led_remove(struct platform_device *pdev)\r\n{\r\nled_classdev_unregister(&raq_power_off_led);\r\nled_classdev_unregister(&raq_web_led);\r\nif (led_port) {\r\niounmap(led_port);\r\nled_port = NULL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init cobalt_raq_led_init(void)\r\n{\r\nreturn platform_driver_register(&cobalt_raq_led_driver);\r\n}
