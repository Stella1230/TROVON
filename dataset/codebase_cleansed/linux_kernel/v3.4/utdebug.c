void acpi_ut_init_stack_ptr_trace(void)\r\n{\r\nacpi_size current_sp;\r\nacpi_gbl_entry_stack_pointer = &current_sp;\r\n}\r\nvoid acpi_ut_track_stack_ptr(void)\r\n{\r\nacpi_size current_sp;\r\nif (&current_sp < acpi_gbl_lowest_stack_pointer) {\r\nacpi_gbl_lowest_stack_pointer = &current_sp;\r\n}\r\nif (acpi_gbl_nesting_level > acpi_gbl_deepest_nesting) {\r\nacpi_gbl_deepest_nesting = acpi_gbl_nesting_level;\r\n}\r\n}\r\nstatic const char *acpi_ut_trim_function_name(const char *function_name)\r\n{\r\nif (*(ACPI_CAST_PTR(u32, function_name)) == ACPI_PREFIX_MIXED) {\r\nreturn (function_name + 4);\r\n}\r\nif (*(ACPI_CAST_PTR(u32, function_name)) == ACPI_PREFIX_LOWER) {\r\nreturn (function_name + 5);\r\n}\r\nreturn (function_name);\r\n}\r\nvoid ACPI_INTERNAL_VAR_XFACE\r\nacpi_debug_print(u32 requested_debug_level,\r\nu32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, const char *format, ...)\r\n{\r\nacpi_thread_id thread_id;\r\nva_list args;\r\nif (!(requested_debug_level & acpi_dbg_level) ||\r\n!(component_id & acpi_dbg_layer)) {\r\nreturn;\r\n}\r\nthread_id = acpi_os_get_thread_id();\r\nif (thread_id != acpi_gbl_prev_thread_id) {\r\nif (ACPI_LV_THREADS & acpi_dbg_level) {\r\nacpi_os_printf\r\n("\n**** Context Switch from TID %u to TID %u ****\n\n",\r\n(u32)acpi_gbl_prev_thread_id, (u32)thread_id);\r\n}\r\nacpi_gbl_prev_thread_id = thread_id;\r\n}\r\nacpi_os_printf("%8s-%04ld ", module_name, line_number);\r\nif (ACPI_LV_THREADS & acpi_dbg_level) {\r\nacpi_os_printf("[%u] ", (u32)thread_id);\r\n}\r\nacpi_os_printf("[%02ld] %-22.22s: ",\r\nacpi_gbl_nesting_level,\r\nacpi_ut_trim_function_name(function_name));\r\nva_start(args, format);\r\nacpi_os_vprintf(format, args);\r\nva_end(args);\r\n}\r\nvoid ACPI_INTERNAL_VAR_XFACE\r\nacpi_debug_print_raw(u32 requested_debug_level,\r\nu32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, const char *format, ...)\r\n{\r\nva_list args;\r\nif (!(requested_debug_level & acpi_dbg_level) ||\r\n!(component_id & acpi_dbg_layer)) {\r\nreturn;\r\n}\r\nva_start(args, format);\r\nacpi_os_vprintf(format, args);\r\nva_end(args);\r\n}\r\nvoid\r\nacpi_ut_trace(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s\n", acpi_gbl_fn_entry_str);\r\n}\r\nvoid\r\nacpi_ut_trace_ptr(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, void *pointer)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s %p\n", acpi_gbl_fn_entry_str, pointer);\r\n}\r\nvoid\r\nacpi_ut_trace_str(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, char *string)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s %s\n", acpi_gbl_fn_entry_str, string);\r\n}\r\nvoid\r\nacpi_ut_trace_u32(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u32 integer)\r\n{\r\nacpi_gbl_nesting_level++;\r\nacpi_ut_track_stack_ptr();\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s %08X\n", acpi_gbl_fn_entry_str, integer);\r\n}\r\nvoid\r\nacpi_ut_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id)\r\n{\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s\n", acpi_gbl_fn_exit_str);\r\nacpi_gbl_nesting_level--;\r\n}\r\nvoid\r\nacpi_ut_status_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name,\r\nu32 component_id, acpi_status status)\r\n{\r\nif (ACPI_SUCCESS(status)) {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s %s\n", acpi_gbl_fn_exit_str,\r\nacpi_format_exception(status));\r\n} else {\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name,\r\ncomponent_id, "%s ****Exception****: %s\n",\r\nacpi_gbl_fn_exit_str,\r\nacpi_format_exception(status));\r\n}\r\nacpi_gbl_nesting_level--;\r\n}\r\nvoid\r\nacpi_ut_value_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u64 value)\r\n{\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s %8.8X%8.8X\n", acpi_gbl_fn_exit_str,\r\nACPI_FORMAT_UINT64(value));\r\nacpi_gbl_nesting_level--;\r\n}\r\nvoid\r\nacpi_ut_ptr_exit(u32 line_number,\r\nconst char *function_name,\r\nconst char *module_name, u32 component_id, u8 *ptr)\r\n{\r\nacpi_debug_print(ACPI_LV_FUNCTIONS,\r\nline_number, function_name, module_name, component_id,\r\n"%s %p\n", acpi_gbl_fn_exit_str, ptr);\r\nacpi_gbl_nesting_level--;\r\n}\r\nvoid acpi_ut_dump_buffer2(u8 * buffer, u32 count, u32 display)\r\n{\r\nu32 i = 0;\r\nu32 j;\r\nu32 temp32;\r\nu8 buf_char;\r\nif (!buffer) {\r\nacpi_os_printf("Null Buffer Pointer in DumpBuffer!\n");\r\nreturn;\r\n}\r\nif ((count < 4) || (count & 0x01)) {\r\ndisplay = DB_BYTE_DISPLAY;\r\n}\r\nwhile (i < count) {\r\nacpi_os_printf("%6.4X: ", i);\r\nfor (j = 0; j < 16;) {\r\nif (i + j >= count) {\r\nacpi_os_printf("%*s", ((display * 2) + 1), " ");\r\nj += display;\r\ncontinue;\r\n}\r\nswitch (display) {\r\ncase DB_BYTE_DISPLAY:\r\ndefault:\r\nacpi_os_printf("%02X ",\r\nbuffer[(acpi_size) i + j]);\r\nbreak;\r\ncase DB_WORD_DISPLAY:\r\nACPI_MOVE_16_TO_32(&temp32,\r\n&buffer[(acpi_size) i + j]);\r\nacpi_os_printf("%04X ", temp32);\r\nbreak;\r\ncase DB_DWORD_DISPLAY:\r\nACPI_MOVE_32_TO_32(&temp32,\r\n&buffer[(acpi_size) i + j]);\r\nacpi_os_printf("%08X ", temp32);\r\nbreak;\r\ncase DB_QWORD_DISPLAY:\r\nACPI_MOVE_32_TO_32(&temp32,\r\n&buffer[(acpi_size) i + j]);\r\nacpi_os_printf("%08X", temp32);\r\nACPI_MOVE_32_TO_32(&temp32,\r\n&buffer[(acpi_size) i + j +\r\n4]);\r\nacpi_os_printf("%08X ", temp32);\r\nbreak;\r\n}\r\nj += display;\r\n}\r\nacpi_os_printf(" ");\r\nfor (j = 0; j < 16; j++) {\r\nif (i + j >= count) {\r\nacpi_os_printf("\n");\r\nreturn;\r\n}\r\nbuf_char = buffer[(acpi_size) i + j];\r\nif (ACPI_IS_PRINT(buf_char)) {\r\nacpi_os_printf("%c", buf_char);\r\n} else {\r\nacpi_os_printf(".");\r\n}\r\n}\r\nacpi_os_printf("\n");\r\ni += 16;\r\n}\r\nreturn;\r\n}\r\nvoid acpi_ut_dump_buffer(u8 * buffer, u32 count, u32 display, u32 component_id)\r\n{\r\nif (!((ACPI_LV_TABLES & acpi_dbg_level) &&\r\n(component_id & acpi_dbg_layer))) {\r\nreturn;\r\n}\r\nacpi_ut_dump_buffer2(buffer, count, display);\r\n}
