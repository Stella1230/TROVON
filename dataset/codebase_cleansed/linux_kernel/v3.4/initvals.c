static void\r\nath5k_hw_ini_registers(struct ath5k_hw *ah, unsigned int size,\r\nconst struct ath5k_ini *ini_regs, bool skip_pcu)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < size; i++) {\r\nif (skip_pcu &&\r\nini_regs[i].ini_register >= AR5K_PCU_MIN &&\r\nini_regs[i].ini_register <= AR5K_PCU_MAX)\r\ncontinue;\r\nswitch (ini_regs[i].ini_mode) {\r\ncase AR5K_INI_READ:\r\nath5k_hw_reg_read(ah, ini_regs[i].ini_register);\r\nbreak;\r\ncase AR5K_INI_WRITE:\r\ndefault:\r\nAR5K_REG_WAIT(i);\r\nath5k_hw_reg_write(ah, ini_regs[i].ini_value,\r\nini_regs[i].ini_register);\r\n}\r\n}\r\n}\r\nstatic void\r\nath5k_hw_ini_mode_registers(struct ath5k_hw *ah,\r\nunsigned int size, const struct ath5k_ini_mode *ini_mode,\r\nu8 mode)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < size; i++) {\r\nAR5K_REG_WAIT(i);\r\nath5k_hw_reg_write(ah, ini_mode[i].mode_value[mode],\r\n(u32)ini_mode[i].mode_register);\r\n}\r\n}\r\nint\r\nath5k_hw_write_initvals(struct ath5k_hw *ah, u8 mode, bool skip_pcu)\r\n{\r\nif (ah->ah_version == AR5K_AR5212) {\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(ar5212_ini_mode_start),\r\nar5212_ini_mode_start, mode);\r\nath5k_hw_ini_registers(ah, ARRAY_SIZE(ar5212_ini_common_start),\r\nar5212_ini_common_start, skip_pcu);\r\nswitch (ah->ah_radio) {\r\ncase AR5K_RF5111:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf5111_ini_mode_end),\r\nrf5111_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5111_ini_common_end),\r\nrf5111_ini_common_end, skip_pcu);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5111_ini_bbgain),\r\nrf5111_ini_bbgain, skip_pcu);\r\nbreak;\r\ncase AR5K_RF5112:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf5112_ini_mode_end),\r\nrf5112_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_common_end),\r\nrf5112_ini_common_end, skip_pcu);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_bbgain),\r\nrf5112_ini_bbgain, skip_pcu);\r\nbreak;\r\ncase AR5K_RF5413:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf5413_ini_mode_end),\r\nrf5413_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5413_ini_common_end),\r\nrf5413_ini_common_end, skip_pcu);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_bbgain),\r\nrf5112_ini_bbgain, skip_pcu);\r\nbreak;\r\ncase AR5K_RF2316:\r\ncase AR5K_RF2413:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf2413_ini_mode_end),\r\nrf2413_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf2413_ini_common_end),\r\nrf2413_ini_common_end, skip_pcu);\r\nif (ah->ah_radio == AR5K_RF2316) {\r\nath5k_hw_reg_write(ah, 0x00004000,\r\nAR5K_PHY_AGC);\r\nath5k_hw_reg_write(ah, 0x081b7caa,\r\n0xa274);\r\n}\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_bbgain),\r\nrf5112_ini_bbgain, skip_pcu);\r\nbreak;\r\ncase AR5K_RF2317:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf2413_ini_mode_end),\r\nrf2413_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf2425_ini_common_end),\r\nrf2425_ini_common_end, skip_pcu);\r\nath5k_hw_reg_write(ah, 0x00180a65, AR5K_PHY_GAIN);\r\nath5k_hw_reg_write(ah, 0x00004000, AR5K_PHY_AGC);\r\nAR5K_REG_WRITE_BITS(ah, AR5K_PHY_TPC_RG5,\r\nAR5K_PHY_TPC_RG5_PD_GAIN_OVERLAP, 0xa);\r\nath5k_hw_reg_write(ah, 0x800000a8, 0x8140);\r\nath5k_hw_reg_write(ah, 0x000000ff, 0x9958);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_bbgain),\r\nrf5112_ini_bbgain, skip_pcu);\r\nbreak;\r\ncase AR5K_RF2425:\r\nath5k_hw_ini_mode_registers(ah,\r\nARRAY_SIZE(rf2425_ini_mode_end),\r\nrf2425_ini_mode_end, mode);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf2425_ini_common_end),\r\nrf2425_ini_common_end, skip_pcu);\r\nath5k_hw_ini_registers(ah,\r\nARRAY_SIZE(rf5112_ini_bbgain),\r\nrf5112_ini_bbgain, skip_pcu);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n} else if (ah->ah_version == AR5K_AR5211) {\r\nif (mode > 2) {\r\nATH5K_ERR(ah,\r\n"unsupported channel mode: %d\n", mode);\r\nreturn -EINVAL;\r\n}\r\nath5k_hw_ini_mode_registers(ah, ARRAY_SIZE(ar5211_ini_mode),\r\nar5211_ini_mode, mode);\r\nath5k_hw_ini_registers(ah, ARRAY_SIZE(ar5211_ini),\r\nar5211_ini, skip_pcu);\r\nath5k_hw_ini_registers(ah, ARRAY_SIZE(rf5111_ini_bbgain),\r\nrf5111_ini_bbgain, skip_pcu);\r\n} else if (ah->ah_version == AR5K_AR5210) {\r\nath5k_hw_ini_registers(ah, ARRAY_SIZE(ar5210_ini),\r\nar5210_ini, skip_pcu);\r\n}\r\nreturn 0;\r\n}
