int __init pcibios_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nint virq;\r\nvirq = irq_tab[slot][pin];\r\nreturn pci_irq[virq];\r\n}\r\nint pcibios_plat_dev_init(struct pci_dev *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __init malta_piix_func0_fixup(struct pci_dev *pdev)\r\n{\r\nunsigned char reg_val;\r\nstatic int piixirqmap[16] __initdata = {\r\n0, 0, 0, 3,\r\n4, 5, 6, 7,\r\n0, 9, 10, 11,\r\n12, 0, 14, 15\r\n};\r\nint i;\r\nfor (i = 0; i <= 3; i++) {\r\npci_read_config_byte(pdev, 0x60+i, &reg_val);\r\nif (reg_val & 0x80)\r\npci_irq[PCIA+i] = 0;\r\nelse\r\npci_irq[PCIA+i] = piixirqmap[reg_val & 15];\r\n}\r\nif (PCI_SLOT(pdev->devfn) == 10) {\r\npci_read_config_byte(pdev, 0x69, &reg_val);\r\npci_write_config_byte(pdev, 0x69, reg_val | 0xf0);\r\n}\r\n}\r\nstatic void __init malta_piix_func1_fixup(struct pci_dev *pdev)\r\n{\r\nunsigned char reg_val;\r\nif (PCI_SLOT(pdev->devfn) == 10) {\r\npci_read_config_byte(pdev, 0x41, &reg_val);\r\npci_write_config_byte(pdev, 0x41, reg_val|0x80);\r\npci_read_config_byte(pdev, 0x43, &reg_val);\r\npci_write_config_byte(pdev, 0x43, reg_val|0x80);\r\n}\r\n}
