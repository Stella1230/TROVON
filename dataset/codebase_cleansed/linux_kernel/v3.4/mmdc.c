static int __devinit imx_mmdc_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nvoid __iomem *mmdc_base, *reg;\r\nu32 val;\r\nint timeout = 0x400;\r\nmmdc_base = of_iomap(np, 0);\r\nWARN_ON(!mmdc_base);\r\nreg = mmdc_base + MMDC_MAPSR;\r\nval = readl_relaxed(reg);\r\nval &= ~(1 << BP_MMDC_MAPSR_PSD);\r\nwritel_relaxed(val, reg);\r\nwhile (!(readl_relaxed(reg) & 1 << BP_MMDC_MAPSR_PSS) && --timeout)\r\ncpu_relax();\r\nif (unlikely(!timeout)) {\r\npr_warn("%s: failed to enable automatic power saving\n",\r\n__func__);\r\nreturn -EBUSY;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init imx_mmdc_init(void)\r\n{\r\nreturn platform_driver_register(&imx_mmdc_driver);\r\n}
