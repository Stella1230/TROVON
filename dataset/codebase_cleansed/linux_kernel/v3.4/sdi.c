static void sdi_basic_init(struct omap_dss_device *dssdev)\r\n{\r\ndispc_mgr_set_io_pad_mode(DSS_IO_PAD_MODE_BYPASS);\r\ndispc_mgr_enable_stallmode(dssdev->manager->id, false);\r\ndispc_mgr_set_lcd_display_type(dssdev->manager->id,\r\nOMAP_DSS_LCD_DISPLAY_TFT);\r\ndispc_mgr_set_tft_data_lines(dssdev->manager->id, 24);\r\ndispc_lcd_enable_signal_polarity(1);\r\n}\r\nint omapdss_sdi_display_enable(struct omap_dss_device *dssdev)\r\n{\r\nstruct omap_video_timings *t = &dssdev->panel.timings;\r\nstruct dss_clock_info dss_cinfo;\r\nstruct dispc_clock_info dispc_cinfo;\r\nu16 lck_div, pck_div;\r\nunsigned long fck;\r\nunsigned long pck;\r\nint r;\r\nif (dssdev->manager == NULL) {\r\nDSSERR("failed to enable display: no manager\n");\r\nreturn -ENODEV;\r\n}\r\nr = omap_dss_start_device(dssdev);\r\nif (r) {\r\nDSSERR("failed to start device\n");\r\ngoto err_start_dev;\r\n}\r\nr = regulator_enable(sdi.vdds_sdi_reg);\r\nif (r)\r\ngoto err_reg_enable;\r\nr = dss_runtime_get();\r\nif (r)\r\ngoto err_get_dss;\r\nr = dispc_runtime_get();\r\nif (r)\r\ngoto err_get_dispc;\r\nsdi_basic_init(dssdev);\r\ndssdev->panel.config |= OMAP_DSS_LCD_RF | OMAP_DSS_LCD_ONOFF;\r\ndispc_mgr_set_pol_freq(dssdev->manager->id, dssdev->panel.config,\r\ndssdev->panel.acbi, dssdev->panel.acb);\r\nr = dss_calc_clock_div(1, t->pixel_clock * 1000,\r\n&dss_cinfo, &dispc_cinfo);\r\nif (r)\r\ngoto err_calc_clock_div;\r\nfck = dss_cinfo.fck;\r\nlck_div = dispc_cinfo.lck_div;\r\npck_div = dispc_cinfo.pck_div;\r\npck = fck / lck_div / pck_div / 1000;\r\nif (pck != t->pixel_clock) {\r\nDSSWARN("Could not find exact pixel clock. Requested %d kHz, "\r\n"got %lu kHz\n",\r\nt->pixel_clock, pck);\r\nt->pixel_clock = pck;\r\n}\r\ndispc_mgr_set_lcd_timings(dssdev->manager->id, t);\r\nr = dss_set_clock_div(&dss_cinfo);\r\nif (r)\r\ngoto err_set_dss_clock_div;\r\nr = dispc_mgr_set_clock_div(dssdev->manager->id, &dispc_cinfo);\r\nif (r)\r\ngoto err_set_dispc_clock_div;\r\ndss_sdi_init(dssdev->phy.sdi.datapairs);\r\nr = dss_sdi_enable();\r\nif (r)\r\ngoto err_sdi_enable;\r\nmdelay(2);\r\nr = dss_mgr_enable(dssdev->manager);\r\nif (r)\r\ngoto err_mgr_enable;\r\nreturn 0;\r\nerr_mgr_enable:\r\ndss_sdi_disable();\r\nerr_sdi_enable:\r\nerr_set_dispc_clock_div:\r\nerr_set_dss_clock_div:\r\nerr_calc_clock_div:\r\ndispc_runtime_put();\r\nerr_get_dispc:\r\ndss_runtime_put();\r\nerr_get_dss:\r\nregulator_disable(sdi.vdds_sdi_reg);\r\nerr_reg_enable:\r\nomap_dss_stop_device(dssdev);\r\nerr_start_dev:\r\nreturn r;\r\n}\r\nvoid omapdss_sdi_display_disable(struct omap_dss_device *dssdev)\r\n{\r\ndss_mgr_disable(dssdev->manager);\r\ndss_sdi_disable();\r\ndispc_runtime_put();\r\ndss_runtime_put();\r\nregulator_disable(sdi.vdds_sdi_reg);\r\nomap_dss_stop_device(dssdev);\r\n}\r\nint sdi_init_display(struct omap_dss_device *dssdev)\r\n{\r\nDSSDBG("SDI init\n");\r\nif (sdi.vdds_sdi_reg == NULL) {\r\nstruct regulator *vdds_sdi;\r\nvdds_sdi = dss_get_vdds_sdi();\r\nif (IS_ERR(vdds_sdi)) {\r\nDSSERR("can't get VDDS_SDI regulator\n");\r\nreturn PTR_ERR(vdds_sdi);\r\n}\r\nsdi.vdds_sdi_reg = vdds_sdi;\r\n}\r\nreturn 0;\r\n}\r\nint sdi_init(void)\r\n{\r\nreturn 0;\r\n}\r\nvoid sdi_exit(void)\r\n{\r\n}
