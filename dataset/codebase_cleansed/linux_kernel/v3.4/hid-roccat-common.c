static inline uint16_t roccat_common_feature_report(uint8_t report_id)\r\n{\r\nreturn 0x300 | report_id;\r\n}\r\nint roccat_common_receive(struct usb_device *usb_dev, uint report_id,\r\nvoid *data, uint size)\r\n{\r\nchar *buf;\r\nint len;\r\nbuf = kmalloc(size, GFP_KERNEL);\r\nif (buf == NULL)\r\nreturn -ENOMEM;\r\nlen = usb_control_msg(usb_dev, usb_rcvctrlpipe(usb_dev, 0),\r\nHID_REQ_GET_REPORT,\r\nUSB_TYPE_CLASS | USB_RECIP_INTERFACE | USB_DIR_IN,\r\nroccat_common_feature_report(report_id),\r\n0, buf, size, USB_CTRL_SET_TIMEOUT);\r\nmemcpy(data, buf, size);\r\nkfree(buf);\r\nreturn ((len < 0) ? len : ((len != size) ? -EIO : 0));\r\n}\r\nint roccat_common_send(struct usb_device *usb_dev, uint report_id,\r\nvoid const *data, uint size)\r\n{\r\nchar *buf;\r\nint len;\r\nbuf = kmemdup(data, size, GFP_KERNEL);\r\nif (buf == NULL)\r\nreturn -ENOMEM;\r\nlen = usb_control_msg(usb_dev, usb_sndctrlpipe(usb_dev, 0),\r\nHID_REQ_SET_REPORT,\r\nUSB_TYPE_CLASS | USB_RECIP_INTERFACE | USB_DIR_OUT,\r\nroccat_common_feature_report(report_id),\r\n0, buf, size, USB_CTRL_SET_TIMEOUT);\r\nkfree(buf);\r\nreturn ((len < 0) ? len : ((len != size) ? -EIO : 0));\r\n}
