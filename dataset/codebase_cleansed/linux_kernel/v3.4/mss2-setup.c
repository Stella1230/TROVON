static int __init mss2_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nint irq;\r\nirq = orion5x_pci_map_irq(dev, slot, pin);\r\nif (irq != -1)\r\nreturn irq;\r\nreturn -1;\r\n}\r\nstatic int __init mss2_pci_init(void)\r\n{\r\nif (machine_is_mss2())\r\npci_common_init(&mss2_pci);\r\nreturn 0;\r\n}\r\nstatic void mss2_power_off(void)\r\n{\r\nu32 reg;\r\nreg = readl(RSTOUTn_MASK);\r\nreg |= 1 << 2;\r\nwritel(reg, RSTOUTn_MASK);\r\nreg = readl(CPU_SOFT_RESET);\r\nreg |= 1;\r\nwritel(reg, CPU_SOFT_RESET);\r\n}\r\nstatic void __init mss2_init(void)\r\n{\r\norion5x_init();\r\norion5x_mpp_conf(mss2_mpp_modes);\r\norion5x_ehci0_init();\r\norion5x_ehci1_init();\r\norion5x_eth_init(&mss2_eth_data);\r\norion5x_i2c_init();\r\norion5x_sata_init(&mss2_sata_data);\r\norion5x_uart0_init();\r\norion5x_xor_init();\r\norion5x_setup_dev_boot_win(MSS2_NOR_BOOT_BASE, MSS2_NOR_BOOT_SIZE);\r\nplatform_device_register(&mss2_nor_flash);\r\nplatform_device_register(&mss2_button_device);\r\nif (gpio_request(MSS2_GPIO_RTC_IRQ, "rtc") == 0) {\r\nif (gpio_direction_input(MSS2_GPIO_RTC_IRQ) == 0)\r\nmss2_i2c_rtc.irq = gpio_to_irq(MSS2_GPIO_RTC_IRQ);\r\nelse\r\ngpio_free(MSS2_GPIO_RTC_IRQ);\r\n}\r\ni2c_register_board_info(0, &mss2_i2c_rtc, 1);\r\npm_power_off = mss2_power_off;\r\n}
