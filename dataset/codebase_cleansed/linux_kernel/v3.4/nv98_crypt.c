static int\r\nnv98_crypt_fini(struct drm_device *dev, int engine, bool suspend)\r\n{\r\nif (!(nv_rd32(dev, 0x000200) & 0x00004000))\r\nreturn 0;\r\nnv_mask(dev, 0x000200, 0x00004000, 0x00000000);\r\nreturn 0;\r\n}\r\nstatic int\r\nnv98_crypt_init(struct drm_device *dev, int engine)\r\n{\r\nnv_mask(dev, 0x000200, 0x00004000, 0x00000000);\r\nnv_mask(dev, 0x000200, 0x00004000, 0x00004000);\r\nreturn 0;\r\n}\r\nstatic void\r\nnv98_crypt_destroy(struct drm_device *dev, int engine)\r\n{\r\nstruct nv98_crypt_engine *pcrypt = nv_engine(dev, engine);\r\nNVOBJ_ENGINE_DEL(dev, CRYPT);\r\nkfree(pcrypt);\r\n}\r\nint\r\nnv98_crypt_create(struct drm_device *dev)\r\n{\r\nstruct nv98_crypt_engine *pcrypt;\r\npcrypt = kzalloc(sizeof(*pcrypt), GFP_KERNEL);\r\nif (!pcrypt)\r\nreturn -ENOMEM;\r\npcrypt->base.destroy = nv98_crypt_destroy;\r\npcrypt->base.init = nv98_crypt_init;\r\npcrypt->base.fini = nv98_crypt_fini;\r\nNVOBJ_ENGINE_ADD(dev, CRYPT, &pcrypt->base);\r\nreturn 0;\r\n}
