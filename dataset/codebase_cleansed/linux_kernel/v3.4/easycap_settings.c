int easycap_video_fillin_formats(void)\r\n{\r\nconst char *name1, *name2, *name3, *name4;\r\nstruct v4l2_format *fmt;\r\nint i, j, k, m, n;\r\nu32 width, height, pixelformat, bytesperline, sizeimage;\r\nu16 mask1, mask2, mask3, mask4;\r\nenum v4l2_field field;\r\nenum v4l2_colorspace colorspace;\r\nfor (i = 0, n = 0; i < STANDARD_MANY; i++) {\r\nmask1 = 0x0000;\r\nswitch (i) {\r\ncase PAL_BGHIN: {\r\nmask1 = 0x1F & PAL_BGHIN;\r\nname1 = "PAL_BGHIN";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase SECAM: {\r\nmask1 = 0x1F & SECAM;\r\nname1 = "SECAM";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_Nc: {\r\nmask1 = 0x1F & PAL_Nc;\r\nname1 = "PAL_Nc";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_60: {\r\nmask1 = 0x1F & PAL_60;\r\nname1 = "PAL_60";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_M: {\r\nmask1 = 0x1F & PAL_M;\r\nname1 = "PAL_M";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase NTSC_M: {\r\nmask1 = 0x1F & NTSC_M;\r\nname1 = "NTSC_M";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_443: {\r\nmask1 = 0x1F & NTSC_443;\r\nname1 = "NTSC_443";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_M_JP: {\r\nmask1 = 0x1F & NTSC_M_JP;\r\nname1 = "NTSC_M_JP";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_N: {\r\nmask1 = 0x1F & NTSC_M;\r\nname1 = "NTSC_N";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_N_443: {\r\nmask1 = 0x1F & NTSC_N_443;\r\nname1 = "NTSC_N_443";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase PAL_BGHIN_SLOW: {\r\nmask1 = 0x001F & PAL_BGHIN_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "PAL_BGHIN_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase SECAM_SLOW: {\r\nmask1 = 0x001F & SECAM_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "SECAM_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_Nc_SLOW: {\r\nmask1 = 0x001F & PAL_Nc_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "PAL_Nc_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_60_SLOW: {\r\nmask1 = 0x001F & PAL_60_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "PAL_60_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase PAL_M_SLOW: {\r\nmask1 = 0x001F & PAL_M_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "PAL_M_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_BG;\r\nbreak;\r\n}\r\ncase NTSC_M_SLOW: {\r\nmask1 = 0x001F & NTSC_M_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "NTSC_M_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_443_SLOW: {\r\nmask1 = 0x001F & NTSC_443_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "NTSC_443_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_M_JP_SLOW: {\r\nmask1 = 0x001F & NTSC_M_JP_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "NTSC_M_JP_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_N_SLOW: {\r\nmask1 = 0x001F & NTSC_N_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "NTSC_N_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ncase NTSC_N_443_SLOW: {\r\nmask1 = 0x001F & NTSC_N_443_SLOW;\r\nmask1 |= 0x0200;\r\nname1 = "NTSC_N_443_SLOW";\r\ncolorspace = V4L2_COLORSPACE_470_SYSTEM_M;\r\nbreak;\r\n}\r\ndefault:\r\nreturn -1;\r\n}\r\nfor (j = 0; j < RESOLUTION_MANY; j++) {\r\nmask2 = 0x0000;\r\nswitch (j) {\r\ncase AT_720x576: {\r\nif (0x1 & mask1)\r\ncontinue;\r\nname2 = "_AT_720x576";\r\nwidth = 720;\r\nheight = 576;\r\nbreak;\r\n}\r\ncase AT_704x576: {\r\nif (0x1 & mask1)\r\ncontinue;\r\nname2 = "_AT_704x576";\r\nwidth = 704;\r\nheight = 576;\r\nbreak;\r\n}\r\ncase AT_640x480: {\r\nname2 = "_AT_640x480";\r\nwidth = 640;\r\nheight = 480;\r\nbreak;\r\n}\r\ncase AT_720x480: {\r\nif (!(0x1 & mask1))\r\ncontinue;\r\nname2 = "_AT_720x480";\r\nwidth = 720;\r\nheight = 480;\r\nbreak;\r\n}\r\ncase AT_360x288: {\r\nif (0x1 & mask1)\r\ncontinue;\r\nname2 = "_AT_360x288";\r\nwidth = 360;\r\nheight = 288;\r\nmask2 = 0x0800;\r\nbreak;\r\n}\r\ncase AT_320x240: {\r\nname2 = "_AT_320x240";\r\nwidth = 320;\r\nheight = 240;\r\nmask2 = 0x0800;\r\nbreak;\r\n}\r\ncase AT_360x240: {\r\nif (!(0x1 & mask1))\r\ncontinue;\r\nname2 = "_AT_360x240";\r\nwidth = 360;\r\nheight = 240;\r\nmask2 = 0x0800;\r\nbreak;\r\n}\r\ndefault:\r\nreturn -2;\r\n}\r\nfor (k = 0; k < PIXELFORMAT_MANY; k++) {\r\nmask3 = 0x0000;\r\nswitch (k) {\r\ncase FMT_UYVY: {\r\nname3 = __stringify(FMT_UYVY);\r\npixelformat = V4L2_PIX_FMT_UYVY;\r\nmask3 |= (0x02 << 5);\r\nbreak;\r\n}\r\ncase FMT_YUY2: {\r\nname3 = __stringify(FMT_YUY2);\r\npixelformat = V4L2_PIX_FMT_YUYV;\r\nmask3 |= (0x02 << 5);\r\nmask3 |= 0x0100;\r\nbreak;\r\n}\r\ncase FMT_RGB24: {\r\nname3 = __stringify(FMT_RGB24);\r\npixelformat = V4L2_PIX_FMT_RGB24;\r\nmask3 |= (0x03 << 5);\r\nbreak;\r\n}\r\ncase FMT_RGB32: {\r\nname3 = __stringify(FMT_RGB32);\r\npixelformat = V4L2_PIX_FMT_RGB32;\r\nmask3 |= (0x04 << 5);\r\nbreak;\r\n}\r\ncase FMT_BGR24: {\r\nname3 = __stringify(FMT_BGR24);\r\npixelformat = V4L2_PIX_FMT_BGR24;\r\nmask3 |= (0x03 << 5);\r\nmask3 |= 0x0100;\r\nbreak;\r\n}\r\ncase FMT_BGR32: {\r\nname3 = __stringify(FMT_BGR32);\r\npixelformat = V4L2_PIX_FMT_BGR32;\r\nmask3 |= (0x04 << 5);\r\nmask3 |= 0x0100;\r\nbreak;\r\n}\r\ndefault:\r\nreturn -3;\r\n}\r\nbytesperline = width * ((mask3 & 0x00E0) >> 5);\r\nsizeimage = bytesperline * height;\r\nfor (m = 0; m < INTERLACE_MANY; m++) {\r\nmask4 = 0x0000;\r\nswitch (m) {\r\ncase FIELD_NONE: {\r\nname4 = "-n";\r\nfield = V4L2_FIELD_NONE;\r\nbreak;\r\n}\r\ncase FIELD_INTERLACED: {\r\nname4 = "-i";\r\nmask4 |= 0x1000;\r\nfield = V4L2_FIELD_INTERLACED;\r\nbreak;\r\n}\r\ndefault:\r\nreturn -4;\r\n}\r\nif (SETTINGS_MANY <= n)\r\nreturn -5;\r\nstrcpy(easycap_format[n].name, name1);\r\nstrcat(easycap_format[n].name, name2);\r\nstrcat(easycap_format[n].name, "_");\r\nstrcat(easycap_format[n].name, name3);\r\nstrcat(easycap_format[n].name, name4);\r\neasycap_format[n].mask =\r\nmask1 | mask2 | mask3 | mask4;\r\nfmt = &easycap_format[n].v4l2_format;\r\nfmt->type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\r\nfmt->fmt.pix.width = width;\r\nfmt->fmt.pix.height = height;\r\nfmt->fmt.pix.pixelformat = pixelformat;\r\nfmt->fmt.pix.field = field;\r\nfmt->fmt.pix.bytesperline = bytesperline;\r\nfmt->fmt.pix.sizeimage = sizeimage;\r\nfmt->fmt.pix.colorspace = colorspace;\r\nfmt->fmt.pix.priv = 0;\r\nn++;\r\n}\r\n}\r\n}\r\n}\r\nif ((1 + SETTINGS_MANY) <= n)\r\nreturn -6;\r\neasycap_format[n].mask = 0xFFFF;\r\nreturn n;\r\n}
