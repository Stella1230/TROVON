void snd_dma_program(unsigned long dma,\r\nunsigned long addr, unsigned int size,\r\nunsigned short mode)\r\n{\r\nunsigned long flags;\r\nflags = claim_dma_lock();\r\ndisable_dma(dma);\r\nclear_dma_ff(dma);\r\nset_dma_mode(dma, mode);\r\nset_dma_addr(dma, addr);\r\nset_dma_count(dma, size);\r\nif (!(mode & DMA_MODE_NO_ENABLE))\r\nenable_dma(dma);\r\nrelease_dma_lock(flags);\r\n}\r\nvoid snd_dma_disable(unsigned long dma)\r\n{\r\nunsigned long flags;\r\nflags = claim_dma_lock();\r\nclear_dma_ff(dma);\r\ndisable_dma(dma);\r\nrelease_dma_lock(flags);\r\n}\r\nunsigned int snd_dma_pointer(unsigned long dma, unsigned int size)\r\n{\r\nunsigned long flags;\r\nunsigned int result, result1;\r\nflags = claim_dma_lock();\r\nclear_dma_ff(dma);\r\nif (!isa_dma_bridge_buggy)\r\ndisable_dma(dma);\r\nresult = get_dma_residue(dma);\r\nresult1 = get_dma_residue(dma);\r\nif (!isa_dma_bridge_buggy)\r\nenable_dma(dma);\r\nrelease_dma_lock(flags);\r\nif (unlikely(result < result1))\r\nresult = result1;\r\n#ifdef CONFIG_SND_DEBUG\r\nif (result > size)\r\nsnd_printk(KERN_ERR "pointer (0x%x) for DMA #%ld is greater than transfer size (0x%x)\n", result, dma, size);\r\n#endif\r\nif (result >= size || result == 0)\r\nreturn 0;\r\nelse\r\nreturn size - result;\r\n}
