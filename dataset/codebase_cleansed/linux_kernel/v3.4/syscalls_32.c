long sys_clone(unsigned long clone_flags, unsigned long newsp,\r\nint __user *parent_tid, void *newtls, int __user *child_tid)\r\n{\r\nlong ret;\r\nif (!newsp)\r\nnewsp = UPT_SP(&current->thread.regs.regs);\r\ncurrent->thread.forking = 1;\r\nret = do_fork(clone_flags, newsp, &current->thread.regs, 0, parent_tid,\r\nchild_tid);\r\ncurrent->thread.forking = 0;\r\nreturn ret;\r\n}\r\nlong sys_sigaction(int sig, const struct old_sigaction __user *act,\r\nstruct old_sigaction __user *oact)\r\n{\r\nstruct k_sigaction new_ka, old_ka;\r\nint ret;\r\nif (act) {\r\nold_sigset_t mask;\r\nif (!access_ok(VERIFY_READ, act, sizeof(*act)) ||\r\n__get_user(new_ka.sa.sa_handler, &act->sa_handler) ||\r\n__get_user(new_ka.sa.sa_restorer, &act->sa_restorer))\r\nreturn -EFAULT;\r\n__get_user(new_ka.sa.sa_flags, &act->sa_flags);\r\n__get_user(mask, &act->sa_mask);\r\nsiginitset(&new_ka.sa.sa_mask, mask);\r\n}\r\nret = do_sigaction(sig, act ? &new_ka : NULL, oact ? &old_ka : NULL);\r\nif (!ret && oact) {\r\nif (!access_ok(VERIFY_WRITE, oact, sizeof(*oact)) ||\r\n__put_user(old_ka.sa.sa_handler, &oact->sa_handler) ||\r\n__put_user(old_ka.sa.sa_restorer, &oact->sa_restorer))\r\nreturn -EFAULT;\r\n__put_user(old_ka.sa.sa_flags, &oact->sa_flags);\r\n__put_user(old_ka.sa.sa_mask.sig[0], &oact->sa_mask);\r\n}\r\nreturn ret;\r\n}
