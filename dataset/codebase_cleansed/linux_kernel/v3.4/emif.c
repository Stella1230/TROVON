static int __init c6x_emifa_init(void)\r\n{\r\nstruct emifa_regs __iomem *regs;\r\nstruct device_node *node;\r\nconst __be32 *p;\r\nu32 val;\r\nint i, len, err;\r\nnode = of_find_matching_node(NULL, emifa_match);\r\nif (!node)\r\nreturn 0;\r\nregs = of_iomap(node, 0);\r\nif (!regs)\r\nreturn 0;\r\nerr = of_property_read_u32_array(node, "ti,dscr-dev-enable", &val, 1);\r\nif (!err)\r\ndscr_set_devstate(val, DSCR_DEVSTATE_ENABLED);\r\np = of_get_property(node, "ti,emifa-ce-config", &len);\r\nif (p) {\r\nlen /= sizeof(u32);\r\nif (len > NUM_EMIFA_CHIP_ENABLES)\r\nlen = NUM_EMIFA_CHIP_ENABLES;\r\nfor (i = 0; i <= len; i++)\r\nsoc_writel(be32_to_cpup(&p[i]), &regs->cecfg[i]);\r\n}\r\nerr = of_property_read_u32_array(node, "ti,emifa-burst-priority", &val, 1);\r\nif (!err)\r\nsoc_writel(val, &regs->bprio);\r\nerr = of_property_read_u32_array(node, "ti,emifa-async-wait-control", &val, 1);\r\nif (!err)\r\nsoc_writel(val, &regs->awcc);\r\niounmap(regs);\r\nof_node_put(node);\r\nreturn 0;\r\n}
