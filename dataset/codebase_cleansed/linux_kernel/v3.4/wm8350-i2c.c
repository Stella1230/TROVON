static int wm8350_i2c_read_device(struct wm8350 *wm8350, char reg,\r\nint bytes, void *dest)\r\n{\r\nint ret;\r\nret = i2c_master_send(wm8350->i2c_client, &reg, 1);\r\nif (ret < 0)\r\nreturn ret;\r\nret = i2c_master_recv(wm8350->i2c_client, dest, bytes);\r\nif (ret < 0)\r\nreturn ret;\r\nif (ret != bytes)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int wm8350_i2c_write_device(struct wm8350 *wm8350, char reg,\r\nint bytes, void *src)\r\n{\r\nu8 msg[(WM8350_MAX_REGISTER << 1) + 1];\r\nint ret;\r\nif (bytes > ((WM8350_MAX_REGISTER << 1) + 1))\r\nreturn -EINVAL;\r\nmsg[0] = reg;\r\nmemcpy(&msg[1], src, bytes);\r\nret = i2c_master_send(wm8350->i2c_client, msg, bytes + 1);\r\nif (ret < 0)\r\nreturn ret;\r\nif (ret != bytes + 1)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int wm8350_i2c_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct wm8350 *wm8350;\r\nint ret = 0;\r\nwm8350 = devm_kzalloc(&i2c->dev, sizeof(struct wm8350), GFP_KERNEL);\r\nif (wm8350 == NULL)\r\nreturn -ENOMEM;\r\ni2c_set_clientdata(i2c, wm8350);\r\nwm8350->dev = &i2c->dev;\r\nwm8350->i2c_client = i2c;\r\nwm8350->read_dev = wm8350_i2c_read_device;\r\nwm8350->write_dev = wm8350_i2c_write_device;\r\nret = wm8350_device_init(wm8350, i2c->irq, i2c->dev.platform_data);\r\nif (ret < 0)\r\ngoto err;\r\nreturn ret;\r\nerr:\r\nreturn ret;\r\n}\r\nstatic int wm8350_i2c_remove(struct i2c_client *i2c)\r\n{\r\nstruct wm8350 *wm8350 = i2c_get_clientdata(i2c);\r\nwm8350_device_exit(wm8350);\r\nreturn 0;\r\n}\r\nstatic int __init wm8350_i2c_init(void)\r\n{\r\nreturn i2c_add_driver(&wm8350_i2c_driver);\r\n}\r\nstatic void __exit wm8350_i2c_exit(void)\r\n{\r\ni2c_del_driver(&wm8350_i2c_driver);\r\n}
