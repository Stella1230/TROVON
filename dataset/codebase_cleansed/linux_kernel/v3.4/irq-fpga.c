static void asb2364_fpga_mask(struct irq_data *d)\r\n{\r\nASB2364_FPGA_REG_MASK(d->irq - NR_CPU_IRQS) = 0x0001;\r\nSyncExBus();\r\n}\r\nstatic void asb2364_fpga_ack(struct irq_data *d)\r\n{\r\nASB2364_FPGA_REG_IRQ(d->irq - NR_CPU_IRQS) = 0x0001;\r\nSyncExBus();\r\n}\r\nstatic void asb2364_fpga_mask_ack(struct irq_data *d)\r\n{\r\nASB2364_FPGA_REG_MASK(d->irq - NR_CPU_IRQS) = 0x0001;\r\nSyncExBus();\r\nASB2364_FPGA_REG_IRQ(d->irq - NR_CPU_IRQS) = 0x0001;\r\nSyncExBus();\r\n}\r\nstatic void asb2364_fpga_unmask(struct irq_data *d)\r\n{\r\nASB2364_FPGA_REG_MASK(d->irq - NR_CPU_IRQS) = 0x0000;\r\nSyncExBus();\r\n}\r\nstatic irqreturn_t fpga_interrupt(int irq, void *_mask)\r\n{\r\nif ((ASB2364_FPGA_REG_IRQ_LAN & 0x0001) != 0x0001)\r\ngeneric_handle_irq(FPGA_LAN_IRQ);\r\nif ((ASB2364_FPGA_REG_IRQ_UART & 0x0001) != 0x0001)\r\ngeneric_handle_irq(FPGA_UART_IRQ);\r\nif ((ASB2364_FPGA_REG_IRQ_I2C & 0x0001) != 0x0001)\r\ngeneric_handle_irq(FPGA_I2C_IRQ);\r\nif ((ASB2364_FPGA_REG_IRQ_USB & 0x0001) != 0x0001)\r\ngeneric_handle_irq(FPGA_USB_IRQ);\r\nif ((ASB2364_FPGA_REG_IRQ_FPGA & 0x0001) != 0x0001)\r\ngeneric_handle_irq(FPGA_FPGA_IRQ);\r\nreturn IRQ_HANDLED;\r\n}\r\nvoid __init irq_fpga_init(void)\r\n{\r\nint irq;\r\nASB2364_FPGA_REG_MASK_LAN = 0x0001;\r\nSyncExBus();\r\nASB2364_FPGA_REG_MASK_UART = 0x0001;\r\nSyncExBus();\r\nASB2364_FPGA_REG_MASK_I2C = 0x0001;\r\nSyncExBus();\r\nASB2364_FPGA_REG_MASK_USB = 0x0001;\r\nSyncExBus();\r\nASB2364_FPGA_REG_MASK_FPGA = 0x0001;\r\nSyncExBus();\r\nfor (irq = NR_CPU_IRQS; irq < NR_IRQS; irq++)\r\nirq_set_chip_and_handler(irq, &asb2364_fpga_pic,\r\nhandle_level_irq);\r\nsetup_irq(XIRQ1, &fpga_irq[0]);\r\n}
