acpi_status acpi_ex_opcode_3A_0T_0R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nstruct acpi_signal_fatal_info *fatal;\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_3A_0T_0R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_FATAL_OP:\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"FatalOp: Type %X Code %X Arg %X <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n",\r\n(u32) operand[0]->integer.value,\r\n(u32) operand[1]->integer.value,\r\n(u32) operand[2]->integer.value));\r\nfatal = ACPI_ALLOCATE(sizeof(struct acpi_signal_fatal_info));\r\nif (fatal) {\r\nfatal->type = (u32) operand[0]->integer.value;\r\nfatal->code = (u32) operand[1]->integer.value;\r\nfatal->argument = (u32) operand[2]->integer.value;\r\n}\r\nstatus = acpi_os_signal(ACPI_SIGNAL_FATAL, fatal);\r\nACPI_FREE(fatal);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\ncleanup:\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_3A_1T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *return_desc = NULL;\r\nchar *buffer = NULL;\r\nacpi_status status = AE_OK;\r\nu64 index;\r\nacpi_size length;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_3A_1T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_MID_OP:\r\nreturn_desc = acpi_ut_create_internal_object((operand[0])->\r\ncommon.type);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nindex = operand[1]->integer.value;\r\nlength = (acpi_size) operand[2]->integer.value;\r\nif (index >= operand[0]->string.length) {\r\nlength = 0;\r\n}\r\nelse if ((index + length) > operand[0]->string.length) {\r\nlength = (acpi_size) operand[0]->string.length -\r\n(acpi_size) index;\r\n}\r\nswitch ((operand[0])->common.type) {\r\ncase ACPI_TYPE_STRING:\r\nbuffer = ACPI_ALLOCATE_ZEROED((acpi_size) length + 1);\r\nif (!buffer) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (length > 0) {\r\nbuffer = ACPI_ALLOCATE_ZEROED(length);\r\nif (!buffer) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\n}\r\nbreak;\r\ndefault:\r\nstatus = AE_AML_OPERAND_TYPE;\r\ngoto cleanup;\r\n}\r\nif (buffer) {\r\nACPI_MEMCPY(buffer, operand[0]->string.pointer + index,\r\nlength);\r\n}\r\nreturn_desc->string.pointer = buffer;\r\nreturn_desc->string.length = (u32) length;\r\nreturn_desc->buffer.flags |= AOPOBJ_DATA_VALID;\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ex_store(return_desc, operand[3], walk_state);\r\ncleanup:\r\nif (ACPI_FAILURE(status) || walk_state->result_obj) {\r\nacpi_ut_remove_reference(return_desc);\r\nwalk_state->result_obj = NULL;\r\n}\r\nelse {\r\nwalk_state->result_obj = return_desc;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}
