int gma_intel_opregion_init(struct drm_device *dev)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nu32 opregion_phy;\r\nvoid *base;\r\nu32 *lid_state;\r\ndev_priv->lid_state = NULL;\r\npci_read_config_dword(dev->pdev, 0xfc, &opregion_phy);\r\nif (opregion_phy == 0)\r\nreturn -ENOTSUPP;\r\nbase = ioremap(opregion_phy, 8*1024);\r\nif (!base)\r\nreturn -ENOMEM;\r\nlid_state = base + 0x01ac;\r\ndev_priv->lid_state = lid_state;\r\ndev_priv->lid_last_state = readl(lid_state);\r\nreturn 0;\r\n}\r\nint gma_intel_opregion_exit(struct drm_device *dev)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nif (dev_priv->lid_state)\r\niounmap(dev_priv->lid_state);\r\nreturn 0;\r\n}
