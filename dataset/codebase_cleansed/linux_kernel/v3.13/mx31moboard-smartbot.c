static int smartbot_cam_power(struct device *dev, int on)\r\n{\r\ngpio_set_value(CAM_POWER, !on);\r\nreturn 0;\r\n}\r\nstatic int smartbot_cam_reset(struct device *dev)\r\n{\r\ngpio_set_value(CAM_RST_B, 0);\r\nudelay(100);\r\ngpio_set_value(CAM_RST_B, 1);\r\nreturn 0;\r\n}\r\nstatic int __init smartbot_cam_init(void)\r\n{\r\nint ret = gpio_request(CAM_RST_B, "cam-reset");\r\nif (ret)\r\nreturn ret;\r\ngpio_direction_output(CAM_RST_B, 1);\r\nret = gpio_request(CAM_POWER, "cam-standby");\r\nif (ret)\r\nreturn ret;\r\ngpio_direction_output(CAM_POWER, 0);\r\nreturn 0;\r\n}\r\nstatic int smartbot_otg_init(struct platform_device *pdev)\r\n{\r\nreturn mx31_initialize_usb_hw(pdev->id, MXC_EHCI_POWER_PINS_ENABLED);\r\n}\r\nstatic int __init smartbot_otg_host_init(void)\r\n{\r\nstruct platform_device *pdev;\r\notg_host_pdata.otg = imx_otg_ulpi_create(ULPI_OTG_DRVVBUS |\r\nULPI_OTG_DRVVBUS_EXT);\r\nif (!otg_host_pdata.otg)\r\nreturn -ENODEV;\r\npdev = imx31_add_mxc_ehci_otg(&otg_host_pdata);\r\nif (IS_ERR(pdev))\r\nreturn PTR_ERR(pdev);\r\nreturn 0;\r\n}\r\nstatic inline int smartbot_otg_host_init(void) { return 0; }\r\nstatic void smartbot_resets_init(void)\r\n{\r\nif (!gpio_request(POWER_EN, "power-enable")) {\r\ngpio_direction_output(POWER_EN, 0);\r\ngpio_export(POWER_EN, false);\r\n}\r\nif (!gpio_request(DSPIC_RST_B, "dspic-rst")) {\r\ngpio_direction_output(DSPIC_RST_B, 0);\r\ngpio_export(DSPIC_RST_B, false);\r\n}\r\nif (!gpio_request(TRSLAT_RST_B, "translator-rst")) {\r\ngpio_direction_output(TRSLAT_RST_B, 0);\r\ngpio_export(TRSLAT_RST_B, false);\r\n}\r\nif (!gpio_request(TRSLAT_SRC_CHOICE, "translator-src-choice")) {\r\ngpio_direction_output(TRSLAT_SRC_CHOICE, 0);\r\ngpio_export(TRSLAT_SRC_CHOICE, false);\r\n}\r\n}\r\nvoid __init mx31moboard_smartbot_init(int board)\r\n{\r\nprintk(KERN_INFO "Initializing mx31smartbot peripherals\n");\r\nmxc_iomux_setup_multiple_pins(smartbot_pins, ARRAY_SIZE(smartbot_pins),\r\n"smartbot");\r\nimx31_add_imx_uart1(&uart_pdata);\r\nswitch (board) {\r\ncase MX31SMARTBOT:\r\nimx31_add_fsl_usb2_udc(&usb_pdata);\r\nbreak;\r\ncase MX31EYEBOT:\r\nsmartbot_otg_host_init();\r\nbreak;\r\ndefault:\r\nprintk(KERN_WARNING "Unknown board %d, USB OTG not initialized",\r\nboard);\r\n}\r\nsmartbot_resets_init();\r\nsmartbot_cam_init();\r\nplatform_add_devices(smartbot_cameras, ARRAY_SIZE(smartbot_cameras));\r\n}
