int vsp1_rwpf_enum_mbus_code(struct v4l2_subdev *subdev,\r\nstruct v4l2_subdev_fh *fh,\r\nstruct v4l2_subdev_mbus_code_enum *code)\r\n{\r\nstatic const unsigned int codes[] = {\r\nV4L2_MBUS_FMT_ARGB8888_1X32,\r\nV4L2_MBUS_FMT_AYUV8_1X32,\r\n};\r\nif (code->index >= ARRAY_SIZE(codes))\r\nreturn -EINVAL;\r\ncode->code = codes[code->index];\r\nreturn 0;\r\n}\r\nint vsp1_rwpf_enum_frame_size(struct v4l2_subdev *subdev,\r\nstruct v4l2_subdev_fh *fh,\r\nstruct v4l2_subdev_frame_size_enum *fse)\r\n{\r\nstruct vsp1_rwpf *rwpf = to_rwpf(subdev);\r\nstruct v4l2_mbus_framefmt *format;\r\nformat = v4l2_subdev_get_try_format(fh, fse->pad);\r\nif (fse->index || fse->code != format->code)\r\nreturn -EINVAL;\r\nif (fse->pad == RWPF_PAD_SINK) {\r\nfse->min_width = RWPF_MIN_WIDTH;\r\nfse->max_width = rwpf->max_width;\r\nfse->min_height = RWPF_MIN_HEIGHT;\r\nfse->max_height = rwpf->max_height;\r\n} else {\r\nfse->min_width = format->width;\r\nfse->max_width = format->width;\r\nfse->min_height = format->height;\r\nfse->max_height = format->height;\r\n}\r\nreturn 0;\r\n}\r\nint vsp1_rwpf_get_format(struct v4l2_subdev *subdev, struct v4l2_subdev_fh *fh,\r\nstruct v4l2_subdev_format *fmt)\r\n{\r\nstruct vsp1_rwpf *rwpf = to_rwpf(subdev);\r\nfmt->format = *vsp1_entity_get_pad_format(&rwpf->entity, fh, fmt->pad,\r\nfmt->which);\r\nreturn 0;\r\n}\r\nint vsp1_rwpf_set_format(struct v4l2_subdev *subdev, struct v4l2_subdev_fh *fh,\r\nstruct v4l2_subdev_format *fmt)\r\n{\r\nstruct vsp1_rwpf *rwpf = to_rwpf(subdev);\r\nstruct v4l2_mbus_framefmt *format;\r\nif (fmt->format.code != V4L2_MBUS_FMT_ARGB8888_1X32 &&\r\nfmt->format.code != V4L2_MBUS_FMT_AYUV8_1X32)\r\nfmt->format.code = V4L2_MBUS_FMT_AYUV8_1X32;\r\nformat = vsp1_entity_get_pad_format(&rwpf->entity, fh, fmt->pad,\r\nfmt->which);\r\nif (fmt->pad == RWPF_PAD_SOURCE) {\r\nformat->code = fmt->format.code;\r\nfmt->format = *format;\r\nreturn 0;\r\n}\r\nformat->code = fmt->format.code;\r\nformat->width = clamp_t(unsigned int, fmt->format.width,\r\nRWPF_MIN_WIDTH, rwpf->max_width);\r\nformat->height = clamp_t(unsigned int, fmt->format.height,\r\nRWPF_MIN_HEIGHT, rwpf->max_height);\r\nformat->field = V4L2_FIELD_NONE;\r\nformat->colorspace = V4L2_COLORSPACE_SRGB;\r\nfmt->format = *format;\r\nformat = vsp1_entity_get_pad_format(&rwpf->entity, fh, RWPF_PAD_SOURCE,\r\nfmt->which);\r\n*format = fmt->format;\r\nreturn 0;\r\n}
