static int regcache_flat_init(struct regmap *map)\r\n{\r\nint i;\r\nunsigned int *cache;\r\nmap->cache = kzalloc(sizeof(unsigned int) * (map->max_register + 1),\r\nGFP_KERNEL);\r\nif (!map->cache)\r\nreturn -ENOMEM;\r\ncache = map->cache;\r\nfor (i = 0; i < map->num_reg_defaults; i++)\r\ncache[map->reg_defaults[i].reg] = map->reg_defaults[i].def;\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_exit(struct regmap *map)\r\n{\r\nkfree(map->cache);\r\nmap->cache = NULL;\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_read(struct regmap *map,\r\nunsigned int reg, unsigned int *value)\r\n{\r\nunsigned int *cache = map->cache;\r\n*value = cache[reg];\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_write(struct regmap *map, unsigned int reg,\r\nunsigned int value)\r\n{\r\nunsigned int *cache = map->cache;\r\ncache[reg] = value;\r\nreturn 0;\r\n}
