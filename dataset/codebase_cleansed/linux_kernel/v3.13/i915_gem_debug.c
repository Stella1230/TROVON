int\r\ni915_verify_lists(struct drm_device *dev)\r\n{\r\nstatic int warned;\r\ndrm_i915_private_t *dev_priv = dev->dev_private;\r\nstruct drm_i915_gem_object *obj;\r\nint err = 0;\r\nif (warned)\r\nreturn 0;\r\nlist_for_each_entry(obj, &dev_priv->render_ring.active_list, list) {\r\nif (obj->base.dev != dev ||\r\n!atomic_read(&obj->base.refcount.refcount)) {\r\nDRM_ERROR("freed render active %p\n", obj);\r\nerr++;\r\nbreak;\r\n} else if (!obj->active ||\r\n(obj->base.read_domains & I915_GEM_GPU_DOMAINS) == 0) {\r\nDRM_ERROR("invalid render active %p (a %d r %x)\n",\r\nobj,\r\nobj->active,\r\nobj->base.read_domains);\r\nerr++;\r\n} else if (obj->base.write_domain && list_empty(&obj->gpu_write_list)) {\r\nDRM_ERROR("invalid render active %p (w %x, gwl %d)\n",\r\nobj,\r\nobj->base.write_domain,\r\n!list_empty(&obj->gpu_write_list));\r\nerr++;\r\n}\r\n}\r\nlist_for_each_entry(obj, &dev_priv->mm.flushing_list, list) {\r\nif (obj->base.dev != dev ||\r\n!atomic_read(&obj->base.refcount.refcount)) {\r\nDRM_ERROR("freed flushing %p\n", obj);\r\nerr++;\r\nbreak;\r\n} else if (!obj->active ||\r\n(obj->base.write_domain & I915_GEM_GPU_DOMAINS) == 0 ||\r\nlist_empty(&obj->gpu_write_list)) {\r\nDRM_ERROR("invalid flushing %p (a %d w %x gwl %d)\n",\r\nobj,\r\nobj->active,\r\nobj->base.write_domain,\r\n!list_empty(&obj->gpu_write_list));\r\nerr++;\r\n}\r\n}\r\nlist_for_each_entry(obj, &dev_priv->mm.gpu_write_list, gpu_write_list) {\r\nif (obj->base.dev != dev ||\r\n!atomic_read(&obj->base.refcount.refcount)) {\r\nDRM_ERROR("freed gpu write %p\n", obj);\r\nerr++;\r\nbreak;\r\n} else if (!obj->active ||\r\n(obj->base.write_domain & I915_GEM_GPU_DOMAINS) == 0) {\r\nDRM_ERROR("invalid gpu write %p (a %d w %x)\n",\r\nobj,\r\nobj->active,\r\nobj->base.write_domain);\r\nerr++;\r\n}\r\n}\r\nlist_for_each_entry(obj, &i915_gtt_vm->inactive_list, list) {\r\nif (obj->base.dev != dev ||\r\n!atomic_read(&obj->base.refcount.refcount)) {\r\nDRM_ERROR("freed inactive %p\n", obj);\r\nerr++;\r\nbreak;\r\n} else if (obj->pin_count || obj->active ||\r\n(obj->base.write_domain & I915_GEM_GPU_DOMAINS)) {\r\nDRM_ERROR("invalid inactive %p (p %d a %d w %x)\n",\r\nobj,\r\nobj->pin_count, obj->active,\r\nobj->base.write_domain);\r\nerr++;\r\n}\r\n}\r\nreturn warned = err;\r\n}
