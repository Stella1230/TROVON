static void __init keystone_init(void)\r\n{\r\nstruct device_node *node;\r\nnode = of_find_compatible_node(NULL, NULL, "ti,keystone-reset");\r\nif (WARN_ON(!node))\r\npr_warn("ti,keystone-reset node undefined\n");\r\nkeystone_rstctrl = of_iomap(node, 0);\r\nif (WARN_ON(!keystone_rstctrl))\r\npr_warn("ti,keystone-reset iomap error\n");\r\nof_platform_populate(NULL, of_default_bus_match_table, NULL, NULL);\r\n}\r\nvoid keystone_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nu32 val;\r\nBUG_ON(!keystone_rstctrl);\r\nval = readl(keystone_rstctrl);\r\nval &= PLL_RESET_WRITE_KEY_MASK;\r\nval |= PLL_RESET_WRITE_KEY;\r\nwritel(val, keystone_rstctrl);\r\nval = readl(keystone_rstctrl);\r\nval &= ~PLL_RESET;\r\nwritel(val, keystone_rstctrl);\r\n}
