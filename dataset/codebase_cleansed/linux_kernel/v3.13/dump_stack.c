static void __dump_stack(void)\r\n{\r\ndump_stack_print_info(KERN_DEFAULT);\r\nshow_stack(NULL, NULL);\r\n}\r\nasmlinkage void dump_stack(void)\r\n{\r\nint was_locked;\r\nint old;\r\nint cpu;\r\npreempt_disable();\r\nretry:\r\ncpu = smp_processor_id();\r\nold = atomic_cmpxchg(&dump_lock, -1, cpu);\r\nif (old == -1) {\r\nwas_locked = 0;\r\n} else if (old == cpu) {\r\nwas_locked = 1;\r\n} else {\r\ncpu_relax();\r\ngoto retry;\r\n}\r\n__dump_stack();\r\nif (!was_locked)\r\natomic_set(&dump_lock, -1);\r\npreempt_enable();\r\n}\r\nasmlinkage void dump_stack(void)\r\n{\r\n__dump_stack();\r\n}
