u8 *ecryptfs_get_auth_tok_key(struct ecryptfs_auth_tok *auth_tok)\r\n{\r\nreturn auth_tok->token.password.session_key_encryption_key;\r\n}\r\nvoid ecryptfs_get_versions(int *major, int *minor, int *file_version)\r\n{\r\n*major = ECRYPTFS_VERSION_MAJOR;\r\n*minor = ECRYPTFS_VERSION_MINOR;\r\nif (file_version)\r\n*file_version = ECRYPTFS_SUPPORTED_FILE_VERSION;\r\n}\r\nint ecryptfs_fill_auth_tok(struct ecryptfs_auth_tok *auth_tok,\r\nconst char *key_desc)\r\n{\r\nint major, minor;\r\necryptfs_get_versions(&major, &minor, NULL);\r\nauth_tok->version = (((uint16_t)(major << 8) & 0xFF00)\r\n| ((uint16_t)minor & 0x00FF));\r\nauth_tok->token_type = ECRYPTFS_PASSWORD;\r\nstrncpy((char *)auth_tok->token.password.signature, key_desc,\r\nECRYPTFS_PASSWORD_SIG_SIZE);\r\nauth_tok->token.password.session_key_encryption_key_bytes =\r\nECRYPTFS_MAX_KEY_BYTES;\r\nauth_tok->token.password.flags |=\r\nECRYPTFS_SESSION_KEY_ENCRYPTION_KEY_SET;\r\nauth_tok->session_key.encrypted_key[0] = 0;\r\nauth_tok->session_key.encrypted_key_size = 0;\r\nauth_tok->token.password.hash_algo = PGP_DIGEST_ALGO_SHA512;\r\nauth_tok->token.password.flags &= ~(ECRYPTFS_PERSISTENT_PASSWORD);\r\nreturn 0;\r\n}
