static int amilo_a1655_rfkill_set_block(void *data, bool blocked)\r\n{\r\nu8 param = blocked ? A1655_WIFI_OFF : A1655_WIFI_ON;\r\nint rc;\r\ni8042_lock_chip();\r\nrc = i8042_command(&param, A1655_WIFI_COMMAND);\r\ni8042_unlock_chip();\r\nreturn rc;\r\n}\r\nstatic int amilo_m7440_rfkill_set_block(void *data, bool blocked)\r\n{\r\nu8 val1 = blocked ? M7440_RADIO_OFF1 : M7440_RADIO_ON1;\r\nu8 val2 = blocked ? M7440_RADIO_OFF2 : M7440_RADIO_ON2;\r\noutb(val1, M7440_PORT1);\r\noutb(val2, M7440_PORT2);\r\nif (inb(M7440_PORT1) != val1 || inb(M7440_PORT2) != val2)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int amilo_rfkill_probe(struct platform_device *device)\r\n{\r\nint rc;\r\nconst struct dmi_system_id *system_id =\r\ndmi_first_match(amilo_rfkill_id_table);\r\nif (!system_id)\r\nreturn -ENXIO;\r\namilo_rfkill_dev = rfkill_alloc(KBUILD_MODNAME, &device->dev,\r\nRFKILL_TYPE_WLAN,\r\nsystem_id->driver_data, NULL);\r\nif (!amilo_rfkill_dev)\r\nreturn -ENOMEM;\r\nrc = rfkill_register(amilo_rfkill_dev);\r\nif (rc)\r\ngoto fail;\r\nreturn 0;\r\nfail:\r\nrfkill_destroy(amilo_rfkill_dev);\r\nreturn rc;\r\n}\r\nstatic int amilo_rfkill_remove(struct platform_device *device)\r\n{\r\nrfkill_unregister(amilo_rfkill_dev);\r\nrfkill_destroy(amilo_rfkill_dev);\r\nreturn 0;\r\n}\r\nstatic int __init amilo_rfkill_init(void)\r\n{\r\nint rc;\r\nif (dmi_first_match(amilo_rfkill_id_table) == NULL)\r\nreturn -ENODEV;\r\nrc = platform_driver_register(&amilo_rfkill_driver);\r\nif (rc)\r\nreturn rc;\r\namilo_rfkill_pdev = platform_device_register_simple(KBUILD_MODNAME, -1,\r\nNULL, 0);\r\nif (IS_ERR(amilo_rfkill_pdev)) {\r\nrc = PTR_ERR(amilo_rfkill_pdev);\r\ngoto fail;\r\n}\r\nreturn 0;\r\nfail:\r\nplatform_driver_unregister(&amilo_rfkill_driver);\r\nreturn rc;\r\n}\r\nstatic void __exit amilo_rfkill_exit(void)\r\n{\r\nplatform_device_unregister(amilo_rfkill_pdev);\r\nplatform_driver_unregister(&amilo_rfkill_driver);\r\n}
