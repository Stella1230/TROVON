struct lu_ucred *lu_ucred(const struct lu_env *env)\r\n{\r\nif (!env->le_ses)\r\nreturn NULL;\r\nreturn lu_context_key_get(env->le_ses, &lu_ucred_key);\r\n}\r\nstruct lu_ucred *lu_ucred_check(const struct lu_env *env)\r\n{\r\nstruct lu_ucred *uc = lu_ucred(env);\r\nif (uc && uc->uc_valid != UCRED_OLD && uc->uc_valid != UCRED_NEW)\r\nreturn NULL;\r\nreturn uc;\r\n}\r\nstruct lu_ucred *lu_ucred_assert(const struct lu_env *env)\r\n{\r\nstruct lu_ucred *uc = lu_ucred_check(env);\r\nLASSERT(uc != NULL);\r\nreturn uc;\r\n}\r\nint lu_ucred_global_init(void)\r\n{\r\nLU_CONTEXT_KEY_INIT(&lu_ucred_key);\r\nreturn lu_context_key_register(&lu_ucred_key);\r\n}\r\nvoid lu_ucred_global_fini(void)\r\n{\r\nlu_context_key_degister(&lu_ucred_key);\r\n}
