void zynq_slcr_system_reset(void)\r\n{\r\nu32 reboot;\r\nwritel(SLCR_UNLOCK_MAGIC, zynq_slcr_base + SLCR_UNLOCK_OFFSET);\r\nreboot = readl(zynq_slcr_base + SLCR_REBOOT_STATUS_OFFSET);\r\nwritel(reboot & 0xF0FFFFFF, zynq_slcr_base + SLCR_REBOOT_STATUS_OFFSET);\r\nwritel(1, zynq_slcr_base + SLCR_PS_RST_CTRL_OFFSET);\r\n}\r\nvoid zynq_slcr_cpu_start(int cpu)\r\n{\r\nu32 reg = readl(zynq_slcr_base + SLCR_A9_CPU_RST_CTRL_OFFSET);\r\nreg &= ~(SLCR_A9_CPU_RST << cpu);\r\nwritel(reg, zynq_slcr_base + SLCR_A9_CPU_RST_CTRL_OFFSET);\r\nreg &= ~(SLCR_A9_CPU_CLKSTOP << cpu);\r\nwritel(reg, zynq_slcr_base + SLCR_A9_CPU_RST_CTRL_OFFSET);\r\n}\r\nvoid zynq_slcr_cpu_stop(int cpu)\r\n{\r\nu32 reg = readl(zynq_slcr_base + SLCR_A9_CPU_RST_CTRL_OFFSET);\r\nreg |= (SLCR_A9_CPU_CLKSTOP | SLCR_A9_CPU_RST) << cpu;\r\nwritel(reg, zynq_slcr_base + SLCR_A9_CPU_RST_CTRL_OFFSET);\r\n}\r\nint __init zynq_slcr_init(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_compatible_node(NULL, NULL, "xlnx,zynq-slcr");\r\nif (!np) {\r\npr_err("%s: no slcr node found\n", __func__);\r\nBUG();\r\n}\r\nzynq_slcr_base = of_iomap(np, 0);\r\nif (!zynq_slcr_base) {\r\npr_err("%s: Unable to map I/O memory\n", __func__);\r\nBUG();\r\n}\r\nwritel(SLCR_UNLOCK_MAGIC, zynq_slcr_base + SLCR_UNLOCK_OFFSET);\r\npr_info("%s mapped to %p\n", np->name, zynq_slcr_base);\r\nzynq_clock_init(zynq_slcr_base);\r\nof_node_put(np);\r\nreturn 0;\r\n}
