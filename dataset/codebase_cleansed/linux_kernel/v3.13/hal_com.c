void dump_chip_info(struct HAL_VERSION chip_vers)\r\n{\r\nuint cnt = 0;\r\nchar buf[128];\r\nif (IS_81XXC(chip_vers)) {\r\ncnt += sprintf((buf+cnt), "Chip Version Info: %s_",\r\nIS_92C_SERIAL(chip_vers) ?\r\n"CHIP_8192C" : "CHIP_8188C");\r\n} else if (IS_92D(chip_vers)) {\r\ncnt += sprintf((buf+cnt), "Chip Version Info: CHIP_8192D_");\r\n} else if (IS_8723_SERIES(chip_vers)) {\r\ncnt += sprintf((buf+cnt), "Chip Version Info: CHIP_8723A_");\r\n} else if (IS_8188E(chip_vers)) {\r\ncnt += sprintf((buf+cnt), "Chip Version Info: CHIP_8188E_");\r\n}\r\ncnt += sprintf((buf+cnt), "%s_", IS_NORMAL_CHIP(chip_vers) ?\r\n"Normal_Chip" : "Test_Chip");\r\ncnt += sprintf((buf+cnt), "%s_", IS_CHIP_VENDOR_TSMC(chip_vers) ?\r\n"TSMC" : "UMC");\r\nif (IS_A_CUT(chip_vers))\r\ncnt += sprintf((buf+cnt), "A_CUT_");\r\nelse if (IS_B_CUT(chip_vers))\r\ncnt += sprintf((buf+cnt), "B_CUT_");\r\nelse if (IS_C_CUT(chip_vers))\r\ncnt += sprintf((buf+cnt), "C_CUT_");\r\nelse if (IS_D_CUT(chip_vers))\r\ncnt += sprintf((buf+cnt), "D_CUT_");\r\nelse if (IS_E_CUT(chip_vers))\r\ncnt += sprintf((buf+cnt), "E_CUT_");\r\nelse\r\ncnt += sprintf((buf+cnt), "UNKNOWN_CUT(%d)_",\r\nchip_vers.CUTVersion);\r\nif (IS_1T1R(chip_vers))\r\ncnt += sprintf((buf+cnt), "1T1R_");\r\nelse if (IS_1T2R(chip_vers))\r\ncnt += sprintf((buf+cnt), "1T2R_");\r\nelse if (IS_2T2R(chip_vers))\r\ncnt += sprintf((buf+cnt), "2T2R_");\r\nelse\r\ncnt += sprintf((buf+cnt), "UNKNOWN_RFTYPE(%d)_",\r\nchip_vers.RFType);\r\ncnt += sprintf((buf+cnt), "RomVer(%d)\n", chip_vers.ROMVer);\r\npr_info("%s", buf);\r\n}\r\nu8\r\nhal_com_get_channel_plan(struct adapter *padapter, u8 hw_channel_plan,\r\nu8 sw_channel_plan, u8 def_channel_plan,\r\nbool load_fail)\r\n{\r\nu8 sw_cfg;\r\nu8 chnlplan;\r\nsw_cfg = true;\r\nif (!load_fail) {\r\nif (!rtw_is_channel_plan_valid(sw_channel_plan))\r\nsw_cfg = false;\r\nif (hw_channel_plan & CHAN_PLAN_HW)\r\nsw_cfg = false;\r\n}\r\nif (sw_cfg)\r\nchnlplan = sw_channel_plan;\r\nelse\r\nchnlplan = hw_channel_plan & (~CHAN_PLAN_HW);\r\nif (!rtw_is_channel_plan_valid(chnlplan))\r\nchnlplan = def_channel_plan;\r\nreturn chnlplan;\r\n}\r\nu8 MRateToHwRate(u8 rate)\r\n{\r\nu8 ret = DESC_RATE1M;\r\nswitch (rate) {\r\ncase IEEE80211_CCK_RATE_1MB:\r\nret = DESC_RATE1M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_2MB:\r\nret = DESC_RATE2M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_5MB:\r\nret = DESC_RATE5_5M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_11MB:\r\nret = DESC_RATE11M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_6MB:\r\nret = DESC_RATE6M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_9MB:\r\nret = DESC_RATE9M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_12MB:\r\nret = DESC_RATE12M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_18MB:\r\nret = DESC_RATE18M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_24MB:\r\nret = DESC_RATE24M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_36MB:\r\nret = DESC_RATE36M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_48MB:\r\nret = DESC_RATE48M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_54MB:\r\nret = DESC_RATE54M;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nvoid HalSetBrateCfg(struct adapter *adapt, u8 *brates, u16 *rate_cfg)\r\n{\r\nu8 i, is_brate, brate;\r\nfor (i = 0; i < NDIS_802_11_LENGTH_RATES_EX; i++) {\r\nis_brate = brates[i] & IEEE80211_BASIC_RATE_MASK;\r\nbrate = brates[i] & 0x7f;\r\nif (is_brate) {\r\nswitch (brate) {\r\ncase IEEE80211_CCK_RATE_1MB:\r\n*rate_cfg |= RATE_1M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_2MB:\r\n*rate_cfg |= RATE_2M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_5MB:\r\n*rate_cfg |= RATE_5_5M;\r\nbreak;\r\ncase IEEE80211_CCK_RATE_11MB:\r\n*rate_cfg |= RATE_11M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_6MB:\r\n*rate_cfg |= RATE_6M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_9MB:\r\n*rate_cfg |= RATE_9M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_12MB:\r\n*rate_cfg |= RATE_12M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_18MB:\r\n*rate_cfg |= RATE_18M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_24MB:\r\n*rate_cfg |= RATE_24M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_36MB:\r\n*rate_cfg |= RATE_36M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_48MB:\r\n*rate_cfg |= RATE_48M;\r\nbreak;\r\ncase IEEE80211_OFDM_RATE_54MB:\r\n*rate_cfg |= RATE_54M;\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\nstatic void one_out_pipe(struct adapter *adapter)\r\n{\r\nstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(adapter);\r\npdvobjpriv->Queue2Pipe[0] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[1] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[2] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[3] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[4] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[5] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[6] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[7] = pdvobjpriv->RtOutPipe[0];\r\n}\r\nstatic void two_out_pipe(struct adapter *adapter, bool wifi_cfg)\r\n{\r\nstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(adapter);\r\nif (wifi_cfg) {\r\npdvobjpriv->Queue2Pipe[0] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[1] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[2] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[3] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[4] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[5] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[6] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[7] = pdvobjpriv->RtOutPipe[0];\r\n} else {\r\npdvobjpriv->Queue2Pipe[0] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[1] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[2] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[3] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[4] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[5] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[6] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[7] = pdvobjpriv->RtOutPipe[0];\r\n}\r\n}\r\nstatic void three_out_pipe(struct adapter *adapter, bool wifi_cfg)\r\n{\r\nstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(adapter);\r\nif (wifi_cfg) {\r\npdvobjpriv->Queue2Pipe[0] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[1] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[2] = pdvobjpriv->RtOutPipe[2];\r\npdvobjpriv->Queue2Pipe[3] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[4] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[5] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[6] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[7] = pdvobjpriv->RtOutPipe[0];\r\n} else {\r\npdvobjpriv->Queue2Pipe[0] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[1] = pdvobjpriv->RtOutPipe[1];\r\npdvobjpriv->Queue2Pipe[2] = pdvobjpriv->RtOutPipe[2];\r\npdvobjpriv->Queue2Pipe[3] = pdvobjpriv->RtOutPipe[2];\r\npdvobjpriv->Queue2Pipe[4] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[5] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[6] = pdvobjpriv->RtOutPipe[0];\r\npdvobjpriv->Queue2Pipe[7] = pdvobjpriv->RtOutPipe[0];\r\n}\r\n}\r\nbool Hal_MappingOutPipe(struct adapter *adapter, u8 numoutpipe)\r\n{\r\nstruct registry_priv *pregistrypriv = &adapter->registrypriv;\r\nbool wifi_cfg = (pregistrypriv->wifi_spec) ? true : false;\r\nbool result = true;\r\nswitch (numoutpipe) {\r\ncase 2:\r\ntwo_out_pipe(adapter, wifi_cfg);\r\nbreak;\r\ncase 3:\r\nthree_out_pipe(adapter, wifi_cfg);\r\nbreak;\r\ncase 1:\r\none_out_pipe(adapter);\r\nbreak;\r\ndefault:\r\nresult = false;\r\nbreak;\r\n}\r\nreturn result;\r\n}\r\nvoid hal_init_macaddr(struct adapter *adapter)\r\n{\r\nrtw_hal_set_hwreg(adapter, HW_VAR_MAC_ADDR,\r\nadapter->eeprompriv.mac_addr);\r\n}\r\nvoid c2h_evt_clear(struct adapter *adapter)\r\n{\r\nrtw_write8(adapter, REG_C2HEVT_CLEAR, C2H_EVT_HOST_CLOSE);\r\n}\r\ns32 c2h_evt_read(struct adapter *adapter, u8 *buf)\r\n{\r\ns32 ret = _FAIL;\r\nstruct c2h_evt_hdr *c2h_evt;\r\nint i;\r\nu8 trigger;\r\nif (buf == NULL)\r\ngoto exit;\r\ntrigger = rtw_read8(adapter, REG_C2HEVT_CLEAR);\r\nif (trigger == C2H_EVT_HOST_CLOSE)\r\ngoto exit;\r\nelse if (trigger != C2H_EVT_FW_CLOSE)\r\ngoto clear_evt;\r\nc2h_evt = (struct c2h_evt_hdr *)buf;\r\n_rtw_memset(c2h_evt, 0, 16);\r\n*buf = rtw_read8(adapter, REG_C2HEVT_MSG_NORMAL);\r\n*(buf+1) = rtw_read8(adapter, REG_C2HEVT_MSG_NORMAL + 1);\r\nRT_PRINT_DATA(_module_hal_init_c_, _drv_info_, "c2h_evt_read(): ",\r\n&c2h_evt , sizeof(c2h_evt));\r\nfor (i = 0; i < c2h_evt->plen; i++)\r\nc2h_evt->payload[i] = rtw_read8(adapter, REG_C2HEVT_MSG_NORMAL +\r\nsizeof(*c2h_evt) + i);\r\nRT_PRINT_DATA(_module_hal_init_c_, _drv_info_,\r\n"c2h_evt_read(): Command Content:\n",\r\nc2h_evt->payload, c2h_evt->plen);\r\nret = _SUCCESS;\r\nclear_evt:\r\nc2h_evt_clear(adapter);\r\nexit:\r\nreturn ret;\r\n}
