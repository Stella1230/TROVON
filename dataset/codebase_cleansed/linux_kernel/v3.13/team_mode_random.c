static u32 random_N(unsigned int N)\r\n{\r\nreturn reciprocal_divide(prandom_u32(), N);\r\n}\r\nstatic bool rnd_transmit(struct team *team, struct sk_buff *skb)\r\n{\r\nstruct team_port *port;\r\nint port_index;\r\nport_index = random_N(team->en_port_count);\r\nport = team_get_port_by_index_rcu(team, port_index);\r\nif (unlikely(!port))\r\ngoto drop;\r\nport = team_get_first_port_txable_rcu(team, port);\r\nif (unlikely(!port))\r\ngoto drop;\r\nif (team_dev_queue_xmit(team, port, skb))\r\nreturn false;\r\nreturn true;\r\ndrop:\r\ndev_kfree_skb_any(skb);\r\nreturn false;\r\n}\r\nstatic int __init rnd_init_module(void)\r\n{\r\nreturn team_mode_register(&rnd_mode);\r\n}\r\nstatic void __exit rnd_cleanup_module(void)\r\n{\r\nteam_mode_unregister(&rnd_mode);\r\n}
