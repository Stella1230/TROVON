static bool CheckCondition(const u32 Condition, const u32 Hex)\r\n{\r\nu32 _board = (Hex & 0x000000FF);\r\nu32 _interface = (Hex & 0x0000FF00) >> 8;\r\nu32 _platform = (Hex & 0x00FF0000) >> 16;\r\nu32 cond = Condition;\r\nif (Condition == 0xCDCDCDCD)\r\nreturn true;\r\ncond = Condition & 0x000000FF;\r\nif ((_board == cond) && cond != 0x00)\r\nreturn false;\r\ncond = Condition & 0x0000FF00;\r\ncond = cond >> 8;\r\nif ((_interface & cond) == 0 && cond != 0x07)\r\nreturn false;\r\ncond = Condition & 0x00FF0000;\r\ncond = cond >> 16;\r\nif ((_platform & cond) == 0 && cond != 0x0F)\r\nreturn false;\r\nreturn true;\r\n}\r\nenum HAL_STATUS ODM_ReadAndConfig_RadioA_1T_8188E(struct odm_dm_struct *pDM_Odm)\r\n{\r\n#define READ_NEXT_PAIR(v1, v2, i) do \\r\n{ i += 2; v1 = Array[i]; \\r\nv2 = Array[i+1]; } while (0)\r\nu32 hex = 0;\r\nu32 i = 0;\r\nu8 platform = pDM_Odm->SupportPlatform;\r\nu8 interfaceValue = pDM_Odm->SupportInterface;\r\nu8 board = pDM_Odm->BoardType;\r\nu32 ArrayLen = sizeof(Array_RadioA_1T_8188E)/sizeof(u32);\r\nu32 *Array = Array_RadioA_1T_8188E;\r\nbool biol = false;\r\nstruct adapter *Adapter = pDM_Odm->Adapter;\r\nstruct xmit_frame *pxmit_frame = NULL;\r\nu8 bndy_cnt = 1;\r\nenum HAL_STATUS rst = HAL_STATUS_SUCCESS;\r\nhex += board;\r\nhex += interfaceValue << 8;\r\nhex += platform << 16;\r\nhex += 0xFF000000;\r\nbiol = rtw_IOL_applied(Adapter);\r\nif (biol) {\r\npxmit_frame = rtw_IOL_accquire_xmit_frame(Adapter);\r\nif (pxmit_frame == NULL) {\r\npr_info("rtw_IOL_accquire_xmit_frame failed\n");\r\nreturn HAL_STATUS_FAILURE;\r\n}\r\n}\r\nfor (i = 0; i < ArrayLen; i += 2) {\r\nu32 v1 = Array[i];\r\nu32 v2 = Array[i+1];\r\nif (v1 < 0xCDCDCDCD) {\r\nif (biol) {\r\nif (rtw_IOL_cmd_boundary_handle(pxmit_frame))\r\nbndy_cnt++;\r\nif (v1 == 0xffe)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 50);\r\nelse if (v1 == 0xfd)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 5);\r\nelse if (v1 == 0xfc)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 1);\r\nelse if (v1 == 0xfb)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 50);\r\nelse if (v1 == 0xfa)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 5);\r\nelse if (v1 == 0xf9)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 1);\r\nelse\r\nrtw_IOL_append_WRF_cmd(pxmit_frame, ODM_RF_PATH_A, (u16)v1, v2, bRFRegOffsetMask);\r\n} else {\r\nodm_ConfigRF_RadioA_8188E(pDM_Odm, v1, v2);\r\n}\r\ncontinue;\r\n} else {\r\nif (!CheckCondition(Array[i], hex)) {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD &&\r\nv2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < ArrayLen - 2)\r\nREAD_NEXT_PAIR(v1, v2, i);\r\ni -= 2;\r\n} else {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD &&\r\nv2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < ArrayLen - 2) {\r\nif (biol) {\r\nif (rtw_IOL_cmd_boundary_handle(pxmit_frame))\r\nbndy_cnt++;\r\nif (v1 == 0xffe)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 50);\r\nelse if (v1 == 0xfd)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 5);\r\nelse if (v1 == 0xfc)\r\nrtw_IOL_append_DELAY_MS_cmd(pxmit_frame, 1);\r\nelse if (v1 == 0xfb)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 50);\r\nelse if (v1 == 0xfa)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 5);\r\nelse if (v1 == 0xf9)\r\nrtw_IOL_append_DELAY_US_cmd(pxmit_frame, 1);\r\nelse\r\nrtw_IOL_append_WRF_cmd(pxmit_frame, ODM_RF_PATH_A, (u16)v1, v2, bRFRegOffsetMask);\r\n} else {\r\nodm_ConfigRF_RadioA_8188E(pDM_Odm, v1, v2);\r\n}\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\nwhile (v2 != 0xDEAD && i < ArrayLen - 2)\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\n}\r\n}\r\nif (biol) {\r\nif (!rtw_IOL_exec_cmds_sync(pDM_Odm->Adapter, pxmit_frame, 1000, bndy_cnt)) {\r\nrst = HAL_STATUS_FAILURE;\r\npr_info("~~~ IOL Config %s Failed !!!\n", __func__);\r\n}\r\n}\r\nreturn rst;\r\n}
