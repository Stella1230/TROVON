int __init mx1_clocks_init(unsigned long fref)\r\n{\r\nint i;\r\nclk[dummy] = imx_clk_fixed("dummy", 0);\r\nclk[clk32] = imx_clk_fixed("clk32", fref);\r\nclk[clk16m_ext] = imx_clk_fixed("clk16m_ext", 16000000);\r\nclk[clk16m] = imx_clk_gate("clk16m", "clk16m_ext", CCM_CSCR, 17);\r\nclk[clk32_premult] = imx_clk_fixed_factor("clk32_premult", "clk32", 512, 1);\r\nclk[prem] = imx_clk_mux("prem", CCM_CSCR, 16, 1, prem_sel_clks,\r\nARRAY_SIZE(prem_sel_clks));\r\nclk[mpll] = imx_clk_pllv1("mpll", "clk32_premult", CCM_MPCTL0);\r\nclk[spll] = imx_clk_pllv1("spll", "prem", CCM_SPCTL0);\r\nclk[mcu] = imx_clk_divider("mcu", "clk32_premult", CCM_CSCR, 15, 1);\r\nclk[fclk] = imx_clk_divider("fclk", "mpll", CCM_CSCR, 15, 1);\r\nclk[hclk] = imx_clk_divider("hclk", "spll", CCM_CSCR, 10, 4);\r\nclk[clk48m] = imx_clk_divider("clk48m", "spll", CCM_CSCR, 26, 3);\r\nclk[per1] = imx_clk_divider("per1", "spll", CCM_PCDR, 0, 4);\r\nclk[per2] = imx_clk_divider("per2", "spll", CCM_PCDR, 4, 4);\r\nclk[per3] = imx_clk_divider("per3", "spll", CCM_PCDR, 16, 7);\r\nclk[clko] = imx_clk_mux("clko", CCM_CSCR, 29, 3, clko_sel_clks,\r\nARRAY_SIZE(clko_sel_clks));\r\nclk[dma_gate] = imx_clk_gate("dma_gate", "hclk", SCM_GCCR, 4);\r\nclk[csi_gate] = imx_clk_gate("csi_gate", "hclk", SCM_GCCR, 2);\r\nclk[mma_gate] = imx_clk_gate("mma_gate", "hclk", SCM_GCCR, 1);\r\nclk[usbd_gate] = imx_clk_gate("usbd_gate", "clk48m", SCM_GCCR, 0);\r\nfor (i = 0; i < ARRAY_SIZE(clk); i++)\r\nif (IS_ERR(clk[i]))\r\npr_err("imx1 clk %d: register failed with %ld\n",\r\ni, PTR_ERR(clk[i]));\r\nclk_register_clkdev(clk[dma_gate], "ahb", "imx1-dma");\r\nclk_register_clkdev(clk[hclk], "ipg", "imx1-dma");\r\nclk_register_clkdev(clk[csi_gate], NULL, "mx1-camera.0");\r\nclk_register_clkdev(clk[mma_gate], "mma", NULL);\r\nclk_register_clkdev(clk[usbd_gate], NULL, "imx_udc.0");\r\nclk_register_clkdev(clk[per1], "per", "imx-gpt.0");\r\nclk_register_clkdev(clk[hclk], "ipg", "imx-gpt.0");\r\nclk_register_clkdev(clk[per1], "per", "imx1-uart.0");\r\nclk_register_clkdev(clk[hclk], "ipg", "imx1-uart.0");\r\nclk_register_clkdev(clk[per1], "per", "imx1-uart.1");\r\nclk_register_clkdev(clk[hclk], "ipg", "imx1-uart.1");\r\nclk_register_clkdev(clk[per1], "per", "imx1-uart.2");\r\nclk_register_clkdev(clk[hclk], "ipg", "imx1-uart.2");\r\nclk_register_clkdev(clk[hclk], NULL, "imx1-i2c.0");\r\nclk_register_clkdev(clk[per2], "per", "imx1-cspi.0");\r\nclk_register_clkdev(clk[dummy], "ipg", "imx1-cspi.0");\r\nclk_register_clkdev(clk[per2], "per", "imx1-cspi.1");\r\nclk_register_clkdev(clk[dummy], "ipg", "imx1-cspi.1");\r\nclk_register_clkdev(clk[per2], NULL, "imx-mmc.0");\r\nclk_register_clkdev(clk[per2], "per", "imx1-fb.0");\r\nclk_register_clkdev(clk[dummy], "ipg", "imx1-fb.0");\r\nclk_register_clkdev(clk[dummy], "ahb", "imx1-fb.0");\r\nclk_register_clkdev(clk[hclk], "mshc", NULL);\r\nclk_register_clkdev(clk[per3], "ssi", NULL);\r\nclk_register_clkdev(clk[clk32], NULL, "imx1-rtc.0");\r\nclk_register_clkdev(clk[clko], "clko", NULL);\r\nmxc_timer_init(MX1_IO_ADDRESS(MX1_TIM1_BASE_ADDR), MX1_TIM1_INT);\r\nreturn 0;\r\n}
