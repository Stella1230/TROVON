static inline const char *msk2str(unsigned int mask)\r\n{\r\nswitch (mask) {\r\ncase PM_4K: return "4kb";\r\ncase PM_16K: return "16kb";\r\ncase PM_64K: return "64kb";\r\ncase PM_256K: return "256kb";\r\n#ifdef CONFIG_CPU_CAVIUM_OCTEON\r\ncase PM_8K: return "8kb";\r\ncase PM_32K: return "32kb";\r\ncase PM_128K: return "128kb";\r\ncase PM_512K: return "512kb";\r\ncase PM_2M: return "2Mb";\r\ncase PM_8M: return "8Mb";\r\ncase PM_32M: return "32Mb";\r\n#endif\r\n#ifndef CONFIG_CPU_VR41XX\r\ncase PM_1M: return "1Mb";\r\ncase PM_4M: return "4Mb";\r\ncase PM_16M: return "16Mb";\r\ncase PM_64M: return "64Mb";\r\ncase PM_256M: return "256Mb";\r\ncase PM_1G: return "1Gb";\r\n#endif\r\n}\r\nreturn "";\r\n}\r\nstatic void dump_tlb(int first, int last)\r\n{\r\nunsigned long s_entryhi, entryhi, asid;\r\nunsigned long long entrylo0, entrylo1;\r\nunsigned int s_index, s_pagemask, pagemask, c0, c1, i;\r\ns_pagemask = read_c0_pagemask();\r\ns_entryhi = read_c0_entryhi();\r\ns_index = read_c0_index();\r\nasid = s_entryhi & 0xff;\r\nfor (i = first; i <= last; i++) {\r\nwrite_c0_index(i);\r\nBARRIER();\r\ntlb_read();\r\nBARRIER();\r\npagemask = read_c0_pagemask();\r\nentryhi = read_c0_entryhi();\r\nentrylo0 = read_c0_entrylo0();\r\nentrylo1 = read_c0_entrylo1();\r\nif ((entryhi & ~0x1ffffUL) != CKSEG0\r\n&& (entryhi & 0xff) == asid) {\r\n#ifdef CONFIG_32BIT\r\nint width = 8;\r\n#else\r\nint width = 11;\r\n#endif\r\nprintk("Index: %2d pgmask=%s ", i, msk2str(pagemask));\r\nc0 = (entrylo0 >> 3) & 7;\r\nc1 = (entrylo1 >> 3) & 7;\r\nprintk("va=%0*lx asid=%02lx\n",\r\nwidth, (entryhi & ~0x1fffUL),\r\nentryhi & 0xff);\r\nprintk("\t[pa=%0*llx c=%d d=%d v=%d g=%d] ",\r\nwidth,\r\n(entrylo0 << 6) & PAGE_MASK, c0,\r\n(entrylo0 & 4) ? 1 : 0,\r\n(entrylo0 & 2) ? 1 : 0,\r\n(entrylo0 & 1) ? 1 : 0);\r\nprintk("[pa=%0*llx c=%d d=%d v=%d g=%d]\n",\r\nwidth,\r\n(entrylo1 << 6) & PAGE_MASK, c1,\r\n(entrylo1 & 4) ? 1 : 0,\r\n(entrylo1 & 2) ? 1 : 0,\r\n(entrylo1 & 1) ? 1 : 0);\r\n}\r\n}\r\nprintk("\n");\r\nwrite_c0_entryhi(s_entryhi);\r\nwrite_c0_index(s_index);\r\nwrite_c0_pagemask(s_pagemask);\r\n}\r\nvoid dump_tlb_all(void)\r\n{\r\ndump_tlb(0, current_cpu_data.tlbsize - 1);\r\n}
