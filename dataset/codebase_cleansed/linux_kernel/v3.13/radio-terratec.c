static struct radio_isa_card *terratec_alloc(void)\r\n{\r\nreturn kzalloc(sizeof(struct radio_isa_card), GFP_KERNEL);\r\n}\r\nstatic int terratec_s_mute_volume(struct radio_isa_card *isa, bool mute, int vol)\r\n{\r\nint i;\r\nif (mute)\r\nvol = 0;\r\nvol = vol + (vol * 32);\r\nfor (i = 0; i < 8; i++) {\r\nif (vol & (0x80 >> i))\r\noutb(0x80, isa->io + 1);\r\nelse\r\noutb(0x00, isa->io + 1);\r\n}\r\nreturn 0;\r\n}\r\nstatic int terratec_s_frequency(struct radio_isa_card *isa, u32 freq)\r\n{\r\nint i;\r\nint p;\r\nint temp;\r\nlong rest;\r\nunsigned char buffer[25];\r\nfreq = freq / 160;\r\nmemset(buffer, 0, sizeof(buffer));\r\nrest = freq * 10 + 10700;\r\ni = 13;\r\np = 10;\r\ntemp = 102400;\r\nwhile (rest != 0) {\r\nif (rest % temp == rest)\r\nbuffer[i] = 0;\r\nelse {\r\nbuffer[i] = 1;\r\nrest = rest - temp;\r\n}\r\ni--;\r\np--;\r\ntemp = temp / 2;\r\n}\r\nfor (i = 24; i > -1; i--) {\r\nif (buffer[i] == 1) {\r\noutb(WRT_EN | DATA, isa->io);\r\noutb(WRT_EN | DATA | CLK_ON, isa->io);\r\noutb(WRT_EN | DATA, isa->io);\r\n} else {\r\noutb(WRT_EN | 0x00, isa->io);\r\noutb(WRT_EN | 0x00 | CLK_ON, isa->io);\r\n}\r\n}\r\noutb(0x00, isa->io);\r\nreturn 0;\r\n}\r\nstatic u32 terratec_g_signal(struct radio_isa_card *isa)\r\n{\r\nreturn (inb(isa->io) & 2) ? 0 : 0xffff;\r\n}\r\nstatic int __init terratec_init(void)\r\n{\r\nreturn isa_register_driver(&terratec_driver.driver, 1);\r\n}\r\nstatic void __exit terratec_exit(void)\r\n{\r\nisa_unregister_driver(&terratec_driver.driver);\r\n}
