static void s3c2410_cpufreq_setdivs(struct s3c_cpufreq_config *cfg)\r\n{\r\nu32 clkdiv = 0;\r\nif (cfg->divs.h_divisor == 2)\r\nclkdiv |= S3C2410_CLKDIVN_HDIVN;\r\nif (cfg->divs.p_divisor != cfg->divs.h_divisor)\r\nclkdiv |= S3C2410_CLKDIVN_PDIVN;\r\n__raw_writel(clkdiv, S3C2410_CLKDIVN);\r\n}\r\nstatic int s3c2410_cpufreq_calcdivs(struct s3c_cpufreq_config *cfg)\r\n{\r\nunsigned long hclk, fclk, pclk;\r\nunsigned int hdiv, pdiv;\r\nunsigned long hclk_max;\r\nfclk = cfg->freq.fclk;\r\nhclk_max = cfg->max.hclk;\r\ncfg->freq.armclk = fclk;\r\ns3c_freq_dbg("%s: fclk is %lu, max hclk %lu\n",\r\n__func__, fclk, hclk_max);\r\nhdiv = (fclk > cfg->max.hclk) ? 2 : 1;\r\nhclk = fclk / hdiv;\r\nif (hclk > cfg->max.hclk) {\r\ns3c_freq_dbg("%s: hclk too big\n", __func__);\r\nreturn -EINVAL;\r\n}\r\npdiv = (hclk > cfg->max.pclk) ? 2 : 1;\r\npclk = hclk / pdiv;\r\nif (pclk > cfg->max.pclk) {\r\ns3c_freq_dbg("%s: pclk too big\n", __func__);\r\nreturn -EINVAL;\r\n}\r\npdiv *= hdiv;\r\ncfg->divs.p_divisor = pdiv;\r\ncfg->divs.h_divisor = hdiv;\r\nreturn 0;\r\n}\r\nstatic int s3c2410_cpufreq_add(struct device *dev,\r\nstruct subsys_interface *sif)\r\n{\r\nreturn s3c_cpufreq_register(&s3c2410_cpufreq_info);\r\n}\r\nstatic int __init s3c2410_cpufreq_init(void)\r\n{\r\nreturn subsys_interface_register(&s3c2410_cpufreq_interface);\r\n}\r\nstatic int s3c2410a_cpufreq_add(struct device *dev,\r\nstruct subsys_interface *sif)\r\n{\r\ns3c2410_cpufreq_info.max.fclk = 266000000;\r\ns3c2410_cpufreq_info.max.hclk = 133000000;\r\ns3c2410_cpufreq_info.max.pclk = 66500000;\r\ns3c2410_cpufreq_info.name = "s3c2410a";\r\nreturn s3c2410_cpufreq_add(dev, sif);\r\n}\r\nstatic int __init s3c2410a_cpufreq_init(void)\r\n{\r\nreturn subsys_interface_register(&s3c2410a_cpufreq_interface);\r\n}
