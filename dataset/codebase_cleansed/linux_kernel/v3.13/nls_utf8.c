static int uni2char(wchar_t uni, unsigned char *out, int boundlen)\r\n{\r\nint n;\r\nif (boundlen <= 0)\r\nreturn -ENAMETOOLONG;\r\nn = utf32_to_utf8(uni, out, boundlen);\r\nif (n < 0) {\r\n*out = '?';\r\nreturn -EINVAL;\r\n}\r\nreturn n;\r\n}\r\nstatic int char2uni(const unsigned char *rawstring, int boundlen, wchar_t *uni)\r\n{\r\nint n;\r\nunicode_t u;\r\nn = utf8_to_utf32(rawstring, boundlen, &u);\r\nif (n < 0 || u > MAX_WCHAR_T) {\r\n*uni = 0x003f;\r\nreturn -EINVAL;\r\n}\r\n*uni = (wchar_t) u;\r\nreturn n;\r\n}\r\nstatic int __init init_nls_utf8(void)\r\n{\r\nint i;\r\nfor (i=0; i<256; i++)\r\nidentity[i] = i;\r\nreturn register_nls(&table);\r\n}\r\nstatic void __exit exit_nls_utf8(void)\r\n{\r\nunregister_nls(&table);\r\n}
