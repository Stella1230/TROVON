static int ufshcd_pltfrm_suspend(struct device *dev)\r\n{\r\nstruct platform_device *pdev = to_platform_device(dev);\r\nstruct ufs_hba *hba = platform_get_drvdata(pdev);\r\ndisable_irq(hba->irq);\r\nreturn 0;\r\n}\r\nstatic int ufshcd_pltfrm_resume(struct device *dev)\r\n{\r\nstruct platform_device *pdev = to_platform_device(dev);\r\nstruct ufs_hba *hba = platform_get_drvdata(pdev);\r\nenable_irq(hba->irq);\r\nreturn 0;\r\n}\r\nstatic int ufshcd_pltfrm_runtime_suspend(struct device *dev)\r\n{\r\nstruct ufs_hba *hba = dev_get_drvdata(dev);\r\nif (!hba)\r\nreturn 0;\r\nreturn ufshcd_runtime_suspend(hba);\r\n}\r\nstatic int ufshcd_pltfrm_runtime_resume(struct device *dev)\r\n{\r\nstruct ufs_hba *hba = dev_get_drvdata(dev);\r\nif (!hba)\r\nreturn 0;\r\nreturn ufshcd_runtime_resume(hba);\r\n}\r\nstatic int ufshcd_pltfrm_runtime_idle(struct device *dev)\r\n{\r\nstruct ufs_hba *hba = dev_get_drvdata(dev);\r\nif (!hba)\r\nreturn 0;\r\nreturn ufshcd_runtime_idle(hba);\r\n}\r\nstatic int ufshcd_pltfrm_probe(struct platform_device *pdev)\r\n{\r\nstruct ufs_hba *hba;\r\nvoid __iomem *mmio_base;\r\nstruct resource *mem_res;\r\nint irq, err;\r\nstruct device *dev = &pdev->dev;\r\nmem_res = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nmmio_base = devm_ioremap_resource(dev, mem_res);\r\nif (IS_ERR(mmio_base)) {\r\nerr = PTR_ERR(mmio_base);\r\ngoto out;\r\n}\r\nirq = platform_get_irq(pdev, 0);\r\nif (irq < 0) {\r\ndev_err(dev, "IRQ resource not available\n");\r\nerr = -ENODEV;\r\ngoto out;\r\n}\r\npm_runtime_set_active(&pdev->dev);\r\npm_runtime_enable(&pdev->dev);\r\nerr = ufshcd_init(dev, &hba, mmio_base, irq);\r\nif (err) {\r\ndev_err(dev, "Intialization failed\n");\r\ngoto out_disable_rpm;\r\n}\r\nplatform_set_drvdata(pdev, hba);\r\nreturn 0;\r\nout_disable_rpm:\r\npm_runtime_disable(&pdev->dev);\r\npm_runtime_set_suspended(&pdev->dev);\r\nout:\r\nreturn err;\r\n}\r\nstatic int ufshcd_pltfrm_remove(struct platform_device *pdev)\r\n{\r\nstruct ufs_hba *hba = platform_get_drvdata(pdev);\r\npm_runtime_get_sync(&(pdev)->dev);\r\nufshcd_remove(hba);\r\nreturn 0;\r\n}
