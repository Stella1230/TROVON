static int go7007_loader_probe(struct usb_interface *interface,\r\nconst struct usb_device_id *id)\r\n{\r\nstruct usb_device *usbdev;\r\nconst struct firmware *fw;\r\nu16 vendor, product;\r\nconst char *fw1, *fw2;\r\nint ret;\r\nint i;\r\nusbdev = usb_get_dev(interface_to_usbdev(interface));\r\nif (!usbdev)\r\ngoto failed2;\r\nif (usbdev->descriptor.bNumConfigurations != 1) {\r\ndev_err(&interface->dev, "can't handle multiple config\n");\r\nreturn -ENODEV;\r\n}\r\nvendor = le16_to_cpu(usbdev->descriptor.idVendor);\r\nproduct = le16_to_cpu(usbdev->descriptor.idProduct);\r\nfor (i = 0; fw_configs[i].fw_name1; i++)\r\nif (fw_configs[i].vendor == vendor &&\r\nfw_configs[i].product == product)\r\nbreak;\r\nif (fw_configs[i].fw_name1 == NULL)\r\ngoto failed2;\r\nfw1 = fw_configs[i].fw_name1;\r\nfw2 = fw_configs[i].fw_name2;\r\ndev_info(&interface->dev, "loading firmware %s\n", fw1);\r\nif (request_firmware(&fw, fw1, &usbdev->dev)) {\r\ndev_err(&interface->dev,\r\n"unable to load firmware from file \"%s\"\n", fw1);\r\ngoto failed2;\r\n}\r\nret = cypress_load_firmware(usbdev, fw, CYPRESS_FX2);\r\nrelease_firmware(fw);\r\nif (0 != ret) {\r\ndev_err(&interface->dev, "loader download failed\n");\r\ngoto failed2;\r\n}\r\nif (fw2 == NULL)\r\nreturn 0;\r\nif (request_firmware(&fw, fw2, &usbdev->dev)) {\r\ndev_err(&interface->dev,\r\n"unable to load firmware from file \"%s\"\n", fw2);\r\ngoto failed2;\r\n}\r\nret = cypress_load_firmware(usbdev, fw, CYPRESS_FX2);\r\nrelease_firmware(fw);\r\nif (0 != ret) {\r\ndev_err(&interface->dev, "firmware download failed\n");\r\ngoto failed2;\r\n}\r\nreturn 0;\r\nfailed2:\r\ndev_err(&interface->dev, "probe failed\n");\r\nreturn -ENODEV;\r\n}\r\nstatic void go7007_loader_disconnect(struct usb_interface *interface)\r\n{\r\ndev_info(&interface->dev, "disconnect\n");\r\nusb_set_intfdata(interface, NULL);\r\n}
