void __init generate_cplb_tables_cpu(unsigned int cpu)\r\n{\r\nint i_d, i_i;\r\nunsigned long addr;\r\nunsigned long cplb_pageflags, cplb_pagesize;\r\nstruct cplb_entry *d_tbl = dcplb_tbl[cpu];\r\nstruct cplb_entry *i_tbl = icplb_tbl[cpu];\r\nprintk(KERN_INFO "NOMPU: setting up cplb tables\n");\r\ni_d = i_i = 0;\r\n#ifdef CONFIG_DEBUG_HUNT_FOR_ZERO\r\nd_tbl[i_d].addr = 0;\r\nd_tbl[i_d++].data = SDRAM_OOPS | PAGE_SIZE_1KB;\r\ni_tbl[i_i].addr = 0;\r\ni_tbl[i_i++].data = SDRAM_OOPS | PAGE_SIZE_1KB;\r\n#endif\r\naddr = 0;\r\n#ifdef PAGE_SIZE_16MB\r\ncplb_pageflags = PAGE_SIZE_16MB;\r\ncplb_pagesize = SIZE_16M;\r\n#else\r\ncplb_pageflags = PAGE_SIZE_4MB;\r\ncplb_pagesize = SIZE_4M;\r\n#endif\r\nfor (; addr < memory_start; addr += cplb_pagesize) {\r\nd_tbl[i_d].addr = addr;\r\nd_tbl[i_d++].data = SDRAM_DGENERIC | cplb_pageflags;\r\ni_tbl[i_i].addr = addr;\r\ni_tbl[i_i++].data = SDRAM_IGENERIC | cplb_pageflags;\r\n}\r\n#ifdef CONFIG_ROMKERNEL\r\n#ifdef CONFIG_BF60x\r\naddr = CONFIG_ROM_BASE & ~(16 * 1024 * 1024 - 1);\r\nd_tbl[i_d].addr = addr;\r\nd_tbl[i_d++].data = SDRAM_DGENERIC | PAGE_SIZE_16MB;\r\ni_tbl[i_i].addr = addr;\r\ni_tbl[i_i++].data = SDRAM_IGENERIC | PAGE_SIZE_16MB;\r\n#else\r\naddr = CONFIG_ROM_BASE & ~(4 * 1024 * 1024 - 1);\r\nd_tbl[i_d].addr = addr;\r\nd_tbl[i_d++].data = SDRAM_DGENERIC | PAGE_SIZE_4MB;\r\ni_tbl[i_i].addr = addr;\r\ni_tbl[i_i++].data = SDRAM_IGENERIC | PAGE_SIZE_4MB;\r\n#endif\r\n#endif\r\nif (cpu == 0) {\r\nif (L1_DATA_A_LENGTH || L1_DATA_B_LENGTH) {\r\nd_tbl[i_d].addr = L1_DATA_A_START;\r\nd_tbl[i_d++].data = L1_DMEMORY | PAGE_SIZE_4MB;\r\n}\r\ni_tbl[i_i].addr = L1_CODE_START;\r\ni_tbl[i_i++].data = L1_IMEMORY | PAGE_SIZE_4MB;\r\n}\r\n#ifdef CONFIG_SMP\r\nelse {\r\nif (L1_DATA_A_LENGTH || L1_DATA_B_LENGTH) {\r\nd_tbl[i_d].addr = COREB_L1_DATA_A_START;\r\nd_tbl[i_d++].data = L1_DMEMORY | PAGE_SIZE_4MB;\r\n}\r\ni_tbl[i_i].addr = COREB_L1_CODE_START;\r\ni_tbl[i_i++].data = L1_IMEMORY | PAGE_SIZE_4MB;\r\n}\r\n#endif\r\nfirst_switched_dcplb = i_d;\r\nfirst_switched_icplb = i_i;\r\nBUG_ON(first_switched_dcplb > MAX_CPLBS);\r\nBUG_ON(first_switched_icplb > MAX_CPLBS);\r\nwhile (i_d < MAX_CPLBS)\r\nd_tbl[i_d++].data = 0;\r\nwhile (i_i < MAX_CPLBS)\r\ni_tbl[i_i++].data = 0;\r\n}\r\nvoid __init generate_cplb_tables_all(void)\r\n{\r\nunsigned long uncached_end;\r\nint i_d, i_i;\r\ni_d = 0;\r\n#ifdef CONFIG_MTD_UCLINUX\r\nuncached_end = memory_mtd_start + mtd_size;\r\n#else\r\nuncached_end = memory_end;\r\n#endif\r\nif ((DMA_UNCACHED_REGION >= 1 * 1024 * 1024) || !DMA_UNCACHED_REGION ||\r\n((_ramend - uncached_end) >= 1 * 1024 * 1024))\r\ndcplb_bounds[i_d].eaddr = uncached_end;\r\nelse\r\ndcplb_bounds[i_d].eaddr = uncached_end & ~(1 * 1024 * 1024 - 1);\r\ndcplb_bounds[i_d++].data = SDRAM_DGENERIC;\r\nif (DMA_UNCACHED_REGION) {\r\ndcplb_bounds[i_d].eaddr = _ramend;\r\ndcplb_bounds[i_d++].data = SDRAM_DNON_CHBL;\r\n}\r\nif (_ramend != physical_mem_end) {\r\ndcplb_bounds[i_d].eaddr = physical_mem_end;\r\ndcplb_bounds[i_d++].data = (reserved_mem_dcache_on ?\r\nSDRAM_DGENERIC : SDRAM_DNON_CHBL);\r\n}\r\ndcplb_bounds[i_d].eaddr = ASYNC_BANK0_BASE;\r\ndcplb_bounds[i_d++].data = 0;\r\ndcplb_bounds[i_d].eaddr = ASYNC_BANK3_BASE + ASYNC_BANK3_SIZE;\r\ndcplb_bounds[i_d++].data = SDRAM_EBIU;\r\ndcplb_bounds[i_d].eaddr = BOOT_ROM_START;\r\ndcplb_bounds[i_d++].data = 0;\r\ndcplb_bounds[i_d].eaddr = BOOT_ROM_START + BOOT_ROM_LENGTH;\r\ndcplb_bounds[i_d++].data = SDRAM_DGENERIC;\r\nif (L2_LENGTH) {\r\ndcplb_bounds[i_d].eaddr = L2_START;\r\ndcplb_bounds[i_d++].data = 0;\r\ndcplb_bounds[i_d].eaddr = L2_START + L2_LENGTH;\r\ndcplb_bounds[i_d++].data = L2_DMEMORY;\r\n}\r\ndcplb_nr_bounds = i_d;\r\nBUG_ON(dcplb_nr_bounds > ARRAY_SIZE(dcplb_bounds));\r\ni_i = 0;\r\nicplb_bounds[i_i].eaddr = uncached_end;\r\nicplb_bounds[i_i++].data = SDRAM_IGENERIC;\r\nif (_ramend != physical_mem_end) {\r\nif (DMA_UNCACHED_REGION) {\r\nicplb_bounds[i_i].eaddr = _ramend;\r\nicplb_bounds[i_i++].data = 0;\r\n}\r\nicplb_bounds[i_i].eaddr = physical_mem_end;\r\nicplb_bounds[i_i++].data = (reserved_mem_icache_on ?\r\nSDRAM_IGENERIC : SDRAM_INON_CHBL);\r\n}\r\nicplb_bounds[i_i].eaddr = ASYNC_BANK0_BASE;\r\nicplb_bounds[i_i++].data = 0;\r\nicplb_bounds[i_i].eaddr = ASYNC_BANK3_BASE + ASYNC_BANK3_SIZE;\r\nicplb_bounds[i_i++].data = SDRAM_EBIU;\r\nicplb_bounds[i_i].eaddr = BOOT_ROM_START;\r\nicplb_bounds[i_i++].data = 0;\r\nicplb_bounds[i_i].eaddr = BOOT_ROM_START + BOOT_ROM_LENGTH;\r\nicplb_bounds[i_i++].data = SDRAM_IGENERIC;\r\nif (L2_LENGTH) {\r\nicplb_bounds[i_i].eaddr = L2_START;\r\nicplb_bounds[i_i++].data = 0;\r\nicplb_bounds[i_i].eaddr = L2_START + L2_LENGTH;\r\nicplb_bounds[i_i++].data = L2_IMEMORY;\r\n}\r\nicplb_nr_bounds = i_i;\r\nBUG_ON(icplb_nr_bounds > ARRAY_SIZE(icplb_bounds));\r\n}
