static int __init vr41xx_siu_add(void)\r\n{\r\nstruct platform_device *pdev;\r\nstruct resource *res;\r\nunsigned int num;\r\nint retval;\r\npdev = platform_device_alloc("SIU", -1);\r\nif (!pdev)\r\nreturn -ENOMEM;\r\nswitch (current_cpu_type()) {\r\ncase CPU_VR4111:\r\ncase CPU_VR4121:\r\npdev->dev.platform_data = siu_type1_ports;\r\nres = siu_type1_resource;\r\nnum = ARRAY_SIZE(siu_type1_resource);\r\nbreak;\r\ncase CPU_VR4122:\r\ncase CPU_VR4131:\r\ncase CPU_VR4133:\r\npdev->dev.platform_data = siu_type2_ports;\r\nres = siu_type2_resource;\r\nnum = ARRAY_SIZE(siu_type2_resource);\r\nbreak;\r\ndefault:\r\nretval = -ENODEV;\r\ngoto err_free_device;\r\n}\r\nretval = platform_device_add_resources(pdev, res, num);\r\nif (retval)\r\ngoto err_free_device;\r\nretval = platform_device_add(pdev);\r\nif (retval)\r\ngoto err_free_device;\r\nreturn 0;\r\nerr_free_device:\r\nplatform_device_put(pdev);\r\nreturn retval;\r\n}\r\nvoid __init vr41xx_siu_setup(void)\r\n{\r\nstruct uart_port port;\r\nstruct resource *res;\r\nunsigned int *type;\r\nint i;\r\nswitch (current_cpu_type()) {\r\ncase CPU_VR4111:\r\ncase CPU_VR4121:\r\ntype = siu_type1_ports;\r\nres = siu_type1_resource;\r\nbreak;\r\ncase CPU_VR4122:\r\ncase CPU_VR4131:\r\ncase CPU_VR4133:\r\ntype = siu_type2_ports;\r\nres = siu_type2_resource;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nfor (i = 0; i < SIU_PORTS_MAX; i++) {\r\nport.line = i;\r\nport.type = type[i];\r\nif (port.type == PORT_UNKNOWN)\r\nbreak;\r\nport.mapbase = res[i].start;\r\nport.membase = (unsigned char __iomem *)KSEG1ADDR(res[i].start);\r\nvr41xx_siu_early_setup(&port);\r\n}\r\n}
