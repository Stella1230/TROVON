static struct dma_chan *shdma_of_xlate(struct of_phandle_args *dma_spec,\r\nstruct of_dma *ofdma)\r\n{\r\nu32 id = dma_spec->args[0];\r\ndma_cap_mask_t mask;\r\nstruct dma_chan *chan;\r\nif (dma_spec->args_count != 1)\r\nreturn NULL;\r\ndma_cap_zero(mask);\r\ndma_cap_set(DMA_SLAVE, mask);\r\nchan = dma_request_channel(mask, shdma_chan_filter, (void *)id);\r\nif (chan)\r\nto_shdma_chan(chan)->hw_req = id;\r\nreturn chan;\r\n}\r\nstatic int shdma_of_probe(struct platform_device *pdev)\r\n{\r\nconst struct of_dev_auxdata *lookup = dev_get_platdata(&pdev->dev);\r\nint ret;\r\nret = of_dma_controller_register(pdev->dev.of_node,\r\nshdma_of_xlate, pdev);\r\nif (ret < 0)\r\nreturn ret;\r\nret = of_platform_populate(pdev->dev.of_node, NULL, lookup, &pdev->dev);\r\nif (ret < 0)\r\nof_dma_controller_free(pdev->dev.of_node);\r\nreturn ret;\r\n}
