void __iomem *iorpc_ioremap(int hv_fd, resource_size_t offset,\r\nunsigned long size)\r\n{\r\npgprot_t mmio_base, prot = { 0 };\r\nunsigned long pfn;\r\nint err;\r\nerr = __iorpc_get_mmio_base(hv_fd, &mmio_base);\r\nif (err) {\r\nTRACE("get_mmio_base() failure: %d\n", err);\r\nreturn NULL;\r\n}\r\nerr = __iorpc_check_mmio_offset(hv_fd, offset, size);\r\nif (err) {\r\nTRACE("check_mmio_offset() failure: %d\n", err);\r\nreturn NULL;\r\n}\r\nprot = hv_pte_set_lotar(prot, hv_pte_get_lotar(mmio_base));\r\npfn = pte_pfn(mmio_base) + PFN_DOWN(offset);\r\nreturn ioremap_prot(PFN_PHYS(pfn), size, prot);\r\n}
