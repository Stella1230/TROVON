int armada_xp_boot_cpu(unsigned int cpu_id, void *boot_addr)\r\n{\r\nint reg, hw_cpu;\r\nif (!pmsu_mp_base || !pmsu_reset_base) {\r\npr_warn("Can't boot CPU. PMSU is uninitialized\n");\r\nreturn 1;\r\n}\r\nhw_cpu = cpu_logical_map(cpu_id);\r\nwritel(virt_to_phys(boot_addr), pmsu_mp_base +\r\nPMSU_BOOT_ADDR_REDIRECT_OFFSET(hw_cpu));\r\nreg = readl(pmsu_reset_base + PMSU_RESET_CTL_OFFSET(hw_cpu));\r\nreg &= (~0x1);\r\nwritel(reg, pmsu_reset_base + PMSU_RESET_CTL_OFFSET(hw_cpu));\r\nreturn 0;\r\n}\r\nint __init armada_370_xp_pmsu_init(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_matching_node(NULL, of_pmsu_table);\r\nif (np) {\r\npr_info("Initializing Power Management Service Unit\n");\r\npmsu_mp_base = of_iomap(np, 0);\r\npmsu_reset_base = of_iomap(np, 1);\r\nof_node_put(np);\r\n}\r\nreturn 0;\r\n}
