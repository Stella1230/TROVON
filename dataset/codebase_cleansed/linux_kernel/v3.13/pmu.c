u16 si_pmu_fast_pwrup_delay(struct si_pub *sih)\r\n{\r\nuint delay = PMU_MAX_TRANSITION_DLY;\r\nswitch (ai_get_chip_id(sih)) {\r\ncase BCMA_CHIP_ID_BCM43224:\r\ncase BCMA_CHIP_ID_BCM43225:\r\ncase BCMA_CHIP_ID_BCM4313:\r\ndelay = 3700;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn (u16) delay;\r\n}\r\nu32 si_pmu_measure_alpclk(struct si_pub *sih)\r\n{\r\nstruct si_info *sii = container_of(sih, struct si_info, pub);\r\nstruct bcma_device *core;\r\nu32 alp_khz;\r\nif (ai_get_pmurev(sih) < 10)\r\nreturn 0;\r\ncore = sii->icbus->drv_cc.core;\r\nif (bcma_read32(core, CHIPCREGOFFS(pmustatus)) & PST_EXTLPOAVAIL) {\r\nu32 ilp_ctr, alp_hz;\r\nbcma_write32(core, CHIPCREGOFFS(pmu_xtalfreq),\r\n1U << PMU_XTALFREQ_REG_MEASURE_SHIFT);\r\nudelay(1000);\r\nilp_ctr = bcma_read32(core, CHIPCREGOFFS(pmu_xtalfreq)) &\r\nPMU_XTALFREQ_REG_ILPCTR_MASK;\r\nbcma_write32(core, CHIPCREGOFFS(pmu_xtalfreq), 0);\r\nalp_hz = (ilp_ctr * EXT_ILP_HZ) / 4;\r\nalp_khz = (alp_hz + 50000) / 100000 * 100;\r\n} else\r\nalp_khz = 0;\r\nreturn alp_khz;\r\n}
