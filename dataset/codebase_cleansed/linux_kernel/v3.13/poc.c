static int readback_insn(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nstruct poc_private *devpriv = dev->private;\r\nint chan;\r\nchan = CR_CHAN(insn->chanspec);\r\ndata[0] = devpriv->ao_readback[chan];\r\nreturn 1;\r\n}\r\nstatic int dac02_ao_winsn(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nstruct poc_private *devpriv = dev->private;\r\nint temp;\r\nint chan;\r\nint output;\r\nchan = CR_CHAN(insn->chanspec);\r\ndevpriv->ao_readback[chan] = data[0];\r\noutput = data[0];\r\n#ifdef wrong\r\nif ((CR_RANGE(insn->chanspec) & 0x2) == 0)\r\noutput = ~output;\r\n#endif\r\ntemp = (output << 4) & 0xf0;\r\noutb(temp, dev->iobase + DAC02_LSB(chan));\r\ntemp = (output >> 4) & 0xff;\r\noutb(temp, dev->iobase + DAC02_MSB(chan));\r\nreturn 1;\r\n}\r\nstatic int poc_attach(struct comedi_device *dev, struct comedi_devconfig *it)\r\n{\r\nconst struct boarddef_struct *board = comedi_board(dev);\r\nstruct poc_private *devpriv;\r\nstruct comedi_subdevice *s;\r\nint ret;\r\nret = comedi_request_region(dev, it->options[0], board->iosize);\r\nif (ret)\r\nreturn ret;\r\nret = comedi_alloc_subdevices(dev, 1);\r\nif (ret)\r\nreturn ret;\r\ndevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\r\nif (!devpriv)\r\nreturn -ENOMEM;\r\ns = &dev->subdevices[0];\r\ns->type = board->type;\r\ns->n_chan = board->n_chan;\r\ns->maxdata = (1 << board->n_bits) - 1;\r\ns->range_table = board->range;\r\ns->insn_write = board->winsn;\r\ns->insn_read = board->rinsn;\r\ns->insn_bits = board->insnbits;\r\nif (s->type == COMEDI_SUBD_AO || s->type == COMEDI_SUBD_DO)\r\ns->subdev_flags = SDF_WRITABLE;\r\nreturn 0;\r\n}
