notrace void arch_local_irq_disable(void)\r\n{\r\npreempt_disable();\r\n__asm__ __volatile__(\r\n" .set push \n"\r\n" .set noat \n"\r\n#ifdef CONFIG_MIPS_MT_SMTC\r\n" mfc0 $1, $2, 1 \n"\r\n" ori $1, 0x400 \n"\r\n" .set noreorder \n"\r\n" mtc0 $1, $2, 1 \n"\r\n#elif defined(CONFIG_CPU_MIPSR2)\r\n#else\r\n" mfc0 $1,$12 \n"\r\n" ori $1,0x1f \n"\r\n" xori $1,0x1f \n"\r\n" .set noreorder \n"\r\n" mtc0 $1,$12 \n"\r\n#endif\r\n" " __stringify(__irq_disable_hazard) " \n"\r\n" .set pop \n"\r\n:\r\n:\r\n: "memory");\r\npreempt_enable();\r\n}\r\nnotrace unsigned long arch_local_irq_save(void)\r\n{\r\nunsigned long flags;\r\npreempt_disable();\r\n__asm__ __volatile__(\r\n" .set push \n"\r\n" .set reorder \n"\r\n" .set noat \n"\r\n#ifdef CONFIG_MIPS_MT_SMTC\r\n" mfc0 %[flags], $2, 1 \n"\r\n" ori $1, %[flags], 0x400 \n"\r\n" .set noreorder \n"\r\n" mtc0 $1, $2, 1 \n"\r\n" andi %[flags], %[flags], 0x400 \n"\r\n#elif defined(CONFIG_CPU_MIPSR2)\r\n#else\r\n" mfc0 %[flags], $12 \n"\r\n" ori $1, %[flags], 0x1f \n"\r\n" xori $1, 0x1f \n"\r\n" .set noreorder \n"\r\n" mtc0 $1, $12 \n"\r\n#endif\r\n" " __stringify(__irq_disable_hazard) " \n"\r\n" .set pop \n"\r\n: [flags] "=r" (flags)\r\n:\r\n: "memory");\r\npreempt_enable();\r\nreturn flags;\r\n}\r\nnotrace void arch_local_irq_restore(unsigned long flags)\r\n{\r\nunsigned long __tmp1;\r\n#ifdef CONFIG_MIPS_MT_SMTC\r\nif (unlikely(!(flags & 0x0400)))\r\nsmtc_ipi_replay();\r\n#endif\r\npreempt_disable();\r\n__asm__ __volatile__(\r\n" .set push \n"\r\n" .set noreorder \n"\r\n" .set noat \n"\r\n#ifdef CONFIG_MIPS_MT_SMTC\r\n" mfc0 $1, $2, 1 \n"\r\n" andi %[flags], 0x400 \n"\r\n" ori $1, 0x400 \n"\r\n" xori $1, 0x400 \n"\r\n" or %[flags], $1 \n"\r\n" mtc0 %[flags], $2, 1 \n"\r\n#elif defined(CONFIG_CPU_MIPSR2) && defined(CONFIG_IRQ_CPU)\r\n#elif defined(CONFIG_CPU_MIPSR2)\r\n#else\r\n" mfc0 $1, $12 \n"\r\n" andi %[flags], 1 \n"\r\n" ori $1, 0x1f \n"\r\n" xori $1, 0x1f \n"\r\n" or %[flags], $1 \n"\r\n" mtc0 %[flags], $12 \n"\r\n#endif\r\n" " __stringify(__irq_disable_hazard) " \n"\r\n" .set pop \n"\r\n: [flags] "=r" (__tmp1)\r\n: "0" (flags)\r\n: "memory");\r\npreempt_enable();\r\n}\r\nnotrace void __arch_local_irq_restore(unsigned long flags)\r\n{\r\nunsigned long __tmp1;\r\npreempt_disable();\r\n__asm__ __volatile__(\r\n" .set push \n"\r\n" .set noreorder \n"\r\n" .set noat \n"\r\n#ifdef CONFIG_MIPS_MT_SMTC\r\n" mfc0 $1, $2, 1 \n"\r\n" andi %[flags], 0x400 \n"\r\n" ori $1, 0x400 \n"\r\n" xori $1, 0x400 \n"\r\n" or %[flags], $1 \n"\r\n" mtc0 %[flags], $2, 1 \n"\r\n#elif defined(CONFIG_CPU_MIPSR2) && defined(CONFIG_IRQ_CPU)\r\n#elif defined(CONFIG_CPU_MIPSR2)\r\n#else\r\n" mfc0 $1, $12 \n"\r\n" andi %[flags], 1 \n"\r\n" ori $1, 0x1f \n"\r\n" xori $1, 0x1f \n"\r\n" or %[flags], $1 \n"\r\n" mtc0 %[flags], $12 \n"\r\n#endif\r\n" " __stringify(__irq_disable_hazard) " \n"\r\n" .set pop \n"\r\n: [flags] "=r" (__tmp1)\r\n: "0" (flags)\r\n: "memory");\r\npreempt_enable();\r\n}
