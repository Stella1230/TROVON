static void __init iq80321_timer_init(void)\r\n{\r\niop_init_time(200000000);\r\n}\r\nvoid __init iq80321_map_io(void)\r\n{\r\niop3xx_map_io();\r\niotable_init(iq80321_io_desc, ARRAY_SIZE(iq80321_io_desc));\r\n}\r\nstatic int __init\r\niq80321_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nint irq;\r\nif ((slot == 2 || slot == 6) && pin == 1) {\r\nirq = IRQ_IOP32X_XINT2;\r\n} else if ((slot == 2 || slot == 6) && pin == 2) {\r\nirq = IRQ_IOP32X_XINT3;\r\n} else if ((slot == 2 || slot == 6) && pin == 3) {\r\nirq = IRQ_IOP32X_XINT0;\r\n} else if ((slot == 2 || slot == 6) && pin == 4) {\r\nirq = IRQ_IOP32X_XINT1;\r\n} else if (slot == 4 || slot == 8) {\r\nirq = IRQ_IOP32X_XINT0;\r\n} else {\r\nprintk(KERN_ERR "iq80321_pci_map_irq() called for unknown "\r\n"device PCI:%d:%d:%d\n", dev->bus->number,\r\nPCI_SLOT(dev->devfn), PCI_FUNC(dev->devfn));\r\nirq = -1;\r\n}\r\nreturn irq;\r\n}\r\nstatic int __init iq80321_pci_init(void)\r\n{\r\nif ((iop3xx_get_init_atu() == IOP3XX_INIT_ATU_ENABLE) &&\r\nmachine_is_iq80321())\r\npci_common_init(&iq80321_pci);\r\nreturn 0;\r\n}\r\nstatic void __init iq80321_init_machine(void)\r\n{\r\nregister_iop32x_gpio();\r\nplatform_device_register(&iop3xx_i2c0_device);\r\nplatform_device_register(&iop3xx_i2c1_device);\r\nplatform_device_register(&iq80321_flash_device);\r\nplatform_device_register(&iq80321_serial_device);\r\nplatform_device_register(&iop3xx_dma_0_channel);\r\nplatform_device_register(&iop3xx_dma_1_channel);\r\nplatform_device_register(&iop3xx_aau_channel);\r\n}
