static void nft_inet_hook_ops_init(struct nf_hook_ops *ops, unsigned int n)\r\n{\r\nstruct nft_af_info *afi;\r\nif (n == 1)\r\nafi = &nft_af_ipv4;\r\nelse\r\nafi = &nft_af_ipv6;\r\nops->pf = afi->family;\r\nif (afi->hooks[ops->hooknum])\r\nops->hook = afi->hooks[ops->hooknum];\r\n}\r\nstatic int __net_init nf_tables_inet_init_net(struct net *net)\r\n{\r\nnet->nft.inet = kmalloc(sizeof(struct nft_af_info), GFP_KERNEL);\r\nif (net->nft.inet == NULL)\r\nreturn -ENOMEM;\r\nmemcpy(net->nft.inet, &nft_af_inet, sizeof(nft_af_inet));\r\nif (nft_register_afinfo(net, net->nft.inet) < 0)\r\ngoto err;\r\nreturn 0;\r\nerr:\r\nkfree(net->nft.inet);\r\nreturn -ENOMEM;\r\n}\r\nstatic void __net_exit nf_tables_inet_exit_net(struct net *net)\r\n{\r\nnft_unregister_afinfo(net->nft.inet);\r\nkfree(net->nft.inet);\r\n}\r\nstatic int __init nf_tables_inet_init(void)\r\n{\r\nint ret;\r\nnft_register_chain_type(&filter_inet);\r\nret = register_pernet_subsys(&nf_tables_inet_net_ops);\r\nif (ret < 0)\r\nnft_unregister_chain_type(&filter_inet);\r\nreturn ret;\r\n}\r\nstatic void __exit nf_tables_inet_exit(void)\r\n{\r\nunregister_pernet_subsys(&nf_tables_inet_net_ops);\r\nnft_unregister_chain_type(&filter_inet);\r\n}
