void *acpi_os_allocate_zeroed(acpi_size size)\r\n{\r\nvoid *allocation;\r\nACPI_FUNCTION_ENTRY();\r\nallocation = acpi_os_allocate(size);\r\nif (allocation) {\r\nACPI_MEMSET(allocation, 0, size);\r\n}\r\nreturn (allocation);\r\n}\r\nacpi_status acpi_ut_create_caches(void)\r\n{\r\nacpi_status status;\r\nstatus =\r\nacpi_os_create_cache("Acpi-Namespace",\r\nsizeof(struct acpi_namespace_node),\r\nACPI_MAX_NAMESPACE_CACHE_DEPTH,\r\n&acpi_gbl_namespace_cache);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus =\r\nacpi_os_create_cache("Acpi-State", sizeof(union acpi_generic_state),\r\nACPI_MAX_STATE_CACHE_DEPTH,\r\n&acpi_gbl_state_cache);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus =\r\nacpi_os_create_cache("Acpi-Parse",\r\nsizeof(struct acpi_parse_obj_common),\r\nACPI_MAX_PARSE_CACHE_DEPTH,\r\n&acpi_gbl_ps_node_cache);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus =\r\nacpi_os_create_cache("Acpi-ParseExt",\r\nsizeof(struct acpi_parse_obj_named),\r\nACPI_MAX_EXTPARSE_CACHE_DEPTH,\r\n&acpi_gbl_ps_node_ext_cache);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus =\r\nacpi_os_create_cache("Acpi-Operand",\r\nsizeof(union acpi_operand_object),\r\nACPI_MAX_OBJECT_CACHE_DEPTH,\r\n&acpi_gbl_operand_cache);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nstatus = acpi_ut_create_list("Acpi-Global", 0, &acpi_gbl_global_list);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus =\r\nacpi_ut_create_list("Acpi-Namespace",\r\nsizeof(struct acpi_namespace_node),\r\n&acpi_gbl_ns_node_list);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n#endif\r\nreturn (AE_OK);\r\n}\r\nacpi_status acpi_ut_delete_caches(void)\r\n{\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nchar buffer[7];\r\nif (acpi_gbl_display_final_mem_stats) {\r\nACPI_STRCPY(buffer, "MEMORY");\r\n(void)acpi_db_display_statistics(buffer);\r\n}\r\n#endif\r\n(void)acpi_os_delete_cache(acpi_gbl_namespace_cache);\r\nacpi_gbl_namespace_cache = NULL;\r\n(void)acpi_os_delete_cache(acpi_gbl_state_cache);\r\nacpi_gbl_state_cache = NULL;\r\n(void)acpi_os_delete_cache(acpi_gbl_operand_cache);\r\nacpi_gbl_operand_cache = NULL;\r\n(void)acpi_os_delete_cache(acpi_gbl_ps_node_cache);\r\nacpi_gbl_ps_node_cache = NULL;\r\n(void)acpi_os_delete_cache(acpi_gbl_ps_node_ext_cache);\r\nacpi_gbl_ps_node_ext_cache = NULL;\r\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\r\nacpi_ut_dump_allocations(ACPI_UINT32_MAX, NULL);\r\nacpi_os_free(acpi_gbl_global_list);\r\nacpi_gbl_global_list = NULL;\r\nacpi_os_free(acpi_gbl_ns_node_list);\r\nacpi_gbl_ns_node_list = NULL;\r\n#endif\r\nreturn (AE_OK);\r\n}\r\nacpi_status acpi_ut_validate_buffer(struct acpi_buffer * buffer)\r\n{\r\nif (!buffer) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nif ((buffer->length == ACPI_NO_BUFFER) ||\r\n(buffer->length == ACPI_ALLOCATE_BUFFER) ||\r\n(buffer->length == ACPI_ALLOCATE_LOCAL_BUFFER)) {\r\nreturn (AE_OK);\r\n}\r\nif (!buffer->pointer) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ut_initialize_buffer(struct acpi_buffer * buffer,\r\nacpi_size required_length)\r\n{\r\nacpi_size input_buffer_length;\r\nif (!buffer || !required_length) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\ninput_buffer_length = buffer->length;\r\nbuffer->length = required_length;\r\nswitch (input_buffer_length) {\r\ncase ACPI_NO_BUFFER:\r\nreturn (AE_BUFFER_OVERFLOW);\r\ncase ACPI_ALLOCATE_BUFFER:\r\nbuffer->pointer = acpi_os_allocate(required_length);\r\nbreak;\r\ncase ACPI_ALLOCATE_LOCAL_BUFFER:\r\nbuffer->pointer = ACPI_ALLOCATE(required_length);\r\nbreak;\r\ndefault:\r\nif (input_buffer_length < required_length) {\r\nreturn (AE_BUFFER_OVERFLOW);\r\n}\r\nbreak;\r\n}\r\nif (!buffer->pointer) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nACPI_MEMSET(buffer->pointer, 0, required_length);\r\nreturn (AE_OK);\r\n}
