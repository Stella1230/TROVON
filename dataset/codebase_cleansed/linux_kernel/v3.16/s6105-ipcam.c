static int s6105_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nstruct snd_soc_dai *cpu_dai = rtd->cpu_dai;\r\nint ret = 0;\r\nret = snd_soc_dai_set_fmt(codec_dai, SND_SOC_DAIFMT_I2S |\r\nSND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_fmt(cpu_dai, SND_SOC_DAIFMT_CBM_CFM |\r\nSND_SOC_DAIFMT_NB_NF);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(codec_dai, 0, S6105_CAM_CODEC_CLOCK,\r\nSND_SOC_CLOCK_OUT);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int output_type_info(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_ENUMERATED;\r\nuinfo->count = 1;\r\nuinfo->value.enumerated.items = 2;\r\nif (uinfo->value.enumerated.item) {\r\nuinfo->value.enumerated.item = 1;\r\nstrcpy(uinfo->value.enumerated.name, "HPLOUT/HPROUT");\r\n} else {\r\nstrcpy(uinfo->value.enumerated.name, "HPLOUT/HPLCOM");\r\n}\r\nreturn 0;\r\n}\r\nstatic int output_type_get(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nucontrol->value.enumerated.item[0] = kcontrol->private_value;\r\nreturn 0;\r\n}\r\nstatic int output_type_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_soc_card *card = kcontrol->private_data;\r\nstruct snd_soc_dapm_context *dapm = &card->dapm;\r\nunsigned int val = (ucontrol->value.enumerated.item[0] != 0);\r\nchar *differential = "Audio Out Differential";\r\nchar *stereo = "Audio Out Stereo";\r\nif (kcontrol->private_value == val)\r\nreturn 0;\r\nkcontrol->private_value = val;\r\nsnd_soc_dapm_disable_pin(dapm, val ? differential : stereo);\r\nsnd_soc_dapm_sync(dapm);\r\nsnd_soc_dapm_enable_pin(dapm, val ? stereo : differential);\r\nsnd_soc_dapm_sync(dapm);\r\nreturn 1;\r\n}\r\nstatic int s6105_aic3x_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_codec *codec = rtd->codec;\r\nstruct snd_soc_dapm_context *dapm = &codec->dapm;\r\nstruct snd_soc_card *card = rtd->card;\r\nsnd_soc_dapm_nc_pin(dapm, "MONO_LOUT");\r\nsnd_soc_dapm_nc_pin(dapm, "LINE2L");\r\nsnd_soc_dapm_nc_pin(dapm, "LINE2R");\r\nsnd_soc_dapm_nc_pin(dapm, "MIC3L");\r\nsnd_soc_dapm_nc_pin(dapm, "MIC3R");\r\nsnd_soc_dapm_nc_pin(dapm, "LLOUT");\r\nsnd_soc_dapm_nc_pin(dapm, "RLOUT");\r\nsnd_soc_dapm_nc_pin(dapm, "HPRCOM");\r\nsnd_soc_dapm_disable_pin(&card->dapm, "Audio Out Differential");\r\nsnd_ctl_add(card->snd_card, snd_ctl_new1(&audio_out_mux, card));\r\nreturn 0;\r\n}\r\nstatic int __init s6105_init(void)\r\n{\r\nint ret;\r\ni2c_register_board_info(0, i2c_device, ARRAY_SIZE(i2c_device));\r\ns6105_snd_device = platform_device_alloc("soc-audio", -1);\r\nif (!s6105_snd_device)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(s6105_snd_device, &snd_soc_card_s6105);\r\nplatform_device_add_data(s6105_snd_device, &s6105_snd_data,\r\nsizeof(s6105_snd_data));\r\nret = platform_device_add(s6105_snd_device);\r\nif (ret)\r\nplatform_device_put(s6105_snd_device);\r\nreturn ret;\r\n}\r\nstatic void __exit s6105_exit(void)\r\n{\r\nplatform_device_unregister(s6105_snd_device);\r\n}
