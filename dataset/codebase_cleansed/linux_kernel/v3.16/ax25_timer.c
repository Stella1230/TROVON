void ax25_setup_timers(ax25_cb *ax25)\r\n{\r\nsetup_timer(&ax25->timer, ax25_heartbeat_expiry, (unsigned long)ax25);\r\nsetup_timer(&ax25->t1timer, ax25_t1timer_expiry, (unsigned long)ax25);\r\nsetup_timer(&ax25->t2timer, ax25_t2timer_expiry, (unsigned long)ax25);\r\nsetup_timer(&ax25->t3timer, ax25_t3timer_expiry, (unsigned long)ax25);\r\nsetup_timer(&ax25->idletimer, ax25_idletimer_expiry,\r\n(unsigned long)ax25);\r\n}\r\nvoid ax25_start_heartbeat(ax25_cb *ax25)\r\n{\r\nmod_timer(&ax25->timer, jiffies + 5 * HZ);\r\n}\r\nvoid ax25_start_t1timer(ax25_cb *ax25)\r\n{\r\nmod_timer(&ax25->t1timer, jiffies + ax25->t1);\r\n}\r\nvoid ax25_start_t2timer(ax25_cb *ax25)\r\n{\r\nmod_timer(&ax25->t2timer, jiffies + ax25->t2);\r\n}\r\nvoid ax25_start_t3timer(ax25_cb *ax25)\r\n{\r\nif (ax25->t3 > 0)\r\nmod_timer(&ax25->t3timer, jiffies + ax25->t3);\r\nelse\r\ndel_timer(&ax25->t3timer);\r\n}\r\nvoid ax25_start_idletimer(ax25_cb *ax25)\r\n{\r\nif (ax25->idle > 0)\r\nmod_timer(&ax25->idletimer, jiffies + ax25->idle);\r\nelse\r\ndel_timer(&ax25->idletimer);\r\n}\r\nvoid ax25_stop_heartbeat(ax25_cb *ax25)\r\n{\r\ndel_timer(&ax25->timer);\r\n}\r\nvoid ax25_stop_t1timer(ax25_cb *ax25)\r\n{\r\ndel_timer(&ax25->t1timer);\r\n}\r\nvoid ax25_stop_t2timer(ax25_cb *ax25)\r\n{\r\ndel_timer(&ax25->t2timer);\r\n}\r\nvoid ax25_stop_t3timer(ax25_cb *ax25)\r\n{\r\ndel_timer(&ax25->t3timer);\r\n}\r\nvoid ax25_stop_idletimer(ax25_cb *ax25)\r\n{\r\ndel_timer(&ax25->idletimer);\r\n}\r\nint ax25_t1timer_running(ax25_cb *ax25)\r\n{\r\nreturn timer_pending(&ax25->t1timer);\r\n}\r\nunsigned long ax25_display_timer(struct timer_list *timer)\r\n{\r\nif (!timer_pending(timer))\r\nreturn 0;\r\nreturn timer->expires - jiffies;\r\n}\r\nstatic void ax25_heartbeat_expiry(unsigned long param)\r\n{\r\nint proto = AX25_PROTO_STD_SIMPLEX;\r\nax25_cb *ax25 = (ax25_cb *)param;\r\nif (ax25->ax25_dev)\r\nproto = ax25->ax25_dev->values[AX25_VALUES_PROTOCOL];\r\nswitch (proto) {\r\ncase AX25_PROTO_STD_SIMPLEX:\r\ncase AX25_PROTO_STD_DUPLEX:\r\nax25_std_heartbeat_expiry(ax25);\r\nbreak;\r\n#ifdef CONFIG_AX25_DAMA_SLAVE\r\ncase AX25_PROTO_DAMA_SLAVE:\r\nif (ax25->ax25_dev->dama.slave)\r\nax25_ds_heartbeat_expiry(ax25);\r\nelse\r\nax25_std_heartbeat_expiry(ax25);\r\nbreak;\r\n#endif\r\n}\r\n}\r\nstatic void ax25_t1timer_expiry(unsigned long param)\r\n{\r\nax25_cb *ax25 = (ax25_cb *)param;\r\nswitch (ax25->ax25_dev->values[AX25_VALUES_PROTOCOL]) {\r\ncase AX25_PROTO_STD_SIMPLEX:\r\ncase AX25_PROTO_STD_DUPLEX:\r\nax25_std_t1timer_expiry(ax25);\r\nbreak;\r\n#ifdef CONFIG_AX25_DAMA_SLAVE\r\ncase AX25_PROTO_DAMA_SLAVE:\r\nif (!ax25->ax25_dev->dama.slave)\r\nax25_std_t1timer_expiry(ax25);\r\nbreak;\r\n#endif\r\n}\r\n}\r\nstatic void ax25_t2timer_expiry(unsigned long param)\r\n{\r\nax25_cb *ax25 = (ax25_cb *)param;\r\nswitch (ax25->ax25_dev->values[AX25_VALUES_PROTOCOL]) {\r\ncase AX25_PROTO_STD_SIMPLEX:\r\ncase AX25_PROTO_STD_DUPLEX:\r\nax25_std_t2timer_expiry(ax25);\r\nbreak;\r\n#ifdef CONFIG_AX25_DAMA_SLAVE\r\ncase AX25_PROTO_DAMA_SLAVE:\r\nif (!ax25->ax25_dev->dama.slave)\r\nax25_std_t2timer_expiry(ax25);\r\nbreak;\r\n#endif\r\n}\r\n}\r\nstatic void ax25_t3timer_expiry(unsigned long param)\r\n{\r\nax25_cb *ax25 = (ax25_cb *)param;\r\nswitch (ax25->ax25_dev->values[AX25_VALUES_PROTOCOL]) {\r\ncase AX25_PROTO_STD_SIMPLEX:\r\ncase AX25_PROTO_STD_DUPLEX:\r\nax25_std_t3timer_expiry(ax25);\r\nbreak;\r\n#ifdef CONFIG_AX25_DAMA_SLAVE\r\ncase AX25_PROTO_DAMA_SLAVE:\r\nif (ax25->ax25_dev->dama.slave)\r\nax25_ds_t3timer_expiry(ax25);\r\nelse\r\nax25_std_t3timer_expiry(ax25);\r\nbreak;\r\n#endif\r\n}\r\n}\r\nstatic void ax25_idletimer_expiry(unsigned long param)\r\n{\r\nax25_cb *ax25 = (ax25_cb *)param;\r\nswitch (ax25->ax25_dev->values[AX25_VALUES_PROTOCOL]) {\r\ncase AX25_PROTO_STD_SIMPLEX:\r\ncase AX25_PROTO_STD_DUPLEX:\r\nax25_std_idletimer_expiry(ax25);\r\nbreak;\r\n#ifdef CONFIG_AX25_DAMA_SLAVE\r\ncase AX25_PROTO_DAMA_SLAVE:\r\nif (ax25->ax25_dev->dama.slave)\r\nax25_ds_idletimer_expiry(ax25);\r\nelse\r\nax25_std_idletimer_expiry(ax25);\r\nbreak;\r\n#endif\r\n}\r\n}
