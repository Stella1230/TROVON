void lustre_lma_init(struct lustre_mdt_attrs *lma, const struct lu_fid *fid,\r\n__u32 incompat)\r\n{\r\nlma->lma_compat = 0;\r\nlma->lma_incompat = incompat;\r\nlma->lma_self_fid = *fid;\r\nLASSERT(sizeof(*lma) ==\r\n(offsetof(struct lustre_mdt_attrs, lma_self_fid) +\r\nsizeof(lma->lma_self_fid)));\r\n}\r\nvoid lustre_lma_swab(struct lustre_mdt_attrs *lma)\r\n{\r\nif (LUSTRE_MSG_MAGIC != cpu_to_le32(LUSTRE_MSG_MAGIC)) {\r\n__swab32s(&lma->lma_compat);\r\n__swab32s(&lma->lma_incompat);\r\nlustre_swab_lu_fid(&lma->lma_self_fid);\r\n}\r\n}\r\nvoid lustre_som_swab(struct som_attrs *attrs)\r\n{\r\nif (LUSTRE_MSG_MAGIC != cpu_to_le32(LUSTRE_MSG_MAGIC)) {\r\n__swab32s(&attrs->som_compat);\r\n__swab32s(&attrs->som_incompat);\r\n__swab64s(&attrs->som_ioepoch);\r\n__swab64s(&attrs->som_size);\r\n__swab64s(&attrs->som_blocks);\r\n__swab64s(&attrs->som_mountid);\r\n}\r\n}\r\nint lustre_buf2som(void *buf, int rc, struct md_som_data *msd)\r\n{\r\nstruct som_attrs *attrs = (struct som_attrs *)buf;\r\nif (rc == 0 || rc == -ENODATA)\r\nreturn -ENODATA;\r\nif (rc < 0)\r\nreturn rc;\r\nif (attrs->som_incompat & ~cpu_to_le32(SOM_INCOMPAT_SUPP))\r\nreturn -ENODATA;\r\nlustre_som_swab(attrs);\r\nmsd->msd_compat = attrs->som_compat;\r\nmsd->msd_incompat = attrs->som_incompat;\r\nmsd->msd_ioepoch = attrs->som_ioepoch;\r\nmsd->msd_size = attrs->som_size;\r\nmsd->msd_blocks = attrs->som_blocks;\r\nmsd->msd_mountid = attrs->som_mountid;\r\nreturn 0;\r\n}\r\nvoid lustre_hsm_swab(struct hsm_attrs *attrs)\r\n{\r\nif (LUSTRE_MSG_MAGIC != cpu_to_le32(LUSTRE_MSG_MAGIC)) {\r\n__swab32s(&attrs->hsm_compat);\r\n__swab32s(&attrs->hsm_flags);\r\n__swab64s(&attrs->hsm_arch_id);\r\n__swab64s(&attrs->hsm_arch_ver);\r\n}\r\n}\r\nint lustre_buf2hsm(void *buf, int rc, struct md_hsm *mh)\r\n{\r\nstruct hsm_attrs *attrs = (struct hsm_attrs *)buf;\r\nif (rc == 0 || rc == -ENODATA)\r\nreturn -ENODATA;\r\nif (rc < 0)\r\nreturn rc;\r\nlustre_hsm_swab(attrs);\r\nmh->mh_compat = attrs->hsm_compat;\r\nmh->mh_flags = attrs->hsm_flags;\r\nmh->mh_arch_id = attrs->hsm_arch_id;\r\nmh->mh_arch_ver = attrs->hsm_arch_ver;\r\nreturn 0;\r\n}\r\nvoid lustre_hsm2buf(void *buf, struct md_hsm *mh)\r\n{\r\nstruct hsm_attrs *attrs = (struct hsm_attrs *)buf;\r\nattrs->hsm_compat = mh->mh_compat;\r\nattrs->hsm_flags = mh->mh_flags;\r\nattrs->hsm_arch_id = mh->mh_arch_id;\r\nattrs->hsm_arch_ver = mh->mh_arch_ver;\r\nlustre_hsm_swab(attrs);\r\n}
