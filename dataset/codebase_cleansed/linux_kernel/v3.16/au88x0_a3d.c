static void\r\na3dsrc_SetTimeConsts(a3dsrc_t * a, short HrtfTrack, short ItdTrack,\r\nshort GTrack, short CTrack)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_HrtfTrackTC), HrtfTrack);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_ITDTrackTC), ItdTrack);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_GainTrackTC), GTrack);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_CoeffTrackTC), CTrack);\r\n}\r\nstatic void\r\na3dsrc_SetAtmosTarget(a3dsrc_t * a, short aa, short b, short c, short d,\r\nshort e)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_A21Target),\r\n(e << 0x10) | d);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_B10Target),\r\n(b << 0x10) | aa);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_B2Target), c);\r\n}\r\nstatic void\r\na3dsrc_SetAtmosCurrent(a3dsrc_t * a, short aa, short b, short c, short d,\r\nshort e)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_A12Current),\r\n(e << 0x10) | d);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_B01Current),\r\n(b << 0x10) | aa);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_B2Current), c);\r\n}\r\nstatic void\r\na3dsrc_SetAtmosState(a3dsrc_t * a, short x1, short x2, short y1, short y2)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio, a3d_addrA(a->slice, a->source, A3D_A_x1), x1);\r\nhwwrite(vortex->mmio, a3d_addrA(a->slice, a->source, A3D_A_x2), x2);\r\nhwwrite(vortex->mmio, a3d_addrA(a->slice, a->source, A3D_A_y1), y1);\r\nhwwrite(vortex->mmio, a3d_addrA(a->slice, a->source, A3D_A_y2), y2);\r\n}\r\nstatic void\r\na3dsrc_SetHrtfTarget(a3dsrc_t * a, a3d_Hrtf_t const aa, a3d_Hrtf_t const b)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint i;\r\nfor (i = 0; i < HRTF_SZ; i++)\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source,\r\nA3D_B_HrtfTarget) + (i << 2),\r\n(b[i] << 0x10) | aa[i]);\r\n}\r\nstatic void\r\na3dsrc_SetHrtfCurrent(a3dsrc_t * a, a3d_Hrtf_t const aa, a3d_Hrtf_t const b)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint i;\r\nfor (i = 0; i < HRTF_SZ; i++)\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source,\r\nA3D_B_HrtfCurrent) + (i << 2),\r\n(b[i] << 0x10) | aa[i]);\r\n}\r\nstatic void\r\na3dsrc_SetHrtfState(a3dsrc_t * a, a3d_Hrtf_t const aa, a3d_Hrtf_t const b)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint i;\r\nfor (i = 0; i < HRTF_SZ; i++)\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source,\r\nA3D_B_HrtfDelayLine) + (i << 2),\r\n(b[i] << 0x10) | aa[i]);\r\n}\r\nstatic void a3dsrc_SetHrtfOutput(a3dsrc_t * a, short left, short right)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_HrtfOutL), left);\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source, A3D_A_HrtfOutR), right);\r\n}\r\nstatic void a3dsrc_SetItdTarget(a3dsrc_t * a, short litd, short ritd)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nif (litd < 0)\r\nlitd = 0;\r\nif (litd > 0x57FF)\r\nlitd = 0x57FF;\r\nif (ritd < 0)\r\nritd = 0;\r\nif (ritd > 0x57FF)\r\nritd = 0x57FF;\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_ITDTarget),\r\n(ritd << 0x10) | litd);\r\n}\r\nstatic void a3dsrc_SetItdCurrent(a3dsrc_t * a, short litd, short ritd)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nif (litd < 0)\r\nlitd = 0;\r\nif (litd > 0x57FF)\r\nlitd = 0x57FF;\r\nif (ritd < 0)\r\nritd = 0;\r\nif (ritd > 0x57FF)\r\nritd = 0x57FF;\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_ITDCurrent),\r\n(ritd << 0x10) | litd);\r\n}\r\nstatic void a3dsrc_SetItdDline(a3dsrc_t * a, a3d_ItdDline_t const dline)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint i;\r\nfor (i = 0; i < DLINE_SZ; i++)\r\nhwwrite(vortex->mmio,\r\na3d_addrA(a->slice, a->source,\r\nA3D_A_ITDDelayLine) + (i << 2), dline[i]);\r\n}\r\nstatic void a3dsrc_SetGainTarget(a3dsrc_t * a, short left, short right)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_GainTarget),\r\n(right << 0x10) | left);\r\n}\r\nstatic void a3dsrc_SetGainCurrent(a3dsrc_t * a, short left, short right)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio,\r\na3d_addrB(a->slice, a->source, A3D_B_GainCurrent),\r\n(right << 0x10) | left);\r\n}\r\nstatic void a3dsrc_SetA3DSampleRate(a3dsrc_t * a, int sr)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint esp0 = 0;\r\nesp0 = (((esp0 & 0x7fffffff) | 0xB8000000) & 0x7) | ((sr & 0x1f) << 3);\r\nhwwrite(vortex->mmio, A3D_SLICE_Control + ((a->slice) << 0xd), esp0);\r\n}\r\nstatic void a3dsrc_EnableA3D(a3dsrc_t * a)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio, A3D_SLICE_Control + ((a->slice) << 0xd),\r\n0xF0000001);\r\n}\r\nstatic void a3dsrc_DisableA3D(a3dsrc_t * a)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio, A3D_SLICE_Control + ((a->slice) << 0xd),\r\n0xF0000000);\r\n}\r\nstatic void a3dsrc_SetA3DControlReg(a3dsrc_t * a, unsigned long ctrl)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio, A3D_SLICE_Control + ((a->slice) << 0xd), ctrl);\r\n}\r\nstatic void a3dsrc_SetA3DPointerReg(a3dsrc_t * a, unsigned long ptr)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nhwwrite(vortex->mmio, A3D_SLICE_Pointers + ((a->slice) << 0xd), ptr);\r\n}\r\nstatic void a3dsrc_ZeroSliceIO(a3dsrc_t * a)\r\n{\r\nvortex_t *vortex = (vortex_t *) (a->vortex);\r\nint i;\r\nfor (i = 0; i < 8; i++)\r\nhwwrite(vortex->mmio,\r\nA3D_SLICE_VDBDest +\r\n((((a->slice) << 0xb) + i) << 2), 0);\r\nfor (i = 0; i < 4; i++)\r\nhwwrite(vortex->mmio,\r\nA3D_SLICE_VDBSource +\r\n((((a->slice) << 0xb) + i) << 2), 0);\r\n}\r\nstatic void a3dsrc_ZeroState(a3dsrc_t * a)\r\n{\r\na3dsrc_SetAtmosState(a, 0, 0, 0, 0);\r\na3dsrc_SetHrtfState(a, A3dHrirZeros, A3dHrirZeros);\r\na3dsrc_SetItdDline(a, A3dItdDlineZeros);\r\na3dsrc_SetHrtfOutput(a, 0, 0);\r\na3dsrc_SetTimeConsts(a, 0, 0, 0, 0);\r\na3dsrc_SetAtmosCurrent(a, 0, 0, 0, 0, 0);\r\na3dsrc_SetAtmosTarget(a, 0, 0, 0, 0, 0);\r\na3dsrc_SetItdCurrent(a, 0, 0);\r\na3dsrc_SetItdTarget(a, 0, 0);\r\na3dsrc_SetGainCurrent(a, 0, 0);\r\na3dsrc_SetGainTarget(a, 0, 0);\r\na3dsrc_SetHrtfCurrent(a, A3dHrirZeros, A3dHrirZeros);\r\na3dsrc_SetHrtfTarget(a, A3dHrirZeros, A3dHrirZeros);\r\n}\r\nstatic void a3dsrc_ZeroStateA3D(a3dsrc_t * a)\r\n{\r\nint i, var, var2;\r\nif ((a->vortex) == NULL) {\r\nprintk(KERN_ERR "vortex: ZeroStateA3D: ERROR: a->vortex is NULL\n");\r\nreturn;\r\n}\r\na3dsrc_SetA3DControlReg(a, 0);\r\na3dsrc_SetA3DPointerReg(a, 0);\r\nvar = a->slice;\r\nvar2 = a->source;\r\nfor (i = 0; i < 4; i++) {\r\na->slice = i;\r\na3dsrc_ZeroSliceIO(a);\r\n}\r\na->source = var2;\r\na->slice = var;\r\n}\r\nstatic void a3dsrc_ProgramPipe(a3dsrc_t * a)\r\n{\r\na3dsrc_SetTimeConsts(a, 0, 0, 0, 0);\r\na3dsrc_SetAtmosCurrent(a, 0, 0x4000, 0, 0, 0);\r\na3dsrc_SetAtmosTarget(a, 0x4000, 0, 0, 0, 0);\r\na3dsrc_SetItdCurrent(a, 0, 0);\r\na3dsrc_SetItdTarget(a, 0, 0);\r\na3dsrc_SetGainCurrent(a, 0x7fff, 0x7fff);\r\na3dsrc_SetGainTarget(a, 0x7fff, 0x7fff);\r\na3dsrc_SetHrtfCurrent(a, A3dHrirImpulse, A3dHrirImpulse);\r\na3dsrc_SetHrtfTarget(a, A3dHrirImpulse, A3dHrirImpulse);\r\n}\r\nstatic void vortex_A3dSourceHw_Initialize(vortex_t * v, int source, int slice)\r\n{\r\na3dsrc_t *a3dsrc = &(v->a3d[source + (slice * 4)]);\r\na3dsrc->vortex = (void *)v;\r\na3dsrc->source = source;\r\na3dsrc->slice = slice;\r\na3dsrc_ZeroState(a3dsrc);\r\na3dsrc_SetA3DSampleRate(a3dsrc, 0x11);\r\n}\r\nstatic int Vort3DRend_Initialize(vortex_t * v, unsigned short mode)\r\n{\r\nv->xt_mode = mode;\r\nvortex_XtalkHw_init(v);\r\nvortex_XtalkHw_SetGainsAllChan(v);\r\nswitch (v->xt_mode) {\r\ncase XT_SPEAKER0:\r\nvortex_XtalkHw_ProgramXtalkNarrow(v);\r\nbreak;\r\ncase XT_SPEAKER1:\r\nvortex_XtalkHw_ProgramXtalkWide(v);\r\nbreak;\r\ndefault:\r\ncase XT_HEADPHONE:\r\nvortex_XtalkHw_ProgramPipe(v);\r\nbreak;\r\ncase XT_DIAMOND:\r\nvortex_XtalkHw_ProgramDiamondXtalk(v);\r\nbreak;\r\n}\r\nvortex_XtalkHw_SetSampleRate(v, 0x11);\r\nvortex_XtalkHw_Enable(v);\r\nreturn 0;\r\n}\r\nstatic void vortex_Vort3D_enable(vortex_t *v)\r\n{\r\nint i;\r\nVort3DRend_Initialize(v, XT_HEADPHONE);\r\nfor (i = 0; i < NR_A3D; i++) {\r\nvortex_A3dSourceHw_Initialize(v, i % 4, i >> 2);\r\na3dsrc_ZeroStateA3D(&(v->a3d[0]));\r\n}\r\nvortex_a3d_register_controls(v);\r\n}\r\nstatic void vortex_Vort3D_disable(vortex_t * v)\r\n{\r\nvortex_XtalkHw_Disable(v);\r\nvortex_a3d_unregister_controls(v);\r\n}\r\nstatic void vortex_Vort3D_connect(vortex_t * v, int en)\r\n{\r\nint i;\r\n#ifdef CHIP_AU8810\r\nreturn;\r\n#endif\r\n#if 1\r\nv->mixxtlk[0] =\r\nvortex_adb_checkinout(v, v->fixed_res, en, VORTEX_RESOURCE_MIXIN);\r\nif (v->mixxtlk[0] < 0) {\r\nprintk\r\n("vortex: vortex_Vort3D: ERROR: not enough free mixer resources.\n");\r\nreturn;\r\n}\r\nv->mixxtlk[1] =\r\nvortex_adb_checkinout(v, v->fixed_res, en, VORTEX_RESOURCE_MIXIN);\r\nif (v->mixxtlk[1] < 0) {\r\nprintk\r\n("vortex: vortex_Vort3D: ERROR: not enough free mixer resources.\n");\r\nreturn;\r\n}\r\n#endif\r\nfor (i = 0; i < 4; i++) {\r\nvortex_route(v, en, 0x11, ADB_A3DOUT(i * 2), ADB_XTALKIN(i));\r\nvortex_route(v, en, 0x11, ADB_A3DOUT(i * 2) + 1, ADB_XTALKIN(5 + i));\r\n}\r\n#if 0\r\nvortex_route(v, en, 0x11, ADB_XTALKOUT(0), ADB_EQIN(2));\r\nvortex_route(v, en, 0x11, ADB_XTALKOUT(1), ADB_EQIN(3));\r\n#else\r\nvortex_route(v, en, 0x11, ADB_XTALKOUT(0), ADB_MIXIN(v->mixxtlk[0]));\r\nvortex_route(v, en, 0x11, ADB_XTALKOUT(1), ADB_MIXIN(v->mixxtlk[1]));\r\nvortex_connection_mixin_mix(v, en, v->mixxtlk[0], v->mixplayb[0], 0);\r\nvortex_connection_mixin_mix(v, en, v->mixxtlk[1], v->mixplayb[1], 0);\r\nvortex_mix_setinputvolumebyte(v, v->mixplayb[0], v->mixxtlk[0],\r\nen ? MIX_DEFIGAIN : VOL_MIN);\r\nvortex_mix_setinputvolumebyte(v, v->mixplayb[1], v->mixxtlk[1],\r\nen ? MIX_DEFIGAIN : VOL_MIN);\r\nif (VORTEX_IS_QUAD(v)) {\r\nvortex_connection_mixin_mix(v, en, v->mixxtlk[0],\r\nv->mixplayb[2], 0);\r\nvortex_connection_mixin_mix(v, en, v->mixxtlk[1],\r\nv->mixplayb[3], 0);\r\nvortex_mix_setinputvolumebyte(v, v->mixplayb[2],\r\nv->mixxtlk[0],\r\nen ? MIX_DEFIGAIN : VOL_MIN);\r\nvortex_mix_setinputvolumebyte(v, v->mixplayb[3],\r\nv->mixxtlk[1],\r\nen ? MIX_DEFIGAIN : VOL_MIN);\r\n}\r\n#endif\r\n}\r\nstatic void vortex_Vort3D_InitializeSource(a3dsrc_t * a, int en)\r\n{\r\nif (a->vortex == NULL) {\r\nprintk\r\n("vortex: Vort3D_InitializeSource: A3D source not initialized\n");\r\nreturn;\r\n}\r\nif (en) {\r\na3dsrc_ProgramPipe(a);\r\na3dsrc_SetA3DSampleRate(a, 0x11);\r\na3dsrc_SetTimeConsts(a, HrtfTCDefault,\r\nItdTCDefault, GainTCDefault,\r\nCoefTCDefault);\r\na3dsrc_EnableA3D(a);\r\n} else {\r\na3dsrc_DisableA3D(a);\r\na3dsrc_ZeroState(a);\r\n}\r\n}\r\nstatic void vortex_a3d_coord2hrtf(a3d_Hrtf_t hrtf, int *coord)\r\n{\r\n}\r\nstatic void vortex_a3d_coord2itd(a3d_Itd_t itd, int *coord)\r\n{\r\n}\r\nstatic void vortex_a3d_coord2ild(a3d_LRGains_t ild, int left, int right)\r\n{\r\n}\r\nstatic void vortex_a3d_translate_filter(a3d_atmos_t filter, int *params)\r\n{\r\n}\r\nstatic int\r\nsnd_vortex_a3d_hrtf_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 6;\r\nuinfo->value.integer.min = 0x00000000;\r\nuinfo->value.integer.max = 0xffffffff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_itd_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 2;\r\nuinfo->value.integer.min = 0x00000000;\r\nuinfo->value.integer.max = 0xffffffff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_ild_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 2;\r\nuinfo->value.integer.min = 0x00000000;\r\nuinfo->value.integer.max = 0xffffffff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_filter_info(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 4;\r\nuinfo->value.integer.min = 0x00000000;\r\nuinfo->value.integer.max = 0xffffffff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_hrtf_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\na3dsrc_t *a = kcontrol->private_data;\r\nint changed = 1, i;\r\nint coord[6];\r\nfor (i = 0; i < 6; i++)\r\ncoord[i] = ucontrol->value.integer.value[i];\r\nvortex_a3d_coord2hrtf(a->hrtf[0], coord);\r\nvortex_a3d_coord2hrtf(a->hrtf[1], coord);\r\na3dsrc_SetHrtfTarget(a, a->hrtf[0], a->hrtf[1]);\r\na3dsrc_SetHrtfCurrent(a, a->hrtf[0], a->hrtf[1]);\r\nreturn changed;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_itd_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\na3dsrc_t *a = kcontrol->private_data;\r\nint coord[6];\r\nint i, changed = 1;\r\nfor (i = 0; i < 6; i++)\r\ncoord[i] = ucontrol->value.integer.value[i];\r\nvortex_a3d_coord2itd(a->hrtf[0], coord);\r\nvortex_a3d_coord2itd(a->hrtf[1], coord);\r\na3dsrc_SetItdTarget(a, a->itd[0], a->itd[1]);\r\na3dsrc_SetItdCurrent(a, a->itd[0], a->itd[1]);\r\na3dsrc_SetItdDline(a, a->dline);\r\nreturn changed;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_ild_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\na3dsrc_t *a = kcontrol->private_data;\r\nint changed = 1;\r\nint l, r;\r\nl = ucontrol->value.integer.value[0];\r\nr = ucontrol->value.integer.value[1];\r\nvortex_a3d_coord2ild(a->ild, l, r);\r\na3dsrc_SetGainTarget(a, l, r);\r\na3dsrc_SetGainCurrent(a, l, r);\r\nreturn changed;\r\n}\r\nstatic int\r\nsnd_vortex_a3d_filter_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\na3dsrc_t *a = kcontrol->private_data;\r\nint i, changed = 1;\r\nint params[6];\r\nfor (i = 0; i < 6; i++)\r\nparams[i] = ucontrol->value.integer.value[i];\r\nvortex_a3d_translate_filter(a->filter, params);\r\na3dsrc_SetAtmosTarget(a, a->filter[0],\r\na->filter[1], a->filter[2],\r\na->filter[3], a->filter[4]);\r\na3dsrc_SetAtmosCurrent(a, a->filter[0],\r\na->filter[1], a->filter[2],\r\na->filter[3], a->filter[4]);\r\nreturn changed;\r\n}\r\nstatic int vortex_a3d_register_controls(vortex_t *vortex)\r\n{\r\nstruct snd_kcontrol *kcontrol;\r\nint err, i;\r\nfor (i = 0; i < NR_A3D; i++) {\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_a3d_kcontrol, &vortex->a3d[i])) == NULL)\r\nreturn -ENOMEM;\r\nkcontrol->id.numid = CTRLID_HRTF;\r\nkcontrol->info = snd_vortex_a3d_hrtf_info;\r\nkcontrol->put = snd_vortex_a3d_hrtf_put;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\n}\r\nfor (i = 0; i < NR_A3D; i++) {\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_a3d_kcontrol, &vortex->a3d[i])) == NULL)\r\nreturn -ENOMEM;\r\nkcontrol->id.numid = CTRLID_ITD;\r\nkcontrol->info = snd_vortex_a3d_itd_info;\r\nkcontrol->put = snd_vortex_a3d_itd_put;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\n}\r\nfor (i = 0; i < NR_A3D; i++) {\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_a3d_kcontrol, &vortex->a3d[i])) == NULL)\r\nreturn -ENOMEM;\r\nkcontrol->id.numid = CTRLID_GAINS;\r\nkcontrol->info = snd_vortex_a3d_ild_info;\r\nkcontrol->put = snd_vortex_a3d_ild_put;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\n}\r\nfor (i = 0; i < NR_A3D; i++) {\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_a3d_kcontrol, &vortex->a3d[i])) == NULL)\r\nreturn -ENOMEM;\r\nkcontrol->id.numid = CTRLID_FILTER;\r\nkcontrol->info = snd_vortex_a3d_filter_info;\r\nkcontrol->put = snd_vortex_a3d_filter_put;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\n}\r\nreturn 0;\r\n}\r\nstatic void vortex_a3d_unregister_controls(vortex_t * vortex)\r\n{\r\n}
