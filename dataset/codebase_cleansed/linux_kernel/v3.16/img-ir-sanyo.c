static int img_ir_sanyo_scancode(int len, u64 raw, int *scancode, u64 protocols)\r\n{\r\nunsigned int addr, addr_inv, data, data_inv;\r\nif (!len)\r\nreturn IMG_IR_REPEATCODE;\r\nif (len != 42)\r\nreturn -EINVAL;\r\naddr = (raw >> 0) & 0x1fff;\r\naddr_inv = (raw >> 13) & 0x1fff;\r\ndata = (raw >> 26) & 0xff;\r\ndata_inv = (raw >> 34) & 0xff;\r\nif ((data_inv ^ data) != 0xff)\r\nreturn -EINVAL;\r\nif ((addr_inv ^ addr) != 0x1fff)\r\nreturn -EINVAL;\r\n*scancode = addr << 8 | data;\r\nreturn IMG_IR_SCANCODE;\r\n}\r\nstatic int img_ir_sanyo_filter(const struct rc_scancode_filter *in,\r\nstruct img_ir_filter *out, u64 protocols)\r\n{\r\nunsigned int addr, addr_inv, data, data_inv;\r\nunsigned int addr_m, data_m;\r\ndata = in->data & 0xff;\r\ndata_m = in->mask & 0xff;\r\ndata_inv = data ^ 0xff;\r\nif (in->data & 0xff700000)\r\nreturn -EINVAL;\r\naddr = (in->data >> 8) & 0x1fff;\r\naddr_m = (in->mask >> 8) & 0x1fff;\r\naddr_inv = addr ^ 0x1fff;\r\nout->data = (u64)data_inv << 34 |\r\n(u64)data << 26 |\r\naddr_inv << 13 |\r\naddr;\r\nout->mask = (u64)data_m << 34 |\r\n(u64)data_m << 26 |\r\naddr_m << 13 |\r\naddr_m;\r\nreturn 0;\r\n}
