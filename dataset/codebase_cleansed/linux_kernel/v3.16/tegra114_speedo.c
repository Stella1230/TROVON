static void rev_sku_to_speedo_ids(int rev, int sku, int *threshold)\r\n{\r\nu32 tmp;\r\nswitch (sku) {\r\ncase 0x00:\r\ncase 0x10:\r\ncase 0x05:\r\ncase 0x06:\r\ntegra_cpu_speedo_id = 1;\r\ntegra_soc_speedo_id = 0;\r\n*threshold = THRESHOLD_INDEX_0;\r\nbreak;\r\ncase 0x03:\r\ncase 0x04:\r\ntegra_cpu_speedo_id = 2;\r\ntegra_soc_speedo_id = 1;\r\n*threshold = THRESHOLD_INDEX_1;\r\nbreak;\r\ndefault:\r\npr_err("Tegra114 Unknown SKU %d\n", sku);\r\ntegra_cpu_speedo_id = 0;\r\ntegra_soc_speedo_id = 0;\r\n*threshold = THRESHOLD_INDEX_0;\r\nbreak;\r\n}\r\nif (rev == TEGRA_REVISION_A01) {\r\ntmp = tegra_fuse_readl(0x270) << 1;\r\ntmp |= tegra_fuse_readl(0x26c);\r\nif (!tmp)\r\ntegra_cpu_speedo_id = 0;\r\n}\r\n}\r\nvoid tegra114_init_speedo_data(void)\r\n{\r\nu32 cpu_speedo_val;\r\nu32 core_speedo_val;\r\nint threshold;\r\nint i;\r\nBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(core_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nrev_sku_to_speedo_ids(tegra_revision, tegra_sku_id, &threshold);\r\ncpu_speedo_val = tegra_fuse_readl(0x12c) + 1024;\r\ncore_speedo_val = tegra_fuse_readl(0x134);\r\nfor (i = 0; i < CPU_PROCESS_CORNERS_NUM; i++)\r\nif (cpu_speedo_val < cpu_process_speedos[threshold][i])\r\nbreak;\r\ntegra_cpu_process_id = i;\r\nfor (i = 0; i < CORE_PROCESS_CORNERS_NUM; i++)\r\nif (core_speedo_val < core_process_speedos[threshold][i])\r\nbreak;\r\ntegra_core_process_id = i;\r\n}
