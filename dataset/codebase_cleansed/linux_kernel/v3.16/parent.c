int\r\nnouveau_parent_sclass(struct nouveau_object *parent, u16 handle,\r\nstruct nouveau_object **pengine,\r\nstruct nouveau_oclass **poclass)\r\n{\r\nstruct nouveau_sclass *sclass;\r\nstruct nouveau_engine *engine;\r\nstruct nouveau_oclass *oclass;\r\nu64 mask;\r\nsclass = nv_parent(parent)->sclass;\r\nwhile (sclass) {\r\nif ((sclass->oclass->handle & 0xffff) == handle) {\r\n*pengine = parent->engine;\r\n*poclass = sclass->oclass;\r\nreturn 0;\r\n}\r\nsclass = sclass->sclass;\r\n}\r\nmask = nv_parent(parent)->engine;\r\nwhile (mask) {\r\nint i = __ffs64(mask);\r\nif (nv_iclass(parent, NV_CLIENT_CLASS))\r\nengine = nv_engine(nv_client(parent)->device);\r\nelse\r\nengine = nouveau_engine(parent, i);\r\nif (engine) {\r\noclass = engine->sclass;\r\nwhile (oclass->ofuncs) {\r\nif ((oclass->handle & 0xffff) == handle) {\r\n*pengine = nv_object(engine);\r\n*poclass = oclass;\r\nreturn 0;\r\n}\r\noclass++;\r\n}\r\n}\r\nmask &= ~(1ULL << i);\r\n}\r\nreturn -EINVAL;\r\n}\r\nint\r\nnouveau_parent_create_(struct nouveau_object *parent,\r\nstruct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, u32 pclass,\r\nstruct nouveau_oclass *sclass, u64 engcls,\r\nint size, void **pobject)\r\n{\r\nstruct nouveau_parent *object;\r\nstruct nouveau_sclass *nclass;\r\nint ret;\r\nret = nouveau_object_create_(parent, engine, oclass, pclass |\r\nNV_PARENT_CLASS, size, pobject);\r\nobject = *pobject;\r\nif (ret)\r\nreturn ret;\r\nwhile (sclass && sclass->ofuncs) {\r\nnclass = kzalloc(sizeof(*nclass), GFP_KERNEL);\r\nif (!nclass)\r\nreturn -ENOMEM;\r\nnclass->sclass = object->sclass;\r\nobject->sclass = nclass;\r\nnclass->engine = engine ? nv_engine(engine) : NULL;\r\nnclass->oclass = sclass;\r\nsclass++;\r\n}\r\nobject->engine = engcls;\r\nreturn 0;\r\n}\r\nvoid\r\nnouveau_parent_destroy(struct nouveau_parent *parent)\r\n{\r\nstruct nouveau_sclass *sclass;\r\nwhile ((sclass = parent->sclass)) {\r\nparent->sclass = sclass->sclass;\r\nkfree(sclass);\r\n}\r\nnouveau_object_destroy(&parent->base);\r\n}\r\nvoid\r\n_nouveau_parent_dtor(struct nouveau_object *object)\r\n{\r\nnouveau_parent_destroy(nv_parent(object));\r\n}
