int wa_create(struct wahc *wa, struct usb_interface *iface,\r\nkernel_ulong_t quirks)\r\n{\r\nint result;\r\nstruct device *dev = &iface->dev;\r\nresult = wa_rpipes_create(wa);\r\nif (result < 0)\r\ngoto error_rpipes_create;\r\nwa->quirks = quirks;\r\nwa->dti_epd = &iface->cur_altsetting->endpoint[1].desc;\r\nwa->dto_epd = &iface->cur_altsetting->endpoint[2].desc;\r\nwa->dti_buf_size = usb_endpoint_maxp(wa->dti_epd);\r\nwa->dti_buf = kmalloc(wa->dti_buf_size, GFP_KERNEL);\r\nif (wa->dti_buf == NULL) {\r\nresult = -ENOMEM;\r\ngoto error_dti_buf_alloc;\r\n}\r\nresult = wa_nep_create(wa, iface);\r\nif (result < 0) {\r\ndev_err(dev, "WA-CDS: can't initialize notif endpoint: %d\n",\r\nresult);\r\ngoto error_nep_create;\r\n}\r\nreturn 0;\r\nerror_nep_create:\r\nkfree(wa->dti_buf);\r\nerror_dti_buf_alloc:\r\nwa_rpipes_destroy(wa);\r\nerror_rpipes_create:\r\nreturn result;\r\n}\r\nvoid __wa_destroy(struct wahc *wa)\r\n{\r\nif (wa->dti_urb) {\r\nusb_kill_urb(wa->dti_urb);\r\nusb_put_urb(wa->dti_urb);\r\n}\r\nkfree(wa->dti_buf);\r\nwa_nep_destroy(wa);\r\nwa_rpipes_destroy(wa);\r\n}\r\nvoid wa_reset_all(struct wahc *wa)\r\n{\r\nwusbhc_reset_all(wa->wusb);\r\n}
