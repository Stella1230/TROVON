int xen_event_channel_op_compat(int cmd, void *arg)\r\n{\r\nstruct evtchn_op op;\r\nint rc;\r\nop.cmd = cmd;\r\nmemcpy(&op.u, arg, sizeof(op.u));\r\nrc = _hypercall1(int, event_channel_op_compat, &op);\r\nswitch (cmd) {\r\ncase EVTCHNOP_close:\r\ncase EVTCHNOP_send:\r\ncase EVTCHNOP_bind_vcpu:\r\ncase EVTCHNOP_unmask:\r\nbreak;\r\n#define COPY_BACK(eop) \\r\ncase EVTCHNOP_##eop: \\r\nmemcpy(arg, &op.u.eop, sizeof(op.u.eop)); \\r\nbreak\r\nCOPY_BACK(bind_interdomain);\r\nCOPY_BACK(bind_virq);\r\nCOPY_BACK(bind_pirq);\r\nCOPY_BACK(status);\r\nCOPY_BACK(alloc_unbound);\r\nCOPY_BACK(bind_ipi);\r\n#undef COPY_BACK\r\ndefault:\r\nWARN_ON(rc != -ENOSYS);\r\nbreak;\r\n}\r\nreturn rc;\r\n}\r\nint xen_physdev_op_compat(int cmd, void *arg)\r\n{\r\nstruct physdev_op op;\r\nint rc;\r\nop.cmd = cmd;\r\nmemcpy(&op.u, arg, sizeof(op.u));\r\nrc = _hypercall1(int, physdev_op_compat, &op);\r\nswitch (cmd) {\r\ncase PHYSDEVOP_IRQ_UNMASK_NOTIFY:\r\ncase PHYSDEVOP_set_iopl:\r\ncase PHYSDEVOP_set_iobitmap:\r\ncase PHYSDEVOP_apic_write:\r\nbreak;\r\n#define COPY_BACK(pop, fld) \\r\ncase PHYSDEVOP_##pop: \\r\nmemcpy(arg, &op.u.fld, sizeof(op.u.fld)); \\r\nbreak\r\nCOPY_BACK(irq_status_query, irq_status_query);\r\nCOPY_BACK(apic_read, apic_op);\r\nCOPY_BACK(ASSIGN_VECTOR, irq_op);\r\n#undef COPY_BACK\r\ndefault:\r\nWARN_ON(rc != -ENOSYS);\r\nbreak;\r\n}\r\nreturn rc;\r\n}
