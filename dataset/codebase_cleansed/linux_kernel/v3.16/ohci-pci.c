static int broken_suspend(struct usb_hcd *hcd)\r\n{\r\ndevice_init_wakeup(&hcd->self.root_hub->dev, 0);\r\nreturn 0;\r\n}\r\nstatic int ohci_quirk_amd756(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nohci->flags = OHCI_QUIRK_AMD756;\r\nohci_dbg (ohci, "AMD756 erratum 4 workaround\n");\r\nreturn broken_suspend(hcd);\r\n}\r\nstatic int ohci_quirk_opti(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nohci_dbg (ohci, "WARNING: OPTi workarounds unavailable\n");\r\nreturn 0;\r\n}\r\nstatic int ohci_quirk_ns(struct usb_hcd *hcd)\r\n{\r\nstruct pci_dev *pdev = to_pci_dev(hcd->self.controller);\r\nstruct pci_dev *b;\r\nb = pci_get_slot (pdev->bus, PCI_DEVFN (PCI_SLOT (pdev->devfn), 1));\r\nif (b && b->device == PCI_DEVICE_ID_NS_87560_LIO\r\n&& b->vendor == PCI_VENDOR_ID_NS) {\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nohci->flags |= OHCI_QUIRK_SUPERIO;\r\nohci_dbg (ohci, "Using NSC SuperIO setup\n");\r\n}\r\npci_dev_put(b);\r\nreturn 0;\r\n}\r\nstatic int ohci_quirk_zfmicro(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nohci->flags |= OHCI_QUIRK_ZFMICRO;\r\nohci_dbg(ohci, "enabled Compaq ZFMicro chipset quirks\n");\r\nreturn 0;\r\n}\r\nstatic int ohci_quirk_toshiba_scc(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\n#ifdef CONFIG_USB_OHCI_BIG_ENDIAN_MMIO\r\nohci->flags |= OHCI_QUIRK_BE_MMIO;\r\nohci_dbg (ohci, "enabled big endian Toshiba quirk\n");\r\nreturn 0;\r\n#else\r\nohci_err (ohci, "unsupported big endian Toshiba quirk\n");\r\nreturn -ENXIO;\r\n#endif\r\n}\r\nstatic void ohci_quirk_nec_worker(struct work_struct *work)\r\n{\r\nstruct ohci_hcd *ohci = container_of(work, struct ohci_hcd, nec_work);\r\nint status;\r\nstatus = ohci_restart(ohci);\r\nif (status != 0)\r\nohci_err(ohci, "Restarting NEC controller failed in %s, %d\n",\r\n"ohci_restart", status);\r\n}\r\nstatic int ohci_quirk_nec(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nohci->flags |= OHCI_QUIRK_NEC;\r\nINIT_WORK(&ohci->nec_work, ohci_quirk_nec_worker);\r\nohci_dbg (ohci, "enabled NEC chipset lost interrupt quirk\n");\r\nreturn 0;\r\n}\r\nstatic int ohci_quirk_amd700(struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci(hcd);\r\nif (usb_amd_find_chipset_info())\r\nohci->flags |= OHCI_QUIRK_AMD_PLL;\r\nif (usb_amd_prefetch_quirk()) {\r\nohci->flags |= OHCI_QUIRK_AMD_PREFETCH;\r\nohci_dbg(ohci, "enabled AMD prefetch quirk\n");\r\n}\r\nohci->flags |= OHCI_QUIRK_GLOBAL_SUSPEND;\r\nreturn 0;\r\n}\r\nstatic int ohci_pci_reset (struct usb_hcd *hcd)\r\n{\r\nstruct ohci_hcd *ohci = hcd_to_ohci (hcd);\r\nstruct pci_dev *pdev = to_pci_dev(hcd->self.controller);\r\nint ret = 0;\r\nif (hcd->self.controller) {\r\nconst struct pci_device_id *quirk_id;\r\nquirk_id = pci_match_id(ohci_pci_quirks, pdev);\r\nif (quirk_id != NULL) {\r\nint (*quirk)(struct usb_hcd *ohci);\r\nquirk = (void *)quirk_id->driver_data;\r\nret = quirk(hcd);\r\n}\r\n}\r\nif (ret == 0)\r\nret = ohci_setup(hcd);\r\nif (device_can_wakeup(&pdev->dev))\r\nohci->hc_control |= OHCI_CTRL_RWC;\r\nreturn ret;\r\n}\r\nstatic int __init ohci_pci_init(void)\r\n{\r\nif (usb_disabled())\r\nreturn -ENODEV;\r\npr_info("%s: " DRIVER_DESC "\n", hcd_name);\r\nohci_init_driver(&ohci_pci_hc_driver, &pci_overrides);\r\n#ifdef CONFIG_PM\r\nohci_pci_hc_driver.pci_suspend = ohci_suspend;\r\nohci_pci_hc_driver.pci_resume = ohci_resume;\r\n#endif\r\nreturn pci_register_driver(&ohci_pci_driver);\r\n}\r\nstatic void __exit ohci_pci_cleanup(void)\r\n{\r\npci_unregister_driver(&ohci_pci_driver);\r\n}
