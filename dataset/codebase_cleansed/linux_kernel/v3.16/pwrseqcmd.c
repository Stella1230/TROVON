bool rtl_hal_pwrseqcmdparsing (struct rtl_priv* rtlpriv, u8 cut_version,\r\nu8 fab_version, u8 interface_type,\r\nstruct wlan_pwr_cfg pwrcfgcmd[])\r\n{\r\nstruct wlan_pwr_cfg pwr_cfg_cmd = {0};\r\nbool polling_bit = false;\r\nu32 ary_idx=0;\r\nu8 value = 0;\r\nu32 offset = 0;\r\nu32 polling_count = 0;\r\nu32 max_polling_cnt = 5000;\r\ndo {\r\npwr_cfg_cmd = pwrcfgcmd[ary_idx];\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): offset(%#x),cut_msk(%#x), fab_msk(%#x),"\r\n"interface_msk(%#x), base(%#x), cmd(%#x), msk(%#x), value(%#x)\n",\r\nGET_PWR_CFG_OFFSET(pwr_cfg_cmd), GET_PWR_CFG_CUT_MASK(pwr_cfg_cmd),\r\nGET_PWR_CFG_FAB_MASK(pwr_cfg_cmd), GET_PWR_CFG_INTF_MASK(pwr_cfg_cmd),\r\nGET_PWR_CFG_BASE(pwr_cfg_cmd), GET_PWR_CFG_CMD(pwr_cfg_cmd),\r\nGET_PWR_CFG_MASK(pwr_cfg_cmd), GET_PWR_CFG_VALUE(pwr_cfg_cmd)));\r\nif ((GET_PWR_CFG_FAB_MASK(pwr_cfg_cmd)&fab_version) &&\r\n(GET_PWR_CFG_CUT_MASK(pwr_cfg_cmd)&cut_version) &&\r\n(GET_PWR_CFG_INTF_MASK(pwr_cfg_cmd)&interface_type)) {\r\nswitch (GET_PWR_CFG_CMD(pwr_cfg_cmd)) {\r\ncase PWR_CMD_READ:\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): PWR_CMD_READ\n"));\r\nbreak;\r\ncase PWR_CMD_WRITE: {\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): PWR_CMD_WRITE\n"));\r\noffset = GET_PWR_CFG_OFFSET(pwr_cfg_cmd);\r\nvalue = rtl_read_byte(rtlpriv, offset);\r\nvalue = value & (~(GET_PWR_CFG_MASK(pwr_cfg_cmd)));\r\nvalue = value | (GET_PWR_CFG_VALUE(pwr_cfg_cmd)\r\n& GET_PWR_CFG_MASK(pwr_cfg_cmd));\r\nrtl_write_byte(rtlpriv, offset, value);\r\n}\r\nbreak;\r\ncase PWR_CMD_POLLING:\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): PWR_CMD_POLLING\n"));\r\npolling_bit = false;\r\noffset = GET_PWR_CFG_OFFSET(pwr_cfg_cmd);\r\ndo {\r\nvalue = rtl_read_byte(rtlpriv, offset);\r\nvalue = value & GET_PWR_CFG_MASK(pwr_cfg_cmd);\r\nif (value == (GET_PWR_CFG_VALUE(pwr_cfg_cmd)\r\n& GET_PWR_CFG_MASK(pwr_cfg_cmd)))\r\npolling_bit=true;\r\nelse\r\nudelay(10);\r\nif (polling_count++ > max_polling_cnt) {\r\nreturn false;\r\n}\r\n} while (!polling_bit);\r\nbreak;\r\ncase PWR_CMD_DELAY:\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): PWR_CMD_DELAY\n"));\r\nif (GET_PWR_CFG_VALUE(pwr_cfg_cmd) == PWRSEQ_DELAY_US)\r\nudelay(GET_PWR_CFG_OFFSET(pwr_cfg_cmd));\r\nelse\r\nmdelay(GET_PWR_CFG_OFFSET(pwr_cfg_cmd));\r\nbreak;\r\ncase PWR_CMD_END:\r\nRT_TRACE(COMP_INIT, DBG_TRACE,\r\n("rtl_hal_pwrseqcmdparsing(): PWR_CMD_END\n"));\r\nreturn true;\r\nbreak;\r\ndefault:\r\nRT_ASSERT(false,\r\n("rtl_hal_pwrseqcmdparsing(): Unknown CMD!!\n"));\r\nbreak;\r\n}\r\n}\r\nary_idx++;\r\n} while (1);\r\nreturn true;\r\n}
