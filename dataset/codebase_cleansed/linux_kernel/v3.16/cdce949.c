int cdce_set_rate(struct clk *clk, unsigned long rate)\r\n{\r\nint i, ret = 0;\r\nstruct cdce_freq *freq_table = output_list[clk->lpsc].freq_table;\r\nstruct cdce_reg *regs = NULL;\r\nif (!cdce_i2c_client)\r\nreturn -ENODEV;\r\nif (!freq_table)\r\nreturn -EINVAL;\r\nfor (i = 0; i < output_list[clk->lpsc].size; i++) {\r\nif (freq_table[i].frequency == rate / 1000) {\r\nregs = freq_table[i].reglist;\r\nbreak;\r\n}\r\n}\r\nif (!regs)\r\nreturn -EINVAL;\r\nmutex_lock(&cdce_mutex);\r\nfor (i = 0; regs[i].addr; i++) {\r\nret = i2c_smbus_write_byte_data(cdce_i2c_client,\r\nregs[i].addr | 0x80, regs[i].val);\r\nif (ret)\r\nbreak;\r\n}\r\nmutex_unlock(&cdce_mutex);\r\nif (!ret)\r\nclk->rate = rate;\r\nreturn ret;\r\n}\r\nstatic int cdce_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\ncdce_i2c_client = client;\r\nreturn 0;\r\n}\r\nstatic int cdce_remove(struct i2c_client *client)\r\n{\r\ncdce_i2c_client = NULL;\r\nreturn 0;\r\n}\r\nstatic int __init cdce_init(void)\r\n{\r\nreturn i2c_add_driver(&cdce_driver);\r\n}\r\nstatic void __exit cdce_exit(void)\r\n{\r\ni2c_del_driver(&cdce_driver);\r\n}
