static int lm_match(struct device *dev, struct device_driver *drv)\r\n{\r\nreturn 1;\r\n}\r\nstatic int lm_bus_probe(struct device *dev)\r\n{\r\nstruct lm_device *lmdev = to_lm_device(dev);\r\nstruct lm_driver *lmdrv = to_lm_driver(dev->driver);\r\nreturn lmdrv->probe(lmdev);\r\n}\r\nstatic int lm_bus_remove(struct device *dev)\r\n{\r\nstruct lm_device *lmdev = to_lm_device(dev);\r\nstruct lm_driver *lmdrv = to_lm_driver(dev->driver);\r\nif (lmdrv->remove)\r\nlmdrv->remove(lmdev);\r\nreturn 0;\r\n}\r\nstatic int __init lm_init(void)\r\n{\r\nreturn bus_register(&lm_bustype);\r\n}\r\nint lm_driver_register(struct lm_driver *drv)\r\n{\r\ndrv->drv.bus = &lm_bustype;\r\nreturn driver_register(&drv->drv);\r\n}\r\nvoid lm_driver_unregister(struct lm_driver *drv)\r\n{\r\ndriver_unregister(&drv->drv);\r\n}\r\nstatic void lm_device_release(struct device *dev)\r\n{\r\nstruct lm_device *d = to_lm_device(dev);\r\nkfree(d);\r\n}\r\nint lm_device_register(struct lm_device *dev)\r\n{\r\nint ret;\r\ndev->dev.release = lm_device_release;\r\ndev->dev.bus = &lm_bustype;\r\nret = dev_set_name(&dev->dev, "lm%d", dev->id);\r\nif (ret)\r\nreturn ret;\r\ndev->resource.name = dev_name(&dev->dev);\r\nret = request_resource(&iomem_resource, &dev->resource);\r\nif (ret == 0) {\r\nret = device_register(&dev->dev);\r\nif (ret)\r\nrelease_resource(&dev->resource);\r\n}\r\nreturn ret;\r\n}
