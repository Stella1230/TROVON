static ssize_t status_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nconst char *cs[GENWQE_CARD_STATE_MAX] = { "unused", "used", "error" };\r\nreturn sprintf(buf, "%s\n", cs[cd->card_state]);\r\n}\r\nstatic ssize_t appid_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nchar app_name[5];\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\ngenwqe_read_app_id(cd, app_name, sizeof(app_name));\r\nreturn sprintf(buf, "%s\n", app_name);\r\n}\r\nstatic ssize_t version_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu64 slu_id, app_id;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nslu_id = __genwqe_readq(cd, IO_SLU_UNITCFG);\r\napp_id = __genwqe_readq(cd, IO_APP_UNITCFG);\r\nreturn sprintf(buf, "%016llx.%016llx\n", slu_id, app_id);\r\n}\r\nstatic ssize_t type_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu8 card_type;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\ncard_type = genwqe_card_type(cd);\r\nreturn sprintf(buf, "%s\n", (card_type >= ARRAY_SIZE(genwqe_types)) ?\r\n"invalid" : genwqe_types[card_type]);\r\n}\r\nstatic ssize_t driver_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%s\n", DRV_VERS_STRING);\r\n}\r\nstatic ssize_t tempsens_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu64 tempsens;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\ntempsens = __genwqe_readq(cd, IO_SLU_TEMPERATURE_SENSOR);\r\nreturn sprintf(buf, "%016llx\n", tempsens);\r\n}\r\nstatic ssize_t freerunning_timer_show(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu64 t;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nt = __genwqe_readq(cd, IO_SLC_FREE_RUNNING_TIMER);\r\nreturn sprintf(buf, "%016llx\n", t);\r\n}\r\nstatic ssize_t queue_working_time_show(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu64 t;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nt = __genwqe_readq(cd, IO_SLC_QUEUE_WTIME);\r\nreturn sprintf(buf, "%016llx\n", t);\r\n}\r\nstatic ssize_t base_clock_show(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nu64 base_clock;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nbase_clock = genwqe_base_clock_frequency(cd);\r\nreturn sprintf(buf, "%lld\n", base_clock);\r\n}\r\nstatic ssize_t curr_bitstream_show(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nint curr_bitstream;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\ncurr_bitstream = __genwqe_readq(cd, IO_SLU_BITSTREAM) & 0x1;\r\nreturn sprintf(buf, "%d\n", curr_bitstream);\r\n}\r\nstatic ssize_t next_bitstream_show(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nint next_bitstream;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nswitch ((cd->softreset & 0xc) >> 2) {\r\ncase 0x2:\r\nnext_bitstream = 0;\r\nbreak;\r\ncase 0x3:\r\nnext_bitstream = 1;\r\nbreak;\r\ndefault:\r\nnext_bitstream = -1;\r\nbreak;\r\n}\r\nreturn sprintf(buf, "%d\n", next_bitstream);\r\n}\r\nstatic ssize_t next_bitstream_store(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nint partition;\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\nif (kstrtoint(buf, 0, &partition) < 0)\r\nreturn -EINVAL;\r\nswitch (partition) {\r\ncase 0x0:\r\ncd->softreset = 0x78;\r\nbreak;\r\ncase 0x1:\r\ncd->softreset = 0x7c;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n__genwqe_writeq(cd, IO_SLC_CFGREG_SOFTRESET, cd->softreset);\r\nreturn count;\r\n}\r\nstatic umode_t genwqe_is_visible(struct kobject *kobj,\r\nstruct attribute *attr, int n)\r\n{\r\nunsigned int j;\r\nstruct device *dev = container_of(kobj, struct device, kobj);\r\nstruct genwqe_dev *cd = dev_get_drvdata(dev);\r\numode_t mode = attr->mode;\r\nif (genwqe_is_privileged(cd))\r\nreturn mode;\r\nfor (j = 0; genwqe_normal_attributes[j] != NULL; j++)\r\nif (genwqe_normal_attributes[j] == attr)\r\nreturn mode;\r\nreturn 0;\r\n}
