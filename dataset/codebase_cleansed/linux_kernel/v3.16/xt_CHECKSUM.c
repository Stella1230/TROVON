static unsigned int\r\nchecksum_tg(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nif (skb->ip_summed == CHECKSUM_PARTIAL)\r\nskb_checksum_help(skb);\r\nreturn XT_CONTINUE;\r\n}\r\nstatic int checksum_tg_check(const struct xt_tgchk_param *par)\r\n{\r\nconst struct xt_CHECKSUM_info *einfo = par->targinfo;\r\nif (einfo->operation & ~XT_CHECKSUM_OP_FILL) {\r\npr_info("unsupported CHECKSUM operation %x\n", einfo->operation);\r\nreturn -EINVAL;\r\n}\r\nif (!einfo->operation) {\r\npr_info("no CHECKSUM operation enabled\n");\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init checksum_tg_init(void)\r\n{\r\nreturn xt_register_target(&checksum_tg_reg);\r\n}\r\nstatic void __exit checksum_tg_exit(void)\r\n{\r\nxt_unregister_target(&checksum_tg_reg);\r\n}
