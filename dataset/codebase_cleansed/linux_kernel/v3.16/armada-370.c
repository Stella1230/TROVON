static u32 __init a370_get_tclk_freq(void __iomem *sar)\r\n{\r\nu8 tclk_freq_select = 0;\r\ntclk_freq_select = ((readl(sar) >> SARL_A370_TCLK_FREQ_OPT) &\r\nSARL_A370_TCLK_FREQ_OPT_MASK);\r\nreturn a370_tclk_freqs[tclk_freq_select];\r\n}\r\nstatic u32 __init a370_get_cpu_freq(void __iomem *sar)\r\n{\r\nu32 cpu_freq;\r\nu8 cpu_freq_select = 0;\r\ncpu_freq_select = ((readl(sar) >> SARL_A370_PCLK_FREQ_OPT) &\r\nSARL_A370_PCLK_FREQ_OPT_MASK);\r\nif (cpu_freq_select >= ARRAY_SIZE(a370_cpu_freqs)) {\r\npr_err("CPU freq select unsupported %d\n", cpu_freq_select);\r\ncpu_freq = 0;\r\n} else\r\ncpu_freq = a370_cpu_freqs[cpu_freq_select];\r\nreturn cpu_freq;\r\n}\r\nstatic void __init a370_get_clk_ratio(\r\nvoid __iomem *sar, int id, int *mult, int *div)\r\n{\r\nu32 opt = ((readl(sar) >> SARL_A370_FAB_FREQ_OPT) &\r\nSARL_A370_FAB_FREQ_OPT_MASK);\r\nswitch (id) {\r\ncase A370_CPU_TO_NBCLK:\r\n*mult = a370_nbclk_ratios[opt][0];\r\n*div = a370_nbclk_ratios[opt][1];\r\nbreak;\r\ncase A370_CPU_TO_HCLK:\r\n*mult = a370_hclk_ratios[opt][0];\r\n*div = a370_hclk_ratios[opt][1];\r\nbreak;\r\ncase A370_CPU_TO_DRAMCLK:\r\n*mult = a370_dramclk_ratios[opt][0];\r\n*div = a370_dramclk_ratios[opt][1];\r\nbreak;\r\n}\r\n}\r\nstatic void __init a370_clk_init(struct device_node *np)\r\n{\r\nstruct device_node *cgnp =\r\nof_find_compatible_node(NULL, NULL, "marvell,armada-370-gating-clock");\r\nmvebu_coreclk_setup(np, &a370_coreclks);\r\nif (cgnp)\r\nmvebu_clk_gating_setup(cgnp, a370_gating_desc);\r\n}
