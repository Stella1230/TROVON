void use_mm(struct mm_struct *mm)\r\n{\r\nstruct mm_struct *active_mm;\r\nstruct task_struct *tsk = current;\r\ntask_lock(tsk);\r\nactive_mm = tsk->active_mm;\r\nif (active_mm != mm) {\r\natomic_inc(&mm->mm_count);\r\ntsk->active_mm = mm;\r\n}\r\ntsk->mm = mm;\r\nswitch_mm(active_mm, mm, tsk);\r\ntask_unlock(tsk);\r\n#ifdef finish_arch_post_lock_switch\r\nfinish_arch_post_lock_switch();\r\n#endif\r\nif (active_mm != mm)\r\nmmdrop(active_mm);\r\n}\r\nvoid unuse_mm(struct mm_struct *mm)\r\n{\r\nstruct task_struct *tsk = current;\r\ntask_lock(tsk);\r\nsync_mm_rss(mm);\r\ntsk->mm = NULL;\r\nenter_lazy_tlb(mm, tsk);\r\ntask_unlock(tsk);\r\n}
