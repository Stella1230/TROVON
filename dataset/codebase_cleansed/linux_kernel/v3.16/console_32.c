static int prom_nbputchar(const char *buf)\r\n{\r\nunsigned long flags;\r\nint i = -1;\r\nspin_lock_irqsave(&prom_lock, flags);\r\nswitch(prom_vers) {\r\ncase PROM_V0:\r\nif ((*(romvec->pv_nbputchar))(*buf))\r\ni = 1;\r\nbreak;\r\ncase PROM_V2:\r\ncase PROM_V3:\r\nif ((*(romvec->pv_v2devops).v2_dev_write)(*romvec->pv_v2bootargs.fd_stdout,\r\nbuf, 0x1) == 1)\r\ni = 1;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nrestore_current();\r\nspin_unlock_irqrestore(&prom_lock, flags);\r\nreturn i;\r\n}\r\nvoid prom_console_write_buf(const char *buf, int len)\r\n{\r\nwhile (len) {\r\nint n = prom_nbputchar(buf);\r\nif (n < 0)\r\ncontinue;\r\nlen--;\r\nbuf++;\r\n}\r\n}
