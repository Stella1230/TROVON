static int rmobile_reset_handler(struct notifier_block *this,\r\nunsigned long mode, void *cmd)\r\n{\r\npr_debug("%s %lu\n", __func__, mode);\r\nwritel(RESCNT2_PRES, sysc_base2 + RESCNT2);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int rmobile_reset_probe(struct platform_device *pdev)\r\n{\r\nint error;\r\nsysc_base2 = of_iomap(pdev->dev.of_node, 1);\r\nif (!sysc_base2)\r\nreturn -ENODEV;\r\nerror = register_restart_handler(&rmobile_reset_nb);\r\nif (error) {\r\ndev_err(&pdev->dev,\r\n"cannot register restart handler (err=%d)\n", error);\r\ngoto fail_unmap;\r\n}\r\nreturn 0;\r\nfail_unmap:\r\niounmap(sysc_base2);\r\nreturn error;\r\n}\r\nstatic int rmobile_reset_remove(struct platform_device *pdev)\r\n{\r\nunregister_restart_handler(&rmobile_reset_nb);\r\niounmap(sysc_base2);\r\nreturn 0;\r\n}
