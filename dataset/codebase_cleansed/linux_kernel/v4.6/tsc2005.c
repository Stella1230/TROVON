static int tsc2005_cmd(struct device *dev, u8 cmd)\r\n{\r\nu8 tx = TSC200X_CMD | TSC200X_CMD_12BIT | cmd;\r\nstruct spi_transfer xfer = {\r\n.tx_buf = &tx,\r\n.len = 1,\r\n.bits_per_word = 8,\r\n};\r\nstruct spi_message msg;\r\nstruct spi_device *spi = to_spi_device(dev);\r\nint error;\r\nspi_message_init(&msg);\r\nspi_message_add_tail(&xfer, &msg);\r\nerror = spi_sync(spi, &msg);\r\nif (error) {\r\ndev_err(dev, "%s: failed, command: %x, spi error: %d\n",\r\n__func__, cmd, error);\r\nreturn error;\r\n}\r\nreturn 0;\r\n}\r\nstatic int tsc2005_probe(struct spi_device *spi)\r\n{\r\nint error;\r\nspi->mode = SPI_MODE_0;\r\nspi->bits_per_word = 8;\r\nif (!spi->max_speed_hz)\r\nspi->max_speed_hz = TSC2005_SPI_MAX_SPEED_HZ;\r\nerror = spi_setup(spi);\r\nif (error)\r\nreturn error;\r\nreturn tsc200x_probe(&spi->dev, spi->irq, BUS_SPI,\r\ndevm_regmap_init_spi(spi, &tsc200x_regmap_config),\r\ntsc2005_cmd);\r\n}\r\nstatic int tsc2005_remove(struct spi_device *spi)\r\n{\r\nreturn tsc200x_remove(&spi->dev);\r\n}
