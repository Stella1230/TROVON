static void __init imx6ul_enet_clk_init(void)\r\n{\r\nstruct regmap *gpr;\r\ngpr = syscon_regmap_lookup_by_compatible("fsl,imx6ul-iomuxc-gpr");\r\nif (!IS_ERR(gpr))\r\nregmap_update_bits(gpr, IOMUXC_GPR1, IMX6UL_GPR1_ENET_CLK_DIR,\r\nIMX6UL_GPR1_ENET_CLK_OUTPUT);\r\nelse\r\npr_err("failed to find fsl,imx6ul-iomux-gpr regmap\n");\r\n}\r\nstatic int ksz8081_phy_fixup(struct phy_device *dev)\r\n{\r\nif (dev && dev->interface == PHY_INTERFACE_MODE_MII) {\r\nphy_write(dev, 0x1f, 0x8110);\r\nphy_write(dev, 0x16, 0x201);\r\n} else if (dev && dev->interface == PHY_INTERFACE_MODE_RMII) {\r\nphy_write(dev, 0x1f, 0x8190);\r\nphy_write(dev, 0x16, 0x202);\r\n}\r\nreturn 0;\r\n}\r\nstatic void __init imx6ul_enet_phy_init(void)\r\n{\r\nif (IS_BUILTIN(CONFIG_PHYLIB))\r\nphy_register_fixup_for_uid(PHY_ID_KSZ8081, 0xffffffff,\r\nksz8081_phy_fixup);\r\n}\r\nstatic inline void imx6ul_enet_init(void)\r\n{\r\nimx6ul_enet_clk_init();\r\nimx6ul_enet_phy_init();\r\n}\r\nstatic void __init imx6ul_init_machine(void)\r\n{\r\nstruct device *parent;\r\nparent = imx_soc_device_init();\r\nif (parent == NULL)\r\npr_warn("failed to initialize soc device\n");\r\nof_platform_populate(NULL, of_default_bus_match_table, NULL, NULL);\r\nimx6ul_enet_init();\r\nimx_anatop_init();\r\nimx6ul_pm_init();\r\n}\r\nstatic void __init imx6ul_init_irq(void)\r\n{\r\nimx_init_revision_from_anatop();\r\nimx_src_init();\r\nirqchip_init();\r\nimx6_pm_ccm_init("fsl,imx6ul-ccm");\r\n}\r\nstatic void __init imx6ul_init_late(void)\r\n{\r\nif (IS_ENABLED(CONFIG_ARM_IMX6Q_CPUFREQ))\r\nplatform_device_register_simple("imx6q-cpufreq", -1, NULL, 0);\r\n}
