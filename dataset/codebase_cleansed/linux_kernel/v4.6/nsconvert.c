acpi_status\r\nacpi_ns_convert_to_integer(union acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object;\r\nacpi_status status;\r\nu64 value = 0;\r\nu32 i;\r\nswitch (original_object->common.type) {\r\ncase ACPI_TYPE_STRING:\r\nstatus = acpi_ut_strtoul64(original_object->string.pointer,\r\nACPI_ANY_BASE, &value);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (original_object->buffer.length > 8) {\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\nfor (i = 0; i < original_object->buffer.length; i++) {\r\nvalue |= ((u64)\r\noriginal_object->buffer.pointer[i] << (i *\r\n8));\r\n}\r\nbreak;\r\ndefault:\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\nnew_object = acpi_ut_create_integer_object(value);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ns_convert_to_string(union acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object;\r\nacpi_size length;\r\nacpi_status status;\r\nswitch (original_object->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nif (original_object->integer.value == 0) {\r\nnew_object = acpi_ut_create_string_object(0);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\n} else {\r\nstatus = acpi_ex_convert_to_string(original_object,\r\n&new_object,\r\nACPI_IMPLICIT_CONVERT_HEX);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nlength = 0;\r\nwhile ((length < original_object->buffer.length) &&\r\n(original_object->buffer.pointer[length])) {\r\nlength++;\r\n}\r\nnew_object = acpi_ut_create_string_object(length);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nmemcpy(new_object->string.pointer,\r\noriginal_object->buffer.pointer, length);\r\nbreak;\r\ndefault:\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ns_convert_to_buffer(union acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object;\r\nacpi_status status;\r\nunion acpi_operand_object **elements;\r\nu32 *dword_buffer;\r\nu32 count;\r\nu32 i;\r\nswitch (original_object->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nstatus =\r\nacpi_ex_convert_to_buffer(original_object, &new_object);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nnew_object = acpi_ut_create_buffer_object\r\n(original_object->string.length);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nmemcpy(new_object->buffer.pointer,\r\noriginal_object->string.pointer,\r\noriginal_object->string.length);\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nelements = original_object->package.elements;\r\ncount = original_object->package.count;\r\nfor (i = 0; i < count; i++) {\r\nif ((!*elements) ||\r\n((*elements)->common.type != ACPI_TYPE_INTEGER)) {\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\nelements++;\r\n}\r\nnew_object = acpi_ut_create_buffer_object(ACPI_MUL_4(count));\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nelements = original_object->package.elements;\r\ndword_buffer = ACPI_CAST_PTR(u32, new_object->buffer.pointer);\r\nfor (i = 0; i < count; i++) {\r\n*dword_buffer = (u32)(*elements)->integer.value;\r\ndword_buffer++;\r\nelements++;\r\n}\r\nbreak;\r\ndefault:\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ns_convert_to_unicode(struct acpi_namespace_node * scope,\r\nunion acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object;\r\nchar *ascii_string;\r\nu16 *unicode_buffer;\r\nu32 unicode_length;\r\nu32 i;\r\nif (!original_object) {\r\nreturn (AE_OK);\r\n}\r\nif (original_object->common.type == ACPI_TYPE_BUFFER) {\r\nif (original_object->buffer.length < 2) {\r\nreturn (AE_AML_OPERAND_VALUE);\r\n}\r\n*return_object = NULL;\r\nreturn (AE_OK);\r\n}\r\nascii_string = original_object->string.pointer;\r\nunicode_length = (original_object->string.length * 2) + 2;\r\nnew_object = acpi_ut_create_buffer_object(unicode_length);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nunicode_buffer = ACPI_CAST_PTR(u16, new_object->buffer.pointer);\r\nfor (i = 0; i < original_object->string.length; i++) {\r\nunicode_buffer[i] = (u16)ascii_string[i];\r\n}\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ns_convert_to_resource(struct acpi_namespace_node * scope,\r\nunion acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object;\r\nu8 *buffer;\r\nif (original_object) {\r\nswitch (original_object->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nif (original_object->integer.value) {\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (original_object->buffer.length) {\r\n*return_object = NULL;\r\nreturn (AE_OK);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\ndefault:\r\nreturn (AE_AML_OPERAND_TYPE);\r\n}\r\n}\r\nnew_object = acpi_ut_create_buffer_object(2);\r\nif (!new_object) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nbuffer = ACPI_CAST_PTR(u8, new_object->buffer.pointer);\r\nbuffer[0] = (ACPI_RESOURCE_NAME_END_TAG | ASL_RDESC_END_TAG_SIZE);\r\nbuffer[1] = 0x00;\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ns_convert_to_reference(struct acpi_namespace_node * scope,\r\nunion acpi_operand_object *original_object,\r\nunion acpi_operand_object **return_object)\r\n{\r\nunion acpi_operand_object *new_object = NULL;\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nunion acpi_generic_state scope_info;\r\nchar *name;\r\nACPI_FUNCTION_NAME(ns_convert_to_reference);\r\nstatus =\r\nacpi_ns_internalize_name(original_object->string.pointer, &name);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nscope_info.scope.node =\r\nACPI_CAST_PTR(struct acpi_namespace_node, scope);\r\nstatus =\r\nacpi_ns_lookup(&scope_info, name, ACPI_TYPE_ANY, ACPI_IMODE_EXECUTE,\r\nACPI_NS_SEARCH_PARENT | ACPI_NS_DONT_OPEN_SCOPE,\r\nNULL, &node);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_ERROR_NAMESPACE(original_object->string.pointer, status);\r\ngoto error_exit;\r\n}\r\nnew_object = acpi_ut_create_internal_object(ACPI_TYPE_LOCAL_REFERENCE);\r\nif (!new_object) {\r\nstatus = AE_NO_MEMORY;\r\ngoto error_exit;\r\n}\r\nnew_object->reference.node = node;\r\nnew_object->reference.object = node->object;\r\nnew_object->reference.class = ACPI_REFCLASS_NAME;\r\nacpi_ut_add_reference(node->object);\r\nerror_exit:\r\nACPI_FREE(name);\r\n*return_object = new_object;\r\nreturn (AE_OK);\r\n}
