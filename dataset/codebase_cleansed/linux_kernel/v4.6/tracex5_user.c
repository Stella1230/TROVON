static void install_accept_all_seccomp(void)\r\n{\r\nstruct sock_filter filter[] = {\r\nBPF_STMT(BPF_RET+BPF_K, SECCOMP_RET_ALLOW),\r\n};\r\nstruct sock_fprog prog = {\r\n.len = (unsigned short)(sizeof(filter)/sizeof(filter[0])),\r\n.filter = filter,\r\n};\r\nif (prctl(PR_SET_SECCOMP, 2, &prog))\r\nperror("prctl");\r\n}\r\nint main(int ac, char **argv)\r\n{\r\nFILE *f;\r\nchar filename[256];\r\nsnprintf(filename, sizeof(filename), "%s_kern.o", argv[0]);\r\nif (load_bpf_file(filename)) {\r\nprintf("%s", bpf_log_buf);\r\nreturn 1;\r\n}\r\ninstall_accept_all_seccomp();\r\nf = popen("dd if=/dev/zero of=/dev/null count=5", "r");\r\n(void) f;\r\nread_trace_pipe();\r\nreturn 0;\r\n}
