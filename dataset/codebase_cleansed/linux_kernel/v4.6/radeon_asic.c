static uint32_t radeon_invalid_rreg(struct radeon_device *rdev, uint32_t reg)\r\n{\r\nDRM_ERROR("Invalid callback to read register 0x%04X\n", reg);\r\nBUG_ON(1);\r\nreturn 0;\r\n}\r\nstatic void radeon_invalid_wreg(struct radeon_device *rdev, uint32_t reg, uint32_t v)\r\n{\r\nDRM_ERROR("Invalid callback to write register 0x%04X with 0x%08X\n",\r\nreg, v);\r\nBUG_ON(1);\r\n}\r\nstatic void radeon_register_accessor_init(struct radeon_device *rdev)\r\n{\r\nrdev->mc_rreg = &radeon_invalid_rreg;\r\nrdev->mc_wreg = &radeon_invalid_wreg;\r\nrdev->pll_rreg = &radeon_invalid_rreg;\r\nrdev->pll_wreg = &radeon_invalid_wreg;\r\nrdev->pciep_rreg = &radeon_invalid_rreg;\r\nrdev->pciep_wreg = &radeon_invalid_wreg;\r\nif (rdev->family < CHIP_RV515) {\r\nrdev->pcie_reg_mask = 0xff;\r\n} else {\r\nrdev->pcie_reg_mask = 0x7ff;\r\n}\r\nif (rdev->family <= CHIP_R580) {\r\nrdev->pll_rreg = &r100_pll_rreg;\r\nrdev->pll_wreg = &r100_pll_wreg;\r\n}\r\nif (rdev->family >= CHIP_R420) {\r\nrdev->mc_rreg = &r420_mc_rreg;\r\nrdev->mc_wreg = &r420_mc_wreg;\r\n}\r\nif (rdev->family >= CHIP_RV515) {\r\nrdev->mc_rreg = &rv515_mc_rreg;\r\nrdev->mc_wreg = &rv515_mc_wreg;\r\n}\r\nif (rdev->family == CHIP_RS400 || rdev->family == CHIP_RS480) {\r\nrdev->mc_rreg = &rs400_mc_rreg;\r\nrdev->mc_wreg = &rs400_mc_wreg;\r\n}\r\nif (rdev->family == CHIP_RS690 || rdev->family == CHIP_RS740) {\r\nrdev->mc_rreg = &rs690_mc_rreg;\r\nrdev->mc_wreg = &rs690_mc_wreg;\r\n}\r\nif (rdev->family == CHIP_RS600) {\r\nrdev->mc_rreg = &rs600_mc_rreg;\r\nrdev->mc_wreg = &rs600_mc_wreg;\r\n}\r\nif (rdev->family == CHIP_RS780 || rdev->family == CHIP_RS880) {\r\nrdev->mc_rreg = &rs780_mc_rreg;\r\nrdev->mc_wreg = &rs780_mc_wreg;\r\n}\r\nif (rdev->family >= CHIP_BONAIRE) {\r\nrdev->pciep_rreg = &cik_pciep_rreg;\r\nrdev->pciep_wreg = &cik_pciep_wreg;\r\n} else if (rdev->family >= CHIP_R600) {\r\nrdev->pciep_rreg = &r600_pciep_rreg;\r\nrdev->pciep_wreg = &r600_pciep_wreg;\r\n}\r\n}\r\nstatic int radeon_invalid_get_allowed_info_register(struct radeon_device *rdev,\r\nu32 reg, u32 *val)\r\n{\r\nreturn -EINVAL;\r\n}\r\nvoid radeon_agp_disable(struct radeon_device *rdev)\r\n{\r\nrdev->flags &= ~RADEON_IS_AGP;\r\nif (rdev->family >= CHIP_R600) {\r\nDRM_INFO("Forcing AGP to PCIE mode\n");\r\nrdev->flags |= RADEON_IS_PCIE;\r\n} else if (rdev->family >= CHIP_RV515 ||\r\nrdev->family == CHIP_RV380 ||\r\nrdev->family == CHIP_RV410 ||\r\nrdev->family == CHIP_R423) {\r\nDRM_INFO("Forcing AGP to PCIE mode\n");\r\nrdev->flags |= RADEON_IS_PCIE;\r\nrdev->asic->gart.tlb_flush = &rv370_pcie_gart_tlb_flush;\r\nrdev->asic->gart.get_page_entry = &rv370_pcie_gart_get_page_entry;\r\nrdev->asic->gart.set_page = &rv370_pcie_gart_set_page;\r\n} else {\r\nDRM_INFO("Forcing AGP to PCI mode\n");\r\nrdev->flags |= RADEON_IS_PCI;\r\nrdev->asic->gart.tlb_flush = &r100_pci_gart_tlb_flush;\r\nrdev->asic->gart.get_page_entry = &r100_pci_gart_get_page_entry;\r\nrdev->asic->gart.set_page = &r100_pci_gart_set_page;\r\n}\r\nrdev->mc.gtt_size = radeon_gart_size * 1024 * 1024;\r\n}\r\nint radeon_asic_init(struct radeon_device *rdev)\r\n{\r\nradeon_register_accessor_init(rdev);\r\nif (rdev->flags & RADEON_SINGLE_CRTC)\r\nrdev->num_crtc = 1;\r\nelse\r\nrdev->num_crtc = 2;\r\nrdev->has_uvd = false;\r\nswitch (rdev->family) {\r\ncase CHIP_R100:\r\ncase CHIP_RV100:\r\ncase CHIP_RS100:\r\ncase CHIP_RV200:\r\ncase CHIP_RS200:\r\nrdev->asic = &r100_asic;\r\nbreak;\r\ncase CHIP_R200:\r\ncase CHIP_RV250:\r\ncase CHIP_RS300:\r\ncase CHIP_RV280:\r\nrdev->asic = &r200_asic;\r\nbreak;\r\ncase CHIP_R300:\r\ncase CHIP_R350:\r\ncase CHIP_RV350:\r\ncase CHIP_RV380:\r\nif (rdev->flags & RADEON_IS_PCIE)\r\nrdev->asic = &r300_asic_pcie;\r\nelse\r\nrdev->asic = &r300_asic;\r\nbreak;\r\ncase CHIP_R420:\r\ncase CHIP_R423:\r\ncase CHIP_RV410:\r\nrdev->asic = &r420_asic;\r\nif (rdev->bios == NULL) {\r\nrdev->asic->pm.get_engine_clock = &radeon_legacy_get_engine_clock;\r\nrdev->asic->pm.set_engine_clock = &radeon_legacy_set_engine_clock;\r\nrdev->asic->pm.get_memory_clock = &radeon_legacy_get_memory_clock;\r\nrdev->asic->pm.set_memory_clock = NULL;\r\nrdev->asic->display.set_backlight_level = &radeon_legacy_set_backlight_level;\r\n}\r\nbreak;\r\ncase CHIP_RS400:\r\ncase CHIP_RS480:\r\nrdev->asic = &rs400_asic;\r\nbreak;\r\ncase CHIP_RS600:\r\nrdev->asic = &rs600_asic;\r\nbreak;\r\ncase CHIP_RS690:\r\ncase CHIP_RS740:\r\nrdev->asic = &rs690_asic;\r\nbreak;\r\ncase CHIP_RV515:\r\nrdev->asic = &rv515_asic;\r\nbreak;\r\ncase CHIP_R520:\r\ncase CHIP_RV530:\r\ncase CHIP_RV560:\r\ncase CHIP_RV570:\r\ncase CHIP_R580:\r\nrdev->asic = &r520_asic;\r\nbreak;\r\ncase CHIP_R600:\r\nrdev->asic = &r600_asic;\r\nbreak;\r\ncase CHIP_RV610:\r\ncase CHIP_RV630:\r\ncase CHIP_RV620:\r\ncase CHIP_RV635:\r\ncase CHIP_RV670:\r\nrdev->asic = &rv6xx_asic;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_RS780:\r\ncase CHIP_RS880:\r\nrdev->asic = &rs780_asic;\r\nif ((rdev->pdev->device == 0x9616)||\r\n(rdev->pdev->device == 0x9611)||\r\n(rdev->pdev->device == 0x9613)||\r\n(rdev->pdev->device == 0x9711)||\r\n(rdev->pdev->device == 0x9713))\r\nrdev->has_uvd = false;\r\nelse\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_RV770:\r\ncase CHIP_RV730:\r\ncase CHIP_RV710:\r\ncase CHIP_RV740:\r\nrdev->asic = &rv770_asic;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_CEDAR:\r\ncase CHIP_REDWOOD:\r\ncase CHIP_JUNIPER:\r\ncase CHIP_CYPRESS:\r\ncase CHIP_HEMLOCK:\r\nif (rdev->family == CHIP_CEDAR)\r\nrdev->num_crtc = 4;\r\nelse\r\nrdev->num_crtc = 6;\r\nrdev->asic = &evergreen_asic;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_PALM:\r\ncase CHIP_SUMO:\r\ncase CHIP_SUMO2:\r\nrdev->asic = &sumo_asic;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_BARTS:\r\ncase CHIP_TURKS:\r\ncase CHIP_CAICOS:\r\nif (rdev->family == CHIP_CAICOS)\r\nrdev->num_crtc = 4;\r\nelse\r\nrdev->num_crtc = 6;\r\nrdev->asic = &btc_asic;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_CAYMAN:\r\nrdev->asic = &cayman_asic;\r\nrdev->num_crtc = 6;\r\nrdev->has_uvd = true;\r\nbreak;\r\ncase CHIP_ARUBA:\r\nrdev->asic = &trinity_asic;\r\nrdev->num_crtc = 4;\r\nrdev->has_uvd = true;\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_VCE_MGCG;\r\nbreak;\r\ncase CHIP_TAHITI:\r\ncase CHIP_PITCAIRN:\r\ncase CHIP_VERDE:\r\ncase CHIP_OLAND:\r\ncase CHIP_HAINAN:\r\nrdev->asic = &si_asic;\r\nif (rdev->family == CHIP_HAINAN)\r\nrdev->num_crtc = 0;\r\nelse if (rdev->family == CHIP_OLAND)\r\nrdev->num_crtc = 2;\r\nelse\r\nrdev->num_crtc = 6;\r\nif (rdev->family == CHIP_HAINAN)\r\nrdev->has_uvd = false;\r\nelse\r\nrdev->has_uvd = true;\r\nswitch (rdev->family) {\r\ncase CHIP_TAHITI:\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\nbreak;\r\ncase CHIP_PITCAIRN:\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_GFX_RLC_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\nbreak;\r\ncase CHIP_VERDE:\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_GFX_RLC_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0 |\r\nRADEON_PG_SUPPORT_SDMA;\r\nbreak;\r\ncase CHIP_OLAND:\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_GFX_RLC_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\nbreak;\r\ncase CHIP_HAINAN:\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_GFX_RLC_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\nbreak;\r\ndefault:\r\nrdev->cg_flags = 0;\r\nrdev->pg_flags = 0;\r\nbreak;\r\n}\r\nbreak;\r\ncase CHIP_BONAIRE:\r\ncase CHIP_HAWAII:\r\nrdev->asic = &ci_asic;\r\nrdev->num_crtc = 6;\r\nrdev->has_uvd = true;\r\nif (rdev->family == CHIP_BONAIRE) {\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CGTS_LS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_LS |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\n} else {\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_MC_LS |\r\nRADEON_CG_SUPPORT_MC_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_LS |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\n}\r\nbreak;\r\ncase CHIP_KAVERI:\r\ncase CHIP_KABINI:\r\ncase CHIP_MULLINS:\r\nrdev->asic = &kv_asic;\r\nif (rdev->family == CHIP_KAVERI) {\r\nrdev->num_crtc = 4;\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CGTS_LS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_LS |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\n} else {\r\nrdev->num_crtc = 2;\r\nrdev->cg_flags =\r\nRADEON_CG_SUPPORT_GFX_MGCG |\r\nRADEON_CG_SUPPORT_GFX_MGLS |\r\nRADEON_CG_SUPPORT_GFX_CGLS |\r\nRADEON_CG_SUPPORT_GFX_CGTS |\r\nRADEON_CG_SUPPORT_GFX_CGTS_LS |\r\nRADEON_CG_SUPPORT_GFX_CP_LS |\r\nRADEON_CG_SUPPORT_SDMA_MGCG |\r\nRADEON_CG_SUPPORT_SDMA_LS |\r\nRADEON_CG_SUPPORT_BIF_LS |\r\nRADEON_CG_SUPPORT_VCE_MGCG |\r\nRADEON_CG_SUPPORT_UVD_MGCG |\r\nRADEON_CG_SUPPORT_HDP_LS |\r\nRADEON_CG_SUPPORT_HDP_MGCG;\r\nrdev->pg_flags = 0;\r\n}\r\nrdev->has_uvd = true;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nif (rdev->flags & RADEON_IS_IGP) {\r\nrdev->asic->pm.get_memory_clock = NULL;\r\nrdev->asic->pm.set_memory_clock = NULL;\r\n}\r\nreturn 0;\r\n}
