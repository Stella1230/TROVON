void arc_init_IRQ(void)\r\n{\r\nint level_mask = 0;\r\nlevel_mask |= IS_ENABLED(CONFIG_ARC_IRQ3_LV2) << 3;\r\nlevel_mask |= IS_ENABLED(CONFIG_ARC_IRQ5_LV2) << 5;\r\nlevel_mask |= IS_ENABLED(CONFIG_ARC_IRQ6_LV2) << 6;\r\nwrite_aux_reg(AUX_IRQ_LEV, level_mask);\r\nif (level_mask)\r\npr_info("Level-2 interrupts bitset %x\n", level_mask);\r\n}\r\nstatic void arc_irq_mask(struct irq_data *data)\r\n{\r\nunsigned int ienb;\r\nienb = read_aux_reg(AUX_IENABLE);\r\nienb &= ~(1 << data->irq);\r\nwrite_aux_reg(AUX_IENABLE, ienb);\r\n}\r\nstatic void arc_irq_unmask(struct irq_data *data)\r\n{\r\nunsigned int ienb;\r\nienb = read_aux_reg(AUX_IENABLE);\r\nienb |= (1 << data->irq);\r\nwrite_aux_reg(AUX_IENABLE, ienb);\r\n}\r\nstatic int arc_intc_domain_map(struct irq_domain *d, unsigned int irq,\r\nirq_hw_number_t hw)\r\n{\r\nswitch (irq) {\r\ncase TIMER0_IRQ:\r\nirq_set_chip_and_handler(irq, &onchip_intc, handle_percpu_irq);\r\nbreak;\r\ndefault:\r\nirq_set_chip_and_handler(irq, &onchip_intc, handle_level_irq);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init\r\ninit_onchip_IRQ(struct device_node *intc, struct device_node *parent)\r\n{\r\nif (parent)\r\npanic("DeviceTree incore intc not a root irq controller\n");\r\nroot_domain = irq_domain_add_legacy(intc, NR_CPU_IRQS, 0, 0,\r\n&arc_intc_domain_ops, NULL);\r\nif (!root_domain)\r\npanic("root irq domain not avail\n");\r\nirq_set_default_host(root_domain);\r\nreturn 0;\r\n}\r\nvoid arch_local_irq_enable(void)\r\n{\r\nunsigned long flags = arch_local_save_flags();\r\nif (flags & STATUS_A2_MASK)\r\nflags |= STATUS_E2_MASK;\r\nelse if (flags & STATUS_A1_MASK)\r\nflags |= STATUS_E1_MASK;\r\narch_local_irq_restore(flags);\r\n}
