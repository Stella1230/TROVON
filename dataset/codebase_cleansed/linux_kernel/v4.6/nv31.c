static void\r\nnv31_bus_intr(struct nvkm_bus *bus)\r\n{\r\nstruct nvkm_subdev *subdev = &bus->subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nu32 stat = nvkm_rd32(device, 0x001100) & nvkm_rd32(device, 0x001140);\r\nu32 gpio = nvkm_rd32(device, 0x001104) & nvkm_rd32(device, 0x001144);\r\nif (gpio) {\r\nstruct nvkm_gpio *gpio = device->gpio;\r\nif (gpio)\r\nnvkm_subdev_intr(&gpio->subdev);\r\n}\r\nif (stat & 0x00000008) {\r\nu32 addr = nvkm_rd32(device, 0x009084);\r\nu32 data = nvkm_rd32(device, 0x009088);\r\nnvkm_error(subdev, "MMIO %s of %08x FAULT at %06x\n",\r\n(addr & 0x00000002) ? "write" : "read", data,\r\n(addr & 0x00fffffc));\r\nstat &= ~0x00000008;\r\nnvkm_wr32(device, 0x001100, 0x00000008);\r\n}\r\nif (stat & 0x00070000) {\r\nstruct nvkm_therm *therm = device->therm;\r\nif (therm)\r\nnvkm_subdev_intr(&therm->subdev);\r\nstat &= ~0x00070000;\r\nnvkm_wr32(device, 0x001100, 0x00070000);\r\n}\r\nif (stat) {\r\nnvkm_error(subdev, "intr %08x\n", stat);\r\nnvkm_mask(device, 0x001140, stat, 0x00000000);\r\n}\r\n}\r\nstatic void\r\nnv31_bus_init(struct nvkm_bus *bus)\r\n{\r\nstruct nvkm_device *device = bus->subdev.device;\r\nnvkm_wr32(device, 0x001100, 0xffffffff);\r\nnvkm_wr32(device, 0x001140, 0x00070008);\r\n}\r\nint\r\nnv31_bus_new(struct nvkm_device *device, int index, struct nvkm_bus **pbus)\r\n{\r\nreturn nvkm_bus_new_(&nv31_bus, device, index, pbus);\r\n}
