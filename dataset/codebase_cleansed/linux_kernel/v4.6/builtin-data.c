static void print_usage(void)\r\n{\r\nstruct data_cmd *cmd;\r\nprintf("Usage:\n");\r\nprintf("\t%s\n\n", data_usage[0]);\r\nprintf("\tAvailable commands:\n");\r\nfor_each_cmd(cmd) {\r\nprintf("\t %s\t- %s\n", cmd->name, cmd->summary);\r\n}\r\nprintf("\n");\r\n}\r\nstatic int cmd_data_convert(int argc, const char **argv,\r\nconst char *prefix __maybe_unused)\r\n{\r\nconst char *to_ctf = NULL;\r\nbool force = false;\r\nconst struct option options[] = {\r\nOPT_INCR('v', "verbose", &verbose, "be more verbose"),\r\nOPT_STRING('i', "input", &input_name, "file", "input file name"),\r\n#ifdef HAVE_LIBBABELTRACE_SUPPORT\r\nOPT_STRING(0, "to-ctf", &to_ctf, NULL, "Convert to CTF format"),\r\n#endif\r\nOPT_BOOLEAN('f', "force", &force, "don't complain, do it"),\r\nOPT_END()\r\n};\r\n#ifndef HAVE_LIBBABELTRACE_SUPPORT\r\npr_err("No conversion support compiled in.\n");\r\nreturn -1;\r\n#endif\r\nargc = parse_options(argc, argv, options,\r\ndata_convert_usage, 0);\r\nif (argc) {\r\nusage_with_options(data_convert_usage, options);\r\nreturn -1;\r\n}\r\nif (to_ctf) {\r\n#ifdef HAVE_LIBBABELTRACE_SUPPORT\r\nreturn bt_convert__perf2ctf(input_name, to_ctf, force);\r\n#else\r\npr_err("The libbabeltrace support is not compiled in.\n");\r\nreturn -1;\r\n#endif\r\n}\r\nreturn 0;\r\n}\r\nint cmd_data(int argc, const char **argv, const char *prefix)\r\n{\r\nstruct data_cmd *cmd;\r\nconst char *cmdstr;\r\nif (argc < 2)\r\ngoto usage;\r\nargc = parse_options_subcommand(argc, argv, data_options, data_subcommands, data_usage,\r\nPARSE_OPT_STOP_AT_NON_OPTION);\r\nif (argc < 1)\r\ngoto usage;\r\ncmdstr = argv[0];\r\nfor_each_cmd(cmd) {\r\nif (strcmp(cmd->name, cmdstr))\r\ncontinue;\r\nreturn cmd->fn(argc, argv, prefix);\r\n}\r\npr_err("Unknown command: %s\n", cmdstr);\r\nusage:\r\nprint_usage();\r\nreturn -1;\r\n}
