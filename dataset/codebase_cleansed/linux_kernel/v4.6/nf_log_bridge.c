static void nf_log_bridge_packet(struct net *net, u_int8_t pf,\r\nunsigned int hooknum,\r\nconst struct sk_buff *skb,\r\nconst struct net_device *in,\r\nconst struct net_device *out,\r\nconst struct nf_loginfo *loginfo,\r\nconst char *prefix)\r\n{\r\nswitch (eth_hdr(skb)->h_proto) {\r\ncase htons(ETH_P_IP):\r\nnf_log_packet(net, NFPROTO_IPV4, hooknum, skb, in, out,\r\nloginfo, "%s", prefix);\r\nbreak;\r\ncase htons(ETH_P_IPV6):\r\nnf_log_packet(net, NFPROTO_IPV6, hooknum, skb, in, out,\r\nloginfo, "%s", prefix);\r\nbreak;\r\ncase htons(ETH_P_ARP):\r\ncase htons(ETH_P_RARP):\r\nnf_log_packet(net, NFPROTO_ARP, hooknum, skb, in, out,\r\nloginfo, "%s", prefix);\r\nbreak;\r\n}\r\n}\r\nstatic int __net_init nf_log_bridge_net_init(struct net *net)\r\n{\r\nnf_log_set(net, NFPROTO_BRIDGE, &nf_bridge_logger);\r\nreturn 0;\r\n}\r\nstatic void __net_exit nf_log_bridge_net_exit(struct net *net)\r\n{\r\nnf_log_unset(net, &nf_bridge_logger);\r\n}\r\nstatic int __init nf_log_bridge_init(void)\r\n{\r\nint ret;\r\nnf_logger_request_module(NFPROTO_IPV4, NF_LOG_TYPE_LOG);\r\nnf_logger_request_module(NFPROTO_IPV6, NF_LOG_TYPE_LOG);\r\nnf_logger_request_module(NFPROTO_ARP, NF_LOG_TYPE_LOG);\r\nret = register_pernet_subsys(&nf_log_bridge_net_ops);\r\nif (ret < 0)\r\nreturn ret;\r\nnf_log_register(NFPROTO_BRIDGE, &nf_bridge_logger);\r\nreturn 0;\r\n}\r\nstatic void __exit nf_log_bridge_exit(void)\r\n{\r\nunregister_pernet_subsys(&nf_log_bridge_net_ops);\r\nnf_log_unregister(&nf_bridge_logger);\r\n}
