static int innovator_get_pendown_state(void)\r\n{\r\nreturn !(__raw_readb(OMAP1510_FPGA_TOUCHSCREEN) & (1 << 5));\r\n}\r\nstatic void __init innovator_init_smc91x(void)\r\n{\r\nif (cpu_is_omap1510()) {\r\n__raw_writeb(__raw_readb(OMAP1510_FPGA_RST) & ~1,\r\nOMAP1510_FPGA_RST);\r\nudelay(750);\r\n} else {\r\nif (gpio_request(0, "SMC91x irq") < 0) {\r\nprintk("Error requesting gpio 0 for smc91x irq\n");\r\nreturn;\r\n}\r\n}\r\n}\r\nstatic int mmc_set_power(struct device *dev, int slot, int power_on,\r\nint vdd)\r\n{\r\nif (power_on)\r\n__raw_writeb(__raw_readb(OMAP1510_FPGA_POWER) | (1 << 3),\r\nOMAP1510_FPGA_POWER);\r\nelse\r\n__raw_writeb(__raw_readb(OMAP1510_FPGA_POWER) & ~(1 << 3),\r\nOMAP1510_FPGA_POWER);\r\nreturn 0;\r\n}\r\nstatic void __init innovator_mmc_init(void)\r\n{\r\nmmc_data[0] = &mmc1_data;\r\nomap1_init_mmc(mmc_data, OMAP15XX_NR_MMC);\r\n}\r\nstatic inline void innovator_mmc_init(void)\r\n{\r\n}\r\nstatic void __init innovator_init(void)\r\n{\r\nif (cpu_is_omap1510())\r\nomap1510_fpga_init_irq();\r\ninnovator_init_smc91x();\r\n#ifdef CONFIG_ARCH_OMAP15XX\r\nif (cpu_is_omap1510()) {\r\nunsigned char reg;\r\nomap_cfg_reg(UART1_TX);\r\nomap_cfg_reg(UART1_RTS);\r\nomap_cfg_reg(UART2_TX);\r\nomap_cfg_reg(UART2_RTS);\r\nomap_cfg_reg(UART3_TX);\r\nomap_cfg_reg(UART3_RX);\r\nreg = __raw_readb(OMAP1510_FPGA_POWER);\r\nreg |= OMAP1510_FPGA_PCR_COM1_EN;\r\n__raw_writeb(reg, OMAP1510_FPGA_POWER);\r\nudelay(10);\r\nreg = __raw_readb(OMAP1510_FPGA_POWER);\r\nreg |= OMAP1510_FPGA_PCR_COM2_EN;\r\n__raw_writeb(reg, OMAP1510_FPGA_POWER);\r\nudelay(10);\r\nplatform_add_devices(innovator1510_devices, ARRAY_SIZE(innovator1510_devices));\r\nspi_register_board_info(innovator1510_boardinfo,\r\nARRAY_SIZE(innovator1510_boardinfo));\r\n}\r\n#endif\r\n#ifdef CONFIG_ARCH_OMAP16XX\r\nif (!cpu_is_omap1510()) {\r\ninnovator1610_smc91x_resources[1].start = gpio_to_irq(0);\r\ninnovator1610_smc91x_resources[1].end = gpio_to_irq(0);\r\nplatform_add_devices(innovator1610_devices, ARRAY_SIZE(innovator1610_devices));\r\n}\r\n#endif\r\n#ifdef CONFIG_ARCH_OMAP15XX\r\nif (cpu_is_omap1510()) {\r\nomap1_usb_init(&innovator1510_usb_config);\r\nomapfb_set_lcd_config(&innovator1510_lcd_config);\r\n}\r\n#endif\r\n#ifdef CONFIG_ARCH_OMAP16XX\r\nif (cpu_is_omap1610()) {\r\nomap1_usb_init(&h2_usb_config);\r\nomapfb_set_lcd_config(&innovator1610_lcd_config);\r\n}\r\n#endif\r\nomap_serial_init();\r\nomap_register_i2c_bus(1, 100, NULL, 0);\r\ninnovator_mmc_init();\r\n}\r\nstatic void __init innovator_map_io(void)\r\n{\r\n#ifdef CONFIG_ARCH_OMAP15XX\r\nomap15xx_map_io();\r\niotable_init(innovator1510_io_desc, ARRAY_SIZE(innovator1510_io_desc));\r\nudelay(10);\r\npr_debug("Innovator FPGA Rev %d.%d Board Rev %d\n",\r\n__raw_readb(OMAP1510_FPGA_REV_HIGH),\r\n__raw_readb(OMAP1510_FPGA_REV_LOW),\r\n__raw_readb(OMAP1510_FPGA_BOARD_REV));\r\n#endif\r\n}
