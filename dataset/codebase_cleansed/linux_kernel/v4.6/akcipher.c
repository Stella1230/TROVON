static int crypto_akcipher_report(struct sk_buff *skb, struct crypto_alg *alg)\r\n{\r\nstruct crypto_report_akcipher rakcipher;\r\nstrncpy(rakcipher.type, "akcipher", sizeof(rakcipher.type));\r\nif (nla_put(skb, CRYPTOCFGA_REPORT_AKCIPHER,\r\nsizeof(struct crypto_report_akcipher), &rakcipher))\r\ngoto nla_put_failure;\r\nreturn 0;\r\nnla_put_failure:\r\nreturn -EMSGSIZE;\r\n}\r\nstatic int crypto_akcipher_report(struct sk_buff *skb, struct crypto_alg *alg)\r\n{\r\nreturn -ENOSYS;\r\n}\r\nstatic void crypto_akcipher_show(struct seq_file *m, struct crypto_alg *alg)\r\n{\r\nseq_puts(m, "type : akcipher\n");\r\n}\r\nstatic void crypto_akcipher_exit_tfm(struct crypto_tfm *tfm)\r\n{\r\nstruct crypto_akcipher *akcipher = __crypto_akcipher_tfm(tfm);\r\nstruct akcipher_alg *alg = crypto_akcipher_alg(akcipher);\r\nalg->exit(akcipher);\r\n}\r\nstatic int crypto_akcipher_init_tfm(struct crypto_tfm *tfm)\r\n{\r\nstruct crypto_akcipher *akcipher = __crypto_akcipher_tfm(tfm);\r\nstruct akcipher_alg *alg = crypto_akcipher_alg(akcipher);\r\nif (alg->exit)\r\nakcipher->base.exit = crypto_akcipher_exit_tfm;\r\nif (alg->init)\r\nreturn alg->init(akcipher);\r\nreturn 0;\r\n}\r\nstatic void crypto_akcipher_free_instance(struct crypto_instance *inst)\r\n{\r\nstruct akcipher_instance *akcipher = akcipher_instance(inst);\r\nakcipher->free(akcipher);\r\n}\r\nint crypto_grab_akcipher(struct crypto_akcipher_spawn *spawn, const char *name,\r\nu32 type, u32 mask)\r\n{\r\nspawn->base.frontend = &crypto_akcipher_type;\r\nreturn crypto_grab_spawn(&spawn->base, name, type, mask);\r\n}\r\nstruct crypto_akcipher *crypto_alloc_akcipher(const char *alg_name, u32 type,\r\nu32 mask)\r\n{\r\nreturn crypto_alloc_tfm(alg_name, &crypto_akcipher_type, type, mask);\r\n}\r\nstatic void akcipher_prepare_alg(struct akcipher_alg *alg)\r\n{\r\nstruct crypto_alg *base = &alg->base;\r\nbase->cra_type = &crypto_akcipher_type;\r\nbase->cra_flags &= ~CRYPTO_ALG_TYPE_MASK;\r\nbase->cra_flags |= CRYPTO_ALG_TYPE_AKCIPHER;\r\n}\r\nint crypto_register_akcipher(struct akcipher_alg *alg)\r\n{\r\nstruct crypto_alg *base = &alg->base;\r\nakcipher_prepare_alg(alg);\r\nreturn crypto_register_alg(base);\r\n}\r\nvoid crypto_unregister_akcipher(struct akcipher_alg *alg)\r\n{\r\ncrypto_unregister_alg(&alg->base);\r\n}\r\nint akcipher_register_instance(struct crypto_template *tmpl,\r\nstruct akcipher_instance *inst)\r\n{\r\nakcipher_prepare_alg(&inst->alg);\r\nreturn crypto_register_instance(tmpl, akcipher_crypto_instance(inst));\r\n}
