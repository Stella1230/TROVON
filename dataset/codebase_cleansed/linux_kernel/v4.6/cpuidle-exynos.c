static int exynos_enter_coupled_lowpower(struct cpuidle_device *dev,\r\nstruct cpuidle_driver *drv,\r\nint index)\r\n{\r\nint ret;\r\nexynos_cpuidle_pdata->pre_enter_aftr();\r\ncpuidle_coupled_parallel_barrier(dev, &exynos_idle_barrier);\r\nret = dev->cpu ? exynos_cpuidle_pdata->cpu1_powerdown()\r\n: exynos_cpuidle_pdata->cpu0_enter_aftr();\r\nif (ret)\r\nindex = ret;\r\ncpuidle_coupled_parallel_barrier(dev, &exynos_idle_barrier);\r\nexynos_cpuidle_pdata->post_enter_aftr();\r\nreturn index;\r\n}\r\nstatic int exynos_enter_lowpower(struct cpuidle_device *dev,\r\nstruct cpuidle_driver *drv,\r\nint index)\r\n{\r\nint new_index = index;\r\nif (num_online_cpus() > 1 || dev->cpu != 0)\r\nnew_index = drv->safe_state_index;\r\nif (new_index == 0)\r\nreturn arm_cpuidle_simple_enter(dev, drv, new_index);\r\nexynos_enter_aftr();\r\nreturn new_index;\r\n}\r\nstatic int exynos_cpuidle_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nif (IS_ENABLED(CONFIG_SMP) &&\r\nof_machine_is_compatible("samsung,exynos4210")) {\r\nexynos_cpuidle_pdata = pdev->dev.platform_data;\r\nret = cpuidle_register(&exynos_coupled_idle_driver,\r\ncpu_possible_mask);\r\n} else {\r\nexynos_enter_aftr = (void *)(pdev->dev.platform_data);\r\nret = cpuidle_register(&exynos_idle_driver, NULL);\r\n}\r\nif (ret) {\r\ndev_err(&pdev->dev, "failed to register cpuidle driver\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
