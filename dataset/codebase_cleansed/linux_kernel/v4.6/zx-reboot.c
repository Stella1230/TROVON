static int zx_restart_handler(struct notifier_block *this,\r\nunsigned long mode, void *cmd)\r\n{\r\nwritel_relaxed(1, base + 0xb0);\r\nwritel_relaxed(1, pcu_base + 0x34);\r\nmdelay(50);\r\npr_emerg("Unable to restart system\n");\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int zx_reboot_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nint err;\r\nbase = of_iomap(np, 0);\r\nif (!base) {\r\nWARN(1, "failed to map base address");\r\nreturn -ENODEV;\r\n}\r\nnp = of_find_compatible_node(NULL, NULL, "zte,zx296702-pcu");\r\npcu_base = of_iomap(np, 0);\r\nif (!pcu_base) {\r\niounmap(base);\r\nWARN(1, "failed to map pcu_base address");\r\nreturn -ENODEV;\r\n}\r\nerr = register_restart_handler(&zx_restart_nb);\r\nif (err)\r\ndev_err(&pdev->dev, "Register restart handler failed(err=%d)\n",\r\nerr);\r\nreturn err;\r\n}
