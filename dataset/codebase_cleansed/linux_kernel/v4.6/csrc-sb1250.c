static inline cycle_t sb1250_hpt_get_cycles(void)\r\n{\r\nunsigned int count;\r\nvoid __iomem *addr;\r\naddr = IOADDR(A_SCD_TIMER_REGISTER(SB1250_HPT_NUM, R_SCD_TIMER_CNT));\r\ncount = G_SCD_TIMER_CNT(__raw_readq(addr));\r\nreturn SB1250_HPT_VALUE - count;\r\n}\r\nstatic cycle_t sb1250_hpt_read(struct clocksource *cs)\r\n{\r\nreturn sb1250_hpt_get_cycles();\r\n}\r\nstatic u64 notrace sb1250_read_sched_clock(void)\r\n{\r\nreturn sb1250_hpt_get_cycles();\r\n}\r\nvoid __init sb1250_clocksource_init(void)\r\n{\r\nstruct clocksource *cs = &bcm1250_clocksource;\r\n__raw_writeq(0,\r\nIOADDR(A_SCD_TIMER_REGISTER(SB1250_HPT_NUM,\r\nR_SCD_TIMER_CFG)));\r\n__raw_writeq(SB1250_HPT_VALUE,\r\nIOADDR(A_SCD_TIMER_REGISTER(SB1250_HPT_NUM,\r\nR_SCD_TIMER_INIT)));\r\n__raw_writeq(M_SCD_TIMER_ENABLE | M_SCD_TIMER_MODE_CONTINUOUS,\r\nIOADDR(A_SCD_TIMER_REGISTER(SB1250_HPT_NUM,\r\nR_SCD_TIMER_CFG)));\r\nclocksource_register_hz(cs, V_SCD_TIMER_FREQ);\r\nsched_clock_register(sb1250_read_sched_clock, 23, V_SCD_TIMER_FREQ);\r\n}
