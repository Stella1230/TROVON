int p9_error_init(void)\r\n{\r\nstruct errormap *c;\r\nint bucket;\r\nfor (bucket = 0; bucket < ERRHASHSZ; bucket++)\r\nINIT_HLIST_HEAD(&hash_errmap[bucket]);\r\nfor (c = errmap; c->name != NULL; c++) {\r\nc->namelen = strlen(c->name);\r\nbucket = jhash(c->name, c->namelen, 0) % ERRHASHSZ;\r\nINIT_HLIST_NODE(&c->list);\r\nhlist_add_head(&c->list, &hash_errmap[bucket]);\r\n}\r\nreturn 1;\r\n}\r\nint p9_errstr2errno(char *errstr, int len)\r\n{\r\nint errno;\r\nstruct errormap *c;\r\nint bucket;\r\nerrno = 0;\r\nc = NULL;\r\nbucket = jhash(errstr, len, 0) % ERRHASHSZ;\r\nhlist_for_each_entry(c, &hash_errmap[bucket], list) {\r\nif (c->namelen == len && !memcmp(c->name, errstr, len)) {\r\nerrno = c->val;\r\nbreak;\r\n}\r\n}\r\nif (errno == 0) {\r\nerrstr[len] = 0;\r\npr_err("%s: server reported unknown error %s\n",\r\n__func__, errstr);\r\nerrno = ESERVERFAULT;\r\n}\r\nreturn -errno;\r\n}
