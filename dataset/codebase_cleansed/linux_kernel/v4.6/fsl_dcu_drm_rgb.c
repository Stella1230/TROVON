static int\r\nfsl_dcu_drm_encoder_atomic_check(struct drm_encoder *encoder,\r\nstruct drm_crtc_state *crtc_state,\r\nstruct drm_connector_state *conn_state)\r\n{\r\nreturn 0;\r\n}\r\nstatic void fsl_dcu_drm_encoder_disable(struct drm_encoder *encoder)\r\n{\r\n}\r\nstatic void fsl_dcu_drm_encoder_enable(struct drm_encoder *encoder)\r\n{\r\n}\r\nstatic void fsl_dcu_drm_encoder_destroy(struct drm_encoder *encoder)\r\n{\r\ndrm_encoder_cleanup(encoder);\r\n}\r\nint fsl_dcu_drm_encoder_create(struct fsl_dcu_drm_device *fsl_dev,\r\nstruct drm_crtc *crtc)\r\n{\r\nstruct drm_encoder *encoder = &fsl_dev->encoder;\r\nint ret;\r\nencoder->possible_crtcs = 1;\r\nret = drm_encoder_init(fsl_dev->drm, encoder, &encoder_funcs,\r\nDRM_MODE_ENCODER_LVDS, NULL);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_encoder_helper_add(encoder, &encoder_helper_funcs);\r\nreturn 0;\r\n}\r\nstatic void fsl_dcu_drm_connector_destroy(struct drm_connector *connector)\r\n{\r\ndrm_connector_unregister(connector);\r\ndrm_connector_cleanup(connector);\r\n}\r\nstatic enum drm_connector_status\r\nfsl_dcu_drm_connector_detect(struct drm_connector *connector, bool force)\r\n{\r\nreturn connector_status_connected;\r\n}\r\nstatic struct drm_encoder *\r\nfsl_dcu_drm_connector_best_encoder(struct drm_connector *connector)\r\n{\r\nstruct fsl_dcu_drm_connector *fsl_con = to_fsl_dcu_connector(connector);\r\nreturn fsl_con->encoder;\r\n}\r\nstatic int fsl_dcu_drm_connector_get_modes(struct drm_connector *connector)\r\n{\r\nstruct fsl_dcu_drm_connector *fsl_connector;\r\nint (*get_modes)(struct drm_panel *panel);\r\nint num_modes = 0;\r\nfsl_connector = to_fsl_dcu_connector(connector);\r\nif (fsl_connector->panel && fsl_connector->panel->funcs &&\r\nfsl_connector->panel->funcs->get_modes) {\r\nget_modes = fsl_connector->panel->funcs->get_modes;\r\nnum_modes = get_modes(fsl_connector->panel);\r\n}\r\nreturn num_modes;\r\n}\r\nstatic int fsl_dcu_drm_connector_mode_valid(struct drm_connector *connector,\r\nstruct drm_display_mode *mode)\r\n{\r\nif (mode->hdisplay & 0xf)\r\nreturn MODE_ERROR;\r\nreturn MODE_OK;\r\n}\r\nint fsl_dcu_drm_connector_create(struct fsl_dcu_drm_device *fsl_dev,\r\nstruct drm_encoder *encoder)\r\n{\r\nstruct drm_connector *connector = &fsl_dev->connector.base;\r\nstruct drm_mode_config mode_config = fsl_dev->drm->mode_config;\r\nstruct device_node *panel_node;\r\nint ret;\r\nfsl_dev->connector.encoder = encoder;\r\nret = drm_connector_init(fsl_dev->drm, connector,\r\n&fsl_dcu_drm_connector_funcs,\r\nDRM_MODE_CONNECTOR_LVDS);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_connector_helper_add(connector, &connector_helper_funcs);\r\nret = drm_connector_register(connector);\r\nif (ret < 0)\r\ngoto err_cleanup;\r\nret = drm_mode_connector_attach_encoder(connector, encoder);\r\nif (ret < 0)\r\ngoto err_sysfs;\r\ndrm_object_property_set_value(&connector->base,\r\nmode_config.dpms_property,\r\nDRM_MODE_DPMS_OFF);\r\npanel_node = of_parse_phandle(fsl_dev->np, "fsl,panel", 0);\r\nif (panel_node) {\r\nfsl_dev->connector.panel = of_drm_find_panel(panel_node);\r\nif (!fsl_dev->connector.panel) {\r\nret = -EPROBE_DEFER;\r\ngoto err_sysfs;\r\n}\r\nof_node_put(panel_node);\r\n}\r\nret = drm_panel_attach(fsl_dev->connector.panel, connector);\r\nif (ret) {\r\ndev_err(fsl_dev->dev, "failed to attach panel\n");\r\ngoto err_sysfs;\r\n}\r\nreturn 0;\r\nerr_sysfs:\r\ndrm_connector_unregister(connector);\r\nerr_cleanup:\r\ndrm_connector_cleanup(connector);\r\nreturn ret;\r\n}
