__init int ima_mok_init(void)\r\n{\r\npr_notice("Allocating IMA MOK and blacklist keyrings.\n");\r\nima_mok_keyring = keyring_alloc(".ima_mok",\r\nKUIDT_INIT(0), KGIDT_INIT(0), current_cred(),\r\n(KEY_POS_ALL & ~KEY_POS_SETATTR) |\r\nKEY_USR_VIEW | KEY_USR_READ |\r\nKEY_USR_WRITE | KEY_USR_SEARCH,\r\nKEY_ALLOC_NOT_IN_QUOTA, NULL);\r\nima_blacklist_keyring = keyring_alloc(".ima_blacklist",\r\nKUIDT_INIT(0), KGIDT_INIT(0), current_cred(),\r\n(KEY_POS_ALL & ~KEY_POS_SETATTR) |\r\nKEY_USR_VIEW | KEY_USR_READ |\r\nKEY_USR_WRITE | KEY_USR_SEARCH,\r\nKEY_ALLOC_NOT_IN_QUOTA, NULL);\r\nif (IS_ERR(ima_mok_keyring) || IS_ERR(ima_blacklist_keyring))\r\npanic("Can't allocate IMA MOK or blacklist keyrings.");\r\nset_bit(KEY_FLAG_TRUSTED_ONLY, &ima_mok_keyring->flags);\r\nset_bit(KEY_FLAG_TRUSTED_ONLY, &ima_blacklist_keyring->flags);\r\nset_bit(KEY_FLAG_KEEP, &ima_blacklist_keyring->flags);\r\nreturn 0;\r\n}
