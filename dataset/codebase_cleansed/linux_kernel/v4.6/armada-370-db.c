static int a370db_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nunsigned int freq;\r\nswitch (params_rate(params)) {\r\ndefault:\r\ncase 44100:\r\nfreq = 11289600;\r\nbreak;\r\ncase 48000:\r\nfreq = 12288000;\r\nbreak;\r\ncase 96000:\r\nfreq = 24576000;\r\nbreak;\r\n}\r\nreturn snd_soc_dai_set_sysclk(codec_dai, 0, freq, SND_SOC_CLOCK_IN);\r\n}\r\nstatic int a370db_probe(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = &a370db;\r\ncard->dev = &pdev->dev;\r\na370db_dai[0].cpu_of_node =\r\nof_parse_phandle(pdev->dev.of_node,\r\n"marvell,audio-controller", 0);\r\na370db_dai[0].platform_of_node = a370db_dai[0].cpu_of_node;\r\na370db_dai[0].codec_of_node =\r\nof_parse_phandle(pdev->dev.of_node,\r\n"marvell,audio-codec", 0);\r\na370db_dai[1].cpu_of_node = a370db_dai[0].cpu_of_node;\r\na370db_dai[1].platform_of_node = a370db_dai[0].cpu_of_node;\r\na370db_dai[1].codec_of_node =\r\nof_parse_phandle(pdev->dev.of_node,\r\n"marvell,audio-codec", 1);\r\na370db_dai[2].cpu_of_node = a370db_dai[0].cpu_of_node;\r\na370db_dai[2].platform_of_node = a370db_dai[0].cpu_of_node;\r\na370db_dai[2].codec_of_node =\r\nof_parse_phandle(pdev->dev.of_node,\r\n"marvell,audio-codec", 2);\r\nreturn devm_snd_soc_register_card(card->dev, card);\r\n}
