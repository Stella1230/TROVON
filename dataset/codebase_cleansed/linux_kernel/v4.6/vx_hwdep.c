int snd_vx_setup_firmware(struct vx_core *chip)\r\n{\r\nstatic char *fw_files[VX_TYPE_NUMS][4] = {\r\n[VX_TYPE_BOARD] = {\r\nNULL, "x1_1_vx2.xlx", "bd56002.boot", "l_1_vx2.d56",\r\n},\r\n[VX_TYPE_V2] = {\r\nNULL, "x1_2_v22.xlx", "bd563v2.boot", "l_1_v22.d56",\r\n},\r\n[VX_TYPE_MIC] = {\r\nNULL, "x1_2_v22.xlx", "bd563v2.boot", "l_1_v22.d56",\r\n},\r\n[VX_TYPE_VXPOCKET] = {\r\n"bx_1_vxp.b56", "x1_1_vxp.xlx", "bd563s3.boot", "l_1_vxp.d56"\r\n},\r\n[VX_TYPE_VXP440] = {\r\n"bx_1_vp4.b56", "x1_1_vp4.xlx", "bd563s3.boot", "l_1_vp4.d56"\r\n},\r\n};\r\nint i, err;\r\nfor (i = 0; i < 4; i++) {\r\nchar path[32];\r\nconst struct firmware *fw;\r\nif (! fw_files[chip->type][i])\r\ncontinue;\r\nsprintf(path, "vx/%s", fw_files[chip->type][i]);\r\nif (request_firmware(&fw, path, chip->dev)) {\r\nsnd_printk(KERN_ERR "vx: can't load firmware %s\n", path);\r\nreturn -ENOENT;\r\n}\r\nerr = chip->ops->load_dsp(chip, i, fw);\r\nif (err < 0) {\r\nrelease_firmware(fw);\r\nreturn err;\r\n}\r\nif (i == 1)\r\nchip->chip_status |= VX_STAT_XILINX_LOADED;\r\n#ifdef CONFIG_PM\r\nchip->firmware[i] = fw;\r\n#else\r\nrelease_firmware(fw);\r\n#endif\r\n}\r\nif ((err = snd_vx_pcm_new(chip)) < 0)\r\nreturn err;\r\nif ((err = snd_vx_mixer_new(chip)) < 0)\r\nreturn err;\r\nif (chip->ops->add_controls)\r\nif ((err = chip->ops->add_controls(chip)) < 0)\r\nreturn err;\r\nchip->chip_status |= VX_STAT_DEVICE_INIT;\r\nchip->chip_status |= VX_STAT_CHIP_INIT;\r\nreturn snd_card_register(chip->card);\r\n}\r\nvoid snd_vx_free_firmware(struct vx_core *chip)\r\n{\r\n#ifdef CONFIG_PM\r\nint i;\r\nfor (i = 0; i < 4; i++)\r\nrelease_firmware(chip->firmware[i]);\r\n#endif\r\n}
