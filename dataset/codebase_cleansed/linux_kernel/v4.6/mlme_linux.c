static void sitesurvey_ctrl_handler(unsigned long data)\r\n{\r\nstruct _adapter *adapter = (struct _adapter *)data;\r\n_r8712_sitesurvey_ctrl_handler(adapter);\r\nmod_timer(&adapter->mlmepriv.sitesurveyctrl.sitesurvey_ctrl_timer,\r\njiffies + msecs_to_jiffies(3000));\r\n}\r\nstatic void join_timeout_handler (unsigned long data)\r\n{\r\nstruct _adapter *adapter = (struct _adapter *)data;\r\n_r8712_join_timeout_handler(adapter);\r\n}\r\nstatic void _scan_timeout_handler (unsigned long data)\r\n{\r\nstruct _adapter *adapter = (struct _adapter *)data;\r\nr8712_scan_timeout_handler(adapter);\r\n}\r\nstatic void dhcp_timeout_handler (unsigned long data)\r\n{\r\nstruct _adapter *adapter = (struct _adapter *)data;\r\n_r8712_dhcp_timeout_handler(adapter);\r\n}\r\nstatic void wdg_timeout_handler (unsigned long data)\r\n{\r\nstruct _adapter *adapter = (struct _adapter *)data;\r\n_r8712_wdg_timeout_handler(adapter);\r\nmod_timer(&adapter->mlmepriv.wdg_timer,\r\njiffies + msecs_to_jiffies(2000));\r\n}\r\nvoid r8712_init_mlme_timer(struct _adapter *padapter)\r\n{\r\nstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\r\nsetup_timer(&pmlmepriv->assoc_timer, join_timeout_handler,\r\n(unsigned long)padapter);\r\nsetup_timer(&pmlmepriv->sitesurveyctrl.sitesurvey_ctrl_timer,\r\nsitesurvey_ctrl_handler,\r\n(unsigned long)padapter);\r\nsetup_timer(&pmlmepriv->scan_to_timer, _scan_timeout_handler,\r\n(unsigned long)padapter);\r\nsetup_timer(&pmlmepriv->dhcp_timer, dhcp_timeout_handler,\r\n(unsigned long)padapter);\r\nsetup_timer(&pmlmepriv->wdg_timer, wdg_timeout_handler,\r\n(unsigned long)padapter);\r\n}\r\nvoid r8712_os_indicate_connect(struct _adapter *adapter)\r\n{\r\nr8712_indicate_wx_assoc_event(adapter);\r\nnetif_carrier_on(adapter->pnetdev);\r\n}\r\nvoid r8712_os_indicate_disconnect(struct _adapter *adapter)\r\n{\r\nu8 backupPMKIDIndex = 0;\r\nu8 backupTKIPCountermeasure = 0x00;\r\nr8712_indicate_wx_disassoc_event(adapter);\r\nnetif_carrier_off(adapter->pnetdev);\r\nif (adapter->securitypriv.AuthAlgrthm == 2) {\r\nmemcpy(&backupPMKIDList[0], &adapter->securitypriv.\r\nPMKIDList[0], sizeof(struct RT_PMKID_LIST) *\r\nNUM_PMKID_CACHE);\r\nbackupPMKIDIndex = adapter->securitypriv.PMKIDIndex;\r\nbackupTKIPCountermeasure = adapter->securitypriv.\r\nbtkip_countermeasure;\r\nmemset((unsigned char *)&adapter->securitypriv, 0,\r\nsizeof(struct security_priv));\r\nsetup_timer(&adapter->securitypriv.tkip_timer,\r\nr8712_use_tkipkey_handler,\r\n(unsigned long)adapter);\r\nmemcpy(&adapter->securitypriv.PMKIDList[0],\r\n&backupPMKIDList[0],\r\nsizeof(struct RT_PMKID_LIST) * NUM_PMKID_CACHE);\r\nadapter->securitypriv.PMKIDIndex = backupPMKIDIndex;\r\nadapter->securitypriv.btkip_countermeasure =\r\nbackupTKIPCountermeasure;\r\n} else {\r\nstruct security_priv *psec_priv = &adapter->securitypriv;\r\npsec_priv->AuthAlgrthm = 0;\r\npsec_priv->PrivacyAlgrthm = _NO_PRIVACY_;\r\npsec_priv->PrivacyKeyIndex = 0;\r\npsec_priv->XGrpPrivacy = _NO_PRIVACY_;\r\npsec_priv->XGrpKeyid = 1;\r\npsec_priv->ndisauthtype = Ndis802_11AuthModeOpen;\r\npsec_priv->ndisencryptstatus = Ndis802_11WEPDisabled;\r\npsec_priv->wps_phase = false;\r\n}\r\n}\r\nvoid r8712_report_sec_ie(struct _adapter *adapter, u8 authmode, u8 *sec_ie)\r\n{\r\nuint len;\r\nu8 *buff, *p, i;\r\nunion iwreq_data wrqu;\r\nbuff = NULL;\r\nif (authmode == _WPA_IE_ID_) {\r\nbuff = kzalloc(IW_CUSTOM_MAX, GFP_ATOMIC);\r\nif (buff == NULL)\r\nreturn;\r\np = buff;\r\np += sprintf(p, "ASSOCINFO(ReqIEs=");\r\nlen = sec_ie[1] + 2;\r\nlen = (len < IW_CUSTOM_MAX) ? len : IW_CUSTOM_MAX - 1;\r\nfor (i = 0; i < len; i++)\r\np += sprintf(p, "%02x", sec_ie[i]);\r\np += sprintf(p, ")");\r\nmemset(&wrqu, 0, sizeof(wrqu));\r\nwrqu.data.length = p - buff;\r\nwrqu.data.length = (wrqu.data.length < IW_CUSTOM_MAX) ?\r\nwrqu.data.length : IW_CUSTOM_MAX;\r\nwireless_send_event(adapter->pnetdev, IWEVCUSTOM, &wrqu, buff);\r\nkfree(buff);\r\n}\r\n}
