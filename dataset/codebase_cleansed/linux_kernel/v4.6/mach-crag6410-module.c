static int wlf_gf_module_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *i2c_id)\r\n{\r\nint ret, i, j, id, rev;\r\nret = i2c_smbus_read_byte_data(i2c, 0);\r\nif (ret < 0) {\r\ndev_err(&i2c->dev, "Failed to read ID: %d\n", ret);\r\nreturn ret;\r\n}\r\nid = (ret & 0xfe) >> 2;\r\nrev = ret & 0x3;\r\nfor (i = 0; i < ARRAY_SIZE(gf_mods); i++)\r\nif (id == gf_mods[i].id && (gf_mods[i].rev == 0xff ||\r\nrev == gf_mods[i].rev))\r\nbreak;\r\nif (i < ARRAY_SIZE(gf_mods)) {\r\ndev_info(&i2c->dev, "%s revision %d\n",\r\ngf_mods[i].name, rev + 1);\r\nfor (j = 0; j < gf_mods[i].num_i2c_devs; j++) {\r\nif (!i2c_new_device(i2c->adapter,\r\n&(gf_mods[i].i2c_devs[j])))\r\ndev_err(&i2c->dev,\r\n"Failed to register dev: %d\n", ret);\r\n}\r\nspi_register_board_info(gf_mods[i].spi_devs,\r\ngf_mods[i].num_spi_devs);\r\n} else {\r\ndev_warn(&i2c->dev, "Unknown module ID 0x%x revision %d\n",\r\nid, rev + 1);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init wlf_gf_module_register(void)\r\n{\r\nif (!soc_is_s3c64xx())\r\nreturn 0;\r\nreturn i2c_add_driver(&wlf_gf_module_driver);\r\n}
