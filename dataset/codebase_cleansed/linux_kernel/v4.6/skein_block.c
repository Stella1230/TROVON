void skein_256_process_block(struct skein_256_ctx *ctx, const u8 *blk_ptr,\r\nsize_t blk_cnt, size_t byte_cnt_add)\r\n{\r\nenum {\r\nWCNT = SKEIN_256_STATE_WORDS\r\n};\r\nsize_t r;\r\n#if SKEIN_UNROLL_256\r\nu64 kw[WCNT+4+RCNT*2];\r\n#else\r\nu64 kw[WCNT+4];\r\n#endif\r\nu64 X0, X1, X2, X3;\r\nu64 w[WCNT];\r\n#ifdef SKEIN_DEBUG\r\nconst u64 *X_ptr[4];\r\nX_ptr[0] = &X0;\r\nX_ptr[1] = &X1;\r\nX_ptr[2] = &X2;\r\nX_ptr[3] = &X3;\r\n#endif\r\nskein_assert(blk_cnt != 0);\r\nts[0] = ctx->h.tweak[0];\r\nts[1] = ctx->h.tweak[1];\r\ndo {\r\nts[0] += byte_cnt_add;\r\nks[0] = ctx->x[0];\r\nks[1] = ctx->x[1];\r\nks[2] = ctx->x[2];\r\nks[3] = ctx->x[3];\r\nks[4] = ks[0] ^ ks[1] ^ ks[2] ^ ks[3] ^ SKEIN_KS_PARITY;\r\nts[2] = ts[0] ^ ts[1];\r\nskein_get64_lsb_first(w, blk_ptr, WCNT);\r\ndebug_save_tweak(ctx);\r\nX0 = w[0] + ks[0];\r\nX1 = w[1] + ks[1] + ts[0];\r\nX2 = w[2] + ks[2] + ts[1];\r\nX3 = w[3] + ks[3];\r\nblk_ptr += SKEIN_256_BLOCK_BYTES;\r\nfor (r = 1;\r\nr < (SKEIN_UNROLL_256 ? 2 * RCNT : 2);\r\nr += (SKEIN_UNROLL_256 ? 2 * SKEIN_UNROLL_256 : 1)) {\r\nR256_8_ROUNDS(0);\r\n#if R256_UNROLL_R(1)\r\nR256_8_ROUNDS(1);\r\n#endif\r\n#if R256_UNROLL_R(2)\r\nR256_8_ROUNDS(2);\r\n#endif\r\n#if R256_UNROLL_R(3)\r\nR256_8_ROUNDS(3);\r\n#endif\r\n#if R256_UNROLL_R(4)\r\nR256_8_ROUNDS(4);\r\n#endif\r\n#if R256_UNROLL_R(5)\r\nR256_8_ROUNDS(5);\r\n#endif\r\n#if R256_UNROLL_R(6)\r\nR256_8_ROUNDS(6);\r\n#endif\r\n#if R256_UNROLL_R(7)\r\nR256_8_ROUNDS(7);\r\n#endif\r\n#if R256_UNROLL_R(8)\r\nR256_8_ROUNDS(8);\r\n#endif\r\n#if R256_UNROLL_R(9)\r\nR256_8_ROUNDS(9);\r\n#endif\r\n#if R256_UNROLL_R(10)\r\nR256_8_ROUNDS(10);\r\n#endif\r\n#if R256_UNROLL_R(11)\r\nR256_8_ROUNDS(11);\r\n#endif\r\n#if R256_UNROLL_R(12)\r\nR256_8_ROUNDS(12);\r\n#endif\r\n#if R256_UNROLL_R(13)\r\nR256_8_ROUNDS(13);\r\n#endif\r\n#if R256_UNROLL_R(14)\r\nR256_8_ROUNDS(14);\r\n#endif\r\n}\r\nctx->x[0] = X0 ^ w[0];\r\nctx->x[1] = X1 ^ w[1];\r\nctx->x[2] = X2 ^ w[2];\r\nctx->x[3] = X3 ^ w[3];\r\nts[1] &= ~SKEIN_T1_FLAG_FIRST;\r\n} while (--blk_cnt);\r\nctx->h.tweak[0] = ts[0];\r\nctx->h.tweak[1] = ts[1];\r\n}\r\nsize_t skein_256_process_block_code_size(void)\r\n{\r\nreturn ((u8 *) skein_256_process_block_code_size) -\r\n((u8 *) skein_256_process_block);\r\n}\r\nunsigned int skein_256_unroll_cnt(void)\r\n{\r\nreturn SKEIN_UNROLL_256;\r\n}\r\nvoid skein_512_process_block(struct skein_512_ctx *ctx, const u8 *blk_ptr,\r\nsize_t blk_cnt, size_t byte_cnt_add)\r\n{\r\nenum {\r\nWCNT = SKEIN_512_STATE_WORDS\r\n};\r\nsize_t r;\r\n#if SKEIN_UNROLL_512\r\nu64 kw[WCNT+4+RCNT*2];\r\n#else\r\nu64 kw[WCNT+4];\r\n#endif\r\nu64 X0, X1, X2, X3, X4, X5, X6, X7;\r\nu64 w[WCNT];\r\n#ifdef SKEIN_DEBUG\r\nconst u64 *X_ptr[8];\r\nX_ptr[0] = &X0;\r\nX_ptr[1] = &X1;\r\nX_ptr[2] = &X2;\r\nX_ptr[3] = &X3;\r\nX_ptr[4] = &X4;\r\nX_ptr[5] = &X5;\r\nX_ptr[6] = &X6;\r\nX_ptr[7] = &X7;\r\n#endif\r\nskein_assert(blk_cnt != 0);\r\nts[0] = ctx->h.tweak[0];\r\nts[1] = ctx->h.tweak[1];\r\ndo {\r\nts[0] += byte_cnt_add;\r\nks[0] = ctx->x[0];\r\nks[1] = ctx->x[1];\r\nks[2] = ctx->x[2];\r\nks[3] = ctx->x[3];\r\nks[4] = ctx->x[4];\r\nks[5] = ctx->x[5];\r\nks[6] = ctx->x[6];\r\nks[7] = ctx->x[7];\r\nks[8] = ks[0] ^ ks[1] ^ ks[2] ^ ks[3] ^\r\nks[4] ^ ks[5] ^ ks[6] ^ ks[7] ^ SKEIN_KS_PARITY;\r\nts[2] = ts[0] ^ ts[1];\r\nskein_get64_lsb_first(w, blk_ptr, WCNT);\r\ndebug_save_tweak(ctx);\r\nX0 = w[0] + ks[0];\r\nX1 = w[1] + ks[1];\r\nX2 = w[2] + ks[2];\r\nX3 = w[3] + ks[3];\r\nX4 = w[4] + ks[4];\r\nX5 = w[5] + ks[5] + ts[0];\r\nX6 = w[6] + ks[6] + ts[1];\r\nX7 = w[7] + ks[7];\r\nblk_ptr += SKEIN_512_BLOCK_BYTES;\r\nfor (r = 1;\r\nr < (SKEIN_UNROLL_512 ? 2 * RCNT : 2);\r\nr += (SKEIN_UNROLL_512 ? 2 * SKEIN_UNROLL_512 : 1)) {\r\nR512_8_ROUNDS(0);\r\n#if R512_UNROLL_R(1)\r\nR512_8_ROUNDS(1);\r\n#endif\r\n#if R512_UNROLL_R(2)\r\nR512_8_ROUNDS(2);\r\n#endif\r\n#if R512_UNROLL_R(3)\r\nR512_8_ROUNDS(3);\r\n#endif\r\n#if R512_UNROLL_R(4)\r\nR512_8_ROUNDS(4);\r\n#endif\r\n#if R512_UNROLL_R(5)\r\nR512_8_ROUNDS(5);\r\n#endif\r\n#if R512_UNROLL_R(6)\r\nR512_8_ROUNDS(6);\r\n#endif\r\n#if R512_UNROLL_R(7)\r\nR512_8_ROUNDS(7);\r\n#endif\r\n#if R512_UNROLL_R(8)\r\nR512_8_ROUNDS(8);\r\n#endif\r\n#if R512_UNROLL_R(9)\r\nR512_8_ROUNDS(9);\r\n#endif\r\n#if R512_UNROLL_R(10)\r\nR512_8_ROUNDS(10);\r\n#endif\r\n#if R512_UNROLL_R(11)\r\nR512_8_ROUNDS(11);\r\n#endif\r\n#if R512_UNROLL_R(12)\r\nR512_8_ROUNDS(12);\r\n#endif\r\n#if R512_UNROLL_R(13)\r\nR512_8_ROUNDS(13);\r\n#endif\r\n#if R512_UNROLL_R(14)\r\nR512_8_ROUNDS(14);\r\n#endif\r\n}\r\nctx->x[0] = X0 ^ w[0];\r\nctx->x[1] = X1 ^ w[1];\r\nctx->x[2] = X2 ^ w[2];\r\nctx->x[3] = X3 ^ w[3];\r\nctx->x[4] = X4 ^ w[4];\r\nctx->x[5] = X5 ^ w[5];\r\nctx->x[6] = X6 ^ w[6];\r\nctx->x[7] = X7 ^ w[7];\r\nts[1] &= ~SKEIN_T1_FLAG_FIRST;\r\n} while (--blk_cnt);\r\nctx->h.tweak[0] = ts[0];\r\nctx->h.tweak[1] = ts[1];\r\n}\r\nsize_t skein_512_process_block_code_size(void)\r\n{\r\nreturn ((u8 *) skein_512_process_block_code_size) -\r\n((u8 *) skein_512_process_block);\r\n}\r\nunsigned int skein_512_unroll_cnt(void)\r\n{\r\nreturn SKEIN_UNROLL_512;\r\n}\r\nvoid skein_1024_process_block(struct skein_1024_ctx *ctx, const u8 *blk_ptr,\r\nsize_t blk_cnt, size_t byte_cnt_add)\r\n{\r\nenum {\r\nWCNT = SKEIN_1024_STATE_WORDS\r\n};\r\nsize_t r;\r\n#if (SKEIN_UNROLL_1024 != 0)\r\nu64 kw[WCNT+4+RCNT*2];\r\n#else\r\nu64 kw[WCNT+4];\r\n#endif\r\nu64 X00, X01, X02, X03, X04, X05, X06, X07,\r\nX08, X09, X10, X11, X12, X13, X14, X15;\r\nu64 w[WCNT];\r\nskein_assert(blk_cnt != 0);\r\nts[0] = ctx->h.tweak[0];\r\nts[1] = ctx->h.tweak[1];\r\ndo {\r\nts[0] += byte_cnt_add;\r\nks[0] = ctx->x[0];\r\nks[1] = ctx->x[1];\r\nks[2] = ctx->x[2];\r\nks[3] = ctx->x[3];\r\nks[4] = ctx->x[4];\r\nks[5] = ctx->x[5];\r\nks[6] = ctx->x[6];\r\nks[7] = ctx->x[7];\r\nks[8] = ctx->x[8];\r\nks[9] = ctx->x[9];\r\nks[10] = ctx->x[10];\r\nks[11] = ctx->x[11];\r\nks[12] = ctx->x[12];\r\nks[13] = ctx->x[13];\r\nks[14] = ctx->x[14];\r\nks[15] = ctx->x[15];\r\nks[16] = ks[0] ^ ks[1] ^ ks[2] ^ ks[3] ^\r\nks[4] ^ ks[5] ^ ks[6] ^ ks[7] ^\r\nks[8] ^ ks[9] ^ ks[10] ^ ks[11] ^\r\nks[12] ^ ks[13] ^ ks[14] ^ ks[15] ^ SKEIN_KS_PARITY;\r\nts[2] = ts[0] ^ ts[1];\r\nskein_get64_lsb_first(w, blk_ptr, WCNT);\r\ndebug_save_tweak(ctx);\r\nX00 = w[0] + ks[0];\r\nX01 = w[1] + ks[1];\r\nX02 = w[2] + ks[2];\r\nX03 = w[3] + ks[3];\r\nX04 = w[4] + ks[4];\r\nX05 = w[5] + ks[5];\r\nX06 = w[6] + ks[6];\r\nX07 = w[7] + ks[7];\r\nX08 = w[8] + ks[8];\r\nX09 = w[9] + ks[9];\r\nX10 = w[10] + ks[10];\r\nX11 = w[11] + ks[11];\r\nX12 = w[12] + ks[12];\r\nX13 = w[13] + ks[13] + ts[0];\r\nX14 = w[14] + ks[14] + ts[1];\r\nX15 = w[15] + ks[15];\r\nfor (r = 1;\r\nr < (SKEIN_UNROLL_1024 ? 2 * RCNT : 2);\r\nr += (SKEIN_UNROLL_1024 ? 2 * SKEIN_UNROLL_1024 : 1)) {\r\nR1024_8_ROUNDS(0);\r\n#if R1024_UNROLL_R(1)\r\nR1024_8_ROUNDS(1);\r\n#endif\r\n#if R1024_UNROLL_R(2)\r\nR1024_8_ROUNDS(2);\r\n#endif\r\n#if R1024_UNROLL_R(3)\r\nR1024_8_ROUNDS(3);\r\n#endif\r\n#if R1024_UNROLL_R(4)\r\nR1024_8_ROUNDS(4);\r\n#endif\r\n#if R1024_UNROLL_R(5)\r\nR1024_8_ROUNDS(5);\r\n#endif\r\n#if R1024_UNROLL_R(6)\r\nR1024_8_ROUNDS(6);\r\n#endif\r\n#if R1024_UNROLL_R(7)\r\nR1024_8_ROUNDS(7);\r\n#endif\r\n#if R1024_UNROLL_R(8)\r\nR1024_8_ROUNDS(8);\r\n#endif\r\n#if R1024_UNROLL_R(9)\r\nR1024_8_ROUNDS(9);\r\n#endif\r\n#if R1024_UNROLL_R(10)\r\nR1024_8_ROUNDS(10);\r\n#endif\r\n#if R1024_UNROLL_R(11)\r\nR1024_8_ROUNDS(11);\r\n#endif\r\n#if R1024_UNROLL_R(12)\r\nR1024_8_ROUNDS(12);\r\n#endif\r\n#if R1024_UNROLL_R(13)\r\nR1024_8_ROUNDS(13);\r\n#endif\r\n#if R1024_UNROLL_R(14)\r\nR1024_8_ROUNDS(14);\r\n#endif\r\n}\r\nctx->x[0] = X00 ^ w[0];\r\nctx->x[1] = X01 ^ w[1];\r\nctx->x[2] = X02 ^ w[2];\r\nctx->x[3] = X03 ^ w[3];\r\nctx->x[4] = X04 ^ w[4];\r\nctx->x[5] = X05 ^ w[5];\r\nctx->x[6] = X06 ^ w[6];\r\nctx->x[7] = X07 ^ w[7];\r\nctx->x[8] = X08 ^ w[8];\r\nctx->x[9] = X09 ^ w[9];\r\nctx->x[10] = X10 ^ w[10];\r\nctx->x[11] = X11 ^ w[11];\r\nctx->x[12] = X12 ^ w[12];\r\nctx->x[13] = X13 ^ w[13];\r\nctx->x[14] = X14 ^ w[14];\r\nctx->x[15] = X15 ^ w[15];\r\nts[1] &= ~SKEIN_T1_FLAG_FIRST;\r\nblk_ptr += SKEIN_1024_BLOCK_BYTES;\r\n} while (--blk_cnt);\r\nctx->h.tweak[0] = ts[0];\r\nctx->h.tweak[1] = ts[1];\r\n}\r\nsize_t skein_1024_process_block_code_size(void)\r\n{\r\nreturn ((u8 *) skein_1024_process_block_code_size) -\r\n((u8 *) skein_1024_process_block);\r\n}\r\nunsigned int skein_1024_unroll_cnt(void)\r\n{\r\nreturn SKEIN_UNROLL_1024;\r\n}
