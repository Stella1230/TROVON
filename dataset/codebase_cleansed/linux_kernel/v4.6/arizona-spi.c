static int arizona_spi_probe(struct spi_device *spi)\r\n{\r\nconst struct spi_device_id *id = spi_get_device_id(spi);\r\nstruct arizona *arizona;\r\nconst struct regmap_config *regmap_config = NULL;\r\nunsigned long type;\r\nint ret;\r\nif (spi->dev.of_node)\r\ntype = arizona_of_get_type(&spi->dev);\r\nelse\r\ntype = id->driver_data;\r\nswitch (type) {\r\ncase WM5102:\r\nif (IS_ENABLED(CONFIG_MFD_WM5102))\r\nregmap_config = &wm5102_spi_regmap;\r\nbreak;\r\ncase WM5110:\r\ncase WM8280:\r\nif (IS_ENABLED(CONFIG_MFD_WM5110))\r\nregmap_config = &wm5110_spi_regmap;\r\nbreak;\r\ncase WM1831:\r\ncase CS47L24:\r\nif (IS_ENABLED(CONFIG_MFD_CS47L24))\r\nregmap_config = &cs47l24_spi_regmap;\r\nbreak;\r\ndefault:\r\ndev_err(&spi->dev, "Unknown device type %ld\n", type);\r\nreturn -EINVAL;\r\n}\r\nif (!regmap_config) {\r\ndev_err(&spi->dev,\r\n"No kernel support for device type %ld\n", type);\r\nreturn -EINVAL;\r\n}\r\narizona = devm_kzalloc(&spi->dev, sizeof(*arizona), GFP_KERNEL);\r\nif (arizona == NULL)\r\nreturn -ENOMEM;\r\narizona->regmap = devm_regmap_init_spi(spi, regmap_config);\r\nif (IS_ERR(arizona->regmap)) {\r\nret = PTR_ERR(arizona->regmap);\r\ndev_err(&spi->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\narizona->type = type;\r\narizona->dev = &spi->dev;\r\narizona->irq = spi->irq;\r\nreturn arizona_dev_init(arizona);\r\n}\r\nstatic int arizona_spi_remove(struct spi_device *spi)\r\n{\r\nstruct arizona *arizona = spi_get_drvdata(spi);\r\narizona_dev_exit(arizona);\r\nreturn 0;\r\n}
