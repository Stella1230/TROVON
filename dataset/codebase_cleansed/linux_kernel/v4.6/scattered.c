void init_scattered_cpuid_features(struct cpuinfo_x86 *c)\r\n{\r\nu32 max_level;\r\nu32 regs[4];\r\nconst struct cpuid_bit *cb;\r\nstatic const struct cpuid_bit cpuid_bits[] = {\r\n{ X86_FEATURE_INTEL_PT, CR_EBX,25, 0x00000007, 0 },\r\n{ X86_FEATURE_APERFMPERF, CR_ECX, 0, 0x00000006, 0 },\r\n{ X86_FEATURE_EPB, CR_ECX, 3, 0x00000006, 0 },\r\n{ X86_FEATURE_HW_PSTATE, CR_EDX, 7, 0x80000007, 0 },\r\n{ X86_FEATURE_CPB, CR_EDX, 9, 0x80000007, 0 },\r\n{ X86_FEATURE_PROC_FEEDBACK, CR_EDX,11, 0x80000007, 0 },\r\n{ 0, 0, 0, 0, 0 }\r\n};\r\nfor (cb = cpuid_bits; cb->feature; cb++) {\r\nmax_level = cpuid_eax(cb->level & 0xffff0000);\r\nif (max_level < cb->level ||\r\nmax_level > (cb->level | 0xffff))\r\ncontinue;\r\ncpuid_count(cb->level, cb->sub_leaf, &regs[CR_EAX],\r\n&regs[CR_EBX], &regs[CR_ECX], &regs[CR_EDX]);\r\nif (regs[cb->reg] & (1 << cb->bit))\r\nset_cpu_cap(c, cb->feature);\r\n}\r\n}
