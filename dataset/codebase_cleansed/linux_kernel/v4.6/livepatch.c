int klp_write_module_reloc(struct module *mod, unsigned long type,\r\nunsigned long loc, unsigned long value)\r\n{\r\nsize_t size = 4;\r\nunsigned long val;\r\nunsigned long core = (unsigned long)mod->core_layout.base;\r\nunsigned long core_size = mod->core_layout.size;\r\nswitch (type) {\r\ncase R_X86_64_NONE:\r\nreturn 0;\r\ncase R_X86_64_64:\r\nval = value;\r\nsize = 8;\r\nbreak;\r\ncase R_X86_64_32:\r\nval = (u32)value;\r\nbreak;\r\ncase R_X86_64_32S:\r\nval = (s32)value;\r\nbreak;\r\ncase R_X86_64_PC32:\r\nval = (u32)(value - loc);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nif (loc < core || loc >= core + core_size)\r\nreturn -EINVAL;\r\nreturn probe_kernel_write((void *)loc, &val, size);\r\n}
