static void dsi_28nm_dphy_set_timing(struct msm_dsi_phy *phy,\r\nstruct msm_dsi_dphy_timing *timing)\r\n{\r\nvoid __iomem *base = phy->base;\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_0,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_0_CLK_ZERO(timing->clk_zero));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_1,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_1_CLK_TRAIL(timing->clk_trail));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_2,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_2_CLK_PREPARE(timing->clk_prepare));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_3, 0x0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_4,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_4_HS_EXIT(timing->hs_exit));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_5,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_5_HS_ZERO(timing->hs_zero));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_6,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_6_HS_PREPARE(timing->hs_prepare));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_7,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_7_HS_TRAIL(timing->hs_trail));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_8,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_8_HS_RQST(timing->hs_rqst));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_9,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_9_TA_GO(timing->ta_go) |\r\nDSI_28nm_8960_PHY_TIMING_CTRL_9_TA_SURE(timing->ta_sure));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_10,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_10_TA_GET(timing->ta_get));\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_TIMING_CTRL_11,\r\nDSI_28nm_8960_PHY_TIMING_CTRL_11_TRIG3_CMD(0));\r\n}\r\nstatic void dsi_28nm_phy_regulator_init(struct msm_dsi_phy *phy)\r\n{\r\nvoid __iomem *base = phy->reg_base;\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_0, 0x3);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_1, 1);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_2, 1);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_3, 0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_4,\r\n0x100);\r\n}\r\nstatic void dsi_28nm_phy_regulator_ctrl(struct msm_dsi_phy *phy)\r\n{\r\nvoid __iomem *base = phy->reg_base;\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_0, 0x3);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_1, 0xa);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_2, 0x4);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_3, 0x0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CTRL_4, 0x20);\r\n}\r\nstatic void dsi_28nm_phy_calibration(struct msm_dsi_phy *phy)\r\n{\r\nvoid __iomem *base = phy->reg_base;\r\nu32 status;\r\nint i = 5000;\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_REGULATOR_CAL_PWR_CFG,\r\n0x3);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_SW_CFG_2, 0x0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_CFG_1, 0x5a);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_CFG_3, 0x10);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_CFG_4, 0x1);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_CFG_0, 0x1);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_TRIGGER, 0x1);\r\nusleep_range(5000, 6000);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_MISC_CAL_HW_TRIGGER, 0x0);\r\ndo {\r\nstatus = dsi_phy_read(base +\r\nREG_DSI_28nm_8960_PHY_MISC_CAL_STATUS);\r\nif (!(status & DSI_28nm_8960_PHY_MISC_CAL_STATUS_CAL_BUSY))\r\nbreak;\r\nudelay(1);\r\n} while (--i > 0);\r\n}\r\nstatic void dsi_28nm_phy_lane_config(struct msm_dsi_phy *phy)\r\n{\r\nvoid __iomem *base = phy->base;\r\nint i;\r\nfor (i = 0; i < 4; i++) {\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_CFG_0(i), 0x80);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_CFG_1(i), 0x45);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_CFG_2(i), 0x00);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_TEST_DATAPATH(i),\r\n0x00);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_TEST_STR_0(i),\r\n0x01);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LN_TEST_STR_1(i),\r\n0x66);\r\n}\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_CFG_0, 0x40);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_CFG_1, 0x67);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_CFG_2, 0x0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_TEST_DATAPATH, 0x0);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_TEST_STR0, 0x1);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LNCK_TEST_STR1, 0x88);\r\n}\r\nstatic int dsi_28nm_phy_enable(struct msm_dsi_phy *phy, int src_pll_id,\r\nconst unsigned long bit_rate, const unsigned long esc_rate)\r\n{\r\nstruct msm_dsi_dphy_timing *timing = &phy->timing;\r\nvoid __iomem *base = phy->base;\r\nDBG("");\r\nif (msm_dsi_dphy_timing_calc(timing, bit_rate, esc_rate)) {\r\ndev_err(&phy->pdev->dev,\r\n"%s: D-PHY timing calculation failed\n", __func__);\r\nreturn -EINVAL;\r\n}\r\ndsi_28nm_phy_regulator_init(phy);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_LDO_CTRL, 0x04);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_STRENGTH_0, 0xff);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_STRENGTH_1, 0x00);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_STRENGTH_2, 0x06);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_CTRL_0, 0x5f);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_CTRL_1, 0x00);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_CTRL_2, 0x00);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_CTRL_3, 0x10);\r\ndsi_28nm_phy_regulator_ctrl(phy);\r\ndsi_28nm_phy_calibration(phy);\r\ndsi_28nm_phy_lane_config(phy);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_BIST_CTRL_4, 0x0f);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_BIST_CTRL_1, 0x03);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_BIST_CTRL_0, 0x03);\r\ndsi_phy_write(base + REG_DSI_28nm_8960_PHY_BIST_CTRL_4, 0x0);\r\ndsi_28nm_dphy_set_timing(phy, timing);\r\nreturn 0;\r\n}\r\nstatic void dsi_28nm_phy_disable(struct msm_dsi_phy *phy)\r\n{\r\ndsi_phy_write(phy->base + REG_DSI_28nm_8960_PHY_CTRL_0, 0x0);\r\nwmb();\r\n}
