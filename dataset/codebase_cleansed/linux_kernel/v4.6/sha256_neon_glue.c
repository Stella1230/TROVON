static int sha256_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int len)\r\n{\r\nstruct sha256_state *sctx = shash_desc_ctx(desc);\r\nif (!may_use_simd() ||\r\n(sctx->count % SHA256_BLOCK_SIZE) + len < SHA256_BLOCK_SIZE)\r\nreturn crypto_sha256_arm_update(desc, data, len);\r\nkernel_neon_begin();\r\nsha256_base_do_update(desc, data, len,\r\n(sha256_block_fn *)sha256_block_data_order_neon);\r\nkernel_neon_end();\r\nreturn 0;\r\n}\r\nstatic int sha256_finup(struct shash_desc *desc, const u8 *data,\r\nunsigned int len, u8 *out)\r\n{\r\nif (!may_use_simd())\r\nreturn crypto_sha256_arm_finup(desc, data, len, out);\r\nkernel_neon_begin();\r\nif (len)\r\nsha256_base_do_update(desc, data, len,\r\n(sha256_block_fn *)sha256_block_data_order_neon);\r\nsha256_base_do_finalize(desc,\r\n(sha256_block_fn *)sha256_block_data_order_neon);\r\nkernel_neon_end();\r\nreturn sha256_base_finish(desc, out);\r\n}\r\nstatic int sha256_final(struct shash_desc *desc, u8 *out)\r\n{\r\nreturn sha256_finup(desc, NULL, 0, out);\r\n}
