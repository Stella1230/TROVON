static void __init check_fpu(void)\r\n{\r\nu32 cr0_saved;\r\ns32 fdiv_bug;\r\ncr0_saved = read_cr0();\r\nwrite_cr0(cr0_saved & ~X86_CR0_TS);\r\nkernel_fpu_begin();\r\n__asm__("fninit\n\t"\r\n"fldl %1\n\t"\r\n"fdivl %2\n\t"\r\n"fmull %2\n\t"\r\n"fldl %1\n\t"\r\n"fsubp %%st,%%st(1)\n\t"\r\n"fistpl %0\n\t"\r\n"fwait\n\t"\r\n"fninit"\r\n: "=m" (*&fdiv_bug)\r\n: "m" (*&x), "m" (*&y));\r\nkernel_fpu_end();\r\nwrite_cr0(cr0_saved);\r\nif (fdiv_bug) {\r\nset_cpu_bug(&boot_cpu_data, X86_BUG_FDIV);\r\npr_warn("Hmm, FPU with FDIV bug\n");\r\n}\r\n}\r\nvoid __init fpu__init_check_bugs(void)\r\n{\r\nif (cpu_has_fpu)\r\ncheck_fpu();\r\n}
