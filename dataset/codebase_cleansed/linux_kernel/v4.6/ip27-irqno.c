int allocate_irqno(void)\r\n{\r\nint irq;\r\nagain:\r\nirq = find_first_zero_bit(irq_map, NR_IRQS);\r\nif (irq >= NR_IRQS)\r\nreturn -ENOSPC;\r\nif (test_and_set_bit(irq, irq_map))\r\ngoto again;\r\nreturn irq;\r\n}\r\nvoid __init alloc_legacy_irqno(void)\r\n{\r\nint i;\r\nfor (i = 0; i <= 16; i++)\r\nBUG_ON(test_and_set_bit(i, irq_map));\r\n}\r\nvoid free_irqno(unsigned int irq)\r\n{\r\nsmp_mb__before_atomic();\r\nclear_bit(irq, irq_map);\r\nsmp_mb__after_atomic();\r\n}
