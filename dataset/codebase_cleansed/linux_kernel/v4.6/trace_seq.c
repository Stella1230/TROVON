static inline void __trace_seq_init(struct trace_seq *s)\r\n{\r\nif (unlikely(!s->seq.size))\r\ntrace_seq_init(s);\r\n}\r\nint trace_print_seq(struct seq_file *m, struct trace_seq *s)\r\n{\r\nint ret;\r\n__trace_seq_init(s);\r\nret = seq_buf_print_seq(m, &s->seq);\r\nif (!ret)\r\ntrace_seq_init(s);\r\nreturn ret;\r\n}\r\nvoid trace_seq_printf(struct trace_seq *s, const char *fmt, ...)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nva_list ap;\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nva_start(ap, fmt);\r\nseq_buf_vprintf(&s->seq, fmt, ap);\r\nva_end(ap);\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\n}\r\n}\r\nvoid trace_seq_bitmask(struct trace_seq *s, const unsigned long *maskp,\r\nint nmaskbits)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nseq_buf_printf(&s->seq, "%*pb", nmaskbits, maskp);\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\n}\r\n}\r\nvoid trace_seq_vprintf(struct trace_seq *s, const char *fmt, va_list args)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nseq_buf_vprintf(&s->seq, fmt, args);\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\n}\r\n}\r\nvoid trace_seq_bprintf(struct trace_seq *s, const char *fmt, const u32 *binary)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nseq_buf_bprintf(&s->seq, fmt, binary);\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\nreturn;\r\n}\r\n}\r\nvoid trace_seq_puts(struct trace_seq *s, const char *str)\r\n{\r\nunsigned int len = strlen(str);\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nif (len > TRACE_SEQ_BUF_LEFT(s)) {\r\ns->full = 1;\r\nreturn;\r\n}\r\nseq_buf_putmem(&s->seq, str, len);\r\n}\r\nvoid trace_seq_putc(struct trace_seq *s, unsigned char c)\r\n{\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nif (TRACE_SEQ_BUF_LEFT(s) < 1) {\r\ns->full = 1;\r\nreturn;\r\n}\r\nseq_buf_putc(&s->seq, c);\r\n}\r\nvoid trace_seq_putmem(struct trace_seq *s, const void *mem, unsigned int len)\r\n{\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nif (len > TRACE_SEQ_BUF_LEFT(s)) {\r\ns->full = 1;\r\nreturn;\r\n}\r\nseq_buf_putmem(&s->seq, mem, len);\r\n}\r\nvoid trace_seq_putmem_hex(struct trace_seq *s, const void *mem,\r\nunsigned int len)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nif (s->full)\r\nreturn;\r\n__trace_seq_init(s);\r\nif (len * 2 > TRACE_SEQ_BUF_LEFT(s)) {\r\ns->full = 1;\r\nreturn;\r\n}\r\nseq_buf_putmem_hex(&s->seq, mem, len);\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\nreturn;\r\n}\r\n}\r\nint trace_seq_path(struct trace_seq *s, const struct path *path)\r\n{\r\nunsigned int save_len = s->seq.len;\r\nif (s->full)\r\nreturn 0;\r\n__trace_seq_init(s);\r\nif (TRACE_SEQ_BUF_LEFT(s) < 1) {\r\ns->full = 1;\r\nreturn 0;\r\n}\r\nseq_buf_path(&s->seq, path, "\n");\r\nif (unlikely(seq_buf_has_overflowed(&s->seq))) {\r\ns->seq.len = save_len;\r\ns->full = 1;\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nint trace_seq_to_user(struct trace_seq *s, char __user *ubuf, int cnt)\r\n{\r\n__trace_seq_init(s);\r\nreturn seq_buf_to_user(&s->seq, ubuf, cnt);\r\n}
