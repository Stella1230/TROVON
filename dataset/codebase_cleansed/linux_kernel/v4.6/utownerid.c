acpi_status acpi_ut_allocate_owner_id(acpi_owner_id * owner_id)\r\n{\r\nu32 i;\r\nu32 j;\r\nu32 k;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_allocate_owner_id);\r\nif (*owner_id) {\r\nACPI_ERROR((AE_INFO,\r\n"Owner ID [0x%2.2X] already exists", *owner_id));\r\nreturn_ACPI_STATUS(AE_ALREADY_EXISTS);\r\n}\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_CACHES);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nfor (i = 0, j = acpi_gbl_last_owner_id_index;\r\ni < (ACPI_NUM_OWNERID_MASKS + 1); i++, j++) {\r\nif (j >= ACPI_NUM_OWNERID_MASKS) {\r\nj = 0;\r\n}\r\nfor (k = acpi_gbl_next_owner_id_offset; k < 32; k++) {\r\nif (acpi_gbl_owner_id_mask[j] == ACPI_UINT32_MAX) {\r\nbreak;\r\n}\r\nif (!(acpi_gbl_owner_id_mask[j] & (1 << k))) {\r\nacpi_gbl_owner_id_mask[j] |= (1 << k);\r\nacpi_gbl_last_owner_id_index = (u8)j;\r\nacpi_gbl_next_owner_id_offset = (u8)(k + 1);\r\n*owner_id =\r\n(acpi_owner_id) ((k + 1) + ACPI_MUL_32(j));\r\nACPI_DEBUG_PRINT((ACPI_DB_VALUES,\r\n"Allocated OwnerId: %2.2X\n",\r\n(unsigned int)*owner_id));\r\ngoto exit;\r\n}\r\n}\r\nacpi_gbl_next_owner_id_offset = 0;\r\n}\r\nstatus = AE_OWNER_ID_LIMIT;\r\nACPI_ERROR((AE_INFO,\r\n"Could not allocate new OwnerId (255 max), AE_OWNER_ID_LIMIT"));\r\nexit:\r\n(void)acpi_ut_release_mutex(ACPI_MTX_CACHES);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nvoid acpi_ut_release_owner_id(acpi_owner_id * owner_id_ptr)\r\n{\r\nacpi_owner_id owner_id = *owner_id_ptr;\r\nacpi_status status;\r\nu32 index;\r\nu32 bit;\r\nACPI_FUNCTION_TRACE_U32(ut_release_owner_id, owner_id);\r\n*owner_id_ptr = 0;\r\nif (owner_id == 0) {\r\nACPI_ERROR((AE_INFO, "Invalid OwnerId: 0x%2.2X", owner_id));\r\nreturn_VOID;\r\n}\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_CACHES);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_VOID;\r\n}\r\nowner_id--;\r\nindex = ACPI_DIV_32(owner_id);\r\nbit = 1 << ACPI_MOD_32(owner_id);\r\nif (acpi_gbl_owner_id_mask[index] & bit) {\r\nacpi_gbl_owner_id_mask[index] ^= bit;\r\n} else {\r\nACPI_ERROR((AE_INFO,\r\n"Release of non-allocated OwnerId: 0x%2.2X",\r\nowner_id + 1));\r\n}\r\n(void)acpi_ut_release_mutex(ACPI_MTX_CACHES);\r\nreturn_VOID;\r\n}
