static int patch_cmi9880(struct hda_codec *codec)\r\n{\r\nstruct cmi_spec *spec;\r\nstruct auto_pin_cfg *cfg;\r\nint err;\r\nspec = kzalloc(sizeof(*spec), GFP_KERNEL);\r\nif (spec == NULL)\r\nreturn -ENOMEM;\r\ncodec->spec = spec;\r\ncodec->patch_ops = cmi_auto_patch_ops;\r\ncfg = &spec->gen.autocfg;\r\nsnd_hda_gen_spec_init(&spec->gen);\r\nerr = snd_hda_parse_pin_defcfg(codec, cfg, NULL, 0);\r\nif (err < 0)\r\ngoto error;\r\nerr = snd_hda_gen_parse_auto_config(codec, cfg);\r\nif (err < 0)\r\ngoto error;\r\nreturn 0;\r\nerror:\r\nsnd_hda_gen_free(codec);\r\nreturn err;\r\n}\r\nstatic int patch_cmi8888(struct hda_codec *codec)\r\n{\r\nstruct cmi_spec *spec;\r\nstruct auto_pin_cfg *cfg;\r\nint err;\r\nspec = kzalloc(sizeof(*spec), GFP_KERNEL);\r\nif (!spec)\r\nreturn -ENOMEM;\r\ncodec->spec = spec;\r\ncodec->patch_ops = cmi_auto_patch_ops;\r\ncfg = &spec->gen.autocfg;\r\nsnd_hda_gen_spec_init(&spec->gen);\r\nspec->gen.out_vol_mask = (1ULL << 0x10);\r\nerr = snd_hda_parse_pin_defcfg(codec, cfg, NULL, 0);\r\nif (err < 0)\r\ngoto error;\r\nerr = snd_hda_gen_parse_auto_config(codec, cfg);\r\nif (err < 0)\r\ngoto error;\r\nif (get_defcfg_device(snd_hda_codec_get_pincfg(codec, 0x10)) ==\r\nAC_JACK_HP_OUT) {\r\nstatic const struct snd_kcontrol_new amp_kctl =\r\nHDA_CODEC_VOLUME("Headphone Amp Playback Volume",\r\n0x10, 0, HDA_OUTPUT);\r\nif (!snd_hda_gen_add_kctl(&spec->gen, NULL, &amp_kctl)) {\r\nerr = -ENOMEM;\r\ngoto error;\r\n}\r\n}\r\nreturn 0;\r\nerror:\r\nsnd_hda_gen_free(codec);\r\nreturn err;\r\n}
