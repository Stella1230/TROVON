void __init corenet_gen_pic_init(void)\r\n{\r\nstruct mpic *mpic;\r\nunsigned int flags = MPIC_BIG_ENDIAN | MPIC_SINGLE_DEST_CPU |\r\nMPIC_NO_RESET;\r\nstruct device_node *np;\r\nif (ppc_md.get_irq == mpic_get_coreint_irq)\r\nflags |= MPIC_ENABLE_COREINT;\r\nmpic = mpic_alloc(NULL, 0, flags, 0, 512, " OpenPIC ");\r\nBUG_ON(mpic == NULL);\r\nmpic_init(mpic);\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,qe-ic");\r\nif (np) {\r\nqe_ic_init(np, 0, qe_ic_cascade_low_mpic,\r\nqe_ic_cascade_high_mpic);\r\nof_node_put(np);\r\n}\r\n}\r\nvoid __init corenet_gen_setup_arch(void)\r\n{\r\nmpc85xx_smp_init();\r\nswiotlb_detect_4g();\r\n#if defined(CONFIG_FSL_PCI) && defined(CONFIG_ZONE_DMA32)\r\nlimit_zone_pfn(ZONE_DMA32, 1UL << (31 - PAGE_SHIFT));\r\n#endif\r\npr_info("%s board\n", ppc_md.name);\r\nmpc85xx_qe_init();\r\n}\r\nint __init corenet_gen_publish_devices(void)\r\n{\r\nreturn of_platform_bus_probe(NULL, of_device_ids, NULL);\r\n}\r\nstatic int __init corenet_generic_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nchar hv_compat[24];\r\nint i;\r\n#ifdef CONFIG_SMP\r\nextern struct smp_ops_t smp_85xx_ops;\r\n#endif\r\nif (of_flat_dt_match(root, boards))\r\nreturn 1;\r\nfor (i = 0; boards[i]; i++) {\r\nsnprintf(hv_compat, sizeof(hv_compat), "%s-hv", boards[i]);\r\nif (of_flat_dt_is_compatible(root, hv_compat)) {\r\nppc_md.init_IRQ = ehv_pic_init;\r\nppc_md.get_irq = ehv_pic_get_irq;\r\nppc_md.restart = fsl_hv_restart;\r\npm_power_off = fsl_hv_halt;\r\nppc_md.halt = fsl_hv_halt;\r\n#ifdef CONFIG_SMP\r\nsmp_85xx_ops.give_timebase = NULL;\r\nsmp_85xx_ops.take_timebase = NULL;\r\n#endif\r\nreturn 1;\r\n}\r\n}\r\nreturn 0;\r\n}
