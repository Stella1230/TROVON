void pcireg_control_bit_clr(struct pcibus_info *pcibus_info, u64 bits)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\n__sn_clrq_relaxed(&ptr->tio.cp_control, bits);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\n__sn_clrq_relaxed(&ptr->pic.p_wid_control, bits);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_control_bit_clr: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nvoid pcireg_control_bit_set(struct pcibus_info *pcibus_info, u64 bits)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\n__sn_setq_relaxed(&ptr->tio.cp_control, bits);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\n__sn_setq_relaxed(&ptr->pic.p_wid_control, bits);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_control_bit_set: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nu64 pcireg_tflush_get(struct pcibus_info *pcibus_info)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nu64 ret = 0;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nret = __sn_readq_relaxed(&ptr->tio.cp_tflush);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nret = __sn_readq_relaxed(&ptr->pic.p_wid_tflush);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_tflush_get: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\nif (ret != 0)\r\npanic("pcireg_tflush_get:Target Flush failed\n");\r\nreturn ret;\r\n}\r\nu64 pcireg_intr_status_get(struct pcibus_info * pcibus_info)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nu64 ret = 0;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nret = __sn_readq_relaxed(&ptr->tio.cp_int_status);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nret = __sn_readq_relaxed(&ptr->pic.p_int_status);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_intr_status_get: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\nreturn ret;\r\n}\r\nvoid pcireg_intr_enable_bit_clr(struct pcibus_info *pcibus_info, u64 bits)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\n__sn_clrq_relaxed(&ptr->tio.cp_int_enable, bits);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\n__sn_clrq_relaxed(&ptr->pic.p_int_enable, bits);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_intr_enable_bit_clr: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nvoid pcireg_intr_enable_bit_set(struct pcibus_info *pcibus_info, u64 bits)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\n__sn_setq_relaxed(&ptr->tio.cp_int_enable, bits);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\n__sn_setq_relaxed(&ptr->pic.p_int_enable, bits);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_intr_enable_bit_set: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nvoid pcireg_intr_addr_addr_set(struct pcibus_info *pcibus_info, int int_n,\r\nu64 addr)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\n__sn_clrq_relaxed(&ptr->tio.cp_int_addr[int_n],\r\nTIOCP_HOST_INTR_ADDR);\r\n__sn_setq_relaxed(&ptr->tio.cp_int_addr[int_n],\r\n(addr & TIOCP_HOST_INTR_ADDR));\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\n__sn_clrq_relaxed(&ptr->pic.p_int_addr[int_n],\r\nPIC_HOST_INTR_ADDR);\r\n__sn_setq_relaxed(&ptr->pic.p_int_addr[int_n],\r\n(addr & PIC_HOST_INTR_ADDR));\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_intr_addr_addr_get: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nvoid pcireg_force_intr_set(struct pcibus_info *pcibus_info, int int_n)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nwriteq(1, &ptr->tio.cp_force_pin[int_n]);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nwriteq(1, &ptr->pic.p_force_pin[int_n]);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_force_intr_set: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nu64 pcireg_wrb_flush_get(struct pcibus_info *pcibus_info, int device)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nu64 ret = 0;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nret =\r\n__sn_readq_relaxed(&ptr->tio.cp_wr_req_buf[device]);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nret =\r\n__sn_readq_relaxed(&ptr->pic.p_wr_req_buf[device]);\r\nbreak;\r\ndefault:\r\npanic("pcireg_wrb_flush_get: unknown bridgetype bridge 0x%p", ptr);\r\n}\r\n}\r\nreturn ret;\r\n}\r\nvoid pcireg_int_ate_set(struct pcibus_info *pcibus_info, int ate_index,\r\nu64 val)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nwriteq(val, &ptr->tio.cp_int_ate_ram[ate_index]);\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nwriteq(val, &ptr->pic.p_int_ate_ram[ate_index]);\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_int_ate_set: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\n}\r\nu64 __iomem *pcireg_int_ate_addr(struct pcibus_info *pcibus_info, int ate_index)\r\n{\r\nunion br_ptr __iomem *ptr = (union br_ptr __iomem *)pcibus_info->pbi_buscommon.bs_base;\r\nu64 __iomem *ret = NULL;\r\nif (pcibus_info) {\r\nswitch (pcibus_info->pbi_bridge_type) {\r\ncase PCIBR_BRIDGETYPE_TIOCP:\r\nret = &ptr->tio.cp_int_ate_ram[ate_index];\r\nbreak;\r\ncase PCIBR_BRIDGETYPE_PIC:\r\nret = &ptr->pic.p_int_ate_ram[ate_index];\r\nbreak;\r\ndefault:\r\npanic\r\n("pcireg_int_ate_addr: unknown bridgetype bridge 0x%p",\r\nptr);\r\n}\r\n}\r\nreturn ret;\r\n}
