static void __init p720t_mmgpio_init(void __iomem *addrbase, int gpiobase)\r\n{\r\np720t_mmgpio_resource[0].start = (unsigned long)addrbase;\r\np720t_mmgpio_pdata.base = gpiobase;\r\nplatform_device_register(&p720t_mmgpio);\r\n}\r\nstatic void p720t_lcd_power_set(struct plat_lcd_data *pd, unsigned int power)\r\n{\r\nif (power) {\r\ngpio_set_value(PLD_LCDEN_EN, 1);\r\ngpio_set_value(PLD_S1_ON, 1);\r\ngpio_set_value(PLD_S2_ON, 1);\r\ngpio_set_value(PLD_S4_ON, 1);\r\n} else {\r\ngpio_set_value(PLD_S1_ON, 0);\r\ngpio_set_value(PLD_S2_ON, 0);\r\ngpio_set_value(PLD_S4_ON, 0);\r\ngpio_set_value(PLD_LCDEN_EN, 0);\r\n}\r\n}\r\nstatic void p720t_lcd_backlight_set_intensity(int intensity)\r\n{\r\ngpio_set_value(PLD_S3_ON, intensity);\r\n}\r\nstatic void __init\r\nfixup_p720t(struct tag *tag, char **cmdline)\r\n{\r\nif (tag->hdr.tag != ATAG_CORE) {\r\ntag->hdr.tag = ATAG_CORE;\r\ntag->hdr.size = tag_size(tag_core);\r\ntag->u.core.flags = 0;\r\ntag->u.core.pagesize = PAGE_SIZE;\r\ntag->u.core.rootdev = 0x0100;\r\ntag = tag_next(tag);\r\ntag->hdr.tag = ATAG_MEM;\r\ntag->hdr.size = tag_size(tag_mem32);\r\ntag->u.mem.size = 4096;\r\ntag->u.mem.start = PHYS_OFFSET;\r\ntag = tag_next(tag);\r\ntag->hdr.tag = ATAG_NONE;\r\ntag->hdr.size = 0;\r\n}\r\n}\r\nstatic void __init p720t_init(void)\r\n{\r\nint i;\r\nclps711x_devices_init();\r\nfor (i = 0; i < ARRAY_SIZE(mmgpios); i++)\r\np720t_mmgpio_init(mmgpios[i].addrbase, mmgpios[i].gpiobase);\r\nplatform_device_register(&p720t_nand_pdev);\r\n}\r\nstatic void __init p720t_init_late(void)\r\n{\r\nWARN_ON(gpio_request_array(p720t_gpios, ARRAY_SIZE(p720t_gpios)));\r\nplatform_device_register_data(NULL, "platform-lcd", 0,\r\n&p720t_lcd_power_pdata,\r\nsizeof(p720t_lcd_power_pdata));\r\nplatform_device_register_data(NULL, "generic-bl", 0,\r\n&p720t_lcd_backlight_pdata,\r\nsizeof(p720t_lcd_backlight_pdata));\r\nplatform_device_register_simple("video-clps711x", 0, NULL, 0);\r\nplatform_device_register_data(NULL, "leds-gpio", 0,\r\n&p720t_gpio_led_pdata,\r\nsizeof(p720t_gpio_led_pdata));\r\n}
