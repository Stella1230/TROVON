static inline void grackle_set_stg(struct pci_controller* bp, int enable)\r\n{\r\nunsigned int val;\r\nout_be32(bp->cfg_addr, GRACKLE_CFA(0, 0, 0xa8));\r\nval = in_le32(bp->cfg_data);\r\nval = enable? (val | GRACKLE_PICR1_STG) :\r\n(val & ~GRACKLE_PICR1_STG);\r\nout_be32(bp->cfg_addr, GRACKLE_CFA(0, 0, 0xa8));\r\nout_le32(bp->cfg_data, val);\r\n(void)in_le32(bp->cfg_data);\r\n}\r\nstatic inline void grackle_set_loop_snoop(struct pci_controller *bp, int enable)\r\n{\r\nunsigned int val;\r\nout_be32(bp->cfg_addr, GRACKLE_CFA(0, 0, 0xa8));\r\nval = in_le32(bp->cfg_data);\r\nval = enable? (val | GRACKLE_PICR1_LOOPSNOOP) :\r\n(val & ~GRACKLE_PICR1_LOOPSNOOP);\r\nout_be32(bp->cfg_addr, GRACKLE_CFA(0, 0, 0xa8));\r\nout_le32(bp->cfg_data, val);\r\n(void)in_le32(bp->cfg_data);\r\n}\r\nvoid __init setup_grackle(struct pci_controller *hose)\r\n{\r\nsetup_indirect_pci(hose, 0xfec00000, 0xfee00000, 0);\r\nif (of_machine_is_compatible("PowerMac1,1"))\r\npci_add_flags(PCI_REASSIGN_ALL_BUS);\r\nif (of_machine_is_compatible("AAPL,PowerBook1998"))\r\ngrackle_set_loop_snoop(hose, 1);\r\n#if 0\r\ngrackle_set_stg(hose, 1);\r\n#endif\r\n}
