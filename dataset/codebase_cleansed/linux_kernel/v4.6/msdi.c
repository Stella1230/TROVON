int omap_msdi_reset(struct omap_hwmod *oh)\r\n{\r\nu16 v = 0;\r\nint c = 0;\r\nomap_hwmod_softreset(oh);\r\nv |= MSDI_CON_POW_MASK;\r\nv |= MSDI_TARGET_RESET_CLKD << MSDI_CON_CLKD_SHIFT;\r\nomap_hwmod_write(v, oh, MSDI_CON_OFFSET);\r\nomap_test_timeout((omap_hwmod_read(oh, oh->class->sysc->syss_offs)\r\n& SYSS_RESETDONE_MASK),\r\nMAX_MODULE_SOFTRESET_WAIT, c);\r\nif (c == MAX_MODULE_SOFTRESET_WAIT)\r\npr_warn("%s: %s: softreset failed (waited %d usec)\n",\r\n__func__, oh->name, MAX_MODULE_SOFTRESET_WAIT);\r\nelse\r\npr_debug("%s: %s: softreset in %d usec\n", __func__,\r\noh->name, c);\r\nv &= ~MSDI_CON_CLKD_MASK;\r\nomap_hwmod_write(v, oh, MSDI_CON_OFFSET);\r\nreturn 0;\r\n}
