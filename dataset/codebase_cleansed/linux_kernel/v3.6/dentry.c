static int hpfs_hash_dentry(const struct dentry *dentry, const struct inode *inode,\r\nstruct qstr *qstr)\r\n{\r\nunsigned long hash;\r\nint i;\r\nunsigned l = qstr->len;\r\nif (l == 1) if (qstr->name[0]=='.') goto x;\r\nif (l == 2) if (qstr->name[0]=='.' || qstr->name[1]=='.') goto x;\r\nhpfs_adjust_length(qstr->name, &l);\r\nx:\r\nhash = init_name_hash();\r\nfor (i = 0; i < l; i++)\r\nhash = partial_name_hash(hpfs_upcase(hpfs_sb(dentry->d_sb)->sb_cp_table,qstr->name[i]), hash);\r\nqstr->hash = end_name_hash(hash);\r\nreturn 0;\r\n}\r\nstatic int hpfs_compare_dentry(const struct dentry *parent,\r\nconst struct inode *pinode,\r\nconst struct dentry *dentry, const struct inode *inode,\r\nunsigned int len, const char *str, const struct qstr *name)\r\n{\r\nunsigned al = len;\r\nunsigned bl = name->len;\r\nhpfs_adjust_length(str, &al);\r\nif (hpfs_chk_name(name->name, &bl))\r\nreturn 1;\r\nif (hpfs_compare_names(parent->d_sb, str, al, name->name, bl, 0))\r\nreturn 1;\r\nreturn 0;\r\n}
