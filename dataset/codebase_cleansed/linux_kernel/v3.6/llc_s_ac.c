int llc_sap_action_unitdata_ind(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nllc_sap_rtn_pdu(sap, skb);\r\nreturn 0;\r\n}\r\nint llc_sap_action_send_ui(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nstruct llc_sap_state_ev *ev = llc_sap_ev(skb);\r\nint rc;\r\nllc_pdu_header_init(skb, LLC_PDU_TYPE_U, ev->saddr.lsap,\r\nev->daddr.lsap, LLC_PDU_CMD);\r\nllc_pdu_init_as_ui_cmd(skb);\r\nrc = llc_mac_hdr_init(skb, ev->saddr.mac, ev->daddr.mac);\r\nif (likely(!rc))\r\nrc = dev_queue_xmit(skb);\r\nreturn rc;\r\n}\r\nint llc_sap_action_send_xid_c(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nstruct llc_sap_state_ev *ev = llc_sap_ev(skb);\r\nint rc;\r\nllc_pdu_header_init(skb, LLC_PDU_TYPE_U, ev->saddr.lsap,\r\nev->daddr.lsap, LLC_PDU_CMD);\r\nllc_pdu_init_as_xid_cmd(skb, LLC_XID_NULL_CLASS_2, 0);\r\nrc = llc_mac_hdr_init(skb, ev->saddr.mac, ev->daddr.mac);\r\nif (likely(!rc))\r\nrc = dev_queue_xmit(skb);\r\nreturn rc;\r\n}\r\nint llc_sap_action_send_xid_r(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nu8 mac_da[ETH_ALEN], mac_sa[ETH_ALEN], dsap;\r\nint rc = 1;\r\nstruct sk_buff *nskb;\r\nllc_pdu_decode_sa(skb, mac_da);\r\nllc_pdu_decode_da(skb, mac_sa);\r\nllc_pdu_decode_ssap(skb, &dsap);\r\nnskb = llc_alloc_frame(NULL, skb->dev, LLC_PDU_TYPE_U,\r\nsizeof(struct llc_xid_info));\r\nif (!nskb)\r\ngoto out;\r\nllc_pdu_header_init(nskb, LLC_PDU_TYPE_U, sap->laddr.lsap, dsap,\r\nLLC_PDU_RSP);\r\nllc_pdu_init_as_xid_rsp(nskb, LLC_XID_NULL_CLASS_2, 0);\r\nrc = llc_mac_hdr_init(nskb, mac_sa, mac_da);\r\nif (likely(!rc))\r\nrc = dev_queue_xmit(nskb);\r\nout:\r\nreturn rc;\r\n}\r\nint llc_sap_action_send_test_c(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nstruct llc_sap_state_ev *ev = llc_sap_ev(skb);\r\nint rc;\r\nllc_pdu_header_init(skb, LLC_PDU_TYPE_U, ev->saddr.lsap,\r\nev->daddr.lsap, LLC_PDU_CMD);\r\nllc_pdu_init_as_test_cmd(skb);\r\nrc = llc_mac_hdr_init(skb, ev->saddr.mac, ev->daddr.mac);\r\nif (likely(!rc))\r\nrc = dev_queue_xmit(skb);\r\nreturn rc;\r\n}\r\nint llc_sap_action_send_test_r(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nu8 mac_da[ETH_ALEN], mac_sa[ETH_ALEN], dsap;\r\nstruct sk_buff *nskb;\r\nint rc = 1;\r\nu32 data_size;\r\nllc_pdu_decode_sa(skb, mac_da);\r\nllc_pdu_decode_da(skb, mac_sa);\r\nllc_pdu_decode_ssap(skb, &dsap);\r\ndata_size = ntohs(eth_hdr(skb)->h_proto) - 3;\r\nnskb = llc_alloc_frame(NULL, skb->dev, LLC_PDU_TYPE_U, data_size);\r\nif (!nskb)\r\ngoto out;\r\nllc_pdu_header_init(nskb, LLC_PDU_TYPE_U, sap->laddr.lsap, dsap,\r\nLLC_PDU_RSP);\r\nllc_pdu_init_as_test_rsp(nskb, skb);\r\nrc = llc_mac_hdr_init(nskb, mac_sa, mac_da);\r\nif (likely(!rc))\r\nrc = dev_queue_xmit(nskb);\r\nout:\r\nreturn rc;\r\n}\r\nint llc_sap_action_report_status(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nreturn 0;\r\n}\r\nint llc_sap_action_xid_ind(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nllc_sap_rtn_pdu(sap, skb);\r\nreturn 0;\r\n}\r\nint llc_sap_action_test_ind(struct llc_sap *sap, struct sk_buff *skb)\r\n{\r\nllc_sap_rtn_pdu(sap, skb);\r\nreturn 0;\r\n}
