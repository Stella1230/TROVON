static int hvc_udbg_put(uint32_t vtermno, const char *buf, int count)\r\n{\r\nint i;\r\nfor (i = 0; i < count && udbg_putc; i++)\r\nudbg_putc(buf[i]);\r\nreturn i;\r\n}\r\nstatic int hvc_udbg_get(uint32_t vtermno, char *buf, int count)\r\n{\r\nint i, c;\r\nif (!udbg_getc_poll)\r\nreturn 0;\r\nfor (i = 0; i < count; i++) {\r\nif ((c = udbg_getc_poll()) == -1)\r\nbreak;\r\nbuf[i] = c;\r\n}\r\nreturn i;\r\n}\r\nstatic int __init hvc_udbg_init(void)\r\n{\r\nstruct hvc_struct *hp;\r\nif (!udbg_putc)\r\nreturn -ENODEV;\r\nBUG_ON(hvc_udbg_dev);\r\nhp = hvc_alloc(0, 0, &hvc_udbg_ops, 16);\r\nif (IS_ERR(hp))\r\nreturn PTR_ERR(hp);\r\nhvc_udbg_dev = hp;\r\nreturn 0;\r\n}\r\nstatic void __exit hvc_udbg_exit(void)\r\n{\r\nif (hvc_udbg_dev)\r\nhvc_remove(hvc_udbg_dev);\r\n}\r\nstatic int __init hvc_udbg_console_init(void)\r\n{\r\nif (!udbg_putc)\r\nreturn -ENODEV;\r\nhvc_instantiate(0, 0, &hvc_udbg_ops);\r\nadd_preferred_console("hvc", 0, NULL);\r\nreturn 0;\r\n}
