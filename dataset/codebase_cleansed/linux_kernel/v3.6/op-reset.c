int wimax_reset(struct wimax_dev *wimax_dev)\r\n{\r\nint result = -EINVAL;\r\nstruct device *dev = wimax_dev_to_dev(wimax_dev);\r\nenum wimax_st state;\r\nmight_sleep();\r\nd_fnstart(3, dev, "(wimax_dev %p)\n", wimax_dev);\r\nmutex_lock(&wimax_dev->mutex);\r\ndev_hold(wimax_dev->net_dev);\r\nstate = wimax_dev->state;\r\nmutex_unlock(&wimax_dev->mutex);\r\nif (state >= WIMAX_ST_DOWN) {\r\nmutex_lock(&wimax_dev->mutex_reset);\r\nresult = wimax_dev->op_reset(wimax_dev);\r\nmutex_unlock(&wimax_dev->mutex_reset);\r\n}\r\ndev_put(wimax_dev->net_dev);\r\nd_fnend(3, dev, "(wimax_dev %p) = %d\n", wimax_dev, result);\r\nreturn result;\r\n}\r\nstatic\r\nint wimax_gnl_doit_reset(struct sk_buff *skb, struct genl_info *info)\r\n{\r\nint result, ifindex;\r\nstruct wimax_dev *wimax_dev;\r\nd_fnstart(3, NULL, "(skb %p info %p)\n", skb, info);\r\nresult = -ENODEV;\r\nif (info->attrs[WIMAX_GNL_RESET_IFIDX] == NULL) {\r\nprintk(KERN_ERR "WIMAX_GNL_OP_RFKILL: can't find IFIDX "\r\n"attribute\n");\r\ngoto error_no_wimax_dev;\r\n}\r\nifindex = nla_get_u32(info->attrs[WIMAX_GNL_RESET_IFIDX]);\r\nwimax_dev = wimax_dev_get_by_genl_info(info, ifindex);\r\nif (wimax_dev == NULL)\r\ngoto error_no_wimax_dev;\r\nresult = wimax_reset(wimax_dev);\r\ndev_put(wimax_dev->net_dev);\r\nerror_no_wimax_dev:\r\nd_fnend(3, NULL, "(skb %p info %p) = %d\n", skb, info, result);\r\nreturn result;\r\n}
