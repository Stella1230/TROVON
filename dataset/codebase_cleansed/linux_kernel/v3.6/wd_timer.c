int omap2_wd_timer_disable(struct omap_hwmod *oh)\r\n{\r\nvoid __iomem *base;\r\nif (!oh) {\r\npr_err("%s: Could not look up wdtimer_hwmod\n", __func__);\r\nreturn -EINVAL;\r\n}\r\nbase = omap_hwmod_get_mpu_rt_va(oh);\r\nif (!base) {\r\npr_err("%s: Could not get the base address for %s\n",\r\noh->name, __func__);\r\nreturn -EINVAL;\r\n}\r\n__raw_writel(0xAAAA, base + OMAP_WDT_SPR);\r\nwhile (__raw_readl(base + OMAP_WDT_WPS) & 0x10)\r\ncpu_relax();\r\n__raw_writel(0x5555, base + OMAP_WDT_SPR);\r\nwhile (__raw_readl(base + OMAP_WDT_WPS) & 0x10)\r\ncpu_relax();\r\nreturn 0;\r\n}\r\nint omap2_wd_timer_reset(struct omap_hwmod *oh)\r\n{\r\nint c = 0;\r\nomap_hwmod_softreset(oh);\r\nomap_test_timeout((omap_hwmod_read(oh,\r\noh->class->sysc->syss_offs)\r\n& SYSS_RESETDONE_MASK),\r\nMAX_MODULE_SOFTRESET_WAIT, c);\r\nif (oh->class->sysc->srst_udelay)\r\nudelay(oh->class->sysc->srst_udelay);\r\nif (c == MAX_MODULE_SOFTRESET_WAIT)\r\npr_warning("%s: %s: softreset failed (waited %d usec)\n",\r\n__func__, oh->name, MAX_MODULE_SOFTRESET_WAIT);\r\nelse\r\npr_debug("%s: %s: softreset in %d usec\n", __func__,\r\noh->name, c);\r\nreturn (c == MAX_MODULE_SOFTRESET_WAIT) ? -ETIMEDOUT :\r\nomap2_wd_timer_disable(oh);\r\n}
