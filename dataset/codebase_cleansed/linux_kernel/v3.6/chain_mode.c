unsigned int stmmac_jumbo_frm(void *p, struct sk_buff *skb, int csum)\r\n{\r\nstruct stmmac_priv *priv = (struct stmmac_priv *) p;\r\nunsigned int txsize = priv->dma_tx_size;\r\nunsigned int entry = priv->cur_tx % txsize;\r\nstruct dma_desc *desc = priv->dma_tx + entry;\r\nunsigned int nopaged_len = skb_headlen(skb);\r\nunsigned int bmax;\r\nunsigned int i = 1, len;\r\nif (priv->plat->enh_desc)\r\nbmax = BUF_SIZE_8KiB;\r\nelse\r\nbmax = BUF_SIZE_2KiB;\r\nlen = nopaged_len - bmax;\r\ndesc->des2 = dma_map_single(priv->device, skb->data,\r\nbmax, DMA_TO_DEVICE);\r\npriv->hw->desc->prepare_tx_desc(desc, 1, bmax, csum);\r\nwhile (len != 0) {\r\nentry = (++priv->cur_tx) % txsize;\r\ndesc = priv->dma_tx + entry;\r\nif (len > bmax) {\r\ndesc->des2 = dma_map_single(priv->device,\r\n(skb->data + bmax * i),\r\nbmax, DMA_TO_DEVICE);\r\npriv->hw->desc->prepare_tx_desc(desc, 0, bmax,\r\ncsum);\r\npriv->hw->desc->set_tx_owner(desc);\r\npriv->tx_skbuff[entry] = NULL;\r\nlen -= bmax;\r\ni++;\r\n} else {\r\ndesc->des2 = dma_map_single(priv->device,\r\n(skb->data + bmax * i), len,\r\nDMA_TO_DEVICE);\r\npriv->hw->desc->prepare_tx_desc(desc, 0, len,\r\ncsum);\r\npriv->hw->desc->set_tx_owner(desc);\r\npriv->tx_skbuff[entry] = NULL;\r\nlen = 0;\r\n}\r\n}\r\nreturn entry;\r\n}\r\nstatic unsigned int stmmac_is_jumbo_frm(int len, int enh_desc)\r\n{\r\nunsigned int ret = 0;\r\nif ((enh_desc && (len > BUF_SIZE_8KiB)) ||\r\n(!enh_desc && (len > BUF_SIZE_2KiB))) {\r\nret = 1;\r\n}\r\nreturn ret;\r\n}\r\nstatic void stmmac_refill_desc3(int bfsize, struct dma_desc *p)\r\n{\r\n}\r\nstatic void stmmac_init_desc3(int des3_as_data_buf, struct dma_desc *p)\r\n{\r\n}\r\nstatic void stmmac_clean_desc3(struct dma_desc *p)\r\n{\r\n}\r\nstatic void stmmac_init_dma_chain(struct dma_desc *des, dma_addr_t phy_addr,\r\nunsigned int size)\r\n{\r\nint i;\r\nstruct dma_desc *p = des;\r\ndma_addr_t dma_phy = phy_addr;\r\nfor (i = 0; i < (size - 1); i++) {\r\ndma_phy += sizeof(struct dma_desc);\r\np->des3 = (unsigned int)dma_phy;\r\np++;\r\n}\r\np->des3 = (unsigned int)phy_addr;\r\n}\r\nstatic int stmmac_set_16kib_bfsize(int mtu)\r\n{\r\nreturn 0;\r\n}
