bool llist_add_batch(struct llist_node *new_first, struct llist_node *new_last,\r\nstruct llist_head *head)\r\n{\r\nstruct llist_node *entry, *old_entry;\r\nentry = head->first;\r\nfor (;;) {\r\nold_entry = entry;\r\nnew_last->next = entry;\r\nentry = cmpxchg(&head->first, old_entry, new_first);\r\nif (entry == old_entry)\r\nbreak;\r\n}\r\nreturn old_entry == NULL;\r\n}\r\nstruct llist_node *llist_del_first(struct llist_head *head)\r\n{\r\nstruct llist_node *entry, *old_entry, *next;\r\nentry = head->first;\r\nfor (;;) {\r\nif (entry == NULL)\r\nreturn NULL;\r\nold_entry = entry;\r\nnext = entry->next;\r\nentry = cmpxchg(&head->first, old_entry, next);\r\nif (entry == old_entry)\r\nbreak;\r\n}\r\nreturn entry;\r\n}
