static inline struct tps65090_regulator *find_regulator_info(int id)\r\n{\r\nstruct tps65090_regulator *ri;\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(TPS65090_regulator); i++) {\r\nri = &TPS65090_regulator[i];\r\nif (ri->desc.id == id)\r\nreturn ri;\r\n}\r\nreturn NULL;\r\n}\r\nstatic int __devinit tps65090_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65090 *tps65090_mfd = dev_get_drvdata(pdev->dev.parent);\r\nstruct tps65090_regulator *ri = NULL;\r\nstruct regulator_config config = { };\r\nstruct regulator_dev *rdev;\r\nstruct tps65090_regulator_platform_data *tps_pdata;\r\nint id = pdev->id;\r\ndev_dbg(&pdev->dev, "Probing regulator %d\n", id);\r\nri = find_regulator_info(id);\r\nif (ri == NULL) {\r\ndev_err(&pdev->dev, "invalid regulator ID specified\n");\r\nreturn -EINVAL;\r\n}\r\ntps_pdata = pdev->dev.platform_data;\r\nri->dev = &pdev->dev;\r\nconfig.dev = &pdev->dev;\r\nconfig.init_data = &tps_pdata->regulator;\r\nconfig.driver_data = ri;\r\nconfig.regmap = tps65090_mfd->rmap;\r\nrdev = regulator_register(&ri->desc, &config);\r\nif (IS_ERR(rdev)) {\r\ndev_err(&pdev->dev, "failed to register regulator %s\n",\r\nri->desc.name);\r\nreturn PTR_ERR(rdev);\r\n}\r\nplatform_set_drvdata(pdev, rdev);\r\nreturn 0;\r\n}\r\nstatic int __devexit tps65090_regulator_remove(struct platform_device *pdev)\r\n{\r\nstruct regulator_dev *rdev = platform_get_drvdata(pdev);\r\nregulator_unregister(rdev);\r\nreturn 0;\r\n}\r\nstatic int __init tps65090_regulator_init(void)\r\n{\r\nreturn platform_driver_register(&tps65090_regulator_driver);\r\n}\r\nstatic void __exit tps65090_regulator_exit(void)\r\n{\r\nplatform_driver_unregister(&tps65090_regulator_driver);\r\n}
