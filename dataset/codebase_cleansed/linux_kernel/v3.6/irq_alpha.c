static void\r\ndummy_perf(unsigned long vector, struct pt_regs *regs)\r\n{\r\nirq_err_count++;\r\nprintk(KERN_CRIT "Performance counter interrupt!\n");\r\n}\r\nasmlinkage void\r\ndo_entInt(unsigned long type, unsigned long vector,\r\nunsigned long la_ptr, struct pt_regs *regs)\r\n{\r\nstruct pt_regs *old_regs;\r\nswitch (type) {\r\ncase 0:\r\n#ifdef CONFIG_SMP\r\nhandle_ipi(regs);\r\nreturn;\r\n#else\r\nirq_err_count++;\r\nprintk(KERN_CRIT "Interprocessor interrupt? "\r\n"You must be kidding!\n");\r\n#endif\r\nbreak;\r\ncase 1:\r\nold_regs = set_irq_regs(regs);\r\n#ifdef CONFIG_SMP\r\n{\r\nlong cpu;\r\nlocal_irq_disable();\r\nsmp_percpu_timer_interrupt(regs);\r\ncpu = smp_processor_id();\r\nif (cpu != boot_cpuid) {\r\nkstat_incr_irqs_this_cpu(RTC_IRQ, irq_to_desc(RTC_IRQ));\r\n} else {\r\nhandle_irq(RTC_IRQ);\r\n}\r\n}\r\n#else\r\nhandle_irq(RTC_IRQ);\r\n#endif\r\nset_irq_regs(old_regs);\r\nreturn;\r\ncase 2:\r\nold_regs = set_irq_regs(regs);\r\nalpha_mv.machine_check(vector, la_ptr);\r\nset_irq_regs(old_regs);\r\nreturn;\r\ncase 3:\r\nold_regs = set_irq_regs(regs);\r\nalpha_mv.device_interrupt(vector);\r\nset_irq_regs(old_regs);\r\nreturn;\r\ncase 4:\r\nperf_irq(la_ptr, regs);\r\nreturn;\r\ndefault:\r\nprintk(KERN_CRIT "Hardware intr %ld %lx? Huh?\n",\r\ntype, vector);\r\n}\r\nprintk(KERN_CRIT "PC = %016lx PS=%04lx\n", regs->pc, regs->ps);\r\n}\r\nvoid __init\r\ncommon_init_isa_dma(void)\r\n{\r\noutb(0, DMA1_RESET_REG);\r\noutb(0, DMA2_RESET_REG);\r\noutb(0, DMA1_CLR_MASK_REG);\r\noutb(0, DMA2_CLR_MASK_REG);\r\n}\r\nvoid __init\r\ninit_IRQ(void)\r\n{\r\nwrent(entInt, 0);\r\nalpha_mv.init_irq();\r\n}\r\nvoid\r\nprocess_mcheck_info(unsigned long vector, unsigned long la_ptr,\r\nconst char *machine, int expected)\r\n{\r\nstruct el_common *mchk_header;\r\nconst char *reason;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (alpha_verbose_mcheck > 1) {\r\nprintk(KERN_CRIT "%s machine check %s\n", machine,\r\nexpected ? "expected." : "NOT expected!!!");\r\n}\r\n#endif\r\nif (expected) {\r\nint cpu = smp_processor_id();\r\nmcheck_expected(cpu) = 0;\r\nmcheck_taken(cpu) = 1;\r\nreturn;\r\n}\r\nmchk_header = (struct el_common *)la_ptr;\r\nprintk(KERN_CRIT "%s machine check: vector=0x%lx pc=0x%lx code=0x%x\n",\r\nmachine, vector, get_irq_regs()->pc, mchk_header->code);\r\nswitch (mchk_header->code) {\r\ncase 0x80: reason = "tag parity error"; break;\r\ncase 0x82: reason = "tag control parity error"; break;\r\ncase 0x84: reason = "generic hard error"; break;\r\ncase 0x86: reason = "correctable ECC error"; break;\r\ncase 0x88: reason = "uncorrectable ECC error"; break;\r\ncase 0x8A: reason = "OS-specific PAL bugcheck"; break;\r\ncase 0x90: reason = "callsys in kernel mode"; break;\r\ncase 0x96: reason = "i-cache read retryable error"; break;\r\ncase 0x98: reason = "processor detected hard error"; break;\r\ncase 0x202: reason = "system detected hard error"; break;\r\ncase 0x203: reason = "system detected uncorrectable ECC error"; break;\r\ncase 0x204: reason = "SIO SERR occurred on PCI bus"; break;\r\ncase 0x205: reason = "parity error detected by core logic"; break;\r\ncase 0x206: reason = "SIO IOCHK occurred on ISA bus"; break;\r\ncase 0x207: reason = "non-existent memory error"; break;\r\ncase 0x208: reason = "MCHK_K_DCSR"; break;\r\ncase 0x209: reason = "PCI SERR detected"; break;\r\ncase 0x20b: reason = "PCI data parity error detected"; break;\r\ncase 0x20d: reason = "PCI address parity error detected"; break;\r\ncase 0x20f: reason = "PCI master abort error"; break;\r\ncase 0x211: reason = "PCI target abort error"; break;\r\ncase 0x213: reason = "scatter/gather PTE invalid error"; break;\r\ncase 0x215: reason = "flash ROM write error"; break;\r\ncase 0x217: reason = "IOA timeout detected"; break;\r\ncase 0x219: reason = "IOCHK#, EISA add-in board parity or other catastrophic error"; break;\r\ncase 0x21b: reason = "EISA fail-safe timer timeout"; break;\r\ncase 0x21d: reason = "EISA bus time-out"; break;\r\ncase 0x21f: reason = "EISA software generated NMI"; break;\r\ncase 0x221: reason = "unexpected ev5 IRQ[3] interrupt"; break;\r\ndefault: reason = "unknown"; break;\r\n}\r\nprintk(KERN_CRIT "machine check type: %s%s\n",\r\nreason, mchk_header->retry ? " (retryable)" : "");\r\ndik_show_regs(get_irq_regs(), NULL);\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (alpha_verbose_mcheck > 1) {\r\nunsigned long *ptr = (unsigned long *)la_ptr;\r\nlong i;\r\nfor (i = 0; i < mchk_header->size / sizeof(long); i += 2) {\r\nprintk(KERN_CRIT " +%8lx %016lx %016lx\n",\r\ni*sizeof(long), ptr[i], ptr[i+1]);\r\n}\r\n}\r\n#endif\r\n}\r\nvoid __init\r\ninit_rtc_irq(void)\r\n{\r\nirq_set_chip_and_handler_name(RTC_IRQ, &dummy_irq_chip,\r\nhandle_simple_irq, "RTC");\r\nsetup_irq(RTC_IRQ, &timer_irqaction);\r\n}
