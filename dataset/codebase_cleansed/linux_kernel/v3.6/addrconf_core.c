static inline unsigned int ipv6_addr_scope2type(unsigned int scope)\r\n{\r\nswitch (scope) {\r\ncase IPV6_ADDR_SCOPE_NODELOCAL:\r\nreturn (IPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_NODELOCAL) |\r\nIPV6_ADDR_LOOPBACK);\r\ncase IPV6_ADDR_SCOPE_LINKLOCAL:\r\nreturn (IPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_LINKLOCAL) |\r\nIPV6_ADDR_LINKLOCAL);\r\ncase IPV6_ADDR_SCOPE_SITELOCAL:\r\nreturn (IPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_SITELOCAL) |\r\nIPV6_ADDR_SITELOCAL);\r\n}\r\nreturn IPV6_ADDR_SCOPE_TYPE(scope);\r\n}\r\nint __ipv6_addr_type(const struct in6_addr *addr)\r\n{\r\n__be32 st;\r\nst = addr->s6_addr32[0];\r\nif ((st & htonl(0xE0000000)) != htonl(0x00000000) &&\r\n(st & htonl(0xE0000000)) != htonl(0xE0000000))\r\nreturn (IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_GLOBAL));\r\nif ((st & htonl(0xFF000000)) == htonl(0xFF000000)) {\r\nreturn (IPV6_ADDR_MULTICAST |\r\nipv6_addr_scope2type(IPV6_ADDR_MC_SCOPE(addr)));\r\n}\r\nif ((st & htonl(0xFFC00000)) == htonl(0xFE800000))\r\nreturn (IPV6_ADDR_LINKLOCAL | IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_LINKLOCAL));\r\nif ((st & htonl(0xFFC00000)) == htonl(0xFEC00000))\r\nreturn (IPV6_ADDR_SITELOCAL | IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_SITELOCAL));\r\nif ((st & htonl(0xFE000000)) == htonl(0xFC000000))\r\nreturn (IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_GLOBAL));\r\nif ((addr->s6_addr32[0] | addr->s6_addr32[1]) == 0) {\r\nif (addr->s6_addr32[2] == 0) {\r\nif (addr->s6_addr32[3] == 0)\r\nreturn IPV6_ADDR_ANY;\r\nif (addr->s6_addr32[3] == htonl(0x00000001))\r\nreturn (IPV6_ADDR_LOOPBACK | IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_LINKLOCAL));\r\nreturn (IPV6_ADDR_COMPATv4 | IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_GLOBAL));\r\n}\r\nif (addr->s6_addr32[2] == htonl(0x0000ffff))\r\nreturn (IPV6_ADDR_MAPPED |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_GLOBAL));\r\n}\r\nreturn (IPV6_ADDR_UNICAST |\r\nIPV6_ADDR_SCOPE_TYPE(IPV6_ADDR_SCOPE_GLOBAL));\r\n}
