static void __init am3517_evm_rtc_init(void)\r\n{\r\nint r;\r\nomap_mux_init_gpio(GPIO_RTCS35390A_IRQ, OMAP_PIN_INPUT_PULLUP);\r\nr = gpio_request_one(GPIO_RTCS35390A_IRQ, GPIOF_IN, "rtcs35390a-irq");\r\nif (r < 0) {\r\nprintk(KERN_WARNING "failed to request GPIO#%d\n",\r\nGPIO_RTCS35390A_IRQ);\r\nreturn;\r\n}\r\nam3517evm_i2c1_boardinfo[0].irq = gpio_to_irq(GPIO_RTCS35390A_IRQ);\r\n}\r\nstatic int __init am3517_evm_i2c_init(void)\r\n{\r\nomap_register_i2c_bus(1, 400, NULL, 0);\r\nomap_register_i2c_bus(2, 400, am3517evm_i2c2_boardinfo,\r\nARRAY_SIZE(am3517evm_i2c2_boardinfo));\r\nomap_register_i2c_bus(3, 400, am3517evm_i2c3_boardinfo,\r\nARRAY_SIZE(am3517evm_i2c3_boardinfo));\r\nreturn 0;\r\n}\r\nstatic void __init am3517_evm_display_init(void)\r\n{\r\nint r;\r\nomap_mux_init_gpio(LCD_PANEL_PWR, OMAP_PIN_INPUT_PULLUP);\r\nomap_mux_init_gpio(LCD_PANEL_BKLIGHT_PWR, OMAP_PIN_INPUT_PULLDOWN);\r\nomap_mux_init_gpio(LCD_PANEL_PWM, OMAP_PIN_INPUT_PULLDOWN);\r\nr = gpio_request_array(am3517_evm_dss_gpios,\r\nARRAY_SIZE(am3517_evm_dss_gpios));\r\nif (r) {\r\nprintk(KERN_ERR "failed to get DSS panel control GPIOs\n");\r\nreturn;\r\n}\r\nprintk(KERN_INFO "Display initialized successfully\n");\r\n}\r\nstatic void __init am3517_evm_display_init(void) {}\r\nstatic int am3517_evm_panel_enable_lcd(struct omap_dss_device *dssdev)\r\n{\r\nif (dvi_enabled) {\r\nprintk(KERN_ERR "cannot enable LCD, DVI is enabled\n");\r\nreturn -EINVAL;\r\n}\r\ngpio_set_value(LCD_PANEL_PWR, 1);\r\nlcd_enabled = 1;\r\nreturn 0;\r\n}\r\nstatic void am3517_evm_panel_disable_lcd(struct omap_dss_device *dssdev)\r\n{\r\ngpio_set_value(LCD_PANEL_PWR, 0);\r\nlcd_enabled = 0;\r\n}\r\nstatic int am3517_evm_panel_enable_tv(struct omap_dss_device *dssdev)\r\n{\r\nreturn 0;\r\n}\r\nstatic void am3517_evm_panel_disable_tv(struct omap_dss_device *dssdev)\r\n{\r\n}\r\nstatic __init void am3517_evm_musb_init(void)\r\n{\r\nu32 devconf2;\r\ndevconf2 = omap_ctrl_readl(AM35XX_CONTROL_DEVCONF2);\r\ndevconf2 &= ~(CONF2_REFFREQ | CONF2_OTGMODE | CONF2_PHY_GPIOMODE);\r\ndevconf2 |= CONF2_REFFREQ_13MHZ | CONF2_SESENDEN | CONF2_VBDTCTEN\r\n| CONF2_DATPOL;\r\nomap_ctrl_writel(devconf2, AM35XX_CONTROL_DEVCONF2);\r\nusb_musb_init(&musb_board_data);\r\n}\r\nstatic void am3517_evm_hecc_init(struct ti_hecc_platform_data *pdata)\r\n{\r\nam3517_hecc_device.dev.platform_data = pdata;\r\nplatform_device_register(&am3517_hecc_device);\r\n}\r\nstatic void __init am3517_evm_init(void)\r\n{\r\nomap_board_config = am3517_evm_config;\r\nomap_board_config_size = ARRAY_SIZE(am3517_evm_config);\r\nomap3_mux_init(board_mux, OMAP_PACKAGE_CBB);\r\nam3517_evm_i2c_init();\r\nomap_display_init(&am3517_evm_dss_data);\r\nomap_serial_init();\r\nomap_sdrc_init(NULL, NULL);\r\nomap_mux_init_gpio(57, OMAP_PIN_OUTPUT);\r\nusbhs_init(&usbhs_bdata);\r\nam3517_evm_hecc_init(&am3517_evm_hecc_pdata);\r\nam3517_evm_display_init();\r\nam3517_evm_rtc_init();\r\ni2c_register_board_info(1, am3517evm_i2c1_boardinfo,\r\nARRAY_SIZE(am3517evm_i2c1_boardinfo));\r\nam35xx_emac_init(AM35XX_DEFAULT_MDIO_FREQUENCY, 1);\r\nam3517_evm_musb_init();\r\nomap_hsmmc_init(mmc);\r\n}
