static inline int __of_pci_pci_compare(struct device_node *node,\r\nunsigned int devfn)\r\n{\r\nunsigned int size;\r\nconst __be32 *reg = of_get_property(node, "reg", &size);\r\nif (!reg || size < 5 * sizeof(__be32))\r\nreturn 0;\r\nreturn ((be32_to_cpup(&reg[0]) >> 8) & 0xff) == devfn;\r\n}\r\nstruct device_node *of_pci_find_child_device(struct device_node *parent,\r\nunsigned int devfn)\r\n{\r\nstruct device_node *node, *node2;\r\nfor_each_child_of_node(parent, node) {\r\nif (__of_pci_pci_compare(node, devfn))\r\nreturn node;\r\nif (!strcmp(node->name, "multifunc-device")) {\r\nfor_each_child_of_node(node, node2) {\r\nif (__of_pci_pci_compare(node2, devfn)) {\r\nof_node_put(node);\r\nreturn node2;\r\n}\r\n}\r\n}\r\n}\r\nreturn NULL;\r\n}
