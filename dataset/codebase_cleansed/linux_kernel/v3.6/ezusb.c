int ezusb_writememory(struct usb_serial *serial, int address,\r\nunsigned char *data, int length, __u8 request)\r\n{\r\nint result;\r\nunsigned char *transfer_buffer;\r\nif (!serial->dev) {\r\nprintk(KERN_ERR "ezusb: %s - no physical device present, "\r\n"failing.\n", __func__);\r\nreturn -ENODEV;\r\n}\r\ntransfer_buffer = kmemdup(data, length, GFP_KERNEL);\r\nif (!transfer_buffer) {\r\ndev_err(&serial->dev->dev, "%s - kmalloc(%d) failed.\n",\r\n__func__, length);\r\nreturn -ENOMEM;\r\n}\r\nresult = usb_control_msg(serial->dev, usb_sndctrlpipe(serial->dev, 0),\r\nrequest, 0x40, address, 0, transfer_buffer, length, 3000);\r\nkfree(transfer_buffer);\r\nreturn result;\r\n}\r\nint ezusb_set_reset(struct usb_serial *serial, unsigned char reset_bit)\r\n{\r\nint response;\r\nresponse = ezusb_writememory(serial, CPUCS_REG, &reset_bit, 1, 0xa0);\r\nif (response < 0)\r\ndev_err(&serial->dev->dev, "%s- %d failed\n",\r\n__func__, reset_bit);\r\nreturn response;\r\n}
