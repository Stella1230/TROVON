static int bfin_eval_adav80x_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nint ret;\r\nret = snd_soc_dai_set_pll(codec_dai, ADAV80X_PLL1, ADAV80X_PLL_SRC_XTAL,\r\n27000000, params_rate(params) * 256);\r\nif (ret)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(codec_dai, ADAV80X_CLK_PLL1,\r\nparams_rate(params) * 256, SND_SOC_CLOCK_IN);\r\nreturn ret;\r\n}\r\nstatic int bfin_eval_adav80x_codec_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nsnd_soc_dai_set_sysclk(codec_dai, ADAV80X_CLK_SYSCLK1, 0,\r\nSND_SOC_CLOCK_OUT);\r\nsnd_soc_dai_set_sysclk(codec_dai, ADAV80X_CLK_SYSCLK2, 0,\r\nSND_SOC_CLOCK_OUT);\r\nsnd_soc_dai_set_sysclk(codec_dai, ADAV80X_CLK_SYSCLK3, 0,\r\nSND_SOC_CLOCK_OUT);\r\nsnd_soc_dai_set_sysclk(codec_dai, ADAV80X_CLK_XTAL, 2700000, 0);\r\nreturn 0;\r\n}\r\nstatic int bfin_eval_adav80x_probe(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = &bfin_eval_adav80x;\r\nconst char *codec_name;\r\nswitch (platform_get_device_id(pdev)->driver_data) {\r\ncase BFIN_EVAL_ADAV801:\r\ncodec_name = "spi0.1";\r\nbreak;\r\ncase BFIN_EVAL_ADAV803:\r\ncodec_name = "adav803.0-0034";\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nbfin_eval_adav80x_dais[0].codec_name = codec_name;\r\ncard->dev = &pdev->dev;\r\nreturn snd_soc_register_card(&bfin_eval_adav80x);\r\n}\r\nstatic int __devexit bfin_eval_adav80x_remove(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = platform_get_drvdata(pdev);\r\nsnd_soc_unregister_card(card);\r\nreturn 0;\r\n}
