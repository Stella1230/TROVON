static int initialize_usbh2_port(struct platform_device *pdev)\r\n{\r\niomux_v3_cfg_t usbh2stp = MX51_PAD_EIM_A26__USBH2_STP;\r\niomux_v3_cfg_t usbh2gpio = MX51_PAD_EIM_A26__GPIO2_20;\r\nmxc_iomux_v3_setup_pad(usbh2gpio);\r\ngpio_request(EFIKASB_USBH2_STP, "usbh2_stp");\r\ngpio_direction_output(EFIKASB_USBH2_STP, 0);\r\nmsleep(1);\r\ngpio_set_value(EFIKASB_USBH2_STP, 1);\r\nmsleep(1);\r\ngpio_free(EFIKASB_USBH2_STP);\r\nmxc_iomux_v3_setup_pad(usbh2stp);\r\nmdelay(10);\r\nreturn mx51_initialize_usb_hw(pdev->id, MXC_EHCI_ITC_NO_THRESHOLD);\r\n}\r\nstatic void __init mx51_efikasb_usb(void)\r\n{\r\nusbh2_config.otg = imx_otg_ulpi_create(ULPI_OTG_DRVVBUS |\r\nULPI_OTG_DRVVBUS_EXT | ULPI_OTG_EXTVBUSIND);\r\nif (usbh2_config.otg)\r\nimx51_add_mxc_ehci_hs(2, &usbh2_config);\r\n}\r\nstatic void mx51_efikasb_power_off(void)\r\n{\r\ngpio_set_value(EFIKA_USB_PHY_RESET, 0);\r\nif (!IS_ERR(pwgt1) && !IS_ERR(pwgt2)) {\r\nregulator_disable(pwgt2);\r\nregulator_disable(pwgt1);\r\n}\r\ngpio_direction_output(EFIKASB_POWEROFF, 1);\r\n}\r\nstatic int __init mx51_efikasb_power_init(void)\r\n{\r\npwgt1 = regulator_get(NULL, "pwgt1");\r\npwgt2 = regulator_get(NULL, "pwgt2");\r\nif (!IS_ERR(pwgt1) && !IS_ERR(pwgt2)) {\r\nregulator_enable(pwgt1);\r\nregulator_enable(pwgt2);\r\n}\r\ngpio_request(EFIKASB_POWEROFF, "poweroff");\r\npm_power_off = mx51_efikasb_power_off;\r\nregulator_has_full_constraints();\r\nreturn 0;\r\n}\r\nstatic void __init mx51_efikasb_init_late(void)\r\n{\r\nimx51_init_late();\r\nmx51_efikasb_power_init();\r\n}\r\nstatic void __init mx51_efikasb_board_id(void)\r\n{\r\nint id;\r\ngpio_request(EFIKASB_PCBID0, "pcb id0");\r\ngpio_direction_input(EFIKASB_PCBID0);\r\ngpio_request(EFIKASB_PCBID1, "pcb id1");\r\ngpio_direction_input(EFIKASB_PCBID1);\r\nid = gpio_get_value(EFIKASB_PCBID0) ? 1 : 0;\r\nid |= (gpio_get_value(EFIKASB_PCBID1) ? 1 : 0) << 1;\r\nswitch (id) {\r\ndefault:\r\nbreak;\r\ncase 1:\r\nsystem_rev = 0x13;\r\nbreak;\r\ncase 2:\r\nsystem_rev = 0x20;\r\nbreak;\r\n}\r\n}\r\nstatic void __init efikasb_board_init(void)\r\n{\r\nimx51_soc_init();\r\nmxc_iomux_v3_setup_multiple_pads(mx51efikasb_pads,\r\nARRAY_SIZE(mx51efikasb_pads));\r\nefika_board_common_init();\r\nmx51_efikasb_board_id();\r\nmx51_efikasb_usb();\r\nimx51_add_sdhci_esdhc_imx(0, &sd0_pdata);\r\nimx51_add_sdhci_esdhc_imx(1, &sd1_pdata);\r\ngpio_led_register_device(-1, &mx51_efikasb_leds_data);\r\nimx_add_gpio_keys(&mx51_efikasb_keys_data);\r\n}\r\nstatic void __init mx51_efikasb_timer_init(void)\r\n{\r\nmx51_clocks_init(32768, 24000000, 22579200, 24576000);\r\n}
