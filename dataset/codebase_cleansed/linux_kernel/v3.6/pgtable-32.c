void pgd_init(unsigned long page)\r\n{\r\nunsigned long *p = (unsigned long *) page;\r\nint i;\r\nfor (i = 0; i < USER_PTRS_PER_PGD; i+=8) {\r\np[i + 0] = (unsigned long) invalid_pte_table;\r\np[i + 1] = (unsigned long) invalid_pte_table;\r\np[i + 2] = (unsigned long) invalid_pte_table;\r\np[i + 3] = (unsigned long) invalid_pte_table;\r\np[i + 4] = (unsigned long) invalid_pte_table;\r\np[i + 5] = (unsigned long) invalid_pte_table;\r\np[i + 6] = (unsigned long) invalid_pte_table;\r\np[i + 7] = (unsigned long) invalid_pte_table;\r\n}\r\n}\r\nvoid __init pagetable_init(void)\r\n{\r\nunsigned long vaddr;\r\npgd_t *pgd_base;\r\n#ifdef CONFIG_HIGHMEM\r\npgd_t *pgd;\r\npud_t *pud;\r\npmd_t *pmd;\r\npte_t *pte;\r\n#endif\r\npgd_init((unsigned long)swapper_pg_dir);\r\npgd_init((unsigned long)swapper_pg_dir\r\n+ sizeof(pgd_t) * USER_PTRS_PER_PGD);\r\npgd_base = swapper_pg_dir;\r\nvaddr = __fix_to_virt(__end_of_fixed_addresses - 1) & PMD_MASK;\r\nfixrange_init(vaddr, vaddr + FIXADDR_SIZE, pgd_base);\r\n#ifdef CONFIG_HIGHMEM\r\nvaddr = PKMAP_BASE;\r\nfixrange_init(vaddr, vaddr + PAGE_SIZE*LAST_PKMAP, pgd_base);\r\npgd = swapper_pg_dir + __pgd_offset(vaddr);\r\npud = pud_offset(pgd, vaddr);\r\npmd = pmd_offset(pud, vaddr);\r\npte = pte_offset_kernel(pmd, vaddr);\r\npkmap_page_table = pte;\r\n#endif\r\n}
