static void __init d2net_sata_power_init(void)\r\n{\r\nint err;\r\nerr = gpio_request(D2NET_GPIO_SATA0_POWER, "SATA0 power");\r\nif (err == 0) {\r\nerr = gpio_direction_output(D2NET_GPIO_SATA0_POWER, 1);\r\nif (err)\r\ngpio_free(D2NET_GPIO_SATA0_POWER);\r\n}\r\nif (err)\r\npr_err("d2net: failed to configure SATA0 power GPIO\n");\r\nerr = gpio_request(D2NET_GPIO_SATA1_POWER, "SATA1 power");\r\nif (err == 0) {\r\nerr = gpio_direction_output(D2NET_GPIO_SATA1_POWER, 1);\r\nif (err)\r\ngpio_free(D2NET_GPIO_SATA1_POWER);\r\n}\r\nif (err)\r\npr_err("d2net: failed to configure SATA1 power GPIO\n");\r\n}\r\nstatic void __init d2net_gpio_leds_init(void)\r\n{\r\nint err;\r\norion_gpio_set_valid(D2NET_GPIO_BLUE_LED_OFF, 1);\r\nerr = gpio_request(D2NET_GPIO_BLUE_LED_BLINK_CTRL, "blue LED blink");\r\nif (err == 0) {\r\nerr = gpio_direction_output(D2NET_GPIO_BLUE_LED_BLINK_CTRL, 1);\r\nif (err)\r\ngpio_free(D2NET_GPIO_BLUE_LED_BLINK_CTRL);\r\n}\r\nif (err)\r\npr_err("d2net: failed to configure blue LED blink GPIO\n");\r\nplatform_device_register(&d2net_gpio_leds);\r\n}\r\nstatic void __init d2net_init(void)\r\n{\r\norion5x_init();\r\norion5x_mpp_conf(d2net_mpp_modes);\r\norion5x_ehci0_init();\r\norion5x_eth_init(&d2net_eth_data);\r\norion5x_i2c_init();\r\norion5x_uart0_init();\r\nd2net_sata_power_init();\r\norion5x_sata_init(&d2net_sata_data);\r\norion5x_setup_dev_boot_win(D2NET_NOR_BOOT_BASE,\r\nD2NET_NOR_BOOT_SIZE);\r\nplatform_device_register(&d2net_nor_flash);\r\nplatform_device_register(&d2net_gpio_buttons);\r\nd2net_gpio_leds_init();\r\npr_notice("d2net: Flash write are not yet supported.\n");\r\ni2c_register_board_info(0, d2net_i2c_devices,\r\nARRAY_SIZE(d2net_i2c_devices));\r\norion_gpio_set_valid(D2NET_GPIO_INHIBIT_POWER_OFF, 1);\r\n}
