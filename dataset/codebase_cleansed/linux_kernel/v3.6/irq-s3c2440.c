static void s3c_irq_demux_wdtac97(unsigned int irq,\r\nstruct irq_desc *desc)\r\n{\r\nunsigned int subsrc, submsk;\r\nsubsrc = __raw_readl(S3C2410_SUBSRCPND);\r\nsubmsk = __raw_readl(S3C2410_INTSUBMSK);\r\nsubsrc &= ~submsk;\r\nsubsrc >>= 13;\r\nsubsrc &= 3;\r\nif (subsrc != 0) {\r\nif (subsrc & 1) {\r\ngeneric_handle_irq(IRQ_S3C2440_WDT);\r\n}\r\nif (subsrc & 2) {\r\ngeneric_handle_irq(IRQ_S3C2440_AC97);\r\n}\r\n}\r\n}\r\nstatic void\r\ns3c_irq_wdtac97_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_WDT, 3 << 13);\r\n}\r\nstatic void\r\ns3c_irq_wdtac97_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_WDT);\r\n}\r\nstatic void\r\ns3c_irq_wdtac97_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_WDT, 3 << 13);\r\n}\r\nstatic int s3c2440_irq_add(struct device *dev, struct subsys_interface *sif)\r\n{\r\nunsigned int irqno;\r\nprintk("S3C2440: IRQ Support\n");\r\nirq_set_chip_and_handler(IRQ_WDT, &s3c_irq_level_chip,\r\nhandle_level_irq);\r\nirq_set_chained_handler(IRQ_WDT, s3c_irq_demux_wdtac97);\r\nfor (irqno = IRQ_S3C2440_WDT; irqno <= IRQ_S3C2440_AC97; irqno++) {\r\nirq_set_chip_and_handler(irqno, &s3c_irq_wdtac97,\r\nhandle_level_irq);\r\nset_irq_flags(irqno, IRQF_VALID);\r\n}\r\nreturn 0;\r\n}\r\nstatic int s3c2440_irq_init(void)\r\n{\r\nreturn subsys_interface_register(&s3c2440_irq_interface);\r\n}
