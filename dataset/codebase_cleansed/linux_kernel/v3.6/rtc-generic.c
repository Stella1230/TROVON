static int generic_get_time(struct device *dev, struct rtc_time *tm)\r\n{\r\nunsigned int ret = get_rtc_time(tm);\r\nif (ret & RTC_BATT_BAD)\r\nreturn -EOPNOTSUPP;\r\nreturn rtc_valid_tm(tm);\r\n}\r\nstatic int generic_set_time(struct device *dev, struct rtc_time *tm)\r\n{\r\nif (set_rtc_time(tm) < 0)\r\nreturn -EOPNOTSUPP;\r\nreturn 0;\r\n}\r\nstatic int __init generic_rtc_probe(struct platform_device *dev)\r\n{\r\nstruct rtc_device *rtc;\r\nrtc = rtc_device_register("rtc-generic", &dev->dev, &generic_rtc_ops,\r\nTHIS_MODULE);\r\nif (IS_ERR(rtc))\r\nreturn PTR_ERR(rtc);\r\nplatform_set_drvdata(dev, rtc);\r\nreturn 0;\r\n}\r\nstatic int __exit generic_rtc_remove(struct platform_device *dev)\r\n{\r\nstruct rtc_device *rtc = platform_get_drvdata(dev);\r\nrtc_device_unregister(rtc);\r\nreturn 0;\r\n}\r\nstatic int __init generic_rtc_init(void)\r\n{\r\nreturn platform_driver_probe(&generic_rtc_driver, generic_rtc_probe);\r\n}\r\nstatic void __exit generic_rtc_fini(void)\r\n{\r\nplatform_driver_unregister(&generic_rtc_driver);\r\n}
