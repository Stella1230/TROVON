void __init usb_musb_init(struct omap_musb_board_data *musb_board_data)\r\n{\r\nstruct omap_hwmod *oh;\r\nstruct platform_device *pdev;\r\nstruct device *dev;\r\nint bus_id = -1;\r\nconst char *oh_name, *name;\r\nstruct omap_musb_board_data *board_data;\r\nif (musb_board_data)\r\nboard_data = musb_board_data;\r\nelse\r\nboard_data = &musb_default_board_data;\r\nmusb_plat.clock = "ick";\r\nmusb_plat.board_data = board_data;\r\nmusb_plat.power = board_data->power >> 1;\r\nmusb_plat.mode = board_data->mode;\r\nmusb_plat.extvbus = board_data->extvbus;\r\nif (soc_is_am35xx()) {\r\noh_name = "am35x_otg_hs";\r\nname = "musb-am35x";\r\n} else if (cpu_is_ti81xx()) {\r\noh_name = "usb_otg_hs";\r\nname = "musb-ti81xx";\r\n} else {\r\noh_name = "usb_otg_hs";\r\nname = "musb-omap2430";\r\n}\r\noh = omap_hwmod_lookup(oh_name);\r\nif (WARN(!oh, "%s: could not find omap_hwmod for %s\n",\r\n__func__, oh_name))\r\nreturn;\r\npdev = omap_device_build(name, bus_id, oh, &musb_plat,\r\nsizeof(musb_plat), NULL, 0, false);\r\nif (IS_ERR(pdev)) {\r\npr_err("Could not build omap_device for %s %s\n",\r\nname, oh_name);\r\nreturn;\r\n}\r\ndev = &pdev->dev;\r\nget_device(dev);\r\ndev->dma_mask = &musb_dmamask;\r\ndev->coherent_dma_mask = musb_dmamask;\r\nput_device(dev);\r\nif (cpu_is_omap44xx())\r\nomap4430_phy_init(dev);\r\n}
