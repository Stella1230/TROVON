void selfmod_function(const int *arr_fce, const unsigned int base)\r\n{\r\nunsigned int flags, i, j, *addr = NULL;\r\nlocal_irq_save(flags);\r\n__disable_icache();\r\nfor (j = 0; arr_fce[j] != 0; j++) {\r\naddr = (unsigned int *) arr_fce[j];\r\npr_debug("%s: func(%d) at 0x%x\n",\r\n__func__, j, (unsigned int) addr);\r\nfor (i = 0; ; i++) {\r\npr_debug("%s: instruction code at %d: 0x%x\n",\r\n__func__, i, addr[i]);\r\nif (addr[i] == IMM_BASE) {\r\nif ((addr[i + 1] & LWI_BASE_MASK) == LWI_BASE) {\r\nMODIFY_INSTR;\r\n} else\r\nif ((addr[i + 1] & ADDIK_BASE_MASK) ==\r\nADDIK_BASE) {\r\nMODIFY_INSTR;\r\n}\r\n} else if (addr[i] == OPCODE_RTSD) {\r\npr_debug("%s: end of array %d\n", __func__, i);\r\nbreak;\r\n}\r\n}\r\n}\r\nlocal_irq_restore(flags);\r\n}
