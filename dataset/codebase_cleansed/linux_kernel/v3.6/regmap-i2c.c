static int regmap_i2c_write(void *context, const void *data, size_t count)\r\n{\r\nstruct device *dev = context;\r\nstruct i2c_client *i2c = to_i2c_client(dev);\r\nint ret;\r\nret = i2c_master_send(i2c, data, count);\r\nif (ret == count)\r\nreturn 0;\r\nelse if (ret < 0)\r\nreturn ret;\r\nelse\r\nreturn -EIO;\r\n}\r\nstatic int regmap_i2c_gather_write(void *context,\r\nconst void *reg, size_t reg_size,\r\nconst void *val, size_t val_size)\r\n{\r\nstruct device *dev = context;\r\nstruct i2c_client *i2c = to_i2c_client(dev);\r\nstruct i2c_msg xfer[2];\r\nint ret;\r\nif (!i2c_check_functionality(i2c->adapter, I2C_FUNC_NOSTART))\r\nreturn -ENOTSUPP;\r\nxfer[0].addr = i2c->addr;\r\nxfer[0].flags = 0;\r\nxfer[0].len = reg_size;\r\nxfer[0].buf = (void *)reg;\r\nxfer[1].addr = i2c->addr;\r\nxfer[1].flags = I2C_M_NOSTART;\r\nxfer[1].len = val_size;\r\nxfer[1].buf = (void *)val;\r\nret = i2c_transfer(i2c->adapter, xfer, 2);\r\nif (ret == 2)\r\nreturn 0;\r\nif (ret < 0)\r\nreturn ret;\r\nelse\r\nreturn -EIO;\r\n}\r\nstatic int regmap_i2c_read(void *context,\r\nconst void *reg, size_t reg_size,\r\nvoid *val, size_t val_size)\r\n{\r\nstruct device *dev = context;\r\nstruct i2c_client *i2c = to_i2c_client(dev);\r\nstruct i2c_msg xfer[2];\r\nint ret;\r\nxfer[0].addr = i2c->addr;\r\nxfer[0].flags = 0;\r\nxfer[0].len = reg_size;\r\nxfer[0].buf = (void *)reg;\r\nxfer[1].addr = i2c->addr;\r\nxfer[1].flags = I2C_M_RD;\r\nxfer[1].len = val_size;\r\nxfer[1].buf = val;\r\nret = i2c_transfer(i2c->adapter, xfer, 2);\r\nif (ret == 2)\r\nreturn 0;\r\nelse if (ret < 0)\r\nreturn ret;\r\nelse\r\nreturn -EIO;\r\n}\r\nstruct regmap *regmap_init_i2c(struct i2c_client *i2c,\r\nconst struct regmap_config *config)\r\n{\r\nreturn regmap_init(&i2c->dev, &regmap_i2c, &i2c->dev, config);\r\n}\r\nstruct regmap *devm_regmap_init_i2c(struct i2c_client *i2c,\r\nconst struct regmap_config *config)\r\n{\r\nreturn devm_regmap_init(&i2c->dev, &regmap_i2c, &i2c->dev, config);\r\n}
