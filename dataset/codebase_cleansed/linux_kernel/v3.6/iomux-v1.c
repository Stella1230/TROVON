static inline unsigned long imx_iomuxv1_readl(unsigned offset)\r\n{\r\nreturn __raw_readl(imx_iomuxv1_baseaddr + offset);\r\n}\r\nstatic inline void imx_iomuxv1_writel(unsigned long val, unsigned offset)\r\n{\r\n__raw_writel(val, imx_iomuxv1_baseaddr + offset);\r\n}\r\nstatic inline void imx_iomuxv1_rmwl(unsigned offset,\r\nunsigned long mask, unsigned long value)\r\n{\r\nunsigned long reg = imx_iomuxv1_readl(offset);\r\nreg &= ~mask;\r\nreg |= value;\r\nimx_iomuxv1_writel(reg, offset);\r\n}\r\nstatic inline void imx_iomuxv1_set_puen(\r\nunsigned int port, unsigned int pin, int on)\r\n{\r\nunsigned long mask = 1 << pin;\r\nimx_iomuxv1_rmwl(MXC_PUEN(port), mask, on ? mask : 0);\r\n}\r\nstatic inline void imx_iomuxv1_set_ddir(\r\nunsigned int port, unsigned int pin, int out)\r\n{\r\nunsigned long mask = 1 << pin;\r\nimx_iomuxv1_rmwl(MXC_DDIR(port), mask, out ? mask : 0);\r\n}\r\nstatic inline void imx_iomuxv1_set_gpr(\r\nunsigned int port, unsigned int pin, int af)\r\n{\r\nunsigned long mask = 1 << pin;\r\nimx_iomuxv1_rmwl(MXC_GPR(port), mask, af ? mask : 0);\r\n}\r\nstatic inline void imx_iomuxv1_set_gius(\r\nunsigned int port, unsigned int pin, int inuse)\r\n{\r\nunsigned long mask = 1 << pin;\r\nimx_iomuxv1_rmwl(MXC_GIUS(port), mask, inuse ? mask : 0);\r\n}\r\nstatic inline void imx_iomuxv1_set_ocr(\r\nunsigned int port, unsigned int pin, unsigned int ocr)\r\n{\r\nunsigned long shift = (pin & 0xf) << 1;\r\nunsigned long mask = 3 << shift;\r\nunsigned long value = ocr << shift;\r\nunsigned long offset = pin < 16 ? MXC_OCR1(port) : MXC_OCR2(port);\r\nimx_iomuxv1_rmwl(offset, mask, value);\r\n}\r\nstatic inline void imx_iomuxv1_set_iconfa(\r\nunsigned int port, unsigned int pin, unsigned int aout)\r\n{\r\nunsigned long shift = (pin & 0xf) << 1;\r\nunsigned long mask = 3 << shift;\r\nunsigned long value = aout << shift;\r\nunsigned long offset = pin < 16 ? MXC_ICONFA1(port) : MXC_ICONFA2(port);\r\nimx_iomuxv1_rmwl(offset, mask, value);\r\n}\r\nstatic inline void imx_iomuxv1_set_iconfb(\r\nunsigned int port, unsigned int pin, unsigned int bout)\r\n{\r\nunsigned long shift = (pin & 0xf) << 1;\r\nunsigned long mask = 3 << shift;\r\nunsigned long value = bout << shift;\r\nunsigned long offset = pin < 16 ? MXC_ICONFB1(port) : MXC_ICONFB2(port);\r\nimx_iomuxv1_rmwl(offset, mask, value);\r\n}\r\nint mxc_gpio_mode(int gpio_mode)\r\n{\r\nunsigned int pin = gpio_mode & GPIO_PIN_MASK;\r\nunsigned int port = (gpio_mode & GPIO_PORT_MASK) >> GPIO_PORT_SHIFT;\r\nunsigned int ocr = (gpio_mode & GPIO_OCR_MASK) >> GPIO_OCR_SHIFT;\r\nunsigned int aout = (gpio_mode >> GPIO_AOUT_SHIFT) & 3;\r\nunsigned int bout = (gpio_mode >> GPIO_BOUT_SHIFT) & 3;\r\nif (port >= imx_iomuxv1_numports)\r\nreturn -EINVAL;\r\nimx_iomuxv1_set_puen(port, pin, gpio_mode & GPIO_PUEN);\r\nimx_iomuxv1_set_ddir(port, pin, gpio_mode & GPIO_OUT);\r\nimx_iomuxv1_set_gpr(port, pin, gpio_mode & GPIO_AF);\r\nimx_iomuxv1_set_gius(port, pin, !(gpio_mode & (GPIO_PF | GPIO_AF)));\r\nimx_iomuxv1_set_ocr(port, pin, ocr);\r\nimx_iomuxv1_set_iconfa(port, pin, aout);\r\nimx_iomuxv1_set_iconfb(port, pin, bout);\r\nreturn 0;\r\n}\r\nstatic int imx_iomuxv1_setup_multiple(const int *list, unsigned count)\r\n{\r\nsize_t i;\r\nint ret = 0;\r\nfor (i = 0; i < count; ++i) {\r\nret = mxc_gpio_mode(list[i]);\r\nif (ret)\r\nreturn ret;\r\n}\r\nreturn ret;\r\n}\r\nint mxc_gpio_setup_multiple_pins(const int *pin_list, unsigned count,\r\nconst char *label)\r\n{\r\nint ret;\r\nret = imx_iomuxv1_setup_multiple(pin_list, count);\r\nreturn ret;\r\n}\r\nint __init imx_iomuxv1_init(void __iomem *base, int numports)\r\n{\r\nimx_iomuxv1_baseaddr = base;\r\nimx_iomuxv1_numports = numports;\r\nreturn 0;\r\n}
