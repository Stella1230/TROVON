static void __iomem *scu_base_addr(void)\r\n{\r\nreturn (void __iomem *)0xf0000000;\r\n}\r\nvoid __init r8a7779_register_twd(void)\r\n{\r\ntwd_local_timer_register(&twd_local_timer);\r\n}\r\nstatic void modify_scu_cpu_psr(unsigned long set, unsigned long clr)\r\n{\r\nvoid __iomem *scu_base = scu_base_addr();\r\nspin_lock(&scu_lock);\r\ntmp = __raw_readl(scu_base + 8);\r\ntmp &= ~clr;\r\ntmp |= set;\r\nspin_unlock(&scu_lock);\r\n__raw_writel(tmp, scu_base + 8);\r\n}\r\nunsigned int __init r8a7779_get_core_count(void)\r\n{\r\nvoid __iomem *scu_base = scu_base_addr();\r\nreturn scu_get_core_count(scu_base);\r\n}\r\nint r8a7779_platform_cpu_kill(unsigned int cpu)\r\n{\r\nstruct r8a7779_pm_ch *ch = NULL;\r\nint ret = -EIO;\r\ncpu = cpu_logical_map(cpu);\r\nmodify_scu_cpu_psr(3 << (cpu * 8), 0);\r\nif (cpu < ARRAY_SIZE(r8a7779_ch_cpu))\r\nch = r8a7779_ch_cpu[cpu];\r\nif (ch)\r\nret = r8a7779_sysc_power_down(ch);\r\nreturn ret ? ret : 1;\r\n}\r\nvoid __cpuinit r8a7779_secondary_init(unsigned int cpu)\r\n{\r\ngic_secondary_init(0);\r\n}\r\nint __cpuinit r8a7779_boot_secondary(unsigned int cpu)\r\n{\r\nstruct r8a7779_pm_ch *ch = NULL;\r\nint ret = -EIO;\r\ncpu = cpu_logical_map(cpu);\r\nmodify_scu_cpu_psr(0, 3 << (cpu * 8));\r\nif (cpu < ARRAY_SIZE(r8a7779_ch_cpu))\r\nch = r8a7779_ch_cpu[cpu];\r\nif (ch)\r\nret = r8a7779_sysc_power_up(ch);\r\nreturn ret;\r\n}\r\nvoid __init r8a7779_smp_prepare_cpus(void)\r\n{\r\nint cpu = cpu_logical_map(0);\r\nscu_enable(scu_base_addr());\r\n__raw_writel(__pa(shmobile_secondary_vector), AVECR);\r\nmodify_scu_cpu_psr(0, 3 << (cpu * 8));\r\nr8a7779_pm_init();\r\nr8a7779_platform_cpu_kill(1);\r\nr8a7779_platform_cpu_kill(2);\r\nr8a7779_platform_cpu_kill(3);\r\n}
