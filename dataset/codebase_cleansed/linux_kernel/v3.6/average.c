void ewma_init(struct ewma *avg, unsigned long factor, unsigned long weight)\r\n{\r\nWARN_ON(!is_power_of_2(weight) || !is_power_of_2(factor));\r\navg->weight = ilog2(weight);\r\navg->factor = ilog2(factor);\r\navg->internal = 0;\r\n}\r\nstruct ewma *ewma_add(struct ewma *avg, unsigned long val)\r\n{\r\navg->internal = avg->internal ?\r\n(((avg->internal << avg->weight) - avg->internal) +\r\n(val << avg->factor)) >> avg->weight :\r\n(val << avg->factor);\r\nreturn avg;\r\n}
