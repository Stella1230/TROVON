char *strchr(const char *s, int c)\r\n{\r\nint z, g;\r\nconst uintptr_t s_int = (uintptr_t) s;\r\nconst uint32_t *p = (const uint32_t *)(s_int & -4);\r\nconst uint32_t goal = 0x01010101 * (uint8_t) c;\r\nconst uint32_t before_mask = (1 << (s_int << 3)) - 1;\r\nuint32_t v = (*p | before_mask) ^ (goal & __insn_shrib(before_mask, 1));\r\nuint32_t zero_matches, goal_matches;\r\nwhile (1) {\r\nzero_matches = __insn_seqb(v, 0);\r\ngoal_matches = __insn_seqb(v, goal);\r\nif (__builtin_expect(zero_matches | goal_matches, 0))\r\nbreak;\r\nv = *++p;\r\n}\r\nz = __insn_ctz(zero_matches);\r\ng = __insn_ctz(goal_matches);\r\nreturn (g <= z) ? ((char *)p) + (g >> 3) : NULL;\r\n}
