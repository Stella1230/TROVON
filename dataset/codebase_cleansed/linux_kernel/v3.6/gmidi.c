static int __exit midi_unbind(struct usb_composite_dev *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int __init midi_bind_config(struct usb_configuration *c)\r\n{\r\nreturn f_midi_bind_config(c, index, id,\r\nin_ports, out_ports,\r\nbuflen, qlen);\r\n}\r\nstatic int __init midi_bind(struct usb_composite_dev *cdev)\r\n{\r\nstruct usb_gadget *gadget = cdev->gadget;\r\nint gcnum, status;\r\nstatus = usb_string_id(cdev);\r\nif (status < 0)\r\nreturn status;\r\nstrings_dev[STRING_MANUFACTURER_IDX].id = status;\r\ndevice_desc.iManufacturer = status;\r\nstatus = usb_string_id(cdev);\r\nif (status < 0)\r\nreturn status;\r\nstrings_dev[STRING_PRODUCT_IDX].id = status;\r\ndevice_desc.iProduct = status;\r\nstatus = usb_string_id(cdev);\r\nif (status < 0)\r\nreturn status;\r\nstrings_dev[STRING_DESCRIPTION_IDX].id = status;\r\nmidi_config.iConfiguration = status;\r\ngcnum = usb_gadget_controller_number(gadget);\r\nif (gcnum < 0) {\r\npr_warning("%s: controller '%s' not recognized\n",\r\n__func__, gadget->name);\r\ndevice_desc.bcdDevice = cpu_to_le16(0x9999);\r\n} else {\r\ndevice_desc.bcdDevice = cpu_to_le16(0x0200 + gcnum);\r\n}\r\nstatus = usb_add_config(cdev, &midi_config, midi_bind_config);\r\nif (status < 0)\r\nreturn status;\r\npr_info("%s\n", longname);\r\nreturn 0;\r\n}\r\nstatic int __init midi_init(void)\r\n{\r\nreturn usb_composite_probe(&midi_driver, midi_bind);\r\n}\r\nstatic void __exit midi_cleanup(void)\r\n{\r\nusb_composite_unregister(&midi_driver);\r\n}
