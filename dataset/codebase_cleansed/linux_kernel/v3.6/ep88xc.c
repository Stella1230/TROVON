static void __init init_ioports(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(ep88xc_pins); i++) {\r\nstruct cpm_pin *pin = &ep88xc_pins[i];\r\ncpm1_set_pin(pin->port, pin->pin, pin->flags);\r\n}\r\ncpm1_clk_setup(CPM_CLK_SMC1, CPM_BRG1, CPM_CLK_RTX);\r\ncpm1_clk_setup(CPM_CLK_SCC1, CPM_CLK2, CPM_CLK_TX);\r\ncpm1_clk_setup(CPM_CLK_SCC1, CPM_CLK2, CPM_CLK_RX);\r\ncpm1_clk_setup(CPM_CLK_SCC2, CPM_BRG2, CPM_CLK_TX);\r\ncpm1_clk_setup(CPM_CLK_SCC2, CPM_BRG2, CPM_CLK_RX);\r\n}\r\nstatic void __init ep88xc_setup_arch(void)\r\n{\r\nstruct device_node *np;\r\ncpm_reset();\r\ninit_ioports();\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,ep88xc-bcsr");\r\nif (!np) {\r\nprintk(KERN_CRIT "Could not find fsl,ep88xc-bcsr node\n");\r\nreturn;\r\n}\r\nep88xc_bcsr = of_iomap(np, 0);\r\nof_node_put(np);\r\nif (!ep88xc_bcsr) {\r\nprintk(KERN_CRIT "Could not remap BCSR\n");\r\nreturn;\r\n}\r\nsetbits8(&ep88xc_bcsr[7], BCSR7_SCC2_ENABLE);\r\nsetbits8(&ep88xc_bcsr[8], BCSR8_PHY1_ENABLE | BCSR8_PHY1_POWER |\r\nBCSR8_PHY2_ENABLE | BCSR8_PHY2_POWER);\r\n}\r\nstatic int __init ep88xc_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nreturn of_flat_dt_is_compatible(root, "fsl,ep88xc");\r\n}\r\nstatic int __init declare_of_platform_devices(void)\r\n{\r\nof_platform_bus_probe(NULL, of_bus_ids, NULL);\r\nreturn 0;\r\n}
