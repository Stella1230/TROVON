static scom_map_t wsp_scom_map(struct device_node *dev, u64 reg, u64 count)\r\n{\r\nstruct resource r;\r\nu64 xscom_addr;\r\nif (!of_get_property(dev, "scom-controller", NULL)) {\r\npr_err("%s: device %s is not a SCOM controller\n",\r\n__func__, dev->full_name);\r\nreturn SCOM_MAP_INVALID;\r\n}\r\nif (of_address_to_resource(dev, 0, &r)) {\r\npr_debug("Failed to find SCOM controller address\n");\r\nreturn 0;\r\n}\r\nxscom_addr = ((reg & 0x7f000000) >> 1) | ((reg & 0xfffff) << 3);\r\nreturn (scom_map_t)ioremap(r.start + xscom_addr, count << 3);\r\n}\r\nstatic void wsp_scom_unmap(scom_map_t map)\r\n{\r\niounmap((void *)map);\r\n}\r\nstatic u64 wsp_scom_read(scom_map_t map, u32 reg)\r\n{\r\nu64 __iomem *addr = (u64 __iomem *)map;\r\nreturn in_be64(addr + reg);\r\n}\r\nstatic void wsp_scom_write(scom_map_t map, u32 reg, u64 value)\r\n{\r\nu64 __iomem *addr = (u64 __iomem *)map;\r\nreturn out_be64(addr + reg, value);\r\n}\r\nvoid scom_init_wsp(void)\r\n{\r\nscom_init(&wsp_scom_controller);\r\n}
