static void h3600_lcd_power(int enable)\r\n{\r\nif (gpio_request(H3XXX_EGPIO_LCD_ON, "LCD power")) {\r\npr_err("%s: can't request H3XXX_EGPIO_LCD_ON\n", __func__);\r\ngoto err1;\r\n}\r\nif (gpio_request(H3600_EGPIO_LCD_PCI, "LCD control")) {\r\npr_err("%s: can't request H3XXX_EGPIO_LCD_PCI\n", __func__);\r\ngoto err2;\r\n}\r\nif (gpio_request(H3600_EGPIO_LCD_5V_ON, "LCD 5v")) {\r\npr_err("%s: can't request H3XXX_EGPIO_LCD_5V_ON\n", __func__);\r\ngoto err3;\r\n}\r\nif (gpio_request(H3600_EGPIO_LVDD_ON, "LCD 9v/-6.5v")) {\r\npr_err("%s: can't request H3600_EGPIO_LVDD_ON\n", __func__);\r\ngoto err4;\r\n}\r\ngpio_direction_output(H3XXX_EGPIO_LCD_ON, enable);\r\ngpio_direction_output(H3600_EGPIO_LCD_PCI, enable);\r\ngpio_direction_output(H3600_EGPIO_LCD_5V_ON, enable);\r\ngpio_direction_output(H3600_EGPIO_LVDD_ON, enable);\r\ngpio_free(H3600_EGPIO_LVDD_ON);\r\nerr4: gpio_free(H3600_EGPIO_LCD_5V_ON);\r\nerr3: gpio_free(H3600_EGPIO_LCD_PCI);\r\nerr2: gpio_free(H3XXX_EGPIO_LCD_ON);\r\nerr1: return;\r\n}\r\nstatic void __init h3600_map_io(void)\r\n{\r\nh3xxx_map_io();\r\n}\r\nstatic int h3600_irda_set_power(struct device *dev, unsigned int state)\r\n{\r\ngpio_set_value(H3600_EGPIO_IR_ON, state);\r\nreturn 0;\r\n}\r\nstatic void h3600_irda_set_speed(struct device *dev, unsigned int speed)\r\n{\r\ngpio_set_value(H3600_EGPIO_IR_FSEL, !(speed < 4000000));\r\n}\r\nstatic int h3600_irda_startup(struct device *dev)\r\n{\r\nint err = gpio_request(H3600_EGPIO_IR_ON, "IrDA power");\r\nif (err)\r\ngoto err1;\r\nerr = gpio_direction_output(H3600_EGPIO_IR_ON, 0);\r\nif (err)\r\ngoto err2;\r\nerr = gpio_request(H3600_EGPIO_IR_FSEL, "IrDA fsel");\r\nif (err)\r\ngoto err2;\r\nerr = gpio_direction_output(H3600_EGPIO_IR_FSEL, 0);\r\nif (err)\r\ngoto err3;\r\nreturn 0;\r\nerr3: gpio_free(H3600_EGPIO_IR_FSEL);\r\nerr2: gpio_free(H3600_EGPIO_IR_ON);\r\nerr1: return err;\r\n}\r\nstatic void h3600_irda_shutdown(struct device *dev)\r\n{\r\ngpio_free(H3600_EGPIO_IR_ON);\r\ngpio_free(H3600_EGPIO_IR_FSEL);\r\n}\r\nstatic void __init h3600_mach_init(void)\r\n{\r\nh3xxx_init_gpio(h3600_default_gpio, ARRAY_SIZE(h3600_default_gpio));\r\nh3xxx_mach_init();\r\nsa11x0_register_lcd(&h3600_lcd_info);\r\nsa11x0_register_irda(&h3600_irda_data);\r\n}
