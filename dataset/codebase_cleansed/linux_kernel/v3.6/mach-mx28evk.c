static void __init mx28evk_fec_reset(void)\r\n{\r\nstruct clk *clk;\r\nclk = clk_get_sys("enet_out", NULL);\r\nif (!IS_ERR(clk))\r\nclk_prepare_enable(clk);\r\ngpio_set_value(MX28EVK_FEC_PHY_RESET, 0);\r\nmdelay(1);\r\ngpio_set_value(MX28EVK_FEC_PHY_RESET, 1);\r\n}\r\nstatic int __init mx28evk_fec_get_mac(void)\r\n{\r\nint i;\r\nu32 val;\r\nconst u32 *ocotp = mxs_get_ocotp();\r\nif (!ocotp)\r\nreturn -ETIMEDOUT;\r\nfor (i = 0; i < 2; i++) {\r\nval = ocotp[i];\r\nmx28_fec_pdata[i].mac[0] = 0x00;\r\nmx28_fec_pdata[i].mac[1] = 0x04;\r\nmx28_fec_pdata[i].mac[2] = 0x9f;\r\nmx28_fec_pdata[i].mac[3] = (val >> 16) & 0xff;\r\nmx28_fec_pdata[i].mac[4] = (val >> 8) & 0xff;\r\nmx28_fec_pdata[i].mac[5] = (val >> 0) & 0xff;\r\n}\r\nreturn 0;\r\n}\r\nstatic void mx28evk_flexcan_switch(void)\r\n{\r\nif (flexcan0_en || flexcan1_en)\r\ngpio_set_value(MX28EVK_FLEXCAN_SWITCH, 1);\r\nelse\r\ngpio_set_value(MX28EVK_FLEXCAN_SWITCH, 0);\r\n}\r\nstatic void mx28evk_flexcan0_switch(int enable)\r\n{\r\nflexcan0_en = enable;\r\nmx28evk_flexcan_switch();\r\n}\r\nstatic void mx28evk_flexcan1_switch(int enable)\r\n{\r\nflexcan1_en = enable;\r\nmx28evk_flexcan_switch();\r\n}\r\nstatic void __init mx28evk_add_regulators(void)\r\n{\r\nplatform_device_register(&mx28evk_voltage_regulator);\r\n}\r\nstatic void __init mx28evk_add_regulators(void) {}\r\nstatic void __init mx28evk_init(void)\r\n{\r\nint ret;\r\nmx28_soc_init();\r\nmxs_iomux_setup_multiple_pads(mx28evk_pads, ARRAY_SIZE(mx28evk_pads));\r\nmx28_add_duart();\r\nmx28_add_auart0();\r\nmx28_add_auart3();\r\nif (mx28evk_fec_get_mac())\r\npr_warn("%s: failed on fec mac setup\n", __func__);\r\nret = gpio_request_array(mx28evk_gpios, ARRAY_SIZE(mx28evk_gpios));\r\nif (ret)\r\npr_err("One or more GPIOs failed to be requested: %d\n", ret);\r\nmx28evk_fec_reset();\r\nmx28_add_fec(0, &mx28_fec_pdata[0]);\r\nmx28_add_fec(1, &mx28_fec_pdata[1]);\r\nmx28_add_flexcan(0, &mx28evk_flexcan_pdata[0]);\r\nmx28_add_flexcan(1, &mx28evk_flexcan_pdata[1]);\r\nmx28_add_mxsfb(&mx28evk_mxsfb_pdata);\r\nmxs_saif_clkmux_select(MXS_DIGCTL_SAIF_CLKMUX_EXTMSTR0);\r\nmx28_add_saif(0, &mx28evk_mxs_saif_pdata[0]);\r\nmx28_add_saif(1, &mx28evk_mxs_saif_pdata[1]);\r\nmx28_add_mxs_i2c(0);\r\ni2c_register_board_info(0, mxs_i2c0_board_info,\r\nARRAY_SIZE(mxs_i2c0_board_info));\r\nmx28evk_add_regulators();\r\nmxs_add_platform_device("mxs-sgtl5000", 0, NULL, 0,\r\nNULL, 0);\r\nmx28_add_mxs_mmc(0, &mx28evk_mmc_pdata[0]);\r\nmx28_add_mxs_mmc(1, &mx28evk_mmc_pdata[1]);\r\nmx28_add_rtc_stmp3xxx();\r\ngpio_led_register_device(0, &mx28evk_led_data);\r\n}\r\nstatic void __init mx28evk_timer_init(void)\r\n{\r\nmx28_clocks_init();\r\n}
