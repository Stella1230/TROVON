static void __init glantank_timer_init(void)\r\n{\r\niop_init_time(200000000);\r\n}\r\nvoid __init glantank_map_io(void)\r\n{\r\niop3xx_map_io();\r\niotable_init(glantank_io_desc, ARRAY_SIZE(glantank_io_desc));\r\n}\r\nstatic int __init\r\nglantank_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nstatic int pci_irq_table[][4] = {\r\n{INTD, INTD, INTD, INTD},\r\n{INTA, INTA, INTA, INTA},\r\n{INTB, INTB, INTB, INTB},\r\n{INTC, INTC, INTC, INTC},\r\n};\r\nBUG_ON(pin < 1 || pin > 4);\r\nreturn pci_irq_table[slot % 4][pin - 1];\r\n}\r\nstatic int __init glantank_pci_init(void)\r\n{\r\nif (machine_is_glantank())\r\npci_common_init(&glantank_pci);\r\nreturn 0;\r\n}\r\nstatic void glantank_power_off(void)\r\n{\r\n__raw_writeb(0x01, 0xfe8d0004);\r\nwhile (1)\r\n;\r\n}\r\nstatic void __init glantank_init_machine(void)\r\n{\r\nplatform_device_register(&iop3xx_i2c0_device);\r\nplatform_device_register(&iop3xx_i2c1_device);\r\nplatform_device_register(&glantank_flash_device);\r\nplatform_device_register(&glantank_serial_device);\r\nplatform_device_register(&iop3xx_dma_0_channel);\r\nplatform_device_register(&iop3xx_dma_1_channel);\r\ni2c_register_board_info(0, glantank_i2c_devices,\r\nARRAY_SIZE(glantank_i2c_devices));\r\npm_power_off = glantank_power_off;\r\n}
