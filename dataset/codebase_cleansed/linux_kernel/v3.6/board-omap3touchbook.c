static int touchbook_twl_gpio_setup(struct device *dev,\r\nunsigned gpio, unsigned ngpio)\r\n{\r\nmmc[0].gpio_cd = gpio + 0;\r\nomap_hsmmc_late_init(mmc);\r\ngpio_request_one(gpio + 1, GPIOF_IN, "EHCI_nOC");\r\ngpio_request_one(gpio + TWL4030_GPIO_MAX, GPIOF_OUT_INIT_LOW,\r\n"nEN_USB_PWR");\r\ngpio_leds[2].gpio = gpio + TWL4030_GPIO_MAX + 1;\r\nreturn 0;\r\n}\r\nstatic int __init omap3_touchbook_i2c_init(void)\r\n{\r\nomap3_pmic_get_config(&touchbook_twldata,\r\nTWL_COMMON_PDATA_USB | TWL_COMMON_PDATA_AUDIO,\r\nTWL_COMMON_REGULATOR_VDAC | TWL_COMMON_REGULATOR_VPLL2);\r\ntouchbook_twldata.vdac->num_consumer_supplies =\r\nARRAY_SIZE(touchbook_vdac_supply);\r\ntouchbook_twldata.vdac->consumer_supplies = touchbook_vdac_supply;\r\ntouchbook_twldata.vpll2->constraints.name = "VDVI";\r\ntouchbook_twldata.vpll2->num_consumer_supplies =\r\nARRAY_SIZE(touchbook_vdvi_supply);\r\ntouchbook_twldata.vpll2->consumer_supplies = touchbook_vdvi_supply;\r\nomap3_pmic_init("twl4030", &touchbook_twldata);\r\nomap_register_i2c_bus(3, 100, touchBook_i2c_boardinfo,\r\nARRAY_SIZE(touchBook_i2c_boardinfo));\r\nreturn 0;\r\n}\r\nstatic void omap3_touchbook_poweroff(void)\r\n{\r\nint pwr_off = TB_KILL_POWER_GPIO;\r\nif (gpio_request_one(pwr_off, GPIOF_OUT_INIT_LOW, "DVI reset") < 0)\r\nprintk(KERN_ERR "Unable to get kill power GPIO\n");\r\n}\r\nstatic int __init early_touchbook_revision(char *p)\r\n{\r\nif (!p)\r\nreturn 0;\r\nreturn strict_strtoul(p, 10, &touchbook_revision);\r\n}\r\nstatic void __init omap3_touchbook_init(void)\r\n{\r\nomap3_mux_init(board_mux, OMAP_PACKAGE_CBB);\r\npm_power_off = omap3_touchbook_poweroff;\r\nif (system_rev >= 0x20 && system_rev <= 0x34301000) {\r\nomap_mux_init_gpio(23, OMAP_PIN_INPUT);\r\nmmc[0].gpio_wp = 23;\r\n} else {\r\nomap_mux_init_gpio(29, OMAP_PIN_INPUT);\r\n}\r\nomap_hsmmc_init(mmc);\r\nomap3_touchbook_i2c_init();\r\nplatform_add_devices(omap3_touchbook_devices,\r\nARRAY_SIZE(omap3_touchbook_devices));\r\nomap_serial_init();\r\nomap_sdrc_init(mt46h32m32lf6_sdrc_params,\r\nmt46h32m32lf6_sdrc_params);\r\nomap_mux_init_gpio(170, OMAP_PIN_INPUT);\r\ngpio_request_one(176, GPIOF_OUT_INIT_HIGH, "DVI_nPD");\r\nomap_ads7846_init(4, OMAP3_TS_GPIO, 310, &ads7846_pdata);\r\nusb_musb_init(NULL);\r\nusbhs_init(&usbhs_bdata);\r\nomap_nand_flash_init(NAND_BUSWIDTH_16, omap3touchbook_nand_partitions,\r\nARRAY_SIZE(omap3touchbook_nand_partitions));\r\nomap_mux_init_signal("sdrc_cke0", OMAP_PIN_OUTPUT);\r\nomap_mux_init_signal("sdrc_cke1", OMAP_PIN_OUTPUT);\r\n}
