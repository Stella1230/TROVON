__wsum csum_partial(const void *buff, int len, __wsum sum)\r\n{\r\nunsigned long tmp1, tmp2;\r\n__asm__("movel %2,%3\n\t"\r\n"btst #1,%3\n\t"\r\n"jeq 2f\n\t"\r\n"subql #2,%1\n\t"\r\n"jgt 1f\n\t"\r\n"addql #2,%1\n\t"\r\n"jra 4f\n"\r\n"1:\t"\r\n"addw %2@+,%0\n\t"\r\n"clrl %3\n\t"\r\n"addxl %3,%0\n"\r\n"2:\t"\r\n"movel %1,%3\n\t"\r\n"lsrl #5,%1\n\t"\r\n"jeq 2f\n\t"\r\n"subql #1,%1\n"\r\n"1:\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"dbra %1,1b\n\t"\r\n"clrl %4\n\t"\r\n"addxl %4,%0\n\t"\r\n"clrw %1\n\t"\r\n"subql #1,%1\n\t"\r\n"jcc 1b\n"\r\n"2:\t"\r\n"movel %3,%1\n\t"\r\n"andw #0x1c,%3\n\t"\r\n"jeq 4f\n\t"\r\n"lsrw #2,%3\n\t"\r\n"subqw #1,%3\n"\r\n"3:\t"\r\n"movel %2@+,%4\n\t"\r\n"addxl %4,%0\n\t"\r\n"dbra %3,3b\n\t"\r\n"clrl %4\n\t"\r\n"addxl %4,%0\n"\r\n"4:\t"\r\n"andw #3,%1\n\t"\r\n"jeq 7f\n\t"\r\n"clrl %4\n\t"\r\n"subqw #2,%1\n\t"\r\n"jlt 5f\n\t"\r\n"movew %2@+,%4\n\t"\r\n"swap %4\n\t"\r\n"tstw %1\n\t"\r\n"jeq 6f\n"\r\n"5:\t"\r\n"moveb %2@,%4\n\t"\r\n"lslw #8,%4\n\t"\r\n"6:\t"\r\n"addl %4,%0\n\t"\r\n"clrl %4\n\t"\r\n"addxl %4,%0\n"\r\n"7:\t"\r\n: "=d" (sum), "=d" (len), "=a" (buff),\r\n"=&d" (tmp1), "=&d" (tmp2)\r\n: "0" (sum), "1" (len), "2" (buff)\r\n);\r\nreturn(sum);\r\n}\r\n__wsum\r\ncsum_partial_copy_from_user(const void __user *src, void *dst,\r\nint len, __wsum sum, int *csum_err)\r\n{\r\nunsigned long tmp1, tmp2;\r\n__asm__("movel %2,%4\n\t"\r\n"btst #1,%4\n\t"\r\n"jeq 2f\n\t"\r\n"subql #2,%1\n\t"\r\n"jgt 1f\n\t"\r\n"addql #2,%1\n\t"\r\n"jra 4f\n"\r\n"1:\n"\r\n"10:\t"\r\n"movesw %2@+,%4\n\t"\r\n"addw %4,%0\n\t"\r\n"movew %4,%3@+\n\t"\r\n"clrl %4\n\t"\r\n"addxl %4,%0\n"\r\n"2:\t"\r\n"movel %1,%4\n\t"\r\n"lsrl #5,%1\n\t"\r\n"jeq 2f\n\t"\r\n"subql #1,%1\n"\r\n"1:\n"\r\n"11:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"12:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"13:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"14:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"15:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"16:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"17:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"18:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"dbra %1,1b\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n\t"\r\n"clrw %1\n\t"\r\n"subql #1,%1\n\t"\r\n"jcc 1b\n"\r\n"2:\t"\r\n"movel %4,%1\n\t"\r\n"andw #0x1c,%4\n\t"\r\n"jeq 4f\n\t"\r\n"lsrw #2,%4\n\t"\r\n"subqw #1,%4\n"\r\n"3:\n"\r\n"19:\t"\r\n"movesl %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"dbra %4,3b\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n"\r\n"4:\t"\r\n"andw #3,%1\n\t"\r\n"jeq 7f\n\t"\r\n"clrl %5\n\t"\r\n"subqw #2,%1\n\t"\r\n"jlt 5f\n\t"\r\n"20:\t"\r\n"movesw %2@+,%5\n\t"\r\n"movew %5,%3@+\n\t"\r\n"swap %5\n\t"\r\n"tstw %1\n\t"\r\n"jeq 6f\n"\r\n"5:\n"\r\n"21:\t"\r\n"movesb %2@,%5\n\t"\r\n"moveb %5,%3@+\n\t"\r\n"lslw #8,%5\n\t"\r\n"6:\t"\r\n"addl %5,%0\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n\t"\r\n"7:\t"\r\n"clrl %5\n"\r\n"8:\n"\r\n".section .fixup,\"ax\"\n"\r\n".even\n"\r\n"90:\t"\r\n"clrw %3@+\n\t"\r\n"movel %1,%4\n\t"\r\n"lsrl #5,%1\n\t"\r\n"jeq 1f\n\t"\r\n"subql #1,%1\n"\r\n"91:\t"\r\n"clrl %3@+\n"\r\n"92:\t"\r\n"clrl %3@+\n"\r\n"93:\t"\r\n"clrl %3@+\n"\r\n"94:\t"\r\n"clrl %3@+\n"\r\n"95:\t"\r\n"clrl %3@+\n"\r\n"96:\t"\r\n"clrl %3@+\n"\r\n"97:\t"\r\n"clrl %3@+\n"\r\n"98:\t"\r\n"clrl %3@+\n\t"\r\n"dbra %1,91b\n\t"\r\n"clrw %1\n\t"\r\n"subql #1,%1\n\t"\r\n"jcc 91b\n"\r\n"1:\t"\r\n"movel %4,%1\n\t"\r\n"andw #0x1c,%4\n\t"\r\n"jeq 1f\n\t"\r\n"lsrw #2,%4\n\t"\r\n"subqw #1,%4\n"\r\n"99:\t"\r\n"clrl %3@+\n\t"\r\n"dbra %4,99b\n\t"\r\n"1:\t"\r\n"andw #3,%1\n\t"\r\n"jeq 9f\n"\r\n"100:\t"\r\n"clrw %3@+\n\t"\r\n"tstw %1\n\t"\r\n"jeq 9f\n"\r\n"101:\t"\r\n"clrb %3@+\n"\r\n"9:\t"\r\n#define STR(X) STR1(X)\r\n#define STR1(X) #X\r\n"moveq #-" STR(EFAULT) ",%5\n\t"\r\n"jra 8b\n"\r\n".previous\n"\r\n".section __ex_table,\"a\"\n"\r\n".long 10b,90b\n"\r\n".long 11b,91b\n"\r\n".long 12b,92b\n"\r\n".long 13b,93b\n"\r\n".long 14b,94b\n"\r\n".long 15b,95b\n"\r\n".long 16b,96b\n"\r\n".long 17b,97b\n"\r\n".long 18b,98b\n"\r\n".long 19b,99b\n"\r\n".long 20b,100b\n"\r\n".long 21b,101b\n"\r\n".previous"\r\n: "=d" (sum), "=d" (len), "=a" (src), "=a" (dst),\r\n"=&d" (tmp1), "=d" (tmp2)\r\n: "0" (sum), "1" (len), "2" (src), "3" (dst)\r\n);\r\n*csum_err = tmp2;\r\nreturn(sum);\r\n}\r\n__wsum\r\ncsum_partial_copy_nocheck(const void *src, void *dst, int len, __wsum sum)\r\n{\r\nunsigned long tmp1, tmp2;\r\n__asm__("movel %2,%4\n\t"\r\n"btst #1,%4\n\t"\r\n"jeq 2f\n\t"\r\n"subql #2,%1\n\t"\r\n"jgt 1f\n\t"\r\n"addql #2,%1\n\t"\r\n"jra 4f\n"\r\n"1:\t"\r\n"movew %2@+,%4\n\t"\r\n"addw %4,%0\n\t"\r\n"movew %4,%3@+\n\t"\r\n"clrl %4\n\t"\r\n"addxl %4,%0\n"\r\n"2:\t"\r\n"movel %1,%4\n\t"\r\n"lsrl #5,%1\n\t"\r\n"jeq 2f\n\t"\r\n"subql #1,%1\n"\r\n"1:\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"dbra %1,1b\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n\t"\r\n"clrw %1\n\t"\r\n"subql #1,%1\n\t"\r\n"jcc 1b\n"\r\n"2:\t"\r\n"movel %4,%1\n\t"\r\n"andw #0x1c,%4\n\t"\r\n"jeq 4f\n\t"\r\n"lsrw #2,%4\n\t"\r\n"subqw #1,%4\n"\r\n"3:\t"\r\n"movel %2@+,%5\n\t"\r\n"addxl %5,%0\n\t"\r\n"movel %5,%3@+\n\t"\r\n"dbra %4,3b\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n"\r\n"4:\t"\r\n"andw #3,%1\n\t"\r\n"jeq 7f\n\t"\r\n"clrl %5\n\t"\r\n"subqw #2,%1\n\t"\r\n"jlt 5f\n\t"\r\n"movew %2@+,%5\n\t"\r\n"movew %5,%3@+\n\t"\r\n"swap %5\n\t"\r\n"tstw %1\n\t"\r\n"jeq 6f\n"\r\n"5:\t"\r\n"moveb %2@,%5\n\t"\r\n"moveb %5,%3@+\n\t"\r\n"lslw #8,%5\n"\r\n"6:\t"\r\n"addl %5,%0\n\t"\r\n"clrl %5\n\t"\r\n"addxl %5,%0\n"\r\n"7:\t"\r\n: "=d" (sum), "=d" (len), "=a" (src), "=a" (dst),\r\n"=&d" (tmp1), "=&d" (tmp2)\r\n: "0" (sum), "1" (len), "2" (src), "3" (dst)\r\n);\r\nreturn(sum);\r\n}
