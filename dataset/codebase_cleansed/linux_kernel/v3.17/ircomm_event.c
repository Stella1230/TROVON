static int ircomm_state_idle(struct ircomm_cb *self, IRCOMM_EVENT event,\r\nstruct sk_buff *skb, struct ircomm_info *info)\r\n{\r\nint ret = 0;\r\nswitch (event) {\r\ncase IRCOMM_CONNECT_REQUEST:\r\nircomm_next_state(self, IRCOMM_WAITI);\r\nret = self->issue.connect_request(self, skb, info);\r\nbreak;\r\ncase IRCOMM_TTP_CONNECT_INDICATION:\r\ncase IRCOMM_LMP_CONNECT_INDICATION:\r\nircomm_next_state(self, IRCOMM_WAITR);\r\nircomm_connect_indication(self, skb, info);\r\nbreak;\r\ndefault:\r\nIRDA_DEBUG(4, "%s(), unknown event: %s\n", __func__ ,\r\nircomm_event[event]);\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ircomm_state_waiti(struct ircomm_cb *self, IRCOMM_EVENT event,\r\nstruct sk_buff *skb, struct ircomm_info *info)\r\n{\r\nint ret = 0;\r\nswitch (event) {\r\ncase IRCOMM_TTP_CONNECT_CONFIRM:\r\ncase IRCOMM_LMP_CONNECT_CONFIRM:\r\nircomm_next_state(self, IRCOMM_CONN);\r\nircomm_connect_confirm(self, skb, info);\r\nbreak;\r\ncase IRCOMM_TTP_DISCONNECT_INDICATION:\r\ncase IRCOMM_LMP_DISCONNECT_INDICATION:\r\nircomm_next_state(self, IRCOMM_IDLE);\r\nircomm_disconnect_indication(self, skb, info);\r\nbreak;\r\ndefault:\r\nIRDA_DEBUG(0, "%s(), unknown event: %s\n", __func__ ,\r\nircomm_event[event]);\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ircomm_state_waitr(struct ircomm_cb *self, IRCOMM_EVENT event,\r\nstruct sk_buff *skb, struct ircomm_info *info)\r\n{\r\nint ret = 0;\r\nswitch (event) {\r\ncase IRCOMM_CONNECT_RESPONSE:\r\nircomm_next_state(self, IRCOMM_CONN);\r\nret = self->issue.connect_response(self, skb);\r\nbreak;\r\ncase IRCOMM_DISCONNECT_REQUEST:\r\nircomm_next_state(self, IRCOMM_IDLE);\r\nret = self->issue.disconnect_request(self, skb, info);\r\nbreak;\r\ncase IRCOMM_TTP_DISCONNECT_INDICATION:\r\ncase IRCOMM_LMP_DISCONNECT_INDICATION:\r\nircomm_next_state(self, IRCOMM_IDLE);\r\nircomm_disconnect_indication(self, skb, info);\r\nbreak;\r\ndefault:\r\nIRDA_DEBUG(0, "%s(), unknown event = %s\n", __func__ ,\r\nircomm_event[event]);\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ircomm_state_conn(struct ircomm_cb *self, IRCOMM_EVENT event,\r\nstruct sk_buff *skb, struct ircomm_info *info)\r\n{\r\nint ret = 0;\r\nswitch (event) {\r\ncase IRCOMM_DATA_REQUEST:\r\nret = self->issue.data_request(self, skb, 0);\r\nbreak;\r\ncase IRCOMM_TTP_DATA_INDICATION:\r\nircomm_process_data(self, skb);\r\nbreak;\r\ncase IRCOMM_LMP_DATA_INDICATION:\r\nircomm_data_indication(self, skb);\r\nbreak;\r\ncase IRCOMM_CONTROL_REQUEST:\r\nret = self->issue.data_request(self, skb, skb->len);\r\nbreak;\r\ncase IRCOMM_TTP_DISCONNECT_INDICATION:\r\ncase IRCOMM_LMP_DISCONNECT_INDICATION:\r\nircomm_next_state(self, IRCOMM_IDLE);\r\nircomm_disconnect_indication(self, skb, info);\r\nbreak;\r\ncase IRCOMM_DISCONNECT_REQUEST:\r\nircomm_next_state(self, IRCOMM_IDLE);\r\nret = self->issue.disconnect_request(self, skb, info);\r\nbreak;\r\ndefault:\r\nIRDA_DEBUG(0, "%s(), unknown event = %s\n", __func__ ,\r\nircomm_event[event]);\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nint ircomm_do_event(struct ircomm_cb *self, IRCOMM_EVENT event,\r\nstruct sk_buff *skb, struct ircomm_info *info)\r\n{\r\nIRDA_DEBUG(4, "%s: state=%s, event=%s\n", __func__ ,\r\nircomm_state[self->state], ircomm_event[event]);\r\nreturn (*state[self->state])(self, event, skb, info);\r\n}\r\nvoid ircomm_next_state(struct ircomm_cb *self, IRCOMM_STATE state)\r\n{\r\nself->state = state;\r\nIRDA_DEBUG(4, "%s: next state=%s, service type=%d\n", __func__ ,\r\nircomm_state[self->state], self->service_type);\r\n}
