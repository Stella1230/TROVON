int snd_soc_component_read(struct snd_soc_component *component,\r\nunsigned int reg, unsigned int *val)\r\n{\r\nint ret;\r\nif (component->regmap)\r\nret = regmap_read(component->regmap, reg, val);\r\nelse if (component->read)\r\nret = component->read(component, reg, val);\r\nelse\r\nret = -EIO;\r\nreturn ret;\r\n}\r\nint snd_soc_component_write(struct snd_soc_component *component,\r\nunsigned int reg, unsigned int val)\r\n{\r\nif (component->regmap)\r\nreturn regmap_write(component->regmap, reg, val);\r\nelse if (component->write)\r\nreturn component->write(component, reg, val);\r\nelse\r\nreturn -EIO;\r\n}\r\nstatic int snd_soc_component_update_bits_legacy(\r\nstruct snd_soc_component *component, unsigned int reg,\r\nunsigned int mask, unsigned int val, bool *change)\r\n{\r\nunsigned int old, new;\r\nint ret;\r\nif (!component->read || !component->write)\r\nreturn -EIO;\r\nmutex_lock(&component->io_mutex);\r\nret = component->read(component, reg, &old);\r\nif (ret < 0)\r\ngoto out_unlock;\r\nnew = (old & ~mask) | (val & mask);\r\n*change = old != new;\r\nif (*change)\r\nret = component->write(component, reg, new);\r\nout_unlock:\r\nmutex_unlock(&component->io_mutex);\r\nreturn ret;\r\n}\r\nint snd_soc_component_update_bits(struct snd_soc_component *component,\r\nunsigned int reg, unsigned int mask, unsigned int val)\r\n{\r\nbool change;\r\nint ret;\r\nif (component->regmap)\r\nret = regmap_update_bits_check(component->regmap, reg, mask,\r\nval, &change);\r\nelse\r\nret = snd_soc_component_update_bits_legacy(component, reg,\r\nmask, val, &change);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn change;\r\n}\r\nint snd_soc_component_update_bits_async(struct snd_soc_component *component,\r\nunsigned int reg, unsigned int mask, unsigned int val)\r\n{\r\nbool change;\r\nint ret;\r\nif (component->regmap)\r\nret = regmap_update_bits_check_async(component->regmap, reg,\r\nmask, val, &change);\r\nelse\r\nret = snd_soc_component_update_bits_legacy(component, reg,\r\nmask, val, &change);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn change;\r\n}\r\nvoid snd_soc_component_async_complete(struct snd_soc_component *component)\r\n{\r\nif (component->regmap)\r\nregmap_async_complete(component->regmap);\r\n}\r\nint snd_soc_component_test_bits(struct snd_soc_component *component,\r\nunsigned int reg, unsigned int mask, unsigned int value)\r\n{\r\nunsigned int old, new;\r\nint ret;\r\nret = snd_soc_component_read(component, reg, &old);\r\nif (ret < 0)\r\nreturn ret;\r\nnew = (old & ~mask) | value;\r\nreturn old != new;\r\n}\r\nunsigned int snd_soc_read(struct snd_soc_codec *codec, unsigned int reg)\r\n{\r\nunsigned int val;\r\nint ret;\r\nret = snd_soc_component_read(&codec->component, reg, &val);\r\nif (ret < 0)\r\nreturn -1;\r\nreturn val;\r\n}\r\nint snd_soc_write(struct snd_soc_codec *codec, unsigned int reg,\r\nunsigned int val)\r\n{\r\nreturn snd_soc_component_write(&codec->component, reg, val);\r\n}\r\nint snd_soc_update_bits(struct snd_soc_codec *codec, unsigned int reg,\r\nunsigned int mask, unsigned int value)\r\n{\r\nreturn snd_soc_component_update_bits(&codec->component, reg, mask,\r\nvalue);\r\n}\r\nint snd_soc_test_bits(struct snd_soc_codec *codec, unsigned int reg,\r\nunsigned int mask, unsigned int value)\r\n{\r\nreturn snd_soc_component_test_bits(&codec->component, reg, mask, value);\r\n}\r\nint snd_soc_platform_read(struct snd_soc_platform *platform,\r\nunsigned int reg)\r\n{\r\nunsigned int val;\r\nint ret;\r\nret = snd_soc_component_read(&platform->component, reg, &val);\r\nif (ret < 0)\r\nreturn -1;\r\nreturn val;\r\n}\r\nint snd_soc_platform_write(struct snd_soc_platform *platform,\r\nunsigned int reg, unsigned int val)\r\n{\r\nreturn snd_soc_component_write(&platform->component, reg, val);\r\n}\r\nint snd_soc_component_init_io(struct snd_soc_component *component,\r\nstruct regmap *regmap)\r\n{\r\nint ret;\r\nif (!regmap)\r\nreturn -EINVAL;\r\nret = regmap_get_val_bytes(regmap);\r\nif (ret > 0)\r\ncomponent->val_bytes = ret;\r\ncomponent->regmap = regmap;\r\nreturn 0;\r\n}
