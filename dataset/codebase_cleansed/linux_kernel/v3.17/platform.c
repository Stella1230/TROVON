static int dwc2_driver_remove(struct platform_device *dev)\r\n{\r\nstruct dwc2_hsotg *hsotg = platform_get_drvdata(dev);\r\ndwc2_hcd_remove(hsotg);\r\nreturn 0;\r\n}\r\nstatic int dwc2_driver_probe(struct platform_device *dev)\r\n{\r\nconst struct of_device_id *match;\r\nconst struct dwc2_core_params *params;\r\nstruct dwc2_core_params defparams;\r\nstruct dwc2_hsotg *hsotg;\r\nstruct resource *res;\r\nint retval;\r\nint irq;\r\nif (usb_disabled())\r\nreturn -ENODEV;\r\nmatch = of_match_device(dwc2_of_match_table, &dev->dev);\r\nif (match && match->data) {\r\nparams = match->data;\r\n} else {\r\ndwc2_set_all_params(&defparams, -1);\r\nparams = &defparams;\r\ndefparams.dma_desc_enable = 0;\r\n}\r\nhsotg = devm_kzalloc(&dev->dev, sizeof(*hsotg), GFP_KERNEL);\r\nif (!hsotg)\r\nreturn -ENOMEM;\r\nhsotg->dev = &dev->dev;\r\nif (!dev->dev.dma_mask)\r\ndev->dev.dma_mask = &dev->dev.coherent_dma_mask;\r\nretval = dma_set_coherent_mask(&dev->dev, DMA_BIT_MASK(32));\r\nif (retval)\r\nreturn retval;\r\nirq = platform_get_irq(dev, 0);\r\nif (irq < 0) {\r\ndev_err(&dev->dev, "missing IRQ resource\n");\r\nreturn irq;\r\n}\r\nres = platform_get_resource(dev, IORESOURCE_MEM, 0);\r\nhsotg->regs = devm_ioremap_resource(&dev->dev, res);\r\nif (IS_ERR(hsotg->regs))\r\nreturn PTR_ERR(hsotg->regs);\r\ndev_dbg(&dev->dev, "mapped PA %08lx to VA %p\n",\r\n(unsigned long)res->start, hsotg->regs);\r\nretval = dwc2_hcd_init(hsotg, irq, params);\r\nif (retval)\r\nreturn retval;\r\nplatform_set_drvdata(dev, hsotg);\r\nreturn retval;\r\n}
