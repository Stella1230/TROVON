static int jfs_loglevel_proc_show(struct seq_file *m, void *v)\r\n{\r\nseq_printf(m, "%d\n", jfsloglevel);\r\nreturn 0;\r\n}\r\nstatic int jfs_loglevel_proc_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, jfs_loglevel_proc_show, NULL);\r\n}\r\nstatic ssize_t jfs_loglevel_proc_write(struct file *file,\r\nconst char __user *buffer, size_t count, loff_t *ppos)\r\n{\r\nchar c;\r\nif (get_user(c, buffer))\r\nreturn -EFAULT;\r\nif (c < '0' || c > '9')\r\nreturn -EINVAL;\r\njfsloglevel = c - '0';\r\nreturn count;\r\n}\r\nvoid jfs_proc_init(void)\r\n{\r\nint i;\r\nif (!(base = proc_mkdir("fs/jfs", NULL)))\r\nreturn;\r\nfor (i = 0; i < NPROCENT; i++)\r\nproc_create(Entries[i].name, 0, base, Entries[i].proc_fops);\r\n}\r\nvoid jfs_proc_clean(void)\r\n{\r\nint i;\r\nif (base) {\r\nfor (i = 0; i < NPROCENT; i++)\r\nremove_proc_entry(Entries[i].name, base);\r\nremove_proc_entry("fs/jfs", NULL);\r\n}\r\n}
