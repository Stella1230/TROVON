int as10x_cmd_add_PID_filter(struct as10x_bus_adapter_t *adap,\r\nstruct as10x_ts_filter *filter)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.add_pid_filter.req));\r\npcmd->body.add_pid_filter.req.proc_id =\r\ncpu_to_le16(CONTROL_PROC_SETFILTER);\r\npcmd->body.add_pid_filter.req.pid = cpu_to_le16(filter->pid);\r\npcmd->body.add_pid_filter.req.stream_type = filter->type;\r\nif (filter->idx < 16)\r\npcmd->body.add_pid_filter.req.idx = filter->idx;\r\nelse\r\npcmd->body.add_pid_filter.req.idx = 0xFF;\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\r\nsizeof(pcmd->body.add_pid_filter.req)\r\n+ HEADER_SIZE, (uint8_t *) prsp,\r\nsizeof(prsp->body.add_pid_filter.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_rsp_parse(prsp, CONTROL_PROC_SETFILTER_RSP);\r\nif (error == 0) {\r\nfilter->idx = prsp->body.add_pid_filter.rsp.filter_id;\r\n}\r\nout:\r\nreturn error;\r\n}\r\nint as10x_cmd_del_PID_filter(struct as10x_bus_adapter_t *adap,\r\nuint16_t pid_value)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.del_pid_filter.req));\r\npcmd->body.del_pid_filter.req.proc_id =\r\ncpu_to_le16(CONTROL_PROC_REMOVEFILTER);\r\npcmd->body.del_pid_filter.req.pid = cpu_to_le16(pid_value);\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\r\nsizeof(pcmd->body.del_pid_filter.req)\r\n+ HEADER_SIZE, (uint8_t *) prsp,\r\nsizeof(prsp->body.del_pid_filter.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_rsp_parse(prsp, CONTROL_PROC_REMOVEFILTER_RSP);\r\nout:\r\nreturn error;\r\n}\r\nint as10x_cmd_start_streaming(struct as10x_bus_adapter_t *adap)\r\n{\r\nint error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.start_streaming.req));\r\npcmd->body.start_streaming.req.proc_id =\r\ncpu_to_le16(CONTROL_PROC_START_STREAMING);\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\r\nsizeof(pcmd->body.start_streaming.req)\r\n+ HEADER_SIZE, (uint8_t *) prsp,\r\nsizeof(prsp->body.start_streaming.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_rsp_parse(prsp, CONTROL_PROC_START_STREAMING_RSP);\r\nout:\r\nreturn error;\r\n}\r\nint as10x_cmd_stop_streaming(struct as10x_bus_adapter_t *adap)\r\n{\r\nint8_t error;\r\nstruct as10x_cmd_t *pcmd, *prsp;\r\npcmd = adap->cmd;\r\nprsp = adap->rsp;\r\nas10x_cmd_build(pcmd, (++adap->cmd_xid),\r\nsizeof(pcmd->body.stop_streaming.req));\r\npcmd->body.stop_streaming.req.proc_id =\r\ncpu_to_le16(CONTROL_PROC_STOP_STREAMING);\r\nif (adap->ops->xfer_cmd) {\r\nerror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\r\nsizeof(pcmd->body.stop_streaming.req)\r\n+ HEADER_SIZE, (uint8_t *) prsp,\r\nsizeof(prsp->body.stop_streaming.rsp)\r\n+ HEADER_SIZE);\r\n} else {\r\nerror = AS10X_CMD_ERROR;\r\n}\r\nif (error < 0)\r\ngoto out;\r\nerror = as10x_rsp_parse(prsp, CONTROL_PROC_STOP_STREAMING_RSP);\r\nout:\r\nreturn error;\r\n}
