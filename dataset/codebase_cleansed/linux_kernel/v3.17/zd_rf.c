const char *zd_rf_name(u8 type)\r\n{\r\nif (type & 0xf0)\r\ntype = 0;\r\nreturn rfs[type];\r\n}\r\nvoid zd_rf_init(struct zd_rf *rf)\r\n{\r\nmemset(rf, 0, sizeof(*rf));\r\nrf->update_channel_int = 1;\r\n}\r\nvoid zd_rf_clear(struct zd_rf *rf)\r\n{\r\nif (rf->clear)\r\nrf->clear(rf);\r\nZD_MEMCLEAR(rf, sizeof(*rf));\r\n}\r\nint zd_rf_init_hw(struct zd_rf *rf, u8 type)\r\n{\r\nint r = 0;\r\nint t;\r\nstruct zd_chip *chip = zd_rf_to_chip(rf);\r\nZD_ASSERT(mutex_is_locked(&chip->mutex));\r\nswitch (type) {\r\ncase RF2959_RF:\r\nr = zd_rf_init_rf2959(rf);\r\nbreak;\r\ncase AL2230_RF:\r\ncase AL2230S_RF:\r\nr = zd_rf_init_al2230(rf);\r\nbreak;\r\ncase AL7230B_RF:\r\nr = zd_rf_init_al7230b(rf);\r\nbreak;\r\ncase MAXIM_NEW_RF:\r\ncase UW2453_RF:\r\nr = zd_rf_init_uw2453(rf);\r\nbreak;\r\ndefault:\r\ndev_err(zd_chip_dev(chip),\r\n"RF %s %#x is not supported\n", zd_rf_name(type), type);\r\nrf->type = 0;\r\nreturn -ENODEV;\r\n}\r\nif (r)\r\nreturn r;\r\nrf->type = type;\r\nr = zd_chip_lock_phy_regs(chip);\r\nif (r)\r\nreturn r;\r\nt = rf->init_hw(rf);\r\nr = zd_chip_unlock_phy_regs(chip);\r\nif (t)\r\nr = t;\r\nreturn r;\r\n}\r\nint zd_rf_scnprint_id(struct zd_rf *rf, char *buffer, size_t size)\r\n{\r\nreturn scnprintf(buffer, size, "%s", zd_rf_name(rf->type));\r\n}\r\nint zd_rf_set_channel(struct zd_rf *rf, u8 channel)\r\n{\r\nint r;\r\nZD_ASSERT(mutex_is_locked(&zd_rf_to_chip(rf)->mutex));\r\nif (channel < MIN_CHANNEL24)\r\nreturn -EINVAL;\r\nif (channel > MAX_CHANNEL24)\r\nreturn -EINVAL;\r\ndev_dbg_f(zd_chip_dev(zd_rf_to_chip(rf)), "channel: %d\n", channel);\r\nr = rf->set_channel(rf, channel);\r\nif (r >= 0)\r\nrf->channel = channel;\r\nreturn r;\r\n}\r\nint zd_switch_radio_on(struct zd_rf *rf)\r\n{\r\nint r, t;\r\nstruct zd_chip *chip = zd_rf_to_chip(rf);\r\nZD_ASSERT(mutex_is_locked(&chip->mutex));\r\nr = zd_chip_lock_phy_regs(chip);\r\nif (r)\r\nreturn r;\r\nt = rf->switch_radio_on(rf);\r\nr = zd_chip_unlock_phy_regs(chip);\r\nif (t)\r\nr = t;\r\nreturn r;\r\n}\r\nint zd_switch_radio_off(struct zd_rf *rf)\r\n{\r\nint r, t;\r\nstruct zd_chip *chip = zd_rf_to_chip(rf);\r\nZD_ASSERT(mutex_is_locked(&chip->mutex));\r\nr = zd_chip_lock_phy_regs(chip);\r\nif (r)\r\nreturn r;\r\nt = rf->switch_radio_off(rf);\r\nr = zd_chip_unlock_phy_regs(chip);\r\nif (t)\r\nr = t;\r\nreturn r;\r\n}\r\nint zd_rf_patch_6m_band_edge(struct zd_rf *rf, u8 channel)\r\n{\r\nif (!rf->patch_6m_band_edge)\r\nreturn 0;\r\nreturn rf->patch_6m_band_edge(rf, channel);\r\n}\r\nint zd_rf_generic_patch_6m(struct zd_rf *rf, u8 channel)\r\n{\r\nreturn zd_chip_generic_patch_6m_band(zd_rf_to_chip(rf), channel);\r\n}
