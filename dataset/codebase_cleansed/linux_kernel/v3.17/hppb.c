static int hppb_probe(struct parisc_device *dev)\r\n{\r\nint status;\r\nstruct hppb_card *card = &hppb_card_head;\r\nwhile(card->next) {\r\ncard = card->next;\r\n}\r\nif(card->hpa) {\r\ncard->next = kzalloc(sizeof(struct hppb_card), GFP_KERNEL);\r\nif(!card->next) {\r\nprintk(KERN_ERR "HP-PB: Unable to allocate memory.\n");\r\nreturn 1;\r\n}\r\ncard = card->next;\r\n}\r\nprintk(KERN_INFO "Found GeckoBoa at 0x%llx\n",\r\n(unsigned long long) dev->hpa.start);\r\ncard->hpa = dev->hpa.start;\r\ncard->mmio_region.name = "HP-PB Bus";\r\ncard->mmio_region.flags = IORESOURCE_MEM;\r\ncard->mmio_region.start = gsc_readl(dev->hpa.start + IO_IO_LOW);\r\ncard->mmio_region.end = gsc_readl(dev->hpa.start + IO_IO_HIGH) - 1;\r\nstatus = ccio_request_resource(dev, &card->mmio_region);\r\nif(status < 0) {\r\nprintk(KERN_ERR "%s: failed to claim HP-PB bus space (%pR)\n",\r\n__FILE__, &card->mmio_region);\r\n}\r\nreturn 0;\r\n}\r\nvoid __init hppb_init(void)\r\n{\r\nregister_parisc_driver(&hppb_driver);\r\n}
