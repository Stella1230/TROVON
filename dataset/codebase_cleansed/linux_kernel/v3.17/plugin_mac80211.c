static void print_string(struct trace_seq *s, struct event_format *event,\r\nconst char *name, const void *data)\r\n{\r\nstruct format_field *f = pevent_find_field(event, name);\r\nint offset;\r\nint length;\r\nif (!f) {\r\ntrace_seq_printf(s, "NOTFOUND:%s", name);\r\nreturn;\r\n}\r\noffset = f->offset;\r\nlength = f->size;\r\nif (!strncmp(f->type, "__data_loc", 10)) {\r\nunsigned long long v;\r\nif (pevent_read_number_field(f, data, &v)) {\r\ntrace_seq_printf(s, "invalid_data_loc");\r\nreturn;\r\n}\r\noffset = v & 0xffff;\r\nlength = v >> 16;\r\n}\r\ntrace_seq_printf(s, "%.*s", length, (char *)data + offset);\r\n}\r\nstatic int drv_bss_info_changed(struct trace_seq *s,\r\nstruct pevent_record *record,\r\nstruct event_format *event, void *context)\r\n{\r\nvoid *data = record->data;\r\nprint_string(s, event, "wiphy_name", data);\r\ntrace_seq_printf(s, " vif:");\r\nprint_string(s, event, "vif_name", data);\r\npevent_print_num_field(s, "(%d)", event, "vif_type", record, 1);\r\ntrace_seq_printf(s, "\n%*s", INDENT, "");\r\nSF("assoc"); SP();\r\nSF("aid"); SP();\r\nSF("cts"); SP();\r\nSF("shortpre"); SP();\r\nSF("shortslot"); SP();\r\nSF("dtimper"); SP();\r\ntrace_seq_printf(s, "\n%*s", INDENT, "");\r\nSF("bcnint"); SP();\r\nSFX("assoc_cap"); SP();\r\nSFX("basic_rates"); SP();\r\nSF("enable_beacon");\r\ntrace_seq_printf(s, "\n%*s", INDENT, "");\r\nSF("ht_operation_mode");\r\nreturn 0;\r\n}\r\nint PEVENT_PLUGIN_LOADER(struct pevent *pevent)\r\n{\r\npevent_register_event_handler(pevent, -1, "mac80211",\r\n"drv_bss_info_changed",\r\ndrv_bss_info_changed, NULL);\r\nreturn 0;\r\n}\r\nvoid PEVENT_PLUGIN_UNLOADER(struct pevent *pevent)\r\n{\r\npevent_unregister_event_handler(pevent, -1, "mac80211",\r\n"drv_bss_info_changed",\r\ndrv_bss_info_changed, NULL);\r\n}
