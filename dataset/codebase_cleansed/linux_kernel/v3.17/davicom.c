static int dm9161_config_intr(struct phy_device *phydev)\r\n{\r\nint temp;\r\ntemp = phy_read(phydev, MII_DM9161_INTR);\r\nif (temp < 0)\r\nreturn temp;\r\nif (PHY_INTERRUPT_ENABLED == phydev->interrupts)\r\ntemp &= ~(MII_DM9161_INTR_STOP);\r\nelse\r\ntemp |= MII_DM9161_INTR_STOP;\r\ntemp = phy_write(phydev, MII_DM9161_INTR, temp);\r\nreturn temp;\r\n}\r\nstatic int dm9161_config_aneg(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_BMCR, BMCR_ISOLATE);\r\nif (err < 0)\r\nreturn err;\r\nerr = genphy_config_aneg(phydev);\r\nif (err < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int dm9161_config_init(struct phy_device *phydev)\r\n{\r\nint err, temp;\r\nerr = phy_write(phydev, MII_BMCR, BMCR_ISOLATE);\r\nif (err < 0)\r\nreturn err;\r\nswitch (phydev->interface) {\r\ncase PHY_INTERFACE_MODE_MII:\r\ntemp = MII_DM9161_SCR_INIT;\r\nbreak;\r\ncase PHY_INTERFACE_MODE_RMII:\r\ntemp = MII_DM9161_SCR_INIT | MII_DM9161_SCR_RMII;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nerr = phy_write(phydev, MII_DM9161_SCR, temp);\r\nif (err < 0)\r\nreturn err;\r\nerr = phy_write(phydev, MII_DM9161_10BTCSR, MII_DM9161_10BTCSR_INIT);\r\nif (err < 0)\r\nreturn err;\r\nreturn phy_write(phydev, MII_BMCR, BMCR_ANENABLE);\r\n}\r\nstatic int dm9161_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err = phy_read(phydev, MII_DM9161_INTR);\r\nreturn (err < 0) ? err : 0;\r\n}\r\nstatic int __init davicom_init(void)\r\n{\r\nreturn phy_drivers_register(dm91xx_driver,\r\nARRAY_SIZE(dm91xx_driver));\r\n}\r\nstatic void __exit davicom_exit(void)\r\n{\r\nphy_drivers_unregister(dm91xx_driver,\r\nARRAY_SIZE(dm91xx_driver));\r\n}
