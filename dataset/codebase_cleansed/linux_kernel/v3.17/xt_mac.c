static bool mac_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nconst struct xt_mac_info *info = par->matchinfo;\r\nbool ret;\r\nif (skb->dev == NULL || skb->dev->type != ARPHRD_ETHER)\r\nreturn false;\r\nif (skb_mac_header(skb) < skb->head)\r\nreturn false;\r\nif (skb_mac_header(skb) + ETH_HLEN > skb->data)\r\nreturn false;\r\nret = ether_addr_equal(eth_hdr(skb)->h_source, info->srcaddr);\r\nret ^= info->invert;\r\nreturn ret;\r\n}\r\nstatic int __init mac_mt_init(void)\r\n{\r\nreturn xt_register_match(&mac_mt_reg);\r\n}\r\nstatic void __exit mac_mt_exit(void)\r\n{\r\nxt_unregister_match(&mac_mt_reg);\r\n}
