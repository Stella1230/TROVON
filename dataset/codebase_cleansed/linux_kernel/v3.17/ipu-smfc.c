int ipu_smfc_set_burstsize(struct ipu_soc *ipu, int channel, int burstsize)\r\n{\r\nstruct ipu_smfc_priv *smfc = ipu->smfc_priv;\r\nunsigned long flags;\r\nu32 val, shift;\r\nspin_lock_irqsave(&smfc->lock, flags);\r\nshift = channel * 4;\r\nval = readl(smfc->base + SMFC_BS);\r\nval &= ~(0xf << shift);\r\nval |= burstsize << shift;\r\nwritel(val, smfc->base + SMFC_BS);\r\nspin_unlock_irqrestore(&smfc->lock, flags);\r\nreturn 0;\r\n}\r\nint ipu_smfc_map_channel(struct ipu_soc *ipu, int channel, int csi_id, int mipi_id)\r\n{\r\nstruct ipu_smfc_priv *smfc = ipu->smfc_priv;\r\nunsigned long flags;\r\nu32 val, shift;\r\nspin_lock_irqsave(&smfc->lock, flags);\r\nshift = channel * 3;\r\nval = readl(smfc->base + SMFC_MAP);\r\nval &= ~(0x7 << shift);\r\nval |= ((csi_id << 2) | mipi_id) << shift;\r\nwritel(val, smfc->base + SMFC_MAP);\r\nspin_unlock_irqrestore(&smfc->lock, flags);\r\nreturn 0;\r\n}\r\nint ipu_smfc_init(struct ipu_soc *ipu, struct device *dev,\r\nunsigned long base)\r\n{\r\nstruct ipu_smfc_priv *smfc;\r\nsmfc = devm_kzalloc(dev, sizeof(*smfc), GFP_KERNEL);\r\nif (!smfc)\r\nreturn -ENOMEM;\r\nipu->smfc_priv = smfc;\r\nspin_lock_init(&smfc->lock);\r\nsmfc->base = devm_ioremap(dev, base, PAGE_SIZE);\r\nif (!smfc->base)\r\nreturn -ENOMEM;\r\npr_debug("%s: ioremap 0x%08lx -> %p\n", __func__, base, smfc->base);\r\nreturn 0;\r\n}\r\nvoid ipu_smfc_exit(struct ipu_soc *ipu)\r\n{\r\n}
