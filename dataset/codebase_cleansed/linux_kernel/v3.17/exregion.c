acpi_status\r\nacpi_ex_system_memory_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nacpi_status status = AE_OK;\r\nvoid *logical_addr_ptr = NULL;\r\nstruct acpi_mem_space_context *mem_info = region_context;\r\nu32 length;\r\nacpi_size map_length;\r\nacpi_size page_boundary_map_length;\r\n#ifdef ACPI_MISALIGNMENT_NOT_SUPPORTED\r\nu32 remainder;\r\n#endif\r\nACPI_FUNCTION_TRACE(ex_system_memory_space_handler);\r\nswitch (bit_width) {\r\ncase 8:\r\nlength = 1;\r\nbreak;\r\ncase 16:\r\nlength = 2;\r\nbreak;\r\ncase 32:\r\nlength = 4;\r\nbreak;\r\ncase 64:\r\nlength = 8;\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Invalid SystemMemory width %u",\r\nbit_width));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_VALUE);\r\n}\r\n#ifdef ACPI_MISALIGNMENT_NOT_SUPPORTED\r\n(void)acpi_ut_short_divide((u64) address, length, NULL, &remainder);\r\nif (remainder != 0) {\r\nreturn_ACPI_STATUS(AE_AML_ALIGNMENT);\r\n}\r\n#endif\r\nif ((address < mem_info->mapped_physical_address) ||\r\n(((u64) address + length) > ((u64)\r\nmem_info->mapped_physical_address +\r\nmem_info->mapped_length))) {\r\nif (mem_info->mapped_length) {\r\nacpi_os_unmap_memory(mem_info->mapped_logical_address,\r\nmem_info->mapped_length);\r\n}\r\nmap_length = (acpi_size)\r\n((mem_info->address + mem_info->length) - address);\r\npage_boundary_map_length =\r\nACPI_ROUND_UP(address, ACPI_DEFAULT_PAGE_SIZE) - address;\r\nif (page_boundary_map_length == 0) {\r\npage_boundary_map_length = ACPI_DEFAULT_PAGE_SIZE;\r\n}\r\nif (map_length > page_boundary_map_length) {\r\nmap_length = page_boundary_map_length;\r\n}\r\nmem_info->mapped_logical_address = acpi_os_map_memory((acpi_physical_address) address, map_length);\r\nif (!mem_info->mapped_logical_address) {\r\nACPI_ERROR((AE_INFO,\r\n"Could not map memory at 0x%8.8X%8.8X, size %u",\r\nACPI_FORMAT_NATIVE_UINT(address),\r\n(u32) map_length));\r\nmem_info->mapped_length = 0;\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\nmem_info->mapped_physical_address = address;\r\nmem_info->mapped_length = map_length;\r\n}\r\nlogical_addr_ptr = mem_info->mapped_logical_address +\r\n((u64) address - (u64) mem_info->mapped_physical_address);\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"System-Memory (width %u) R/W %u Address=%8.8X%8.8X\n",\r\nbit_width, function,\r\nACPI_FORMAT_NATIVE_UINT(address)));\r\nswitch (function) {\r\ncase ACPI_READ:\r\n*value = 0;\r\nswitch (bit_width) {\r\ncase 8:\r\n*value = (u64)ACPI_GET8(logical_addr_ptr);\r\nbreak;\r\ncase 16:\r\n*value = (u64)ACPI_GET16(logical_addr_ptr);\r\nbreak;\r\ncase 32:\r\n*value = (u64)ACPI_GET32(logical_addr_ptr);\r\nbreak;\r\ncase 64:\r\n*value = (u64)ACPI_GET64(logical_addr_ptr);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_WRITE:\r\nswitch (bit_width) {\r\ncase 8:\r\nACPI_SET8(logical_addr_ptr, *value);\r\nbreak;\r\ncase 16:\r\nACPI_SET16(logical_addr_ptr, *value);\r\nbreak;\r\ncase 32:\r\nACPI_SET32(logical_addr_ptr, *value);\r\nbreak;\r\ncase 64:\r\nACPI_SET64(logical_addr_ptr, *value);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nstatus = AE_BAD_PARAMETER;\r\nbreak;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_system_io_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nacpi_status status = AE_OK;\r\nu32 value32;\r\nACPI_FUNCTION_TRACE(ex_system_io_space_handler);\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"System-IO (width %u) R/W %u Address=%8.8X%8.8X\n",\r\nbit_width, function,\r\nACPI_FORMAT_NATIVE_UINT(address)));\r\nswitch (function) {\r\ncase ACPI_READ:\r\nstatus = acpi_hw_read_port((acpi_io_address) address,\r\n&value32, bit_width);\r\n*value = value32;\r\nbreak;\r\ncase ACPI_WRITE:\r\nstatus = acpi_hw_write_port((acpi_io_address) address,\r\n(u32) * value, bit_width);\r\nbreak;\r\ndefault:\r\nstatus = AE_BAD_PARAMETER;\r\nbreak;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_pci_config_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nacpi_status status = AE_OK;\r\nstruct acpi_pci_id *pci_id;\r\nu16 pci_register;\r\nACPI_FUNCTION_TRACE(ex_pci_config_space_handler);\r\npci_id = (struct acpi_pci_id *)region_context;\r\npci_register = (u16) (u32) address;\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"Pci-Config %u (%u) Seg(%04x) Bus(%04x) Dev(%04x) Func(%04x) Reg(%04x)\n",\r\nfunction, bit_width, pci_id->segment, pci_id->bus,\r\npci_id->device, pci_id->function, pci_register));\r\nswitch (function) {\r\ncase ACPI_READ:\r\n*value = 0;\r\nstatus = acpi_os_read_pci_configuration(pci_id, pci_register,\r\nvalue, bit_width);\r\nbreak;\r\ncase ACPI_WRITE:\r\nstatus = acpi_os_write_pci_configuration(pci_id, pci_register,\r\n*value, bit_width);\r\nbreak;\r\ndefault:\r\nstatus = AE_BAD_PARAMETER;\r\nbreak;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_cmos_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(ex_cmos_space_handler);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_pci_bar_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE(ex_pci_bar_space_handler);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ex_data_table_space_handler(u32 function,\r\nacpi_physical_address address,\r\nu32 bit_width,\r\nu64 *value,\r\nvoid *handler_context, void *region_context)\r\n{\r\nACPI_FUNCTION_TRACE(ex_data_table_space_handler);\r\nswitch (function) {\r\ncase ACPI_READ:\r\nACPI_MEMCPY(ACPI_CAST_PTR(char, value),\r\nACPI_PHYSADDR_TO_PTR(address),\r\nACPI_DIV_8(bit_width));\r\nbreak;\r\ncase ACPI_WRITE:\r\nACPI_MEMCPY(ACPI_PHYSADDR_TO_PTR(address),\r\nACPI_CAST_PTR(char, value), ACPI_DIV_8(bit_width));\r\nbreak;\r\ndefault:\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nreturn_ACPI_STATUS(AE_OK);\r\n}
