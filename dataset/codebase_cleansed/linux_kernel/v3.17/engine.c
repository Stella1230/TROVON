int\r\nnouveau_engine_create_(struct nouveau_object *parent,\r\nstruct nouveau_object *engobj,\r\nstruct nouveau_oclass *oclass, bool enable,\r\nconst char *iname, const char *fname,\r\nint length, void **pobject)\r\n{\r\nstruct nouveau_engine *engine;\r\nint ret;\r\nret = nouveau_subdev_create_(parent, engobj, oclass, NV_ENGINE_CLASS,\r\niname, fname, length, pobject);\r\nengine = *pobject;\r\nif (ret)\r\nreturn ret;\r\nif (parent) {\r\nstruct nouveau_device *device = nv_device(parent);\r\nint engidx = nv_engidx(nv_object(engine));\r\nif (device->disable_mask & (1ULL << engidx)) {\r\nif (!nouveau_boolopt(device->cfgopt, iname, false)) {\r\nnv_debug(engine, "engine disabled by hw/fw\n");\r\nreturn -ENODEV;\r\n}\r\nnv_warn(engine, "ignoring hw/fw engine disable\n");\r\n}\r\nif (!nouveau_boolopt(device->cfgopt, iname, enable)) {\r\nif (!enable)\r\nnv_warn(engine, "disabled, %s=1 to enable\n", iname);\r\nreturn -ENODEV;\r\n}\r\n}\r\nINIT_LIST_HEAD(&engine->contexts);\r\nspin_lock_init(&engine->lock);\r\nreturn 0;\r\n}
