struct task_struct *__sched\r\n__switch_to(struct task_struct *prev_task, struct task_struct *next_task)\r\n{\r\nunsigned int tmp;\r\nunsigned int prev = (unsigned int)prev_task;\r\nunsigned int next = (unsigned int)next_task;\r\n__asm__ __volatile__(\r\n"st.a r13, [sp, -4] \n\t"\r\n"st.a r14, [sp, -4] \n\t"\r\n"st.a r15, [sp, -4] \n\t"\r\n"st.a r16, [sp, -4] \n\t"\r\n"st.a r17, [sp, -4] \n\t"\r\n"st.a r18, [sp, -4] \n\t"\r\n"st.a r19, [sp, -4] \n\t"\r\n"st.a r20, [sp, -4] \n\t"\r\n"st.a r21, [sp, -4] \n\t"\r\n"st.a r22, [sp, -4] \n\t"\r\n"st.a r23, [sp, -4] \n\t"\r\n"st.a r24, [sp, -4] \n\t"\r\n#ifndef CONFIG_ARC_CURR_IN_REG\r\n"st.a r25, [sp, -4] \n\t"\r\n#else\r\n"sub sp, sp, 4 \n\t"\r\n#endif\r\n#if KSP_WORD_OFF <= 255\r\n"st.as sp, [%3, %1] \n\t"\r\n#else\r\n"add2 r24, %3, %1 \n\t"\r\n"st sp, [r24] \n\t"\r\n#endif\r\n"sync \n\t"\r\n#ifndef CONFIG_SMP\r\n"st %2, [@_current_task] \n\t"\r\n#else\r\n"lr r24, [identity] \n\t"\r\n"lsr r24, r24, 8 \n\t"\r\n"bmsk r24, r24, 7 \n\t"\r\n"add2 r24, @_current_task, r24 \n\t"\r\n"st %2, [r24] \n\t"\r\n#endif\r\n#ifdef CONFIG_ARC_CURR_IN_REG\r\n"mov r25, %2 \n\t"\r\n#endif\r\n"ld.as sp, [%2, %1] \n\t"\r\n#ifndef CONFIG_ARC_CURR_IN_REG\r\n"ld.ab r25, [sp, 4] \n\t"\r\n#else\r\n"add sp, sp, 4 \n\t"\r\n#endif\r\n"ld.ab r24, [sp, 4] \n\t"\r\n"ld.ab r23, [sp, 4] \n\t"\r\n"ld.ab r22, [sp, 4] \n\t"\r\n"ld.ab r21, [sp, 4] \n\t"\r\n"ld.ab r20, [sp, 4] \n\t"\r\n"ld.ab r19, [sp, 4] \n\t"\r\n"ld.ab r18, [sp, 4] \n\t"\r\n"ld.ab r17, [sp, 4] \n\t"\r\n"ld.ab r16, [sp, 4] \n\t"\r\n"ld.ab r15, [sp, 4] \n\t"\r\n"ld.ab r14, [sp, 4] \n\t"\r\n"ld.ab r13, [sp, 4] \n\t"\r\n"mov %0, %3 \n\t"\r\n: "=r"(tmp)\r\n: "n"(KSP_WORD_OFF), "r"(next), "r"(prev)\r\n: "blink"\r\n);\r\nreturn (struct task_struct *)tmp;\r\n}
