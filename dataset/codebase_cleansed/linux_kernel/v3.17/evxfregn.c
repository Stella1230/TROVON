acpi_status\r\nacpi_install_address_space_handler(acpi_handle device,\r\nacpi_adr_space_type space_id,\r\nacpi_adr_space_handler handler,\r\nacpi_adr_space_setup setup, void *context)\r\n{\r\nstruct acpi_namespace_node *node;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_install_address_space_handler);\r\nif (!device) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nnode = acpi_ns_validate_handle(device);\r\nif (!node) {\r\nstatus = AE_BAD_PARAMETER;\r\ngoto unlock_and_exit;\r\n}\r\nstatus =\r\nacpi_ev_install_space_handler(node, space_id, handler, setup,\r\ncontext);\r\nif (ACPI_FAILURE(status)) {\r\ngoto unlock_and_exit;\r\n}\r\nswitch (space_id) {\r\ncase ACPI_ADR_SPACE_SYSTEM_MEMORY:\r\ncase ACPI_ADR_SPACE_SYSTEM_IO:\r\ncase ACPI_ADR_SPACE_PCI_CONFIG:\r\ncase ACPI_ADR_SPACE_DATA_TABLE:\r\nif (!acpi_gbl_reg_methods_executed) {\r\ngoto unlock_and_exit;\r\n}\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nstatus = acpi_ev_execute_reg_methods(node, space_id);\r\nunlock_and_exit:\r\n(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_remove_address_space_handler(acpi_handle device,\r\nacpi_adr_space_type space_id,\r\nacpi_adr_space_handler handler)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nunion acpi_operand_object *handler_obj;\r\nunion acpi_operand_object *region_obj;\r\nunion acpi_operand_object **last_obj_ptr;\r\nstruct acpi_namespace_node *node;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(acpi_remove_address_space_handler);\r\nif (!device) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nnode = acpi_ns_validate_handle(device);\r\nif (!node ||\r\n((node->type != ACPI_TYPE_DEVICE) &&\r\n(node->type != ACPI_TYPE_PROCESSOR) &&\r\n(node->type != ACPI_TYPE_THERMAL) &&\r\n(node != acpi_gbl_root_node))) {\r\nstatus = AE_BAD_PARAMETER;\r\ngoto unlock_and_exit;\r\n}\r\nobj_desc = acpi_ns_get_attached_object(node);\r\nif (!obj_desc) {\r\nstatus = AE_NOT_EXIST;\r\ngoto unlock_and_exit;\r\n}\r\nhandler_obj = obj_desc->device.handler;\r\nlast_obj_ptr = &obj_desc->device.handler;\r\nwhile (handler_obj) {\r\nif (handler_obj->address_space.space_id == space_id) {\r\nif (handler_obj->address_space.handler != handler) {\r\nstatus = AE_BAD_PARAMETER;\r\ngoto unlock_and_exit;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_OPREGION,\r\n"Removing address handler %p(%p) for region %s "\r\n"on Device %p(%p)\n",\r\nhandler_obj, handler,\r\nacpi_ut_get_region_name(space_id),\r\nnode, obj_desc));\r\nregion_obj = handler_obj->address_space.region_list;\r\nwhile (region_obj) {\r\nacpi_ev_detach_region(region_obj, TRUE);\r\nregion_obj =\r\nhandler_obj->address_space.region_list;\r\n}\r\n*last_obj_ptr = handler_obj->address_space.next;\r\nacpi_ut_remove_reference(handler_obj);\r\ngoto unlock_and_exit;\r\n}\r\nlast_obj_ptr = &handler_obj->address_space.next;\r\nhandler_obj = handler_obj->address_space.next;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_OPREGION,\r\n"Unable to remove address handler %p for %s(%X), DevNode %p, obj %p\n",\r\nhandler, acpi_ut_get_region_name(space_id), space_id,\r\nnode, obj_desc));\r\nstatus = AE_NOT_EXIST;\r\nunlock_and_exit:\r\n(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\r\nreturn_ACPI_STATUS(status);\r\n}
