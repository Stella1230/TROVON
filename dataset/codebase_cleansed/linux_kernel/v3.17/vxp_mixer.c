static int vx_mic_level_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 1;\r\nuinfo->value.integer.min = 0;\r\nuinfo->value.integer.max = MIC_LEVEL_MAX;\r\nreturn 0;\r\n}\r\nstatic int vx_mic_level_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct vx_core *_chip = snd_kcontrol_chip(kcontrol);\r\nstruct snd_vxpocket *chip = (struct snd_vxpocket *)_chip;\r\nucontrol->value.integer.value[0] = chip->mic_level;\r\nreturn 0;\r\n}\r\nstatic int vx_mic_level_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct vx_core *_chip = snd_kcontrol_chip(kcontrol);\r\nstruct snd_vxpocket *chip = (struct snd_vxpocket *)_chip;\r\nunsigned int val = ucontrol->value.integer.value[0];\r\nif (val > MIC_LEVEL_MAX)\r\nreturn -EINVAL;\r\nmutex_lock(&_chip->mixer_mutex);\r\nif (chip->mic_level != ucontrol->value.integer.value[0]) {\r\nvx_set_mic_level(_chip, ucontrol->value.integer.value[0]);\r\nchip->mic_level = ucontrol->value.integer.value[0];\r\nmutex_unlock(&_chip->mixer_mutex);\r\nreturn 1;\r\n}\r\nmutex_unlock(&_chip->mixer_mutex);\r\nreturn 0;\r\n}\r\nstatic int vx_mic_boost_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct vx_core *_chip = snd_kcontrol_chip(kcontrol);\r\nstruct snd_vxpocket *chip = (struct snd_vxpocket *)_chip;\r\nucontrol->value.integer.value[0] = chip->mic_level;\r\nreturn 0;\r\n}\r\nstatic int vx_mic_boost_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct vx_core *_chip = snd_kcontrol_chip(kcontrol);\r\nstruct snd_vxpocket *chip = (struct snd_vxpocket *)_chip;\r\nint val = !!ucontrol->value.integer.value[0];\r\nmutex_lock(&_chip->mixer_mutex);\r\nif (chip->mic_level != val) {\r\nvx_set_mic_boost(_chip, val);\r\nchip->mic_level = val;\r\nmutex_unlock(&_chip->mixer_mutex);\r\nreturn 1;\r\n}\r\nmutex_unlock(&_chip->mixer_mutex);\r\nreturn 0;\r\n}\r\nint vxp_add_mic_controls(struct vx_core *_chip)\r\n{\r\nstruct snd_vxpocket *chip = (struct snd_vxpocket *)_chip;\r\nint err;\r\nchip->mic_level = 0;\r\nswitch (_chip->type) {\r\ncase VX_TYPE_VXPOCKET:\r\nvx_set_mic_level(_chip, 0);\r\nbreak;\r\ncase VX_TYPE_VXP440:\r\nvx_set_mic_boost(_chip, 0);\r\nbreak;\r\n}\r\nswitch (_chip->type) {\r\ncase VX_TYPE_VXPOCKET:\r\nif ((err = snd_ctl_add(_chip->card, snd_ctl_new1(&vx_control_mic_level, chip))) < 0)\r\nreturn err;\r\nbreak;\r\ncase VX_TYPE_VXP440:\r\nif ((err = snd_ctl_add(_chip->card, snd_ctl_new1(&vx_control_mic_boost, chip))) < 0)\r\nreturn err;\r\nbreak;\r\n}\r\nreturn 0;\r\n}
