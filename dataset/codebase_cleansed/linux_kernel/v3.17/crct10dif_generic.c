static int chksum_init(struct shash_desc *desc)\r\n{\r\nstruct chksum_desc_ctx *ctx = shash_desc_ctx(desc);\r\nctx->crc = 0;\r\nreturn 0;\r\n}\r\nstatic int chksum_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int length)\r\n{\r\nstruct chksum_desc_ctx *ctx = shash_desc_ctx(desc);\r\nctx->crc = crc_t10dif_generic(ctx->crc, data, length);\r\nreturn 0;\r\n}\r\nstatic int chksum_final(struct shash_desc *desc, u8 *out)\r\n{\r\nstruct chksum_desc_ctx *ctx = shash_desc_ctx(desc);\r\n*(__u16 *)out = ctx->crc;\r\nreturn 0;\r\n}\r\nstatic int __chksum_finup(__u16 *crcp, const u8 *data, unsigned int len,\r\nu8 *out)\r\n{\r\n*(__u16 *)out = crc_t10dif_generic(*crcp, data, len);\r\nreturn 0;\r\n}\r\nstatic int chksum_finup(struct shash_desc *desc, const u8 *data,\r\nunsigned int len, u8 *out)\r\n{\r\nstruct chksum_desc_ctx *ctx = shash_desc_ctx(desc);\r\nreturn __chksum_finup(&ctx->crc, data, len, out);\r\n}\r\nstatic int chksum_digest(struct shash_desc *desc, const u8 *data,\r\nunsigned int length, u8 *out)\r\n{\r\nstruct chksum_desc_ctx *ctx = shash_desc_ctx(desc);\r\nreturn __chksum_finup(&ctx->crc, data, length, out);\r\n}\r\nstatic int __init crct10dif_mod_init(void)\r\n{\r\nint ret;\r\nret = crypto_register_shash(&alg);\r\nreturn ret;\r\n}\r\nstatic void __exit crct10dif_mod_fini(void)\r\n{\r\ncrypto_unregister_shash(&alg);\r\n}
