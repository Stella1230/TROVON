int nfs4_get_rootfh(struct nfs_server *server, struct nfs_fh *mntfh, bool auth_probe)\r\n{\r\nstruct nfs_fsinfo fsinfo;\r\nint ret = -ENOMEM;\r\ndprintk("--> nfs4_get_rootfh()\n");\r\nfsinfo.fattr = nfs_alloc_fattr();\r\nif (fsinfo.fattr == NULL)\r\ngoto out;\r\nret = nfs4_proc_get_rootfh(server, mntfh, &fsinfo, auth_probe);\r\nif (ret < 0) {\r\ndprintk("nfs4_get_rootfh: getroot error = %d\n", -ret);\r\ngoto out;\r\n}\r\nif (!(fsinfo.fattr->valid & NFS_ATTR_FATTR_TYPE)\r\n|| !S_ISDIR(fsinfo.fattr->mode)) {\r\nprintk(KERN_ERR "nfs4_get_rootfh:"\r\n" getroot encountered non-directory\n");\r\nret = -ENOTDIR;\r\ngoto out;\r\n}\r\nif (fsinfo.fattr->valid & NFS_ATTR_FATTR_V4_REFERRAL) {\r\nprintk(KERN_ERR "nfs4_get_rootfh:"\r\n" getroot obtained referral\n");\r\nret = -EREMOTE;\r\ngoto out;\r\n}\r\nmemcpy(&server->fsid, &fsinfo.fattr->fsid, sizeof(server->fsid));\r\nout:\r\nnfs_free_fattr(fsinfo.fattr);\r\ndprintk("<-- nfs4_get_rootfh() = %d\n", ret);\r\nreturn ret;\r\n}
