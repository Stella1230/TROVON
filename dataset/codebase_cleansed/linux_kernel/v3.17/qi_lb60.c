static int qi_lb60_spk_event(struct snd_soc_dapm_widget *widget,\r\nstruct snd_kcontrol *ctrl, int event)\r\n{\r\nstruct qi_lb60 *qi_lb60 = snd_soc_card_get_drvdata(widget->dapm->card);\r\nint on = !SND_SOC_DAPM_EVENT_OFF(event);\r\ngpiod_set_value_cansleep(qi_lb60->snd_gpio, on);\r\ngpiod_set_value_cansleep(qi_lb60->amp_gpio, on);\r\nreturn 0;\r\n}\r\nstatic int qi_lb60_probe(struct platform_device *pdev)\r\n{\r\nstruct qi_lb60 *qi_lb60;\r\nstruct snd_soc_card *card = &qi_lb60_card;\r\nint ret;\r\nqi_lb60 = devm_kzalloc(&pdev->dev, sizeof(*qi_lb60), GFP_KERNEL);\r\nif (!qi_lb60)\r\nreturn -ENOMEM;\r\nqi_lb60->snd_gpio = devm_gpiod_get(&pdev->dev, "snd");\r\nif (IS_ERR(qi_lb60->snd_gpio))\r\nreturn PTR_ERR(qi_lb60->snd_gpio);\r\nret = gpiod_direction_output(qi_lb60->snd_gpio, 0);\r\nif (ret)\r\nreturn ret;\r\nqi_lb60->amp_gpio = devm_gpiod_get(&pdev->dev, "amp");\r\nif (IS_ERR(qi_lb60->amp_gpio))\r\nreturn PTR_ERR(qi_lb60->amp_gpio);\r\nret = gpiod_direction_output(qi_lb60->amp_gpio, 0);\r\nif (ret)\r\nreturn ret;\r\ncard->dev = &pdev->dev;\r\nsnd_soc_card_set_drvdata(card, qi_lb60);\r\nreturn devm_snd_soc_register_card(&pdev->dev, card);\r\n}
