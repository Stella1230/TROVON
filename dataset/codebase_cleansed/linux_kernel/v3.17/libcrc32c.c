u32 crc32c(u32 crc, const void *address, unsigned int length)\r\n{\r\nstruct {\r\nstruct shash_desc shash;\r\nchar ctx[crypto_shash_descsize(tfm)];\r\n} desc;\r\nint err;\r\ndesc.shash.tfm = tfm;\r\ndesc.shash.flags = 0;\r\n*(u32 *)desc.ctx = crc;\r\nerr = crypto_shash_update(&desc.shash, address, length);\r\nBUG_ON(err);\r\nreturn *(u32 *)desc.ctx;\r\n}\r\nstatic int __init libcrc32c_mod_init(void)\r\n{\r\ntfm = crypto_alloc_shash("crc32c", 0, 0);\r\nreturn PTR_ERR_OR_ZERO(tfm);\r\n}\r\nstatic void __exit libcrc32c_mod_fini(void)\r\n{\r\ncrypto_free_shash(tfm);\r\n}
