static int toonie_dev_register(struct snd_device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int toonie_usable(struct codec_info_item *cii,\r\nstruct transfer_info *ti,\r\nstruct transfer_info *out)\r\n{\r\nreturn 1;\r\n}\r\nstatic int toonie_suspend(struct codec_info_item *cii, pm_message_t state)\r\n{\r\nreturn 0;\r\n}\r\nstatic int toonie_resume(struct codec_info_item *cii)\r\n{\r\nreturn 0;\r\n}\r\nstatic int toonie_init_codec(struct aoa_codec *codec)\r\n{\r\nstruct toonie *toonie = codec_to_toonie(codec);\r\nif (toonie->codec.connected != 1)\r\nreturn -ENOTCONN;\r\nif (aoa_snd_device_new(SNDRV_DEV_CODEC, toonie, &ops)) {\r\nprintk(KERN_ERR PFX "failed to create toonie snd device!\n");\r\nreturn -ENODEV;\r\n}\r\nif (toonie->codec.soundbus_dev->attach_codec(toonie->codec.soundbus_dev,\r\naoa_get_card(),\r\n&toonie_codec_info, toonie)) {\r\nprintk(KERN_ERR PFX "error creating toonie pcm\n");\r\nsnd_device_free(aoa_get_card(), toonie);\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic void toonie_exit_codec(struct aoa_codec *codec)\r\n{\r\nstruct toonie *toonie = codec_to_toonie(codec);\r\nif (!toonie->codec.soundbus_dev) {\r\nprintk(KERN_ERR PFX "toonie_exit_codec called without soundbus_dev!\n");\r\nreturn;\r\n}\r\ntoonie->codec.soundbus_dev->detach_codec(toonie->codec.soundbus_dev, toonie);\r\n}\r\nstatic int __init toonie_init(void)\r\n{\r\ntoonie = kzalloc(sizeof(struct toonie), GFP_KERNEL);\r\nif (!toonie)\r\nreturn -ENOMEM;\r\nstrlcpy(toonie->codec.name, "toonie", sizeof(toonie->codec.name));\r\ntoonie->codec.owner = THIS_MODULE;\r\ntoonie->codec.init = toonie_init_codec;\r\ntoonie->codec.exit = toonie_exit_codec;\r\nif (aoa_codec_register(&toonie->codec)) {\r\nkfree(toonie);\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit toonie_exit(void)\r\n{\r\naoa_codec_unregister(&toonie->codec);\r\nkfree(toonie);\r\n}
