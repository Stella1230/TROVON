static void devm_component_release(struct device *dev, void *res)\r\n{\r\nsnd_soc_unregister_component(*(struct device **)res);\r\n}\r\nint devm_snd_soc_register_component(struct device *dev,\r\nconst struct snd_soc_component_driver *cmpnt_drv,\r\nstruct snd_soc_dai_driver *dai_drv, int num_dai)\r\n{\r\nstruct device **ptr;\r\nint ret;\r\nptr = devres_alloc(devm_component_release, sizeof(*ptr), GFP_KERNEL);\r\nif (!ptr)\r\nreturn -ENOMEM;\r\nret = snd_soc_register_component(dev, cmpnt_drv, dai_drv, num_dai);\r\nif (ret == 0) {\r\n*ptr = dev;\r\ndevres_add(dev, ptr);\r\n} else {\r\ndevres_free(ptr);\r\n}\r\nreturn ret;\r\n}\r\nstatic void devm_platform_release(struct device *dev, void *res)\r\n{\r\nsnd_soc_unregister_platform(*(struct device **)res);\r\n}\r\nint devm_snd_soc_register_platform(struct device *dev,\r\nconst struct snd_soc_platform_driver *platform_drv)\r\n{\r\nstruct device **ptr;\r\nint ret;\r\nptr = devres_alloc(devm_platform_release, sizeof(*ptr), GFP_KERNEL);\r\nif (!ptr)\r\nreturn -ENOMEM;\r\nret = snd_soc_register_platform(dev, platform_drv);\r\nif (ret == 0) {\r\n*ptr = dev;\r\ndevres_add(dev, ptr);\r\n} else {\r\ndevres_free(ptr);\r\n}\r\nreturn ret;\r\n}\r\nstatic void devm_card_release(struct device *dev, void *res)\r\n{\r\nsnd_soc_unregister_card(*(struct snd_soc_card **)res);\r\n}\r\nint devm_snd_soc_register_card(struct device *dev, struct snd_soc_card *card)\r\n{\r\nstruct snd_soc_card **ptr;\r\nint ret;\r\nptr = devres_alloc(devm_card_release, sizeof(*ptr), GFP_KERNEL);\r\nif (!ptr)\r\nreturn -ENOMEM;\r\nret = snd_soc_register_card(card);\r\nif (ret == 0) {\r\n*ptr = card;\r\ndevres_add(dev, ptr);\r\n} else {\r\ndevres_free(ptr);\r\n}\r\nreturn ret;\r\n}\r\nstatic void devm_dmaengine_pcm_release(struct device *dev, void *res)\r\n{\r\nsnd_dmaengine_pcm_unregister(*(struct device **)res);\r\n}\r\nint devm_snd_dmaengine_pcm_register(struct device *dev,\r\nconst struct snd_dmaengine_pcm_config *config, unsigned int flags)\r\n{\r\nstruct device **ptr;\r\nint ret;\r\nptr = devres_alloc(devm_dmaengine_pcm_release, sizeof(*ptr), GFP_KERNEL);\r\nif (!ptr)\r\nreturn -ENOMEM;\r\nret = snd_dmaengine_pcm_register(dev, config, flags);\r\nif (ret == 0) {\r\n*ptr = dev;\r\ndevres_add(dev, ptr);\r\n} else {\r\ndevres_free(ptr);\r\n}\r\nreturn ret;\r\n}
