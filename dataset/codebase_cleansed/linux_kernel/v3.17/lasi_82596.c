static inline void ca(struct net_device *dev)\r\n{\r\ngsc_writel(0, dev->base_addr + PA_CHANNEL_ATTENTION);\r\n}\r\nstatic void mpu_port(struct net_device *dev, int c, dma_addr_t x)\r\n{\r\nstruct i596_private *lp = netdev_priv(dev);\r\nu32 v = (u32) (c) | (u32) (x);\r\nu16 a, b;\r\nif (lp->options & OPT_SWAP_PORT) {\r\na = v >> 16;\r\nb = v & 0xffff;\r\n} else {\r\na = v & 0xffff;\r\nb = v >> 16;\r\n}\r\ngsc_writel(a, dev->base_addr + PA_CPU_PORT_L_ACCESS);\r\nudelay(1);\r\ngsc_writel(b, dev->base_addr + PA_CPU_PORT_L_ACCESS);\r\n}\r\nstatic int\r\nlan_init_chip(struct parisc_device *dev)\r\n{\r\nstruct net_device *netdevice;\r\nstruct i596_private *lp;\r\nint retval;\r\nint i;\r\nif (!dev->irq) {\r\nprintk(KERN_ERR "%s: IRQ not found for i82596 at 0x%lx\n",\r\n__FILE__, (unsigned long)dev->hpa.start);\r\nreturn -ENODEV;\r\n}\r\nprintk(KERN_INFO "Found i82596 at 0x%lx, IRQ %d\n",\r\n(unsigned long)dev->hpa.start, dev->irq);\r\nnetdevice = alloc_etherdev(sizeof(struct i596_private));\r\nif (!netdevice)\r\nreturn -ENOMEM;\r\nSET_NETDEV_DEV(netdevice, &dev->dev);\r\nparisc_set_drvdata (dev, netdevice);\r\nnetdevice->base_addr = dev->hpa.start;\r\nnetdevice->irq = dev->irq;\r\nif (pdc_lan_station_id(netdevice->dev_addr, netdevice->base_addr)) {\r\nfor (i = 0; i < 6; i++) {\r\nnetdevice->dev_addr[i] = gsc_readb(LAN_PROM_ADDR + i);\r\n}\r\nprintk(KERN_INFO\r\n"%s: MAC of HP700 LAN read from EEPROM\n", __FILE__);\r\n}\r\nlp = netdev_priv(netdevice);\r\nlp->options = dev->id.sversion == 0x72 ? OPT_SWAP_PORT : 0;\r\nretval = i82596_probe(netdevice);\r\nif (retval) {\r\nfree_netdev(netdevice);\r\nreturn -ENODEV;\r\n}\r\nreturn retval;\r\n}\r\nstatic int lan_remove_chip(struct parisc_device *pdev)\r\n{\r\nstruct net_device *dev = parisc_get_drvdata(pdev);\r\nstruct i596_private *lp = netdev_priv(dev);\r\nunregister_netdev (dev);\r\nDMA_FREE(&pdev->dev, sizeof(struct i596_private),\r\n(void *)lp->dma, lp->dma_addr);\r\nfree_netdev (dev);\r\nreturn 0;\r\n}\r\nstatic int lasi_82596_init(void)\r\n{\r\nprintk(KERN_INFO LASI_82596_DRIVER_VERSION "\n");\r\nreturn register_parisc_driver(&lan_driver);\r\n}\r\nstatic void __exit lasi_82596_exit(void)\r\n{\r\nunregister_parisc_driver(&lan_driver);\r\n}
