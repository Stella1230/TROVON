static void m68vz328_reset(void)\r\n{\r\nlocal_irq_disable();\r\n#ifdef CONFIG_INIT_LCD\r\nPBDATA |= 0x20;\r\nPKDATA |= 0x4;\r\nLCKCON = 0;\r\n#endif\r\n__asm__ __volatile__(\r\n"reset\n\t"\r\n"moveal #0x04000000, %a0\n\t"\r\n"moveal 0(%a0), %sp\n\t"\r\n"moveal 4(%a0), %a0\n\t"\r\n"jmp (%a0)"\r\n);\r\n}\r\nstatic void __init init_hardware(char *command, int size)\r\n{\r\n#ifdef CONFIG_DIRECT_IO_ACCESS\r\nSCR = 0x10;\r\n#endif\r\nCSGBB = 0x4000;\r\nCSB = 0x1a1;\r\nPKSEL |= PK(3);\r\nPKDIR |= PK(3);\r\nPKDATA |= PK(3);\r\nPFSEL |= PF(5);\r\nPFDIR |= PF(5);\r\nPFDATA &= ~PF(5);\r\nPFDATA |= PF(5);\r\n{ int i; for (i = 0; i < 32000; ++i); }\r\nPFDATA &= ~PF(5);\r\nPDPOL &= ~PD(1);\r\nPDIQEG &= ~PD(1);\r\nPDIRQEN |= PD(1);\r\n#ifdef CONFIG_INIT_LCD\r\nLSSA = (long) screen_bits;\r\nLVPW = 0x14;\r\nLXMAX = 0x140;\r\nLYMAX = 0xef;\r\nLRRA = 0;\r\nLPXCD = 3;\r\nLPICF = 0x08;\r\nLPOLCF = 0;\r\nLCKCON = 0x80;\r\nPCPDEN = 0xff;\r\nPCSEL = 0;\r\nPKDIR |= 0x4;\r\nPKSEL |= 0x4;\r\nPKDATA &= ~0x4;\r\nPBDIR |= 0x20;\r\nPBSEL |= 0x20;\r\nPBDATA &= ~0x20;\r\nPFDIR |= 0x1;\r\nPFSEL &= ~0x1;\r\nPWMR = 0x037F;\r\n#endif\r\n}\r\nstatic void m68vz328_reset(void)\r\n{\r\nlocal_irq_disable();\r\nasm volatile (\r\n"moveal #0x10c00000, %a0;\n\t"\r\n"moveb #0, 0xFFFFF300;\n\t"\r\n"moveal 0(%a0), %sp;\n\t"\r\n"moveal 4(%a0), %a0;\n\t"\r\n"jmp (%a0);\n"\r\n);\r\n}\r\nstatic void __init init_hardware(char *command, int size)\r\n{\r\nchar *p;\r\nprintk(KERN_INFO "uCdimm serial string [%s]\n", getserialnum());\r\np = cs8900a_hwaddr = gethwaddr(0);\r\nprintk(KERN_INFO "uCdimm hwaddr %.2x:%.2x:%.2x:%.2x:%.2x:%.2x\n",\r\np[0], p[1], p[2], p[3], p[4], p[5]);\r\np = getbenv("APPEND");\r\nif (p)\r\nstrcpy(p, command);\r\nelse\r\ncommand[0] = 0;\r\n}\r\nstatic void m68vz328_reset(void)\r\n{\r\n}\r\nstatic void __init init_hardware(char *command, int size)\r\n{\r\n}\r\nvoid __init config_BSP(char *command, int size)\r\n{\r\nprintk(KERN_INFO "68VZ328 DragonBallVZ support (c) 2001 Lineo, Inc.\n");\r\ninit_hardware(command, size);\r\nmach_sched_init = hw_timer_init;\r\nmach_hwclk = m68328_hwclk;\r\nmach_reset = m68vz328_reset;\r\n}
