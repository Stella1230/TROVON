static acpi_status\r\nacpi_rs_validate_parameters(acpi_handle device_handle,\r\nstruct acpi_buffer *buffer,\r\nstruct acpi_namespace_node **return_node)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(rs_validate_parameters);\r\nif (!device_handle) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nnode = acpi_ns_validate_handle(device_handle);\r\nif (!node) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nif (node->type != ACPI_TYPE_DEVICE) {\r\nreturn_ACPI_STATUS(AE_TYPE);\r\n}\r\nstatus = acpi_ut_validate_buffer(buffer);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\n*return_node = node;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status\r\nacpi_get_irq_routing_table(acpi_handle device_handle,\r\nstruct acpi_buffer *ret_buffer)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(acpi_get_irq_routing_table);\r\nstatus = acpi_rs_validate_parameters(device_handle, ret_buffer, &node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_rs_get_prt_method_data(node, ret_buffer);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_get_current_resources(acpi_handle device_handle,\r\nstruct acpi_buffer *ret_buffer)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(acpi_get_current_resources);\r\nstatus = acpi_rs_validate_parameters(device_handle, ret_buffer, &node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_rs_get_crs_method_data(node, ret_buffer);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_get_possible_resources(acpi_handle device_handle,\r\nstruct acpi_buffer *ret_buffer)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(acpi_get_possible_resources);\r\nstatus = acpi_rs_validate_parameters(device_handle, ret_buffer, &node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_rs_get_prs_method_data(node, ret_buffer);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_set_current_resources(acpi_handle device_handle,\r\nstruct acpi_buffer *in_buffer)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(acpi_set_current_resources);\r\nif ((!in_buffer) || (!in_buffer->pointer) || (!in_buffer->length)) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nstatus = acpi_rs_validate_parameters(device_handle, in_buffer, &node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_rs_set_srs_method_data(node, in_buffer);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_get_event_resources(acpi_handle device_handle,\r\nstruct acpi_buffer *ret_buffer)\r\n{\r\nacpi_status status;\r\nstruct acpi_namespace_node *node;\r\nACPI_FUNCTION_TRACE(acpi_get_event_resources);\r\nstatus = acpi_rs_validate_parameters(device_handle, ret_buffer, &node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_rs_get_aei_method_data(node, ret_buffer);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_resource_to_address64(struct acpi_resource *resource,\r\nstruct acpi_resource_address64 *out)\r\n{\r\nstruct acpi_resource_address16 *address16;\r\nstruct acpi_resource_address32 *address32;\r\nif (!resource || !out) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nswitch (resource->type) {\r\ncase ACPI_RESOURCE_TYPE_ADDRESS16:\r\naddress16 =\r\nACPI_CAST_PTR(struct acpi_resource_address16,\r\n&resource->data);\r\nACPI_COPY_ADDRESS(out, address16);\r\nbreak;\r\ncase ACPI_RESOURCE_TYPE_ADDRESS32:\r\naddress32 =\r\nACPI_CAST_PTR(struct acpi_resource_address32,\r\n&resource->data);\r\nACPI_COPY_ADDRESS(out, address32);\r\nbreak;\r\ncase ACPI_RESOURCE_TYPE_ADDRESS64:\r\nACPI_MEMCPY(out, &resource->data,\r\nsizeof(struct acpi_resource_address64));\r\nbreak;\r\ndefault:\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_get_vendor_resource(acpi_handle device_handle,\r\nchar *name,\r\nstruct acpi_vendor_uuid * uuid,\r\nstruct acpi_buffer * ret_buffer)\r\n{\r\nstruct acpi_vendor_walk_info info;\r\nacpi_status status;\r\nif (!uuid || !ret_buffer) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\ninfo.uuid = uuid;\r\ninfo.buffer = ret_buffer;\r\ninfo.status = AE_NOT_EXIST;\r\nstatus =\r\nacpi_walk_resources(device_handle, name,\r\nacpi_rs_match_vendor_resource, &info);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nreturn (info.status);\r\n}\r\nstatic acpi_status\r\nacpi_rs_match_vendor_resource(struct acpi_resource *resource, void *context)\r\n{\r\nstruct acpi_vendor_walk_info *info = context;\r\nstruct acpi_resource_vendor_typed *vendor;\r\nstruct acpi_buffer *buffer;\r\nacpi_status status;\r\nif (resource->type != ACPI_RESOURCE_TYPE_VENDOR) {\r\nreturn (AE_OK);\r\n}\r\nvendor = &resource->data.vendor_typed;\r\nif ((vendor->byte_length < (ACPI_UUID_LENGTH + 1)) ||\r\n(vendor->uuid_subtype != info->uuid->subtype) ||\r\n(ACPI_MEMCMP(vendor->uuid, info->uuid->data, ACPI_UUID_LENGTH))) {\r\nreturn (AE_OK);\r\n}\r\nbuffer = info->buffer;\r\nstatus = acpi_ut_initialize_buffer(buffer, resource->length);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nACPI_MEMCPY(buffer->pointer, resource, resource->length);\r\nbuffer->length = resource->length;\r\ninfo->status = AE_OK;\r\nreturn (AE_CTRL_TERMINATE);\r\n}\r\nacpi_status\r\nacpi_walk_resource_buffer(struct acpi_buffer * buffer,\r\nacpi_walk_resource_callback user_function,\r\nvoid *context)\r\n{\r\nacpi_status status = AE_OK;\r\nstruct acpi_resource *resource;\r\nstruct acpi_resource *resource_end;\r\nACPI_FUNCTION_TRACE(acpi_walk_resource_buffer);\r\nif (!buffer || !buffer->pointer || !user_function) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nresource = ACPI_CAST_PTR(struct acpi_resource, buffer->pointer);\r\nresource_end =\r\nACPI_ADD_PTR(struct acpi_resource, buffer->pointer, buffer->length);\r\nwhile (resource < resource_end) {\r\nif (resource->type > ACPI_RESOURCE_TYPE_MAX) {\r\nstatus = AE_AML_INVALID_RESOURCE_TYPE;\r\nbreak;\r\n}\r\nif (!resource->length) {\r\nreturn_ACPI_STATUS(AE_AML_BAD_RESOURCE_LENGTH);\r\n}\r\nstatus = user_function(resource, context);\r\nif (ACPI_FAILURE(status)) {\r\nif (status == AE_CTRL_TERMINATE) {\r\nstatus = AE_OK;\r\n}\r\nbreak;\r\n}\r\nif (resource->type == ACPI_RESOURCE_TYPE_END_TAG) {\r\nbreak;\r\n}\r\nresource = ACPI_NEXT_RESOURCE(resource);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_walk_resources(acpi_handle device_handle,\r\nchar *name,\r\nacpi_walk_resource_callback user_function, void *context)\r\n{\r\nacpi_status status;\r\nstruct acpi_buffer buffer;\r\nACPI_FUNCTION_TRACE(acpi_walk_resources);\r\nif (!device_handle || !user_function || !name ||\r\n(!ACPI_COMPARE_NAME(name, METHOD_NAME__CRS) &&\r\n!ACPI_COMPARE_NAME(name, METHOD_NAME__PRS) &&\r\n!ACPI_COMPARE_NAME(name, METHOD_NAME__AEI))) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\nbuffer.length = ACPI_ALLOCATE_LOCAL_BUFFER;\r\nstatus = acpi_rs_get_method_data(device_handle, name, &buffer);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_walk_resource_buffer(&buffer, user_function, context);\r\nACPI_FREE(buffer.pointer);\r\nreturn_ACPI_STATUS(status);\r\n}
