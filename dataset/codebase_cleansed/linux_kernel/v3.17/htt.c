int ath10k_htt_connect(struct ath10k_htt *htt)\r\n{\r\nstruct ath10k_htc_svc_conn_req conn_req;\r\nstruct ath10k_htc_svc_conn_resp conn_resp;\r\nint status;\r\nmemset(&conn_req, 0, sizeof(conn_req));\r\nmemset(&conn_resp, 0, sizeof(conn_resp));\r\nconn_req.ep_ops.ep_tx_complete = ath10k_htt_htc_tx_complete;\r\nconn_req.ep_ops.ep_rx_complete = ath10k_htt_t2h_msg_handler;\r\nconn_req.service_id = ATH10K_HTC_SVC_ID_HTT_DATA_MSG;\r\nstatus = ath10k_htc_connect_service(&htt->ar->htc, &conn_req,\r\n&conn_resp);\r\nif (status)\r\nreturn status;\r\nhtt->eid = conn_resp.eid;\r\nreturn 0;\r\n}\r\nint ath10k_htt_init(struct ath10k *ar)\r\n{\r\nstruct ath10k_htt *htt = &ar->htt;\r\nhtt->ar = ar;\r\nhtt->max_throughput_mbps = 800;\r\nhtt->prefetch_len =\r\n36 +\r\n4 +\r\n8 +\r\n2;\r\nreturn 0;\r\n}\r\nstatic int ath10k_htt_verify_version(struct ath10k_htt *htt)\r\n{\r\nath10k_dbg(ATH10K_DBG_BOOT, "htt target version %d.%d\n",\r\nhtt->target_version_major, htt->target_version_minor);\r\nif (htt->target_version_major != 2 &&\r\nhtt->target_version_major != 3) {\r\nath10k_err("unsupported htt major version %d. supported versions are 2 and 3\n",\r\nhtt->target_version_major);\r\nreturn -ENOTSUPP;\r\n}\r\nreturn 0;\r\n}\r\nint ath10k_htt_setup(struct ath10k_htt *htt)\r\n{\r\nint status;\r\ninit_completion(&htt->target_version_received);\r\nstatus = ath10k_htt_h2t_ver_req_msg(htt);\r\nif (status)\r\nreturn status;\r\nstatus = wait_for_completion_timeout(&htt->target_version_received,\r\nHTT_TARGET_VERSION_TIMEOUT_HZ);\r\nif (status <= 0) {\r\nath10k_warn("htt version request timed out\n");\r\nreturn -ETIMEDOUT;\r\n}\r\nstatus = ath10k_htt_verify_version(htt);\r\nif (status)\r\nreturn status;\r\nreturn ath10k_htt_send_rx_ring_cfg_ll(htt);\r\n}
