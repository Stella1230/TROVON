int\r\ndbl_fdiv (dbl_floating_point * srcptr1, dbl_floating_point * srcptr2,\r\ndbl_floating_point * dstptr, unsigned int *status)\r\n{\r\nregister unsigned int opnd1p1, opnd1p2, opnd2p1, opnd2p2;\r\nregister unsigned int opnd3p1, opnd3p2, resultp1, resultp2;\r\nregister int dest_exponent, count;\r\nregister boolean inexact = FALSE, guardbit = FALSE, stickybit = FALSE;\r\nboolean is_tiny;\r\nDbl_copyfromptr(srcptr1,opnd1p1,opnd1p2);\r\nDbl_copyfromptr(srcptr2,opnd2p1,opnd2p2);\r\nif (Dbl_sign(opnd1p1) ^ Dbl_sign(opnd2p1))\r\nDbl_setnegativezerop1(resultp1);\r\nelse Dbl_setzerop1(resultp1);\r\nif (Dbl_isinfinity_exponent(opnd1p1)) {\r\nif (Dbl_iszero_mantissa(opnd1p1,opnd1p2)) {\r\nif (Dbl_isnotnan(opnd2p1,opnd2p2)) {\r\nif (Dbl_isinfinity(opnd2p1,opnd2p2)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_makequietnan(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nDbl_setinfinity_exponentmantissa(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nelse {\r\nif (Dbl_isone_signaling(opnd1p1)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_set_quiet(opnd1p1);\r\n}\r\nelse if (Dbl_is_signalingnan(opnd2p1)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_set_quiet(opnd2p1);\r\nDbl_copytoptr(opnd2p1,opnd2p2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nDbl_copytoptr(opnd1p1,opnd1p2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nif (Dbl_isinfinity_exponent(opnd2p1)) {\r\nif (Dbl_iszero_mantissa(opnd2p1,opnd2p2)) {\r\nDbl_setzero_exponentmantissa(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Dbl_isone_signaling(opnd2p1)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_set_quiet(opnd2p1);\r\n}\r\nDbl_copytoptr(opnd2p1,opnd2p2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Dbl_iszero_exponentmantissa(opnd2p1,opnd2p2)) {\r\nif (Dbl_iszero_exponentmantissa(opnd1p1,opnd1p2)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_makequietnan(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Is_divisionbyzerotrap_enabled())\r\nreturn(DIVISIONBYZEROEXCEPTION);\r\nSet_divisionbyzeroflag();\r\nDbl_setinfinity_exponentmantissa(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\ndest_exponent = Dbl_exponent(opnd1p1) - Dbl_exponent(opnd2p1) + DBL_BIAS;\r\nif (Dbl_isnotzero_exponent(opnd1p1)) {\r\nDbl_clear_signexponent_set_hidden(opnd1p1);\r\n}\r\nelse {\r\nif (Dbl_iszero_mantissa(opnd1p1,opnd1p2)) {\r\nDbl_setzero_exponentmantissa(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nDbl_clear_signexponent(opnd1p1);\r\nDbl_leftshiftby1(opnd1p1,opnd1p2);\r\nDbl_normalize(opnd1p1,opnd1p2,dest_exponent);\r\n}\r\nif (Dbl_isnotzero_exponent(opnd2p1)) {\r\nDbl_clear_signexponent_set_hidden(opnd2p1);\r\n}\r\nelse {\r\nDbl_clear_signexponent(opnd2p1);\r\nDbl_leftshiftby1(opnd2p1,opnd2p2);\r\nwhile (Dbl_iszero_hiddenhigh7mantissa(opnd2p1)) {\r\ndest_exponent+=8;\r\nDbl_leftshiftby8(opnd2p1,opnd2p2);\r\n}\r\nif (Dbl_iszero_hiddenhigh3mantissa(opnd2p1)) {\r\ndest_exponent+=4;\r\nDbl_leftshiftby4(opnd2p1,opnd2p2);\r\n}\r\nwhile (Dbl_iszero_hidden(opnd2p1)) {\r\ndest_exponent++;\r\nDbl_leftshiftby1(opnd2p1,opnd2p2);\r\n}\r\n}\r\nTwoword_subtract(opnd1p1,opnd1p2,opnd2p1,opnd2p2);\r\nDbl_setzero(opnd3p1,opnd3p2);\r\nfor (count=1; count <= DBL_P && (opnd1p1 || opnd1p2); count++) {\r\nDbl_leftshiftby1(opnd1p1,opnd1p2);\r\nDbl_leftshiftby1(opnd3p1,opnd3p2);\r\nif (Dbl_iszero_sign(opnd1p1)) {\r\nDbl_setone_lowmantissap2(opnd3p2);\r\nTwoword_subtract(opnd1p1,opnd1p2,opnd2p1,opnd2p2);\r\n}\r\nelse {\r\nTwoword_add(opnd1p1, opnd1p2, opnd2p1, opnd2p2);\r\n}\r\n}\r\nif (count <= DBL_P) {\r\nDbl_leftshiftby1(opnd3p1,opnd3p2);\r\nDbl_setone_lowmantissap2(opnd3p2);\r\nDbl_leftshift(opnd3p1,opnd3p2,(DBL_P-count));\r\nif (Dbl_iszero_hidden(opnd3p1)) {\r\nDbl_leftshiftby1(opnd3p1,opnd3p2);\r\ndest_exponent--;\r\n}\r\n}\r\nelse {\r\nif (Dbl_iszero_hidden(opnd3p1)) {\r\nDbl_leftshiftby1(opnd1p1,opnd1p2);\r\nDbl_leftshiftby1(opnd3p1,opnd3p2);\r\nif (Dbl_iszero_sign(opnd1p1)) {\r\nDbl_setone_lowmantissap2(opnd3p2);\r\nTwoword_subtract(opnd1p1,opnd1p2,opnd2p1,opnd2p2);\r\n}\r\nelse {\r\nTwoword_add(opnd1p1,opnd1p2,opnd2p1,opnd2p2);\r\n}\r\ndest_exponent--;\r\n}\r\nif (Dbl_iszero_sign(opnd1p1)) guardbit = TRUE;\r\nstickybit = Dbl_allp1(opnd1p1) || Dbl_allp2(opnd1p2);\r\n}\r\ninexact = guardbit | stickybit;\r\nif (inexact && (dest_exponent > 0 || Is_underflowtrap_enabled())) {\r\nDbl_clear_signexponent(opnd3p1);\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Dbl_iszero_sign(resultp1))\r\nDbl_increment(opnd3p1,opnd3p2);\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Dbl_isone_sign(resultp1))\r\nDbl_increment(opnd3p1,opnd3p2);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit && (stickybit ||\r\nDbl_isone_lowmantissap2(opnd3p2))) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\n}\r\n}\r\nif (Dbl_isone_hidden(opnd3p1)) dest_exponent++;\r\n}\r\nDbl_set_mantissa(resultp1,resultp2,opnd3p1,opnd3p2);\r\nif (dest_exponent >= DBL_INFINITY_EXPONENT) {\r\nif (Is_overflowtrap_enabled()) {\r\nDbl_setwrapped_exponent(resultp1,dest_exponent,ovfl);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nif (inexact)\r\nif (Is_inexacttrap_enabled())\r\nreturn(OVERFLOWEXCEPTION | INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\nreturn(OVERFLOWEXCEPTION);\r\n}\r\nSet_overflowflag();\r\nDbl_setoverflow(resultp1,resultp2);\r\ninexact = TRUE;\r\n}\r\nelse if (dest_exponent <= 0) {\r\nif (Is_underflowtrap_enabled()) {\r\nDbl_setwrapped_exponent(resultp1,dest_exponent,unfl);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nif (inexact)\r\nif (Is_inexacttrap_enabled())\r\nreturn(UNDERFLOWEXCEPTION | INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\nreturn(UNDERFLOWEXCEPTION);\r\n}\r\nis_tiny = TRUE;\r\nif (dest_exponent == 0 && inexact) {\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Dbl_iszero_sign(resultp1)) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\nif (Dbl_isone_hiddenoverflow(opnd3p1))\r\nis_tiny = FALSE;\r\nDbl_decrement(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Dbl_isone_sign(resultp1)) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\nif (Dbl_isone_hiddenoverflow(opnd3p1))\r\nis_tiny = FALSE;\r\nDbl_decrement(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit && (stickybit ||\r\nDbl_isone_lowmantissap2(opnd3p2))) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\nif (Dbl_isone_hiddenoverflow(opnd3p1))\r\nis_tiny = FALSE;\r\nDbl_decrement(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\n}\r\n}\r\nstickybit = inexact;\r\nDbl_denormalize(opnd3p1,opnd3p2,dest_exponent,guardbit,\r\nstickybit,inexact);\r\nif (inexact) {\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Dbl_iszero_sign(resultp1)) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Dbl_isone_sign(resultp1)) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit && (stickybit ||\r\nDbl_isone_lowmantissap2(opnd3p2))) {\r\nDbl_increment(opnd3p1,opnd3p2);\r\n}\r\nbreak;\r\n}\r\nif (is_tiny) Set_underflowflag();\r\n}\r\nDbl_set_exponentmantissa(resultp1,resultp2,opnd3p1,opnd3p2);\r\n}\r\nelse Dbl_set_exponent(resultp1,dest_exponent);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nif (inexact) {\r\nif (Is_inexacttrap_enabled()) return(INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\n}\r\nreturn(NOEXCEPTION);\r\n}
