static int gpio_set_dir(struct wm8350 *wm8350, int gpio, int dir)\r\n{\r\nint ret;\r\nwm8350_reg_unlock(wm8350);\r\nif (dir == WM8350_GPIO_DIR_OUT)\r\nret = wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_CONFIGURATION_I_O,\r\n1 << gpio);\r\nelse\r\nret = wm8350_set_bits(wm8350,\r\nWM8350_GPIO_CONFIGURATION_I_O,\r\n1 << gpio);\r\nwm8350_reg_lock(wm8350);\r\nreturn ret;\r\n}\r\nstatic int wm8350_gpio_set_debounce(struct wm8350 *wm8350, int gpio, int db)\r\n{\r\nif (db == WM8350_GPIO_DEBOUNCE_ON)\r\nreturn wm8350_set_bits(wm8350, WM8350_GPIO_DEBOUNCE,\r\n1 << gpio);\r\nelse\r\nreturn wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_DEBOUNCE, 1 << gpio);\r\n}\r\nstatic int gpio_set_func(struct wm8350 *wm8350, int gpio, int func)\r\n{\r\nu16 reg;\r\nwm8350_reg_unlock(wm8350);\r\nswitch (gpio) {\r\ncase 0:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\r\n& ~WM8350_GP0_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\r\nreg | ((func & 0xf) << 0));\r\nbreak;\r\ncase 1:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\r\n& ~WM8350_GP1_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\r\nreg | ((func & 0xf) << 4));\r\nbreak;\r\ncase 2:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\r\n& ~WM8350_GP2_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\r\nreg | ((func & 0xf) << 8));\r\nbreak;\r\ncase 3:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\r\n& ~WM8350_GP3_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\r\nreg | ((func & 0xf) << 12));\r\nbreak;\r\ncase 4:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\r\n& ~WM8350_GP4_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\r\nreg | ((func & 0xf) << 0));\r\nbreak;\r\ncase 5:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\r\n& ~WM8350_GP5_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\r\nreg | ((func & 0xf) << 4));\r\nbreak;\r\ncase 6:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\r\n& ~WM8350_GP6_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\r\nreg | ((func & 0xf) << 8));\r\nbreak;\r\ncase 7:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\r\n& ~WM8350_GP7_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\r\nreg | ((func & 0xf) << 12));\r\nbreak;\r\ncase 8:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\r\n& ~WM8350_GP8_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\r\nreg | ((func & 0xf) << 0));\r\nbreak;\r\ncase 9:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\r\n& ~WM8350_GP9_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\r\nreg | ((func & 0xf) << 4));\r\nbreak;\r\ncase 10:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\r\n& ~WM8350_GP10_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\r\nreg | ((func & 0xf) << 8));\r\nbreak;\r\ncase 11:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\r\n& ~WM8350_GP11_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\r\nreg | ((func & 0xf) << 12));\r\nbreak;\r\ncase 12:\r\nreg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_4)\r\n& ~WM8350_GP12_FN_MASK;\r\nwm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_4,\r\nreg | ((func & 0xf) << 0));\r\nbreak;\r\ndefault:\r\nwm8350_reg_lock(wm8350);\r\nreturn -EINVAL;\r\n}\r\nwm8350_reg_lock(wm8350);\r\nreturn 0;\r\n}\r\nstatic int gpio_set_pull_up(struct wm8350 *wm8350, int gpio, int up)\r\n{\r\nif (up)\r\nreturn wm8350_set_bits(wm8350,\r\nWM8350_GPIO_PIN_PULL_UP_CONTROL,\r\n1 << gpio);\r\nelse\r\nreturn wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_PIN_PULL_UP_CONTROL,\r\n1 << gpio);\r\n}\r\nstatic int gpio_set_pull_down(struct wm8350 *wm8350, int gpio, int down)\r\n{\r\nif (down)\r\nreturn wm8350_set_bits(wm8350,\r\nWM8350_GPIO_PULL_DOWN_CONTROL,\r\n1 << gpio);\r\nelse\r\nreturn wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_PULL_DOWN_CONTROL,\r\n1 << gpio);\r\n}\r\nstatic int gpio_set_polarity(struct wm8350 *wm8350, int gpio, int pol)\r\n{\r\nif (pol == WM8350_GPIO_ACTIVE_HIGH)\r\nreturn wm8350_set_bits(wm8350,\r\nWM8350_GPIO_PIN_POLARITY_TYPE,\r\n1 << gpio);\r\nelse\r\nreturn wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_PIN_POLARITY_TYPE,\r\n1 << gpio);\r\n}\r\nstatic int gpio_set_invert(struct wm8350 *wm8350, int gpio, int invert)\r\n{\r\nif (invert == WM8350_GPIO_INVERT_ON)\r\nreturn wm8350_set_bits(wm8350, WM8350_GPIO_INT_MODE, 1 << gpio);\r\nelse\r\nreturn wm8350_clear_bits(wm8350,\r\nWM8350_GPIO_INT_MODE, 1 << gpio);\r\n}\r\nint wm8350_gpio_config(struct wm8350 *wm8350, int gpio, int dir, int func,\r\nint pol, int pull, int invert, int debounce)\r\n{\r\nif (pull == WM8350_GPIO_PULL_NONE) {\r\nif (gpio_set_pull_up(wm8350, gpio, 0))\r\ngoto err;\r\nif (gpio_set_pull_down(wm8350, gpio, 0))\r\ngoto err;\r\n} else if (pull == WM8350_GPIO_PULL_UP) {\r\nif (gpio_set_pull_down(wm8350, gpio, 0))\r\ngoto err;\r\nif (gpio_set_pull_up(wm8350, gpio, 1))\r\ngoto err;\r\n} else if (pull == WM8350_GPIO_PULL_DOWN) {\r\nif (gpio_set_pull_up(wm8350, gpio, 0))\r\ngoto err;\r\nif (gpio_set_pull_down(wm8350, gpio, 1))\r\ngoto err;\r\n}\r\nif (gpio_set_invert(wm8350, gpio, invert))\r\ngoto err;\r\nif (gpio_set_polarity(wm8350, gpio, pol))\r\ngoto err;\r\nif (wm8350_gpio_set_debounce(wm8350, gpio, debounce))\r\ngoto err;\r\nif (gpio_set_dir(wm8350, gpio, dir))\r\ngoto err;\r\nreturn gpio_set_func(wm8350, gpio, func);\r\nerr:\r\nreturn -EIO;\r\n}
