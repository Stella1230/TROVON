static void *get_uts(struct ctl_table *table, int write)\r\n{\r\nchar *which = table->data;\r\nstruct uts_namespace *uts_ns;\r\nuts_ns = current->nsproxy->uts_ns;\r\nwhich = (which - (char *)&init_uts_ns) + (char *)uts_ns;\r\nif (!write)\r\ndown_read(&uts_sem);\r\nelse\r\ndown_write(&uts_sem);\r\nreturn which;\r\n}\r\nstatic void put_uts(struct ctl_table *table, int write, void *which)\r\n{\r\nif (!write)\r\nup_read(&uts_sem);\r\nelse\r\nup_write(&uts_sem);\r\n}\r\nstatic int proc_do_uts_string(struct ctl_table *table, int write,\r\nvoid __user *buffer, size_t *lenp, loff_t *ppos)\r\n{\r\nstruct ctl_table uts_table;\r\nint r;\r\nmemcpy(&uts_table, table, sizeof(uts_table));\r\nuts_table.data = get_uts(table, write);\r\nr = proc_dostring(&uts_table, write, buffer, lenp, ppos);\r\nput_uts(table, write, uts_table.data);\r\nif (write)\r\nproc_sys_poll_notify(table->poll);\r\nreturn r;\r\n}\r\nvoid uts_proc_notify(enum uts_proc proc)\r\n{\r\nstruct ctl_table *table = &uts_kern_table[proc];\r\nproc_sys_poll_notify(table->poll);\r\n}\r\nstatic int __init utsname_sysctl_init(void)\r\n{\r\nregister_sysctl_table(uts_root_table);\r\nreturn 0;\r\n}
