static unsigned int\r\nnflog_tg(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nconst struct xt_nflog_info *info = par->targinfo;\r\nstruct nf_loginfo li;\r\nstruct net *net = dev_net(par->in ? par->in : par->out);\r\nli.type = NF_LOG_TYPE_ULOG;\r\nli.u.ulog.copy_len = info->len;\r\nli.u.ulog.group = info->group;\r\nli.u.ulog.qthreshold = info->threshold;\r\nnfulnl_log_packet(net, par->family, par->hooknum, skb, par->in,\r\npar->out, &li, info->prefix);\r\nreturn XT_CONTINUE;\r\n}\r\nstatic int nflog_tg_check(const struct xt_tgchk_param *par)\r\n{\r\nconst struct xt_nflog_info *info = par->targinfo;\r\nif (info->flags & ~XT_NFLOG_MASK)\r\nreturn -EINVAL;\r\nif (info->prefix[sizeof(info->prefix) - 1] != '\0')\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic int __init nflog_tg_init(void)\r\n{\r\nreturn xt_register_target(&nflog_tg_reg);\r\n}\r\nstatic void __exit nflog_tg_exit(void)\r\n{\r\nxt_unregister_target(&nflog_tg_reg);\r\n}
