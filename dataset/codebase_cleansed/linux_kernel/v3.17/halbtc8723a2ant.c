BOOLEAN\r\nhalbtc8723a2ant_IsWifiIdle(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBOOLEAN bWifiConnected=FALSE, bScan=FALSE, bLink=FALSE, bRoam=FALSE;\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\r\nif(bWifiConnected)\r\nreturn FALSE;\r\nif(bScan)\r\nreturn FALSE;\r\nif(bLink)\r\nreturn FALSE;\r\nif(bRoam)\r\nreturn FALSE;\r\nreturn true;\r\n}\r\nu1Byte\r\nhalbtc8723a2ant_BtRssiState(\r\nu1Byte levelNum,\r\nu1Byte rssiThresh,\r\nu1Byte rssiThresh1\r\n)\r\n{\r\ns4Byte btRssi=0;\r\nu1Byte btRssiState=pCoexSta->preBtRssiState;\r\nbtRssi = pCoexSta->btRssi;\r\nif(levelNum == 2)\r\n{\r\nif( (pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW))\r\n{\r\nif(btRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nbtRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to High\n"));\r\n}\r\nelse\r\n{\r\nbtRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Low\n"));\r\n}\r\n}\r\nelse\r\n{\r\nif(btRssi < rssiThresh)\r\n{\r\nbtRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Low\n"));\r\n}\r\nelse\r\n{\r\nbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at High\n"));\r\n}\r\n}\r\n}\r\nelse if(levelNum == 3)\r\n{\r\nif(rssiThresh > rssiThresh1)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi thresh error!!\n"));\r\nreturn pCoexSta->preBtRssiState;\r\n}\r\nif( (pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW))\r\n{\r\nif(btRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nbtRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Medium\n"));\r\n}\r\nelse\r\n{\r\nbtRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Low\n"));\r\n}\r\n}\r\nelse if( (pCoexSta->preBtRssiState == BTC_RSSI_STATE_MEDIUM) ||\r\n(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_MEDIUM))\r\n{\r\nif(btRssi >= (rssiThresh1+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nbtRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to High\n"));\r\n}\r\nelse if(btRssi < rssiThresh)\r\n{\r\nbtRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Low\n"));\r\n}\r\nelse\r\n{\r\nbtRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at Medium\n"));\r\n}\r\n}\r\nelse\r\n{\r\nif(btRssi < rssiThresh1)\r\n{\r\nbtRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state switch to Medium\n"));\r\n}\r\nelse\r\n{\r\nbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_RSSI_STATE, ("[BTCoex], BT Rssi state stay at High\n"));\r\n}\r\n}\r\n}\r\npCoexSta->preBtRssiState = btRssiState;\r\nreturn btRssiState;\r\n}\r\nu1Byte\r\nhalbtc8723a2ant_WifiRssiState(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte index,\r\nIN u1Byte levelNum,\r\nIN u1Byte rssiThresh,\r\nIN u1Byte rssiThresh1\r\n)\r\n{\r\ns4Byte wifiRssi=0;\r\nu1Byte wifiRssiState=pCoexSta->preWifiRssiState[index];\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_S4_WIFI_RSSI, &wifiRssi);\r\nif(levelNum == 2)\r\n{\r\nif( (pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW))\r\n{\r\nif(wifiRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to High\n"));\r\n}\r\nelse\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Low\n"));\r\n}\r\n}\r\nelse\r\n{\r\nif(wifiRssi < rssiThresh)\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Low\n"));\r\n}\r\nelse\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at High\n"));\r\n}\r\n}\r\n}\r\nelse if(levelNum == 3)\r\n{\r\nif(rssiThresh > rssiThresh1)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI thresh error!!\n"));\r\nreturn pCoexSta->preWifiRssiState[index];\r\n}\r\nif( (pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW))\r\n{\r\nif(wifiRssi >= (rssiThresh+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Medium\n"));\r\n}\r\nelse\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_STAY_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Low\n"));\r\n}\r\n}\r\nelse if( (pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_MEDIUM) ||\r\n(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_MEDIUM))\r\n{\r\nif(wifiRssi >= (rssiThresh1+BTC_RSSI_COEX_THRESH_TOL_8723A_2ANT))\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to High\n"));\r\n}\r\nelse if(wifiRssi < rssiThresh)\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_LOW;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Low\n"));\r\n}\r\nelse\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at Medium\n"));\r\n}\r\n}\r\nelse\r\n{\r\nif(wifiRssi < rssiThresh1)\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_MEDIUM;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state switch to Medium\n"));\r\n}\r\nelse\r\n{\r\nwifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_WIFI_RSSI_STATE, ("[BTCoex], wifi RSSI state stay at High\n"));\r\n}\r\n}\r\n}\r\npCoexSta->preWifiRssiState[index] = wifiRssiState;\r\nreturn wifiRssiState;\r\n}\r\nVOID\r\nhalbtc8723a2ant_IndicateWifiChnlBwInfo(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nu1Byte H2C_Parameter[3] ={0};\r\nu4Byte wifiBw;\r\nu1Byte wifiCentralChnl;\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U1_WIFI_CENTRAL_CHNL, &wifiCentralChnl);\r\nif( (BTC_MEDIA_CONNECT == type) &&\r\n(wifiCentralChnl <= 14) )\r\n{\r\nH2C_Parameter[0] = 0x1;\r\nH2C_Parameter[1] = wifiCentralChnl;\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\nH2C_Parameter[2] = 0x30;\r\nelse\r\nH2C_Parameter[2] = 0x20;\r\n}\r\npCoexDm->wifiChnlInfo[0] = H2C_Parameter[0];\r\npCoexDm->wifiChnlInfo[1] = H2C_Parameter[1];\r\npCoexDm->wifiChnlInfo[2] = H2C_Parameter[2];\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], FW write 0x19=0x%x\n",\r\nH2C_Parameter[0]<<16|H2C_Parameter[1]<<8|H2C_Parameter[2]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x19, 3, H2C_Parameter);\r\n}\r\nVOID\r\nhalbtc8723a2ant_QueryBtInfo(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte H2C_Parameter[1] ={0};\r\npCoexSta->bC2hBtInfoReqSent = true;\r\nH2C_Parameter[0] |= BIT0;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], Query Bt Info, FW write 0x38=0x%x\n",\r\nH2C_Parameter[0]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x38, 1, H2C_Parameter);\r\n}\r\nu1Byte\r\nhalbtc8723a2ant_ActionAlgorithm(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nPBTC_STACK_INFO pStackInfo=&pBtCoexist->stack_info;\r\nBOOLEAN bBtHsOn=FALSE, bBtBusy=FALSE, limited_dig=FALSE;\r\nu1Byte algorithm=BT_8723A_2ANT_COEX_ALGO_UNDEFINED;\r\nu1Byte numOfDiffProfile=0;\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_IDLE;\r\nif((pStackInfo->bScoExist) ||(bBtHsOn) ||(pStackInfo->bHidExist))\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO or HID or HS exists, set BT non-idle !!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_NON_IDLE;\r\n}\r\nelse\r\n{\r\nif( (pBtCoexist->stack_info.numOfLink == 1) &&\r\n(pStackInfo->bA2dpExist) )\r\n{\r\nif( (pCoexSta->lowPriorityTx+ pCoexSta->lowPriorityRx) < 100)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP, low priority tx+rx < 100, set BT connected-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP, low priority tx+rx >= 100, set BT non-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_NON_IDLE;\r\n}\r\n}\r\nif( (pBtCoexist->stack_info.numOfLink == 1) &&\r\n(pStackInfo->bPanExist) )\r\n{\r\nif((pCoexSta->lowPriorityTx+ pCoexSta->lowPriorityRx) < 600)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN, low priority tx+rx < 600, set BT connected-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE;\r\n}\r\nelse\r\n{\r\nif(pCoexSta->lowPriorityTx)\r\n{\r\nif((pCoexSta->lowPriorityRx /pCoexSta->lowPriorityTx)>9 )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN, low priority rx/tx > 9, set BT connected-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE;\r\n}\r\n}\r\n}\r\nif(BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE != pCoexDm->btStatus)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN, set BT non-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_NON_IDLE;\r\n}\r\n}\r\nif( (pBtCoexist->stack_info.numOfLink == 2) &&\r\n(pStackInfo->bA2dpExist) &&\r\n(pStackInfo->bPanExist) )\r\n{\r\nif((pCoexSta->lowPriorityTx+ pCoexSta->lowPriorityRx) < 600)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN+A2DP, low priority tx+rx < 600, set BT connected-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE;\r\n}\r\nelse\r\n{\r\nif(pCoexSta->lowPriorityTx)\r\n{\r\nif((pCoexSta->lowPriorityRx /pCoexSta->lowPriorityTx)>9 )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN+A2DP, low priority rx/tx > 9, set BT connected-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE;\r\n}\r\n}\r\n}\r\nif(BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE != pCoexDm->btStatus)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN+A2DP, set BT non-idle!!!\n"));\r\npCoexDm->btStatus = BT_8723A_2ANT_BT_STATUS_NON_IDLE;\r\n}\r\n}\r\n}\r\nif(BT_8723A_2ANT_BT_STATUS_IDLE != pCoexDm->btStatus)\r\n{\r\nbBtBusy = true;\r\nlimited_dig = true;\r\n}\r\nelse\r\n{\r\nbBtBusy = FALSE;\r\nlimited_dig = FALSE;\r\n}\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_BL_BT_TRAFFIC_BUSY, &bBtBusy);\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_BL_BT_LIMITED_DIG, &limited_dig);\r\nif(!pStackInfo->bBtLinkExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], No profile exists!!!\n"));\r\nreturn algorithm;\r\n}\r\nif(pStackInfo->bScoExist)\r\nnumOfDiffProfile++;\r\nif(pStackInfo->bHidExist)\r\nnumOfDiffProfile++;\r\nif(pStackInfo->bPanExist)\r\nnumOfDiffProfile++;\r\nif(pStackInfo->bA2dpExist)\r\nnumOfDiffProfile++;\r\nif(numOfDiffProfile == 1)\r\n{\r\nif(pStackInfo->bScoExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO only\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_SCO;\r\n}\r\nelse\r\n{\r\nif(pStackInfo->bHidExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID only\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID;\r\n}\r\nelse if(pStackInfo->bA2dpExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP only\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_A2DP;\r\n}\r\nelse if(pStackInfo->bPanExist)\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN(HS) only\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANHS;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], PAN(EDR) only\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR;\r\n}\r\n}\r\n}\r\n}\r\nelse if(numOfDiffProfile == 2)\r\n{\r\nif(pStackInfo->bScoExist)\r\n{\r\nif(pStackInfo->bHidExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID;\r\n}\r\nelse if(pStackInfo->bA2dpExist)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP ==> SCO\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_SCO;\r\n}\r\nelse if(pStackInfo->bPanExist)\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_SCO;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + PAN(EDR)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nif( pStackInfo->bHidExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID_A2DP;\r\n}\r\nelse if( pStackInfo->bHidExist &&\r\npStackInfo->bPanExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID_A2DP;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + PAN(EDR)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\nelse if( pStackInfo->bPanExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_A2DP;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], A2DP + PAN(EDR)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_A2DP;\r\n}\r\n}\r\n}\r\n}\r\nelse if(numOfDiffProfile == 3)\r\n{\r\nif(pStackInfo->bScoExist)\r\n{\r\nif( pStackInfo->bHidExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID + A2DP ==> HID\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID;\r\n}\r\nelse if( pStackInfo->bHidExist &&\r\npStackInfo->bPanExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID_A2DP;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID + PAN(EDR)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\nelse if( pStackInfo->bPanExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_SCO;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + A2DP + PAN(EDR) ==> HID\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nif( pStackInfo->bHidExist &&\r\npStackInfo->bPanExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP + PAN(HS)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID_A2DP;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], HID + A2DP + PAN(EDR)\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_HID_A2DP_PANEDR;\r\n}\r\n}\r\n}\r\n}\r\nelse if(numOfDiffProfile >= 3)\r\n{\r\nif(pStackInfo->bScoExist)\r\n{\r\nif( pStackInfo->bHidExist &&\r\npStackInfo->bPanExist &&\r\npStackInfo->bA2dpExist )\r\n{\r\nif(bBtHsOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Error!!! SCO + HID + A2DP + PAN(HS)\n"));\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], SCO + HID + A2DP + PAN(EDR)==>PAN(EDR)+HID\n"));\r\nalgorithm = BT_8723A_2ANT_COEX_ALGO_PANEDR_HID;\r\n}\r\n}\r\n}\r\n}\r\nreturn algorithm;\r\n}\r\nBOOLEAN\r\nhalbtc8723a2ant_NeedToDecBtPwr(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBOOLEAN bRet=FALSE;\r\nBOOLEAN bBtHsOn=FALSE, bWifiConnected=FALSE;\r\ns4Byte btHsRssi=0;\r\nif(!pBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn))\r\nreturn FALSE;\r\nif(!pBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected))\r\nreturn FALSE;\r\nif(!pBtCoexist->btc_get(pBtCoexist, BTC_GET_S4_HS_RSSI, &btHsRssi))\r\nreturn FALSE;\r\nif(bWifiConnected)\r\n{\r\nif(bBtHsOn)\r\n{\r\nif(btHsRssi > 37)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], Need to decrease bt power for HS mode!!\n"));\r\nbRet = true;\r\n}\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], Need to decrease bt power for Wifi is connected!!\n"));\r\nbRet = true;\r\n}\r\n}\r\nreturn bRet;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetFwDacSwingLevel(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte dacSwingLvl\r\n)\r\n{\r\nu1Byte H2C_Parameter[1] ={0};\r\nH2C_Parameter[0] = dacSwingLvl;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], Set Dac Swing Level=0x%x\n", dacSwingLvl));\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], FW write 0x29=0x%x\n", H2C_Parameter[0]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x29, 1, H2C_Parameter);\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetFwDecBtPwr(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bDecBtPwr\r\n)\r\n{\r\nu1Byte H2C_Parameter[1] ={0};\r\nH2C_Parameter[0] = 0;\r\nif(bDecBtPwr)\r\n{\r\nH2C_Parameter[0] |= BIT1;\r\n}\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], decrease Bt Power : %s, FW write 0x21=0x%x\n",\r\n(bDecBtPwr? "Yes!!":"No!!"), H2C_Parameter[0]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x21, 1, H2C_Parameter);\r\n}\r\nVOID\r\nhalbtc8723a2ant_DecBtPwr(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bDecBtPwr\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], %s Dec BT power = %s\n",\r\n(bForceExec? "force to":""), ((bDecBtPwr)? "ON":"OFF")));\r\npCoexDm->bCurDecBtPwr = bDecBtPwr;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], bPreDecBtPwr=%d, bCurDecBtPwr=%d\n",\r\npCoexDm->bPreDecBtPwr, pCoexDm->bCurDecBtPwr));\r\nif(pCoexDm->bPreDecBtPwr == pCoexDm->bCurDecBtPwr)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetFwDecBtPwr(pBtCoexist, pCoexDm->bCurDecBtPwr);\r\npCoexDm->bPreDecBtPwr = pCoexDm->bCurDecBtPwr;\r\n}\r\nVOID\r\nhalbtc8723a2ant_FwDacSwingLvl(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN u1Byte fwDacSwingLvl\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], %s set FW Dac Swing level = %d\n",\r\n(bForceExec? "force to":""), fwDacSwingLvl));\r\npCoexDm->curFwDacSwingLvl = fwDacSwingLvl;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], preFwDacSwingLvl=%d, curFwDacSwingLvl=%d\n",\r\npCoexDm->preFwDacSwingLvl, pCoexDm->curFwDacSwingLvl));\r\nif(pCoexDm->preFwDacSwingLvl == pCoexDm->curFwDacSwingLvl)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetFwDacSwingLevel(pBtCoexist, pCoexDm->curFwDacSwingLvl);\r\npCoexDm->preFwDacSwingLvl = pCoexDm->curFwDacSwingLvl;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetSwRfRxLpfCorner(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bRxRfShrinkOn\r\n)\r\n{\r\nif(bRxRfShrinkOn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Shrink RF Rx LPF corner!!\n"));\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, 0xf0ff7);\r\n}\r\nelse\r\n{\r\nif(pBtCoexist->initilized)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Resume RF Rx LPF corner!!\n"));\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, pCoexDm->btRf0x1eBackup);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_RfShrink(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bRxRfShrinkOn\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s turn Rx RF Shrink = %s\n",\r\n(bForceExec? "force to":""), ((bRxRfShrinkOn)? "ON":"OFF")));\r\npCoexDm->bCurRfRxLpfShrink = bRxRfShrinkOn;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], bPreRfRxLpfShrink=%d, bCurRfRxLpfShrink=%d\n",\r\npCoexDm->bPreRfRxLpfShrink, pCoexDm->bCurRfRxLpfShrink));\r\nif(pCoexDm->bPreRfRxLpfShrink == pCoexDm->bCurRfRxLpfShrink)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetSwRfRxLpfCorner(pBtCoexist, pCoexDm->bCurRfRxLpfShrink);\r\npCoexDm->bPreRfRxLpfShrink = pCoexDm->bCurRfRxLpfShrink;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetSwPenaltyTxRateAdaptive(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bLowPenaltyRa\r\n)\r\n{\r\nu1Byte tmpU1;\r\ntmpU1 = pBtCoexist->btc_read_1byte(pBtCoexist, 0x4fd);\r\ntmpU1 |= BIT0;\r\nif(bLowPenaltyRa)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Tx rate adaptive, set low penalty!!\n"));\r\ntmpU1 &= ~BIT2;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Tx rate adaptive, set normal!!\n"));\r\ntmpU1 |= BIT2;\r\n}\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x4fd, tmpU1);\r\n}\r\nVOID\r\nhalbtc8723a2ant_LowPenaltyRa(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bLowPenaltyRa\r\n)\r\n{\r\nreturn;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s turn LowPenaltyRA = %s\n",\r\n(bForceExec? "force to":""), ((bLowPenaltyRa)? "ON":"OFF")));\r\npCoexDm->bCurLowPenaltyRa = bLowPenaltyRa;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], bPreLowPenaltyRa=%d, bCurLowPenaltyRa=%d\n",\r\npCoexDm->bPreLowPenaltyRa, pCoexDm->bCurLowPenaltyRa));\r\nif(pCoexDm->bPreLowPenaltyRa == pCoexDm->bCurLowPenaltyRa)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetSwPenaltyTxRateAdaptive(pBtCoexist, pCoexDm->bCurLowPenaltyRa);\r\npCoexDm->bPreLowPenaltyRa = pCoexDm->bCurLowPenaltyRa;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetSwFullTimeDacSwing(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bSwDacSwingOn,\r\nIN u4Byte swDacSwingLvl\r\n)\r\n{\r\nif(bSwDacSwingOn)\r\n{\r\npBtCoexist->btc_setBbReg(pBtCoexist, 0x880, 0xff000000, swDacSwingLvl);\r\n}\r\nelse\r\n{\r\npBtCoexist->btc_setBbReg(pBtCoexist, 0x880, 0xff000000, 0xc0);\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_DacSwing(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bDacSwingOn,\r\nIN u4Byte dacSwingLvl\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s turn DacSwing=%s, dacSwingLvl=0x%x\n",\r\n(bForceExec? "force to":""), ((bDacSwingOn)? "ON":"OFF"), dacSwingLvl));\r\npCoexDm->bCurDacSwingOn = bDacSwingOn;\r\npCoexDm->curDacSwingLvl = dacSwingLvl;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], bPreDacSwingOn=%d, preDacSwingLvl=0x%x, bCurDacSwingOn=%d, curDacSwingLvl=0x%x\n",\r\npCoexDm->bPreDacSwingOn, pCoexDm->preDacSwingLvl,\r\npCoexDm->bCurDacSwingOn, pCoexDm->curDacSwingLvl));\r\nif( (pCoexDm->bPreDacSwingOn == pCoexDm->bCurDacSwingOn) &&\r\n(pCoexDm->preDacSwingLvl == pCoexDm->curDacSwingLvl) )\r\nreturn;\r\n}\r\nmdelay(30);\r\nhalbtc8723a2ant_SetSwFullTimeDacSwing(pBtCoexist, bDacSwingOn, dacSwingLvl);\r\npCoexDm->bPreDacSwingOn = pCoexDm->bCurDacSwingOn;\r\npCoexDm->preDacSwingLvl = pCoexDm->curDacSwingLvl;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetAdcBackOff(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bAdcBackOff\r\n)\r\n{\r\nif(bAdcBackOff)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], BB BackOff Level On!\n"));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc04,0x3a07611);\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], BB BackOff Level Off!\n"));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc04,0x3a05611);\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_AdcBackOff(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bAdcBackOff\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s turn AdcBackOff = %s\n",\r\n(bForceExec? "force to":""), ((bAdcBackOff)? "ON":"OFF")));\r\npCoexDm->bCurAdcBackOff = bAdcBackOff;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], bPreAdcBackOff=%d, bCurAdcBackOff=%d\n",\r\npCoexDm->bPreAdcBackOff, pCoexDm->bCurAdcBackOff));\r\nif(pCoexDm->bPreAdcBackOff == pCoexDm->bCurAdcBackOff)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetAdcBackOff(pBtCoexist, pCoexDm->bCurAdcBackOff);\r\npCoexDm->bPreAdcBackOff = pCoexDm->bCurAdcBackOff;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetAgcTable(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bAgcTableEn\r\n)\r\n{\r\nu1Byte rssiAdjustVal=0;\r\nif(bAgcTableEn)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table On!\n"));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x4e1c0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x4d1d0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x4c1e0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x4b1f0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x4a200001);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0xdc000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0x90000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0x51000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0x12000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x1a, 0xfffff, 0x00355);\r\nrssiAdjustVal = 6;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], Agc Table Off!\n"));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x641c0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x631d0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x621e0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x611f0001);\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0xc78,0x60200001);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0x32000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0x71000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0xb0000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x12, 0xfffff, 0xfc000);\r\npBtCoexist->btc_set_rf_reg(pBtCoexist, BTC_RF_A, 0x1a, 0xfffff, 0x30355);\r\n}\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_U1_RSSI_ADJ_VAL_FOR_AGC_TABLE_ON, &rssiAdjustVal);\r\n}\r\nVOID\r\nhalbtc8723a2ant_AgcTable(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bAgcTableEn\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s %s Agc Table\n",\r\n(bForceExec? "force to":""), ((bAgcTableEn)? "Enable":"Disable")));\r\npCoexDm->bCurAgcTableEn = bAgcTableEn;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], bPreAgcTableEn=%d, bCurAgcTableEn=%d\n",\r\npCoexDm->bPreAgcTableEn, pCoexDm->bCurAgcTableEn));\r\nif(pCoexDm->bPreAgcTableEn == pCoexDm->bCurAgcTableEn)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetAgcTable(pBtCoexist, bAgcTableEn);\r\npCoexDm->bPreAgcTableEn = pCoexDm->bCurAgcTableEn;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetCoexTable(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u4Byte val0x6c0,\r\nIN u4Byte val0x6c8,\r\nIN u1Byte val0x6cc\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], set coex table, set 0x6c0=0x%x\n", val0x6c0));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0x6c0, val0x6c0);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], set coex table, set 0x6c8=0x%x\n", val0x6c8));\r\npBtCoexist->btc_write_4byte(pBtCoexist, 0x6c8, val0x6c8);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_EXEC, ("[BTCoex], set coex table, set 0x6cc=0x%x\n", val0x6cc));\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x6cc, val0x6cc);\r\n}\r\nVOID\r\nhalbtc8723a2ant_CoexTable(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN u4Byte val0x6c0,\r\nIN u4Byte val0x6c8,\r\nIN u1Byte val0x6cc\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW, ("[BTCoex], %s write Coex Table 0x6c0=0x%x, 0x6c8=0x%x, 0x6cc=0x%x\n",\r\n(bForceExec? "force to":""), val0x6c0, val0x6c8, val0x6cc));\r\npCoexDm->curVal0x6c0 = val0x6c0;\r\npCoexDm->curVal0x6c8 = val0x6c8;\r\npCoexDm->curVal0x6cc = val0x6cc;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], preVal0x6c0=0x%x, preVal0x6c8=0x%x, preVal0x6cc=0x%x !!\n",\r\npCoexDm->preVal0x6c0, pCoexDm->preVal0x6c8, pCoexDm->preVal0x6cc));\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_SW_DETAIL, ("[BTCoex], curVal0x6c0=0x%x, curVal0x6c8=0x%x, curVal0x6cc=0x%x !!\n",\r\npCoexDm->curVal0x6c0, pCoexDm->curVal0x6c8, pCoexDm->curVal0x6cc));\r\nif( (pCoexDm->preVal0x6c0 == pCoexDm->curVal0x6c0) &&\r\n(pCoexDm->preVal0x6c8 == pCoexDm->curVal0x6c8) &&\r\n(pCoexDm->preVal0x6cc == pCoexDm->curVal0x6cc) )\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetCoexTable(pBtCoexist, val0x6c0, val0x6c8, val0x6cc);\r\npCoexDm->preVal0x6c0 = pCoexDm->curVal0x6c0;\r\npCoexDm->preVal0x6c8 = pCoexDm->curVal0x6c8;\r\npCoexDm->preVal0x6cc = pCoexDm->curVal0x6cc;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetFwIgnoreWlanAct(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bEnable\r\n)\r\n{\r\nu1Byte H2C_Parameter[1] ={0};\r\nif(bEnable)\r\n{\r\nH2C_Parameter[0] |= BIT0;\r\n}\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], set FW for BT Ignore Wlan_Act, FW write 0x25=0x%x\n",\r\nH2C_Parameter[0]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x25, 1, H2C_Parameter);\r\n}\r\nVOID\r\nhalbtc8723a2ant_IgnoreWlanAct(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bEnable\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], %s turn Ignore WlanAct %s\n",\r\n(bForceExec? "force to":""), (bEnable? "ON":"OFF")));\r\npCoexDm->bCurIgnoreWlanAct = bEnable;\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], bPreIgnoreWlanAct = %d, bCurIgnoreWlanAct = %d!!\n",\r\npCoexDm->bPreIgnoreWlanAct, pCoexDm->bCurIgnoreWlanAct));\r\nif(pCoexDm->bPreIgnoreWlanAct == pCoexDm->bCurIgnoreWlanAct)\r\nreturn;\r\n}\r\nhalbtc8723a2ant_SetFwIgnoreWlanAct(pBtCoexist, bEnable);\r\npCoexDm->bPreIgnoreWlanAct = pCoexDm->bCurIgnoreWlanAct;\r\n}\r\nVOID\r\nhalbtc8723a2ant_SetFwPstdma(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte byte1,\r\nIN u1Byte byte2,\r\nIN u1Byte byte3,\r\nIN u1Byte byte4,\r\nIN u1Byte byte5\r\n)\r\n{\r\nu1Byte H2C_Parameter[5] ={0};\r\nH2C_Parameter[0] = byte1;\r\nH2C_Parameter[1] = byte2;\r\nH2C_Parameter[2] = byte3;\r\nH2C_Parameter[3] = byte4;\r\nH2C_Parameter[4] = byte5;\r\npCoexDm->psTdmaPara[0] = byte1;\r\npCoexDm->psTdmaPara[1] = byte2;\r\npCoexDm->psTdmaPara[2] = byte3;\r\npCoexDm->psTdmaPara[3] = byte4;\r\npCoexDm->psTdmaPara[4] = byte5;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_EXEC, ("[BTCoex], FW write 0x3a(5bytes)=0x%x%08x\n",\r\nH2C_Parameter[0],\r\nH2C_Parameter[1]<<24|H2C_Parameter[2]<<16|H2C_Parameter[3]<<8|H2C_Parameter[4]));\r\npBtCoexist->btc_fill_h2c(pBtCoexist, 0x3a, 5, H2C_Parameter);\r\n}\r\nVOID\r\nhalbtc8723a2ant_PsTdma(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bForceExec,\r\nIN BOOLEAN bTurnOn,\r\nIN u1Byte type\r\n)\r\n{\r\nu4Byte btTxRxCnt=0;\r\nbtTxRxCnt = pCoexSta->highPriorityTx+pCoexSta->highPriorityRx+\r\npCoexSta->lowPriorityTx+pCoexSta->lowPriorityRx;\r\nif(btTxRxCnt > 3000)\r\n{\r\npCoexDm->bCurPsTdmaOn = true;\r\npCoexDm->curPsTdma = 8;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], turn ON PS TDMA, type=%d for BT tx/rx counters=%d(>3000)\n",\r\npCoexDm->curPsTdma, btTxRxCnt));\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], %s turn %s PS TDMA, type=%d\n",\r\n(bForceExec? "force to":""), (bTurnOn? "ON":"OFF"), type));\r\npCoexDm->bCurPsTdmaOn = bTurnOn;\r\npCoexDm->curPsTdma = type;\r\n}\r\nif(!bForceExec)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], bPrePsTdmaOn = %d, bCurPsTdmaOn = %d!!\n",\r\npCoexDm->bPrePsTdmaOn, pCoexDm->bCurPsTdmaOn));\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], prePsTdma = %d, curPsTdma = %d!!\n",\r\npCoexDm->prePsTdma, pCoexDm->curPsTdma));\r\nif( (pCoexDm->bPrePsTdmaOn == pCoexDm->bCurPsTdmaOn) &&\r\n(pCoexDm->prePsTdma == pCoexDm->curPsTdma) )\r\nreturn;\r\n}\r\nif(pCoexDm->bCurPsTdmaOn)\r\n{\r\nswitch(pCoexDm->curPsTdma)\r\n{\r\ncase 1:\r\ndefault:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x98);\r\nbreak;\r\ncase 2:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x98);\r\nbreak;\r\ncase 3:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0xe1, 0x98);\r\nbreak;\r\ncase 4:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x5, 0x5, 0xe1, 0x80);\r\nbreak;\r\ncase 5:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x98);\r\nbreak;\r\ncase 6:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x98);\r\nbreak;\r\ncase 7:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0x60, 0x98);\r\nbreak;\r\ncase 8:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x5, 0x5, 0x60, 0x80);\r\nbreak;\r\ncase 9:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x98);\r\nbreak;\r\ncase 10:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x98);\r\nbreak;\r\ncase 11:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0xe1, 0x98);\r\nbreak;\r\ncase 12:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x98);\r\nbreak;\r\ncase 13:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x98);\r\nbreak;\r\ncase 14:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x98);\r\nbreak;\r\ncase 15:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0x60, 0x98);\r\nbreak;\r\ncase 16:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0x60, 0x98);\r\nbreak;\r\ncase 17:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x2f, 0x2f, 0x60, 0x80);\r\nbreak;\r\ncase 18:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x98);\r\nbreak;\r\ncase 19:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0xe1, 0x98);\r\nbreak;\r\ncase 20:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0x60, 0x98);\r\nbreak;\r\n}\r\n}\r\nelse\r\n{\r\nswitch(pCoexDm->curPsTdma)\r\n{\r\ncase 0:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x8, 0x0);\r\nbreak;\r\ncase 1:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x0, 0x0);\r\nbreak;\r\ndefault:\r\nhalbtc8723a2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x8, 0x0);\r\nbreak;\r\n}\r\n}\r\npCoexDm->bPrePsTdmaOn = pCoexDm->bCurPsTdmaOn;\r\npCoexDm->prePsTdma = pCoexDm->curPsTdma;\r\n}\r\nVOID\r\nhalbtc8723a2ant_CoexAllOff(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\n}\r\nVOID\r\nhalbtc8723a2ant_InitCoexDm(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, FORCE_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, FORCE_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, FORCE_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, FORCE_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, FORCE_EXEC, FALSE, 0xc0);\r\n}\r\nVOID\r\nhalbtc8723a2ant_BtInquiryPage(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBOOLEAN bLowPwrDisable=true;\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\n}\r\nVOID\r\nhalbtc8723a2ant_BtEnableAction(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBOOLEAN bWifiConnected=FALSE;\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\nif(bWifiConnected)\r\n{\r\nhalbtc8723a2ant_IndicateWifiChnlBwInfo(pBtCoexist, BTC_MEDIA_CONNECT);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_IndicateWifiChnlBwInfo(pBtCoexist, BTC_MEDIA_DISCONNECT);\r\n}\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, FALSE);\r\n}\r\nVOID\r\nhalbtc8723a2ant_MonitorBtCtr(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu4Byte regHPTxRx, regLPTxRx, u4Tmp;\r\nu4Byte regHPTx=0, regHPRx=0, regLPTx=0, regLPRx=0;\r\nu1Byte u1Tmp;\r\nregHPTxRx = 0x770;\r\nregLPTxRx = 0x774;\r\nu4Tmp = pBtCoexist->btc_read_4byte(pBtCoexist, regHPTxRx);\r\nregHPTx = u4Tmp & MASKLWORD;\r\nregHPRx = (u4Tmp & MASKHWORD)>>16;\r\nu4Tmp = pBtCoexist->btc_read_4byte(pBtCoexist, regLPTxRx);\r\nregLPTx = u4Tmp & MASKLWORD;\r\nregLPRx = (u4Tmp & MASKHWORD)>>16;\r\npCoexSta->highPriorityTx = regHPTx;\r\npCoexSta->highPriorityRx = regHPRx;\r\npCoexSta->lowPriorityTx = regLPTx;\r\npCoexSta->lowPriorityRx = regLPRx;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], High Priority Tx/Rx (reg 0x%x)=0x%x(%d)/0x%x(%d)\n",\r\nregHPTxRx, regHPTx, regHPTx, regHPRx, regHPRx));\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], Low Priority Tx/Rx (reg 0x%x)=0x%x(%d)/0x%x(%d)\n",\r\nregLPTxRx, regLPTx, regLPTx, regLPRx, regLPRx));\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x76e, 0xc);\r\n}\r\nVOID\r\nhalbtc8723a2ant_MonitorBtEnableDisable(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nstatic BOOLEAN bPreBtDisabled=FALSE;\r\nstatic u4Byte btDisableCnt=0;\r\nBOOLEAN bBtActive=true, bBtDisabled=FALSE;\r\nif( pCoexSta->highPriorityTx == 0 &&\r\npCoexSta->highPriorityRx == 0 &&\r\npCoexSta->lowPriorityTx == 0 &&\r\npCoexSta->lowPriorityRx == 0)\r\n{\r\nbBtActive = FALSE;\r\n}\r\nif( pCoexSta->highPriorityTx == 0xffff &&\r\npCoexSta->highPriorityRx == 0xffff &&\r\npCoexSta->lowPriorityTx == 0xffff &&\r\npCoexSta->lowPriorityRx == 0xffff)\r\n{\r\nbBtActive = FALSE;\r\n}\r\nif(bBtActive)\r\n{\r\nbtDisableCnt = 0;\r\nbBtDisabled = FALSE;\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_BL_BT_DISABLE, &bBtDisabled);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], BT is enabled !!\n"));\r\n}\r\nelse\r\n{\r\nbtDisableCnt++;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], bt all counters=0, %d times!!\n",\r\nbtDisableCnt));\r\nif(btDisableCnt >= 2)\r\n{\r\nbBtDisabled = true;\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_BL_BT_DISABLE, &bBtDisabled);\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], BT is disabled !!\n"));\r\n}\r\n}\r\nif(bPreBtDisabled != bBtDisabled)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_BT_MONITOR, ("[BTCoex], BT is from %s to %s!!\n",\r\n(bPreBtDisabled ? "disabled":"enabled"),\r\n(bBtDisabled ? "disabled":"enabled")));\r\nbPreBtDisabled = bBtDisabled;\r\nif(!bBtDisabled)\r\n{\r\nhalbtc8723a2ant_BtEnableAction(pBtCoexist);\r\n}\r\n}\r\n}\r\nBOOLEAN\r\nhalbtc8723a2ant_IsCommonAction(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nPBTC_STACK_INFO pStackInfo=&pBtCoexist->stack_info;\r\nBOOLEAN bCommon=FALSE, bWifiConnected=FALSE;\r\nBOOLEAN bLowPwrDisable=FALSE;\r\nif(!pStackInfo->bBtLinkExist)\r\n{\r\nbLowPwrDisable = FALSE;\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\n}\r\nelse\r\n{\r\nbLowPwrDisable = true;\r\npBtCoexist->btc_set(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\r\n}\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\r\nif(halbtc8723a2ant_IsWifiIdle(pBtCoexist) &&\r\nBT_8723A_2ANT_BT_STATUS_IDLE == pCoexDm->btStatus)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi idle + Bt idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nbCommon = true;\r\n}\r\nelse if(!halbtc8723a2ant_IsWifiIdle(pBtCoexist) &&\r\n(BT_8723A_2ANT_BT_STATUS_IDLE == pCoexDm->btStatus) )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi non-idle + BT idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nbCommon = true;\r\n}\r\nelse if(halbtc8723a2ant_IsWifiIdle(pBtCoexist) &&\r\n(BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus) )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi idle + Bt connected idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nbCommon = true;\r\n}\r\nelse if(!halbtc8723a2ant_IsWifiIdle(pBtCoexist) &&\r\n(BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus) )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi non-idle + Bt connected idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nbCommon = true;\r\n}\r\nelse if(halbtc8723a2ant_IsWifiIdle(pBtCoexist) &&\r\n(BT_8723A_2ANT_BT_STATUS_NON_IDLE == pCoexDm->btStatus) )\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi idle + BT non-idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\nbCommon = true;\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Wifi non-idle + BT non-idle!!\n"));\r\nhalbtc8723a2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_RfShrink(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0x20);\r\nbCommon = FALSE;\r\n}\r\nreturn bCommon;\r\n}\r\nVOID\r\nhalbtc8723a2ant_TdmaDurationAdjust(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN BOOLEAN bScoHid,\r\nIN BOOLEAN bTxPause,\r\nIN u1Byte maxInterval\r\n)\r\n{\r\nstatic s4Byte up,dn,m,n,WaitCount;\r\ns4Byte result;\r\nu1Byte retryCount=0;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW, ("[BTCoex], TdmaDurationAdjust()\n"));\r\nif(pCoexDm->bResetTdmaAdjust)\r\n{\r\npCoexDm->bResetTdmaAdjust = FALSE;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], first run TdmaDurationAdjust()!!\n"));\r\n{\r\nif(bScoHid)\r\n{\r\nif(bTxPause)\r\n{\r\nif(maxInterval == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n}\r\nelse if(maxInterval == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(maxInterval == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\n}\r\nelse\r\n{\r\nif(maxInterval == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n}\r\nelse if(maxInterval == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(maxInterval == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nif(bTxPause)\r\n{\r\nif(maxInterval == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n}\r\nelse if(maxInterval == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(maxInterval == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\n}\r\nelse\r\n{\r\nif(maxInterval == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n}\r\nelse if(maxInterval == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(maxInterval == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\n}\r\n}\r\n}\r\nup = 0;\r\ndn = 0;\r\nm = 1;\r\nn= 3;\r\nresult = 0;\r\nWaitCount = 0;\r\n}\r\nelse\r\n{\r\nretryCount = pCoexSta->btRetryCnt;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], retryCount = %d\n", retryCount));\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], up=%d, dn=%d, m=%d, n=%d, WaitCount=%d\n",\r\nup, dn, m, n, WaitCount));\r\nresult = 0;\r\nWaitCount++;\r\nif(retryCount == 0)\r\n{\r\nup++;\r\ndn--;\r\nif (dn <= 0)\r\ndn = 0;\r\nif(up >= n)\r\n{\r\nWaitCount = 0;\r\nn = 3;\r\nup = 0;\r\ndn = 0;\r\nresult = 1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Increase wifi duration!!\n"));\r\n}\r\n}\r\nelse if (retryCount <= 3)\r\n{\r\nup--;\r\ndn++;\r\nif (up <= 0)\r\nup = 0;\r\nif (dn == 2)\r\n{\r\nif (WaitCount <= 2)\r\nm++;\r\nelse\r\nm = 1;\r\nif ( m >= 20)\r\nm = 20;\r\nn = 3*m;\r\nup = 0;\r\ndn = 0;\r\nWaitCount = 0;\r\nresult = -1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Decrease wifi duration for retryCounter<3!!\n"));\r\n}\r\n}\r\nelse\r\n{\r\nif (WaitCount == 1)\r\nm++;\r\nelse\r\nm = 1;\r\nif ( m >= 20)\r\nm = 20;\r\nn = 3*m;\r\nup = 0;\r\ndn = 0;\r\nWaitCount = 0;\r\nresult = -1;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], Decrease wifi duration for retryCounter>3!!\n"));\r\n}\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], max Interval = %d\n", maxInterval));\r\nif(maxInterval == 1)\r\n{\r\nif(bTxPause)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nelse if(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\r\npCoexDm->psTdmaDuAdjType = 5;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\npCoexDm->psTdmaDuAdjType = 13;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nelse if(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\r\npCoexDm->psTdmaDuAdjType = 1;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\npCoexDm->psTdmaDuAdjType = 9;\r\n}\r\n}\r\n}\r\n}\r\nelse if(maxInterval == 2)\r\n{\r\nif(bTxPause)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nelse if(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\npCoexDm->psTdmaDuAdjType = 6;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\npCoexDm->psTdmaDuAdjType = 14;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nelse if(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\npCoexDm->psTdmaDuAdjType = 2;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\npCoexDm->psTdmaDuAdjType = 10;\r\n}\r\n}\r\n}\r\n}\r\nelse if(maxInterval == 3)\r\n{\r\nif(bTxPause)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 1\n"));\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nif(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\npCoexDm->psTdmaDuAdjType = 8;\r\n}\r\nelse if(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\npCoexDm->psTdmaDuAdjType = 16;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 7);\r\npCoexDm->psTdmaDuAdjType = 7;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\npCoexDm->psTdmaDuAdjType = 15;\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], TxPause = 0\n"));\r\nif(pCoexDm->curPsTdma == 5)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 6)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 7)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 8)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nif(pCoexDm->curPsTdma == 13)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 14)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 15)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 16)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\nif(result == -1)\r\n{\r\nif(pCoexDm->curPsTdma == 1)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\npCoexDm->psTdmaDuAdjType = 4;\r\n}\r\nelse if(pCoexDm->curPsTdma == 9)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\npCoexDm->psTdmaDuAdjType = 12;\r\n}\r\n}\r\nelse if (result == 1)\r\n{\r\nif(pCoexDm->curPsTdma == 4)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 3)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 2)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\r\npCoexDm->psTdmaDuAdjType = 3;\r\n}\r\nelse if(pCoexDm->curPsTdma == 12)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 11)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\nelse if(pCoexDm->curPsTdma == 10)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\npCoexDm->psTdmaDuAdjType = 11;\r\n}\r\n}\r\n}\r\n}\r\n}\r\nif(pCoexDm->curPsTdma != pCoexDm->psTdmaDuAdjType)\r\n{\r\nBOOLEAN bScan=FALSE, bLink=FALSE, bRoam=FALSE;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], PsTdma type dismatch!!!, curPsTdma=%d, recordPsTdma=%d\n",\r\npCoexDm->curPsTdma, pCoexDm->psTdmaDuAdjType));\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\r\nif( !bScan && !bLink && !bRoam)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, pCoexDm->psTdmaDuAdjType);\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE_FW_DETAIL, ("[BTCoex], roaming/link/scan is under progress, will adjust next time!!!\n"));\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionSco(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1;\r\nu4Byte wifiBw;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 11);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 15);\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionHid(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1;\r\nu4Byte wifiBw;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionA2dp(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1, btInfoExt;\r\nu4Byte wifiBw;\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, FALSE, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, FALSE, 1);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, true, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, true, 1);\r\n}\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, FALSE, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, FALSE, 1);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, true, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, FALSE, true, 1);\r\n}\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionPanEdr(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1, btInfoExt;\r\nu4Byte wifiBw;\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionPanHs(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState;\r\nu4Byte wifiBw;\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\n}\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, FALSE, 0);\r\n}\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionPanEdrA2dp(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1, btInfoExt;\r\nu4Byte wifiBw;\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\n}\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 4);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 2);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 8);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 6);\r\n}\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionPanEdrHid(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1;\r\nu4Byte wifiBw;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\n}\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionHidA2dpPanEdr(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1, btInfoExt;\r\nu4Byte wifiBw;\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\n}\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 12);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 10);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 16);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 14);\r\n}\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_ActionHidA2dp(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte wifiRssiState, wifiRssiState1, btInfoExt;\r\nu4Byte wifiBw;\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nif(halbtc8723a2ant_NeedToDecBtPwr(pBtCoexist))\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, true);\r\nelse\r\nhalbtc8723a2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_CoexTable(pBtCoexist, NORMAL_EXEC, 0x55555555, 0xffff, 0x3);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\nif(BTC_WIFI_BW_HT40 == wifiBw)\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 37, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, FALSE, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, FALSE, 1);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, true, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, true, 1);\r\n}\r\n}\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nwifiRssiState = halbtc8723a2ant_WifiRssiState(pBtCoexist, 0, 2, 27, 0);\r\nwifiRssiState1 = halbtc8723a2ant_WifiRssiState(pBtCoexist, 1, 2, 47, 0);\r\nif( (wifiRssiState == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, FALSE, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, FALSE, 1);\r\n}\r\n}\r\nelse\r\n{\r\nif(btInfoExt&BIT0)\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, true, 3);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_TdmaDurationAdjust(pBtCoexist, true, true, 1);\r\n}\r\n}\r\nif( (wifiRssiState1 == BTC_RSSI_STATE_HIGH) ||\r\n(wifiRssiState1 == BTC_RSSI_STATE_STAY_HIGH) )\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, true);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\nelse\r\n{\r\nhalbtc8723a2ant_AgcTable(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_AdcBackOff(pBtCoexist, NORMAL_EXEC, FALSE);\r\nhalbtc8723a2ant_DacSwing(pBtCoexist, NORMAL_EXEC, FALSE, 0xc0);\r\n}\r\n}\r\n}\r\nVOID\r\nhalbtc8723a2ant_RunCoexistMechanism(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nPBTC_STACK_INFO pStackInfo=&pBtCoexist->stack_info;\r\nu1Byte btInfoOriginal=0, btRetryCnt=0;\r\nu1Byte algorithm=0;\r\nif(pBtCoexist->manual_control)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Manual control!!!\n"));\r\nreturn;\r\n}\r\nif(pStackInfo->bProfileNotified)\r\n{\r\nif(pCoexSta->bHoldForStackOperation)\r\n{\r\nreturn;\r\n}\r\nalgorithm = halbtc8723a2ant_ActionAlgorithm(pBtCoexist);\r\nif(pCoexSta->bHoldPeriodCnt && (BT_8723A_2ANT_COEX_ALGO_PANHS!=algorithm))\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex],Hold BT inquiry/page scan setting (cnt = %d)!!\n",\r\npCoexSta->bHoldPeriodCnt));\r\nif(pCoexSta->bHoldPeriodCnt >= 6)\r\n{\r\npCoexSta->bHoldPeriodCnt = 0;\r\n}\r\nelse\r\npCoexSta->bHoldPeriodCnt++;\r\nreturn;\r\n}\r\npCoexDm->curAlgorithm = algorithm;\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Algorithm = %d \n", pCoexDm->curAlgorithm));\r\nif(halbtc8723a2ant_IsCommonAction(pBtCoexist))\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant common.\n"));\r\npCoexDm->bResetTdmaAdjust = true;\r\n}\r\nelse\r\n{\r\nif(pCoexDm->curAlgorithm != pCoexDm->preAlgorithm)\r\n{\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], preAlgorithm=%d, curAlgorithm=%d\n",\r\npCoexDm->preAlgorithm, pCoexDm->curAlgorithm));\r\npCoexDm->bResetTdmaAdjust = true;\r\n}\r\nswitch(pCoexDm->curAlgorithm)\r\n{\r\ncase BT_8723A_2ANT_COEX_ALGO_SCO:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = SCO.\n"));\r\nhalbtc8723a2ant_ActionSco(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_HID:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID.\n"));\r\nhalbtc8723a2ant_ActionHid(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = A2DP.\n"));\r\nhalbtc8723a2ant_ActionA2dp(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_PANEDR:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN(EDR).\n"));\r\nhalbtc8723a2ant_ActionPanEdr(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_PANHS:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HS mode.\n"));\r\nhalbtc8723a2ant_ActionPanHs(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_PANEDR_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN+A2DP.\n"));\r\nhalbtc8723a2ant_ActionPanEdrA2dp(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_PANEDR_HID:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = PAN(EDR)+HID.\n"));\r\nhalbtc8723a2ant_ActionPanEdrHid(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_HID_A2DP_PANEDR:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID+A2DP+PAN.\n"));\r\nhalbtc8723a2ant_ActionHidA2dpPanEdr(pBtCoexist);\r\nbreak;\r\ncase BT_8723A_2ANT_COEX_ALGO_HID_A2DP:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = HID+A2DP.\n"));\r\nhalbtc8723a2ant_ActionHidA2dp(pBtCoexist);\r\nbreak;\r\ndefault:\r\nBTC_PRINT(BTC_MSG_ALGORITHM, ALGO_TRACE, ("[BTCoex], Action 2-Ant, algorithm = coexist All Off!!\n"));\r\nhalbtc8723a2ant_CoexAllOff(pBtCoexist);\r\nbreak;\r\n}\r\npCoexDm->preAlgorithm = pCoexDm->curAlgorithm;\r\n}\r\n}\r\n}\r\nVOID\r\nwa_halbtc8723a2ant_MonitorC2h(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu1Byte tmp1b=0x0;\r\nu4Byte curC2hTotalCnt=0x0;\r\nstatic u4Byte preC2hTotalCnt=0x0, sameCntPollingTime=0x0;\r\ncurC2hTotalCnt+=pCoexSta->btInfoC2hCnt[BT_INFO_SRC_8723A_2ANT_BT_RSP];\r\nif(curC2hTotalCnt == preC2hTotalCnt)\r\n{\r\nsameCntPollingTime++;\r\n}\r\nelse\r\n{\r\npreC2hTotalCnt = curC2hTotalCnt;\r\nsameCntPollingTime = 0;\r\n}\r\nif(sameCntPollingTime >= 2)\r\n{\r\ntmp1b = pBtCoexist->btc_read_1byte(pBtCoexist, 0x1af);\r\nif(tmp1b != 0x0)\r\n{\r\npCoexSta->c2hHangDetectCnt++;\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x1af, 0x0);\r\n}\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_InitHwConfig(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nu4Byte u4Tmp=0;\r\nu1Byte u1Tmp=0;\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], 2Ant Init HW Config!!\n"));\r\npCoexDm->btRf0x1eBackup =\r\npBtCoexist->btc_get_rf_reg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff);\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x76e, 0x4);\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x778, 0x3);\r\npBtCoexist->btc_write_1byte(pBtCoexist, 0x40, 0x20);\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_InitCoexDm(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_INIT, ("[BTCoex], Coex Mechanism Init!!\n"));\r\nhalbtc8723a2ant_InitCoexDm(pBtCoexist);\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_DisplayCoexInfo(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nstruct btc_board_info * pBoardInfo=&pBtCoexist->board_info;\r\nPBTC_STACK_INFO pStackInfo=&pBtCoexist->stack_info;\r\npu1Byte cliBuf=pBtCoexist->cli_buf;\r\nu1Byte u1Tmp[4], i, btInfoExt, psTdmaCase=0;\r\nu4Byte u4Tmp[4];\r\nBOOLEAN bRoam=FALSE, bScan=FALSE, bLink=FALSE, bWifiUnder5G=FALSE;\r\nBOOLEAN bBtHsOn=FALSE, bWifiBusy=FALSE;\r\ns4Byte wifiRssi=0, btHsRssi=0;\r\nu4Byte wifiBw, wifiTrafficDir;\r\nu1Byte wifiDot11Chnl, wifiHsChnl;\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n ============[BT Coexist info]============");\r\nCL_PRINTF(cliBuf);\r\nif(!pBoardInfo->bt_exist)\r\n{\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n BT not exists !!!");\r\nCL_PRINTF(cliBuf);\r\nreturn;\r\n}\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d ", "Ant PG number/ Ant mechanism:", \\r\npBoardInfo->pg_ant_num, pBoardInfo->btdm_ant_num);\r\nCL_PRINTF(cliBuf);\r\nif(pBtCoexist->manual_control)\r\n{\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "[Action Manual control]!!");\r\nCL_PRINTF(cliBuf);\r\n}\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %s / %d", "BT stack/ hci ext ver", \\r\n((pStackInfo->bProfileNotified)? "Yes":"No"), pStackInfo->hciVersion);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U1_WIFI_DOT11_CHNL, &wifiDot11Chnl);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U1_WIFI_HS_CHNL, &wifiHsChnl);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d / %d(%d)", "Dot11 channel / HsChnl(HsMode)", \\r\nwifiDot11Chnl, wifiHsChnl, bBtHsOn);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %02x %02x %02x ", "H2C Wifi inform bt chnl Info", \\r\npCoexDm->wifiChnlInfo[0], pCoexDm->wifiChnlInfo[1],\r\npCoexDm->wifiChnlInfo[2]);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_S4_WIFI_RSSI, &wifiRssi);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_S4_HS_RSSI, &btHsRssi);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d", "Wifi rssi/ HS rssi", \\r\nwifiRssi, btHsRssi);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d/ %d ", "Wifi bLink/ bRoam/ bScan", \\r\nbLink, bRoam, bScan);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_UNDER_5G, &bWifiUnder5G);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_U4_WIFI_TRAFFIC_DIRECTION, &wifiTrafficDir);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %s / %s/ %s ", "Wifi status", \\r\n(bWifiUnder5G? "5G":"2.4G"),\r\n((BTC_WIFI_BW_LEGACY==wifiBw)? "Legacy": (((BTC_WIFI_BW_HT40==wifiBw)? "HT40":"HT20"))),\r\n((!bWifiBusy)? "idle": ((BTC_WIFI_TRAFFIC_TX==wifiTrafficDir)? "uplink":"downlink")));\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = [%s/ %d/ %d] ", "BT [status/ rssi/ retryCnt]", \\r\n((pCoexSta->bC2hBtInquiryPage)?("inquiry/page scan"):((BT_8723A_2ANT_BT_STATUS_IDLE == pCoexDm->btStatus)? "idle":( (BT_8723A_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus)? "connected-idle":"busy"))),\r\npCoexSta->btRssi, pCoexSta->btRetryCnt);\r\nCL_PRINTF(cliBuf);\r\nif(pStackInfo->bProfileNotified)\r\n{\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d / %d / %d / %d", "SCO/HID/PAN/A2DP", \\r\npStackInfo->bScoExist, pStackInfo->bHidExist, pStackInfo->bPanExist, pStackInfo->bA2dpExist);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_disp_dbg_msg(pBtCoexist, BTC_DBG_DISP_BT_LINK_INFO);\r\n}\r\nbtInfoExt = pCoexSta->btInfoExt;\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %s", "BT Info A2DP rate", \\r\n(btInfoExt&BIT0)? "Basic rate":"EDR rate");\r\nCL_PRINTF(cliBuf);\r\nfor(i=0; i<BT_INFO_SRC_8723A_2ANT_MAX; i++)\r\n{\r\nif(pCoexSta->btInfoC2hCnt[i])\r\n{\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %02x %02x %02x %02x %02x %02x %02x(%d)", GLBtInfoSrc8723a2Ant[i], \\r\npCoexSta->btInfoC2h[i][0], pCoexSta->btInfoC2h[i][1],\r\npCoexSta->btInfoC2h[i][2], pCoexSta->btInfoC2h[i][3],\r\npCoexSta->btInfoC2h[i][4], pCoexSta->btInfoC2h[i][5],\r\npCoexSta->btInfoC2h[i][6], pCoexSta->btInfoC2hCnt[i]);\r\nCL_PRINTF(cliBuf);\r\n}\r\n}\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d", "write 0x1af=0x0 num", \\r\npCoexSta->c2hHangDetectCnt);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "============[Sw mechanism]============");\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d/ %d", "SM1[ShRf/ LpRA/ LimDig]", \\r\npCoexDm->bCurRfRxLpfShrink, pCoexDm->bCurLowPenaltyRa, pCoexDm->limited_dig);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d/ %d(0x%x) ", "SM2[AgcT/ AdcB/ SwDacSwing(lvl)]", \\r\npCoexDm->bCurAgcTableEn, pCoexDm->bCurAdcBackOff, pCoexDm->bCurDacSwingOn, pCoexDm->curDacSwingLvl);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "============[Fw mechanism]============");\r\nCL_PRINTF(cliBuf);\r\nif(!pBtCoexist->manual_control)\r\n{\r\npsTdmaCase = pCoexDm->curPsTdma;\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %02x %02x %02x %02x %02x case-%d", "PS TDMA", \\r\npCoexDm->psTdmaPara[0], pCoexDm->psTdmaPara[1],\r\npCoexDm->psTdmaPara[2], pCoexDm->psTdmaPara[3],\r\npCoexDm->psTdmaPara[4], psTdmaCase);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d ", "DecBtPwr/ IgnWlanAct", \\r\npCoexDm->bCurDecBtPwr, pCoexDm->bCurIgnoreWlanAct);\r\nCL_PRINTF(cliBuf);\r\n}\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s", "============[Hw setting]============");\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "RF-A, 0x1e initVal", \\r\npCoexDm->btRf0x1eBackup);\r\nCL_PRINTF(cliBuf);\r\nu1Tmp[0] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x778);\r\nu1Tmp[1] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x783);\r\nu1Tmp[2] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x796);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x/ 0x%x/ 0x%x", "0x778/ 0x783/ 0x796", \\r\nu1Tmp[0], u1Tmp[1], u1Tmp[2]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x880);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "0x880", \\r\nu4Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nu1Tmp[0] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x40);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "0x40", \\r\nu1Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x550);\r\nu1Tmp[0] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x522);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x/ 0x%x", "0x550(bcn ctrl)/0x522", \\r\nu4Tmp[0], u1Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x484);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "0x484(rate adaptive)", \\r\nu4Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0xc50);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "0xc50(dig)", \\r\nu4Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0xda0);\r\nu4Tmp[1] = pBtCoexist->btc_read_4byte(pBtCoexist, 0xda4);\r\nu4Tmp[2] = pBtCoexist->btc_read_4byte(pBtCoexist, 0xda8);\r\nu4Tmp[3] = pBtCoexist->btc_read_4byte(pBtCoexist, 0xdac);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x/ 0x%x/ 0x%x/ 0x%x", "0xda0/0xda4/0xda8/0xdac(FA cnt)", \\r\nu4Tmp[0], u4Tmp[1], u4Tmp[2], u4Tmp[3]);\r\nCL_PRINTF(cliBuf);\r\nu4Tmp[0] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x6c0);\r\nu4Tmp[1] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x6c4);\r\nu4Tmp[2] = pBtCoexist->btc_read_4byte(pBtCoexist, 0x6c8);\r\nu1Tmp[0] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x6cc);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x/ 0x%x/ 0x%x/ 0x%x", "0x6c0/0x6c4/0x6c8/0x6cc(coexTable)", \\r\nu4Tmp[0], u4Tmp[1], u4Tmp[2], u1Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d", "0x770 (hp rx[31:16]/tx[15:0])", \\r\npCoexSta->highPriorityRx, pCoexSta->highPriorityTx);\r\nCL_PRINTF(cliBuf);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = %d/ %d", "0x774(lp rx[31:16]/tx[15:0])", \\r\npCoexSta->lowPriorityRx, pCoexSta->lowPriorityTx);\r\nCL_PRINTF(cliBuf);\r\nu1Tmp[0] = pBtCoexist->btc_read_1byte(pBtCoexist, 0x41b);\r\nCL_SPRINTF(cliBuf, BT_TMP_BUF_SIZE, "\r\n %-35s = 0x%x", "0x41b (mgntQ hang chk == 0xf)", \\r\nu1Tmp[0]);\r\nCL_PRINTF(cliBuf);\r\npBtCoexist->btc_disp_dbg_msg(pBtCoexist, BTC_DBG_DISP_COEX_STATISTICS);\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_IpsNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_IPS_ENTER == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], IPS ENTER notify\n"));\r\nhalbtc8723a2ant_CoexAllOff(pBtCoexist);\r\n}\r\nelse if(BTC_IPS_LEAVE == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], IPS LEAVE notify\n"));\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_LpsNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_LPS_ENABLE == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], LPS ENABLE notify\n"));\r\n}\r\nelse if(BTC_LPS_DISABLE == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], LPS DISABLE notify\n"));\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_ScanNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_SCAN_START == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], SCAN START notify\n"));\r\n}\r\nelse if(BTC_SCAN_FINISH == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], SCAN FINISH notify\n"));\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_ConnectNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_ASSOCIATE_START == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], CONNECT START notify\n"));\r\n}\r\nelse if(BTC_ASSOCIATE_FINISH == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], CONNECT FINISH notify\n"));\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_MediaStatusNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_MEDIA_CONNECT == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], MEDIA connect notify\n"));\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], MEDIA disconnect notify\n"));\r\n}\r\nhalbtc8723a2ant_IndicateWifiChnlBwInfo(pBtCoexist, type);\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_SpecialPacketNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(type == BTC_PACKET_DHCP)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], DHCP Packet notify\n"));\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_BtInfoNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN pu1Byte tmpBuf,\r\nIN u1Byte length\r\n)\r\n{\r\nu1Byte btInfo=0;\r\nu1Byte i, rspSource=0;\r\nBOOLEAN bBtBusy=FALSE, limited_dig=FALSE;\r\nBOOLEAN bWifiConnected=FALSE, bBtHsOn=FALSE;\r\npCoexSta->bC2hBtInfoReqSent = FALSE;\r\nrspSource = BT_INFO_SRC_8723A_2ANT_BT_RSP;\r\npCoexSta->btInfoC2hCnt[rspSource]++;\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Bt info[%d], length=%d, hex data=[", rspSource, length));\r\nfor(i=0; i<length; i++)\r\n{\r\npCoexSta->btInfoC2h[rspSource][i] = tmpBuf[i];\r\nif(i == 0)\r\nbtInfo = tmpBuf[i];\r\nif(i == length-1)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("0x%02x]\n", tmpBuf[i]));\r\n}\r\nelse\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("0x%02x, ", tmpBuf[i]));\r\n}\r\n}\r\nif(BT_INFO_SRC_8723A_2ANT_WIFI_FW != rspSource)\r\n{\r\npCoexSta->btRetryCnt =\r\npCoexSta->btInfoC2h[rspSource][1];\r\npCoexSta->btRssi =\r\npCoexSta->btInfoC2h[rspSource][2]*2+10;\r\npCoexSta->btInfoExt =\r\npCoexSta->btInfoC2h[rspSource][3];\r\n}\r\npBtCoexist->btc_get(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\r\nif(btInfo & BT_INFO_8723A_2ANT_B_INQ_PAGE)\r\n{\r\npCoexSta->bC2hBtInquiryPage = true;\r\n}\r\nelse\r\n{\r\npCoexSta->bC2hBtInquiryPage = FALSE;\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_StackOperationNotify(\r\nIN PBTC_COEXIST pBtCoexist,\r\nIN u1Byte type\r\n)\r\n{\r\nif(BTC_STACK_OP_INQ_PAGE_PAIR_START == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], StackOP Inquiry/page/pair start notify\n"));\r\npCoexSta->bHoldForStackOperation = true;\r\npCoexSta->bHoldPeriodCnt = 1;\r\nhalbtc8723a2ant_BtInquiryPage(pBtCoexist);\r\n}\r\nelse if(BTC_STACK_OP_INQ_PAGE_PAIR_FINISH == type)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], StackOP Inquiry/page/pair finish notify\n"));\r\npCoexSta->bHoldForStackOperation = FALSE;\r\n}\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_HaltNotify(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], Halt notify\n"));\r\nhalbtc8723a2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, true);\r\nEXhalbtc8723a2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_DISCONNECT);\r\n}\r\nVOID\r\nEXhalbtc8723a2ant_Periodical(\r\nIN PBTC_COEXIST pBtCoexist\r\n)\r\n{\r\nBTC_PRINT(BTC_MSG_INTERFACE, INTF_NOTIFY, ("[BTCoex], 2Ant Periodical!!\n"));\r\nwa_halbtc8723a2ant_MonitorC2h(pBtCoexist);\r\nhalbtc8723a2ant_QueryBtInfo(pBtCoexist);\r\nhalbtc8723a2ant_MonitorBtCtr(pBtCoexist);\r\nhalbtc8723a2ant_MonitorBtEnableDisable(pBtCoexist);\r\nhalbtc8723a2ant_RunCoexistMechanism(pBtCoexist);\r\n}
