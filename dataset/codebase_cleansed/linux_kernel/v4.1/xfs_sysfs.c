static inline struct xfs_sysfs_attr *\r\nto_attr(struct attribute *attr)\r\n{\r\nreturn container_of(attr, struct xfs_sysfs_attr, attr);\r\n}\r\nSTATIC ssize_t\r\nlog_recovery_delay_store(\r\nconst char *buf,\r\nsize_t count,\r\nvoid *data)\r\n{\r\nint ret;\r\nint val;\r\nret = kstrtoint(buf, 0, &val);\r\nif (ret)\r\nreturn ret;\r\nif (val < 0 || val > 60)\r\nreturn -EINVAL;\r\nxfs_globals.log_recovery_delay = val;\r\nreturn count;\r\n}\r\nSTATIC ssize_t\r\nlog_recovery_delay_show(\r\nchar *buf,\r\nvoid *data)\r\n{\r\nreturn snprintf(buf, PAGE_SIZE, "%d\n", xfs_globals.log_recovery_delay);\r\n}\r\nSTATIC ssize_t\r\nxfs_dbg_show(\r\nstruct kobject *kobject,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct xfs_sysfs_attr *xfs_attr = to_attr(attr);\r\nreturn xfs_attr->show ? xfs_attr->show(buf, NULL) : 0;\r\n}\r\nSTATIC ssize_t\r\nxfs_dbg_store(\r\nstruct kobject *kobject,\r\nstruct attribute *attr,\r\nconst char *buf,\r\nsize_t count)\r\n{\r\nstruct xfs_sysfs_attr *xfs_attr = to_attr(attr);\r\nreturn xfs_attr->store ? xfs_attr->store(buf, count, NULL) : 0;\r\n}\r\nSTATIC ssize_t\r\nlog_head_lsn_show(\r\nchar *buf,\r\nvoid *data)\r\n{\r\nstruct xlog *log = data;\r\nint cycle;\r\nint block;\r\nspin_lock(&log->l_icloglock);\r\ncycle = log->l_curr_cycle;\r\nblock = log->l_curr_block;\r\nspin_unlock(&log->l_icloglock);\r\nreturn snprintf(buf, PAGE_SIZE, "%d:%d\n", cycle, block);\r\n}\r\nSTATIC ssize_t\r\nlog_tail_lsn_show(\r\nchar *buf,\r\nvoid *data)\r\n{\r\nstruct xlog *log = data;\r\nint cycle;\r\nint block;\r\nxlog_crack_atomic_lsn(&log->l_tail_lsn, &cycle, &block);\r\nreturn snprintf(buf, PAGE_SIZE, "%d:%d\n", cycle, block);\r\n}\r\nSTATIC ssize_t\r\nreserve_grant_head_show(\r\nchar *buf,\r\nvoid *data)\r\n{\r\nstruct xlog *log = data;\r\nint cycle;\r\nint bytes;\r\nxlog_crack_grant_head(&log->l_reserve_head.grant, &cycle, &bytes);\r\nreturn snprintf(buf, PAGE_SIZE, "%d:%d\n", cycle, bytes);\r\n}\r\nSTATIC ssize_t\r\nwrite_grant_head_show(\r\nchar *buf,\r\nvoid *data)\r\n{\r\nstruct xlog *log = data;\r\nint cycle;\r\nint bytes;\r\nxlog_crack_grant_head(&log->l_write_head.grant, &cycle, &bytes);\r\nreturn snprintf(buf, PAGE_SIZE, "%d:%d\n", cycle, bytes);\r\n}\r\nstatic inline struct xlog *\r\nto_xlog(struct kobject *kobject)\r\n{\r\nstruct xfs_kobj *kobj = to_kobj(kobject);\r\nreturn container_of(kobj, struct xlog, l_kobj);\r\n}\r\nSTATIC ssize_t\r\nxfs_log_show(\r\nstruct kobject *kobject,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct xlog *log = to_xlog(kobject);\r\nstruct xfs_sysfs_attr *xfs_attr = to_attr(attr);\r\nreturn xfs_attr->show ? xfs_attr->show(buf, log) : 0;\r\n}\r\nSTATIC ssize_t\r\nxfs_log_store(\r\nstruct kobject *kobject,\r\nstruct attribute *attr,\r\nconst char *buf,\r\nsize_t count)\r\n{\r\nstruct xlog *log = to_xlog(kobject);\r\nstruct xfs_sysfs_attr *xfs_attr = to_attr(attr);\r\nreturn xfs_attr->store ? xfs_attr->store(buf, count, log) : 0;\r\n}
