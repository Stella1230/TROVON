static int dbx500_cpufreq_target(struct cpufreq_policy *policy,\r\nunsigned int index)\r\n{\r\nreturn clk_set_rate(armss_clk, freq_table[index].frequency * 1000);\r\n}\r\nstatic int dbx500_cpufreq_init(struct cpufreq_policy *policy)\r\n{\r\npolicy->clk = armss_clk;\r\nreturn cpufreq_generic_init(policy, freq_table, 20 * 1000);\r\n}\r\nstatic int dbx500_cpufreq_probe(struct platform_device *pdev)\r\n{\r\nstruct cpufreq_frequency_table *pos;\r\nfreq_table = dev_get_platdata(&pdev->dev);\r\nif (!freq_table) {\r\npr_err("dbx500-cpufreq: Failed to fetch cpufreq table\n");\r\nreturn -ENODEV;\r\n}\r\narmss_clk = clk_get(&pdev->dev, "armss");\r\nif (IS_ERR(armss_clk)) {\r\npr_err("dbx500-cpufreq: Failed to get armss clk\n");\r\nreturn PTR_ERR(armss_clk);\r\n}\r\npr_info("dbx500-cpufreq: Available frequencies:\n");\r\ncpufreq_for_each_entry(pos, freq_table)\r\npr_info(" %d Mhz\n", pos->frequency / 1000);\r\nreturn cpufreq_register_driver(&dbx500_cpufreq_driver);\r\n}\r\nstatic int __init dbx500_cpufreq_register(void)\r\n{\r\nreturn platform_driver_register(&dbx500_cpufreq_plat_driver);\r\n}
