static void __init socfpga_scu_map_io(void)\r\n{\r\nunsigned long base;\r\nasm("mrc p15, 4, %0, c15, c0, 0" : "=r" (base));\r\nscu_io_desc.pfn = __phys_to_pfn(base);\r\niotable_init(&scu_io_desc, 1);\r\n}\r\nstatic void __init socfpga_map_io(void)\r\n{\r\nsocfpga_scu_map_io();\r\niotable_init(&uart_io_desc, 1);\r\nearly_printk("Early printk initialized\n");\r\n}\r\nvoid __init socfpga_sysmgr_init(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_compatible_node(NULL, NULL, "altr,sys-mgr");\r\nif (of_property_read_u32(np, "cpu1-start-addr",\r\n(u32 *) &socfpga_cpu1start_addr))\r\npr_err("SMP: Need cpu1-start-addr in device tree.\n");\r\nsmp_wmb();\r\nsync_cache_w(&socfpga_cpu1start_addr);\r\nsys_manager_base_addr = of_iomap(np, 0);\r\nnp = of_find_compatible_node(NULL, NULL, "altr,rst-mgr");\r\nrst_manager_base_addr = of_iomap(np, 0);\r\n}\r\nstatic void __init socfpga_init_irq(void)\r\n{\r\nirqchip_init();\r\nsocfpga_sysmgr_init();\r\n}\r\nstatic void socfpga_cyclone5_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nu32 temp;\r\ntemp = readl(rst_manager_base_addr + SOCFPGA_RSTMGR_CTRL);\r\nif (mode == REBOOT_HARD)\r\ntemp |= RSTMGR_CTRL_SWCOLDRSTREQ;\r\nelse\r\ntemp |= RSTMGR_CTRL_SWWARMRSTREQ;\r\nwritel(temp, rst_manager_base_addr + SOCFPGA_RSTMGR_CTRL);\r\n}
