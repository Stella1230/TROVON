static int ehci_sead3_setup(struct usb_hcd *hcd)\r\n{\r\nint ret;\r\nstruct ehci_hcd *ehci = hcd_to_ehci(hcd);\r\nehci->caps = hcd->regs + 0x100;\r\n#ifdef __BIG_ENDIAN\r\nehci->big_endian_mmio = 1;\r\nehci->big_endian_desc = 1;\r\n#endif\r\nret = ehci_setup(hcd);\r\nif (ret)\r\nreturn ret;\r\nehci->need_io_watchdog = 0;\r\nehci_writel(ehci, 0x1010, &ehci->regs->reserved1[1]);\r\nreturn ret;\r\n}\r\nstatic int ehci_hcd_sead3_drv_probe(struct platform_device *pdev)\r\n{\r\nstruct usb_hcd *hcd;\r\nstruct resource *res;\r\nint ret;\r\nif (usb_disabled())\r\nreturn -ENODEV;\r\nif (pdev->resource[1].flags != IORESOURCE_IRQ) {\r\npr_debug("resource[1] is not IORESOURCE_IRQ");\r\nreturn -ENOMEM;\r\n}\r\nhcd = usb_create_hcd(&ehci_sead3_hc_driver, &pdev->dev, "SEAD-3");\r\nif (!hcd)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nhcd->regs = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(hcd->regs)) {\r\nret = PTR_ERR(hcd->regs);\r\ngoto err1;\r\n}\r\nhcd->rsrc_start = res->start;\r\nhcd->rsrc_len = resource_size(res);\r\nhcd->has_tt = 1;\r\nret = usb_add_hcd(hcd, pdev->resource[1].start,\r\nIRQF_SHARED);\r\nif (ret == 0) {\r\nplatform_set_drvdata(pdev, hcd);\r\ndevice_wakeup_enable(hcd->self.controller);\r\nreturn ret;\r\n}\r\nerr1:\r\nusb_put_hcd(hcd);\r\nreturn ret;\r\n}\r\nstatic int ehci_hcd_sead3_drv_remove(struct platform_device *pdev)\r\n{\r\nstruct usb_hcd *hcd = platform_get_drvdata(pdev);\r\nusb_remove_hcd(hcd);\r\nusb_put_hcd(hcd);\r\nreturn 0;\r\n}\r\nstatic int ehci_hcd_sead3_drv_suspend(struct device *dev)\r\n{\r\nstruct usb_hcd *hcd = dev_get_drvdata(dev);\r\nbool do_wakeup = device_may_wakeup(dev);\r\nreturn ehci_suspend(hcd, do_wakeup);\r\n}\r\nstatic int ehci_hcd_sead3_drv_resume(struct device *dev)\r\n{\r\nstruct usb_hcd *hcd = dev_get_drvdata(dev);\r\nehci_resume(hcd, false);\r\nreturn 0;\r\n}
