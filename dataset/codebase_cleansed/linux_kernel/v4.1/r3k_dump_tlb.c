static void dump_tlb(int first, int last)\r\n{\r\nint i;\r\nunsigned int asid;\r\nunsigned long entryhi, entrylo0;\r\nasid = read_c0_entryhi() & ASID_MASK;\r\nfor (i = first; i <= last; i++) {\r\nwrite_c0_index(i<<8);\r\n__asm__ __volatile__(\r\n".set\tnoreorder\n\t"\r\n"tlbr\n\t"\r\n"nop\n\t"\r\n".set\treorder");\r\nentryhi = read_c0_entryhi();\r\nentrylo0 = read_c0_entrylo0();\r\nif ((entryhi & PAGE_MASK) != KSEG0\r\n&& (entryhi & ASID_MASK) == asid) {\r\nprintk("Index: %2d ", i);\r\nprintk("va=%08lx asid=%08lx"\r\n" [pa=%06lx n=%d d=%d v=%d g=%d]",\r\nentryhi & PAGE_MASK,\r\nentryhi & ASID_MASK,\r\nentrylo0 & PAGE_MASK,\r\n(entrylo0 & (1 << 11)) ? 1 : 0,\r\n(entrylo0 & (1 << 10)) ? 1 : 0,\r\n(entrylo0 & (1 << 9)) ? 1 : 0,\r\n(entrylo0 & (1 << 8)) ? 1 : 0);\r\n}\r\n}\r\nprintk("\n");\r\nwrite_c0_entryhi(asid);\r\n}\r\nvoid dump_tlb_all(void)\r\n{\r\ndump_tlb(0, current_cpu_data.tlbsize - 1);\r\n}
