static void resend_irqs(unsigned long arg)\r\n{\r\nstruct irq_desc *desc;\r\nint irq;\r\nwhile (!bitmap_empty(irqs_resend, nr_irqs)) {\r\nirq = find_first_bit(irqs_resend, nr_irqs);\r\nclear_bit(irq, irqs_resend);\r\ndesc = irq_to_desc(irq);\r\nlocal_irq_disable();\r\ndesc->handle_irq(irq, desc);\r\nlocal_irq_enable();\r\n}\r\n}\r\nvoid check_irq_resend(struct irq_desc *desc, unsigned int irq)\r\n{\r\nif (irq_settings_is_level(desc)) {\r\ndesc->istate &= ~IRQS_PENDING;\r\nreturn;\r\n}\r\nif (desc->istate & IRQS_REPLAY)\r\nreturn;\r\nif (desc->istate & IRQS_PENDING) {\r\ndesc->istate &= ~IRQS_PENDING;\r\ndesc->istate |= IRQS_REPLAY;\r\nif (!desc->irq_data.chip->irq_retrigger ||\r\n!desc->irq_data.chip->irq_retrigger(&desc->irq_data)) {\r\n#ifdef CONFIG_HARDIRQS_SW_RESEND\r\nif (desc->parent_irq &&\r\nirq_settings_is_nested_thread(desc))\r\nirq = desc->parent_irq;\r\nset_bit(irq, irqs_resend);\r\ntasklet_schedule(&resend_tasklet);\r\n#endif\r\n}\r\n}\r\n}
