static int\r\nnv1a_ram_create(struct nvkm_object *parent, struct nvkm_object *engine,\r\nstruct nvkm_oclass *oclass, void *data, u32 size,\r\nstruct nvkm_object **pobject)\r\n{\r\nstruct nvkm_fb *pfb = nvkm_fb(parent);\r\nstruct nvkm_ram *ram;\r\nstruct pci_dev *bridge;\r\nu32 mem, mib;\r\nint ret;\r\nbridge = pci_get_bus_and_slot(0, PCI_DEVFN(0, 1));\r\nif (!bridge) {\r\nnv_fatal(pfb, "no bridge device\n");\r\nreturn -ENODEV;\r\n}\r\nret = nvkm_ram_create(parent, engine, oclass, &ram);\r\n*pobject = nv_object(ram);\r\nif (ret)\r\nreturn ret;\r\nif (nv_device(pfb)->chipset == 0x1a) {\r\npci_read_config_dword(bridge, 0x7c, &mem);\r\nmib = ((mem >> 6) & 31) + 1;\r\n} else {\r\npci_read_config_dword(bridge, 0x84, &mem);\r\nmib = ((mem >> 4) & 127) + 1;\r\n}\r\nram->type = NV_MEM_TYPE_STOLEN;\r\nram->size = mib * 1024 * 1024;\r\nreturn 0;\r\n}
