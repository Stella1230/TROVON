unsigned int cfs_rand(void)\r\n{\r\nseed_x = RANDOM_CONST_A * (seed_x & 65535) + (seed_x >> 16);\r\nseed_y = RANDOM_CONST_B * (seed_y & 65535) + (seed_y >> 16);\r\nreturn ((seed_x << 16) + (seed_y & 65535));\r\n}\r\nvoid cfs_srand(unsigned int seed1, unsigned int seed2)\r\n{\r\nif (seed1)\r\nseed_x = seed1;\r\nif (seed2)\r\nseed_y = seed2;\r\n}\r\nvoid cfs_get_random_bytes(void *buf, int size)\r\n{\r\nint *p = buf;\r\nint rem, tmp;\r\nLASSERT(size >= 0);\r\nrem = min((int)((unsigned long)buf & (sizeof(int) - 1)), size);\r\nif (rem) {\r\nget_random_bytes(&tmp, sizeof(tmp));\r\ntmp ^= cfs_rand();\r\nmemcpy(buf, &tmp, rem);\r\np = buf + rem;\r\nsize -= rem;\r\n}\r\nwhile (size >= sizeof(int)) {\r\nget_random_bytes(&tmp, sizeof(tmp));\r\n*p = cfs_rand() ^ tmp;\r\nsize -= sizeof(int);\r\np++;\r\n}\r\nbuf = p;\r\nif (size) {\r\nget_random_bytes(&tmp, sizeof(tmp));\r\ntmp ^= cfs_rand();\r\nmemcpy(buf, &tmp, size);\r\n}\r\n}
