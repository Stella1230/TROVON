static void __init u8500_map_io(void)\r\n{\r\niotable_init(u8500_uart_io_desc, ARRAY_SIZE(u8500_uart_io_desc));\r\nux500_map_io();\r\niotable_init(u8500_common_io_desc, ARRAY_SIZE(u8500_common_io_desc));\r\nif (cpu_is_ux540_family())\r\niotable_init(u9540_io_desc, ARRAY_SIZE(u9540_io_desc));\r\nelse\r\niotable_init(u8500_io_desc, ARRAY_SIZE(u8500_io_desc));\r\n}\r\nstatic irqreturn_t db8500_pmu_handler(int irq, void *dev, irq_handler_t handler)\r\n{\r\nirqreturn_t ret = handler(irq, dev);\r\nint other = !smp_processor_id();\r\nif (ret == IRQ_NONE && cpu_online(other))\r\nirq_set_affinity(irq, cpumask_of(other));\r\nreturn ret;\r\n}\r\nstatic const char *db8500_read_soc_id(void)\r\n{\r\nvoid __iomem *uid = __io_address(U8500_BB_UID_BASE);\r\nadd_device_randomness(uid, 0x14);\r\nreturn kasprintf(GFP_KERNEL, "%08x%08x%08x%08x%08x",\r\nreadl((u32 *)uid+0),\r\nreadl((u32 *)uid+1), readl((u32 *)uid+2),\r\nreadl((u32 *)uid+3), readl((u32 *)uid+4));\r\n}\r\nstatic struct device * __init db8500_soc_device_init(void)\r\n{\r\nconst char *soc_id = db8500_read_soc_id();\r\nreturn ux500_soc_device_init(soc_id);\r\n}\r\nstatic void __init u8500_init_machine(void)\r\n{\r\nstruct device *parent = db8500_soc_device_init();\r\nif (of_machine_is_compatible("st-ericsson,u8540"))\r\nof_platform_populate(NULL, u8500_local_bus_nodes,\r\nu8540_auxdata_lookup, parent);\r\nelse\r\nof_platform_populate(NULL, u8500_local_bus_nodes,\r\nu8500_auxdata_lookup, parent);\r\n}
