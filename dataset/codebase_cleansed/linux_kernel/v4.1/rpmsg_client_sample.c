static void rpmsg_sample_cb(struct rpmsg_channel *rpdev, void *data, int len,\r\nvoid *priv, u32 src)\r\n{\r\nint ret;\r\nstatic int rx_count;\r\ndev_info(&rpdev->dev, "incoming msg %d (src: 0x%x)\n", ++rx_count, src);\r\nprint_hex_dump(KERN_DEBUG, __func__, DUMP_PREFIX_NONE, 16, 1,\r\ndata, len, true);\r\nif (rx_count >= MSG_LIMIT) {\r\ndev_info(&rpdev->dev, "goodbye!\n");\r\nreturn;\r\n}\r\nret = rpmsg_send(rpdev, MSG, strlen(MSG));\r\nif (ret)\r\ndev_err(&rpdev->dev, "rpmsg_send failed: %d\n", ret);\r\n}\r\nstatic int rpmsg_sample_probe(struct rpmsg_channel *rpdev)\r\n{\r\nint ret;\r\ndev_info(&rpdev->dev, "new channel: 0x%x -> 0x%x!\n",\r\nrpdev->src, rpdev->dst);\r\nret = rpmsg_send(rpdev, MSG, strlen(MSG));\r\nif (ret) {\r\ndev_err(&rpdev->dev, "rpmsg_send failed: %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void rpmsg_sample_remove(struct rpmsg_channel *rpdev)\r\n{\r\ndev_info(&rpdev->dev, "rpmsg sample client driver is removed\n");\r\n}\r\nstatic int __init rpmsg_client_sample_init(void)\r\n{\r\nreturn register_rpmsg_driver(&rpmsg_sample_client);\r\n}\r\nstatic void __exit rpmsg_client_sample_fini(void)\r\n{\r\nunregister_rpmsg_driver(&rpmsg_sample_client);\r\n}
