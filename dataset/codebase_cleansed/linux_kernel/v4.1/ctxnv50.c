static int\r\nnv50_grctx_generate(struct nvkm_grctx *ctx)\r\n{\r\ncp_set (ctx, STATE, RUNNING);\r\ncp_set (ctx, XFER_SWITCH, ENABLE);\r\ncp_bra (ctx, AUTO_SAVE, PENDING, cp_setup_save);\r\ncp_bra (ctx, USER_SAVE, PENDING, cp_setup_save);\r\ncp_name(ctx, cp_check_load);\r\ncp_bra (ctx, AUTO_LOAD, PENDING, cp_setup_auto_load);\r\ncp_bra (ctx, USER_LOAD, PENDING, cp_setup_load);\r\ncp_bra (ctx, ALWAYS, TRUE, cp_prepare_exit);\r\ncp_name(ctx, cp_setup_auto_load);\r\ncp_out (ctx, CP_DISABLE1);\r\ncp_out (ctx, CP_DISABLE2);\r\ncp_out (ctx, CP_ENABLE);\r\ncp_out (ctx, CP_NEXT_TO_SWAP);\r\ncp_set (ctx, UNK01, SET);\r\ncp_name(ctx, cp_setup_load);\r\ncp_out (ctx, CP_NEWCTX);\r\ncp_wait(ctx, NEWCTX, BUSY);\r\ncp_set (ctx, UNK1D, CLEAR);\r\ncp_set (ctx, SWAP_DIRECTION, LOAD);\r\ncp_bra (ctx, UNK0B, SET, cp_prepare_exit);\r\ncp_bra (ctx, ALWAYS, TRUE, cp_swap_state);\r\ncp_name(ctx, cp_setup_save);\r\ncp_set (ctx, UNK1D, SET);\r\ncp_wait(ctx, STATUS, BUSY);\r\ncp_wait(ctx, INTR, PENDING);\r\ncp_bra (ctx, STATUS, BUSY, cp_setup_save);\r\ncp_set (ctx, UNK01, SET);\r\ncp_set (ctx, SWAP_DIRECTION, SAVE);\r\ncp_name(ctx, cp_swap_state);\r\ncp_set (ctx, UNK03, SET);\r\ncp_pos (ctx, 0x00004/4);\r\ncp_ctx (ctx, 0x400828, 1);\r\ncp_pos (ctx, 0x00100/4);\r\nnv50_gr_construct_mmio(ctx);\r\nnv50_gr_construct_xfer1(ctx);\r\nnv50_gr_construct_xfer2(ctx);\r\ncp_bra (ctx, SWAP_DIRECTION, SAVE, cp_check_load);\r\ncp_set (ctx, UNK20, SET);\r\ncp_set (ctx, SWAP_DIRECTION, SAVE);\r\ncp_lsr (ctx, ctx->ctxvals_base);\r\ncp_out (ctx, CP_SET_XFER_POINTER);\r\ncp_lsr (ctx, 4);\r\ncp_out (ctx, CP_SEEK_1);\r\ncp_out (ctx, CP_XFER_1);\r\ncp_wait(ctx, XFER, BUSY);\r\ncp_name(ctx, cp_prepare_exit);\r\ncp_set (ctx, UNK01, CLEAR);\r\ncp_set (ctx, UNK03, CLEAR);\r\ncp_set (ctx, UNK1D, CLEAR);\r\ncp_bra (ctx, USER_SAVE, PENDING, cp_exit);\r\ncp_out (ctx, CP_NEXT_TO_CURRENT);\r\ncp_name(ctx, cp_exit);\r\ncp_set (ctx, USER_SAVE, NOT_PENDING);\r\ncp_set (ctx, USER_LOAD, NOT_PENDING);\r\ncp_set (ctx, XFER_SWITCH, DISABLE);\r\ncp_set (ctx, STATE, STOPPED);\r\ncp_out (ctx, CP_END);\r\nctx->ctxvals_pos += 0x400;\r\nreturn 0;\r\n}\r\nvoid\r\nnv50_grctx_fill(struct nvkm_device *device, struct nvkm_gpuobj *mem)\r\n{\r\nnv50_grctx_generate(&(struct nvkm_grctx) {\r\n.device = device,\r\n.mode = NVKM_GRCTX_VALS,\r\n.data = mem,\r\n});\r\n}\r\nint\r\nnv50_grctx_init(struct nvkm_device *device, u32 *size)\r\n{\r\nu32 *ctxprog = kmalloc(512 * 4, GFP_KERNEL), i;\r\nstruct nvkm_grctx ctx = {\r\n.device = device,\r\n.mode = NVKM_GRCTX_PROG,\r\n.data = ctxprog,\r\n.ctxprog_max = 512,\r\n};\r\nif (!ctxprog)\r\nreturn -ENOMEM;\r\nnv50_grctx_generate(&ctx);\r\nnv_wr32(device, 0x400324, 0);\r\nfor (i = 0; i < ctx.ctxprog_len; i++)\r\nnv_wr32(device, 0x400328, ctxprog[i]);\r\n*size = ctx.ctxvals_pos * 4;\r\nkfree(ctxprog);\r\nreturn 0;\r\n}\r\nstatic void\r\nnv50_gr_construct_mmio(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i, j;\r\nint offset, base;\r\nu32 units = nv_rd32 (ctx->device, 0x1540);\r\ncp_ctx(ctx, 0x400808, 7);\r\ngr_def(ctx, 0x400814, 0x00000030);\r\ncp_ctx(ctx, 0x400834, 0x32);\r\nif (device->chipset == 0x50) {\r\ngr_def(ctx, 0x400834, 0xff400040);\r\ngr_def(ctx, 0x400838, 0xfff00080);\r\ngr_def(ctx, 0x40083c, 0xfff70090);\r\ngr_def(ctx, 0x400840, 0xffe806a8);\r\n}\r\ngr_def(ctx, 0x400844, 0x00000002);\r\nif (IS_NVA3F(device->chipset))\r\ngr_def(ctx, 0x400894, 0x00001000);\r\ngr_def(ctx, 0x4008e8, 0x00000003);\r\ngr_def(ctx, 0x4008ec, 0x00001000);\r\nif (device->chipset == 0x50)\r\ncp_ctx(ctx, 0x400908, 0xb);\r\nelse if (device->chipset < 0xa0)\r\ncp_ctx(ctx, 0x400908, 0xc);\r\nelse\r\ncp_ctx(ctx, 0x400908, 0xe);\r\nif (device->chipset >= 0xa0)\r\ncp_ctx(ctx, 0x400b00, 0x1);\r\nif (IS_NVA3F(device->chipset)) {\r\ncp_ctx(ctx, 0x400b10, 0x1);\r\ngr_def(ctx, 0x400b10, 0x0001629d);\r\ncp_ctx(ctx, 0x400b20, 0x1);\r\ngr_def(ctx, 0x400b20, 0x0001629d);\r\n}\r\nnv50_gr_construct_mmio_ddata(ctx);\r\ncp_ctx(ctx, 0x400c08, 0x2);\r\ngr_def(ctx, 0x400c08, 0x0000fe0c);\r\nif (device->chipset < 0xa0) {\r\ncp_ctx(ctx, 0x401008, 0x4);\r\ngr_def(ctx, 0x401014, 0x00001000);\r\n} else if (!IS_NVA3F(device->chipset)) {\r\ncp_ctx(ctx, 0x401008, 0x5);\r\ngr_def(ctx, 0x401018, 0x00001000);\r\n} else {\r\ncp_ctx(ctx, 0x401008, 0x5);\r\ngr_def(ctx, 0x401018, 0x00004000);\r\n}\r\ncp_ctx(ctx, 0x401400, 0x8);\r\ncp_ctx(ctx, 0x401424, 0x3);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, 0x40142c, 0x0001fd87);\r\nelse\r\ngr_def(ctx, 0x40142c, 0x00000187);\r\ncp_ctx(ctx, 0x401540, 0x5);\r\ngr_def(ctx, 0x401550, 0x00001018);\r\ncp_ctx(ctx, 0x401814, 0x1);\r\ngr_def(ctx, 0x401814, 0x000000ff);\r\nif (device->chipset == 0x50) {\r\ncp_ctx(ctx, 0x40181c, 0xe);\r\ngr_def(ctx, 0x401850, 0x00000004);\r\n} else if (device->chipset < 0xa0) {\r\ncp_ctx(ctx, 0x40181c, 0xf);\r\ngr_def(ctx, 0x401854, 0x00000004);\r\n} else {\r\ncp_ctx(ctx, 0x40181c, 0x13);\r\ngr_def(ctx, 0x401864, 0x00000004);\r\n}\r\ncp_ctx(ctx, 0x401c00, 0x1);\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ngr_def(ctx, 0x401c00, 0x0001005f);\r\nbreak;\r\ncase 0x84:\r\ncase 0x86:\r\ncase 0x94:\r\ngr_def(ctx, 0x401c00, 0x044d00df);\r\nbreak;\r\ncase 0x92:\r\ncase 0x96:\r\ncase 0x98:\r\ncase 0xa0:\r\ncase 0xaa:\r\ncase 0xac:\r\ngr_def(ctx, 0x401c00, 0x042500df);\r\nbreak;\r\ncase 0xa3:\r\ncase 0xa5:\r\ncase 0xa8:\r\ncase 0xaf:\r\ngr_def(ctx, 0x401c00, 0x142500df);\r\nbreak;\r\n}\r\ncp_ctx(ctx, 0x402400, 0x1);\r\nif (device->chipset == 0x50)\r\ncp_ctx(ctx, 0x402408, 0x1);\r\nelse\r\ncp_ctx(ctx, 0x402408, 0x2);\r\ngr_def(ctx, 0x402408, 0x00000600);\r\ncp_ctx(ctx, 0x402800, 0x1);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, 0x402800, 0x00000006);\r\ncp_ctx(ctx, 0x402c08, 0x6);\r\nif (device->chipset != 0x50)\r\ngr_def(ctx, 0x402c14, 0x01000000);\r\ngr_def(ctx, 0x402c18, 0x000000ff);\r\nif (device->chipset == 0x50)\r\ncp_ctx(ctx, 0x402ca0, 0x1);\r\nelse\r\ncp_ctx(ctx, 0x402ca0, 0x2);\r\nif (device->chipset < 0xa0)\r\ngr_def(ctx, 0x402ca0, 0x00000400);\r\nelse if (!IS_NVA3F(device->chipset))\r\ngr_def(ctx, 0x402ca0, 0x00000800);\r\nelse\r\ngr_def(ctx, 0x402ca0, 0x00000400);\r\ncp_ctx(ctx, 0x402cac, 0x4);\r\ncp_ctx(ctx, 0x403004, 0x1);\r\ngr_def(ctx, 0x403004, 0x00000001);\r\nif (device->chipset >= 0xa0) {\r\ncp_ctx(ctx, 0x403404, 0x1);\r\ngr_def(ctx, 0x403404, 0x00000001);\r\n}\r\ncp_ctx(ctx, 0x405000, 0x1);\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ngr_def(ctx, 0x405000, 0x00300080);\r\nbreak;\r\ncase 0x84:\r\ncase 0xa0:\r\ncase 0xa3:\r\ncase 0xa5:\r\ncase 0xa8:\r\ncase 0xaa:\r\ncase 0xac:\r\ncase 0xaf:\r\ngr_def(ctx, 0x405000, 0x000e0080);\r\nbreak;\r\ncase 0x86:\r\ncase 0x92:\r\ncase 0x94:\r\ncase 0x96:\r\ncase 0x98:\r\ngr_def(ctx, 0x405000, 0x00000080);\r\nbreak;\r\n}\r\ncp_ctx(ctx, 0x405014, 0x1);\r\ngr_def(ctx, 0x405014, 0x00000004);\r\ncp_ctx(ctx, 0x40501c, 0x1);\r\ncp_ctx(ctx, 0x405024, 0x1);\r\ncp_ctx(ctx, 0x40502c, 0x1);\r\nif (device->chipset == 0x50)\r\ncp_ctx(ctx, 0x4063e0, 0x1);\r\nif (device->chipset < 0x90) {\r\ncp_ctx(ctx, 0x406814, 0x2b);\r\ngr_def(ctx, 0x406818, 0x00000f80);\r\ngr_def(ctx, 0x406860, 0x007f0080);\r\ngr_def(ctx, 0x40689c, 0x007f0080);\r\n} else {\r\ncp_ctx(ctx, 0x406814, 0x4);\r\nif (device->chipset == 0x98)\r\ngr_def(ctx, 0x406818, 0x00000f80);\r\nelse\r\ngr_def(ctx, 0x406818, 0x00001f80);\r\nif (IS_NVA3F(device->chipset))\r\ngr_def(ctx, 0x40681c, 0x00000030);\r\ncp_ctx(ctx, 0x406830, 0x3);\r\n}\r\nfor (i = 0; i < 8; i++) {\r\nif (units & (1<<(i+16))) {\r\ncp_ctx(ctx, 0x407000 + (i<<8), 3);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, 0x407000 + (i<<8), 0x1b74f820);\r\nelse if (device->chipset != 0xa5)\r\ngr_def(ctx, 0x407000 + (i<<8), 0x3b74f821);\r\nelse\r\ngr_def(ctx, 0x407000 + (i<<8), 0x7b74f821);\r\ngr_def(ctx, 0x407004 + (i<<8), 0x89058001);\r\nif (device->chipset == 0x50) {\r\ncp_ctx(ctx, 0x407010 + (i<<8), 1);\r\n} else if (device->chipset < 0xa0) {\r\ncp_ctx(ctx, 0x407010 + (i<<8), 2);\r\ngr_def(ctx, 0x407010 + (i<<8), 0x00001000);\r\ngr_def(ctx, 0x407014 + (i<<8), 0x0000001f);\r\n} else {\r\ncp_ctx(ctx, 0x407010 + (i<<8), 3);\r\ngr_def(ctx, 0x407010 + (i<<8), 0x00001000);\r\nif (device->chipset != 0xa5)\r\ngr_def(ctx, 0x407014 + (i<<8), 0x000000ff);\r\nelse\r\ngr_def(ctx, 0x407014 + (i<<8), 0x000001ff);\r\n}\r\ncp_ctx(ctx, 0x407080 + (i<<8), 4);\r\nif (device->chipset != 0xa5)\r\ngr_def(ctx, 0x407080 + (i<<8), 0x027c10fa);\r\nelse\r\ngr_def(ctx, 0x407080 + (i<<8), 0x827c10fa);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, 0x407084 + (i<<8), 0x000000c0);\r\nelse\r\ngr_def(ctx, 0x407084 + (i<<8), 0x400000c0);\r\ngr_def(ctx, 0x407088 + (i<<8), 0xb7892080);\r\nif (device->chipset < 0xa0)\r\ncp_ctx(ctx, 0x407094 + (i<<8), 1);\r\nelse if (!IS_NVA3F(device->chipset))\r\ncp_ctx(ctx, 0x407094 + (i<<8), 3);\r\nelse {\r\ncp_ctx(ctx, 0x407094 + (i<<8), 4);\r\ngr_def(ctx, 0x4070a0 + (i<<8), 1);\r\n}\r\n}\r\n}\r\ncp_ctx(ctx, 0x407c00, 0x3);\r\nif (device->chipset < 0x90)\r\ngr_def(ctx, 0x407c00, 0x00010040);\r\nelse if (device->chipset < 0xa0)\r\ngr_def(ctx, 0x407c00, 0x00390040);\r\nelse\r\ngr_def(ctx, 0x407c00, 0x003d0040);\r\ngr_def(ctx, 0x407c08, 0x00000022);\r\nif (device->chipset >= 0xa0) {\r\ncp_ctx(ctx, 0x407c10, 0x3);\r\ncp_ctx(ctx, 0x407c20, 0x1);\r\ncp_ctx(ctx, 0x407c2c, 0x1);\r\n}\r\nif (device->chipset < 0xa0) {\r\ncp_ctx(ctx, 0x407d00, 0x9);\r\n} else {\r\ncp_ctx(ctx, 0x407d00, 0x15);\r\n}\r\nif (device->chipset == 0x98)\r\ngr_def(ctx, 0x407d08, 0x00380040);\r\nelse {\r\nif (device->chipset < 0x90)\r\ngr_def(ctx, 0x407d08, 0x00010040);\r\nelse if (device->chipset < 0xa0)\r\ngr_def(ctx, 0x407d08, 0x00390040);\r\nelse {\r\nif (nvkm_fb(device)->ram->type != NV_MEM_TYPE_GDDR5)\r\ngr_def(ctx, 0x407d08, 0x003d0040);\r\nelse\r\ngr_def(ctx, 0x407d08, 0x003c0040);\r\n}\r\ngr_def(ctx, 0x407d0c, 0x00000022);\r\n}\r\nfor (i = 0; i < 10; i++) {\r\nif (units & (1<<i)) {\r\nif (device->chipset < 0xa0)\r\nbase = 0x408000 + (i<<12);\r\nelse\r\nbase = 0x408000 + (i<<11);\r\nif (device->chipset < 0xa0)\r\noffset = base + 0xc00;\r\nelse\r\noffset = base + 0x80;\r\ncp_ctx(ctx, offset + 0x00, 1);\r\ngr_def(ctx, offset + 0x00, 0x0000ff0a);\r\ncp_ctx(ctx, offset + 0x08, 1);\r\nfor (j = 0; j < (device->chipset < 0xa0 ? 2 : 4); j++) {\r\nif (!(units & (1 << (j+24)))) continue;\r\nif (device->chipset < 0xa0)\r\noffset = base + 0x200 + (j<<7);\r\nelse\r\noffset = base + 0x100 + (j<<7);\r\ncp_ctx(ctx, offset, 0x20);\r\ngr_def(ctx, offset + 0x00, 0x01800000);\r\ngr_def(ctx, offset + 0x04, 0x00160000);\r\ngr_def(ctx, offset + 0x08, 0x01800000);\r\ngr_def(ctx, offset + 0x18, 0x0003ffff);\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ngr_def(ctx, offset + 0x1c, 0x00080000);\r\nbreak;\r\ncase 0x84:\r\ngr_def(ctx, offset + 0x1c, 0x00880000);\r\nbreak;\r\ncase 0x86:\r\ngr_def(ctx, offset + 0x1c, 0x018c0000);\r\nbreak;\r\ncase 0x92:\r\ncase 0x96:\r\ncase 0x98:\r\ngr_def(ctx, offset + 0x1c, 0x118c0000);\r\nbreak;\r\ncase 0x94:\r\ngr_def(ctx, offset + 0x1c, 0x10880000);\r\nbreak;\r\ncase 0xa0:\r\ncase 0xa5:\r\ngr_def(ctx, offset + 0x1c, 0x310c0000);\r\nbreak;\r\ncase 0xa3:\r\ncase 0xa8:\r\ncase 0xaa:\r\ncase 0xac:\r\ncase 0xaf:\r\ngr_def(ctx, offset + 0x1c, 0x300c0000);\r\nbreak;\r\n}\r\ngr_def(ctx, offset + 0x40, 0x00010401);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, offset + 0x48, 0x00000040);\r\nelse\r\ngr_def(ctx, offset + 0x48, 0x00000078);\r\ngr_def(ctx, offset + 0x50, 0x000000bf);\r\ngr_def(ctx, offset + 0x58, 0x00001210);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, offset + 0x5c, 0x00000080);\r\nelse\r\ngr_def(ctx, offset + 0x5c, 0x08000080);\r\nif (device->chipset >= 0xa0)\r\ngr_def(ctx, offset + 0x68, 0x0000003e);\r\n}\r\nif (device->chipset < 0xa0)\r\ncp_ctx(ctx, base + 0x300, 0x4);\r\nelse\r\ncp_ctx(ctx, base + 0x300, 0x5);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, base + 0x304, 0x00007070);\r\nelse if (device->chipset < 0xa0)\r\ngr_def(ctx, base + 0x304, 0x00027070);\r\nelse if (!IS_NVA3F(device->chipset))\r\ngr_def(ctx, base + 0x304, 0x01127070);\r\nelse\r\ngr_def(ctx, base + 0x304, 0x05127070);\r\nif (device->chipset < 0xa0)\r\ncp_ctx(ctx, base + 0x318, 1);\r\nelse\r\ncp_ctx(ctx, base + 0x320, 1);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, base + 0x318, 0x0003ffff);\r\nelse if (device->chipset < 0xa0)\r\ngr_def(ctx, base + 0x318, 0x03ffffff);\r\nelse\r\ngr_def(ctx, base + 0x320, 0x07ffffff);\r\nif (device->chipset < 0xa0)\r\ncp_ctx(ctx, base + 0x324, 5);\r\nelse\r\ncp_ctx(ctx, base + 0x328, 4);\r\nif (device->chipset < 0xa0) {\r\ncp_ctx(ctx, base + 0x340, 9);\r\noffset = base + 0x340;\r\n} else if (!IS_NVA3F(device->chipset)) {\r\ncp_ctx(ctx, base + 0x33c, 0xb);\r\noffset = base + 0x344;\r\n} else {\r\ncp_ctx(ctx, base + 0x33c, 0xd);\r\noffset = base + 0x344;\r\n}\r\ngr_def(ctx, offset + 0x0, 0x00120407);\r\ngr_def(ctx, offset + 0x4, 0x05091507);\r\nif (device->chipset == 0x84)\r\ngr_def(ctx, offset + 0x8, 0x05100202);\r\nelse\r\ngr_def(ctx, offset + 0x8, 0x05010202);\r\ngr_def(ctx, offset + 0xc, 0x00030201);\r\nif (device->chipset == 0xa3)\r\ncp_ctx(ctx, base + 0x36c, 1);\r\ncp_ctx(ctx, base + 0x400, 2);\r\ngr_def(ctx, base + 0x404, 0x00000040);\r\ncp_ctx(ctx, base + 0x40c, 2);\r\ngr_def(ctx, base + 0x40c, 0x0d0c0b0a);\r\ngr_def(ctx, base + 0x410, 0x00141210);\r\nif (device->chipset < 0xa0)\r\noffset = base + 0x800;\r\nelse\r\noffset = base + 0x500;\r\ncp_ctx(ctx, offset, 6);\r\ngr_def(ctx, offset + 0x0, 0x000001f0);\r\ngr_def(ctx, offset + 0x4, 0x00000001);\r\ngr_def(ctx, offset + 0x8, 0x00000003);\r\nif (device->chipset == 0x50 || IS_NVAAF(device->chipset))\r\ngr_def(ctx, offset + 0xc, 0x00008000);\r\ngr_def(ctx, offset + 0x14, 0x00039e00);\r\ncp_ctx(ctx, offset + 0x1c, 2);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, offset + 0x1c, 0x00000040);\r\nelse\r\ngr_def(ctx, offset + 0x1c, 0x00000100);\r\ngr_def(ctx, offset + 0x20, 0x00003800);\r\nif (device->chipset >= 0xa0) {\r\ncp_ctx(ctx, base + 0x54c, 2);\r\nif (!IS_NVA3F(device->chipset))\r\ngr_def(ctx, base + 0x54c, 0x003fe006);\r\nelse\r\ngr_def(ctx, base + 0x54c, 0x003fe007);\r\ngr_def(ctx, base + 0x550, 0x003fe000);\r\n}\r\nif (device->chipset < 0xa0)\r\noffset = base + 0xa00;\r\nelse\r\noffset = base + 0x680;\r\ncp_ctx(ctx, offset, 1);\r\ngr_def(ctx, offset, 0x00404040);\r\nif (device->chipset < 0xa0)\r\noffset = base + 0xe00;\r\nelse\r\noffset = base + 0x700;\r\ncp_ctx(ctx, offset, 2);\r\nif (device->chipset < 0xa0)\r\ngr_def(ctx, offset, 0x0077f005);\r\nelse if (device->chipset == 0xa5)\r\ngr_def(ctx, offset, 0x6cf7f007);\r\nelse if (device->chipset == 0xa8)\r\ngr_def(ctx, offset, 0x6cfff007);\r\nelse if (device->chipset == 0xac)\r\ngr_def(ctx, offset, 0x0cfff007);\r\nelse\r\ngr_def(ctx, offset, 0x0cf7f007);\r\nif (device->chipset == 0x50)\r\ngr_def(ctx, offset + 0x4, 0x00007fff);\r\nelse if (device->chipset < 0xa0)\r\ngr_def(ctx, offset + 0x4, 0x003f7fff);\r\nelse\r\ngr_def(ctx, offset + 0x4, 0x02bf7fff);\r\ncp_ctx(ctx, offset + 0x2c, 1);\r\nif (device->chipset == 0x50) {\r\ncp_ctx(ctx, offset + 0x50, 9);\r\ngr_def(ctx, offset + 0x54, 0x000003ff);\r\ngr_def(ctx, offset + 0x58, 0x00000003);\r\ngr_def(ctx, offset + 0x5c, 0x00000003);\r\ngr_def(ctx, offset + 0x60, 0x000001ff);\r\ngr_def(ctx, offset + 0x64, 0x0000001f);\r\ngr_def(ctx, offset + 0x68, 0x0000000f);\r\ngr_def(ctx, offset + 0x6c, 0x0000000f);\r\n} else if (device->chipset < 0xa0) {\r\ncp_ctx(ctx, offset + 0x50, 1);\r\ncp_ctx(ctx, offset + 0x70, 1);\r\n} else {\r\ncp_ctx(ctx, offset + 0x50, 1);\r\ncp_ctx(ctx, offset + 0x60, 5);\r\n}\r\n}\r\n}\r\n}\r\nstatic void\r\ndd_emit(struct nvkm_grctx *ctx, int num, u32 val) {\r\nint i;\r\nif (val && ctx->mode == NVKM_GRCTX_VALS)\r\nfor (i = 0; i < num; i++)\r\nnv_wo32(ctx->data, 4 * (ctx->ctxvals_pos + i), val);\r\nctx->ctxvals_pos += num;\r\n}\r\nstatic void\r\nnv50_gr_construct_mmio_ddata(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint base, num;\r\nbase = ctx->ctxvals_pos;\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\nif (device->chipset >= 0x94)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x3fffff);\r\ndd_emit(ctx, 1, 0x1fff);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 1);\r\nif (IS_NVA3F(device->chipset))\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 7);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 7);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\nif (device->chipset == 0x50) {\r\ndd_emit(ctx, 4, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0xa);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x40);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 0);\r\n}\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 2, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 2, 0);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x100);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 2, 0);\r\ndd_emit(ctx, 1, 0x100);\r\nif (device->chipset == 0x50) {\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 3);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\n}\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 0x70);\r\ndd_emit(ctx, 1, 0x80);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\n} else {\r\ndd_emit(ctx, 1, 0);\r\n}\r\ndd_emit(ctx, 1, 0xc);\r\nif (device->chipset != 0x50)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 8);\r\ndd_emit(ctx, 1, 0x14);\r\nif (device->chipset == 0x50) {\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\n} else {\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x29);\r\ndd_emit(ctx, 1, 0x27);\r\ndd_emit(ctx, 1, 0x26);\r\ndd_emit(ctx, 1, 8);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 0x27);\r\ndd_emit(ctx, 1, 0);\r\n}\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 3);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 5);\r\ndd_emit(ctx, 1, 6);\r\ndd_emit(ctx, 1, 7);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 8, 0);\r\ndd_emit(ctx, 8, 0);\r\ndd_emit(ctx, 1, 0xcf);\r\ndd_emit(ctx, 7, 0);\r\nif (device->chipset != 0x50)\r\ndd_emit(ctx, 3, 0);\r\nelse\r\ndd_emit(ctx, 2, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x80);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 4);\r\nif (IS_NVA3F(device->chipset)) {\r\ndd_emit(ctx, 1, 3);\r\ndd_emit(ctx, 1, 0);\r\n}\r\nif (device->chipset != 0x50)\r\ndd_emit(ctx, 1, 3);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x12);\r\ndd_emit(ctx, 1, 0x10);\r\ndd_emit(ctx, 1, 0xc);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 4);\r\nif (device->chipset >= 0xa0)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x3fffff);\r\ndd_emit(ctx, 1, 0x1fff);\r\ndd_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50)\r\ndd_emit(ctx, 8, 0);\r\nif (device->chipset >= 0xa0) {\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 0);\r\n}\r\ndd_emit(ctx, 1, 4);\r\ndd_emit(ctx, 1, 0x14);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\nif (device->chipset >= 0xa0)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0)\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 0x1000);\r\nif (device->chipset != 0x50) {\r\ndd_emit(ctx, 1, 0xe00);\r\ndd_emit(ctx, 1, 0x1000);\r\ndd_emit(ctx, 1, 0x1e00);\r\n}\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0x200);\r\nif (IS_NVA3F(device->chipset))\r\ndd_emit(ctx, 1, 0x200);\r\ndd_emit(ctx, 1, 0);\r\nif (device->chipset < 0xa0) {\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x70);\r\ndd_emit(ctx, 1, 0x80);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0x70);\r\ndd_emit(ctx, 1, 0x80);\r\ndd_emit(ctx, 1, 0);\r\n} else {\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0xf0);\r\ndd_emit(ctx, 1, 0xff);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0xf0);\r\ndd_emit(ctx, 1, 0xff);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 9);\r\n}\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0xcf);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0xcf);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 2);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 1);\r\ndd_emit(ctx, 1, 0);\r\ndd_emit(ctx, 1, 0xcf);\r\ndd_emit(ctx, 1, 0xcf);\r\ndd_emit(ctx, 1, 1);\r\nnum = ctx->ctxvals_pos - base;\r\nctx->ctxvals_pos = base;\r\nif (IS_NVA3F(device->chipset))\r\ncp_ctx(ctx, 0x404800, num);\r\nelse\r\ncp_ctx(ctx, 0x405400, num);\r\n}\r\nstatic void\r\nxf_emit(struct nvkm_grctx *ctx, int num, u32 val) {\r\nint i;\r\nif (val && ctx->mode == NVKM_GRCTX_VALS)\r\nfor (i = 0; i < num; i++)\r\nnv_wo32(ctx->data, 4 * (ctx->ctxvals_pos + (i << 3)), val);\r\nctx->ctxvals_pos += num << 3;\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer1(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i;\r\nint offset;\r\nint size = 0;\r\nu32 units = nv_rd32 (ctx->device, 0x1540);\r\noffset = (ctx->ctxvals_pos+0x3f)&~0x3f;\r\nctx->ctxvals_base = offset;\r\nif (device->chipset < 0xa0) {\r\nctx->ctxvals_pos = offset;\r\nnv50_gr_construct_gene_dispatch(ctx);\r\nnv50_gr_construct_gene_m2mf(ctx);\r\nnv50_gr_construct_gene_unk24xx(ctx);\r\nnv50_gr_construct_gene_clipid(ctx);\r\nnv50_gr_construct_gene_zcull(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 0x1;\r\nnv50_gr_construct_gene_vfetch(ctx);\r\nnv50_gr_construct_gene_eng2d(ctx);\r\nnv50_gr_construct_gene_csched(ctx);\r\nnv50_gr_construct_gene_ropm1(ctx);\r\nnv50_gr_construct_gene_ropm2(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 0x2;\r\nnv50_gr_construct_gene_ccache(ctx);\r\nnv50_gr_construct_gene_unk1cxx(ctx);\r\nnv50_gr_construct_gene_strmout(ctx);\r\nnv50_gr_construct_gene_unk14xx(ctx);\r\nnv50_gr_construct_gene_unk10xx(ctx);\r\nnv50_gr_construct_gene_unk34xx(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 3;\r\nfor (i = 0; i < 6; i++)\r\nif (units & (1 << (i + 16)))\r\nnv50_gr_construct_gene_ropc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nfor (i = 0; i < 4; i++) {\r\nctx->ctxvals_pos = offset + 4 + i;\r\nif (units & (1 << (2 * i)))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << (2 * i + 1)))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\n}\r\n} else {\r\nctx->ctxvals_pos = offset;\r\nnv50_gr_construct_gene_dispatch(ctx);\r\nnv50_gr_construct_gene_m2mf(ctx);\r\nnv50_gr_construct_gene_unk34xx(ctx);\r\nnv50_gr_construct_gene_csched(ctx);\r\nnv50_gr_construct_gene_unk1cxx(ctx);\r\nnv50_gr_construct_gene_strmout(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 1;\r\nnv50_gr_construct_gene_unk10xx(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 2;\r\nif (device->chipset == 0xa0)\r\nnv50_gr_construct_gene_unk14xx(ctx);\r\nnv50_gr_construct_gene_unk24xx(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 3;\r\nnv50_gr_construct_gene_vfetch(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 4;\r\nnv50_gr_construct_gene_ccache(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 5;\r\nnv50_gr_construct_gene_ropm2(ctx);\r\nnv50_gr_construct_gene_ropm1(ctx);\r\nfor (i = 0; i < 8; i++)\r\nif (units & (1<<(i+16)))\r\nnv50_gr_construct_gene_ropc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 6;\r\nnv50_gr_construct_gene_zcull(ctx);\r\nnv50_gr_construct_gene_clipid(ctx);\r\nnv50_gr_construct_gene_eng2d(ctx);\r\nif (units & (1 << 0))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 1))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 2))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 3))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 7;\r\nif (device->chipset == 0xa0) {\r\nif (units & (1 << 4))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 5))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 6))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 7))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 8))\r\nnv50_gr_construct_xfer_tp(ctx);\r\nif (units & (1 << 9))\r\nnv50_gr_construct_xfer_tp(ctx);\r\n} else {\r\nnv50_gr_construct_gene_unk14xx(ctx);\r\n}\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\n}\r\nctx->ctxvals_pos = offset + size * 8;\r\nctx->ctxvals_pos = (ctx->ctxvals_pos+0x3f)&~0x3f;\r\ncp_lsr (ctx, offset);\r\ncp_out (ctx, CP_SET_XFER_POINTER);\r\ncp_lsr (ctx, size);\r\ncp_out (ctx, CP_SEEK_1);\r\ncp_out (ctx, CP_XFER_1);\r\ncp_wait(ctx, XFER, BUSY);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_dispatch(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 5, 0);\r\nelse if (!IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 6, 0);\r\nelse\r\nxf_emit(ctx, 4, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 8*3, 0);\r\nelse\r\nxf_emit(ctx, 0x100*3, 0);\r\nxf_emit(ctx, 3, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 9, 0);\r\nxf_emit(ctx, 9, 0);\r\nxf_emit(ctx, 9, 0);\r\nxf_emit(ctx, 9, 0);\r\nif (device->chipset < 0x90)\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 6*2, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 6*2, 0);\r\nxf_emit(ctx, 2, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 0x1c, 0);\r\nelse if (device->chipset < 0xa0)\r\nxf_emit(ctx, 0x1e, 0);\r\nelse\r\nxf_emit(ctx, 0x22, 0);\r\nxf_emit(ctx, 0x15, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_m2mf(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint smallm2mf = 0;\r\nif (device->chipset < 0x92 || device->chipset == 0x98)\r\nsmallm2mf = 1;\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0x21);\r\nxf_emit (ctx, 1, 1);\r\nxf_emit (ctx, 1, 0x2);\r\nxf_emit (ctx, 1, 0x100);\r\nxf_emit (ctx, 1, 0x100);\r\nxf_emit (ctx, 1, 1);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 1);\r\nxf_emit (ctx, 1, 0x2);\r\nxf_emit (ctx, 1, 0x100);\r\nxf_emit (ctx, 1, 0x100);\r\nxf_emit (ctx, 1, 1);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nxf_emit (ctx, 1, 0);\r\nif (smallm2mf)\r\nxf_emit(ctx, 0x40, 0);\r\nelse\r\nxf_emit(ctx, 0x100, 0);\r\nxf_emit(ctx, 4, 0);\r\nif (smallm2mf)\r\nxf_emit(ctx, 0x400, 0);\r\nelse\r\nxf_emit(ctx, 0x800, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0x40, 0);\r\nxf_emit(ctx, 0x6, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_ccache(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 0x800, 0);\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ncase 0x92:\r\ncase 0xa0:\r\nxf_emit(ctx, 0x2b, 0);\r\nbreak;\r\ncase 0x84:\r\nxf_emit(ctx, 0x29, 0);\r\nbreak;\r\ncase 0x94:\r\ncase 0x96:\r\ncase 0xa3:\r\nxf_emit(ctx, 0x27, 0);\r\nbreak;\r\ncase 0x86:\r\ncase 0x98:\r\ncase 0xa5:\r\ncase 0xa8:\r\ncase 0xaa:\r\ncase 0xac:\r\ncase 0xaf:\r\nxf_emit(ctx, 0x25, 0);\r\nbreak;\r\n}\r\nxf_emit(ctx, 0x100, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x30, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0x100, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x3fffff);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1fff);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_unk10xx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i;\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0x3ff);\r\nelse\r\nxf_emit(ctx, 1, 0x7ff);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nfor (i = 0; i < 8; i++) {\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ncase 0x86:\r\ncase 0x98:\r\ncase 0xaa:\r\ncase 0xac:\r\nxf_emit(ctx, 0xa0, 0);\r\nbreak;\r\ncase 0x84:\r\ncase 0x92:\r\ncase 0x94:\r\ncase 0x96:\r\nxf_emit(ctx, 0x120, 0);\r\nbreak;\r\ncase 0xa5:\r\ncase 0xa8:\r\nxf_emit(ctx, 0x100, 0);\r\nbreak;\r\ncase 0xa0:\r\ncase 0xa3:\r\ncase 0xaf:\r\nxf_emit(ctx, 0x400, 0);\r\nbreak;\r\n}\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\n}\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x27);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x26);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_unk34xx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x10, 0x04000000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x20, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x04e3bfdf);\r\nxf_emit(ctx, 1, 0x04e3bfdf);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1fe21);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 3, 0);\r\n}\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_unk14xx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nif (device->chipset != 0x50) {\r\nxf_emit(ctx, 5, 0);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x804);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 4);\r\nxf_emit(ctx, 1, 0x8100c12);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x804);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x1a);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0x7f);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0x3ff);\r\nelse\r\nxf_emit(ctx, 1, 0x7ff);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x30, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x30, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0x88);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x26);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x3f800000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1a);\r\nxf_emit(ctx, 1, 0x10);\r\nif (device->chipset != 0x50) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 0x20, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x52);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x26);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1a);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x00ffff00);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_zcull(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0x3f);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 2, 0x04000000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x1001);\r\nxf_emit(ctx, 4, 0xffff);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x10, 0x3f800000);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_clipid(struct nvkm_grctx *ctx)\r\n{\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0x04000000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_unk24xx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i;\r\nxf_emit(ctx, 0x33, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0xe10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 9, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0xe10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 9, 0);\r\n} else {\r\nxf_emit(ctx, 0xc, 0);\r\nxf_emit(ctx, 0xe10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0xc, 0);\r\nxf_emit(ctx, 0xe10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 1);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 2, 4);\r\nxf_emit(ctx, 1, 0x80c14);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 1, 0x27);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nfor (i = 0; i < 10; i++) {\r\nxf_emit(ctx, 0x40, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x10, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_vfetch(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint acnt = 0x10, rep, i;\r\nif (IS_NVA3F(device->chipset))\r\nacnt = 0x20;\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, (acnt/8)-1, 0);\r\nxf_emit(ctx, acnt/8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x20);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0xb, 0);\r\nelse if (device->chipset >= 0xa0)\r\nxf_emit(ctx, 0x9, 0);\r\nelse\r\nxf_emit(ctx, 0x8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1a);\r\nxf_emit(ctx, 0xc, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 8);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0x3ff);\r\nelse\r\nxf_emit(ctx, 1, 0x7ff);\r\nif (device->chipset == 0xa8)\r\nxf_emit(ctx, 1, 0x1e00);\r\nxf_emit(ctx, 0xc, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, (acnt/8)-1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset > 0x50 && device->chipset < 0xa0)\r\nxf_emit(ctx, 2, 0);\r\nelse\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0);\r\n} else {\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, acnt, 0);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, acnt, 0);\r\nxf_emit(ctx, 3, 0);\r\n}\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 2, 0);\r\nelse\r\nxf_emit(ctx, 5, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset < 0xa0) {\r\nxf_emit(ctx, 0x41, 0);\r\nxf_emit(ctx, 0x11, 0);\r\n} else if (!IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x50, 0);\r\nelse\r\nxf_emit(ctx, 0x58, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, (acnt/8)-1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, acnt*4, 0);\r\nxf_emit(ctx, 4, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x1d, 0);\r\nelse\r\nxf_emit(ctx, 0x16, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, (acnt/8)-1, 0);\r\nif (device->chipset < 0xa0)\r\nxf_emit(ctx, 8, 0);\r\nelse if (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0xc, 0);\r\nelse\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 0xa, 0);\r\nif (device->chipset == 0xa0)\r\nrep = 0xc;\r\nelse\r\nrep = 4;\r\nfor (i = 0; i < rep; i++) {\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x20, 0);\r\nxf_emit(ctx, 0x200, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, (acnt/8)-1, 0);\r\nxf_emit(ctx, acnt/8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 7, 0);\r\nelse\r\nxf_emit(ctx, 5, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_eng2d(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset < 0xa0) {\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 1);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 8);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0xcf);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x15);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x4444480);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x27, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_csched(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10001);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10001);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x10001);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 0x40, 0);\r\nswitch (device->chipset) {\r\ncase 0x50:\r\ncase 0x92:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0x80, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 0x10*2, 0);\r\nbreak;\r\ncase 0x84:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0x60, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 0xc*2, 0);\r\nbreak;\r\ncase 0x94:\r\ncase 0x96:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0x40, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 8*2, 0);\r\nbreak;\r\ncase 0x86:\r\ncase 0x98:\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2*2, 0);\r\nbreak;\r\ncase 0xa0:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0xf0, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 0x1e*2, 0);\r\nbreak;\r\ncase 0xa3:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0x60, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 0xc*2, 0);\r\nbreak;\r\ncase 0xa5:\r\ncase 0xaf:\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 0x30, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 6*2, 0);\r\nbreak;\r\ncase 0xaa:\r\nxf_emit(ctx, 0x12, 0);\r\nbreak;\r\ncase 0xa8:\r\ncase 0xac:\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2*2, 0);\r\nbreak;\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_unk1cxx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0x3f800000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x1a);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x00ffff00);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 3);\r\nelse if (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 2, 0x04000000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 5);\r\nxf_emit(ctx, 1, 0x52);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\n}\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x10, 0x3f800000);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 0x20, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x8100c12);\r\nxf_emit(ctx, 1, 5);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0xffff);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 3);\r\nif (device->chipset < 0xa0)\r\nxf_emit(ctx, 0x1c, 0);\r\nelse if (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x9, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x00ffff00);\r\nxf_emit(ctx, 1, 0x1a);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50) {\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nif (device->chipset < 0xa0)\r\nxf_emit(ctx, 0x25, 0);\r\nelse\r\nxf_emit(ctx, 0x3b, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_strmout(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0x102);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 4);\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\n}\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0x3ff);\r\nelse\r\nxf_emit(ctx, 1, 0x7ff);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x102);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 4);\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x20, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_ropm1(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0x4e3bfdf);\r\nxf_emit(ctx, 1, 0x4e3bfdf);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_ropm2(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0x4e3bfdf);\r\nxf_emit(ctx, 1, 0x4e3bfdf);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_gene_ropc(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint magic2;\r\nif (device->chipset == 0x50) {\r\nmagic2 = 0x00003e60;\r\n} else if (!IS_NVA3F(device->chipset)) {\r\nmagic2 = 0x001ffe67;\r\n} else {\r\nmagic2 = 0x00087e67;\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, magic2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0 && !IS_NVAAF(device->chipset))\r\nxf_emit(ctx, 1, 0x15);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x86 || device->chipset == 0x92 || device->chipset == 0x98 || device->chipset >= 0xa0) {\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x400);\r\nxf_emit(ctx, 1, 0x300);\r\nxf_emit(ctx, 1, 0x1001);\r\nif (device->chipset != 0xa0) {\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0);\r\nelse\r\nxf_emit(ctx, 1, 0x15);\r\n}\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 0x10, 0x3f800000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x10);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x3f);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0x1001);\r\nxf_emit(ctx, 0xb, 0);\r\n} else {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset != 0x50) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, magic2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n} else if (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\n} else {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x50, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_unk84xx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint magic3;\r\nswitch (device->chipset) {\r\ncase 0x50:\r\nmagic3 = 0x1000;\r\nbreak;\r\ncase 0x86:\r\ncase 0x98:\r\ncase 0xa8:\r\ncase 0xaa:\r\ncase 0xac:\r\ncase 0xaf:\r\nmagic3 = 0x1e00;\r\nbreak;\r\ndefault:\r\nmagic3 = 0;\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x1f, 0);\r\nelse if (device->chipset >= 0xa0)\r\nxf_emit(ctx, 0x0f, 0);\r\nelse\r\nxf_emit(ctx, 0x10, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0x03020100);\r\nelse\r\nxf_emit(ctx, 1, 0x00608080);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x80);\r\nif (magic3)\r\nxf_emit(ctx, 1, magic3);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 0x1f, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0x03020100);\r\nxf_emit(ctx, 1, 3);\r\nif (magic3)\r\nxf_emit(ctx, 1, magic3);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x94 || device->chipset == 0x96)\r\nxf_emit(ctx, 0x1020, 0);\r\nelse if (device->chipset < 0xa0)\r\nxf_emit(ctx, 0xa20, 0);\r\nelse if (!IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x210, 0);\r\nelse\r\nxf_emit(ctx, 0x410, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_tprop(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint magic1, magic2;\r\nif (device->chipset == 0x50) {\r\nmagic1 = 0x3ff;\r\nmagic2 = 0x00003e60;\r\n} else if (!IS_NVA3F(device->chipset)) {\r\nmagic1 = 0x7ff;\r\nmagic2 = 0x001ffe67;\r\n} else {\r\nmagic1 = 0x7ff;\r\nmagic2 = 0x00087e67;\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 4, 0xffff);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n} else if (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\n} else {\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xcf);\r\nxf_emit(ctx, 1, 0xcf);\r\nxf_emit(ctx, 1, 0xcf);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, magic2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 1);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0);\r\nelse\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, magic1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 8, 8);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 8, 0x400);\r\nxf_emit(ctx, 8, 0x300);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x20);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x40);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, magic2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x400);\r\nxf_emit(ctx, 1, 0x300);\r\nxf_emit(ctx, 1, 0x1001);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0x0fac6881);\r\nxf_emit(ctx, 1, magic2);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0xfac6881);\r\nxf_emit(ctx, 4, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 1);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 0x9, 0);\r\nelse\r\nxf_emit(ctx, 0x8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0xfac6881);\r\nxf_emit(ctx, 1, 0xf);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 5, 0);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\n}\r\n}\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_tex(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 2, 0);\r\nif (device->chipset != 0x50)\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 1, 0);\r\nelse\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0x2a712488);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x4085c000);\r\nxf_emit(ctx, 1, 0x40);\r\nxf_emit(ctx, 1, 0x100);\r\nxf_emit(ctx, 1, 0x10100);\r\nxf_emit(ctx, 1, 0x02800000);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n} else if (!IS_NVAAF(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n} else {\r\nxf_emit(ctx, 0x6, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_unk8cxx(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 2, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x04e3bfdf);\r\nxf_emit(ctx, 1, 0x04e3bfdf);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x00ffff00);\r\nxf_emit(ctx, 1, 1);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x00ffff00);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x30201000);\r\nxf_emit(ctx, 1, 0x70605040);\r\nxf_emit(ctx, 1, 0xb8a89888);\r\nxf_emit(ctx, 1, 0xf8e8d8c8);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1a);\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_tp(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nif (device->chipset < 0xa0) {\r\nnv50_gr_construct_xfer_unk84xx(ctx);\r\nnv50_gr_construct_xfer_tprop(ctx);\r\nnv50_gr_construct_xfer_tex(ctx);\r\nnv50_gr_construct_xfer_unk8cxx(ctx);\r\n} else {\r\nnv50_gr_construct_xfer_tex(ctx);\r\nnv50_gr_construct_xfer_tprop(ctx);\r\nnv50_gr_construct_xfer_unk8cxx(ctx);\r\nnv50_gr_construct_xfer_unk84xx(ctx);\r\n}\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer_mpc(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i, mpcnt = 2;\r\nswitch (device->chipset) {\r\ncase 0x98:\r\ncase 0xaa:\r\nmpcnt = 1;\r\nbreak;\r\ncase 0x50:\r\ncase 0x84:\r\ncase 0x86:\r\ncase 0x92:\r\ncase 0x94:\r\ncase 0x96:\r\ncase 0xa8:\r\ncase 0xac:\r\nmpcnt = 2;\r\nbreak;\r\ncase 0xa0:\r\ncase 0xa3:\r\ncase 0xa5:\r\ncase 0xaf:\r\nmpcnt = 3;\r\nbreak;\r\n}\r\nfor (i = 0; i < mpcnt; i++) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x80);\r\nxf_emit(ctx, 1, 0x80007004);\r\nxf_emit(ctx, 1, 0x04000400);\r\nif (device->chipset >= 0xa0)\r\nxf_emit(ctx, 1, 0xc0);\r\nxf_emit(ctx, 1, 0x1000);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x86 || device->chipset == 0x98 || device->chipset == 0xa8 || IS_NVAAF(device->chipset)) {\r\nxf_emit(ctx, 1, 0xe00);\r\nxf_emit(ctx, 1, 0x1e00);\r\n}\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 2, 0x1000);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 2);\r\nif (IS_NVAAF(device->chipset))\r\nxf_emit(ctx, 0xb, 0);\r\nelse if (device->chipset >= 0xa0)\r\nxf_emit(ctx, 0xc, 0);\r\nelse\r\nxf_emit(ctx, 0xa, 0);\r\n}\r\nxf_emit(ctx, 1, 0x08100c12);\r\nxf_emit(ctx, 1, 0);\r\nif (device->chipset >= 0xa0) {\r\nxf_emit(ctx, 1, 0x1fe21);\r\n}\r\nxf_emit(ctx, 3, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 4, 0xffff);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0x10001);\r\nxf_emit(ctx, 1, 0x10001);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x1fe21);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0x08100c12);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 7, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0xfac6881);\r\nxf_emit(ctx, 1, 0);\r\nif (IS_NVA3F(device->chipset))\r\nxf_emit(ctx, 1, 3);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nxf_emit(ctx, 8, 0);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 2);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 1, 1);\r\nif (IS_NVA3F(device->chipset)) {\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 2);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 8, 1);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 0);\r\n}\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 4);\r\nif (device->chipset == 0x50)\r\nxf_emit(ctx, 0x3a0, 0);\r\nelse if (device->chipset < 0x94)\r\nxf_emit(ctx, 0x3a2, 0);\r\nelse if (device->chipset == 0x98 || device->chipset == 0xaa)\r\nxf_emit(ctx, 0x39f, 0);\r\nelse\r\nxf_emit(ctx, 0x3a3, 0);\r\nxf_emit(ctx, 1, 0x11);\r\nxf_emit(ctx, 1, 0);\r\nxf_emit(ctx, 1, 1);\r\nxf_emit(ctx, 0x2d, 0);\r\n}\r\nstatic void\r\nnv50_gr_construct_xfer2(struct nvkm_grctx *ctx)\r\n{\r\nstruct nvkm_device *device = ctx->device;\r\nint i;\r\nu32 offset;\r\nu32 units = nv_rd32 (ctx->device, 0x1540);\r\nint size = 0;\r\noffset = (ctx->ctxvals_pos+0x3f)&~0x3f;\r\nif (device->chipset < 0xa0) {\r\nfor (i = 0; i < 8; i++) {\r\nctx->ctxvals_pos = offset + i;\r\nif (i == 0)\r\nxf_emit(ctx, 1, 0x08100c12);\r\nif (units & (1 << i))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\n}\r\n} else {\r\nctx->ctxvals_pos = offset;\r\nxf_emit(ctx, 1, 0x08100c12);\r\nif (units & (1 << 0))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 1))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 1;\r\nif (units & (1 << 2))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 3))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 2;\r\nif (units & (1 << 4))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 5))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 6))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\nctx->ctxvals_pos = offset + 3;\r\nif (units & (1 << 7))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 8))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif (units & (1 << 9))\r\nnv50_gr_construct_xfer_mpc(ctx);\r\nif ((ctx->ctxvals_pos-offset)/8 > size)\r\nsize = (ctx->ctxvals_pos-offset)/8;\r\n}\r\nctx->ctxvals_pos = offset + size * 8;\r\nctx->ctxvals_pos = (ctx->ctxvals_pos+0x3f)&~0x3f;\r\ncp_lsr (ctx, offset);\r\ncp_out (ctx, CP_SET_XFER_POINTER);\r\ncp_lsr (ctx, size);\r\ncp_out (ctx, CP_SEEK_2);\r\ncp_out (ctx, CP_XFER_2);\r\ncp_wait(ctx, XFER, BUSY);\r\n}
