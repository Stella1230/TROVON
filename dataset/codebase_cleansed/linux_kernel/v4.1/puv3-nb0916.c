static irqreturn_t nb0916_lcdcaseoff_handler(int irq, void *dev_id)\r\n{\r\nif (gpio_get_value(GPI_LCD_CASE_OFF))\r\ngpio_set_value(GPO_LCD_EN, 1);\r\nelse\r\ngpio_set_value(GPO_LCD_EN, 0);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic irqreturn_t nb0916_overheat_handler(int irq, void *dev_id)\r\n{\r\nmachine_halt();\r\nreturn IRQ_HANDLED;\r\n}\r\nint __init mach_nb0916_init(void)\r\n{\r\ni2c_register_board_info(0, puv3_i2c_devices,\r\nARRAY_SIZE(puv3_i2c_devices));\r\nplatform_device_register_simple("PKUnity-v3-I2C", -1,\r\npuv3_i2c_resources, ARRAY_SIZE(puv3_i2c_resources));\r\nplatform_device_register_data(NULL, "pwm-backlight", -1,\r\n&nb0916_backlight_data, sizeof(nb0916_backlight_data));\r\nplatform_device_register_data(NULL, "gpio-keys", -1,\r\n&nb0916_gpio_button_data, sizeof(nb0916_gpio_button_data));\r\nplatform_device_register_resndata(NULL, "physmap-flash", -1,\r\n&physmap_flash_resource, 1,\r\n&physmap_flash_data, sizeof(physmap_flash_data));\r\nif (request_irq(gpio_to_irq(GPI_LCD_CASE_OFF),\r\n&nb0916_lcdcaseoff_handler,\r\nIRQF_TRIGGER_RISING | IRQF_TRIGGER_FALLING,\r\n"NB0916 lcd case off", NULL) < 0) {\r\nprintk(KERN_DEBUG "LCD-Case-OFF IRQ %d not available\n",\r\ngpio_to_irq(GPI_LCD_CASE_OFF));\r\n}\r\nif (request_irq(gpio_to_irq(GPI_OTP_INT), &nb0916_overheat_handler,\r\nIRQF_TRIGGER_RISING | IRQF_TRIGGER_FALLING,\r\n"NB0916 overheating protection", NULL) < 0) {\r\nprintk(KERN_DEBUG "Overheating Protection IRQ %d not available\n",\r\ngpio_to_irq(GPI_OTP_INT));\r\n}\r\nreturn 0;\r\n}
