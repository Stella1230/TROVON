u32\r\nnvbios_pcirTe(struct nvkm_bios *bios, u32 base, u8 *ver, u16 *hdr)\r\n{\r\nu32 data = nv_ro16(bios, base + 0x18);\r\nif (data) {\r\ndata += base;\r\nswitch (nv_ro32(bios, data + 0x00)) {\r\ncase 0x52494350:\r\ncase 0x53494752:\r\ncase 0x5344504e:\r\n*hdr = nv_ro16(bios, data + 0x0a);\r\n*ver = nv_ro08(bios, data + 0x0c);\r\nbreak;\r\ndefault:\r\nnv_debug(bios, "%08x: PCIR signature (%08x) unknown\n",\r\ndata, nv_ro32(bios, data + 0x00));\r\ndata = 0;\r\nbreak;\r\n}\r\n}\r\nreturn data;\r\n}\r\nu32\r\nnvbios_pcirTp(struct nvkm_bios *bios, u32 base, u8 *ver, u16 *hdr,\r\nstruct nvbios_pcirT *info)\r\n{\r\nu32 data = nvbios_pcirTe(bios, base, ver, hdr);\r\nmemset(info, 0x00, sizeof(*info));\r\nif (data) {\r\ninfo->vendor_id = nv_ro16(bios, data + 0x04);\r\ninfo->device_id = nv_ro16(bios, data + 0x06);\r\ninfo->class_code[0] = nv_ro08(bios, data + 0x0d);\r\ninfo->class_code[1] = nv_ro08(bios, data + 0x0e);\r\ninfo->class_code[2] = nv_ro08(bios, data + 0x0f);\r\ninfo->image_size = nv_ro16(bios, data + 0x10) * 512;\r\ninfo->image_rev = nv_ro16(bios, data + 0x12);\r\ninfo->image_type = nv_ro08(bios, data + 0x14);\r\ninfo->last = nv_ro08(bios, data + 0x15) & 0x80;\r\n}\r\nreturn data;\r\n}
