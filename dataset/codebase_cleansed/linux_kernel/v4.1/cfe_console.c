static void cfe_console_write(struct console *cons, const char *str,\r\nunsigned int count)\r\n{\r\nint i, last, written;\r\nfor (i=0, last=0; i<count; i++) {\r\nif (!str[i])\r\nreturn;\r\nif (str[i] == '\n') {\r\ndo {\r\nwritten = cfe_write(cfe_cons_handle, &str[last], i-last);\r\nif (written < 0)\r\n;\r\nlast += written;\r\n} while (last < i);\r\nwhile (cfe_write(cfe_cons_handle, "\r", 1) <= 0)\r\n;\r\n}\r\n}\r\nif (last != count) {\r\ndo {\r\nwritten = cfe_write(cfe_cons_handle, &str[last], count-last);\r\nif (written < 0)\r\n;\r\nlast += written;\r\n} while (last < count);\r\n}\r\n}\r\nstatic int cfe_console_setup(struct console *cons, char *str)\r\n{\r\nchar consdev[32];\r\nif (cfe_getenv("BOOT_CONSOLE", consdev, 32) >= 0) {\r\n#ifdef CONFIG_SERIAL_SB1250_DUART\r\nif (!strcmp(consdev, "uart0")) {\r\nsetleds("u0cn");\r\n} else if (!strcmp(consdev, "uart1")) {\r\nsetleds("u1cn");\r\n} else\r\n#endif\r\n#ifdef CONFIG_VGA_CONSOLE\r\nif (!strcmp(consdev, "pcconsole0")) {\r\nsetleds("pccn");\r\n} else\r\n#endif\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init sb1250_cfe_console_init(void)\r\n{\r\nregister_console(&sb1250_cfe_cons);\r\nreturn 0;\r\n}
