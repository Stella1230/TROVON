void exynos3250_jpeg_reset(void __iomem *regs)\r\n{\r\nu32 reg = 1;\r\nint count = 1000;\r\nwritel(1, regs + EXYNOS3250_SW_RESET);\r\nwhile (reg != 0 && --count > 0) {\r\nudelay(1);\r\ncpu_relax();\r\nreg = readl(regs + EXYNOS3250_SW_RESET);\r\n}\r\nreg = 0;\r\ncount = 1000;\r\nwhile (reg != 1 && --count > 0) {\r\nwritel(1, regs + EXYNOS3250_JPGDRI);\r\nudelay(1);\r\ncpu_relax();\r\nreg = readl(regs + EXYNOS3250_JPGDRI);\r\n}\r\nwritel(0, regs + EXYNOS3250_JPGDRI);\r\n}\r\nvoid exynos3250_jpeg_poweron(void __iomem *regs)\r\n{\r\nwritel(EXYNOS3250_POWER_ON, regs + EXYNOS3250_JPGCLKCON);\r\n}\r\nvoid exynos3250_jpeg_set_dma_num(void __iomem *regs)\r\n{\r\nwritel(((EXYNOS3250_DMA_MO_COUNT << EXYNOS3250_WDMA_ISSUE_NUM_SHIFT) &\r\nEXYNOS3250_WDMA_ISSUE_NUM_MASK) |\r\n((EXYNOS3250_DMA_MO_COUNT << EXYNOS3250_RDMA_ISSUE_NUM_SHIFT) &\r\nEXYNOS3250_RDMA_ISSUE_NUM_MASK) |\r\n((EXYNOS3250_DMA_MO_COUNT << EXYNOS3250_ISSUE_GATHER_NUM_SHIFT) &\r\nEXYNOS3250_ISSUE_GATHER_NUM_MASK),\r\nregs + EXYNOS3250_DMA_ISSUE_NUM);\r\n}\r\nvoid exynos3250_jpeg_clk_set(void __iomem *base)\r\n{\r\nu32 reg;\r\nreg = readl(base + EXYNOS3250_JPGCMOD) & ~EXYNOS3250_HALF_EN_MASK;\r\nwritel(reg | EXYNOS3250_HALF_EN, base + EXYNOS3250_JPGCMOD);\r\n}\r\nvoid exynos3250_jpeg_input_raw_fmt(void __iomem *regs, unsigned int fmt)\r\n{\r\nu32 reg;\r\nreg = readl(regs + EXYNOS3250_JPGCMOD) &\r\nEXYNOS3250_MODE_Y16_MASK;\r\nswitch (fmt) {\r\ncase V4L2_PIX_FMT_RGB32:\r\nreg |= EXYNOS3250_MODE_SEL_ARGB8888;\r\nbreak;\r\ncase V4L2_PIX_FMT_BGR32:\r\nreg |= EXYNOS3250_MODE_SEL_ARGB8888 | EXYNOS3250_SRC_SWAP_RGB;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565:\r\nreg |= EXYNOS3250_MODE_SEL_RGB565;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565X:\r\nreg |= EXYNOS3250_MODE_SEL_RGB565 | EXYNOS3250_SRC_SWAP_RGB;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUYV:\r\nreg |= EXYNOS3250_MODE_SEL_422_1P_LUM_CHR;\r\nbreak;\r\ncase V4L2_PIX_FMT_YVYU:\r\nreg |= EXYNOS3250_MODE_SEL_422_1P_LUM_CHR |\r\nEXYNOS3250_SRC_SWAP_UV;\r\nbreak;\r\ncase V4L2_PIX_FMT_UYVY:\r\nreg |= EXYNOS3250_MODE_SEL_422_1P_CHR_LUM;\r\nbreak;\r\ncase V4L2_PIX_FMT_VYUY:\r\nreg |= EXYNOS3250_MODE_SEL_422_1P_CHR_LUM |\r\nEXYNOS3250_SRC_SWAP_UV;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV12:\r\nreg |= EXYNOS3250_MODE_SEL_420_2P | EXYNOS3250_SRC_NV12;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV21:\r\nreg |= EXYNOS3250_MODE_SEL_420_2P | EXYNOS3250_SRC_NV21;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUV420:\r\nreg |= EXYNOS3250_MODE_SEL_420_3P;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nwritel(reg, regs + EXYNOS3250_JPGCMOD);\r\n}\r\nvoid exynos3250_jpeg_set_y16(void __iomem *regs, bool y16)\r\n{\r\nu32 reg;\r\nreg = readl(regs + EXYNOS3250_JPGCMOD);\r\nif (y16)\r\nreg |= EXYNOS3250_MODE_Y16;\r\nelse\r\nreg &= ~EXYNOS3250_MODE_Y16_MASK;\r\nwritel(reg, regs + EXYNOS3250_JPGCMOD);\r\n}\r\nvoid exynos3250_jpeg_proc_mode(void __iomem *regs, unsigned int mode)\r\n{\r\nu32 reg, m;\r\nif (mode == S5P_JPEG_ENCODE)\r\nm = EXYNOS3250_PROC_MODE_COMPR;\r\nelse\r\nm = EXYNOS3250_PROC_MODE_DECOMPR;\r\nreg = readl(regs + EXYNOS3250_JPGMOD);\r\nreg &= ~EXYNOS3250_PROC_MODE_MASK;\r\nreg |= m;\r\nwritel(reg, regs + EXYNOS3250_JPGMOD);\r\n}\r\nvoid exynos3250_jpeg_subsampling_mode(void __iomem *regs, unsigned int mode)\r\n{\r\nu32 reg, m = 0;\r\nswitch (mode) {\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_444:\r\nm = EXYNOS3250_SUBSAMPLING_MODE_444;\r\nbreak;\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_422:\r\nm = EXYNOS3250_SUBSAMPLING_MODE_422;\r\nbreak;\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_420:\r\nm = EXYNOS3250_SUBSAMPLING_MODE_420;\r\nbreak;\r\n}\r\nreg = readl(regs + EXYNOS3250_JPGMOD);\r\nreg &= ~EXYNOS3250_SUBSAMPLING_MODE_MASK;\r\nreg |= m;\r\nwritel(reg, regs + EXYNOS3250_JPGMOD);\r\n}\r\nunsigned int exynos3250_jpeg_get_subsampling_mode(void __iomem *regs)\r\n{\r\nreturn readl(regs + EXYNOS3250_JPGMOD) &\r\nEXYNOS3250_SUBSAMPLING_MODE_MASK;\r\n}\r\nvoid exynos3250_jpeg_dri(void __iomem *regs, unsigned int dri)\r\n{\r\nu32 reg;\r\nreg = dri & EXYNOS3250_JPGDRI_MASK;\r\nwritel(reg, regs + EXYNOS3250_JPGDRI);\r\n}\r\nvoid exynos3250_jpeg_qtbl(void __iomem *regs, unsigned int t, unsigned int n)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + EXYNOS3250_QHTBL);\r\nreg &= ~EXYNOS3250_QT_NUM_MASK(t);\r\nreg |= (n << EXYNOS3250_QT_NUM_SHIFT(t)) &\r\nEXYNOS3250_QT_NUM_MASK(t);\r\nwritel(reg, regs + EXYNOS3250_QHTBL);\r\n}\r\nvoid exynos3250_jpeg_htbl_ac(void __iomem *regs, unsigned int t)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + EXYNOS3250_QHTBL);\r\nreg &= ~EXYNOS3250_HT_NUM_AC_MASK(t);\r\nreg |= (0 << EXYNOS3250_HT_NUM_AC_SHIFT(t)) &\r\nEXYNOS3250_HT_NUM_AC_MASK(t);\r\nwritel(reg, regs + EXYNOS3250_QHTBL);\r\n}\r\nvoid exynos3250_jpeg_htbl_dc(void __iomem *regs, unsigned int t)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + EXYNOS3250_QHTBL);\r\nreg &= ~EXYNOS3250_HT_NUM_DC_MASK(t);\r\nreg |= (0 << EXYNOS3250_HT_NUM_DC_SHIFT(t)) &\r\nEXYNOS3250_HT_NUM_DC_MASK(t);\r\nwritel(reg, regs + EXYNOS3250_QHTBL);\r\n}\r\nvoid exynos3250_jpeg_set_y(void __iomem *regs, unsigned int y)\r\n{\r\nu32 reg;\r\nreg = y & EXYNOS3250_JPGY_MASK;\r\nwritel(reg, regs + EXYNOS3250_JPGY);\r\n}\r\nvoid exynos3250_jpeg_set_x(void __iomem *regs, unsigned int x)\r\n{\r\nu32 reg;\r\nreg = x & EXYNOS3250_JPGX_MASK;\r\nwritel(reg, regs + EXYNOS3250_JPGX);\r\n}\r\nvoid exynos3250_jpeg_interrupts_enable(void __iomem *regs)\r\n{\r\nu32 reg;\r\nreg = readl(regs + EXYNOS3250_JPGINTSE);\r\nreg |= (EXYNOS3250_JPEG_DONE_EN |\r\nEXYNOS3250_WDMA_DONE_EN |\r\nEXYNOS3250_RDMA_DONE_EN |\r\nEXYNOS3250_ENC_STREAM_INT_EN |\r\nEXYNOS3250_CORE_DONE_EN |\r\nEXYNOS3250_ERR_INT_EN |\r\nEXYNOS3250_HEAD_INT_EN);\r\nwritel(reg, regs + EXYNOS3250_JPGINTSE);\r\n}\r\nvoid exynos3250_jpeg_enc_stream_bound(void __iomem *regs, unsigned int size)\r\n{\r\nu32 reg;\r\nreg = size & EXYNOS3250_ENC_STREAM_BOUND_MASK;\r\nwritel(reg, regs + EXYNOS3250_ENC_STREAM_BOUND);\r\n}\r\nvoid exynos3250_jpeg_output_raw_fmt(void __iomem *regs, unsigned int fmt)\r\n{\r\nu32 reg;\r\nswitch (fmt) {\r\ncase V4L2_PIX_FMT_RGB32:\r\nreg = EXYNOS3250_OUT_FMT_ARGB8888;\r\nbreak;\r\ncase V4L2_PIX_FMT_BGR32:\r\nreg = EXYNOS3250_OUT_FMT_ARGB8888 | EXYNOS3250_OUT_SWAP_RGB;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565:\r\nreg = EXYNOS3250_OUT_FMT_RGB565;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565X:\r\nreg = EXYNOS3250_OUT_FMT_RGB565 | EXYNOS3250_OUT_SWAP_RGB;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUYV:\r\nreg = EXYNOS3250_OUT_FMT_422_1P_LUM_CHR;\r\nbreak;\r\ncase V4L2_PIX_FMT_YVYU:\r\nreg = EXYNOS3250_OUT_FMT_422_1P_LUM_CHR |\r\nEXYNOS3250_OUT_SWAP_UV;\r\nbreak;\r\ncase V4L2_PIX_FMT_UYVY:\r\nreg = EXYNOS3250_OUT_FMT_422_1P_CHR_LUM;\r\nbreak;\r\ncase V4L2_PIX_FMT_VYUY:\r\nreg = EXYNOS3250_OUT_FMT_422_1P_CHR_LUM |\r\nEXYNOS3250_OUT_SWAP_UV;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV12:\r\nreg = EXYNOS3250_OUT_FMT_420_2P | EXYNOS3250_OUT_NV12;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV21:\r\nreg = EXYNOS3250_OUT_FMT_420_2P | EXYNOS3250_OUT_NV21;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUV420:\r\nreg = EXYNOS3250_OUT_FMT_420_3P;\r\nbreak;\r\ndefault:\r\nreg = 0;\r\nbreak;\r\n}\r\nwritel(reg, regs + EXYNOS3250_OUTFORM);\r\n}\r\nvoid exynos3250_jpeg_jpgadr(void __iomem *regs, unsigned int addr)\r\n{\r\nwritel(addr, regs + EXYNOS3250_JPG_JPGADR);\r\n}\r\nvoid exynos3250_jpeg_imgadr(void __iomem *regs, struct s5p_jpeg_addr *img_addr)\r\n{\r\nwritel(img_addr->y, regs + EXYNOS3250_LUMA_BASE);\r\nwritel(img_addr->cb, regs + EXYNOS3250_CHROMA_BASE);\r\nwritel(img_addr->cr, regs + EXYNOS3250_CHROMA_CR_BASE);\r\n}\r\nvoid exynos3250_jpeg_stride(void __iomem *regs, unsigned int img_fmt,\r\nunsigned int width)\r\n{\r\nu32 reg_luma = 0, reg_cr = 0, reg_cb = 0;\r\nswitch (img_fmt) {\r\ncase V4L2_PIX_FMT_RGB32:\r\nreg_luma = 4 * width;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565:\r\ncase V4L2_PIX_FMT_RGB565X:\r\ncase V4L2_PIX_FMT_YUYV:\r\ncase V4L2_PIX_FMT_YVYU:\r\ncase V4L2_PIX_FMT_UYVY:\r\ncase V4L2_PIX_FMT_VYUY:\r\nreg_luma = 2 * width;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV12:\r\ncase V4L2_PIX_FMT_NV21:\r\nreg_luma = width;\r\nreg_cb = reg_luma;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUV420:\r\nreg_luma = width;\r\nreg_cb = reg_cr = reg_luma / 2;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nwritel(reg_luma, regs + EXYNOS3250_LUMA_STRIDE);\r\nwritel(reg_cb, regs + EXYNOS3250_CHROMA_STRIDE);\r\nwritel(reg_cr, regs + EXYNOS3250_CHROMA_CR_STRIDE);\r\n}\r\nvoid exynos3250_jpeg_offset(void __iomem *regs, unsigned int x_offset,\r\nunsigned int y_offset)\r\n{\r\nu32 reg;\r\nreg = (y_offset << EXYNOS3250_LUMA_YY_OFFSET_SHIFT) &\r\nEXYNOS3250_LUMA_YY_OFFSET_MASK;\r\nreg |= (x_offset << EXYNOS3250_LUMA_YX_OFFSET_SHIFT) &\r\nEXYNOS3250_LUMA_YX_OFFSET_MASK;\r\nwritel(reg, regs + EXYNOS3250_LUMA_XY_OFFSET);\r\nreg = (y_offset << EXYNOS3250_CHROMA_YY_OFFSET_SHIFT) &\r\nEXYNOS3250_CHROMA_YY_OFFSET_MASK;\r\nreg |= (x_offset << EXYNOS3250_CHROMA_YX_OFFSET_SHIFT) &\r\nEXYNOS3250_CHROMA_YX_OFFSET_MASK;\r\nwritel(reg, regs + EXYNOS3250_CHROMA_XY_OFFSET);\r\nreg = (y_offset << EXYNOS3250_CHROMA_CR_YY_OFFSET_SHIFT) &\r\nEXYNOS3250_CHROMA_CR_YY_OFFSET_MASK;\r\nreg |= (x_offset << EXYNOS3250_CHROMA_CR_YX_OFFSET_SHIFT) &\r\nEXYNOS3250_CHROMA_CR_YX_OFFSET_MASK;\r\nwritel(reg, regs + EXYNOS3250_CHROMA_CR_XY_OFFSET);\r\n}\r\nvoid exynos3250_jpeg_coef(void __iomem *base, unsigned int mode)\r\n{\r\nif (mode == S5P_JPEG_ENCODE) {\r\nwritel(EXYNOS3250_JPEG_ENC_COEF1,\r\nbase + EXYNOS3250_JPG_COEF(1));\r\nwritel(EXYNOS3250_JPEG_ENC_COEF2,\r\nbase + EXYNOS3250_JPG_COEF(2));\r\nwritel(EXYNOS3250_JPEG_ENC_COEF3,\r\nbase + EXYNOS3250_JPG_COEF(3));\r\n} else {\r\nwritel(EXYNOS3250_JPEG_DEC_COEF1,\r\nbase + EXYNOS3250_JPG_COEF(1));\r\nwritel(EXYNOS3250_JPEG_DEC_COEF2,\r\nbase + EXYNOS3250_JPG_COEF(2));\r\nwritel(EXYNOS3250_JPEG_DEC_COEF3,\r\nbase + EXYNOS3250_JPG_COEF(3));\r\n}\r\n}\r\nvoid exynos3250_jpeg_start(void __iomem *regs)\r\n{\r\nwritel(1, regs + EXYNOS3250_JSTART);\r\n}\r\nvoid exynos3250_jpeg_rstart(void __iomem *regs)\r\n{\r\nwritel(1, regs + EXYNOS3250_JRSTART);\r\n}\r\nunsigned int exynos3250_jpeg_get_int_status(void __iomem *regs)\r\n{\r\nreturn readl(regs + EXYNOS3250_JPGINTST);\r\n}\r\nvoid exynos3250_jpeg_clear_int_status(void __iomem *regs,\r\nunsigned int value)\r\n{\r\nreturn writel(value, regs + EXYNOS3250_JPGINTST);\r\n}\r\nunsigned int exynos3250_jpeg_operating(void __iomem *regs)\r\n{\r\nreturn readl(regs + S5P_JPGOPR) & EXYNOS3250_JPGOPR_MASK;\r\n}\r\nunsigned int exynos3250_jpeg_compressed_size(void __iomem *regs)\r\n{\r\nreturn readl(regs + EXYNOS3250_JPGCNT) & EXYNOS3250_JPGCNT_MASK;\r\n}\r\nvoid exynos3250_jpeg_dec_stream_size(void __iomem *regs,\r\nunsigned int size)\r\n{\r\nwritel(size & EXYNOS3250_DEC_STREAM_MASK,\r\nregs + EXYNOS3250_DEC_STREAM_SIZE);\r\n}\r\nvoid exynos3250_jpeg_dec_scaling_ratio(void __iomem *regs,\r\nunsigned int sratio)\r\n{\r\nswitch (sratio) {\r\ncase 1:\r\ndefault:\r\nsratio = EXYNOS3250_DEC_SCALE_FACTOR_8_8;\r\nbreak;\r\ncase 2:\r\nsratio = EXYNOS3250_DEC_SCALE_FACTOR_4_8;\r\nbreak;\r\ncase 4:\r\nsratio = EXYNOS3250_DEC_SCALE_FACTOR_2_8;\r\nbreak;\r\ncase 8:\r\nsratio = EXYNOS3250_DEC_SCALE_FACTOR_1_8;\r\nbreak;\r\n}\r\nwritel(sratio & EXYNOS3250_DEC_SCALE_FACTOR_MASK,\r\nregs + EXYNOS3250_DEC_SCALING_RATIO);\r\n}\r\nvoid exynos3250_jpeg_set_timer(void __iomem *regs, unsigned int time_value)\r\n{\r\ntime_value &= EXYNOS3250_TIMER_INIT_MASK;\r\nwritel(EXYNOS3250_TIMER_INT_STAT | time_value,\r\nregs + EXYNOS3250_TIMER_SE);\r\n}\r\nunsigned int exynos3250_jpeg_get_timer_status(void __iomem *regs)\r\n{\r\nreturn readl(regs + EXYNOS3250_TIMER_ST);\r\n}\r\nvoid exynos3250_jpeg_clear_timer_status(void __iomem *regs)\r\n{\r\nwritel(EXYNOS3250_TIMER_INT_STAT, regs + EXYNOS3250_TIMER_ST);\r\n}
