struct nvkm_engine *\r\nnvkm_engine(void *obj, int idx)\r\n{\r\nobj = nvkm_subdev(obj, idx);\r\nif (obj && nv_iclass(obj, NV_ENGINE_CLASS))\r\nreturn nv_engine(obj);\r\nreturn NULL;\r\n}\r\nint\r\nnvkm_engine_create_(struct nvkm_object *parent, struct nvkm_object *engobj,\r\nstruct nvkm_oclass *oclass, bool enable,\r\nconst char *iname, const char *fname,\r\nint length, void **pobject)\r\n{\r\nstruct nvkm_engine *engine;\r\nint ret;\r\nret = nvkm_subdev_create_(parent, engobj, oclass, NV_ENGINE_CLASS,\r\niname, fname, length, pobject);\r\nengine = *pobject;\r\nif (ret)\r\nreturn ret;\r\nif (parent) {\r\nstruct nvkm_device *device = nv_device(parent);\r\nint engidx = nv_engidx(engine);\r\nif (device->disable_mask & (1ULL << engidx)) {\r\nif (!nvkm_boolopt(device->cfgopt, iname, false)) {\r\nnv_debug(engine, "engine disabled by hw/fw\n");\r\nreturn -ENODEV;\r\n}\r\nnv_warn(engine, "ignoring hw/fw engine disable\n");\r\n}\r\nif (!nvkm_boolopt(device->cfgopt, iname, enable)) {\r\nif (!enable)\r\nnv_warn(engine, "disabled, %s=1 to enable\n", iname);\r\nreturn -ENODEV;\r\n}\r\n}\r\nINIT_LIST_HEAD(&engine->contexts);\r\nspin_lock_init(&engine->lock);\r\nreturn 0;\r\n}
