static int __init omap3logic_i2c_init(void)\r\n{\r\nomap3_pmic_init("twl4030", &omap3logic_twldata);\r\nreturn 0;\r\n}\r\nstatic void __init board_mmc_init(void)\r\n{\r\nif (machine_is_omap3530_lv_som()) {\r\nboard_mmc_info[0].gpio_cd = OMAP3530_LV_SOM_MMC_GPIO_CD;\r\nboard_mmc_info[0].gpio_wp = OMAP3530_LV_SOM_MMC_GPIO_WP;\r\nomap_mux_init_signal("gpio_110", OMAP_PIN_OUTPUT);\r\nomap_mux_init_signal("gpio_126", OMAP_PIN_OUTPUT);\r\n} else if (machine_is_omap3_torpedo()) {\r\nboard_mmc_info[0].gpio_cd = OMAP3_TORPEDO_MMC_GPIO_CD;\r\nomap_mux_init_signal("gpio_127", OMAP_PIN_OUTPUT);\r\n} else {\r\nprintk(KERN_ERR "%s(): unknown machine type\n", __func__);\r\nreturn;\r\n}\r\nomap_hsmmc_init(board_mmc_info);\r\n}\r\nstatic void omap3torpedo_fix_pbias_voltage(void)\r\n{\r\nu16 control_pbias_offset = OMAP343X_CONTROL_PBIAS_LITE;\r\nu32 reg;\r\nif (machine_is_omap3_torpedo())\r\n{\r\nreg = omap_ctrl_readl(control_pbias_offset);\r\nreg &= ~OMAP343X_PBIASLITEPWRDNZ1;\r\nomap_ctrl_writel(reg, control_pbias_offset);\r\nmsleep(100);\r\nreg |= OMAP343X_PBIASLITEVMODE1;\r\nreg |= OMAP343X_PBIASLITEPWRDNZ1;\r\nomap_ctrl_writel(reg | 0x300, control_pbias_offset);\r\n}\r\n}\r\nstatic inline void __init board_smsc911x_init(void)\r\n{\r\nif (machine_is_omap3530_lv_som()) {\r\nboard_smsc911x_data.gpio_irq =\r\nOMAP3530_LV_SOM_SMSC911X_GPIO_IRQ;\r\nomap_mux_init_signal("gpio_152", OMAP_PIN_INPUT);\r\n} else if (machine_is_omap3_torpedo()) {\r\nboard_smsc911x_data.gpio_irq = OMAP3_TORPEDO_SMSC911X_GPIO_IRQ;\r\nomap_mux_init_signal("gpio_129", OMAP_PIN_INPUT);\r\n} else {\r\nprintk(KERN_ERR "%s(): unknown machine type\n", __func__);\r\nreturn;\r\n}\r\ngpmc_smsc911x_init(&board_smsc911x_data);\r\n}\r\nstatic void __init omap3logic_init(void)\r\n{\r\nregulator_register_fixed(0, dummy_supplies, ARRAY_SIZE(dummy_supplies));\r\nomap3_mux_init(board_mux, OMAP_PACKAGE_CBB);\r\nomap3torpedo_fix_pbias_voltage();\r\nomap3logic_i2c_init();\r\nomap_serial_init();\r\nomap_sdrc_init(NULL, NULL);\r\nboard_mmc_init();\r\nboard_smsc911x_init();\r\nusb_bind_phy("musb-hdrc.0.auto", 0, "twl4030_usb");\r\nusb_musb_init(NULL);\r\nomap_mux_init_signal("sdrc_cke0", OMAP_PIN_OUTPUT);\r\nomap_mux_init_signal("sdrc_cke1", OMAP_PIN_OUTPUT);\r\n}
