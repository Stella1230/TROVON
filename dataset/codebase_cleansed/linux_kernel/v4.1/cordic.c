struct cordic_iq cordic_calc_iq(s32 theta)\r\n{\r\nstruct cordic_iq coord;\r\ns32 angle, valtmp;\r\nunsigned iter;\r\nint signx = 1;\r\nint signtheta;\r\ncoord.i = CORDIC_ANGLE_GEN;\r\ncoord.q = 0;\r\nangle = 0;\r\ntheta = FIXED(theta);\r\nsigntheta = (theta < 0) ? -1 : 1;\r\ntheta = ((theta + FIXED(180) * signtheta) % FIXED(360)) -\r\nFIXED(180) * signtheta;\r\nif (FLOAT(theta) > 90) {\r\ntheta -= FIXED(180);\r\nsignx = -1;\r\n} else if (FLOAT(theta) < -90) {\r\ntheta += FIXED(180);\r\nsignx = -1;\r\n}\r\nfor (iter = 0; iter < CORDIC_NUM_ITER; iter++) {\r\nif (theta > angle) {\r\nvaltmp = coord.i - (coord.q >> iter);\r\ncoord.q += (coord.i >> iter);\r\nangle += arctan_table[iter];\r\n} else {\r\nvaltmp = coord.i + (coord.q >> iter);\r\ncoord.q -= (coord.i >> iter);\r\nangle -= arctan_table[iter];\r\n}\r\ncoord.i = valtmp;\r\n}\r\ncoord.i *= signx;\r\ncoord.q *= signx;\r\nreturn coord;\r\n}
