u16\r\nnvbios_timingTe(struct nvkm_bios *bios,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len, u8 *snr, u8 *ssz)\r\n{\r\nstruct bit_entry bit_P;\r\nu16 timing = 0x0000;\r\nif (!bit_entry(bios, 'P', &bit_P)) {\r\nif (bit_P.version == 1)\r\ntiming = nv_ro16(bios, bit_P.offset + 4);\r\nelse\r\nif (bit_P.version == 2)\r\ntiming = nv_ro16(bios, bit_P.offset + 8);\r\nif (timing) {\r\n*ver = nv_ro08(bios, timing + 0);\r\nswitch (*ver) {\r\ncase 0x10:\r\n*hdr = nv_ro08(bios, timing + 1);\r\n*cnt = nv_ro08(bios, timing + 2);\r\n*len = nv_ro08(bios, timing + 3);\r\n*snr = 0;\r\n*ssz = 0;\r\nreturn timing;\r\ncase 0x20:\r\n*hdr = nv_ro08(bios, timing + 1);\r\n*cnt = nv_ro08(bios, timing + 5);\r\n*len = nv_ro08(bios, timing + 2);\r\n*snr = nv_ro08(bios, timing + 4);\r\n*ssz = nv_ro08(bios, timing + 3);\r\nreturn timing;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn 0x0000;\r\n}\r\nu16\r\nnvbios_timingEe(struct nvkm_bios *bios, int idx,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len)\r\n{\r\nu8 snr, ssz;\r\nu16 timing = nvbios_timingTe(bios, ver, hdr, cnt, len, &snr, &ssz);\r\nif (timing && idx < *cnt) {\r\ntiming += *hdr + idx * (*len + (snr * ssz));\r\n*hdr = *len;\r\n*cnt = snr;\r\n*len = ssz;\r\nreturn timing;\r\n}\r\nreturn 0x0000;\r\n}\r\nu16\r\nnvbios_timingEp(struct nvkm_bios *bios, int idx,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_ramcfg *p)\r\n{\r\nu16 data = nvbios_timingEe(bios, idx, ver, hdr, cnt, len), temp;\r\np->timing_ver = *ver;\r\np->timing_hdr = *hdr;\r\nswitch (!!data * *ver) {\r\ncase 0x10:\r\np->timing_10_WR = nv_ro08(bios, data + 0x00);\r\np->timing_10_WTR = nv_ro08(bios, data + 0x01);\r\np->timing_10_CL = nv_ro08(bios, data + 0x02);\r\np->timing_10_RC = nv_ro08(bios, data + 0x03);\r\np->timing_10_RFC = nv_ro08(bios, data + 0x05);\r\np->timing_10_RAS = nv_ro08(bios, data + 0x07);\r\np->timing_10_RP = nv_ro08(bios, data + 0x09);\r\np->timing_10_RCDRD = nv_ro08(bios, data + 0x0a);\r\np->timing_10_RCDWR = nv_ro08(bios, data + 0x0b);\r\np->timing_10_RRD = nv_ro08(bios, data + 0x0c);\r\np->timing_10_13 = nv_ro08(bios, data + 0x0d);\r\np->timing_10_ODT = nv_ro08(bios, data + 0x0e) & 0x07;\r\np->timing_10_24 = 0xff;\r\np->timing_10_21 = 0;\r\np->timing_10_20 = 0;\r\np->timing_10_CWL = 0;\r\np->timing_10_18 = 0;\r\np->timing_10_16 = 0;\r\nswitch (min_t(u8, *hdr, 25)) {\r\ncase 25:\r\np->timing_10_24 = nv_ro08(bios, data + 0x18);\r\ncase 24:\r\ncase 23:\r\ncase 22:\r\np->timing_10_21 = nv_ro08(bios, data + 0x15);\r\ncase 21:\r\np->timing_10_20 = nv_ro08(bios, data + 0x14);\r\ncase 20:\r\np->timing_10_CWL = nv_ro08(bios, data + 0x13);\r\ncase 19:\r\np->timing_10_18 = nv_ro08(bios, data + 0x12);\r\ncase 18:\r\ncase 17:\r\np->timing_10_16 = nv_ro08(bios, data + 0x10);\r\n}\r\nbreak;\r\ncase 0x20:\r\np->timing[0] = nv_ro32(bios, data + 0x00);\r\np->timing[1] = nv_ro32(bios, data + 0x04);\r\np->timing[2] = nv_ro32(bios, data + 0x08);\r\np->timing[3] = nv_ro32(bios, data + 0x0c);\r\np->timing[4] = nv_ro32(bios, data + 0x10);\r\np->timing[5] = nv_ro32(bios, data + 0x14);\r\np->timing[6] = nv_ro32(bios, data + 0x18);\r\np->timing[7] = nv_ro32(bios, data + 0x1c);\r\np->timing[8] = nv_ro32(bios, data + 0x20);\r\np->timing[9] = nv_ro32(bios, data + 0x24);\r\np->timing[10] = nv_ro32(bios, data + 0x28);\r\np->timing_20_2e_03 = (nv_ro08(bios, data + 0x2e) & 0x03) >> 0;\r\np->timing_20_2e_30 = (nv_ro08(bios, data + 0x2e) & 0x30) >> 4;\r\np->timing_20_2e_c0 = (nv_ro08(bios, data + 0x2e) & 0xc0) >> 6;\r\np->timing_20_2f_03 = (nv_ro08(bios, data + 0x2f) & 0x03) >> 0;\r\ntemp = nv_ro16(bios, data + 0x2c);\r\np->timing_20_2c_003f = (temp & 0x003f) >> 0;\r\np->timing_20_2c_1fc0 = (temp & 0x1fc0) >> 6;\r\np->timing_20_30_07 = (nv_ro08(bios, data + 0x30) & 0x07) >> 0;\r\np->timing_20_30_f8 = (nv_ro08(bios, data + 0x30) & 0xf8) >> 3;\r\ntemp = nv_ro16(bios, data + 0x31);\r\np->timing_20_31_0007 = (temp & 0x0007) >> 0;\r\np->timing_20_31_0078 = (temp & 0x0078) >> 3;\r\np->timing_20_31_0780 = (temp & 0x0780) >> 7;\r\np->timing_20_31_0800 = (temp & 0x0800) >> 11;\r\np->timing_20_31_7000 = (temp & 0x7000) >> 12;\r\np->timing_20_31_8000 = (temp & 0x8000) >> 15;\r\nbreak;\r\ndefault:\r\ndata = 0;\r\nbreak;\r\n}\r\nreturn data;\r\n}
