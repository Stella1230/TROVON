static int sti_vid_prepare_layer(struct sti_layer *vid, bool first_prepare)\r\n{\r\nu32 val;\r\nval = readl(vid->regs + VID_CTL);\r\nval &= ~VID_CTL_IGNORE;\r\nwritel(val, vid->regs + VID_CTL);\r\nreturn 0;\r\n}\r\nstatic int sti_vid_commit_layer(struct sti_layer *vid)\r\n{\r\nstruct drm_display_mode *mode = vid->mode;\r\nu32 ydo, xdo, yds, xds;\r\nydo = sti_vtg_get_line_number(*mode, vid->dst_y);\r\nyds = sti_vtg_get_line_number(*mode, vid->dst_y + vid->dst_h - 1);\r\nxdo = sti_vtg_get_pixel_number(*mode, vid->dst_x);\r\nxds = sti_vtg_get_pixel_number(*mode, vid->dst_x + vid->dst_w - 1);\r\nwritel((ydo << 16) | xdo, vid->regs + VID_VPO);\r\nwritel((yds << 16) | xds, vid->regs + VID_VPS);\r\nreturn 0;\r\n}\r\nstatic int sti_vid_disable_layer(struct sti_layer *vid)\r\n{\r\nu32 val;\r\nval = readl(vid->regs + VID_CTL);\r\nval |= VID_CTL_IGNORE;\r\nwritel(val, vid->regs + VID_CTL);\r\nreturn 0;\r\n}\r\nstatic const uint32_t *sti_vid_get_formats(struct sti_layer *layer)\r\n{\r\nreturn NULL;\r\n}\r\nstatic unsigned int sti_vid_get_nb_formats(struct sti_layer *layer)\r\n{\r\nreturn 0;\r\n}\r\nstatic void sti_vid_init(struct sti_layer *vid)\r\n{\r\nwritel(VID_CTL_PSI_ENABLE | VID_CTL_IGNORE, vid->regs + VID_CTL);\r\nwritel(VID_ALP_OPAQUE, vid->regs + VID_ALP);\r\nwritel(VID_MPR0_BT709, vid->regs + VID_MPR0);\r\nwritel(VID_MPR1_BT709, vid->regs + VID_MPR1);\r\nwritel(VID_MPR2_BT709, vid->regs + VID_MPR2);\r\nwritel(VID_MPR3_BT709, vid->regs + VID_MPR3);\r\nwritel(VID_BC_DFLT, vid->regs + VID_BC);\r\nwritel(VID_TINT_DFLT, vid->regs + VID_TINT);\r\nwritel(VID_CSAT_DFLT, vid->regs + VID_CSAT);\r\n}\r\nstruct sti_layer *sti_vid_create(struct device *dev)\r\n{\r\nstruct sti_layer *vid;\r\nvid = devm_kzalloc(dev, sizeof(*vid), GFP_KERNEL);\r\nif (!vid) {\r\nDRM_ERROR("Failed to allocate memory for VID\n");\r\nreturn NULL;\r\n}\r\nvid->ops = &vid_ops;\r\nreturn vid;\r\n}
