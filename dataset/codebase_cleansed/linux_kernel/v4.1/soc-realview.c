static const char *realview_board_str(u32 id)\r\n{\r\nswitch ((id >> 16) & 0xfff) {\r\ncase 0x0147:\r\nreturn "HBI-0147";\r\ndefault:\r\nreturn "Unknown";\r\n}\r\n}\r\nstatic const char *realview_arch_str(u32 id)\r\n{\r\nswitch ((id >> 8) & 0xf) {\r\ncase 0x05:\r\nreturn "Multi-layer AXI";\r\ndefault:\r\nreturn "Unknown";\r\n}\r\n}\r\nstatic ssize_t realview_get_manf(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%02x\n", realview_coreid >> 24);\r\n}\r\nstatic ssize_t realview_get_board(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%s\n", realview_board_str(realview_coreid));\r\n}\r\nstatic ssize_t realview_get_arch(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%s\n", realview_arch_str(realview_coreid));\r\n}\r\nstatic ssize_t realview_get_build(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%02x\n", (realview_coreid & 0xFF));\r\n}\r\nstatic int realview_soc_probe(struct platform_device *pdev)\r\n{\r\nstatic struct regmap *syscon_regmap;\r\nstruct soc_device *soc_dev;\r\nstruct soc_device_attribute *soc_dev_attr;\r\nstruct device_node *np = pdev->dev.of_node;\r\nint ret;\r\nsyscon_regmap = syscon_regmap_lookup_by_phandle(np, "regmap");\r\nif (IS_ERR(syscon_regmap))\r\nreturn PTR_ERR(syscon_regmap);\r\nsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\r\nif (!soc_dev_attr)\r\nreturn -ENOMEM;\r\nret = of_property_read_string(np, "compatible",\r\n&soc_dev_attr->soc_id);\r\nif (ret)\r\nreturn -EINVAL;\r\nsoc_dev_attr->machine = "RealView";\r\nsoc_dev_attr->family = "Versatile";\r\nsoc_dev = soc_device_register(soc_dev_attr);\r\nif (IS_ERR(soc_dev)) {\r\nkfree(soc_dev_attr);\r\nreturn -ENODEV;\r\n}\r\nret = regmap_read(syscon_regmap, REALVIEW_SYS_ID_OFFSET,\r\n&realview_coreid);\r\nif (ret)\r\nreturn -ENODEV;\r\ndevice_create_file(soc_device_to_device(soc_dev), &realview_manf_attr);\r\ndevice_create_file(soc_device_to_device(soc_dev), &realview_board_attr);\r\ndevice_create_file(soc_device_to_device(soc_dev), &realview_arch_attr);\r\ndevice_create_file(soc_device_to_device(soc_dev), &realview_build_attr);\r\ndev_info(&pdev->dev, "RealView Syscon Core ID: 0x%08x\n",\r\nrealview_coreid);\r\nreturn 0;\r\n}
