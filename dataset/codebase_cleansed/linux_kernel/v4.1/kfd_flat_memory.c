int kfd_init_apertures(struct kfd_process *process)\r\n{\r\nuint8_t id = 0;\r\nstruct kfd_dev *dev;\r\nstruct kfd_process_device *pdd;\r\nwhile ((dev = kfd_topology_enum_kfd_devices(id)) != NULL &&\r\nid < NUM_OF_SUPPORTED_GPUS) {\r\npdd = kfd_create_process_device_data(dev, process);\r\nif (pdd == NULL) {\r\npr_err("Failed to create process device data\n");\r\nreturn -1;\r\n}\r\nif (process->is_32bit_user_mode) {\r\npdd->lds_base = pdd->lds_limit = 0;\r\npdd->gpuvm_base = pdd->gpuvm_limit = 0;\r\npdd->scratch_base = pdd->scratch_limit = 0;\r\n} else {\r\npdd->lds_base = MAKE_LDS_APP_BASE(id + 1);\r\npdd->lds_limit = MAKE_LDS_APP_LIMIT(pdd->lds_base);\r\npdd->gpuvm_base = MAKE_GPUVM_APP_BASE(id + 1);\r\npdd->gpuvm_limit =\r\nMAKE_GPUVM_APP_LIMIT(pdd->gpuvm_base);\r\npdd->scratch_base = MAKE_SCRATCH_APP_BASE(id + 1);\r\npdd->scratch_limit =\r\nMAKE_SCRATCH_APP_LIMIT(pdd->scratch_base);\r\n}\r\ndev_dbg(kfd_device, "node id %u\n", id);\r\ndev_dbg(kfd_device, "gpu id %u\n", pdd->dev->id);\r\ndev_dbg(kfd_device, "lds_base %llX\n", pdd->lds_base);\r\ndev_dbg(kfd_device, "lds_limit %llX\n", pdd->lds_limit);\r\ndev_dbg(kfd_device, "gpuvm_base %llX\n", pdd->gpuvm_base);\r\ndev_dbg(kfd_device, "gpuvm_limit %llX\n", pdd->gpuvm_limit);\r\ndev_dbg(kfd_device, "scratch_base %llX\n", pdd->scratch_base);\r\ndev_dbg(kfd_device, "scratch_limit %llX\n", pdd->scratch_limit);\r\nid++;\r\n}\r\nreturn 0;\r\n}
