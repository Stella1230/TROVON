acpi_status acpi_ex_opcode_0A_0T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nacpi_status status = AE_OK;\r\nunion acpi_operand_object *return_desc = NULL;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_0A_0T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_TIMER_OP:\r\nreturn_desc =\r\nacpi_ut_create_integer_object(acpi_os_get_timer());\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\nbreak;\r\n}\r\ncleanup:\r\nif ((ACPI_FAILURE(status)) || walk_state->result_obj) {\r\nacpi_ut_remove_reference(return_desc);\r\nwalk_state->result_obj = NULL;\r\n} else {\r\nwalk_state->result_obj = return_desc;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_1A_0T_0R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_1A_0T_0R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_RELEASE_OP:\r\nstatus = acpi_ex_release_mutex(operand[0], walk_state);\r\nbreak;\r\ncase AML_RESET_OP:\r\nstatus = acpi_ex_system_reset_event(operand[0]);\r\nbreak;\r\ncase AML_SIGNAL_OP:\r\nstatus = acpi_ex_system_signal_event(operand[0]);\r\nbreak;\r\ncase AML_SLEEP_OP:\r\nstatus = acpi_ex_system_do_sleep(operand[0]->integer.value);\r\nbreak;\r\ncase AML_STALL_OP:\r\nstatus =\r\nacpi_ex_system_do_stall((u32) operand[0]->integer.value);\r\nbreak;\r\ncase AML_UNLOAD_OP:\r\nstatus = acpi_ex_unload_table(operand[0]);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\nbreak;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_1A_1T_0R(struct acpi_walk_state *walk_state)\r\n{\r\nacpi_status status = AE_OK;\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_1A_1T_0R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_LOAD_OP:\r\nstatus = acpi_ex_load_op(operand[0], operand[1], walk_state);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\ncleanup:\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_1A_1T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nacpi_status status = AE_OK;\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *return_desc = NULL;\r\nunion acpi_operand_object *return_desc2 = NULL;\r\nu32 temp32;\r\nu32 i;\r\nu64 power_of_ten;\r\nu64 digit;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_1A_1T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_BIT_NOT_OP:\r\ncase AML_FIND_SET_LEFT_BIT_OP:\r\ncase AML_FIND_SET_RIGHT_BIT_OP:\r\ncase AML_FROM_BCD_OP:\r\ncase AML_TO_BCD_OP:\r\ncase AML_COND_REF_OF_OP:\r\nreturn_desc = acpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nswitch (walk_state->opcode) {\r\ncase AML_BIT_NOT_OP:\r\nreturn_desc->integer.value = ~operand[0]->integer.value;\r\nbreak;\r\ncase AML_FIND_SET_LEFT_BIT_OP:\r\nreturn_desc->integer.value = operand[0]->integer.value;\r\nfor (temp32 = 0; return_desc->integer.value &&\r\ntemp32 < ACPI_INTEGER_BIT_SIZE; ++temp32) {\r\nreturn_desc->integer.value >>= 1;\r\n}\r\nreturn_desc->integer.value = temp32;\r\nbreak;\r\ncase AML_FIND_SET_RIGHT_BIT_OP:\r\nreturn_desc->integer.value = operand[0]->integer.value;\r\nfor (temp32 = 0; return_desc->integer.value &&\r\ntemp32 < ACPI_INTEGER_BIT_SIZE; ++temp32) {\r\nreturn_desc->integer.value <<= 1;\r\n}\r\nreturn_desc->integer.value =\r\ntemp32 ==\r\n0 ? 0 : (ACPI_INTEGER_BIT_SIZE + 1) - temp32;\r\nbreak;\r\ncase AML_FROM_BCD_OP:\r\npower_of_ten = 1;\r\nreturn_desc->integer.value = 0;\r\ndigit = operand[0]->integer.value;\r\nfor (i = 0;\r\n(i < acpi_gbl_integer_nybble_width) && (digit > 0);\r\ni++) {\r\ntemp32 = ((u32) digit) & 0xF;\r\nif (temp32 > 9) {\r\nACPI_ERROR((AE_INFO,\r\n"BCD digit too large (not decimal): 0x%X",\r\ntemp32));\r\nstatus = AE_AML_NUMERIC_OVERFLOW;\r\ngoto cleanup;\r\n}\r\nreturn_desc->integer.value +=\r\n(((u64) temp32) * power_of_ten);\r\ndigit >>= 4;\r\npower_of_ten *= 10;\r\n}\r\nbreak;\r\ncase AML_TO_BCD_OP:\r\nreturn_desc->integer.value = 0;\r\ndigit = operand[0]->integer.value;\r\nfor (i = 0;\r\n(i < acpi_gbl_integer_nybble_width) && (digit > 0);\r\ni++) {\r\n(void)acpi_ut_short_divide(digit, 10, &digit,\r\n&temp32);\r\nreturn_desc->integer.value |=\r\n(((u64) temp32) << ACPI_MUL_4(i));\r\n}\r\nif (digit > 0) {\r\nACPI_ERROR((AE_INFO,\r\n"Integer too large to convert to BCD: 0x%8.8X%8.8X",\r\nACPI_FORMAT_UINT64(operand[0]->\r\ninteger.value)));\r\nstatus = AE_AML_NUMERIC_OVERFLOW;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase AML_COND_REF_OF_OP:\r\nif ((struct acpi_namespace_node *)operand[0] ==\r\nacpi_gbl_root_node) {\r\nreturn_desc->integer.value = 0;\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ex_get_object_reference(operand[0],\r\n&return_desc2,\r\nwalk_state);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nstatus =\r\nacpi_ex_store(return_desc2, operand[1], walk_state);\r\nacpi_ut_remove_reference(return_desc2);\r\nreturn_desc->integer.value = ACPI_UINT64_MAX;\r\ngoto cleanup;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase AML_STORE_OP:\r\nstatus = acpi_ex_store(operand[0], operand[1], walk_state);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (!walk_state->result_obj) {\r\nwalk_state->result_obj = operand[0];\r\nwalk_state->operands[0] = NULL;\r\n}\r\nreturn_ACPI_STATUS(status);\r\ncase AML_COPY_OP:\r\nstatus =\r\nacpi_ut_copy_iobject_to_iobject(operand[0], &return_desc,\r\nwalk_state);\r\nbreak;\r\ncase AML_TO_DECSTRING_OP:\r\nstatus = acpi_ex_convert_to_string(operand[0], &return_desc,\r\nACPI_EXPLICIT_CONVERT_DECIMAL);\r\nif (return_desc == operand[0]) {\r\nacpi_ut_add_reference(return_desc);\r\n}\r\nbreak;\r\ncase AML_TO_HEXSTRING_OP:\r\nstatus = acpi_ex_convert_to_string(operand[0], &return_desc,\r\nACPI_EXPLICIT_CONVERT_HEX);\r\nif (return_desc == operand[0]) {\r\nacpi_ut_add_reference(return_desc);\r\n}\r\nbreak;\r\ncase AML_TO_BUFFER_OP:\r\nstatus = acpi_ex_convert_to_buffer(operand[0], &return_desc);\r\nif (return_desc == operand[0]) {\r\nacpi_ut_add_reference(return_desc);\r\n}\r\nbreak;\r\ncase AML_TO_INTEGER_OP:\r\nstatus = acpi_ex_convert_to_integer(operand[0], &return_desc,\r\nACPI_ANY_BASE);\r\nif (return_desc == operand[0]) {\r\nacpi_ut_add_reference(return_desc);\r\n}\r\nbreak;\r\ncase AML_SHIFT_LEFT_BIT_OP:\r\ncase AML_SHIFT_RIGHT_BIT_OP:\r\nACPI_ERROR((AE_INFO,\r\n"%s is obsolete and not implemented",\r\nacpi_ps_get_opcode_name(walk_state->opcode)));\r\nstatus = AE_SUPPORT;\r\ngoto cleanup;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\nif (ACPI_SUCCESS(status)) {\r\nstatus = acpi_ex_store(return_desc, operand[1], walk_state);\r\n}\r\ncleanup:\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ut_remove_reference(return_desc);\r\n}\r\nelse if (!walk_state->result_obj) {\r\nwalk_state->result_obj = return_desc;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_1A_0T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *temp_desc;\r\nunion acpi_operand_object *return_desc = NULL;\r\nacpi_status status = AE_OK;\r\nu32 type;\r\nu64 value;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_1A_0T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_LNOT_OP:\r\nreturn_desc = acpi_ut_create_integer_object((u64) 0);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nif (!operand[0]->integer.value) {\r\nreturn_desc->integer.value = ACPI_UINT64_MAX;\r\n}\r\nbreak;\r\ncase AML_DECREMENT_OP:\r\ncase AML_INCREMENT_OP:\r\nreturn_desc = acpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\ntemp_desc = operand[0];\r\nif (ACPI_GET_DESCRIPTOR_TYPE(temp_desc) ==\r\nACPI_DESC_TYPE_OPERAND) {\r\nacpi_ut_add_reference(temp_desc);\r\n}\r\nstatus =\r\nacpi_ex_resolve_operands(AML_LNOT_OP, &temp_desc,\r\nwalk_state);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"While resolving operands for [%s]",\r\nacpi_ps_get_opcode_name(walk_state->\r\nopcode)));\r\ngoto cleanup;\r\n}\r\nif (walk_state->opcode == AML_INCREMENT_OP) {\r\nreturn_desc->integer.value =\r\ntemp_desc->integer.value + 1;\r\n} else {\r\nreturn_desc->integer.value =\r\ntemp_desc->integer.value - 1;\r\n}\r\nacpi_ut_remove_reference(temp_desc);\r\nstatus = acpi_ex_store(return_desc, operand[0], walk_state);\r\nbreak;\r\ncase AML_TYPE_OP:\r\nstatus =\r\nacpi_ex_resolve_multiple(walk_state, operand[0], &type,\r\nNULL);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nreturn_desc = acpi_ut_create_integer_object((u64) type);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase AML_SIZE_OF_OP:\r\nstatus = acpi_ex_resolve_multiple(walk_state,\r\noperand[0], &type,\r\n&temp_desc);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nswitch (type) {\r\ncase ACPI_TYPE_INTEGER:\r\nvalue = acpi_gbl_integer_byte_width;\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nvalue = temp_desc->string.length;\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nstatus = acpi_ds_get_buffer_arguments(temp_desc);\r\nvalue = temp_desc->buffer.length;\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nstatus = acpi_ds_get_package_arguments(temp_desc);\r\nvalue = temp_desc->package.count;\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO,\r\n"Operand must be Buffer/Integer/String/Package - found type %s",\r\nacpi_ut_get_type_name(type)));\r\nstatus = AE_AML_OPERAND_TYPE;\r\ngoto cleanup;\r\n}\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nreturn_desc = acpi_ut_create_integer_object(value);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase AML_REF_OF_OP:\r\nstatus =\r\nacpi_ex_get_object_reference(operand[0], &return_desc,\r\nwalk_state);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase AML_DEREF_OF_OP:\r\nif (ACPI_GET_DESCRIPTOR_TYPE(operand[0]) ==\r\nACPI_DESC_TYPE_NAMED) {\r\ntemp_desc =\r\nacpi_ns_get_attached_object((struct\r\nacpi_namespace_node *)\r\noperand[0]);\r\nif (temp_desc\r\n&& ((temp_desc->common.type == ACPI_TYPE_STRING)\r\n|| (temp_desc->common.type ==\r\nACPI_TYPE_LOCAL_REFERENCE))) {\r\noperand[0] = temp_desc;\r\nacpi_ut_add_reference(temp_desc);\r\n} else {\r\nstatus = AE_AML_OPERAND_TYPE;\r\ngoto cleanup;\r\n}\r\n} else {\r\nswitch ((operand[0])->common.type) {\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nswitch (operand[0]->reference.class) {\r\ncase ACPI_REFCLASS_LOCAL:\r\ncase ACPI_REFCLASS_ARG:\r\nstatus =\r\nacpi_ds_method_data_get_value\r\n(operand[0]->reference.class,\r\noperand[0]->reference.value,\r\nwalk_state, &temp_desc);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nacpi_ut_remove_reference(operand[0]);\r\noperand[0] = temp_desc;\r\nbreak;\r\ncase ACPI_REFCLASS_REFOF:\r\ntemp_desc =\r\noperand[0]->reference.object;\r\nacpi_ut_remove_reference(operand[0]);\r\noperand[0] = temp_desc;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nbreak;\r\ndefault:\r\nstatus = AE_AML_OPERAND_TYPE;\r\ngoto cleanup;\r\n}\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(operand[0]) !=\r\nACPI_DESC_TYPE_NAMED) {\r\nif ((operand[0])->common.type == ACPI_TYPE_STRING) {\r\nstatus =\r\nacpi_ns_get_node(walk_state->scope_info->\r\nscope.node,\r\noperand[0]->string.pointer,\r\nACPI_NS_SEARCH_PARENT,\r\nACPI_CAST_INDIRECT_PTR\r\n(struct\r\nacpi_namespace_node,\r\n&return_desc));\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nstatus =\r\nacpi_ex_resolve_node_to_value\r\n(ACPI_CAST_INDIRECT_PTR\r\n(struct acpi_namespace_node, &return_desc),\r\nwalk_state);\r\ngoto cleanup;\r\n}\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(operand[0]) ==\r\nACPI_DESC_TYPE_NAMED) {\r\nreturn_desc = acpi_ns_get_attached_object((struct\r\nacpi_namespace_node\r\n*)\r\noperand[0]);\r\nacpi_ut_add_reference(return_desc);\r\n} else {\r\nswitch (operand[0]->reference.class) {\r\ncase ACPI_REFCLASS_INDEX:\r\nswitch (operand[0]->reference.target_type) {\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\ntemp_desc =\r\noperand[0]->reference.object;\r\nreturn_desc =\r\nacpi_ut_create_integer_object((u64)\r\ntemp_desc->buffer.pointer[operand[0]->reference.value]);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nreturn_desc =\r\n*(operand[0]->reference.where);\r\nif (!return_desc) {\r\nreturn_ACPI_STATUS\r\n(AE_AML_UNINITIALIZED_ELEMENT);\r\n}\r\nacpi_ut_add_reference(return_desc);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO,\r\n"Unknown Index TargetType 0x%X in reference object %p",\r\noperand[0]->reference.\r\ntarget_type, operand[0]));\r\nstatus = AE_AML_OPERAND_TYPE;\r\ngoto cleanup;\r\n}\r\nbreak;\r\ncase ACPI_REFCLASS_REFOF:\r\nreturn_desc = operand[0]->reference.object;\r\nif (ACPI_GET_DESCRIPTOR_TYPE(return_desc) ==\r\nACPI_DESC_TYPE_NAMED) {\r\nreturn_desc =\r\nacpi_ns_get_attached_object((struct\r\nacpi_namespace_node\r\n*)\r\nreturn_desc);\r\nif (!return_desc) {\r\nbreak;\r\n}\r\nswitch (return_desc->common.type) {\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nstatus =\r\nacpi_ex_read_data_from_field\r\n(walk_state, return_desc,\r\n&temp_desc);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nreturn_desc = temp_desc;\r\nbreak;\r\ndefault:\r\nacpi_ut_add_reference\r\n(return_desc);\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO,\r\n"Unknown class in reference(%p) - 0x%2.2X",\r\noperand[0],\r\noperand[0]->reference.class));\r\nstatus = AE_TYPE;\r\ngoto cleanup;\r\n}\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\ncleanup:\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ut_remove_reference(return_desc);\r\n}\r\nelse {\r\nwalk_state->result_obj = return_desc;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}
