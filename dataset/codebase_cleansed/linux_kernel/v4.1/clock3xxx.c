int omap3_dpll4_set_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate)\r\n{\r\nif (ti_clk_features.flags & TI_CLK_DPLL4_DENY_REPROGRAM) {\r\npr_err("clock: DPLL4 cannot change rate due to silicon 'Limitation 2.5' on 3430ES1.\n");\r\nreturn -EINVAL;\r\n}\r\nreturn omap3_noncore_dpll_set_rate(hw, rate, parent_rate);\r\n}\r\nint omap3_dpll4_set_rate_and_parent(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate, u8 index)\r\n{\r\nif (ti_clk_features.flags & TI_CLK_DPLL4_DENY_REPROGRAM) {\r\npr_err("clock: DPLL4 cannot change rate due to silicon 'Limitation 2.5' on 3430ES1.\n");\r\nreturn -EINVAL;\r\n}\r\nreturn omap3_noncore_dpll_set_rate_and_parent(hw, rate, parent_rate,\r\nindex);\r\n}\r\nvoid __init omap3_clk_lock_dpll5(void)\r\n{\r\nstruct clk *dpll5_clk;\r\nstruct clk *dpll5_m2_clk;\r\ndpll5_clk = clk_get(NULL, "dpll5_ck");\r\nclk_set_rate(dpll5_clk, DPLL5_FREQ_FOR_USBHOST);\r\nclk_prepare_enable(dpll5_clk);\r\ndpll5_m2_clk = clk_get(NULL, "dpll5_m2_ck");\r\nclk_prepare_enable(dpll5_m2_clk);\r\nclk_set_rate(dpll5_m2_clk, DPLL5_FREQ_FOR_USBHOST);\r\nclk_disable_unprepare(dpll5_m2_clk);\r\nclk_disable_unprepare(dpll5_clk);\r\nreturn;\r\n}\r\nstatic int __init omap3xxx_clk_arch_init(void)\r\n{\r\nint ret;\r\nif (!cpu_is_omap34xx())\r\nreturn 0;\r\nret = omap2_clk_switch_mpurate_at_boot("dpll1_ck");\r\nif (!ret)\r\nomap2_clk_print_new_rates("osc_sys_ck", "core_ck", "arm_fck");\r\nreturn ret;\r\n}
