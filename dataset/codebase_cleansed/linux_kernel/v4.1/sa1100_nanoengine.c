static int nanoengine_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nunsigned i = skt->nr;\r\nint ret;\r\nif (i >= num_nano_pcmcia_sockets)\r\nreturn -ENXIO;\r\nret = gpio_request_one(nano_skts[i].gpio_rst, GPIOF_OUT_INIT_LOW,\r\ni ? "PC RST1" : "PC RST0");\r\nif (ret)\r\nreturn ret;\r\nskt->stat[SOC_STAT_CD].gpio = nano_skts[i].gpio_cd;\r\nskt->stat[SOC_STAT_CD].name = i ? "PC CD1" : "PC CD0";\r\nskt->stat[SOC_STAT_RDY].gpio = nano_skts[i].gpio_rdy;\r\nskt->stat[SOC_STAT_RDY].name = i ? "PC RDY1" : "PC RDY0";\r\nreturn 0;\r\n}\r\nstatic void nanoengine_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\r\n{\r\ngpio_free(nano_skts[skt->nr].gpio_rst);\r\n}\r\nstatic int nanoengine_pcmcia_configure_socket(\r\nstruct soc_pcmcia_socket *skt, const socket_state_t *state)\r\n{\r\nunsigned i = skt->nr;\r\nif (i >= num_nano_pcmcia_sockets)\r\nreturn -ENXIO;\r\ngpio_set_value(nano_skts[skt->nr].gpio_rst, !!(state->flags & SS_RESET));\r\nreturn 0;\r\n}\r\nstatic void nanoengine_pcmcia_socket_state(\r\nstruct soc_pcmcia_socket *skt, struct pcmcia_state *state)\r\n{\r\nunsigned i = skt->nr;\r\nif (i >= num_nano_pcmcia_sockets)\r\nreturn;\r\nstate->bvd1 = 1;\r\nstate->bvd2 = 1;\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nint pcmcia_nanoengine_init(struct device *dev)\r\n{\r\nint ret = -ENODEV;\r\nif (machine_is_nanoengine())\r\nret = sa11xx_drv_pcmcia_probe(\r\ndev, &nanoengine_pcmcia_ops, 0, 2);\r\nreturn ret;\r\n}
