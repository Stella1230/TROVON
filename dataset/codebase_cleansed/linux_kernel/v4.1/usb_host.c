int gxio_usb_host_init(gxio_usb_host_context_t *context, int usb_index,\r\nint is_ehci)\r\n{\r\nchar file[32];\r\nint fd;\r\nif (is_ehci)\r\nsnprintf(file, sizeof(file), "usb_host/%d/iorpc/ehci",\r\nusb_index);\r\nelse\r\nsnprintf(file, sizeof(file), "usb_host/%d/iorpc/ohci",\r\nusb_index);\r\nfd = hv_dev_open((HV_VirtAddr) file, 0);\r\nif (fd < 0) {\r\nif (fd >= GXIO_ERR_MIN && fd <= GXIO_ERR_MAX)\r\nreturn fd;\r\nelse\r\nreturn -ENODEV;\r\n}\r\ncontext->fd = fd;\r\ncontext->mmio_base =\r\n(void __force *)iorpc_ioremap(fd, 0, HV_USB_HOST_MMIO_SIZE);\r\nif (context->mmio_base == NULL) {\r\nhv_dev_close(context->fd);\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nint gxio_usb_host_destroy(gxio_usb_host_context_t *context)\r\n{\r\niounmap((void __force __iomem *)(context->mmio_base));\r\nhv_dev_close(context->fd);\r\ncontext->mmio_base = NULL;\r\ncontext->fd = -1;\r\nreturn 0;\r\n}\r\nvoid *gxio_usb_host_get_reg_start(gxio_usb_host_context_t *context)\r\n{\r\nreturn context->mmio_base;\r\n}\r\nsize_t gxio_usb_host_get_reg_len(gxio_usb_host_context_t *context)\r\n{\r\nreturn HV_USB_HOST_MMIO_SIZE;\r\n}
