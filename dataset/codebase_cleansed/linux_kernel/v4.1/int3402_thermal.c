static void int3402_notify(acpi_handle handle, u32 event, void *data)\r\n{\r\nstruct int3402_thermal_data *priv = data;\r\nif (!priv)\r\nreturn;\r\nswitch (event) {\r\ncase INT3402_PERF_CHANGED_EVENT:\r\nbreak;\r\ncase INT3402_THERMAL_EVENT:\r\nint340x_thermal_zone_device_update(priv->int340x_zone);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nstatic int int3402_thermal_probe(struct platform_device *pdev)\r\n{\r\nstruct acpi_device *adev = ACPI_COMPANION(&pdev->dev);\r\nstruct int3402_thermal_data *d;\r\nint ret;\r\nif (!acpi_has_method(adev->handle, "_TMP"))\r\nreturn -ENODEV;\r\nd = devm_kzalloc(&pdev->dev, sizeof(*d), GFP_KERNEL);\r\nif (!d)\r\nreturn -ENOMEM;\r\nd->int340x_zone = int340x_thermal_zone_add(adev, NULL);\r\nif (IS_ERR(d->int340x_zone))\r\nreturn PTR_ERR(d->int340x_zone);\r\nret = acpi_install_notify_handler(adev->handle,\r\nACPI_DEVICE_NOTIFY,\r\nint3402_notify,\r\nd);\r\nif (ret) {\r\nint340x_thermal_zone_remove(d->int340x_zone);\r\nreturn ret;\r\n}\r\nd->handle = adev->handle;\r\nplatform_set_drvdata(pdev, d);\r\nreturn 0;\r\n}\r\nstatic int int3402_thermal_remove(struct platform_device *pdev)\r\n{\r\nstruct int3402_thermal_data *d = platform_get_drvdata(pdev);\r\nacpi_remove_notify_handler(d->handle,\r\nACPI_DEVICE_NOTIFY, int3402_notify);\r\nint340x_thermal_zone_remove(d->int340x_zone);\r\nreturn 0;\r\n}
