static int cinergyt2_streaming_ctrl(struct dvb_usb_adapter *adap, int enable)\r\n{\r\nchar buf[] = { CINERGYT2_EP1_CONTROL_STREAM_TRANSFER, enable ? 1 : 0 };\r\nchar result[64];\r\nreturn dvb_usb_generic_rw(adap->dev, buf, sizeof(buf), result,\r\nsizeof(result), 0);\r\n}\r\nstatic int cinergyt2_power_ctrl(struct dvb_usb_device *d, int enable)\r\n{\r\nchar buf[] = { CINERGYT2_EP1_SLEEP_MODE, enable ? 0 : 1 };\r\nchar state[3];\r\nreturn dvb_usb_generic_rw(d, buf, sizeof(buf), state, sizeof(state), 0);\r\n}\r\nstatic int cinergyt2_frontend_attach(struct dvb_usb_adapter *adap)\r\n{\r\nchar query[] = { CINERGYT2_EP1_GET_FIRMWARE_VERSION };\r\nchar state[3];\r\nint ret;\r\nadap->fe_adap[0].fe = cinergyt2_fe_attach(adap->dev);\r\nret = dvb_usb_generic_rw(adap->dev, query, sizeof(query), state,\r\nsizeof(state), 0);\r\nif (ret < 0) {\r\ndeb_rc("cinergyt2_power_ctrl() Failed to retrieve sleep "\r\n"state info\n");\r\n}\r\ncinergyt2_usb_device = adap->dev;\r\nreturn 0;\r\n}\r\nstatic int cinergyt2_rc_query(struct dvb_usb_device *d, u32 *event, int *state)\r\n{\r\nstruct cinergyt2_state *st = d->priv;\r\nu8 key[5] = {0, 0, 0, 0, 0}, cmd = CINERGYT2_EP1_GET_RC_EVENTS;\r\nint i;\r\n*state = REMOTE_NO_KEY_PRESSED;\r\ndvb_usb_generic_rw(d, &cmd, 1, key, sizeof(key), 0);\r\nif (key[4] == 0xff) {\r\nst->rc_counter++;\r\nif (st->rc_counter > RC_REPEAT_DELAY) {\r\nfor (i = 0; i < ARRAY_SIZE(repeatable_keys); i++) {\r\nif (d->last_event == repeatable_keys[i]) {\r\n*state = REMOTE_KEY_REPEAT;\r\n*event = d->last_event;\r\ndeb_rc("repeat key, event %x\n",\r\n*event);\r\nreturn 0;\r\n}\r\n}\r\ndeb_rc("repeated key (non repeatable)\n");\r\n}\r\nreturn 0;\r\n}\r\nkey[2] = ~key[1];\r\ndvb_usb_nec_rc_key_to_event(d, key, event, state);\r\nif (key[0] != 0) {\r\nif (*event != d->last_event)\r\nst->rc_counter = 0;\r\ndeb_rc("key: %*ph\n", 5, key);\r\n}\r\nreturn 0;\r\n}\r\nstatic int cinergyt2_usb_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nreturn dvb_usb_device_init(intf, &cinergyt2_properties,\r\nTHIS_MODULE, NULL, adapter_nr);\r\n}
