static int init_hw(struct echoaudio *chip, u16 device_id, u16 subdevice_id)\r\n{\r\nint err;\r\nlocal_irq_enable();\r\nif (snd_BUG_ON((subdevice_id & 0xfff0) != ECHO3G))\r\nreturn -ENODEV;\r\nif ((err = init_dsp_comm_page(chip))) {\r\ndev_err(chip->card->dev,\r\n"init_hw - could not initialize DSP comm page\n");\r\nreturn err;\r\n}\r\nchip->comm_page->e3g_frq_register =\r\ncpu_to_le32((E3G_MAGIC_NUMBER / 48000) - 2);\r\nchip->device_id = device_id;\r\nchip->subdevice_id = subdevice_id;\r\nchip->bad_board = TRUE;\r\nchip->has_midi = TRUE;\r\nchip->dsp_code_to_load = FW_ECHO3G_DSP;\r\nerr = load_firmware(chip);\r\nif (err < 0) {\r\nreturn err;\r\n} else if (err == E3G_GINA3G_BOX_TYPE) {\r\nchip->input_clock_types = ECHO_CLOCK_BIT_INTERNAL |\r\nECHO_CLOCK_BIT_SPDIF |\r\nECHO_CLOCK_BIT_ADAT;\r\nchip->card_name = "Gina3G";\r\nchip->px_digital_out = chip->bx_digital_out = 6;\r\nchip->px_analog_in = chip->bx_analog_in = 14;\r\nchip->px_digital_in = chip->bx_digital_in = 16;\r\nchip->px_num = chip->bx_num = 24;\r\nchip->has_phantom_power = TRUE;\r\nchip->hasnt_input_nominal_level = TRUE;\r\n} else if (err == E3G_LAYLA3G_BOX_TYPE) {\r\nchip->input_clock_types = ECHO_CLOCK_BIT_INTERNAL |\r\nECHO_CLOCK_BIT_SPDIF |\r\nECHO_CLOCK_BIT_ADAT |\r\nECHO_CLOCK_BIT_WORD;\r\nchip->card_name = "Layla3G";\r\nchip->px_digital_out = chip->bx_digital_out = 8;\r\nchip->px_analog_in = chip->bx_analog_in = 16;\r\nchip->px_digital_in = chip->bx_digital_in = 24;\r\nchip->px_num = chip->bx_num = 32;\r\n} else {\r\nreturn -ENODEV;\r\n}\r\nchip->digital_modes = ECHOCAPS_HAS_DIGITAL_MODE_SPDIF_RCA |\r\nECHOCAPS_HAS_DIGITAL_MODE_SPDIF_OPTICAL |\r\nECHOCAPS_HAS_DIGITAL_MODE_ADAT;\r\nreturn err;\r\n}\r\nstatic int set_mixer_defaults(struct echoaudio *chip)\r\n{\r\nchip->digital_mode = DIGITAL_MODE_SPDIF_RCA;\r\nchip->professional_spdif = FALSE;\r\nchip->non_audio_spdif = FALSE;\r\nchip->bad_board = FALSE;\r\nchip->phantom_power = FALSE;\r\nreturn init_line_levels(chip);\r\n}\r\nstatic int set_phantom_power(struct echoaudio *chip, char on)\r\n{\r\nu32 control_reg = le32_to_cpu(chip->comm_page->control_register);\r\nif (on)\r\ncontrol_reg |= E3G_PHANTOM_POWER;\r\nelse\r\ncontrol_reg &= ~E3G_PHANTOM_POWER;\r\nchip->phantom_power = on;\r\nreturn write_control_reg(chip, control_reg,\r\nle32_to_cpu(chip->comm_page->e3g_frq_register),\r\n0);\r\n}
