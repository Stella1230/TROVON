void __iomem *pci_iomap_range(struct pci_dev *dev,\r\nint bar,\r\nunsigned long offset,\r\nunsigned long maxlen)\r\n{\r\nresource_size_t start = pci_resource_start(dev, bar);\r\nresource_size_t len = pci_resource_len(dev, bar);\r\nunsigned long flags = pci_resource_flags(dev, bar);\r\nif (len <= offset || !start)\r\nreturn NULL;\r\nlen -= offset;\r\nstart += offset;\r\nif (maxlen && len > maxlen)\r\nlen = maxlen;\r\nif (flags & IORESOURCE_IO)\r\nreturn __pci_ioport_map(dev, start, len);\r\nif (flags & IORESOURCE_MEM) {\r\nif (flags & IORESOURCE_CACHEABLE)\r\nreturn ioremap(start, len);\r\nreturn ioremap_nocache(start, len);\r\n}\r\nreturn NULL;\r\n}\r\nvoid __iomem *pci_iomap(struct pci_dev *dev, int bar, unsigned long maxlen)\r\n{\r\nreturn pci_iomap_range(dev, bar, 0, maxlen);\r\n}
