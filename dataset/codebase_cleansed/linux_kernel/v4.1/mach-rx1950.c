static int power_supply_init(struct device *dev)\r\n{\r\nreturn gpio_request(S3C2410_GPF(2), "cable plugged");\r\n}\r\nstatic int rx1950_is_ac_online(void)\r\n{\r\nreturn !gpio_get_value(S3C2410_GPF(2));\r\n}\r\nstatic void power_supply_exit(struct device *dev)\r\n{\r\ngpio_free(S3C2410_GPF(2));\r\n}\r\nstatic int rx1950_bat_init(void)\r\n{\r\nint ret;\r\nret = gpio_request(S3C2410_GPJ(2), "rx1950-charger-enable-1");\r\nif (ret)\r\ngoto err_gpio1;\r\nret = gpio_request(S3C2410_GPJ(3), "rx1950-charger-enable-2");\r\nif (ret)\r\ngoto err_gpio2;\r\nreturn 0;\r\nerr_gpio2:\r\ngpio_free(S3C2410_GPJ(2));\r\nerr_gpio1:\r\nreturn ret;\r\n}\r\nstatic void rx1950_bat_exit(void)\r\n{\r\ngpio_free(S3C2410_GPJ(2));\r\ngpio_free(S3C2410_GPJ(3));\r\n}\r\nstatic void rx1950_enable_charger(void)\r\n{\r\ngpio_direction_output(S3C2410_GPJ(2), 1);\r\ngpio_direction_output(S3C2410_GPJ(3), 1);\r\n}\r\nstatic void rx1950_disable_charger(void)\r\n{\r\ngpio_direction_output(S3C2410_GPJ(2), 0);\r\ngpio_direction_output(S3C2410_GPJ(3), 0);\r\n}\r\nstatic int rx1950_led_blink_set(struct gpio_desc *desc, int state,\r\nunsigned long *delay_on, unsigned long *delay_off)\r\n{\r\nint gpio = desc_to_gpio(desc);\r\nint blink_gpio, check_gpio;\r\nswitch (gpio) {\r\ncase S3C2410_GPA(6):\r\nblink_gpio = S3C2410_GPA(4);\r\ncheck_gpio = S3C2410_GPA(3);\r\nbreak;\r\ncase S3C2410_GPA(7):\r\nblink_gpio = S3C2410_GPA(3);\r\ncheck_gpio = S3C2410_GPA(4);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\nbreak;\r\n}\r\nif (delay_on && delay_off && !*delay_on && !*delay_off)\r\n*delay_on = *delay_off = 500;\r\nspin_lock(&rx1950_blink_spin);\r\nswitch (state) {\r\ncase GPIO_LED_NO_BLINK_LOW:\r\ncase GPIO_LED_NO_BLINK_HIGH:\r\nif (!gpio_get_value(check_gpio))\r\ngpio_set_value(S3C2410_GPJ(6), 0);\r\ngpio_set_value(blink_gpio, 0);\r\ngpio_set_value(gpio, state);\r\nbreak;\r\ncase GPIO_LED_BLINK:\r\ngpio_set_value(gpio, 0);\r\ngpio_set_value(S3C2410_GPJ(6), 1);\r\ngpio_set_value(blink_gpio, 1);\r\nbreak;\r\n}\r\nspin_unlock(&rx1950_blink_spin);\r\nreturn 0;\r\n}\r\nstatic void rx1950_lcd_power(int enable)\r\n{\r\nint i;\r\nstatic int enabled;\r\nif (enabled == enable)\r\nreturn;\r\nif (!enable) {\r\nfor (i = 11; i < 16; i++)\r\ngpio_direction_output(S3C2410_GPC(i), 1);\r\nmdelay(100);\r\nfor (i = 2; i < 8; i++)\r\ngpio_direction_output(S3C2410_GPD(i), 1);\r\nfor (i = 11; i < 16; i++)\r\ngpio_direction_output(S3C2410_GPD(i), 1);\r\nmdelay(100);\r\ngpio_direction_output(S3C2410_GPB(0), 0);\r\nfor (i = 1; i < 5; i++)\r\ngpio_direction_output(S3C2410_GPC(i), 0);\r\nfor (i = 11; i < 16; i++)\r\ngpio_direction_output(S3C2410_GPC(i), 0);\r\nfor (i = 11; i < 16; i++)\r\ngpio_direction_output(S3C2410_GPD(i), 0);\r\nfor (i = 2; i < 8; i++)\r\ngpio_direction_output(S3C2410_GPD(i), 0);\r\ngpio_direction_output(S3C2410_GPC(6), 0);\r\ngpio_direction_output(S3C2410_GPC(7), 0);\r\ngpio_direction_output(S3C2410_GPC(5), 0);\r\ngpio_direction_output(S3C2410_GPB(1), 0);\r\npwm_config(lcd_pwm, 0, LCD_PWM_PERIOD);\r\npwm_disable(lcd_pwm);\r\ngpio_direction_output(S3C2410_GPC(0), 0);\r\ngpio_direction_output(S3C2410_GPC(10), 0);\r\n} else {\r\npwm_config(lcd_pwm, LCD_PWM_DUTY, LCD_PWM_PERIOD);\r\npwm_enable(lcd_pwm);\r\ngpio_direction_output(S3C2410_GPC(0), 1);\r\ngpio_direction_output(S3C2410_GPC(5), 1);\r\ns3c_gpio_cfgpin(S3C2410_GPB(1), S3C2410_GPB1_TOUT1);\r\ngpio_direction_output(S3C2410_GPC(7), 1);\r\nfor (i = 1; i < 5; i++)\r\ns3c_gpio_cfgpin(S3C2410_GPC(i), S3C_GPIO_SFN(2));\r\nfor (i = 11; i < 16; i++)\r\ns3c_gpio_cfgpin(S3C2410_GPC(i), S3C_GPIO_SFN(2));\r\nfor (i = 2; i < 8; i++)\r\ns3c_gpio_cfgpin(S3C2410_GPD(i), S3C_GPIO_SFN(2));\r\nfor (i = 11; i < 16; i++)\r\ns3c_gpio_cfgpin(S3C2410_GPD(i), S3C_GPIO_SFN(2));\r\ngpio_direction_output(S3C2410_GPC(10), 1);\r\ngpio_direction_output(S3C2410_GPC(6), 1);\r\n}\r\nenabled = enable;\r\n}\r\nstatic void rx1950_bl_power(int enable)\r\n{\r\nstatic int enabled;\r\nif (enabled == enable)\r\nreturn;\r\nif (!enable) {\r\ngpio_direction_output(S3C2410_GPB(0), 0);\r\n} else {\r\ngpio_direction_output(S3C2410_GPB(0), 1);\r\nndelay(48000);\r\ns3c_gpio_cfgpin(S3C2410_GPB(0), S3C2410_GPB0_TOUT0);\r\n}\r\nenabled = enable;\r\n}\r\nstatic int rx1950_backlight_init(struct device *dev)\r\n{\r\nWARN_ON(gpio_request(S3C2410_GPB(0), "Backlight"));\r\nlcd_pwm = pwm_request(1, "RX1950 LCD");\r\nif (IS_ERR(lcd_pwm)) {\r\ndev_err(dev, "Unable to request PWM for LCD power!\n");\r\nreturn PTR_ERR(lcd_pwm);\r\n}\r\nrx1950_lcd_power(1);\r\nrx1950_bl_power(1);\r\nreturn 0;\r\n}\r\nstatic void rx1950_backlight_exit(struct device *dev)\r\n{\r\nrx1950_bl_power(0);\r\nrx1950_lcd_power(0);\r\npwm_free(lcd_pwm);\r\ngpio_free(S3C2410_GPB(0));\r\n}\r\nstatic int rx1950_backlight_notify(struct device *dev, int brightness)\r\n{\r\nif (!brightness) {\r\nrx1950_bl_power(0);\r\nrx1950_lcd_power(0);\r\n} else {\r\nrx1950_lcd_power(1);\r\nrx1950_bl_power(1);\r\n}\r\nreturn brightness;\r\n}\r\nstatic void rx1950_set_mmc_power(unsigned char power_mode, unsigned short vdd)\r\n{\r\nswitch (power_mode) {\r\ncase MMC_POWER_OFF:\r\ngpio_direction_output(S3C2410_GPJ(1), 0);\r\nbreak;\r\ncase MMC_POWER_UP:\r\ncase MMC_POWER_ON:\r\ngpio_direction_output(S3C2410_GPJ(1), 1);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nstatic void __init rx1950_map_io(void)\r\n{\r\ns3c24xx_init_io(rx1950_iodesc, ARRAY_SIZE(rx1950_iodesc));\r\ns3c24xx_init_uarts(rx1950_uartcfgs, ARRAY_SIZE(rx1950_uartcfgs));\r\nsamsung_set_timer_source(SAMSUNG_PWM3, SAMSUNG_PWM4);\r\n#ifdef CONFIG_PM_H1940\r\nmemcpy(phys_to_virt(H1940_SUSPEND_RESUMEAT), h1940_pm_return, 8);\r\n#endif\r\ns3c_pm_init();\r\n}\r\nstatic void __init rx1950_init_time(void)\r\n{\r\ns3c2442_init_clocks(16934000);\r\nsamsung_timer_init();\r\n}\r\nstatic void __init rx1950_init_machine(void)\r\n{\r\nint i;\r\ns3c24xx_fb_set_platdata(&rx1950_lcd_cfg);\r\ns3c24xx_udc_set_platdata(&rx1950_udc_cfg);\r\ns3c24xx_ts_set_platdata(&rx1950_ts_cfg);\r\ns3c24xx_mci_set_platdata(&rx1950_mmc_cfg);\r\ns3c_i2c0_set_platdata(NULL);\r\ns3c_nand_set_platdata(&rx1950_nand_info);\r\ns3c2410_modify_misccr(S3C2410_MISCCR_USBHOST |\r\nS3C2410_MISCCR_USBSUSPND0 |\r\nS3C2410_MISCCR_USBSUSPND1, 0x0);\r\nWARN_ON(gpio_request(S3C2410_GPJ(1), "MMC power"));\r\ngpio_direction_output(S3C2410_GPJ(1), 0);\r\nfor (i = 0; i < 8; i++)\r\nWARN_ON(gpio_request(S3C2410_GPC(i), "LCD power"));\r\nfor (i = 10; i < 16; i++)\r\nWARN_ON(gpio_request(S3C2410_GPC(i), "LCD power"));\r\nfor (i = 2; i < 8; i++)\r\nWARN_ON(gpio_request(S3C2410_GPD(i), "LCD power"));\r\nfor (i = 11; i < 16; i++)\r\nWARN_ON(gpio_request(S3C2410_GPD(i), "LCD power"));\r\nWARN_ON(gpio_request(S3C2410_GPB(1), "LCD power"));\r\nWARN_ON(gpio_request(S3C2410_GPA(3), "Red blink"));\r\nWARN_ON(gpio_request(S3C2410_GPA(4), "Green blink"));\r\nWARN_ON(gpio_request(S3C2410_GPJ(6), "LED blink"));\r\ngpio_direction_output(S3C2410_GPA(3), 0);\r\ngpio_direction_output(S3C2410_GPA(4), 0);\r\ngpio_direction_output(S3C2410_GPJ(6), 0);\r\nplatform_add_devices(rx1950_devices, ARRAY_SIZE(rx1950_devices));\r\ni2c_register_board_info(0, rx1950_i2c_devices,\r\nARRAY_SIZE(rx1950_i2c_devices));\r\n}\r\nstatic void __init rx1950_reserve(void)\r\n{\r\nmemblock_reserve(0x30003000, 0x1000);\r\nmemblock_reserve(0x30081000, 0x1000);\r\n}
