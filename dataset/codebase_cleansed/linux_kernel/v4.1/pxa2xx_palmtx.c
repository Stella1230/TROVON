static int palmtx_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nint ret;\r\nret = gpio_request_array(palmtx_pcmcia_gpios,\r\nARRAY_SIZE(palmtx_pcmcia_gpios));\r\nskt->stat[SOC_STAT_RDY].gpio = GPIO_NR_PALMTX_PCMCIA_READY;\r\nskt->stat[SOC_STAT_RDY].name = "PCMCIA Ready";\r\nreturn ret;\r\n}\r\nstatic void palmtx_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\r\n{\r\ngpio_free_array(palmtx_pcmcia_gpios, ARRAY_SIZE(palmtx_pcmcia_gpios));\r\n}\r\nstatic void palmtx_pcmcia_socket_state(struct soc_pcmcia_socket *skt,\r\nstruct pcmcia_state *state)\r\n{\r\nstate->detect = 1;\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nstatic int\r\npalmtx_pcmcia_configure_socket(struct soc_pcmcia_socket *skt,\r\nconst socket_state_t *state)\r\n{\r\ngpio_set_value(GPIO_NR_PALMTX_PCMCIA_POWER1, 1);\r\ngpio_set_value(GPIO_NR_PALMTX_PCMCIA_POWER2, 1);\r\ngpio_set_value(GPIO_NR_PALMTX_PCMCIA_RESET,\r\n!!(state->flags & SS_RESET));\r\nreturn 0;\r\n}\r\nstatic int __init palmtx_pcmcia_init(void)\r\n{\r\nint ret;\r\nif (!machine_is_palmtx())\r\nreturn -ENODEV;\r\npalmtx_pcmcia_device = platform_device_alloc("pxa2xx-pcmcia", -1);\r\nif (!palmtx_pcmcia_device)\r\nreturn -ENOMEM;\r\nret = platform_device_add_data(palmtx_pcmcia_device, &palmtx_pcmcia_ops,\r\nsizeof(palmtx_pcmcia_ops));\r\nif (!ret)\r\nret = platform_device_add(palmtx_pcmcia_device);\r\nif (ret)\r\nplatform_device_put(palmtx_pcmcia_device);\r\nreturn ret;\r\n}\r\nstatic void __exit palmtx_pcmcia_exit(void)\r\n{\r\nplatform_device_unregister(palmtx_pcmcia_device);\r\n}
