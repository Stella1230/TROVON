int ieee754dp_tint(union ieee754dp x)\r\n{\r\nu64 residue;\r\nint round;\r\nint sticky;\r\nint odd;\r\nCOMPXDP;\r\nieee754_clearcx();\r\nEXPLODEXDP;\r\nFLUSHXDP;\r\nswitch (xc) {\r\ncase IEEE754_CLASS_SNAN:\r\ncase IEEE754_CLASS_QNAN:\r\ncase IEEE754_CLASS_INF:\r\nieee754_setcx(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_indef();\r\ncase IEEE754_CLASS_ZERO:\r\nreturn 0;\r\ncase IEEE754_CLASS_DNORM:\r\ncase IEEE754_CLASS_NORM:\r\nbreak;\r\n}\r\nif (xe > 31) {\r\nieee754_setcx(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_indef();\r\n}\r\nif (xe > DP_FBITS) {\r\nxm <<= xe - DP_FBITS;\r\n} else if (xe < DP_FBITS) {\r\nif (xe < -1) {\r\nresidue = xm;\r\nround = 0;\r\nsticky = residue != 0;\r\nxm = 0;\r\n} else {\r\nresidue = xm << (64 - DP_FBITS + xe);\r\nround = (residue >> 63) != 0;\r\nsticky = (residue << 1) != 0;\r\nxm >>= DP_FBITS - xe;\r\n}\r\nodd = (xm & 0x1) != 0x0;\r\nswitch (ieee754_csr.rm) {\r\ncase FPU_CSR_RN:\r\nif (round && (sticky || odd))\r\nxm++;\r\nbreak;\r\ncase FPU_CSR_RZ:\r\nbreak;\r\ncase FPU_CSR_RU:\r\nif ((round || sticky) && !xs)\r\nxm++;\r\nbreak;\r\ncase FPU_CSR_RD:\r\nif ((round || sticky) && xs)\r\nxm++;\r\nbreak;\r\n}\r\nif ((xm >> 31) != 0 && (xs == 0 || xm != 0x80000000)) {\r\nieee754_setcx(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_indef();\r\n}\r\nif (round || sticky)\r\nieee754_setcx(IEEE754_INEXACT);\r\n}\r\nif (xs)\r\nreturn -xm;\r\nelse\r\nreturn xm;\r\n}
