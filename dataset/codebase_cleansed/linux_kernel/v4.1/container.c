static int acpi_container_offline(struct container_dev *cdev)\r\n{\r\nstruct acpi_device *adev = ACPI_COMPANION(&cdev->dev);\r\nstruct acpi_device *child;\r\nlist_for_each_entry(child, &adev->children, node)\r\nif (!acpi_scan_is_offline(child, false))\r\nreturn -EBUSY;\r\nreturn 0;\r\n}\r\nstatic void acpi_container_release(struct device *dev)\r\n{\r\nkfree(to_container_dev(dev));\r\n}\r\nstatic int container_device_attach(struct acpi_device *adev,\r\nconst struct acpi_device_id *not_used)\r\n{\r\nstruct container_dev *cdev;\r\nstruct device *dev;\r\nint ret;\r\nif (adev->flags.is_dock_station)\r\nreturn 0;\r\ncdev = kzalloc(sizeof(*cdev), GFP_KERNEL);\r\nif (!cdev)\r\nreturn -ENOMEM;\r\ncdev->offline = acpi_container_offline;\r\ndev = &cdev->dev;\r\ndev->bus = &container_subsys;\r\ndev_set_name(dev, "%s", dev_name(&adev->dev));\r\nACPI_COMPANION_SET(dev, adev);\r\ndev->release = acpi_container_release;\r\nret = device_register(dev);\r\nif (ret) {\r\nput_device(dev);\r\nreturn ret;\r\n}\r\nadev->driver_data = dev;\r\nreturn 1;\r\n}\r\nstatic void container_device_detach(struct acpi_device *adev)\r\n{\r\nstruct device *dev = acpi_driver_data(adev);\r\nadev->driver_data = NULL;\r\nif (dev)\r\ndevice_unregister(dev);\r\n}\r\nstatic void container_device_online(struct acpi_device *adev)\r\n{\r\nstruct device *dev = acpi_driver_data(adev);\r\nkobject_uevent(&dev->kobj, KOBJ_ONLINE);\r\n}\r\nvoid __init acpi_container_init(void)\r\n{\r\nacpi_scan_add_handler(&container_handler);\r\n}\r\nvoid __init acpi_container_init(void)\r\n{\r\nacpi_scan_add_handler_with_hotplug(&container_handler, "container");\r\n}
