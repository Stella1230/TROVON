void samsung_wdt_reset(void)\r\n{\r\nif (!wdt_base) {\r\npr_err("%s: wdt reset not initialized\n", __func__);\r\nmdelay(50);\r\nreturn;\r\n}\r\nif (!IS_ERR(wdt_clock))\r\nclk_prepare_enable(wdt_clock);\r\n__raw_writel(0, wdt_base + S3C2410_WTCON);\r\n__raw_writel(0x80, wdt_base + S3C2410_WTCNT);\r\n__raw_writel(0x80, wdt_base + S3C2410_WTDAT);\r\n__raw_writel(S3C2410_WTCON_ENABLE | S3C2410_WTCON_DIV16 |\r\nS3C2410_WTCON_RSTEN | S3C2410_WTCON_PRESCALE(0x20),\r\nwdt_base + S3C2410_WTCON);\r\nmdelay(500);\r\npr_err("Watchdog reset failed to assert reset\n");\r\nmdelay(50);\r\n}\r\nvoid __init samsung_wdt_reset_of_init(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_matching_node(NULL, s3c2410_wdt_match);\r\nif (!np) {\r\npr_err("%s: failed to find watchdog node\n", __func__);\r\nreturn;\r\n}\r\nwdt_base = of_iomap(np, 0);\r\nif (!wdt_base) {\r\npr_err("%s: failed to map watchdog registers\n", __func__);\r\nreturn;\r\n}\r\nwdt_clock = of_clk_get(np, 0);\r\n}\r\nvoid __init samsung_wdt_reset_init(void __iomem *base)\r\n{\r\nwdt_base = base;\r\nwdt_clock = clk_get(NULL, "watchdog");\r\n}
