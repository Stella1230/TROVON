void intc_balancing_enable(unsigned int irq)\r\n{\r\nstruct intc_desc_int *d = get_intc_desc(irq);\r\nunsigned long handle = dist_handle[irq];\r\nunsigned long addr;\r\nif (irq_balancing_disabled(irq) || !handle)\r\nreturn;\r\naddr = INTC_REG(d, _INTC_ADDR_D(handle), 0);\r\nintc_reg_fns[_INTC_FN(handle)](addr, handle, 1);\r\n}\r\nvoid intc_balancing_disable(unsigned int irq)\r\n{\r\nstruct intc_desc_int *d = get_intc_desc(irq);\r\nunsigned long handle = dist_handle[irq];\r\nunsigned long addr;\r\nif (irq_balancing_disabled(irq) || !handle)\r\nreturn;\r\naddr = INTC_REG(d, _INTC_ADDR_D(handle), 0);\r\nintc_reg_fns[_INTC_FN(handle)](addr, handle, 0);\r\n}\r\nstatic unsigned int intc_dist_data(struct intc_desc *desc,\r\nstruct intc_desc_int *d,\r\nintc_enum enum_id)\r\n{\r\nstruct intc_mask_reg *mr = desc->hw.mask_regs;\r\nunsigned int i, j, fn, mode;\r\nunsigned long reg_e, reg_d;\r\nfor (i = 0; mr && enum_id && i < desc->hw.nr_mask_regs; i++) {\r\nmr = desc->hw.mask_regs + i;\r\nif (!mr->dist_reg)\r\ncontinue;\r\nfor (j = 0; j < ARRAY_SIZE(mr->enum_ids); j++) {\r\nif (mr->enum_ids[j] != enum_id)\r\ncontinue;\r\nfn = REG_FN_MODIFY_BASE;\r\nmode = MODE_ENABLE_REG;\r\nreg_e = mr->dist_reg;\r\nreg_d = mr->dist_reg;\r\nfn += (mr->reg_width >> 3) - 1;\r\nreturn _INTC_MK(fn, mode,\r\nintc_get_reg(d, reg_e),\r\nintc_get_reg(d, reg_d),\r\n1,\r\n(mr->reg_width - 1) - j);\r\n}\r\n}\r\nreturn 0;\r\n}\r\nvoid intc_set_dist_handle(unsigned int irq, struct intc_desc *desc,\r\nstruct intc_desc_int *d, intc_enum id)\r\n{\r\nunsigned long flags;\r\nif (!desc->hw.mask_regs)\r\nreturn;\r\nraw_spin_lock_irqsave(&intc_big_lock, flags);\r\ndist_handle[irq] = intc_dist_data(desc, d, id);\r\nraw_spin_unlock_irqrestore(&intc_big_lock, flags);\r\n}
