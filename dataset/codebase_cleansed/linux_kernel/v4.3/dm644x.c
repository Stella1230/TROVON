static int dm644x_venc_setup_clock(enum vpbe_enc_timings_type type,\r\nunsigned int pclock)\r\n{\r\nint ret = 0;\r\nu32 v = DM644X_VPSS_VENCLKEN;\r\nswitch (type) {\r\ncase VPBE_ENC_STD:\r\nv |= DM644X_VPSS_DACCLKEN;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\nbreak;\r\ncase VPBE_ENC_DV_TIMINGS:\r\nif (pclock <= 27000000) {\r\nv |= DM644X_VPSS_DACCLKEN;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\n} else {\r\nv |= DM644X_VPSS_MUXSEL_VPBECLK_MODE;\r\nwritel(v, DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL));\r\n}\r\nbreak;\r\ndefault:\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nint __init dm644x_gpio_register(void)\r\n{\r\nreturn davinci_gpio_register(dm644_gpio_resources,\r\nARRAY_SIZE(dm644_gpio_resources),\r\n&dm644_gpio_platform_data);\r\n}\r\nvoid __init dm644x_init_asp(struct snd_platform_data *pdata)\r\n{\r\ndavinci_cfg_reg(DM644X_MCBSP);\r\ndm644x_asp_device.dev.platform_data = pdata;\r\nplatform_device_register(&dm644x_asp_device);\r\n}\r\nvoid __init dm644x_init(void)\r\n{\r\ndavinci_common_init(&davinci_soc_info_dm644x);\r\ndavinci_map_sysmod();\r\n}\r\nint __init dm644x_init_video(struct vpfe_config *vpfe_cfg,\r\nstruct vpbe_config *vpbe_cfg)\r\n{\r\nif (vpfe_cfg || vpbe_cfg)\r\nplatform_device_register(&dm644x_vpss_device);\r\nif (vpfe_cfg) {\r\ndm644x_vpfe_dev.dev.platform_data = vpfe_cfg;\r\nplatform_device_register(&dm644x_ccdc_dev);\r\nplatform_device_register(&dm644x_vpfe_dev);\r\n}\r\nif (vpbe_cfg) {\r\ndm644x_vpbe_dev.dev.platform_data = vpbe_cfg;\r\nplatform_device_register(&dm644x_osd_dev);\r\nplatform_device_register(&dm644x_venc_dev);\r\nplatform_device_register(&dm644x_vpbe_dev);\r\nplatform_device_register(&dm644x_vpbe_display);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init dm644x_init_devices(void)\r\n{\r\nint ret = 0;\r\nif (!cpu_is_davinci_dm644x())\r\nreturn 0;\r\nplatform_device_register(&dm644x_edma_device);\r\nplatform_device_register(&dm644x_mdio_device);\r\nplatform_device_register(&dm644x_emac_device);\r\nret = davinci_init_wdt();\r\nif (ret)\r\npr_warn("%s: watchdog init failed: %d\n", __func__, ret);\r\nreturn ret;\r\n}
