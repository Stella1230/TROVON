static int sha512_neon_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int len)\r\n{\r\nstruct sha512_state *sctx = shash_desc_ctx(desc);\r\nif (!may_use_simd() ||\r\n(sctx->count[0] % SHA512_BLOCK_SIZE) + len < SHA512_BLOCK_SIZE)\r\nreturn sha512_arm_update(desc, data, len);\r\nkernel_neon_begin();\r\nsha512_base_do_update(desc, data, len,\r\n(sha512_block_fn *)sha512_block_data_order_neon);\r\nkernel_neon_end();\r\nreturn 0;\r\n}\r\nstatic int sha512_neon_finup(struct shash_desc *desc, const u8 *data,\r\nunsigned int len, u8 *out)\r\n{\r\nif (!may_use_simd())\r\nreturn sha512_arm_finup(desc, data, len, out);\r\nkernel_neon_begin();\r\nif (len)\r\nsha512_base_do_update(desc, data, len,\r\n(sha512_block_fn *)sha512_block_data_order_neon);\r\nsha512_base_do_finalize(desc,\r\n(sha512_block_fn *)sha512_block_data_order_neon);\r\nkernel_neon_end();\r\nreturn sha512_base_finish(desc, out);\r\n}\r\nstatic int sha512_neon_final(struct shash_desc *desc, u8 *out)\r\n{\r\nreturn sha512_neon_finup(desc, NULL, 0, out);\r\n}
