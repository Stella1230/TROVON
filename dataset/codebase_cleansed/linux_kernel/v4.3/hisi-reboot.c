static int hisi_restart_handler(struct notifier_block *this,\r\nunsigned long mode, void *cmd)\r\n{\r\nwritel_relaxed(0xdeadbeef, base + reboot_offset);\r\nwhile (1)\r\ncpu_do_idle();\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int hisi_reboot_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nint err;\r\nbase = of_iomap(np, 0);\r\nif (!base) {\r\nWARN(1, "failed to map base address");\r\nreturn -ENODEV;\r\n}\r\nif (of_property_read_u32(np, "reboot-offset", &reboot_offset) < 0) {\r\npr_err("failed to find reboot-offset property\n");\r\nreturn -EINVAL;\r\n}\r\nerr = register_restart_handler(&hisi_restart_nb);\r\nif (err)\r\ndev_err(&pdev->dev, "cannot register restart handler (err=%d)\n",\r\nerr);\r\nreturn err;\r\n}
