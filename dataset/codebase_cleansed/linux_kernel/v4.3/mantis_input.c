void mantis_input_process(struct mantis_pci *mantis, int scancode)\r\n{\r\nif (mantis->rc)\r\nrc_keydown(mantis->rc, RC_TYPE_UNKNOWN, scancode, 0);\r\n}\r\nint mantis_input_init(struct mantis_pci *mantis)\r\n{\r\nstruct rc_dev *dev;\r\nint err;\r\ndev = rc_allocate_device();\r\nif (!dev) {\r\ndprintk(MANTIS_ERROR, 1, "Remote device allocation failed");\r\nerr = -ENOMEM;\r\ngoto out;\r\n}\r\nsnprintf(mantis->input_name, sizeof(mantis->input_name),\r\n"Mantis %s IR receiver", mantis->hwconfig->model_name);\r\nsnprintf(mantis->input_phys, sizeof(mantis->input_phys),\r\n"pci-%s/ir0", pci_name(mantis->pdev));\r\ndev->input_name = mantis->input_name;\r\ndev->input_phys = mantis->input_phys;\r\ndev->input_id.bustype = BUS_PCI;\r\ndev->input_id.vendor = mantis->vendor_id;\r\ndev->input_id.product = mantis->device_id;\r\ndev->input_id.version = 1;\r\ndev->driver_name = MODULE_NAME;\r\ndev->map_name = mantis->rc_map_name ? : RC_MAP_EMPTY;\r\ndev->dev.parent = &mantis->pdev->dev;\r\nerr = rc_register_device(dev);\r\nif (err) {\r\ndprintk(MANTIS_ERROR, 1, "IR device registration failed, ret = %d", err);\r\ngoto out_dev;\r\n}\r\nmantis->rc = dev;\r\nreturn 0;\r\nout_dev:\r\nrc_free_device(dev);\r\nout:\r\nreturn err;\r\n}\r\nvoid mantis_input_exit(struct mantis_pci *mantis)\r\n{\r\nrc_unregister_device(mantis->rc);\r\n}
