acpi_status\r\nacpi_ex_store_buffer_to_buffer(union acpi_operand_object *source_desc,\r\nunion acpi_operand_object *target_desc)\r\n{\r\nu32 length;\r\nu8 *buffer;\r\nACPI_FUNCTION_TRACE_PTR(ex_store_buffer_to_buffer, source_desc);\r\nif (source_desc == target_desc) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nbuffer = ACPI_CAST_PTR(u8, source_desc->buffer.pointer);\r\nlength = source_desc->buffer.length;\r\nif ((target_desc->buffer.length == 0) ||\r\n(target_desc->common.flags & AOPOBJ_STATIC_POINTER)) {\r\ntarget_desc->buffer.pointer = ACPI_ALLOCATE(length);\r\nif (!target_desc->buffer.pointer) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\ntarget_desc->buffer.length = length;\r\n}\r\nif (length <= target_desc->buffer.length) {\r\nmemset(target_desc->buffer.pointer, 0,\r\ntarget_desc->buffer.length);\r\nmemcpy(target_desc->buffer.pointer, buffer, length);\r\n#ifdef ACPI_OBSOLETE_BEHAVIOR\r\nif (original_src_type == ACPI_TYPE_STRING) {\r\ntarget_desc->buffer.length = length;\r\n}\r\n#endif\r\n} else {\r\nmemcpy(target_desc->buffer.pointer, buffer,\r\ntarget_desc->buffer.length);\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO,\r\n"Truncating source buffer from %X to %X\n",\r\nlength, target_desc->buffer.length));\r\n}\r\ntarget_desc->buffer.flags = source_desc->buffer.flags;\r\ntarget_desc->common.flags &= ~AOPOBJ_STATIC_POINTER;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status\r\nacpi_ex_store_string_to_string(union acpi_operand_object *source_desc,\r\nunion acpi_operand_object *target_desc)\r\n{\r\nu32 length;\r\nu8 *buffer;\r\nACPI_FUNCTION_TRACE_PTR(ex_store_string_to_string, source_desc);\r\nif (source_desc == target_desc) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nbuffer = ACPI_CAST_PTR(u8, source_desc->string.pointer);\r\nlength = source_desc->string.length;\r\nif ((length < target_desc->string.length) &&\r\n(!(target_desc->common.flags & AOPOBJ_STATIC_POINTER))) {\r\nmemset(target_desc->string.pointer, 0,\r\n(acpi_size) target_desc->string.length + 1);\r\nmemcpy(target_desc->string.pointer, buffer, length);\r\n} else {\r\nif (target_desc->string.pointer &&\r\n(!(target_desc->common.flags & AOPOBJ_STATIC_POINTER))) {\r\nACPI_FREE(target_desc->string.pointer);\r\n}\r\ntarget_desc->string.pointer = ACPI_ALLOCATE_ZEROED((acpi_size)\r\nlength + 1);\r\nif (!target_desc->string.pointer) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\ntarget_desc->common.flags &= ~AOPOBJ_STATIC_POINTER;\r\nmemcpy(target_desc->string.pointer, buffer, length);\r\n}\r\ntarget_desc->string.length = length;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}
