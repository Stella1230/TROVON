void user_return_notifier_register(struct user_return_notifier *urn)\r\n{\r\nset_tsk_thread_flag(current, TIF_USER_RETURN_NOTIFY);\r\nhlist_add_head(&urn->link, this_cpu_ptr(&return_notifier_list));\r\n}\r\nvoid user_return_notifier_unregister(struct user_return_notifier *urn)\r\n{\r\nhlist_del(&urn->link);\r\nif (hlist_empty(this_cpu_ptr(&return_notifier_list)))\r\nclear_tsk_thread_flag(current, TIF_USER_RETURN_NOTIFY);\r\n}\r\nvoid fire_user_return_notifiers(void)\r\n{\r\nstruct user_return_notifier *urn;\r\nstruct hlist_node *tmp2;\r\nstruct hlist_head *head;\r\nhead = &get_cpu_var(return_notifier_list);\r\nhlist_for_each_entry_safe(urn, tmp2, head, link)\r\nurn->on_user_return(urn);\r\nput_cpu_var(return_notifier_list);\r\n}
