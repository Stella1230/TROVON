int nvidia_probe_of_connector(struct fb_info *info, int conn, u8 **out_edid)\r\n{\r\nstruct nvidia_par *par = info->par;\r\nstruct device_node *parent, *dp;\r\nconst unsigned char *pedid = NULL;\r\nstatic char *propnames[] = {\r\n"DFP,EDID", "LCD,EDID", "EDID", "EDID1",\r\n"EDID,B", "EDID,A", NULL };\r\nint i;\r\nparent = pci_device_to_OF_node(par->pci_dev);\r\nif (parent == NULL)\r\nreturn -1;\r\nif (par->twoHeads) {\r\nconst char *pname;\r\nint len;\r\nfor (dp = NULL;\r\n(dp = of_get_next_child(parent, dp)) != NULL;) {\r\npname = of_get_property(dp, "name", NULL);\r\nif (!pname)\r\ncontinue;\r\nlen = strlen(pname);\r\nif ((pname[len-1] == 'A' && conn == 1) ||\r\n(pname[len-1] == 'B' && conn == 2)) {\r\nfor (i = 0; propnames[i] != NULL; ++i) {\r\npedid = of_get_property(dp,\r\npropnames[i], NULL);\r\nif (pedid != NULL)\r\nbreak;\r\n}\r\nof_node_put(dp);\r\nbreak;\r\n}\r\n}\r\n}\r\nif (pedid == NULL) {\r\nfor (i = 0; propnames[i] != NULL; ++i) {\r\npedid = of_get_property(parent, propnames[i], NULL);\r\nif (pedid != NULL)\r\nbreak;\r\n}\r\n}\r\nif (pedid) {\r\n*out_edid = kmemdup(pedid, EDID_LENGTH, GFP_KERNEL);\r\nif (*out_edid == NULL)\r\nreturn -1;\r\nprintk(KERN_DEBUG "nvidiafb: Found OF EDID for head %d\n", conn);\r\nreturn 0;\r\n}\r\nreturn -1;\r\n}
