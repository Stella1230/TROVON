void saa7164_card_list(struct saa7164_dev *dev)\r\n{\r\nint i;\r\nif (0 == dev->pci->subsystem_vendor &&\r\n0 == dev->pci->subsystem_device) {\r\nprintk(KERN_ERR\r\n"%s: Board has no valid PCIe Subsystem ID and can't\n"\r\n"%s: be autodetected. Pass card=<n> insmod option to\n"\r\n"%s: workaround that. Send complaints to the vendor\n"\r\n"%s: of the TV card. Best regards,\n"\r\n"%s: -- tux\n",\r\ndev->name, dev->name, dev->name, dev->name, dev->name);\r\n} else {\r\nprintk(KERN_ERR\r\n"%s: Your board isn't known (yet) to the driver.\n"\r\n"%s: Try to pick one of the existing card configs via\n"\r\n"%s: card=<n> insmod option. Updating to the latest\n"\r\n"%s: version might help as well.\n",\r\ndev->name, dev->name, dev->name, dev->name);\r\n}\r\nprintk(KERN_ERR "%s: Here are valid choices for the card=<n> insmod "\r\n"option:\n", dev->name);\r\nfor (i = 0; i < saa7164_bcount; i++)\r\nprintk(KERN_ERR "%s: card=%d -> %s\n",\r\ndev->name, i, saa7164_boards[i].name);\r\n}\r\nvoid saa7164_gpio_setup(struct saa7164_dev *dev)\r\n{\r\nswitch (dev->board) {\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_2:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_3:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_4:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_5:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250_2:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250_3:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2255proto:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2255:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2205:\r\nsaa7164_api_clear_gpiobit(dev, PCIEBRIDGE_UNITID, 2);\r\nsaa7164_api_clear_gpiobit(dev, PCIEBRIDGE_UNITID, 3);\r\nmsleep(20);\r\nsaa7164_api_set_gpiobit(dev, PCIEBRIDGE_UNITID, 2);\r\nsaa7164_api_set_gpiobit(dev, PCIEBRIDGE_UNITID, 3);\r\nbreak;\r\n}\r\n}\r\nstatic void hauppauge_eeprom(struct saa7164_dev *dev, u8 *eeprom_data)\r\n{\r\nstruct tveeprom tv;\r\ntveeprom_hauppauge_analog(&dev->i2c_bus[0].i2c_client, &tv,\r\neeprom_data);\r\nswitch (tv.model) {\r\ncase 88001:\r\ncase 88021:\r\nbreak;\r\ncase 88041:\r\nbreak;\r\ncase 88061:\r\nbreak;\r\ncase 89519:\r\ncase 89609:\r\nbreak;\r\ncase 89619:\r\nbreak;\r\ncase 151009:\r\nbreak;\r\ncase 151609:\r\nbreak;\r\ncase 151061:\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "%s: Warning: Unknown Hauppauge model #%d\n",\r\ndev->name, tv.model);\r\nbreak;\r\n}\r\nprintk(KERN_INFO "%s: Hauppauge eeprom: model=%d\n", dev->name,\r\ntv.model);\r\n}\r\nvoid saa7164_card_setup(struct saa7164_dev *dev)\r\n{\r\nstatic u8 eeprom[256];\r\nif (dev->i2c_bus[0].i2c_rc == 0) {\r\nif (saa7164_api_read_eeprom(dev, &eeprom[0],\r\nsizeof(eeprom)) < 0)\r\nreturn;\r\n}\r\nswitch (dev->board) {\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_2:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_3:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_4:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2200_5:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250_2:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2250_3:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2255proto:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2255:\r\ncase SAA7164_BOARD_HAUPPAUGE_HVR2205:\r\nhauppauge_eeprom(dev, &eeprom[0]);\r\nbreak;\r\n}\r\n}\r\nint saa7164_i2caddr_to_unitid(struct saa7164_i2c *bus, int addr)\r\n{\r\nstruct saa7164_dev *dev = bus->dev;\r\nstruct saa7164_unit *unit;\r\nint i;\r\nfor (i = 0; i < SAA7164_MAX_UNITS; i++) {\r\nunit = &saa7164_boards[dev->board].unit[i];\r\nif (unit->type == SAA7164_UNIT_UNDEFINED)\r\ncontinue;\r\nif ((bus->nr == unit->i2c_bus_nr) &&\r\n(addr == unit->i2c_bus_addr))\r\nreturn unit->id;\r\n}\r\nreturn -1;\r\n}\r\nint saa7164_i2caddr_to_reglen(struct saa7164_i2c *bus, int addr)\r\n{\r\nstruct saa7164_dev *dev = bus->dev;\r\nstruct saa7164_unit *unit;\r\nint i;\r\nfor (i = 0; i < SAA7164_MAX_UNITS; i++) {\r\nunit = &saa7164_boards[dev->board].unit[i];\r\nif (unit->type == SAA7164_UNIT_UNDEFINED)\r\ncontinue;\r\nif ((bus->nr == unit->i2c_bus_nr) &&\r\n(addr == unit->i2c_bus_addr))\r\nreturn unit->i2c_reg_len;\r\n}\r\nreturn -1;\r\n}\r\nchar *saa7164_unitid_name(struct saa7164_dev *dev, u8 unitid)\r\n{\r\nchar *undefed = "UNDEFINED";\r\nchar *bridge = "BRIDGE";\r\nstruct saa7164_unit *unit;\r\nint i;\r\nif (unitid == 0)\r\nreturn bridge;\r\nfor (i = 0; i < SAA7164_MAX_UNITS; i++) {\r\nunit = &saa7164_boards[dev->board].unit[i];\r\nif (unit->type == SAA7164_UNIT_UNDEFINED)\r\ncontinue;\r\nif (unitid == unit->id)\r\nreturn unit->name;\r\n}\r\nreturn undefed;\r\n}
