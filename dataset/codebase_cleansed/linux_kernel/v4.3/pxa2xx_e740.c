static int e740_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nif (skt->nr == 0) {\r\nskt->stat[SOC_STAT_CD].gpio = GPIO_E740_PCMCIA_CD0;\r\nskt->stat[SOC_STAT_CD].name = "CF card detect";\r\nskt->stat[SOC_STAT_RDY].gpio = GPIO_E740_PCMCIA_RDY0;\r\nskt->stat[SOC_STAT_RDY].name = "CF ready";\r\n} else {\r\nskt->stat[SOC_STAT_CD].gpio = GPIO_E740_PCMCIA_CD1;\r\nskt->stat[SOC_STAT_CD].name = "Wifi switch";\r\nskt->stat[SOC_STAT_RDY].gpio = GPIO_E740_PCMCIA_RDY1;\r\nskt->stat[SOC_STAT_RDY].name = "Wifi ready";\r\n}\r\nreturn 0;\r\n}\r\nstatic void e740_pcmcia_socket_state(struct soc_pcmcia_socket *skt,\r\nstruct pcmcia_state *state)\r\n{\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nstatic int e740_pcmcia_configure_socket(struct soc_pcmcia_socket *skt,\r\nconst socket_state_t *state)\r\n{\r\nif (state->flags & SS_RESET) {\r\nif (skt->nr == 0)\r\ngpio_set_value(GPIO_E740_PCMCIA_RST0, 1);\r\nelse\r\ngpio_set_value(GPIO_E740_PCMCIA_RST1, 1);\r\n} else {\r\nif (skt->nr == 0)\r\ngpio_set_value(GPIO_E740_PCMCIA_RST0, 0);\r\nelse\r\ngpio_set_value(GPIO_E740_PCMCIA_RST1, 0);\r\n}\r\nswitch (state->Vcc) {\r\ncase 0:\r\nif (skt->nr == 0)\r\ngpio_set_value(GPIO_E740_PCMCIA_PWR0, 0);\r\nelse\r\ngpio_set_value(GPIO_E740_PCMCIA_PWR1, 1);\r\nbreak;\r\ncase 50:\r\ncase 33:\r\nif (skt->nr == 0)\r\ngpio_set_value(GPIO_E740_PCMCIA_PWR0, 1);\r\nelse\r\ngpio_set_value(GPIO_E740_PCMCIA_PWR1, 0);\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "e740_cs: Unsupported Vcc: %d\n", state->Vcc);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init e740_pcmcia_init(void)\r\n{\r\nint ret;\r\nif (!machine_is_e740())\r\nreturn -ENODEV;\r\ne740_pcmcia_device = platform_device_alloc("pxa2xx-pcmcia", -1);\r\nif (!e740_pcmcia_device)\r\nreturn -ENOMEM;\r\nret = platform_device_add_data(e740_pcmcia_device, &e740_pcmcia_ops,\r\nsizeof(e740_pcmcia_ops));\r\nif (!ret)\r\nret = platform_device_add(e740_pcmcia_device);\r\nif (ret)\r\nplatform_device_put(e740_pcmcia_device);\r\nreturn ret;\r\n}\r\nstatic void __exit e740_pcmcia_exit(void)\r\n{\r\nplatform_device_unregister(e740_pcmcia_device);\r\n}
