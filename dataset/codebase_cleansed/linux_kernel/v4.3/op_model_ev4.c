static void\r\nev4_reg_setup(struct op_register_config *reg,\r\nstruct op_counter_config *ctr,\r\nstruct op_system_config *sys)\r\n{\r\nunsigned long ctl = 0, count, hilo;\r\nctl |= (ctr[0].enabled ? ctr[0].event << 8 : 14 << 8);\r\nctl |= (ctr[1].enabled ? (ctr[1].event - 16) << 32 : 7ul << 32);\r\ncount = ctr[0].count;\r\nif (count <= 4096)\r\ncount = 4096, hilo = 1;\r\nelse\r\ncount = 65536, hilo = 0;\r\nctr[0].count = count;\r\nctl |= (ctr[0].enabled && hilo) << 3;\r\ncount = ctr[1].count;\r\nif (count <= 256)\r\ncount = 256, hilo = 1;\r\nelse\r\ncount = 4096, hilo = 0;\r\nctr[1].count = count;\r\nctl |= (ctr[1].enabled && hilo);\r\nreg->mux_select = ctl;\r\nreg->proc_mode = 0;\r\nreg->freq = 0;\r\nreg->reset_values = 0;\r\nreg->need_reset = 0;\r\n}\r\nstatic void\r\nev4_cpu_setup(void *x)\r\n{\r\nstruct op_register_config *reg = x;\r\nwrperfmon(2, reg->mux_select);\r\nwrperfmon(3, reg->proc_mode);\r\n}\r\nstatic void\r\nev4_handle_interrupt(unsigned long which, struct pt_regs *regs,\r\nstruct op_counter_config *ctr)\r\n{\r\nif (!ctr[which].enabled)\r\nreturn;\r\noprofile_add_sample(regs, which);\r\n}
