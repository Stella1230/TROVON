u32 vmci_get_context_id(void)\r\n{\r\nif (vmci_guest_code_active())\r\nreturn vmci_get_vm_context_id();\r\nelse if (vmci_host_code_active())\r\nreturn VMCI_HOST_CONTEXT_ID;\r\nreturn VMCI_INVALID_ID;\r\n}\r\nstatic int __init vmci_drv_init(void)\r\n{\r\nint vmci_err;\r\nint error;\r\nvmci_err = vmci_event_init();\r\nif (vmci_err < VMCI_SUCCESS) {\r\npr_err("Failed to initialize VMCIEvent (result=%d)\n",\r\nvmci_err);\r\nreturn -EINVAL;\r\n}\r\nif (!vmci_disable_guest) {\r\nerror = vmci_guest_init();\r\nif (error) {\r\npr_warn("Failed to initialize guest personality (err=%d)\n",\r\nerror);\r\n} else {\r\nvmci_guest_personality_initialized = true;\r\npr_info("Guest personality initialized and is %s\n",\r\nvmci_guest_code_active() ?\r\n"active" : "inactive");\r\n}\r\n}\r\nif (!vmci_disable_host) {\r\nerror = vmci_host_init();\r\nif (error) {\r\npr_warn("Unable to initialize host personality (err=%d)\n",\r\nerror);\r\n} else {\r\nvmci_host_personality_initialized = true;\r\npr_info("Initialized host personality\n");\r\n}\r\n}\r\nif (!vmci_guest_personality_initialized &&\r\n!vmci_host_personality_initialized) {\r\nvmci_event_exit();\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit vmci_drv_exit(void)\r\n{\r\nif (vmci_guest_personality_initialized)\r\nvmci_guest_exit();\r\nif (vmci_host_personality_initialized)\r\nvmci_host_exit();\r\nvmci_event_exit();\r\n}
