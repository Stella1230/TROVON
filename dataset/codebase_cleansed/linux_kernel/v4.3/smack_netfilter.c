static unsigned int smack_ipv6_output(const struct nf_hook_ops *ops,\r\nstruct sk_buff *skb,\r\nconst struct nf_hook_state *state)\r\n{\r\nstruct socket_smack *ssp;\r\nstruct smack_known *skp;\r\nif (skb && skb->sk && skb->sk->sk_security) {\r\nssp = skb->sk->sk_security;\r\nskp = ssp->smk_out;\r\nskb->secmark = skp->smk_secid;\r\n}\r\nreturn NF_ACCEPT;\r\n}\r\nstatic unsigned int smack_ipv4_output(const struct nf_hook_ops *ops,\r\nstruct sk_buff *skb,\r\nconst struct nf_hook_state *state)\r\n{\r\nstruct socket_smack *ssp;\r\nstruct smack_known *skp;\r\nif (skb && skb->sk && skb->sk->sk_security) {\r\nssp = skb->sk->sk_security;\r\nskp = ssp->smk_out;\r\nskb->secmark = skp->smk_secid;\r\n}\r\nreturn NF_ACCEPT;\r\n}\r\nstatic int __init smack_nf_ip_init(void)\r\n{\r\nint err;\r\nif (smack_enabled == 0)\r\nreturn 0;\r\nprintk(KERN_DEBUG "Smack: Registering netfilter hooks\n");\r\nerr = nf_register_hooks(smack_nf_ops, ARRAY_SIZE(smack_nf_ops));\r\nif (err)\r\npr_info("Smack: nf_register_hooks: error %d\n", err);\r\nreturn 0;\r\n}
