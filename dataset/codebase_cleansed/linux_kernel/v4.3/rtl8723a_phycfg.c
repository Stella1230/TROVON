static u32 phy_CalculateBitShift(u32 BitMask)\r\n{\r\nu32 i;\r\nfor (i = 0; i <= 31; i++) {\r\nif (((BitMask>>i) & 0x1) == 1)\r\nbreak;\r\n}\r\nreturn i;\r\n}\r\nu32\r\nPHY_QueryBBReg(struct rtw_adapter *Adapter, u32 RegAddr, u32 BitMask)\r\n{\r\nu32 ReturnValue = 0, OriginalValue, BitShift;\r\nOriginalValue = rtl8723au_read32(Adapter, RegAddr);\r\nBitShift = phy_CalculateBitShift(BitMask);\r\nReturnValue = (OriginalValue & BitMask) >> BitShift;\r\nreturn ReturnValue;\r\n}\r\nvoid\r\nPHY_SetBBReg(struct rtw_adapter *Adapter, u32 RegAddr, u32 BitMask, u32 Data)\r\n{\r\nu32 OriginalValue, BitShift;\r\nif (BitMask != bMaskDWord) {\r\nOriginalValue = rtl8723au_read32(Adapter, RegAddr);\r\nBitShift = phy_CalculateBitShift(BitMask);\r\nData = (OriginalValue & (~BitMask)) | (Data << BitShift);\r\n}\r\nrtl8723au_write32(Adapter, RegAddr, Data);\r\n}\r\nstatic u32\r\nphy_RFSerialRead(struct rtw_adapter *Adapter, enum RF_RADIO_PATH eRFPath,\r\nu32 Offset)\r\n{\r\nu32 retValue = 0;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nstruct bb_reg_define *pPhyReg = &pHalData->PHYRegDef[eRFPath];\r\nu32 NewOffset;\r\nu32 tmplong, tmplong2;\r\nu8 RfPiEnable = 0;\r\nOffset &= 0x3f;\r\nNewOffset = Offset;\r\ntmplong = rtl8723au_read32(Adapter, rFPGA0_XA_HSSIParameter2);\r\nif (eRFPath == RF_PATH_A)\r\ntmplong2 = tmplong;\r\nelse\r\ntmplong2 = rtl8723au_read32(Adapter, pPhyReg->rfHSSIPara2);\r\ntmplong2 = (tmplong2 & ~bLSSIReadAddress) |\r\n(NewOffset << 23) | bLSSIReadEdge;\r\nrtl8723au_write32(Adapter, rFPGA0_XA_HSSIParameter2,\r\ntmplong & (~bLSSIReadEdge));\r\nudelay(10);\r\nrtl8723au_write32(Adapter, pPhyReg->rfHSSIPara2, tmplong2);\r\nudelay(100);\r\nrtl8723au_write32(Adapter, rFPGA0_XA_HSSIParameter2,\r\ntmplong | bLSSIReadEdge);\r\nudelay(10);\r\nif (eRFPath == RF_PATH_A)\r\nRfPiEnable = (u8)PHY_QueryBBReg(Adapter,\r\nrFPGA0_XA_HSSIParameter1,\r\nBIT(8));\r\nelse if (eRFPath == RF_PATH_B)\r\nRfPiEnable = (u8)PHY_QueryBBReg(Adapter,\r\nrFPGA0_XB_HSSIParameter1,\r\nBIT(8));\r\nif (RfPiEnable) {\r\nretValue = PHY_QueryBBReg(Adapter, pPhyReg->rfLSSIReadBackPi,\r\nbLSSIReadBackData);\r\n} else {\r\nretValue = PHY_QueryBBReg(Adapter, pPhyReg->rfLSSIReadBack,\r\nbLSSIReadBackData);\r\n}\r\nreturn retValue;\r\n}\r\nstatic void\r\nphy_RFSerialWrite(struct rtw_adapter *Adapter, enum RF_RADIO_PATH eRFPath,\r\nu32 Offset, u32 Data)\r\n{\r\nu32 DataAndAddr = 0;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nstruct bb_reg_define *pPhyReg = &pHalData->PHYRegDef[eRFPath];\r\nu32 NewOffset;\r\nOffset &= 0x3f;\r\nNewOffset = Offset;\r\nDataAndAddr = ((NewOffset<<20) | (Data&0x000fffff)) & 0x0fffffff;\r\nrtl8723au_write32(Adapter, pPhyReg->rf3wireOffset, DataAndAddr);\r\n}\r\nu32\r\nPHY_QueryRFReg(struct rtw_adapter *Adapter, enum RF_RADIO_PATH eRFPath,\r\nu32 RegAddr, u32 BitMask)\r\n{\r\nu32 Original_Value, Readback_Value, BitShift;\r\nOriginal_Value = phy_RFSerialRead(Adapter, eRFPath, RegAddr);\r\nBitShift = phy_CalculateBitShift(BitMask);\r\nReadback_Value = (Original_Value & BitMask) >> BitShift;\r\nreturn Readback_Value;\r\n}\r\nvoid\r\nPHY_SetRFReg(struct rtw_adapter *Adapter, enum RF_RADIO_PATH eRFPath,\r\nu32 RegAddr, u32 BitMask, u32 Data)\r\n{\r\nu32 Original_Value, BitShift;\r\nif (BitMask != bRFRegOffsetMask) {\r\nOriginal_Value = phy_RFSerialRead(Adapter, eRFPath, RegAddr);\r\nBitShift = phy_CalculateBitShift(BitMask);\r\nData = (Original_Value & (~BitMask)) | (Data << BitShift);\r\n}\r\nphy_RFSerialWrite(Adapter, eRFPath, RegAddr, Data);\r\n}\r\nint PHY_MACConfig8723A(struct rtw_adapter *Adapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nODM_ReadAndConfig_MAC_REG_8723A(&pHalData->odmpriv);\r\nrtl8723au_write8(Adapter, REG_MAX_AGGR_NUM, 0x0A);\r\nif (pHalData->rf_type == RF_2T2R &&\r\nBOARD_USB_DONGLE == pHalData->BoardType)\r\nrtl8723au_write8(Adapter, 0x40, 0x04);\r\nreturn _SUCCESS;\r\n}\r\nstatic void\r\nphy_InitBBRFRegisterDefinition(struct rtw_adapter *Adapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\npHalData->PHYRegDef[RF_PATH_A].rfintfs = rFPGA0_XAB_RFInterfaceSW;\r\npHalData->PHYRegDef[RF_PATH_B].rfintfs = rFPGA0_XAB_RFInterfaceSW;\r\npHalData->PHYRegDef[RF_PATH_A].rfintfi = rFPGA0_XAB_RFInterfaceRB;\r\npHalData->PHYRegDef[RF_PATH_B].rfintfi = rFPGA0_XAB_RFInterfaceRB;\r\npHalData->PHYRegDef[RF_PATH_A].rfintfo = rFPGA0_XA_RFInterfaceOE;\r\npHalData->PHYRegDef[RF_PATH_B].rfintfo = rFPGA0_XB_RFInterfaceOE;\r\npHalData->PHYRegDef[RF_PATH_A].rfintfe = rFPGA0_XA_RFInterfaceOE;\r\npHalData->PHYRegDef[RF_PATH_B].rfintfe = rFPGA0_XB_RFInterfaceOE;\r\npHalData->PHYRegDef[RF_PATH_A].rf3wireOffset = rFPGA0_XA_LSSIParameter;\r\npHalData->PHYRegDef[RF_PATH_B].rf3wireOffset = rFPGA0_XB_LSSIParameter;\r\npHalData->PHYRegDef[RF_PATH_A].rfLSSI_Select = rFPGA0_XAB_RFParameter;\r\npHalData->PHYRegDef[RF_PATH_B].rfLSSI_Select = rFPGA0_XAB_RFParameter;\r\npHalData->PHYRegDef[RF_PATH_A].rfTxGainStage = rFPGA0_TxGainStage;\r\npHalData->PHYRegDef[RF_PATH_B].rfTxGainStage = rFPGA0_TxGainStage;\r\npHalData->PHYRegDef[RF_PATH_A].rfHSSIPara1 = rFPGA0_XA_HSSIParameter1;\r\npHalData->PHYRegDef[RF_PATH_B].rfHSSIPara1 = rFPGA0_XB_HSSIParameter1;\r\npHalData->PHYRegDef[RF_PATH_A].rfHSSIPara2 = rFPGA0_XA_HSSIParameter2;\r\npHalData->PHYRegDef[RF_PATH_B].rfHSSIPara2 = rFPGA0_XB_HSSIParameter2;\r\npHalData->PHYRegDef[RF_PATH_A].rfSwitchControl =\r\nrFPGA0_XAB_SwitchControl;\r\npHalData->PHYRegDef[RF_PATH_B].rfSwitchControl =\r\nrFPGA0_XAB_SwitchControl;\r\npHalData->PHYRegDef[RF_PATH_A].rfAGCControl1 = rOFDM0_XAAGCCore1;\r\npHalData->PHYRegDef[RF_PATH_B].rfAGCControl1 = rOFDM0_XBAGCCore1;\r\npHalData->PHYRegDef[RF_PATH_A].rfAGCControl2 = rOFDM0_XAAGCCore2;\r\npHalData->PHYRegDef[RF_PATH_B].rfAGCControl2 = rOFDM0_XBAGCCore2;\r\npHalData->PHYRegDef[RF_PATH_A].rfRxIQImbalance = rOFDM0_XARxIQImbalance;\r\npHalData->PHYRegDef[RF_PATH_B].rfRxIQImbalance = rOFDM0_XBRxIQImbalance;\r\npHalData->PHYRegDef[RF_PATH_A].rfRxAFE = rOFDM0_XARxAFE;\r\npHalData->PHYRegDef[RF_PATH_B].rfRxAFE = rOFDM0_XBRxAFE;\r\npHalData->PHYRegDef[RF_PATH_A].rfTxIQImbalance = rOFDM0_XATxIQImbalance;\r\npHalData->PHYRegDef[RF_PATH_B].rfTxIQImbalance = rOFDM0_XBTxIQImbalance;\r\npHalData->PHYRegDef[RF_PATH_A].rfTxAFE = rOFDM0_XATxAFE;\r\npHalData->PHYRegDef[RF_PATH_B].rfTxAFE = rOFDM0_XBTxAFE;\r\npHalData->PHYRegDef[RF_PATH_A].rfLSSIReadBack = rFPGA0_XA_LSSIReadBack;\r\npHalData->PHYRegDef[RF_PATH_B].rfLSSIReadBack = rFPGA0_XB_LSSIReadBack;\r\npHalData->PHYRegDef[RF_PATH_A].rfLSSIReadBackPi =\r\nTransceiverA_HSPI_Readback;\r\npHalData->PHYRegDef[RF_PATH_B].rfLSSIReadBackPi =\r\nTransceiverB_HSPI_Readback;\r\n}\r\nstatic void\r\nstorePwrIndexDiffRateOffset(struct rtw_adapter *Adapter, u32 RegAddr,\r\nu32 BitMask, u32 Data)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nif (RegAddr == rTxAGC_A_Rate18_06) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][0] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_Rate54_24) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][1] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_CCK1_Mcs32) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][6] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_CCK11_A_CCK2_11 && BitMask == 0xffffff00) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][7] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_Mcs03_Mcs00) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][2] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_Mcs07_Mcs04) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][3] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_Mcs11_Mcs08) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][4] = Data;\r\n}\r\nif (RegAddr == rTxAGC_A_Mcs15_Mcs12) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][5] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Rate18_06) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][8] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Rate54_24) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][9] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_CCK1_55_Mcs32) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][14] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_CCK11_A_CCK2_11 && BitMask == 0x000000ff) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][15] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Mcs03_Mcs00) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][10] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Mcs07_Mcs04) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][11] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Mcs11_Mcs08) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][12] = Data;\r\n}\r\nif (RegAddr == rTxAGC_B_Mcs15_Mcs12) {\r\npHalData->MCSTxPowerLevelOriginalOffset[pHalData->pwrGroupCnt][13] = Data;\r\npHalData->pwrGroupCnt++;\r\n}\r\n}\r\nstatic int\r\nphy_ConfigBBWithPgHeaderFile(struct rtw_adapter *Adapter)\r\n{\r\nint i;\r\nu32 *Rtl819XPHY_REGArray_Table_PG;\r\nu16 PHY_REGArrayPGLen;\r\nPHY_REGArrayPGLen = Rtl8723_PHY_REG_Array_PGLength;\r\nRtl819XPHY_REGArray_Table_PG = (u32 *)Rtl8723_PHY_REG_Array_PG;\r\nfor (i = 0; i < PHY_REGArrayPGLen; i = i + 3) {\r\nstorePwrIndexDiffRateOffset(Adapter,\r\nRtl819XPHY_REGArray_Table_PG[i],\r\nRtl819XPHY_REGArray_Table_PG[i+1],\r\nRtl819XPHY_REGArray_Table_PG[i+2]);\r\n}\r\nreturn _SUCCESS;\r\n}\r\nstatic void\r\nphy_BB8192C_Config_1T(struct rtw_adapter *Adapter)\r\n{\r\nPHY_SetBBReg(Adapter, rFPGA0_TxInfo, 0x3, 0x2);\r\nPHY_SetBBReg(Adapter, rFPGA1_TxInfo, 0x300033, 0x200022);\r\nPHY_SetBBReg(Adapter, rCCK0_AFESetting, bMaskByte3, 0x45);\r\nPHY_SetBBReg(Adapter, rOFDM0_TRxPathEnable, bMaskByte0, 0x23);\r\nPHY_SetBBReg(Adapter, rOFDM0_AGCParameter1, 0x30, 0x1);\r\nPHY_SetBBReg(Adapter, 0xe74, 0x0c000000, 0x2);\r\nPHY_SetBBReg(Adapter, 0xe78, 0x0c000000, 0x2);\r\nPHY_SetBBReg(Adapter, 0xe7c, 0x0c000000, 0x2);\r\nPHY_SetBBReg(Adapter, 0xe80, 0x0c000000, 0x2);\r\nPHY_SetBBReg(Adapter, 0xe88, 0x0c000000, 0x2);\r\n}\r\nstatic int\r\nphy_BB8723a_Config_ParaFile(struct rtw_adapter *Adapter)\r\n{\r\nstruct eeprom_priv *pEEPROM = GET_EEPROM_EFUSE_PRIV(Adapter);\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nint rtStatus = _SUCCESS;\r\nODM_ReadAndConfig_PHY_REG_1T_8723A(&pHalData->odmpriv);\r\nif (pHalData->rf_type == RF_1T2R) {\r\nphy_BB8192C_Config_1T(Adapter);\r\nDBG_8723A("phy_BB8723a_Config_ParaFile():Config to 1T!!\n");\r\n}\r\nif (pEEPROM->bautoload_fail_flag == false) {\r\npHalData->pwrGroupCnt = 0;\r\nrtStatus = phy_ConfigBBWithPgHeaderFile(Adapter);\r\n}\r\nif (rtStatus != _SUCCESS)\r\ngoto phy_BB8190_Config_ParaFile_Fail;\r\nODM_ReadAndConfig_AGC_TAB_1T_8723A(&pHalData->odmpriv);\r\nphy_BB8190_Config_ParaFile_Fail:\r\nreturn rtStatus;\r\n}\r\nint\r\nPHY_BBConfig8723A(struct rtw_adapter *Adapter)\r\n{\r\nint rtStatus = _SUCCESS;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nu8 TmpU1B = 0;\r\nu8 CrystalCap;\r\nphy_InitBBRFRegisterDefinition(Adapter);\r\nTmpU1B = rtl8723au_read8(Adapter, REG_AFE_PLL_CTRL);\r\nudelay(2);\r\nrtl8723au_write8(Adapter, REG_AFE_PLL_CTRL, TmpU1B | BIT(1));\r\nudelay(2);\r\nrtl8723au_write8(Adapter, REG_AFE_PLL_CTRL+1, 0xff);\r\nudelay(2);\r\nTmpU1B = rtl8723au_read8(Adapter, REG_SYS_FUNC_EN);\r\nrtl8723au_write8(Adapter, REG_SYS_FUNC_EN,\r\n(TmpU1B | FEN_BB_GLB_RSTn | FEN_BBRSTB));\r\nTmpU1B = rtl8723au_read8(Adapter, REG_AFE_XTAL_CTRL + 1);\r\nrtl8723au_write8(Adapter, REG_AFE_XTAL_CTRL+1, TmpU1B & ~BIT(6));\r\nTmpU1B = rtl8723au_read8(Adapter, REG_AFE_XTAL_CTRL+2);\r\nrtl8723au_write8(Adapter, REG_AFE_XTAL_CTRL+2, TmpU1B & ~BIT(4));\r\nrtl8723au_write8(Adapter, REG_RF_CTRL, 0x07);\r\nrtStatus = phy_BB8723a_Config_ParaFile(Adapter);\r\nif (pHalData->EEPROMVersion >= 0x01) {\r\nCrystalCap = pHalData->CrystalCap & 0x3F;\r\nPHY_SetBBReg(Adapter, REG_MAC_PHY_CTRL, 0xFFF000,\r\n(CrystalCap | (CrystalCap << 6)));\r\n}\r\nrtl8723au_write32(Adapter, REG_LDOA15_CTRL, 0x01572505);\r\nreturn rtStatus;\r\n}\r\nstatic void getTxPowerIndex(struct rtw_adapter *Adapter,\r\nu8 channel, u8 *cckPowerLevel, u8 *ofdmPowerLevel)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nu8 index = (channel - 1);\r\ncckPowerLevel[RF_PATH_A] = pHalData->TxPwrLevelCck[RF_PATH_A][index];\r\ncckPowerLevel[RF_PATH_B] = pHalData->TxPwrLevelCck[RF_PATH_B][index];\r\nif (GET_RF_TYPE(Adapter) == RF_1T2R || GET_RF_TYPE(Adapter) == RF_1T1R) {\r\nofdmPowerLevel[RF_PATH_A] =\r\npHalData->TxPwrLevelHT40_1S[RF_PATH_A][index];\r\nofdmPowerLevel[RF_PATH_B] =\r\npHalData->TxPwrLevelHT40_1S[RF_PATH_B][index];\r\n} else if (GET_RF_TYPE(Adapter) == RF_2T2R) {\r\nofdmPowerLevel[RF_PATH_A] =\r\npHalData->TxPwrLevelHT40_2S[RF_PATH_A][index];\r\nofdmPowerLevel[RF_PATH_B] =\r\npHalData->TxPwrLevelHT40_2S[RF_PATH_B][index];\r\n}\r\n}\r\nstatic void ccxPowerIndexCheck(struct rtw_adapter *Adapter, u8 channel,\r\nu8 *cckPowerLevel, u8 *ofdmPowerLevel)\r\n{\r\n}\r\nvoid PHY_SetTxPowerLevel8723A(struct rtw_adapter *Adapter, u8 channel)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nu8 cckPowerLevel[2], ofdmPowerLevel[2];\r\nif (pHalData->bTXPowerDataReadFromEEPORM == false)\r\nreturn;\r\ngetTxPowerIndex(Adapter, channel, &cckPowerLevel[0],\r\n&ofdmPowerLevel[0]);\r\nccxPowerIndexCheck(Adapter, channel, &cckPowerLevel[0],\r\n&ofdmPowerLevel[0]);\r\nrtl823a_phy_rf6052setccktxpower(Adapter, &cckPowerLevel[0]);\r\nrtl8723a_PHY_RF6052SetOFDMTxPower(Adapter, &ofdmPowerLevel[0], channel);\r\n}\r\nstatic void\r\n_PHY_SetBWMode23a92C(struct rtw_adapter *Adapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nu8 regBwOpMode;\r\nu8 regRRSR_RSC;\r\nif (Adapter->bDriverStopped)\r\nreturn;\r\nregBwOpMode = rtl8723au_read8(Adapter, REG_BWOPMODE);\r\nregRRSR_RSC = rtl8723au_read8(Adapter, REG_RRSR+2);\r\nswitch (pHalData->CurrentChannelBW) {\r\ncase HT_CHANNEL_WIDTH_20:\r\nregBwOpMode |= BW_OPMODE_20MHZ;\r\nrtl8723au_write8(Adapter, REG_BWOPMODE, regBwOpMode);\r\nbreak;\r\ncase HT_CHANNEL_WIDTH_40:\r\nregBwOpMode &= ~BW_OPMODE_20MHZ;\r\nrtl8723au_write8(Adapter, REG_BWOPMODE, regBwOpMode);\r\nregRRSR_RSC = (regRRSR_RSC & 0x90) |\r\n(pHalData->nCur40MhzPrimeSC << 5);\r\nrtl8723au_write8(Adapter, REG_RRSR+2, regRRSR_RSC);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nswitch (pHalData->CurrentChannelBW) {\r\ncase HT_CHANNEL_WIDTH_20:\r\nPHY_SetBBReg(Adapter, rFPGA0_RFMOD, bRFMOD, 0x0);\r\nPHY_SetBBReg(Adapter, rFPGA1_RFMOD, bRFMOD, 0x0);\r\nPHY_SetBBReg(Adapter, rFPGA0_AnalogParameter2, BIT(10), 1);\r\nbreak;\r\ncase HT_CHANNEL_WIDTH_40:\r\nPHY_SetBBReg(Adapter, rFPGA0_RFMOD, bRFMOD, 0x1);\r\nPHY_SetBBReg(Adapter, rFPGA1_RFMOD, bRFMOD, 0x1);\r\nPHY_SetBBReg(Adapter, rCCK0_System, bCCKSideBand,\r\n(pHalData->nCur40MhzPrimeSC >> 1));\r\nPHY_SetBBReg(Adapter, rOFDM1_LSTF, 0xC00,\r\npHalData->nCur40MhzPrimeSC);\r\nPHY_SetBBReg(Adapter, rFPGA0_AnalogParameter2, BIT(10), 0);\r\nPHY_SetBBReg(Adapter, 0x818, BIT(26) | BIT(27),\r\n(pHalData->nCur40MhzPrimeSC ==\r\nHAL_PRIME_CHNL_OFFSET_LOWER) ? 2:1);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nrtl8723a_phy_rf6052set_bw(Adapter, pHalData->CurrentChannelBW);\r\n}\r\nvoid\r\nPHY_SetBWMode23a8723A(struct rtw_adapter *Adapter,\r\nenum ht_channel_width Bandwidth, unsigned char Offset)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nenum ht_channel_width tmpBW = pHalData->CurrentChannelBW;\r\npHalData->CurrentChannelBW = Bandwidth;\r\npHalData->nCur40MhzPrimeSC = Offset;\r\nif ((!Adapter->bDriverStopped) && (!Adapter->bSurpriseRemoved))\r\n_PHY_SetBWMode23a92C(Adapter);\r\nelse\r\npHalData->CurrentChannelBW = tmpBW;\r\n}\r\nstatic void _PHY_SwChnl8723A(struct rtw_adapter *Adapter, u8 channel)\r\n{\r\nenum RF_RADIO_PATH eRFPath;\r\nu32 param1, param2;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nPHY_SetTxPowerLevel8723A(Adapter, channel);\r\nparam1 = RF_CHNLBW;\r\nparam2 = channel;\r\nfor (eRFPath = 0; eRFPath < pHalData->NumTotalRFPath; eRFPath++) {\r\npHalData->RfRegChnlVal[eRFPath] =\r\n(pHalData->RfRegChnlVal[eRFPath] & 0xfffffc00) | param2;\r\nPHY_SetRFReg(Adapter, eRFPath, param1,\r\nbRFRegOffsetMask, pHalData->RfRegChnlVal[eRFPath]);\r\n}\r\n}\r\nvoid PHY_SwChnl8723A(struct rtw_adapter *Adapter, u8 channel)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nu8 tmpchannel = pHalData->CurrentChannel;\r\nbool result = true;\r\nif (channel == 0)\r\nchannel = 1;\r\npHalData->CurrentChannel = channel;\r\nif ((!Adapter->bDriverStopped) && (!Adapter->bSurpriseRemoved)) {\r\n_PHY_SwChnl8723A(Adapter, channel);\r\nif (!result)\r\npHalData->CurrentChannel = tmpchannel;\r\n} else {\r\npHalData->CurrentChannel = tmpchannel;\r\n}\r\n}
