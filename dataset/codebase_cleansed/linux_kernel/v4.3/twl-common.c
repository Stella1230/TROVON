static int twl_set_voltage(void *data, int target_uV)\r\n{\r\nstruct voltagedomain *voltdm = (struct voltagedomain *)data;\r\nreturn voltdm_scale(voltdm, target_uV);\r\n}\r\nstatic int twl_get_voltage(void *data)\r\n{\r\nstruct voltagedomain *voltdm = (struct voltagedomain *)data;\r\nreturn voltdm_get_voltage(voltdm);\r\n}\r\nvoid __init omap_pmic_init(int bus, u32 clkrate,\r\nconst char *pmic_type, int pmic_irq,\r\nstruct twl4030_platform_data *pmic_data)\r\n{\r\nomap_mux_init_signal("sys_nirq", OMAP_PIN_INPUT_PULLUP | OMAP_PIN_OFF_WAKEUPENABLE);\r\nstrlcpy(pmic_i2c_board_info.type, pmic_type,\r\nsizeof(pmic_i2c_board_info.type));\r\npmic_i2c_board_info.irq = pmic_irq;\r\npmic_i2c_board_info.platform_data = pmic_data;\r\nomap_register_i2c_bus(bus, clkrate, &pmic_i2c_board_info, 1);\r\n}\r\nvoid __init omap4_pmic_init(const char *pmic_type,\r\nstruct twl4030_platform_data *pmic_data,\r\nstruct i2c_board_info *devices, int nr_devices)\r\n{\r\nunsigned int irq;\r\nomap_mux_init_signal("sys_nirq1", OMAP_PIN_INPUT_PULLUP | OMAP_PIN_OFF_WAKEUPENABLE);\r\nomap_mux_init_signal("fref_clk0_out.sys_drm_msecure", OMAP_PIN_OUTPUT);\r\nirq = omap4_xlate_irq(7 + OMAP44XX_IRQ_GIC_START);\r\nomap_pmic_init(1, 400, pmic_type, irq, pmic_data);\r\nif (devices)\r\ni2c_register_board_info(1, devices, nr_devices);\r\n}\r\nvoid __init omap_pmic_late_init(void)\r\n{\r\nif (!pmic_i2c_board_info.irq)\r\nreturn;\r\nomap3_twl_init();\r\nomap4_twl_init();\r\n}\r\nvoid __init omap3_pmic_get_config(struct twl4030_platform_data *pmic_data,\r\nu32 pdata_flags, u32 regulators_flags)\r\n{\r\nif (!pmic_data->vdd1) {\r\nomap3_vdd1.driver_data = &omap3_vdd1_drvdata;\r\nomap3_vdd1_drvdata.data = voltdm_lookup("mpu_iva");\r\npmic_data->vdd1 = &omap3_vdd1;\r\n}\r\nif (!pmic_data->vdd2) {\r\nomap3_vdd2.driver_data = &omap3_vdd2_drvdata;\r\nomap3_vdd2_drvdata.data = voltdm_lookup("core");\r\npmic_data->vdd2 = &omap3_vdd2;\r\n}\r\nif (pdata_flags & TWL_COMMON_PDATA_USB && !pmic_data->usb)\r\npmic_data->usb = &omap3_usb_pdata;\r\nif (pdata_flags & TWL_COMMON_PDATA_BCI && !pmic_data->bci)\r\npmic_data->bci = &omap3_bci_pdata;\r\nif (pdata_flags & TWL_COMMON_PDATA_MADC && !pmic_data->madc)\r\npmic_data->madc = &omap3_madc_pdata;\r\nif (pdata_flags & TWL_COMMON_PDATA_AUDIO && !pmic_data->audio)\r\npmic_data->audio = &omap3_audio_pdata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VDAC && !pmic_data->vdac)\r\npmic_data->vdac = &omap3_vdac_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VPLL2 && !pmic_data->vpll2)\r\npmic_data->vpll2 = &omap3_vpll2_idata;\r\n}\r\nvoid __init omap4_pmic_get_config(struct twl4030_platform_data *pmic_data,\r\nu32 pdata_flags, u32 regulators_flags)\r\n{\r\nif (!pmic_data->vdd1) {\r\nomap4_vdd1.driver_data = &omap4_vdd1_drvdata;\r\nomap4_vdd1_drvdata.data = voltdm_lookup("mpu");\r\npmic_data->vdd1 = &omap4_vdd1;\r\n}\r\nif (!pmic_data->vdd2) {\r\nomap4_vdd2.driver_data = &omap4_vdd2_drvdata;\r\nomap4_vdd2_drvdata.data = voltdm_lookup("iva");\r\npmic_data->vdd2 = &omap4_vdd2;\r\n}\r\nif (!pmic_data->vdd3) {\r\nomap4_vdd3.driver_data = &omap4_vdd3_drvdata;\r\nomap4_vdd3_drvdata.data = voltdm_lookup("core");\r\npmic_data->vdd3 = &omap4_vdd3;\r\n}\r\nif (pdata_flags & TWL_COMMON_PDATA_USB && !pmic_data->usb)\r\npmic_data->usb = &omap4_usb_pdata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VDAC && !pmic_data->vdac)\r\npmic_data->vdac = &omap4_vdac_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VAUX2 && !pmic_data->vaux2)\r\npmic_data->vaux2 = &omap4_vaux2_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VAUX3 && !pmic_data->vaux3)\r\npmic_data->vaux3 = &omap4_vaux3_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VMMC && !pmic_data->vmmc)\r\npmic_data->vmmc = &omap4_vmmc_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VPP && !pmic_data->vpp)\r\npmic_data->vpp = &omap4_vpp_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VANA && !pmic_data->vana)\r\npmic_data->vana = &omap4_vana_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VCXIO && !pmic_data->vcxio)\r\npmic_data->vcxio = &omap4_vcxio_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_VUSB && !pmic_data->vusb)\r\npmic_data->vusb = &omap4_vusb_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_CLK32KG &&\r\n!pmic_data->clk32kg)\r\npmic_data->clk32kg = &omap4_clk32kg_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_V1V8 && !pmic_data->v1v8)\r\npmic_data->v1v8 = &omap4_v1v8_idata;\r\nif (regulators_flags & TWL_COMMON_REGULATOR_V2V1 && !pmic_data->v2v1)\r\npmic_data->v2v1 = &omap4_v2v1_idata;\r\n}\r\nvoid omap_twl4030_audio_init(char *card_name,\r\nstruct omap_tw4030_pdata *pdata)\r\n{\r\nif (!pdata)\r\npdata = &omap_twl4030_audio_data;\r\npdata->card_name = card_name;\r\naudio_device.dev.platform_data = pdata;\r\nplatform_device_register(&audio_device);\r\n}\r\nvoid omap_twl4030_audio_init(char *card_name,\r\nstruct omap_tw4030_pdata *pdata)\r\n{\r\nreturn;\r\n}
