int clk_is_enabled_regmap(struct clk_hw *hw)\r\n{\r\nstruct clk_regmap *rclk = to_clk_regmap(hw);\r\nunsigned int val;\r\nint ret;\r\nret = regmap_read(rclk->regmap, rclk->enable_reg, &val);\r\nif (ret != 0)\r\nreturn ret;\r\nif (rclk->enable_is_inverted)\r\nreturn (val & rclk->enable_mask) == 0;\r\nelse\r\nreturn (val & rclk->enable_mask) != 0;\r\n}\r\nint clk_enable_regmap(struct clk_hw *hw)\r\n{\r\nstruct clk_regmap *rclk = to_clk_regmap(hw);\r\nunsigned int val;\r\nif (rclk->enable_is_inverted)\r\nval = 0;\r\nelse\r\nval = rclk->enable_mask;\r\nreturn regmap_update_bits(rclk->regmap, rclk->enable_reg,\r\nrclk->enable_mask, val);\r\n}\r\nvoid clk_disable_regmap(struct clk_hw *hw)\r\n{\r\nstruct clk_regmap *rclk = to_clk_regmap(hw);\r\nunsigned int val;\r\nif (rclk->enable_is_inverted)\r\nval = rclk->enable_mask;\r\nelse\r\nval = 0;\r\nregmap_update_bits(rclk->regmap, rclk->enable_reg, rclk->enable_mask,\r\nval);\r\n}\r\nstruct clk *devm_clk_register_regmap(struct device *dev,\r\nstruct clk_regmap *rclk)\r\n{\r\nif (dev && dev_get_regmap(dev, NULL))\r\nrclk->regmap = dev_get_regmap(dev, NULL);\r\nelse if (dev && dev->parent)\r\nrclk->regmap = dev_get_regmap(dev->parent, NULL);\r\nreturn devm_clk_register(dev, &rclk->hw);\r\n}
