static void byteblaster_write(int port, int data)\r\n{\r\noutb((u8)data, (u16)(port + 0x378));\r\n}\r\nstatic int byteblaster_read(int port)\r\n{\r\nint data = 0;\r\ndata = inb((u16)(port + 0x378));\r\nreturn data & 0xff;\r\n}\r\nint netup_jtag_io_lpt(void *device, int tms, int tdi, int read_tdo)\r\n{\r\nint data = 0;\r\nint tdo = 0;\r\nint initial_lpt_ctrl = 0;\r\nif (!lpt_hardware_initialized) {\r\ninitial_lpt_ctrl = byteblaster_read(2);\r\nbyteblaster_write(2, (initial_lpt_ctrl | 0x02) & 0xdf);\r\nlpt_hardware_initialized = 1;\r\n}\r\ndata = ((tdi ? 0x40 : 0) | (tms ? 0x02 : 0));\r\nbyteblaster_write(0, data);\r\nif (read_tdo) {\r\ntdo = byteblaster_read(1);\r\ntdo = ((tdo & 0x80) ? 0 : 1);\r\n}\r\nbyteblaster_write(0, data | 0x01);\r\nbyteblaster_write(0, data);\r\nreturn tdo;\r\n}
