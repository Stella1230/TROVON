static void\r\nsnd_emux_proc_info_read(struct snd_info_entry *entry,\r\nstruct snd_info_buffer *buf)\r\n{\r\nstruct snd_emux *emu;\r\nint i;\r\nemu = entry->private_data;\r\nmutex_lock(&emu->register_mutex);\r\nif (emu->name)\r\nsnd_iprintf(buf, "Device: %s\n", emu->name);\r\nsnd_iprintf(buf, "Ports: %d\n", emu->num_ports);\r\nsnd_iprintf(buf, "Addresses:");\r\nfor (i = 0; i < emu->num_ports; i++)\r\nsnd_iprintf(buf, " %d:%d", emu->client, emu->ports[i]);\r\nsnd_iprintf(buf, "\n");\r\nsnd_iprintf(buf, "Use Counter: %d\n", emu->used);\r\nsnd_iprintf(buf, "Max Voices: %d\n", emu->max_voices);\r\nsnd_iprintf(buf, "Allocated Voices: %d\n", emu->num_voices);\r\nif (emu->memhdr) {\r\nsnd_iprintf(buf, "Memory Size: %d\n", emu->memhdr->size);\r\nsnd_iprintf(buf, "Memory Available: %d\n", snd_util_mem_avail(emu->memhdr));\r\nsnd_iprintf(buf, "Allocated Blocks: %d\n", emu->memhdr->nblocks);\r\n} else {\r\nsnd_iprintf(buf, "Memory Size: 0\n");\r\n}\r\nif (emu->sflist) {\r\nmutex_lock(&emu->sflist->presets_mutex);\r\nsnd_iprintf(buf, "SoundFonts: %d\n", emu->sflist->fonts_size);\r\nsnd_iprintf(buf, "Instruments: %d\n", emu->sflist->zone_counter);\r\nsnd_iprintf(buf, "Samples: %d\n", emu->sflist->sample_counter);\r\nsnd_iprintf(buf, "Locked Instruments: %d\n", emu->sflist->zone_locked);\r\nsnd_iprintf(buf, "Locked Samples: %d\n", emu->sflist->sample_locked);\r\nmutex_unlock(&emu->sflist->presets_mutex);\r\n}\r\n#if 0\r\nif (emu->voices[0].state != SNDRV_EMUX_ST_OFF && emu->voices[0].ch >= 0) {\r\nstruct snd_emux_voice *vp = &emu->voices[0];\r\nsnd_iprintf(buf, "voice 0: on\n");\r\nsnd_iprintf(buf, "mod delay=%x, atkhld=%x, dcysus=%x, rel=%x\n",\r\nvp->reg.parm.moddelay,\r\nvp->reg.parm.modatkhld,\r\nvp->reg.parm.moddcysus,\r\nvp->reg.parm.modrelease);\r\nsnd_iprintf(buf, "vol delay=%x, atkhld=%x, dcysus=%x, rel=%x\n",\r\nvp->reg.parm.voldelay,\r\nvp->reg.parm.volatkhld,\r\nvp->reg.parm.voldcysus,\r\nvp->reg.parm.volrelease);\r\nsnd_iprintf(buf, "lfo1 delay=%x, lfo2 delay=%x, pefe=%x\n",\r\nvp->reg.parm.lfo1delay,\r\nvp->reg.parm.lfo2delay,\r\nvp->reg.parm.pefe);\r\nsnd_iprintf(buf, "fmmod=%x, tremfrq=%x, fm2frq2=%x\n",\r\nvp->reg.parm.fmmod,\r\nvp->reg.parm.tremfrq,\r\nvp->reg.parm.fm2frq2);\r\nsnd_iprintf(buf, "cutoff=%x, filterQ=%x, chorus=%x, reverb=%x\n",\r\nvp->reg.parm.cutoff,\r\nvp->reg.parm.filterQ,\r\nvp->reg.parm.chorus,\r\nvp->reg.parm.reverb);\r\nsnd_iprintf(buf, "avol=%x, acutoff=%x, apitch=%x\n",\r\nvp->avol, vp->acutoff, vp->apitch);\r\nsnd_iprintf(buf, "apan=%x, aaux=%x, ptarget=%x, vtarget=%x, ftarget=%x\n",\r\nvp->apan, vp->aaux,\r\nvp->ptarget,\r\nvp->vtarget,\r\nvp->ftarget);\r\nsnd_iprintf(buf, "start=%x, end=%x, loopstart=%x, loopend=%x\n",\r\nvp->reg.start, vp->reg.end, vp->reg.loopstart, vp->reg.loopend);\r\nsnd_iprintf(buf, "sample_mode=%x, rate=%x\n", vp->reg.sample_mode, vp->reg.rate_offset);\r\n}\r\n#endif\r\nmutex_unlock(&emu->register_mutex);\r\n}\r\nvoid snd_emux_proc_init(struct snd_emux *emu, struct snd_card *card, int device)\r\n{\r\nstruct snd_info_entry *entry;\r\nchar name[64];\r\nsprintf(name, "wavetableD%d", device);\r\nentry = snd_info_create_card_entry(card, name, card->proc_root);\r\nif (entry == NULL)\r\nreturn;\r\nentry->content = SNDRV_INFO_CONTENT_TEXT;\r\nentry->private_data = emu;\r\nentry->c.text.read = snd_emux_proc_info_read;\r\nif (snd_info_register(entry) < 0)\r\nsnd_info_free_entry(entry);\r\nelse\r\nemu->proc = entry;\r\n}\r\nvoid snd_emux_proc_free(struct snd_emux *emu)\r\n{\r\nsnd_info_free_entry(emu->proc);\r\nemu->proc = NULL;\r\n}
