static void mips_machine_restart(char *command)\r\n{\r\nunsigned int __iomem *softres_reg =\r\nioremap(SOFTRES_REG, sizeof(unsigned int));\r\n__raw_writel(GORESET, softres_reg);\r\n}\r\nstatic void mips_machine_halt(void)\r\n{\r\nwhile (true);\r\n}\r\nstatic void mips_machine_power_off(void)\r\n{\r\nmips_pm_suspend(PIIX4_FUNC3IO_PMCNTRL_SUS_TYP_SOFF);\r\npr_info("Failed to power down, resetting\n");\r\nmips_machine_restart(NULL);\r\n}\r\nstatic int __init mips_reboot_setup(void)\r\n{\r\n_machine_restart = mips_machine_restart;\r\n_machine_halt = mips_machine_halt;\r\npm_power_off = mips_machine_power_off;\r\nreturn 0;\r\n}
