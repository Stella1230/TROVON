void gma_get_core_freq(struct drm_device *dev)\r\n{\r\nuint32_t clock;\r\nstruct pci_dev *pci_root = pci_get_bus_and_slot(0, 0);\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\npci_write_config_dword(pci_root, 0xD0, 0xD0050300);\r\npci_read_config_dword(pci_root, 0xD4, &clock);\r\npci_dev_put(pci_root);\r\nswitch (clock & 0x07) {\r\ncase 0:\r\ndev_priv->core_freq = 100;\r\nbreak;\r\ncase 1:\r\ndev_priv->core_freq = 133;\r\nbreak;\r\ncase 2:\r\ndev_priv->core_freq = 150;\r\nbreak;\r\ncase 3:\r\ndev_priv->core_freq = 178;\r\nbreak;\r\ncase 4:\r\ndev_priv->core_freq = 200;\r\nbreak;\r\ncase 5:\r\ncase 6:\r\ncase 7:\r\ndev_priv->core_freq = 266;\r\nbreak;\r\ndefault:\r\ndev_priv->core_freq = 0;\r\n}\r\n}
