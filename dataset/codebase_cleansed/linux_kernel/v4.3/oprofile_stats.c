void oprofile_reset_stats(void)\r\n{\r\nstruct oprofile_cpu_buffer *cpu_buf;\r\nint i;\r\nfor_each_possible_cpu(i) {\r\ncpu_buf = &per_cpu(op_cpu_buffer, i);\r\ncpu_buf->sample_received = 0;\r\ncpu_buf->sample_lost_overflow = 0;\r\ncpu_buf->backtrace_aborted = 0;\r\ncpu_buf->sample_invalid_eip = 0;\r\n}\r\natomic_set(&oprofile_stats.sample_lost_no_mm, 0);\r\natomic_set(&oprofile_stats.sample_lost_no_mapping, 0);\r\natomic_set(&oprofile_stats.event_lost_overflow, 0);\r\natomic_set(&oprofile_stats.bt_lost_no_mapping, 0);\r\natomic_set(&oprofile_stats.multiplex_counter, 0);\r\n}\r\nvoid oprofile_create_stats_files(struct dentry *root)\r\n{\r\nstruct oprofile_cpu_buffer *cpu_buf;\r\nstruct dentry *cpudir;\r\nstruct dentry *dir;\r\nchar buf[10];\r\nint i;\r\ndir = oprofilefs_mkdir(root, "stats");\r\nif (!dir)\r\nreturn;\r\nfor_each_possible_cpu(i) {\r\ncpu_buf = &per_cpu(op_cpu_buffer, i);\r\nsnprintf(buf, 10, "cpu%d", i);\r\ncpudir = oprofilefs_mkdir(dir, buf);\r\noprofilefs_create_ro_ulong(cpudir, "sample_received",\r\n&cpu_buf->sample_received);\r\noprofilefs_create_ro_ulong(cpudir, "sample_lost_overflow",\r\n&cpu_buf->sample_lost_overflow);\r\noprofilefs_create_ro_ulong(cpudir, "backtrace_aborted",\r\n&cpu_buf->backtrace_aborted);\r\noprofilefs_create_ro_ulong(cpudir, "sample_invalid_eip",\r\n&cpu_buf->sample_invalid_eip);\r\n}\r\noprofilefs_create_ro_atomic(dir, "sample_lost_no_mm",\r\n&oprofile_stats.sample_lost_no_mm);\r\noprofilefs_create_ro_atomic(dir, "sample_lost_no_mapping",\r\n&oprofile_stats.sample_lost_no_mapping);\r\noprofilefs_create_ro_atomic(dir, "event_lost_overflow",\r\n&oprofile_stats.event_lost_overflow);\r\noprofilefs_create_ro_atomic(dir, "bt_lost_no_mapping",\r\n&oprofile_stats.bt_lost_no_mapping);\r\n#ifdef CONFIG_OPROFILE_EVENT_MULTIPLEX\r\noprofilefs_create_ro_atomic(dir, "multiplex_counter",\r\n&oprofile_stats.multiplex_counter);\r\n#endif\r\n}
