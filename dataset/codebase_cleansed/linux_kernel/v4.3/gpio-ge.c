static int __init gef_gpio_probe(struct platform_device *pdev)\r\n{\r\nconst struct of_device_id *of_id =\r\nof_match_device(gef_gpio_ids, &pdev->dev);\r\nstruct bgpio_chip *bgc;\r\nvoid __iomem *regs;\r\nint ret;\r\nbgc = devm_kzalloc(&pdev->dev, sizeof(*bgc), GFP_KERNEL);\r\nif (!bgc)\r\nreturn -ENOMEM;\r\nregs = of_iomap(pdev->dev.of_node, 0);\r\nif (!regs)\r\nreturn -ENOMEM;\r\nret = bgpio_init(bgc, &pdev->dev, 4, regs + GEF_GPIO_IN,\r\nregs + GEF_GPIO_OUT, NULL, NULL,\r\nregs + GEF_GPIO_DIRECT, BGPIOF_BIG_ENDIAN_BYTE_ORDER);\r\nif (ret) {\r\ndev_err(&pdev->dev, "bgpio_init failed\n");\r\ngoto err0;\r\n}\r\nbgc->gc.label = devm_kstrdup(&pdev->dev, pdev->dev.of_node->full_name,\r\nGFP_KERNEL);\r\nif (!bgc->gc.label) {\r\nret = -ENOMEM;\r\ngoto err0;\r\n}\r\nbgc->gc.base = -1;\r\nbgc->gc.ngpio = (u16)(uintptr_t)of_id->data;\r\nbgc->gc.of_gpio_n_cells = 2;\r\nbgc->gc.of_node = pdev->dev.of_node;\r\nret = gpiochip_add(&bgc->gc);\r\nif (ret)\r\ngoto err0;\r\nreturn 0;\r\nerr0:\r\niounmap(regs);\r\npr_err("%s: GPIO chip registration failed\n",\r\npdev->dev.of_node->full_name);\r\nreturn ret;\r\n}
