static int of_console_open(void)\r\n{\r\nvoid *devp;\r\nif (((devp = of_finddevice("/chosen")) != NULL)\r\n&& (of_getprop(devp, "stdout", &of_stdout_handle,\r\nsizeof(of_stdout_handle))\r\n== sizeof(of_stdout_handle))) {\r\nof_stdout_handle = be32_to_cpu(of_stdout_handle);\r\nreturn 0;\r\n}\r\nreturn -1;\r\n}\r\nstatic void of_console_write(const char *buf, int len)\r\n{\r\nof_call_prom("write", 3, 1, of_stdout_handle, buf, len);\r\n}\r\nvoid of_console_init(void)\r\n{\r\nconsole_ops.open = of_console_open;\r\nconsole_ops.write = of_console_write;\r\n}
