static unsigned int acpi_gsi_get_irq_type(int trigger, int polarity)\r\n{\r\nswitch (polarity) {\r\ncase ACPI_ACTIVE_LOW:\r\nreturn trigger == ACPI_EDGE_SENSITIVE ?\r\nIRQ_TYPE_EDGE_FALLING :\r\nIRQ_TYPE_LEVEL_LOW;\r\ncase ACPI_ACTIVE_HIGH:\r\nreturn trigger == ACPI_EDGE_SENSITIVE ?\r\nIRQ_TYPE_EDGE_RISING :\r\nIRQ_TYPE_LEVEL_HIGH;\r\ncase ACPI_ACTIVE_BOTH:\r\nif (trigger == ACPI_EDGE_SENSITIVE)\r\nreturn IRQ_TYPE_EDGE_BOTH;\r\ndefault:\r\nreturn IRQ_TYPE_NONE;\r\n}\r\n}\r\nint acpi_gsi_to_irq(u32 gsi, unsigned int *irq)\r\n{\r\n*irq = irq_find_mapping(NULL, gsi);\r\nreturn (*irq > 0) ? *irq : -EINVAL;\r\n}\r\nint acpi_register_gsi(struct device *dev, u32 gsi, int trigger,\r\nint polarity)\r\n{\r\nunsigned int irq;\r\nunsigned int irq_type = acpi_gsi_get_irq_type(trigger, polarity);\r\nirq = irq_create_mapping(NULL, gsi);\r\nif (!irq)\r\nreturn -EINVAL;\r\nif (irq_type != IRQ_TYPE_NONE &&\r\nirq_type != irq_get_trigger_type(irq))\r\nirq_set_irq_type(irq, irq_type);\r\nreturn irq;\r\n}\r\nvoid acpi_unregister_gsi(u32 gsi)\r\n{\r\nint irq = irq_find_mapping(NULL, gsi);\r\nirq_dispose_mapping(irq);\r\n}
