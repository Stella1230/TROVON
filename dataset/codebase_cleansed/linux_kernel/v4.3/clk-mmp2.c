void __init mmp2_clk_init(void)\r\n{\r\nstruct clk *clk;\r\nstruct clk *vctcxo;\r\nvoid __iomem *mpmu_base;\r\nvoid __iomem *apmu_base;\r\nvoid __iomem *apbc_base;\r\nmpmu_base = ioremap(APB_PHYS_BASE + 0x50000, SZ_4K);\r\nif (mpmu_base == NULL) {\r\npr_err("error to ioremap MPMU base\n");\r\nreturn;\r\n}\r\napmu_base = ioremap(AXI_PHYS_BASE + 0x82800, SZ_4K);\r\nif (apmu_base == NULL) {\r\npr_err("error to ioremap APMU base\n");\r\nreturn;\r\n}\r\napbc_base = ioremap(APB_PHYS_BASE + 0x15000, SZ_4K);\r\nif (apbc_base == NULL) {\r\npr_err("error to ioremap APBC base\n");\r\nreturn;\r\n}\r\nclk = clk_register_fixed_rate(NULL, "clk32", NULL, CLK_IS_ROOT, 3200);\r\nclk_register_clkdev(clk, "clk32", NULL);\r\nvctcxo = clk_register_fixed_rate(NULL, "vctcxo", NULL, CLK_IS_ROOT,\r\n26000000);\r\nclk_register_clkdev(vctcxo, "vctcxo", NULL);\r\nclk = clk_register_fixed_rate(NULL, "pll1", NULL, CLK_IS_ROOT,\r\n800000000);\r\nclk_register_clkdev(clk, "pll1", NULL);\r\nclk = clk_register_fixed_rate(NULL, "usb_pll", NULL, CLK_IS_ROOT,\r\n480000000);\r\nclk_register_clkdev(clk, "usb_pll", NULL);\r\nclk = clk_register_fixed_rate(NULL, "pll2", NULL, CLK_IS_ROOT,\r\n960000000);\r\nclk_register_clkdev(clk, "pll2", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_2", "pll1",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_2", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_4", "pll1_2",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_4", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_8", "pll1_4",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_8", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_16", "pll1_8",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_16", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_20", "pll1_4",\r\nCLK_SET_RATE_PARENT, 1, 5);\r\nclk_register_clkdev(clk, "pll1_20", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_3", "pll1",\r\nCLK_SET_RATE_PARENT, 1, 3);\r\nclk_register_clkdev(clk, "pll1_3", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_6", "pll1_3",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_6", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll1_12", "pll1_6",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll1_12", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_2", "pll2",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_2", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_4", "pll2_2",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_4", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_8", "pll2_4",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_8", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_16", "pll2_8",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_16", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_3", "pll2",\r\nCLK_SET_RATE_PARENT, 1, 3);\r\nclk_register_clkdev(clk, "pll2_3", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_6", "pll2_3",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_6", NULL);\r\nclk = clk_register_fixed_factor(NULL, "pll2_12", "pll2_6",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "pll2_12", NULL);\r\nclk = clk_register_fixed_factor(NULL, "vctcxo_2", "vctcxo",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "vctcxo_2", NULL);\r\nclk = clk_register_fixed_factor(NULL, "vctcxo_4", "vctcxo_2",\r\nCLK_SET_RATE_PARENT, 1, 2);\r\nclk_register_clkdev(clk, "vctcxo_4", NULL);\r\nclk = mmp_clk_register_factor("uart_pll", "pll1_4", 0,\r\nmpmu_base + MPMU_UART_PLL,\r\n&uart_factor_masks, uart_factor_tbl,\r\nARRAY_SIZE(uart_factor_tbl), &clk_lock);\r\nclk_set_rate(clk, 14745600);\r\nclk_register_clkdev(clk, "uart_pll", NULL);\r\nclk = mmp_clk_register_apbc("twsi0", "vctcxo",\r\napbc_base + APBC_TWSI0, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.0");\r\nclk = mmp_clk_register_apbc("twsi1", "vctcxo",\r\napbc_base + APBC_TWSI1, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.1");\r\nclk = mmp_clk_register_apbc("twsi2", "vctcxo",\r\napbc_base + APBC_TWSI2, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.2");\r\nclk = mmp_clk_register_apbc("twsi3", "vctcxo",\r\napbc_base + APBC_TWSI3, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.3");\r\nclk = mmp_clk_register_apbc("twsi4", "vctcxo",\r\napbc_base + APBC_TWSI4, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.4");\r\nclk = mmp_clk_register_apbc("twsi5", "vctcxo",\r\napbc_base + APBC_TWSI5, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-i2c.5");\r\nclk = mmp_clk_register_apbc("gpio", "vctcxo",\r\napbc_base + APBC_GPIO, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp2-gpio");\r\nclk = mmp_clk_register_apbc("kpc", "clk32",\r\napbc_base + APBC_KPC, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa27x-keypad");\r\nclk = mmp_clk_register_apbc("rtc", "clk32",\r\napbc_base + APBC_RTC, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-rtc");\r\nclk = mmp_clk_register_apbc("pwm0", "vctcxo",\r\napbc_base + APBC_PWM0, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp2-pwm.0");\r\nclk = mmp_clk_register_apbc("pwm1", "vctcxo",\r\napbc_base + APBC_PWM1, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp2-pwm.1");\r\nclk = mmp_clk_register_apbc("pwm2", "vctcxo",\r\napbc_base + APBC_PWM2, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp2-pwm.2");\r\nclk = mmp_clk_register_apbc("pwm3", "vctcxo",\r\napbc_base + APBC_PWM3, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp2-pwm.3");\r\nclk = clk_register_mux(NULL, "uart0_mux", uart_parent,\r\nARRAY_SIZE(uart_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_UART0, 4, 3, 0, &clk_lock);\r\nclk_set_parent(clk, vctcxo);\r\nclk_register_clkdev(clk, "uart_mux.0", NULL);\r\nclk = mmp_clk_register_apbc("uart0", "uart0_mux",\r\napbc_base + APBC_UART0, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-uart.0");\r\nclk = clk_register_mux(NULL, "uart1_mux", uart_parent,\r\nARRAY_SIZE(uart_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_UART1, 4, 3, 0, &clk_lock);\r\nclk_set_parent(clk, vctcxo);\r\nclk_register_clkdev(clk, "uart_mux.1", NULL);\r\nclk = mmp_clk_register_apbc("uart1", "uart1_mux",\r\napbc_base + APBC_UART1, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-uart.1");\r\nclk = clk_register_mux(NULL, "uart2_mux", uart_parent,\r\nARRAY_SIZE(uart_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_UART2, 4, 3, 0, &clk_lock);\r\nclk_set_parent(clk, vctcxo);\r\nclk_register_clkdev(clk, "uart_mux.2", NULL);\r\nclk = mmp_clk_register_apbc("uart2", "uart2_mux",\r\napbc_base + APBC_UART2, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-uart.2");\r\nclk = clk_register_mux(NULL, "uart3_mux", uart_parent,\r\nARRAY_SIZE(uart_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_UART3, 4, 3, 0, &clk_lock);\r\nclk_set_parent(clk, vctcxo);\r\nclk_register_clkdev(clk, "uart_mux.3", NULL);\r\nclk = mmp_clk_register_apbc("uart3", "uart3_mux",\r\napbc_base + APBC_UART3, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "pxa2xx-uart.3");\r\nclk = clk_register_mux(NULL, "ssp0_mux", ssp_parent,\r\nARRAY_SIZE(ssp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_SSP0, 4, 3, 0, &clk_lock);\r\nclk_register_clkdev(clk, "uart_mux.0", NULL);\r\nclk = mmp_clk_register_apbc("ssp0", "ssp0_mux",\r\napbc_base + APBC_SSP0, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-ssp.0");\r\nclk = clk_register_mux(NULL, "ssp1_mux", ssp_parent,\r\nARRAY_SIZE(ssp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_SSP1, 4, 3, 0, &clk_lock);\r\nclk_register_clkdev(clk, "ssp_mux.1", NULL);\r\nclk = mmp_clk_register_apbc("ssp1", "ssp1_mux",\r\napbc_base + APBC_SSP1, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-ssp.1");\r\nclk = clk_register_mux(NULL, "ssp2_mux", ssp_parent,\r\nARRAY_SIZE(ssp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_SSP2, 4, 3, 0, &clk_lock);\r\nclk_register_clkdev(clk, "ssp_mux.2", NULL);\r\nclk = mmp_clk_register_apbc("ssp2", "ssp2_mux",\r\napbc_base + APBC_SSP2, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-ssp.2");\r\nclk = clk_register_mux(NULL, "ssp3_mux", ssp_parent,\r\nARRAY_SIZE(ssp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napbc_base + APBC_SSP3, 4, 3, 0, &clk_lock);\r\nclk_register_clkdev(clk, "ssp_mux.3", NULL);\r\nclk = mmp_clk_register_apbc("ssp3", "ssp3_mux",\r\napbc_base + APBC_SSP3, 10, 0, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-ssp.3");\r\nclk = clk_register_mux(NULL, "sdh_mux", sdh_parent,\r\nARRAY_SIZE(sdh_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napmu_base + APMU_SDH0, 8, 2, 0, &clk_lock);\r\nclk_register_clkdev(clk, "sdh_mux", NULL);\r\nclk = clk_register_divider(NULL, "sdh_div", "sdh_mux",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_SDH0,\r\n10, 4, CLK_DIVIDER_ONE_BASED, &clk_lock);\r\nclk_register_clkdev(clk, "sdh_div", NULL);\r\nclk = mmp_clk_register_apmu("sdh0", "sdh_div", apmu_base + APMU_SDH0,\r\n0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "sdhci-pxav3.0");\r\nclk = mmp_clk_register_apmu("sdh1", "sdh_div", apmu_base + APMU_SDH1,\r\n0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "sdhci-pxav3.1");\r\nclk = mmp_clk_register_apmu("sdh2", "sdh_div", apmu_base + APMU_SDH2,\r\n0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "sdhci-pxav3.2");\r\nclk = mmp_clk_register_apmu("sdh3", "sdh_div", apmu_base + APMU_SDH3,\r\n0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "sdhci-pxav3.3");\r\nclk = mmp_clk_register_apmu("usb", "usb_pll", apmu_base + APMU_USB,\r\n0x9, &clk_lock);\r\nclk_register_clkdev(clk, "usb_clk", NULL);\r\nclk = clk_register_mux(NULL, "disp0_mux", disp_parent,\r\nARRAY_SIZE(disp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napmu_base + APMU_DISP0, 6, 2, 0, &clk_lock);\r\nclk_register_clkdev(clk, "disp_mux.0", NULL);\r\nclk = clk_register_divider(NULL, "disp0_div", "disp0_mux",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_DISP0,\r\n8, 4, CLK_DIVIDER_ONE_BASED, &clk_lock);\r\nclk_register_clkdev(clk, "disp_div.0", NULL);\r\nclk = mmp_clk_register_apmu("disp0", "disp0_div",\r\napmu_base + APMU_DISP0, 0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-disp.0");\r\nclk = clk_register_divider(NULL, "disp0_sphy_div", "disp0_mux", 0,\r\napmu_base + APMU_DISP0, 15, 5, 0, &clk_lock);\r\nclk_register_clkdev(clk, "disp_sphy_div.0", NULL);\r\nclk = mmp_clk_register_apmu("disp0_sphy", "disp0_sphy_div",\r\napmu_base + APMU_DISP0, 0x1024, &clk_lock);\r\nclk_register_clkdev(clk, "disp_sphy.0", NULL);\r\nclk = clk_register_mux(NULL, "disp1_mux", disp_parent,\r\nARRAY_SIZE(disp_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napmu_base + APMU_DISP1, 6, 2, 0, &clk_lock);\r\nclk_register_clkdev(clk, "disp_mux.1", NULL);\r\nclk = clk_register_divider(NULL, "disp1_div", "disp1_mux",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_DISP1,\r\n8, 4, CLK_DIVIDER_ONE_BASED, &clk_lock);\r\nclk_register_clkdev(clk, "disp_div.1", NULL);\r\nclk = mmp_clk_register_apmu("disp1", "disp1_div",\r\napmu_base + APMU_DISP1, 0x1b, &clk_lock);\r\nclk_register_clkdev(clk, NULL, "mmp-disp.1");\r\nclk = mmp_clk_register_apmu("ccic_arbiter", "vctcxo",\r\napmu_base + APMU_CCIC0, 0x1800, &clk_lock);\r\nclk_register_clkdev(clk, "ccic_arbiter", NULL);\r\nclk = clk_register_mux(NULL, "ccic0_mux", ccic_parent,\r\nARRAY_SIZE(ccic_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napmu_base + APMU_CCIC0, 6, 2, 0, &clk_lock);\r\nclk_register_clkdev(clk, "ccic_mux.0", NULL);\r\nclk = clk_register_divider(NULL, "ccic0_div", "ccic0_mux",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_CCIC0,\r\n17, 4, CLK_DIVIDER_ONE_BASED, &clk_lock);\r\nclk_register_clkdev(clk, "ccic_div.0", NULL);\r\nclk = mmp_clk_register_apmu("ccic0", "ccic0_div",\r\napmu_base + APMU_CCIC0, 0x1b, &clk_lock);\r\nclk_register_clkdev(clk, "fnclk", "mmp-ccic.0");\r\nclk = mmp_clk_register_apmu("ccic0_phy", "ccic0_div",\r\napmu_base + APMU_CCIC0, 0x24, &clk_lock);\r\nclk_register_clkdev(clk, "phyclk", "mmp-ccic.0");\r\nclk = clk_register_divider(NULL, "ccic0_sphy_div", "ccic0_div",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_CCIC0,\r\n10, 5, 0, &clk_lock);\r\nclk_register_clkdev(clk, "sphyclk_div", "mmp-ccic.0");\r\nclk = mmp_clk_register_apmu("ccic0_sphy", "ccic0_sphy_div",\r\napmu_base + APMU_CCIC0, 0x300, &clk_lock);\r\nclk_register_clkdev(clk, "sphyclk", "mmp-ccic.0");\r\nclk = clk_register_mux(NULL, "ccic1_mux", ccic_parent,\r\nARRAY_SIZE(ccic_parent),\r\nCLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT,\r\napmu_base + APMU_CCIC1, 6, 2, 0, &clk_lock);\r\nclk_register_clkdev(clk, "ccic_mux.1", NULL);\r\nclk = clk_register_divider(NULL, "ccic1_div", "ccic1_mux",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_CCIC1,\r\n16, 4, CLK_DIVIDER_ONE_BASED, &clk_lock);\r\nclk_register_clkdev(clk, "ccic_div.1", NULL);\r\nclk = mmp_clk_register_apmu("ccic1", "ccic1_div",\r\napmu_base + APMU_CCIC1, 0x1b, &clk_lock);\r\nclk_register_clkdev(clk, "fnclk", "mmp-ccic.1");\r\nclk = mmp_clk_register_apmu("ccic1_phy", "ccic1_div",\r\napmu_base + APMU_CCIC1, 0x24, &clk_lock);\r\nclk_register_clkdev(clk, "phyclk", "mmp-ccic.1");\r\nclk = clk_register_divider(NULL, "ccic1_sphy_div", "ccic1_div",\r\nCLK_SET_RATE_PARENT, apmu_base + APMU_CCIC1,\r\n10, 5, 0, &clk_lock);\r\nclk_register_clkdev(clk, "sphyclk_div", "mmp-ccic.1");\r\nclk = mmp_clk_register_apmu("ccic1_sphy", "ccic1_sphy_div",\r\napmu_base + APMU_CCIC1, 0x300, &clk_lock);\r\nclk_register_clkdev(clk, "sphyclk", "mmp-ccic.1");\r\n}
