void cb_out_1(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *cbdata)\r\n{\r\nstruct sk_buff *skb;\r\nint len;\r\nushort refnum;\r\n#ifdef DEBUG\r\nprintk(KERN_DEBUG "Called Party Number: %s\n",\r\ncbdata->data.setup.CalledPN);\r\n#endif\r\nif ((len = capi_conn_req(cbdata->data.setup.CalledPN, &skb,\r\nchan->proto)) < 0)\r\n{\r\nprintk("capi_conn_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->callref = 0;\r\nchan->layer2link = 0;\r\nchan->snum = 0;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_CONN_REQ, refnum, skb, len);\r\n}\r\nvoid cb_out_2(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nisdn_ctrl ictl;\r\nstruct sk_buff *skb;\r\nint len;\r\nushort refnum;\r\nif ((len = capi_conn_active_resp(chan, &skb)) < 0)\r\n{\r\nprintk("capi_conn_active_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_CONN_ACTV_RESP, refnum, skb, len);\r\nictl.command = ISDN_STAT_DCONN;\r\nictl.driver = dev->id;\r\nictl.arg = chan->id;\r\ndev->dev_if->statcallb(&ictl);\r\nif ((len = capi_select_proto_req(chan, &skb, 1 )) < 0) {\r\nprintk("capi_select_proto_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_SELP_REQ, refnum, skb, len);\r\n}\r\nvoid cb_in_1(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *cbdata)\r\n{\r\nisdn_ctrl ictl;\r\nunsigned short refnum;\r\nstruct sk_buff *skb;\r\nint len;\r\nictl.command = ISDN_STAT_ICALL;\r\nictl.driver = dev->id;\r\nictl.arg = chan->id;\r\nif (cbdata->data.setup.CallingPN == NULL) {\r\nprintk(KERN_DEBUG "NULL CallingPN to phone; using 0\n");\r\nstrcpy(ictl.parm.setup.phone, "0");\r\n}\r\nelse {\r\nstrcpy(ictl.parm.setup.phone, cbdata->data.setup.CallingPN);\r\n}\r\nif (cbdata->data.setup.CalledPN == NULL) {\r\nprintk(KERN_DEBUG "NULL CalledPN to eazmsn; using 0\n");\r\nstrcpy(ictl.parm.setup.eazmsn, "0");\r\n}\r\nelse {\r\nstrcpy(ictl.parm.setup.eazmsn, cbdata->data.setup.CalledPN);\r\n}\r\nictl.parm.setup.si1 = 7;\r\nictl.parm.setup.si2 = 0;\r\nictl.parm.setup.plan = 0;\r\nictl.parm.setup.screen = 0;\r\n#ifdef DEBUG\r\nprintk(KERN_DEBUG "statstr: %s\n", ictl.num);\r\n#endif\r\ndev->dev_if->statcallb(&ictl);\r\nif ((len = capi_conn_resp(chan, &skb)) < 0) {\r\nprintk(KERN_DEBUG "capi_conn_resp failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_CONN_RESP, refnum, skb, len);\r\n}\r\nvoid cb_in_2(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nunsigned short refnum;\r\nstruct sk_buff *skb;\r\nint len;\r\nif ((len = capi_conn_active_req(chan, &skb)) < 0) {\r\nprintk(KERN_DEBUG "capi_conn_active_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\nprintk(KERN_DEBUG "sending MSG_CONN_ACTV_REQ\n");\r\npcbit_l2_write(dev, MSG_CONN_ACTV_REQ, refnum, skb, len);\r\n}\r\nvoid cb_in_3(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nunsigned short refnum;\r\nstruct sk_buff *skb;\r\nint len;\r\nif ((len = capi_select_proto_req(chan, &skb, 0 )) < 0)\r\n{\r\nprintk("capi_select_proto_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_SELP_REQ, refnum, skb, len);\r\n}\r\nvoid cb_disc_1(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nstruct sk_buff *skb;\r\nint len;\r\nushort refnum;\r\nisdn_ctrl ictl;\r\nif ((len = capi_disc_resp(chan, &skb)) < 0) {\r\nprintk("capi_disc_resp failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_DISC_RESP, refnum, skb, len);\r\nictl.command = ISDN_STAT_BHUP;\r\nictl.driver = dev->id;\r\nictl.arg = chan->id;\r\ndev->dev_if->statcallb(&ictl);\r\n}\r\nvoid cb_disc_2(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nstruct sk_buff *skb;\r\nint len;\r\nushort refnum;\r\nif ((len = capi_disc_req(chan->callref, &skb, CAUSE_NORMAL)) < 0)\r\n{\r\nprintk("capi_disc_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_DISC_REQ, refnum, skb, len);\r\n}\r\nvoid cb_disc_3(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nisdn_ctrl ictl;\r\nictl.command = ISDN_STAT_BHUP;\r\nictl.driver = dev->id;\r\nictl.arg = chan->id;\r\ndev->dev_if->statcallb(&ictl);\r\n}\r\nvoid cb_notdone(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\n}\r\nvoid cb_selp_1(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nstruct sk_buff *skb;\r\nint len;\r\nushort refnum;\r\nif ((len = capi_activate_transp_req(chan, &skb)) < 0)\r\n{\r\nprintk("capi_conn_activate_transp_req failed\n");\r\nreturn;\r\n}\r\nrefnum = last_ref_num++ & 0x7fffU;\r\nchan->s_refnum = refnum;\r\npcbit_l2_write(dev, MSG_ACT_TRANSP_REQ, refnum, skb, len);\r\n}\r\nvoid cb_open(struct pcbit_dev *dev, struct pcbit_chan *chan,\r\nstruct callb_data *data)\r\n{\r\nisdn_ctrl ictl;\r\nictl.command = ISDN_STAT_BCONN;\r\nictl.driver = dev->id;\r\nictl.arg = chan->id;\r\ndev->dev_if->statcallb(&ictl);\r\n}
