static void __hw_param_copy(void *dst, void *src)\r\n{\r\nmemcpy(dst, src, FIMC_IS_PARAM_MAX_SIZE);\r\n}\r\nstatic void __fimc_is_hw_update_param_global_shotmode(struct fimc_is *is)\r\n{\r\nstruct param_global_shotmode *dst, *src;\r\ndst = &is->is_p_region->parameter.global.shotmode;\r\nsrc = &is->config[is->config_index].global.shotmode;\r\n__hw_param_copy(dst, src);\r\n}\r\nstatic void __fimc_is_hw_update_param_sensor_framerate(struct fimc_is *is)\r\n{\r\nstruct param_sensor_framerate *dst, *src;\r\ndst = &is->is_p_region->parameter.sensor.frame_rate;\r\nsrc = &is->config[is->config_index].sensor.frame_rate;\r\n__hw_param_copy(dst, src);\r\n}\r\nint __fimc_is_hw_update_param(struct fimc_is *is, u32 offset)\r\n{\r\nstruct is_param_region *par = &is->is_p_region->parameter;\r\nstruct chain_config *cfg = &is->config[is->config_index];\r\nswitch (offset) {\r\ncase PARAM_ISP_CONTROL:\r\n__hw_param_copy(&par->isp.control, &cfg->isp.control);\r\nbreak;\r\ncase PARAM_ISP_OTF_INPUT:\r\n__hw_param_copy(&par->isp.otf_input, &cfg->isp.otf_input);\r\nbreak;\r\ncase PARAM_ISP_DMA1_INPUT:\r\n__hw_param_copy(&par->isp.dma1_input, &cfg->isp.dma1_input);\r\nbreak;\r\ncase PARAM_ISP_DMA2_INPUT:\r\n__hw_param_copy(&par->isp.dma2_input, &cfg->isp.dma2_input);\r\nbreak;\r\ncase PARAM_ISP_AA:\r\n__hw_param_copy(&par->isp.aa, &cfg->isp.aa);\r\nbreak;\r\ncase PARAM_ISP_FLASH:\r\n__hw_param_copy(&par->isp.flash, &cfg->isp.flash);\r\nbreak;\r\ncase PARAM_ISP_AWB:\r\n__hw_param_copy(&par->isp.awb, &cfg->isp.awb);\r\nbreak;\r\ncase PARAM_ISP_IMAGE_EFFECT:\r\n__hw_param_copy(&par->isp.effect, &cfg->isp.effect);\r\nbreak;\r\ncase PARAM_ISP_ISO:\r\n__hw_param_copy(&par->isp.iso, &cfg->isp.iso);\r\nbreak;\r\ncase PARAM_ISP_ADJUST:\r\n__hw_param_copy(&par->isp.adjust, &cfg->isp.adjust);\r\nbreak;\r\ncase PARAM_ISP_METERING:\r\n__hw_param_copy(&par->isp.metering, &cfg->isp.metering);\r\nbreak;\r\ncase PARAM_ISP_AFC:\r\n__hw_param_copy(&par->isp.afc, &cfg->isp.afc);\r\nbreak;\r\ncase PARAM_ISP_OTF_OUTPUT:\r\n__hw_param_copy(&par->isp.otf_output, &cfg->isp.otf_output);\r\nbreak;\r\ncase PARAM_ISP_DMA1_OUTPUT:\r\n__hw_param_copy(&par->isp.dma1_output, &cfg->isp.dma1_output);\r\nbreak;\r\ncase PARAM_ISP_DMA2_OUTPUT:\r\n__hw_param_copy(&par->isp.dma2_output, &cfg->isp.dma2_output);\r\nbreak;\r\ncase PARAM_DRC_CONTROL:\r\n__hw_param_copy(&par->drc.control, &cfg->drc.control);\r\nbreak;\r\ncase PARAM_DRC_OTF_INPUT:\r\n__hw_param_copy(&par->drc.otf_input, &cfg->drc.otf_input);\r\nbreak;\r\ncase PARAM_DRC_DMA_INPUT:\r\n__hw_param_copy(&par->drc.dma_input, &cfg->drc.dma_input);\r\nbreak;\r\ncase PARAM_DRC_OTF_OUTPUT:\r\n__hw_param_copy(&par->drc.otf_output, &cfg->drc.otf_output);\r\nbreak;\r\ncase PARAM_FD_CONTROL:\r\n__hw_param_copy(&par->fd.control, &cfg->fd.control);\r\nbreak;\r\ncase PARAM_FD_OTF_INPUT:\r\n__hw_param_copy(&par->fd.otf_input, &cfg->fd.otf_input);\r\nbreak;\r\ncase PARAM_FD_DMA_INPUT:\r\n__hw_param_copy(&par->fd.dma_input, &cfg->fd.dma_input);\r\nbreak;\r\ncase PARAM_FD_CONFIG:\r\n__hw_param_copy(&par->fd.config, &cfg->fd.config);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nunsigned int __get_pending_param_count(struct fimc_is *is)\r\n{\r\nstruct chain_config *config = &is->config[is->config_index];\r\nunsigned long flags;\r\nunsigned int count;\r\nspin_lock_irqsave(&is->slock, flags);\r\ncount = hweight32(config->p_region_index[0]);\r\ncount += hweight32(config->p_region_index[1]);\r\nspin_unlock_irqrestore(&is->slock, flags);\r\nreturn count;\r\n}\r\nint __is_hw_update_params(struct fimc_is *is)\r\n{\r\nunsigned long *p_index;\r\nint i, id, ret = 0;\r\nid = is->config_index;\r\np_index = &is->config[id].p_region_index[0];\r\nif (test_bit(PARAM_GLOBAL_SHOTMODE, p_index))\r\n__fimc_is_hw_update_param_global_shotmode(is);\r\nif (test_bit(PARAM_SENSOR_FRAME_RATE, p_index))\r\n__fimc_is_hw_update_param_sensor_framerate(is);\r\nfor (i = PARAM_ISP_CONTROL; i < PARAM_DRC_CONTROL; i++) {\r\nif (test_bit(i, p_index))\r\nret = __fimc_is_hw_update_param(is, i);\r\n}\r\nfor (i = PARAM_DRC_CONTROL; i < PARAM_SCALERC_CONTROL; i++) {\r\nif (test_bit(i, p_index))\r\nret = __fimc_is_hw_update_param(is, i);\r\n}\r\nfor (i = PARAM_FD_CONTROL; i <= PARAM_FD_CONFIG; i++) {\r\nif (test_bit(i, p_index))\r\nret = __fimc_is_hw_update_param(is, i);\r\n}\r\nreturn ret;\r\n}\r\nvoid __is_get_frame_size(struct fimc_is *is, struct v4l2_mbus_framefmt *mf)\r\n{\r\nstruct isp_param *isp;\r\nisp = &is->config[is->config_index].isp;\r\nmf->width = isp->otf_input.width;\r\nmf->height = isp->otf_input.height;\r\n}\r\nvoid __is_set_frame_size(struct fimc_is *is, struct v4l2_mbus_framefmt *mf)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nstruct drc_param *drc;\r\nstruct fd_param *fd;\r\nisp = &is->config[index].isp;\r\ndrc = &is->config[index].drc;\r\nfd = &is->config[index].fd;\r\nisp->otf_input.width = mf->width;\r\nisp->otf_input.height = mf->height;\r\nisp->otf_output.width = mf->width;\r\nisp->otf_output.height = mf->height;\r\ndrc->otf_input.width = mf->width;\r\ndrc->otf_input.height = mf->height;\r\ndrc->otf_output.width = mf->width;\r\ndrc->otf_output.height = mf->height;\r\nfd->otf_input.width = mf->width;\r\nfd->otf_input.height = mf->height;\r\nif (test_bit(PARAM_ISP_OTF_INPUT,\r\n&is->config[index].p_region_index[0]))\r\nreturn;\r\nfimc_is_set_param_bit(is, PARAM_ISP_OTF_INPUT);\r\nfimc_is_set_param_bit(is, PARAM_ISP_OTF_OUTPUT);\r\nfimc_is_set_param_bit(is, PARAM_DRC_OTF_INPUT);\r\nfimc_is_set_param_bit(is, PARAM_DRC_OTF_OUTPUT);\r\nfimc_is_set_param_bit(is, PARAM_FD_OTF_INPUT);\r\n}\r\nint fimc_is_hw_get_sensor_max_framerate(struct fimc_is *is)\r\n{\r\nswitch (is->sensor->drvdata->id) {\r\ncase FIMC_IS_SENSOR_ID_S5K6A3:\r\nreturn 30;\r\ndefault:\r\nreturn 15;\r\n}\r\n}\r\nvoid __is_set_sensor(struct fimc_is *is, int fps)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct sensor_param *sensor;\r\nstruct isp_param *isp;\r\nsensor = &is->config[index].sensor;\r\nisp = &is->config[index].isp;\r\nif (fps == 0) {\r\nsensor->frame_rate.frame_rate =\r\nfimc_is_hw_get_sensor_max_framerate(is);\r\nisp->otf_input.frametime_min = 0;\r\nisp->otf_input.frametime_max = 66666;\r\n} else {\r\nsensor->frame_rate.frame_rate = fps;\r\nisp->otf_input.frametime_min = 0;\r\nisp->otf_input.frametime_max = (u32)1000000 / fps;\r\n}\r\nfimc_is_set_param_bit(is, PARAM_SENSOR_FRAME_RATE);\r\nfimc_is_set_param_bit(is, PARAM_ISP_OTF_INPUT);\r\n}\r\nstatic void __maybe_unused __is_set_init_isp_aa(struct fimc_is *is)\r\n{\r\nstruct isp_param *isp;\r\nisp = &is->config[is->config_index].isp;\r\nisp->aa.cmd = ISP_AA_COMMAND_START;\r\nisp->aa.target = ISP_AA_TARGET_AF | ISP_AA_TARGET_AE |\r\nISP_AA_TARGET_AWB;\r\nisp->aa.mode = 0;\r\nisp->aa.scene = 0;\r\nisp->aa.sleep = 0;\r\nisp->aa.face = 0;\r\nisp->aa.touch_x = 0;\r\nisp->aa.touch_y = 0;\r\nisp->aa.manual_af_setting = 0;\r\nisp->aa.err = ISP_AF_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_AA);\r\n}\r\nvoid __is_set_isp_flash(struct fimc_is *is, u32 cmd, u32 redeye)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp = &is->config[index].isp;\r\nisp->flash.cmd = cmd;\r\nisp->flash.redeye = redeye;\r\nisp->flash.err = ISP_FLASH_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_FLASH);\r\n}\r\nvoid __is_set_isp_awb(struct fimc_is *is, u32 cmd, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nisp = &is->config[index].isp;\r\nisp->awb.cmd = cmd;\r\nisp->awb.illumination = val;\r\nisp->awb.err = ISP_AWB_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_AWB);\r\n}\r\nvoid __is_set_isp_effect(struct fimc_is *is, u32 cmd)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nisp = &is->config[index].isp;\r\nisp->effect.cmd = cmd;\r\nisp->effect.err = ISP_IMAGE_EFFECT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_IMAGE_EFFECT);\r\n}\r\nvoid __is_set_isp_iso(struct fimc_is *is, u32 cmd, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nisp = &is->config[index].isp;\r\nisp->iso.cmd = cmd;\r\nisp->iso.value = val;\r\nisp->iso.err = ISP_ISO_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_ISO);\r\n}\r\nvoid __is_set_isp_adjust(struct fimc_is *is, u32 cmd, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nunsigned long *p_index;\r\nstruct isp_param *isp;\r\np_index = &is->config[index].p_region_index[0];\r\nisp = &is->config[index].isp;\r\nswitch (cmd) {\r\ncase ISP_ADJUST_COMMAND_MANUAL_CONTRAST:\r\nisp->adjust.contrast = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_MANUAL_SATURATION:\r\nisp->adjust.saturation = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_MANUAL_SHARPNESS:\r\nisp->adjust.sharpness = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_MANUAL_EXPOSURE:\r\nisp->adjust.exposure = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_MANUAL_BRIGHTNESS:\r\nisp->adjust.brightness = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_MANUAL_HUE:\r\nisp->adjust.hue = val;\r\nbreak;\r\ncase ISP_ADJUST_COMMAND_AUTO:\r\nisp->adjust.contrast = 0;\r\nisp->adjust.saturation = 0;\r\nisp->adjust.sharpness = 0;\r\nisp->adjust.exposure = 0;\r\nisp->adjust.brightness = 0;\r\nisp->adjust.hue = 0;\r\nbreak;\r\n}\r\nif (!test_bit(PARAM_ISP_ADJUST, p_index)) {\r\nisp->adjust.cmd = cmd;\r\nisp->adjust.err = ISP_ADJUST_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_ADJUST);\r\n} else {\r\nisp->adjust.cmd |= cmd;\r\n}\r\n}\r\nvoid __is_set_isp_metering(struct fimc_is *is, u32 id, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[0];\r\nisp = &is->config[index].isp;\r\nswitch (id) {\r\ncase IS_METERING_CONFIG_CMD:\r\nisp->metering.cmd = val;\r\nbreak;\r\ncase IS_METERING_CONFIG_WIN_POS_X:\r\nisp->metering.win_pos_x = val;\r\nbreak;\r\ncase IS_METERING_CONFIG_WIN_POS_Y:\r\nisp->metering.win_pos_y = val;\r\nbreak;\r\ncase IS_METERING_CONFIG_WIN_WIDTH:\r\nisp->metering.win_width = val;\r\nbreak;\r\ncase IS_METERING_CONFIG_WIN_HEIGHT:\r\nisp->metering.win_height = val;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nif (!test_bit(PARAM_ISP_METERING, p_index)) {\r\nisp->metering.err = ISP_METERING_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_METERING);\r\n}\r\n}\r\nvoid __is_set_isp_afc(struct fimc_is *is, u32 cmd, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct isp_param *isp;\r\nisp = &is->config[index].isp;\r\nisp->afc.cmd = cmd;\r\nisp->afc.manual = val;\r\nisp->afc.err = ISP_AFC_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_AFC);\r\n}\r\nvoid __is_set_drc_control(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct drc_param *drc;\r\ndrc = &is->config[index].drc;\r\ndrc->control.bypass = val;\r\nfimc_is_set_param_bit(is, PARAM_DRC_CONTROL);\r\n}\r\nvoid __is_set_fd_control(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->control.cmd = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index))\r\nfimc_is_set_param_bit(is, PARAM_FD_CONTROL);\r\n}\r\nvoid __is_set_fd_config_maxface(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.max_number = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_MAXIMUM_NUMBER;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_MAXIMUM_NUMBER;\r\n}\r\n}\r\nvoid __is_set_fd_config_rollangle(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.roll_angle = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_ROLL_ANGLE;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_ROLL_ANGLE;\r\n}\r\n}\r\nvoid __is_set_fd_config_yawangle(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.yaw_angle = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_YAW_ANGLE;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_YAW_ANGLE;\r\n}\r\n}\r\nvoid __is_set_fd_config_smilemode(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.smile_mode = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_SMILE_MODE;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_SMILE_MODE;\r\n}\r\n}\r\nvoid __is_set_fd_config_blinkmode(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.blink_mode = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_BLINK_MODE;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_BLINK_MODE;\r\n}\r\n}\r\nvoid __is_set_fd_config_eyedetect(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.eye_detect = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_EYES_DETECT;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_EYES_DETECT;\r\n}\r\n}\r\nvoid __is_set_fd_config_mouthdetect(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.mouth_detect = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_MOUTH_DETECT;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_MOUTH_DETECT;\r\n}\r\n}\r\nvoid __is_set_fd_config_orientation(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.orientation = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_ORIENTATION;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_ORIENTATION;\r\n}\r\n}\r\nvoid __is_set_fd_config_orientation_val(struct fimc_is *is, u32 val)\r\n{\r\nunsigned int index = is->config_index;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\np_index = &is->config[index].p_region_index[1];\r\nfd = &is->config[index].fd;\r\nfd->config.orientation_value = val;\r\nif (!test_bit((PARAM_FD_CONFIG - 32), p_index)) {\r\nfd->config.cmd = FD_CONFIG_COMMAND_ORIENTATION_VALUE;\r\nfd->config.err = ERROR_FD_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_CONFIG);\r\n} else {\r\nfd->config.cmd |= FD_CONFIG_COMMAND_ORIENTATION_VALUE;\r\n}\r\n}\r\nvoid fimc_is_set_initial_params(struct fimc_is *is)\r\n{\r\nstruct global_param *global;\r\nstruct isp_param *isp;\r\nstruct drc_param *drc;\r\nstruct fd_param *fd;\r\nunsigned long *p_index;\r\nunsigned int index;\r\nindex = is->config_index;\r\nglobal = &is->config[index].global;\r\nisp = &is->config[index].isp;\r\ndrc = &is->config[index].drc;\r\nfd = &is->config[index].fd;\r\np_index = &is->config[index].p_region_index[0];\r\nglobal->shotmode.cmd = 1;\r\nfimc_is_set_param_bit(is, PARAM_GLOBAL_SHOTMODE);\r\nisp->control.cmd = CONTROL_COMMAND_START;\r\nisp->control.bypass = CONTROL_BYPASS_DISABLE;\r\nisp->control.err = CONTROL_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_CONTROL);\r\nisp->otf_input.cmd = OTF_INPUT_COMMAND_ENABLE;\r\nif (!test_bit(PARAM_ISP_OTF_INPUT, p_index)) {\r\nisp->otf_input.width = DEFAULT_PREVIEW_STILL_WIDTH;\r\nisp->otf_input.height = DEFAULT_PREVIEW_STILL_HEIGHT;\r\nfimc_is_set_param_bit(is, PARAM_ISP_OTF_INPUT);\r\n}\r\nif (is->sensor->test_pattern)\r\nisp->otf_input.format = OTF_INPUT_FORMAT_STRGEN_COLORBAR_BAYER;\r\nelse\r\nisp->otf_input.format = OTF_INPUT_FORMAT_BAYER;\r\nisp->otf_input.bitwidth = 10;\r\nisp->otf_input.order = OTF_INPUT_ORDER_BAYER_GR_BG;\r\nisp->otf_input.crop_offset_x = 0;\r\nisp->otf_input.crop_offset_y = 0;\r\nisp->otf_input.err = OTF_INPUT_ERROR_NONE;\r\nisp->dma1_input.cmd = DMA_INPUT_COMMAND_DISABLE;\r\nisp->dma1_input.width = 0;\r\nisp->dma1_input.height = 0;\r\nisp->dma1_input.format = 0;\r\nisp->dma1_input.bitwidth = 0;\r\nisp->dma1_input.plane = 0;\r\nisp->dma1_input.order = 0;\r\nisp->dma1_input.buffer_number = 0;\r\nisp->dma1_input.width = 0;\r\nisp->dma1_input.err = DMA_INPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_DMA1_INPUT);\r\nisp->dma2_input.cmd = DMA_INPUT_COMMAND_DISABLE;\r\nisp->dma2_input.width = 0;\r\nisp->dma2_input.height = 0;\r\nisp->dma2_input.format = 0;\r\nisp->dma2_input.bitwidth = 0;\r\nisp->dma2_input.plane = 0;\r\nisp->dma2_input.order = 0;\r\nisp->dma2_input.buffer_number = 0;\r\nisp->dma2_input.width = 0;\r\nisp->dma2_input.err = DMA_INPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_DMA2_INPUT);\r\nisp->aa.cmd = ISP_AA_COMMAND_START;\r\nisp->aa.target = ISP_AA_TARGET_AE | ISP_AA_TARGET_AWB;\r\nfimc_is_set_param_bit(is, PARAM_ISP_AA);\r\nif (!test_bit(PARAM_ISP_FLASH, p_index))\r\n__is_set_isp_flash(is, ISP_FLASH_COMMAND_DISABLE,\r\nISP_FLASH_REDEYE_DISABLE);\r\nif (!test_bit(PARAM_ISP_AWB, p_index))\r\n__is_set_isp_awb(is, ISP_AWB_COMMAND_AUTO, 0);\r\nif (!test_bit(PARAM_ISP_IMAGE_EFFECT, p_index))\r\n__is_set_isp_effect(is, ISP_IMAGE_EFFECT_DISABLE);\r\nif (!test_bit(PARAM_ISP_ISO, p_index))\r\n__is_set_isp_iso(is, ISP_ISO_COMMAND_AUTO, 0);\r\nif (!test_bit(PARAM_ISP_ADJUST, p_index)) {\r\n__is_set_isp_adjust(is, ISP_ADJUST_COMMAND_MANUAL_CONTRAST, 0);\r\n__is_set_isp_adjust(is,\r\nISP_ADJUST_COMMAND_MANUAL_SATURATION, 0);\r\n__is_set_isp_adjust(is, ISP_ADJUST_COMMAND_MANUAL_SHARPNESS, 0);\r\n__is_set_isp_adjust(is, ISP_ADJUST_COMMAND_MANUAL_EXPOSURE, 0);\r\n__is_set_isp_adjust(is,\r\nISP_ADJUST_COMMAND_MANUAL_BRIGHTNESS, 0);\r\n__is_set_isp_adjust(is, ISP_ADJUST_COMMAND_MANUAL_HUE, 0);\r\n}\r\nif (!test_bit(PARAM_ISP_METERING, p_index)) {\r\n__is_set_isp_metering(is, 0, ISP_METERING_COMMAND_CENTER);\r\n__is_set_isp_metering(is, 1, 0);\r\n__is_set_isp_metering(is, 2, 0);\r\n__is_set_isp_metering(is, 3, 0);\r\n__is_set_isp_metering(is, 4, 0);\r\n}\r\nif (!test_bit(PARAM_ISP_AFC, p_index))\r\n__is_set_isp_afc(is, ISP_AFC_COMMAND_AUTO, 0);\r\nisp->otf_output.cmd = OTF_OUTPUT_COMMAND_ENABLE;\r\nif (!test_bit(PARAM_ISP_OTF_OUTPUT, p_index)) {\r\nisp->otf_output.width = DEFAULT_PREVIEW_STILL_WIDTH;\r\nisp->otf_output.height = DEFAULT_PREVIEW_STILL_HEIGHT;\r\nfimc_is_set_param_bit(is, PARAM_ISP_OTF_OUTPUT);\r\n}\r\nisp->otf_output.format = OTF_OUTPUT_FORMAT_YUV444;\r\nisp->otf_output.bitwidth = 12;\r\nisp->otf_output.order = 0;\r\nisp->otf_output.err = OTF_OUTPUT_ERROR_NONE;\r\nif (!test_bit(PARAM_ISP_DMA1_OUTPUT, p_index)) {\r\nisp->dma1_output.cmd = DMA_OUTPUT_COMMAND_DISABLE;\r\nisp->dma1_output.width = 0;\r\nisp->dma1_output.height = 0;\r\nisp->dma1_output.format = 0;\r\nisp->dma1_output.bitwidth = 0;\r\nisp->dma1_output.plane = 0;\r\nisp->dma1_output.order = 0;\r\nisp->dma1_output.buffer_number = 0;\r\nisp->dma1_output.buffer_address = 0;\r\nisp->dma1_output.notify_dma_done = 0;\r\nisp->dma1_output.dma_out_mask = 0;\r\nisp->dma1_output.err = DMA_OUTPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_DMA1_OUTPUT);\r\n}\r\nif (!test_bit(PARAM_ISP_DMA2_OUTPUT, p_index)) {\r\nisp->dma2_output.cmd = DMA_OUTPUT_COMMAND_DISABLE;\r\nisp->dma2_output.width = 0;\r\nisp->dma2_output.height = 0;\r\nisp->dma2_output.format = 0;\r\nisp->dma2_output.bitwidth = 0;\r\nisp->dma2_output.plane = 0;\r\nisp->dma2_output.order = 0;\r\nisp->dma2_output.buffer_number = 0;\r\nisp->dma2_output.buffer_address = 0;\r\nisp->dma2_output.notify_dma_done = 0;\r\nisp->dma2_output.dma_out_mask = 0;\r\nisp->dma2_output.err = DMA_OUTPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_ISP_DMA2_OUTPUT);\r\n}\r\nif (!test_bit(PARAM_SENSOR_FRAME_RATE, p_index)) {\r\nif (is->config_index == 0)\r\n__is_set_sensor(is, 0);\r\n}\r\ndrc->control.cmd = CONTROL_COMMAND_START;\r\n__is_set_drc_control(is, CONTROL_BYPASS_ENABLE);\r\ndrc->otf_input.cmd = OTF_INPUT_COMMAND_ENABLE;\r\nif (!test_bit(PARAM_DRC_OTF_INPUT, p_index)) {\r\ndrc->otf_input.width = DEFAULT_PREVIEW_STILL_WIDTH;\r\ndrc->otf_input.height = DEFAULT_PREVIEW_STILL_HEIGHT;\r\nfimc_is_set_param_bit(is, PARAM_DRC_OTF_INPUT);\r\n}\r\ndrc->otf_input.format = OTF_INPUT_FORMAT_YUV444;\r\ndrc->otf_input.bitwidth = 12;\r\ndrc->otf_input.order = 0;\r\ndrc->otf_input.err = OTF_INPUT_ERROR_NONE;\r\ndrc->dma_input.cmd = DMA_INPUT_COMMAND_DISABLE;\r\ndrc->dma_input.width = 0;\r\ndrc->dma_input.height = 0;\r\ndrc->dma_input.format = 0;\r\ndrc->dma_input.bitwidth = 0;\r\ndrc->dma_input.plane = 0;\r\ndrc->dma_input.order = 0;\r\ndrc->dma_input.buffer_number = 0;\r\ndrc->dma_input.width = 0;\r\ndrc->dma_input.err = DMA_INPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_DRC_DMA_INPUT);\r\ndrc->otf_output.cmd = OTF_OUTPUT_COMMAND_ENABLE;\r\nif (!test_bit(PARAM_DRC_OTF_OUTPUT, p_index)) {\r\ndrc->otf_output.width = DEFAULT_PREVIEW_STILL_WIDTH;\r\ndrc->otf_output.height = DEFAULT_PREVIEW_STILL_HEIGHT;\r\nfimc_is_set_param_bit(is, PARAM_DRC_OTF_OUTPUT);\r\n}\r\ndrc->otf_output.format = OTF_OUTPUT_FORMAT_YUV444;\r\ndrc->otf_output.bitwidth = 8;\r\ndrc->otf_output.order = 0;\r\ndrc->otf_output.err = OTF_OUTPUT_ERROR_NONE;\r\n__is_set_fd_control(is, CONTROL_COMMAND_STOP);\r\nfd->control.bypass = CONTROL_BYPASS_DISABLE;\r\nfd->otf_input.cmd = OTF_INPUT_COMMAND_ENABLE;\r\nif (!test_bit(PARAM_FD_OTF_INPUT, p_index)) {\r\nfd->otf_input.width = DEFAULT_PREVIEW_STILL_WIDTH;\r\nfd->otf_input.height = DEFAULT_PREVIEW_STILL_HEIGHT;\r\nfimc_is_set_param_bit(is, PARAM_FD_OTF_INPUT);\r\n}\r\nfd->otf_input.format = OTF_INPUT_FORMAT_YUV444;\r\nfd->otf_input.bitwidth = 8;\r\nfd->otf_input.order = 0;\r\nfd->otf_input.err = OTF_INPUT_ERROR_NONE;\r\nfd->dma_input.cmd = DMA_INPUT_COMMAND_DISABLE;\r\nfd->dma_input.width = 0;\r\nfd->dma_input.height = 0;\r\nfd->dma_input.format = 0;\r\nfd->dma_input.bitwidth = 0;\r\nfd->dma_input.plane = 0;\r\nfd->dma_input.order = 0;\r\nfd->dma_input.buffer_number = 0;\r\nfd->dma_input.width = 0;\r\nfd->dma_input.err = DMA_INPUT_ERROR_NONE;\r\nfimc_is_set_param_bit(is, PARAM_FD_DMA_INPUT);\r\n__is_set_fd_config_maxface(is, 5);\r\n__is_set_fd_config_rollangle(is, FD_CONFIG_ROLL_ANGLE_FULL);\r\n__is_set_fd_config_yawangle(is, FD_CONFIG_YAW_ANGLE_45_90);\r\n__is_set_fd_config_smilemode(is, FD_CONFIG_SMILE_MODE_DISABLE);\r\n__is_set_fd_config_blinkmode(is, FD_CONFIG_BLINK_MODE_DISABLE);\r\n__is_set_fd_config_eyedetect(is, FD_CONFIG_EYES_DETECT_ENABLE);\r\n__is_set_fd_config_mouthdetect(is, FD_CONFIG_MOUTH_DETECT_DISABLE);\r\n__is_set_fd_config_orientation(is, FD_CONFIG_ORIENTATION_DISABLE);\r\n__is_set_fd_config_orientation_val(is, 0);\r\n}
