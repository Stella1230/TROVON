static inline void xgmac_mac_disable(void __iomem *ioaddr)\r\n{\r\nu32 value = readl(ioaddr + XGMAC_DMA_CONTROL);\r\nvalue &= ~(DMA_CONTROL_ST | DMA_CONTROL_SR);\r\nwritel(value, ioaddr + XGMAC_DMA_CONTROL);\r\nvalue = readl(ioaddr + XGMAC_CONTROL);\r\nvalue &= ~(MAC_ENABLE_TX | MAC_ENABLE_RX);\r\nwritel(value, ioaddr + XGMAC_CONTROL);\r\n}\r\nint vfio_platform_calxedaxgmac_reset(struct vfio_platform_device *vdev)\r\n{\r\nstruct vfio_platform_region reg = vdev->regions[0];\r\nif (!reg.ioaddr) {\r\nreg.ioaddr =\r\nioremap_nocache(reg.addr, reg.size);\r\nif (!reg.ioaddr)\r\nreturn -ENOMEM;\r\n}\r\nwritel(0, reg.ioaddr + XGMAC_DMA_INTR_ENA);\r\nxgmac_mac_disable(reg.ioaddr);\r\nreturn 0;\r\n}
