static int da9052_map_irq(struct da9052 *da9052, int irq)\r\n{\r\nreturn regmap_irq_get_virq(da9052->irq_data, irq);\r\n}\r\nint da9052_enable_irq(struct da9052 *da9052, int irq)\r\n{\r\nirq = da9052_map_irq(da9052, irq);\r\nif (irq < 0)\r\nreturn irq;\r\nenable_irq(irq);\r\nreturn 0;\r\n}\r\nint da9052_disable_irq(struct da9052 *da9052, int irq)\r\n{\r\nirq = da9052_map_irq(da9052, irq);\r\nif (irq < 0)\r\nreturn irq;\r\ndisable_irq(irq);\r\nreturn 0;\r\n}\r\nint da9052_disable_irq_nosync(struct da9052 *da9052, int irq)\r\n{\r\nirq = da9052_map_irq(da9052, irq);\r\nif (irq < 0)\r\nreturn irq;\r\ndisable_irq_nosync(irq);\r\nreturn 0;\r\n}\r\nint da9052_request_irq(struct da9052 *da9052, int irq, char *name,\r\nirq_handler_t handler, void *data)\r\n{\r\nirq = da9052_map_irq(da9052, irq);\r\nif (irq < 0)\r\nreturn irq;\r\nreturn request_threaded_irq(irq, NULL, handler,\r\nIRQF_TRIGGER_LOW | IRQF_ONESHOT,\r\nname, data);\r\n}\r\nvoid da9052_free_irq(struct da9052 *da9052, int irq, void *data)\r\n{\r\nirq = da9052_map_irq(da9052, irq);\r\nif (irq < 0)\r\nreturn;\r\nfree_irq(irq, data);\r\n}\r\nstatic irqreturn_t da9052_auxadc_irq(int irq, void *irq_data)\r\n{\r\nstruct da9052 *da9052 = irq_data;\r\ncomplete(&da9052->done);\r\nreturn IRQ_HANDLED;\r\n}\r\nint da9052_irq_init(struct da9052 *da9052)\r\n{\r\nint ret;\r\nret = regmap_add_irq_chip(da9052->regmap, da9052->chip_irq,\r\nIRQF_TRIGGER_LOW | IRQF_ONESHOT,\r\n-1, &da9052_regmap_irq_chip,\r\n&da9052->irq_data);\r\nif (ret < 0) {\r\ndev_err(da9052->dev, "regmap_add_irq_chip failed: %d\n", ret);\r\ngoto regmap_err;\r\n}\r\nenable_irq_wake(da9052->chip_irq);\r\nret = da9052_request_irq(da9052, DA9052_IRQ_ADC_EOM, "adc-irq",\r\nda9052_auxadc_irq, da9052);\r\nif (ret != 0) {\r\ndev_err(da9052->dev, "DA9052_IRQ_ADC_EOM failed: %d\n", ret);\r\ngoto request_irq_err;\r\n}\r\nreturn 0;\r\nrequest_irq_err:\r\nregmap_del_irq_chip(da9052->chip_irq, da9052->irq_data);\r\nregmap_err:\r\nreturn ret;\r\n}\r\nint da9052_irq_exit(struct da9052 *da9052)\r\n{\r\nda9052_free_irq(da9052, DA9052_IRQ_ADC_EOM , da9052);\r\nregmap_del_irq_chip(da9052->chip_irq, da9052->irq_data);\r\nreturn 0;\r\n}
