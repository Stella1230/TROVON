static const uint8_t *dump_line(int addr, const uint8_t *line,\r\nconst uint8_t *prev)\r\n{\r\nint i;\r\nif (!prev || memcmp(line, prev, LINELEN)) {\r\npr_info("%04x: ", addr);\r\nfor (i = 0; i < LINELEN; ) {\r\nprintk(KERN_CONT "%02x", line[i]);\r\ni++;\r\nprintk(i & 3 ? " " : i & (LINELEN - 1) ? " " : "\n");\r\n}\r\nreturn line;\r\n}\r\nif (line == prev + LINELEN)\r\npr_info("[...]\n");\r\nreturn prev;\r\n}\r\nvoid fmc_dump_eeprom(const struct fmc_device *fmc)\r\n{\r\nconst uint8_t *line, *prev;\r\nint i;\r\nif (!fmc_must_dump_eeprom)\r\nreturn;\r\npr_info("FMC: %s (%s), slot %i, device %s\n", dev_name(fmc->hwdev),\r\nfmc->carrier_name, fmc->slot_id, dev_name(&fmc->dev));\r\npr_info("FMC: dumping eeprom 0x%x (%i) bytes\n", fmc->eeprom_len,\r\nfmc->eeprom_len);\r\nline = fmc->eeprom;\r\nprev = NULL;\r\nfor (i = 0; i < fmc->eeprom_len; i += LINELEN, line += LINELEN)\r\nprev = dump_line(i, line, prev);\r\n}\r\nvoid fmc_dump_sdb(const struct fmc_device *fmc)\r\n{\r\nconst uint8_t *line, *prev;\r\nint i, len;\r\nif (!fmc->sdb)\r\nreturn;\r\nif (!fmc_must_dump_sdb)\r\nreturn;\r\nif (fmc_must_dump_sdb > 0)\r\nfmc_show_sdb_tree(fmc);\r\nif (fmc_must_dump_sdb == 1)\r\nreturn;\r\npr_info("FMC: %s (%s), slot %i, device %s\n", dev_name(fmc->hwdev),\r\nfmc->carrier_name, fmc->slot_id, dev_name(&fmc->dev));\r\npr_info("FMC: poor dump of sdb first level:\n");\r\nlen = fmc->sdb->len * sizeof(union sdb_record);\r\nline = (void *)fmc->sdb->record;\r\nprev = NULL;\r\nfor (i = 0; i < len; i += LINELEN, line += LINELEN)\r\nprev = dump_line(i, line, prev);\r\nreturn;\r\n}
