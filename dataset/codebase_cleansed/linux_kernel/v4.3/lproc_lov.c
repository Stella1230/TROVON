static int lov_stripesize_seq_show(struct seq_file *m, void *v)\r\n{\r\nstruct obd_device *dev = (struct obd_device *)m->private;\r\nstruct lov_desc *desc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nseq_printf(m, "%llu\n", desc->ld_default_stripe_size);\r\nreturn 0;\r\n}\r\nstatic ssize_t lov_stripesize_seq_write(struct file *file,\r\nconst char __user *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct obd_device *dev = ((struct seq_file *)file->private_data)->private;\r\nstruct lov_desc *desc;\r\n__u64 val;\r\nint rc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nrc = lprocfs_write_u64_helper(buffer, count, &val);\r\nif (rc)\r\nreturn rc;\r\nlov_fix_desc_stripe_size(&val);\r\ndesc->ld_default_stripe_size = val;\r\nreturn count;\r\n}\r\nstatic int lov_stripeoffset_seq_show(struct seq_file *m, void *v)\r\n{\r\nstruct obd_device *dev = (struct obd_device *)m->private;\r\nstruct lov_desc *desc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nseq_printf(m, "%llu\n", desc->ld_default_stripe_offset);\r\nreturn 0;\r\n}\r\nstatic ssize_t lov_stripeoffset_seq_write(struct file *file,\r\nconst char __user *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct obd_device *dev = ((struct seq_file *)file->private_data)->private;\r\nstruct lov_desc *desc;\r\n__u64 val;\r\nint rc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nrc = lprocfs_write_u64_helper(buffer, count, &val);\r\nif (rc)\r\nreturn rc;\r\ndesc->ld_default_stripe_offset = val;\r\nreturn count;\r\n}\r\nstatic int lov_stripetype_seq_show(struct seq_file *m, void *v)\r\n{\r\nstruct obd_device *dev = (struct obd_device *)m->private;\r\nstruct lov_desc *desc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nseq_printf(m, "%u\n", desc->ld_pattern);\r\nreturn 0;\r\n}\r\nstatic ssize_t lov_stripetype_seq_write(struct file *file,\r\nconst char __user *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct obd_device *dev = ((struct seq_file *)file->private_data)->private;\r\nstruct lov_desc *desc;\r\nint val, rc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nrc = lprocfs_write_helper(buffer, count, &val);\r\nif (rc)\r\nreturn rc;\r\nlov_fix_desc_pattern(&val);\r\ndesc->ld_pattern = val;\r\nreturn count;\r\n}\r\nstatic int lov_stripecount_seq_show(struct seq_file *m, void *v)\r\n{\r\nstruct obd_device *dev = (struct obd_device *)m->private;\r\nstruct lov_desc *desc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nseq_printf(m, "%d\n", (__s16)(desc->ld_default_stripe_count + 1) - 1);\r\nreturn 0;\r\n}\r\nstatic ssize_t lov_stripecount_seq_write(struct file *file,\r\nconst char __user *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct obd_device *dev = ((struct seq_file *)file->private_data)->private;\r\nstruct lov_desc *desc;\r\nint val, rc;\r\nLASSERT(dev != NULL);\r\ndesc = &dev->u.lov.desc;\r\nrc = lprocfs_write_helper(buffer, count, &val);\r\nif (rc)\r\nreturn rc;\r\nlov_fix_desc_stripe_count(&val);\r\ndesc->ld_default_stripe_count = val;\r\nreturn count;\r\n}\r\nstatic ssize_t numobd_show(struct kobject *kobj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nstruct lov_desc *desc;\r\ndesc = &dev->u.lov.desc;\r\nreturn sprintf(buf, "%u\n", desc->ld_tgt_count);\r\n}\r\nstatic ssize_t activeobd_show(struct kobject *kobj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nstruct lov_desc *desc;\r\ndesc = &dev->u.lov.desc;\r\nreturn sprintf(buf, "%u\n", desc->ld_active_tgt_count);\r\n}\r\nstatic int lov_desc_uuid_seq_show(struct seq_file *m, void *v)\r\n{\r\nstruct obd_device *dev = (struct obd_device *)m->private;\r\nstruct lov_obd *lov;\r\nLASSERT(dev != NULL);\r\nlov = &dev->u.lov;\r\nseq_printf(m, "%s\n", lov->desc.ld_uuid.uuid);\r\nreturn 0;\r\n}\r\nstatic void *lov_tgt_seq_start(struct seq_file *p, loff_t *pos)\r\n{\r\nstruct obd_device *dev = p->private;\r\nstruct lov_obd *lov = &dev->u.lov;\r\nwhile (*pos < lov->desc.ld_tgt_count) {\r\nif (lov->lov_tgts[*pos])\r\nreturn lov->lov_tgts[*pos];\r\n++*pos;\r\n}\r\nreturn NULL;\r\n}\r\nstatic void lov_tgt_seq_stop(struct seq_file *p, void *v)\r\n{\r\n}\r\nstatic void *lov_tgt_seq_next(struct seq_file *p, void *v, loff_t *pos)\r\n{\r\nstruct obd_device *dev = p->private;\r\nstruct lov_obd *lov = &dev->u.lov;\r\nwhile (++*pos < lov->desc.ld_tgt_count) {\r\nif (lov->lov_tgts[*pos])\r\nreturn lov->lov_tgts[*pos];\r\n}\r\nreturn NULL;\r\n}\r\nstatic int lov_tgt_seq_show(struct seq_file *p, void *v)\r\n{\r\nstruct lov_tgt_desc *tgt = v;\r\nseq_printf(p, "%d: %s %sACTIVE\n",\r\ntgt->ltd_index, obd_uuid2str(&tgt->ltd_uuid),\r\ntgt->ltd_active ? "" : "IN");\r\nreturn 0;\r\n}\r\nstatic int lov_target_seq_open(struct inode *inode, struct file *file)\r\n{\r\nstruct seq_file *seq;\r\nint rc;\r\nrc = seq_open(file, &lov_tgt_sops);\r\nif (rc)\r\nreturn rc;\r\nseq = file->private_data;\r\nseq->private = inode->i_private;\r\nreturn 0;\r\n}\r\nvoid lprocfs_lov_init_vars(struct lprocfs_static_vars *lvars)\r\n{\r\nlvars->sysfs_vars = &lov_attr_group;\r\nlvars->obd_vars = lprocfs_lov_obd_vars;\r\n}
