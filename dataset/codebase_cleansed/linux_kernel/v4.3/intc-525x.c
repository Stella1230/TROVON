static void intc2_irq_gpio_mask(struct irq_data *d)\r\n{\r\nu32 imr = readl(MCFSIM2_GPIOINTENABLE);\r\nu32 type = irqd_get_trigger_type(d);\r\nint irq = d->irq - MCF_IRQ_GPIO0;\r\nif (type & IRQ_TYPE_EDGE_RISING)\r\nimr &= ~(0x001 << irq);\r\nif (type & IRQ_TYPE_EDGE_FALLING)\r\nimr &= ~(0x100 << irq);\r\nwritel(imr, MCFSIM2_GPIOINTENABLE);\r\n}\r\nstatic void intc2_irq_gpio_unmask(struct irq_data *d)\r\n{\r\nu32 imr = readl(MCFSIM2_GPIOINTENABLE);\r\nu32 type = irqd_get_trigger_type(d);\r\nint irq = d->irq - MCF_IRQ_GPIO0;\r\nif (type & IRQ_TYPE_EDGE_RISING)\r\nimr |= (0x001 << irq);\r\nif (type & IRQ_TYPE_EDGE_FALLING)\r\nimr |= (0x100 << irq);\r\nwritel(imr, MCFSIM2_GPIOINTENABLE);\r\n}\r\nstatic void intc2_irq_gpio_ack(struct irq_data *d)\r\n{\r\nu32 imr = 0;\r\nu32 type = irqd_get_trigger_type(d);\r\nint irq = d->irq - MCF_IRQ_GPIO0;\r\nif (type & IRQ_TYPE_EDGE_RISING)\r\nimr |= (0x001 << irq);\r\nif (type & IRQ_TYPE_EDGE_FALLING)\r\nimr |= (0x100 << irq);\r\nwritel(imr, MCFSIM2_GPIOINTCLEAR);\r\n}\r\nstatic int intc2_irq_gpio_set_type(struct irq_data *d, unsigned int f)\r\n{\r\nif (f & ~IRQ_TYPE_EDGE_BOTH)\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic int __init mcf_intc2_init(void)\r\n{\r\nint irq;\r\nwritel(MCFINTC2_VECBASE, MCFINTC2_INTBASE);\r\nfor (irq = MCF_IRQ_GPIO0; (irq <= MCF_IRQ_GPIO6); irq++) {\r\nirq_set_chip(irq, &intc2_irq_gpio_chip);\r\nirq_set_handler(irq, handle_edge_irq);\r\n}\r\nreturn 0;\r\n}
