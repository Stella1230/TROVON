unsigned int\r\ndbl_fsqrt(\r\ndbl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\ndbl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int srcp1, srcp2, resultp1, resultp2;\r\nregister unsigned int newbitp1, newbitp2, sump1, sump2;\r\nregister int src_exponent;\r\nregister boolean guardbit = FALSE, even_exponent;\r\nDbl_copyfromptr(srcptr,srcp1,srcp2);\r\nif ((src_exponent = Dbl_exponent(srcp1)) == DBL_INFINITY_EXPONENT) {\r\nif (Dbl_isone_signaling(srcp1)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_set_quiet(srcp1);\r\n}\r\nif (Dbl_iszero_sign(srcp1) ||\r\nDbl_isnotzero_mantissa(srcp1,srcp2)) {\r\nDbl_copytoptr(srcp1,srcp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nif (Dbl_iszero_exponentmantissa(srcp1,srcp2)) {\r\nDbl_copytoptr(srcp1,srcp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Dbl_isone_sign(srcp1)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_makequietnan(srcp1,srcp2);\r\nDbl_copytoptr(srcp1,srcp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (src_exponent > 0) {\r\neven_exponent = Dbl_hidden(srcp1);\r\nDbl_clear_signexponent_set_hidden(srcp1);\r\n}\r\nelse {\r\nDbl_clear_signexponent(srcp1);\r\nsrc_exponent++;\r\nDbl_normalize(srcp1,srcp2,src_exponent);\r\neven_exponent = src_exponent & 1;\r\n}\r\nif (even_exponent) {\r\nDbl_leftshiftby1(srcp1,srcp2);\r\n}\r\nDbl_setzero(resultp1,resultp2);\r\nDbl_allp1(newbitp1) = 1 << (DBL_P - 32);\r\nDbl_setzero_mantissap2(newbitp2);\r\nwhile (Dbl_isnotzero(newbitp1,newbitp2) && Dbl_isnotzero(srcp1,srcp2)) {\r\nDbl_addition(resultp1,resultp2,newbitp1,newbitp2,sump1,sump2);\r\nif(Dbl_isnotgreaterthan(sump1,sump2,srcp1,srcp2)) {\r\nDbl_leftshiftby1(newbitp1,newbitp2);\r\nDbl_addition(resultp1,resultp2,newbitp1,newbitp2,\r\nresultp1,resultp2);\r\nDbl_subtract(srcp1,srcp2,sump1,sump2,srcp1,srcp2);\r\nDbl_rightshiftby2(newbitp1,newbitp2);\r\n}\r\nelse {\r\nDbl_rightshiftby1(newbitp1,newbitp2);\r\n}\r\nDbl_leftshiftby1(srcp1,srcp2);\r\n}\r\nif (even_exponent) {\r\nDbl_rightshiftby1(resultp1,resultp2);\r\n}\r\nif (Dbl_isnotzero(srcp1,srcp2)) {\r\nif (!even_exponent && Dbl_islessthan(resultp1,resultp2,srcp1,srcp2)) {\r\nDbl_increment(resultp1,resultp2);\r\n}\r\nguardbit = Dbl_lowmantissap2(resultp2);\r\nDbl_rightshiftby1(resultp1,resultp2);\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nDbl_increment(resultp1,resultp2);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit) {\r\nDbl_increment(resultp1,resultp2);\r\n}\r\nbreak;\r\n}\r\nif (Dbl_isone_hiddenoverflow(resultp1)) src_exponent+=2;\r\nif (Is_inexacttrap_enabled()) {\r\nDbl_set_exponent(resultp1,\r\n((src_exponent-DBL_BIAS)>>1)+DBL_BIAS);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(INEXACTEXCEPTION);\r\n}\r\nelse Set_inexactflag();\r\n}\r\nelse {\r\nDbl_rightshiftby1(resultp1,resultp2);\r\n}\r\nDbl_set_exponent(resultp1,((src_exponent-DBL_BIAS)>>1)+DBL_BIAS);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}
