const struct hda_device_id *\r\nhdac_get_device_id(struct hdac_device *hdev, struct hdac_driver *drv)\r\n{\r\nif (drv->id_table) {\r\nconst struct hda_device_id *id = drv->id_table;\r\nwhile (id->vendor_id) {\r\nif (hdev->vendor_id == id->vendor_id &&\r\n(!id->rev_id || id->rev_id == hdev->revision_id))\r\nreturn id;\r\nid++;\r\n}\r\n}\r\nreturn NULL;\r\n}\r\nstatic int hdac_codec_match(struct hdac_device *dev, struct hdac_driver *drv)\r\n{\r\nif (hdac_get_device_id(dev, drv))\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nstatic int hda_bus_match(struct device *dev, struct device_driver *drv)\r\n{\r\nstruct hdac_device *hdev = dev_to_hdac_dev(dev);\r\nstruct hdac_driver *hdrv = drv_to_hdac_driver(drv);\r\nif (hdev->type != hdrv->type)\r\nreturn 0;\r\nif (hdrv->match)\r\nreturn hdrv->match(hdev, hdrv);\r\nelse\r\nreturn hdac_codec_match(hdev, hdrv);\r\nreturn 1;\r\n}\r\nstatic int __init hda_bus_init(void)\r\n{\r\nreturn bus_register(&snd_hda_bus_type);\r\n}\r\nstatic void __exit hda_bus_exit(void)\r\n{\r\nbus_unregister(&snd_hda_bus_type);\r\n}
