int fsl_asoc_get_dma_channel(struct device_node *ssi_np,\r\nconst char *name,\r\nstruct snd_soc_dai_link *dai,\r\nunsigned int *dma_channel_id,\r\nunsigned int *dma_id)\r\n{\r\nstruct resource res;\r\nstruct device_node *dma_channel_np, *dma_np;\r\nconst u32 *iprop;\r\nint ret;\r\ndma_channel_np = of_parse_phandle(ssi_np, name, 0);\r\nif (!dma_channel_np)\r\nreturn -EINVAL;\r\nif (!of_device_is_compatible(dma_channel_np, "fsl,ssi-dma-channel")) {\r\nof_node_put(dma_channel_np);\r\nreturn -EINVAL;\r\n}\r\nret = of_address_to_resource(dma_channel_np, 0, &res);\r\nif (ret) {\r\nof_node_put(dma_channel_np);\r\nreturn ret;\r\n}\r\nsnprintf((char *)dai->platform_name, DAI_NAME_SIZE, "%llx.%s",\r\n(unsigned long long) res.start, dma_channel_np->name);\r\niprop = of_get_property(dma_channel_np, "cell-index", NULL);\r\nif (!iprop) {\r\nof_node_put(dma_channel_np);\r\nreturn -EINVAL;\r\n}\r\n*dma_channel_id = be32_to_cpup(iprop);\r\ndma_np = of_get_parent(dma_channel_np);\r\niprop = of_get_property(dma_np, "cell-index", NULL);\r\nif (!iprop) {\r\nof_node_put(dma_np);\r\nreturn -EINVAL;\r\n}\r\n*dma_id = be32_to_cpup(iprop);\r\nof_node_put(dma_np);\r\nof_node_put(dma_channel_np);\r\nreturn 0;\r\n}
