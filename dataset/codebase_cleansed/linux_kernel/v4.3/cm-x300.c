static void __init cm_x300_init_dm9000(void)\r\n{\r\nplatform_device_register(&dm9000_device);\r\n}\r\nstatic inline void cm_x300_init_dm9000(void) {}\r\nstatic void __init cm_x300_init_lcd(void)\r\n{\r\npxa_set_fb_info(NULL, &cm_x300_lcd);\r\n}\r\nstatic inline void cm_x300_init_lcd(void) {}\r\nstatic void cm_x300_init_bl(void)\r\n{\r\nplatform_device_register(&cm_x300_backlight_device);\r\n}\r\nstatic inline void cm_x300_init_bl(void) {}\r\nstatic void __init cm_x300_init_spi(void)\r\n{\r\nspi_register_board_info(cm_x300_spi_devices,\r\nARRAY_SIZE(cm_x300_spi_devices));\r\nplatform_device_register(&cm_x300_spi_gpio);\r\n}\r\nstatic inline void cm_x300_init_spi(void) {}\r\nstatic void __init cm_x300_init_ac97(void)\r\n{\r\npxa_set_ac97_info(NULL);\r\n}\r\nstatic inline void cm_x300_init_ac97(void) {}\r\nstatic void __init cm_x300_init_nand(void)\r\n{\r\npxa3xx_set_nand_info(&cm_x300_nand_info);\r\n}\r\nstatic inline void cm_x300_init_nand(void) {}\r\nstatic int cm_x300_mci2_init(struct device *dev,\r\nirq_handler_t cm_x300_detect_int,\r\nvoid *data)\r\n{\r\nreturn 0;\r\n}\r\nstatic void cm_x300_mci2_exit(struct device *dev, void *data)\r\n{\r\n}\r\nstatic void __init cm_x300_init_mmc(void)\r\n{\r\npxa_set_mci_info(&cm_x300_mci_platform_data);\r\npxa3xx_set_mci2_info(&cm_x300_mci2_platform_data);\r\n}\r\nstatic inline void cm_x300_init_mmc(void) {}\r\nstatic int cm_x300_ulpi_phy_reset(void)\r\n{\r\nint err;\r\nerr = gpio_request_one(GPIO_ULPI_PHY_RST, GPIOF_OUT_INIT_LOW,\r\n"ulpi reset");\r\nif (err) {\r\npr_err("failed to request ULPI reset GPIO: %d\n", err);\r\nreturn err;\r\n}\r\nmsleep(10);\r\ngpio_set_value(GPIO_ULPI_PHY_RST, 1);\r\nmsleep(10);\r\ngpio_free(GPIO_ULPI_PHY_RST);\r\nreturn 0;\r\n}\r\nstatic inline int cm_x300_u2d_init(struct device *dev)\r\n{\r\nint err = 0;\r\nif (cpu_is_pxa310()) {\r\npout_clk = clk_get(NULL, "CLK_POUT");\r\nif (IS_ERR(pout_clk)) {\r\nerr = PTR_ERR(pout_clk);\r\npr_err("failed to get CLK_POUT: %d\n", err);\r\nreturn err;\r\n}\r\nclk_enable(pout_clk);\r\nerr = cm_x300_ulpi_phy_reset();\r\nif (err) {\r\nclk_disable(pout_clk);\r\nclk_put(pout_clk);\r\n}\r\n}\r\nreturn err;\r\n}\r\nstatic void cm_x300_u2d_exit(struct device *dev)\r\n{\r\nif (cpu_is_pxa310()) {\r\nclk_disable(pout_clk);\r\nclk_put(pout_clk);\r\n}\r\n}\r\nstatic void cm_x300_init_u2d(void)\r\n{\r\npxa3xx_set_u2d_info(&cm_x300_u2d_platform_data);\r\n}\r\nstatic inline void cm_x300_init_u2d(void) {}\r\nstatic int cm_x300_ohci_init(struct device *dev)\r\n{\r\nif (cpu_is_pxa300())\r\nUP2OCR = UP2OCR_HXS\r\n| UP2OCR_HXOE | UP2OCR_DMPDE | UP2OCR_DPPDE;\r\nreturn 0;\r\n}\r\nstatic void __init cm_x300_init_ohci(void)\r\n{\r\npxa_set_ohci_info(&cm_x300_ohci_platform_data);\r\n}\r\nstatic inline void cm_x300_init_ohci(void) {}\r\nstatic void __init cm_x300_init_leds(void)\r\n{\r\nif (system_rev < 130)\r\ncm_x300_leds[0].gpio = 79;\r\nelse\r\ncm_x300_leds[0].gpio = 76;\r\nplatform_device_register(&cm_x300_led_device);\r\n}\r\nstatic inline void cm_x300_init_leds(void) {}\r\nstatic void __init cm_x300_init_i2c(void)\r\n{\r\npxa_set_i2c_info(NULL);\r\ni2c_register_board_info(0, cm_x300_gpio_ext_info,\r\nARRAY_SIZE(cm_x300_gpio_ext_info));\r\n}\r\nstatic inline void cm_x300_init_i2c(void) {}\r\nstatic void __init cm_x300_init_rtc(void)\r\n{\r\nplatform_device_register(&cm_x300_rtc_device);\r\n}\r\nstatic inline void cm_x300_init_rtc(void) {}\r\nstatic void cm_x300_battery_low(void)\r\n{\r\n#if defined(CONFIG_APM_EMULATION)\r\napm_queue_event(APM_LOW_BATTERY);\r\n#endif\r\n}\r\nstatic void cm_x300_battery_critical(void)\r\n{\r\n#if defined(CONFIG_APM_EMULATION)\r\napm_queue_event(APM_CRITICAL_SUSPEND);\r\n#endif\r\n}\r\nstatic void __init cm_x300_init_da9030(void)\r\n{\r\npxa3xx_set_i2c_power_info(&cm_x300_pwr_i2c_info);\r\ni2c_register_board_info(1, &cm_x300_pmic_info, 1);\r\nirq_set_irq_wake(IRQ_WAKEUP0, 1);\r\n}\r\nstatic void __init cm_x300_init_wi2wi(void)\r\n{\r\nint err;\r\nif (system_rev < 130) {\r\ncm_x300_wi2wi_gpios[0].gpio = 77;\r\ncm_x300_wi2wi_gpios[1].gpio = 78;\r\n}\r\nerr = gpio_request_array(ARRAY_AND_SIZE(cm_x300_wi2wi_gpios));\r\nif (err) {\r\npr_err("failed to request wifi/bt gpios: %d\n", err);\r\nreturn;\r\n}\r\nudelay(10);\r\ngpio_set_value(cm_x300_wi2wi_gpios[1].gpio, 0);\r\nudelay(10);\r\ngpio_set_value(cm_x300_wi2wi_gpios[1].gpio, 1);\r\ngpio_free_array(ARRAY_AND_SIZE(cm_x300_wi2wi_gpios));\r\n}\r\nstatic void __init cm_x300_init_mfp(void)\r\n{\r\npxa3xx_mfp_config(ARRAY_AND_SIZE(cm_x3xx_mfp_cfg));\r\nif (system_rev < 130)\r\npxa3xx_mfp_config(ARRAY_AND_SIZE(cm_x3xx_rev_lt130_mfp_cfg));\r\nelse\r\npxa3xx_mfp_config(ARRAY_AND_SIZE(cm_x3xx_rev_ge130_mfp_cfg));\r\nif (cpu_is_pxa310())\r\npxa3xx_mfp_config(ARRAY_AND_SIZE(cm_x310_mfp_cfg));\r\n}\r\nstatic void __init cm_x300_init(void)\r\n{\r\ncm_x300_init_mfp();\r\npxa_set_btuart_info(NULL);\r\npxa_set_stuart_info(NULL);\r\nif (cpu_is_pxa300())\r\npxa_set_ffuart_info(NULL);\r\ncm_x300_init_da9030();\r\ncm_x300_init_dm9000();\r\ncm_x300_init_lcd();\r\ncm_x300_init_u2d();\r\ncm_x300_init_ohci();\r\ncm_x300_init_mmc();\r\ncm_x300_init_nand();\r\ncm_x300_init_leds();\r\ncm_x300_init_i2c();\r\ncm_x300_init_spi();\r\ncm_x300_init_rtc();\r\ncm_x300_init_ac97();\r\ncm_x300_init_wi2wi();\r\ncm_x300_init_bl();\r\nregulator_has_full_constraints();\r\n}\r\nstatic void __init cm_x300_fixup(struct tag *tags, char **cmdline)\r\n{\r\nfor (; tags->hdr.size; tags = tag_next(tags))\r\nif (tags->hdr.tag == ATAG_MEM &&\r\ntags->u.mem.start == 0x80000000) {\r\ntags->u.mem.start = 0xa0000000;\r\nbreak;\r\n}\r\n}
