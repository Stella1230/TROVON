static int ssb_host_pcmcia_probe(struct pcmcia_device *dev)\r\n{\r\nstruct ssb_bus *ssb;\r\nint err = -ENOMEM;\r\nint res = 0;\r\nssb = kzalloc(sizeof(*ssb), GFP_KERNEL);\r\nif (!ssb)\r\ngoto out_error;\r\nerr = -ENODEV;\r\ndev->config_flags |= CONF_ENABLE_IRQ;\r\ndev->resource[2]->flags |= WIN_ENABLE | WIN_DATA_WIDTH_16 |\r\nWIN_USE_WAIT;\r\ndev->resource[2]->start = 0;\r\ndev->resource[2]->end = SSB_CORE_SIZE;\r\nres = pcmcia_request_window(dev, dev->resource[2], 250);\r\nif (res != 0)\r\ngoto err_kfree_ssb;\r\nres = pcmcia_map_mem_page(dev, dev->resource[2], 0);\r\nif (res != 0)\r\ngoto err_disable;\r\nif (!dev->irq)\r\ngoto err_disable;\r\nres = pcmcia_enable_device(dev);\r\nif (res != 0)\r\ngoto err_disable;\r\nerr = ssb_bus_pcmciabus_register(ssb, dev, dev->resource[2]->start);\r\nif (err)\r\ngoto err_disable;\r\ndev->priv = ssb;\r\nreturn 0;\r\nerr_disable:\r\npcmcia_disable_device(dev);\r\nerr_kfree_ssb:\r\nkfree(ssb);\r\nout_error:\r\nssb_err("Initialization failed (%d, %d)\n", res, err);\r\nreturn err;\r\n}\r\nstatic void ssb_host_pcmcia_remove(struct pcmcia_device *dev)\r\n{\r\nstruct ssb_bus *ssb = dev->priv;\r\nssb_bus_unregister(ssb);\r\npcmcia_disable_device(dev);\r\nkfree(ssb);\r\ndev->priv = NULL;\r\n}\r\nstatic int ssb_host_pcmcia_suspend(struct pcmcia_device *dev)\r\n{\r\nstruct ssb_bus *ssb = dev->priv;\r\nreturn ssb_bus_suspend(ssb);\r\n}\r\nstatic int ssb_host_pcmcia_resume(struct pcmcia_device *dev)\r\n{\r\nstruct ssb_bus *ssb = dev->priv;\r\nreturn ssb_bus_resume(ssb);\r\n}\r\nint ssb_host_pcmcia_init(void)\r\n{\r\nreturn pcmcia_register_driver(&ssb_host_pcmcia_driver);\r\n}\r\nvoid ssb_host_pcmcia_exit(void)\r\n{\r\npcmcia_unregister_driver(&ssb_host_pcmcia_driver);\r\n}
