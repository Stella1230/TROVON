static int trinity_notify_message_to_smu(struct radeon_device *rdev, u32 id)\r\n{\r\nint i;\r\nu32 v = 0;\r\nWREG32(SMC_MESSAGE_0, id);\r\nfor (i = 0; i < rdev->usec_timeout; i++) {\r\nif (RREG32(SMC_RESP_0) != 0)\r\nbreak;\r\nudelay(1);\r\n}\r\nv = RREG32(SMC_RESP_0);\r\nif (v != 1) {\r\nif (v == 0xFF) {\r\nDRM_ERROR("SMC failed to handle the message!\n");\r\nreturn -EINVAL;\r\n} else if (v == 0xFE) {\r\nDRM_ERROR("Unknown SMC message!\n");\r\nreturn -EINVAL;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nint trinity_dpm_bapm_enable(struct radeon_device *rdev, bool enable)\r\n{\r\nif (enable)\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_EnableBAPM);\r\nelse\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DisableBAPM);\r\n}\r\nint trinity_dpm_config(struct radeon_device *rdev, bool enable)\r\n{\r\nif (enable)\r\nWREG32_SMC(SMU_SCRATCH0, 1);\r\nelse\r\nWREG32_SMC(SMU_SCRATCH0, 0);\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_Config);\r\n}\r\nint trinity_dpm_force_state(struct radeon_device *rdev, u32 n)\r\n{\r\nWREG32_SMC(SMU_SCRATCH0, n);\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_ForceState);\r\n}\r\nint trinity_dpm_n_levels_disabled(struct radeon_device *rdev, u32 n)\r\n{\r\nWREG32_SMC(SMU_SCRATCH0, n);\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_N_LevelsDisabled);\r\n}\r\nint trinity_uvd_dpm_config(struct radeon_device *rdev)\r\n{\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_UVD_DPM_Config);\r\n}\r\nint trinity_dpm_no_forced_level(struct radeon_device *rdev)\r\n{\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_NoForcedLevel);\r\n}\r\nint trinity_dce_enable_voltage_adjustment(struct radeon_device *rdev,\r\nbool enable)\r\n{\r\nif (enable)\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DCE_AllowVoltageAdjustment);\r\nelse\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DCE_RemoveVoltageAdjustment);\r\n}\r\nint trinity_gfx_dynamic_mgpg_config(struct radeon_device *rdev)\r\n{\r\nreturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_PG_SIMD_Config);\r\n}\r\nvoid trinity_acquire_mutex(struct radeon_device *rdev)\r\n{\r\nint i;\r\nWREG32(SMC_INT_REQ, 1);\r\nfor (i = 0; i < rdev->usec_timeout; i++) {\r\nif ((RREG32(SMC_INT_REQ) & 0xffff) == 1)\r\nbreak;\r\nudelay(1);\r\n}\r\n}\r\nvoid trinity_release_mutex(struct radeon_device *rdev)\r\n{\r\nWREG32(SMC_INT_REQ, 0);\r\n}
