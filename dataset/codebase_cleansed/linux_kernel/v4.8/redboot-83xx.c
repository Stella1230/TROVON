static void platform_fixups(void)\r\n{\r\nvoid *node;\r\ndt_fixup_memory(bd.bi_memstart, bd.bi_memsize);\r\ndt_fixup_mac_addresses(bd.bi_enetaddr);\r\ndt_fixup_cpu_clocks(bd.bi_intfreq, bd.bi_busfreq / 16, bd.bi_busfreq);\r\nnode = finddevice("/soc/cpm/brg");\r\nif (node) {\r\nprintf("BRG clock-frequency <- 0x%x (%dMHz)\r\n",\r\nbd.bi_busfreq, MHZ(bd.bi_busfreq));\r\nsetprop(node, "clock-frequency", &bd.bi_busfreq, 4);\r\n}\r\n}\r\nvoid platform_init(unsigned long r3, unsigned long r4, unsigned long r5,\r\nunsigned long r6, unsigned long r7)\r\n{\r\nmemcpy(&bd, (char *)r3, sizeof(bd));\r\nif (bd.bi_tag != 0x42444944)\r\nreturn;\r\nsimple_alloc_init(_end,\r\nbd.bi_memstart + bd.bi_memsize - (unsigned long)_end,\r\n32, 64);\r\nfdt_init(_dtb_start);\r\nserial_console_init();\r\nplatform_ops.fixups = platform_fixups;\r\nloader_info.cmdline = (char *)bd.bi_cmdline;\r\nloader_info.cmdline_len = strlen((char *)bd.bi_cmdline);\r\n}
