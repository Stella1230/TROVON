static void cmd_usage(void)\r\n{\r\nunsigned int i, longest = 0;\r\nprintf("\n usage: %s\n\n", objtool_usage_string);\r\nfor (i = 0; i < ARRAY_SIZE(objtool_cmds); i++) {\r\nif (longest < strlen(objtool_cmds[i].name))\r\nlongest = strlen(objtool_cmds[i].name);\r\n}\r\nputs(" Commands:");\r\nfor (i = 0; i < ARRAY_SIZE(objtool_cmds); i++) {\r\nprintf(" %-*s ", longest, objtool_cmds[i].name);\r\nputs(objtool_cmds[i].help);\r\n}\r\nprintf("\n");\r\nexit(1);\r\n}\r\nstatic void handle_options(int *argc, const char ***argv)\r\n{\r\nwhile (*argc > 0) {\r\nconst char *cmd = (*argv)[0];\r\nif (cmd[0] != '-')\r\nbreak;\r\nif (!strcmp(cmd, "--help") || !strcmp(cmd, "-h")) {\r\nhelp = true;\r\nbreak;\r\n} else {\r\nfprintf(stderr, "Unknown option: %s\n", cmd);\r\nfprintf(stderr, "\n Usage: %s\n",\r\nobjtool_usage_string);\r\nexit(1);\r\n}\r\n(*argv)++;\r\n(*argc)--;\r\n}\r\n}\r\nstatic void handle_internal_command(int argc, const char **argv)\r\n{\r\nconst char *cmd = argv[0];\r\nunsigned int i, ret;\r\nfor (i = 0; i < ARRAY_SIZE(objtool_cmds); i++) {\r\nstruct cmd_struct *p = objtool_cmds+i;\r\nif (strcmp(p->name, cmd))\r\ncontinue;\r\nret = p->fn(argc, argv);\r\nexit(ret);\r\n}\r\ncmd_usage();\r\n}\r\nint main(int argc, const char **argv)\r\n{\r\nstatic const char *UNUSED = "OBJTOOL_NOT_IMPLEMENTED";\r\nexec_cmd_init("objtool", UNUSED, UNUSED, UNUSED);\r\npager_init(UNUSED);\r\nargv++;\r\nargc--;\r\nhandle_options(&argc, &argv);\r\nif (!argc || help)\r\ncmd_usage();\r\nhandle_internal_command(argc, argv);\r\nreturn 0;\r\n}
