static int palmte2_backlight_init(struct device *dev)\r\n{\r\nreturn gpio_request_array(ARRAY_AND_SIZE(palmte_bl_gpios));\r\n}\r\nstatic int palmte2_backlight_notify(struct device *dev, int brightness)\r\n{\r\ngpio_set_value(GPIO_NR_PALMTE2_BL_POWER, brightness);\r\ngpio_set_value(GPIO_NR_PALMTE2_LCD_POWER, brightness);\r\nreturn brightness;\r\n}\r\nstatic void palmte2_backlight_exit(struct device *dev)\r\n{\r\ngpio_free_array(ARRAY_AND_SIZE(palmte_bl_gpios));\r\n}\r\nstatic int power_supply_init(struct device *dev)\r\n{\r\nint ret;\r\nret = gpio_request(GPIO_NR_PALMTE2_POWER_DETECT, "CABLE_STATE_AC");\r\nif (ret)\r\ngoto err1;\r\nret = gpio_direction_input(GPIO_NR_PALMTE2_POWER_DETECT);\r\nif (ret)\r\ngoto err2;\r\nreturn 0;\r\nerr2:\r\ngpio_free(GPIO_NR_PALMTE2_POWER_DETECT);\r\nerr1:\r\nreturn ret;\r\n}\r\nstatic int palmte2_is_ac_online(void)\r\n{\r\nreturn gpio_get_value(GPIO_NR_PALMTE2_POWER_DETECT);\r\n}\r\nstatic void power_supply_exit(struct device *dev)\r\n{\r\ngpio_free(GPIO_NR_PALMTE2_POWER_DETECT);\r\n}\r\nstatic void __init palmte2_udc_init(void)\r\n{\r\nif (!gpio_request(GPIO_NR_PALMTE2_USB_PULLUP, "UDC Vbus")) {\r\ngpio_direction_output(GPIO_NR_PALMTE2_USB_PULLUP, 1);\r\ngpio_free(GPIO_NR_PALMTE2_USB_PULLUP);\r\n}\r\n}\r\nstatic void __init palmte2_init(void)\r\n{\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(palmte2_pin_config));\r\npxa_set_ffuart_info(NULL);\r\npxa_set_btuart_info(NULL);\r\npxa_set_stuart_info(NULL);\r\npxa_set_fb_info(NULL, &palmte2_lcd_screen);\r\npxa_set_mci_info(&palmte2_mci_platform_data);\r\npalmte2_udc_init();\r\npxa_set_ac97_info(&palmte2_ac97_pdata);\r\npxa_set_ficp_info(&palmte2_ficp_platform_data);\r\npwm_add_table(palmte2_pwm_lookup, ARRAY_SIZE(palmte2_pwm_lookup));\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\n}
