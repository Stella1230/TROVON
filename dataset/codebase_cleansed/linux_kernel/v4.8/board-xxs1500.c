const char *get_system_type(void)\r\n{\r\nreturn "XXS1500";\r\n}\r\nvoid __init prom_init(void)\r\n{\r\nunsigned char *memsize_str;\r\nunsigned long memsize;\r\nprom_argc = fw_arg0;\r\nprom_argv = (char **)fw_arg1;\r\nprom_envp = (char **)fw_arg2;\r\nprom_init_cmdline();\r\nmemsize_str = prom_getenv("memsize");\r\nif (!memsize_str || kstrtoul(memsize_str, 0, &memsize))\r\nmemsize = 0x04000000;\r\nadd_memory_region(0, memsize, BOOT_MEM_RAM);\r\n}\r\nvoid prom_putchar(unsigned char c)\r\n{\r\nalchemy_uart_putchar(AU1000_UART0_PHYS_ADDR, c);\r\n}\r\nstatic void xxs1500_reset(char *c)\r\n{\r\n__asm__ __volatile__("jr\t%0" : : "r"(0xbfc00000));\r\n}\r\nstatic void xxs1500_power_off(void)\r\n{\r\nwhile (1)\r\nasm volatile (\r\n" .set mips32 \n"\r\n" wait \n"\r\n" .set mips0 \n");\r\n}\r\nvoid __init board_setup(void)\r\n{\r\nu32 pin_func;\r\npm_power_off = xxs1500_power_off;\r\n_machine_halt = xxs1500_power_off;\r\n_machine_restart = xxs1500_reset;\r\nalchemy_gpio1_input_enable();\r\nalchemy_gpio2_enable();\r\npin_func = alchemy_rdsys(AU1000_SYS_PINFUNC) & ~SYS_PF_UR3;\r\npin_func |= SYS_PF_UR3;\r\nalchemy_wrsys(pin_func, AU1000_SYS_PINFUNC);\r\nalchemy_uart_enable(AU1000_UART3_PHYS_ADDR);\r\n__raw_writel(1, (void __iomem *)KSEG1ADDR(AU1000_UART3_PHYS_ADDR + 0x18));\r\nwmb();\r\n}\r\nstatic int __init xxs1500_dev_init(void)\r\n{\r\nirq_set_irq_type(AU1500_GPIO204_INT, IRQ_TYPE_LEVEL_HIGH);\r\nirq_set_irq_type(AU1500_GPIO201_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO202_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO203_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO205_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO207_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO0_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO1_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO2_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO3_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO4_INT, IRQ_TYPE_LEVEL_LOW);\r\nirq_set_irq_type(AU1500_GPIO5_INT, IRQ_TYPE_LEVEL_LOW);\r\nreturn platform_add_devices(xxs1500_devs,\r\nARRAY_SIZE(xxs1500_devs));\r\n}
