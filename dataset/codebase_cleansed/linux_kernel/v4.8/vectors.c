void __init base_trap_init(void)\r\n{\r\nif (MACH_IS_SUN3X) {\r\nextern e_vector *sun3x_prom_vbr;\r\n__asm__ volatile ("movec %%vbr, %0" : "=r" (sun3x_prom_vbr));\r\n}\r\n__asm__ volatile ("movec %0,%%vbr" : : "r" ((void*)vectors));\r\nif (CPU_IS_060) {\r\nasmlinkage void unimp_vec(void) asm ("_060_isp_unimp");\r\nvectors[VEC_UNIMPII] = unimp_vec;\r\n}\r\nvectors[VEC_BUSERR] = buserr;\r\nvectors[VEC_ILLEGAL] = trap;\r\nvectors[VEC_SYS] = system_call;\r\n}\r\nvoid __init trap_init (void)\r\n{\r\nint i;\r\nfor (i = VEC_SPUR; i <= VEC_INT7; i++)\r\nvectors[i] = bad_inthandler;\r\nfor (i = 0; i < VEC_USER; i++)\r\nif (!vectors[i])\r\nvectors[i] = trap;\r\nfor (i = VEC_USER; i < 256; i++)\r\nvectors[i] = bad_inthandler;\r\n#ifdef CONFIG_M68KFPU_EMU\r\nif (FPU_IS_EMU)\r\nvectors[VEC_LINE11] = fpu_emu;\r\n#endif\r\nif (CPU_IS_040 && !FPU_IS_EMU) {\r\nasmlinkage void dz_vec(void) asm ("dz");\r\nasmlinkage void inex_vec(void) asm ("inex");\r\nasmlinkage void ovfl_vec(void) asm ("ovfl");\r\nasmlinkage void unfl_vec(void) asm ("unfl");\r\nasmlinkage void snan_vec(void) asm ("snan");\r\nasmlinkage void operr_vec(void) asm ("operr");\r\nasmlinkage void bsun_vec(void) asm ("bsun");\r\nasmlinkage void fline_vec(void) asm ("fline");\r\nasmlinkage void unsupp_vec(void) asm ("unsupp");\r\nvectors[VEC_FPDIVZ] = dz_vec;\r\nvectors[VEC_FPIR] = inex_vec;\r\nvectors[VEC_FPOVER] = ovfl_vec;\r\nvectors[VEC_FPUNDER] = unfl_vec;\r\nvectors[VEC_FPNAN] = snan_vec;\r\nvectors[VEC_FPOE] = operr_vec;\r\nvectors[VEC_FPBRUC] = bsun_vec;\r\nvectors[VEC_LINE11] = fline_vec;\r\nvectors[VEC_FPUNSUP] = unsupp_vec;\r\n}\r\nif (CPU_IS_060 && !FPU_IS_EMU) {\r\nasmlinkage void snan_vec6(void) asm ("_060_fpsp_snan");\r\nasmlinkage void operr_vec6(void) asm ("_060_fpsp_operr");\r\nasmlinkage void ovfl_vec6(void) asm ("_060_fpsp_ovfl");\r\nasmlinkage void unfl_vec6(void) asm ("_060_fpsp_unfl");\r\nasmlinkage void dz_vec6(void) asm ("_060_fpsp_dz");\r\nasmlinkage void inex_vec6(void) asm ("_060_fpsp_inex");\r\nasmlinkage void fline_vec6(void) asm ("_060_fpsp_fline");\r\nasmlinkage void unsupp_vec6(void) asm ("_060_fpsp_unsupp");\r\nasmlinkage void effadd_vec6(void) asm ("_060_fpsp_effadd");\r\nvectors[VEC_FPNAN] = snan_vec6;\r\nvectors[VEC_FPOE] = operr_vec6;\r\nvectors[VEC_FPOVER] = ovfl_vec6;\r\nvectors[VEC_FPUNDER] = unfl_vec6;\r\nvectors[VEC_FPDIVZ] = dz_vec6;\r\nvectors[VEC_FPIR] = inex_vec6;\r\nvectors[VEC_LINE11] = fline_vec6;\r\nvectors[VEC_FPUNSUP] = unsupp_vec6;\r\nvectors[VEC_UNIMPEA] = effadd_vec6;\r\n}\r\nif (MACH_IS_AMIGA) {\r\nvectors[VEC_INT7] = nmihandler;\r\n}\r\n}
