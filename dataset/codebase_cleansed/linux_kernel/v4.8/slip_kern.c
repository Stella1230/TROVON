static void slip_init(struct net_device *dev, void *data)\r\n{\r\nstruct uml_net_private *private;\r\nstruct slip_data *spri;\r\nstruct slip_init *init = data;\r\nprivate = netdev_priv(dev);\r\nspri = (struct slip_data *) private->user;\r\nmemset(spri->name, 0, sizeof(spri->name));\r\nspri->addr = NULL;\r\nspri->gate_addr = init->gate_addr;\r\nspri->slave = -1;\r\nspri->dev = dev;\r\nslip_proto_init(&spri->slip);\r\ndev->hard_header_len = 0;\r\ndev->header_ops = NULL;\r\ndev->addr_len = 0;\r\ndev->type = ARPHRD_SLIP;\r\ndev->tx_queue_len = 256;\r\ndev->flags = IFF_NOARP;\r\nprintk("SLIP backend - SLIP IP = %s\n", spri->gate_addr);\r\n}\r\nstatic unsigned short slip_protocol(struct sk_buff *skbuff)\r\n{\r\nreturn htons(ETH_P_IP);\r\n}\r\nstatic int slip_read(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn slip_user_read(fd, skb_mac_header(skb), skb->dev->mtu,\r\n(struct slip_data *) &lp->user);\r\n}\r\nstatic int slip_write(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn slip_user_write(fd, skb->data, skb->len,\r\n(struct slip_data *) &lp->user);\r\n}\r\nstatic int slip_setup(char *str, char **mac_out, void *data)\r\n{\r\nstruct slip_init *init = data;\r\n*init = ((struct slip_init) { .gate_addr = NULL });\r\nif (str[0] != '\0')\r\ninit->gate_addr = str;\r\nreturn 1;\r\n}\r\nstatic int register_slip(void)\r\n{\r\nregister_transport(&slip_transport);\r\nreturn 0;\r\n}
