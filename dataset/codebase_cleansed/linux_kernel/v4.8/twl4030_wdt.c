static int twl4030_wdt_write(unsigned char val)\r\n{\r\nreturn twl_i2c_write_u8(TWL_MODULE_PM_RECEIVER, val,\r\nTWL4030_WATCHDOG_CFG_REG_OFFS);\r\n}\r\nstatic int twl4030_wdt_start(struct watchdog_device *wdt)\r\n{\r\nreturn twl4030_wdt_write(wdt->timeout + 1);\r\n}\r\nstatic int twl4030_wdt_stop(struct watchdog_device *wdt)\r\n{\r\nreturn twl4030_wdt_write(0);\r\n}\r\nstatic int twl4030_wdt_set_timeout(struct watchdog_device *wdt,\r\nunsigned int timeout)\r\n{\r\nwdt->timeout = timeout;\r\nreturn 0;\r\n}\r\nstatic int twl4030_wdt_probe(struct platform_device *pdev)\r\n{\r\nint ret = 0;\r\nstruct watchdog_device *wdt;\r\nwdt = devm_kzalloc(&pdev->dev, sizeof(*wdt), GFP_KERNEL);\r\nif (!wdt)\r\nreturn -ENOMEM;\r\nwdt->info = &twl4030_wdt_info;\r\nwdt->ops = &twl4030_wdt_ops;\r\nwdt->status = 0;\r\nwdt->timeout = 30;\r\nwdt->min_timeout = 1;\r\nwdt->max_timeout = 30;\r\nwdt->parent = &pdev->dev;\r\nwatchdog_set_nowayout(wdt, nowayout);\r\nplatform_set_drvdata(pdev, wdt);\r\ntwl4030_wdt_stop(wdt);\r\nret = watchdog_register_device(wdt);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int twl4030_wdt_remove(struct platform_device *pdev)\r\n{\r\nstruct watchdog_device *wdt = platform_get_drvdata(pdev);\r\nwatchdog_unregister_device(wdt);\r\nreturn 0;\r\n}\r\nstatic int twl4030_wdt_suspend(struct platform_device *pdev, pm_message_t state)\r\n{\r\nstruct watchdog_device *wdt = platform_get_drvdata(pdev);\r\nif (watchdog_active(wdt))\r\nreturn twl4030_wdt_stop(wdt);\r\nreturn 0;\r\n}\r\nstatic int twl4030_wdt_resume(struct platform_device *pdev)\r\n{\r\nstruct watchdog_device *wdt = platform_get_drvdata(pdev);\r\nif (watchdog_active(wdt))\r\nreturn twl4030_wdt_start(wdt);\r\nreturn 0;\r\n}
