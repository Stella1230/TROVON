static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nif (par->gpio.cs != -1)\r\ngpio_set_value(par->gpio.cs, 0);\r\nwrite_reg(par, 0x00, 0x0001);\r\nwrite_reg(par, 0x03, 0xA8A4);\r\nwrite_reg(par, 0x0C, 0x0000);\r\nwrite_reg(par, 0x0D, 0x080C);\r\nwrite_reg(par, 0x0E, 0x2B00);\r\nwrite_reg(par, 0x1E, 0x00B7);\r\nwrite_reg(par, 0x01,\r\n(1 << 13) | (par->bgr << 11) | (1 << 9) | (HEIGHT - 1));\r\nwrite_reg(par, 0x02, 0x0600);\r\nwrite_reg(par, 0x10, 0x0000);\r\nwrite_reg(par, 0x05, 0x0000);\r\nwrite_reg(par, 0x06, 0x0000);\r\nwrite_reg(par, 0x16, 0xEF1C);\r\nwrite_reg(par, 0x17, 0x0003);\r\nwrite_reg(par, 0x07, 0x0233);\r\nwrite_reg(par, 0x0B, 0x0000);\r\nwrite_reg(par, 0x0F, 0x0000);\r\nwrite_reg(par, 0x41, 0x0000);\r\nwrite_reg(par, 0x42, 0x0000);\r\nwrite_reg(par, 0x48, 0x0000);\r\nwrite_reg(par, 0x49, 0x013F);\r\nwrite_reg(par, 0x4A, 0x0000);\r\nwrite_reg(par, 0x4B, 0x0000);\r\nwrite_reg(par, 0x44, 0xEF00);\r\nwrite_reg(par, 0x45, 0x0000);\r\nwrite_reg(par, 0x46, 0x013F);\r\nwrite_reg(par, 0x23, 0x0000);\r\nwrite_reg(par, 0x24, 0x0000);\r\nwrite_reg(par, 0x25, 0x8000);\r\nwrite_reg(par, 0x4f, 0x0000);\r\nwrite_reg(par, 0x4e, 0x0000);\r\nwrite_reg(par, 0x22);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, 0x4e, xs);\r\nwrite_reg(par, 0x4f, ys);\r\nbreak;\r\ncase 180:\r\nwrite_reg(par, 0x4e, par->info->var.xres - 1 - xs);\r\nwrite_reg(par, 0x4f, par->info->var.yres - 1 - ys);\r\nbreak;\r\ncase 270:\r\nwrite_reg(par, 0x4e, par->info->var.yres - 1 - ys);\r\nwrite_reg(par, 0x4f, xs);\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, 0x4e, ys);\r\nwrite_reg(par, 0x4f, par->info->var.xres - 1 - xs);\r\nbreak;\r\n}\r\nwrite_reg(par, 0x22);\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\nif (par->fbtftops.init_display != init_display) {\r\nfbtft_par_dbg(DEBUG_INIT_DISPLAY, par,\r\n"%s: skipping since custom init_display() is used\n",\r\n__func__);\r\nreturn 0;\r\n}\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, 0x11, reg11 | 0x30);\r\nbreak;\r\ncase 270:\r\nwrite_reg(par, 0x11, reg11 | 0x28);\r\nbreak;\r\ncase 180:\r\nwrite_reg(par, 0x11, reg11 | 0x00);\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, 0x11, reg11 | 0x18);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, unsigned long *curves)\r\n{\r\nunsigned long mask[] = {\r\n0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\r\n0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\r\n};\r\nint i, j;\r\nfor (i = 0; i < 2; i++)\r\nfor (j = 0; j < 10; j++)\r\nCURVE(i, j) &= mask[i * par->gamma.num_values + j];\r\nwrite_reg(par, 0x0030, CURVE(0, 5) << 8 | CURVE(0, 4));\r\nwrite_reg(par, 0x0031, CURVE(0, 7) << 8 | CURVE(0, 6));\r\nwrite_reg(par, 0x0032, CURVE(0, 9) << 8 | CURVE(0, 8));\r\nwrite_reg(par, 0x0033, CURVE(0, 3) << 8 | CURVE(0, 2));\r\nwrite_reg(par, 0x0034, CURVE(1, 5) << 8 | CURVE(1, 4));\r\nwrite_reg(par, 0x0035, CURVE(1, 7) << 8 | CURVE(1, 6));\r\nwrite_reg(par, 0x0036, CURVE(1, 9) << 8 | CURVE(1, 8));\r\nwrite_reg(par, 0x0037, CURVE(1, 3) << 8 | CURVE(1, 2));\r\nwrite_reg(par, 0x003A, CURVE(0, 1) << 8 | CURVE(0, 0));\r\nwrite_reg(par, 0x003B, CURVE(1, 1) << 8 | CURVE(1, 0));\r\nreturn 0;\r\n}
