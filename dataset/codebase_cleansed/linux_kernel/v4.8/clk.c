unsigned long ltq_danube_fpi_hz(void)\r\n{\r\nunsigned long ddr_clock = DDR_HZ;\r\nif (ltq_cgu_r32(CGU_SYS) & 0x40)\r\nreturn ddr_clock >> 1;\r\nreturn ddr_clock;\r\n}\r\nunsigned long ltq_danube_cpu_hz(void)\r\n{\r\nswitch (ltq_cgu_r32(CGU_SYS) & 0xc) {\r\ncase 0:\r\nreturn CLOCK_333M;\r\ncase 4:\r\nreturn DDR_HZ;\r\ncase 8:\r\nreturn DDR_HZ << 1;\r\ndefault:\r\nreturn DDR_HZ >> 1;\r\n}\r\n}\r\nunsigned long ltq_danube_pp32_hz(void)\r\n{\r\nunsigned int clksys = (ltq_cgu_r32(CGU_SYS) >> 7) & 3;\r\nunsigned long clk;\r\nswitch (clksys) {\r\ncase 1:\r\nclk = CLOCK_240M;\r\nbreak;\r\ncase 2:\r\nclk = CLOCK_222M;\r\nbreak;\r\ncase 3:\r\nclk = CLOCK_133M;\r\nbreak;\r\ndefault:\r\nclk = CLOCK_266M;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_ar9_sys_hz(void)\r\n{\r\nif (((ltq_cgu_r32(CGU_SYS) >> 3) & 0x3) == 0x2)\r\nreturn CLOCK_393M;\r\nreturn CLOCK_333M;\r\n}\r\nunsigned long ltq_ar9_fpi_hz(void)\r\n{\r\nunsigned long sys = ltq_ar9_sys_hz();\r\nif (ltq_cgu_r32(CGU_SYS) & BIT(0))\r\nreturn sys / 3;\r\nelse\r\nreturn sys / 2;\r\n}\r\nunsigned long ltq_ar9_cpu_hz(void)\r\n{\r\nif (ltq_cgu_r32(CGU_SYS) & BIT(2))\r\nreturn ltq_ar9_fpi_hz();\r\nelse\r\nreturn ltq_ar9_sys_hz();\r\n}\r\nunsigned long ltq_vr9_cpu_hz(void)\r\n{\r\nunsigned int cpu_sel;\r\nunsigned long clk;\r\ncpu_sel = (ltq_cgu_r32(CGU_SYS_XRX) >> 4) & 0xf;\r\nswitch (cpu_sel) {\r\ncase 0:\r\nclk = CLOCK_600M;\r\nbreak;\r\ncase 1:\r\nclk = CLOCK_500M;\r\nbreak;\r\ncase 2:\r\nclk = CLOCK_393M;\r\nbreak;\r\ncase 3:\r\nclk = CLOCK_333M;\r\nbreak;\r\ncase 5:\r\ncase 6:\r\nclk = CLOCK_196_608M;\r\nbreak;\r\ncase 7:\r\nclk = CLOCK_167M;\r\nbreak;\r\ncase 4:\r\ncase 8:\r\ncase 9:\r\nclk = CLOCK_125M;\r\nbreak;\r\ndefault:\r\nclk = 0;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_vr9_fpi_hz(void)\r\n{\r\nunsigned int ocp_sel, cpu_clk;\r\nunsigned long clk;\r\ncpu_clk = ltq_vr9_cpu_hz();\r\nocp_sel = ltq_cgu_r32(CGU_SYS_XRX) & 0x3;\r\nswitch (ocp_sel) {\r\ncase 0:\r\nclk = cpu_clk;\r\nbreak;\r\ncase 2:\r\nclk = cpu_clk / 2;\r\nbreak;\r\ncase 3:\r\nclk = (cpu_clk * 2) / 5;\r\nbreak;\r\ncase 4:\r\nclk = cpu_clk / 3;\r\nbreak;\r\ndefault:\r\nclk = 0;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_vr9_pp32_hz(void)\r\n{\r\nunsigned int clksys = (ltq_cgu_r32(CGU_SYS) >> 16) & 0x7;\r\nunsigned long clk;\r\nswitch (clksys) {\r\ncase 0:\r\nclk = CLOCK_500M;\r\nbreak;\r\ncase 1:\r\nclk = CLOCK_432M;\r\nbreak;\r\ncase 2:\r\nclk = CLOCK_288M;\r\nbreak;\r\ndefault:\r\nclk = CLOCK_500M;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_ar10_cpu_hz(void)\r\n{\r\nunsigned int clksys;\r\nint cpu_fs = (ltq_cgu_r32(CGU_SYS_XRX) >> 8) & 0x1;\r\nint freq_div = (ltq_cgu_r32(CGU_SYS_XRX) >> 4) & 0x7;\r\nswitch (cpu_fs) {\r\ncase 0:\r\nclksys = CLOCK_500M;\r\nbreak;\r\ncase 1:\r\nclksys = CLOCK_600M;\r\nbreak;\r\ndefault:\r\nclksys = CLOCK_500M;\r\nbreak;\r\n}\r\nswitch (freq_div) {\r\ncase 0:\r\nreturn clksys;\r\ncase 1:\r\nreturn clksys >> 1;\r\ncase 2:\r\nreturn clksys >> 2;\r\ndefault:\r\nreturn clksys;\r\n}\r\n}\r\nunsigned long ltq_ar10_fpi_hz(void)\r\n{\r\nint freq_fpi = (ltq_cgu_r32(CGU_IF_CLK_AR10) >> 25) & 0xf;\r\nswitch (freq_fpi) {\r\ncase 1:\r\nreturn CLOCK_300M;\r\ncase 5:\r\nreturn CLOCK_250M;\r\ncase 2:\r\nreturn CLOCK_150M;\r\ncase 6:\r\nreturn CLOCK_125M;\r\ndefault:\r\nreturn CLOCK_125M;\r\n}\r\n}\r\nunsigned long ltq_ar10_pp32_hz(void)\r\n{\r\nunsigned int clksys = (ltq_cgu_r32(CGU_SYS) >> 16) & 0x7;\r\nunsigned long clk;\r\nswitch (clksys) {\r\ncase 1:\r\nclk = CLOCK_250M;\r\nbreak;\r\ncase 4:\r\nclk = CLOCK_400M;\r\nbreak;\r\ndefault:\r\nclk = CLOCK_250M;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_grx390_cpu_hz(void)\r\n{\r\nunsigned int clksys;\r\nint cpu_fs = ((ltq_cgu_r32(CGU_SYS_XRX) >> 9) & 0x3);\r\nint freq_div = ((ltq_cgu_r32(CGU_SYS_XRX) >> 4) & 0x7);\r\nswitch (cpu_fs) {\r\ncase 0:\r\nclksys = CLOCK_600M;\r\nbreak;\r\ncase 1:\r\nclksys = CLOCK_666M;\r\nbreak;\r\ncase 2:\r\nclksys = CLOCK_720M;\r\nbreak;\r\ndefault:\r\nclksys = CLOCK_600M;\r\nbreak;\r\n}\r\nswitch (freq_div) {\r\ncase 0:\r\nreturn clksys;\r\ncase 1:\r\nreturn clksys >> 1;\r\ncase 2:\r\nreturn clksys >> 2;\r\ndefault:\r\nreturn clksys;\r\n}\r\n}\r\nunsigned long ltq_grx390_fpi_hz(void)\r\n{\r\nunsigned int clksys;\r\nint cpu_fs = ((ltq_cgu_r32(CGU_SYS_XRX) >> 9) & 0x3);\r\nint freq_div = ((ltq_cgu_r32(CGU_SYS_XRX)) & 0x7);\r\nswitch (cpu_fs) {\r\ncase 0:\r\nclksys = CLOCK_600M;\r\nbreak;\r\ncase 1:\r\nclksys = CLOCK_666M;\r\nbreak;\r\ncase 2:\r\nclksys = CLOCK_720M;\r\nbreak;\r\ndefault:\r\nclksys = CLOCK_600M;\r\nbreak;\r\n}\r\nswitch (freq_div) {\r\ncase 1:\r\nreturn clksys >> 1;\r\ncase 2:\r\nreturn clksys >> 2;\r\ndefault:\r\nreturn clksys >> 1;\r\n}\r\n}\r\nunsigned long ltq_grx390_pp32_hz(void)\r\n{\r\nunsigned int clksys = (ltq_cgu_r32(CGU_SYS) >> 16) & 0x7;\r\nunsigned long clk;\r\nswitch (clksys) {\r\ncase 1:\r\nclk = CLOCK_250M;\r\nbreak;\r\ncase 2:\r\nclk = CLOCK_432M;\r\nbreak;\r\ncase 4:\r\nclk = CLOCK_400M;\r\nbreak;\r\ndefault:\r\nclk = CLOCK_250M;\r\nbreak;\r\n}\r\nreturn clk;\r\n}
