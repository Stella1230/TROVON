static void __init realview_pb11mp_map_io(void)\r\n{\r\niotable_init(realview_pb11mp_io_desc, ARRAY_SIZE(realview_pb11mp_io_desc));\r\n}\r\nstatic void __init gic_init_irq(void)\r\n{\r\nunsigned int pldctrl;\r\nwritel(0x0000a05f, __io_address(REALVIEW_SYS_LOCK));\r\npldctrl = readl(__io_address(REALVIEW_SYS_BASE) + REALVIEW_PB11MP_SYS_PLD_CTRL1);\r\npldctrl |= 2 << 22;\r\nwritel(pldctrl, __io_address(REALVIEW_SYS_BASE) + REALVIEW_PB11MP_SYS_PLD_CTRL1);\r\nwritel(0x00000000, __io_address(REALVIEW_SYS_LOCK));\r\ngic_init(0, 29, __io_address(REALVIEW_TC11MP_GIC_DIST_BASE),\r\n__io_address(REALVIEW_TC11MP_GIC_CPU_BASE));\r\ngic_init(1, IRQ_PB11MP_GIC_START,\r\n__io_address(REALVIEW_PB11MP_GIC_DIST_BASE),\r\n__io_address(REALVIEW_PB11MP_GIC_CPU_BASE));\r\ngic_cascade_irq(1, IRQ_TC11MP_PB_IRQ1);\r\n}\r\nstatic void __init realview_pb11mp_twd_init(void)\r\n{\r\nint err = twd_local_timer_register(&twd_local_timer);\r\nif (err)\r\npr_err("twd_local_timer_register failed %d\n", err);\r\n}\r\nstatic void __init realview_pb11mp_timer_init(void)\r\n{\r\ntimer0_va_base = __io_address(REALVIEW_PB11MP_TIMER0_1_BASE);\r\ntimer1_va_base = __io_address(REALVIEW_PB11MP_TIMER0_1_BASE) + 0x20;\r\ntimer2_va_base = __io_address(REALVIEW_PB11MP_TIMER2_3_BASE);\r\ntimer3_va_base = __io_address(REALVIEW_PB11MP_TIMER2_3_BASE) + 0x20;\r\nrealview_clk_init(__io_address(REALVIEW_SYS_BASE), false);\r\nrealview_timer_init(IRQ_TC11MP_TIMER0_1);\r\nrealview_pb11mp_twd_init();\r\n}\r\nstatic void realview_pb11mp_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nvoid __iomem *reset_ctrl = __io_address(REALVIEW_SYS_RESETCTL);\r\nvoid __iomem *lock_ctrl = __io_address(REALVIEW_SYS_LOCK);\r\n__raw_writel(REALVIEW_SYS_LOCK_VAL, lock_ctrl);\r\n__raw_writel(0x0000, reset_ctrl);\r\n__raw_writel(0x0004, reset_ctrl);\r\ndsb();\r\n}\r\nstatic void __init realview_pb11mp_init(void)\r\n{\r\nint i;\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_init(__io_address(REALVIEW_TC11MP_L220_BASE), 0x00790000, 0xfe000fff);\r\nouter_cache.sync = NULL;\r\n#endif\r\nrealview_flash_register(realview_pb11mp_flash_resource,\r\nARRAY_SIZE(realview_pb11mp_flash_resource));\r\nrealview_eth_register(NULL, realview_pb11mp_smsc911x_resources);\r\nplatform_device_register(&realview_i2c_device);\r\nplatform_device_register(&realview_cf_device);\r\nplatform_device_register(&realview_leds_device);\r\nrealview_usb_register(realview_pb11mp_isp1761_resources);\r\nplatform_device_register(&pmu_device);\r\nfor (i = 0; i < ARRAY_SIZE(amba_devs); i++) {\r\nstruct amba_device *d = amba_devs[i];\r\namba_device_register(d, &iomem_resource);\r\n}\r\n}
