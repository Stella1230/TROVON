static void update_dell_wmi_micmute_led(struct hda_codec *codec,\r\nstruct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nif (dell_old_cap_hook)\r\ndell_old_cap_hook(codec, kcontrol, ucontrol);\r\nif (!ucontrol || !dell_led_set_func)\r\nreturn;\r\nif (strcmp("Capture Switch", ucontrol->id.name) == 0 && ucontrol->id.index == 0) {\r\nint val = (ucontrol->value.integer.value[0] || ucontrol->value.integer.value[1]) ? 0 : 1;\r\nif (val == dell_led_value)\r\nreturn;\r\ndell_led_value = val;\r\nif (dell_led_set_func)\r\ndell_led_set_func(DELL_LED_MICMUTE, dell_led_value);\r\n}\r\n}\r\nstatic void alc_fixup_dell_wmi(struct hda_codec *codec,\r\nconst struct hda_fixup *fix, int action)\r\n{\r\nstruct alc_spec *spec = codec->spec;\r\nbool removefunc = false;\r\nif (action == HDA_FIXUP_ACT_PROBE) {\r\nif (!dell_led_set_func)\r\ndell_led_set_func = symbol_request(dell_app_wmi_led_set);\r\nif (!dell_led_set_func) {\r\ncodec_warn(codec, "Failed to find dell wmi symbol dell_app_wmi_led_set\n");\r\nreturn;\r\n}\r\nremovefunc = true;\r\nif (dell_led_set_func(DELL_LED_MICMUTE, false) >= 0) {\r\ndell_led_value = 0;\r\nif (spec->gen.num_adc_nids > 1)\r\ncodec_dbg(codec, "Skipping micmute LED control due to several ADCs");\r\nelse {\r\ndell_old_cap_hook = spec->gen.cap_sync_hook;\r\nspec->gen.cap_sync_hook = update_dell_wmi_micmute_led;\r\nremovefunc = false;\r\n}\r\n}\r\n}\r\nif (dell_led_set_func && (action == HDA_FIXUP_ACT_FREE || removefunc)) {\r\nsymbol_put(dell_app_wmi_led_set);\r\ndell_led_set_func = NULL;\r\ndell_old_cap_hook = NULL;\r\n}\r\n}\r\nstatic void alc_fixup_dell_wmi(struct hda_codec *codec,\r\nconst struct hda_fixup *fix, int action)\r\n{\r\n}
