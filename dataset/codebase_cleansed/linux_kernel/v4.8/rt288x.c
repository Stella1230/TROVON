static void rt288x_wdt_reset(void)\r\n{\r\nu32 t;\r\nt = rt_sysc_r32(SYSC_REG_CLKCFG);\r\nt |= CLKCFG_SRAM_CS_N_WDT;\r\nrt_sysc_w32(t, SYSC_REG_CLKCFG);\r\n}\r\nvoid __init ralink_clk_init(void)\r\n{\r\nunsigned long cpu_rate, wmac_rate = 40000000;\r\nu32 t = rt_sysc_r32(SYSC_REG_SYSTEM_CONFIG);\r\nt = ((t >> SYSTEM_CONFIG_CPUCLK_SHIFT) & SYSTEM_CONFIG_CPUCLK_MASK);\r\nswitch (t) {\r\ncase SYSTEM_CONFIG_CPUCLK_250:\r\ncpu_rate = 250000000;\r\nbreak;\r\ncase SYSTEM_CONFIG_CPUCLK_266:\r\ncpu_rate = 266666667;\r\nbreak;\r\ncase SYSTEM_CONFIG_CPUCLK_280:\r\ncpu_rate = 280000000;\r\nbreak;\r\ncase SYSTEM_CONFIG_CPUCLK_300:\r\ncpu_rate = 300000000;\r\nbreak;\r\n}\r\nralink_clk_add("cpu", cpu_rate);\r\nralink_clk_add("300100.timer", cpu_rate / 2);\r\nralink_clk_add("300120.watchdog", cpu_rate / 2);\r\nralink_clk_add("300500.uart", cpu_rate / 2);\r\nralink_clk_add("300c00.uartlite", cpu_rate / 2);\r\nralink_clk_add("400000.ethernet", cpu_rate / 2);\r\nralink_clk_add("480000.wmac", wmac_rate);\r\n}\r\nvoid __init ralink_of_remap(void)\r\n{\r\nrt_sysc_membase = plat_of_remap_node("ralink,rt2880-sysc");\r\nrt_memc_membase = plat_of_remap_node("ralink,rt2880-memc");\r\nif (!rt_sysc_membase || !rt_memc_membase)\r\npanic("Failed to remap core resources");\r\n}\r\nvoid prom_soc_init(struct ralink_soc_info *soc_info)\r\n{\r\nvoid __iomem *sysc = (void __iomem *) KSEG1ADDR(RT2880_SYSC_BASE);\r\nconst char *name;\r\nu32 n0;\r\nu32 n1;\r\nu32 id;\r\nn0 = __raw_readl(sysc + SYSC_REG_CHIP_NAME0);\r\nn1 = __raw_readl(sysc + SYSC_REG_CHIP_NAME1);\r\nid = __raw_readl(sysc + SYSC_REG_CHIP_ID);\r\nif (n0 == RT2880_CHIP_NAME0 && n1 == RT2880_CHIP_NAME1) {\r\nsoc_info->compatible = "ralink,r2880-soc";\r\nname = "RT2880";\r\n} else {\r\npanic("rt288x: unknown SoC, n0:%08x n1:%08x", n0, n1);\r\n}\r\nsnprintf(soc_info->sys_type, RAMIPS_SYS_TYPE_LEN,\r\n"Ralink %s id:%u rev:%u",\r\nname,\r\n(id >> CHIP_ID_ID_SHIFT) & CHIP_ID_ID_MASK,\r\n(id & CHIP_ID_REV_MASK));\r\nsoc_info->mem_base = RT2880_SDRAM_BASE;\r\nsoc_info->mem_size_min = RT2880_MEM_SIZE_MIN;\r\nsoc_info->mem_size_max = RT2880_MEM_SIZE_MAX;\r\nrt2880_pinmux_data = rt2880_pinmux_data_act;\r\nralink_soc = RT2880_SOC;\r\n}
