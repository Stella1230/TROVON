int bpf_prog1(struct pt_regs *ctx)\r\n{\r\nstruct seccomp_data sd;\r\nbpf_probe_read(&sd, sizeof(sd), (void *)PT_REGS_PARM1(ctx));\r\nbpf_tail_call(ctx, &progs, sd.nr);\r\nif (sd.nr >= __NR_getuid && sd.nr <= __NR_getsid) {\r\nchar fmt[] = "syscall=%d (one of get/set uid/pid/gid)\n";\r\nbpf_trace_printk(fmt, sizeof(fmt), sd.nr);\r\n}\r\nreturn 0;\r\n}\r\nPROG(__NR_write)(struct pt_regs *ctx)\r\n{\r\nstruct seccomp_data sd;\r\nbpf_probe_read(&sd, sizeof(sd), (void *)PT_REGS_PARM1(ctx));\r\nif (sd.args[2] == 512) {\r\nchar fmt[] = "write(fd=%d, buf=%p, size=%d)\n";\r\nbpf_trace_printk(fmt, sizeof(fmt),\r\nsd.args[0], sd.args[1], sd.args[2]);\r\n}\r\nreturn 0;\r\n}\r\nPROG(__NR_read)(struct pt_regs *ctx)\r\n{\r\nstruct seccomp_data sd;\r\nbpf_probe_read(&sd, sizeof(sd), (void *)PT_REGS_PARM1(ctx));\r\nif (sd.args[2] > 128 && sd.args[2] <= 1024) {\r\nchar fmt[] = "read(fd=%d, buf=%p, size=%d)\n";\r\nbpf_trace_printk(fmt, sizeof(fmt),\r\nsd.args[0], sd.args[1], sd.args[2]);\r\n}\r\nreturn 0;\r\n}\r\nPROG(__NR_mmap)(struct pt_regs *ctx)\r\n{\r\nchar fmt[] = "mmap\n";\r\nbpf_trace_printk(fmt, sizeof(fmt));\r\nreturn 0;\r\n}
