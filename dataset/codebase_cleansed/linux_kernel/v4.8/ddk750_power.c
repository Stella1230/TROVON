void ddk750_setDPMS(DPMS_t state)\r\n{\r\nunsigned int value;\r\nif (getChipType() == SM750LE) {\r\nvalue = PEEK32(CRT_DISPLAY_CTRL) & ~CRT_DISPLAY_CTRL_DPMS_MASK;\r\nvalue |= (state << CRT_DISPLAY_CTRL_DPMS_SHIFT);\r\nPOKE32(CRT_DISPLAY_CTRL, value);\r\n} else {\r\nvalue = PEEK32(SYSTEM_CTRL);\r\nvalue = (value & ~SYSTEM_CTRL_DPMS_MASK) | state;\r\nPOKE32(SYSTEM_CTRL, value);\r\n}\r\n}\r\nstatic unsigned int getPowerMode(void)\r\n{\r\nif (getChipType() == SM750LE)\r\nreturn 0;\r\nreturn PEEK32(POWER_MODE_CTRL) & POWER_MODE_CTRL_MODE_MASK;\r\n}\r\nvoid setPowerMode(unsigned int powerMode)\r\n{\r\nunsigned int control_value = 0;\r\ncontrol_value = PEEK32(POWER_MODE_CTRL) & ~POWER_MODE_CTRL_MODE_MASK;\r\nif (getChipType() == SM750LE)\r\nreturn;\r\nswitch (powerMode) {\r\ncase POWER_MODE_CTRL_MODE_MODE0:\r\ncontrol_value |= POWER_MODE_CTRL_MODE_MODE0;\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_MODE1:\r\ncontrol_value |= POWER_MODE_CTRL_MODE_MODE1;\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_SLEEP:\r\ncontrol_value |= POWER_MODE_CTRL_MODE_SLEEP;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (powerMode == POWER_MODE_CTRL_MODE_SLEEP) {\r\ncontrol_value &= ~POWER_MODE_CTRL_OSC_INPUT;\r\n#ifdef VALIDATION_CHIP\r\ncontrol_value &= ~POWER_MODE_CTRL_336CLK;\r\n#endif\r\n} else {\r\ncontrol_value |= POWER_MODE_CTRL_OSC_INPUT;\r\n#ifdef VALIDATION_CHIP\r\ncontrol_value |= POWER_MODE_CTRL_336CLK;\r\n#endif\r\n}\r\nPOKE32(POWER_MODE_CTRL, control_value);\r\n}\r\nvoid setCurrentGate(unsigned int gate)\r\n{\r\nunsigned int gate_reg;\r\nunsigned int mode;\r\nmode = getPowerMode();\r\nswitch (mode) {\r\ncase POWER_MODE_CTRL_MODE_MODE0:\r\ngate_reg = MODE0_GATE;\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_MODE1:\r\ngate_reg = MODE1_GATE;\r\nbreak;\r\ndefault:\r\ngate_reg = MODE0_GATE;\r\nbreak;\r\n}\r\nPOKE32(gate_reg, gate);\r\n}\r\nvoid enable2DEngine(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate |= (CURRENT_GATE_DE | CURRENT_GATE_CSC);\r\nelse\r\ngate &= ~(CURRENT_GATE_DE | CURRENT_GATE_CSC);\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableDMA(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate |= CURRENT_GATE_DMA;\r\nelse\r\ngate &= ~CURRENT_GATE_DMA;\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableGPIO(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate |= CURRENT_GATE_GPIO;\r\nelse\r\ngate &= ~CURRENT_GATE_GPIO;\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableI2C(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate |= CURRENT_GATE_I2C;\r\nelse\r\ngate &= ~CURRENT_GATE_I2C;\r\nsetCurrentGate(gate);\r\n}
