acpi_status\r\nacpi_ex_do_concatenate(union acpi_operand_object *operand0,\r\nunion acpi_operand_object *operand1,\r\nunion acpi_operand_object **actual_return_desc,\r\nstruct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object *local_operand0 = operand0;\r\nunion acpi_operand_object *local_operand1 = operand1;\r\nunion acpi_operand_object *temp_operand1 = NULL;\r\nunion acpi_operand_object *return_desc;\r\nchar *buffer;\r\nacpi_object_type operand0_type;\r\nacpi_object_type operand1_type;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ex_do_concatenate);\r\nswitch (operand0->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\ncase ACPI_TYPE_STRING:\r\ncase ACPI_TYPE_BUFFER:\r\noperand0_type = operand0->common.type;\r\nbreak;\r\ndefault:\r\nstatus =\r\nacpi_ex_convert_to_object_type_string(operand0,\r\n&local_operand0);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\noperand0_type = ACPI_TYPE_STRING;\r\nbreak;\r\n}\r\nswitch (operand1->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\ncase ACPI_TYPE_STRING:\r\ncase ACPI_TYPE_BUFFER:\r\noperand1_type = operand1->common.type;\r\nbreak;\r\ndefault:\r\nstatus =\r\nacpi_ex_convert_to_object_type_string(operand1,\r\n&local_operand1);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\noperand1_type = ACPI_TYPE_STRING;\r\nbreak;\r\n}\r\nswitch (operand0_type) {\r\ncase ACPI_TYPE_INTEGER:\r\nstatus =\r\nacpi_ex_convert_to_integer(local_operand1, &temp_operand1,\r\n16);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nstatus =\r\nacpi_ex_convert_to_buffer(local_operand1, &temp_operand1);\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nswitch (operand1_type) {\r\ncase ACPI_TYPE_INTEGER:\r\ncase ACPI_TYPE_STRING:\r\ncase ACPI_TYPE_BUFFER:\r\nstatus =\r\nacpi_ex_convert_to_string(local_operand1,\r\n&temp_operand1,\r\nACPI_IMPLICIT_CONVERT_HEX);\r\nbreak;\r\ndefault:\r\nstatus = AE_OK;\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Invalid object type: 0x%X",\r\noperand0->common.type));\r\nstatus = AE_AML_INTERNAL;\r\n}\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nif ((local_operand1 != operand1) && (local_operand1 != temp_operand1)) {\r\nacpi_ut_remove_reference(local_operand1);\r\n}\r\nlocal_operand1 = temp_operand1;\r\nswitch (operand0_type) {\r\ncase ACPI_TYPE_INTEGER:\r\nreturn_desc = acpi_ut_create_buffer_object((acpi_size)\r\nACPI_MUL_2\r\n(acpi_gbl_integer_byte_width));\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbuffer = (char *)return_desc->buffer.pointer;\r\nmemcpy(buffer, &operand0->integer.value,\r\nacpi_gbl_integer_byte_width);\r\nmemcpy(buffer + acpi_gbl_integer_byte_width,\r\n&local_operand1->integer.value,\r\nacpi_gbl_integer_byte_width);\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nreturn_desc = acpi_ut_create_string_object(((acpi_size)\r\nlocal_operand0->\r\nstring.length +\r\nlocal_operand1->\r\nstring.length));\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbuffer = return_desc->string.pointer;\r\nstrcpy(buffer, local_operand0->string.pointer);\r\nstrcat(buffer, local_operand1->string.pointer);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nreturn_desc = acpi_ut_create_buffer_object(((acpi_size)\r\noperand0->buffer.\r\nlength +\r\nlocal_operand1->\r\nbuffer.length));\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nbuffer = (char *)return_desc->buffer.pointer;\r\nmemcpy(buffer, operand0->buffer.pointer,\r\noperand0->buffer.length);\r\nmemcpy(buffer + operand0->buffer.length,\r\nlocal_operand1->buffer.pointer,\r\nlocal_operand1->buffer.length);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Invalid object type: 0x%X",\r\noperand0->common.type));\r\nstatus = AE_AML_INTERNAL;\r\ngoto cleanup;\r\n}\r\n*actual_return_desc = return_desc;\r\ncleanup:\r\nif (local_operand0 != operand0) {\r\nacpi_ut_remove_reference(local_operand0);\r\n}\r\nif (local_operand1 != operand1) {\r\nacpi_ut_remove_reference(local_operand1);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatic acpi_status\r\nacpi_ex_convert_to_object_type_string(union acpi_operand_object *obj_desc,\r\nunion acpi_operand_object **result_desc)\r\n{\r\nunion acpi_operand_object *return_desc;\r\nconst char *type_string;\r\ntype_string = acpi_ut_get_type_name(obj_desc->common.type);\r\nreturn_desc = acpi_ut_create_string_object(((acpi_size)strlen(type_string) + 9));\r\nif (!return_desc) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nstrcpy(return_desc->string.pointer, "[");\r\nstrcat(return_desc->string.pointer, type_string);\r\nstrcat(return_desc->string.pointer, " Object]");\r\n*result_desc = return_desc;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_ex_concat_template(union acpi_operand_object *operand0,\r\nunion acpi_operand_object *operand1,\r\nunion acpi_operand_object **actual_return_desc,\r\nstruct acpi_walk_state *walk_state)\r\n{\r\nacpi_status status;\r\nunion acpi_operand_object *return_desc;\r\nu8 *new_buf;\r\nu8 *end_tag;\r\nacpi_size length0;\r\nacpi_size length1;\r\nacpi_size new_length;\r\nACPI_FUNCTION_TRACE(ex_concat_template);\r\nstatus = acpi_ut_get_resource_end_tag(operand0, &end_tag);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nlength0 = ACPI_PTR_DIFF(end_tag, operand0->buffer.pointer);\r\nstatus = acpi_ut_get_resource_end_tag(operand1, &end_tag);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nlength1 = ACPI_PTR_DIFF(end_tag, operand1->buffer.pointer);\r\nnew_length = length0 + length1 + sizeof(struct aml_resource_end_tag);\r\nreturn_desc = acpi_ut_create_buffer_object(new_length);\r\nif (!return_desc) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\nnew_buf = return_desc->buffer.pointer;\r\nmemcpy(new_buf, operand0->buffer.pointer, length0);\r\nmemcpy(new_buf + length0, operand1->buffer.pointer, length1);\r\nnew_buf[new_length - 1] = 0;\r\nnew_buf[new_length - 2] = ACPI_RESOURCE_NAME_END_TAG | 1;\r\n*actual_return_desc = return_desc;\r\nreturn_ACPI_STATUS(AE_OK);\r\n}
