static inline struct clk *zx_divtbl(const char *name, const char *parent,\r\nvoid __iomem *reg, u8 shift, u8 width,\r\nconst struct clk_div_table *table)\r\n{\r\nreturn clk_register_divider_table(NULL, name, parent, 0, reg, shift,\r\nwidth, 0, table, &reg_lock);\r\n}\r\nstatic inline struct clk *zx_div(const char *name, const char *parent,\r\nvoid __iomem *reg, u8 shift, u8 width)\r\n{\r\nreturn clk_register_divider(NULL, name, parent, 0,\r\nreg, shift, width, 0, &reg_lock);\r\n}\r\nstatic inline struct clk *zx_mux(const char *name, const char * const *parents,\r\nint num_parents, void __iomem *reg, u8 shift, u8 width)\r\n{\r\nreturn clk_register_mux(NULL, name, parents, num_parents,\r\n0, reg, shift, width, 0, &reg_lock);\r\n}\r\nstatic inline struct clk *zx_gate(const char *name, const char *parent,\r\nvoid __iomem *reg, u8 shift)\r\n{\r\nreturn clk_register_gate(NULL, name, parent, CLK_IGNORE_UNUSED,\r\nreg, shift, CLK_SET_RATE_PARENT, &reg_lock);\r\n}\r\nstatic void __init zx296702_top_clocks_init(struct device_node *np)\r\n{\r\nstruct clk **clk = topclk;\r\nint i;\r\ntopcrm_base = of_iomap(np, 0);\r\nWARN_ON(!topcrm_base);\r\nclk[ZX296702_OSC] =\r\nclk_register_fixed_rate(NULL, "osc", NULL, 0, 30000000);\r\nclk[ZX296702_PLL_A9] =\r\nclk_register_zx_pll("pll_a9", "osc", 0, topcrm_base\r\n+ 0x01c, pll_a9_config,\r\nARRAY_SIZE(pll_a9_config), &reg_lock);\r\nclk[ZX296702_PLL_A9_350M] =\r\nclk_register_fixed_rate(NULL, "pll_a9_350M", "osc", 0,\r\n350000000);\r\nclk[ZX296702_PLL_MAC_1000M] =\r\nclk_register_fixed_rate(NULL, "pll_mac_1000M", "osc", 0,\r\n1000000000);\r\nclk[ZX296702_PLL_MAC_333M] =\r\nclk_register_fixed_rate(NULL, "pll_mac_333M", "osc", 0,\r\n333000000);\r\nclk[ZX296702_PLL_MM0_1188M] =\r\nclk_register_fixed_rate(NULL, "pll_mm0_1188M", "osc", 0,\r\n1188000000);\r\nclk[ZX296702_PLL_MM0_396M] =\r\nclk_register_fixed_rate(NULL, "pll_mm0_396M", "osc", 0,\r\n396000000);\r\nclk[ZX296702_PLL_MM0_198M] =\r\nclk_register_fixed_rate(NULL, "pll_mm0_198M", "osc", 0,\r\n198000000);\r\nclk[ZX296702_PLL_MM1_108M] =\r\nclk_register_fixed_rate(NULL, "pll_mm1_108M", "osc", 0,\r\n108000000);\r\nclk[ZX296702_PLL_MM1_72M] =\r\nclk_register_fixed_rate(NULL, "pll_mm1_72M", "osc", 0,\r\n72000000);\r\nclk[ZX296702_PLL_MM1_54M] =\r\nclk_register_fixed_rate(NULL, "pll_mm1_54M", "osc", 0,\r\n54000000);\r\nclk[ZX296702_PLL_LSP_104M] =\r\nclk_register_fixed_rate(NULL, "pll_lsp_104M", "osc", 0,\r\n104000000);\r\nclk[ZX296702_PLL_LSP_26M] =\r\nclk_register_fixed_rate(NULL, "pll_lsp_26M", "osc", 0,\r\n26000000);\r\nclk[ZX296702_PLL_DDR_266M] =\r\nclk_register_fixed_rate(NULL, "pll_ddr_266M", "osc", 0,\r\n266000000);\r\nclk[ZX296702_PLL_AUDIO_294M912] =\r\nclk_register_fixed_rate(NULL, "pll_audio_294M912", "osc", 0,\r\n294912000);\r\nclk[ZX296702_MATRIX_ACLK] =\r\nzx_mux("matrix_aclk", matrix_aclk_sel,\r\nARRAY_SIZE(matrix_aclk_sel), CLK_MUX, 2, 2);\r\nclk[ZX296702_MAIN_HCLK] =\r\nzx_divtbl("main_hclk", "matrix_aclk", CLK_DIV, 0, 2,\r\nmain_hlk_div);\r\nclk[ZX296702_MAIN_PCLK] =\r\nzx_divtbl("main_pclk", "matrix_aclk", CLK_DIV, 2, 2,\r\nmain_hlk_div);\r\nclk[ZX296702_CLK_500] =\r\nclk_register_fixed_factor(NULL, "clk_500", "pll_mac_1000M", 0,\r\n1, 2);\r\nclk[ZX296702_CLK_250] =\r\nclk_register_fixed_factor(NULL, "clk_250", "pll_mac_1000M", 0,\r\n1, 4);\r\nclk[ZX296702_CLK_125] =\r\nclk_register_fixed_factor(NULL, "clk_125", "clk_250", 0, 1, 2);\r\nclk[ZX296702_CLK_148M5] =\r\nclk_register_fixed_factor(NULL, "clk_148M5", "pll_mm0_1188M", 0,\r\n1, 8);\r\nclk[ZX296702_CLK_74M25] =\r\nclk_register_fixed_factor(NULL, "clk_74M25", "pll_mm0_1188M", 0,\r\n1, 16);\r\nclk[ZX296702_A9_WCLK] =\r\nzx_mux("a9_wclk", a9_wclk_sel, ARRAY_SIZE(a9_wclk_sel), CLK_MUX,\r\n0, 2);\r\nclk[ZX296702_A9_AS1_ACLK_MUX] =\r\nzx_mux("a9_as1_aclk_mux", a9_as1_aclk_sel,\r\nARRAY_SIZE(a9_as1_aclk_sel), CLK_MUX, 4, 2);\r\nclk[ZX296702_A9_TRACE_CLKIN_MUX] =\r\nzx_mux("a9_trace_clkin_mux", a9_trace_clkin_sel,\r\nARRAY_SIZE(a9_trace_clkin_sel), CLK_MUX1, 0, 2);\r\nclk[ZX296702_A9_AS1_ACLK_DIV] =\r\nzx_divtbl("a9_as1_aclk_div", "a9_as1_aclk_mux", CLK_DIV, 4, 2,\r\na9_as1_aclk_divider);\r\nclk[ZX296702_CLK_2] =\r\nclk_register_fixed_factor(NULL, "clk_2", "pll_mm1_72M", 0,\r\n1, 36);\r\nclk[ZX296702_CLK_27] =\r\nclk_register_fixed_factor(NULL, "clk_27", "pll_mm1_54M", 0,\r\n1, 2);\r\nclk[ZX296702_DECPPU_ACLK_MUX] =\r\nzx_mux("decppu_aclk_mux", decppu_aclk_sel,\r\nARRAY_SIZE(decppu_aclk_sel), CLK_MUX, 6, 2);\r\nclk[ZX296702_PPU_ACLK_MUX] =\r\nzx_mux("ppu_aclk_mux", decppu_aclk_sel,\r\nARRAY_SIZE(decppu_aclk_sel), CLK_MUX, 8, 2);\r\nclk[ZX296702_MALI400_ACLK_MUX] =\r\nzx_mux("mali400_aclk_mux", decppu_aclk_sel,\r\nARRAY_SIZE(decppu_aclk_sel), CLK_MUX, 12, 2);\r\nclk[ZX296702_VOU_ACLK_MUX] =\r\nzx_mux("vou_aclk_mux", decppu_aclk_sel,\r\nARRAY_SIZE(decppu_aclk_sel), CLK_MUX, 10, 2);\r\nclk[ZX296702_VOU_MAIN_WCLK_MUX] =\r\nzx_mux("vou_main_wclk_mux", vou_main_wclk_sel,\r\nARRAY_SIZE(vou_main_wclk_sel), CLK_MUX, 14, 2);\r\nclk[ZX296702_VOU_AUX_WCLK_MUX] =\r\nzx_mux("vou_aux_wclk_mux", vou_main_wclk_sel,\r\nARRAY_SIZE(vou_main_wclk_sel), CLK_MUX, 16, 2);\r\nclk[ZX296702_VOU_SCALER_WCLK_MUX] =\r\nzx_mux("vou_scaler_wclk_mux", vou_scaler_wclk_sel,\r\nARRAY_SIZE(vou_scaler_wclk_sel), CLK_MUX,\r\n18, 2);\r\nclk[ZX296702_R2D_ACLK_MUX] =\r\nzx_mux("r2d_aclk_mux", decppu_aclk_sel,\r\nARRAY_SIZE(decppu_aclk_sel), CLK_MUX, 20, 2);\r\nclk[ZX296702_R2D_WCLK_MUX] =\r\nzx_mux("r2d_wclk_mux", r2d_wclk_sel,\r\nARRAY_SIZE(r2d_wclk_sel), CLK_MUX, 22, 2);\r\nclk[ZX296702_CLK_50] =\r\nclk_register_fixed_factor(NULL, "clk_50", "pll_mac_1000M",\r\n0, 1, 20);\r\nclk[ZX296702_CLK_25] =\r\nclk_register_fixed_factor(NULL, "clk_25", "pll_mac_1000M",\r\n0, 1, 40);\r\nclk[ZX296702_CLK_12] =\r\nclk_register_fixed_factor(NULL, "clk_12", "pll_mm1_72M",\r\n0, 1, 6);\r\nclk[ZX296702_CLK_16M384] =\r\nclk_register_fixed_factor(NULL, "clk_16M384",\r\n"pll_audio_294M912", 0, 1, 18);\r\nclk[ZX296702_CLK_32K768] =\r\nclk_register_fixed_factor(NULL, "clk_32K768", "clk_16M384",\r\n0, 1, 500);\r\nclk[ZX296702_SEC_WCLK_DIV] =\r\nzx_divtbl("sec_wclk_div", "pll_lsp_104M", CLK_DIV, 6, 3,\r\nsec_wclk_divider);\r\nclk[ZX296702_DDR_WCLK_MUX] =\r\nzx_mux("ddr_wclk_mux", ddr_wclk_sel,\r\nARRAY_SIZE(ddr_wclk_sel), CLK_MUX, 24, 2);\r\nclk[ZX296702_NAND_WCLK_MUX] =\r\nzx_mux("nand_wclk_mux", nand_wclk_sel,\r\nARRAY_SIZE(nand_wclk_sel), CLK_MUX, 24, 2);\r\nclk[ZX296702_LSP_26_WCLK_MUX] =\r\nzx_mux("lsp_26_wclk_mux", lsp_26_wclk_sel,\r\nARRAY_SIZE(lsp_26_wclk_sel), CLK_MUX, 27, 1);\r\nclk[ZX296702_A9_AS0_ACLK] =\r\nzx_gate("a9_as0_aclk", "matrix_aclk", CLK_EN0, 0);\r\nclk[ZX296702_A9_AS1_ACLK] =\r\nzx_gate("a9_as1_aclk", "a9_as1_aclk_div", CLK_EN0, 1);\r\nclk[ZX296702_A9_TRACE_CLKIN] =\r\nzx_gate("a9_trace_clkin", "a9_trace_clkin_mux", CLK_EN0, 2);\r\nclk[ZX296702_DECPPU_AXI_M_ACLK] =\r\nzx_gate("decppu_axi_m_aclk", "decppu_aclk_mux", CLK_EN0, 3);\r\nclk[ZX296702_DECPPU_AHB_S_HCLK] =\r\nzx_gate("decppu_ahb_s_hclk", "main_hclk", CLK_EN0, 4);\r\nclk[ZX296702_PPU_AXI_M_ACLK] =\r\nzx_gate("ppu_axi_m_aclk", "ppu_aclk_mux", CLK_EN0, 5);\r\nclk[ZX296702_PPU_AHB_S_HCLK] =\r\nzx_gate("ppu_ahb_s_hclk", "main_hclk", CLK_EN0, 6);\r\nclk[ZX296702_VOU_AXI_M_ACLK] =\r\nzx_gate("vou_axi_m_aclk", "vou_aclk_mux", CLK_EN0, 7);\r\nclk[ZX296702_VOU_APB_PCLK] =\r\nzx_gate("vou_apb_pclk", "main_pclk", CLK_EN0, 8);\r\nclk[ZX296702_VOU_MAIN_CHANNEL_WCLK] =\r\nzx_gate("vou_main_channel_wclk", "vou_main_wclk_mux",\r\nCLK_EN0, 9);\r\nclk[ZX296702_VOU_AUX_CHANNEL_WCLK] =\r\nzx_gate("vou_aux_channel_wclk", "vou_aux_wclk_mux",\r\nCLK_EN0, 10);\r\nclk[ZX296702_VOU_HDMI_OSCLK_CEC] =\r\nzx_gate("vou_hdmi_osclk_cec", "clk_2", CLK_EN0, 11);\r\nclk[ZX296702_VOU_SCALER_WCLK] =\r\nzx_gate("vou_scaler_wclk", "vou_scaler_wclk_mux", CLK_EN0, 12);\r\nclk[ZX296702_MALI400_AXI_M_ACLK] =\r\nzx_gate("mali400_axi_m_aclk", "mali400_aclk_mux", CLK_EN0, 13);\r\nclk[ZX296702_MALI400_APB_PCLK] =\r\nzx_gate("mali400_apb_pclk", "main_pclk", CLK_EN0, 14);\r\nclk[ZX296702_R2D_WCLK] =\r\nzx_gate("r2d_wclk", "r2d_wclk_mux", CLK_EN0, 15);\r\nclk[ZX296702_R2D_AXI_M_ACLK] =\r\nzx_gate("r2d_axi_m_aclk", "r2d_aclk_mux", CLK_EN0, 16);\r\nclk[ZX296702_R2D_AHB_HCLK] =\r\nzx_gate("r2d_ahb_hclk", "main_hclk", CLK_EN0, 17);\r\nclk[ZX296702_DDR3_AXI_S0_ACLK] =\r\nzx_gate("ddr3_axi_s0_aclk", "matrix_aclk", CLK_EN0, 18);\r\nclk[ZX296702_DDR3_APB_PCLK] =\r\nzx_gate("ddr3_apb_pclk", "main_pclk", CLK_EN0, 19);\r\nclk[ZX296702_DDR3_WCLK] =\r\nzx_gate("ddr3_wclk", "ddr_wclk_mux", CLK_EN0, 20);\r\nclk[ZX296702_USB20_0_AHB_HCLK] =\r\nzx_gate("usb20_0_ahb_hclk", "main_hclk", CLK_EN0, 21);\r\nclk[ZX296702_USB20_0_EXTREFCLK] =\r\nzx_gate("usb20_0_extrefclk", "clk_12", CLK_EN0, 22);\r\nclk[ZX296702_USB20_1_AHB_HCLK] =\r\nzx_gate("usb20_1_ahb_hclk", "main_hclk", CLK_EN0, 23);\r\nclk[ZX296702_USB20_1_EXTREFCLK] =\r\nzx_gate("usb20_1_extrefclk", "clk_12", CLK_EN0, 24);\r\nclk[ZX296702_USB20_2_AHB_HCLK] =\r\nzx_gate("usb20_2_ahb_hclk", "main_hclk", CLK_EN0, 25);\r\nclk[ZX296702_USB20_2_EXTREFCLK] =\r\nzx_gate("usb20_2_extrefclk", "clk_12", CLK_EN0, 26);\r\nclk[ZX296702_GMAC_AXI_M_ACLK] =\r\nzx_gate("gmac_axi_m_aclk", "matrix_aclk", CLK_EN0, 27);\r\nclk[ZX296702_GMAC_APB_PCLK] =\r\nzx_gate("gmac_apb_pclk", "main_pclk", CLK_EN0, 28);\r\nclk[ZX296702_GMAC_125_CLKIN] =\r\nzx_gate("gmac_125_clkin", "clk_125", CLK_EN0, 29);\r\nclk[ZX296702_GMAC_RMII_CLKIN] =\r\nzx_gate("gmac_rmii_clkin", "clk_50", CLK_EN0, 30);\r\nclk[ZX296702_GMAC_25M_CLK] =\r\nzx_gate("gmac_25M_clk", "clk_25", CLK_EN0, 31);\r\nclk[ZX296702_NANDFLASH_AHB_HCLK] =\r\nzx_gate("nandflash_ahb_hclk", "main_hclk", CLK_EN1, 0);\r\nclk[ZX296702_NANDFLASH_WCLK] =\r\nzx_gate("nandflash_wclk", "nand_wclk_mux", CLK_EN1, 1);\r\nclk[ZX296702_LSP0_APB_PCLK] =\r\nzx_gate("lsp0_apb_pclk", "main_pclk", CLK_EN1, 2);\r\nclk[ZX296702_LSP0_AHB_HCLK] =\r\nzx_gate("lsp0_ahb_hclk", "main_hclk", CLK_EN1, 3);\r\nclk[ZX296702_LSP0_26M_WCLK] =\r\nzx_gate("lsp0_26M_wclk", "lsp_26_wclk_mux", CLK_EN1, 4);\r\nclk[ZX296702_LSP0_104M_WCLK] =\r\nzx_gate("lsp0_104M_wclk", "pll_lsp_104M", CLK_EN1, 5);\r\nclk[ZX296702_LSP0_16M384_WCLK] =\r\nzx_gate("lsp0_16M384_wclk", "clk_16M384", CLK_EN1, 6);\r\nclk[ZX296702_LSP1_APB_PCLK] =\r\nzx_gate("lsp1_apb_pclk", "main_pclk", CLK_EN1, 7);\r\nclk[ZX296702_LSP1_26M_WCLK] =\r\nzx_gate("lsp1_26M_wclk", "lsp_26_wclk_mux", CLK_EN1, 31);\r\nclk[ZX296702_LSP1_104M_WCLK] =\r\nzx_gate("lsp1_104M_wclk", "pll_lsp_104M", CLK_EN1, 9);\r\nclk[ZX296702_LSP1_32K_CLK] =\r\nzx_gate("lsp1_32K_clk", "clk_32K768", CLK_EN1, 10);\r\nclk[ZX296702_AON_HCLK] =\r\nzx_gate("aon_hclk", "main_hclk", CLK_EN1, 11);\r\nclk[ZX296702_SYS_CTRL_PCLK] =\r\nzx_gate("sys_ctrl_pclk", "main_pclk", CLK_EN1, 12);\r\nclk[ZX296702_DMA_PCLK] =\r\nzx_gate("dma_pclk", "main_pclk", CLK_EN1, 13);\r\nclk[ZX296702_DMA_ACLK] =\r\nzx_gate("dma_aclk", "matrix_aclk", CLK_EN1, 14);\r\nclk[ZX296702_SEC_HCLK] =\r\nzx_gate("sec_hclk", "main_hclk", CLK_EN1, 15);\r\nclk[ZX296702_AES_WCLK] =\r\nzx_gate("aes_wclk", "sec_wclk_div", CLK_EN1, 16);\r\nclk[ZX296702_DES_WCLK] =\r\nzx_gate("des_wclk", "sec_wclk_div", CLK_EN1, 17);\r\nclk[ZX296702_IRAM_ACLK] =\r\nzx_gate("iram_aclk", "matrix_aclk", CLK_EN1, 18);\r\nclk[ZX296702_IROM_ACLK] =\r\nzx_gate("irom_aclk", "matrix_aclk", CLK_EN1, 19);\r\nclk[ZX296702_BOOT_CTRL_HCLK] =\r\nzx_gate("boot_ctrl_hclk", "main_hclk", CLK_EN1, 20);\r\nclk[ZX296702_EFUSE_CLK_30] =\r\nzx_gate("efuse_clk_30", "osc", CLK_EN1, 21);\r\nclk[ZX296702_VOU_MAIN_CHANNEL_DIV] =\r\nzx_div("vou_main_channel_div", "vou_main_channel_wclk",\r\nVOU_LOCAL_DIV2_SET, 1, 1);\r\nclk[ZX296702_VOU_AUX_CHANNEL_DIV] =\r\nzx_div("vou_aux_channel_div", "vou_aux_channel_wclk",\r\nVOU_LOCAL_DIV2_SET, 0, 1);\r\nclk[ZX296702_VOU_TV_ENC_HD_DIV] =\r\nzx_div("vou_tv_enc_hd_div", "vou_tv_enc_hd_mux",\r\nVOU_LOCAL_DIV2_SET, 3, 1);\r\nclk[ZX296702_VOU_TV_ENC_SD_DIV] =\r\nzx_div("vou_tv_enc_sd_div", "vou_tv_enc_sd_mux",\r\nVOU_LOCAL_DIV2_SET, 2, 1);\r\nclk[ZX296702_VL0_MUX] =\r\nzx_mux("vl0_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 8, 1);\r\nclk[ZX296702_VL1_MUX] =\r\nzx_mux("vl1_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 9, 1);\r\nclk[ZX296702_VL2_MUX] =\r\nzx_mux("vl2_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 10, 1);\r\nclk[ZX296702_GL0_MUX] =\r\nzx_mux("gl0_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 5, 1);\r\nclk[ZX296702_GL1_MUX] =\r\nzx_mux("gl1_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 6, 1);\r\nclk[ZX296702_GL2_MUX] =\r\nzx_mux("gl2_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 7, 1);\r\nclk[ZX296702_WB_MUX] =\r\nzx_mux("wb_mux", vl0_sel, ARRAY_SIZE(vl0_sel),\r\nVOU_LOCAL_CLKSEL, 11, 1);\r\nclk[ZX296702_HDMI_MUX] =\r\nzx_mux("hdmi_mux", hdmi_sel, ARRAY_SIZE(hdmi_sel),\r\nVOU_LOCAL_CLKSEL, 4, 1);\r\nclk[ZX296702_VOU_TV_ENC_HD_MUX] =\r\nzx_mux("vou_tv_enc_hd_mux", hdmi_sel, ARRAY_SIZE(hdmi_sel),\r\nVOU_LOCAL_CLKSEL, 3, 1);\r\nclk[ZX296702_VOU_TV_ENC_SD_MUX] =\r\nzx_mux("vou_tv_enc_sd_mux", hdmi_sel, ARRAY_SIZE(hdmi_sel),\r\nVOU_LOCAL_CLKSEL, 2, 1);\r\nclk[ZX296702_VL0_CLK] =\r\nzx_gate("vl0_clk", "vl0_mux", VOU_LOCAL_CLKEN, 8);\r\nclk[ZX296702_VL1_CLK] =\r\nzx_gate("vl1_clk", "vl1_mux", VOU_LOCAL_CLKEN, 9);\r\nclk[ZX296702_VL2_CLK] =\r\nzx_gate("vl2_clk", "vl2_mux", VOU_LOCAL_CLKEN, 10);\r\nclk[ZX296702_GL0_CLK] =\r\nzx_gate("gl0_clk", "gl0_mux", VOU_LOCAL_CLKEN, 5);\r\nclk[ZX296702_GL1_CLK] =\r\nzx_gate("gl1_clk", "gl1_mux", VOU_LOCAL_CLKEN, 6);\r\nclk[ZX296702_GL2_CLK] =\r\nzx_gate("gl2_clk", "gl2_mux", VOU_LOCAL_CLKEN, 7);\r\nclk[ZX296702_WB_CLK] =\r\nzx_gate("wb_clk", "wb_mux", VOU_LOCAL_CLKEN, 11);\r\nclk[ZX296702_CL_CLK] =\r\nzx_gate("cl_clk", "vou_main_channel_div", VOU_LOCAL_CLKEN, 12);\r\nclk[ZX296702_MAIN_MIX_CLK] =\r\nzx_gate("main_mix_clk", "vou_main_channel_div",\r\nVOU_LOCAL_CLKEN, 4);\r\nclk[ZX296702_AUX_MIX_CLK] =\r\nzx_gate("aux_mix_clk", "vou_aux_channel_div",\r\nVOU_LOCAL_CLKEN, 3);\r\nclk[ZX296702_HDMI_CLK] =\r\nzx_gate("hdmi_clk", "hdmi_mux", VOU_LOCAL_CLKEN, 2);\r\nclk[ZX296702_VOU_TV_ENC_HD_DAC_CLK] =\r\nzx_gate("vou_tv_enc_hd_dac_clk", "vou_tv_enc_hd_div",\r\nVOU_LOCAL_CLKEN, 1);\r\nclk[ZX296702_VOU_TV_ENC_SD_DAC_CLK] =\r\nzx_gate("vou_tv_enc_sd_dac_clk", "vou_tv_enc_sd_div",\r\nVOU_LOCAL_CLKEN, 0);\r\nclk[ZX296702_A9_PERIPHCLK] =\r\nclk_register_fixed_factor(NULL, "a9_periphclk", "a9_wclk",\r\n0, 1, 2);\r\nfor (i = 0; i < ARRAY_SIZE(topclk); i++) {\r\nif (IS_ERR(clk[i])) {\r\npr_err("zx296702 clk %d: register failed with %ld\n",\r\ni, PTR_ERR(clk[i]));\r\nreturn;\r\n}\r\n}\r\ntopclk_data.clks = topclk;\r\ntopclk_data.clk_num = ARRAY_SIZE(topclk);\r\nof_clk_add_provider(np, of_clk_src_onecell_get, &topclk_data);\r\n}\r\nstatic void __init zx296702_lsp0_clocks_init(struct device_node *np)\r\n{\r\nstruct clk **clk = lsp0clk;\r\nint i;\r\nlsp0crpm_base = of_iomap(np, 0);\r\nWARN_ON(!lsp0crpm_base);\r\nclk[ZX296702_SDMMC1_WCLK_MUX] =\r\nzx_mux("sdmmc1_wclk_mux", sdmmc1_wclk_sel,\r\nARRAY_SIZE(sdmmc1_wclk_sel), CLK_SDMMC1, 4, 1);\r\nclk[ZX296702_SDMMC1_WCLK_DIV] =\r\nzx_div("sdmmc1_wclk_div", "sdmmc1_wclk_mux", CLK_SDMMC1, 12, 4);\r\nclk[ZX296702_SDMMC1_WCLK] =\r\nzx_gate("sdmmc1_wclk", "sdmmc1_wclk_div", CLK_SDMMC1, 1);\r\nclk[ZX296702_SDMMC1_PCLK] =\r\nzx_gate("sdmmc1_pclk", "lsp0_apb_pclk", CLK_SDMMC1, 0);\r\nclk[ZX296702_GPIO_CLK] =\r\nzx_gate("gpio_clk", "lsp0_apb_pclk", CLK_GPIO, 0);\r\nclk[ZX296702_SPDIF0_WCLK_MUX] =\r\nzx_mux("spdif0_wclk_mux", spdif0_wclk_sel,\r\nARRAY_SIZE(spdif0_wclk_sel), CLK_SPDIF0, 4, 1);\r\nclk[ZX296702_SPDIF0_WCLK] =\r\nzx_gate("spdif0_wclk", "spdif0_wclk_mux", CLK_SPDIF0, 1);\r\nclk[ZX296702_SPDIF0_PCLK] =\r\nzx_gate("spdif0_pclk", "lsp0_apb_pclk", CLK_SPDIF0, 0);\r\nclk[ZX296702_SPDIF0_DIV] =\r\nclk_register_zx_audio("spdif0_div", "spdif0_wclk", 0,\r\nSPDIF0_DIV);\r\nclk[ZX296702_I2S0_WCLK_MUX] =\r\nzx_mux("i2s0_wclk_mux", i2s_wclk_sel,\r\nARRAY_SIZE(i2s_wclk_sel), CLK_I2S0, 4, 1);\r\nclk[ZX296702_I2S0_WCLK] =\r\nzx_gate("i2s0_wclk", "i2s0_wclk_mux", CLK_I2S0, 1);\r\nclk[ZX296702_I2S0_PCLK] =\r\nzx_gate("i2s0_pclk", "lsp0_apb_pclk", CLK_I2S0, 0);\r\nclk[ZX296702_I2S0_DIV] =\r\nclk_register_zx_audio("i2s0_div", "i2s0_wclk", 0, I2S0_DIV);\r\nclk[ZX296702_I2S1_WCLK_MUX] =\r\nzx_mux("i2s1_wclk_mux", i2s_wclk_sel,\r\nARRAY_SIZE(i2s_wclk_sel), CLK_I2S1, 4, 1);\r\nclk[ZX296702_I2S1_WCLK] =\r\nzx_gate("i2s1_wclk", "i2s1_wclk_mux", CLK_I2S1, 1);\r\nclk[ZX296702_I2S1_PCLK] =\r\nzx_gate("i2s1_pclk", "lsp0_apb_pclk", CLK_I2S1, 0);\r\nclk[ZX296702_I2S1_DIV] =\r\nclk_register_zx_audio("i2s1_div", "i2s1_wclk", 0, I2S1_DIV);\r\nclk[ZX296702_I2S2_WCLK_MUX] =\r\nzx_mux("i2s2_wclk_mux", i2s_wclk_sel,\r\nARRAY_SIZE(i2s_wclk_sel), CLK_I2S2, 4, 1);\r\nclk[ZX296702_I2S2_WCLK] =\r\nzx_gate("i2s2_wclk", "i2s2_wclk_mux", CLK_I2S2, 1);\r\nclk[ZX296702_I2S2_PCLK] =\r\nzx_gate("i2s2_pclk", "lsp0_apb_pclk", CLK_I2S2, 0);\r\nclk[ZX296702_I2S2_DIV] =\r\nclk_register_zx_audio("i2s2_div", "i2s2_wclk", 0, I2S2_DIV);\r\nfor (i = 0; i < ARRAY_SIZE(lsp0clk); i++) {\r\nif (IS_ERR(clk[i])) {\r\npr_err("zx296702 clk %d: register failed with %ld\n",\r\ni, PTR_ERR(clk[i]));\r\nreturn;\r\n}\r\n}\r\nlsp0clk_data.clks = lsp0clk;\r\nlsp0clk_data.clk_num = ARRAY_SIZE(lsp0clk);\r\nof_clk_add_provider(np, of_clk_src_onecell_get, &lsp0clk_data);\r\n}\r\nstatic void __init zx296702_lsp1_clocks_init(struct device_node *np)\r\n{\r\nstruct clk **clk = lsp1clk;\r\nint i;\r\nlsp1crpm_base = of_iomap(np, 0);\r\nWARN_ON(!lsp1crpm_base);\r\nclk[ZX296702_UART0_WCLK_MUX] =\r\nzx_mux("uart0_wclk_mux", uart_wclk_sel,\r\nARRAY_SIZE(uart_wclk_sel), CLK_UART0, 4, 1);\r\nclk[ZX296702_UART0_WCLK] =\r\nzx_gate("uart0_wclk", "uart0_wclk_mux", CLK_UART0, 31);\r\nclk[ZX296702_UART0_PCLK] =\r\nzx_gate("uart0_pclk", "lsp1_apb_pclk", CLK_UART0, 0);\r\nclk[ZX296702_UART1_WCLK_MUX] =\r\nzx_mux("uart1_wclk_mux", uart_wclk_sel,\r\nARRAY_SIZE(uart_wclk_sel), CLK_UART1, 4, 1);\r\nclk[ZX296702_UART1_WCLK] =\r\nzx_gate("uart1_wclk", "uart1_wclk_mux", CLK_UART1, 1);\r\nclk[ZX296702_UART1_PCLK] =\r\nzx_gate("uart1_pclk", "lsp1_apb_pclk", CLK_UART1, 0);\r\nclk[ZX296702_SDMMC0_WCLK_MUX] =\r\nzx_mux("sdmmc0_wclk_mux", sdmmc0_wclk_sel,\r\nARRAY_SIZE(sdmmc0_wclk_sel), CLK_SDMMC0, 4, 1);\r\nclk[ZX296702_SDMMC0_WCLK_DIV] =\r\nzx_div("sdmmc0_wclk_div", "sdmmc0_wclk_mux", CLK_SDMMC0, 12, 4);\r\nclk[ZX296702_SDMMC0_WCLK] =\r\nzx_gate("sdmmc0_wclk", "sdmmc0_wclk_div", CLK_SDMMC0, 1);\r\nclk[ZX296702_SDMMC0_PCLK] =\r\nzx_gate("sdmmc0_pclk", "lsp1_apb_pclk", CLK_SDMMC0, 0);\r\nclk[ZX296702_SPDIF1_WCLK_MUX] =\r\nzx_mux("spdif1_wclk_mux", spdif1_wclk_sel,\r\nARRAY_SIZE(spdif1_wclk_sel), CLK_SPDIF1, 4, 1);\r\nclk[ZX296702_SPDIF1_WCLK] =\r\nzx_gate("spdif1_wclk", "spdif1_wclk_mux", CLK_SPDIF1, 1);\r\nclk[ZX296702_SPDIF1_PCLK] =\r\nzx_gate("spdif1_pclk", "lsp1_apb_pclk", CLK_SPDIF1, 0);\r\nclk[ZX296702_SPDIF1_DIV] =\r\nclk_register_zx_audio("spdif1_div", "spdif1_wclk", 0,\r\nSPDIF1_DIV);\r\nfor (i = 0; i < ARRAY_SIZE(lsp1clk); i++) {\r\nif (IS_ERR(clk[i])) {\r\npr_err("zx296702 clk %d: register failed with %ld\n",\r\ni, PTR_ERR(clk[i]));\r\nreturn;\r\n}\r\n}\r\nlsp1clk_data.clks = lsp1clk;\r\nlsp1clk_data.clk_num = ARRAY_SIZE(lsp1clk);\r\nof_clk_add_provider(np, of_clk_src_onecell_get, &lsp1clk_data);\r\n}
