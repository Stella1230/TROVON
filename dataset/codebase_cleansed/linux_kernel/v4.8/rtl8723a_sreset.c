void rtl8723a_sreset_xmit_status_check(struct rtw_adapter *padapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(padapter);\r\nstruct sreset_priv *psrtpriv = &pHalData->srestpriv;\r\nunsigned long current_time;\r\nstruct xmit_priv *pxmitpriv = &padapter->xmitpriv;\r\nunsigned int diff_time;\r\nu32 txdma_status;\r\ntxdma_status = rtl8723au_read32(padapter, REG_TXDMA_STATUS);\r\nif (txdma_status != 0) {\r\nDBG_8723A("%s REG_TXDMA_STATUS:0x%08x\n", __func__, txdma_status);\r\nrtw_sreset_reset(padapter);\r\n}\r\ncurrent_time = jiffies;\r\nif (0 == pxmitpriv->free_xmitbuf_cnt || 0 == pxmitpriv->free_xmit_extbuf_cnt) {\r\ndiff_time = jiffies_to_msecs(jiffies - psrtpriv->last_tx_time);\r\nif (diff_time > 2000) {\r\nif (psrtpriv->last_tx_complete_time == 0) {\r\npsrtpriv->last_tx_complete_time = current_time;\r\n} else {\r\ndiff_time = jiffies_to_msecs(jiffies - psrtpriv->last_tx_complete_time);\r\nif (diff_time > 4000) {\r\nDBG_8723A("%s tx hang\n", __func__);\r\nrtw_sreset_reset(padapter);\r\n}\r\n}\r\n}\r\n}\r\n}
