static void __init vision_map_io(void)\r\n{\r\nep93xx_map_io();\r\niotable_init(vision_io_desc, ARRAY_SIZE(vision_io_desc));\r\n}\r\nstatic int vision_lcd_setup(struct platform_device *pdev)\r\n{\r\nint err;\r\nerr = gpio_request_one(VISION_LCD_ENABLE, GPIOF_INIT_HIGH,\r\ndev_name(&pdev->dev));\r\nif (err)\r\nreturn err;\r\nep93xx_devcfg_clear_bits(EP93XX_SYSCON_DEVCFG_RAS |\r\nEP93XX_SYSCON_DEVCFG_RASONP3 |\r\nEP93XX_SYSCON_DEVCFG_EXVC);\r\nreturn 0;\r\n}\r\nstatic void vision_lcd_teardown(struct platform_device *pdev)\r\n{\r\ngpio_free(VISION_LCD_ENABLE);\r\n}\r\nstatic void vision_lcd_blank(int blank_mode, struct fb_info *info)\r\n{\r\nif (blank_mode)\r\ngpio_set_value(VISION_LCD_ENABLE, 0);\r\nelse\r\ngpio_set_value(VISION_LCD_ENABLE, 1);\r\n}\r\nstatic int vision_cs4271_hw_setup(struct spi_device *spi)\r\n{\r\nreturn gpio_request_one(EP93XX_GPIO_LINE_EGPIO6,\r\nGPIOF_OUT_INIT_HIGH, spi->modalias);\r\n}\r\nstatic void vision_cs4271_hw_cleanup(struct spi_device *spi)\r\n{\r\ngpio_free(EP93XX_GPIO_LINE_EGPIO6);\r\n}\r\nstatic void vision_cs4271_hw_cs_control(struct spi_device *spi, int value)\r\n{\r\ngpio_set_value(EP93XX_GPIO_LINE_EGPIO6, value);\r\n}\r\nstatic int vision_spi_flash_hw_setup(struct spi_device *spi)\r\n{\r\nreturn gpio_request_one(VISION_SPI_FLASH_CS, GPIOF_INIT_HIGH,\r\nspi->modalias);\r\n}\r\nstatic void vision_spi_flash_hw_cleanup(struct spi_device *spi)\r\n{\r\ngpio_free(VISION_SPI_FLASH_CS);\r\n}\r\nstatic void vision_spi_flash_hw_cs_control(struct spi_device *spi, int value)\r\n{\r\ngpio_set_value(VISION_SPI_FLASH_CS, value);\r\n}\r\nstatic int vision_spi_mmc_hw_setup(struct spi_device *spi)\r\n{\r\nreturn gpio_request_one(VISION_SPI_MMC_CS, GPIOF_INIT_HIGH,\r\nspi->modalias);\r\n}\r\nstatic void vision_spi_mmc_hw_cleanup(struct spi_device *spi)\r\n{\r\ngpio_free(VISION_SPI_MMC_CS);\r\n}\r\nstatic void vision_spi_mmc_hw_cs_control(struct spi_device *spi, int value)\r\n{\r\ngpio_set_value(VISION_SPI_MMC_CS, value);\r\n}\r\nstatic void __init vision_register_i2s(void)\r\n{\r\nep93xx_register_i2s();\r\nplatform_device_register(&vision_audio_device);\r\n}\r\nstatic void __init vision_init_machine(void)\r\n{\r\nep93xx_init_devices();\r\nep93xx_register_flash(2, EP93XX_CS6_PHYS_BASE, SZ_64M);\r\nep93xx_register_eth(&vision_eth_data, 1);\r\nep93xx_register_fb(&ep93xxfb_info);\r\nep93xx_register_pwm(1, 0);\r\nif (gpio_request_one(EP93XX_GPIO_LINE_F(7), GPIOF_DIR_IN,\r\n"pca9539:74"))\r\npr_warn("cannot request interrupt gpio for pca9539:74\n");\r\nvision_i2c_info[1].irq = gpio_to_irq(EP93XX_GPIO_LINE_F(7));\r\nep93xx_register_i2c(&vision_i2c_gpio_data, vision_i2c_info,\r\nARRAY_SIZE(vision_i2c_info));\r\nep93xx_register_spi(&vision_spi_master, vision_spi_board_info,\r\nARRAY_SIZE(vision_spi_board_info));\r\nvision_register_i2s();\r\n}
