static int tegra124_dfll_fcpu_probe(struct platform_device *pdev)\r\n{\r\nint process_id, speedo_id, speedo_value, err;\r\nstruct tegra_dfll_soc_data *soc;\r\nprocess_id = tegra_sku_info.cpu_process_id;\r\nspeedo_id = tegra_sku_info.cpu_speedo_id;\r\nspeedo_value = tegra_sku_info.cpu_speedo_value;\r\nif (speedo_id >= ARRAY_SIZE(cpu_max_freq_table)) {\r\ndev_err(&pdev->dev, "unknown max CPU freq for speedo_id=%d\n",\r\nspeedo_id);\r\nreturn -ENODEV;\r\n}\r\nsoc = devm_kzalloc(&pdev->dev, sizeof(*soc), GFP_KERNEL);\r\nif (!soc)\r\nreturn -ENOMEM;\r\nsoc->dev = get_cpu_device(0);\r\nif (!soc->dev) {\r\ndev_err(&pdev->dev, "no CPU0 device\n");\r\nreturn -ENODEV;\r\n}\r\nsoc->max_freq = cpu_max_freq_table[speedo_id];\r\nsoc->cvb = tegra_cvb_add_opp_table(soc->dev, tegra124_cpu_cvb_tables,\r\nARRAY_SIZE(tegra124_cpu_cvb_tables),\r\nprocess_id, speedo_id, speedo_value,\r\nsoc->max_freq);\r\nif (IS_ERR(soc->cvb)) {\r\ndev_err(&pdev->dev, "couldn't add OPP table: %ld\n",\r\nPTR_ERR(soc->cvb));\r\nreturn PTR_ERR(soc->cvb);\r\n}\r\nerr = tegra_dfll_register(pdev, soc);\r\nif (err < 0) {\r\ntegra_cvb_remove_opp_table(soc->dev, soc->cvb, soc->max_freq);\r\nreturn err;\r\n}\r\nplatform_set_drvdata(pdev, soc);\r\nreturn 0;\r\n}\r\nstatic int tegra124_dfll_fcpu_remove(struct platform_device *pdev)\r\n{\r\nstruct tegra_dfll_soc_data *soc = platform_get_drvdata(pdev);\r\nint err;\r\nerr = tegra_dfll_unregister(pdev);\r\nif (err < 0)\r\ndev_err(&pdev->dev, "failed to unregister DFLL: %d\n", err);\r\ntegra_cvb_remove_opp_table(soc->dev, soc->cvb, soc->max_freq);\r\nreturn 0;\r\n}\r\nstatic int __init tegra124_dfll_fcpu_init(void)\r\n{\r\nreturn platform_driver_register(&tegra124_dfll_fcpu_driver);\r\n}\r\nstatic void __exit tegra124_dfll_fcpu_exit(void)\r\n{\r\nplatform_driver_unregister(&tegra124_dfll_fcpu_driver);\r\n}
