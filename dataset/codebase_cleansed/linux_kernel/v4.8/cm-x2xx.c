static void __init cmx2xx_init_dm9000(void)\r\n{\r\nif (cpu_is_pxa25x())\r\ncmx2xx_dm9000_device.resource = cmx255_dm9000_resource;\r\nelse\r\ncmx2xx_dm9000_device.resource = cmx270_dm9000_resource;\r\nplatform_device_register(&cmx2xx_dm9000_device);\r\n}\r\nstatic inline void cmx2xx_init_dm9000(void) {}\r\nstatic void __init cmx2xx_init_touchscreen(void)\r\n{\r\nplatform_device_register(&cmx2xx_ts_device);\r\n}\r\nstatic inline void cmx2xx_init_touchscreen(void) {}\r\nstatic void __init cmx2xx_init_leds(void)\r\n{\r\nif (cpu_is_pxa25x()) {\r\ncmx2xx_leds[0].gpio = CMX255_GPIO_RED;\r\ncmx2xx_leds[1].gpio = CMX255_GPIO_GREEN;\r\n} else {\r\ncmx2xx_leds[0].gpio = CMX270_GPIO_RED;\r\ncmx2xx_leds[1].gpio = CMX270_GPIO_GREEN;\r\n}\r\nplatform_device_register(&cmx2xx_led_device);\r\n}\r\nstatic inline void cmx2xx_init_leds(void) {}\r\nstatic int __init cmx2xx_set_display(char *str)\r\n{\r\nint disp_type = simple_strtol(str, NULL, 0);\r\nswitch (disp_type) {\r\ncase MTYPE_STN320x240:\r\ncmx2xx_display = &generic_stn_320x240;\r\nbreak;\r\ncase MTYPE_TFT640x480:\r\ncmx2xx_display = &generic_tft_640x480;\r\nbreak;\r\ncase MTYPE_CRT640x480:\r\ncmx2xx_display = &generic_crt_640x480;\r\nbreak;\r\ncase MTYPE_CRT800x600:\r\ncmx2xx_display = &generic_crt_800x600;\r\nbreak;\r\ncase MTYPE_TFT320x240:\r\ncmx2xx_display = &generic_tft_320x240;\r\nbreak;\r\ncase MTYPE_STN640x480:\r\ncmx2xx_display = &generic_stn_640x480;\r\nbreak;\r\ndefault:\r\ncmx2xx_display = &generic_crt_640x480;\r\nbreak;\r\n}\r\nreturn 1;\r\n}\r\nstatic void __init cmx2xx_init_display(void)\r\n{\r\npxa_set_fb_info(NULL, cmx2xx_display);\r\n}\r\nstatic inline void cmx2xx_init_display(void) {}\r\nstatic int cmx2xx_suspend(void)\r\n{\r\ncmx2xx_pci_suspend();\r\nsleep_save_msc[0] = __raw_readl(MSC0);\r\nsleep_save_msc[1] = __raw_readl(MSC1);\r\nsleep_save_msc[2] = __raw_readl(MSC2);\r\nPCFR = 0x0;\r\nPSLR = 0xff400000;\r\nPMCR = 0x00000005;\r\nPWER = 0x80000000;\r\nPFER = 0x00000000;\r\nPRER = 0x00000000;\r\nPGSR0 = 0xC0018800;\r\nPGSR1 = 0x004F0002;\r\nPGSR2 = 0x6021C000;\r\nPGSR3 = 0x00020000;\r\nreturn 0;\r\n}\r\nstatic void cmx2xx_resume(void)\r\n{\r\ncmx2xx_pci_resume();\r\n__raw_writel(sleep_save_msc[0], MSC0);\r\n__raw_writel(sleep_save_msc[1], MSC1);\r\n__raw_writel(sleep_save_msc[2], MSC2);\r\n}\r\nstatic int __init cmx2xx_pm_init(void)\r\n{\r\nregister_syscore_ops(&cmx2xx_pm_syscore_ops);\r\nreturn 0;\r\n}\r\nstatic int __init cmx2xx_pm_init(void) { return 0; }\r\nstatic void __init cmx2xx_init_ac97(void)\r\n{\r\npxa_set_ac97_info(NULL);\r\n}\r\nstatic inline void cmx2xx_init_ac97(void) {}\r\nstatic void __init cmx2xx_init(void)\r\n{\r\npxa_set_ffuart_info(NULL);\r\npxa_set_btuart_info(NULL);\r\npxa_set_stuart_info(NULL);\r\ncmx2xx_pm_init();\r\nif (cpu_is_pxa25x())\r\ncmx255_init();\r\nelse\r\ncmx270_init();\r\ncmx2xx_init_dm9000();\r\ncmx2xx_init_display();\r\ncmx2xx_init_ac97();\r\ncmx2xx_init_touchscreen();\r\ncmx2xx_init_leds();\r\nregulator_has_full_constraints();\r\n}\r\nstatic void __init cmx2xx_init_irq(void)\r\n{\r\nif (cpu_is_pxa25x()) {\r\npxa25x_init_irq();\r\ncmx2xx_pci_init_irq(CMX255_GPIO_IT8152_IRQ);\r\n} else {\r\npxa27x_init_irq();\r\ncmx2xx_pci_init_irq(CMX270_GPIO_IT8152_IRQ);\r\n}\r\n}\r\nstatic void __init cmx2xx_map_io(void)\r\n{\r\nif (cpu_is_pxa25x())\r\npxa25x_map_io();\r\nif (cpu_is_pxa27x())\r\npxa27x_map_io();\r\niotable_init(cmx2xx_io_desc, ARRAY_SIZE(cmx2xx_io_desc));\r\nit8152_base_address = CMX2XX_IT8152_VIRT;\r\n}\r\nstatic void __init cmx2xx_map_io(void)\r\n{\r\nif (cpu_is_pxa25x())\r\npxa25x_map_io();\r\nif (cpu_is_pxa27x())\r\npxa27x_map_io();\r\n}
