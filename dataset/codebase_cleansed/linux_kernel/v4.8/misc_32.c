void\r\nprom_reboot(char *bcommand)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&prom_lock, flags);\r\n(*(romvec->pv_reboot))(bcommand);\r\nrestore_current();\r\nspin_unlock_irqrestore(&prom_lock, flags);\r\n}\r\nvoid\r\nprom_feval(char *fstring)\r\n{\r\nunsigned long flags;\r\nif(!fstring || fstring[0] == 0)\r\nreturn;\r\nspin_lock_irqsave(&prom_lock, flags);\r\nif(prom_vers == PROM_V0)\r\n(*(romvec->pv_fortheval.v0_eval))(strlen(fstring), fstring);\r\nelse\r\n(*(romvec->pv_fortheval.v2_eval))(fstring);\r\nrestore_current();\r\nspin_unlock_irqrestore(&prom_lock, flags);\r\n}\r\nvoid\r\nprom_cmdline(void)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&prom_lock, flags);\r\n(*(romvec->pv_abort))();\r\nrestore_current();\r\nspin_unlock_irqrestore(&prom_lock, flags);\r\nset_auxio(AUXIO_LED, 0);\r\n}\r\nvoid __noreturn\r\nprom_halt(void)\r\n{\r\nunsigned long flags;\r\nagain:\r\nspin_lock_irqsave(&prom_lock, flags);\r\n(*(romvec->pv_halt))();\r\nrestore_current();\r\nspin_unlock_irqrestore(&prom_lock, flags);\r\ngoto again;\r\n}\r\nvoid\r\nprom_setsync(sfunc_t funcp)\r\n{\r\nif(!funcp) return;\r\n*romvec->pv_synchook = funcp;\r\n}\r\nunsigned char\r\nprom_get_idprom(char *idbuf, int num_bytes)\r\n{\r\nint len;\r\nlen = prom_getproplen(prom_root_node, "idprom");\r\nif((len>num_bytes) || (len==-1)) return 0xff;\r\nif(!prom_getproperty(prom_root_node, "idprom", idbuf, num_bytes))\r\nreturn idbuf[0];\r\nreturn 0xff;\r\n}\r\nint\r\nprom_version(void)\r\n{\r\nreturn romvec->pv_romvers;\r\n}\r\nint\r\nprom_getrev(void)\r\n{\r\nreturn prom_rev;\r\n}\r\nint\r\nprom_getprev(void)\r\n{\r\nreturn prom_prev;\r\n}
