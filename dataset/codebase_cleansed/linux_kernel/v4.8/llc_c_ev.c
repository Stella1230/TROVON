static u16 llc_util_ns_inside_rx_window(u8 ns, u8 vr, u8 rw)\r\n{\r\nreturn !llc_circular_between(vr, ns,\r\n(vr + rw - 1) % LLC_2_SEQ_NBR_MODULO);\r\n}\r\nstatic u16 llc_util_nr_inside_tx_window(struct sock *sk, u8 nr)\r\n{\r\nu8 nr1, nr2;\r\nstruct sk_buff *skb;\r\nstruct llc_pdu_sn *pdu;\r\nstruct llc_sock *llc = llc_sk(sk);\r\nint rc = 0;\r\nif (llc->dev->flags & IFF_LOOPBACK)\r\ngoto out;\r\nrc = 1;\r\nif (skb_queue_empty(&llc->pdu_unack_q))\r\ngoto out;\r\nskb = skb_peek(&llc->pdu_unack_q);\r\npdu = llc_pdu_sn_hdr(skb);\r\nnr1 = LLC_I_GET_NS(pdu);\r\nskb = skb_peek_tail(&llc->pdu_unack_q);\r\npdu = llc_pdu_sn_hdr(skb);\r\nnr2 = LLC_I_GET_NS(pdu);\r\nrc = !llc_circular_between(nr1, nr, (nr2 + 1) % LLC_2_SEQ_NBR_MODULO);\r\nout:\r\nreturn rc;\r\n}\r\nint llc_conn_ev_conn_req(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->prim == LLC_CONN_PRIM &&\r\nev->prim_type == LLC_PRIM_TYPE_REQ ? 0 : 1;\r\n}\r\nint llc_conn_ev_data_req(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->prim == LLC_DATA_PRIM &&\r\nev->prim_type == LLC_PRIM_TYPE_REQ ? 0 : 1;\r\n}\r\nint llc_conn_ev_disc_req(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->prim == LLC_DISC_PRIM &&\r\nev->prim_type == LLC_PRIM_TYPE_REQ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rst_req(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->prim == LLC_RESET_PRIM &&\r\nev->prim_type == LLC_PRIM_TYPE_REQ ? 0 : 1;\r\n}\r\nint llc_conn_ev_local_busy_detected(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type == LLC_CONN_EV_TYPE_SIMPLE &&\r\nev->prim_type == LLC_CONN_EV_LOCAL_BUSY_DETECTED ? 0 : 1;\r\n}\r\nint llc_conn_ev_local_busy_cleared(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type == LLC_CONN_EV_TYPE_SIMPLE &&\r\nev->prim_type == LLC_CONN_EV_LOCAL_BUSY_CLEARED ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_bad_pdu(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn 1;\r\n}\r\nint llc_conn_ev_rx_disc_cmd_pbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_U(pdu) &&\r\nLLC_U_PDU_CMD(pdu) == LLC_2_PDU_CMD_DISC ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_dm_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_U(pdu) &&\r\nLLC_U_PDU_RSP(pdu) == LLC_2_PDU_RSP_DM ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_frmr_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_U(pdu) &&\r\nLLC_U_PDU_RSP(pdu) == LLC_2_PDU_RSP_FRMR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_cmd_pbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_0(pdu) &&\r\nLLC_I_GET_NS(pdu) == llc_sk(sk)->vR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_cmd_pbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_1(pdu) &&\r\nLLC_I_GET_NS(pdu) == llc_sk(sk)->vR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_cmd_pbit_set_0_unexpd_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_0(pdu) && ns != vr &&\r\n!llc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_cmd_pbit_set_1_unexpd_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_1(pdu) && ns != vr &&\r\n!llc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_cmd_pbit_set_x_inval_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn * pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nconst u16 rc = LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nns != vr &&\r\nllc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\nif (!rc)\r\ndprintk("%s: matched, state=%d, ns=%d, vr=%d\n",\r\n__func__, llc_sk(sk)->state, ns, vr);\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_0(pdu) &&\r\nLLC_I_GET_NS(pdu) == llc_sk(sk)->vR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_1(pdu) &&\r\nLLC_I_GET_NS(pdu) == llc_sk(sk)->vR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_GET_NS(pdu) == llc_sk(sk)->vR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_0_unexpd_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_0(pdu) && ns != vr &&\r\n!llc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_1_unexpd_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nLLC_I_PF_IS_1(pdu) && ns != vr &&\r\n!llc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_x_unexpd_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) && ns != vr &&\r\n!llc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_i_rsp_fbit_set_x_inval_ns(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vr = llc_sk(sk)->vR;\r\nconst u8 ns = LLC_I_GET_NS(pdu);\r\nconst u16 rc = LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_I(pdu) &&\r\nns != vr &&\r\nllc_util_ns_inside_rx_window(ns, vr, llc_sk(sk)->rw) ? 0 : 1;\r\nif (!rc)\r\ndprintk("%s: matched, state=%d, ns=%d, vr=%d\n",\r\n__func__, llc_sk(sk)->state, ns, vr);\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_rej_cmd_pbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_REJ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rej_cmd_pbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_REJ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rej_rsp_fbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_REJ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rej_rsp_fbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_REJ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rej_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_REJ ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rnr_cmd_pbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_RNR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rnr_cmd_pbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_RNR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rnr_rsp_fbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_RNR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rnr_rsp_fbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_RNR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rr_cmd_pbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_RR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rr_cmd_pbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_CMD(pdu) == LLC_2_PDU_CMD_RR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rr_rsp_fbit_set_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_0(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_RR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_rr_rsp_fbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nreturn llc_conn_space(sk, skb) &&\r\nLLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_S(pdu) &&\r\nLLC_S_PF_IS_1(pdu) &&\r\nLLC_S_PDU_RSP(pdu) == LLC_2_PDU_RSP_RR ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_sabme_cmd_pbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_CMD(pdu) && LLC_PDU_TYPE_IS_U(pdu) &&\r\nLLC_U_PDU_CMD(pdu) == LLC_2_PDU_CMD_SABME ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_ua_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nreturn LLC_PDU_IS_RSP(pdu) && LLC_PDU_TYPE_IS_U(pdu) &&\r\nLLC_U_PDU_RSP(pdu) == LLC_2_PDU_RSP_UA ? 0 : 1;\r\n}\r\nint llc_conn_ev_rx_xxx_cmd_pbit_set_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nu16 rc = 1;\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nif (LLC_PDU_IS_CMD(pdu)) {\r\nif (LLC_PDU_TYPE_IS_I(pdu) || LLC_PDU_TYPE_IS_S(pdu)) {\r\nif (LLC_I_PF_IS_1(pdu))\r\nrc = 0;\r\n} else if (LLC_PDU_TYPE_IS_U(pdu) && LLC_U_PF_IS_1(pdu))\r\nrc = 0;\r\n}\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_xxx_cmd_pbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nu16 rc = 1;\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nif (LLC_PDU_IS_CMD(pdu)) {\r\nif (LLC_PDU_TYPE_IS_I(pdu) || LLC_PDU_TYPE_IS_S(pdu))\r\nrc = 0;\r\nelse if (LLC_PDU_TYPE_IS_U(pdu))\r\nswitch (LLC_U_PDU_CMD(pdu)) {\r\ncase LLC_2_PDU_CMD_SABME:\r\ncase LLC_2_PDU_CMD_DISC:\r\nrc = 0;\r\nbreak;\r\n}\r\n}\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_xxx_rsp_fbit_set_x(struct sock *sk, struct sk_buff *skb)\r\n{\r\nu16 rc = 1;\r\nconst struct llc_pdu_un *pdu = llc_pdu_un_hdr(skb);\r\nif (LLC_PDU_IS_RSP(pdu)) {\r\nif (LLC_PDU_TYPE_IS_I(pdu) || LLC_PDU_TYPE_IS_S(pdu))\r\nrc = 0;\r\nelse if (LLC_PDU_TYPE_IS_U(pdu))\r\nswitch (LLC_U_PDU_RSP(pdu)) {\r\ncase LLC_2_PDU_RSP_UA:\r\ncase LLC_2_PDU_RSP_DM:\r\ncase LLC_2_PDU_RSP_FRMR:\r\nrc = 0;\r\nbreak;\r\n}\r\n}\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_zzz_cmd_pbit_set_x_inval_nr(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nu16 rc = 1;\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vs = llc_sk(sk)->vS;\r\nconst u8 nr = LLC_I_GET_NR(pdu);\r\nif (LLC_PDU_IS_CMD(pdu) &&\r\n(LLC_PDU_TYPE_IS_I(pdu) || LLC_PDU_TYPE_IS_S(pdu)) &&\r\nnr != vs && llc_util_nr_inside_tx_window(sk, nr)) {\r\ndprintk("%s: matched, state=%d, vs=%d, nr=%d\n",\r\n__func__, llc_sk(sk)->state, vs, nr);\r\nrc = 0;\r\n}\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_zzz_rsp_fbit_set_x_inval_nr(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nu16 rc = 1;\r\nconst struct llc_pdu_sn *pdu = llc_pdu_sn_hdr(skb);\r\nconst u8 vs = llc_sk(sk)->vS;\r\nconst u8 nr = LLC_I_GET_NR(pdu);\r\nif (LLC_PDU_IS_RSP(pdu) &&\r\n(LLC_PDU_TYPE_IS_I(pdu) || LLC_PDU_TYPE_IS_S(pdu)) &&\r\nnr != vs && llc_util_nr_inside_tx_window(sk, nr)) {\r\nrc = 0;\r\ndprintk("%s: matched, state=%d, vs=%d, nr=%d\n",\r\n__func__, llc_sk(sk)->state, vs, nr);\r\n}\r\nreturn rc;\r\n}\r\nint llc_conn_ev_rx_any_frame(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn 0;\r\n}\r\nint llc_conn_ev_p_tmr_exp(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type != LLC_CONN_EV_TYPE_P_TMR;\r\n}\r\nint llc_conn_ev_ack_tmr_exp(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type != LLC_CONN_EV_TYPE_ACK_TMR;\r\n}\r\nint llc_conn_ev_rej_tmr_exp(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type != LLC_CONN_EV_TYPE_REJ_TMR;\r\n}\r\nint llc_conn_ev_busy_tmr_exp(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type != LLC_CONN_EV_TYPE_BUSY_TMR;\r\n}\r\nint llc_conn_ev_init_p_f_cycle(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn 1;\r\n}\r\nint llc_conn_ev_tx_buffer_full(struct sock *sk, struct sk_buff *skb)\r\n{\r\nconst struct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nreturn ev->type == LLC_CONN_EV_TYPE_SIMPLE &&\r\nev->prim_type == LLC_CONN_EV_TX_BUFF_FULL ? 0 : 1;\r\n}\r\nint llc_conn_ev_qlfy_data_flag_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->data_flag != 1;\r\n}\r\nint llc_conn_ev_qlfy_data_flag_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->data_flag;\r\n}\r\nint llc_conn_ev_qlfy_data_flag_eq_2(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->data_flag != 2;\r\n}\r\nint llc_conn_ev_qlfy_p_flag_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->p_flag != 1;\r\n}\r\nint llc_conn_ev_qlfy_last_frame_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !(skb_queue_len(&llc_sk(sk)->pdu_unack_q) + 1 == llc_sk(sk)->k);\r\n}\r\nint llc_conn_ev_qlfy_last_frame_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn skb_queue_len(&llc_sk(sk)->pdu_unack_q) + 1 == llc_sk(sk)->k;\r\n}\r\nint llc_conn_ev_qlfy_p_flag_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->p_flag;\r\n}\r\nint llc_conn_ev_qlfy_p_flag_eq_f(struct sock *sk, struct sk_buff *skb)\r\n{\r\nu8 f_bit;\r\nllc_pdu_decode_pf_bit(skb, &f_bit);\r\nreturn llc_sk(sk)->p_flag == f_bit ? 0 : 1;\r\n}\r\nint llc_conn_ev_qlfy_remote_busy_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->remote_busy_flag;\r\n}\r\nint llc_conn_ev_qlfy_remote_busy_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !llc_sk(sk)->remote_busy_flag;\r\n}\r\nint llc_conn_ev_qlfy_retry_cnt_lt_n2(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !(llc_sk(sk)->retry_count < llc_sk(sk)->n2);\r\n}\r\nint llc_conn_ev_qlfy_retry_cnt_gte_n2(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !(llc_sk(sk)->retry_count >= llc_sk(sk)->n2);\r\n}\r\nint llc_conn_ev_qlfy_s_flag_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !llc_sk(sk)->s_flag;\r\n}\r\nint llc_conn_ev_qlfy_s_flag_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->s_flag;\r\n}\r\nint llc_conn_ev_qlfy_cause_flag_eq_1(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn !llc_sk(sk)->cause_flag;\r\n}\r\nint llc_conn_ev_qlfy_cause_flag_eq_0(struct sock *sk, struct sk_buff *skb)\r\n{\r\nreturn llc_sk(sk)->cause_flag;\r\n}\r\nint llc_conn_ev_qlfy_set_status_conn(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_CONN;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_disc(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_DISC;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_failed(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_FAILED;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_remote_busy(struct sock *sk,\r\nstruct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_REMOTE_BUSY;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_refuse(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_REFUSE;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_conflict(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_CONFLICT;\r\nreturn 0;\r\n}\r\nint llc_conn_ev_qlfy_set_status_rst_done(struct sock *sk, struct sk_buff *skb)\r\n{\r\nstruct llc_conn_state_ev *ev = llc_conn_ev(skb);\r\nev->status = LLC_STATUS_RESET_DONE;\r\nreturn 0;\r\n}
