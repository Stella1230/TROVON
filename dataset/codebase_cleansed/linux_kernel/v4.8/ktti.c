static void ktti_write_regr( PIA *pi, int cont, int regr, int val)\r\n{ int r;\r\nr = regr + cont_map[cont];\r\nw0(r); w2(0xb); w2(0xa); w2(3); w2(6);\r\nw0(val); w2(3); w0(0); w2(6); w2(0xb);\r\n}\r\nstatic int ktti_read_regr( PIA *pi, int cont, int regr )\r\n{ int a, b, r;\r\nr = regr + cont_map[cont];\r\nw0(r); w2(0xb); w2(0xa); w2(9); w2(0xc); w2(9);\r\na = r1(); w2(0xc); b = r1(); w2(9); w2(0xc); w2(9);\r\nreturn j44(a,b);\r\n}\r\nstatic void ktti_read_block( PIA *pi, char * buf, int count )\r\n{ int k, a, b;\r\nfor (k=0;k<count/2;k++) {\r\nw0(0x10); w2(0xb); w2(0xa); w2(9); w2(0xc); w2(9);\r\na = r1(); w2(0xc); b = r1(); w2(9);\r\nbuf[2*k] = j44(a,b);\r\na = r1(); w2(0xc); b = r1(); w2(9);\r\nbuf[2*k+1] = j44(a,b);\r\n}\r\n}\r\nstatic void ktti_write_block( PIA *pi, char * buf, int count )\r\n{ int k;\r\nfor (k=0;k<count/2;k++) {\r\nw0(0x10); w2(0xb); w2(0xa); w2(3); w2(6);\r\nw0(buf[2*k]); w2(3);\r\nw0(buf[2*k+1]); w2(6);\r\nw2(0xb);\r\n}\r\n}\r\nstatic void ktti_connect ( PIA *pi )\r\n{ pi->saved_r0 = r0();\r\npi->saved_r2 = r2();\r\nw2(0xb); w2(0xa); w0(0); w2(3); w2(6);\r\n}\r\nstatic void ktti_disconnect ( PIA *pi )\r\n{ w2(0xb); w2(0xa); w0(0xa0); w2(3); w2(4);\r\nw0(pi->saved_r0);\r\nw2(pi->saved_r2);\r\n}\r\nstatic void ktti_log_adapter( PIA *pi, char * scratch, int verbose )\r\n{ printk("%s: ktti %s, KT adapter at 0x%x, delay %d\n",\r\npi->device,KTTI_VERSION,pi->port,pi->delay);\r\n}\r\nstatic int __init ktti_init(void)\r\n{\r\nreturn paride_register(&ktti);\r\n}\r\nstatic void __exit ktti_exit(void)\r\n{\r\nparide_unregister(&ktti);\r\n}
