static void hvr950q_cs5340_audio(void *priv, int enable)\r\n{\r\nstruct au0828_dev *dev = priv;\r\nif (enable == 1)\r\nau0828_set(dev, REG_000, 0x10);\r\nelse\r\nau0828_clear(dev, REG_000, 0x10);\r\n}\r\nint au0828_tuner_callback(void *priv, int component, int command, int arg)\r\n{\r\nstruct au0828_dev *dev = priv;\r\ndprintk(1, "%s()\n", __func__);\r\nswitch (dev->boardnr) {\r\ncase AU0828_BOARD_HAUPPAUGE_HVR850:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\r\ncase AU0828_BOARD_DVICO_FUSIONHDTV7:\r\nif (command == 0) {\r\nau0828_clear(dev, REG_001, 2);\r\nmdelay(10);\r\nau0828_set(dev, REG_001, 2);\r\nmdelay(10);\r\nreturn 0;\r\n} else {\r\npr_err("%s(): Unknown command.\n", __func__);\r\nreturn -EINVAL;\r\n}\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic void hauppauge_eeprom(struct au0828_dev *dev, u8 *eeprom_data)\r\n{\r\nstruct tveeprom tv;\r\ntveeprom_hauppauge_analog(&dev->i2c_client, &tv, eeprom_data);\r\ndev->board.tuner_type = tv.tuner_type;\r\nswitch (tv.model) {\r\ncase 72000:\r\ncase 72001:\r\ncase 72101:\r\ncase 72201:\r\ncase 72211:\r\ncase 72221:\r\ncase 72231:\r\ncase 72241:\r\ncase 72251:\r\ncase 72261:\r\ncase 72271:\r\ncase 72281:\r\ncase 72301:\r\ncase 72500:\r\nbreak;\r\ndefault:\r\npr_warn("%s: warning: unknown hauppauge model #%d\n",\r\n__func__, tv.model);\r\nbreak;\r\n}\r\npr_info("%s: hauppauge eeprom: model=%d\n",\r\n__func__, tv.model);\r\n}\r\nvoid au0828_card_setup(struct au0828_dev *dev)\r\n{\r\nstatic u8 eeprom[256];\r\ndprintk(1, "%s()\n", __func__);\r\nif (dev->i2c_rc == 0) {\r\ndev->i2c_client.addr = 0xa0 >> 1;\r\ntveeprom_read(&dev->i2c_client, eeprom, sizeof(eeprom));\r\n}\r\nswitch (dev->boardnr) {\r\ncase AU0828_BOARD_HAUPPAUGE_HVR850:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\r\ncase AU0828_BOARD_HAUPPAUGE_WOODBURY:\r\nif (dev->i2c_rc == 0)\r\nhauppauge_eeprom(dev, eeprom+0xa0);\r\nbreak;\r\n}\r\nau0828_card_analog_fe_setup(dev);\r\n}\r\nvoid au0828_card_analog_fe_setup(struct au0828_dev *dev)\r\n{\r\n#ifdef CONFIG_VIDEO_AU0828_V4L2\r\nstruct tuner_setup tun_setup;\r\nstruct v4l2_subdev *sd;\r\nunsigned int mode_mask = T_ANALOG_TV;\r\nif (AUVI_INPUT(0).type != AU0828_VMUX_UNDEFINED) {\r\nsd = v4l2_i2c_new_subdev(&dev->v4l2_dev, &dev->i2c_adap,\r\n"au8522", 0x8e >> 1, NULL);\r\nif (sd == NULL)\r\npr_err("analog subdev registration failed\n");\r\n}\r\nif (dev->board.tuner_type != TUNER_ABSENT && dev->board.has_analog) {\r\nsd = v4l2_i2c_new_subdev(&dev->v4l2_dev, &dev->i2c_adap,\r\n"tuner", dev->board.tuner_addr, NULL);\r\nif (sd == NULL)\r\npr_err("tuner subdev registration fail\n");\r\ntun_setup.mode_mask = mode_mask;\r\ntun_setup.type = dev->board.tuner_type;\r\ntun_setup.addr = dev->board.tuner_addr;\r\ntun_setup.tuner_callback = au0828_tuner_callback;\r\nv4l2_device_call_all(&dev->v4l2_dev, 0, tuner, s_type_addr,\r\n&tun_setup);\r\n}\r\n#endif\r\n}\r\nvoid au0828_gpio_setup(struct au0828_dev *dev)\r\n{\r\ndprintk(1, "%s()\n", __func__);\r\nswitch (dev->boardnr) {\r\ncase AU0828_BOARD_HAUPPAUGE_HVR850:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q:\r\ncase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\r\ncase AU0828_BOARD_HAUPPAUGE_WOODBURY:\r\nau0828_write(dev, REG_003, 0x02);\r\nau0828_write(dev, REG_002, 0x80 | 0x20 | 0x10);\r\nau0828_write(dev, REG_001, 0x0);\r\nau0828_write(dev, REG_000, 0x0);\r\nmsleep(50);\r\nau0828_write(dev, REG_000, 0x80);\r\nmsleep(50);\r\nau0828_write(dev, REG_001, 0x02);\r\nau0828_write(dev, REG_000, 0x80 | 0x20);\r\nmsleep(250);\r\nbreak;\r\ncase AU0828_BOARD_DVICO_FUSIONHDTV7:\r\nau0828_write(dev, REG_003, 0x02);\r\nau0828_write(dev, REG_002, 0xa0);\r\nau0828_write(dev, REG_001, 0x0);\r\nau0828_write(dev, REG_000, 0x0);\r\nmsleep(100);\r\nau0828_write(dev, REG_003, 0x02);\r\nau0828_write(dev, REG_002, 0xa0);\r\nau0828_write(dev, REG_001, 0x02);\r\nau0828_write(dev, REG_000, 0xa0);\r\nmsleep(250);\r\nbreak;\r\n}\r\n}
