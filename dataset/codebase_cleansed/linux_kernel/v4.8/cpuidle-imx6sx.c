static int imx6sx_idle_finish(unsigned long val)\r\n{\r\ncpu_do_idle();\r\nreturn 0;\r\n}\r\nstatic int imx6sx_enter_wait(struct cpuidle_device *dev,\r\nstruct cpuidle_driver *drv, int index)\r\n{\r\nimx6_set_lpm(WAIT_UNCLOCKED);\r\nswitch (index) {\r\ncase 1:\r\ncpu_do_idle();\r\nbreak;\r\ncase 2:\r\nimx6_enable_rbc(true);\r\nimx_gpc_set_arm_power_in_lpm(true);\r\nimx_set_cpu_jump(0, v7_cpu_resume);\r\ncpu_pm_enter();\r\ncpu_cluster_pm_enter();\r\ncpu_suspend(0, imx6sx_idle_finish);\r\ncpu_cluster_pm_exit();\r\ncpu_pm_exit();\r\nimx_gpc_set_arm_power_in_lpm(false);\r\nimx6_enable_rbc(false);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nimx6_set_lpm(WAIT_CLOCKED);\r\nreturn index;\r\n}\r\nint __init imx6sx_cpuidle_init(void)\r\n{\r\nimx6_enable_rbc(false);\r\nimx_gpc_set_arm_power_up_timing(2, 1);\r\nimx_gpc_set_arm_power_down_timing(1, 1);\r\nreturn cpuidle_register(&imx6sx_cpuidle_driver, NULL);\r\n}
