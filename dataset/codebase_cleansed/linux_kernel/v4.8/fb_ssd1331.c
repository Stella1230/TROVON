static void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, 0x15, xs, xe);\r\nwrite_reg(par, 0x75, ys, ye);\r\n}\r\nstatic void write_reg8_bus8(struct fbtft_par *par, int len, ...)\r\n{\r\nva_list args;\r\nint i, ret;\r\nu8 *buf = par->buf;\r\nif (unlikely(par->debug & DEBUG_WRITE_REGISTER)) {\r\nva_start(args, len);\r\nfor (i = 0; i < len; i++)\r\nbuf[i] = (u8)va_arg(args, unsigned int);\r\nva_end(args);\r\nfbtft_par_dbg_hex(DEBUG_WRITE_REGISTER, par, par->info->device, u8, buf, len, "%s: ", __func__);\r\n}\r\nva_start(args, len);\r\n*buf = (u8)va_arg(args, unsigned int);\r\nif (par->gpio.dc != -1)\r\ngpio_set_value(par->gpio.dc, 0);\r\nret = par->fbtftops.write(par, par->buf, sizeof(u8));\r\nif (ret < 0) {\r\nva_end(args);\r\ndev_err(par->info->device,\r\n"write() failed and returned %d\n", ret);\r\nreturn;\r\n}\r\nlen--;\r\nif (len) {\r\ni = len;\r\nwhile (i--)\r\n*buf++ = (u8)va_arg(args, unsigned int);\r\nret = par->fbtftops.write(par, par->buf, len * (sizeof(u8)));\r\nif (ret < 0) {\r\nva_end(args);\r\ndev_err(par->info->device,\r\n"write() failed and returned %d\n", ret);\r\nreturn;\r\n}\r\n}\r\nif (par->gpio.dc != -1)\r\ngpio_set_value(par->gpio.dc, 1);\r\nva_end(args);\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, unsigned long *curves)\r\n{\r\nunsigned long tmp[GAMMA_NUM * GAMMA_LEN];\r\nint i, acc = 0;\r\nfor (i = 0; i < 63; i++) {\r\nif (i > 0 && curves[i] < 2) {\r\ndev_err(par->info->device,\r\n"Illegal value in Grayscale Lookup Table at index %d. " \\r\n"Must be greater than 1\n", i);\r\nreturn -EINVAL;\r\n}\r\nacc += curves[i];\r\ntmp[i] = acc;\r\nif (acc > 180) {\r\ndev_err(par->info->device,\r\n"Illegal value(s) in Grayscale Lookup Table. " \\r\n"At index=%d, the accumulated value has exceeded 180\n", i);\r\nreturn -EINVAL;\r\n}\r\n}\r\nwrite_reg(par, 0xB8,\r\ntmp[0], tmp[1], tmp[2], tmp[3], tmp[4], tmp[5], tmp[6], tmp[7],\r\ntmp[8], tmp[9], tmp[10], tmp[11], tmp[12], tmp[13], tmp[14], tmp[15],\r\ntmp[16], tmp[17], tmp[18], tmp[19], tmp[20], tmp[21], tmp[22], tmp[23],\r\ntmp[24], tmp[25], tmp[26], tmp[27], tmp[28], tmp[29], tmp[30], tmp[31],\r\ntmp[32], tmp[33], tmp[34], tmp[35], tmp[36], tmp[37], tmp[38], tmp[39],\r\ntmp[40], tmp[41], tmp[42], tmp[43], tmp[44], tmp[45], tmp[46], tmp[47],\r\ntmp[48], tmp[49], tmp[50], tmp[51], tmp[52], tmp[53], tmp[54], tmp[55],\r\ntmp[56], tmp[57], tmp[58], tmp[59], tmp[60], tmp[61], tmp[62]);\r\nreturn 0;\r\n}\r\nstatic int blank(struct fbtft_par *par, bool on)\r\n{\r\nfbtft_par_dbg(DEBUG_BLANK, par, "%s(blank=%s)\n",\r\n__func__, on ? "true" : "false");\r\nif (on)\r\nwrite_reg(par, 0xAE);\r\nelse\r\nwrite_reg(par, 0xAF);\r\nreturn 0;\r\n}
