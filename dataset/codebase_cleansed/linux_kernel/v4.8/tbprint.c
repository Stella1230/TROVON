static void acpi_tb_fix_string(char *string, acpi_size length)\r\n{\r\nwhile (length && *string) {\r\nif (!isprint((int)*string)) {\r\n*string = '?';\r\n}\r\nstring++;\r\nlength--;\r\n}\r\n}\r\nstatic void\r\nacpi_tb_cleanup_table_header(struct acpi_table_header *out_header,\r\nstruct acpi_table_header *header)\r\n{\r\nmemcpy(out_header, header, sizeof(struct acpi_table_header));\r\nacpi_tb_fix_string(out_header->signature, ACPI_NAME_SIZE);\r\nacpi_tb_fix_string(out_header->oem_id, ACPI_OEM_ID_SIZE);\r\nacpi_tb_fix_string(out_header->oem_table_id, ACPI_OEM_TABLE_ID_SIZE);\r\nacpi_tb_fix_string(out_header->asl_compiler_id, ACPI_NAME_SIZE);\r\n}\r\nvoid\r\nacpi_tb_print_table_header(acpi_physical_address address,\r\nstruct acpi_table_header *header)\r\n{\r\nstruct acpi_table_header local_header;\r\nif (ACPI_COMPARE_NAME(header->signature, ACPI_SIG_FACS)) {\r\nACPI_INFO(("%-4.4s 0x%8.8X%8.8X %06X",\r\nheader->signature, ACPI_FORMAT_UINT64(address),\r\nheader->length));\r\n} else if (ACPI_VALIDATE_RSDP_SIG(header->signature)) {\r\nmemcpy(local_header.oem_id,\r\nACPI_CAST_PTR(struct acpi_table_rsdp, header)->oem_id,\r\nACPI_OEM_ID_SIZE);\r\nacpi_tb_fix_string(local_header.oem_id, ACPI_OEM_ID_SIZE);\r\nACPI_INFO(("RSDP 0x%8.8X%8.8X %06X (v%.2d %-6.6s)",\r\nACPI_FORMAT_UINT64(address),\r\n(ACPI_CAST_PTR(struct acpi_table_rsdp, header)->\r\nrevision >\r\n0) ? ACPI_CAST_PTR(struct acpi_table_rsdp,\r\nheader)->length : 20,\r\nACPI_CAST_PTR(struct acpi_table_rsdp,\r\nheader)->revision,\r\nlocal_header.oem_id));\r\n} else {\r\nacpi_tb_cleanup_table_header(&local_header, header);\r\nACPI_INFO(("%-4.4s 0x%8.8X%8.8X"\r\n" %06X (v%.2d %-6.6s %-8.8s %08X %-4.4s %08X)",\r\nlocal_header.signature, ACPI_FORMAT_UINT64(address),\r\nlocal_header.length, local_header.revision,\r\nlocal_header.oem_id, local_header.oem_table_id,\r\nlocal_header.oem_revision,\r\nlocal_header.asl_compiler_id,\r\nlocal_header.asl_compiler_revision));\r\n}\r\n}\r\nacpi_status acpi_tb_verify_checksum(struct acpi_table_header *table, u32 length)\r\n{\r\nu8 checksum;\r\nif (ACPI_COMPARE_NAME(table->signature, ACPI_SIG_S3PT) ||\r\nACPI_COMPARE_NAME(table->signature, ACPI_SIG_FACS)) {\r\nreturn (AE_OK);\r\n}\r\nchecksum = acpi_tb_checksum(ACPI_CAST_PTR(u8, table), length);\r\nif (checksum) {\r\nACPI_BIOS_WARNING((AE_INFO,\r\n"Incorrect checksum in table [%4.4s] - 0x%2.2X, "\r\n"should be 0x%2.2X",\r\ntable->signature, table->checksum,\r\n(u8)(table->checksum - checksum)));\r\n#if (ACPI_CHECKSUM_ABORT)\r\nreturn (AE_BAD_CHECKSUM);\r\n#endif\r\n}\r\nreturn (AE_OK);\r\n}\r\nu8 acpi_tb_checksum(u8 *buffer, u32 length)\r\n{\r\nu8 sum = 0;\r\nu8 *end = buffer + length;\r\nwhile (buffer < end) {\r\nsum = (u8)(sum + *(buffer++));\r\n}\r\nreturn (sum);\r\n}
