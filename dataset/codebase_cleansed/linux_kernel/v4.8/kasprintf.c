char *kvasprintf(gfp_t gfp, const char *fmt, va_list ap)\r\n{\r\nunsigned int first, second;\r\nchar *p;\r\nva_list aq;\r\nva_copy(aq, ap);\r\nfirst = vsnprintf(NULL, 0, fmt, aq);\r\nva_end(aq);\r\np = kmalloc_track_caller(first+1, gfp);\r\nif (!p)\r\nreturn NULL;\r\nsecond = vsnprintf(p, first+1, fmt, ap);\r\nWARN(first != second, "different return values (%u and %u) from vsnprintf(\"%s\", ...)",\r\nfirst, second, fmt);\r\nreturn p;\r\n}\r\nconst char *kvasprintf_const(gfp_t gfp, const char *fmt, va_list ap)\r\n{\r\nif (!strchr(fmt, '%'))\r\nreturn kstrdup_const(fmt, gfp);\r\nif (!strcmp(fmt, "%s"))\r\nreturn kstrdup_const(va_arg(ap, const char*), gfp);\r\nreturn kvasprintf(gfp, fmt, ap);\r\n}\r\nchar *kasprintf(gfp_t gfp, const char *fmt, ...)\r\n{\r\nva_list ap;\r\nchar *p;\r\nva_start(ap, fmt);\r\np = kvasprintf(gfp, fmt, ap);\r\nva_end(ap);\r\nreturn p;\r\n}
