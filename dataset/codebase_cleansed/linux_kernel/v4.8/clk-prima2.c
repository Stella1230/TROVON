static void __init prima2_clk_init(struct device_node *np)\r\n{\r\nstruct device_node *rscnp;\r\nint i;\r\nrscnp = of_find_compatible_node(NULL, NULL, "sirf,prima2-rsc");\r\nsirfsoc_rsc_vbase = of_iomap(rscnp, 0);\r\nif (!sirfsoc_rsc_vbase)\r\npanic("unable to map rsc registers\n");\r\nof_node_put(rscnp);\r\nsirfsoc_clk_vbase = of_iomap(np, 0);\r\nif (!sirfsoc_clk_vbase)\r\npanic("unable to map clkc registers\n");\r\nprima2_clks[rtc] = clk_register_fixed_rate(NULL, "rtc", NULL, 0, 32768);\r\nprima2_clks[osc] = clk_register_fixed_rate(NULL, "osc", NULL, 0,\r\n26000000);\r\nfor (i = pll1; i < maxclk; i++) {\r\nprima2_clks[i] = clk_register(NULL, prima2_clk_hw_array[i]);\r\nBUG_ON(!prima2_clks[i]);\r\n}\r\nclk_register_clkdev(prima2_clks[cpu], NULL, "cpu");\r\nclk_register_clkdev(prima2_clks[io], NULL, "io");\r\nclk_register_clkdev(prima2_clks[mem], NULL, "mem");\r\nclk_register_clkdev(prima2_clks[mem], NULL, "osc");\r\nclk_data.clks = prima2_clks;\r\nclk_data.clk_num = maxclk;\r\nof_clk_add_provider(np, of_clk_src_onecell_get, &clk_data);\r\n}
