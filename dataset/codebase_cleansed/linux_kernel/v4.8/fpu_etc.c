static void fchs(FPU_REG *st0_ptr, u_char st0tag)\r\n{\r\nif (st0tag ^ TAG_Empty) {\r\nsignbyte(st0_ptr) ^= SIGN_NEG;\r\nclear_C1();\r\n} else\r\nFPU_stack_underflow();\r\n}\r\nstatic void fabs(FPU_REG *st0_ptr, u_char st0tag)\r\n{\r\nif (st0tag ^ TAG_Empty) {\r\nsetpositive(st0_ptr);\r\nclear_C1();\r\n} else\r\nFPU_stack_underflow();\r\n}\r\nstatic void ftst_(FPU_REG *st0_ptr, u_char st0tag)\r\n{\r\nswitch (st0tag) {\r\ncase TAG_Zero:\r\nsetcc(SW_C3);\r\nbreak;\r\ncase TAG_Valid:\r\nif (getsign(st0_ptr) == SIGN_POS)\r\nsetcc(0);\r\nelse\r\nsetcc(SW_C0);\r\nbreak;\r\ncase TAG_Special:\r\nswitch (FPU_Special(st0_ptr)) {\r\ncase TW_Denormal:\r\nif (getsign(st0_ptr) == SIGN_POS)\r\nsetcc(0);\r\nelse\r\nsetcc(SW_C0);\r\nif (denormal_operand() < 0) {\r\n#ifdef PECULIAR_486\r\nif (getsign(st0_ptr) == SIGN_POS)\r\nsetcc(SW_C3);\r\n#endif\r\nreturn;\r\n}\r\nbreak;\r\ncase TW_NaN:\r\nsetcc(SW_C0 | SW_C2 | SW_C3);\r\nEXCEPTION(EX_Invalid);\r\nbreak;\r\ncase TW_Infinity:\r\nif (getsign(st0_ptr) == SIGN_POS)\r\nsetcc(0);\r\nelse\r\nsetcc(SW_C0);\r\nbreak;\r\ndefault:\r\nsetcc(SW_C0 | SW_C2 | SW_C3);\r\nEXCEPTION(EX_INTERNAL | 0x14);\r\nbreak;\r\n}\r\nbreak;\r\ncase TAG_Empty:\r\nsetcc(SW_C0 | SW_C2 | SW_C3);\r\nEXCEPTION(EX_StackUnder);\r\nbreak;\r\n}\r\n}\r\nstatic void fxam(FPU_REG *st0_ptr, u_char st0tag)\r\n{\r\nint c = 0;\r\nswitch (st0tag) {\r\ncase TAG_Empty:\r\nc = SW_C3 | SW_C0;\r\nbreak;\r\ncase TAG_Zero:\r\nc = SW_C3;\r\nbreak;\r\ncase TAG_Valid:\r\nc = SW_C2;\r\nbreak;\r\ncase TAG_Special:\r\nswitch (FPU_Special(st0_ptr)) {\r\ncase TW_Denormal:\r\nc = SW_C2 | SW_C3;\r\nbreak;\r\ncase TW_NaN:\r\nif ((st0_ptr->sigh & 0x80000000)\r\n&& (exponent(st0_ptr) == EXP_OVER))\r\nc = SW_C0;\r\nbreak;\r\ncase TW_Infinity:\r\nc = SW_C2 | SW_C0;\r\nbreak;\r\n}\r\n}\r\nif (getsign(st0_ptr) == SIGN_NEG)\r\nc |= SW_C1;\r\nsetcc(c);\r\n}\r\nvoid FPU_etc(void)\r\n{\r\n(fp_etc_table[FPU_rm]) (&st(0), FPU_gettag0());\r\n}
