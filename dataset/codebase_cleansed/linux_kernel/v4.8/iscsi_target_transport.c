struct iscsit_transport *iscsit_get_transport(int type)\r\n{\r\nstruct iscsit_transport *t;\r\nmutex_lock(&transport_mutex);\r\nlist_for_each_entry(t, &g_transport_list, t_node) {\r\nif (t->transport_type == type) {\r\nif (t->owner && !try_module_get(t->owner)) {\r\nt = NULL;\r\n}\r\nmutex_unlock(&transport_mutex);\r\nreturn t;\r\n}\r\n}\r\nmutex_unlock(&transport_mutex);\r\nreturn NULL;\r\n}\r\nvoid iscsit_put_transport(struct iscsit_transport *t)\r\n{\r\nmodule_put(t->owner);\r\n}\r\nint iscsit_register_transport(struct iscsit_transport *t)\r\n{\r\nINIT_LIST_HEAD(&t->t_node);\r\nmutex_lock(&transport_mutex);\r\nlist_add_tail(&t->t_node, &g_transport_list);\r\nmutex_unlock(&transport_mutex);\r\npr_debug("Registered iSCSI transport: %s\n", t->name);\r\nreturn 0;\r\n}\r\nvoid iscsit_unregister_transport(struct iscsit_transport *t)\r\n{\r\nmutex_lock(&transport_mutex);\r\nlist_del(&t->t_node);\r\nmutex_unlock(&transport_mutex);\r\npr_debug("Unregistered iSCSI transport: %s\n", t->name);\r\n}
