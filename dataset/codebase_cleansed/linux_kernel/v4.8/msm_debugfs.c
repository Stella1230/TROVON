static int msm_gpu_show(struct drm_device *dev, struct seq_file *m)\r\n{\r\nstruct msm_drm_private *priv = dev->dev_private;\r\nstruct msm_gpu *gpu = priv->gpu;\r\nif (gpu) {\r\nseq_printf(m, "%s Status:\n", gpu->name);\r\ngpu->funcs->show(gpu, m);\r\n}\r\nreturn 0;\r\n}\r\nstatic int msm_gem_show(struct drm_device *dev, struct seq_file *m)\r\n{\r\nstruct msm_drm_private *priv = dev->dev_private;\r\nstruct msm_gpu *gpu = priv->gpu;\r\nif (gpu) {\r\nseq_printf(m, "Active Objects (%s):\n", gpu->name);\r\nmsm_gem_describe_objects(&gpu->active_list, m);\r\n}\r\nseq_printf(m, "Inactive Objects:\n");\r\nmsm_gem_describe_objects(&priv->inactive_list, m);\r\nreturn 0;\r\n}\r\nstatic int msm_mm_show(struct drm_device *dev, struct seq_file *m)\r\n{\r\nreturn drm_mm_dump_table(m, &dev->vma_offset_manager->vm_addr_space_mm);\r\n}\r\nstatic int msm_fb_show(struct drm_device *dev, struct seq_file *m)\r\n{\r\nstruct msm_drm_private *priv = dev->dev_private;\r\nstruct drm_framebuffer *fb, *fbdev_fb = NULL;\r\nif (priv->fbdev) {\r\nseq_printf(m, "fbcon ");\r\nfbdev_fb = priv->fbdev->fb;\r\nmsm_framebuffer_describe(fbdev_fb, m);\r\n}\r\nmutex_lock(&dev->mode_config.fb_lock);\r\nlist_for_each_entry(fb, &dev->mode_config.fb_list, head) {\r\nif (fb == fbdev_fb)\r\ncontinue;\r\nseq_printf(m, "user ");\r\nmsm_framebuffer_describe(fb, m);\r\n}\r\nmutex_unlock(&dev->mode_config.fb_lock);\r\nreturn 0;\r\n}\r\nstatic int show_locked(struct seq_file *m, void *arg)\r\n{\r\nstruct drm_info_node *node = (struct drm_info_node *) m->private;\r\nstruct drm_device *dev = node->minor->dev;\r\nint (*show)(struct drm_device *dev, struct seq_file *m) =\r\nnode->info_ent->data;\r\nint ret;\r\nret = mutex_lock_interruptible(&dev->struct_mutex);\r\nif (ret)\r\nreturn ret;\r\nret = show(dev, m);\r\nmutex_unlock(&dev->struct_mutex);\r\nreturn ret;\r\n}\r\nstatic int late_init_minor(struct drm_minor *minor)\r\n{\r\nint ret;\r\nif (!minor)\r\nreturn 0;\r\nret = msm_rd_debugfs_init(minor);\r\nif (ret) {\r\ndev_err(minor->dev->dev, "could not install rd debugfs\n");\r\nreturn ret;\r\n}\r\nret = msm_perf_debugfs_init(minor);\r\nif (ret) {\r\ndev_err(minor->dev->dev, "could not install perf debugfs\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nint msm_debugfs_late_init(struct drm_device *dev)\r\n{\r\nint ret;\r\nret = late_init_minor(dev->primary);\r\nif (ret)\r\nreturn ret;\r\nret = late_init_minor(dev->render);\r\nif (ret)\r\nreturn ret;\r\nret = late_init_minor(dev->control);\r\nreturn ret;\r\n}\r\nint msm_debugfs_init(struct drm_minor *minor)\r\n{\r\nstruct drm_device *dev = minor->dev;\r\nint ret;\r\nret = drm_debugfs_create_files(msm_debugfs_list,\r\nARRAY_SIZE(msm_debugfs_list),\r\nminor->debugfs_root, minor);\r\nif (ret) {\r\ndev_err(dev->dev, "could not install msm_debugfs_list\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nvoid msm_debugfs_cleanup(struct drm_minor *minor)\r\n{\r\ndrm_debugfs_remove_files(msm_debugfs_list,\r\nARRAY_SIZE(msm_debugfs_list), minor);\r\nif (!minor->dev->dev_private)\r\nreturn;\r\nmsm_rd_debugfs_cleanup(minor);\r\nmsm_perf_debugfs_cleanup(minor);\r\n}
