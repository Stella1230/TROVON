static int adt7316_i2c_read(void *client, u8 reg, u8 *data)\r\n{\r\nstruct i2c_client *cl = client;\r\nint ret;\r\nret = i2c_smbus_write_byte(cl, reg);\r\nif (ret < 0) {\r\ndev_err(&cl->dev, "I2C fail to select reg\n");\r\nreturn ret;\r\n}\r\nret = i2c_smbus_read_byte(client);\r\nif (ret < 0) {\r\ndev_err(&cl->dev, "I2C read error\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int adt7316_i2c_write(void *client, u8 reg, u8 data)\r\n{\r\nstruct i2c_client *cl = client;\r\nint ret = 0;\r\nret = i2c_smbus_write_byte_data(cl, reg, data);\r\nif (ret < 0)\r\ndev_err(&cl->dev, "I2C write error\n");\r\nreturn ret;\r\n}\r\nstatic int adt7316_i2c_multi_read(void *client, u8 reg, u8 count, u8 *data)\r\n{\r\nstruct i2c_client *cl = client;\r\nint i, ret = 0;\r\nif (count > ADT7316_REG_MAX_ADDR)\r\ncount = ADT7316_REG_MAX_ADDR;\r\nfor (i = 0; i < count; i++) {\r\nret = adt7316_i2c_read(cl, reg, &data[i]);\r\nif (ret < 0) {\r\ndev_err(&cl->dev, "I2C multi read error\n");\r\nreturn ret;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int adt7316_i2c_multi_write(void *client, u8 reg, u8 count, u8 *data)\r\n{\r\nstruct i2c_client *cl = client;\r\nint i, ret = 0;\r\nif (count > ADT7316_REG_MAX_ADDR)\r\ncount = ADT7316_REG_MAX_ADDR;\r\nfor (i = 0; i < count; i++) {\r\nret = adt7316_i2c_write(cl, reg, data[i]);\r\nif (ret < 0) {\r\ndev_err(&cl->dev, "I2C multi write error\n");\r\nreturn ret;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int adt7316_i2c_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct adt7316_bus bus = {\r\n.client = client,\r\n.irq = client->irq,\r\n.irq_flags = IRQF_TRIGGER_LOW,\r\n.read = adt7316_i2c_read,\r\n.write = adt7316_i2c_write,\r\n.multi_read = adt7316_i2c_multi_read,\r\n.multi_write = adt7316_i2c_multi_write,\r\n};\r\nreturn adt7316_probe(&client->dev, &bus, id->name);\r\n}
