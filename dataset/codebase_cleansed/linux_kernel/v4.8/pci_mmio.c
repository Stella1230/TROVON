static long get_pfn(unsigned long user_addr, unsigned long access,\r\nunsigned long *pfn)\r\n{\r\nstruct vm_area_struct *vma;\r\nlong ret;\r\ndown_read(&current->mm->mmap_sem);\r\nret = -EINVAL;\r\nvma = find_vma(current->mm, user_addr);\r\nif (!vma)\r\ngoto out;\r\nret = -EACCES;\r\nif (!(vma->vm_flags & access))\r\ngoto out;\r\nret = follow_pfn(vma, user_addr, pfn);\r\nout:\r\nup_read(&current->mm->mmap_sem);\r\nreturn ret;\r\n}
