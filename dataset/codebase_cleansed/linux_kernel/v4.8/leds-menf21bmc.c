static void\r\nmenf21bmc_led_set(struct led_classdev *led_cdev, enum led_brightness value)\r\n{\r\nint led_val;\r\nstruct menf21bmc_led *led = container_of(led_cdev,\r\nstruct menf21bmc_led, cdev);\r\nmutex_lock(&led_lock);\r\nled_val = i2c_smbus_read_byte_data(led->i2c_client,\r\nBMC_CMD_LED_GET_SET);\r\nif (led_val < 0)\r\ngoto err_out;\r\nif (value == LED_OFF)\r\nled_val &= ~led->led_bit;\r\nelse\r\nled_val |= led->led_bit;\r\ni2c_smbus_write_byte_data(led->i2c_client,\r\nBMC_CMD_LED_GET_SET, led_val);\r\nerr_out:\r\nmutex_unlock(&led_lock);\r\n}\r\nstatic int menf21bmc_led_probe(struct platform_device *pdev)\r\n{\r\nint i;\r\nint ret;\r\nstruct i2c_client *i2c_client = to_i2c_client(pdev->dev.parent);\r\nfor (i = 0; i < ARRAY_SIZE(leds); i++) {\r\nleds[i].cdev.name = leds[i].name;\r\nleds[i].cdev.brightness_set = menf21bmc_led_set;\r\nleds[i].i2c_client = i2c_client;\r\nret = devm_led_classdev_register(&pdev->dev, &leds[i].cdev);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "failed to register LED device\n");\r\nreturn ret;\r\n}\r\n}\r\ndev_info(&pdev->dev, "MEN 140F21P00 BMC LED device enabled\n");\r\nreturn 0;\r\n}
