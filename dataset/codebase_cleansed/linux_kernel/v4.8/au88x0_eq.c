static void vortex_EqHw_SetTimeConsts(vortex_t * vortex, u16 gain, u16 level)\r\n{\r\nhwwrite(vortex->mmio, 0x2b3c4, gain);\r\nhwwrite(vortex->mmio, 0x2b3c8, level);\r\n}\r\nstatic inline u16 sign_invert(u16 a)\r\n{\r\nif (a == (u16)-32768)\r\nreturn 32767;\r\nelse\r\nreturn -a;\r\n}\r\nstatic void vortex_EqHw_SetLeftCoefs(vortex_t * vortex, u16 coefs[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i = 0, n ;\r\nfor (n = 0; n < eqhw->this04; n++) {\r\nhwwrite(vortex->mmio, 0x2b000 + n * 0x30, coefs[i + 0]);\r\nhwwrite(vortex->mmio, 0x2b004 + n * 0x30, coefs[i + 1]);\r\nif (eqhw->this08 == 0) {\r\nhwwrite(vortex->mmio, 0x2b008 + n * 0x30, coefs[i + 2]);\r\nhwwrite(vortex->mmio, 0x2b00c + n * 0x30, coefs[i + 3]);\r\nhwwrite(vortex->mmio, 0x2b010 + n * 0x30, coefs[i + 4]);\r\n} else {\r\nhwwrite(vortex->mmio, 0x2b008 + n * 0x30, sign_invert(coefs[2 + i]));\r\nhwwrite(vortex->mmio, 0x2b00c + n * 0x30, sign_invert(coefs[3 + i]));\r\nhwwrite(vortex->mmio, 0x2b010 + n * 0x30, sign_invert(coefs[4 + i]));\r\n}\r\ni += 5;\r\n}\r\n}\r\nstatic void vortex_EqHw_SetRightCoefs(vortex_t * vortex, u16 coefs[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i = 0, n ;\r\nfor (n = 0; n < eqhw->this04; n++) {\r\nhwwrite(vortex->mmio, 0x2b1e0 + n * 0x30, coefs[0 + i]);\r\nhwwrite(vortex->mmio, 0x2b1e4 + n * 0x30, coefs[1 + i]);\r\nif (eqhw->this08 == 0) {\r\nhwwrite(vortex->mmio, 0x2b1e8 + n * 0x30, coefs[2 + i]);\r\nhwwrite(vortex->mmio, 0x2b1ec + n * 0x30, coefs[3 + i]);\r\nhwwrite(vortex->mmio, 0x2b1f0 + n * 0x30, coefs[4 + i]);\r\n} else {\r\nhwwrite(vortex->mmio, 0x2b1e8 + n * 0x30, sign_invert(coefs[2 + i]));\r\nhwwrite(vortex->mmio, 0x2b1ec + n * 0x30, sign_invert(coefs[3 + i]));\r\nhwwrite(vortex->mmio, 0x2b1f0 + n * 0x30, sign_invert(coefs[4 + i]));\r\n}\r\ni += 5;\r\n}\r\n}\r\nstatic void vortex_EqHw_SetLeftStates(vortex_t * vortex, u16 a[], u16 b[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i = 0, ebx;\r\nhwwrite(vortex->mmio, 0x2b3fc, a[0]);\r\nhwwrite(vortex->mmio, 0x2b400, a[1]);\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b014 + (i * 0xc), b[i]);\r\nhwwrite(vortex->mmio, 0x2b018 + (i * 0xc), b[1 + i]);\r\nhwwrite(vortex->mmio, 0x2b01c + (i * 0xc), b[2 + i]);\r\nhwwrite(vortex->mmio, 0x2b020 + (i * 0xc), b[3 + i]);\r\ni += 4;\r\n}\r\n}\r\nstatic void vortex_EqHw_SetRightStates(vortex_t * vortex, u16 a[], u16 b[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i = 0, ebx;\r\nhwwrite(vortex->mmio, 0x2b404, a[0]);\r\nhwwrite(vortex->mmio, 0x2b408, a[1]);\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b1f4 + (i * 0xc), b[i]);\r\nhwwrite(vortex->mmio, 0x2b1f8 + (i * 0xc), b[1 + i]);\r\nhwwrite(vortex->mmio, 0x2b1fc + (i * 0xc), b[2 + i]);\r\nhwwrite(vortex->mmio, 0x2b200 + (i * 0xc), b[3 + i]);\r\ni += 4;\r\n}\r\n}\r\nstatic void vortex_EqHw_SetBypassGain(vortex_t * vortex, u16 a, u16 b)\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nif (eqhw->this08 == 0) {\r\nhwwrite(vortex->mmio, 0x2b3d4, a);\r\nhwwrite(vortex->mmio, 0x2b3ec, b);\r\n} else {\r\nhwwrite(vortex->mmio, 0x2b3d4, sign_invert(a));\r\nhwwrite(vortex->mmio, 0x2b3ec, sign_invert(b));\r\n}\r\n}\r\nstatic void vortex_EqHw_SetA3DBypassGain(vortex_t * vortex, u16 a, u16 b)\r\n{\r\nhwwrite(vortex->mmio, 0x2b3e0, a);\r\nhwwrite(vortex->mmio, 0x2b3f8, b);\r\n}\r\nstatic void\r\nvortex_EqHw_SetLeftGainsSingleTarget(vortex_t * vortex, u16 index, u16 b)\r\n{\r\nhwwrite(vortex->mmio, 0x2b02c + (index * 0x30), b);\r\n}\r\nstatic void\r\nvortex_EqHw_SetRightGainsSingleTarget(vortex_t * vortex, u16 index, u16 b)\r\n{\r\nhwwrite(vortex->mmio, 0x2b20c + (index * 0x30), b);\r\n}\r\nstatic void vortex_EqHw_SetLeftGainsTarget(vortex_t * vortex, u16 a[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint ebx;\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b02c + ebx * 0x30, a[ebx]);\r\n}\r\n}\r\nstatic void vortex_EqHw_SetRightGainsTarget(vortex_t * vortex, u16 a[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint ebx;\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b20c + ebx * 0x30, a[ebx]);\r\n}\r\n}\r\nstatic void vortex_EqHw_SetLeftGainsCurrent(vortex_t * vortex, u16 a[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint ebx;\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b028 + ebx * 0x30, a[ebx]);\r\n}\r\n}\r\nstatic void vortex_EqHw_SetRightGainsCurrent(vortex_t * vortex, u16 a[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint ebx;\r\nfor (ebx = 0; ebx < eqhw->this04; ebx++) {\r\nhwwrite(vortex->mmio, 0x2b208 + ebx * 0x30, a[ebx]);\r\n}\r\n}\r\nstatic void vortex_EqHw_SetLevels(vortex_t * vortex, u16 peaks[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i;\r\nfor (i = 0; i < eqhw->this04; i++) {\r\nhwwrite(vortex->mmio, 0x2b024 + i * VORTEX_BAND_COEFF_SIZE, peaks[i]);\r\n}\r\nhwwrite(vortex->mmio, 0x2b3cc, peaks[eqhw->this04]);\r\nhwwrite(vortex->mmio, 0x2b3d8, peaks[eqhw->this04 + 1]);\r\nfor (i = 0; i < eqhw->this04; i++) {\r\nhwwrite(vortex->mmio, 0x2b204 + i * VORTEX_BAND_COEFF_SIZE,\r\npeaks[i + (eqhw->this04 + 2)]);\r\n}\r\nhwwrite(vortex->mmio, 0x2b3e4, peaks[2 + (eqhw->this04 * 2)]);\r\nhwwrite(vortex->mmio, 0x2b3f0, peaks[3 + (eqhw->this04 * 2)]);\r\n}\r\nstatic void vortex_EqHw_SetControlReg(vortex_t * vortex, u32 reg)\r\n{\r\nhwwrite(vortex->mmio, 0x2b440, reg);\r\n}\r\nstatic void vortex_EqHw_SetSampleRate(vortex_t * vortex, u32 sr)\r\n{\r\nhwwrite(vortex->mmio, 0x2b440, ((sr & 0x1f) << 3) | 0xb800);\r\n}\r\nstatic void vortex_EqHw_Enable(vortex_t * vortex)\r\n{\r\nhwwrite(vortex->mmio, VORTEX_EQ_CTRL, 0xf001);\r\n}\r\nstatic void vortex_EqHw_Disable(vortex_t * vortex)\r\n{\r\nhwwrite(vortex->mmio, VORTEX_EQ_CTRL, 0xf000);\r\n}\r\nstatic void vortex_EqHw_ZeroIO(vortex_t * vortex)\r\n{\r\nint i;\r\nfor (i = 0; i < 0x8; i++)\r\nhwwrite(vortex->mmio, VORTEX_EQ_DEST + (i << 2), 0x0);\r\nfor (i = 0; i < 0x4; i++)\r\nhwwrite(vortex->mmio, VORTEX_EQ_SOURCE + (i << 2), 0x0);\r\n}\r\nstatic void vortex_EqHw_ZeroA3DIO(vortex_t * vortex)\r\n{\r\nint i;\r\nfor (i = 0; i < 0x4; i++)\r\nhwwrite(vortex->mmio, VORTEX_EQ_DEST + (i << 2), 0x0);\r\n}\r\nstatic void vortex_EqHw_ZeroState(vortex_t * vortex)\r\n{\r\nvortex_EqHw_SetControlReg(vortex, 0);\r\nvortex_EqHw_ZeroIO(vortex);\r\nhwwrite(vortex->mmio, 0x2b3c0, 0);\r\nvortex_EqHw_SetTimeConsts(vortex, 0, 0);\r\nvortex_EqHw_SetLeftCoefs(vortex, asEqCoefsZeros);\r\nvortex_EqHw_SetRightCoefs(vortex, asEqCoefsZeros);\r\nvortex_EqHw_SetLeftGainsCurrent(vortex, eq_gains_zero);\r\nvortex_EqHw_SetRightGainsCurrent(vortex, eq_gains_zero);\r\nvortex_EqHw_SetLeftGainsTarget(vortex, eq_gains_zero);\r\nvortex_EqHw_SetRightGainsTarget(vortex, eq_gains_zero);\r\nvortex_EqHw_SetBypassGain(vortex, 0, 0);\r\nvortex_EqHw_SetA3DBypassGain(vortex, 0, 0);\r\nvortex_EqHw_SetLeftStates(vortex, eq_states_zero, asEqOutStateZeros);\r\nvortex_EqHw_SetRightStates(vortex, eq_states_zero, asEqOutStateZeros);\r\nvortex_EqHw_SetLevels(vortex, (u16 *) eq_levels);\r\n}\r\nstatic void vortex_EqHw_ProgramPipe(vortex_t * vortex)\r\n{\r\nvortex_EqHw_SetTimeConsts(vortex, 0, 0);\r\nvortex_EqHw_SetLeftCoefs(vortex, asEqCoefsPipes);\r\nvortex_EqHw_SetRightCoefs(vortex, asEqCoefsPipes);\r\nvortex_EqHw_SetLeftGainsCurrent(vortex, eq_gains_current);\r\nvortex_EqHw_SetRightGainsCurrent(vortex, eq_gains_current);\r\nvortex_EqHw_SetLeftGainsTarget(vortex, eq_gains_current);\r\nvortex_EqHw_SetRightGainsTarget(vortex, eq_gains_current);\r\n}\r\nstatic void\r\nvortex_EqHw_Program10Band(vortex_t * vortex, auxxEqCoeffSet_t * coefset)\r\n{\r\nvortex_EqHw_SetTimeConsts(vortex, 0xc, 0x7fe0);\r\nvortex_EqHw_SetLeftCoefs(vortex, coefset->LeftCoefs);\r\nvortex_EqHw_SetRightCoefs(vortex, coefset->RightCoefs);\r\nvortex_EqHw_SetLeftGainsCurrent(vortex, coefset->LeftGains);\r\nvortex_EqHw_SetRightGainsTarget(vortex, coefset->RightGains);\r\nvortex_EqHw_SetLeftGainsTarget(vortex, coefset->LeftGains);\r\nvortex_EqHw_SetRightGainsCurrent(vortex, coefset->RightGains);\r\n}\r\nstatic void vortex_EqHw_GetTenBandLevels(vortex_t * vortex, u16 peaks[])\r\n{\r\neqhw_t *eqhw = &(vortex->eq.this04);\r\nint i;\r\nif (eqhw->this04 <= 0)\r\nreturn;\r\nfor (i = 0; i < eqhw->this04; i++)\r\npeaks[i] = hwread(vortex->mmio, 0x2B024 + i * 0x30);\r\nfor (i = 0; i < eqhw->this04; i++)\r\npeaks[i + eqhw->this04] =\r\nhwread(vortex->mmio, 0x2B204 + i * 0x30);\r\n}\r\nstatic int vortex_Eqlzr_GetLeftGain(vortex_t * vortex, u16 index, u16 * gain)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif (eq->this28) {\r\n*gain = eq->this130[index];\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nstatic void vortex_Eqlzr_SetLeftGain(vortex_t * vortex, u16 index, u16 gain)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif (eq->this28 == 0)\r\nreturn;\r\neq->this130[index] = gain;\r\nif (eq->this54)\r\nreturn;\r\nvortex_EqHw_SetLeftGainsSingleTarget(vortex, index, gain);\r\n}\r\nstatic int vortex_Eqlzr_GetRightGain(vortex_t * vortex, u16 index, u16 * gain)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif (eq->this28) {\r\n*gain = eq->this130[index + eq->this10];\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nstatic void vortex_Eqlzr_SetRightGain(vortex_t * vortex, u16 index, u16 gain)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif (eq->this28 == 0)\r\nreturn;\r\neq->this130[index + eq->this10] = gain;\r\nif (eq->this54)\r\nreturn;\r\nvortex_EqHw_SetRightGainsSingleTarget(vortex, index, gain);\r\n}\r\nstatic int vortex_Eqlzr_SetAllBandsFromActiveCoeffSet(vortex_t * vortex)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nvortex_EqHw_SetLeftGainsTarget(vortex, eq->this130);\r\nvortex_EqHw_SetRightGainsTarget(vortex, &(eq->this130[eq->this10]));\r\nreturn 0;\r\n}\r\nstatic int\r\nvortex_Eqlzr_SetAllBands(vortex_t * vortex, u16 gains[], s32 count)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nint i;\r\nif (((eq->this10) * 2 != count) || (eq->this28 == 0))\r\nreturn 1;\r\nfor (i = 0; i < count; i++) {\r\neq->this130[i] = gains[i];\r\n}\r\nif (eq->this54)\r\nreturn 0;\r\nreturn vortex_Eqlzr_SetAllBandsFromActiveCoeffSet(vortex);\r\n}\r\nstatic void\r\nvortex_Eqlzr_SetA3dBypassGain(vortex_t * vortex, u32 a, u32 b)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nu32 eax, ebx;\r\neq->this58 = a;\r\neq->this5c = b;\r\nif (eq->this54)\r\neax = eq->this0e;\r\nelse\r\neax = eq->this0a;\r\nebx = (eax * eq->this58) >> 0x10;\r\neax = (eax * eq->this5c) >> 0x10;\r\nvortex_EqHw_SetA3DBypassGain(vortex, ebx, eax);\r\n}\r\nstatic void vortex_Eqlzr_ProgramA3dBypassGain(vortex_t * vortex)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nu32 eax, ebx;\r\nif (eq->this54)\r\neax = eq->this0e;\r\nelse\r\neax = eq->this0a;\r\nebx = (eax * eq->this58) >> 0x10;\r\neax = (eax * eq->this5c) >> 0x10;\r\nvortex_EqHw_SetA3DBypassGain(vortex, ebx, eax);\r\n}\r\nstatic void vortex_Eqlzr_ShutDownA3d(vortex_t * vortex)\r\n{\r\nif (vortex != NULL)\r\nvortex_EqHw_ZeroA3DIO(vortex);\r\n}\r\nstatic void vortex_Eqlzr_SetBypass(vortex_t * vortex, u32 bp)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif ((eq->this28) && (bp == 0)) {\r\nvortex_Eqlzr_SetAllBandsFromActiveCoeffSet(vortex);\r\nvortex_EqHw_SetBypassGain(vortex, eq->this08, eq->this08);\r\n} else {\r\nvortex_EqHw_SetLeftGainsTarget(vortex, eq->this14_array);\r\nvortex_EqHw_SetRightGainsTarget(vortex, eq->this14_array);\r\nvortex_EqHw_SetBypassGain(vortex, eq->this0c, eq->this0c);\r\n}\r\nvortex_Eqlzr_ProgramA3dBypassGain(vortex);\r\n}\r\nstatic void vortex_Eqlzr_ReadAndSetActiveCoefSet(vortex_t * vortex)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nmemcpy(&(eq->coefset), &asEqCoefsNormal, sizeof(auxxEqCoeffSet_t));\r\nvortex_Eqlzr_SetAllBands(vortex, eq_gains_normal, eq->this10 * 2);\r\n}\r\nstatic int vortex_Eqlzr_GetAllPeaks(vortex_t * vortex, u16 * peaks, int *count)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\nif (eq->this10 == 0)\r\nreturn 1;\r\n*count = eq->this10 * 2;\r\nvortex_EqHw_GetTenBandLevels(vortex, peaks);\r\nreturn 0;\r\n}\r\nstatic void vortex_Eqlzr_init(vortex_t * vortex)\r\n{\r\neqlzr_t *eq = &(vortex->eq);\r\neq->this08 = 0;\r\neq->this0a = 0x5999;\r\neq->this0c = 0x5999;\r\neq->this0e = 0x5999;\r\neq->this10 = 0xa;\r\neq->this04.this04 = eq->this10;\r\neq->this28 = 0x1;\r\neq->this54 = 0x0;\r\neq->this58 = 0xffff;\r\neq->this5c = 0xffff;\r\nmemset(eq->this14_array, 0, sizeof(eq->this14_array));\r\nvortex_EqHw_ZeroState(vortex);\r\nvortex_EqHw_SetSampleRate(vortex, 0x11);\r\nvortex_Eqlzr_ReadAndSetActiveCoefSet(vortex);\r\nvortex_EqHw_Program10Band(vortex, &(eq->coefset));\r\nvortex_Eqlzr_SetBypass(vortex, eq->this54);\r\nvortex_Eqlzr_SetA3dBypassGain(vortex, 0, 0);\r\nvortex_EqHw_Enable(vortex);\r\n}\r\nstatic void vortex_Eqlzr_shutdown(vortex_t * vortex)\r\n{\r\nvortex_Eqlzr_ShutDownA3d(vortex);\r\nvortex_EqHw_ProgramPipe(vortex);\r\nvortex_EqHw_Disable(vortex);\r\n}\r\nstatic int\r\nsnd_vortex_eqtoggle_get(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nvortex_t *vortex = snd_kcontrol_chip(kcontrol);\r\neqlzr_t *eq = &(vortex->eq);\r\nucontrol->value.integer.value[0] = eq->this54 ? 0 : 1;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_eqtoggle_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nvortex_t *vortex = snd_kcontrol_chip(kcontrol);\r\neqlzr_t *eq = &(vortex->eq);\r\neq->this54 = ucontrol->value.integer.value[0] ? 0 : 1;\r\nvortex_Eqlzr_SetBypass(vortex, eq->this54);\r\nreturn 1;\r\n}\r\nstatic int\r\nsnd_vortex_eq_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 2;\r\nuinfo->value.integer.min = 0x0000;\r\nuinfo->value.integer.max = 0x7fff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_eq_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nvortex_t *vortex = snd_kcontrol_chip(kcontrol);\r\nint i = kcontrol->private_value;\r\nu16 gainL = 0, gainR = 0;\r\nvortex_Eqlzr_GetLeftGain(vortex, i, &gainL);\r\nvortex_Eqlzr_GetRightGain(vortex, i, &gainR);\r\nucontrol->value.integer.value[0] = gainL;\r\nucontrol->value.integer.value[1] = gainR;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_eq_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nvortex_t *vortex = snd_kcontrol_chip(kcontrol);\r\nint changed = 0, i = kcontrol->private_value;\r\nu16 gainL = 0, gainR = 0;\r\nvortex_Eqlzr_GetLeftGain(vortex, i, &gainL);\r\nvortex_Eqlzr_GetRightGain(vortex, i, &gainR);\r\nif (gainL != ucontrol->value.integer.value[0]) {\r\nvortex_Eqlzr_SetLeftGain(vortex, i,\r\nucontrol->value.integer.value[0]);\r\nchanged = 1;\r\n}\r\nif (gainR != ucontrol->value.integer.value[1]) {\r\nvortex_Eqlzr_SetRightGain(vortex, i,\r\nucontrol->value.integer.value[1]);\r\nchanged = 1;\r\n}\r\nreturn changed;\r\n}\r\nstatic int\r\nsnd_vortex_peaks_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 20;\r\nuinfo->value.integer.min = 0x0000;\r\nuinfo->value.integer.max = 0x7fff;\r\nreturn 0;\r\n}\r\nstatic int\r\nsnd_vortex_peaks_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nvortex_t *vortex = snd_kcontrol_chip(kcontrol);\r\nint i, count = 0;\r\nu16 peaks[20];\r\nvortex_Eqlzr_GetAllPeaks(vortex, peaks, &count);\r\nif (count != 20) {\r\ndev_err(vortex->card->dev,\r\n"peak count error 20 != %d\n", count);\r\nreturn -1;\r\n}\r\nfor (i = 0; i < 20; i++)\r\nucontrol->value.integer.value[i] = peaks[i];\r\nreturn 0;\r\n}\r\nstatic int vortex_eq_init(vortex_t *vortex)\r\n{\r\nstruct snd_kcontrol *kcontrol;\r\nint err, i;\r\nvortex_Eqlzr_init(vortex);\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_eqtoggle_kcontrol, vortex)) == NULL)\r\nreturn -ENOMEM;\r\nkcontrol->private_value = 0;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\nfor (i = 0; i < 10; i++) {\r\nif ((kcontrol =\r\nsnd_ctl_new1(&vortex_eq_kcontrol, vortex)) == NULL)\r\nreturn -ENOMEM;\r\nsnprintf(kcontrol->id.name, sizeof(kcontrol->id.name),\r\n"%s Playback Volume", EqBandLabels[i]);\r\nkcontrol->private_value = i;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\n}\r\nif ((kcontrol = snd_ctl_new1(&vortex_levels_kcontrol, vortex)) == NULL)\r\nreturn -ENOMEM;\r\nif ((err = snd_ctl_add(vortex->card, kcontrol)) < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int vortex_eq_free(vortex_t * vortex)\r\n{\r\nvortex_Eqlzr_shutdown(vortex);\r\nreturn 0;\r\n}
