int eprom_init(struct hfi1_devdata *dd)\r\n{\r\nint ret = 0;\r\nif (dd->pcidev->device != PCI_DEVICE_ID_INTEL0)\r\nreturn 0;\r\nret = acquire_chip_resource(dd, CR_EPROM, EPROM_TIMEOUT);\r\nif (ret) {\r\ndd_dev_err(dd,\r\n"%s: unable to acquire EPROM resource, no EPROM support\n",\r\n__func__);\r\ngoto done_asic;\r\n}\r\nwrite_csr(dd, ASIC_EEP_CTL_STAT, ASIC_EEP_CTL_STAT_EP_RESET_SMASK);\r\nwrite_csr(dd, ASIC_EEP_CTL_STAT,\r\nEP_SPEED_FULL << ASIC_EEP_CTL_STAT_RATE_SPI_SHIFT);\r\nwrite_csr(dd, ASIC_EEP_ADDR_CMD, CMD_RELEASE_POWERDOWN_NOID);\r\ndd->eprom_available = true;\r\nrelease_chip_resource(dd, CR_EPROM);\r\ndone_asic:\r\nreturn ret;\r\n}
