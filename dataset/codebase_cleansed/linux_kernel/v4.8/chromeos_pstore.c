static int __init chromeos_probe_acpi(struct platform_device *pdev)\r\n{\r\nstruct resource *res;\r\nresource_size_t len;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nif (!res)\r\nreturn -ENOMEM;\r\nlen = resource_size(res);\r\nif (!res->start || !len)\r\nreturn -ENOMEM;\r\npr_info("chromeos ramoops using acpi device.\n");\r\nchromeos_ramoops_data.mem_size = len;\r\nchromeos_ramoops_data.mem_address = res->start;\r\nreturn 0;\r\n}\r\nstatic bool __init chromeos_check_acpi(void)\r\n{\r\nif (!platform_driver_probe(&chromeos_ramoops_acpi, chromeos_probe_acpi))\r\nreturn true;\r\nreturn false;\r\n}\r\nstatic inline bool chromeos_check_acpi(void) { return false; }\r\nstatic int __init chromeos_pstore_init(void)\r\n{\r\nbool acpi_dev_found;\r\nacpi_dev_found = chromeos_check_acpi();\r\nif (acpi_dev_found || dmi_check_system(chromeos_pstore_dmi_table))\r\nreturn platform_device_register(&chromeos_ramoops);\r\nreturn -ENODEV;\r\n}\r\nstatic void __exit chromeos_pstore_exit(void)\r\n{\r\nplatform_device_unregister(&chromeos_ramoops);\r\n}
