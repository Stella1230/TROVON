void exynos4_jpeg_sw_reset(void __iomem *base)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_JPEG_CNTL_REG);\r\nwritel(reg & ~EXYNOS4_SOFT_RESET_HI, base + EXYNOS4_JPEG_CNTL_REG);\r\nudelay(100);\r\nwritel(reg | EXYNOS4_SOFT_RESET_HI, base + EXYNOS4_JPEG_CNTL_REG);\r\n}\r\nvoid exynos4_jpeg_set_enc_dec_mode(void __iomem *base, unsigned int mode)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_JPEG_CNTL_REG);\r\nif (mode == S5P_JPEG_DECODE) {\r\nwritel((reg & EXYNOS4_ENC_DEC_MODE_MASK) |\r\nEXYNOS4_DEC_MODE,\r\nbase + EXYNOS4_JPEG_CNTL_REG);\r\n} else {\r\nwritel((reg & EXYNOS4_ENC_DEC_MODE_MASK) |\r\nEXYNOS4_ENC_MODE,\r\nbase + EXYNOS4_JPEG_CNTL_REG);\r\n}\r\n}\r\nvoid __exynos4_jpeg_set_img_fmt(void __iomem *base, unsigned int img_fmt,\r\nunsigned int version)\r\n{\r\nunsigned int reg;\r\nunsigned int exynos4_swap_chroma_cbcr;\r\nunsigned int exynos4_swap_chroma_crcb;\r\nif (version == SJPEG_EXYNOS4) {\r\nexynos4_swap_chroma_cbcr = EXYNOS4_SWAP_CHROMA_CBCR;\r\nexynos4_swap_chroma_crcb = EXYNOS4_SWAP_CHROMA_CRCB;\r\n} else {\r\nexynos4_swap_chroma_cbcr = EXYNOS5433_SWAP_CHROMA_CBCR;\r\nexynos4_swap_chroma_crcb = EXYNOS5433_SWAP_CHROMA_CRCB;\r\n}\r\nreg = readl(base + EXYNOS4_IMG_FMT_REG) &\r\nEXYNOS4_ENC_IN_FMT_MASK;\r\nswitch (img_fmt) {\r\ncase V4L2_PIX_FMT_GREY:\r\nreg = reg | EXYNOS4_ENC_GRAY_IMG | EXYNOS4_GRAY_IMG_IP;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB32:\r\nreg = reg | EXYNOS4_ENC_RGB_IMG |\r\nEXYNOS4_RGB_IP_RGB_32BIT_IMG;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB565:\r\nreg = reg | EXYNOS4_ENC_RGB_IMG |\r\nEXYNOS4_RGB_IP_RGB_16BIT_IMG;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV24:\r\nreg = reg | EXYNOS4_ENC_YUV_444_IMG |\r\nEXYNOS4_YUV_444_IP_YUV_444_2P_IMG |\r\nexynos4_swap_chroma_cbcr;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV42:\r\nreg = reg | EXYNOS4_ENC_YUV_444_IMG |\r\nEXYNOS4_YUV_444_IP_YUV_444_2P_IMG |\r\nexynos4_swap_chroma_crcb;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUYV:\r\nreg = reg | EXYNOS4_DEC_YUV_422_IMG |\r\nEXYNOS4_YUV_422_IP_YUV_422_1P_IMG |\r\nexynos4_swap_chroma_cbcr;\r\nbreak;\r\ncase V4L2_PIX_FMT_YVYU:\r\nreg = reg | EXYNOS4_DEC_YUV_422_IMG |\r\nEXYNOS4_YUV_422_IP_YUV_422_1P_IMG |\r\nexynos4_swap_chroma_crcb;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV16:\r\nreg = reg | EXYNOS4_DEC_YUV_422_IMG |\r\nEXYNOS4_YUV_422_IP_YUV_422_2P_IMG |\r\nexynos4_swap_chroma_cbcr;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV61:\r\nreg = reg | EXYNOS4_DEC_YUV_422_IMG |\r\nEXYNOS4_YUV_422_IP_YUV_422_2P_IMG |\r\nexynos4_swap_chroma_crcb;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV12:\r\nreg = reg | EXYNOS4_DEC_YUV_420_IMG |\r\nEXYNOS4_YUV_420_IP_YUV_420_2P_IMG |\r\nexynos4_swap_chroma_cbcr;\r\nbreak;\r\ncase V4L2_PIX_FMT_NV21:\r\nreg = reg | EXYNOS4_DEC_YUV_420_IMG |\r\nEXYNOS4_YUV_420_IP_YUV_420_2P_IMG |\r\nexynos4_swap_chroma_crcb;\r\nbreak;\r\ncase V4L2_PIX_FMT_YUV420:\r\nreg = reg | EXYNOS4_DEC_YUV_420_IMG |\r\nEXYNOS4_YUV_420_IP_YUV_420_3P_IMG |\r\nexynos4_swap_chroma_cbcr;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nwritel(reg, base + EXYNOS4_IMG_FMT_REG);\r\n}\r\nvoid __exynos4_jpeg_set_enc_out_fmt(void __iomem *base, unsigned int out_fmt,\r\nunsigned int version)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_IMG_FMT_REG) &\r\n~(version == SJPEG_EXYNOS4 ? EXYNOS4_ENC_FMT_MASK :\r\nEXYNOS5433_ENC_FMT_MASK);\r\nswitch (out_fmt) {\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_GRAY:\r\nreg = reg | EXYNOS4_ENC_FMT_GRAY;\r\nbreak;\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_444:\r\nreg = reg | EXYNOS4_ENC_FMT_YUV_444;\r\nbreak;\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_422:\r\nreg = reg | EXYNOS4_ENC_FMT_YUV_422;\r\nbreak;\r\ncase V4L2_JPEG_CHROMA_SUBSAMPLING_420:\r\nreg = reg | EXYNOS4_ENC_FMT_YUV_420;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nwritel(reg, base + EXYNOS4_IMG_FMT_REG);\r\n}\r\nvoid exynos4_jpeg_set_interrupt(void __iomem *base, unsigned int version)\r\n{\r\nunsigned int reg;\r\nif (version == SJPEG_EXYNOS4) {\r\nreg = readl(base + EXYNOS4_INT_EN_REG) & ~EXYNOS4_INT_EN_MASK;\r\nwritel(reg | EXYNOS4_INT_EN_ALL, base + EXYNOS4_INT_EN_REG);\r\n} else {\r\nreg = readl(base + EXYNOS4_INT_EN_REG) &\r\n~EXYNOS5433_INT_EN_MASK;\r\nwritel(reg | EXYNOS5433_INT_EN_ALL, base + EXYNOS4_INT_EN_REG);\r\n}\r\n}\r\nunsigned int exynos4_jpeg_get_int_status(void __iomem *base)\r\n{\r\nunsigned int int_status;\r\nint_status = readl(base + EXYNOS4_INT_STATUS_REG);\r\nreturn int_status;\r\n}\r\nunsigned int exynos4_jpeg_get_fifo_status(void __iomem *base)\r\n{\r\nunsigned int fifo_status;\r\nfifo_status = readl(base + EXYNOS4_FIFO_STATUS_REG);\r\nreturn fifo_status;\r\n}\r\nvoid exynos4_jpeg_set_huf_table_enable(void __iomem *base, int value)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_JPEG_CNTL_REG) & ~EXYNOS4_HUF_TBL_EN;\r\nif (value == 1)\r\nwritel(reg | EXYNOS4_HUF_TBL_EN,\r\nbase + EXYNOS4_JPEG_CNTL_REG);\r\nelse\r\nwritel(reg & ~EXYNOS4_HUF_TBL_EN,\r\nbase + EXYNOS4_JPEG_CNTL_REG);\r\n}\r\nvoid exynos4_jpeg_set_sys_int_enable(void __iomem *base, int value)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_JPEG_CNTL_REG) & ~(EXYNOS4_SYS_INT_EN);\r\nif (value == 1)\r\nwritel(reg | EXYNOS4_SYS_INT_EN, base + EXYNOS4_JPEG_CNTL_REG);\r\nelse\r\nwritel(reg & ~EXYNOS4_SYS_INT_EN, base + EXYNOS4_JPEG_CNTL_REG);\r\n}\r\nvoid exynos4_jpeg_set_stream_buf_address(void __iomem *base,\r\nunsigned int address)\r\n{\r\nwritel(address, base + EXYNOS4_OUT_MEM_BASE_REG);\r\n}\r\nvoid exynos4_jpeg_set_stream_size(void __iomem *base,\r\nunsigned int x_value, unsigned int y_value)\r\n{\r\nwritel(0x0, base + EXYNOS4_JPEG_IMG_SIZE_REG);\r\nwritel(EXYNOS4_X_SIZE(x_value) | EXYNOS4_Y_SIZE(y_value),\r\nbase + EXYNOS4_JPEG_IMG_SIZE_REG);\r\n}\r\nvoid exynos4_jpeg_set_frame_buf_address(void __iomem *base,\r\nstruct s5p_jpeg_addr *exynos4_jpeg_addr)\r\n{\r\nwritel(exynos4_jpeg_addr->y, base + EXYNOS4_IMG_BA_PLANE_1_REG);\r\nwritel(exynos4_jpeg_addr->cb, base + EXYNOS4_IMG_BA_PLANE_2_REG);\r\nwritel(exynos4_jpeg_addr->cr, base + EXYNOS4_IMG_BA_PLANE_3_REG);\r\n}\r\nvoid exynos4_jpeg_set_encode_tbl_select(void __iomem *base,\r\nenum exynos4_jpeg_img_quality_level level)\r\n{\r\nunsigned int reg;\r\nreg = EXYNOS4_Q_TBL_COMP1_0 | EXYNOS4_Q_TBL_COMP2_1 |\r\nEXYNOS4_Q_TBL_COMP3_1 |\r\nEXYNOS4_HUFF_TBL_COMP1_AC_0_DC_1 |\r\nEXYNOS4_HUFF_TBL_COMP2_AC_0_DC_0 |\r\nEXYNOS4_HUFF_TBL_COMP3_AC_1_DC_1;\r\nwritel(reg, base + EXYNOS4_TBL_SEL_REG);\r\n}\r\nvoid exynos4_jpeg_set_dec_components(void __iomem *base, int n)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_TBL_SEL_REG);\r\nreg |= EXYNOS4_NF(n);\r\nwritel(reg, base + EXYNOS4_TBL_SEL_REG);\r\n}\r\nvoid exynos4_jpeg_select_dec_q_tbl(void __iomem *base, char c, char x)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_TBL_SEL_REG);\r\nreg |= EXYNOS4_Q_TBL_COMP(c, x);\r\nwritel(reg, base + EXYNOS4_TBL_SEL_REG);\r\n}\r\nvoid exynos4_jpeg_select_dec_h_tbl(void __iomem *base, char c, char x)\r\n{\r\nunsigned int reg;\r\nreg = readl(base + EXYNOS4_TBL_SEL_REG);\r\nreg |= EXYNOS4_HUFF_TBL_COMP(c, x);\r\nwritel(reg, base + EXYNOS4_TBL_SEL_REG);\r\n}\r\nvoid exynos4_jpeg_set_encode_hoff_cnt(void __iomem *base, unsigned int fmt)\r\n{\r\nif (fmt == V4L2_PIX_FMT_GREY)\r\nwritel(0xd2, base + EXYNOS4_HUFF_CNT_REG);\r\nelse\r\nwritel(0x1a2, base + EXYNOS4_HUFF_CNT_REG);\r\n}\r\nunsigned int exynos4_jpeg_get_stream_size(void __iomem *base)\r\n{\r\nunsigned int size;\r\nsize = readl(base + EXYNOS4_BITSTREAM_SIZE_REG);\r\nreturn size;\r\n}\r\nvoid exynos4_jpeg_set_dec_bitstream_size(void __iomem *base, unsigned int size)\r\n{\r\nwritel(size, base + EXYNOS4_BITSTREAM_SIZE_REG);\r\n}\r\nvoid exynos4_jpeg_get_frame_size(void __iomem *base,\r\nunsigned int *width, unsigned int *height)\r\n{\r\n*width = (readl(base + EXYNOS4_DECODE_XY_SIZE_REG) &\r\nEXYNOS4_DECODED_SIZE_MASK);\r\n*height = (readl(base + EXYNOS4_DECODE_XY_SIZE_REG) >> 16) &\r\nEXYNOS4_DECODED_SIZE_MASK;\r\n}\r\nunsigned int exynos4_jpeg_get_frame_fmt(void __iomem *base)\r\n{\r\nreturn readl(base + EXYNOS4_DECODE_IMG_FMT_REG) &\r\nEXYNOS4_JPEG_DECODED_IMG_FMT_MASK;\r\n}\r\nvoid exynos4_jpeg_set_timer_count(void __iomem *base, unsigned int size)\r\n{\r\nwritel(size, base + EXYNOS4_INT_TIMER_COUNT_REG);\r\n}
