static void __init em7210_timer_init(void)\r\n{\r\niop_init_time(200000000);\r\n}\r\nvoid __init em7210_map_io(void)\r\n{\r\niop3xx_map_io();\r\niotable_init(em7210_io_desc, ARRAY_SIZE(em7210_io_desc));\r\n}\r\nstatic int __init\r\nem7210_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nstatic int pci_irq_table[][4] = {\r\n{INTB, INTB, INTB, INTB},\r\n{INTA, INTA, INTA, INTA},\r\n{INTD, INTD, INTD, INTD},\r\n{INTC, INTC, INTC, INTC},\r\n{INTD, INTA, INTA, INTA},\r\n{INTD, INTC, INTA, INTA},\r\n};\r\nif (pin < 1 || pin > 4)\r\nreturn -1;\r\nreturn pci_irq_table[slot % 6][pin - 1];\r\n}\r\nstatic int __init em7210_pci_init(void)\r\n{\r\nif (machine_is_em7210())\r\npci_common_init(&em7210_pci);\r\nreturn 0;\r\n}\r\nvoid em7210_power_off(void)\r\n{\r\nint ret;\r\nret = gpio_direction_output(EM7210_HARDWARE_POWER, 1);\r\nif (ret)\r\npr_crit("could not drive power off GPIO high\n");\r\n}\r\nstatic int __init em7210_request_gpios(void)\r\n{\r\nint ret;\r\nif (!machine_is_em7210())\r\nreturn 0;\r\nret = gpio_request(EM7210_HARDWARE_POWER, "power");\r\nif (ret) {\r\npr_err("could not request power off GPIO\n");\r\nreturn 0;\r\n}\r\npm_power_off = em7210_power_off;\r\nreturn 0;\r\n}\r\nstatic void __init em7210_init_machine(void)\r\n{\r\nregister_iop32x_gpio();\r\nplatform_device_register(&em7210_serial_device);\r\nplatform_device_register(&iop3xx_i2c0_device);\r\nplatform_device_register(&iop3xx_i2c1_device);\r\nplatform_device_register(&em7210_flash_device);\r\nplatform_device_register(&iop3xx_dma_0_channel);\r\nplatform_device_register(&iop3xx_dma_1_channel);\r\ni2c_register_board_info(0, em7210_i2c_devices,\r\nARRAY_SIZE(em7210_i2c_devices));\r\n}
