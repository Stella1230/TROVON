static void sha1_generic_block_fn(struct sha1_state *sst, u8 const *src,\r\nint blocks)\r\n{\r\nu32 temp[SHA_WORKSPACE_WORDS];\r\nwhile (blocks--) {\r\nsha_transform(sst->state, src, temp);\r\nsrc += SHA1_BLOCK_SIZE;\r\n}\r\nmemzero_explicit(temp, sizeof(temp));\r\n}\r\nint crypto_sha1_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int len)\r\n{\r\nreturn sha1_base_do_update(desc, data, len, sha1_generic_block_fn);\r\n}\r\nstatic int sha1_final(struct shash_desc *desc, u8 *out)\r\n{\r\nsha1_base_do_finalize(desc, sha1_generic_block_fn);\r\nreturn sha1_base_finish(desc, out);\r\n}\r\nint crypto_sha1_finup(struct shash_desc *desc, const u8 *data,\r\nunsigned int len, u8 *out)\r\n{\r\nsha1_base_do_update(desc, data, len, sha1_generic_block_fn);\r\nreturn sha1_final(desc, out);\r\n}\r\nstatic int __init sha1_generic_mod_init(void)\r\n{\r\nreturn crypto_register_shash(&alg);\r\n}\r\nstatic void __exit sha1_generic_mod_fini(void)\r\n{\r\ncrypto_unregister_shash(&alg);\r\n}
