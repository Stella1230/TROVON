void gic_send_ipi_single(int cpu, unsigned int action)\r\n{\r\nunsigned long flags;\r\nunsigned int intr;\r\nunsigned int core = cpu_data[cpu].core;\r\npr_debug("CPU%d: %s cpu %d action %u status %08x\n",\r\nsmp_processor_id(), __func__, cpu, action, read_c0_status());\r\nlocal_irq_save(flags);\r\nswitch (action) {\r\ncase SMP_CALL_FUNCTION:\r\nintr = plat_ipi_call_int_xlate(cpu);\r\nbreak;\r\ncase SMP_RESCHEDULE_YOURSELF:\r\nintr = plat_ipi_resched_int_xlate(cpu);\r\nbreak;\r\ndefault:\r\nBUG();\r\n}\r\ngic_send_ipi(intr);\r\nif (mips_cpc_present() && (core != current_cpu_data.core)) {\r\nwhile (!cpumask_test_cpu(cpu, &cpu_coherent_mask)) {\r\nmips_cm_lock_other(core, 0);\r\nmips_cpc_lock_other(core);\r\nwrite_cpc_co_cmd(CPC_Cx_CMD_PWRUP);\r\nmips_cpc_unlock_other();\r\nmips_cm_unlock_other();\r\n}\r\n}\r\nlocal_irq_restore(flags);\r\n}\r\nvoid gic_send_ipi_mask(const struct cpumask *mask, unsigned int action)\r\n{\r\nunsigned int i;\r\nfor_each_cpu(i, mask)\r\ngic_send_ipi_single(i, action);\r\n}
