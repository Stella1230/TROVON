static int ltc3815_read_byte_data(struct i2c_client *client, int page, int reg)\r\n{\r\nint ret;\r\nswitch (reg) {\r\ncase PMBUS_VOUT_MODE:\r\nret = 0x40;\r\nbreak;\r\ndefault:\r\nret = -ENODATA;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ltc3815_write_byte(struct i2c_client *client, int page, u8 reg)\r\n{\r\nint ret;\r\nswitch (reg) {\r\ncase PMBUS_CLEAR_FAULTS:\r\nret = pmbus_read_word_data(client, 0, PMBUS_STATUS_WORD);\r\nif (ret > 0) {\r\npmbus_write_word_data(client, 0, PMBUS_STATUS_WORD,\r\nret);\r\nret = 0;\r\n}\r\nbreak;\r\ndefault:\r\nret = -ENODATA;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ltc3815_read_word_data(struct i2c_client *client, int page, int reg)\r\n{\r\nint ret;\r\nswitch (reg) {\r\ncase PMBUS_VIRT_READ_VIN_MAX:\r\nret = pmbus_read_word_data(client, page, LTC3815_MFR_VIN_PEAK);\r\nbreak;\r\ncase PMBUS_VIRT_READ_VOUT_MAX:\r\nret = pmbus_read_word_data(client, page, LTC3815_MFR_VOUT_PEAK);\r\nbreak;\r\ncase PMBUS_VIRT_READ_TEMP_MAX:\r\nret = pmbus_read_word_data(client, page, LTC3815_MFR_TEMP_PEAK);\r\nbreak;\r\ncase PMBUS_VIRT_READ_IOUT_MAX:\r\nret = pmbus_read_word_data(client, page, LTC3815_MFR_IOUT_PEAK);\r\nbreak;\r\ncase PMBUS_VIRT_READ_IIN_MAX:\r\nret = pmbus_read_word_data(client, page, LTC3815_MFR_IIN_PEAK);\r\nbreak;\r\ncase PMBUS_VIRT_RESET_VOUT_HISTORY:\r\ncase PMBUS_VIRT_RESET_VIN_HISTORY:\r\ncase PMBUS_VIRT_RESET_TEMP_HISTORY:\r\ncase PMBUS_VIRT_RESET_IOUT_HISTORY:\r\ncase PMBUS_VIRT_RESET_IIN_HISTORY:\r\nret = 0;\r\nbreak;\r\ndefault:\r\nret = -ENODATA;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ltc3815_write_word_data(struct i2c_client *client, int page,\r\nint reg, u16 word)\r\n{\r\nint ret;\r\nswitch (reg) {\r\ncase PMBUS_VIRT_RESET_IIN_HISTORY:\r\nret = pmbus_write_word_data(client, page,\r\nLTC3815_MFR_IIN_PEAK, 0);\r\nbreak;\r\ncase PMBUS_VIRT_RESET_IOUT_HISTORY:\r\nret = pmbus_write_word_data(client, page,\r\nLTC3815_MFR_IOUT_PEAK, 0);\r\nbreak;\r\ncase PMBUS_VIRT_RESET_VOUT_HISTORY:\r\nret = pmbus_write_word_data(client, page,\r\nLTC3815_MFR_VOUT_PEAK, 0);\r\nbreak;\r\ncase PMBUS_VIRT_RESET_VIN_HISTORY:\r\nret = pmbus_write_word_data(client, page,\r\nLTC3815_MFR_VIN_PEAK, 0);\r\nbreak;\r\ncase PMBUS_VIRT_RESET_TEMP_HISTORY:\r\nret = pmbus_write_word_data(client, page,\r\nLTC3815_MFR_TEMP_PEAK, 0);\r\nbreak;\r\ndefault:\r\nret = -ENODATA;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int ltc3815_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nint chip_id;\r\nif (!i2c_check_functionality(client->adapter,\r\nI2C_FUNC_SMBUS_READ_WORD_DATA))\r\nreturn -ENODEV;\r\nchip_id = i2c_smbus_read_word_data(client, LTC3815_MFR_SPECIAL_ID);\r\nif (chip_id < 0)\r\nreturn chip_id;\r\nif ((chip_id & LTC3815_ID_MASK) != LTC3815_ID)\r\nreturn -ENODEV;\r\nreturn pmbus_do_probe(client, id, &ltc3815_info);\r\n}
