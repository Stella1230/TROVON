static bool touchscreen_get_prop_u32(struct device *dev,\r\nconst char *property,\r\nunsigned int default_value,\r\nunsigned int *value)\r\n{\r\nu32 val;\r\nint error;\r\nerror = device_property_read_u32(dev, property, &val);\r\nif (error) {\r\n*value = default_value;\r\nreturn false;\r\n}\r\n*value = val;\r\nreturn true;\r\n}\r\nstatic void touchscreen_set_params(struct input_dev *dev,\r\nunsigned long axis,\r\nint max, int fuzz)\r\n{\r\nstruct input_absinfo *absinfo;\r\nif (!test_bit(axis, dev->absbit)) {\r\ndev_warn(&dev->dev,\r\n"DT specifies parameters but the axis %lu is not set up\n",\r\naxis);\r\nreturn;\r\n}\r\nabsinfo = &dev->absinfo[axis];\r\nabsinfo->maximum = max;\r\nabsinfo->fuzz = fuzz;\r\n}\r\nvoid touchscreen_parse_properties(struct input_dev *input, bool multitouch)\r\n{\r\nstruct device *dev = input->dev.parent;\r\nunsigned int axis;\r\nunsigned int maximum, fuzz;\r\nbool data_present;\r\ninput_alloc_absinfo(input);\r\nif (!input->absinfo)\r\nreturn;\r\naxis = multitouch ? ABS_MT_POSITION_X : ABS_X;\r\ndata_present = touchscreen_get_prop_u32(dev, "touchscreen-size-x",\r\ninput_abs_get_max(input,\r\naxis) + 1,\r\n&maximum) |\r\ntouchscreen_get_prop_u32(dev, "touchscreen-fuzz-x",\r\ninput_abs_get_fuzz(input, axis),\r\n&fuzz);\r\nif (data_present)\r\ntouchscreen_set_params(input, axis, maximum - 1, fuzz);\r\naxis = multitouch ? ABS_MT_POSITION_Y : ABS_Y;\r\ndata_present = touchscreen_get_prop_u32(dev, "touchscreen-size-y",\r\ninput_abs_get_max(input,\r\naxis) + 1,\r\n&maximum) |\r\ntouchscreen_get_prop_u32(dev, "touchscreen-fuzz-y",\r\ninput_abs_get_fuzz(input, axis),\r\n&fuzz);\r\nif (data_present)\r\ntouchscreen_set_params(input, axis, maximum - 1, fuzz);\r\naxis = multitouch ? ABS_MT_PRESSURE : ABS_PRESSURE;\r\ndata_present = touchscreen_get_prop_u32(dev,\r\n"touchscreen-max-pressure",\r\ninput_abs_get_max(input, axis),\r\n&maximum) |\r\ntouchscreen_get_prop_u32(dev,\r\n"touchscreen-fuzz-pressure",\r\ninput_abs_get_fuzz(input, axis),\r\n&fuzz);\r\nif (data_present)\r\ntouchscreen_set_params(input, axis, maximum, fuzz);\r\n}
