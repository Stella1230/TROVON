static int loongson_gpio_direction_input(struct gpio_chip *chip, unsigned gpio)\r\n{\r\nu32 temp;\r\nu32 mask;\r\nspin_lock(&gpio_lock);\r\nmask = 1 << gpio;\r\ntemp = LOONGSON_GPIOIE;\r\ntemp |= mask;\r\nLOONGSON_GPIOIE = temp;\r\nspin_unlock(&gpio_lock);\r\nreturn 0;\r\n}\r\nstatic int loongson_gpio_direction_output(struct gpio_chip *chip,\r\nunsigned gpio, int level)\r\n{\r\nu32 temp;\r\nu32 mask;\r\ngpio_set_value(gpio, level);\r\nspin_lock(&gpio_lock);\r\nmask = 1 << gpio;\r\ntemp = LOONGSON_GPIOIE;\r\ntemp &= (~mask);\r\nLOONGSON_GPIOIE = temp;\r\nspin_unlock(&gpio_lock);\r\nreturn 0;\r\n}\r\nstatic int loongson_gpio_get_value(struct gpio_chip *chip, unsigned gpio)\r\n{\r\nu32 val;\r\nu32 mask;\r\nmask = 1 << (gpio + LOONGSON_GPIO_IN_OFFSET);\r\nspin_lock(&gpio_lock);\r\nval = LOONGSON_GPIODATA;\r\nspin_unlock(&gpio_lock);\r\nreturn (val & mask) != 0;\r\n}\r\nstatic void loongson_gpio_set_value(struct gpio_chip *chip,\r\nunsigned gpio, int value)\r\n{\r\nu32 val;\r\nu32 mask;\r\nmask = 1 << gpio;\r\nspin_lock(&gpio_lock);\r\nval = LOONGSON_GPIODATA;\r\nif (value)\r\nval |= mask;\r\nelse\r\nval &= (~mask);\r\nLOONGSON_GPIODATA = val;\r\nspin_unlock(&gpio_lock);\r\n}\r\nstatic int __init loongson_gpio_setup(void)\r\n{\r\nreturn gpiochip_add_data(&loongson_chip, NULL);\r\n}
