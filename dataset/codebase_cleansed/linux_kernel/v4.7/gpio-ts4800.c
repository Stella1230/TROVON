static int ts4800_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *node;\r\nstruct gpio_chip *chip;\r\nstruct resource *res;\r\nvoid __iomem *base_addr;\r\nint retval;\r\nu32 ngpios;\r\nchip = devm_kzalloc(&pdev->dev, sizeof(struct gpio_chip), GFP_KERNEL);\r\nif (!chip)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nbase_addr = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(base_addr))\r\nreturn PTR_ERR(base_addr);\r\nnode = pdev->dev.of_node;\r\nif (!node)\r\nreturn -EINVAL;\r\nretval = of_property_read_u32(node, "ngpios", &ngpios);\r\nif (retval == -EINVAL)\r\nngpios = DEFAULT_PIN_NUMBER;\r\nelse if (retval)\r\nreturn retval;\r\nretval = bgpio_init(chip, &pdev->dev, 2, base_addr + INPUT_REG_OFFSET,\r\nbase_addr + OUTPUT_REG_OFFSET, NULL,\r\nbase_addr + DIRECTION_REG_OFFSET, NULL, 0);\r\nif (retval) {\r\ndev_err(&pdev->dev, "bgpio_init failed\n");\r\nreturn retval;\r\n}\r\nchip->ngpio = ngpios;\r\nplatform_set_drvdata(pdev, chip);\r\nreturn devm_gpiochip_add_data(&pdev->dev, chip, NULL);\r\n}
