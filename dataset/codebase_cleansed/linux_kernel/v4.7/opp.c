int __init omap_init_opp_table(struct omap_opp_def *opp_def,\r\nu32 opp_def_size)\r\n{\r\nint i, r;\r\nif (of_have_populated_dt())\r\nreturn -EINVAL;\r\nif (!opp_def || !opp_def_size) {\r\npr_err("%s: invalid params!\n", __func__);\r\nreturn -EINVAL;\r\n}\r\nif (omap_table_init)\r\nreturn -EEXIST;\r\nomap_table_init = 1;\r\nfor (i = 0; i < opp_def_size; i++, opp_def++) {\r\nstruct omap_hwmod *oh;\r\nstruct device *dev;\r\nif (!opp_def->hwmod_name) {\r\npr_err("%s: NULL name of omap_hwmod, failing [%d].\n",\r\n__func__, i);\r\nreturn -EINVAL;\r\n}\r\nif (!strncmp(opp_def->hwmod_name, "mpu", 3)) {\r\ndev = get_cpu_device(0);\r\n} else {\r\noh = omap_hwmod_lookup(opp_def->hwmod_name);\r\nif (!oh || !oh->od) {\r\npr_debug("%s: no hwmod or odev for %s, [%d] cannot add OPPs.\n",\r\n__func__, opp_def->hwmod_name, i);\r\ncontinue;\r\n}\r\ndev = &oh->od->pdev->dev;\r\n}\r\nr = dev_pm_opp_add(dev, opp_def->freq, opp_def->u_volt);\r\nif (r) {\r\ndev_err(dev, "%s: add OPP %ld failed for %s [%d] result=%d\n",\r\n__func__, opp_def->freq,\r\nopp_def->hwmod_name, i, r);\r\n} else {\r\nif (!opp_def->default_available)\r\nr = dev_pm_opp_disable(dev, opp_def->freq);\r\nif (r)\r\ndev_err(dev, "%s: disable %ld failed for %s [%d] result=%d\n",\r\n__func__, opp_def->freq,\r\nopp_def->hwmod_name, i, r);\r\n}\r\n}\r\nreturn 0;\r\n}
