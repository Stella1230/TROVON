u32 omap_secure_dispatcher(u32 idx, u32 flag, u32 nargs, u32 arg1, u32 arg2,\r\nu32 arg3, u32 arg4)\r\n{\r\nu32 ret;\r\nu32 param[5];\r\nparam[0] = nargs;\r\nparam[1] = arg1;\r\nparam[2] = arg2;\r\nparam[3] = arg3;\r\nparam[4] = arg4;\r\nflush_cache_all();\r\nouter_clean_range(__pa(param), __pa(param + 5));\r\nret = omap_smc2(idx, flag, __pa(param));\r\nreturn ret;\r\n}\r\nint __init omap_secure_ram_reserve_memblock(void)\r\n{\r\nu32 size = OMAP_SECURE_RAM_STORAGE;\r\nsize = ALIGN(size, SECTION_SIZE);\r\nomap_secure_memblock_base = arm_memblock_steal(size, SECTION_SIZE);\r\nreturn 0;\r\n}\r\nphys_addr_t omap_secure_ram_mempool_base(void)\r\n{\r\nreturn omap_secure_memblock_base;\r\n}\r\nu32 rx51_secure_dispatcher(u32 idx, u32 process, u32 flag, u32 nargs,\r\nu32 arg1, u32 arg2, u32 arg3, u32 arg4)\r\n{\r\nu32 ret;\r\nu32 param[5];\r\nparam[0] = nargs+1;\r\nparam[1] = arg1;\r\nparam[2] = arg2;\r\nparam[3] = arg3;\r\nparam[4] = arg4;\r\nlocal_irq_disable();\r\nlocal_fiq_disable();\r\nflush_cache_all();\r\nouter_clean_range(__pa(param), __pa(param + 5));\r\nret = omap_smc3(idx, process, flag, __pa(param));\r\nflush_cache_all();\r\nlocal_fiq_enable();\r\nlocal_irq_enable();\r\nreturn ret;\r\n}\r\nu32 rx51_secure_update_aux_cr(u32 set_bits, u32 clear_bits)\r\n{\r\nu32 acr;\r\nasm volatile ("mrc p15, 0, %0, c1, c0, 1" : "=r" (acr));\r\nacr &= ~clear_bits;\r\nacr |= set_bits;\r\nreturn rx51_secure_dispatcher(RX51_PPA_WRITE_ACR,\r\n0,\r\nFLAG_START_CRITICAL,\r\n1, acr, 0, 0, 0);\r\n}\r\nu32 rx51_secure_rng_call(u32 ptr, u32 count, u32 flag)\r\n{\r\nreturn rx51_secure_dispatcher(RX51_PPA_HWRNG,\r\n0,\r\nNO_FLAG,\r\n3, ptr, count, flag, 0);\r\n}
