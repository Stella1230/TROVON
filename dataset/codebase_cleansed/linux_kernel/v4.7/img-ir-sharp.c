static int img_ir_sharp_scancode(int len, u64 raw, u64 enabled_protocols,\r\nstruct img_ir_scancode_req *request)\r\n{\r\nunsigned int addr, cmd, exp, chk;\r\nif (len != 15)\r\nreturn -EINVAL;\r\naddr = (raw >> 0) & 0x1f;\r\ncmd = (raw >> 5) & 0xff;\r\nexp = (raw >> 13) & 0x1;\r\nchk = (raw >> 14) & 0x1;\r\nif (!exp)\r\nreturn -EINVAL;\r\nif (chk)\r\nreturn -EINVAL;\r\nrequest->protocol = RC_TYPE_SHARP;\r\nrequest->scancode = addr << 8 | cmd;\r\nreturn IMG_IR_SCANCODE;\r\n}\r\nstatic int img_ir_sharp_filter(const struct rc_scancode_filter *in,\r\nstruct img_ir_filter *out, u64 protocols)\r\n{\r\nunsigned int addr, cmd, exp = 0, chk = 0;\r\nunsigned int addr_m, cmd_m, exp_m = 0, chk_m = 0;\r\naddr = (in->data >> 8) & 0x1f;\r\naddr_m = (in->mask >> 8) & 0x1f;\r\ncmd = (in->data >> 0) & 0xff;\r\ncmd_m = (in->mask >> 0) & 0xff;\r\nif (cmd_m) {\r\nexp = 1;\r\nexp_m = 1;\r\nchk = 0;\r\nchk_m = 1;\r\n}\r\nout->data = addr |\r\ncmd << 5 |\r\nexp << 13 |\r\nchk << 14;\r\nout->mask = addr_m |\r\ncmd_m << 5 |\r\nexp_m << 13 |\r\nchk_m << 14;\r\nreturn 0;\r\n}
