static int exynos4210_rate_to_clk(unsigned long rate, u32 *reg)\r\n{\r\nswitch (rate) {\r\ncase 12 * MHZ:\r\n*reg = EXYNOS_4210_UPHYCLK_PHYFSEL_12MHZ;\r\nbreak;\r\ncase 24 * MHZ:\r\n*reg = EXYNOS_4210_UPHYCLK_PHYFSEL_24MHZ;\r\nbreak;\r\ncase 48 * MHZ:\r\n*reg = EXYNOS_4210_UPHYCLK_PHYFSEL_48MHZ;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic void exynos4210_isol(struct samsung_usb2_phy_instance *inst, bool on)\r\n{\r\nstruct samsung_usb2_phy_driver *drv = inst->drv;\r\nu32 offset;\r\nu32 mask;\r\nswitch (inst->cfg->id) {\r\ncase EXYNOS4210_DEVICE:\r\noffset = EXYNOS_4210_USB_ISOL_DEVICE_OFFSET;\r\nmask = EXYNOS_4210_USB_ISOL_DEVICE;\r\nbreak;\r\ncase EXYNOS4210_HOST:\r\noffset = EXYNOS_4210_USB_ISOL_HOST_OFFSET;\r\nmask = EXYNOS_4210_USB_ISOL_HOST;\r\nbreak;\r\ndefault:\r\nreturn;\r\n};\r\nregmap_update_bits(drv->reg_pmu, offset, mask, on ? 0 : mask);\r\n}\r\nstatic void exynos4210_phy_pwr(struct samsung_usb2_phy_instance *inst, bool on)\r\n{\r\nstruct samsung_usb2_phy_driver *drv = inst->drv;\r\nu32 rstbits = 0;\r\nu32 phypwr = 0;\r\nu32 rst;\r\nu32 pwr;\r\nu32 clk;\r\nswitch (inst->cfg->id) {\r\ncase EXYNOS4210_DEVICE:\r\nphypwr = EXYNOS_4210_UPHYPWR_PHY0;\r\nrstbits = EXYNOS_4210_URSTCON_PHY0;\r\nbreak;\r\ncase EXYNOS4210_HOST:\r\nphypwr = EXYNOS_4210_UPHYPWR_PHY1;\r\nrstbits = EXYNOS_4210_URSTCON_PHY1_ALL |\r\nEXYNOS_4210_URSTCON_PHY1_P0 |\r\nEXYNOS_4210_URSTCON_PHY1_P1P2 |\r\nEXYNOS_4210_URSTCON_HOST_LINK_ALL |\r\nEXYNOS_4210_URSTCON_HOST_LINK_P0;\r\nwritel(on, drv->reg_phy + EXYNOS_4210_UPHY1CON);\r\nbreak;\r\ncase EXYNOS4210_HSIC0:\r\nphypwr = EXYNOS_4210_UPHYPWR_HSIC0;\r\nrstbits = EXYNOS_4210_URSTCON_PHY1_P1P2 |\r\nEXYNOS_4210_URSTCON_HOST_LINK_P1;\r\nbreak;\r\ncase EXYNOS4210_HSIC1:\r\nphypwr = EXYNOS_4210_UPHYPWR_HSIC1;\r\nrstbits = EXYNOS_4210_URSTCON_PHY1_P1P2 |\r\nEXYNOS_4210_URSTCON_HOST_LINK_P2;\r\nbreak;\r\n};\r\nif (on) {\r\nclk = readl(drv->reg_phy + EXYNOS_4210_UPHYCLK);\r\nclk &= ~EXYNOS_4210_UPHYCLK_PHYFSEL_MASK;\r\nclk |= drv->ref_reg_val << EXYNOS_4210_UPHYCLK_PHYFSEL_OFFSET;\r\nwritel(clk, drv->reg_phy + EXYNOS_4210_UPHYCLK);\r\npwr = readl(drv->reg_phy + EXYNOS_4210_UPHYPWR);\r\npwr &= ~phypwr;\r\nwritel(pwr, drv->reg_phy + EXYNOS_4210_UPHYPWR);\r\nrst = readl(drv->reg_phy + EXYNOS_4210_UPHYRST);\r\nrst |= rstbits;\r\nwritel(rst, drv->reg_phy + EXYNOS_4210_UPHYRST);\r\nudelay(10);\r\nrst &= ~rstbits;\r\nwritel(rst, drv->reg_phy + EXYNOS_4210_UPHYRST);\r\nudelay(80);\r\n} else {\r\npwr = readl(drv->reg_phy + EXYNOS_4210_UPHYPWR);\r\npwr |= phypwr;\r\nwritel(pwr, drv->reg_phy + EXYNOS_4210_UPHYPWR);\r\n}\r\n}\r\nstatic int exynos4210_power_on(struct samsung_usb2_phy_instance *inst)\r\n{\r\nexynos4210_phy_pwr(inst, 1);\r\nexynos4210_isol(inst, 0);\r\nreturn 0;\r\n}\r\nstatic int exynos4210_power_off(struct samsung_usb2_phy_instance *inst)\r\n{\r\nexynos4210_isol(inst, 1);\r\nexynos4210_phy_pwr(inst, 0);\r\nreturn 0;\r\n}
