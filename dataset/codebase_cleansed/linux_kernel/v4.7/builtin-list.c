int cmd_list(int argc, const char **argv, const char *prefix __maybe_unused)\r\n{\r\nint i;\r\nbool raw_dump = false;\r\nstruct option list_options[] = {\r\nOPT_BOOLEAN(0, "raw-dump", &raw_dump, "Dump raw events"),\r\nOPT_END()\r\n};\r\nconst char * const list_usage[] = {\r\n"perf list [hw|sw|cache|tracepoint|pmu|event_glob]",\r\nNULL\r\n};\r\nset_option_flag(list_options, 0, "raw-dump", PARSE_OPT_HIDDEN);\r\nargc = parse_options(argc, argv, list_options, list_usage,\r\nPARSE_OPT_STOP_AT_NON_OPTION);\r\nsetup_pager();\r\nif (!raw_dump && pager_in_use())\r\nprintf("\nList of pre-defined events (to be used in -e):\n\n");\r\nif (argc == 0) {\r\nprint_events(NULL, raw_dump);\r\nreturn 0;\r\n}\r\nfor (i = 0; i < argc; ++i) {\r\nchar *sep, *s;\r\nif (strcmp(argv[i], "tracepoint") == 0)\r\nprint_tracepoint_events(NULL, NULL, raw_dump);\r\nelse if (strcmp(argv[i], "hw") == 0 ||\r\nstrcmp(argv[i], "hardware") == 0)\r\nprint_symbol_events(NULL, PERF_TYPE_HARDWARE,\r\nevent_symbols_hw, PERF_COUNT_HW_MAX, raw_dump);\r\nelse if (strcmp(argv[i], "sw") == 0 ||\r\nstrcmp(argv[i], "software") == 0)\r\nprint_symbol_events(NULL, PERF_TYPE_SOFTWARE,\r\nevent_symbols_sw, PERF_COUNT_SW_MAX, raw_dump);\r\nelse if (strcmp(argv[i], "cache") == 0 ||\r\nstrcmp(argv[i], "hwcache") == 0)\r\nprint_hwcache_events(NULL, raw_dump);\r\nelse if (strcmp(argv[i], "pmu") == 0)\r\nprint_pmu_events(NULL, raw_dump);\r\nelse if ((sep = strchr(argv[i], ':')) != NULL) {\r\nint sep_idx;\r\nif (sep == NULL) {\r\nprint_events(argv[i], raw_dump);\r\ncontinue;\r\n}\r\nsep_idx = sep - argv[i];\r\ns = strdup(argv[i]);\r\nif (s == NULL)\r\nreturn -1;\r\ns[sep_idx] = '\0';\r\nprint_tracepoint_events(s, s + sep_idx + 1, raw_dump);\r\nfree(s);\r\n} else {\r\nif (asprintf(&s, "*%s*", argv[i]) < 0) {\r\nprintf("Critical: Not enough memory! Trying to continue...\n");\r\ncontinue;\r\n}\r\nprint_symbol_events(s, PERF_TYPE_HARDWARE,\r\nevent_symbols_hw, PERF_COUNT_HW_MAX, raw_dump);\r\nprint_symbol_events(s, PERF_TYPE_SOFTWARE,\r\nevent_symbols_sw, PERF_COUNT_SW_MAX, raw_dump);\r\nprint_hwcache_events(s, raw_dump);\r\nprint_pmu_events(s, raw_dump);\r\nprint_tracepoint_events(NULL, s, raw_dump);\r\nfree(s);\r\n}\r\n}\r\nreturn 0;\r\n}
