static int rcar_du_hdmi_connector_get_modes(struct drm_connector *connector)\r\n{\r\nstruct rcar_du_connector *con = to_rcar_connector(connector);\r\nstruct drm_encoder *encoder = rcar_encoder_to_drm_encoder(con->encoder);\r\nconst struct drm_encoder_slave_funcs *sfuncs = to_slave_funcs(encoder);\r\nif (sfuncs->get_modes == NULL)\r\nreturn 0;\r\nreturn sfuncs->get_modes(encoder, connector);\r\n}\r\nstatic int rcar_du_hdmi_connector_mode_valid(struct drm_connector *connector,\r\nstruct drm_display_mode *mode)\r\n{\r\nstruct rcar_du_connector *con = to_rcar_connector(connector);\r\nstruct drm_encoder *encoder = rcar_encoder_to_drm_encoder(con->encoder);\r\nconst struct drm_encoder_slave_funcs *sfuncs = to_slave_funcs(encoder);\r\nif (sfuncs->mode_valid == NULL)\r\nreturn MODE_OK;\r\nreturn sfuncs->mode_valid(encoder, mode);\r\n}\r\nstatic enum drm_connector_status\r\nrcar_du_hdmi_connector_detect(struct drm_connector *connector, bool force)\r\n{\r\nstruct rcar_du_connector *con = to_rcar_connector(connector);\r\nstruct drm_encoder *encoder = rcar_encoder_to_drm_encoder(con->encoder);\r\nconst struct drm_encoder_slave_funcs *sfuncs = to_slave_funcs(encoder);\r\nif (sfuncs->detect == NULL)\r\nreturn connector_status_unknown;\r\nreturn sfuncs->detect(encoder, connector);\r\n}\r\nint rcar_du_hdmi_connector_init(struct rcar_du_device *rcdu,\r\nstruct rcar_du_encoder *renc)\r\n{\r\nstruct drm_encoder *encoder = rcar_encoder_to_drm_encoder(renc);\r\nstruct rcar_du_connector *rcon;\r\nstruct drm_connector *connector;\r\nint ret;\r\nrcon = devm_kzalloc(rcdu->dev, sizeof(*rcon), GFP_KERNEL);\r\nif (rcon == NULL)\r\nreturn -ENOMEM;\r\nconnector = &rcon->connector;\r\nconnector->display_info.width_mm = 0;\r\nconnector->display_info.height_mm = 0;\r\nconnector->interlace_allowed = true;\r\nconnector->polled = DRM_CONNECTOR_POLL_HPD;\r\nret = drm_connector_init(rcdu->ddev, connector, &connector_funcs,\r\nDRM_MODE_CONNECTOR_HDMIA);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_connector_helper_add(connector, &connector_helper_funcs);\r\nconnector->dpms = DRM_MODE_DPMS_OFF;\r\ndrm_object_property_set_value(&connector->base,\r\nrcdu->ddev->mode_config.dpms_property, DRM_MODE_DPMS_OFF);\r\nret = drm_mode_connector_attach_encoder(connector, encoder);\r\nif (ret < 0)\r\nreturn ret;\r\nrcon->encoder = renc;\r\nreturn 0;\r\n}
