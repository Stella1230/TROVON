static unsigned long fll_recalc(struct clk *clk)\r\n{\r\nunsigned long mult = 0;\r\nunsigned long div = 1;\r\nif (__raw_readl(PLLCR) & 0x1000)\r\nmult = __raw_readl(FLLFRQ) & 0x3ff;\r\nif (__raw_readl(FLLFRQ) & 0x4000)\r\ndiv = 2;\r\nreturn (clk->parent->rate * mult) / div;\r\n}\r\nstatic unsigned long pll_recalc(struct clk *clk)\r\n{\r\nunsigned long mult = 1;\r\nif (__raw_readl(PLLCR) & 0x4000)\r\nmult = (((__raw_readl(FRQCRA) >> 24) & 0x3f) + 1) * 2;\r\nreturn clk->parent->rate * mult;\r\n}\r\nstatic unsigned long div3_recalc(struct clk *clk)\r\n{\r\nreturn clk->parent->rate / 3;\r\n}\r\nstatic void div4_kick(struct clk *clk)\r\n{\r\nunsigned long value;\r\nvalue = __raw_readl(FRQCRA);\r\nvalue |= (1 << 31);\r\n__raw_writel(value, FRQCRA);\r\n}\r\nint __init arch_clk_init(void)\r\n{\r\nint k, ret = 0;\r\nif (__raw_readl(PLLCR) & 0x1000)\r\npll_clk.parent = &fll_clk;\r\nelse\r\npll_clk.parent = &extal_clk;\r\nfor (k = 0; !ret && (k < ARRAY_SIZE(main_clks)); k++)\r\nret = clk_register(main_clks[k]);\r\nclkdev_add_table(lookups, ARRAY_SIZE(lookups));\r\nif (!ret)\r\nret = sh_clk_div4_register(div4_clks, DIV4_NR, &div4_table);\r\nif (!ret)\r\nret = sh_clk_div6_reparent_register(div6_clks, DIV6_NR);\r\nif (!ret)\r\nret = sh_clk_mstp_register(mstp_clks, HWBLK_NR);\r\nreturn ret;\r\n}
