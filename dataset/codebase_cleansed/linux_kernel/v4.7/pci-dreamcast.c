static int __init gapspci_init(void)\r\n{\r\nchar idbuf[16];\r\nint i;\r\nfor (i=0; i<16; i++)\r\nidbuf[i] = inb(GAPSPCI_REGS+i);\r\nif (strncmp(idbuf, "GAPSPCI_BRIDGE_2", 16))\r\nreturn -ENODEV;\r\noutl(0x5a14a501, GAPSPCI_REGS+0x18);\r\nfor (i=0; i<1000000; i++)\r\ncpu_relax();\r\nif (inl(GAPSPCI_REGS+0x18) != 1)\r\nreturn -EINVAL;\r\noutl(0x01000000, GAPSPCI_REGS+0x20);\r\noutl(0x01000000, GAPSPCI_REGS+0x24);\r\noutl(GAPSPCI_DMA_BASE, GAPSPCI_REGS+0x28);\r\noutl(GAPSPCI_DMA_BASE+GAPSPCI_DMA_SIZE, GAPSPCI_REGS+0x2c);\r\noutl(1, GAPSPCI_REGS+0x14);\r\noutl(1, GAPSPCI_REGS+0x34);\r\noutw(0xf900, GAPSPCI_BBA_CONFIG+0x06);\r\noutl(0x00000000, GAPSPCI_BBA_CONFIG+0x30);\r\noutb(0x00, GAPSPCI_BBA_CONFIG+0x3c);\r\noutb(0xf0, GAPSPCI_BBA_CONFIG+0x0d);\r\noutw(0x0006, GAPSPCI_BBA_CONFIG+0x04);\r\noutl(0x00002001, GAPSPCI_BBA_CONFIG+0x10);\r\noutl(0x01000000, GAPSPCI_BBA_CONFIG+0x14);\r\nreturn register_pci_controller(&dreamcast_pci_controller);\r\n}
