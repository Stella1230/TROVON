static int mxc_mmc1_get_ro(struct device *dev)\r\n{\r\nreturn gpio_get_value(IOMUX_TO_GPIO(MX31_PIN_GPIO1_6));\r\n}\r\nstatic int mxc_mmc1_init(struct device *dev,\r\nirq_handler_t detect_irq, void *data)\r\n{\r\nint ret;\r\ngpio_det = IOMUX_TO_GPIO(MX31_PIN_DCD_DCE1);\r\ngpio_wp = IOMUX_TO_GPIO(MX31_PIN_GPIO1_6);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_DATA0,\r\nMMC_PAD_CFG | PAD_CTL_PUE_PUD | PAD_CTL_100K_PU);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_DATA1,\r\nMMC_PAD_CFG | PAD_CTL_PUE_PUD | PAD_CTL_100K_PU);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_DATA2,\r\nMMC_PAD_CFG | PAD_CTL_PUE_PUD | PAD_CTL_100K_PU);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_DATA3,\r\nMMC_PAD_CFG | PAD_CTL_PUE_PUD | PAD_CTL_100K_PU);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_CMD,\r\nMMC_PAD_CFG | PAD_CTL_PUE_PUD | PAD_CTL_100K_PU);\r\nmxc_iomux_set_pad(MX31_PIN_SD1_CLK, MMC_PAD_CFG);\r\nret = gpio_request(gpio_det, "MMC detect");\r\nif (ret)\r\nreturn ret;\r\nret = gpio_request(gpio_wp, "MMC w/p");\r\nif (ret)\r\ngoto exit_free_det;\r\ngpio_direction_input(gpio_det);\r\ngpio_direction_input(gpio_wp);\r\nret = request_irq(gpio_to_irq(IOMUX_TO_GPIO(MX31_PIN_DCD_DCE1)),\r\ndetect_irq,\r\nIRQF_TRIGGER_RISING | IRQF_TRIGGER_FALLING,\r\n"MMC detect", data);\r\nif (ret)\r\ngoto exit_free_wp;\r\nreturn 0;\r\nexit_free_wp:\r\ngpio_free(gpio_wp);\r\nexit_free_det:\r\ngpio_free(gpio_det);\r\nreturn ret;\r\n}\r\nstatic void mxc_mmc1_exit(struct device *dev, void *data)\r\n{\r\ngpio_free(gpio_det);\r\ngpio_free(gpio_wp);\r\nfree_irq(gpio_to_irq(IOMUX_TO_GPIO(MX31_PIN_DCD_DCE1)), data);\r\n}\r\nvoid __init mx31lite_db_init(void)\r\n{\r\nmxc_iomux_setup_multiple_pins(litekit_db_board_pins,\r\nARRAY_SIZE(litekit_db_board_pins),\r\n"development board pins");\r\nimx31_add_imx_uart0(&uart_pdata);\r\nimx31_add_mxc_mmc(0, &mmc_pdata);\r\nimx31_add_spi_imx0(&spi0_pdata);\r\ngpio_led_register_device(-1, &litekit_led_platform_data);\r\nimx31_add_imx2_wdt();\r\nimx31_add_mxc_rtc();\r\n}
