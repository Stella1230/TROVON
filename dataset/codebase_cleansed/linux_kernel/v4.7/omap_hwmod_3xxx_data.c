static int __init omap3xxx_hwmod_is_hs_ip_block_usable(struct device_node *bus,\r\nconst char *dev_name)\r\n{\r\nif (!bus)\r\nreturn (omap_type() == OMAP2_DEVICE_TYPE_GP) ? 1 : 0;\r\nif (of_device_is_available(of_find_node_by_name(bus, dev_name)))\r\nreturn 1;\r\nreturn 0;\r\n}\r\nint __init omap3xxx_hwmod_init(void)\r\n{\r\nint r;\r\nstruct omap_hwmod_ocp_if **h = NULL, **h_gp = NULL, **h_sham = NULL;\r\nstruct omap_hwmod_ocp_if **h_aes = NULL;\r\nstruct device_node *bus = NULL;\r\nunsigned int rev;\r\nomap_hwmod_init();\r\nr = omap_hwmod_register_links(omap3xxx_hwmod_ocp_ifs);\r\nif (r < 0)\r\nreturn r;\r\nrev = omap_rev();\r\nif (rev == OMAP3430_REV_ES1_0 || rev == OMAP3430_REV_ES2_0 ||\r\nrev == OMAP3430_REV_ES2_1 || rev == OMAP3430_REV_ES3_0 ||\r\nrev == OMAP3430_REV_ES3_1 || rev == OMAP3430_REV_ES3_1_2) {\r\nh = omap34xx_hwmod_ocp_ifs;\r\nh_gp = omap34xx_gp_hwmod_ocp_ifs;\r\nh_sham = omap34xx_sham_hwmod_ocp_ifs;\r\nh_aes = omap34xx_aes_hwmod_ocp_ifs;\r\n} else if (rev == AM35XX_REV_ES1_0 || rev == AM35XX_REV_ES1_1) {\r\nh = am35xx_hwmod_ocp_ifs;\r\nh_gp = am35xx_gp_hwmod_ocp_ifs;\r\nh_sham = am35xx_sham_hwmod_ocp_ifs;\r\nh_aes = am35xx_aes_hwmod_ocp_ifs;\r\n} else if (rev == OMAP3630_REV_ES1_0 || rev == OMAP3630_REV_ES1_1 ||\r\nrev == OMAP3630_REV_ES1_2) {\r\nh = omap36xx_hwmod_ocp_ifs;\r\nh_gp = omap36xx_gp_hwmod_ocp_ifs;\r\nh_sham = omap36xx_sham_hwmod_ocp_ifs;\r\nh_aes = omap36xx_aes_hwmod_ocp_ifs;\r\n} else {\r\nWARN(1, "OMAP3 hwmod family init: unknown chip type\n");\r\nreturn -EINVAL;\r\n}\r\nr = omap_hwmod_register_links(h);\r\nif (r < 0)\r\nreturn r;\r\nif (h_gp && omap_type() == OMAP2_DEVICE_TYPE_GP) {\r\nr = omap_hwmod_register_links(h_gp);\r\nif (r < 0)\r\nreturn r;\r\n}\r\nif (of_have_populated_dt())\r\nbus = of_find_node_by_name(NULL, "ocp");\r\nif (h_sham && omap3xxx_hwmod_is_hs_ip_block_usable(bus, "sham")) {\r\nr = omap_hwmod_register_links(h_sham);\r\nif (r < 0)\r\nreturn r;\r\n}\r\nif (h_aes && omap3xxx_hwmod_is_hs_ip_block_usable(bus, "aes")) {\r\nr = omap_hwmod_register_links(h_aes);\r\nif (r < 0)\r\nreturn r;\r\n}\r\nh = NULL;\r\nif (rev == OMAP3430_REV_ES1_0) {\r\nh = omap3430es1_hwmod_ocp_ifs;\r\n} else if (rev == OMAP3430_REV_ES2_0 || rev == OMAP3430_REV_ES2_1 ||\r\nrev == OMAP3430_REV_ES3_0 || rev == OMAP3430_REV_ES3_1 ||\r\nrev == OMAP3430_REV_ES3_1_2) {\r\nh = omap3430es2plus_hwmod_ocp_ifs;\r\n}\r\nif (h) {\r\nr = omap_hwmod_register_links(h);\r\nif (r < 0)\r\nreturn r;\r\n}\r\nh = NULL;\r\nif (rev == OMAP3430_REV_ES1_0 || rev == OMAP3430_REV_ES2_0 ||\r\nrev == OMAP3430_REV_ES2_1) {\r\nh = omap3430_pre_es3_hwmod_ocp_ifs;\r\n} else if (rev == OMAP3430_REV_ES3_0 || rev == OMAP3430_REV_ES3_1 ||\r\nrev == OMAP3430_REV_ES3_1_2) {\r\nh = omap3430_es3plus_hwmod_ocp_ifs;\r\n}\r\nif (h)\r\nr = omap_hwmod_register_links(h);\r\nif (r < 0)\r\nreturn r;\r\nr = omap_hwmod_register_links(omap3xxx_dss_hwmod_ocp_ifs);\r\nreturn r;\r\n}
