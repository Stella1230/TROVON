static void __init realview_smp_prepare_cpus(unsigned int max_cpus)\r\n{\r\nstruct device_node *np;\r\nvoid __iomem *scu_base;\r\nstruct regmap *map;\r\nunsigned int ncores;\r\nint i;\r\nnp = of_find_matching_node(NULL, realview_scu_match);\r\nif (!np) {\r\npr_err("PLATSMP: No SCU base address\n");\r\nreturn;\r\n}\r\nscu_base = of_iomap(np, 0);\r\nof_node_put(np);\r\nif (!scu_base) {\r\npr_err("PLATSMP: No SCU remap\n");\r\nreturn;\r\n}\r\nscu_enable(scu_base);\r\nncores = scu_get_core_count(scu_base);\r\npr_info("SCU: %d cores detected\n", ncores);\r\nfor (i = 0; i < ncores; i++)\r\nset_cpu_possible(i, true);\r\niounmap(scu_base);\r\nnp = of_find_matching_node(NULL, realview_syscon_match);\r\nif (!np) {\r\npr_err("PLATSMP: No syscon match\n");\r\nreturn;\r\n}\r\nmap = syscon_node_to_regmap(np);\r\nif (IS_ERR(map)) {\r\npr_err("PLATSMP: No syscon regmap\n");\r\nreturn;\r\n}\r\nregmap_write(map, REALVIEW_SYS_FLAGSSET_OFFSET,\r\nvirt_to_phys(versatile_secondary_startup));\r\n}
