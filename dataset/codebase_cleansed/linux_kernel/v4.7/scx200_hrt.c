static cycle_t read_hrt(struct clocksource *cs)\r\n{\r\nreturn (cycle_t) inl(scx200_cb_base + SCx200_TIMER_OFFSET);\r\n}\r\nstatic int __init init_hrt_clocksource(void)\r\n{\r\nu32 freq;\r\nif (!scx200_cb_present())\r\nreturn -ENODEV;\r\nif (!request_region(scx200_cb_base + SCx200_TIMER_OFFSET,\r\nSCx200_TIMER_SIZE,\r\n"NatSemi SCx200 High-Resolution Timer")) {\r\npr_warn("unable to lock timer region\n");\r\nreturn -ENODEV;\r\n}\r\noutb(HR_TMEN | (mhz27 ? HR_TMCLKSEL : 0),\r\nscx200_cb_base + SCx200_TMCNFG_OFFSET);\r\nfreq = (HRT_FREQ + ppm);\r\nif (mhz27)\r\nfreq *= 27;\r\npr_info("enabling scx200 high-res timer (%s MHz +%d ppm)\n", mhz27 ? "27":"1", ppm);\r\nreturn clocksource_register_hz(&cs_hrt, freq);\r\n}
