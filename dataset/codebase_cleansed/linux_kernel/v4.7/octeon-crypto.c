unsigned long octeon_crypto_enable(struct octeon_cop2_state *state)\r\n{\r\nint status;\r\nunsigned long flags;\r\npreempt_disable();\r\nlocal_irq_save(flags);\r\nstatus = read_c0_status();\r\nwrite_c0_status(status | ST0_CU2);\r\nif (KSTK_STATUS(current) & ST0_CU2) {\r\nocteon_cop2_save(&(current->thread.cp2));\r\nKSTK_STATUS(current) &= ~ST0_CU2;\r\nstatus &= ~ST0_CU2;\r\n} else if (status & ST0_CU2) {\r\nocteon_cop2_save(state);\r\n}\r\nlocal_irq_restore(flags);\r\nreturn status & ST0_CU2;\r\n}\r\nvoid octeon_crypto_disable(struct octeon_cop2_state *state,\r\nunsigned long crypto_flags)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nif (crypto_flags & ST0_CU2)\r\nocteon_cop2_restore(state);\r\nelse\r\nwrite_c0_status(read_c0_status() & ~ST0_CU2);\r\nlocal_irq_restore(flags);\r\npreempt_enable();\r\n}
