static u64 *cp15_64(struct kvm_cpu_context *ctxt, int idx)\r\n{\r\nreturn (u64 *)(ctxt->cp15 + idx);\r\n}\r\nvoid __hyp_text __sysreg_save_state(struct kvm_cpu_context *ctxt)\r\n{\r\nctxt->cp15[c0_MPIDR] = read_sysreg(VMPIDR);\r\nctxt->cp15[c0_CSSELR] = read_sysreg(CSSELR);\r\nctxt->cp15[c1_SCTLR] = read_sysreg(SCTLR);\r\nctxt->cp15[c1_CPACR] = read_sysreg(CPACR);\r\n*cp15_64(ctxt, c2_TTBR0) = read_sysreg(TTBR0);\r\n*cp15_64(ctxt, c2_TTBR1) = read_sysreg(TTBR1);\r\nctxt->cp15[c2_TTBCR] = read_sysreg(TTBCR);\r\nctxt->cp15[c3_DACR] = read_sysreg(DACR);\r\nctxt->cp15[c5_DFSR] = read_sysreg(DFSR);\r\nctxt->cp15[c5_IFSR] = read_sysreg(IFSR);\r\nctxt->cp15[c5_ADFSR] = read_sysreg(ADFSR);\r\nctxt->cp15[c5_AIFSR] = read_sysreg(AIFSR);\r\nctxt->cp15[c6_DFAR] = read_sysreg(DFAR);\r\nctxt->cp15[c6_IFAR] = read_sysreg(IFAR);\r\n*cp15_64(ctxt, c7_PAR) = read_sysreg(PAR);\r\nctxt->cp15[c10_PRRR] = read_sysreg(PRRR);\r\nctxt->cp15[c10_NMRR] = read_sysreg(NMRR);\r\nctxt->cp15[c10_AMAIR0] = read_sysreg(AMAIR0);\r\nctxt->cp15[c10_AMAIR1] = read_sysreg(AMAIR1);\r\nctxt->cp15[c12_VBAR] = read_sysreg(VBAR);\r\nctxt->cp15[c13_CID] = read_sysreg(CID);\r\nctxt->cp15[c13_TID_URW] = read_sysreg(TID_URW);\r\nctxt->cp15[c13_TID_URO] = read_sysreg(TID_URO);\r\nctxt->cp15[c13_TID_PRIV] = read_sysreg(TID_PRIV);\r\nctxt->cp15[c14_CNTKCTL] = read_sysreg(CNTKCTL);\r\n}\r\nvoid __hyp_text __sysreg_restore_state(struct kvm_cpu_context *ctxt)\r\n{\r\nwrite_sysreg(ctxt->cp15[c0_MPIDR], VMPIDR);\r\nwrite_sysreg(ctxt->cp15[c0_CSSELR], CSSELR);\r\nwrite_sysreg(ctxt->cp15[c1_SCTLR], SCTLR);\r\nwrite_sysreg(ctxt->cp15[c1_CPACR], CPACR);\r\nwrite_sysreg(*cp15_64(ctxt, c2_TTBR0), TTBR0);\r\nwrite_sysreg(*cp15_64(ctxt, c2_TTBR1), TTBR1);\r\nwrite_sysreg(ctxt->cp15[c2_TTBCR], TTBCR);\r\nwrite_sysreg(ctxt->cp15[c3_DACR], DACR);\r\nwrite_sysreg(ctxt->cp15[c5_DFSR], DFSR);\r\nwrite_sysreg(ctxt->cp15[c5_IFSR], IFSR);\r\nwrite_sysreg(ctxt->cp15[c5_ADFSR], ADFSR);\r\nwrite_sysreg(ctxt->cp15[c5_AIFSR], AIFSR);\r\nwrite_sysreg(ctxt->cp15[c6_DFAR], DFAR);\r\nwrite_sysreg(ctxt->cp15[c6_IFAR], IFAR);\r\nwrite_sysreg(*cp15_64(ctxt, c7_PAR), PAR);\r\nwrite_sysreg(ctxt->cp15[c10_PRRR], PRRR);\r\nwrite_sysreg(ctxt->cp15[c10_NMRR], NMRR);\r\nwrite_sysreg(ctxt->cp15[c10_AMAIR0], AMAIR0);\r\nwrite_sysreg(ctxt->cp15[c10_AMAIR1], AMAIR1);\r\nwrite_sysreg(ctxt->cp15[c12_VBAR], VBAR);\r\nwrite_sysreg(ctxt->cp15[c13_CID], CID);\r\nwrite_sysreg(ctxt->cp15[c13_TID_URW], TID_URW);\r\nwrite_sysreg(ctxt->cp15[c13_TID_URO], TID_URO);\r\nwrite_sysreg(ctxt->cp15[c13_TID_PRIV], TID_PRIV);\r\nwrite_sysreg(ctxt->cp15[c14_CNTKCTL], CNTKCTL);\r\n}
