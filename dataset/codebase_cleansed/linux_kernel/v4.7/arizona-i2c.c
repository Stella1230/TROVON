static int arizona_i2c_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct arizona *arizona;\r\nconst struct regmap_config *regmap_config = NULL;\r\nunsigned long type;\r\nint ret;\r\nif (i2c->dev.of_node)\r\ntype = arizona_of_get_type(&i2c->dev);\r\nelse\r\ntype = id->driver_data;\r\nswitch (type) {\r\ncase WM5102:\r\nif (IS_ENABLED(CONFIG_MFD_WM5102))\r\nregmap_config = &wm5102_i2c_regmap;\r\nbreak;\r\ncase WM5110:\r\ncase WM8280:\r\nif (IS_ENABLED(CONFIG_MFD_WM5110))\r\nregmap_config = &wm5110_i2c_regmap;\r\nbreak;\r\ncase WM8997:\r\nif (IS_ENABLED(CONFIG_MFD_WM8997))\r\nregmap_config = &wm8997_i2c_regmap;\r\nbreak;\r\ncase WM8998:\r\ncase WM1814:\r\nif (IS_ENABLED(CONFIG_MFD_WM8998))\r\nregmap_config = &wm8998_i2c_regmap;\r\nbreak;\r\ndefault:\r\ndev_err(&i2c->dev, "Unknown device type %ld\n", type);\r\nreturn -EINVAL;\r\n}\r\nif (!regmap_config) {\r\ndev_err(&i2c->dev,\r\n"No kernel support for device type %ld\n", type);\r\nreturn -EINVAL;\r\n}\r\narizona = devm_kzalloc(&i2c->dev, sizeof(*arizona), GFP_KERNEL);\r\nif (arizona == NULL)\r\nreturn -ENOMEM;\r\narizona->regmap = devm_regmap_init_i2c(i2c, regmap_config);\r\nif (IS_ERR(arizona->regmap)) {\r\nret = PTR_ERR(arizona->regmap);\r\ndev_err(&i2c->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\narizona->type = type;\r\narizona->dev = &i2c->dev;\r\narizona->irq = i2c->irq;\r\nreturn arizona_dev_init(arizona);\r\n}\r\nstatic int arizona_i2c_remove(struct i2c_client *i2c)\r\n{\r\nstruct arizona *arizona = dev_get_drvdata(&i2c->dev);\r\narizona_dev_exit(arizona);\r\nreturn 0;\r\n}
