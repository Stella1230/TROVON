acpi_status acpi_ex_opcode_2A_0T_0R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nstruct acpi_namespace_node *node;\r\nu32 value;\r\nacpi_status status = AE_OK;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_2A_0T_0R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_NOTIFY_OP:\r\nnode = (struct acpi_namespace_node *)operand[0];\r\nvalue = (u32) operand[1]->integer.value;\r\nif (!acpi_ev_is_notify_object(node)) {\r\nACPI_ERROR((AE_INFO,\r\n"Unexpected notify object type [%s]",\r\nacpi_ut_get_type_name(node->type)));\r\nstatus = AE_AML_OPERAND_TYPE;\r\nbreak;\r\n}\r\nstatus = acpi_ev_queue_notify_request(node, value);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_2A_2T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *return_desc1 = NULL;\r\nunion acpi_operand_object *return_desc2 = NULL;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_2A_2T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nswitch (walk_state->opcode) {\r\ncase AML_DIVIDE_OP:\r\nreturn_desc1 =\r\nacpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc1) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nreturn_desc2 =\r\nacpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc2) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ut_divide(operand[0]->integer.value,\r\noperand[1]->integer.value,\r\n&return_desc1->integer.value,\r\n&return_desc2->integer.value);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ex_store(return_desc2, operand[2], walk_state);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ex_store(return_desc1, operand[3], walk_state);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\ncleanup:\r\nacpi_ut_remove_reference(return_desc2);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ut_remove_reference(return_desc1);\r\n}\r\nelse {\r\nwalk_state->result_obj = return_desc1;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_2A_1T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *return_desc = NULL;\r\nu64 index;\r\nacpi_status status = AE_OK;\r\nacpi_size length = 0;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_2A_1T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nif (walk_state->op_info->flags & AML_MATH) {\r\nreturn_desc = acpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nreturn_desc->integer.value =\r\nacpi_ex_do_math_op(walk_state->opcode,\r\noperand[0]->integer.value,\r\noperand[1]->integer.value);\r\ngoto store_result_to_target;\r\n}\r\nswitch (walk_state->opcode) {\r\ncase AML_MOD_OP:\r\nreturn_desc = acpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nstatus = acpi_ut_divide(operand[0]->integer.value,\r\noperand[1]->integer.value,\r\nNULL, &return_desc->integer.value);\r\nbreak;\r\ncase AML_CONCAT_OP:\r\nstatus =\r\nacpi_ex_do_concatenate(operand[0], operand[1], &return_desc,\r\nwalk_state);\r\nbreak;\r\ncase AML_TO_STRING_OP:\r\nwhile ((length < operand[0]->buffer.length) &&\r\n(length < operand[1]->integer.value) &&\r\n(operand[0]->buffer.pointer[length])) {\r\nlength++;\r\n}\r\nreturn_desc = acpi_ut_create_string_object(length);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nmemcpy(return_desc->string.pointer,\r\noperand[0]->buffer.pointer, length);\r\nbreak;\r\ncase AML_CONCAT_RES_OP:\r\nstatus =\r\nacpi_ex_concat_template(operand[0], operand[1],\r\n&return_desc, walk_state);\r\nbreak;\r\ncase AML_INDEX_OP:\r\nreturn_desc =\r\nacpi_ut_create_internal_object(ACPI_TYPE_LOCAL_REFERENCE);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nindex = operand[1]->integer.value;\r\nreturn_desc->reference.value = (u32) index;\r\nreturn_desc->reference.class = ACPI_REFCLASS_INDEX;\r\nswitch ((operand[0])->common.type) {\r\ncase ACPI_TYPE_STRING:\r\nif (index >= operand[0]->string.length) {\r\nlength = operand[0]->string.length;\r\nstatus = AE_AML_STRING_LIMIT;\r\n}\r\nreturn_desc->reference.target_type =\r\nACPI_TYPE_BUFFER_FIELD;\r\nreturn_desc->reference.index_pointer =\r\n&(operand[0]->buffer.pointer[index]);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (index >= operand[0]->buffer.length) {\r\nlength = operand[0]->buffer.length;\r\nstatus = AE_AML_BUFFER_LIMIT;\r\n}\r\nreturn_desc->reference.target_type =\r\nACPI_TYPE_BUFFER_FIELD;\r\nreturn_desc->reference.index_pointer =\r\n&(operand[0]->buffer.pointer[index]);\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nif (index >= operand[0]->package.count) {\r\nlength = operand[0]->package.count;\r\nstatus = AE_AML_PACKAGE_LIMIT;\r\n}\r\nreturn_desc->reference.target_type = ACPI_TYPE_PACKAGE;\r\nreturn_desc->reference.where =\r\n&operand[0]->package.elements[index];\r\nbreak;\r\ndefault:\r\nstatus = AE_AML_INTERNAL;\r\ngoto cleanup;\r\n}\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Index (0x%X%8.8X) is beyond end of object (length 0x%X)",\r\nACPI_FORMAT_UINT64(index),\r\n(u32)length));\r\ngoto cleanup;\r\n}\r\nreturn_desc->reference.object = operand[0];\r\nacpi_ut_add_reference(operand[0]);\r\nstatus = acpi_ex_store(return_desc, operand[2], walk_state);\r\nwalk_state->result_obj = return_desc;\r\ngoto cleanup;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\nbreak;\r\n}\r\nstore_result_to_target:\r\nif (ACPI_SUCCESS(status)) {\r\nstatus = acpi_ex_store(return_desc, operand[2], walk_state);\r\nif (ACPI_FAILURE(status)) {\r\ngoto cleanup;\r\n}\r\nif (!walk_state->result_obj) {\r\nwalk_state->result_obj = return_desc;\r\n}\r\n}\r\ncleanup:\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ut_remove_reference(return_desc);\r\nwalk_state->result_obj = NULL;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ex_opcode_2A_0T_1R(struct acpi_walk_state *walk_state)\r\n{\r\nunion acpi_operand_object **operand = &walk_state->operands[0];\r\nunion acpi_operand_object *return_desc = NULL;\r\nacpi_status status = AE_OK;\r\nu8 logical_result = FALSE;\r\nACPI_FUNCTION_TRACE_STR(ex_opcode_2A_0T_1R,\r\nacpi_ps_get_opcode_name(walk_state->opcode));\r\nreturn_desc = acpi_ut_create_internal_object(ACPI_TYPE_INTEGER);\r\nif (!return_desc) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nif (walk_state->op_info->flags & AML_LOGICAL_NUMERIC) {\r\nstatus = acpi_ex_do_logical_numeric_op(walk_state->opcode,\r\noperand[0]->integer.\r\nvalue,\r\noperand[1]->integer.\r\nvalue, &logical_result);\r\ngoto store_logical_result;\r\n} else if (walk_state->op_info->flags & AML_LOGICAL) {\r\nstatus = acpi_ex_do_logical_op(walk_state->opcode, operand[0],\r\noperand[1], &logical_result);\r\ngoto store_logical_result;\r\n}\r\nswitch (walk_state->opcode) {\r\ncase AML_ACQUIRE_OP:\r\nstatus =\r\nacpi_ex_acquire_mutex(operand[1], operand[0], walk_state);\r\nif (status == AE_TIME) {\r\nlogical_result = TRUE;\r\nstatus = AE_OK;\r\n}\r\nbreak;\r\ncase AML_WAIT_OP:\r\nstatus = acpi_ex_system_wait_event(operand[1], operand[0]);\r\nif (status == AE_TIME) {\r\nlogical_result = TRUE;\r\nstatus = AE_OK;\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Unknown AML opcode 0x%X",\r\nwalk_state->opcode));\r\nstatus = AE_AML_BAD_OPCODE;\r\ngoto cleanup;\r\n}\r\nstore_logical_result:\r\nif (logical_result) {\r\nreturn_desc->integer.value = ACPI_UINT64_MAX;\r\n}\r\ncleanup:\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ut_remove_reference(return_desc);\r\n}\r\nelse {\r\nwalk_state->result_obj = return_desc;\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}
