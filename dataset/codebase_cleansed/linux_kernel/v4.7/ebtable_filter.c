static int check(const struct ebt_table_info *info, unsigned int valid_hooks)\r\n{\r\nif (valid_hooks & ~FILTER_VALID_HOOKS)\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic unsigned int\r\nebt_in_hook(void *priv, struct sk_buff *skb,\r\nconst struct nf_hook_state *state)\r\n{\r\nreturn ebt_do_table(skb, state, state->net->xt.frame_filter);\r\n}\r\nstatic unsigned int\r\nebt_out_hook(void *priv, struct sk_buff *skb,\r\nconst struct nf_hook_state *state)\r\n{\r\nreturn ebt_do_table(skb, state, state->net->xt.frame_filter);\r\n}\r\nstatic int __net_init frame_filter_net_init(struct net *net)\r\n{\r\nnet->xt.frame_filter = ebt_register_table(net, &frame_filter);\r\nreturn PTR_ERR_OR_ZERO(net->xt.frame_filter);\r\n}\r\nstatic void __net_exit frame_filter_net_exit(struct net *net)\r\n{\r\nebt_unregister_table(net, net->xt.frame_filter);\r\n}\r\nstatic int __init ebtable_filter_init(void)\r\n{\r\nint ret;\r\nret = register_pernet_subsys(&frame_filter_net_ops);\r\nif (ret < 0)\r\nreturn ret;\r\nret = nf_register_hooks(ebt_ops_filter, ARRAY_SIZE(ebt_ops_filter));\r\nif (ret < 0)\r\nunregister_pernet_subsys(&frame_filter_net_ops);\r\nreturn ret;\r\n}\r\nstatic void __exit ebtable_filter_fini(void)\r\n{\r\nnf_unregister_hooks(ebt_ops_filter, ARRAY_SIZE(ebt_ops_filter));\r\nunregister_pernet_subsys(&frame_filter_net_ops);\r\n}
