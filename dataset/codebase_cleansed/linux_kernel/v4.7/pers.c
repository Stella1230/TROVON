void ptlrpc_fill_bulk_md(lnet_md_t *md, struct ptlrpc_bulk_desc *desc,\r\nint mdidx)\r\n{\r\nCLASSERT(PTLRPC_MAX_BRW_PAGES < LI_POISON);\r\nLASSERT(mdidx < desc->bd_md_max_brw);\r\nLASSERT(desc->bd_iov_count <= PTLRPC_MAX_BRW_PAGES);\r\nLASSERT(!(md->options & (LNET_MD_IOVEC | LNET_MD_KIOV |\r\nLNET_MD_PHYS)));\r\nmd->options |= LNET_MD_KIOV;\r\nmd->length = max(0, desc->bd_iov_count - mdidx * LNET_MAX_IOV);\r\nmd->length = min_t(unsigned int, LNET_MAX_IOV, md->length);\r\nif (desc->bd_enc_iov)\r\nmd->start = &desc->bd_enc_iov[mdidx * LNET_MAX_IOV];\r\nelse\r\nmd->start = &desc->bd_iov[mdidx * LNET_MAX_IOV];\r\n}\r\nvoid ptlrpc_add_bulk_page(struct ptlrpc_bulk_desc *desc, struct page *page,\r\nint pageoffset, int len)\r\n{\r\nlnet_kiov_t *kiov = &desc->bd_iov[desc->bd_iov_count];\r\nkiov->kiov_page = page;\r\nkiov->kiov_offset = pageoffset;\r\nkiov->kiov_len = len;\r\ndesc->bd_iov_count++;\r\n}
