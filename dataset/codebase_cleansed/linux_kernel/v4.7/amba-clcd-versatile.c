struct clcd_panel *versatile_clcd_get_panel(const char *name)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(panels); i++)\r\nif (strcmp(panels[i]->mode.name, name) == 0)\r\nbreak;\r\nif (i < ARRAY_SIZE(panels))\r\nreturn panels[i];\r\npr_err("CLCD: couldn't get parameters for panel %s\n", name);\r\nreturn NULL;\r\n}\r\nint versatile_clcd_setup_dma(struct clcd_fb *fb, unsigned long framesize)\r\n{\r\ndma_addr_t dma;\r\nfb->fb.screen_base = dma_alloc_wc(&fb->dev->dev, framesize, &dma,\r\nGFP_KERNEL);\r\nif (!fb->fb.screen_base) {\r\npr_err("CLCD: unable to map framebuffer\n");\r\nreturn -ENOMEM;\r\n}\r\nfb->fb.fix.smem_start = dma;\r\nfb->fb.fix.smem_len = framesize;\r\nreturn 0;\r\n}\r\nint versatile_clcd_mmap_dma(struct clcd_fb *fb, struct vm_area_struct *vma)\r\n{\r\nreturn dma_mmap_wc(&fb->dev->dev, vma, fb->fb.screen_base,\r\nfb->fb.fix.smem_start, fb->fb.fix.smem_len);\r\n}\r\nvoid versatile_clcd_remove_dma(struct clcd_fb *fb)\r\n{\r\ndma_free_wc(&fb->dev->dev, fb->fb.fix.smem_len, fb->fb.screen_base,\r\nfb->fb.fix.smem_start);\r\n}
