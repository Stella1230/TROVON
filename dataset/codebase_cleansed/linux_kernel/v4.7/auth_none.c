static void reset(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nxi->starting = true;\r\n}\r\nstatic void destroy(struct ceph_auth_client *ac)\r\n{\r\nkfree(ac->private);\r\nac->private = NULL;\r\n}\r\nstatic int is_authenticated(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nreturn !xi->starting;\r\n}\r\nstatic int should_authenticate(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nreturn xi->starting;\r\n}\r\nstatic int ceph_auth_none_build_authorizer(struct ceph_auth_client *ac,\r\nstruct ceph_none_authorizer *au)\r\n{\r\nvoid *p = au->buf;\r\nvoid *const end = p + sizeof(au->buf);\r\nint ret;\r\nceph_encode_8_safe(&p, end, 1, e_range);\r\nret = ceph_entity_name_encode(ac->name, &p, end);\r\nif (ret < 0)\r\nreturn ret;\r\nceph_encode_64_safe(&p, end, ac->global_id, e_range);\r\nau->buf_len = p - (void *)au->buf;\r\ndout("%s built authorizer len %d\n", __func__, au->buf_len);\r\nreturn 0;\r\ne_range:\r\nreturn -ERANGE;\r\n}\r\nstatic int build_request(struct ceph_auth_client *ac, void *buf, void *end)\r\n{\r\nreturn 0;\r\n}\r\nstatic int handle_reply(struct ceph_auth_client *ac, int result,\r\nvoid *buf, void *end)\r\n{\r\nstruct ceph_auth_none_info *xi = ac->private;\r\nxi->starting = false;\r\nreturn result;\r\n}\r\nstatic void ceph_auth_none_destroy_authorizer(struct ceph_authorizer *a)\r\n{\r\nkfree(a);\r\n}\r\nstatic int ceph_auth_none_create_authorizer(\r\nstruct ceph_auth_client *ac, int peer_type,\r\nstruct ceph_auth_handshake *auth)\r\n{\r\nstruct ceph_none_authorizer *au;\r\nint ret;\r\nau = kmalloc(sizeof(*au), GFP_NOFS);\r\nif (!au)\r\nreturn -ENOMEM;\r\nau->base.destroy = ceph_auth_none_destroy_authorizer;\r\nret = ceph_auth_none_build_authorizer(ac, au);\r\nif (ret) {\r\nkfree(au);\r\nreturn ret;\r\n}\r\nauth->authorizer = (struct ceph_authorizer *) au;\r\nauth->authorizer_buf = au->buf;\r\nauth->authorizer_buf_len = au->buf_len;\r\nauth->authorizer_reply_buf = au->reply_buf;\r\nauth->authorizer_reply_buf_len = sizeof (au->reply_buf);\r\nreturn 0;\r\n}\r\nint ceph_auth_none_init(struct ceph_auth_client *ac)\r\n{\r\nstruct ceph_auth_none_info *xi;\r\ndout("ceph_auth_none_init %p\n", ac);\r\nxi = kzalloc(sizeof(*xi), GFP_NOFS);\r\nif (!xi)\r\nreturn -ENOMEM;\r\nxi->starting = true;\r\nac->protocol = CEPH_AUTH_NONE;\r\nac->private = xi;\r\nac->ops = &ceph_auth_none_ops;\r\nreturn 0;\r\n}
