static __u8 *gembird_report_fixup(struct hid_device *hdev, __u8 *rdesc,\r\nunsigned int *rsize)\r\n{\r\n__u8 *new_rdesc;\r\nsize_t delta_size = sizeof(gembird_jpd_fixed_rdesc) -\r\nsizeof(gembird_jpd_faulty_rdesc);\r\nsize_t new_size = *rsize + delta_size;\r\nif (*rsize >= 31 && !memcmp(&rdesc[GEMBIRD_START_FAULTY_RDESC],\r\ngembird_jpd_faulty_rdesc,\r\nsizeof(gembird_jpd_faulty_rdesc))) {\r\nnew_rdesc = devm_kzalloc(&hdev->dev, new_size, GFP_KERNEL);\r\nif (new_rdesc == NULL)\r\nreturn rdesc;\r\ndev_info(&hdev->dev,\r\n"fixing Gembird JPD-DualForce 2 report descriptor.\n");\r\nmemcpy(new_rdesc + delta_size, rdesc, *rsize);\r\nmemcpy(new_rdesc, rdesc, GEMBIRD_START_FAULTY_RDESC);\r\nmemcpy(new_rdesc + GEMBIRD_START_FAULTY_RDESC,\r\ngembird_jpd_fixed_rdesc,\r\nsizeof(gembird_jpd_fixed_rdesc));\r\n*rsize = new_size;\r\nrdesc = new_rdesc;\r\n}\r\nreturn rdesc;\r\n}
