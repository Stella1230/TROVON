static int axxia_restart_handler(struct notifier_block *this,\r\nunsigned long mode, void *cmd)\r\n{\r\nregmap_write(syscon, SC_CRIT_WRITE_KEY, 0xab);\r\nregmap_write(syscon, SC_LATCH_ON_RESET, 0x00000040);\r\nregmap_write(syscon, SC_EFUSE_INT_STATUS, EFUSE_READ_DONE);\r\nregmap_update_bits(syscon, SC_RESET_CONTROL,\r\nRSTCTL_RST_CHIP, RSTCTL_RST_CHIP);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int axxia_reset_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nint err;\r\nsyscon = syscon_regmap_lookup_by_phandle(dev->of_node, "syscon");\r\nif (IS_ERR(syscon)) {\r\npr_err("%s: syscon lookup failed\n", dev->of_node->name);\r\nreturn PTR_ERR(syscon);\r\n}\r\nerr = register_restart_handler(&axxia_restart_nb);\r\nif (err)\r\ndev_err(dev, "cannot register restart handler (err=%d)\n", err);\r\nreturn err;\r\n}\r\nstatic int __init axxia_reset_init(void)\r\n{\r\nreturn platform_driver_register(&axxia_reset_driver);\r\n}
