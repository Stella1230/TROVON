static void\r\nnv17_fifo_init(struct nvkm_fifo *base)\r\n{\r\nstruct nv04_fifo *fifo = nv04_fifo(base);\r\nstruct nvkm_device *device = fifo->base.engine.subdev.device;\r\nstruct nvkm_instmem *imem = device->imem;\r\nstruct nvkm_ramht *ramht = imem->ramht;\r\nstruct nvkm_memory *ramro = imem->ramro;\r\nstruct nvkm_memory *ramfc = imem->ramfc;\r\nnvkm_wr32(device, NV04_PFIFO_DELAY_0, 0x000000ff);\r\nnvkm_wr32(device, NV04_PFIFO_DMA_TIMESLICE, 0x0101ffff);\r\nnvkm_wr32(device, NV03_PFIFO_RAMHT, (0x03 << 24) |\r\n((ramht->bits - 9) << 16) |\r\n(ramht->gpuobj->addr >> 8));\r\nnvkm_wr32(device, NV03_PFIFO_RAMRO, nvkm_memory_addr(ramro) >> 8);\r\nnvkm_wr32(device, NV03_PFIFO_RAMFC, nvkm_memory_addr(ramfc) >> 8 |\r\n0x00010000);\r\nnvkm_wr32(device, NV03_PFIFO_CACHE1_PUSH1, fifo->base.nr - 1);\r\nnvkm_wr32(device, NV03_PFIFO_INTR_0, 0xffffffff);\r\nnvkm_wr32(device, NV03_PFIFO_INTR_EN_0, 0xffffffff);\r\nnvkm_wr32(device, NV03_PFIFO_CACHE1_PUSH0, 1);\r\nnvkm_wr32(device, NV04_PFIFO_CACHE1_PULL0, 1);\r\nnvkm_wr32(device, NV03_PFIFO_CACHES, 1);\r\n}\r\nint\r\nnv17_fifo_new(struct nvkm_device *device, int index, struct nvkm_fifo **pfifo)\r\n{\r\nreturn nv04_fifo_new_(&nv17_fifo, device, index, 32,\r\nnv17_fifo_ramfc, pfifo);\r\n}
