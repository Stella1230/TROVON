int hdmi_parse_lanes_of(struct platform_device *pdev, struct device_node *ep,\r\nstruct hdmi_phy_data *phy)\r\n{\r\nstruct property *prop;\r\nint r, len;\r\nprop = of_find_property(ep, "lanes", &len);\r\nif (prop) {\r\nu32 lanes[8];\r\nif (len / sizeof(u32) != ARRAY_SIZE(lanes)) {\r\ndev_err(&pdev->dev, "bad number of lanes\n");\r\nreturn -EINVAL;\r\n}\r\nr = of_property_read_u32_array(ep, "lanes", lanes,\r\nARRAY_SIZE(lanes));\r\nif (r) {\r\ndev_err(&pdev->dev, "failed to read lane data\n");\r\nreturn r;\r\n}\r\nr = hdmi_phy_parse_lanes(phy, lanes);\r\nif (r) {\r\ndev_err(&pdev->dev, "failed to parse lane data\n");\r\nreturn r;\r\n}\r\n} else {\r\nstatic const u32 default_lanes[] = { 0, 1, 2, 3, 4, 5, 6, 7 };\r\nr = hdmi_phy_parse_lanes(phy, default_lanes);\r\nif (WARN_ON(r)) {\r\ndev_err(&pdev->dev, "failed to parse lane data\n");\r\nreturn r;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nint hdmi_compute_acr(u32 pclk, u32 sample_freq, u32 *n, u32 *cts)\r\n{\r\nu32 deep_color;\r\nbool deep_color_correct = false;\r\nif (n == NULL || cts == NULL)\r\nreturn -EINVAL;\r\ndeep_color = 100;\r\nswitch (sample_freq) {\r\ncase 32000:\r\ncase 48000:\r\ncase 96000:\r\ncase 192000:\r\nif (deep_color == 125)\r\nif (pclk == 27027000 || pclk == 74250000)\r\ndeep_color_correct = true;\r\nif (deep_color == 150)\r\nif (pclk == 27027000)\r\ndeep_color_correct = true;\r\nbreak;\r\ncase 44100:\r\ncase 88200:\r\ncase 176400:\r\nif (deep_color == 125)\r\nif (pclk == 27027000)\r\ndeep_color_correct = true;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nif (deep_color_correct) {\r\nswitch (sample_freq) {\r\ncase 32000:\r\n*n = 8192;\r\nbreak;\r\ncase 44100:\r\n*n = 12544;\r\nbreak;\r\ncase 48000:\r\n*n = 8192;\r\nbreak;\r\ncase 88200:\r\n*n = 25088;\r\nbreak;\r\ncase 96000:\r\n*n = 16384;\r\nbreak;\r\ncase 176400:\r\n*n = 50176;\r\nbreak;\r\ncase 192000:\r\n*n = 32768;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n} else {\r\nswitch (sample_freq) {\r\ncase 32000:\r\n*n = 4096;\r\nbreak;\r\ncase 44100:\r\n*n = 6272;\r\nbreak;\r\ncase 48000:\r\n*n = 6144;\r\nbreak;\r\ncase 88200:\r\n*n = 12544;\r\nbreak;\r\ncase 96000:\r\n*n = 12288;\r\nbreak;\r\ncase 176400:\r\n*n = 25088;\r\nbreak;\r\ncase 192000:\r\n*n = 24576;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n}\r\n*cts = (pclk/1000) * (*n / 128) * deep_color / (sample_freq / 10);\r\nreturn 0;\r\n}
