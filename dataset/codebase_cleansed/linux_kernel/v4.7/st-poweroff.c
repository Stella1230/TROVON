static int st_restart(struct notifier_block *this, unsigned long mode,\r\nvoid *cmd)\r\n{\r\nregmap_update_bits(st_restart_syscfg->regmap,\r\nst_restart_syscfg->offset_rst,\r\nst_restart_syscfg->mask_rst,\r\n0);\r\nregmap_update_bits(st_restart_syscfg->regmap,\r\nst_restart_syscfg->offset_rst_msk,\r\nst_restart_syscfg->mask_rst_msk,\r\n0);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int st_reset_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nconst struct of_device_id *match;\r\nstruct device *dev = &pdev->dev;\r\nmatch = of_match_device(st_reset_of_match, dev);\r\nif (!match)\r\nreturn -ENODEV;\r\nst_restart_syscfg = (struct reset_syscfg *)match->data;\r\nst_restart_syscfg->regmap =\r\nsyscon_regmap_lookup_by_phandle(np, "st,syscfg");\r\nif (IS_ERR(st_restart_syscfg->regmap)) {\r\ndev_err(dev, "No syscfg phandle specified\n");\r\nreturn PTR_ERR(st_restart_syscfg->regmap);\r\n}\r\nreturn register_restart_handler(&st_restart_nb);\r\n}\r\nstatic int __init st_reset_init(void)\r\n{\r\nreturn platform_driver_register(&st_reset_driver);\r\n}
