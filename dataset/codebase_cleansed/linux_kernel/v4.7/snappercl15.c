static void snappercl15_nand_cmd_ctrl(struct mtd_info *mtd, int cmd,\r\nunsigned int ctrl)\r\n{\r\nstruct nand_chip *chip = mtd_to_nand(mtd);\r\nstatic u16 nand_state = SNAPPERCL15_NAND_WPN;\r\nu16 set;\r\nif (ctrl & NAND_CTRL_CHANGE) {\r\nset = SNAPPERCL15_NAND_CEN | SNAPPERCL15_NAND_WPN;\r\nif (ctrl & NAND_NCE)\r\nset &= ~SNAPPERCL15_NAND_CEN;\r\nif (ctrl & NAND_CLE)\r\nset |= SNAPPERCL15_NAND_CLE;\r\nif (ctrl & NAND_ALE)\r\nset |= SNAPPERCL15_NAND_ALE;\r\nnand_state &= ~(SNAPPERCL15_NAND_CEN |\r\nSNAPPERCL15_NAND_CLE |\r\nSNAPPERCL15_NAND_ALE);\r\nnand_state |= set;\r\n__raw_writew(nand_state, NAND_CTRL_ADDR(chip));\r\n}\r\nif (cmd != NAND_CMD_NONE)\r\n__raw_writew((cmd & 0xff) | nand_state, chip->IO_ADDR_W);\r\n}\r\nstatic int snappercl15_nand_dev_ready(struct mtd_info *mtd)\r\n{\r\nstruct nand_chip *chip = mtd_to_nand(mtd);\r\nreturn !!(__raw_readw(NAND_CTRL_ADDR(chip)) & SNAPPERCL15_NAND_RDY);\r\n}\r\nstatic void __init snappercl15_register_audio(void)\r\n{\r\nep93xx_register_i2s();\r\nplatform_device_register(&snappercl15_audio_device);\r\n}\r\nstatic void __init snappercl15_init_machine(void)\r\n{\r\nep93xx_init_devices();\r\nep93xx_register_eth(&snappercl15_eth_data, 1);\r\nep93xx_register_i2c(&snappercl15_i2c_gpio_data, snappercl15_i2c_data,\r\nARRAY_SIZE(snappercl15_i2c_data));\r\nep93xx_register_fb(&snappercl15_fb_info);\r\nsnappercl15_register_audio();\r\nplatform_device_register(&snappercl15_nand_device);\r\n}
