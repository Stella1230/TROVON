static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nwrite_reg(par, 0x21);\r\nwrite_reg(par, 0x10 | (bs & 0x7));\r\nwrite_reg(par, 0x04 | (64 >> 6));\r\nwrite_reg(par, 0x40 | (64 & 0x3F));\r\nwrite_reg(par, 0x20);\r\nwrite_reg(par, 0x08 | 4);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, 0x80);\r\nwrite_reg(par, 0x40);\r\n}\r\nstatic int write_vmem(struct fbtft_par *par, size_t offset, size_t len)\r\n{\r\nu16 *vmem16 = (u16 *)par->info->screen_buffer;\r\nint x, y, i;\r\nint ret = 0;\r\nfor (y = 0; y < HEIGHT / 8; y++) {\r\nu8 *buf = par->txbuf.buf;\r\ngpio_set_value(par->gpio.dc, 0);\r\nwrite_reg(par, 0x80 | 0);\r\nwrite_reg(par, 0x40 | y);\r\nfor (x = 0; x < WIDTH; x++) {\r\nu8 ch = 0;\r\nfor (i = 0; i < 8 * WIDTH; i += WIDTH) {\r\nch >>= 1;\r\nif (vmem16[(y * 8 * WIDTH) + i + x])\r\nch |= 0x80;\r\n}\r\n*buf++ = ch;\r\n}\r\ngpio_set_value(par->gpio.dc, 1);\r\nret = par->fbtftops.write(par, par->txbuf.buf, WIDTH);\r\nif (ret < 0) {\r\ndev_err(par->info->device,\r\n"write failed and returned: %d\n", ret);\r\nbreak;\r\n}\r\n}\r\nreturn ret;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, unsigned long *curves)\r\n{\r\ncurves[0] &= 0x7F;\r\nwrite_reg(par, 0x21);\r\nwrite_reg(par, 0x80 | curves[0]);\r\nwrite_reg(par, 0x20);\r\nreturn 0;\r\n}
