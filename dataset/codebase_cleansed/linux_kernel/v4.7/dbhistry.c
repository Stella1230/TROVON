void acpi_db_add_to_history(char *command_line)\r\n{\r\nu16 cmd_len;\r\nu16 buffer_len;\r\ncmd_len = (u16)strlen(command_line);\r\nif (!cmd_len) {\r\nreturn;\r\n}\r\nif (acpi_gbl_history_buffer[acpi_gbl_next_history_index].command !=\r\nNULL) {\r\nbuffer_len =\r\n(u16)\r\nstrlen(acpi_gbl_history_buffer[acpi_gbl_next_history_index].\r\ncommand);\r\nif (cmd_len > buffer_len) {\r\nacpi_os_free(acpi_gbl_history_buffer\r\n[acpi_gbl_next_history_index].command);\r\nacpi_gbl_history_buffer[acpi_gbl_next_history_index].\r\ncommand = acpi_os_allocate(cmd_len + 1);\r\n}\r\n} else {\r\nacpi_gbl_history_buffer[acpi_gbl_next_history_index].command =\r\nacpi_os_allocate(cmd_len + 1);\r\n}\r\nstrcpy(acpi_gbl_history_buffer[acpi_gbl_next_history_index].command,\r\ncommand_line);\r\nacpi_gbl_history_buffer[acpi_gbl_next_history_index].cmd_num =\r\nacpi_gbl_next_cmd_num;\r\nif ((acpi_gbl_num_history == HISTORY_SIZE) &&\r\n(acpi_gbl_next_history_index == acpi_gbl_lo_history)) {\r\nacpi_gbl_lo_history++;\r\nif (acpi_gbl_lo_history >= HISTORY_SIZE) {\r\nacpi_gbl_lo_history = 0;\r\n}\r\n}\r\nacpi_gbl_next_history_index++;\r\nif (acpi_gbl_next_history_index >= HISTORY_SIZE) {\r\nacpi_gbl_next_history_index = 0;\r\n}\r\nacpi_gbl_next_cmd_num++;\r\nif (acpi_gbl_num_history < HISTORY_SIZE) {\r\nacpi_gbl_num_history++;\r\n}\r\n}\r\nvoid acpi_db_display_history(void)\r\n{\r\nu32 i;\r\nu16 history_index;\r\nhistory_index = acpi_gbl_lo_history;\r\nfor (i = 0; i < acpi_gbl_num_history; i++) {\r\nif (acpi_gbl_history_buffer[history_index].command) {\r\nacpi_os_printf("%3ld %s\n",\r\nacpi_gbl_history_buffer[history_index].\r\ncmd_num,\r\nacpi_gbl_history_buffer[history_index].\r\ncommand);\r\n}\r\nhistory_index++;\r\nif (history_index >= HISTORY_SIZE) {\r\nhistory_index = 0;\r\n}\r\n}\r\n}\r\nchar *acpi_db_get_from_history(char *command_num_arg)\r\n{\r\nu32 cmd_num;\r\nif (command_num_arg == NULL) {\r\ncmd_num = acpi_gbl_next_cmd_num - 1;\r\n}\r\nelse {\r\ncmd_num = strtoul(command_num_arg, NULL, 0);\r\n}\r\nreturn (acpi_db_get_history_by_index(cmd_num));\r\n}\r\nchar *acpi_db_get_history_by_index(u32 cmd_num)\r\n{\r\nu32 i;\r\nu16 history_index;\r\nhistory_index = acpi_gbl_lo_history;\r\nfor (i = 0; i < acpi_gbl_num_history; i++) {\r\nif (acpi_gbl_history_buffer[history_index].cmd_num == cmd_num) {\r\nreturn (acpi_gbl_history_buffer[history_index].command);\r\n}\r\nhistory_index++;\r\nif (history_index >= HISTORY_SIZE) {\r\nhistory_index = 0;\r\n}\r\n}\r\nacpi_os_printf("Invalid history number: %u\n", history_index);\r\nreturn (NULL);\r\n}
