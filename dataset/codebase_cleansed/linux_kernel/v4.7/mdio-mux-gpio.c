static int mdio_mux_gpio_switch_fn(int current_child, int desired_child,\r\nvoid *data)\r\n{\r\nstruct mdio_mux_gpio_state *s = data;\r\nint values[s->gpios->ndescs];\r\nunsigned int n;\r\nif (current_child == desired_child)\r\nreturn 0;\r\nfor (n = 0; n < s->gpios->ndescs; n++)\r\nvalues[n] = (desired_child >> n) & 1;\r\ngpiod_set_array_value_cansleep(s->gpios->ndescs, s->gpios->desc,\r\nvalues);\r\nreturn 0;\r\n}\r\nstatic int mdio_mux_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct mdio_mux_gpio_state *s;\r\nint r;\r\ns = devm_kzalloc(&pdev->dev, sizeof(*s), GFP_KERNEL);\r\nif (!s)\r\nreturn -ENOMEM;\r\ns->gpios = gpiod_get_array(&pdev->dev, NULL, GPIOD_OUT_LOW);\r\nif (IS_ERR(s->gpios))\r\nreturn PTR_ERR(s->gpios);\r\nr = mdio_mux_init(&pdev->dev,\r\nmdio_mux_gpio_switch_fn, &s->mux_handle, s);\r\nif (r != 0) {\r\ngpiod_put_array(s->gpios);\r\nreturn r;\r\n}\r\npdev->dev.platform_data = s;\r\nreturn 0;\r\n}\r\nstatic int mdio_mux_gpio_remove(struct platform_device *pdev)\r\n{\r\nstruct mdio_mux_gpio_state *s = dev_get_platdata(&pdev->dev);\r\nmdio_mux_uninit(s->mux_handle);\r\ngpiod_put_array(s->gpios);\r\nreturn 0;\r\n}
