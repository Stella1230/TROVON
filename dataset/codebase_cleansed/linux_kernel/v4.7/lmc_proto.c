void lmc_proto_attach(lmc_softc_t *sc)\r\n{\r\nlmc_trace(sc->lmc_device, "lmc_proto_attach in");\r\nif (sc->if_type == LMC_NET) {\r\nstruct net_device *dev = sc->lmc_device;\r\ndev->flags |= IFF_POINTOPOINT;\r\ndev->hard_header_len = 0;\r\ndev->addr_len = 0;\r\n}\r\nlmc_trace(sc->lmc_device, "lmc_proto_attach out");\r\n}\r\nint lmc_proto_ioctl(lmc_softc_t *sc, struct ifreq *ifr, int cmd)\r\n{\r\nlmc_trace(sc->lmc_device, "lmc_proto_ioctl");\r\nif (sc->if_type == LMC_PPP)\r\nreturn hdlc_ioctl(sc->lmc_device, ifr, cmd);\r\nreturn -EOPNOTSUPP;\r\n}\r\nint lmc_proto_open(lmc_softc_t *sc)\r\n{\r\nint ret = 0;\r\nlmc_trace(sc->lmc_device, "lmc_proto_open in");\r\nif (sc->if_type == LMC_PPP) {\r\nret = hdlc_open(sc->lmc_device);\r\nif (ret < 0)\r\nprintk(KERN_WARNING "%s: HDLC open failed: %d\n",\r\nsc->name, ret);\r\n}\r\nlmc_trace(sc->lmc_device, "lmc_proto_open out");\r\nreturn ret;\r\n}\r\nvoid lmc_proto_close(lmc_softc_t *sc)\r\n{\r\nlmc_trace(sc->lmc_device, "lmc_proto_close in");\r\nif (sc->if_type == LMC_PPP)\r\nhdlc_close(sc->lmc_device);\r\nlmc_trace(sc->lmc_device, "lmc_proto_close out");\r\n}\r\n__be16 lmc_proto_type(lmc_softc_t *sc, struct sk_buff *skb)\r\n{\r\nlmc_trace(sc->lmc_device, "lmc_proto_type in");\r\nswitch(sc->if_type){\r\ncase LMC_PPP:\r\nreturn hdlc_type_trans(skb, sc->lmc_device);\r\nbreak;\r\ncase LMC_NET:\r\nreturn htons(ETH_P_802_2);\r\nbreak;\r\ncase LMC_RAW:\r\nreturn htons(ETH_P_802_2);\r\nbreak;\r\ndefault:\r\nprintk(KERN_WARNING "%s: No protocol set for this interface, assuming 802.2 (which is wrong!!)\n", sc->name);\r\nreturn htons(ETH_P_802_2);\r\nbreak;\r\n}\r\nlmc_trace(sc->lmc_device, "lmc_proto_tye out");\r\n}\r\nvoid lmc_proto_netif(lmc_softc_t *sc, struct sk_buff *skb)\r\n{\r\nlmc_trace(sc->lmc_device, "lmc_proto_netif in");\r\nswitch(sc->if_type){\r\ncase LMC_PPP:\r\ncase LMC_NET:\r\ndefault:\r\nnetif_rx(skb);\r\nbreak;\r\ncase LMC_RAW:\r\nbreak;\r\n}\r\nlmc_trace(sc->lmc_device, "lmc_proto_netif out");\r\n}
