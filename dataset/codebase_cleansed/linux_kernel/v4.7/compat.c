static void pnp_convert_id(char *buf, unsigned short vendor,\r\nunsigned short device)\r\n{\r\nsprintf(buf, "%c%c%c%x%x%x%x",\r\n'A' + ((vendor >> 2) & 0x3f) - 1,\r\n'A' + (((vendor & 3) << 3) | ((vendor >> 13) & 7)) - 1,\r\n'A' + ((vendor >> 8) & 0x1f) - 1,\r\n(device >> 4) & 0x0f, device & 0x0f,\r\n(device >> 12) & 0x0f, (device >> 8) & 0x0f);\r\n}\r\nstruct pnp_card *pnp_find_card(unsigned short vendor, unsigned short device,\r\nstruct pnp_card *from)\r\n{\r\nchar id[8];\r\nchar any[8];\r\nstruct list_head *list;\r\npnp_convert_id(id, vendor, device);\r\npnp_convert_id(any, ISAPNP_ANY_ID, ISAPNP_ANY_ID);\r\nlist = from ? from->global_list.next : pnp_cards.next;\r\nwhile (list != &pnp_cards) {\r\nstruct pnp_card *card = global_to_pnp_card(list);\r\nif (compare_pnp_id(card->id, id) || (memcmp(id, any, 7) == 0))\r\nreturn card;\r\nlist = list->next;\r\n}\r\nreturn NULL;\r\n}\r\nstruct pnp_dev *pnp_find_dev(struct pnp_card *card, unsigned short vendor,\r\nunsigned short function, struct pnp_dev *from)\r\n{\r\nchar id[8];\r\nchar any[8];\r\npnp_convert_id(id, vendor, function);\r\npnp_convert_id(any, ISAPNP_ANY_ID, ISAPNP_ANY_ID);\r\nif (card == NULL) {\r\nstruct list_head *list;\r\nlist = pnp_global.next;\r\nif (from)\r\nlist = from->global_list.next;\r\nwhile (list != &pnp_global) {\r\nstruct pnp_dev *dev = global_to_pnp_dev(list);\r\nif (compare_pnp_id(dev->id, id) ||\r\n(memcmp(id, any, 7) == 0))\r\nreturn dev;\r\nlist = list->next;\r\n}\r\n} else {\r\nstruct list_head *list;\r\nlist = card->devices.next;\r\nif (from) {\r\nlist = from->card_list.next;\r\nif (from->card != card)\r\nreturn NULL;\r\n}\r\nwhile (list != &card->devices) {\r\nstruct pnp_dev *dev = card_to_pnp_dev(list);\r\nif (compare_pnp_id(dev->id, id))\r\nreturn dev;\r\nlist = list->next;\r\n}\r\n}\r\nreturn NULL;\r\n}
