static void dummy_smp_setup(void)\r\n{\r\n}\r\nstatic void dummy_prepare_cpus(unsigned int max_cpus)\r\n{\r\n}\r\nstatic void dummy_start_cpu(unsigned int cpu, unsigned long entry_point)\r\n{\r\n}\r\nstatic unsigned int dummy_smp_processor_id(void)\r\n{\r\nreturn 0;\r\n}\r\nstatic void dummy_send_ipi(unsigned int cpu, unsigned int message)\r\n{\r\n}\r\nstatic void sh_of_smp_probe(void)\r\n{\r\nstruct device_node *np = 0;\r\nconst char *method = 0;\r\nconst struct of_cpu_method *m = __cpu_method_of_table;\r\npr_info("SH generic board support: scanning for cpus\n");\r\ninit_cpu_possible(cpumask_of(0));\r\nwhile ((np = of_find_node_by_type(np, "cpu"))) {\r\nconst __be32 *cell = of_get_property(np, "reg", NULL);\r\nu64 id = -1;\r\nif (cell) id = of_read_number(cell, of_n_addr_cells(np));\r\nif (id < NR_CPUS) {\r\nif (!method)\r\nof_property_read_string(np, "enable-method", &method);\r\nset_cpu_possible(id, true);\r\nset_cpu_present(id, true);\r\n__cpu_number_map[id] = id;\r\n__cpu_logical_map[id] = id;\r\n}\r\n}\r\nif (!method) {\r\nnp = of_find_node_by_name(NULL, "cpus");\r\nof_property_read_string(np, "enable-method", &method);\r\n}\r\npr_info("CPU enable method: %s\n", method);\r\nif (method)\r\nfor (; m->method; m++)\r\nif (!strcmp(m->method, method)) {\r\nregister_smp_ops(m->ops);\r\nreturn;\r\n}\r\nregister_smp_ops(&dummy_smp_ops);\r\n}\r\nstatic void sh_of_smp_probe(void)\r\n{\r\n}\r\nstatic void noop(void)\r\n{\r\n}\r\nstatic int noopi(void)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __init sh_of_mem_reserve(void)\r\n{\r\nearly_init_fdt_reserve_self();\r\nearly_init_fdt_scan_reserved_mem();\r\n}\r\nstatic void __init sh_of_time_init(void)\r\n{\r\npr_info("SH generic board support: scanning for clocksource devices\n");\r\nclocksource_probe();\r\n}\r\nstatic void __init sh_of_setup(char **cmdline_p)\r\n{\r\nunflatten_device_tree();\r\nboard_time_init = sh_of_time_init;\r\nsh_mv.mv_name = of_flat_dt_get_machine_name();\r\nif (!sh_mv.mv_name)\r\nsh_mv.mv_name = "Unknown SH model";\r\nsh_of_smp_probe();\r\n}\r\nstatic int sh_of_irq_demux(int irq)\r\n{\r\nreturn irq;\r\n}\r\nstatic void __init sh_of_init_irq(void)\r\n{\r\npr_info("SH generic board support: scanning for interrupt controllers\n");\r\nirqchip_init();\r\n}\r\nstatic int __init sh_of_clk_init(void)\r\n{\r\n#ifdef CONFIG_COMMON_CLK\r\npr_info("SH generic board support: scanning for clk providers\n");\r\nof_clk_init(NULL);\r\n#endif\r\nreturn 0;\r\n}\r\nvoid __init arch_init_clk_ops(struct sh_clk_ops **ops, int idx)\r\n{\r\n}\r\nvoid __init plat_irq_setup(void)\r\n{\r\n}\r\nstatic int __init sh_of_device_init(void)\r\n{\r\npr_info("SH generic board support: populating platform devices\n");\r\nif (of_have_populated_dt()) {\r\nof_iommu_init();\r\nof_platform_populate(NULL, of_default_bus_match_table,\r\nNULL, NULL);\r\n} else {\r\npr_crit("Device tree not populated\n");\r\n}\r\nreturn 0;\r\n}
