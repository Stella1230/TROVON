static int __init via_pmu_event_init(void)\r\n{\r\nint err;\r\nif (pmu_get_model() != PMU_KEYLARGO_BASED)\r\nreturn -ENODEV;\r\npmu_input_dev = input_allocate_device();\r\nif (!pmu_input_dev)\r\nreturn -ENOMEM;\r\npmu_input_dev->name = "PMU";\r\npmu_input_dev->id.bustype = BUS_HOST;\r\npmu_input_dev->id.vendor = 0x0001;\r\npmu_input_dev->id.product = 0x0001;\r\npmu_input_dev->id.version = 0x0100;\r\nset_bit(EV_KEY, pmu_input_dev->evbit);\r\nset_bit(EV_SW, pmu_input_dev->evbit);\r\nset_bit(KEY_POWER, pmu_input_dev->keybit);\r\nset_bit(SW_LID, pmu_input_dev->swbit);\r\nerr = input_register_device(pmu_input_dev);\r\nif (err)\r\ninput_free_device(pmu_input_dev);\r\nreturn err;\r\n}\r\nvoid via_pmu_event(int key, int down)\r\n{\r\nif (unlikely(!pmu_input_dev))\r\nreturn;\r\nswitch (key) {\r\ncase PMU_EVT_POWER:\r\ninput_report_key(pmu_input_dev, KEY_POWER, down);\r\nbreak;\r\ncase PMU_EVT_LID:\r\ninput_report_switch(pmu_input_dev, SW_LID, down);\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\ninput_sync(pmu_input_dev);\r\n}
