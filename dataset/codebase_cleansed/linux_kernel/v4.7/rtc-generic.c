static int generic_get_time(struct device *dev, struct rtc_time *tm)\r\n{\r\nunsigned int ret = get_rtc_time(tm);\r\nif (ret & RTC_BATT_BAD)\r\nreturn -EOPNOTSUPP;\r\nreturn rtc_valid_tm(tm);\r\n}\r\nstatic int generic_set_time(struct device *dev, struct rtc_time *tm)\r\n{\r\nif (set_rtc_time(tm) < 0)\r\nreturn -EOPNOTSUPP;\r\nreturn 0;\r\n}\r\nstatic int __init generic_rtc_probe(struct platform_device *dev)\r\n{\r\nstruct rtc_device *rtc;\r\nconst struct rtc_class_ops *ops;\r\nops = dev_get_platdata(&dev->dev);\r\nif (!ops)\r\nops = &generic_rtc_ops;\r\nrtc = devm_rtc_device_register(&dev->dev, "rtc-generic",\r\nops, THIS_MODULE);\r\nif (IS_ERR(rtc))\r\nreturn PTR_ERR(rtc);\r\nplatform_set_drvdata(dev, rtc);\r\nreturn 0;\r\n}
