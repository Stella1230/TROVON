static int __init serial_init_chip(struct parisc_device *dev)\r\n{\r\nstruct uart_8250_port uart;\r\nunsigned long address;\r\nint err;\r\n#ifdef CONFIG_64BIT\r\nif (!dev->irq && (dev->id.sversion == 0xad))\r\ndev->irq = iosapic_serial_irq(dev);\r\n#endif\r\nif (!dev->irq) {\r\nif (parisc_parent(dev)->id.hw_type != HPHW_IOA)\r\ndev_info(&dev->dev,\r\n"Serial: device 0x%llx not configured.\n"\r\n"Enable support for Wax, Lasi, Asp or Dino.\n",\r\n(unsigned long long)dev->hpa.start);\r\nreturn -ENODEV;\r\n}\r\naddress = dev->hpa.start;\r\nif (dev->id.sversion != 0x8d)\r\naddress += 0x800;\r\nmemset(&uart, 0, sizeof(uart));\r\nuart.port.iotype = UPIO_MEM;\r\nuart.port.uartclk = (dev->id.sversion != 0xad) ?\r\n7272727 : 1843200;\r\nuart.port.mapbase = address;\r\nuart.port.membase = ioremap_nocache(address, 16);\r\nuart.port.irq = dev->irq;\r\nuart.port.flags = UPF_BOOT_AUTOCONF;\r\nuart.port.dev = &dev->dev;\r\nerr = serial8250_register_8250_port(&uart);\r\nif (err < 0) {\r\ndev_warn(&dev->dev,\r\n"serial8250_register_8250_port returned error %d\n",\r\nerr);\r\niounmap(uart.port.membase);\r\nreturn err;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init probe_serial_gsc(void)\r\n{\r\nregister_parisc_driver(&lasi_driver);\r\nregister_parisc_driver(&serial_driver);\r\nreturn 0;\r\n}
