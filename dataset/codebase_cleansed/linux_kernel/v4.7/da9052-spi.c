static int da9052_spi_probe(struct spi_device *spi)\r\n{\r\nstruct regmap_config config;\r\nint ret;\r\nconst struct spi_device_id *id = spi_get_device_id(spi);\r\nstruct da9052 *da9052;\r\nda9052 = devm_kzalloc(&spi->dev, sizeof(struct da9052), GFP_KERNEL);\r\nif (!da9052)\r\nreturn -ENOMEM;\r\nspi->mode = SPI_MODE_0;\r\nspi->bits_per_word = 8;\r\nspi_setup(spi);\r\nda9052->dev = &spi->dev;\r\nda9052->chip_irq = spi->irq;\r\nspi_set_drvdata(spi, da9052);\r\nconfig = da9052_regmap_config;\r\nconfig.read_flag_mask = 1;\r\nconfig.reg_bits = 7;\r\nconfig.pad_bits = 1;\r\nconfig.val_bits = 8;\r\nconfig.use_single_rw = 1;\r\nda9052->regmap = devm_regmap_init_spi(spi, &config);\r\nif (IS_ERR(da9052->regmap)) {\r\nret = PTR_ERR(da9052->regmap);\r\ndev_err(&spi->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\nreturn da9052_device_init(da9052, id->driver_data);\r\n}\r\nstatic int da9052_spi_remove(struct spi_device *spi)\r\n{\r\nstruct da9052 *da9052 = spi_get_drvdata(spi);\r\nda9052_device_exit(da9052);\r\nreturn 0;\r\n}\r\nstatic int __init da9052_spi_init(void)\r\n{\r\nint ret;\r\nret = spi_register_driver(&da9052_spi_driver);\r\nif (ret != 0) {\r\npr_err("Failed to register DA9052 SPI driver, %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit da9052_spi_exit(void)\r\n{\r\nspi_unregister_driver(&da9052_spi_driver);\r\n}
