static void __init nettel_smc91x_setmac(unsigned int ioaddr, unsigned int flashaddr)\r\n{\r\nu16 *macp;\r\nmacp = (u16 *) flashaddr;\r\nif ((macp[0] == 0xffff) && (macp[1] == 0xffff) && (macp[2] == 0xffff))\r\nmacp = (u16 *) &nettel_macdefault[0];\r\nwritew(1, NETTEL_SMC0_ADDR + SMC91xx_BANKSELECT);\r\nwritew(macp[0], ioaddr + SMC91xx_BASEMAC);\r\nwritew(macp[1], ioaddr + SMC91xx_BASEMAC + 2);\r\nwritew(macp[2], ioaddr + SMC91xx_BASEMAC + 4);\r\n}\r\nstatic void __init nettel_smc91x_init(void)\r\n{\r\nwritew(0x00ec, MCFSIM_PADDR);\r\nmcf_setppdata(0, 0x0080);\r\nwritew(1, NETTEL_SMC0_ADDR + SMC91xx_BANKSELECT);\r\nwritew(0x0067, NETTEL_SMC0_ADDR + SMC91xx_BASEADDR);\r\nmcf_setppdata(0x0080, 0);\r\nwritew(0x1180, MCFSIM_CSCR3);\r\nmcf_autovector(NETTEL_SMC0_IRQ);\r\nmcf_autovector(NETTEL_SMC1_IRQ);\r\nnettel_smc91x_setmac(NETTEL_SMC0_ADDR, 0xf0006000);\r\nnettel_smc91x_setmac(NETTEL_SMC1_ADDR, 0xf0006006);\r\n}\r\nstatic int __init init_nettel(void)\r\n{\r\nnettel_smc91x_init();\r\nplatform_add_devices(nettel_devices, ARRAY_SIZE(nettel_devices));\r\nreturn 0;\r\n}
