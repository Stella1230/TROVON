int\r\nparse_regs(const struct option *opt, const char *str, int unset)\r\n{\r\nuint64_t *mode = (uint64_t *)opt->value;\r\nconst struct sample_reg *r;\r\nchar *s, *os = NULL, *p;\r\nint ret = -1;\r\nif (unset)\r\nreturn 0;\r\nif (*mode)\r\nreturn -1;\r\nif (str) {\r\ns = os = strdup(str);\r\nif (!s)\r\nreturn -1;\r\nfor (;;) {\r\np = strchr(s, ',');\r\nif (p)\r\n*p = '\0';\r\nif (!strcmp(s, "?")) {\r\nfprintf(stderr, "available registers: ");\r\nfor (r = sample_reg_masks; r->name; r++) {\r\nfprintf(stderr, "%s ", r->name);\r\n}\r\nfputc('\n', stderr);\r\nreturn -1;\r\n}\r\nfor (r = sample_reg_masks; r->name; r++) {\r\nif (!strcasecmp(s, r->name))\r\nbreak;\r\n}\r\nif (!r->name) {\r\nui__warning("unknown register %s,"\r\n" check man page\n", s);\r\ngoto error;\r\n}\r\n*mode |= r->mask;\r\nif (!p)\r\nbreak;\r\ns = p + 1;\r\n}\r\n}\r\nret = 0;\r\nif (*mode == 0)\r\n*mode = PERF_REGS_MASK;\r\nerror:\r\nfree(os);\r\nreturn ret;\r\n}
