static int __init actisys_sir_init(void)\r\n{\r\nint ret;\r\nret = irda_register_dongle(&act220l);\r\nif (ret < 0)\r\nreturn ret;\r\nret = irda_register_dongle(&act220l_plus);\r\nif (ret < 0) {\r\nirda_unregister_dongle(&act220l);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit actisys_sir_cleanup(void)\r\n{\r\nirda_unregister_dongle(&act220l_plus);\r\nirda_unregister_dongle(&act220l);\r\n}\r\nstatic int actisys_open(struct sir_dev *dev)\r\n{\r\nstruct qos_info *qos = &dev->qos;\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nqos->baud_rate.bits &= IR_9600|IR_19200|IR_38400|IR_57600|IR_115200;\r\nif (dev->dongle_drv->type == IRDA_ACTISYS_DONGLE)\r\nqos->baud_rate.bits &= ~IR_38400;\r\nqos->min_turn_time.bits = 0x7f;\r\nirda_qos_bits_to_value(qos);\r\nreturn 0;\r\n}\r\nstatic int actisys_close(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, FALSE, FALSE);\r\nreturn 0;\r\n}\r\nstatic int actisys_change_speed(struct sir_dev *dev, unsigned speed)\r\n{\r\nint ret = 0;\r\nint i = 0;\r\npr_debug("%s(), speed=%d (was %d)\n", __func__, speed, dev->speed);\r\nfor (i = 0; i < MAX_SPEEDS; i++) {\r\nif (speed == baud_rates[i]) {\r\ndev->speed = speed;\r\nbreak;\r\n}\r\nsirdev_set_dtr_rts(dev, TRUE, FALSE);\r\nudelay(MIN_DELAY);\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\nudelay(MIN_DELAY);\r\n}\r\nif (i >= MAX_SPEEDS) {\r\nactisys_reset(dev);\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic int actisys_reset(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, FALSE, TRUE);\r\nudelay(MIN_DELAY);\r\nsirdev_set_dtr_rts(dev, TRUE, TRUE);\r\ndev->speed = 9600;\r\nreturn 0;\r\n}
