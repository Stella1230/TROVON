struct extcon_dev *of_extcon_get_extcon_dev(struct device *dev, int index)\r\n{\r\nstruct device_node *node;\r\nstruct extcon_dev *edev;\r\nstruct platform_device *extcon_parent_dev;\r\nif (!dev->of_node) {\r\ndev_dbg(dev, "device does not have a device node entry\n");\r\nreturn ERR_PTR(-EINVAL);\r\n}\r\nnode = of_parse_phandle(dev->of_node, "extcon", index);\r\nif (!node) {\r\ndev_dbg(dev, "failed to get phandle in %s node\n",\r\ndev->of_node->full_name);\r\nreturn ERR_PTR(-ENODEV);\r\n}\r\nextcon_parent_dev = of_find_device_by_node(node);\r\nif (!extcon_parent_dev) {\r\ndev_dbg(dev, "unable to find device by node\n");\r\nreturn ERR_PTR(-EPROBE_DEFER);\r\n}\r\nedev = extcon_get_extcon_dev(dev_name(&extcon_parent_dev->dev));\r\nif (!edev) {\r\ndev_dbg(dev, "unable to get extcon device : %s\n",\r\ndev_name(&extcon_parent_dev->dev));\r\nreturn ERR_PTR(-ENODEV);\r\n}\r\nreturn edev;\r\n}
