static void pandora_wl1251_init_card(struct mmc_card *card)\r\n{\r\ncard->quirks |= MMC_QUIRK_NONSTD_SDIO;\r\ncard->cccr.wide_bus = 1;\r\ncard->cis.vendor = 0x104c;\r\ncard->cis.device = 0x9066;\r\ncard->cis.blksize = 512;\r\ncard->cis.max_dtr = 20000000;\r\n}\r\nstatic int omap3pandora_twl_gpio_setup(struct device *dev,\r\nunsigned gpio, unsigned ngpio)\r\n{\r\nint ret, gpio_32khz;\r\nomap3pandora_mmc[0].gpio_cd = gpio + 0;\r\nomap3pandora_mmc[1].gpio_cd = gpio + 1;\r\nomap_hsmmc_late_init(omap3pandora_mmc);\r\ngpio_32khz = gpio + 13;\r\nret = gpio_request_one(gpio_32khz, GPIOF_OUT_INIT_HIGH, "wifi 32kHz");\r\nif (ret < 0) {\r\npr_err("Cannot get GPIO line %d, ret=%d\n", gpio_32khz, ret);\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init omap3pandora_i2c_init(void)\r\n{\r\nomap3_pmic_get_config(&omap3pandora_twldata,\r\nTWL_COMMON_PDATA_USB | TWL_COMMON_PDATA_AUDIO,\r\nTWL_COMMON_REGULATOR_VDAC | TWL_COMMON_REGULATOR_VPLL2);\r\nomap3pandora_twldata.vdac->constraints.apply_uV = true;\r\nomap3pandora_twldata.vpll2->constraints.apply_uV = true;\r\nomap3pandora_twldata.vpll2->num_consumer_supplies =\r\nARRAY_SIZE(pandora_vdds_supplies);\r\nomap3pandora_twldata.vpll2->consumer_supplies = pandora_vdds_supplies;\r\nomap3_pmic_init("tps65950", &omap3pandora_twldata);\r\nomap_register_i2c_bus(3, 100, omap3pandora_i2c3_boardinfo,\r\nARRAY_SIZE(omap3pandora_i2c3_boardinfo));\r\nreturn 0;\r\n}\r\nstatic void __init pandora_wl1251_init(void)\r\n{\r\nstruct wl12xx_platform_data pandora_wl1251_pdata;\r\nint ret;\r\nmemset(&pandora_wl1251_pdata, 0, sizeof(pandora_wl1251_pdata));\r\nret = gpio_request_one(PANDORA_WIFI_IRQ_GPIO, GPIOF_IN, "wl1251 irq");\r\nif (ret < 0)\r\ngoto fail;\r\npandora_wl1251_pdata.irq = gpio_to_irq(PANDORA_WIFI_IRQ_GPIO);\r\nif (pandora_wl1251_pdata.irq < 0)\r\ngoto fail_irq;\r\npandora_wl1251_pdata.use_eeprom = true;\r\nret = wl12xx_set_platform_data(&pandora_wl1251_pdata);\r\nif (ret < 0)\r\ngoto fail_irq;\r\nreturn;\r\nfail_irq:\r\ngpio_free(PANDORA_WIFI_IRQ_GPIO);\r\nfail:\r\nprintk(KERN_ERR "wl1251 board initialisation failed\n");\r\n}\r\nstatic void __init omap3pandora_init(void)\r\n{\r\nomap3_mux_init(board_mux, OMAP_PACKAGE_CBB);\r\nomap_hsmmc_init(omap3pandora_mmc);\r\nomap3pandora_i2c_init();\r\npandora_wl1251_init();\r\nplatform_add_devices(omap3pandora_devices,\r\nARRAY_SIZE(omap3pandora_devices));\r\nomap_display_init(&pandora_dss_data);\r\nomap_serial_init();\r\nomap_sdrc_init(mt46h32m32lf6_sdrc_params,\r\nmt46h32m32lf6_sdrc_params);\r\nspi_register_board_info(omap3pandora_spi_board_info,\r\nARRAY_SIZE(omap3pandora_spi_board_info));\r\nomap_ads7846_init(1, OMAP3_PANDORA_TS_GPIO, 0, NULL);\r\nusbhs_init_phys(phy_data, ARRAY_SIZE(phy_data));\r\nusbhs_init(&usbhs_bdata);\r\nusb_bind_phy("musb-hdrc.0.auto", 0, "twl4030_usb");\r\nusb_musb_init(NULL);\r\ngpmc_nand_init(&pandora_nand_data, NULL);\r\nomap_mux_init_signal("sdrc_cke0", OMAP_PIN_OUTPUT);\r\nomap_mux_init_signal("sdrc_cke1", OMAP_PIN_OUTPUT);\r\n}
