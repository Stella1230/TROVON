static int rcar_du_lvds_connector_get_modes(struct drm_connector *connector)\r\n{\r\nstruct rcar_du_lvds_connector *lvdscon =\r\nto_rcar_lvds_connector(connector);\r\nstruct drm_display_mode *mode;\r\nmode = drm_mode_create(connector->dev);\r\nif (mode == NULL)\r\nreturn 0;\r\nmode->type = DRM_MODE_TYPE_PREFERRED | DRM_MODE_TYPE_DRIVER;\r\nmode->clock = lvdscon->panel->mode.clock;\r\nmode->hdisplay = lvdscon->panel->mode.hdisplay;\r\nmode->hsync_start = lvdscon->panel->mode.hsync_start;\r\nmode->hsync_end = lvdscon->panel->mode.hsync_end;\r\nmode->htotal = lvdscon->panel->mode.htotal;\r\nmode->vdisplay = lvdscon->panel->mode.vdisplay;\r\nmode->vsync_start = lvdscon->panel->mode.vsync_start;\r\nmode->vsync_end = lvdscon->panel->mode.vsync_end;\r\nmode->vtotal = lvdscon->panel->mode.vtotal;\r\nmode->flags = lvdscon->panel->mode.flags;\r\ndrm_mode_set_name(mode);\r\ndrm_mode_probed_add(connector, mode);\r\nreturn 1;\r\n}\r\nstatic int rcar_du_lvds_connector_mode_valid(struct drm_connector *connector,\r\nstruct drm_display_mode *mode)\r\n{\r\nreturn MODE_OK;\r\n}\r\nstatic void rcar_du_lvds_connector_destroy(struct drm_connector *connector)\r\n{\r\ndrm_sysfs_connector_remove(connector);\r\ndrm_connector_cleanup(connector);\r\n}\r\nstatic enum drm_connector_status\r\nrcar_du_lvds_connector_detect(struct drm_connector *connector, bool force)\r\n{\r\nreturn connector_status_connected;\r\n}\r\nint rcar_du_lvds_connector_init(struct rcar_du_device *rcdu,\r\nstruct rcar_du_encoder *renc,\r\nconst struct rcar_du_panel_data *panel)\r\n{\r\nstruct rcar_du_lvds_connector *lvdscon;\r\nstruct drm_connector *connector;\r\nint ret;\r\nlvdscon = devm_kzalloc(rcdu->dev, sizeof(*lvdscon), GFP_KERNEL);\r\nif (lvdscon == NULL)\r\nreturn -ENOMEM;\r\nlvdscon->panel = panel;\r\nconnector = &lvdscon->connector.connector;\r\nconnector->display_info.width_mm = panel->width_mm;\r\nconnector->display_info.height_mm = panel->height_mm;\r\nret = drm_connector_init(rcdu->ddev, connector, &connector_funcs,\r\nDRM_MODE_CONNECTOR_LVDS);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_connector_helper_add(connector, &connector_helper_funcs);\r\nret = drm_sysfs_connector_add(connector);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_helper_connector_dpms(connector, DRM_MODE_DPMS_OFF);\r\ndrm_object_property_set_value(&connector->base,\r\nrcdu->ddev->mode_config.dpms_property, DRM_MODE_DPMS_OFF);\r\nret = drm_mode_connector_attach_encoder(connector, &renc->encoder);\r\nif (ret < 0)\r\nreturn ret;\r\nconnector->encoder = &renc->encoder;\r\nlvdscon->connector.encoder = renc;\r\nreturn 0;\r\n}
