void\r\nnouveau_subdev_reset(struct nouveau_object *subdev)\r\n{\r\nnv_trace(subdev, "resetting...\n");\r\nnv_ofuncs(subdev)->fini(subdev, false);\r\nnv_debug(subdev, "reset\n");\r\n}\r\nint\r\nnouveau_subdev_init(struct nouveau_subdev *subdev)\r\n{\r\nint ret = nouveau_object_init(&subdev->base);\r\nif (ret)\r\nreturn ret;\r\nnouveau_subdev_reset(&subdev->base);\r\nreturn 0;\r\n}\r\nint\r\n_nouveau_subdev_init(struct nouveau_object *object)\r\n{\r\nreturn nouveau_subdev_init(nv_subdev(object));\r\n}\r\nint\r\nnouveau_subdev_fini(struct nouveau_subdev *subdev, bool suspend)\r\n{\r\nif (subdev->unit) {\r\nnv_mask(subdev, 0x000200, subdev->unit, 0x00000000);\r\nnv_mask(subdev, 0x000200, subdev->unit, subdev->unit);\r\n}\r\nreturn nouveau_object_fini(&subdev->base, suspend);\r\n}\r\nint\r\n_nouveau_subdev_fini(struct nouveau_object *object, bool suspend)\r\n{\r\nreturn nouveau_subdev_fini(nv_subdev(object), suspend);\r\n}\r\nvoid\r\nnouveau_subdev_destroy(struct nouveau_subdev *subdev)\r\n{\r\nint subidx = nv_hclass(subdev) & 0xff;\r\nnv_device(subdev)->subdev[subidx] = NULL;\r\nnouveau_object_destroy(&subdev->base);\r\n}\r\nvoid\r\n_nouveau_subdev_dtor(struct nouveau_object *object)\r\n{\r\nnouveau_subdev_destroy(nv_subdev(object));\r\n}\r\nint\r\nnouveau_subdev_create_(struct nouveau_object *parent,\r\nstruct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, u32 pclass,\r\nconst char *subname, const char *sysname,\r\nint size, void **pobject)\r\n{\r\nstruct nouveau_subdev *subdev;\r\nint ret;\r\nret = nouveau_object_create_(parent, engine, oclass, pclass |\r\nNV_SUBDEV_CLASS, size, pobject);\r\nsubdev = *pobject;\r\nif (ret)\r\nreturn ret;\r\n__mutex_init(&subdev->mutex, subname, &oclass->lock_class_key);\r\nsubdev->name = subname;\r\nif (parent) {\r\nstruct nouveau_device *device = nv_device(parent);\r\nsubdev->debug = nouveau_dbgopt(device->dbgopt, subname);\r\nsubdev->mmio = nv_subdev(device)->mmio;\r\n}\r\nreturn 0;\r\n}
