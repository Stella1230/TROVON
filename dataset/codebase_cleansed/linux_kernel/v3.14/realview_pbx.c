static void __init realview_pbx_map_io(void)\r\n{\r\niotable_init(realview_pbx_io_desc, ARRAY_SIZE(realview_pbx_io_desc));\r\nif (core_tile_pbx11mp() || core_tile_pbxa9mp())\r\niotable_init(realview_local_io_desc, ARRAY_SIZE(realview_local_io_desc));\r\n}\r\nstatic void __init gic_init_irq(void)\r\n{\r\nif (core_tile_pbx11mp() || core_tile_pbxa9mp()) {\r\ngic_init(0, 29, __io_address(REALVIEW_PBX_TILE_GIC_DIST_BASE),\r\n__io_address(REALVIEW_PBX_TILE_GIC_CPU_BASE));\r\n} else {\r\ngic_init(0, IRQ_PBX_GIC_START,\r\n__io_address(REALVIEW_PBX_GIC_DIST_BASE),\r\n__io_address(REALVIEW_PBX_GIC_CPU_BASE));\r\n}\r\n}\r\nstatic void __init realview_pbx_twd_init(void)\r\n{\r\nint err = twd_local_timer_register(&twd_local_timer);\r\nif (err)\r\npr_err("twd_local_timer_register failed %d\n", err);\r\n}\r\nstatic void __init realview_pbx_timer_init(void)\r\n{\r\ntimer0_va_base = __io_address(REALVIEW_PBX_TIMER0_1_BASE);\r\ntimer1_va_base = __io_address(REALVIEW_PBX_TIMER0_1_BASE) + 0x20;\r\ntimer2_va_base = __io_address(REALVIEW_PBX_TIMER2_3_BASE);\r\ntimer3_va_base = __io_address(REALVIEW_PBX_TIMER2_3_BASE) + 0x20;\r\nrealview_clk_init(__io_address(REALVIEW_SYS_BASE), false);\r\nrealview_timer_init(IRQ_PBX_TIMER0_1);\r\nrealview_pbx_twd_init();\r\n}\r\nstatic void realview_pbx_fixup(struct tag *tags, char **from,\r\nstruct meminfo *meminfo)\r\n{\r\n#ifdef CONFIG_SPARSEMEM\r\nmeminfo->bank[0].start = 0;\r\nmeminfo->bank[0].size = SZ_256M;\r\nmeminfo->bank[1].start = 0x20000000;\r\nmeminfo->bank[1].size = SZ_512M;\r\nmeminfo->bank[2].start = 0x80000000;\r\nmeminfo->bank[2].size = SZ_256M;\r\nmeminfo->nr_banks = 3;\r\n#else\r\nrealview_fixup(tags, from, meminfo);\r\n#endif\r\n}\r\nstatic void realview_pbx_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nvoid __iomem *reset_ctrl = __io_address(REALVIEW_SYS_RESETCTL);\r\nvoid __iomem *lock_ctrl = __io_address(REALVIEW_SYS_LOCK);\r\n__raw_writel(REALVIEW_SYS_LOCK_VAL, lock_ctrl);\r\n__raw_writel(0x00F0, reset_ctrl);\r\n__raw_writel(0x00F4, reset_ctrl);\r\ndsb();\r\n}\r\nstatic void __init realview_pbx_init(void)\r\n{\r\nint i;\r\n#ifdef CONFIG_CACHE_L2X0\r\nif (core_tile_pbxa9mp()) {\r\nvoid __iomem *l2x0_base =\r\n__io_address(REALVIEW_PBX_TILE_L220_BASE);\r\nwritel(0, l2x0_base + L2X0_TAG_LATENCY_CTRL);\r\nwritel(0, l2x0_base + L2X0_DATA_LATENCY_CTRL);\r\nl2x0_init(l2x0_base, 0x02520000, 0xc0000fff);\r\nplatform_device_register(&pmu_device);\r\n}\r\n#endif\r\nrealview_flash_register(realview_pbx_flash_resources,\r\nARRAY_SIZE(realview_pbx_flash_resources));\r\nrealview_eth_register(NULL, realview_pbx_smsc911x_resources);\r\nplatform_device_register(&realview_i2c_device);\r\nplatform_device_register(&realview_cf_device);\r\nrealview_usb_register(realview_pbx_isp1761_resources);\r\nfor (i = 0; i < ARRAY_SIZE(amba_devs); i++) {\r\nstruct amba_device *d = amba_devs[i];\r\namba_device_register(d, &iomem_resource);\r\n}\r\n}
