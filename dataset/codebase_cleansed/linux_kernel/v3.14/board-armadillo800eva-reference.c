static void __init eva_clock_init(void)\r\n{\r\nstruct clk *system = clk_get(NULL, "system_clk");\r\nstruct clk *xtal1 = clk_get(NULL, "extal1");\r\nstruct clk *usb24s = clk_get(NULL, "usb24s");\r\nstruct clk *fsibck = clk_get(NULL, "fsibck");\r\nif (IS_ERR(system) ||\r\nIS_ERR(xtal1) ||\r\nIS_ERR(usb24s) ||\r\nIS_ERR(fsibck)) {\r\npr_err("armadillo800eva board clock init failed\n");\r\ngoto clock_error;\r\n}\r\nclk_set_rate(xtal1, 24000000);\r\nclk_set_parent(usb24s, system);\r\nclk_set_rate(fsibck, 12288000);\r\nclock_error:\r\nif (!IS_ERR(system))\r\nclk_put(system);\r\nif (!IS_ERR(xtal1))\r\nclk_put(xtal1);\r\nif (!IS_ERR(usb24s))\r\nclk_put(usb24s);\r\nif (!IS_ERR(fsibck))\r\nclk_put(fsibck);\r\n}\r\nstatic void __init eva_init(void)\r\n{\r\nr8a7740_clock_init(MD_CK0 | MD_CK2);\r\neva_clock_init();\r\nr8a7740_meram_workaround();\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_init(IOMEM(0xf0002000), 0x40440000, 0x82000fff);\r\n#endif\r\nr8a7740_add_standard_devices_dt();\r\nr8a7740_pm_init();\r\n}\r\nstatic void eva_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nwritel(1 << 31, RESCNT2);\r\n}
