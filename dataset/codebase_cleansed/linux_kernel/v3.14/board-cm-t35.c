static void __init cm_t35_init_ethernet(void)\r\n{\r\nregulator_register_fixed(0, cm_t35_smsc911x_supplies,\r\nARRAY_SIZE(cm_t35_smsc911x_supplies));\r\nregulator_register_fixed(1, sb_t35_smsc911x_supplies,\r\nARRAY_SIZE(sb_t35_smsc911x_supplies));\r\ngpmc_smsc911x_init(&cm_t35_smsc911x_cfg);\r\ngpmc_smsc911x_init(&sb_t35_smsc911x_cfg);\r\n}\r\nstatic inline void __init cm_t35_init_ethernet(void) { return; }\r\nstatic void __init cm_t35_init_led(void)\r\n{\r\nplatform_device_register(&cm_t35_led_device);\r\n}\r\nstatic inline void cm_t35_init_led(void) {}\r\nstatic void __init cm_t35_init_nand(void)\r\n{\r\nif (gpmc_nand_init(&cm_t35_nand_data, NULL) < 0)\r\npr_err("CM-T35: Unable to register NAND device\n");\r\n}\r\nstatic inline void cm_t35_init_nand(void) {}\r\nstatic void __init cm_t35_init_display(void)\r\n{\r\nint err;\r\nspi_register_board_info(cm_t35_lcd_spi_board_info,\r\nARRAY_SIZE(cm_t35_lcd_spi_board_info));\r\nerr = gpio_request_one(CM_T35_LCD_EN_GPIO, GPIOF_OUT_INIT_LOW,\r\n"lcd bl enable");\r\nif (err) {\r\npr_err("CM-T35: failed to request LCD EN GPIO\n");\r\nreturn;\r\n}\r\nmsleep(50);\r\ngpio_set_value(CM_T35_LCD_EN_GPIO, 1);\r\nerr = omap_display_init(&cm_t35_dss_data);\r\nif (err) {\r\npr_err("CM-T35: failed to register DSS device\n");\r\ngpio_free(CM_T35_LCD_EN_GPIO);\r\n}\r\nplatform_device_register(&cm_t35_tfp410_device);\r\nplatform_device_register(&cm_t35_dvi_connector_device);\r\nplatform_device_register(&cm_t35_lcd_device);\r\nplatform_device_register(&cm_t35_tv_connector_device);\r\n}\r\nstatic void __init cm_t35_init_usbh(void)\r\n{\r\nint err;\r\nerr = gpio_request_one(SB_T35_USB_HUB_RESET_GPIO,\r\nGPIOF_OUT_INIT_LOW, "usb hub rst");\r\nif (err) {\r\npr_err("SB-T35: usb hub rst gpio request failed: %d\n", err);\r\n} else {\r\nudelay(10);\r\ngpio_set_value(SB_T35_USB_HUB_RESET_GPIO, 1);\r\nmsleep(1);\r\n}\r\nusbhs_init_phys(phy_data, ARRAY_SIZE(phy_data));\r\nusbhs_init(&usbhs_bdata);\r\n}\r\nstatic int cm_t35_twl_gpio_setup(struct device *dev, unsigned gpio,\r\nunsigned ngpio)\r\n{\r\nint wlan_rst = gpio + 2;\r\nif (gpio_request_one(wlan_rst, GPIOF_OUT_INIT_HIGH, "WLAN RST") == 0) {\r\ngpio_export(wlan_rst, 0);\r\nudelay(10);\r\ngpio_set_value_cansleep(wlan_rst, 0);\r\nudelay(10);\r\ngpio_set_value_cansleep(wlan_rst, 1);\r\n} else {\r\npr_err("CM-T35: could not obtain gpio for WiFi reset\n");\r\n}\r\nmmc[0].gpio_cd = gpio + 0;\r\nomap_hsmmc_late_init(mmc);\r\nreturn 0;\r\n}\r\nstatic void __init cm_t35_init_camera(void)\r\n{\r\nif (omap3_init_camera(&cm_t35_isp_pdata) < 0)\r\npr_warn("CM-T3x: Failed registering camera device!\n");\r\n}\r\nstatic inline void cm_t35_init_camera(void) {}\r\nstatic void __init cm_t35_init_i2c(void)\r\n{\r\nomap3_pmic_get_config(&cm_t35_twldata, TWL_COMMON_PDATA_USB,\r\nTWL_COMMON_REGULATOR_VDAC |\r\nTWL_COMMON_PDATA_AUDIO);\r\nomap3_pmic_init("tps65930", &cm_t35_twldata);\r\nomap_register_i2c_bus(3, 400, NULL, 0);\r\n}\r\nstatic void __init cm_t3x_common_dss_mux_init(int mux_mode)\r\n{\r\nomap_mux_init_signal("dss_data18", mux_mode);\r\nomap_mux_init_signal("dss_data19", mux_mode);\r\nomap_mux_init_signal("dss_data20", mux_mode);\r\nomap_mux_init_signal("dss_data21", mux_mode);\r\nomap_mux_init_signal("dss_data22", mux_mode);\r\nomap_mux_init_signal("dss_data23", mux_mode);\r\n}\r\nstatic void __init cm_t35_init_mux(void)\r\n{\r\nint mux_mode = OMAP_MUX_MODE0 | OMAP_PIN_OUTPUT;\r\nomap_mux_init_signal("dss_data0.dss_data0", mux_mode);\r\nomap_mux_init_signal("dss_data1.dss_data1", mux_mode);\r\nomap_mux_init_signal("dss_data2.dss_data2", mux_mode);\r\nomap_mux_init_signal("dss_data3.dss_data3", mux_mode);\r\nomap_mux_init_signal("dss_data4.dss_data4", mux_mode);\r\nomap_mux_init_signal("dss_data5.dss_data5", mux_mode);\r\ncm_t3x_common_dss_mux_init(mux_mode);\r\n}\r\nstatic void __init cm_t3730_init_mux(void)\r\n{\r\nint mux_mode = OMAP_MUX_MODE3 | OMAP_PIN_OUTPUT;\r\nomap_mux_init_signal("sys_boot0", mux_mode);\r\nomap_mux_init_signal("sys_boot1", mux_mode);\r\nomap_mux_init_signal("sys_boot3", mux_mode);\r\nomap_mux_init_signal("sys_boot4", mux_mode);\r\nomap_mux_init_signal("sys_boot5", mux_mode);\r\nomap_mux_init_signal("sys_boot6", mux_mode);\r\ncm_t3x_common_dss_mux_init(mux_mode);\r\n}\r\nstatic inline void cm_t35_init_mux(void) {}\r\nstatic inline void cm_t3730_init_mux(void) {}\r\nstatic void __init cm_t3x_common_init(void)\r\n{\r\nomap3_mux_init(board_mux, OMAP_PACKAGE_CUS);\r\nomap_serial_init();\r\nomap_sdrc_init(mt46h32m32lf6_sdrc_params,\r\nmt46h32m32lf6_sdrc_params);\r\nomap_hsmmc_init(mmc);\r\ncm_t35_init_i2c();\r\nomap_ads7846_init(1, CM_T35_GPIO_PENDOWN, 0, NULL);\r\ncm_t35_init_ethernet();\r\ncm_t35_init_led();\r\ncm_t35_init_display();\r\nomap_twl4030_audio_init("cm-t3x", NULL);\r\nusb_bind_phy("musb-hdrc.0.auto", 0, "twl4030_usb");\r\nusb_musb_init(NULL);\r\ncm_t35_init_usbh();\r\ncm_t35_init_camera();\r\n}\r\nstatic void __init cm_t35_init(void)\r\n{\r\ncm_t3x_common_init();\r\ncm_t35_init_mux();\r\ncm_t35_init_nand();\r\n}\r\nstatic void __init cm_t3730_init(void)\r\n{\r\ncm_t3x_common_init();\r\ncm_t3730_init_mux();\r\n}
