static const struct cpu_operations * __init cpu_get_ops(const char *name)\r\n{\r\nconst struct cpu_operations **ops = supported_cpu_ops;\r\nwhile (*ops) {\r\nif (!strcmp(name, (*ops)->name))\r\nreturn *ops;\r\nops++;\r\n}\r\nreturn NULL;\r\n}\r\nint __init cpu_read_ops(struct device_node *dn, int cpu)\r\n{\r\nconst char *enable_method = of_get_property(dn, "enable-method", NULL);\r\nif (!enable_method) {\r\nif (cpu != 0)\r\npr_err("%s: missing enable-method property\n",\r\ndn->full_name);\r\nreturn -ENOENT;\r\n}\r\ncpu_ops[cpu] = cpu_get_ops(enable_method);\r\nif (!cpu_ops[cpu]) {\r\npr_warn("%s: unsupported enable-method property: %s\n",\r\ndn->full_name, enable_method);\r\nreturn -EOPNOTSUPP;\r\n}\r\nreturn 0;\r\n}\r\nvoid __init cpu_read_bootcpu_ops(void)\r\n{\r\nstruct device_node *dn = of_get_cpu_node(0, NULL);\r\nif (!dn) {\r\npr_err("Failed to find device node for boot cpu\n");\r\nreturn;\r\n}\r\ncpu_read_ops(dn, 0);\r\n}
