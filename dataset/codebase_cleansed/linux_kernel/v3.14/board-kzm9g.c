static int usbhs_get_vbus(struct platform_device *pdev)\r\n{\r\nstruct usbhs_private *priv = usbhs_get_priv(pdev);\r\nreturn !((1 << 7) & __raw_readw(priv->cr2));\r\n}\r\nstatic int usbhs_phy_reset(struct platform_device *pdev)\r\n{\r\nstruct usbhs_private *priv = usbhs_get_priv(pdev);\r\n__raw_writew(0x8a0a, priv->cr2);\r\nreturn 0;\r\n}\r\nstatic int usbhs_get_id(struct platform_device *pdev)\r\n{\r\nreturn USBHS_GADGET;\r\n}\r\nstatic irqreturn_t usbhs_interrupt(int irq, void *data)\r\n{\r\nstruct platform_device *pdev = data;\r\nstruct usbhs_private *priv = usbhs_get_priv(pdev);\r\nrenesas_usbhs_call_notify_hotplug(pdev);\r\n__raw_writew(__raw_readw(priv->phy) | USB_PHY_INT_CLR, priv->phy);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic int usbhs_hardware_init(struct platform_device *pdev)\r\n{\r\nstruct usbhs_private *priv = usbhs_get_priv(pdev);\r\nint ret;\r\n__raw_writew(USB_PHY_MODE | USB_PHY_INT_CLR, priv->phy);\r\nret = request_irq(IRQ15, usbhs_interrupt, IRQF_TRIGGER_HIGH,\r\ndev_name(&pdev->dev), pdev);\r\nif (ret) {\r\ndev_err(&pdev->dev, "request_irq err\n");\r\nreturn ret;\r\n}\r\n__raw_writew(USB_PHY_MODE | USB_PHY_INT_EN, priv->phy);\r\nreturn 0;\r\n}\r\nstatic int usbhs_hardware_exit(struct platform_device *pdev)\r\n{\r\nstruct usbhs_private *priv = usbhs_get_priv(pdev);\r\n__raw_writew(USB_PHY_MODE | USB_PHY_INT_CLR, priv->phy);\r\nfree_irq(IRQ15, pdev);\r\nreturn 0;\r\n}\r\nstatic void __init kzm_init(void)\r\n{\r\nregulator_register_always_on(2, "fixed-1.8V", fixed1v8_power_consumers,\r\nARRAY_SIZE(fixed1v8_power_consumers), 1800000);\r\nregulator_register_fixed(3, dummy_supplies, ARRAY_SIZE(dummy_supplies));\r\npinctrl_register_mappings(kzm_pinctrl_map, ARRAY_SIZE(kzm_pinctrl_map));\r\nsh73a0_pinmux_init();\r\ngpio_request_one(224, GPIOF_IN, NULL);\r\ngpio_request_one(222, GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_request_one(226, GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_request_one(223, GPIOF_IN, NULL);\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_init(IOMEM(0xf0100000), 0x40460000, 0x82000fff);\r\n#endif\r\ni2c_register_board_info(0, i2c0_devices, ARRAY_SIZE(i2c0_devices));\r\ni2c_register_board_info(1, i2c1_devices, ARRAY_SIZE(i2c1_devices));\r\ni2c_register_board_info(3, i2c3_devices, ARRAY_SIZE(i2c3_devices));\r\nsh73a0_add_standard_devices();\r\nplatform_add_devices(kzm_devices, ARRAY_SIZE(kzm_devices));\r\nsh73a0_pm_init();\r\n}\r\nstatic void kzm9g_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\n#define RESCNT2 IOMEM(0xe6188020)\r\nwritel((1 << 31), RESCNT2);\r\n}
