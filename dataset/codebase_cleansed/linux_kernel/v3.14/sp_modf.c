ieee754sp ieee754sp_modf(ieee754sp x, ieee754sp *ip)\r\n{\r\nCOMPXSP;\r\nCLEARCX;\r\nEXPLODEXSP;\r\nswitch (xc) {\r\ncase IEEE754_CLASS_SNAN:\r\ncase IEEE754_CLASS_QNAN:\r\ncase IEEE754_CLASS_INF:\r\ncase IEEE754_CLASS_ZERO:\r\n*ip = x;\r\nreturn x;\r\ncase IEEE754_CLASS_DNORM:\r\n*ip = ieee754sp_zero(xs);\r\nreturn x;\r\ncase IEEE754_CLASS_NORM:\r\nbreak;\r\n}\r\nif (xe < 0) {\r\n*ip = ieee754sp_zero(xs);\r\nreturn x;\r\n}\r\nif (xe >= SP_MBITS) {\r\n*ip = x;\r\nreturn ieee754sp_zero(xs);\r\n}\r\n*ip = buildsp(xs, xe + SP_EBIAS,\r\n((xm >> (SP_MBITS - xe)) << (SP_MBITS - xe)) &\r\n~SP_HIDDEN_BIT);\r\nxm = (xm << (32 - (SP_MBITS - xe))) >> (32 - (SP_MBITS - xe));\r\nif (xm == 0)\r\nreturn ieee754sp_zero(xs);\r\nwhile ((xm >> SP_MBITS) == 0) {\r\nxm <<= 1;\r\nxe--;\r\n}\r\nreturn buildsp(xs, xe + SP_EBIAS, xm & ~SP_HIDDEN_BIT);\r\n}
