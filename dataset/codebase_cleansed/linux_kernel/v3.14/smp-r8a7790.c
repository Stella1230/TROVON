static void __init r8a7790_smp_prepare_cpus(unsigned int max_cpus)\r\n{\r\nvoid __iomem *p;\r\nu32 bar;\r\nshmobile_smp_apmu_prepare_cpus(max_cpus);\r\np = ioremap_nocache(MERAM, shmobile_boot_size);\r\nmemcpy_toio(p, shmobile_boot_vector, shmobile_boot_size);\r\niounmap(p);\r\np = ioremap_nocache(RST, 0x63);\r\nbar = (MERAM >> 8) & 0xfffffc00;\r\nwritel_relaxed(bar, p + CA15BAR);\r\nwritel_relaxed(bar, p + CA7BAR);\r\nwritel_relaxed(bar | 0x10, p + CA15BAR);\r\nwritel_relaxed(bar | 0x10, p + CA7BAR);\r\nwritel_relaxed((readl_relaxed(p + CA15RESCNT) & ~0x0f) | 0xa5a50000,\r\np + CA15RESCNT);\r\nwritel_relaxed((readl_relaxed(p + CA7RESCNT) & ~0x0f) | 0x5a5a0000,\r\np + CA7RESCNT);\r\niounmap(p);\r\n}
