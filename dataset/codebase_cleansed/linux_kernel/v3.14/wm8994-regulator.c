static int wm8994_ldo2_list_voltage(struct regulator_dev *rdev,\r\nunsigned int selector)\r\n{\r\nstruct wm8994_ldo *ldo = rdev_get_drvdata(rdev);\r\nif (selector > WM8994_LDO2_MAX_SELECTOR)\r\nreturn -EINVAL;\r\nswitch (ldo->wm8994->type) {\r\ncase WM8994:\r\nreturn (selector * 100000) + 900000;\r\ncase WM8958:\r\nreturn (selector * 100000) + 1000000;\r\ncase WM1811:\r\nswitch (selector) {\r\ncase 0:\r\nreturn -EINVAL;\r\ndefault:\r\nreturn (selector * 100000) + 950000;\r\n}\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n}\r\nstatic int wm8994_ldo_probe(struct platform_device *pdev)\r\n{\r\nstruct wm8994 *wm8994 = dev_get_drvdata(pdev->dev.parent);\r\nstruct wm8994_pdata *pdata = dev_get_platdata(wm8994->dev);\r\nint id = pdev->id % ARRAY_SIZE(pdata->ldo);\r\nstruct regulator_config config = { };\r\nstruct wm8994_ldo *ldo;\r\nint ret;\r\ndev_dbg(&pdev->dev, "Probing LDO%d\n", id + 1);\r\nldo = devm_kzalloc(&pdev->dev, sizeof(struct wm8994_ldo), GFP_KERNEL);\r\nif (ldo == NULL) {\r\ndev_err(&pdev->dev, "Unable to allocate private data\n");\r\nreturn -ENOMEM;\r\n}\r\nldo->wm8994 = wm8994;\r\nldo->supply = wm8994_ldo_consumer[id];\r\nldo->supply.dev_name = dev_name(wm8994->dev);\r\nconfig.dev = wm8994->dev;\r\nconfig.driver_data = ldo;\r\nconfig.regmap = wm8994->regmap;\r\nconfig.init_data = &ldo->init_data;\r\nif (pdata)\r\nconfig.ena_gpio = pdata->ldo[id].enable;\r\nelse if (wm8994->dev->of_node)\r\nconfig.ena_gpio = wm8994->pdata.ldo[id].enable;\r\nif (!pdata || !pdata->ldo[id].init_data || wm8994->dev->of_node) {\r\ndev_dbg(wm8994->dev, "Using default init data, supply %s %s\n",\r\nldo->supply.dev_name, ldo->supply.supply);\r\nldo->init_data = wm8994_ldo_default[id];\r\nldo->init_data.consumer_supplies = &ldo->supply;\r\nif (!config.ena_gpio)\r\nldo->init_data.constraints.valid_ops_mask = 0;\r\n} else {\r\nldo->init_data = *pdata->ldo[id].init_data;\r\n}\r\nldo->regulator = devm_regulator_register(&pdev->dev,\r\n&wm8994_ldo_desc[id],\r\n&config);\r\nif (IS_ERR(ldo->regulator)) {\r\nret = PTR_ERR(ldo->regulator);\r\ndev_err(wm8994->dev, "Failed to register LDO%d: %d\n",\r\nid + 1, ret);\r\ngoto err;\r\n}\r\nplatform_set_drvdata(pdev, ldo);\r\nreturn 0;\r\nerr:\r\nreturn ret;\r\n}
