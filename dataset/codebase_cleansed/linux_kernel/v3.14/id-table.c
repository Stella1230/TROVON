void wimax_id_table_add(struct wimax_dev *wimax_dev)\r\n{\r\nd_fnstart(3, NULL, "(wimax_dev %p)\n", wimax_dev);\r\nspin_lock(&wimax_id_table_lock);\r\nlist_add(&wimax_dev->id_table_node, &wimax_id_table);\r\nspin_unlock(&wimax_id_table_lock);\r\nd_fnend(3, NULL, "(wimax_dev %p)\n", wimax_dev);\r\n}\r\nstruct wimax_dev *wimax_dev_get_by_genl_info(\r\nstruct genl_info *info, int ifindex)\r\n{\r\nstruct wimax_dev *wimax_dev = NULL;\r\nd_fnstart(3, NULL, "(info %p ifindex %d)\n", info, ifindex);\r\nspin_lock(&wimax_id_table_lock);\r\nlist_for_each_entry(wimax_dev, &wimax_id_table, id_table_node) {\r\nif (wimax_dev->net_dev->ifindex == ifindex) {\r\ndev_hold(wimax_dev->net_dev);\r\ngoto found;\r\n}\r\n}\r\nwimax_dev = NULL;\r\nd_printf(1, NULL, "wimax: no devices found with ifindex %d\n",\r\nifindex);\r\nfound:\r\nspin_unlock(&wimax_id_table_lock);\r\nd_fnend(3, NULL, "(info %p ifindex %d) = %p\n",\r\ninfo, ifindex, wimax_dev);\r\nreturn wimax_dev;\r\n}\r\nvoid wimax_id_table_rm(struct wimax_dev *wimax_dev)\r\n{\r\nspin_lock(&wimax_id_table_lock);\r\nlist_del_init(&wimax_dev->id_table_node);\r\nspin_unlock(&wimax_id_table_lock);\r\n}\r\nvoid wimax_id_table_release(void)\r\n{\r\nstruct wimax_dev *wimax_dev;\r\n#ifndef CONFIG_BUG\r\nreturn;\r\n#endif\r\nspin_lock(&wimax_id_table_lock);\r\nlist_for_each_entry(wimax_dev, &wimax_id_table, id_table_node) {\r\nprintk(KERN_ERR "BUG: %s wimax_dev %p ifindex %d not cleared\n",\r\n__func__, wimax_dev, wimax_dev->net_dev->ifindex);\r\nWARN_ON(1);\r\n}\r\nspin_unlock(&wimax_id_table_lock);\r\n}
