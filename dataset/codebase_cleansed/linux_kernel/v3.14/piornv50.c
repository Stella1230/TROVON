static struct nouveau_i2c_port *\r\nnv50_pior_dp_find(struct nouveau_disp *disp, struct dcb_output *outp)\r\n{\r\nstruct nouveau_i2c *i2c = nouveau_i2c(disp);\r\nreturn i2c->find_type(i2c, NV_I2C_TYPE_EXTAUX(outp->extdev));\r\n}\r\nstatic int\r\nnv50_pior_dp_pattern(struct nouveau_disp *disp, struct dcb_output *outp,\r\nint head, int pattern)\r\n{\r\nstruct nouveau_i2c_port *port;\r\nint ret = -EINVAL;\r\nport = nv50_pior_dp_find(disp, outp);\r\nif (port) {\r\nif (port->func->pattern)\r\nret = port->func->pattern(port, pattern);\r\nelse\r\nret = 0;\r\n}\r\nreturn ret;\r\n}\r\nstatic int\r\nnv50_pior_dp_lnk_ctl(struct nouveau_disp *disp, struct dcb_output *outp,\r\nint head, int lane_nr, int link_bw, bool enh)\r\n{\r\nstruct nouveau_i2c_port *port;\r\nint ret = -EINVAL;\r\nport = nv50_pior_dp_find(disp, outp);\r\nif (port && port->func->lnk_ctl)\r\nret = port->func->lnk_ctl(port, lane_nr, link_bw, enh);\r\nreturn ret;\r\n}\r\nstatic int\r\nnv50_pior_dp_drv_ctl(struct nouveau_disp *disp, struct dcb_output *outp,\r\nint head, int lane, int vsw, int pre)\r\n{\r\nstruct nouveau_i2c_port *port;\r\nint ret = -EINVAL;\r\nport = nv50_pior_dp_find(disp, outp);\r\nif (port) {\r\nif (port->func->drv_ctl)\r\nret = port->func->drv_ctl(port, lane, vsw, pre);\r\nelse\r\nret = 0;\r\n}\r\nreturn ret;\r\n}\r\nint\r\nnv50_pior_power(struct nv50_disp_priv *priv, int or, u32 data)\r\n{\r\nconst u32 stat = data & NV50_DISP_PIOR_PWR_STATE;\r\nconst u32 soff = (or * 0x800);\r\nnv_wait(priv, 0x61e004 + soff, 0x80000000, 0x00000000);\r\nnv_mask(priv, 0x61e004 + soff, 0x80000101, 0x80000000 | stat);\r\nnv_wait(priv, 0x61e004 + soff, 0x80000000, 0x00000000);\r\nreturn 0;\r\n}\r\nint\r\nnv50_pior_mthd(struct nouveau_object *object, u32 mthd, void *args, u32 size)\r\n{\r\nstruct nv50_disp_priv *priv = (void *)object->engine;\r\nconst u8 type = (mthd & NV50_DISP_PIOR_MTHD_TYPE) >> 12;\r\nconst u8 or = (mthd & NV50_DISP_PIOR_MTHD_OR);\r\nu32 *data = args;\r\nint ret;\r\nif (size < sizeof(u32))\r\nreturn -EINVAL;\r\nmthd &= ~NV50_DISP_PIOR_MTHD_TYPE;\r\nmthd &= ~NV50_DISP_PIOR_MTHD_OR;\r\nswitch (mthd) {\r\ncase NV50_DISP_PIOR_PWR:\r\nret = priv->pior.power(priv, or, data[0]);\r\npriv->pior.type[or] = type;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn ret;\r\n}
