void __list_add(struct list_head *new,\r\nstruct list_head *prev,\r\nstruct list_head *next)\r\n{\r\nWARN(next->prev != prev,\r\n"list_add corruption. next->prev should be "\r\n"prev (%p), but was %p. (next=%p).\n",\r\nprev, next->prev, next);\r\nWARN(prev->next != next,\r\n"list_add corruption. prev->next should be "\r\n"next (%p), but was %p. (prev=%p).\n",\r\nnext, prev->next, prev);\r\nWARN(new == prev || new == next,\r\n"list_add double add: new=%p, prev=%p, next=%p.\n",\r\nnew, prev, next);\r\nnext->prev = new;\r\nnew->next = next;\r\nnew->prev = prev;\r\nprev->next = new;\r\n}\r\nvoid __list_del_entry(struct list_head *entry)\r\n{\r\nstruct list_head *prev, *next;\r\nprev = entry->prev;\r\nnext = entry->next;\r\nif (WARN(next == LIST_POISON1,\r\n"list_del corruption, %p->next is LIST_POISON1 (%p)\n",\r\nentry, LIST_POISON1) ||\r\nWARN(prev == LIST_POISON2,\r\n"list_del corruption, %p->prev is LIST_POISON2 (%p)\n",\r\nentry, LIST_POISON2) ||\r\nWARN(prev->next != entry,\r\n"list_del corruption. prev->next should be %p, "\r\n"but was %p\n", entry, prev->next) ||\r\nWARN(next->prev != entry,\r\n"list_del corruption. next->prev should be %p, "\r\n"but was %p\n", entry, next->prev))\r\nreturn;\r\n__list_del(prev, next);\r\n}\r\nvoid list_del(struct list_head *entry)\r\n{\r\n__list_del_entry(entry);\r\nentry->next = LIST_POISON1;\r\nentry->prev = LIST_POISON2;\r\n}\r\nvoid __list_add_rcu(struct list_head *new,\r\nstruct list_head *prev, struct list_head *next)\r\n{\r\nWARN(next->prev != prev,\r\n"list_add_rcu corruption. next->prev should be prev (%p), but was %p. (next=%p).\n",\r\nprev, next->prev, next);\r\nWARN(prev->next != next,\r\n"list_add_rcu corruption. prev->next should be next (%p), but was %p. (prev=%p).\n",\r\nnext, prev->next, prev);\r\nnew->next = next;\r\nnew->prev = prev;\r\nrcu_assign_pointer(list_next_rcu(prev), new);\r\nnext->prev = new;\r\n}
