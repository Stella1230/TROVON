int smp_call_function_single(int cpu, void (*func) (void *info), void *info,\r\nint wait)\r\n{\r\nunsigned long flags;\r\nWARN_ON(cpu != 0);\r\nlocal_irq_save(flags);\r\nfunc(info);\r\nlocal_irq_restore(flags);\r\nreturn 0;\r\n}\r\nvoid __smp_call_function_single(int cpu, struct call_single_data *csd,\r\nint wait)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\ncsd->func(csd->info);\r\nlocal_irq_restore(flags);\r\n}\r\nint on_each_cpu(smp_call_func_t func, void *info, int wait)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nfunc(info);\r\nlocal_irq_restore(flags);\r\nreturn 0;\r\n}\r\nvoid on_each_cpu_mask(const struct cpumask *mask,\r\nsmp_call_func_t func, void *info, bool wait)\r\n{\r\nunsigned long flags;\r\nif (cpumask_test_cpu(0, mask)) {\r\nlocal_irq_save(flags);\r\nfunc(info);\r\nlocal_irq_restore(flags);\r\n}\r\n}\r\nvoid on_each_cpu_cond(bool (*cond_func)(int cpu, void *info),\r\nsmp_call_func_t func, void *info, bool wait,\r\ngfp_t gfp_flags)\r\n{\r\nunsigned long flags;\r\npreempt_disable();\r\nif (cond_func(0, info)) {\r\nlocal_irq_save(flags);\r\nfunc(info);\r\nlocal_irq_restore(flags);\r\n}\r\npreempt_enable();\r\n}
