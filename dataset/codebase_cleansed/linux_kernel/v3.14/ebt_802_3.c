static bool\r\nebt_802_3_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nconst struct ebt_802_3_info *info = par->matchinfo;\r\nconst struct ebt_802_3_hdr *hdr = ebt_802_3_hdr(skb);\r\n__be16 type = hdr->llc.ui.ctrl & IS_UI ? hdr->llc.ui.type : hdr->llc.ni.type;\r\nif (info->bitmask & EBT_802_3_SAP) {\r\nif (FWINV(info->sap != hdr->llc.ui.ssap, EBT_802_3_SAP))\r\nreturn false;\r\nif (FWINV(info->sap != hdr->llc.ui.dsap, EBT_802_3_SAP))\r\nreturn false;\r\n}\r\nif (info->bitmask & EBT_802_3_TYPE) {\r\nif (!(hdr->llc.ui.dsap == CHECK_TYPE && hdr->llc.ui.ssap == CHECK_TYPE))\r\nreturn false;\r\nif (FWINV(info->type != type, EBT_802_3_TYPE))\r\nreturn false;\r\n}\r\nreturn true;\r\n}\r\nstatic int ebt_802_3_mt_check(const struct xt_mtchk_param *par)\r\n{\r\nconst struct ebt_802_3_info *info = par->matchinfo;\r\nif (info->bitmask & ~EBT_802_3_MASK || info->invflags & ~EBT_802_3_MASK)\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic int __init ebt_802_3_init(void)\r\n{\r\nreturn xt_register_match(&ebt_802_3_mt_reg);\r\n}\r\nstatic void __exit ebt_802_3_fini(void)\r\n{\r\nxt_unregister_match(&ebt_802_3_mt_reg);\r\n}
