static void rtl92c_init_aspm_vars(struct ieee80211_hw *hw)\r\n{\r\nstruct rtl_pci *rtlpci = rtl_pcidev(rtl_pcipriv(hw));\r\nrtlpci->const_amdpci_aspm = 0;\r\nrtlpci->const_pci_aspm = 3;\r\nrtlpci->const_devicepci_aspm_setting = 0x03;\r\nrtlpci->const_hostpci_aspm_setting = 0x02;\r\nrtlpci->const_hwsw_rfoff_d3 = 0;\r\nrtlpci->const_support_pciaspm = 1;\r\n}\r\nint rtl92c_init_sw_vars(struct ieee80211_hw *hw)\r\n{\r\nint err;\r\nstruct rtl_priv *rtlpriv = rtl_priv(hw);\r\nstruct rtl_pci *rtlpci = rtl_pcidev(rtl_pcipriv(hw));\r\nstruct rtl_hal *rtlhal = rtl_hal(rtl_priv(hw));\r\nrtl8192ce_bt_reg_init(hw);\r\nrtlpriv->dm.dm_initialgain_enable = true;\r\nrtlpriv->dm.dm_flag = 0;\r\nrtlpriv->dm.disable_framebursting = false;\r\nrtlpriv->dm.thermalvalue = 0;\r\nrtlpci->transmit_config = CFENDFORM | BIT(12) | BIT(13);\r\nrtlpriv->rtlhal.current_bandtype = BAND_ON_2_4G;\r\nrtlpriv->rtlhal.bandset = BAND_ON_2_4G;\r\nrtlpriv->rtlhal.macphymode = SINGLEMAC_SINGLEPHY;\r\nrtlpci->receive_config = (RCR_APPFCS |\r\nRCR_AMF |\r\nRCR_ADF |\r\nRCR_APP_MIC |\r\nRCR_APP_ICV |\r\nRCR_AICV |\r\nRCR_ACRC32 |\r\nRCR_AB |\r\nRCR_AM |\r\nRCR_APM |\r\nRCR_APP_PHYST_RXFF | RCR_HTC_LOC_CTRL | 0);\r\nrtlpci->irq_mask[0] =\r\n(u32) (IMR_ROK |\r\nIMR_VODOK |\r\nIMR_VIDOK |\r\nIMR_BEDOK |\r\nIMR_BKDOK |\r\nIMR_MGNTDOK |\r\nIMR_HIGHDOK | IMR_BDOK | IMR_RDU | IMR_RXFOVW | 0);\r\nrtlpci->irq_mask[1] = (u32) (IMR_CPWM | IMR_C2HCMD | 0);\r\nrtlpriv->dbg.global_debuglevel = rtlpriv->cfg->mod_params->debug;\r\nrtlpriv->psc.inactiveps = rtlpriv->cfg->mod_params->inactiveps;\r\nrtlpriv->psc.swctrl_lps = rtlpriv->cfg->mod_params->swctrl_lps;\r\nrtlpriv->psc.fwctrl_lps = rtlpriv->cfg->mod_params->fwctrl_lps;\r\nif (!rtlpriv->psc.inactiveps)\r\npr_info("rtl8192ce: Power Save off (module option)\n");\r\nif (!rtlpriv->psc.fwctrl_lps)\r\npr_info("rtl8192ce: FW Power Save off (module option)\n");\r\nrtlpriv->psc.reg_fwctrl_lps = 3;\r\nrtlpriv->psc.reg_max_lps_awakeintvl = 5;\r\nrtl92c_init_aspm_vars(hw);\r\nif (rtlpriv->psc.reg_fwctrl_lps == 1)\r\nrtlpriv->psc.fwctrl_psmode = FW_PS_MIN_MODE;\r\nelse if (rtlpriv->psc.reg_fwctrl_lps == 2)\r\nrtlpriv->psc.fwctrl_psmode = FW_PS_MAX_MODE;\r\nelse if (rtlpriv->psc.reg_fwctrl_lps == 3)\r\nrtlpriv->psc.fwctrl_psmode = FW_PS_DTIM_MODE;\r\nrtlpriv->rtlhal.pfirmware = vzalloc(0x4000);\r\nif (!rtlpriv->rtlhal.pfirmware) {\r\nRT_TRACE(rtlpriv, COMP_ERR, DBG_EMERG,\r\n"Can't alloc buffer for fw\n");\r\nreturn 1;\r\n}\r\nif (IS_VENDOR_UMC_A_CUT(rtlhal->version) &&\r\n!IS_92C_SERIAL(rtlhal->version))\r\nrtlpriv->cfg->fw_name = "rtlwifi/rtl8192cfwU.bin";\r\nelse if (IS_81xxC_VENDOR_UMC_B_CUT(rtlhal->version))\r\nrtlpriv->cfg->fw_name = "rtlwifi/rtl8192cfwU_B.bin";\r\nrtlpriv->max_fw_size = 0x4000;\r\npr_info("Using firmware %s\n", rtlpriv->cfg->fw_name);\r\nerr = request_firmware_nowait(THIS_MODULE, 1, rtlpriv->cfg->fw_name,\r\nrtlpriv->io.dev, GFP_KERNEL, hw,\r\nrtl_fw_cb);\r\nif (err) {\r\nRT_TRACE(rtlpriv, COMP_ERR, DBG_EMERG,\r\n"Failed to request firmware!\n");\r\nreturn 1;\r\n}\r\nreturn 0;\r\n}\r\nvoid rtl92c_deinit_sw_vars(struct ieee80211_hw *hw)\r\n{\r\nstruct rtl_priv *rtlpriv = rtl_priv(hw);\r\nif (rtlpriv->rtlhal.pfirmware) {\r\nvfree(rtlpriv->rtlhal.pfirmware);\r\nrtlpriv->rtlhal.pfirmware = NULL;\r\n}\r\n}
