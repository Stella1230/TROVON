static int clk_pll_prepare(struct clk_hw *hw)\r\n{\r\nstruct clk_pll *pll = to_clk_pll(hw);\r\nwritel_relaxed(1 << pll->power, pll->base + SET);\r\nudelay(10);\r\nreturn 0;\r\n}\r\nstatic void clk_pll_unprepare(struct clk_hw *hw)\r\n{\r\nstruct clk_pll *pll = to_clk_pll(hw);\r\nwritel_relaxed(1 << pll->power, pll->base + CLR);\r\n}\r\nstatic int clk_pll_enable(struct clk_hw *hw)\r\n{\r\nstruct clk_pll *pll = to_clk_pll(hw);\r\nwritel_relaxed(1 << 31, pll->base + CLR);\r\nreturn 0;\r\n}\r\nstatic void clk_pll_disable(struct clk_hw *hw)\r\n{\r\nstruct clk_pll *pll = to_clk_pll(hw);\r\nwritel_relaxed(1 << 31, pll->base + SET);\r\n}\r\nstatic unsigned long clk_pll_recalc_rate(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nstruct clk_pll *pll = to_clk_pll(hw);\r\nreturn pll->rate;\r\n}\r\nstruct clk *mxs_clk_pll(const char *name, const char *parent_name,\r\nvoid __iomem *base, u8 power, unsigned long rate)\r\n{\r\nstruct clk_pll *pll;\r\nstruct clk *clk;\r\nstruct clk_init_data init;\r\npll = kzalloc(sizeof(*pll), GFP_KERNEL);\r\nif (!pll)\r\nreturn ERR_PTR(-ENOMEM);\r\ninit.name = name;\r\ninit.ops = &clk_pll_ops;\r\ninit.flags = 0;\r\ninit.parent_names = (parent_name ? &parent_name: NULL);\r\ninit.num_parents = (parent_name ? 1 : 0);\r\npll->base = base;\r\npll->rate = rate;\r\npll->power = power;\r\npll->hw.init = &init;\r\nclk = clk_register(NULL, &pll->hw);\r\nif (IS_ERR(clk))\r\nkfree(pll);\r\nreturn clk;\r\n}
