static int nand_dev_ready(struct mtd_info *mtd)\r\n{\r\nreturn gpio_get_value(H3_NAND_RB_GPIO_PIN);\r\n}\r\nstatic void __init h3_init_smc91x(void)\r\n{\r\nomap_cfg_reg(W15_1710_GPIO40);\r\nif (gpio_request(40, "SMC91x irq") < 0) {\r\nprintk("Error requesting gpio 40 for smc91x irq\n");\r\nreturn;\r\n}\r\n}\r\nstatic void __init h3_init(void)\r\n{\r\nh3_init_smc91x();\r\nnor_resource.end = nor_resource.start = omap_cs3_phys();\r\nnor_resource.end += SZ_32M - 1;\r\nnand_resource.end = nand_resource.start = OMAP_CS2B_PHYS;\r\nnand_resource.end += SZ_4K - 1;\r\nBUG_ON(gpio_request(H3_NAND_RB_GPIO_PIN, "NAND ready") < 0);\r\ngpio_direction_input(H3_NAND_RB_GPIO_PIN);\r\nomap_cfg_reg(V2_1710_GPIO10);\r\nomap_cfg_reg(F18_1610_KBC0);\r\nomap_cfg_reg(D20_1610_KBC1);\r\nomap_cfg_reg(D19_1610_KBC2);\r\nomap_cfg_reg(E18_1610_KBC3);\r\nomap_cfg_reg(C21_1610_KBC4);\r\nomap_cfg_reg(G18_1610_KBR0);\r\nomap_cfg_reg(F19_1610_KBR1);\r\nomap_cfg_reg(H14_1610_KBR2);\r\nomap_cfg_reg(E20_1610_KBR3);\r\nomap_cfg_reg(E19_1610_KBR4);\r\nomap_cfg_reg(N19_1610_KBR5);\r\nomap_cfg_reg(P18_1610_GPIO3);\r\nomap_cfg_reg(MPUIO4);\r\nsmc91x_resources[1].start = gpio_to_irq(40);\r\nsmc91x_resources[1].end = gpio_to_irq(40);\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\nh3_spi_board_info[0].irq = gpio_to_irq(H3_TS_GPIO);\r\nspi_register_board_info(h3_spi_board_info,\r\nARRAY_SIZE(h3_spi_board_info));\r\nomap_serial_init();\r\nh3_i2c_board_info[1].irq = gpio_to_irq(14);\r\nomap_register_i2c_bus(1, 100, h3_i2c_board_info,\r\nARRAY_SIZE(h3_i2c_board_info));\r\nomap1_usb_init(&h3_usb_config);\r\nh3_mmc_init();\r\nomapfb_set_lcd_config(&h3_lcd_config);\r\n}
