void eeh_sysfs_add_device(struct pci_dev *pdev)\r\n{\r\nstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\r\nint rc=0;\r\nif (edev && (edev->mode & EEH_DEV_SYSFS))\r\nreturn;\r\nrc += device_create_file(&pdev->dev, &dev_attr_eeh_mode);\r\nrc += device_create_file(&pdev->dev, &dev_attr_eeh_config_addr);\r\nrc += device_create_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\r\nif (rc)\r\nprintk(KERN_WARNING "EEH: Unable to create sysfs entries\n");\r\nelse if (edev)\r\nedev->mode |= EEH_DEV_SYSFS;\r\n}\r\nvoid eeh_sysfs_remove_device(struct pci_dev *pdev)\r\n{\r\nstruct eeh_dev *edev = pci_dev_to_eeh_dev(pdev);\r\nif (!pdev->dev.kobj.sd) {\r\nif (edev)\r\nedev->mode &= ~EEH_DEV_SYSFS;\r\nreturn;\r\n}\r\ndevice_remove_file(&pdev->dev, &dev_attr_eeh_mode);\r\ndevice_remove_file(&pdev->dev, &dev_attr_eeh_config_addr);\r\ndevice_remove_file(&pdev->dev, &dev_attr_eeh_pe_config_addr);\r\nif (edev)\r\nedev->mode &= ~EEH_DEV_SYSFS;\r\n}
