static void lookup_ops(struct device *dev, struct abx500_ops **ops)\r\n{\r\nstruct abx500_device_entry *dev_entry;\r\n*ops = NULL;\r\nlist_for_each_entry(dev_entry, &abx500_list, list) {\r\nif (dev_entry->dev == dev) {\r\n*ops = &dev_entry->ops;\r\nreturn;\r\n}\r\n}\r\n}\r\nint abx500_register_ops(struct device *dev, struct abx500_ops *ops)\r\n{\r\nstruct abx500_device_entry *dev_entry;\r\ndev_entry = devm_kzalloc(dev,\r\nsizeof(struct abx500_device_entry),\r\nGFP_KERNEL);\r\nif (!dev_entry) {\r\ndev_err(dev, "register_ops kzalloc failed");\r\nreturn -ENOMEM;\r\n}\r\ndev_entry->dev = dev;\r\nmemcpy(&dev_entry->ops, ops, sizeof(struct abx500_ops));\r\nlist_add_tail(&dev_entry->list, &abx500_list);\r\nreturn 0;\r\n}\r\nvoid abx500_remove_ops(struct device *dev)\r\n{\r\nstruct abx500_device_entry *dev_entry, *tmp;\r\nlist_for_each_entry_safe(dev_entry, tmp, &abx500_list, list)\r\nif (dev_entry->dev == dev)\r\nlist_del(&dev_entry->list);\r\n}\r\nint abx500_set_register_interruptible(struct device *dev, u8 bank, u8 reg,\r\nu8 value)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->set_register != NULL))\r\nreturn ops->set_register(dev, bank, reg, value);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_get_register_interruptible(struct device *dev, u8 bank, u8 reg,\r\nu8 *value)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->get_register != NULL))\r\nreturn ops->get_register(dev, bank, reg, value);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_get_register_page_interruptible(struct device *dev, u8 bank,\r\nu8 first_reg, u8 *regvals, u8 numregs)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->get_register_page != NULL))\r\nreturn ops->get_register_page(dev, bank,\r\nfirst_reg, regvals, numregs);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_mask_and_set_register_interruptible(struct device *dev, u8 bank,\r\nu8 reg, u8 bitmask, u8 bitvalues)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->mask_and_set_register != NULL))\r\nreturn ops->mask_and_set_register(dev, bank,\r\nreg, bitmask, bitvalues);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_get_chip_id(struct device *dev)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->get_chip_id != NULL))\r\nreturn ops->get_chip_id(dev);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_event_registers_startup_state_get(struct device *dev, u8 *event)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->event_registers_startup_state_get != NULL))\r\nreturn ops->event_registers_startup_state_get(dev, event);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nint abx500_startup_irq_enabled(struct device *dev, unsigned int irq)\r\n{\r\nstruct abx500_ops *ops;\r\nlookup_ops(dev->parent, &ops);\r\nif ((ops != NULL) && (ops->startup_irq_enabled != NULL))\r\nreturn ops->startup_irq_enabled(dev, irq);\r\nelse\r\nreturn -ENOTSUPP;\r\n}\r\nvoid abx500_dump_all_banks(void)\r\n{\r\nstruct abx500_ops *ops;\r\nstruct device dummy_child = {NULL};\r\nstruct abx500_device_entry *dev_entry;\r\nlist_for_each_entry(dev_entry, &abx500_list, list) {\r\ndummy_child.parent = dev_entry->dev;\r\nops = &dev_entry->ops;\r\nif ((ops != NULL) && (ops->dump_all_banks != NULL))\r\nops->dump_all_banks(&dummy_child);\r\n}\r\n}
