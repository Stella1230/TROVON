static __u8 *huion_report_fixup(struct hid_device *hdev, __u8 *rdesc,\r\nunsigned int *rsize)\r\n{\r\nswitch (hdev->product) {\r\ncase USB_DEVICE_ID_HUION_580:\r\nif (*rsize == HUION_580_RDESC_ORIG_SIZE) {\r\nrdesc = huion_580_rdesc_fixed;\r\n*rsize = sizeof(huion_580_rdesc_fixed);\r\n}\r\nbreak;\r\n}\r\nreturn rdesc;\r\n}\r\nstatic int huion_tablet_enable(struct hid_device *hdev)\r\n{\r\nint rc;\r\nchar buf[22];\r\nrc = usb_string(hid_to_usb_dev(hdev), 0x64, buf, sizeof(buf));\r\nif (rc < 0)\r\nreturn rc;\r\nreturn 0;\r\n}\r\nstatic int huion_probe(struct hid_device *hdev, const struct hid_device_id *id)\r\n{\r\nint ret;\r\nstruct usb_interface *intf = to_usb_interface(hdev->dev.parent);\r\nswitch (id->product) {\r\ncase USB_DEVICE_ID_HUION_580:\r\nif (intf->cur_altsetting->desc.bInterfaceNumber != 0x00)\r\nreturn -ENODEV;\r\nbreak;\r\n}\r\nret = hid_parse(hdev);\r\nif (ret) {\r\nhid_err(hdev, "parse failed\n");\r\ngoto err;\r\n}\r\nret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\r\nif (ret) {\r\nhid_err(hdev, "hw start failed\n");\r\ngoto err;\r\n}\r\nswitch (id->product) {\r\ncase USB_DEVICE_ID_HUION_580:\r\nret = huion_tablet_enable(hdev);\r\nif (ret) {\r\nhid_err(hdev, "tablet enabling failed\n");\r\ngoto enabling_err;\r\n}\r\nbreak;\r\n}\r\nreturn 0;\r\nenabling_err:\r\nhid_hw_stop(hdev);\r\nerr:\r\nreturn ret;\r\n}\r\nstatic int huion_raw_event(struct hid_device *hdev, struct hid_report *report,\r\nu8 *data, int size)\r\n{\r\nif (report->type == HID_INPUT_REPORT && report->id == 0x07 && size >= 2)\r\ndata[1] ^= 0x40;\r\nreturn 0;\r\n}
