static int __init imx_fb_helper_init(void)\r\n{\r\nstruct drm_device *drm = imx_drm_device_get();\r\nif (!drm)\r\nreturn -EINVAL;\r\nif (legacyfb_depth != 16 && legacyfb_depth != 32) {\r\npr_warn("i.MX legacyfb: invalid legacyfb_depth setting. defaulting to 16bpp\n");\r\nlegacyfb_depth = 16;\r\n}\r\nfbdev_cma = drm_fbdev_cma_init(drm, legacyfb_depth,\r\ndrm->mode_config.num_crtc, MAX_CONNECTOR);\r\nif (IS_ERR(fbdev_cma)) {\r\nimx_drm_device_put();\r\nreturn PTR_ERR(fbdev_cma);\r\n}\r\nimx_drm_fb_helper_set(fbdev_cma);\r\nreturn 0;\r\n}\r\nstatic void __exit imx_fb_helper_exit(void)\r\n{\r\nimx_drm_fb_helper_set(NULL);\r\ndrm_fbdev_cma_fini(fbdev_cma);\r\nimx_drm_device_put();\r\n}
