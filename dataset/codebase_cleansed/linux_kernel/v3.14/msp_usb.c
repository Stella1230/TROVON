static int __init msp_usb_setup(void)\r\n{\r\nchar *strp;\r\nchar envstr[32];\r\nstruct platform_device *msp_devs[NUM_USB_DEVS];\r\nunsigned int val;\r\nsnprintf((char *)&envstr[0], sizeof(envstr), "usbmode");\r\nval = 1;\r\nstrp = prom_getenv((char *)&envstr[0]);\r\nif (strp) {\r\nif (!strcmp(strp, "device"))\r\nval = 0;\r\n}\r\nif (val) {\r\n#if defined(CONFIG_USB_EHCI_HCD)\r\nmsp_devs[0] = &msp_usbhost0_device.dev;\r\nppfinit("platform add USB HOST done %s.\n", msp_devs[0]->name);\r\n#ifdef CONFIG_MSP_HAS_DUAL_USB\r\nmsp_devs[1] = &msp_usbhost1_device.dev;\r\nppfinit("platform add USB HOST done %s.\n", msp_devs[1]->name);\r\n#endif\r\n#else\r\nppfinit("%s: echi_hcd not supported\n", __FILE__);\r\n#endif\r\n} else {\r\n#if defined(CONFIG_USB_GADGET)\r\nmsp_devs[0] = &msp_usbdev0_device.dev;\r\nppfinit("platform add USB DEVICE done %s.\n"\r\n, msp_devs[0]->name);\r\n#ifdef CONFIG_MSP_HAS_DUAL_USB\r\nmsp_devs[1] = &msp_usbdev1_device.dev;\r\nppfinit("platform add USB DEVICE done %s.\n"\r\n, msp_devs[1]->name);\r\n#endif\r\n#else\r\nppfinit("%s: usb_gadget not supported\n", __FILE__);\r\n#endif\r\n}\r\nplatform_add_devices(msp_devs, ARRAY_SIZE(msp_devs));\r\nreturn 0;\r\n}
