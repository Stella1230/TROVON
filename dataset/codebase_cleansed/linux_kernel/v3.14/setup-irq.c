void __weak pcibios_update_irq(struct pci_dev *dev, int irq)\r\n{\r\ndev_dbg(&dev->dev, "assigning IRQ %02d\n", irq);\r\npci_write_config_byte(dev, PCI_INTERRUPT_LINE, irq);\r\n}\r\nstatic void\r\npdev_fixup_irq(struct pci_dev *dev,\r\nu8 (*swizzle)(struct pci_dev *, u8 *),\r\nint (*map_irq)(const struct pci_dev *, u8, u8))\r\n{\r\nu8 pin, slot;\r\nint irq = 0;\r\npci_read_config_byte(dev, PCI_INTERRUPT_PIN, &pin);\r\nif (pin > 4)\r\npin = 1;\r\nif (pin != 0) {\r\nslot = (*swizzle)(dev, &pin);\r\nirq = (*map_irq)(dev, slot, pin);\r\nif (irq == -1)\r\nirq = 0;\r\n}\r\ndev->irq = irq;\r\ndev_dbg(&dev->dev, "fixup irq: got %d\n", dev->irq);\r\npcibios_update_irq(dev, irq);\r\n}\r\nvoid\r\npci_fixup_irqs(u8 (*swizzle)(struct pci_dev *, u8 *),\r\nint (*map_irq)(const struct pci_dev *, u8, u8))\r\n{\r\nstruct pci_dev *dev = NULL;\r\nfor_each_pci_dev(dev)\r\npdev_fixup_irq(dev, swizzle, map_irq);\r\n}
