static int mea_last_char_hash(int count, char *name, int namelen)\r\n{\r\nunsigned int c;\r\nc = name[namelen - 1];\r\nif (c == 0)\r\nCWARN("looks like wrong len is passed\n");\r\nc = c % count;\r\nreturn c;\r\n}\r\nstatic int mea_all_chars_hash(int count, char *name, int namelen)\r\n{\r\nunsigned int c = 0;\r\nwhile (--namelen >= 0)\r\nc += name[namelen];\r\nc = c % count;\r\nreturn c;\r\n}\r\nint raw_name2idx(int hashtype, int count, const char *name, int namelen)\r\n{\r\nunsigned int c = 0;\r\nint idx;\r\nLASSERT(namelen > 0);\r\nif (filename_is_volatile(name, namelen, &idx)) {\r\nif ((idx >= 0) && (idx < count))\r\nreturn idx;\r\ngoto hashchoice;\r\n}\r\nif (count <= 1)\r\nreturn 0;\r\nhashchoice:\r\nswitch (hashtype) {\r\ncase MEA_MAGIC_LAST_CHAR:\r\nc = mea_last_char_hash(count, (char *)name, namelen);\r\nbreak;\r\ncase MEA_MAGIC_ALL_CHARS:\r\nc = mea_all_chars_hash(count, (char *)name, namelen);\r\nbreak;\r\ncase MEA_MAGIC_HASH_SEGMENT:\r\nCERROR("Unsupported hash type MEA_MAGIC_HASH_SEGMENT\n");\r\nbreak;\r\ndefault:\r\nCERROR("Unknown hash type 0x%x\n", hashtype);\r\n}\r\nLASSERT(c < count);\r\nreturn c;\r\n}\r\nint mea_name2idx(struct lmv_stripe_md *mea, const char *name, int namelen)\r\n{\r\nunsigned int c;\r\nLASSERT(mea && mea->mea_count);\r\nc = raw_name2idx(mea->mea_magic, mea->mea_count, name, namelen);\r\nLASSERT(c < mea->mea_count);\r\nreturn c;\r\n}
