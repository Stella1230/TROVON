ieee754sp ieee754sp_mul(ieee754sp x, ieee754sp y)\r\n{\r\nCOMPXSP;\r\nCOMPYSP;\r\nEXPLODEXSP;\r\nEXPLODEYSP;\r\nCLEARCX;\r\nFLUSHXSP;\r\nFLUSHYSP;\r\nswitch (CLPAIR(xc, yc)) {\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_SNAN):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_SNAN, IEEE754_CLASS_INF):\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_nanxcpt(ieee754sp_indef(), "mul", x, y);\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_QNAN):\r\nreturn y;\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_QNAN):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_QNAN, IEEE754_CLASS_INF):\r\nreturn x;\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_INF):\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_xcpt(ieee754sp_indef(), "mul", x, y);\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_INF):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_INF):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_INF, IEEE754_CLASS_INF):\r\nreturn ieee754sp_inf(xs ^ ys);\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_NORM):\r\ncase CLPAIR(IEEE754_CLASS_ZERO, IEEE754_CLASS_DNORM):\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_ZERO):\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_ZERO):\r\nreturn ieee754sp_zero(xs ^ ys);\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_DNORM):\r\nSPDNORMX;\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_DNORM):\r\nSPDNORMY;\r\nbreak;\r\ncase CLPAIR(IEEE754_CLASS_DNORM, IEEE754_CLASS_NORM):\r\nSPDNORMX;\r\nbreak;\r\ncase CLPAIR(IEEE754_CLASS_NORM, IEEE754_CLASS_NORM):\r\nbreak;\r\n}\r\nassert(xm & SP_HIDDEN_BIT);\r\nassert(ym & SP_HIDDEN_BIT);\r\n{\r\nint re = xe + ye;\r\nint rs = xs ^ ys;\r\nunsigned rm;\r\nxm <<= 32 - (SP_MBITS + 1);\r\nym <<= 32 - (SP_MBITS + 1);\r\n{\r\nunsigned short lxm = xm & 0xffff;\r\nunsigned short hxm = xm >> 16;\r\nunsigned short lym = ym & 0xffff;\r\nunsigned short hym = ym >> 16;\r\nunsigned lrm;\r\nunsigned hrm;\r\nlrm = lxm * lym;\r\nhrm = hxm * hym;\r\n{\r\nunsigned t = lxm * hym;\r\n{\r\nunsigned at = lrm + (t << 16);\r\nhrm += at < lrm;\r\nlrm = at;\r\n}\r\nhrm = hrm + (t >> 16);\r\n}\r\n{\r\nunsigned t = hxm * lym;\r\n{\r\nunsigned at = lrm + (t << 16);\r\nhrm += at < lrm;\r\nlrm = at;\r\n}\r\nhrm = hrm + (t >> 16);\r\n}\r\nrm = hrm | (lrm != 0);\r\n}\r\nif ((int) rm < 0) {\r\nrm = (rm >> (32 - (SP_MBITS + 1 + 3))) |\r\n((rm << (SP_MBITS + 1 + 3)) != 0);\r\nre++;\r\n} else {\r\nrm = (rm >> (32 - (SP_MBITS + 1 + 3 + 1))) |\r\n((rm << (SP_MBITS + 1 + 3 + 1)) != 0);\r\n}\r\nassert(rm & (SP_HIDDEN_BIT << 3));\r\nSPNORMRET2(rs, re, rm, "mul", x, y);\r\n}\r\n}
