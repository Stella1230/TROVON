void update_stats(struct stats *stats, u64 val)\r\n{\r\ndouble delta;\r\nstats->n++;\r\ndelta = val - stats->mean;\r\nstats->mean += delta / stats->n;\r\nstats->M2 += delta*(val - stats->mean);\r\nif (val > stats->max)\r\nstats->max = val;\r\nif (val < stats->min)\r\nstats->min = val;\r\n}\r\ndouble avg_stats(struct stats *stats)\r\n{\r\nreturn stats->mean;\r\n}\r\ndouble stddev_stats(struct stats *stats)\r\n{\r\ndouble variance, variance_mean;\r\nif (stats->n < 2)\r\nreturn 0.0;\r\nvariance = stats->M2 / (stats->n - 1);\r\nvariance_mean = variance / stats->n;\r\nreturn sqrt(variance_mean);\r\n}\r\ndouble rel_stddev_stats(double stddev, double avg)\r\n{\r\ndouble pct = 0.0;\r\nif (avg)\r\npct = 100.0 * stddev/avg;\r\nreturn pct;\r\n}
