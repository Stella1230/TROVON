struct pcmcia_device *comedi_to_pcmcia_dev(struct comedi_device *dev)\r\n{\r\nreturn dev->hw_dev ? to_pcmcia_dev(dev->hw_dev) : NULL;\r\n}\r\nstatic int comedi_pcmcia_conf_check(struct pcmcia_device *link,\r\nvoid *priv_data)\r\n{\r\nif (link->config_index == 0)\r\nreturn -EINVAL;\r\nreturn pcmcia_request_io(link);\r\n}\r\nint comedi_pcmcia_enable(struct comedi_device *dev,\r\nint (*conf_check)(struct pcmcia_device *, void *))\r\n{\r\nstruct pcmcia_device *link = comedi_to_pcmcia_dev(dev);\r\nint ret;\r\nif (!link)\r\nreturn -ENODEV;\r\nif (!conf_check)\r\nconf_check = comedi_pcmcia_conf_check;\r\nret = pcmcia_loop_config(link, conf_check, NULL);\r\nif (ret)\r\nreturn ret;\r\nreturn pcmcia_enable_device(link);\r\n}\r\nvoid comedi_pcmcia_disable(struct comedi_device *dev)\r\n{\r\nstruct pcmcia_device *link = comedi_to_pcmcia_dev(dev);\r\nif (link)\r\npcmcia_disable_device(link);\r\n}\r\nint comedi_pcmcia_auto_config(struct pcmcia_device *link,\r\nstruct comedi_driver *driver)\r\n{\r\nreturn comedi_auto_config(&link->dev, driver, 0);\r\n}\r\nvoid comedi_pcmcia_auto_unconfig(struct pcmcia_device *link)\r\n{\r\ncomedi_auto_unconfig(&link->dev);\r\n}\r\nint comedi_pcmcia_driver_register(struct comedi_driver *comedi_driver,\r\nstruct pcmcia_driver *pcmcia_driver)\r\n{\r\nint ret;\r\nret = comedi_driver_register(comedi_driver);\r\nif (ret < 0)\r\nreturn ret;\r\nret = pcmcia_register_driver(pcmcia_driver);\r\nif (ret < 0) {\r\ncomedi_driver_unregister(comedi_driver);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nvoid comedi_pcmcia_driver_unregister(struct comedi_driver *comedi_driver,\r\nstruct pcmcia_driver *pcmcia_driver)\r\n{\r\npcmcia_unregister_driver(pcmcia_driver);\r\ncomedi_driver_unregister(comedi_driver);\r\n}
