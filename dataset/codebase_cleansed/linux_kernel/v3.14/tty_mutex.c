static void __lockfunc tty_lock_nested(struct tty_struct *tty,\r\nunsigned int subclass)\r\n{\r\nif (tty->magic != TTY_MAGIC) {\r\npr_err("L Bad %p\n", tty);\r\nWARN_ON(1);\r\nreturn;\r\n}\r\ntty_kref_get(tty);\r\nmutex_lock_nested(&tty->legacy_mutex, subclass);\r\n}\r\nvoid __lockfunc tty_lock(struct tty_struct *tty)\r\n{\r\nreturn tty_lock_nested(tty, TTY_MUTEX_NORMAL);\r\n}\r\nvoid __lockfunc tty_unlock(struct tty_struct *tty)\r\n{\r\nif (tty->magic != TTY_MAGIC) {\r\npr_err("U Bad %p\n", tty);\r\nWARN_ON(1);\r\nreturn;\r\n}\r\nmutex_unlock(&tty->legacy_mutex);\r\ntty_kref_put(tty);\r\n}\r\nvoid __lockfunc tty_lock_pair(struct tty_struct *tty,\r\nstruct tty_struct *tty2)\r\n{\r\nif (tty < tty2) {\r\ntty_lock(tty);\r\ntty_lock_nested(tty2, TTY_MUTEX_NESTED);\r\n} else {\r\nif (tty2 && tty2 != tty)\r\ntty_lock(tty2);\r\ntty_lock_nested(tty, TTY_MUTEX_NESTED);\r\n}\r\n}\r\nvoid __lockfunc tty_unlock_pair(struct tty_struct *tty,\r\nstruct tty_struct *tty2)\r\n{\r\ntty_unlock(tty);\r\nif (tty2 && tty2 != tty)\r\ntty_unlock(tty2);\r\n}
