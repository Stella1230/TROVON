static void ot200_led_brightness_set(struct led_classdev *led_cdev,\r\nenum led_brightness value)\r\n{\r\nstruct ot200_led *led = container_of(led_cdev, struct ot200_led, cdev);\r\nu8 *val;\r\nunsigned long flags;\r\nspin_lock_irqsave(&value_lock, flags);\r\nif (led->port == 0x49)\r\nval = &leds_front;\r\nelse if (led->port == 0x5a)\r\nval = &leds_back;\r\nelse\r\nBUG();\r\nif (value == LED_OFF)\r\n*val &= ~led->mask;\r\nelse\r\n*val |= led->mask;\r\noutb(*val, led->port);\r\nspin_unlock_irqrestore(&value_lock, flags);\r\n}\r\nstatic int ot200_led_probe(struct platform_device *pdev)\r\n{\r\nint i;\r\nint ret;\r\nfor (i = 0; i < ARRAY_SIZE(leds); i++) {\r\nleds[i].cdev.name = leds[i].name;\r\nleds[i].cdev.brightness_set = ot200_led_brightness_set;\r\nret = led_classdev_register(&pdev->dev, &leds[i].cdev);\r\nif (ret < 0)\r\ngoto err;\r\n}\r\nleds_front = 0;\r\nleds_back = BIT(1);\r\noutb(leds_front, 0x49);\r\noutb(leds_back, 0x5a);\r\nreturn 0;\r\nerr:\r\nfor (i = i - 1; i >= 0; i--)\r\nled_classdev_unregister(&leds[i].cdev);\r\nreturn ret;\r\n}\r\nstatic int ot200_led_remove(struct platform_device *pdev)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(leds); i++)\r\nled_classdev_unregister(&leds[i].cdev);\r\nreturn 0;\r\n}
