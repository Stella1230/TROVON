static int et1011c_config_aneg(struct phy_device *phydev)\r\n{\r\nint ctl = 0;\r\nctl = phy_read(phydev, MII_BMCR);\r\nif (ctl < 0)\r\nreturn ctl;\r\nctl &= ~(BMCR_FULLDPLX | BMCR_SPEED100 | BMCR_SPEED1000 |\r\nBMCR_ANENABLE);\r\nphy_write(phydev, MII_BMCR, ctl | BMCR_RESET);\r\nreturn genphy_config_aneg(phydev);\r\n}\r\nstatic int et1011c_read_status(struct phy_device *phydev)\r\n{\r\nint ret;\r\nu32 val;\r\nstatic int speed;\r\nret = genphy_read_status(phydev);\r\nif (speed != phydev->speed) {\r\nspeed = phydev->speed;\r\nval = phy_read(phydev, ET1011C_STATUS_REG);\r\nif ((val & ET1011C_SPEED_MASK) ==\r\nET1011C_GIGABIT_SPEED) {\r\nval = phy_read(phydev, ET1011C_CONFIG_REG);\r\nval &= ~ET1011C_TX_FIFO_MASK;\r\nphy_write(phydev, ET1011C_CONFIG_REG, val\\r\n| ET1011C_GMII_INTERFACE\\r\n| ET1011C_SYS_CLK_EN\\r\n| ET1011C_TX_FIFO_DEPTH_16);\r\n}\r\n}\r\nreturn ret;\r\n}\r\nstatic int __init et1011c_init(void)\r\n{\r\nreturn phy_driver_register(&et1011c_driver);\r\n}\r\nstatic void __exit et1011c_exit(void)\r\n{\r\nphy_driver_unregister(&et1011c_driver);\r\n}
