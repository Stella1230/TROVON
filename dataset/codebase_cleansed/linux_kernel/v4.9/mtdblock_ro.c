static int mtdblock_readsect(struct mtd_blktrans_dev *dev,\r\nunsigned long block, char *buf)\r\n{\r\nsize_t retlen;\r\nif (mtd_read(dev->mtd, (block * 512), 512, &retlen, buf))\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic int mtdblock_writesect(struct mtd_blktrans_dev *dev,\r\nunsigned long block, char *buf)\r\n{\r\nsize_t retlen;\r\nif (mtd_write(dev->mtd, (block * 512), 512, &retlen, buf))\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic void mtdblock_add_mtd(struct mtd_blktrans_ops *tr, struct mtd_info *mtd)\r\n{\r\nstruct mtd_blktrans_dev *dev = kzalloc(sizeof(*dev), GFP_KERNEL);\r\nif (!dev)\r\nreturn;\r\ndev->mtd = mtd;\r\ndev->devnum = mtd->index;\r\ndev->size = mtd->size >> 9;\r\ndev->tr = tr;\r\ndev->readonly = 1;\r\nif (add_mtd_blktrans_dev(dev))\r\nkfree(dev);\r\n}\r\nstatic void mtdblock_remove_dev(struct mtd_blktrans_dev *dev)\r\n{\r\ndel_mtd_blktrans_dev(dev);\r\n}\r\nstatic int __init mtdblock_init(void)\r\n{\r\nreturn register_mtd_blktrans(&mtdblock_tr);\r\n}\r\nstatic void __exit mtdblock_exit(void)\r\n{\r\nderegister_mtd_blktrans(&mtdblock_tr);\r\n}
