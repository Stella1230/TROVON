static int __init x86_rdrand_setup(char *s)\r\n{\r\nsetup_clear_cpu_cap(X86_FEATURE_RDRAND);\r\nsetup_clear_cpu_cap(X86_FEATURE_RDSEED);\r\nreturn 1;\r\n}\r\nvoid x86_init_rdrand(struct cpuinfo_x86 *c)\r\n{\r\nunsigned long tmp;\r\nint i;\r\nif (!cpu_has(c, X86_FEATURE_RDRAND))\r\nreturn;\r\nfor (i = 0; i < SANITY_CHECK_LOOPS; i++) {\r\nif (!rdrand_long(&tmp)) {\r\nclear_cpu_cap(c, X86_FEATURE_RDRAND);\r\npr_warn_once("rdrand: disabled\n");\r\nreturn;\r\n}\r\n}\r\n}
