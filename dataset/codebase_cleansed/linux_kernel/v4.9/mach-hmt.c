static int hmt_bl_init(struct device *dev)\r\n{\r\nint ret;\r\nret = gpio_request(S3C64XX_GPB(4), "lcd backlight enable");\r\nif (!ret)\r\nret = gpio_direction_output(S3C64XX_GPB(4), 0);\r\nreturn ret;\r\n}\r\nstatic int hmt_bl_notify(struct device *dev, int brightness)\r\n{\r\nif (brightness < 0x800) {\r\nbrightness = (100*256 * brightness + 231245/2) / 231245;\r\n} else {\r\nint t = (brightness*4 + 16*1024 + 58)/116;\r\nbrightness = 25 * ((t * t * t + 0x100000/2) / 0x100000);\r\n}\r\ngpio_set_value(S3C64XX_GPB(4), brightness);\r\nreturn brightness;\r\n}\r\nstatic void hmt_bl_exit(struct device *dev)\r\n{\r\ngpio_free(S3C64XX_GPB(4));\r\n}\r\nstatic void __init hmt_map_io(void)\r\n{\r\ns3c64xx_init_io(hmt_iodesc, ARRAY_SIZE(hmt_iodesc));\r\ns3c64xx_set_xtal_freq(12000000);\r\ns3c24xx_init_uarts(hmt_uartcfgs, ARRAY_SIZE(hmt_uartcfgs));\r\nsamsung_set_timer_source(SAMSUNG_PWM3, SAMSUNG_PWM4);\r\n}\r\nstatic void __init hmt_machine_init(void)\r\n{\r\ns3c_i2c0_set_platdata(NULL);\r\ns3c_fb_set_platdata(&hmt_lcd_pdata);\r\ns3c_nand_set_platdata(&hmt_nand_info);\r\ngpio_request(S3C64XX_GPC(7), "usb power");\r\ngpio_direction_output(S3C64XX_GPC(7), 0);\r\ngpio_request(S3C64XX_GPM(0), "usb power");\r\ngpio_direction_output(S3C64XX_GPM(0), 1);\r\ngpio_request(S3C64XX_GPK(7), "usb power");\r\ngpio_direction_output(S3C64XX_GPK(7), 1);\r\ngpio_request(S3C64XX_GPF(13), "usb power");\r\ngpio_direction_output(S3C64XX_GPF(13), 1);\r\npwm_add_table(hmt_pwm_lookup, ARRAY_SIZE(hmt_pwm_lookup));\r\nplatform_add_devices(hmt_devices, ARRAY_SIZE(hmt_devices));\r\n}
