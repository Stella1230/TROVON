static inline unsigned int regcache_flat_get_index(const struct regmap *map,\r\nunsigned int reg)\r\n{\r\nreturn regcache_get_index_by_order(map, reg);\r\n}\r\nstatic int regcache_flat_init(struct regmap *map)\r\n{\r\nint i;\r\nunsigned int *cache;\r\nif (!map || map->reg_stride_order < 0 || !map->max_register)\r\nreturn -EINVAL;\r\nmap->cache = kcalloc(regcache_flat_get_index(map, map->max_register)\r\n+ 1, sizeof(unsigned int), GFP_KERNEL);\r\nif (!map->cache)\r\nreturn -ENOMEM;\r\ncache = map->cache;\r\nfor (i = 0; i < map->num_reg_defaults; i++)\r\ncache[regcache_flat_get_index(map, map->reg_defaults[i].reg)] =\r\nmap->reg_defaults[i].def;\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_exit(struct regmap *map)\r\n{\r\nkfree(map->cache);\r\nmap->cache = NULL;\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_read(struct regmap *map,\r\nunsigned int reg, unsigned int *value)\r\n{\r\nunsigned int *cache = map->cache;\r\n*value = cache[regcache_flat_get_index(map, reg)];\r\nreturn 0;\r\n}\r\nstatic int regcache_flat_write(struct regmap *map, unsigned int reg,\r\nunsigned int value)\r\n{\r\nunsigned int *cache = map->cache;\r\ncache[regcache_flat_get_index(map, reg)] = value;\r\nreturn 0;\r\n}
