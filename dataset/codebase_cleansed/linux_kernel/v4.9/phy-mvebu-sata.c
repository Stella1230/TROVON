static int phy_mvebu_sata_power_on(struct phy *phy)\r\n{\r\nstruct priv *priv = phy_get_drvdata(phy);\r\nu32 reg;\r\nclk_prepare_enable(priv->clk);\r\nreg = readl(priv->base + SATA_PHY_MODE_2);\r\nreg |= (MODE_2_FORCE_PU_TX | MODE_2_FORCE_PU_RX |\r\nMODE_2_PU_PLL | MODE_2_PU_IVREF);\r\nwritel(reg , priv->base + SATA_PHY_MODE_2);\r\nreg = readl(priv->base + SATA_IF_CTRL);\r\nreg &= ~CTRL_PHY_SHUTDOWN;\r\nwritel(reg, priv->base + SATA_IF_CTRL);\r\nclk_disable_unprepare(priv->clk);\r\nreturn 0;\r\n}\r\nstatic int phy_mvebu_sata_power_off(struct phy *phy)\r\n{\r\nstruct priv *priv = phy_get_drvdata(phy);\r\nu32 reg;\r\nclk_prepare_enable(priv->clk);\r\nreg = readl(priv->base + SATA_PHY_MODE_2);\r\nreg &= ~(MODE_2_FORCE_PU_TX | MODE_2_FORCE_PU_RX |\r\nMODE_2_PU_PLL | MODE_2_PU_IVREF);\r\nwritel(reg, priv->base + SATA_PHY_MODE_2);\r\nreg = readl(priv->base + SATA_IF_CTRL);\r\nreg |= CTRL_PHY_SHUTDOWN;\r\nwritel(reg, priv->base + SATA_IF_CTRL);\r\nclk_disable_unprepare(priv->clk);\r\nreturn 0;\r\n}\r\nstatic int phy_mvebu_sata_probe(struct platform_device *pdev)\r\n{\r\nstruct phy_provider *phy_provider;\r\nstruct resource *res;\r\nstruct priv *priv;\r\nstruct phy *phy;\r\npriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\r\nif (!priv)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\npriv->base = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(priv->base))\r\nreturn PTR_ERR(priv->base);\r\npriv->clk = devm_clk_get(&pdev->dev, "sata");\r\nif (IS_ERR(priv->clk))\r\nreturn PTR_ERR(priv->clk);\r\nphy = devm_phy_create(&pdev->dev, NULL, &phy_mvebu_sata_ops);\r\nif (IS_ERR(phy))\r\nreturn PTR_ERR(phy);\r\nphy_set_drvdata(phy, priv);\r\nphy_provider = devm_of_phy_provider_register(&pdev->dev,\r\nof_phy_simple_xlate);\r\nif (IS_ERR(phy_provider))\r\nreturn PTR_ERR(phy_provider);\r\nphy_mvebu_sata_power_off(phy);\r\nreturn 0;\r\n}
