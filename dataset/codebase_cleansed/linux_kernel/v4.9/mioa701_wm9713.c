static int rear_amp_power(struct snd_soc_codec *codec, int power)\r\n{\r\nunsigned short reg;\r\nif (power) {\r\nreg = snd_soc_read(codec, AC97_GPIO_CFG);\r\nsnd_soc_write(codec, AC97_GPIO_CFG, reg | 0x0100);\r\nreg = snd_soc_read(codec, AC97_GPIO_PULL);\r\nsnd_soc_write(codec, AC97_GPIO_PULL, reg | (1<<15));\r\n} else {\r\nreg = snd_soc_read(codec, AC97_GPIO_CFG);\r\nsnd_soc_write(codec, AC97_GPIO_CFG, reg & ~0x0100);\r\nreg = snd_soc_read(codec, AC97_GPIO_PULL);\r\nsnd_soc_write(codec, AC97_GPIO_PULL, reg & ~(1<<15));\r\n}\r\nreturn 0;\r\n}\r\nstatic int rear_amp_event(struct snd_soc_dapm_widget *widget,\r\nstruct snd_kcontrol *kctl, int event)\r\n{\r\nstruct snd_soc_card *card = widget->dapm->card;\r\nstruct snd_soc_pcm_runtime *rtd;\r\nstruct snd_soc_codec *codec;\r\nrtd = snd_soc_get_pcm_runtime(card, card->dai_link[0].name);\r\ncodec = rtd->codec;\r\nreturn rear_amp_power(codec, SND_SOC_DAPM_EVENT_ON(event));\r\n}\r\nstatic int mioa701_wm9713_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_codec *codec = rtd->codec;\r\nsnd_soc_update_bits(codec, AC97_GPIO_CFG, 0x100, 0x100);\r\nsnd_soc_update_bits(codec, AC97_3D_CONTROL, 0xc000, 0xc000);\r\nreturn 0;\r\n}\r\nstatic int mioa701_wm9713_probe(struct platform_device *pdev)\r\n{\r\nint rc;\r\nif (!machine_is_mioa701())\r\nreturn -ENODEV;\r\nmioa701.dev = &pdev->dev;\r\nrc = devm_snd_soc_register_card(&pdev->dev, &mioa701);\r\nif (!rc)\r\ndev_warn(&pdev->dev, "Be warned that incorrect mixers/muxes setup will"\r\n"lead to overheating and possible destruction of your device."\r\n" Do not use without a good knowledge of mio's board design!\n");\r\nreturn rc;\r\n}
