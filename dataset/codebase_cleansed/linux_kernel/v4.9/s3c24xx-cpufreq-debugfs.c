static void show_max(struct seq_file *seq, struct s3c_freq *f)\r\n{\r\nseq_printf(seq, "MAX: F=%lu, H=%lu, P=%lu, A=%lu\n",\r\nf->fclk, f->hclk, f->pclk, f->armclk);\r\n}\r\nstatic int board_show(struct seq_file *seq, void *p)\r\n{\r\nstruct s3c_cpufreq_config *cfg;\r\nstruct s3c_cpufreq_board *brd;\r\ncfg = s3c_cpufreq_getconfig();\r\nif (!cfg) {\r\nseq_printf(seq, "no configuration registered\n");\r\nreturn 0;\r\n}\r\nbrd = cfg->board;\r\nif (!brd) {\r\nseq_printf(seq, "no board definition set?\n");\r\nreturn 0;\r\n}\r\nseq_printf(seq, "SDRAM refresh %u ns\n", brd->refresh);\r\nseq_printf(seq, "auto_io=%u\n", brd->auto_io);\r\nseq_printf(seq, "need_io=%u\n", brd->need_io);\r\nshow_max(seq, &brd->max);\r\nreturn 0;\r\n}\r\nstatic int fops_board_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, board_show, NULL);\r\n}\r\nstatic int info_show(struct seq_file *seq, void *p)\r\n{\r\nstruct s3c_cpufreq_config *cfg;\r\ncfg = s3c_cpufreq_getconfig();\r\nif (!cfg) {\r\nseq_printf(seq, "no configuration registered\n");\r\nreturn 0;\r\n}\r\nseq_printf(seq, " FCLK %ld Hz\n", cfg->freq.fclk);\r\nseq_printf(seq, " HCLK %ld Hz (%lu.%lu ns)\n",\r\ncfg->freq.hclk, print_ns(cfg->freq.hclk_tns));\r\nseq_printf(seq, " PCLK %ld Hz\n", cfg->freq.hclk);\r\nseq_printf(seq, "ARMCLK %ld Hz\n", cfg->freq.armclk);\r\nseq_printf(seq, "\n");\r\nshow_max(seq, &cfg->max);\r\nseq_printf(seq, "Divisors: P=%d, H=%d, A=%d, dvs=%s\n",\r\ncfg->divs.h_divisor, cfg->divs.p_divisor,\r\ncfg->divs.arm_divisor, cfg->divs.dvs ? "on" : "off");\r\nseq_printf(seq, "\n");\r\nseq_printf(seq, "lock_pll=%u\n", cfg->lock_pll);\r\nreturn 0;\r\n}\r\nstatic int fops_info_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, info_show, NULL);\r\n}\r\nstatic int io_show(struct seq_file *seq, void *p)\r\n{\r\nvoid (*show_bank)(struct seq_file *, struct s3c_cpufreq_config *, union s3c_iobank *);\r\nstruct s3c_cpufreq_config *cfg;\r\nstruct s3c_iotimings *iot;\r\nunion s3c_iobank *iob;\r\nint bank;\r\ncfg = s3c_cpufreq_getconfig();\r\nif (!cfg) {\r\nseq_printf(seq, "no configuration registered\n");\r\nreturn 0;\r\n}\r\nshow_bank = cfg->info->debug_io_show;\r\nif (!show_bank) {\r\nseq_printf(seq, "no code to show bank timing\n");\r\nreturn 0;\r\n}\r\niot = s3c_cpufreq_getiotimings();\r\nif (!iot) {\r\nseq_printf(seq, "no io timings registered\n");\r\nreturn 0;\r\n}\r\nseq_printf(seq, "hclk period is %lu.%lu ns\n", print_ns(cfg->freq.hclk_tns));\r\nfor (bank = 0; bank < MAX_BANKS; bank++) {\r\niob = &iot->bank[bank];\r\nseq_printf(seq, "bank %d: ", bank);\r\nif (!iob->io_2410) {\r\nseq_printf(seq, "nothing set\n");\r\ncontinue;\r\n}\r\nshow_bank(seq, cfg, iob);\r\n}\r\nreturn 0;\r\n}\r\nstatic int fops_io_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, io_show, NULL);\r\n}\r\nstatic int __init s3c_freq_debugfs_init(void)\r\n{\r\ndbgfs_root = debugfs_create_dir("s3c-cpufreq", NULL);\r\nif (IS_ERR(dbgfs_root)) {\r\npr_err("%s: error creating debugfs root\n", __func__);\r\nreturn PTR_ERR(dbgfs_root);\r\n}\r\ndbgfs_file_io = debugfs_create_file("io-timing", S_IRUGO, dbgfs_root,\r\nNULL, &fops_io);\r\ndbgfs_file_info = debugfs_create_file("info", S_IRUGO, dbgfs_root,\r\nNULL, &fops_info);\r\ndbgfs_file_board = debugfs_create_file("board", S_IRUGO, dbgfs_root,\r\nNULL, &fops_board);\r\nreturn 0;\r\n}
