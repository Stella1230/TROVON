static int psci_boot_secondary(unsigned int cpu, struct task_struct *idle)\r\n{\r\nif (psci_ops.cpu_on)\r\nreturn psci_ops.cpu_on(cpu_logical_map(cpu),\r\nvirt_to_idmap(&secondary_startup));\r\nreturn -ENODEV;\r\n}\r\nint psci_cpu_disable(unsigned int cpu)\r\n{\r\nif (!psci_ops.cpu_off)\r\nreturn -EOPNOTSUPP;\r\nif (psci_tos_resident_on(cpu))\r\nreturn -EPERM;\r\nreturn 0;\r\n}\r\nvoid psci_cpu_die(unsigned int cpu)\r\n{\r\nu32 state = PSCI_POWER_STATE_TYPE_POWER_DOWN <<\r\nPSCI_0_2_POWER_STATE_TYPE_SHIFT;\r\nif (psci_ops.cpu_off)\r\npsci_ops.cpu_off(state);\r\npanic("psci: cpu %d failed to shutdown\n", cpu);\r\n}\r\nint psci_cpu_kill(unsigned int cpu)\r\n{\r\nint err, i;\r\nif (!psci_ops.affinity_info)\r\nreturn 1;\r\nfor (i = 0; i < 10; i++) {\r\nerr = psci_ops.affinity_info(cpu_logical_map(cpu), 0);\r\nif (err == PSCI_0_2_AFFINITY_LEVEL_OFF) {\r\npr_info("CPU%d killed.\n", cpu);\r\nreturn 1;\r\n}\r\nmsleep(10);\r\npr_info("Retrying again to check for CPU kill\n");\r\n}\r\npr_warn("CPU%d may not have shut down cleanly (AFFINITY_INFO reports %d)\n",\r\ncpu, err);\r\nreturn 0;\r\n}\r\nbool __init psci_smp_available(void)\r\n{\r\nreturn (psci_ops.cpu_on != NULL);\r\n}
