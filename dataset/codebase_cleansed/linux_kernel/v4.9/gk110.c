void\r\ngk110_pmu_pgob(struct nvkm_pmu *pmu, bool enable)\r\n{\r\nstruct nvkm_device *device = pmu->subdev.device;\r\nstatic const struct {\r\nu32 addr;\r\nu32 data;\r\n} magic[] = {\r\n{ 0x020520, 0xfffffffc },\r\n{ 0x020524, 0xfffffffe },\r\n{ 0x020524, 0xfffffffc },\r\n{ 0x020524, 0xfffffff8 },\r\n{ 0x020524, 0xffffffe0 },\r\n{ 0x020530, 0xfffffffe },\r\n{ 0x02052c, 0xfffffffa },\r\n{ 0x02052c, 0xfffffff0 },\r\n{ 0x02052c, 0xffffffc0 },\r\n{ 0x02052c, 0xffffff00 },\r\n{ 0x02052c, 0xfffffc00 },\r\n{ 0x02052c, 0xfffcfc00 },\r\n{ 0x02052c, 0xfff0fc00 },\r\n{ 0x02052c, 0xff80fc00 },\r\n{ 0x020528, 0xfffffffe },\r\n{ 0x020528, 0xfffffffc },\r\n};\r\nint i;\r\nnvkm_mask(device, 0x000200, 0x00001000, 0x00000000);\r\nnvkm_rd32(device, 0x000200);\r\nnvkm_mask(device, 0x000200, 0x08000000, 0x08000000);\r\nmsleep(50);\r\nnvkm_mask(device, 0x10a78c, 0x00000002, 0x00000002);\r\nnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000001);\r\nnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000000);\r\nnvkm_mask(device, 0x0206b4, 0x00000000, 0x00000000);\r\nfor (i = 0; i < ARRAY_SIZE(magic); i++) {\r\nnvkm_wr32(device, magic[i].addr, magic[i].data);\r\nnvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, magic[i].addr) & 0x80000000))\r\nbreak;\r\n);\r\n}\r\nnvkm_mask(device, 0x10a78c, 0x00000002, 0x00000000);\r\nnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000001);\r\nnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000000);\r\nnvkm_mask(device, 0x000200, 0x08000000, 0x00000000);\r\nnvkm_mask(device, 0x000200, 0x00001000, 0x00001000);\r\nnvkm_rd32(device, 0x000200);\r\n}\r\nint\r\ngk110_pmu_new(struct nvkm_device *device, int index, struct nvkm_pmu **ppmu)\r\n{\r\nreturn nvkm_pmu_new_(&gk110_pmu, device, index, ppmu);\r\n}
