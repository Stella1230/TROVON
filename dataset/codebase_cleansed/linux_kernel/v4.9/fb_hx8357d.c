static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nwrite_reg(par, MIPI_DCS_SOFT_RESET);\r\nusleep_range(5000, 7000);\r\nwrite_reg(par, HX8357D_SETC, 0xFF, 0x83, 0x57);\r\nmsleep(150);\r\nwrite_reg(par, HX8357_SETRGB, 0x00, 0x00, 0x06, 0x06);\r\nwrite_reg(par, HX8357D_SETCOM, 0x25);\r\nwrite_reg(par, HX8357_SETOSC, 0x68);\r\nwrite_reg(par, HX8357_SETPANEL, 0x05);\r\nwrite_reg(par, HX8357_SETPWR1,\r\n0x00,\r\n0x15,\r\n0x1C,\r\n0x1C,\r\n0x83,\r\n0xAA);\r\nwrite_reg(par, HX8357D_SETSTBA,\r\n0x50,\r\n0x50,\r\n0x01,\r\n0x3C,\r\n0x1E,\r\n0x08);\r\nwrite_reg(par, HX8357D_SETCYC,\r\n0x02,\r\n0x40,\r\n0x00,\r\n0x2A,\r\n0x2A,\r\n0x0D,\r\n0x78);\r\nwrite_reg(par, HX8357D_SETGAMMA,\r\n0x02,\r\n0x0A,\r\n0x11,\r\n0x1d,\r\n0x23,\r\n0x35,\r\n0x41,\r\n0x4b,\r\n0x4b,\r\n0x42,\r\n0x3A,\r\n0x27,\r\n0x1B,\r\n0x08,\r\n0x09,\r\n0x03,\r\n0x02,\r\n0x0A,\r\n0x11,\r\n0x1d,\r\n0x23,\r\n0x35,\r\n0x41,\r\n0x4b,\r\n0x4b,\r\n0x42,\r\n0x3A,\r\n0x27,\r\n0x1B,\r\n0x08,\r\n0x09,\r\n0x03,\r\n0x00,\r\n0x01);\r\nwrite_reg(par, MIPI_DCS_SET_PIXEL_FORMAT, 0x55);\r\nwrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0xC0);\r\nwrite_reg(par, MIPI_DCS_SET_TEAR_ON, 0x00);\r\nwrite_reg(par, MIPI_DCS_SET_TEAR_SCANLINE, 0x00, 0x02);\r\nwrite_reg(par, MIPI_DCS_EXIT_SLEEP_MODE);\r\nmsleep(150);\r\nwrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\r\nusleep_range(5000, 7000);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,\r\nxs >> 8, xs & 0xff,\r\nxe >> 8, xe & 0xff);\r\nwrite_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,\r\nys >> 8, ys & 0xff,\r\nye >> 8, ye & 0xff);\r\nwrite_reg(par, MIPI_DCS_WRITE_MEMORY_START);\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\nu8 val;\r\nswitch (par->info->var.rotate) {\r\ncase 270:\r\nval = HX8357D_MADCTL_MV | HX8357D_MADCTL_MX;\r\nbreak;\r\ncase 180:\r\nval = 0;\r\nbreak;\r\ncase 90:\r\nval = HX8357D_MADCTL_MV | HX8357D_MADCTL_MY;\r\nbreak;\r\ndefault:\r\nval = HX8357D_MADCTL_MX | HX8357D_MADCTL_MY;\r\nbreak;\r\n}\r\nval |= (par->bgr ? HX8357D_MADCTL_RGB : HX8357D_MADCTL_BGR);\r\nwrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, val);\r\nreturn 0;\r\n}
