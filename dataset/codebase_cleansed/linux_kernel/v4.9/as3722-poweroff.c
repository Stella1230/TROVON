static void as3722_pm_power_off(void)\r\n{\r\nint ret;\r\nif (!as3722_pm_poweroff) {\r\npr_err("AS3722 poweroff is not initialised\n");\r\nreturn;\r\n}\r\nret = as3722_update_bits(as3722_pm_poweroff->as3722,\r\nAS3722_RESET_CONTROL_REG, AS3722_POWER_OFF, AS3722_POWER_OFF);\r\nif (ret < 0)\r\ndev_err(as3722_pm_poweroff->dev,\r\n"RESET_CONTROL_REG update failed, %d\n", ret);\r\n}\r\nstatic int as3722_poweroff_probe(struct platform_device *pdev)\r\n{\r\nstruct as3722_poweroff *as3722_poweroff;\r\nstruct device_node *np = pdev->dev.parent->of_node;\r\nif (!np)\r\nreturn -EINVAL;\r\nif (!of_property_read_bool(np, "ams,system-power-controller"))\r\nreturn 0;\r\nas3722_poweroff = devm_kzalloc(&pdev->dev, sizeof(*as3722_poweroff),\r\nGFP_KERNEL);\r\nif (!as3722_poweroff)\r\nreturn -ENOMEM;\r\nas3722_poweroff->as3722 = dev_get_drvdata(pdev->dev.parent);\r\nas3722_poweroff->dev = &pdev->dev;\r\nas3722_pm_poweroff = as3722_poweroff;\r\nif (!pm_power_off)\r\npm_power_off = as3722_pm_power_off;\r\nreturn 0;\r\n}\r\nstatic int as3722_poweroff_remove(struct platform_device *pdev)\r\n{\r\nif (pm_power_off == as3722_pm_power_off)\r\npm_power_off = NULL;\r\nas3722_pm_poweroff = NULL;\r\nreturn 0;\r\n}
