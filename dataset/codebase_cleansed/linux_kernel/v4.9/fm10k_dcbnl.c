static int fm10k_dcbnl_ieee_getets(struct net_device *dev, struct ieee_ets *ets)\r\n{\r\nint i;\r\nets->ets_cap = IEEE_8021QAZ_MAX_TCS;\r\nets->cbs = 0;\r\nmemset(ets->tc_tx_bw, 0, sizeof(ets->tc_tx_bw));\r\nmemset(ets->tc_rx_bw, 0, sizeof(ets->tc_rx_bw));\r\nmemset(ets->tc_tsa, IEEE_8021QAZ_TSA_STRICT, sizeof(ets->tc_tsa));\r\nfor (i = 0; i < IEEE_8021QAZ_MAX_TCS; i++)\r\nets->prio_tc[i] = netdev_get_prio_tc_map(dev, i);\r\nreturn 0;\r\n}\r\nstatic int fm10k_dcbnl_ieee_setets(struct net_device *dev, struct ieee_ets *ets)\r\n{\r\nu8 num_tc = 0;\r\nint i, err;\r\nfor (i = 0; i < IEEE_8021QAZ_MAX_TCS; i++) {\r\nif (ets->tc_tx_bw[i] || ets->tc_rx_bw[i])\r\nreturn -EINVAL;\r\nif (ets->tc_tsa[i] != IEEE_8021QAZ_TSA_STRICT)\r\nreturn -EINVAL;\r\nif (ets->prio_tc[i] > num_tc)\r\nnum_tc = ets->prio_tc[i];\r\n}\r\nif (num_tc)\r\nnum_tc++;\r\nif (num_tc > IEEE_8021QAZ_MAX_TCS)\r\nreturn -EINVAL;\r\nif (num_tc != netdev_get_num_tc(dev)) {\r\nerr = fm10k_setup_tc(dev, num_tc);\r\nif (err)\r\nreturn err;\r\n}\r\nfor (i = 0; i < IEEE_8021QAZ_MAX_TCS; i++)\r\nnetdev_set_prio_tc_map(dev, i, ets->prio_tc[i]);\r\nreturn 0;\r\n}\r\nstatic int fm10k_dcbnl_ieee_getpfc(struct net_device *dev, struct ieee_pfc *pfc)\r\n{\r\nstruct fm10k_intfc *interface = netdev_priv(dev);\r\npfc->pfc_cap = IEEE_8021QAZ_MAX_TCS;\r\npfc->pfc_en = interface->pfc_en;\r\nreturn 0;\r\n}\r\nstatic int fm10k_dcbnl_ieee_setpfc(struct net_device *dev, struct ieee_pfc *pfc)\r\n{\r\nstruct fm10k_intfc *interface = netdev_priv(dev);\r\ninterface->pfc_en = pfc->pfc_en;\r\nif (netif_running(dev))\r\nfm10k_update_rx_drop_en(interface);\r\nreturn 0;\r\n}\r\nstatic u8 fm10k_dcbnl_getdcbx(struct net_device __always_unused *dev)\r\n{\r\nreturn DCB_CAP_DCBX_HOST | DCB_CAP_DCBX_VER_IEEE;\r\n}\r\nstatic u8 fm10k_dcbnl_setdcbx(struct net_device __always_unused *dev, u8 mode)\r\n{\r\nreturn (mode != (DCB_CAP_DCBX_HOST | DCB_CAP_DCBX_VER_IEEE)) ? 1 : 0;\r\n}\r\nvoid fm10k_dcbnl_set_ops(struct net_device *dev)\r\n{\r\nstruct fm10k_intfc *interface = netdev_priv(dev);\r\nstruct fm10k_hw *hw = &interface->hw;\r\nif (hw->mac.type == fm10k_mac_pf)\r\ndev->dcbnl_ops = &fm10k_dcbnl_ops;\r\n}
