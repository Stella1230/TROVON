static void print_facility_list(struct facility_def *def)\r\n{\r\nunsigned int high, bit, dword, i;\r\nunsigned long long *array;\r\narray = calloc(1, 8);\r\nif (!array)\r\nexit(EXIT_FAILURE);\r\nhigh = 0;\r\nfor (i = 0; def->bits[i] != -1; i++) {\r\nbit = 63 - (def->bits[i] & 63);\r\ndword = def->bits[i] / 64;\r\nif (dword > high) {\r\narray = realloc(array, (dword + 1) * 8);\r\nif (!array)\r\nexit(EXIT_FAILURE);\r\nmemset(array + high + 1, 0, (dword - high) * 8);\r\nhigh = dword;\r\n}\r\narray[dword] |= 1ULL << bit;\r\n}\r\nprintf("#define %s ", def->name);\r\nfor (i = 0; i <= high; i++)\r\nprintf("_AC(0x%016llx,UL)%c", array[i], i < high ? ',' : '\n');\r\nfree(array);\r\n}\r\nstatic void print_facility_lists(void)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < sizeof(facility_defs) / sizeof(facility_defs[0]); i++)\r\nprint_facility_list(&facility_defs[i]);\r\n}\r\nint main(int argc, char **argv)\r\n{\r\nprintf("#ifndef __ASM_S390_FACILITIES__\n");\r\nprintf("#define __ASM_S390_FACILITIES__\n");\r\nprintf("/*\n");\r\nprintf(" * DO NOT MODIFY.\n");\r\nprintf(" *\n");\r\nprintf(" * This file was generated by %s\n", __FILE__);\r\nprintf(" */\n\n");\r\nprintf("#include <linux/const.h>\n\n");\r\nprint_facility_lists();\r\nprintf("\n#endif\n");\r\nreturn 0;\r\n}
