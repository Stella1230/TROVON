void radix__flush_hugetlb_page(struct vm_area_struct *vma, unsigned long vmaddr)\r\n{\r\nint psize;\r\nstruct hstate *hstate = hstate_file(vma->vm_file);\r\npsize = hstate_get_psize(hstate);\r\nradix__flush_tlb_page_psize(vma->vm_mm, vmaddr, psize);\r\n}\r\nvoid radix__local_flush_hugetlb_page(struct vm_area_struct *vma, unsigned long vmaddr)\r\n{\r\nint psize;\r\nstruct hstate *hstate = hstate_file(vma->vm_file);\r\npsize = hstate_get_psize(hstate);\r\nradix__local_flush_tlb_page_psize(vma->vm_mm, vmaddr, psize);\r\n}\r\nvoid radix__flush_hugetlb_tlb_range(struct vm_area_struct *vma, unsigned long start,\r\nunsigned long end)\r\n{\r\nint psize;\r\nstruct hstate *hstate = hstate_file(vma->vm_file);\r\npsize = hstate_get_psize(hstate);\r\nradix__flush_tlb_range_psize(vma->vm_mm, start, end, psize);\r\n}\r\nunsigned long\r\nradix__hugetlb_get_unmapped_area(struct file *file, unsigned long addr,\r\nunsigned long len, unsigned long pgoff,\r\nunsigned long flags)\r\n{\r\nstruct mm_struct *mm = current->mm;\r\nstruct vm_area_struct *vma;\r\nstruct hstate *h = hstate_file(file);\r\nstruct vm_unmapped_area_info info;\r\nif (len & ~huge_page_mask(h))\r\nreturn -EINVAL;\r\nif (len > TASK_SIZE)\r\nreturn -ENOMEM;\r\nif (flags & MAP_FIXED) {\r\nif (prepare_hugepage_range(file, addr, len))\r\nreturn -EINVAL;\r\nreturn addr;\r\n}\r\nif (addr) {\r\naddr = ALIGN(addr, huge_page_size(h));\r\nvma = find_vma(mm, addr);\r\nif (TASK_SIZE - len >= addr &&\r\n(!vma || addr + len <= vma->vm_start))\r\nreturn addr;\r\n}\r\ninfo.flags = VM_UNMAPPED_AREA_TOPDOWN;\r\ninfo.length = len;\r\ninfo.low_limit = PAGE_SIZE;\r\ninfo.high_limit = current->mm->mmap_base;\r\ninfo.align_mask = PAGE_MASK & ~huge_page_mask(h);\r\ninfo.align_offset = 0;\r\nreturn vm_unmapped_area(&info);\r\n}
