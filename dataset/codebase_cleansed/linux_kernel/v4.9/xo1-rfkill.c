static int rfkill_set_block(void *data, bool blocked)\r\n{\r\nunsigned char cmd;\r\nint r;\r\nif (blocked == card_blocked)\r\nreturn 0;\r\nif (blocked)\r\ncmd = EC_WLAN_ENTER_RESET;\r\nelse\r\ncmd = EC_WLAN_LEAVE_RESET;\r\nr = olpc_ec_cmd(cmd, NULL, 0, NULL, 0);\r\nif (r == 0)\r\ncard_blocked = blocked;\r\nreturn r;\r\n}\r\nstatic int xo1_rfkill_probe(struct platform_device *pdev)\r\n{\r\nstruct rfkill *rfk;\r\nint r;\r\nrfk = rfkill_alloc(pdev->name, &pdev->dev, RFKILL_TYPE_WLAN,\r\n&rfkill_ops, NULL);\r\nif (!rfk)\r\nreturn -ENOMEM;\r\nr = rfkill_register(rfk);\r\nif (r) {\r\nrfkill_destroy(rfk);\r\nreturn r;\r\n}\r\nplatform_set_drvdata(pdev, rfk);\r\nreturn 0;\r\n}\r\nstatic int xo1_rfkill_remove(struct platform_device *pdev)\r\n{\r\nstruct rfkill *rfk = platform_get_drvdata(pdev);\r\nrfkill_unregister(rfk);\r\nrfkill_destroy(rfk);\r\nreturn 0;\r\n}
