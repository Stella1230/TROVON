static acpi_status sst_acpi_find_name(acpi_handle handle, u32 level,\r\nvoid *context, void **ret)\r\n{\r\nstruct acpi_device *adev;\r\nconst char *name = NULL;\r\nif (acpi_bus_get_device(handle, &adev))\r\nreturn AE_OK;\r\nif (adev->status.present && adev->status.functional) {\r\nname = acpi_dev_name(adev);\r\n*(const char **)ret = name;\r\nreturn AE_CTRL_TERMINATE;\r\n}\r\nreturn AE_OK;\r\n}\r\nconst char *sst_acpi_find_name_from_hid(const u8 hid[ACPI_ID_LEN])\r\n{\r\nconst char *name = NULL;\r\nacpi_status status;\r\nstatus = acpi_get_devices(hid, sst_acpi_find_name, NULL,\r\n(void **)&name);\r\nif (ACPI_FAILURE(status) || name[0] == '\0')\r\nreturn NULL;\r\nreturn name;\r\n}\r\nstatic acpi_status sst_acpi_mach_match(acpi_handle handle, u32 level,\r\nvoid *context, void **ret)\r\n{\r\nunsigned long long sta;\r\nacpi_status status;\r\n*(bool *)context = true;\r\nstatus = acpi_evaluate_integer(handle, "_STA", NULL, &sta);\r\nif (ACPI_FAILURE(status) || !(sta & ACPI_STA_DEVICE_PRESENT))\r\n*(bool *)context = false;\r\nreturn AE_OK;\r\n}\r\nstruct sst_acpi_mach *sst_acpi_find_machine(struct sst_acpi_mach *machines)\r\n{\r\nstruct sst_acpi_mach *mach;\r\nbool found = false;\r\nfor (mach = machines; mach->id[0]; mach++)\r\nif (ACPI_SUCCESS(acpi_get_devices(mach->id,\r\nsst_acpi_mach_match,\r\n&found, NULL)) && found)\r\nreturn mach;\r\nreturn NULL;\r\n}
