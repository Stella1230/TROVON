size_t symbol__fprintf(struct symbol *sym, FILE *fp)\r\n{\r\nreturn fprintf(fp, " %" PRIx64 "-%" PRIx64 " %c %s\n",\r\nsym->start, sym->end,\r\nsym->binding == STB_GLOBAL ? 'g' :\r\nsym->binding == STB_LOCAL ? 'l' : 'w',\r\nsym->name);\r\n}\r\nsize_t __symbol__fprintf_symname_offs(const struct symbol *sym,\r\nconst struct addr_location *al,\r\nbool unknown_as_addr, FILE *fp)\r\n{\r\nunsigned long offset;\r\nsize_t length;\r\nif (sym && sym->name) {\r\nlength = fprintf(fp, "%s", sym->name);\r\nif (al) {\r\nif (al->addr < sym->end)\r\noffset = al->addr - sym->start;\r\nelse\r\noffset = al->addr - al->map->start - sym->start;\r\nlength += fprintf(fp, "+0x%lx", offset);\r\n}\r\nreturn length;\r\n} else if (al && unknown_as_addr)\r\nreturn fprintf(fp, "[%#" PRIx64 "]", al->addr);\r\nelse\r\nreturn fprintf(fp, "[unknown]");\r\n}\r\nsize_t symbol__fprintf_symname_offs(const struct symbol *sym,\r\nconst struct addr_location *al,\r\nFILE *fp)\r\n{\r\nreturn __symbol__fprintf_symname_offs(sym, al, false, fp);\r\n}\r\nsize_t __symbol__fprintf_symname(const struct symbol *sym,\r\nconst struct addr_location *al,\r\nbool unknown_as_addr, FILE *fp)\r\n{\r\nreturn __symbol__fprintf_symname_offs(sym, al, unknown_as_addr, fp);\r\n}\r\nsize_t symbol__fprintf_symname(const struct symbol *sym, FILE *fp)\r\n{\r\nreturn __symbol__fprintf_symname_offs(sym, NULL, false, fp);\r\n}\r\nsize_t dso__fprintf_symbols_by_name(struct dso *dso,\r\nenum map_type type, FILE *fp)\r\n{\r\nsize_t ret = 0;\r\nstruct rb_node *nd;\r\nstruct symbol_name_rb_node *pos;\r\nfor (nd = rb_first(&dso->symbol_names[type]); nd; nd = rb_next(nd)) {\r\npos = rb_entry(nd, struct symbol_name_rb_node, rb_node);\r\nfprintf(fp, "%s\n", pos->sym.name);\r\n}\r\nreturn ret;\r\n}
