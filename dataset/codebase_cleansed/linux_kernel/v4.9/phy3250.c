static int lpc32xx_clcd_setup(struct clcd_fb *fb)\r\n{\r\ndma_addr_t dma;\r\nfb->fb.screen_base = dma_alloc_wc(&fb->dev->dev, PANEL_SIZE, &dma,\r\nGFP_KERNEL);\r\nif (!fb->fb.screen_base) {\r\nprintk(KERN_ERR "CLCD: unable to map framebuffer\n");\r\nreturn -ENOMEM;\r\n}\r\nfb->fb.fix.smem_start = dma;\r\nfb->fb.fix.smem_len = PANEL_SIZE;\r\nfb->panel = &conn_lcd_panel;\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_clcd_mmap(struct clcd_fb *fb, struct vm_area_struct *vma)\r\n{\r\nreturn dma_mmap_wc(&fb->dev->dev, vma, fb->fb.screen_base,\r\nfb->fb.fix.smem_start, fb->fb.fix.smem_len);\r\n}\r\nstatic void lpc32xx_clcd_remove(struct clcd_fb *fb)\r\n{\r\ndma_free_wc(&fb->dev->dev, fb->fb.fix.smem_len, fb->fb.screen_base,\r\nfb->fb.fix.smem_start);\r\n}\r\nstatic int pl08x_get_signal(const struct pl08x_channel_data *cd)\r\n{\r\nreturn cd->min_signal;\r\n}\r\nstatic void pl08x_put_signal(const struct pl08x_channel_data *cd, int ch)\r\n{\r\n}\r\nstatic void __init lpc3250_machine_init(void)\r\n{\r\nu32 tmp;\r\ntmp = __raw_readl(LPC32XX_CLKPWR_LCDCLK_CTRL) &\r\n~(LPC32XX_CLKPWR_LCDCTRL_LCDTYPE_MSK |\r\nLPC32XX_CLKPWR_LCDCTRL_PSCALE_MSK);\r\ntmp |= LPC32XX_CLKPWR_LCDCTRL_LCDTYPE_TFT16;\r\n__raw_writel(tmp, LPC32XX_CLKPWR_LCDCLK_CTRL);\r\nlpc32xx_serial_init();\r\n__raw_writel(LPC32XX_CLKPWR_TESTCLK2_SEL_MOSC |\r\nLPC32XX_CLKPWR_TESTCLK_TESTCLK2_EN,\r\nLPC32XX_CLKPWR_TEST_CLK_SEL);\r\nof_platform_default_populate(NULL, lpc32xx_auxdata_lookup, NULL);\r\n}
