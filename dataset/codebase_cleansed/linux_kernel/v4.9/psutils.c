union acpi_parse_object *acpi_ps_create_scope_op(u8 *aml)\r\n{\r\nunion acpi_parse_object *scope_op;\r\nscope_op = acpi_ps_alloc_op(AML_SCOPE_OP, aml);\r\nif (!scope_op) {\r\nreturn (NULL);\r\n}\r\nscope_op->named.name = ACPI_ROOT_NAME;\r\nreturn (scope_op);\r\n}\r\nvoid acpi_ps_init_op(union acpi_parse_object *op, u16 opcode)\r\n{\r\nACPI_FUNCTION_ENTRY();\r\nop->common.descriptor_type = ACPI_DESC_TYPE_PARSER;\r\nop->common.aml_opcode = opcode;\r\nACPI_DISASM_ONLY_MEMBERS(strncpy(op->common.aml_op_name,\r\n(acpi_ps_get_opcode_info(opcode))->\r\nname, sizeof(op->common.aml_op_name)));\r\n}\r\nunion acpi_parse_object *acpi_ps_alloc_op(u16 opcode, u8 *aml)\r\n{\r\nunion acpi_parse_object *op;\r\nconst struct acpi_opcode_info *op_info;\r\nu8 flags = ACPI_PARSEOP_GENERIC;\r\nACPI_FUNCTION_ENTRY();\r\nop_info = acpi_ps_get_opcode_info(opcode);\r\nif (op_info->flags & AML_DEFER) {\r\nflags = ACPI_PARSEOP_DEFERRED;\r\n} else if (op_info->flags & AML_NAMED) {\r\nflags = ACPI_PARSEOP_NAMED_OBJECT;\r\n} else if (opcode == AML_INT_BYTELIST_OP) {\r\nflags = ACPI_PARSEOP_BYTELIST;\r\n}\r\nif (flags == ACPI_PARSEOP_GENERIC) {\r\nop = acpi_os_acquire_object(acpi_gbl_ps_node_cache);\r\n} else {\r\nop = acpi_os_acquire_object(acpi_gbl_ps_node_ext_cache);\r\n}\r\nif (op) {\r\nacpi_ps_init_op(op, opcode);\r\nop->common.aml = aml;\r\nop->common.flags = flags;\r\n}\r\nreturn (op);\r\n}\r\nvoid acpi_ps_free_op(union acpi_parse_object *op)\r\n{\r\nACPI_FUNCTION_NAME(ps_free_op);\r\nif (op->common.aml_opcode == AML_INT_RETURN_VALUE_OP) {\r\nACPI_DEBUG_PRINT((ACPI_DB_ALLOCATIONS,\r\n"Free retval op: %p\n", op));\r\n}\r\nif (op->common.flags & ACPI_PARSEOP_GENERIC) {\r\n(void)acpi_os_release_object(acpi_gbl_ps_node_cache, op);\r\n} else {\r\n(void)acpi_os_release_object(acpi_gbl_ps_node_ext_cache, op);\r\n}\r\n}\r\nu8 acpi_ps_is_leading_char(u32 c)\r\n{\r\nreturn ((u8) (c == '_' || (c >= 'A' && c <= 'Z')));\r\n}\r\nu32 acpi_ps_get_name(union acpi_parse_object * op)\r\n{\r\nif (op->common.flags & ACPI_PARSEOP_GENERIC) {\r\nreturn (0);\r\n}\r\nreturn (op->named.name);\r\n}\r\nvoid acpi_ps_set_name(union acpi_parse_object *op, u32 name)\r\n{\r\nif (op->common.flags & ACPI_PARSEOP_GENERIC) {\r\nreturn;\r\n}\r\nop->named.name = name;\r\n}
