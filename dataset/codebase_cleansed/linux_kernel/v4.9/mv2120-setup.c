static void mv2120_power_off(void)\r\n{\r\npr_info("%s: triggering power-off...\n", __func__);\r\ngpio_set_value(MV2120_GPIO_POWER_OFF, 0);\r\n}\r\nstatic void __init mv2120_init(void)\r\n{\r\norion5x_init();\r\norion5x_mpp_conf(mv2120_mpp_modes);\r\norion5x_ehci0_init();\r\norion5x_ehci1_init();\r\norion5x_eth_init(&mv2120_eth_data);\r\norion5x_i2c_init();\r\norion5x_sata_init(&mv2120_sata_data);\r\norion5x_uart0_init();\r\norion5x_xor_init();\r\nmvebu_mbus_add_window_by_id(ORION_MBUS_DEVBUS_BOOT_TARGET,\r\nORION_MBUS_DEVBUS_BOOT_ATTR,\r\nMV2120_NOR_BOOT_BASE,\r\nMV2120_NOR_BOOT_SIZE);\r\nplatform_device_register(&mv2120_nor_flash);\r\nplatform_device_register(&mv2120_button_device);\r\nif (gpio_request(MV2120_GPIO_RTC_IRQ, "rtc") == 0) {\r\nif (gpio_direction_input(MV2120_GPIO_RTC_IRQ) == 0)\r\nmv2120_i2c_rtc.irq = gpio_to_irq(MV2120_GPIO_RTC_IRQ);\r\nelse\r\ngpio_free(MV2120_GPIO_RTC_IRQ);\r\n}\r\ni2c_register_board_info(0, &mv2120_i2c_rtc, 1);\r\nplatform_device_register(&mv2120_leds);\r\nif (gpio_request(MV2120_GPIO_POWER_OFF, "POWEROFF") != 0 ||\r\ngpio_direction_output(MV2120_GPIO_POWER_OFF, 1) != 0)\r\npr_err("mv2120: failed to setup power-off GPIO\n");\r\npm_power_off = mv2120_power_off;\r\n}
