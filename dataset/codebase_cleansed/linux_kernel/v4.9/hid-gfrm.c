static int gfrm_input_mapping(struct hid_device *hdev, struct hid_input *hi,\r\nstruct hid_field *field, struct hid_usage *usage,\r\nunsigned long **bit, int *max)\r\n{\r\nunsigned long hdev_type = (unsigned long) hid_get_drvdata(hdev);\r\nif (hdev_type == GFRM100) {\r\nif (usage->hid == (HID_UP_CONSUMER | 0x4)) {\r\nhid_map_usage_clear(hi, usage, bit, max, EV_KEY, KEY_INFO);\r\nreturn 1;\r\n}\r\nif (usage->hid == (HID_UP_CONSUMER | 0x41)) {\r\nhid_map_usage_clear(hi, usage, bit, max, EV_KEY, KEY_OK);\r\nreturn 1;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int gfrm_raw_event(struct hid_device *hdev, struct hid_report *report,\r\nu8 *data, int size)\r\n{\r\nunsigned long hdev_type = (unsigned long) hid_get_drvdata(hdev);\r\nint ret = 0;\r\nif (hdev_type != GFRM100)\r\nreturn 0;\r\nif (size < 2 || data[0] != GFRM100_SEARCH_KEY_REPORT_ID)\r\nreturn 0;\r\nswitch (data[1]) {\r\ncase GFRM100_SEARCH_KEY_DOWN:\r\nret = hid_report_raw_event(hdev, HID_INPUT_REPORT, search_key_dn,\r\nsizeof(search_key_dn), 1);\r\nbreak;\r\ncase GFRM100_SEARCH_KEY_AUDIO_DATA:\r\nbreak;\r\ncase GFRM100_SEARCH_KEY_UP:\r\nret = hid_report_raw_event(hdev, HID_INPUT_REPORT, search_key_up,\r\nsizeof(search_key_up), 1);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn (ret < 0) ? ret : -1;\r\n}\r\nstatic int gfrm_input_configured(struct hid_device *hid, struct hid_input *hidinput)\r\n{\r\ninput_enable_softrepeat(hidinput->input, 400, 100);\r\nreturn 0;\r\n}\r\nstatic int gfrm_probe(struct hid_device *hdev, const struct hid_device_id *id)\r\n{\r\nint ret;\r\nhid_set_drvdata(hdev, (void *) id->driver_data);\r\nret = hid_parse(hdev);\r\nif (ret)\r\ngoto done;\r\nif (id->driver_data == GFRM100) {\r\nif (!hid_register_report(hdev, HID_INPUT_REPORT,\r\nGFRM100_SEARCH_KEY_REPORT_ID)) {\r\nret = -ENOMEM;\r\ngoto done;\r\n}\r\n}\r\nret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\r\ndone:\r\nreturn ret;\r\n}\r\nstatic void gfrm_remove(struct hid_device *hdev)\r\n{\r\nhid_hw_stop(hdev);\r\nhid_set_drvdata(hdev, NULL);\r\n}
