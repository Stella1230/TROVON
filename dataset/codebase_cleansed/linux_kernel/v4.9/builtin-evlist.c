static int __cmd_evlist(const char *file_name, struct perf_attr_details *details)\r\n{\r\nstruct perf_session *session;\r\nstruct perf_evsel *pos;\r\nstruct perf_data_file file = {\r\n.path = file_name,\r\n.mode = PERF_DATA_MODE_READ,\r\n.force = details->force,\r\n};\r\nbool has_tracepoint = false;\r\nsession = perf_session__new(&file, 0, NULL);\r\nif (session == NULL)\r\nreturn -1;\r\nevlist__for_each_entry(session->evlist, pos) {\r\nperf_evsel__fprintf(pos, details, stdout);\r\nif (pos->attr.type == PERF_TYPE_TRACEPOINT)\r\nhas_tracepoint = true;\r\n}\r\nif (has_tracepoint && !details->trace_fields)\r\nprintf("# Tip: use 'perf evlist --trace-fields' to show fields for tracepoint events\n");\r\nperf_session__delete(session);\r\nreturn 0;\r\n}\r\nint cmd_evlist(int argc, const char **argv, const char *prefix __maybe_unused)\r\n{\r\nstruct perf_attr_details details = { .verbose = false, };\r\nconst struct option options[] = {\r\nOPT_STRING('i', "input", &input_name, "file", "Input file name"),\r\nOPT_BOOLEAN('F', "freq", &details.freq, "Show the sample frequency"),\r\nOPT_BOOLEAN('v', "verbose", &details.verbose,\r\n"Show all event attr details"),\r\nOPT_BOOLEAN('g', "group", &details.event_group,\r\n"Show event group information"),\r\nOPT_BOOLEAN('f', "force", &details.force, "don't complain, do it"),\r\nOPT_BOOLEAN(0, "trace-fields", &details.trace_fields, "Show tracepoint fields"),\r\nOPT_END()\r\n};\r\nconst char * const evlist_usage[] = {\r\n"perf evlist [<options>]",\r\nNULL\r\n};\r\nargc = parse_options(argc, argv, options, evlist_usage, 0);\r\nif (argc)\r\nusage_with_options(evlist_usage, options);\r\nif (details.event_group && (details.verbose || details.freq)) {\r\nusage_with_options_msg(evlist_usage, options,\r\n"--group option is not compatible with other options\n");\r\n}\r\nreturn __cmd_evlist(input_name, &details);\r\n}
