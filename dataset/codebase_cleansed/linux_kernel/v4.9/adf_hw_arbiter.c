int adf_init_arb(struct adf_accel_dev *accel_dev)\r\n{\r\nstruct adf_hw_device_data *hw_data = accel_dev->hw_device;\r\nvoid __iomem *csr = accel_dev->transport->banks[0].csr_addr;\r\nu32 arb_cfg = 0x1 << 31 | 0x4 << 4 | 0x1;\r\nu32 arb, i;\r\nconst u32 *thd_2_arb_cfg;\r\nfor (arb = 0; arb < ADF_ARB_NUM; arb++)\r\nWRITE_CSR_ARB_SARCONFIG(csr, arb, arb_cfg);\r\nfor (i = 0; i < hw_data->num_engines; i++)\r\nWRITE_CSR_ARB_WQCFG(csr, i, i);\r\nhw_data->get_arb_mapping(accel_dev, &thd_2_arb_cfg);\r\nif (!thd_2_arb_cfg)\r\nreturn -EFAULT;\r\nfor (i = 0; i < hw_data->num_engines; i++)\r\nWRITE_CSR_ARB_WRK_2_SER_MAP(csr, i, *(thd_2_arb_cfg + i));\r\nreturn 0;\r\n}\r\nvoid adf_update_ring_arb(struct adf_etr_ring_data *ring)\r\n{\r\nWRITE_CSR_ARB_RINGSRVARBEN(ring->bank->csr_addr,\r\nring->bank->bank_number,\r\nring->bank->ring_mask & 0xFF);\r\n}\r\nvoid adf_exit_arb(struct adf_accel_dev *accel_dev)\r\n{\r\nstruct adf_hw_device_data *hw_data = accel_dev->hw_device;\r\nvoid __iomem *csr;\r\nunsigned int i;\r\nif (!accel_dev->transport)\r\nreturn;\r\ncsr = accel_dev->transport->banks[0].csr_addr;\r\nfor (i = 0; i < ADF_ARB_NUM; i++)\r\nWRITE_CSR_ARB_SARCONFIG(csr, i, 0);\r\nfor (i = 0; i < hw_data->num_engines; i++)\r\nWRITE_CSR_ARB_WQCFG(csr, i, 0);\r\nfor (i = 0; i < hw_data->num_engines; i++)\r\nWRITE_CSR_ARB_WRK_2_SER_MAP(csr, i, 0);\r\nfor (i = 0; i < GET_MAX_BANKS(accel_dev); i++)\r\nWRITE_CSR_ARB_RINGSRVARBEN(csr, i, 0);\r\n}
