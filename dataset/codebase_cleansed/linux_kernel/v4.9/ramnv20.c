int\r\nnv20_ram_new(struct nvkm_fb *fb, struct nvkm_ram **pram)\r\n{\r\nstruct nvkm_device *device = fb->subdev.device;\r\nu32 pbus1218 = nvkm_rd32(device, 0x001218);\r\nu32 size = (nvkm_rd32(device, 0x10020c) & 0xff000000);\r\nu32 tags = nvkm_rd32(device, 0x100320);\r\nenum nvkm_ram_type type = NVKM_RAM_TYPE_UNKNOWN;\r\nint ret;\r\nswitch (pbus1218 & 0x00000300) {\r\ncase 0x00000000: type = NVKM_RAM_TYPE_SDRAM; break;\r\ncase 0x00000100: type = NVKM_RAM_TYPE_DDR1 ; break;\r\ncase 0x00000200: type = NVKM_RAM_TYPE_GDDR3; break;\r\ncase 0x00000300: type = NVKM_RAM_TYPE_GDDR2; break;\r\n}\r\nret = nvkm_ram_new_(&nv04_ram_func, fb, type, size, tags, pram);\r\nif (ret)\r\nreturn ret;\r\n(*pram)->parts = (nvkm_rd32(device, 0x100200) & 0x00000003) + 1;\r\nreturn 0;\r\n}
