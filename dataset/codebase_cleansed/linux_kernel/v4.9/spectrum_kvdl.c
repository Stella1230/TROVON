int mlxsw_sp_kvdl_alloc(struct mlxsw_sp *mlxsw_sp, unsigned int entry_count)\r\n{\r\nint entry_index;\r\nint size;\r\nint type_base;\r\nint type_size;\r\nint type_entries;\r\nif (entry_count == 0 || entry_count > MLXSW_SP_CHUNK_MAX) {\r\nreturn -EINVAL;\r\n} else if (entry_count == 1) {\r\ntype_base = MLXSW_SP_KVDL_SINGLE_BASE;\r\ntype_size = MLXSW_SP_KVDL_SINGLE_SIZE;\r\ntype_entries = 1;\r\n} else {\r\ntype_base = MLXSW_SP_KVDL_CHUNKS_BASE;\r\ntype_size = MLXSW_SP_KVDL_CHUNKS_SIZE;\r\ntype_entries = MLXSW_SP_CHUNK_MAX;\r\n}\r\nentry_index = type_base;\r\nsize = type_base + type_size;\r\nfor_each_clear_bit_from(entry_index, mlxsw_sp->kvdl.usage, size) {\r\nint i;\r\nfor (i = 0; i < type_entries; i++)\r\nset_bit(entry_index + i, mlxsw_sp->kvdl.usage);\r\nreturn entry_index;\r\n}\r\nreturn -ENOBUFS;\r\n}\r\nvoid mlxsw_sp_kvdl_free(struct mlxsw_sp *mlxsw_sp, int entry_index)\r\n{\r\nint type_entries;\r\nint i;\r\nif (entry_index < MLXSW_SP_KVDL_CHUNKS_BASE)\r\ntype_entries = 1;\r\nelse\r\ntype_entries = MLXSW_SP_CHUNK_MAX;\r\nfor (i = 0; i < type_entries; i++)\r\nclear_bit(entry_index + i, mlxsw_sp->kvdl.usage);\r\n}
