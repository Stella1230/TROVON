int\r\nnv1a_ram_new(struct nvkm_fb *fb, struct nvkm_ram **pram)\r\n{\r\nstruct pci_dev *bridge;\r\nu32 mem, mib;\r\nbridge = pci_get_bus_and_slot(0, PCI_DEVFN(0, 1));\r\nif (!bridge) {\r\nnvkm_error(&fb->subdev, "no bridge device\n");\r\nreturn -ENODEV;\r\n}\r\nif (fb->subdev.device->chipset == 0x1a) {\r\npci_read_config_dword(bridge, 0x7c, &mem);\r\nmib = ((mem >> 6) & 31) + 1;\r\n} else {\r\npci_read_config_dword(bridge, 0x84, &mem);\r\nmib = ((mem >> 4) & 127) + 1;\r\n}\r\nreturn nvkm_ram_new_(&nv04_ram_func, fb, NVKM_RAM_TYPE_STOLEN,\r\nmib * 1024 * 1024, 0, pram);\r\n}
