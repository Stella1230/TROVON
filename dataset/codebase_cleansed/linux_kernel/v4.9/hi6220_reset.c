static int hi6220_peripheral_assert(struct reset_controller_dev *rc_dev,\r\nunsigned long idx)\r\n{\r\nstruct hi6220_reset_data *data = to_reset_data(rc_dev);\r\nstruct regmap *regmap = data->regmap;\r\nu32 bank = idx >> 8;\r\nu32 offset = idx & 0xff;\r\nu32 reg = PERIPH_ASSERT_OFFSET + bank * 0x10;\r\nreturn regmap_write(regmap, reg, BIT(offset));\r\n}\r\nstatic int hi6220_peripheral_deassert(struct reset_controller_dev *rc_dev,\r\nunsigned long idx)\r\n{\r\nstruct hi6220_reset_data *data = to_reset_data(rc_dev);\r\nstruct regmap *regmap = data->regmap;\r\nu32 bank = idx >> 8;\r\nu32 offset = idx & 0xff;\r\nu32 reg = PERIPH_DEASSERT_OFFSET + bank * 0x10;\r\nreturn regmap_write(regmap, reg, BIT(offset));\r\n}\r\nstatic int hi6220_media_assert(struct reset_controller_dev *rc_dev,\r\nunsigned long idx)\r\n{\r\nstruct hi6220_reset_data *data = to_reset_data(rc_dev);\r\nstruct regmap *regmap = data->regmap;\r\nreturn regmap_write(regmap, SC_MEDIA_RSTEN, BIT(idx));\r\n}\r\nstatic int hi6220_media_deassert(struct reset_controller_dev *rc_dev,\r\nunsigned long idx)\r\n{\r\nstruct hi6220_reset_data *data = to_reset_data(rc_dev);\r\nstruct regmap *regmap = data->regmap;\r\nreturn regmap_write(regmap, SC_MEDIA_RSTDIS, BIT(idx));\r\n}\r\nstatic int hi6220_reset_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np = pdev->dev.of_node;\r\nstruct device *dev = &pdev->dev;\r\nenum hi6220_reset_ctrl_type type;\r\nstruct hi6220_reset_data *data;\r\nstruct regmap *regmap;\r\ndata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\r\nif (!data)\r\nreturn -ENOMEM;\r\ntype = (enum hi6220_reset_ctrl_type)of_device_get_match_data(dev);\r\nregmap = syscon_node_to_regmap(np);\r\nif (IS_ERR(regmap)) {\r\ndev_err(dev, "failed to get reset controller regmap\n");\r\nreturn PTR_ERR(regmap);\r\n}\r\ndata->regmap = regmap;\r\ndata->rc_dev.of_node = np;\r\nif (type == MEDIA) {\r\ndata->rc_dev.ops = &hi6220_media_reset_ops;\r\ndata->rc_dev.nr_resets = MEDIA_MAX_INDEX;\r\n} else {\r\ndata->rc_dev.ops = &hi6220_peripheral_reset_ops;\r\ndata->rc_dev.nr_resets = PERIPH_MAX_INDEX;\r\n}\r\nreturn reset_controller_register(&data->rc_dev);\r\n}\r\nstatic int __init hi6220_reset_init(void)\r\n{\r\nreturn platform_driver_register(&hi6220_reset_driver);\r\n}
