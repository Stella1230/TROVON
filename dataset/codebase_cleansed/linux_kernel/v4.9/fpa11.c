static void resetFPA11(void)\r\n{\r\nint i;\r\nFPA11 *fpa11 = GET_FPA11();\r\nfor (i = 0; i <= 7; i++) {\r\nfpa11->fType[i] = typeNone;\r\n}\r\nfpa11->fpsr = FP_EMULATOR | BIT_AC;\r\n}\r\nint8 SetRoundingMode(const unsigned int opcode)\r\n{\r\nswitch (opcode & MASK_ROUNDING_MODE) {\r\ndefault:\r\ncase ROUND_TO_NEAREST:\r\nreturn float_round_nearest_even;\r\ncase ROUND_TO_PLUS_INFINITY:\r\nreturn float_round_up;\r\ncase ROUND_TO_MINUS_INFINITY:\r\nreturn float_round_down;\r\ncase ROUND_TO_ZERO:\r\nreturn float_round_to_zero;\r\n}\r\n}\r\nint8 SetRoundingPrecision(const unsigned int opcode)\r\n{\r\n#ifdef CONFIG_FPE_NWFPE_XP\r\nswitch (opcode & MASK_ROUNDING_PRECISION) {\r\ncase ROUND_SINGLE:\r\nreturn 32;\r\ncase ROUND_DOUBLE:\r\nreturn 64;\r\ncase ROUND_EXTENDED:\r\nreturn 80;\r\ndefault:\r\nreturn 80;\r\n}\r\n#endif\r\nreturn 80;\r\n}\r\nvoid nwfpe_init_fpa(union fp_state *fp)\r\n{\r\nFPA11 *fpa11 = (FPA11 *)fp;\r\n#ifdef NWFPE_DEBUG\r\nprintk("NWFPE: setting up state.\n");\r\n#endif\r\nmemset(fpa11, 0, sizeof(FPA11));\r\nresetFPA11();\r\nfpa11->initflag = 1;\r\n}\r\nunsigned int EmulateAll(unsigned int opcode)\r\n{\r\nunsigned int code;\r\n#ifdef NWFPE_DEBUG\r\nprintk("NWFPE: emulating opcode %08x\n", opcode);\r\n#endif\r\ncode = opcode & 0x00000f00;\r\nif (code == 0x00000100 || code == 0x00000200) {\r\ncode = opcode & 0x0e000000;\r\nif (code == 0x0e000000) {\r\nif (opcode & 0x00000010) {\r\nreturn EmulateCPRT(opcode);\r\n} else {\r\nreturn EmulateCPDO(opcode);\r\n}\r\n} else if (code == 0x0c000000) {\r\nreturn EmulateCPDT(opcode);\r\n}\r\n}\r\nreturn 0;\r\n}
