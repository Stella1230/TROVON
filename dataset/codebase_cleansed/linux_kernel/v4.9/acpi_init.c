static int __init register_acpi_resource(void)\r\n{\r\nrequest_region(SBX00_ACPI_IO_BASE, SBX00_ACPI_IO_SIZE, "acpi");\r\nreturn 0;\r\n}\r\nstatic void pmio_write_index(u16 index, u8 reg, u8 value)\r\n{\r\noutb(reg, index);\r\noutb(value, index + 1);\r\n}\r\nstatic u8 pmio_read_index(u16 index, u8 reg)\r\n{\r\noutb(reg, index);\r\nreturn inb(index + 1);\r\n}\r\nvoid pm_iowrite(u8 reg, u8 value)\r\n{\r\npmio_write_index(PM_INDEX, reg, value);\r\n}\r\nu8 pm_ioread(u8 reg)\r\n{\r\nreturn pmio_read_index(PM_INDEX, reg);\r\n}\r\nvoid pm2_iowrite(u8 reg, u8 value)\r\n{\r\npmio_write_index(PM2_INDEX, reg, value);\r\n}\r\nu8 pm2_ioread(u8 reg)\r\n{\r\nreturn pmio_read_index(PM2_INDEX, reg);\r\n}\r\nstatic void acpi_hw_clear_status(void)\r\n{\r\nu16 value;\r\nvalue = inw(ACPI_PM_EVT_BLK);\r\nvalue |= (1 << 8 | 1 << 15);\r\noutw(value, ACPI_PM_EVT_BLK);\r\noutl(inl(ACPI_GPE0_BLK), ACPI_GPE0_BLK);\r\n}\r\nvoid acpi_registers_setup(void)\r\n{\r\nu32 value;\r\npm_iowrite(0x20, ACPI_PM_EVT_BLK & 0xff);\r\npm_iowrite(0x21, ACPI_PM_EVT_BLK >> 8);\r\npm_iowrite(0x22, ACPI_PM_CNT_BLK & 0xff);\r\npm_iowrite(0x23, ACPI_PM_CNT_BLK >> 8);\r\npm_iowrite(0x28, ACPI_GPE0_BLK & 0xff);\r\npm_iowrite(0x29, ACPI_GPE0_BLK >> 8);\r\npm_iowrite(0x2e, ACPI_END & 0xff);\r\npm_iowrite(0x2f, ACPI_END >> 8);\r\npm_iowrite(0x0e, 1 << 3);\r\noutw(1, ACPI_PM_CNT_BLK);\r\npm_iowrite(0x10, pm_ioread(0x10) | 1);\r\nvalue = inl(ACPI_GPE0_BLK + 4);\r\noutl(value | (1 << 14) | (1 << 22), ACPI_GPE0_BLK + 4);\r\npm_iowrite(0x8d, pm_ioread(0x8d) & (~(1 << 1)));\r\npm_iowrite(0x94, pm_ioread(0x94) | (1 << 3));\r\npm_iowrite(0x33, pm_ioread(0x33) & (~(3 << 4)));\r\npm_iowrite(0x3d, pm_ioread(0x3d) & (~(3 << 2)));\r\npm_iowrite(0x37, pm_ioread(0x37) & (~(1 << 6)));\r\npm_iowrite(0x7c, pm_ioread(0x7c) | (1 << 6));\r\nvalue = pm2_ioread(0xf6);\r\nvalue |= ((1 << 7) | (1 << 3));\r\npm2_iowrite(0xf6, value);\r\nvalue = pm2_ioread(0xf8);\r\nvalue |= ((1 << 5) | (1 << 1));\r\npm2_iowrite(0xf8, value);\r\n}\r\nint __init sbx00_acpi_init(void)\r\n{\r\nregister_acpi_resource();\r\nacpi_registers_setup();\r\nacpi_hw_clear_status();\r\nreturn 0;\r\n}
