static void tse_get_drvinfo(struct net_device *dev,\r\nstruct ethtool_drvinfo *info)\r\n{\r\nstruct altera_tse_private *priv = netdev_priv(dev);\r\nu32 rev = ioread32(&priv->mac_dev->megacore_revision);\r\nstrcpy(info->driver, "altera_tse");\r\nstrcpy(info->version, "v8.0");\r\nsnprintf(info->fw_version, ETHTOOL_FWVERS_LEN, "v%d.%d",\r\nrev & 0xFFFF, (rev & 0xFFFF0000) >> 16);\r\nsprintf(info->bus_info, "platform");\r\n}\r\nstatic void tse_gstrings(struct net_device *dev, u32 stringset, u8 *buf)\r\n{\r\nmemcpy(buf, stat_gstrings, TSE_STATS_LEN * ETH_GSTRING_LEN);\r\n}\r\nstatic void tse_fill_stats(struct net_device *dev, struct ethtool_stats *dummy,\r\nu64 *buf)\r\n{\r\nstruct altera_tse_private *priv = netdev_priv(dev);\r\nu64 ext;\r\nbuf[0] = csrrd32(priv->mac_dev,\r\ntse_csroffs(frames_transmitted_ok));\r\nbuf[1] = csrrd32(priv->mac_dev,\r\ntse_csroffs(frames_received_ok));\r\nbuf[2] = csrrd32(priv->mac_dev,\r\ntse_csroffs(frames_check_sequence_errors));\r\nbuf[3] = csrrd32(priv->mac_dev,\r\ntse_csroffs(alignment_errors));\r\next = (u64) csrrd32(priv->mac_dev,\r\ntse_csroffs(msb_octets_transmitted_ok)) << 32;\r\next |= csrrd32(priv->mac_dev,\r\ntse_csroffs(octets_transmitted_ok));\r\nbuf[4] = ext;\r\next = (u64) csrrd32(priv->mac_dev,\r\ntse_csroffs(msb_octets_received_ok)) << 32;\r\next |= csrrd32(priv->mac_dev,\r\ntse_csroffs(octets_received_ok));\r\nbuf[5] = ext;\r\nbuf[6] = csrrd32(priv->mac_dev,\r\ntse_csroffs(tx_pause_mac_ctrl_frames));\r\nbuf[7] = csrrd32(priv->mac_dev,\r\ntse_csroffs(rx_pause_mac_ctrl_frames));\r\nbuf[8] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_in_errors));\r\nbuf[9] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_out_errors));\r\nbuf[10] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_in_ucast_pkts));\r\nbuf[11] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_in_multicast_pkts));\r\nbuf[12] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_in_broadcast_pkts));\r\nbuf[13] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_out_discards));\r\nbuf[14] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_out_ucast_pkts));\r\nbuf[15] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_out_multicast_pkts));\r\nbuf[16] = csrrd32(priv->mac_dev,\r\ntse_csroffs(if_out_broadcast_pkts));\r\nbuf[17] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_drop_events));\r\next = (u64) csrrd32(priv->mac_dev,\r\ntse_csroffs(msb_ether_stats_octets)) << 32;\r\next |= csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_octets));\r\nbuf[18] = ext;\r\nbuf[19] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts));\r\nbuf[20] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_undersize_pkts));\r\nbuf[21] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_oversize_pkts));\r\nbuf[22] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_64_octets));\r\nbuf[23] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_65to127_octets));\r\nbuf[24] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_128to255_octets));\r\nbuf[25] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_256to511_octets));\r\nbuf[26] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_512to1023_octets));\r\nbuf[27] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_1024to1518_octets));\r\nbuf[28] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_pkts_1519tox_octets));\r\nbuf[29] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_jabbers));\r\nbuf[30] = csrrd32(priv->mac_dev,\r\ntse_csroffs(ether_stats_fragments));\r\n}\r\nstatic int tse_sset_count(struct net_device *dev, int sset)\r\n{\r\nswitch (sset) {\r\ncase ETH_SS_STATS:\r\nreturn TSE_STATS_LEN;\r\ndefault:\r\nreturn -EOPNOTSUPP;\r\n}\r\n}\r\nstatic u32 tse_get_msglevel(struct net_device *dev)\r\n{\r\nstruct altera_tse_private *priv = netdev_priv(dev);\r\nreturn priv->msg_enable;\r\n}\r\nstatic void tse_set_msglevel(struct net_device *dev, uint32_t data)\r\n{\r\nstruct altera_tse_private *priv = netdev_priv(dev);\r\npriv->msg_enable = data;\r\n}\r\nstatic int tse_reglen(struct net_device *dev)\r\n{\r\nreturn TSE_NUM_REGS * sizeof(u32);\r\n}\r\nstatic void tse_get_regs(struct net_device *dev, struct ethtool_regs *regs,\r\nvoid *regbuf)\r\n{\r\nint i;\r\nstruct altera_tse_private *priv = netdev_priv(dev);\r\nu32 *buf = regbuf;\r\nregs->version = 1;\r\nfor (i = 0; i < TSE_NUM_REGS; i++)\r\nbuf[i] = csrrd32(priv->mac_dev, i * 4);\r\n}\r\nvoid altera_tse_set_ethtool_ops(struct net_device *netdev)\r\n{\r\nnetdev->ethtool_ops = &tse_ethtool_ops;\r\n}
