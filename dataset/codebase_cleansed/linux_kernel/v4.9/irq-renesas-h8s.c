static void h8s_disable_irq(struct irq_data *data)\r\n{\r\nint pos;\r\nunsigned int addr;\r\nunsigned short pri;\r\nint irq = data->irq;\r\naddr = IPRA + ((ipr_table[irq - 16] & 0xf0) >> 3);\r\npos = (ipr_table[irq - 16] & 0x0f) * 4;\r\npri = ~(0x000f << pos);\r\npri &= readw(addr);\r\nwritew(pri, addr);\r\n}\r\nstatic void h8s_enable_irq(struct irq_data *data)\r\n{\r\nint pos;\r\nunsigned int addr;\r\nunsigned short pri;\r\nint irq = data->irq;\r\naddr = IPRA + ((ipr_table[irq - 16] & 0xf0) >> 3);\r\npos = (ipr_table[irq - 16] & 0x0f) * 4;\r\npri = ~(0x000f << pos);\r\npri &= readw(addr);\r\npri |= 1 << pos;\r\nwritew(pri, addr);\r\n}\r\nstatic __init int irq_map(struct irq_domain *h, unsigned int virq,\r\nirq_hw_number_t hw_irq_num)\r\n{\r\nirq_set_chip_and_handler(virq, &h8s_irq_chip, handle_simple_irq);\r\nreturn 0;\r\n}\r\nstatic int __init h8s_intc_of_init(struct device_node *intc,\r\nstruct device_node *parent)\r\n{\r\nstruct irq_domain *domain;\r\nint n;\r\nintc_baseaddr = of_iomap(intc, 0);\r\nBUG_ON(!intc_baseaddr);\r\nfor (n = 0; n <= 'k' - 'a'; n++)\r\nwritew(0x0000, IPRA + (n * 2));\r\ndomain = irq_domain_add_linear(intc, NR_IRQS, &irq_ops, NULL);\r\nBUG_ON(!domain);\r\nirq_set_default_host(domain);\r\nreturn 0;\r\n}
