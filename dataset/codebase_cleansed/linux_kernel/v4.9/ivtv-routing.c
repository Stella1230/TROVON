void ivtv_audio_set_io(struct ivtv *itv)\r\n{\r\nconst struct ivtv_card_audio_input *in;\r\nu32 input, output = 0;\r\nif (test_bit(IVTV_F_I_RADIO_USER, &itv->i_flags))\r\nin = &itv->card->radio_input;\r\nelse\r\nin = &itv->card->audio_inputs[itv->audio_input];\r\ninput = in->muxer_input;\r\nif (itv->card->hw_muxer & IVTV_HW_M52790)\r\noutput = M52790_OUT_STEREO;\r\nv4l2_subdev_call(itv->sd_muxer, audio, s_routing,\r\ninput, output, 0);\r\ninput = in->audio_input;\r\noutput = 0;\r\nif (itv->card->hw_audio & IVTV_HW_MSP34XX)\r\noutput = MSP_OUTPUT(MSP_SC_IN_DSP_SCART1);\r\nivtv_call_hw(itv, itv->card->hw_audio, audio, s_routing,\r\ninput, output, 0);\r\n}\r\nvoid ivtv_video_set_io(struct ivtv *itv)\r\n{\r\nint inp = itv->active_input;\r\nu32 input;\r\nu32 type;\r\nv4l2_subdev_call(itv->sd_video, video, s_routing,\r\nitv->card->video_inputs[inp].video_input, 0, 0);\r\ntype = itv->card->video_inputs[inp].video_type;\r\nif (type == IVTV_CARD_INPUT_VID_TUNER) {\r\ninput = 0;\r\n} else if (type < IVTV_CARD_INPUT_COMPOSITE1) {\r\ninput = 2;\r\n} else {\r\ninput = 1;\r\n}\r\nif (itv->card->hw_video & IVTV_HW_GPIO)\r\nivtv_call_hw(itv, IVTV_HW_GPIO, video, s_routing,\r\ninput, 0, 0);\r\nif (itv->card->hw_video & IVTV_HW_UPD64031A) {\r\nif (type == IVTV_CARD_INPUT_VID_TUNER ||\r\ntype >= IVTV_CARD_INPUT_COMPOSITE1) {\r\ninput = UPD64031A_GR_ON | UPD64031A_3DYCS_COMPOSITE;\r\n} else {\r\ninput = UPD64031A_GR_OFF | UPD64031A_3DYCS_DISABLE;\r\n}\r\ninput |= itv->card->gr_config;\r\nivtv_call_hw(itv, IVTV_HW_UPD64031A, video, s_routing,\r\ninput, 0, 0);\r\n}\r\nif (itv->card->hw_video & IVTV_HW_UPD6408X) {\r\ninput = UPD64083_YCS_MODE;\r\nif (type > IVTV_CARD_INPUT_VID_TUNER &&\r\ntype < IVTV_CARD_INPUT_COMPOSITE1) {\r\ninput |= UPD64083_YCNR_MODE;\r\n}\r\nelse if (itv->card->hw_video & IVTV_HW_UPD64031A) {\r\nif (type == IVTV_CARD_INPUT_VID_TUNER ||\r\nitv->card->type == IVTV_CARD_CX23416GYC) {\r\ninput |= UPD64083_EXT_Y_ADC;\r\n}\r\n}\r\nivtv_call_hw(itv, IVTV_HW_UPD6408X, video, s_routing,\r\ninput, 0, 0);\r\n}\r\n}
