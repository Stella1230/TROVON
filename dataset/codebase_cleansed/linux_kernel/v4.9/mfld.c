static void mfld_power_off(void)\r\n{\r\n}\r\nstatic unsigned long __init mfld_calibrate_tsc(void)\r\n{\r\nunsigned long fast_calibrate;\r\nu32 lo, hi, ratio, fsb;\r\nrdmsr(MSR_IA32_PERF_STATUS, lo, hi);\r\npr_debug("IA32 perf status is 0x%x, 0x%0x\n", lo, hi);\r\nratio = (hi >> 8) & 0x1f;\r\npr_debug("ratio is %d\n", ratio);\r\nif (!ratio) {\r\npr_err("read a zero ratio, should be incorrect!\n");\r\npr_err("force tsc ratio to 16 ...\n");\r\nratio = 16;\r\n}\r\nrdmsr(MSR_FSB_FREQ, lo, hi);\r\nif ((lo & 0x7) == 0x7)\r\nfsb = FSB_FREQ_83SKU;\r\nelse\r\nfsb = FSB_FREQ_100SKU;\r\nfast_calibrate = ratio * fsb;\r\npr_debug("read penwell tsc %lu khz\n", fast_calibrate);\r\nlapic_timer_frequency = fsb * 1000 / HZ;\r\nset_cpu_cap(&boot_cpu_data, X86_FEATURE_TSC_RELIABLE);\r\nreturn fast_calibrate;\r\n}\r\nstatic void __init penwell_arch_setup(void)\r\n{\r\nx86_platform.calibrate_tsc = mfld_calibrate_tsc;\r\npm_power_off = mfld_power_off;\r\n}\r\nvoid *get_penwell_ops(void)\r\n{\r\nreturn &penwell_ops;\r\n}\r\nvoid *get_cloverview_ops(void)\r\n{\r\nreturn &penwell_ops;\r\n}
