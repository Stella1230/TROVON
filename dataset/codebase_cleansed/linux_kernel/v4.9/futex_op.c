static size_t syscall_arg__scnprintf_futex_op(char *bf, size_t size, struct syscall_arg *arg)\r\n{\r\nenum syscall_futex_args {\r\nSCF_UADDR = (1 << 0),\r\nSCF_OP = (1 << 1),\r\nSCF_VAL = (1 << 2),\r\nSCF_TIMEOUT = (1 << 3),\r\nSCF_UADDR2 = (1 << 4),\r\nSCF_VAL3 = (1 << 5),\r\n};\r\nint op = arg->val;\r\nint cmd = op & FUTEX_CMD_MASK;\r\nsize_t printed = 0;\r\nswitch (cmd) {\r\n#define P_FUTEX_OP(n) case FUTEX_##n: printed = scnprintf(bf, size, #n);\r\nP_FUTEX_OP(WAIT); arg->mask |= SCF_VAL3|SCF_UADDR2; break;\r\nP_FUTEX_OP(WAKE); arg->mask |= SCF_VAL3|SCF_UADDR2|SCF_TIMEOUT; break;\r\nP_FUTEX_OP(FD); arg->mask |= SCF_VAL3|SCF_UADDR2|SCF_TIMEOUT; break;\r\nP_FUTEX_OP(REQUEUE); arg->mask |= SCF_VAL3|SCF_TIMEOUT; break;\r\nP_FUTEX_OP(CMP_REQUEUE); arg->mask |= SCF_TIMEOUT; break;\r\nP_FUTEX_OP(CMP_REQUEUE_PI); arg->mask |= SCF_TIMEOUT; break;\r\nP_FUTEX_OP(WAKE_OP); break;\r\nP_FUTEX_OP(LOCK_PI); arg->mask |= SCF_VAL3|SCF_UADDR2|SCF_TIMEOUT; break;\r\nP_FUTEX_OP(UNLOCK_PI); arg->mask |= SCF_VAL3|SCF_UADDR2|SCF_TIMEOUT; break;\r\nP_FUTEX_OP(TRYLOCK_PI); arg->mask |= SCF_VAL3|SCF_UADDR2; break;\r\nP_FUTEX_OP(WAIT_BITSET); arg->mask |= SCF_UADDR2; break;\r\nP_FUTEX_OP(WAKE_BITSET); arg->mask |= SCF_UADDR2; break;\r\nP_FUTEX_OP(WAIT_REQUEUE_PI); break;\r\ndefault: printed = scnprintf(bf, size, "%#x", cmd); break;\r\n}\r\nif (op & FUTEX_PRIVATE_FLAG)\r\nprinted += scnprintf(bf + printed, size - printed, "|PRIV");\r\nif (op & FUTEX_CLOCK_REALTIME)\r\nprinted += scnprintf(bf + printed, size - printed, "|CLKRT");\r\nreturn printed;\r\n}
