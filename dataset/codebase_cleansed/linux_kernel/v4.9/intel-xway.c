static int xway_gphy_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nu32 ledxh;\r\nu32 ledxl;\r\nerr = phy_write(phydev, XWAY_MDIO_IMASK, 0);\r\nif (err)\r\nreturn err;\r\nphy_read(phydev, XWAY_MDIO_ISTAT);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LEDCH, MDIO_MMD_VEND2,\r\nXWAY_MMD_LEDCH_NACS_NONE |\r\nXWAY_MMD_LEDCH_SBF_F02HZ |\r\nXWAY_MMD_LEDCH_FBF_F16HZ);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LEDCL, MDIO_MMD_VEND2,\r\nXWAY_MMD_LEDCH_CBLINK_NONE |\r\nXWAY_MMD_LEDCH_SCAN_NONE);\r\nledxh = XWAY_MMD_LEDxH_BLINKF_NONE | XWAY_MMD_LEDxH_CON_LINK10XX;\r\nledxl = XWAY_MMD_LEDxL_PULSE_TXACT | XWAY_MMD_LEDxL_PULSE_RXACT |\r\nXWAY_MMD_LEDxL_BLINKS_NONE;\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED0H, MDIO_MMD_VEND2, ledxh);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED0L, MDIO_MMD_VEND2, ledxl);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED1H, MDIO_MMD_VEND2, ledxh);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED1L, MDIO_MMD_VEND2, ledxl);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED2H, MDIO_MMD_VEND2, ledxh);\r\nphy_write_mmd_indirect(phydev, XWAY_MMD_LED2L, MDIO_MMD_VEND2, ledxl);\r\nreturn 0;\r\n}\r\nstatic int xway_gphy14_config_aneg(struct phy_device *phydev)\r\n{\r\nint reg, err;\r\nreg = phy_read(phydev, MII_CTRL1000);\r\nreg |= ADVERTISED_MPD;\r\nerr = phy_write(phydev, MII_CTRL1000, reg);\r\nif (err)\r\nreturn err;\r\nreturn genphy_config_aneg(phydev);\r\n}\r\nstatic int xway_gphy_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint reg;\r\nreg = phy_read(phydev, XWAY_MDIO_ISTAT);\r\nreturn (reg < 0) ? reg : 0;\r\n}\r\nstatic int xway_gphy_did_interrupt(struct phy_device *phydev)\r\n{\r\nint reg;\r\nreg = phy_read(phydev, XWAY_MDIO_ISTAT);\r\nreturn reg & XWAY_MDIO_INIT_MASK;\r\n}\r\nstatic int xway_gphy_config_intr(struct phy_device *phydev)\r\n{\r\nu16 mask = 0;\r\nif (phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nmask = XWAY_MDIO_INIT_MASK;\r\nreturn phy_write(phydev, XWAY_MDIO_IMASK, mask);\r\n}
