static inline struct bnx2i_hba *bnx2i_dev_to_hba(struct device *dev)\r\n{\r\nstruct Scsi_Host *shost = class_to_shost(dev);\r\nreturn iscsi_host_priv(shost);\r\n}\r\nstatic ssize_t bnx2i_show_sq_info(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct bnx2i_hba *hba = bnx2i_dev_to_hba(dev);\r\nreturn sprintf(buf, "0x%x\n", hba->max_sqes);\r\n}\r\nstatic ssize_t bnx2i_set_sq_info(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct bnx2i_hba *hba = bnx2i_dev_to_hba(dev);\r\nu32 val;\r\nint max_sq_size;\r\nif (hba->ofld_conns_active)\r\ngoto skip_config;\r\nif (test_bit(BNX2I_NX2_DEV_57710, &hba->cnic_dev_type))\r\nmax_sq_size = BNX2I_5770X_SQ_WQES_MAX;\r\nelse\r\nmax_sq_size = BNX2I_570X_SQ_WQES_MAX;\r\nif (sscanf(buf, " 0x%x ", &val) > 0) {\r\nif ((val >= BNX2I_SQ_WQES_MIN) && (val <= max_sq_size) &&\r\n(is_power_of_2(val)))\r\nhba->max_sqes = val;\r\n}\r\nreturn count;\r\nskip_config:\r\nprintk(KERN_ERR "bnx2i: device busy, cannot change SQ size\n");\r\nreturn 0;\r\n}\r\nstatic ssize_t bnx2i_show_ccell_info(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct bnx2i_hba *hba = bnx2i_dev_to_hba(dev);\r\nreturn sprintf(buf, "0x%x\n", hba->num_ccell);\r\n}\r\nstatic ssize_t bnx2i_set_ccell_info(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nu32 val;\r\nstruct bnx2i_hba *hba = bnx2i_dev_to_hba(dev);\r\nif (hba->ofld_conns_active)\r\ngoto skip_config;\r\nif (sscanf(buf, " 0x%x ", &val) > 0) {\r\nif ((val >= BNX2I_CCELLS_MIN) &&\r\n(val <= BNX2I_CCELLS_MAX)) {\r\nhba->num_ccell = val;\r\n}\r\n}\r\nreturn count;\r\nskip_config:\r\nprintk(KERN_ERR "bnx2i: device busy, cannot change CCELL size\n");\r\nreturn 0;\r\n}
