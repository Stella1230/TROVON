int\r\ngf119_disp_dmac_bind(struct nv50_disp_dmac *chan,\r\nstruct nvkm_object *object, u32 handle)\r\n{\r\nreturn nvkm_ramht_insert(chan->base.root->ramht, object,\r\nchan->base.chid, -9, handle,\r\nchan->base.chid << 27 | 0x00000001);\r\n}\r\nvoid\r\ngf119_disp_dmac_fini(struct nv50_disp_dmac *chan)\r\n{\r\nstruct nv50_disp *disp = chan->base.root->disp;\r\nstruct nvkm_subdev *subdev = &disp->base.engine.subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nint chid = chan->base.chid;\r\nnvkm_mask(device, 0x610490 + (chid * 0x0010), 0x00001010, 0x00001000);\r\nnvkm_mask(device, 0x610490 + (chid * 0x0010), 0x00000003, 0x00000000);\r\nif (nvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x610490 + (chid * 0x10)) & 0x001e0000))\r\nbreak;\r\n) < 0) {\r\nnvkm_error(subdev, "ch %d fini: %08x\n", chid,\r\nnvkm_rd32(device, 0x610490 + (chid * 0x10)));\r\n}\r\nnvkm_mask(device, 0x610090, 0x00000001 << chid, 0x00000000);\r\nnvkm_mask(device, 0x6100a0, 0x00000001 << chid, 0x00000000);\r\n}\r\nstatic int\r\ngf119_disp_dmac_init(struct nv50_disp_dmac *chan)\r\n{\r\nstruct nv50_disp *disp = chan->base.root->disp;\r\nstruct nvkm_subdev *subdev = &disp->base.engine.subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nint chid = chan->base.chid;\r\nnvkm_mask(device, 0x6100a0, 0x00000001 << chid, 0x00000001 << chid);\r\nnvkm_wr32(device, 0x610494 + (chid * 0x0010), chan->push);\r\nnvkm_wr32(device, 0x610498 + (chid * 0x0010), 0x00010000);\r\nnvkm_wr32(device, 0x61049c + (chid * 0x0010), 0x00000001);\r\nnvkm_mask(device, 0x610490 + (chid * 0x0010), 0x00000010, 0x00000010);\r\nnvkm_wr32(device, 0x640000 + (chid * 0x1000), 0x00000000);\r\nnvkm_wr32(device, 0x610490 + (chid * 0x0010), 0x00000013);\r\nif (nvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x610490 + (chid * 0x10)) & 0x80000000))\r\nbreak;\r\n) < 0) {\r\nnvkm_error(subdev, "ch %d init: %08x\n", chid,\r\nnvkm_rd32(device, 0x610490 + (chid * 0x10)));\r\nreturn -EBUSY;\r\n}\r\nreturn 0;\r\n}
