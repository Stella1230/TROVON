static void winchip_machine_check(struct pt_regs *regs, long error_code)\r\n{\r\nist_enter(regs);\r\npr_emerg("CPU0: Machine Check Exception.\n");\r\nadd_taint(TAINT_MACHINE_CHECK, LOCKDEP_NOW_UNRELIABLE);\r\nist_exit(regs);\r\n}\r\nvoid winchip_mcheck_init(struct cpuinfo_x86 *c)\r\n{\r\nu32 lo, hi;\r\nmachine_check_vector = winchip_machine_check;\r\nwmb();\r\nrdmsr(MSR_IDT_FCR1, lo, hi);\r\nlo |= (1<<2);\r\nlo &= ~(1<<4);\r\nwrmsr(MSR_IDT_FCR1, lo, hi);\r\ncr4_set_bits(X86_CR4_MCE);\r\npr_info("Winchip machine check reporting enabled on CPU#0.\n");\r\n}
