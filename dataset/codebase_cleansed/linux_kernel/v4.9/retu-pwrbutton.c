static irqreturn_t retu_pwrbutton_irq(int irq, void *_pwr)\r\n{\r\nstruct input_dev *idev = _pwr;\r\nstruct retu_dev *rdev = input_get_drvdata(idev);\r\nbool state;\r\nstate = !(retu_read(rdev, RETU_REG_STATUS) & RETU_STATUS_PWRONX);\r\ninput_report_key(idev, KEY_POWER, state);\r\ninput_sync(idev);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic int retu_pwrbutton_probe(struct platform_device *pdev)\r\n{\r\nstruct retu_dev *rdev = dev_get_drvdata(pdev->dev.parent);\r\nstruct input_dev *idev;\r\nint irq;\r\nint error;\r\nirq = platform_get_irq(pdev, 0);\r\nif (irq < 0)\r\nreturn irq;\r\nidev = devm_input_allocate_device(&pdev->dev);\r\nif (!idev)\r\nreturn -ENOMEM;\r\nidev->name = "retu-pwrbutton";\r\nidev->dev.parent = &pdev->dev;\r\ninput_set_capability(idev, EV_KEY, KEY_POWER);\r\ninput_set_drvdata(idev, rdev);\r\nerror = devm_request_threaded_irq(&pdev->dev, irq,\r\nNULL, retu_pwrbutton_irq,\r\nIRQF_ONESHOT,\r\n"retu-pwrbutton", idev);\r\nif (error)\r\nreturn error;\r\nerror = input_register_device(idev);\r\nif (error)\r\nreturn error;\r\nreturn 0;\r\n}\r\nstatic int retu_pwrbutton_remove(struct platform_device *pdev)\r\n{\r\nreturn 0;\r\n}
