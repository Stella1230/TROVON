static int mt6311_i2c_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct regulator_config config = { };\r\nstruct regulator_dev *rdev;\r\nstruct regmap *regmap;\r\nint i, ret;\r\nunsigned int data;\r\nregmap = devm_regmap_init_i2c(i2c, &mt6311_regmap_config);\r\nif (IS_ERR(regmap)) {\r\nret = PTR_ERR(regmap);\r\ndev_err(&i2c->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\nret = regmap_read(regmap, MT6311_SWCID, &data);\r\nif (ret < 0) {\r\ndev_err(&i2c->dev, "Failed to read DEVICE_ID reg: %d\n", ret);\r\nreturn ret;\r\n}\r\nswitch (data) {\r\ncase MT6311_E1_CID_CODE:\r\ncase MT6311_E2_CID_CODE:\r\ncase MT6311_E3_CID_CODE:\r\nbreak;\r\ndefault:\r\ndev_err(&i2c->dev, "Unsupported device id = 0x%x.\n", data);\r\nreturn -ENODEV;\r\n}\r\nfor (i = 0; i < MT6311_MAX_REGULATORS; i++) {\r\nconfig.dev = &i2c->dev;\r\nconfig.regmap = regmap;\r\nrdev = devm_regulator_register(&i2c->dev,\r\n&mt6311_regulators[i], &config);\r\nif (IS_ERR(rdev)) {\r\ndev_err(&i2c->dev,\r\n"Failed to register MT6311 regulator\n");\r\nreturn PTR_ERR(rdev);\r\n}\r\n}\r\nreturn 0;\r\n}
