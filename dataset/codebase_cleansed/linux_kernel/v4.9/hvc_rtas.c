static inline int hvc_rtas_write_console(uint32_t vtermno, const char *buf,\r\nint count)\r\n{\r\nint i;\r\nfor (i = 0; i < count; i++) {\r\nif (rtas_call(rtascons_put_char_token, 1, 1, NULL, buf[i]))\r\nbreak;\r\n}\r\nreturn i;\r\n}\r\nstatic int hvc_rtas_read_console(uint32_t vtermno, char *buf, int count)\r\n{\r\nint i, c;\r\nfor (i = 0; i < count; i++) {\r\nif (rtas_call(rtascons_get_char_token, 0, 2, &c))\r\nbreak;\r\nbuf[i] = c;\r\n}\r\nreturn i;\r\n}\r\nstatic int __init hvc_rtas_init(void)\r\n{\r\nstruct hvc_struct *hp;\r\nif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\r\nrtascons_put_char_token = rtas_token("put-term-char");\r\nif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\r\nreturn -EIO;\r\nif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\r\nrtascons_get_char_token = rtas_token("get-term-char");\r\nif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\r\nreturn -EIO;\r\nBUG_ON(hvc_rtas_dev);\r\nhp = hvc_alloc(hvc_rtas_cookie, 0, &hvc_rtas_get_put_ops, 16);\r\nif (IS_ERR(hp))\r\nreturn PTR_ERR(hp);\r\nhvc_rtas_dev = hp;\r\nreturn 0;\r\n}\r\nstatic int __init hvc_rtas_console_init(void)\r\n{\r\nrtascons_put_char_token = rtas_token("put-term-char");\r\nif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\r\nreturn -EIO;\r\nrtascons_get_char_token = rtas_token("get-term-char");\r\nif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\r\nreturn -EIO;\r\nhvc_instantiate(hvc_rtas_cookie, 0, &hvc_rtas_get_put_ops);\r\nadd_preferred_console("hvc", 0, NULL);\r\nreturn 0;\r\n}
