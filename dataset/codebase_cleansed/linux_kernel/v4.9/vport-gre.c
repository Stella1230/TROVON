static struct vport *gre_tnl_create(const struct vport_parms *parms)\r\n{\r\nstruct net *net = ovs_dp_get_net(parms->dp);\r\nstruct net_device *dev;\r\nstruct vport *vport;\r\nint err;\r\nvport = ovs_vport_alloc(0, &ovs_gre_vport_ops, parms);\r\nif (IS_ERR(vport))\r\nreturn vport;\r\nrtnl_lock();\r\ndev = gretap_fb_dev_create(net, parms->name, NET_NAME_USER);\r\nif (IS_ERR(dev)) {\r\nrtnl_unlock();\r\novs_vport_free(vport);\r\nreturn ERR_CAST(dev);\r\n}\r\nerr = dev_change_flags(dev, dev->flags | IFF_UP);\r\nif (err < 0) {\r\nrtnl_delete_link(dev);\r\nrtnl_unlock();\r\novs_vport_free(vport);\r\nreturn ERR_PTR(err);\r\n}\r\nrtnl_unlock();\r\nreturn vport;\r\n}\r\nstatic struct vport *gre_create(const struct vport_parms *parms)\r\n{\r\nstruct vport *vport;\r\nvport = gre_tnl_create(parms);\r\nif (IS_ERR(vport))\r\nreturn vport;\r\nreturn ovs_netdev_link(vport, parms->name);\r\n}\r\nstatic int __init ovs_gre_tnl_init(void)\r\n{\r\nreturn ovs_vport_ops_register(&ovs_gre_vport_ops);\r\n}\r\nstatic void __exit ovs_gre_tnl_exit(void)\r\n{\r\novs_vport_ops_unregister(&ovs_gre_vport_ops);\r\n}
