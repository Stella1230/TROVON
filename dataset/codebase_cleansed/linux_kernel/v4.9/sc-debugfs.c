static ssize_t sc_prefetch_read(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nbool enabled = bc_prefetch_is_enabled();\r\nchar buf[3];\r\nbuf[0] = enabled ? 'Y' : 'N';\r\nbuf[1] = '\n';\r\nbuf[2] = 0;\r\nreturn simple_read_from_buffer(user_buf, count, ppos, buf, 2);\r\n}\r\nstatic ssize_t sc_prefetch_write(struct file *file,\r\nconst char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nchar buf[32];\r\nssize_t buf_size;\r\nbool enabled;\r\nint err;\r\nbuf_size = min(count, sizeof(buf) - 1);\r\nif (copy_from_user(buf, user_buf, buf_size))\r\nreturn -EFAULT;\r\nbuf[buf_size] = '\0';\r\nerr = strtobool(buf, &enabled);\r\nif (err)\r\nreturn err;\r\nif (enabled)\r\nbc_prefetch_enable();\r\nelse\r\nbc_prefetch_disable();\r\nreturn count;\r\n}\r\nstatic int __init sc_debugfs_init(void)\r\n{\r\nstruct dentry *dir, *file;\r\nif (!mips_debugfs_dir)\r\nreturn -ENODEV;\r\ndir = debugfs_create_dir("l2cache", mips_debugfs_dir);\r\nif (IS_ERR(dir))\r\nreturn PTR_ERR(dir);\r\nfile = debugfs_create_file("prefetch", S_IRUGO | S_IWUSR, dir,\r\nNULL, &sc_prefetch_fops);\r\nif (!file)\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}
