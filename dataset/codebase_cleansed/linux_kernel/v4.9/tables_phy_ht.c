u32 b43_httab_read(struct b43_wldev *dev, u32 offset)\r\n{\r\nu32 type, value;\r\ntype = offset & B43_HTTAB_TYPEMASK;\r\noffset &= ~B43_HTTAB_TYPEMASK;\r\nB43_WARN_ON(offset > 0xFFFF);\r\nswitch (type) {\r\ncase B43_HTTAB_8BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nvalue = b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO) & 0xFF;\r\nbreak;\r\ncase B43_HTTAB_16BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nvalue = b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO);\r\nbreak;\r\ncase B43_HTTAB_32BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nvalue = b43_phy_read(dev, B43_PHY_HT_TABLE_DATAHI);\r\nvalue <<= 16;\r\nvalue |= b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO);\r\nbreak;\r\ndefault:\r\nB43_WARN_ON(1);\r\nvalue = 0;\r\n}\r\nreturn value;\r\n}\r\nvoid b43_httab_read_bulk(struct b43_wldev *dev, u32 offset,\r\nunsigned int nr_elements, void *_data)\r\n{\r\nu32 type;\r\nu8 *data = _data;\r\nunsigned int i;\r\ntype = offset & B43_HTTAB_TYPEMASK;\r\noffset &= ~B43_HTTAB_TYPEMASK;\r\nB43_WARN_ON(offset > 0xFFFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nfor (i = 0; i < nr_elements; i++) {\r\nswitch (type) {\r\ncase B43_HTTAB_8BIT:\r\n*data = b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO) & 0xFF;\r\ndata++;\r\nbreak;\r\ncase B43_HTTAB_16BIT:\r\n*((u16 *)data) = b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO);\r\ndata += 2;\r\nbreak;\r\ncase B43_HTTAB_32BIT:\r\n*((u32 *)data) = b43_phy_read(dev, B43_PHY_HT_TABLE_DATAHI);\r\n*((u32 *)data) <<= 16;\r\n*((u32 *)data) |= b43_phy_read(dev, B43_PHY_HT_TABLE_DATALO);\r\ndata += 4;\r\nbreak;\r\ndefault:\r\nB43_WARN_ON(1);\r\n}\r\n}\r\n}\r\nvoid b43_httab_write(struct b43_wldev *dev, u32 offset, u32 value)\r\n{\r\nu32 type;\r\ntype = offset & B43_HTTAB_TYPEMASK;\r\noffset &= 0xFFFF;\r\nswitch (type) {\r\ncase B43_HTTAB_8BIT:\r\nB43_WARN_ON(value & ~0xFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\nbreak;\r\ncase B43_HTTAB_16BIT:\r\nB43_WARN_ON(value & ~0xFFFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\nbreak;\r\ncase B43_HTTAB_32BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATAHI, value >> 16);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value & 0xFFFF);\r\nbreak;\r\ndefault:\r\nB43_WARN_ON(1);\r\n}\r\nreturn;\r\n}\r\nvoid b43_httab_write_few(struct b43_wldev *dev, u32 offset, size_t num, ...)\r\n{\r\nva_list args;\r\nu32 type, value;\r\nunsigned int i;\r\ntype = offset & B43_HTTAB_TYPEMASK;\r\noffset &= 0xFFFF;\r\nva_start(args, num);\r\nswitch (type) {\r\ncase B43_HTTAB_8BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nfor (i = 0; i < num; i++) {\r\nvalue = va_arg(args, int);\r\nB43_WARN_ON(value & ~0xFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\n}\r\nbreak;\r\ncase B43_HTTAB_16BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nfor (i = 0; i < num; i++) {\r\nvalue = va_arg(args, int);\r\nB43_WARN_ON(value & ~0xFFFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\n}\r\nbreak;\r\ncase B43_HTTAB_32BIT:\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nfor (i = 0; i < num; i++) {\r\nvalue = va_arg(args, int);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATAHI,\r\nvalue >> 16);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO,\r\nvalue & 0xFFFF);\r\n}\r\nbreak;\r\ndefault:\r\nB43_WARN_ON(1);\r\n}\r\nva_end(args);\r\nreturn;\r\n}\r\nvoid b43_httab_write_bulk(struct b43_wldev *dev, u32 offset,\r\nunsigned int nr_elements, const void *_data)\r\n{\r\nu32 type, value;\r\nconst u8 *data = _data;\r\nunsigned int i;\r\ntype = offset & B43_HTTAB_TYPEMASK;\r\noffset &= ~B43_HTTAB_TYPEMASK;\r\nB43_WARN_ON(offset > 0xFFFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_ADDR, offset);\r\nfor (i = 0; i < nr_elements; i++) {\r\nswitch (type) {\r\ncase B43_HTTAB_8BIT:\r\nvalue = *data;\r\ndata++;\r\nB43_WARN_ON(value & ~0xFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\nbreak;\r\ncase B43_HTTAB_16BIT:\r\nvalue = *((u16 *)data);\r\ndata += 2;\r\nB43_WARN_ON(value & ~0xFFFF);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO, value);\r\nbreak;\r\ncase B43_HTTAB_32BIT:\r\nvalue = *((u32 *)data);\r\ndata += 4;\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATAHI, value >> 16);\r\nb43_phy_write(dev, B43_PHY_HT_TABLE_DATALO,\r\nvalue & 0xFFFF);\r\nbreak;\r\ndefault:\r\nB43_WARN_ON(1);\r\n}\r\n}\r\n}\r\nvoid b43_phy_ht_tables_init(struct b43_wldev *dev)\r\n{\r\nBUILD_BUG_ON(ARRAY_SIZE(b43_httab_0x1a_0xc0_late) !=\r\nB43_HTTAB_1A_C0_LATE_SIZE);\r\nhttab_upload(dev, B43_HTTAB16(0x12, 0), b43_httab_0x12);\r\nhttab_upload(dev, B43_HTTAB16(0x27, 0), b43_httab_0x27);\r\nhttab_upload(dev, B43_HTTAB16(0x26, 0), b43_httab_0x26);\r\nhttab_upload(dev, B43_HTTAB32(0x25, 0), b43_httab_0x25);\r\nhttab_upload(dev, B43_HTTAB32(0x2f, 0), b43_httab_0x2f);\r\nhttab_upload(dev, B43_HTTAB16(0x1a, 0), b43_httab_0x1a);\r\nhttab_upload(dev, B43_HTTAB16(0x1b, 0), b43_httab_0x1b);\r\nhttab_upload(dev, B43_HTTAB16(0x1c, 0), b43_httab_0x1c);\r\nhttab_upload(dev, B43_HTTAB32(0x1a, 0x0c0), b43_httab_0x1a_0xc0);\r\nhttab_upload(dev, B43_HTTAB32(0x1a, 0x140), b43_httab_0x1a_0x140);\r\nhttab_upload(dev, B43_HTTAB32(0x1b, 0x140), b43_httab_0x1b_0x140);\r\nhttab_upload(dev, B43_HTTAB32(0x1c, 0x140), b43_httab_0x1c_0x140);\r\nhttab_upload(dev, B43_HTTAB16(0x1a, 0x1c0), b43_httab_0x1a_0x1c0);\r\nhttab_upload(dev, B43_HTTAB16(0x1b, 0x1c0), b43_httab_0x1b_0x1c0);\r\nhttab_upload(dev, B43_HTTAB16(0x1c, 0x1c0), b43_httab_0x1c_0x1c0);\r\nhttab_upload(dev, B43_HTTAB16(0x1a, 0x240), b43_httab_0x1a_0x240);\r\nhttab_upload(dev, B43_HTTAB16(0x1b, 0x240), b43_httab_0x1b_0x240);\r\nhttab_upload(dev, B43_HTTAB16(0x1c, 0x240), b43_httab_0x1c_0x240);\r\nhttab_upload(dev, B43_HTTAB32(0x1f, 0), b43_httab_0x1f);\r\nhttab_upload(dev, B43_HTTAB32(0x21, 0), b43_httab_0x21);\r\nhttab_upload(dev, B43_HTTAB32(0x23, 0), b43_httab_0x23);\r\nhttab_upload(dev, B43_HTTAB32(0x20, 0), b43_httab_0x20);\r\nhttab_upload(dev, B43_HTTAB32(0x22, 0), b43_httab_0x22);\r\nhttab_upload(dev, B43_HTTAB32(0x24, 0), b43_httab_0x24);\r\n}
