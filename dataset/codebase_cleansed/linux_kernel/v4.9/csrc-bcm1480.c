static cycle_t bcm1480_hpt_read(struct clocksource *cs)\r\n{\r\nreturn (cycle_t) __raw_readq(IOADDR(A_SCD_ZBBUS_CYCLE_COUNT));\r\n}\r\nstatic u64 notrace sb1480_read_sched_clock(void)\r\n{\r\nreturn __raw_readq(IOADDR(A_SCD_ZBBUS_CYCLE_COUNT));\r\n}\r\nvoid __init sb1480_clocksource_init(void)\r\n{\r\nstruct clocksource *cs = &bcm1480_clocksource;\r\nunsigned int plldiv;\r\nunsigned long zbbus;\r\nplldiv = G_BCM1480_SYS_PLL_DIV(__raw_readq(IOADDR(A_SCD_SYSTEM_CFG)));\r\nzbbus = ((plldiv >> 1) * 50000000) + ((plldiv & 1) * 25000000);\r\nclocksource_register_hz(cs, zbbus);\r\nsched_clock_register(sb1480_read_sched_clock, 64, zbbus);\r\n}
