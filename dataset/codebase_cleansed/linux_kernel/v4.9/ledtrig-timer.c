static ssize_t led_delay_on_show(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct led_classdev *led_cdev = dev_get_drvdata(dev);\r\nreturn sprintf(buf, "%lu\n", led_cdev->blink_delay_on);\r\n}\r\nstatic ssize_t led_delay_on_store(struct device *dev,\r\nstruct device_attribute *attr, const char *buf, size_t size)\r\n{\r\nstruct led_classdev *led_cdev = dev_get_drvdata(dev);\r\nunsigned long state;\r\nssize_t ret = -EINVAL;\r\nret = kstrtoul(buf, 10, &state);\r\nif (ret)\r\nreturn ret;\r\nled_blink_set(led_cdev, &state, &led_cdev->blink_delay_off);\r\nled_cdev->blink_delay_on = state;\r\nreturn size;\r\n}\r\nstatic ssize_t led_delay_off_show(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct led_classdev *led_cdev = dev_get_drvdata(dev);\r\nreturn sprintf(buf, "%lu\n", led_cdev->blink_delay_off);\r\n}\r\nstatic ssize_t led_delay_off_store(struct device *dev,\r\nstruct device_attribute *attr, const char *buf, size_t size)\r\n{\r\nstruct led_classdev *led_cdev = dev_get_drvdata(dev);\r\nunsigned long state;\r\nssize_t ret = -EINVAL;\r\nret = kstrtoul(buf, 10, &state);\r\nif (ret)\r\nreturn ret;\r\nled_blink_set(led_cdev, &led_cdev->blink_delay_on, &state);\r\nled_cdev->blink_delay_off = state;\r\nreturn size;\r\n}\r\nstatic void timer_trig_activate(struct led_classdev *led_cdev)\r\n{\r\nint rc;\r\nled_cdev->trigger_data = NULL;\r\nrc = device_create_file(led_cdev->dev, &dev_attr_delay_on);\r\nif (rc)\r\nreturn;\r\nrc = device_create_file(led_cdev->dev, &dev_attr_delay_off);\r\nif (rc)\r\ngoto err_out_delayon;\r\nled_blink_set(led_cdev, &led_cdev->blink_delay_on,\r\n&led_cdev->blink_delay_off);\r\nled_cdev->activated = true;\r\nreturn;\r\nerr_out_delayon:\r\ndevice_remove_file(led_cdev->dev, &dev_attr_delay_on);\r\n}\r\nstatic void timer_trig_deactivate(struct led_classdev *led_cdev)\r\n{\r\nif (led_cdev->activated) {\r\ndevice_remove_file(led_cdev->dev, &dev_attr_delay_on);\r\ndevice_remove_file(led_cdev->dev, &dev_attr_delay_off);\r\nled_cdev->activated = false;\r\n}\r\nled_set_brightness(led_cdev, LED_OFF);\r\n}\r\nstatic int __init timer_trig_init(void)\r\n{\r\nreturn led_trigger_register(&timer_led_trigger);\r\n}\r\nstatic void __exit timer_trig_exit(void)\r\n{\r\nled_trigger_unregister(&timer_led_trigger);\r\n}
