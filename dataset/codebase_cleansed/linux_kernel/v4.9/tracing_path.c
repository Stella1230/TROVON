static void __tracing_path_set(const char *tracing, const char *mountpoint)\r\n{\r\nsnprintf(tracing_mnt, sizeof(tracing_mnt), "%s", mountpoint);\r\nsnprintf(tracing_path, sizeof(tracing_path), "%s/%s",\r\nmountpoint, tracing);\r\nsnprintf(tracing_events_path, sizeof(tracing_events_path), "%s/%s%s",\r\nmountpoint, tracing, "events");\r\n}\r\nstatic const char *tracing_path_tracefs_mount(void)\r\n{\r\nconst char *mnt;\r\nmnt = tracefs__mount();\r\nif (!mnt)\r\nreturn NULL;\r\n__tracing_path_set("", mnt);\r\nreturn mnt;\r\n}\r\nstatic const char *tracing_path_debugfs_mount(void)\r\n{\r\nconst char *mnt;\r\nmnt = debugfs__mount();\r\nif (!mnt)\r\nreturn NULL;\r\n__tracing_path_set("tracing/", mnt);\r\nreturn mnt;\r\n}\r\nconst char *tracing_path_mount(void)\r\n{\r\nconst char *mnt;\r\nmnt = tracing_path_tracefs_mount();\r\nif (mnt)\r\nreturn mnt;\r\nmnt = tracing_path_debugfs_mount();\r\nreturn mnt;\r\n}\r\nvoid tracing_path_set(const char *mntpt)\r\n{\r\n__tracing_path_set("tracing/", mntpt);\r\n}\r\nchar *get_tracing_file(const char *name)\r\n{\r\nchar *file;\r\nif (asprintf(&file, "%s/%s", tracing_path, name) < 0)\r\nreturn NULL;\r\nreturn file;\r\n}\r\nvoid put_tracing_file(char *file)\r\n{\r\nfree(file);\r\n}\r\nstatic int strerror_open(int err, char *buf, size_t size, const char *filename)\r\n{\r\nchar sbuf[128];\r\nswitch (err) {\r\ncase ENOENT:\r\nif (debugfs__configured() || tracefs__configured()) {\r\nsnprintf(buf, size,\r\n"Error:\tFile %s/%s not found.\n"\r\n"Hint:\tPerhaps this kernel misses some CONFIG_ setting to enable this feature?.\n",\r\ntracing_events_path, filename);\r\nbreak;\r\n}\r\nsnprintf(buf, size, "%s",\r\n"Error:\tUnable to find debugfs/tracefs\n"\r\n"Hint:\tWas your kernel compiled with debugfs/tracefs support?\n"\r\n"Hint:\tIs the debugfs/tracefs filesystem mounted?\n"\r\n"Hint:\tTry 'sudo mount -t debugfs nodev /sys/kernel/debug'");\r\nbreak;\r\ncase EACCES: {\r\nsnprintf(buf, size,\r\n"Error:\tNo permissions to read %s/%s\n"\r\n"Hint:\tTry 'sudo mount -o remount,mode=755 %s'\n",\r\ntracing_events_path, filename, tracing_mnt);\r\n}\r\nbreak;\r\ndefault:\r\nsnprintf(buf, size, "%s", str_error_r(err, sbuf, sizeof(sbuf)));\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nint tracing_path__strerror_open_tp(int err, char *buf, size_t size, const char *sys, const char *name)\r\n{\r\nchar path[PATH_MAX];\r\nsnprintf(path, PATH_MAX, "%s/%s", sys, name ?: "*");\r\nreturn strerror_open(err, buf, size, path);\r\n}
