acpi_status\r\nacpi_ex_resolve_node_to_value(struct acpi_namespace_node **object_ptr,\r\nstruct acpi_walk_state *walk_state)\r\n{\r\nacpi_status status = AE_OK;\r\nunion acpi_operand_object *source_desc;\r\nunion acpi_operand_object *obj_desc = NULL;\r\nstruct acpi_namespace_node *node;\r\nacpi_object_type entry_type;\r\nACPI_FUNCTION_TRACE(ex_resolve_node_to_value);\r\nnode = *object_ptr;\r\nsource_desc = acpi_ns_get_attached_object(node);\r\nentry_type = acpi_ns_get_type((acpi_handle)node);\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC, "Entry=%p SourceDesc=%p [%s]\n",\r\nnode, source_desc,\r\nacpi_ut_get_type_name(entry_type)));\r\nif ((entry_type == ACPI_TYPE_LOCAL_ALIAS) ||\r\n(entry_type == ACPI_TYPE_LOCAL_METHOD_ALIAS)) {\r\nnode = ACPI_CAST_PTR(struct acpi_namespace_node, node->object);\r\nsource_desc = acpi_ns_get_attached_object(node);\r\nentry_type = acpi_ns_get_type((acpi_handle)node);\r\n*object_ptr = node;\r\n}\r\nif ((entry_type == ACPI_TYPE_DEVICE) ||\r\n(entry_type == ACPI_TYPE_THERMAL) ||\r\n(entry_type == ACPI_TYPE_METHOD) ||\r\n(node->flags & (ANOBJ_METHOD_ARG | ANOBJ_METHOD_LOCAL))) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif (!source_desc) {\r\nACPI_ERROR((AE_INFO, "No object attached to node [%4.4s] %p",\r\nnode->name.ascii, node));\r\nreturn_ACPI_STATUS(AE_AML_UNINITIALIZED_NODE);\r\n}\r\nswitch (entry_type) {\r\ncase ACPI_TYPE_PACKAGE:\r\nif (source_desc->common.type != ACPI_TYPE_PACKAGE) {\r\nACPI_ERROR((AE_INFO, "Object not a Package, type %s",\r\nacpi_ut_get_object_type_name(source_desc)));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\nstatus = acpi_ds_get_package_arguments(source_desc);\r\nif (ACPI_SUCCESS(status)) {\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (source_desc->common.type != ACPI_TYPE_BUFFER) {\r\nACPI_ERROR((AE_INFO, "Object not a Buffer, type %s",\r\nacpi_ut_get_object_type_name(source_desc)));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\nstatus = acpi_ds_get_buffer_arguments(source_desc);\r\nif (ACPI_SUCCESS(status)) {\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nif (source_desc->common.type != ACPI_TYPE_STRING) {\r\nACPI_ERROR((AE_INFO, "Object not a String, type %s",\r\nacpi_ut_get_object_type_name(source_desc)));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\nbreak;\r\ncase ACPI_TYPE_INTEGER:\r\nif (source_desc->common.type != ACPI_TYPE_INTEGER) {\r\nACPI_ERROR((AE_INFO, "Object not a Integer, type %s",\r\nacpi_ut_get_object_type_name(source_desc)));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nACPI_DEBUG_PRINT((ACPI_DB_EXEC,\r\n"FieldRead Node=%p SourceDesc=%p Type=%X\n",\r\nnode, source_desc, entry_type));\r\nstatus =\r\nacpi_ex_read_data_from_field(walk_state, source_desc,\r\n&obj_desc);\r\nbreak;\r\ncase ACPI_TYPE_MUTEX:\r\ncase ACPI_TYPE_POWER:\r\ncase ACPI_TYPE_PROCESSOR:\r\ncase ACPI_TYPE_EVENT:\r\ncase ACPI_TYPE_REGION:\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\nbreak;\r\ncase ACPI_TYPE_ANY:\r\nACPI_ERROR((AE_INFO,\r\n"Untyped entry %p, no attached object!", node));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nswitch (source_desc->reference.class) {\r\ncase ACPI_REFCLASS_TABLE:\r\ncase ACPI_REFCLASS_REFOF:\r\ncase ACPI_REFCLASS_INDEX:\r\nobj_desc = source_desc;\r\nacpi_ut_add_reference(obj_desc);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO,\r\n"Unsupported Reference type 0x%X",\r\nsource_desc->reference.class));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO,\r\n"Node %p - Unknown object type 0x%X",\r\nnode, entry_type));\r\nreturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\r\n}\r\n*object_ptr = (void *)obj_desc;\r\nreturn_ACPI_STATUS(status);\r\n}
