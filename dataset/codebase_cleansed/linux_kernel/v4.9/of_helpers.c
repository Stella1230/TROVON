struct device_node *pseries_of_derive_parent(const char *path)\r\n{\r\nstruct device_node *parent;\r\nchar *parent_path = "/";\r\nconst char *tail;\r\ntail = kbasename(path) - 1;\r\nif (!strcmp(path, "/"))\r\nreturn ERR_PTR(-EINVAL);\r\nif (tail > path) {\r\nparent_path = kstrndup(path, tail - path, GFP_KERNEL);\r\nif (!parent_path)\r\nreturn ERR_PTR(-ENOMEM);\r\n}\r\nparent = of_find_node_by_path(parent_path);\r\nif (strcmp(parent_path, "/"))\r\nkfree(parent_path);\r\nreturn parent ? parent : ERR_PTR(-EINVAL);\r\n}
