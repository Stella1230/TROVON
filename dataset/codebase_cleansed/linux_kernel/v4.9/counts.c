struct perf_counts *perf_counts__new(int ncpus, int nthreads)\r\n{\r\nstruct perf_counts *counts = zalloc(sizeof(*counts));\r\nif (counts) {\r\nstruct xyarray *values;\r\nvalues = xyarray__new(ncpus, nthreads, sizeof(struct perf_counts_values));\r\nif (!values) {\r\nfree(counts);\r\nreturn NULL;\r\n}\r\ncounts->values = values;\r\n}\r\nreturn counts;\r\n}\r\nvoid perf_counts__delete(struct perf_counts *counts)\r\n{\r\nif (counts) {\r\nxyarray__delete(counts->values);\r\nfree(counts);\r\n}\r\n}\r\nstatic void perf_counts__reset(struct perf_counts *counts)\r\n{\r\nxyarray__reset(counts->values);\r\n}\r\nvoid perf_evsel__reset_counts(struct perf_evsel *evsel)\r\n{\r\nperf_counts__reset(evsel->counts);\r\n}\r\nint perf_evsel__alloc_counts(struct perf_evsel *evsel, int ncpus, int nthreads)\r\n{\r\nevsel->counts = perf_counts__new(ncpus, nthreads);\r\nreturn evsel->counts != NULL ? 0 : -ENOMEM;\r\n}\r\nvoid perf_evsel__free_counts(struct perf_evsel *evsel)\r\n{\r\nperf_counts__delete(evsel->counts);\r\nevsel->counts = NULL;\r\n}
