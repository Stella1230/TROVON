static int __init noexec_setup(char *str)\r\n{\r\nif (!str)\r\nreturn -EINVAL;\r\nif (!strncmp(str, "on", 2)) {\r\ndisable_nx = 0;\r\n} else if (!strncmp(str, "off", 3)) {\r\ndisable_nx = 1;\r\n}\r\nx86_configure_nx();\r\nreturn 0;\r\n}\r\nvoid x86_configure_nx(void)\r\n{\r\nif (cpu_has_nx && !disable_nx)\r\n__supported_pte_mask |= _PAGE_NX;\r\nelse\r\n__supported_pte_mask &= ~_PAGE_NX;\r\n}\r\nvoid __init x86_report_nx(void)\r\n{\r\nif (!cpu_has_nx) {\r\nprintk(KERN_NOTICE "Notice: NX (Execute Disable) protection "\r\n"missing in CPU!\n");\r\n} else {\r\n#if defined(CONFIG_X86_64) || defined(CONFIG_X86_PAE)\r\nif (disable_nx) {\r\nprintk(KERN_INFO "NX (Execute Disable) protection: "\r\n"disabled by kernel command line option\n");\r\n} else {\r\nprintk(KERN_INFO "NX (Execute Disable) protection: "\r\n"active\n");\r\n}\r\n#else\r\nprintk(KERN_NOTICE "Notice: NX (Execute Disable) protection "\r\n"cannot be enabled: non-PAE kernel!\n");\r\n#endif\r\n}\r\n}
