int __init fscache_proc_init(void)\r\n{\r\n_enter("");\r\nif (!proc_mkdir("fs/fscache", NULL))\r\ngoto error_dir;\r\n#ifdef CONFIG_FSCACHE_STATS\r\nif (!proc_create("fs/fscache/stats", S_IFREG | 0444, NULL,\r\n&fscache_stats_fops))\r\ngoto error_stats;\r\n#endif\r\n#ifdef CONFIG_FSCACHE_HISTOGRAM\r\nif (!proc_create("fs/fscache/histogram", S_IFREG | 0444, NULL,\r\n&fscache_histogram_fops))\r\ngoto error_histogram;\r\n#endif\r\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\r\nif (!proc_create("fs/fscache/objects", S_IFREG | 0444, NULL,\r\n&fscache_objlist_fops))\r\ngoto error_objects;\r\n#endif\r\n_leave(" = 0");\r\nreturn 0;\r\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\r\nerror_objects:\r\n#endif\r\n#ifdef CONFIG_FSCACHE_HISTOGRAM\r\nremove_proc_entry("fs/fscache/histogram", NULL);\r\nerror_histogram:\r\n#endif\r\n#ifdef CONFIG_FSCACHE_STATS\r\nremove_proc_entry("fs/fscache/stats", NULL);\r\nerror_stats:\r\n#endif\r\nremove_proc_entry("fs/fscache", NULL);\r\nerror_dir:\r\n_leave(" = -ENOMEM");\r\nreturn -ENOMEM;\r\n}\r\nvoid fscache_proc_cleanup(void)\r\n{\r\n#ifdef CONFIG_FSCACHE_OBJECT_LIST\r\nremove_proc_entry("fs/fscache/objects", NULL);\r\n#endif\r\n#ifdef CONFIG_FSCACHE_HISTOGRAM\r\nremove_proc_entry("fs/fscache/histogram", NULL);\r\n#endif\r\n#ifdef CONFIG_FSCACHE_STATS\r\nremove_proc_entry("fs/fscache/stats", NULL);\r\n#endif\r\nremove_proc_entry("fs/fscache", NULL);\r\n}
