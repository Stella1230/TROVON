static int byt_max98090_init(struct snd_soc_pcm_runtime *runtime)\r\n{\r\nint ret;\r\nstruct snd_soc_codec *codec = runtime->codec;\r\nstruct snd_soc_card *card = runtime->card;\r\nstruct byt_max98090_private *drv = snd_soc_card_get_drvdata(card);\r\nstruct snd_soc_jack *jack = &drv->jack;\r\ncard->dapm.idle_bias_off = true;\r\nret = snd_soc_dai_set_sysclk(runtime->codec_dai,\r\nM98090_REG_SYSTEM_CLOCK,\r\n25000000, SND_SOC_CLOCK_IN);\r\nif (ret < 0) {\r\ndev_err(card->dev, "Can't set codec clock %d\n", ret);\r\nreturn ret;\r\n}\r\nret = snd_soc_jack_new(codec, "Headset",\r\nSND_JACK_LINEOUT | SND_JACK_HEADSET, jack);\r\nif (ret)\r\nreturn ret;\r\nret = snd_soc_jack_add_pins(jack, ARRAY_SIZE(hs_jack_pins),\r\nhs_jack_pins);\r\nif (ret)\r\nreturn ret;\r\nreturn snd_soc_jack_add_gpiods(card->dev->parent, jack,\r\nARRAY_SIZE(hs_jack_gpios),\r\nhs_jack_gpios);\r\n}\r\nstatic int byt_max98090_probe(struct platform_device *pdev)\r\n{\r\nint ret_val = 0;\r\nstruct byt_max98090_private *priv;\r\npriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_ATOMIC);\r\nif (!priv) {\r\ndev_err(&pdev->dev, "allocation failed\n");\r\nreturn -ENOMEM;\r\n}\r\nbyt_max98090_card.dev = &pdev->dev;\r\nsnd_soc_card_set_drvdata(&byt_max98090_card, priv);\r\nret_val = devm_snd_soc_register_card(&pdev->dev, &byt_max98090_card);\r\nif (ret_val) {\r\ndev_err(&pdev->dev,\r\n"snd_soc_register_card failed %d\n", ret_val);\r\nreturn ret_val;\r\n}\r\nreturn ret_val;\r\n}\r\nstatic int byt_max98090_remove(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = platform_get_drvdata(pdev);\r\nstruct byt_max98090_private *priv = snd_soc_card_get_drvdata(card);\r\nsnd_soc_jack_free_gpios(&priv->jack, ARRAY_SIZE(hs_jack_gpios),\r\nhs_jack_gpios);\r\nreturn 0;\r\n}
