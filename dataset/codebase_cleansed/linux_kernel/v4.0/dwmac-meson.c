static void meson6_dwmac_fix_mac_speed(void *priv, unsigned int speed)\r\n{\r\nstruct meson_dwmac *dwmac = priv;\r\nunsigned int val;\r\nval = readl(dwmac->reg);\r\nswitch (speed) {\r\ncase SPEED_10:\r\nval &= ~ETHMAC_SPEED_100;\r\nbreak;\r\ncase SPEED_100:\r\nval |= ETHMAC_SPEED_100;\r\nbreak;\r\n}\r\nwritel(val, dwmac->reg);\r\n}\r\nstatic void *meson6_dwmac_setup(struct platform_device *pdev)\r\n{\r\nstruct meson_dwmac *dwmac;\r\nstruct resource *res;\r\ndwmac = devm_kzalloc(&pdev->dev, sizeof(*dwmac), GFP_KERNEL);\r\nif (!dwmac)\r\nreturn ERR_PTR(-ENOMEM);\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 1);\r\ndwmac->reg = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(dwmac->reg))\r\nreturn ERR_CAST(dwmac->reg);\r\nreturn dwmac;\r\n}
