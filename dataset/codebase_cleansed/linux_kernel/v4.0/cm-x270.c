static void __init cmx270_init_rtc(void)\r\n{\r\nplatform_device_register(&cmx270_rtc_device);\r\n}\r\nstatic inline void cmx270_init_rtc(void) {}\r\nstatic int cmx270_marathon_probe(struct fb_info *fb)\r\n{\r\nint gpio, err;\r\nfor (gpio = 58; gpio <= 77; gpio++) {\r\nerr = gpio_request(gpio, "LCD");\r\nif (err)\r\nreturn err;\r\ngpio_direction_input(gpio);\r\n}\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(cmx270_marathon_on));\r\nreturn 0;\r\n}\r\nstatic int cmx270_marathon_remove(struct fb_info *fb)\r\n{\r\nint gpio;\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(cmx270_marathon_off));\r\nfor (gpio = 58; gpio <= 77; gpio++)\r\ngpio_free(gpio);\r\nreturn 0;\r\n}\r\nstatic void __init cmx270_init_2700G(void)\r\n{\r\nplatform_device_register(&cmx270_2700G);\r\n}\r\nstatic inline void cmx270_init_2700G(void) {}\r\nstatic void __init cmx270_init_ohci(void)\r\n{\r\npxa_set_ohci_info(&cmx270_ohci_platform_data);\r\n}\r\nstatic inline void cmx270_init_ohci(void) {}\r\nstatic void __init cmx270_init_mmc(void)\r\n{\r\npxa_set_mci_info(&cmx270_mci_platform_data);\r\n}\r\nstatic inline void cmx270_init_mmc(void) {}\r\nstatic int cm_x270_libertas_setup(struct spi_device *spi)\r\n{\r\nint err = gpio_request(GPIO19_WLAN_STRAP, "WLAN STRAP");\r\nif (err)\r\nreturn err;\r\nerr = gpio_request(GPIO102_WLAN_RST, "WLAN RST");\r\nif (err)\r\ngoto err_free_strap;\r\nerr = gpio_direction_output(GPIO102_WLAN_RST, 0);\r\nif (err)\r\ngoto err_free_strap;\r\nmsleep(100);\r\nerr = gpio_direction_output(GPIO19_WLAN_STRAP, 1);\r\nif (err)\r\ngoto err_free_strap;\r\nmsleep(100);\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(cm_x270_libertas_pin_config));\r\ngpio_set_value(GPIO102_WLAN_RST, 1);\r\nmsleep(100);\r\nspi->bits_per_word = 16;\r\nspi_setup(spi);\r\nreturn 0;\r\nerr_free_strap:\r\ngpio_free(GPIO19_WLAN_STRAP);\r\nreturn err;\r\n}\r\nstatic int cm_x270_libertas_teardown(struct spi_device *spi)\r\n{\r\ngpio_set_value(GPIO102_WLAN_RST, 0);\r\ngpio_free(GPIO102_WLAN_RST);\r\ngpio_free(GPIO19_WLAN_STRAP);\r\nreturn 0;\r\n}\r\nstatic void __init cmx270_init_spi(void)\r\n{\r\npxa2xx_set_spi_info(2, &cm_x270_spi_info);\r\nspi_register_board_info(ARRAY_AND_SIZE(cm_x270_spi_devices));\r\n}\r\nstatic inline void cmx270_init_spi(void) {}\r\nvoid __init cmx270_init(void)\r\n{\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(cmx270_pin_config));\r\n#ifdef CONFIG_PM\r\npxa27x_set_pwrmode(PWRMODE_DEEPSLEEP);\r\n#endif\r\ncmx270_init_rtc();\r\ncmx270_init_mmc();\r\ncmx270_init_ohci();\r\ncmx270_init_2700G();\r\ncmx270_init_spi();\r\n}
