int wl12xx_wait_for_event(struct wl1271 *wl, enum wlcore_wait_event event,\r\nbool *timeout)\r\n{\r\nu32 local_event;\r\nswitch (event) {\r\ncase WLCORE_EVENT_ROLE_STOP_COMPLETE:\r\nlocal_event = ROLE_STOP_COMPLETE_EVENT_ID;\r\nbreak;\r\ncase WLCORE_EVENT_PEER_REMOVE_COMPLETE:\r\nlocal_event = PEER_REMOVE_COMPLETE_EVENT_ID;\r\nbreak;\r\ndefault:\r\nreturn 0;\r\n}\r\nreturn wlcore_cmd_wait_for_event_or_timeout(wl, local_event, timeout);\r\n}\r\nint wl12xx_process_mailbox_events(struct wl1271 *wl)\r\n{\r\nstruct wl12xx_event_mailbox *mbox = wl->mbox;\r\nu32 vector;\r\nvector = le32_to_cpu(mbox->events_vector);\r\nvector &= ~(le32_to_cpu(mbox->events_mask));\r\nwl1271_debug(DEBUG_EVENT, "MBOX vector: 0x%x", vector);\r\nif (vector & SCAN_COMPLETE_EVENT_ID) {\r\nwl1271_debug(DEBUG_EVENT, "status: 0x%x",\r\nmbox->scheduled_scan_status);\r\nif (wl->scan_wlvif)\r\nwl12xx_scan_completed(wl, wl->scan_wlvif);\r\n}\r\nif (vector & PERIODIC_SCAN_REPORT_EVENT_ID) {\r\nwl1271_debug(DEBUG_EVENT,\r\n"PERIODIC_SCAN_REPORT_EVENT (status 0x%0x)",\r\nmbox->scheduled_scan_status);\r\nwlcore_scan_sched_scan_results(wl);\r\n}\r\nif (vector & PERIODIC_SCAN_COMPLETE_EVENT_ID)\r\nwlcore_event_sched_scan_completed(wl,\r\nmbox->scheduled_scan_status);\r\nif (vector & SOFT_GEMINI_SENSE_EVENT_ID)\r\nwlcore_event_soft_gemini_sense(wl,\r\nmbox->soft_gemini_sense_info);\r\nif (vector & BSS_LOSE_EVENT_ID)\r\nwlcore_event_beacon_loss(wl, 0xff);\r\nif (vector & RSSI_SNR_TRIGGER_0_EVENT_ID)\r\nwlcore_event_rssi_trigger(wl, mbox->rssi_snr_trigger_metric);\r\nif (vector & BA_SESSION_RX_CONSTRAINT_EVENT_ID)\r\nwlcore_event_ba_rx_constraint(wl,\r\nBIT(mbox->role_id),\r\nmbox->rx_ba_allowed);\r\nif (vector & CHANNEL_SWITCH_COMPLETE_EVENT_ID)\r\nwlcore_event_channel_switch(wl, 0xff,\r\nmbox->channel_switch_status);\r\nif (vector & DUMMY_PACKET_EVENT_ID)\r\nwlcore_event_dummy_packet(wl);\r\nif (vector & MAX_TX_RETRY_EVENT_ID)\r\nwlcore_event_max_tx_failure(wl,\r\nle16_to_cpu(mbox->sta_tx_retry_exceeded));\r\nif (vector & INACTIVE_STA_EVENT_ID)\r\nwlcore_event_inactive_sta(wl,\r\nle16_to_cpu(mbox->sta_aging_status));\r\nif (vector & REMAIN_ON_CHANNEL_COMPLETE_EVENT_ID)\r\nwlcore_event_roc_complete(wl);\r\nreturn 0;\r\n}
