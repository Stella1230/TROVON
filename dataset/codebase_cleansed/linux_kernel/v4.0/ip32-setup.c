static inline unsigned char str2hexnum(unsigned char c)\r\n{\r\nif (c >= '0' && c <= '9')\r\nreturn c - '0';\r\nif (c >= 'a' && c <= 'f')\r\nreturn c - 'a' + 10;\r\nreturn 0;\r\n}\r\nstatic inline void str2eaddr(unsigned char *ea, unsigned char *str)\r\n{\r\nint i;\r\nfor (i = 0; i < 6; i++) {\r\nunsigned char num;\r\nif(*str == ':')\r\nstr++;\r\nnum = str2hexnum(*str++) << 4;\r\nnum |= (str2hexnum(*str++));\r\nea[i] = num;\r\n}\r\n}\r\nvoid __init plat_time_init(void)\r\n{\r\nprintk(KERN_INFO "Calibrating system timer... ");\r\nwrite_c0_count(0);\r\ncrime->timer = 0;\r\nwhile (crime->timer < CRIME_MASTER_FREQ * WAIT_MS / 1000) ;\r\nmips_hpt_frequency = read_c0_count() * 1000 / WAIT_MS;\r\nprintk("%d MHz CPU detected\n", mips_hpt_frequency * 2 / 1000000);\r\n}\r\nvoid __init plat_mem_setup(void)\r\n{\r\nboard_be_init = ip32_be_init;\r\n#ifdef CONFIG_SGI_O2MACE_ETH\r\n{\r\nchar *mac = ArcGetEnvironmentVariable("eaddr");\r\nstr2eaddr(o2meth_eaddr, mac);\r\n}\r\n#endif\r\n#if defined(CONFIG_SERIAL_CORE_CONSOLE)\r\n{\r\nchar* con = ArcGetEnvironmentVariable("console");\r\nif (con && *con == 'd') {\r\nstatic char options[8] __initdata;\r\nchar *baud = ArcGetEnvironmentVariable("dbaud");\r\nif (baud)\r\nstrcpy(options, baud);\r\nadd_preferred_console("ttyS", *(con + 1) == '2' ? 1 : 0,\r\nbaud ? options : NULL);\r\n}\r\n}\r\n#endif\r\n}
