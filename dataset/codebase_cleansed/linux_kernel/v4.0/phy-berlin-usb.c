static int phy_berlin_usb_power_on(struct phy *phy)\r\n{\r\nstruct phy_berlin_usb_priv *priv = dev_get_drvdata(phy->dev.parent);\r\nreset_control_reset(priv->rst_ctrl);\r\nwritel(priv->pll_divider,\r\npriv->base + USB_PHY_PLL);\r\nwritel(CLK_STABLE | PLL_CTRL_REG | PHASE_OFF_TOL_250 | KVC0_REG_CTRL |\r\nCLK_BLK_EN, priv->base + USB_PHY_PLL_CONTROL);\r\nwritel(V2I_VCO_RATIO(0x5) | R_ROTATE_0 | ANA_TEST_DC_CTRL(0x5),\r\npriv->base + USB_PHY_ANALOG);\r\nwritel(PHASE_FREEZE_DLY_4_CL | ACK_LENGTH_16_CL | SQ_LENGTH_12 |\r\nDISCON_THRESHOLD_260 | SQ_THRESHOLD(0xa) | LPF_COEF(0x2) |\r\nINTPL_CUR_30, priv->base + USB_PHY_RX_CTRL);\r\nwritel(TX_VDD12_13 | TX_OUT_AMP(0x3), priv->base + USB_PHY_TX_CTRL1);\r\nwritel(EXT_HS_RCAL_EN | IMPCAL_VTH_DIV(0x3) | EXT_RS_RCAL_DIV(0x4),\r\npriv->base + USB_PHY_TX_CTRL0);\r\nwritel(EXT_HS_RCAL_EN | IMPCAL_VTH_DIV(0x3) | EXT_RS_RCAL_DIV(0x4) |\r\nEXT_FS_RCAL_DIV(0x2), priv->base + USB_PHY_TX_CTRL0);\r\nwritel(EXT_HS_RCAL_EN | IMPCAL_VTH_DIV(0x3) | EXT_RS_RCAL_DIV(0x4),\r\npriv->base + USB_PHY_TX_CTRL0);\r\nwritel(TX_CHAN_CTRL_REG(0xf) | DRV_SLEWRATE(0x3) | IMP_CAL_FS_HS_DLY_3 |\r\nFS_DRV_EN_MASK(0xd), priv->base + USB_PHY_TX_CTRL2);\r\nreturn 0;\r\n}\r\nstatic int phy_berlin_usb_probe(struct platform_device *pdev)\r\n{\r\nconst struct of_device_id *match =\r\nof_match_device(phy_berlin_sata_of_match, &pdev->dev);\r\nstruct phy_berlin_usb_priv *priv;\r\nstruct resource *res;\r\nstruct phy_provider *phy_provider;\r\npriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\r\nif (!priv)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\npriv->base = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(priv->base))\r\nreturn PTR_ERR(priv->base);\r\npriv->rst_ctrl = devm_reset_control_get(&pdev->dev, NULL);\r\nif (IS_ERR(priv->rst_ctrl))\r\nreturn PTR_ERR(priv->rst_ctrl);\r\npriv->pll_divider = *((u32 *)match->data);\r\npriv->phy = devm_phy_create(&pdev->dev, NULL, &phy_berlin_usb_ops);\r\nif (IS_ERR(priv->phy)) {\r\ndev_err(&pdev->dev, "failed to create PHY\n");\r\nreturn PTR_ERR(priv->phy);\r\n}\r\nplatform_set_drvdata(pdev, priv);\r\nphy_provider =\r\ndevm_of_phy_provider_register(&pdev->dev, of_phy_simple_xlate);\r\nif (IS_ERR(phy_provider))\r\nreturn PTR_ERR(phy_provider);\r\nreturn 0;\r\n}
