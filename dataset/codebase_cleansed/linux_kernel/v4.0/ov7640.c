static int write_regs(struct i2c_client *client, const u8 *regs)\r\n{\r\nint i;\r\nfor (i = 0; regs[i] != 0xFF; i += 2)\r\nif (i2c_smbus_write_byte_data(client, regs[i], regs[i + 1]) < 0)\r\nreturn -1;\r\nreturn 0;\r\n}\r\nstatic int ov7640_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct i2c_adapter *adapter = client->adapter;\r\nstruct v4l2_subdev *sd;\r\nif (!i2c_check_functionality(adapter, I2C_FUNC_SMBUS_BYTE_DATA))\r\nreturn -ENODEV;\r\nsd = devm_kzalloc(&client->dev, sizeof(*sd), GFP_KERNEL);\r\nif (sd == NULL)\r\nreturn -ENOMEM;\r\nv4l2_i2c_subdev_init(sd, client, &ov7640_ops);\r\nclient->flags = I2C_CLIENT_SCCB;\r\nv4l_info(client, "chip found @ 0x%02x (%s)\n",\r\nclient->addr << 1, client->adapter->name);\r\nif (write_regs(client, initial_registers) < 0) {\r\nv4l_err(client, "error initializing OV7640\n");\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ov7640_remove(struct i2c_client *client)\r\n{\r\nstruct v4l2_subdev *sd = i2c_get_clientdata(client);\r\nv4l2_device_unregister_subdev(sd);\r\nreturn 0;\r\n}
