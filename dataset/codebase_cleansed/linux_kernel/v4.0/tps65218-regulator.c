static int tps65218_pmic_set_voltage_sel(struct regulator_dev *dev,\r\nunsigned selector)\r\n{\r\nint ret;\r\nstruct tps65218 *tps = rdev_get_drvdata(dev);\r\nunsigned int rid = rdev_get_id(dev);\r\nret = tps65218_set_bits(tps, dev->desc->vsel_reg, dev->desc->vsel_mask,\r\nselector, TPS65218_PROTECT_L1);\r\nswitch (rid) {\r\ncase TPS65218_DCDC_1:\r\ncase TPS65218_DCDC_2:\r\nret = tps65218_set_bits(tps, TPS65218_REG_CONTRL_SLEW_RATE,\r\nTPS65218_SLEW_RATE_GO,\r\nTPS65218_SLEW_RATE_GO,\r\nTPS65218_PROTECT_L1);\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int tps65218_pmic_enable(struct regulator_dev *dev)\r\n{\r\nstruct tps65218 *tps = rdev_get_drvdata(dev);\r\nint rid = rdev_get_id(dev);\r\nif (rid < TPS65218_DCDC_1 || rid > TPS65218_LDO_1)\r\nreturn -EINVAL;\r\nreturn tps65218_set_bits(tps, dev->desc->enable_reg,\r\ndev->desc->enable_mask, dev->desc->enable_mask,\r\nTPS65218_PROTECT_L1);\r\n}\r\nstatic int tps65218_pmic_disable(struct regulator_dev *dev)\r\n{\r\nstruct tps65218 *tps = rdev_get_drvdata(dev);\r\nint rid = rdev_get_id(dev);\r\nif (rid < TPS65218_DCDC_1 || rid > TPS65218_LDO_1)\r\nreturn -EINVAL;\r\nreturn tps65218_clear_bits(tps, dev->desc->enable_reg,\r\ndev->desc->enable_mask, TPS65218_PROTECT_L1);\r\n}\r\nstatic int tps65218_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65218 *tps = dev_get_drvdata(pdev->dev.parent);\r\nstruct regulator_init_data *init_data;\r\nconst struct tps_info *template;\r\nstruct regulator_dev *rdev;\r\nconst struct of_device_id *match;\r\nstruct regulator_config config = { };\r\nint id;\r\nmatch = of_match_device(tps65218_of_match, &pdev->dev);\r\nif (!match)\r\nreturn -ENODEV;\r\ntemplate = match->data;\r\nid = template->id;\r\ninit_data = of_get_regulator_init_data(&pdev->dev, pdev->dev.of_node,\r\n&regulators[id]);\r\nplatform_set_drvdata(pdev, tps);\r\ntps->info[id] = &tps65218_pmic_regs[id];\r\nconfig.dev = &pdev->dev;\r\nconfig.init_data = init_data;\r\nconfig.driver_data = tps;\r\nconfig.regmap = tps->regmap;\r\nconfig.of_node = pdev->dev.of_node;\r\nrdev = devm_regulator_register(&pdev->dev, &regulators[id], &config);\r\nif (IS_ERR(rdev)) {\r\ndev_err(tps->dev, "failed to register %s regulator\n",\r\npdev->name);\r\nreturn PTR_ERR(rdev);\r\n}\r\nreturn 0;\r\n}
