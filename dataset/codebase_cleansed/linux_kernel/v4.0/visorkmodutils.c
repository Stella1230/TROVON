static __init uint32_t visorutil_spar_detect(void)\r\n{\r\nunsigned int eax, ebx, ecx, edx;\r\nif (cpu_has_hypervisor) {\r\ncpuid(UNISYS_SPAR_LEAF_ID, &eax, &ebx, &ecx, &edx);\r\nreturn (ebx == UNISYS_SPAR_ID_EBX) &&\r\n(ecx == UNISYS_SPAR_ID_ECX) &&\r\n(edx == UNISYS_SPAR_ID_EDX);\r\n} else {\r\nreturn 0;\r\n}\r\n}\r\nstatic __init int visorutil_mod_init(void)\r\n{\r\nif (visorutil_spar_detect()) {\r\nunisys_spar_platform = TRUE;\r\nreturn 0;\r\n} else {\r\nreturn -ENODEV;\r\n}\r\n}\r\nstatic __exit void\r\nvisorutil_mod_exit(void)\r\n{\r\n}
