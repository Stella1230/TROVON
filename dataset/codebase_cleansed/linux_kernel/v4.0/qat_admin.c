static int qat_send_admin_cmd(struct adf_accel_dev *accel_dev, int cmd)\r\n{\r\nstruct adf_hw_device_data *hw_device = accel_dev->hw_device;\r\nstruct icp_qat_fw_init_admin_req req;\r\nstruct icp_qat_fw_init_admin_resp resp;\r\nint i;\r\nmemset(&req, 0, sizeof(struct icp_qat_fw_init_admin_req));\r\nreq.init_admin_cmd_id = cmd;\r\nfor (i = 0; i < hw_device->get_num_aes(hw_device); i++) {\r\nmemset(&resp, 0, sizeof(struct icp_qat_fw_init_admin_resp));\r\nif (adf_put_admin_msg_sync(accel_dev, i, &req, &resp) ||\r\nresp.init_resp_hdr.status)\r\nreturn -EFAULT;\r\n}\r\nreturn 0;\r\n}\r\nstatic int qat_admin_start(struct adf_accel_dev *accel_dev)\r\n{\r\nreturn qat_send_admin_cmd(accel_dev, ICP_QAT_FW_INIT_ME);\r\n}\r\nstatic int qat_admin_event_handler(struct adf_accel_dev *accel_dev,\r\nenum adf_event event)\r\n{\r\nint ret;\r\nswitch (event) {\r\ncase ADF_EVENT_START:\r\nret = qat_admin_start(accel_dev);\r\nbreak;\r\ncase ADF_EVENT_STOP:\r\ncase ADF_EVENT_INIT:\r\ncase ADF_EVENT_SHUTDOWN:\r\ndefault:\r\nret = 0;\r\n}\r\nreturn ret;\r\n}\r\nint qat_admin_register(void)\r\n{\r\nmemset(&qat_admin, 0, sizeof(struct service_hndl));\r\nqat_admin.event_hld = qat_admin_event_handler;\r\nqat_admin.name = "qat_admin";\r\nqat_admin.admin = 1;\r\nreturn adf_service_register(&qat_admin);\r\n}\r\nint qat_admin_unregister(void)\r\n{\r\nreturn adf_service_unregister(&qat_admin);\r\n}
