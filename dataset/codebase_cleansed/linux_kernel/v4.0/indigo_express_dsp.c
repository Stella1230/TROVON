static int set_sample_rate(struct echoaudio *chip, u32 rate)\r\n{\r\nu32 clock, control_reg, old_control_reg;\r\nif (wait_handshake(chip))\r\nreturn -EIO;\r\nold_control_reg = le32_to_cpu(chip->comm_page->control_register);\r\ncontrol_reg = old_control_reg & ~INDIGO_EXPRESS_CLOCK_MASK;\r\nswitch (rate) {\r\ncase 32000:\r\nclock = INDIGO_EXPRESS_32000;\r\nbreak;\r\ncase 44100:\r\nclock = INDIGO_EXPRESS_44100;\r\nbreak;\r\ncase 48000:\r\nclock = INDIGO_EXPRESS_48000;\r\nbreak;\r\ncase 64000:\r\nclock = INDIGO_EXPRESS_32000|INDIGO_EXPRESS_DOUBLE_SPEED;\r\nbreak;\r\ncase 88200:\r\nclock = INDIGO_EXPRESS_44100|INDIGO_EXPRESS_DOUBLE_SPEED;\r\nbreak;\r\ncase 96000:\r\nclock = INDIGO_EXPRESS_48000|INDIGO_EXPRESS_DOUBLE_SPEED;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\ncontrol_reg |= clock;\r\nif (control_reg != old_control_reg) {\r\ndev_dbg(chip->card->dev,\r\n"set_sample_rate: %d clock %d\n", rate, clock);\r\nchip->comm_page->control_register = cpu_to_le32(control_reg);\r\nchip->sample_rate = rate;\r\nclear_handshake(chip);\r\nreturn send_vector(chip, DSP_VC_UPDATE_CLOCKS);\r\n}\r\nreturn 0;\r\n}\r\nstatic int set_vmixer_gain(struct echoaudio *chip, u16 output, u16 pipe,\r\nint gain)\r\n{\r\nint index;\r\nif (snd_BUG_ON(pipe >= num_pipes_out(chip) ||\r\noutput >= num_busses_out(chip)))\r\nreturn -EINVAL;\r\nif (wait_handshake(chip))\r\nreturn -EIO;\r\nchip->vmixer_gain[output][pipe] = gain;\r\nindex = output * num_pipes_out(chip) + pipe;\r\nchip->comm_page->vmixer[index] = gain;\r\ndev_dbg(chip->card->dev,\r\n"set_vmixer_gain: pipe %d, out %d = %d\n", pipe, output, gain);\r\nreturn 0;\r\n}\r\nstatic int update_vmixer_level(struct echoaudio *chip)\r\n{\r\nif (wait_handshake(chip))\r\nreturn -EIO;\r\nclear_handshake(chip);\r\nreturn send_vector(chip, DSP_VC_SET_VMIXER_GAIN);\r\n}\r\nstatic u32 detect_input_clocks(const struct echoaudio *chip)\r\n{\r\nreturn ECHO_CLOCK_BIT_INTERNAL;\r\n}\r\nstatic int load_asic(struct echoaudio *chip)\r\n{\r\nreturn 0;\r\n}
