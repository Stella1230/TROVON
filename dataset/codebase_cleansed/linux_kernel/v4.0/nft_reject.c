int nft_reject_init(const struct nft_ctx *ctx,\r\nconst struct nft_expr *expr,\r\nconst struct nlattr * const tb[])\r\n{\r\nstruct nft_reject *priv = nft_expr_priv(expr);\r\nif (tb[NFTA_REJECT_TYPE] == NULL)\r\nreturn -EINVAL;\r\npriv->type = ntohl(nla_get_be32(tb[NFTA_REJECT_TYPE]));\r\nswitch (priv->type) {\r\ncase NFT_REJECT_ICMP_UNREACH:\r\nif (tb[NFTA_REJECT_ICMP_CODE] == NULL)\r\nreturn -EINVAL;\r\npriv->icmp_code = nla_get_u8(tb[NFTA_REJECT_ICMP_CODE]);\r\ncase NFT_REJECT_TCP_RST:\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nint nft_reject_dump(struct sk_buff *skb, const struct nft_expr *expr)\r\n{\r\nconst struct nft_reject *priv = nft_expr_priv(expr);\r\nif (nla_put_be32(skb, NFTA_REJECT_TYPE, htonl(priv->type)))\r\ngoto nla_put_failure;\r\nswitch (priv->type) {\r\ncase NFT_REJECT_ICMP_UNREACH:\r\nif (nla_put_u8(skb, NFTA_REJECT_ICMP_CODE, priv->icmp_code))\r\ngoto nla_put_failure;\r\nbreak;\r\n}\r\nreturn 0;\r\nnla_put_failure:\r\nreturn -1;\r\n}\r\nint nft_reject_icmp_code(u8 code)\r\n{\r\nBUG_ON(code > NFT_REJECT_ICMPX_MAX);\r\nreturn icmp_code_v4[code];\r\n}\r\nint nft_reject_icmpv6_code(u8 code)\r\n{\r\nBUG_ON(code > NFT_REJECT_ICMPX_MAX);\r\nreturn icmp_code_v6[code];\r\n}
