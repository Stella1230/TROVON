static void check_signum(int sig)\r\n{\r\nif (sig < 1 || sig >= SIGCHAIN_MAX_SIGNALS)\r\ndie("BUG: signal out of range: %d", sig);\r\n}\r\nstatic int sigchain_push(int sig, sigchain_fun f)\r\n{\r\nstruct sigchain_signal *s = signals + sig;\r\ncheck_signum(sig);\r\nALLOC_GROW(s->old, s->n + 1, s->alloc);\r\ns->old[s->n] = signal(sig, f);\r\nif (s->old[s->n] == SIG_ERR)\r\nreturn -1;\r\ns->n++;\r\nreturn 0;\r\n}\r\nint sigchain_pop(int sig)\r\n{\r\nstruct sigchain_signal *s = signals + sig;\r\ncheck_signum(sig);\r\nif (s->n < 1)\r\nreturn 0;\r\nif (signal(sig, s->old[s->n - 1]) == SIG_ERR)\r\nreturn -1;\r\ns->n--;\r\nreturn 0;\r\n}\r\nvoid sigchain_push_common(sigchain_fun f)\r\n{\r\nsigchain_push(SIGINT, f);\r\nsigchain_push(SIGHUP, f);\r\nsigchain_push(SIGTERM, f);\r\nsigchain_push(SIGQUIT, f);\r\nsigchain_push(SIGPIPE, f);\r\n}
