static void\r\nodm_TXPowerTrackingCallback_ThermalMeter_92C(\r\nstruct rtw_adapter *Adapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nstruct dm_priv *pdmpriv = &pHalData->dmpriv;\r\nu8 ThermalValue = 0, delta, delta_LCK, delta_IQK, delta_HP;\r\nint ele_A, ele_D, TempCCk, X, value32;\r\nint Y, ele_C;\r\ns8 OFDM_index[2], CCK_index = 0, OFDM_index_old[2] = {0};\r\ns8 CCK_index_old = 0;\r\nint i = 0;\r\nbool is2T = IS_92C_SERIAL(pHalData->VersionID);\r\nu8 OFDM_min_index = 6, rf;\r\nu8 ThermalValue_HP_count = 0;\r\nu32 ThermalValue_HP = 0;\r\ns32 index_mapping_HP[index_mapping_HP_NUM] = {\r\n0, 1, 3, 4, 6,\r\n7, 9, 10, 12, 13,\r\n15, 16, 18, 19, 21\r\n};\r\ns8 index_HP;\r\npdmpriv->TXPowerTrackingCallbackCnt++;\r\npdmpriv->bTXPowerTrackingInit = true;\r\nif (pHalData->CurrentChannel == 14 && !pdmpriv->bCCKinCH14)\r\npdmpriv->bCCKinCH14 = true;\r\nelse if (pHalData->CurrentChannel != 14 && pdmpriv->bCCKinCH14)\r\npdmpriv->bCCKinCH14 = false;\r\nThermalValue = (u8)PHY_QueryRFReg(Adapter, RF_PATH_A, RF_T_METER,\r\n0x1f);\r\nrtl8723a_phy_ap_calibrate(Adapter, (ThermalValue -\r\npHalData->EEPROMThermalMeter));\r\nif (is2T)\r\nrf = 2;\r\nelse\r\nrf = 1;\r\nif (ThermalValue) {\r\nele_D = PHY_QueryBBReg(Adapter, rOFDM0_XATxIQImbalance,\r\nbMaskDWord)&bMaskOFDM_D;\r\nfor (i = 0; i < OFDM_TABLE_SIZE_92C; i++) {\r\nif (ele_D == (OFDMSwingTable23A[i]&bMaskOFDM_D)) {\r\nOFDM_index_old[0] = (u8)i;\r\nbreak;\r\n}\r\n}\r\nif (is2T) {\r\nele_D = PHY_QueryBBReg(Adapter, rOFDM0_XBTxIQImbalance,\r\nbMaskDWord)&bMaskOFDM_D;\r\nfor (i = 0; i < OFDM_TABLE_SIZE_92C; i++) {\r\nif (ele_D == (OFDMSwingTable23A[i]&bMaskOFDM_D)) {\r\nOFDM_index_old[1] = (u8)i;\r\nbreak;\r\n}\r\n}\r\n}\r\nTempCCk = PHY_QueryBBReg(Adapter, rCCK0_TxFilter2,\r\nbMaskDWord)&bMaskCCK;\r\nfor (i = 0 ; i < CCK_TABLE_SIZE ; i++) {\r\nif (pdmpriv->bCCKinCH14) {\r\nif (!memcmp(&TempCCk,\r\n&CCKSwingTable_Ch1423A[i][2], 4)) {\r\nCCK_index_old = (u8)i;\r\nbreak;\r\n}\r\n} else {\r\nif (!memcmp(&TempCCk,\r\n&CCKSwingTable_Ch1_Ch1323A[i][2], 4)) {\r\nCCK_index_old = (u8)i;\r\nbreak;\r\n}\r\n}\r\n}\r\nif (!pdmpriv->ThermalValue) {\r\npdmpriv->ThermalValue = pHalData->EEPROMThermalMeter;\r\npdmpriv->ThermalValue_LCK = ThermalValue;\r\npdmpriv->ThermalValue_IQK = ThermalValue;\r\npdmpriv->ThermalValue_DPK = pHalData->EEPROMThermalMeter;\r\nfor (i = 0; i < rf; i++) {\r\npdmpriv->OFDM_index_HP[i] = OFDM_index_old[i];\r\npdmpriv->OFDM_index[i] = OFDM_index_old[i];\r\n}\r\npdmpriv->CCK_index_HP = CCK_index_old;\r\npdmpriv->CCK_index = CCK_index_old;\r\n}\r\nif (pHalData->BoardType == BOARD_USB_High_PA) {\r\npdmpriv->ThermalValue_HP[pdmpriv->ThermalValue_HP_index] = ThermalValue;\r\npdmpriv->ThermalValue_HP_index++;\r\nif (pdmpriv->ThermalValue_HP_index == HP_THERMAL_NUM)\r\npdmpriv->ThermalValue_HP_index = 0;\r\nfor (i = 0; i < HP_THERMAL_NUM; i++) {\r\nif (pdmpriv->ThermalValue_HP[i]) {\r\nThermalValue_HP += pdmpriv->ThermalValue_HP[i];\r\nThermalValue_HP_count++;\r\n}\r\n}\r\nif (ThermalValue_HP_count)\r\nThermalValue = (u8)(ThermalValue_HP / ThermalValue_HP_count);\r\n}\r\ndelta = (ThermalValue > pdmpriv->ThermalValue) ?\r\n(ThermalValue - pdmpriv->ThermalValue) :\r\n(pdmpriv->ThermalValue - ThermalValue);\r\nif (pHalData->BoardType == BOARD_USB_High_PA) {\r\nif (pdmpriv->bDoneTxpower)\r\ndelta_HP = (ThermalValue > pdmpriv->ThermalValue) ?\r\n(ThermalValue - pdmpriv->ThermalValue) :\r\n(pdmpriv->ThermalValue - ThermalValue);\r\nelse\r\ndelta_HP = ThermalValue > pHalData->EEPROMThermalMeter ?\r\n(ThermalValue - pHalData->EEPROMThermalMeter) :\r\n(pHalData->EEPROMThermalMeter - ThermalValue);\r\n} else {\r\ndelta_HP = 0;\r\n}\r\ndelta_LCK = (ThermalValue > pdmpriv->ThermalValue_LCK) ?\r\n(ThermalValue - pdmpriv->ThermalValue_LCK) :\r\n(pdmpriv->ThermalValue_LCK - ThermalValue);\r\ndelta_IQK = (ThermalValue > pdmpriv->ThermalValue_IQK) ?\r\n(ThermalValue - pdmpriv->ThermalValue_IQK) :\r\n(pdmpriv->ThermalValue_IQK - ThermalValue);\r\nif (delta_LCK > 1) {\r\npdmpriv->ThermalValue_LCK = ThermalValue;\r\nrtl8723a_phy_lc_calibrate(Adapter);\r\n}\r\nif ((delta > 0 || delta_HP > 0) && pdmpriv->TxPowerTrackControl) {\r\nif (pHalData->BoardType == BOARD_USB_High_PA) {\r\npdmpriv->bDoneTxpower = true;\r\ndelta_HP = ThermalValue > pHalData->EEPROMThermalMeter ?\r\n(ThermalValue - pHalData->EEPROMThermalMeter) :\r\n(pHalData->EEPROMThermalMeter - ThermalValue);\r\nif (delta_HP > index_mapping_HP_NUM-1)\r\nindex_HP = index_mapping_HP[index_mapping_HP_NUM-1];\r\nelse\r\nindex_HP = index_mapping_HP[delta_HP];\r\nif (ThermalValue > pHalData->EEPROMThermalMeter) {\r\nfor (i = 0; i < rf; i++)\r\nOFDM_index[i] = pdmpriv->OFDM_index_HP[i] - index_HP;\r\nCCK_index = pdmpriv->CCK_index_HP - index_HP;\r\n} else {\r\nfor (i = 0; i < rf; i++)\r\nOFDM_index[i] = pdmpriv->OFDM_index_HP[i] + index_HP;\r\nCCK_index = pdmpriv->CCK_index_HP + index_HP;\r\n}\r\ndelta_HP = (ThermalValue > pdmpriv->ThermalValue) ?\r\n(ThermalValue - pdmpriv->ThermalValue) :\r\n(pdmpriv->ThermalValue - ThermalValue);\r\n} else {\r\nif (ThermalValue > pdmpriv->ThermalValue) {\r\nfor (i = 0; i < rf; i++)\r\npdmpriv->OFDM_index[i] -= delta;\r\npdmpriv->CCK_index -= delta;\r\n} else {\r\nfor (i = 0; i < rf; i++)\r\npdmpriv->OFDM_index[i] += delta;\r\npdmpriv->CCK_index += delta;\r\n}\r\n}\r\nif (pHalData->BoardType != BOARD_USB_High_PA) {\r\nif (ThermalValue > pHalData->EEPROMThermalMeter) {\r\nfor (i = 0; i < rf; i++)\r\nOFDM_index[i] = pdmpriv->OFDM_index[i]+1;\r\nCCK_index = pdmpriv->CCK_index+1;\r\n} else {\r\nfor (i = 0; i < rf; i++)\r\nOFDM_index[i] = pdmpriv->OFDM_index[i];\r\nCCK_index = pdmpriv->CCK_index;\r\n}\r\n}\r\nfor (i = 0; i < rf; i++) {\r\nif (OFDM_index[i] > (OFDM_TABLE_SIZE_92C-1))\r\nOFDM_index[i] = (OFDM_TABLE_SIZE_92C-1);\r\nelse if (OFDM_index[i] < OFDM_min_index)\r\nOFDM_index[i] = OFDM_min_index;\r\n}\r\nif (CCK_index > (CCK_TABLE_SIZE-1))\r\nCCK_index = (CCK_TABLE_SIZE-1);\r\nelse if (CCK_index < 0)\r\nCCK_index = 0;\r\n}\r\nif (pdmpriv->TxPowerTrackControl && (delta != 0 || delta_HP != 0)) {\r\nele_D = (OFDMSwingTable23A[OFDM_index[0]] & 0xFFC00000)>>22;\r\nX = pdmpriv->RegE94;\r\nY = pdmpriv->RegE9C;\r\nif (X != 0) {\r\nif ((X & 0x00000200) != 0)\r\nX = X | 0xFFFFFC00;\r\nele_A = ((X * ele_D)>>8)&0x000003FF;\r\nif ((Y & 0x00000200) != 0)\r\nY = Y | 0xFFFFFC00;\r\nele_C = ((Y * ele_D)>>8)&0x000003FF;\r\nvalue32 = (ele_D<<22)|((ele_C&0x3F)<<16)|ele_A;\r\nPHY_SetBBReg(Adapter, rOFDM0_XATxIQImbalance, bMaskDWord, value32);\r\nvalue32 = (ele_C&0x000003C0)>>6;\r\nPHY_SetBBReg(Adapter, rOFDM0_XCTxAFE, bMaskH4Bits, value32);\r\nvalue32 = ((X * ele_D)>>7)&0x01;\r\nPHY_SetBBReg(Adapter, rOFDM0_ECCAThreshold,\r\nBIT(31), value32);\r\nvalue32 = ((Y * ele_D)>>7)&0x01;\r\nPHY_SetBBReg(Adapter, rOFDM0_ECCAThreshold,\r\nBIT(29), value32);\r\n} else {\r\nPHY_SetBBReg(Adapter, rOFDM0_XATxIQImbalance,\r\nbMaskDWord,\r\nOFDMSwingTable23A[OFDM_index[0]]);\r\nPHY_SetBBReg(Adapter, rOFDM0_XCTxAFE,\r\nbMaskH4Bits, 0x00);\r\nPHY_SetBBReg(Adapter, rOFDM0_ECCAThreshold,\r\nBIT(31) | BIT(29), 0x00);\r\n}\r\nif (!pdmpriv->bCCKinCH14) {\r\nrtl8723au_write8(Adapter, 0xa22, CCKSwingTable_Ch1_Ch1323A[CCK_index][0]);\r\nrtl8723au_write8(Adapter, 0xa23, CCKSwingTable_Ch1_Ch1323A[CCK_index][1]);\r\nrtl8723au_write8(Adapter, 0xa24, CCKSwingTable_Ch1_Ch1323A[CCK_index][2]);\r\nrtl8723au_write8(Adapter, 0xa25, CCKSwingTable_Ch1_Ch1323A[CCK_index][3]);\r\nrtl8723au_write8(Adapter, 0xa26, CCKSwingTable_Ch1_Ch1323A[CCK_index][4]);\r\nrtl8723au_write8(Adapter, 0xa27, CCKSwingTable_Ch1_Ch1323A[CCK_index][5]);\r\nrtl8723au_write8(Adapter, 0xa28, CCKSwingTable_Ch1_Ch1323A[CCK_index][6]);\r\nrtl8723au_write8(Adapter, 0xa29, CCKSwingTable_Ch1_Ch1323A[CCK_index][7]);\r\n} else {\r\nrtl8723au_write8(Adapter, 0xa22, CCKSwingTable_Ch1423A[CCK_index][0]);\r\nrtl8723au_write8(Adapter, 0xa23, CCKSwingTable_Ch1423A[CCK_index][1]);\r\nrtl8723au_write8(Adapter, 0xa24, CCKSwingTable_Ch1423A[CCK_index][2]);\r\nrtl8723au_write8(Adapter, 0xa25, CCKSwingTable_Ch1423A[CCK_index][3]);\r\nrtl8723au_write8(Adapter, 0xa26, CCKSwingTable_Ch1423A[CCK_index][4]);\r\nrtl8723au_write8(Adapter, 0xa27, CCKSwingTable_Ch1423A[CCK_index][5]);\r\nrtl8723au_write8(Adapter, 0xa28, CCKSwingTable_Ch1423A[CCK_index][6]);\r\nrtl8723au_write8(Adapter, 0xa29, CCKSwingTable_Ch1423A[CCK_index][7]);\r\n}\r\nif (is2T) {\r\nele_D = (OFDMSwingTable23A[(u8)OFDM_index[1]] & 0xFFC00000)>>22;\r\nX = pdmpriv->RegEB4;\r\nY = pdmpriv->RegEBC;\r\nif (X != 0) {\r\nif ((X & 0x00000200) != 0)\r\nX = X | 0xFFFFFC00;\r\nele_A = ((X * ele_D)>>8)&0x000003FF;\r\nif ((Y & 0x00000200) != 0)\r\nY = Y | 0xFFFFFC00;\r\nele_C = ((Y * ele_D)>>8)&0x00003FF;\r\nvalue32 = (ele_D<<22)|((ele_C&0x3F)<<16) | ele_A;\r\nPHY_SetBBReg(Adapter, rOFDM0_XBTxIQImbalance, bMaskDWord, value32);\r\nvalue32 = (ele_C&0x000003C0)>>6;\r\nPHY_SetBBReg(Adapter, rOFDM0_XDTxAFE, bMaskH4Bits, value32);\r\nvalue32 = ((X * ele_D)>>7)&0x01;\r\nPHY_SetBBReg(Adapter,\r\nrOFDM0_ECCAThreshold,\r\nBIT(27), value32);\r\nvalue32 = ((Y * ele_D)>>7)&0x01;\r\nPHY_SetBBReg(Adapter,\r\nrOFDM0_ECCAThreshold,\r\nBIT(25), value32);\r\n} else {\r\nPHY_SetBBReg(Adapter,\r\nrOFDM0_XBTxIQImbalance,\r\nbMaskDWord,\r\nOFDMSwingTable23A[OFDM_index[1]]);\r\nPHY_SetBBReg(Adapter,\r\nrOFDM0_XDTxAFE,\r\nbMaskH4Bits, 0x00);\r\nPHY_SetBBReg(Adapter,\r\nrOFDM0_ECCAThreshold,\r\nBIT(27) | BIT(25), 0x00);\r\n}\r\n}\r\n}\r\nif (delta_IQK > 3) {\r\npdmpriv->ThermalValue_IQK = ThermalValue;\r\nrtl8723a_phy_iq_calibrate(Adapter, false);\r\n}\r\nif (pdmpriv->TxPowerTrackControl)\r\npdmpriv->ThermalValue = ThermalValue;\r\n}\r\npdmpriv->TXPowercount = 0;\r\n}\r\nstatic void ODM_TXPowerTracking92CDirectCall(struct rtw_adapter *Adapter)\r\n{\r\nodm_TXPowerTrackingCallback_ThermalMeter_92C(Adapter);\r\n}\r\nstatic void odm_CheckTXPowerTracking_ThermalMeter(struct rtw_adapter *Adapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(Adapter);\r\nstruct dm_priv *pdmpriv = &pHalData->dmpriv;\r\nstruct dm_odm_t *podmpriv = &pHalData->odmpriv;\r\nif (!(podmpriv->SupportAbility & ODM_RF_TX_PWR_TRACK))\r\nreturn;\r\nif (!pdmpriv->TM_Trigger) {\r\nPHY_SetRFReg(Adapter, RF_PATH_A, RF_T_METER, bRFRegOffsetMask, 0x60);\r\npdmpriv->TM_Trigger = 1;\r\nreturn;\r\n} else {\r\nODM_TXPowerTracking92CDirectCall(Adapter);\r\npdmpriv->TM_Trigger = 0;\r\n}\r\n}\r\nvoid rtl8723a_odm_check_tx_power_tracking(struct rtw_adapter *Adapter)\r\n{\r\nodm_CheckTXPowerTracking_ThermalMeter(Adapter);\r\n}\r\nstatic u8 _PHY_PathA_IQK(struct rtw_adapter *pAdapter, bool configPathB)\r\n{\r\nu32 regEAC, regE94, regE9C, regEA4;\r\nu8 result = 0x00;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(pAdapter);\r\nPHY_SetBBReg(pAdapter, rTx_IQK_Tone_A, bMaskDWord, 0x10008c1f);\r\nPHY_SetBBReg(pAdapter, rRx_IQK_Tone_A, bMaskDWord, 0x10008c1f);\r\nPHY_SetBBReg(pAdapter, rTx_IQK_PI_A, bMaskDWord, 0x82140102);\r\nPHY_SetBBReg(pAdapter, rRx_IQK_PI_A, bMaskDWord, configPathB ? 0x28160202 :\r\nIS_81xxC_VENDOR_UMC_B_CUT(pHalData->VersionID)?0x28160202:0x28160502);\r\nif (configPathB) {\r\nPHY_SetBBReg(pAdapter, rTx_IQK_Tone_B, bMaskDWord, 0x10008c22);\r\nPHY_SetBBReg(pAdapter, rRx_IQK_Tone_B, bMaskDWord, 0x10008c22);\r\nPHY_SetBBReg(pAdapter, rTx_IQK_PI_B, bMaskDWord, 0x82140102);\r\nPHY_SetBBReg(pAdapter, rRx_IQK_PI_B, bMaskDWord, 0x28160202);\r\n}\r\nPHY_SetBBReg(pAdapter, rIQK_AGC_Rsp, bMaskDWord, 0x001028d1);\r\nPHY_SetBBReg(pAdapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\r\nPHY_SetBBReg(pAdapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\r\nudelay(IQK_DELAY_TIME*1000);\r\nregEAC = PHY_QueryBBReg(pAdapter, rRx_Power_After_IQK_A_2, bMaskDWord);\r\nregE94 = PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_A, bMaskDWord);\r\nregE9C = PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_A, bMaskDWord);\r\nregEA4 = PHY_QueryBBReg(pAdapter, rRx_Power_Before_IQK_A_2, bMaskDWord);\r\nif (!(regEAC & BIT(28)) &&\r\n(((regE94 & 0x03FF0000)>>16) != 0x142) &&\r\n(((regE9C & 0x03FF0000)>>16) != 0x42))\r\nresult |= 0x01;\r\nelse\r\nreturn result;\r\nif (!(regEAC & BIT(27)) &&\r\n(((regEA4 & 0x03FF0000)>>16) != 0x132) &&\r\n(((regEAC & 0x03FF0000)>>16) != 0x36))\r\nresult |= 0x02;\r\nelse\r\nDBG_8723A("Path A Rx IQK fail!!\n");\r\nreturn result;\r\n}\r\nstatic u8 _PHY_PathB_IQK(struct rtw_adapter *pAdapter)\r\n{\r\nu32 regEAC, regEB4, regEBC, regEC4, regECC;\r\nu8 result = 0x00;\r\nPHY_SetBBReg(pAdapter, rIQK_AGC_Cont, bMaskDWord, 0x00000002);\r\nPHY_SetBBReg(pAdapter, rIQK_AGC_Cont, bMaskDWord, 0x00000000);\r\nudelay(IQK_DELAY_TIME*1000);\r\nregEAC = PHY_QueryBBReg(pAdapter, rRx_Power_After_IQK_A_2, bMaskDWord);\r\nregEB4 = PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_B, bMaskDWord);\r\nregEBC = PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_B, bMaskDWord);\r\nregEC4 = PHY_QueryBBReg(pAdapter, rRx_Power_Before_IQK_B_2, bMaskDWord);\r\nregECC = PHY_QueryBBReg(pAdapter, rRx_Power_After_IQK_B_2, bMaskDWord);\r\nif (!(regEAC & BIT(31)) &&\r\n(((regEB4 & 0x03FF0000)>>16) != 0x142) &&\r\n(((regEBC & 0x03FF0000)>>16) != 0x42))\r\nresult |= 0x01;\r\nelse\r\nreturn result;\r\nif (!(regEAC & BIT(30)) &&\r\n(((regEC4 & 0x03FF0000)>>16) != 0x132) &&\r\n(((regECC & 0x03FF0000)>>16) != 0x36))\r\nresult |= 0x02;\r\nelse\r\nDBG_8723A("Path B Rx IQK fail!!\n");\r\nreturn result;\r\n}\r\nstatic void _PHY_PathAFillIQKMatrix(struct rtw_adapter *pAdapter,\r\nbool bIQKOK,\r\nint result[][8],\r\nu8 final_candidate,\r\nbool bTxOnly\r\n)\r\n{\r\nu32 Oldval_0, X, TX0_A, reg;\r\ns32 Y, TX0_C;\r\nDBG_8723A("Path A IQ Calibration %s !\n", (bIQKOK)?"Success":"Failed");\r\nif (final_candidate == 0xFF) {\r\nreturn;\r\n} else if (bIQKOK) {\r\nOldval_0 = (PHY_QueryBBReg(pAdapter, rOFDM0_XATxIQImbalance, bMaskDWord) >> 22) & 0x3FF;\r\nX = result[final_candidate][0];\r\nif ((X & 0x00000200) != 0)\r\nX = X | 0xFFFFFC00;\r\nTX0_A = (X * Oldval_0) >> 8;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XATxIQImbalance, 0x3FF, TX0_A);\r\nPHY_SetBBReg(pAdapter, rOFDM0_ECCAThreshold, BIT(31), ((X * Oldval_0>>7) & 0x1));\r\nY = result[final_candidate][1];\r\nif ((Y & 0x00000200) != 0)\r\nY = Y | 0xFFFFFC00;\r\nTX0_C = (Y * Oldval_0) >> 8;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XCTxAFE, 0xF0000000, ((TX0_C&0x3C0)>>6));\r\nPHY_SetBBReg(pAdapter, rOFDM0_XATxIQImbalance, 0x003F0000, (TX0_C&0x3F));\r\nPHY_SetBBReg(pAdapter, rOFDM0_ECCAThreshold, BIT(29), ((Y * Oldval_0>>7) & 0x1));\r\nif (bTxOnly) {\r\nDBG_8723A("_PHY_PathAFillIQKMatrix only Tx OK\n");\r\nreturn;\r\n}\r\nreg = result[final_candidate][2];\r\nPHY_SetBBReg(pAdapter, rOFDM0_XARxIQImbalance, 0x3FF, reg);\r\nreg = result[final_candidate][3] & 0x3F;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XARxIQImbalance, 0xFC00, reg);\r\nreg = (result[final_candidate][3] >> 6) & 0xF;\r\nPHY_SetBBReg(pAdapter, rOFDM0_RxIQExtAnta, 0xF0000000, reg);\r\n}\r\n}\r\nstatic void _PHY_PathBFillIQKMatrix(struct rtw_adapter *pAdapter, bool bIQKOK, int result[][8], u8 final_candidate, bool bTxOnly)\r\n{\r\nu32 Oldval_1, X, TX1_A, reg;\r\ns32 Y, TX1_C;\r\nDBG_8723A("Path B IQ Calibration %s !\n", (bIQKOK)?"Success":"Failed");\r\nif (final_candidate == 0xFF) {\r\nreturn;\r\n} else if (bIQKOK) {\r\nOldval_1 = (PHY_QueryBBReg(pAdapter, rOFDM0_XBTxIQImbalance, bMaskDWord) >> 22) & 0x3FF;\r\nX = result[final_candidate][4];\r\nif ((X & 0x00000200) != 0)\r\nX = X | 0xFFFFFC00;\r\nTX1_A = (X * Oldval_1) >> 8;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XBTxIQImbalance, 0x3FF, TX1_A);\r\nPHY_SetBBReg(pAdapter, rOFDM0_ECCAThreshold, BIT(27), ((X * Oldval_1>>7) & 0x1));\r\nY = result[final_candidate][5];\r\nif ((Y & 0x00000200) != 0)\r\nY = Y | 0xFFFFFC00;\r\nTX1_C = (Y * Oldval_1) >> 8;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XDTxAFE, 0xF0000000, ((TX1_C&0x3C0)>>6));\r\nPHY_SetBBReg(pAdapter, rOFDM0_XBTxIQImbalance, 0x003F0000, (TX1_C&0x3F));\r\nPHY_SetBBReg(pAdapter, rOFDM0_ECCAThreshold, BIT(25), ((Y * Oldval_1>>7) & 0x1));\r\nif (bTxOnly)\r\nreturn;\r\nreg = result[final_candidate][6];\r\nPHY_SetBBReg(pAdapter, rOFDM0_XBRxIQImbalance, 0x3FF, reg);\r\nreg = result[final_candidate][7] & 0x3F;\r\nPHY_SetBBReg(pAdapter, rOFDM0_XBRxIQImbalance, 0xFC00, reg);\r\nreg = (result[final_candidate][7] >> 6) & 0xF;\r\nPHY_SetBBReg(pAdapter, rOFDM0_AGCRSSITable, 0x0000F000, reg);\r\n}\r\n}\r\nstatic void _PHY_SaveADDARegisters(struct rtw_adapter *pAdapter, u32 *ADDAReg, u32 *ADDABackup, u32 RegisterNum)\r\n{\r\nu32 i;\r\nfor (i = 0 ; i < RegisterNum ; i++) {\r\nADDABackup[i] = PHY_QueryBBReg(pAdapter, ADDAReg[i], bMaskDWord);\r\n}\r\n}\r\nstatic void _PHY_SaveMACRegisters(struct rtw_adapter *pAdapter, u32 *MACReg, u32 *MACBackup)\r\n{\r\nu32 i;\r\nfor (i = 0 ; i < (IQK_MAC_REG_NUM - 1); i++) {\r\nMACBackup[i] = rtl8723au_read8(pAdapter, MACReg[i]);\r\n}\r\nMACBackup[i] = rtl8723au_read32(pAdapter, MACReg[i]);\r\n}\r\nstatic void _PHY_ReloadADDARegisters(struct rtw_adapter *pAdapter, u32 *ADDAReg, u32 *ADDABackup, u32 RegiesterNum)\r\n{\r\nu32 i;\r\nfor (i = 0 ; i < RegiesterNum ; i++) {\r\nPHY_SetBBReg(pAdapter, ADDAReg[i], bMaskDWord, ADDABackup[i]);\r\n}\r\n}\r\nstatic void _PHY_ReloadMACRegisters(struct rtw_adapter *pAdapter, u32 *MACReg, u32 *MACBackup)\r\n{\r\nu32 i;\r\nfor (i = 0 ; i < (IQK_MAC_REG_NUM - 1); i++)\r\nrtl8723au_write8(pAdapter, MACReg[i], (u8)MACBackup[i]);\r\nrtl8723au_write32(pAdapter, MACReg[i], MACBackup[i]);\r\n}\r\nstatic void _PHY_PathADDAOn(struct rtw_adapter *pAdapter, u32 *ADDAReg, bool isPathAOn, bool is2T)\r\n{\r\nu32 pathOn;\r\nu32 i;\r\npathOn = isPathAOn ? 0x04db25a4 : 0x0b1b25a4;\r\nif (!is2T) {\r\npathOn = 0x0bdb25a0;\r\nPHY_SetBBReg(pAdapter, ADDAReg[0], bMaskDWord, 0x0b1b25a0);\r\n} else {\r\nPHY_SetBBReg(pAdapter, ADDAReg[0], bMaskDWord, pathOn);\r\n}\r\nfor (i = 1 ; i < IQK_ADDA_REG_NUM ; i++)\r\nPHY_SetBBReg(pAdapter, ADDAReg[i], bMaskDWord, pathOn);\r\n}\r\nstatic void _PHY_MACSettingCalibration(struct rtw_adapter *pAdapter, u32 *MACReg, u32 *MACBackup)\r\n{\r\nu32 i = 0;\r\nrtl8723au_write8(pAdapter, MACReg[i], 0x3F);\r\nfor (i = 1 ; i < (IQK_MAC_REG_NUM - 1); i++) {\r\nrtl8723au_write8(pAdapter, MACReg[i],\r\n(u8)(MACBackup[i] & ~BIT(3)));\r\n}\r\nrtl8723au_write8(pAdapter, MACReg[i], (u8)(MACBackup[i] & ~BIT(5)));\r\n}\r\nstatic void _PHY_PathAStandBy(struct rtw_adapter *pAdapter)\r\n{\r\nPHY_SetBBReg(pAdapter, rFPGA0_IQK, bMaskDWord, 0x0);\r\nPHY_SetBBReg(pAdapter, 0x840, bMaskDWord, 0x00010000);\r\nPHY_SetBBReg(pAdapter, rFPGA0_IQK, bMaskDWord, 0x80800000);\r\n}\r\nstatic void _PHY_PIModeSwitch(struct rtw_adapter *pAdapter, bool PIMode)\r\n{\r\nu32 mode;\r\nmode = PIMode ? 0x01000100 : 0x01000000;\r\nPHY_SetBBReg(pAdapter, 0x820, bMaskDWord, mode);\r\nPHY_SetBBReg(pAdapter, 0x828, bMaskDWord, mode);\r\n}\r\nstatic bool _PHY_SimularityCompare(struct rtw_adapter *pAdapter, int result[][8], u8 c1, u8 c2)\r\n{\r\nu32 i, j, diff, SimularityBitMap, bound = 0;\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(pAdapter);\r\nu8 final_candidate[2] = {0xFF, 0xFF};\r\nbool bResult = true, is2T = IS_92C_SERIAL(pHalData->VersionID);\r\nif (is2T)\r\nbound = 8;\r\nelse\r\nbound = 4;\r\nSimularityBitMap = 0;\r\nfor (i = 0; i < bound; i++) {\r\ndiff = (result[c1][i] > result[c2][i]) ? (result[c1][i] - result[c2][i]) : (result[c2][i] - result[c1][i]);\r\nif (diff > MAX_TOLERANCE) {\r\nif ((i == 2 || i == 6) && !SimularityBitMap) {\r\nif (result[c1][i]+result[c1][i+1] == 0)\r\nfinal_candidate[(i/4)] = c2;\r\nelse if (result[c2][i]+result[c2][i+1] == 0)\r\nfinal_candidate[(i/4)] = c1;\r\nelse\r\nSimularityBitMap = SimularityBitMap|(1<<i);\r\n} else {\r\nSimularityBitMap = SimularityBitMap|(1<<i);\r\n}\r\n}\r\n}\r\nif (SimularityBitMap == 0) {\r\nfor (i = 0; i < (bound/4); i++) {\r\nif (final_candidate[i] != 0xFF) {\r\nfor (j = i*4; j < (i+1)*4-2; j++)\r\nresult[3][j] = result[final_candidate[i]][j];\r\nbResult = false;\r\n}\r\n}\r\nreturn bResult;\r\n} else if (!(SimularityBitMap & 0x0F)) {\r\nfor (i = 0; i < 4; i++)\r\nresult[3][i] = result[c1][i];\r\nreturn false;\r\n} else if (!(SimularityBitMap & 0xF0) && is2T) {\r\nfor (i = 4; i < 8; i++)\r\nresult[3][i] = result[c1][i];\r\nreturn false;\r\n} else {\r\nreturn false;\r\n}\r\n}\r\nstatic void _PHY_IQCalibrate(struct rtw_adapter *pAdapter, int result[][8], u8 t, bool is2T)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(pAdapter);\r\nstruct dm_priv *pdmpriv = &pHalData->dmpriv;\r\nu32 i;\r\nu8 PathAOK, PathBOK;\r\nu32 ADDA_REG[IQK_ADDA_REG_NUM] = {\r\nrFPGA0_XCD_SwitchControl, rBlue_Tooth,\r\nrRx_Wait_CCA, rTx_CCK_RFON,\r\nrTx_CCK_BBON, rTx_OFDM_RFON,\r\nrTx_OFDM_BBON, rTx_To_Rx,\r\nrTx_To_Tx, rRx_CCK,\r\nrRx_OFDM, rRx_Wait_RIFS,\r\nrRx_TO_Rx, rStandby,\r\nrSleep, rPMPD_ANAEN\r\n};\r\nu32 IQK_MAC_REG[IQK_MAC_REG_NUM] = {\r\nREG_TXPAUSE, REG_BCN_CTRL,\r\nREG_BCN_CTRL_1, REG_GPIO_MUXCFG\r\n};\r\nu32 IQK_BB_REG_92C[IQK_BB_REG_NUM] = {\r\nrOFDM0_TRxPathEnable, rOFDM0_TRMuxPar,\r\nrFPGA0_XCD_RFInterfaceSW, rConfig_AntA, rConfig_AntB,\r\nrFPGA0_XAB_RFInterfaceSW, rFPGA0_XA_RFInterfaceOE,\r\nrFPGA0_XB_RFInterfaceOE, rFPGA0_RFMOD\r\n};\r\nconst u32 retryCount = 2;\r\nu32 bbvalue;\r\nif (t == 0) {\r\nbbvalue = PHY_QueryBBReg(pAdapter, rFPGA0_RFMOD, bMaskDWord);\r\n_PHY_SaveADDARegisters(pAdapter, ADDA_REG, pdmpriv->ADDA_backup, IQK_ADDA_REG_NUM);\r\n_PHY_SaveMACRegisters(pAdapter, IQK_MAC_REG, pdmpriv->IQK_MAC_backup);\r\n_PHY_SaveADDARegisters(pAdapter, IQK_BB_REG_92C, pdmpriv->IQK_BB_backup, IQK_BB_REG_NUM);\r\n}\r\n_PHY_PathADDAOn(pAdapter, ADDA_REG, true, is2T);\r\nif (t == 0)\r\npdmpriv->bRfPiEnable = (u8)\r\nPHY_QueryBBReg(pAdapter, rFPGA0_XA_HSSIParameter1,\r\nBIT(8));\r\nif (!pdmpriv->bRfPiEnable) {\r\n_PHY_PIModeSwitch(pAdapter, true);\r\n}\r\nPHY_SetBBReg(pAdapter, rFPGA0_RFMOD, BIT(24), 0x00);\r\nPHY_SetBBReg(pAdapter, rOFDM0_TRxPathEnable, bMaskDWord, 0x03a05600);\r\nPHY_SetBBReg(pAdapter, rOFDM0_TRMuxPar, bMaskDWord, 0x000800e4);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XCD_RFInterfaceSW, bMaskDWord, 0x22204000);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XAB_RFInterfaceSW, BIT(10), 0x01);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XAB_RFInterfaceSW, BIT(26), 0x01);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XA_RFInterfaceOE, BIT(10), 0x00);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XB_RFInterfaceOE, BIT(10), 0x00);\r\nif (is2T) {\r\nPHY_SetBBReg(pAdapter, rFPGA0_XA_LSSIParameter, bMaskDWord, 0x00010000);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XB_LSSIParameter, bMaskDWord, 0x00010000);\r\n}\r\n_PHY_MACSettingCalibration(pAdapter, IQK_MAC_REG, pdmpriv->IQK_MAC_backup);\r\nPHY_SetBBReg(pAdapter, rConfig_AntA, bMaskDWord, 0x00080000);\r\nif (is2T)\r\nPHY_SetBBReg(pAdapter, rConfig_AntB, bMaskDWord, 0x00080000);\r\nPHY_SetBBReg(pAdapter, rFPGA0_IQK, bMaskDWord, 0x80800000);\r\nPHY_SetBBReg(pAdapter, rTx_IQK, bMaskDWord, 0x01007c00);\r\nPHY_SetBBReg(pAdapter, rRx_IQK, bMaskDWord, 0x01004800);\r\nfor (i = 0 ; i < retryCount ; i++) {\r\nPathAOK = _PHY_PathA_IQK(pAdapter, is2T);\r\nif (PathAOK == 0x03) {\r\nDBG_8723A("Path A IQK Success!!\n");\r\nresult[t][0] = (PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_A, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][1] = (PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_A, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][2] = (PHY_QueryBBReg(pAdapter, rRx_Power_Before_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][3] = (PHY_QueryBBReg(pAdapter, rRx_Power_After_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\r\nbreak;\r\n} else if (i == (retryCount-1) && PathAOK == 0x01) {\r\nDBG_8723A("Path A IQK Only Tx Success!!\n");\r\nresult[t][0] = (PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_A, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][1] = (PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_A, bMaskDWord)&0x3FF0000)>>16;\r\n}\r\n}\r\nif (0x00 == PathAOK) {\r\nDBG_8723A("Path A IQK failed!!\n");\r\n}\r\nif (is2T) {\r\n_PHY_PathAStandBy(pAdapter);\r\n_PHY_PathADDAOn(pAdapter, ADDA_REG, false, is2T);\r\nfor (i = 0 ; i < retryCount ; i++) {\r\nPathBOK = _PHY_PathB_IQK(pAdapter);\r\nif (PathBOK == 0x03) {\r\nDBG_8723A("Path B IQK Success!!\n");\r\nresult[t][4] = (PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_B, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][5] = (PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_B, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][6] = (PHY_QueryBBReg(pAdapter, rRx_Power_Before_IQK_B_2, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][7] = (PHY_QueryBBReg(pAdapter, rRx_Power_After_IQK_B_2, bMaskDWord)&0x3FF0000)>>16;\r\nbreak;\r\n} else if (i == (retryCount - 1) && PathBOK == 0x01) {\r\nDBG_8723A("Path B Only Tx IQK Success!!\n");\r\nresult[t][4] = (PHY_QueryBBReg(pAdapter, rTx_Power_Before_IQK_B, bMaskDWord)&0x3FF0000)>>16;\r\nresult[t][5] = (PHY_QueryBBReg(pAdapter, rTx_Power_After_IQK_B, bMaskDWord)&0x3FF0000)>>16;\r\n}\r\n}\r\nif (0x00 == PathBOK) {\r\nDBG_8723A("Path B IQK failed!!\n");\r\n}\r\n}\r\nPHY_SetBBReg(pAdapter, rFPGA0_IQK, bMaskDWord, 0);\r\nif (t != 0) {\r\nif (!pdmpriv->bRfPiEnable) {\r\n_PHY_PIModeSwitch(pAdapter, false);\r\n}\r\n_PHY_ReloadADDARegisters(pAdapter, ADDA_REG, pdmpriv->ADDA_backup, IQK_ADDA_REG_NUM);\r\n_PHY_ReloadMACRegisters(pAdapter, IQK_MAC_REG, pdmpriv->IQK_MAC_backup);\r\n_PHY_ReloadADDARegisters(pAdapter, IQK_BB_REG_92C, pdmpriv->IQK_BB_backup, IQK_BB_REG_NUM);\r\nPHY_SetBBReg(pAdapter, rFPGA0_XA_LSSIParameter, bMaskDWord, 0x00032ed3);\r\nif (is2T) {\r\nPHY_SetBBReg(pAdapter, rFPGA0_XB_LSSIParameter, bMaskDWord, 0x00032ed3);\r\n}\r\nPHY_SetBBReg(pAdapter, rTx_IQK_Tone_A, bMaskDWord, 0x01008c00);\r\nPHY_SetBBReg(pAdapter, rRx_IQK_Tone_A, bMaskDWord, 0x01008c00);\r\n}\r\n}\r\nstatic void _PHY_LCCalibrate(struct rtw_adapter *pAdapter, bool is2T)\r\n{\r\nu8 tmpReg;\r\nu32 RF_Amode = 0, RF_Bmode = 0, LC_Cal;\r\ntmpReg = rtl8723au_read8(pAdapter, 0xd03);\r\nif ((tmpReg&0x70) != 0) {\r\nrtl8723au_write8(pAdapter, 0xd03, tmpReg&0x8F);\r\n} else {\r\nrtl8723au_write8(pAdapter, REG_TXPAUSE, 0xFF);\r\n}\r\nif ((tmpReg&0x70) != 0) {\r\nRF_Amode = PHY_QueryRFReg(pAdapter, RF_PATH_A, RF_AC, bMask12Bits);\r\nif (is2T)\r\nRF_Bmode = PHY_QueryRFReg(pAdapter, RF_PATH_B, RF_AC, bMask12Bits);\r\nPHY_SetRFReg(pAdapter, RF_PATH_A, RF_AC, bMask12Bits, (RF_Amode&0x8FFFF)|0x10000);\r\nif (is2T)\r\nPHY_SetRFReg(pAdapter, RF_PATH_B, RF_AC, bMask12Bits, (RF_Bmode&0x8FFFF)|0x10000);\r\n}\r\nLC_Cal = PHY_QueryRFReg(pAdapter, RF_PATH_A, RF_CHNLBW, bMask12Bits);\r\nPHY_SetRFReg(pAdapter, RF_PATH_A, RF_CHNLBW, bMask12Bits, LC_Cal|0x08000);\r\nmsleep(100);\r\nif ((tmpReg&0x70) != 0) {\r\nrtl8723au_write8(pAdapter, 0xd03, tmpReg);\r\nPHY_SetRFReg(pAdapter, RF_PATH_A, RF_AC, bMask12Bits, RF_Amode);\r\nif (is2T)\r\nPHY_SetRFReg(pAdapter, RF_PATH_B, RF_AC, bMask12Bits, RF_Bmode);\r\n} else\r\nrtl8723au_write8(pAdapter, REG_TXPAUSE, 0x00);\r\n}\r\nvoid rtl8723a_phy_iq_calibrate(struct rtw_adapter *pAdapter, bool bReCovery)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(pAdapter);\r\nstruct dm_priv *pdmpriv = &pHalData->dmpriv;\r\ns32 result[4][8];\r\nu8 i, final_candidate;\r\nbool bPathAOK, bPathBOK;\r\ns32 RegE94, RegE9C, RegEA4, RegEAC, RegEB4, RegEBC, RegEC4;\r\ns32 RegECC, RegTmp = 0;\r\nbool is12simular, is13simular, is23simular;\r\nbool bStartContTx = false, bSingleTone = false;\r\nbool bCarrierSuppression = false;\r\nu32 IQK_BB_REG_92C[IQK_BB_REG_NUM] = {\r\nrOFDM0_XARxIQImbalance, rOFDM0_XBRxIQImbalance,\r\nrOFDM0_ECCAThreshold, rOFDM0_AGCRSSITable,\r\nrOFDM0_XATxIQImbalance, rOFDM0_XBTxIQImbalance,\r\nrOFDM0_XCTxAFE, rOFDM0_XDTxAFE,\r\nrOFDM0_RxIQExtAnta\r\n};\r\nif (bStartContTx || bSingleTone || bCarrierSuppression)\r\nreturn;\r\nif (bReCovery) {\r\n_PHY_ReloadADDARegisters(pAdapter, IQK_BB_REG_92C, pdmpriv->IQK_BB_backup_recover, 9);\r\nreturn;\r\n}\r\nDBG_8723A("IQK:Start!!!\n");\r\nfor (i = 0; i < 8; i++) {\r\nresult[0][i] = 0;\r\nresult[1][i] = 0;\r\nresult[2][i] = 0;\r\nresult[3][i] = 0;\r\n}\r\nfinal_candidate = 0xff;\r\nbPathAOK = false;\r\nbPathBOK = false;\r\nis12simular = false;\r\nis23simular = false;\r\nis13simular = false;\r\nfor (i = 0; i < 3; i++) {\r\nif (IS_92C_SERIAL(pHalData->VersionID)) {\r\n_PHY_IQCalibrate(pAdapter, result, i, true);\r\n} else {\r\n_PHY_IQCalibrate(pAdapter, result, i, false);\r\n}\r\nif (i == 1) {\r\nis12simular = _PHY_SimularityCompare(pAdapter, result, 0, 1);\r\nif (is12simular) {\r\nfinal_candidate = 0;\r\nbreak;\r\n}\r\n}\r\nif (i == 2) {\r\nis13simular = _PHY_SimularityCompare(pAdapter, result, 0, 2);\r\nif (is13simular) {\r\nfinal_candidate = 0;\r\nbreak;\r\n}\r\nis23simular = _PHY_SimularityCompare(pAdapter, result, 1, 2);\r\nif (is23simular) {\r\nfinal_candidate = 1;\r\n} else {\r\nfor (i = 0; i < 8; i++)\r\nRegTmp += result[3][i];\r\nif (RegTmp != 0)\r\nfinal_candidate = 3;\r\nelse\r\nfinal_candidate = 0xFF;\r\n}\r\n}\r\n}\r\nfor (i = 0; i < 4; i++) {\r\nRegE94 = result[i][0];\r\nRegE9C = result[i][1];\r\nRegEA4 = result[i][2];\r\nRegEAC = result[i][3];\r\nRegEB4 = result[i][4];\r\nRegEBC = result[i][5];\r\nRegEC4 = result[i][6];\r\nRegECC = result[i][7];\r\n}\r\nif (final_candidate != 0xff) {\r\nRegE94 = result[final_candidate][0];\r\npdmpriv->RegE94 = RegE94;\r\nRegE9C = result[final_candidate][1];\r\npdmpriv->RegE9C = RegE9C;\r\nRegEA4 = result[final_candidate][2];\r\nRegEAC = result[final_candidate][3];\r\nRegEB4 = result[final_candidate][4];\r\npdmpriv->RegEB4 = RegEB4;\r\nRegEBC = result[final_candidate][5];\r\npdmpriv->RegEBC = RegEBC;\r\nRegEC4 = result[final_candidate][6];\r\nRegECC = result[final_candidate][7];\r\nDBG_8723A("IQK: final_candidate is %x\n", final_candidate);\r\nDBG_8723A("IQK: RegE94 =%x RegE9C =%x RegEA4 =%x RegEAC =%x RegEB4 =%x RegEBC =%x RegEC4 =%x RegECC =%x\n ",\r\nRegE94, RegE9C, RegEA4, RegEAC, RegEB4, RegEBC, RegEC4, RegECC);\r\nbPathAOK = bPathBOK = true;\r\n} else {\r\nRegE94 = RegEB4 = pdmpriv->RegE94 = pdmpriv->RegEB4 = 0x100;\r\nRegE9C = RegEBC = pdmpriv->RegE9C = pdmpriv->RegEBC = 0x0;\r\n}\r\nif ((RegE94 != 0))\r\n_PHY_PathAFillIQKMatrix(pAdapter, bPathAOK, result, final_candidate, (RegEA4 == 0));\r\nif (IS_92C_SERIAL(pHalData->VersionID)) {\r\nif ((RegEB4 != 0))\r\n_PHY_PathBFillIQKMatrix(pAdapter, bPathBOK, result, final_candidate, (RegEC4 == 0));\r\n}\r\n_PHY_SaveADDARegisters(pAdapter, IQK_BB_REG_92C, pdmpriv->IQK_BB_backup_recover, 9);\r\n}\r\nvoid rtl8723a_phy_lc_calibrate(struct rtw_adapter *pAdapter)\r\n{\r\nstruct hal_data_8723a *pHalData = GET_HAL_DATA(pAdapter);\r\nstruct mlme_ext_priv *pmlmeext = &pAdapter->mlmeextpriv;\r\nbool bStartContTx = false, bSingleTone = false, bCarrierSuppression = false;\r\nif (bStartContTx || bSingleTone || bCarrierSuppression)\r\nreturn;\r\nif (pmlmeext->sitesurvey_res.state == SCAN_PROCESS)\r\nreturn;\r\nif (IS_92C_SERIAL(pHalData->VersionID)) {\r\n_PHY_LCCalibrate(pAdapter, true);\r\n} else {\r\n_PHY_LCCalibrate(pAdapter, false);\r\n}\r\n}\r\nvoid\r\nrtl8723a_phy_ap_calibrate(struct rtw_adapter *pAdapter, char delta)\r\n{\r\n}
