static void *get_mq(struct ctl_table *table)\r\n{\r\nchar *which = table->data;\r\nstruct ipc_namespace *ipc_ns = current->nsproxy->ipc_ns;\r\nwhich = (which - (char *)&init_ipc_ns) + (char *)ipc_ns;\r\nreturn which;\r\n}\r\nstatic int proc_mq_dointvec(struct ctl_table *table, int write,\r\nvoid __user *buffer, size_t *lenp, loff_t *ppos)\r\n{\r\nstruct ctl_table mq_table;\r\nmemcpy(&mq_table, table, sizeof(mq_table));\r\nmq_table.data = get_mq(table);\r\nreturn proc_dointvec(&mq_table, write, buffer, lenp, ppos);\r\n}\r\nstatic int proc_mq_dointvec_minmax(struct ctl_table *table, int write,\r\nvoid __user *buffer, size_t *lenp, loff_t *ppos)\r\n{\r\nstruct ctl_table mq_table;\r\nmemcpy(&mq_table, table, sizeof(mq_table));\r\nmq_table.data = get_mq(table);\r\nreturn proc_dointvec_minmax(&mq_table, write, buffer,\r\nlenp, ppos);\r\n}\r\nstruct ctl_table_header *mq_register_sysctl_table(void)\r\n{\r\nreturn register_sysctl_table(mq_sysctl_root);\r\n}
