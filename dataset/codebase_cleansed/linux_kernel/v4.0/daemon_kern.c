static void daemon_init(struct net_device *dev, void *data)\r\n{\r\nstruct uml_net_private *pri;\r\nstruct daemon_data *dpri;\r\nstruct daemon_init *init = data;\r\npri = netdev_priv(dev);\r\ndpri = (struct daemon_data *) pri->user;\r\ndpri->sock_type = init->sock_type;\r\ndpri->ctl_sock = init->ctl_sock;\r\ndpri->fd = -1;\r\ndpri->control = -1;\r\ndpri->dev = dev;\r\ndpri->ctl_addr = NULL;\r\ndpri->data_addr = NULL;\r\ndpri->local_addr = NULL;\r\nprintk("daemon backend (uml_switch version %d) - %s:%s",\r\nSWITCH_VERSION, dpri->sock_type, dpri->ctl_sock);\r\nprintk("\n");\r\n}\r\nstatic int daemon_read(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn net_recvfrom(fd, skb_mac_header(skb),\r\nskb->dev->mtu + ETH_HEADER_OTHER);\r\n}\r\nstatic int daemon_write(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn daemon_user_write(fd, skb->data, skb->len,\r\n(struct daemon_data *) &lp->user);\r\n}\r\nstatic int daemon_setup(char *str, char **mac_out, void *data)\r\n{\r\nstruct daemon_init *init = data;\r\nchar *remain;\r\n*init = ((struct daemon_init)\r\n{ .sock_type = "unix",\r\n.ctl_sock = "/tmp/uml.ctl" });\r\nremain = split_if_spec(str, mac_out, &init->sock_type, &init->ctl_sock,\r\nNULL);\r\nif (remain != NULL)\r\nprintk(KERN_WARNING "daemon_setup : Ignoring data socket "\r\n"specification\n");\r\nreturn 1;\r\n}\r\nstatic int register_daemon(void)\r\n{\r\nregister_transport(&daemon_transport);\r\nreturn 0;\r\n}
