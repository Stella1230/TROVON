static unsigned int\r\nmark_tg(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nconst struct xt_mark_tginfo2 *info = par->targinfo;\r\nskb->mark = (skb->mark & ~info->mask) ^ info->mark;\r\nreturn XT_CONTINUE;\r\n}\r\nstatic bool\r\nmark_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nconst struct xt_mark_mtinfo1 *info = par->matchinfo;\r\nreturn ((skb->mark & info->mask) == info->mark) ^ info->invert;\r\n}\r\nstatic int __init mark_mt_init(void)\r\n{\r\nint ret;\r\nret = xt_register_target(&mark_tg_reg);\r\nif (ret < 0)\r\nreturn ret;\r\nret = xt_register_match(&mark_mt_reg);\r\nif (ret < 0) {\r\nxt_unregister_target(&mark_tg_reg);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic void __exit mark_mt_exit(void)\r\n{\r\nxt_unregister_match(&mark_mt_reg);\r\nxt_unregister_target(&mark_tg_reg);\r\n}
