static void encode_fallocate(struct xdr_stream *xdr,\r\nstruct nfs42_falloc_args *args)\r\n{\r\nencode_nfs4_stateid(xdr, &args->falloc_stateid);\r\nencode_uint64(xdr, args->falloc_offset);\r\nencode_uint64(xdr, args->falloc_length);\r\n}\r\nstatic void encode_allocate(struct xdr_stream *xdr,\r\nstruct nfs42_falloc_args *args,\r\nstruct compound_hdr *hdr)\r\n{\r\nencode_op_hdr(xdr, OP_ALLOCATE, decode_allocate_maxsz, hdr);\r\nencode_fallocate(xdr, args);\r\n}\r\nstatic void encode_deallocate(struct xdr_stream *xdr,\r\nstruct nfs42_falloc_args *args,\r\nstruct compound_hdr *hdr)\r\n{\r\nencode_op_hdr(xdr, OP_DEALLOCATE, decode_deallocate_maxsz, hdr);\r\nencode_fallocate(xdr, args);\r\n}\r\nstatic void encode_seek(struct xdr_stream *xdr,\r\nstruct nfs42_seek_args *args,\r\nstruct compound_hdr *hdr)\r\n{\r\nencode_op_hdr(xdr, OP_SEEK, decode_seek_maxsz, hdr);\r\nencode_nfs4_stateid(xdr, &args->sa_stateid);\r\nencode_uint64(xdr, args->sa_offset);\r\nencode_uint32(xdr, args->sa_what);\r\n}\r\nstatic void nfs4_xdr_enc_allocate(struct rpc_rqst *req,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_falloc_args *args)\r\n{\r\nstruct compound_hdr hdr = {\r\n.minorversion = nfs4_xdr_minorversion(&args->seq_args),\r\n};\r\nencode_compound_hdr(xdr, req, &hdr);\r\nencode_sequence(xdr, &args->seq_args, &hdr);\r\nencode_putfh(xdr, args->falloc_fh, &hdr);\r\nencode_allocate(xdr, args, &hdr);\r\nencode_nops(&hdr);\r\n}\r\nstatic void nfs4_xdr_enc_deallocate(struct rpc_rqst *req,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_falloc_args *args)\r\n{\r\nstruct compound_hdr hdr = {\r\n.minorversion = nfs4_xdr_minorversion(&args->seq_args),\r\n};\r\nencode_compound_hdr(xdr, req, &hdr);\r\nencode_sequence(xdr, &args->seq_args, &hdr);\r\nencode_putfh(xdr, args->falloc_fh, &hdr);\r\nencode_deallocate(xdr, args, &hdr);\r\nencode_nops(&hdr);\r\n}\r\nstatic void nfs4_xdr_enc_seek(struct rpc_rqst *req,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_seek_args *args)\r\n{\r\nstruct compound_hdr hdr = {\r\n.minorversion = nfs4_xdr_minorversion(&args->seq_args),\r\n};\r\nencode_compound_hdr(xdr, req, &hdr);\r\nencode_sequence(xdr, &args->seq_args, &hdr);\r\nencode_putfh(xdr, args->sa_fh, &hdr);\r\nencode_seek(xdr, args, &hdr);\r\nencode_nops(&hdr);\r\n}\r\nstatic int decode_allocate(struct xdr_stream *xdr, struct nfs42_falloc_res *res)\r\n{\r\nreturn decode_op_hdr(xdr, OP_ALLOCATE);\r\n}\r\nstatic int decode_deallocate(struct xdr_stream *xdr, struct nfs42_falloc_res *res)\r\n{\r\nreturn decode_op_hdr(xdr, OP_DEALLOCATE);\r\n}\r\nstatic int decode_seek(struct xdr_stream *xdr, struct nfs42_seek_res *res)\r\n{\r\nint status;\r\n__be32 *p;\r\nstatus = decode_op_hdr(xdr, OP_SEEK);\r\nif (status)\r\nreturn status;\r\np = xdr_inline_decode(xdr, 4 + 8);\r\nif (unlikely(!p))\r\ngoto out_overflow;\r\nres->sr_eof = be32_to_cpup(p++);\r\np = xdr_decode_hyper(p, &res->sr_offset);\r\nreturn 0;\r\nout_overflow:\r\nprint_overflow_msg(__func__, xdr);\r\nreturn -EIO;\r\n}\r\nstatic int nfs4_xdr_dec_allocate(struct rpc_rqst *rqstp,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_falloc_res *res)\r\n{\r\nstruct compound_hdr hdr;\r\nint status;\r\nstatus = decode_compound_hdr(xdr, &hdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_sequence(xdr, &res->seq_res, rqstp);\r\nif (status)\r\ngoto out;\r\nstatus = decode_putfh(xdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_allocate(xdr, res);\r\nout:\r\nreturn status;\r\n}\r\nstatic int nfs4_xdr_dec_deallocate(struct rpc_rqst *rqstp,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_falloc_res *res)\r\n{\r\nstruct compound_hdr hdr;\r\nint status;\r\nstatus = decode_compound_hdr(xdr, &hdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_sequence(xdr, &res->seq_res, rqstp);\r\nif (status)\r\ngoto out;\r\nstatus = decode_putfh(xdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_deallocate(xdr, res);\r\nout:\r\nreturn status;\r\n}\r\nstatic int nfs4_xdr_dec_seek(struct rpc_rqst *rqstp,\r\nstruct xdr_stream *xdr,\r\nstruct nfs42_seek_res *res)\r\n{\r\nstruct compound_hdr hdr;\r\nint status;\r\nstatus = decode_compound_hdr(xdr, &hdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_sequence(xdr, &res->seq_res, rqstp);\r\nif (status)\r\ngoto out;\r\nstatus = decode_putfh(xdr);\r\nif (status)\r\ngoto out;\r\nstatus = decode_seek(xdr, res);\r\nout:\r\nreturn status;\r\n}
