void g2d_reset(struct g2d_dev *d)\r\n{\r\nw(1, SOFT_RESET_REG);\r\n}\r\nvoid g2d_set_src_size(struct g2d_dev *d, struct g2d_frame *f)\r\n{\r\nu32 n;\r\nw(0, SRC_SELECT_REG);\r\nw(f->stride & 0xFFFF, SRC_STRIDE_REG);\r\nn = f->o_height & 0xFFF;\r\nn <<= 16;\r\nn |= f->o_width & 0xFFF;\r\nw(n, SRC_LEFT_TOP_REG);\r\nn = f->bottom & 0xFFF;\r\nn <<= 16;\r\nn |= f->right & 0xFFF;\r\nw(n, SRC_RIGHT_BOTTOM_REG);\r\nw(f->fmt->hw, SRC_COLOR_MODE_REG);\r\n}\r\nvoid g2d_set_src_addr(struct g2d_dev *d, dma_addr_t a)\r\n{\r\nw(a, SRC_BASE_ADDR_REG);\r\n}\r\nvoid g2d_set_dst_size(struct g2d_dev *d, struct g2d_frame *f)\r\n{\r\nu32 n;\r\nw(0, DST_SELECT_REG);\r\nw(f->stride & 0xFFFF, DST_STRIDE_REG);\r\nn = f->o_height & 0xFFF;\r\nn <<= 16;\r\nn |= f->o_width & 0xFFF;\r\nw(n, DST_LEFT_TOP_REG);\r\nn = f->bottom & 0xFFF;\r\nn <<= 16;\r\nn |= f->right & 0xFFF;\r\nw(n, DST_RIGHT_BOTTOM_REG);\r\nw(f->fmt->hw, DST_COLOR_MODE_REG);\r\n}\r\nvoid g2d_set_dst_addr(struct g2d_dev *d, dma_addr_t a)\r\n{\r\nw(a, DST_BASE_ADDR_REG);\r\n}\r\nvoid g2d_set_rop4(struct g2d_dev *d, u32 r)\r\n{\r\nw(r, ROP4_REG);\r\n}\r\nvoid g2d_set_flip(struct g2d_dev *d, u32 r)\r\n{\r\nw(r, SRC_MSK_DIRECT_REG);\r\n}\r\nvoid g2d_set_v41_stretch(struct g2d_dev *d, struct g2d_frame *src,\r\nstruct g2d_frame *dst)\r\n{\r\nw(DEFAULT_SCALE_MODE, SRC_SCALE_CTRL_REG);\r\nw((src->c_width << 16) / dst->c_width, SRC_XSCALE_REG);\r\nw((src->c_height << 16) / dst->c_height, SRC_YSCALE_REG);\r\n}\r\nvoid g2d_set_cmd(struct g2d_dev *d, u32 c)\r\n{\r\nw(c, BITBLT_COMMAND_REG);\r\n}\r\nvoid g2d_start(struct g2d_dev *d)\r\n{\r\nif (d->variant->hw_rev == TYPE_G2D_3X)\r\nw(0x7, CACHECTL_REG);\r\nw(1, INTEN_REG);\r\nw(1, BITBLT_START_REG);\r\n}\r\nvoid g2d_clear_int(struct g2d_dev *d)\r\n{\r\nw(1, INTC_PEND_REG);\r\n}
