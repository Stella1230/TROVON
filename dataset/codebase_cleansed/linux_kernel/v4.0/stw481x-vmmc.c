static int stw481x_vmmc_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct stw481x *stw481x = dev_get_platdata(&pdev->dev);\r\nstruct regulator_config config = { };\r\nint ret;\r\nret = regmap_update_bits(stw481x->map, STW_CONF2,\r\nSTW_CONF2_VMMC_EXT, 0);\r\nif (ret) {\r\ndev_err(&pdev->dev, "could not disable external VMMC\n");\r\nreturn ret;\r\n}\r\nconfig.dev = &pdev->dev;\r\nconfig.driver_data = stw481x;\r\nconfig.regmap = stw481x->map;\r\nconfig.of_node = pdev->dev.of_node;\r\nconfig.init_data = of_get_regulator_init_data(&pdev->dev,\r\npdev->dev.of_node,\r\n&vmmc_regulator);\r\nstw481x->vmmc_regulator = devm_regulator_register(&pdev->dev,\r\n&vmmc_regulator, &config);\r\nif (IS_ERR(stw481x->vmmc_regulator)) {\r\ndev_err(&pdev->dev,\r\n"error initializing STw481x VMMC regulator\n");\r\nreturn PTR_ERR(stw481x->vmmc_regulator);\r\n}\r\ndev_info(&pdev->dev, "initialized STw481x VMMC regulator\n");\r\nreturn 0;\r\n}
