static const struct icade_key *icade_find_translation(u16 from)\r\n{\r\nif (from > ICADE_MAX_USAGE)\r\nreturn NULL;\r\nreturn &icade_usage_table[from];\r\n}\r\nstatic int icade_event(struct hid_device *hdev, struct hid_field *field,\r\nstruct hid_usage *usage, __s32 value)\r\n{\r\nconst struct icade_key *trans;\r\nif (!(hdev->claimed & HID_CLAIMED_INPUT) || !field->hidinput ||\r\n!usage->type)\r\nreturn 0;\r\nif (!value)\r\nreturn 1;\r\ntrans = icade_find_translation(usage->hid & HID_USAGE);\r\nif (!trans)\r\nreturn 1;\r\ninput_event(field->hidinput->input, usage->type,\r\ntrans->to, trans->press);\r\nreturn 1;\r\n}\r\nstatic int icade_input_mapping(struct hid_device *hdev, struct hid_input *hi,\r\nstruct hid_field *field, struct hid_usage *usage,\r\nunsigned long **bit, int *max)\r\n{\r\nconst struct icade_key *trans;\r\nif ((usage->hid & HID_USAGE_PAGE) == HID_UP_KEYBOARD) {\r\ntrans = icade_find_translation(usage->hid & HID_USAGE);\r\nif (!trans)\r\nreturn -1;\r\nhid_map_usage(hi, usage, bit, max, EV_KEY, trans->to);\r\nset_bit(trans->to, hi->input->keybit);\r\nreturn 1;\r\n}\r\nreturn -1;\r\n}\r\nstatic int icade_input_mapped(struct hid_device *hdev, struct hid_input *hi,\r\nstruct hid_field *field, struct hid_usage *usage,\r\nunsigned long **bit, int *max)\r\n{\r\nif (usage->type == EV_KEY)\r\nset_bit(usage->type, hi->input->evbit);\r\nreturn -1;\r\n}
