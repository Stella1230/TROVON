static void ab8500_modify_reg_init(int id, u8 mask, u8 value)\r\n{\r\nint i;\r\nif (cpu_is_u8520()) {\r\nfor (i = ARRAY_SIZE(ab8505_reg_init) - 1; i >= 0; i--) {\r\nif (ab8505_reg_init[i].id == id) {\r\nu8 initval = ab8505_reg_init[i].value;\r\ninitval = (initval & ~mask) | (value & mask);\r\nab8505_reg_init[i].value = initval;\r\nBUG_ON(mask & ~ab8505_reg_init[i].mask);\r\nreturn;\r\n}\r\n}\r\n} else {\r\nfor (i = ARRAY_SIZE(ab8500_reg_init) - 1; i >= 0; i--) {\r\nif (ab8500_reg_init[i].id == id) {\r\nu8 initval = ab8500_reg_init[i].value;\r\ninitval = (initval & ~mask) | (value & mask);\r\nab8500_reg_init[i].value = initval;\r\nBUG_ON(mask & ~ab8500_reg_init[i].mask);\r\nreturn;\r\n}\r\n}\r\n}\r\nBUG_ON(1);\r\n}\r\nvoid mop500_regulator_init(void)\r\n{\r\nstruct regulator_init_data *regulator;\r\nif (cpu_is_u8520()) {\r\nab8500_modify_reg_init(AB8505_VAUX12REGU, 0x0f, 0x05);\r\n}\r\nif (cpu_is_u8500v20()) {\r\nab8500_modify_reg_init(AB8500_REGUREQUESTCTRL3, 0x01, 0x01);\r\nab8500_modify_reg_init(AB8500_REGUSYSCLKREQ1HPVALID2,\r\n0x20, 0x20);\r\nab8500_modify_reg_init(AB8500_EXTSUPPLYREGU, 0x0c, 0x04);\r\nregulator = &ab8500_ext_regulators[AB8500_EXT_SUPPLY2];\r\nregulator->constraints.always_on = 1;\r\nregulator = &ab8500_ext_regulators[AB8500_EXT_SUPPLY2];\r\nregulator->constraints.state_mem.disabled = 1;\r\nregulator->constraints.state_standby.disabled = 1;\r\nregulator->driver_data = (void *)&ab8500_ext_supply2;\r\n}\r\n}
