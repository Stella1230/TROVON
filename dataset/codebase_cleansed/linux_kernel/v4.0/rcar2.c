static int usbhs_rcar2_hardware_init(struct platform_device *pdev)\r\n{\r\nstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\r\nif (IS_ENABLED(CONFIG_GENERIC_PHY)) {\r\nstruct phy *phy = phy_get(&pdev->dev, "usb");\r\nif (IS_ERR(phy))\r\nreturn PTR_ERR(phy);\r\npriv->phy = phy;\r\nreturn 0;\r\n}\r\nif (IS_ENABLED(CONFIG_USB_PHY)) {\r\nstruct usb_phy *usb_phy = usb_get_phy_dev(&pdev->dev, 0);\r\nif (IS_ERR(usb_phy))\r\nreturn PTR_ERR(usb_phy);\r\npriv->usb_phy = usb_phy;\r\nreturn 0;\r\n}\r\nreturn -ENXIO;\r\n}\r\nstatic int usbhs_rcar2_hardware_exit(struct platform_device *pdev)\r\n{\r\nstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\r\nif (priv->phy) {\r\nphy_put(priv->phy);\r\npriv->phy = NULL;\r\n}\r\nif (priv->usb_phy) {\r\nusb_put_phy(priv->usb_phy);\r\npriv->usb_phy = NULL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int usbhs_rcar2_power_ctrl(struct platform_device *pdev,\r\nvoid __iomem *base, int enable)\r\n{\r\nstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\r\nint retval = -ENODEV;\r\nif (priv->phy) {\r\nif (enable) {\r\nretval = phy_init(priv->phy);\r\nif (!retval)\r\nretval = phy_power_on(priv->phy);\r\n} else {\r\nphy_power_off(priv->phy);\r\nphy_exit(priv->phy);\r\nretval = 0;\r\n}\r\n}\r\nif (priv->usb_phy) {\r\nif (enable) {\r\nretval = usb_phy_init(priv->usb_phy);\r\nif (!retval)\r\nretval = usb_phy_set_suspend(priv->usb_phy, 0);\r\n} else {\r\nusb_phy_set_suspend(priv->usb_phy, 1);\r\nusb_phy_shutdown(priv->usb_phy);\r\nretval = 0;\r\n}\r\n}\r\nreturn retval;\r\n}\r\nstatic int usbhs_rcar2_get_id(struct platform_device *pdev)\r\n{\r\nreturn USBHS_GADGET;\r\n}
