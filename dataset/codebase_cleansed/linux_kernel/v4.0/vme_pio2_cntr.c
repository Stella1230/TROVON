static int pio2_cntr_irq_set(struct pio2_card *card, int id)\r\n{\r\nint retval;\r\nu8 data;\r\ndata = PIO2_CNTR_SC_DEV[id] | PIO2_CNTR_RW_BOTH | card->cntr[id].mode;\r\nretval = vme_master_write(card->window, &data, 1, PIO2_CNTR_CTRL[id]);\r\nif (retval < 0)\r\nreturn retval;\r\ndata = card->cntr[id].count & 0xFF;\r\nretval = vme_master_write(card->window, &data, 1, PIO2_CNTR_DATA[id]);\r\nif (retval < 0)\r\nreturn retval;\r\ndata = (card->cntr[id].count >> 8) & 0xFF;\r\nretval = vme_master_write(card->window, &data, 1, PIO2_CNTR_DATA[id]);\r\nif (retval < 0)\r\nreturn retval;\r\nreturn 0;\r\n}\r\nint pio2_cntr_reset(struct pio2_card *card)\r\n{\r\nint i, retval = 0;\r\nu8 reg;\r\nfor (i = 0; i < 6; i++) {\r\ncard->cntr[i].mode = PIO2_CNTR_MODE5;\r\ncard->cntr[i].count = 0;\r\nretval = pio2_cntr_irq_set(card, i);\r\nif (retval < 0)\r\nreturn retval;\r\n}\r\ndo {\r\nretval = vme_master_read(card->window, &reg, 1,\r\nPIO2_REGS_INT_STAT_CNTR);\r\nif (retval < 0)\r\nreturn retval;\r\n} while (reg != 0);\r\nreturn retval;\r\n}
