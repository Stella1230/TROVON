static void __init m528x_qspi_init(void)\r\n{\r\n#if IS_ENABLED(CONFIG_SPI_COLDFIRE_QSPI)\r\n__raw_writeb(0x07, MCFGPIO_PQSPAR);\r\n#endif\r\n}\r\nstatic void __init m528x_uarts_init(void)\r\n{\r\nu8 port;\r\nport = readb(MCFGPIO_PUAPAR);\r\nport |= 0x03 | (0x03 << 2);\r\nwriteb(port, MCFGPIO_PUAPAR);\r\n}\r\nstatic void __init m528x_fec_init(void)\r\n{\r\nu16 v16;\r\nv16 = readw(MCFGPIO_PASPAR);\r\nwritew(v16 | 0xf00, MCFGPIO_PASPAR);\r\nwriteb(0xc0, MCFGPIO_PEHLPAR);\r\n}\r\nvoid wildfire_halt(void)\r\n{\r\nwriteb(0, 0x30000007);\r\nwriteb(0x2, 0x30000007);\r\n}\r\nvoid wildfiremod_halt(void)\r\n{\r\nprintk(KERN_INFO "WildFireMod hibernating...\n");\r\nMCF5282_GPIO_PEPAR &= ~(1 << (5 * 2));\r\nMCF5282_GPIO_DDRE |= (1 << 5);\r\nMCF5282_GPIO_PORTE &= ~(1 << 5);\r\nMCF5282_GPIO_PORTE |= (1 << 5);\r\nprintk(KERN_EMERG "Failed to hibernate. Halting!\n");\r\n}\r\nvoid __init config_BSP(char *commandp, int size)\r\n{\r\n#ifdef CONFIG_WILDFIRE\r\nmach_halt = wildfire_halt;\r\n#endif\r\n#ifdef CONFIG_WILDFIREMOD\r\nmach_halt = wildfiremod_halt;\r\n#endif\r\nmach_sched_init = hw_timer_init;\r\nm528x_uarts_init();\r\nm528x_fec_init();\r\nm528x_qspi_init();\r\n}
