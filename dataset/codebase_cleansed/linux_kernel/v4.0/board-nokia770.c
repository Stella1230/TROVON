static void mipid_shutdown(struct mipid_platform_data *pdata)\r\n{\r\nif (pdata->nreset_gpio != -1) {\r\nprintk(KERN_INFO "shutdown LCD\n");\r\ngpio_set_value(pdata->nreset_gpio, 0);\r\nmsleep(120);\r\n}\r\n}\r\nstatic void __init mipid_dev_init(void)\r\n{\r\nnokia770_mipid_platform_data.nreset_gpio = 13;\r\nnokia770_mipid_platform_data.data_lines = 16;\r\nomapfb_set_lcd_config(&nokia770_lcd_config);\r\n}\r\nstatic void __init hwa742_dev_init(void)\r\n{\r\nclk_add_alias("hwa_sys_ck", NULL, "bclk", NULL);\r\n}\r\nstatic int nokia770_mmc_set_power(struct device *dev, int slot, int power_on,\r\nint vdd)\r\n{\r\ngpio_set_value(NOKIA770_GPIO_MMC_POWER, power_on);\r\nreturn 0;\r\n}\r\nstatic int nokia770_mmc_get_cover_state(struct device *dev, int slot)\r\n{\r\nreturn gpio_get_value(NOKIA770_GPIO_MMC_SWITCH);\r\n}\r\nstatic void __init nokia770_mmc_init(void)\r\n{\r\nint ret;\r\nret = gpio_request(NOKIA770_GPIO_MMC_POWER, "MMC power");\r\nif (ret < 0)\r\nreturn;\r\ngpio_direction_output(NOKIA770_GPIO_MMC_POWER, 0);\r\nret = gpio_request(NOKIA770_GPIO_MMC_SWITCH, "MMC cover");\r\nif (ret < 0) {\r\ngpio_free(NOKIA770_GPIO_MMC_POWER);\r\nreturn;\r\n}\r\ngpio_direction_input(NOKIA770_GPIO_MMC_SWITCH);\r\nnokia770_mmc_data[1] = &nokia770_mmc2_data;\r\nomap1_init_mmc(nokia770_mmc_data, OMAP16XX_NR_MMC);\r\n}\r\nstatic inline void nokia770_mmc_init(void)\r\n{\r\n}\r\nstatic void __init nokia770_cbus_init(void)\r\n{\r\nconst int retu_irq_gpio = 62;\r\nconst int tahvo_irq_gpio = 40;\r\nif (gpio_request_one(retu_irq_gpio, GPIOF_IN, "Retu IRQ"))\r\nreturn;\r\nif (gpio_request_one(tahvo_irq_gpio, GPIOF_IN, "Tahvo IRQ")) {\r\ngpio_free(retu_irq_gpio);\r\nreturn;\r\n}\r\nirq_set_irq_type(gpio_to_irq(retu_irq_gpio), IRQ_TYPE_EDGE_RISING);\r\nirq_set_irq_type(gpio_to_irq(tahvo_irq_gpio), IRQ_TYPE_EDGE_RISING);\r\nnokia770_i2c_board_info_2[0].irq = gpio_to_irq(retu_irq_gpio);\r\nnokia770_i2c_board_info_2[1].irq = gpio_to_irq(tahvo_irq_gpio);\r\ni2c_register_board_info(2, nokia770_i2c_board_info_2,\r\nARRAY_SIZE(nokia770_i2c_board_info_2));\r\nplatform_device_register(&nokia770_cbus_device);\r\n}\r\nstatic void __init nokia770_cbus_init(void)\r\n{\r\n}\r\nstatic void __init omap_nokia770_init(void)\r\n{\r\nomap_writew((omap_readw(0xfffb5008) & ~2), 0xfffb5008);\r\nomap_writew((omap_readw(0xfffb5004) & ~2), 0xfffb5004);\r\nplatform_add_devices(nokia770_devices, ARRAY_SIZE(nokia770_devices));\r\nnokia770_spi_board_info[1].irq = gpio_to_irq(15);\r\nspi_register_board_info(nokia770_spi_board_info,\r\nARRAY_SIZE(nokia770_spi_board_info));\r\nomap_serial_init();\r\nomap_register_i2c_bus(1, 100, NULL, 0);\r\nhwa742_dev_init();\r\nmipid_dev_init();\r\nomap1_usb_init(&nokia770_usb_config);\r\nnokia770_mmc_init();\r\nnokia770_cbus_init();\r\n}
