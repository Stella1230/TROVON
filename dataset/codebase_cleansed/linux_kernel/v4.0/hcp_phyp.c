u64 hcall_map_page(u64 physaddr)\r\n{\r\nreturn (u64)ioremap(physaddr, EHCA_PAGESIZE);\r\n}\r\nint hcall_unmap_page(u64 mapaddr)\r\n{\r\niounmap((volatile void __iomem *) mapaddr);\r\nreturn 0;\r\n}\r\nint hcp_galpas_ctor(struct h_galpas *galpas, int is_user,\r\nu64 paddr_kernel, u64 paddr_user)\r\n{\r\nif (!is_user) {\r\ngalpas->kernel.fw_handle = hcall_map_page(paddr_kernel);\r\nif (!galpas->kernel.fw_handle)\r\nreturn -ENOMEM;\r\n} else\r\ngalpas->kernel.fw_handle = 0;\r\ngalpas->user.fw_handle = paddr_user;\r\nreturn 0;\r\n}\r\nint hcp_galpas_dtor(struct h_galpas *galpas)\r\n{\r\nif (galpas->kernel.fw_handle) {\r\nint ret = hcall_unmap_page(galpas->kernel.fw_handle);\r\nif (ret)\r\nreturn ret;\r\n}\r\ngalpas->user.fw_handle = galpas->kernel.fw_handle = 0;\r\nreturn 0;\r\n}
