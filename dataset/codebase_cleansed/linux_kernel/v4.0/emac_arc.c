static int emac_arc_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct net_device *ndev;\r\nstruct arc_emac_priv *priv;\r\nint interface, err;\r\nif (!dev->of_node)\r\nreturn -ENODEV;\r\nndev = alloc_etherdev(sizeof(struct arc_emac_priv));\r\nif (!ndev)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(pdev, ndev);\r\nSET_NETDEV_DEV(ndev, dev);\r\npriv = netdev_priv(ndev);\r\npriv->drv_name = DRV_NAME;\r\npriv->drv_version = DRV_VERSION;\r\ninterface = of_get_phy_mode(dev->of_node);\r\nif (interface < 0)\r\ninterface = PHY_INTERFACE_MODE_MII;\r\npriv->clk = devm_clk_get(dev, "hclk");\r\nif (IS_ERR(priv->clk)) {\r\ndev_err(dev, "failed to retrieve host clock from device tree\n");\r\nerr = -EINVAL;\r\ngoto out_netdev;\r\n}\r\nerr = arc_emac_probe(ndev, interface);\r\nout_netdev:\r\nif (err)\r\nfree_netdev(ndev);\r\nreturn err;\r\n}\r\nstatic int emac_arc_remove(struct platform_device *pdev)\r\n{\r\nstruct net_device *ndev = platform_get_drvdata(pdev);\r\nint err;\r\nerr = arc_emac_remove(ndev);\r\nfree_netdev(ndev);\r\nreturn err;\r\n}
