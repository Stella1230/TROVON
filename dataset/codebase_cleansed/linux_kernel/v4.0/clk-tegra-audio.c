void __init tegra_audio_clk_init(void __iomem *clk_base,\r\nvoid __iomem *pmc_base, struct tegra_clk *tegra_clks,\r\nstruct tegra_clk_pll_params *pll_a_params)\r\n{\r\nstruct clk *clk;\r\nstruct clk **dt_clk;\r\nint i;\r\ndt_clk = tegra_lookup_dt_id(tegra_clk_pll_a, tegra_clks);\r\nif (dt_clk) {\r\nclk = tegra_clk_register_pll("pll_a", "pll_p_out1", clk_base,\r\npmc_base, 0, pll_a_params, NULL);\r\n*dt_clk = clk;\r\n}\r\ndt_clk = tegra_lookup_dt_id(tegra_clk_pll_a_out0, tegra_clks);\r\nif (dt_clk) {\r\nclk = tegra_clk_register_divider("pll_a_out0_div", "pll_a",\r\nclk_base + PLLA_OUT, 0, TEGRA_DIVIDER_ROUND_UP,\r\n8, 8, 1, NULL);\r\nclk = tegra_clk_register_pll_out("pll_a_out0", "pll_a_out0_div",\r\nclk_base + PLLA_OUT, 1, 0, CLK_IGNORE_UNUSED |\r\nCLK_SET_RATE_PARENT, 0, NULL);\r\n*dt_clk = clk;\r\n}\r\nfor (i = 0; i < ARRAY_SIZE(sync_source_clks); i++) {\r\nstruct tegra_sync_source_initdata *data;\r\ndata = &sync_source_clks[i];\r\ndt_clk = tegra_lookup_dt_id(data->clk_id, tegra_clks);\r\nif (!dt_clk)\r\ncontinue;\r\nclk = tegra_clk_register_sync_source(data->name,\r\ndata->rate, data->max_rate);\r\n*dt_clk = clk;\r\n}\r\nfor (i = 0; i < ARRAY_SIZE(audio_clks); i++) {\r\nstruct tegra_audio_clk_initdata *data;\r\ndata = &audio_clks[i];\r\ndt_clk = tegra_lookup_dt_id(data->mux_clk_id, tegra_clks);\r\nif (!dt_clk)\r\ncontinue;\r\nclk = clk_register_mux(NULL, data->mux_name, mux_audio_sync_clk,\r\nARRAY_SIZE(mux_audio_sync_clk),\r\nCLK_SET_RATE_NO_REPARENT,\r\nclk_base + data->offset, 0, 3, 0,\r\nNULL);\r\n*dt_clk = clk;\r\ndt_clk = tegra_lookup_dt_id(data->gate_clk_id, tegra_clks);\r\nif (!dt_clk)\r\ncontinue;\r\nclk = clk_register_gate(NULL, data->gate_name, data->mux_name,\r\n0, clk_base + data->offset, 4,\r\nCLK_GATE_SET_TO_DISABLE, NULL);\r\n*dt_clk = clk;\r\n}\r\nfor (i = 0; i < ARRAY_SIZE(audio2x_clks); i++) {\r\nstruct tegra_audio2x_clk_initdata *data;\r\ndata = &audio2x_clks[i];\r\ndt_clk = tegra_lookup_dt_id(data->clk_id, tegra_clks);\r\nif (!dt_clk)\r\ncontinue;\r\nclk = clk_register_fixed_factor(NULL, data->name_2x,\r\ndata->parent, CLK_SET_RATE_PARENT, 2, 1);\r\nclk = tegra_clk_register_divider(data->div_name,\r\ndata->name_2x, clk_base + AUDIO_SYNC_DOUBLER,\r\n0, 0, data->div_offset, 1, 0,\r\n&clk_doubler_lock);\r\nclk = tegra_clk_register_periph_gate(data->gate_name,\r\ndata->div_name, TEGRA_PERIPH_NO_RESET,\r\nclk_base, CLK_SET_RATE_PARENT, data->clk_num,\r\nperiph_clk_enb_refcnt);\r\n*dt_clk = clk;\r\n}\r\n}
