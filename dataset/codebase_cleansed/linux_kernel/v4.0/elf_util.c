int parse_elf64(void *hdr, struct elf_info *info)\r\n{\r\nElf64_Ehdr *elf64 = hdr;\r\nElf64_Phdr *elf64ph;\r\nunsigned int i;\r\nif (!(elf64->e_ident[EI_MAG0] == ELFMAG0 &&\r\nelf64->e_ident[EI_MAG1] == ELFMAG1 &&\r\nelf64->e_ident[EI_MAG2] == ELFMAG2 &&\r\nelf64->e_ident[EI_MAG3] == ELFMAG3 &&\r\nelf64->e_ident[EI_CLASS] == ELFCLASS64 &&\r\n#ifdef __LITTLE_ENDIAN__\r\nelf64->e_ident[EI_DATA] == ELFDATA2LSB &&\r\n#else\r\nelf64->e_ident[EI_DATA] == ELFDATA2MSB &&\r\n#endif\r\n(elf64->e_type == ET_EXEC ||\r\nelf64->e_type == ET_DYN) &&\r\nelf64->e_machine == EM_PPC64))\r\nreturn 0;\r\nelf64ph = (Elf64_Phdr *)((unsigned long)elf64 +\r\n(unsigned long)elf64->e_phoff);\r\nfor (i = 0; i < (unsigned int)elf64->e_phnum; i++, elf64ph++)\r\nif (elf64ph->p_type == PT_LOAD)\r\nbreak;\r\nif (i >= (unsigned int)elf64->e_phnum)\r\nreturn 0;\r\ninfo->loadsize = (unsigned long)elf64ph->p_filesz;\r\ninfo->memsize = (unsigned long)elf64ph->p_memsz;\r\ninfo->elfoffset = (unsigned long)elf64ph->p_offset;\r\nreturn 1;\r\n}\r\nint parse_elf32(void *hdr, struct elf_info *info)\r\n{\r\nElf32_Ehdr *elf32 = hdr;\r\nElf32_Phdr *elf32ph;\r\nunsigned int i;\r\nif (!(elf32->e_ident[EI_MAG0] == ELFMAG0 &&\r\nelf32->e_ident[EI_MAG1] == ELFMAG1 &&\r\nelf32->e_ident[EI_MAG2] == ELFMAG2 &&\r\nelf32->e_ident[EI_MAG3] == ELFMAG3 &&\r\nelf32->e_ident[EI_CLASS] == ELFCLASS32 &&\r\nelf32->e_ident[EI_DATA] == ELFDATA2MSB &&\r\n(elf32->e_type == ET_EXEC ||\r\nelf32->e_type == ET_DYN) &&\r\nelf32->e_machine == EM_PPC))\r\nreturn 0;\r\nelf32ph = (Elf32_Phdr *) ((unsigned long)elf32 + elf32->e_phoff);\r\nfor (i = 0; i < elf32->e_phnum; i++, elf32ph++)\r\nif (elf32ph->p_type == PT_LOAD)\r\nbreak;\r\nif (i >= elf32->e_phnum)\r\nreturn 0;\r\ninfo->loadsize = elf32ph->p_filesz;\r\ninfo->memsize = elf32ph->p_memsz;\r\ninfo->elfoffset = elf32ph->p_offset;\r\nreturn 1;\r\n}
