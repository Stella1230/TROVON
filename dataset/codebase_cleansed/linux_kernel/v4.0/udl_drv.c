static int udl_driver_set_busid(struct drm_device *d, struct drm_master *m)\r\n{\r\nreturn 0;\r\n}\r\nstatic int udl_usb_probe(struct usb_interface *interface,\r\nconst struct usb_device_id *id)\r\n{\r\nstruct usb_device *udev = interface_to_usbdev(interface);\r\nstruct drm_device *dev;\r\nint r;\r\ndev = drm_dev_alloc(&driver, &interface->dev);\r\nif (!dev)\r\nreturn -ENOMEM;\r\nr = drm_dev_register(dev, (unsigned long)udev);\r\nif (r)\r\ngoto err_free;\r\nusb_set_intfdata(interface, dev);\r\nDRM_INFO("Initialized udl on minor %d\n", dev->primary->index);\r\nreturn 0;\r\nerr_free:\r\ndrm_dev_unref(dev);\r\nreturn r;\r\n}\r\nstatic void udl_usb_disconnect(struct usb_interface *interface)\r\n{\r\nstruct drm_device *dev = usb_get_intfdata(interface);\r\ndrm_kms_helper_poll_disable(dev);\r\ndrm_connector_unplug_all(dev);\r\nudl_fbdev_unplug(dev);\r\nudl_drop_usb(dev);\r\ndrm_unplug_dev(dev);\r\n}\r\nstatic int __init udl_init(void)\r\n{\r\nreturn usb_register(&udl_driver);\r\n}\r\nstatic void __exit udl_exit(void)\r\n{\r\nusb_deregister(&udl_driver);\r\n}
