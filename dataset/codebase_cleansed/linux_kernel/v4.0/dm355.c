void __init dm355_init_spi0(unsigned chipselect_mask,\r\nconst struct spi_board_info *info, unsigned len)\r\n{\r\ndavinci_cfg_reg(DM355_SPI0_SDI);\r\nif (chipselect_mask & BIT(0))\r\ndavinci_cfg_reg(DM355_SPI0_SDENA0);\r\nif (chipselect_mask & BIT(1))\r\ndavinci_cfg_reg(DM355_SPI0_SDENA1);\r\nspi_register_board_info(info, len);\r\nplatform_device_register(&dm355_spi0_device);\r\n}\r\nstatic void dm355_ccdc_setup_pinmux(void)\r\n{\r\ndavinci_cfg_reg(DM355_VIN_PCLK);\r\ndavinci_cfg_reg(DM355_VIN_CAM_WEN);\r\ndavinci_cfg_reg(DM355_VIN_CAM_VD);\r\ndavinci_cfg_reg(DM355_VIN_CAM_HD);\r\ndavinci_cfg_reg(DM355_VIN_YIN_EN);\r\ndavinci_cfg_reg(DM355_VIN_CINL_EN);\r\ndavinci_cfg_reg(DM355_VIN_CINH_EN);\r\n}\r\nstatic int dm355_vpbe_setup_pinmux(u32 if_type, int field)\r\n{\r\nswitch (if_type) {\r\ncase MEDIA_BUS_FMT_SGRBG8_1X8:\r\ndavinci_cfg_reg(DM355_VOUT_FIELD_G70);\r\nbreak;\r\ncase MEDIA_BUS_FMT_YUYV10_1X20:\r\nif (field)\r\ndavinci_cfg_reg(DM355_VOUT_FIELD);\r\nelse\r\ndavinci_cfg_reg(DM355_VOUT_FIELD_G70);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\ndavinci_cfg_reg(DM355_VOUT_COUTL_EN);\r\ndavinci_cfg_reg(DM355_VOUT_COUTH_EN);\r\nreturn 0;\r\n}\r\nstatic int dm355_venc_setup_clock(enum vpbe_enc_timings_type type,\r\nunsigned int pclock)\r\n{\r\nvoid __iomem *vpss_clk_ctrl_reg;\r\nvpss_clk_ctrl_reg = DAVINCI_SYSMOD_VIRT(SYSMOD_VPSS_CLKCTL);\r\nswitch (type) {\r\ncase VPBE_ENC_STD:\r\nwritel(VPSS_DACCLKEN_ENABLE | VPSS_VENCCLKEN_ENABLE,\r\nvpss_clk_ctrl_reg);\r\nbreak;\r\ncase VPBE_ENC_DV_TIMINGS:\r\nif (pclock > 27000000)\r\nwritel(VPSS_MUXSEL_EXTCLK_ENABLE, vpss_clk_ctrl_reg);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nint __init dm355_gpio_register(void)\r\n{\r\nreturn davinci_gpio_register(dm355_gpio_resources,\r\nARRAY_SIZE(dm355_gpio_resources),\r\n&dm355_gpio_platform_data);\r\n}\r\nvoid __init dm355_init_asp1(u32 evt_enable, struct snd_platform_data *pdata)\r\n{\r\nif (evt_enable & ASP1_TX_EVT_EN)\r\ndavinci_cfg_reg(DM355_EVT8_ASP1_TX);\r\nif (evt_enable & ASP1_RX_EVT_EN)\r\ndavinci_cfg_reg(DM355_EVT9_ASP1_RX);\r\ndm355_asp1_device.dev.platform_data = pdata;\r\nplatform_device_register(&dm355_asp1_device);\r\n}\r\nvoid __init dm355_init(void)\r\n{\r\ndavinci_common_init(&davinci_soc_info_dm355);\r\ndavinci_map_sysmod();\r\n}\r\nint __init dm355_init_video(struct vpfe_config *vpfe_cfg,\r\nstruct vpbe_config *vpbe_cfg)\r\n{\r\nif (vpfe_cfg || vpbe_cfg)\r\nplatform_device_register(&dm355_vpss_device);\r\nif (vpfe_cfg) {\r\nvpfe_capture_dev.dev.platform_data = vpfe_cfg;\r\nplatform_device_register(&dm355_ccdc_dev);\r\nplatform_device_register(&vpfe_capture_dev);\r\n}\r\nif (vpbe_cfg) {\r\ndm355_vpbe_dev.dev.platform_data = vpbe_cfg;\r\nplatform_device_register(&dm355_osd_dev);\r\nplatform_device_register(&dm355_venc_dev);\r\nplatform_device_register(&dm355_vpbe_dev);\r\nplatform_device_register(&dm355_vpbe_display);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init dm355_init_devices(void)\r\n{\r\nint ret = 0;\r\nif (!cpu_is_davinci_dm355())\r\nreturn 0;\r\ndavinci_cfg_reg(DM355_INT_EDMA_CC);\r\nplatform_device_register(&dm355_edma_device);\r\nret = davinci_init_wdt();\r\nif (ret)\r\npr_warn("%s: watchdog init failed: %d\n", __func__, ret);\r\nreturn ret;\r\n}
