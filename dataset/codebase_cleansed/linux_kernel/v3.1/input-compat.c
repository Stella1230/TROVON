int input_event_from_user(const char __user *buffer,\r\nstruct input_event *event)\r\n{\r\nif (INPUT_COMPAT_TEST) {\r\nstruct input_event_compat compat_event;\r\nif (copy_from_user(&compat_event, buffer,\r\nsizeof(struct input_event_compat)))\r\nreturn -EFAULT;\r\nevent->time.tv_sec = compat_event.time.tv_sec;\r\nevent->time.tv_usec = compat_event.time.tv_usec;\r\nevent->type = compat_event.type;\r\nevent->code = compat_event.code;\r\nevent->value = compat_event.value;\r\n} else {\r\nif (copy_from_user(event, buffer, sizeof(struct input_event)))\r\nreturn -EFAULT;\r\n}\r\nreturn 0;\r\n}\r\nint input_event_to_user(char __user *buffer,\r\nconst struct input_event *event)\r\n{\r\nif (INPUT_COMPAT_TEST) {\r\nstruct input_event_compat compat_event;\r\ncompat_event.time.tv_sec = event->time.tv_sec;\r\ncompat_event.time.tv_usec = event->time.tv_usec;\r\ncompat_event.type = event->type;\r\ncompat_event.code = event->code;\r\ncompat_event.value = event->value;\r\nif (copy_to_user(buffer, &compat_event,\r\nsizeof(struct input_event_compat)))\r\nreturn -EFAULT;\r\n} else {\r\nif (copy_to_user(buffer, event, sizeof(struct input_event)))\r\nreturn -EFAULT;\r\n}\r\nreturn 0;\r\n}\r\nint input_ff_effect_from_user(const char __user *buffer, size_t size,\r\nstruct ff_effect *effect)\r\n{\r\nif (INPUT_COMPAT_TEST) {\r\nstruct ff_effect_compat *compat_effect;\r\nif (size != sizeof(struct ff_effect_compat))\r\nreturn -EINVAL;\r\ncompat_effect = (struct ff_effect_compat *)effect;\r\nif (copy_from_user(compat_effect, buffer,\r\nsizeof(struct ff_effect_compat)))\r\nreturn -EFAULT;\r\nif (compat_effect->type == FF_PERIODIC &&\r\ncompat_effect->u.periodic.waveform == FF_CUSTOM)\r\neffect->u.periodic.custom_data =\r\ncompat_ptr(compat_effect->u.periodic.custom_data);\r\n} else {\r\nif (size != sizeof(struct ff_effect))\r\nreturn -EINVAL;\r\nif (copy_from_user(effect, buffer, sizeof(struct ff_effect)))\r\nreturn -EFAULT;\r\n}\r\nreturn 0;\r\n}\r\nint input_event_from_user(const char __user *buffer,\r\nstruct input_event *event)\r\n{\r\nif (copy_from_user(event, buffer, sizeof(struct input_event)))\r\nreturn -EFAULT;\r\nreturn 0;\r\n}\r\nint input_event_to_user(char __user *buffer,\r\nconst struct input_event *event)\r\n{\r\nif (copy_to_user(buffer, event, sizeof(struct input_event)))\r\nreturn -EFAULT;\r\nreturn 0;\r\n}\r\nint input_ff_effect_from_user(const char __user *buffer, size_t size,\r\nstruct ff_effect *effect)\r\n{\r\nif (size != sizeof(struct ff_effect))\r\nreturn -EINVAL;\r\nif (copy_from_user(effect, buffer, sizeof(struct ff_effect)))\r\nreturn -EFAULT;\r\nreturn 0;\r\n}
