static int __init probe_list2(int unit, struct devprobe2 *p, int autoprobe)\r\n{\r\nstruct net_device *dev;\r\nfor (; p->probe; p++) {\r\nif (autoprobe && p->status)\r\ncontinue;\r\ndev = p->probe(unit);\r\nif (!IS_ERR(dev))\r\nreturn 0;\r\nif (autoprobe)\r\np->status = PTR_ERR(dev);\r\n}\r\nreturn -ENODEV;\r\n}\r\nstatic void __init ethif_probe2(int unit)\r\n{\r\nunsigned long base_addr = netdev_boot_base("eth", unit);\r\nif (base_addr == 1)\r\nreturn;\r\n(void)( probe_list2(unit, m68k_probes, base_addr == 0) &&\r\nprobe_list2(unit, eisa_probes, base_addr == 0) &&\r\nprobe_list2(unit, mca_probes, base_addr == 0) &&\r\nprobe_list2(unit, isa_probes, base_addr == 0) &&\r\nprobe_list2(unit, parport_probes, base_addr == 0));\r\n}\r\nstatic __init int trif_probe(int unit)\r\n{\r\nint err = -ENODEV;\r\n#ifdef CONFIG_IBMTR\r\nstruct net_device *dev = alloc_trdev(0);\r\nif (!dev)\r\nreturn -ENOMEM;\r\nsprintf(dev->name, "tr%d", unit);\r\nnetdev_boot_setup_check(dev);\r\nerr = ibmtr_probe_card(dev);\r\nif (err)\r\nfree_netdev(dev);\r\n#endif\r\nreturn err;\r\n}\r\nstatic void __init trif_probe2(int unit)\r\n{\r\nunsigned long base_addr = netdev_boot_base("tr", unit);\r\nif (base_addr == 1)\r\nreturn;\r\nprobe_list2(unit, tr_probes2, base_addr == 0);\r\n}\r\nstatic int __init net_olddevs_init(void)\r\n{\r\nint num;\r\n#ifdef CONFIG_SBNI\r\nfor (num = 0; num < 8; ++num)\r\nsbni_probe(num);\r\n#endif\r\n#ifdef CONFIG_TR\r\nfor (num = 0; num < 8; ++num)\r\nif (!trif_probe(num))\r\ntrif_probe2(num);\r\n#endif\r\nfor (num = 0; num < 8; ++num)\r\nethif_probe2(num);\r\n#ifdef CONFIG_COPS\r\ncops_probe(0);\r\ncops_probe(1);\r\ncops_probe(2);\r\n#endif\r\n#ifdef CONFIG_LTPC\r\nltpc_probe();\r\n#endif\r\nreturn 0;\r\n}
