static void notify_ha_event(struct sas_ha_struct *sas_ha, enum ha_event event)\r\n{\r\nBUG_ON(event >= HA_NUM_EVENTS);\r\nsas_queue_event(event, &sas_ha->event_lock, &sas_ha->pending,\r\n&sas_ha->ha_events[event].work, sas_ha);\r\n}\r\nstatic void notify_port_event(struct asd_sas_phy *phy, enum port_event event)\r\n{\r\nstruct sas_ha_struct *ha = phy->ha;\r\nBUG_ON(event >= PORT_NUM_EVENTS);\r\nsas_queue_event(event, &ha->event_lock, &phy->port_events_pending,\r\n&phy->port_events[event].work, ha);\r\n}\r\nstatic void notify_phy_event(struct asd_sas_phy *phy, enum phy_event event)\r\n{\r\nstruct sas_ha_struct *ha = phy->ha;\r\nBUG_ON(event >= PHY_NUM_EVENTS);\r\nsas_queue_event(event, &ha->event_lock, &phy->phy_events_pending,\r\n&phy->phy_events[event].work, ha);\r\n}\r\nint sas_init_events(struct sas_ha_struct *sas_ha)\r\n{\r\nstatic const work_func_t sas_ha_event_fns[HA_NUM_EVENTS] = {\r\n[HAE_RESET] = sas_hae_reset,\r\n};\r\nint i;\r\nspin_lock_init(&sas_ha->event_lock);\r\nfor (i = 0; i < HA_NUM_EVENTS; i++) {\r\nINIT_WORK(&sas_ha->ha_events[i].work, sas_ha_event_fns[i]);\r\nsas_ha->ha_events[i].ha = sas_ha;\r\n}\r\nsas_ha->notify_ha_event = notify_ha_event;\r\nsas_ha->notify_port_event = notify_port_event;\r\nsas_ha->notify_phy_event = notify_phy_event;\r\nreturn 0;\r\n}
