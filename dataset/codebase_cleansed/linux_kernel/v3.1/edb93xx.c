static void __init edb93xx_register_flash(void)\r\n{\r\nif (machine_is_edb9307() || machine_is_edb9312() ||\r\nmachine_is_edb9315()) {\r\nep93xx_register_flash(4, EP93XX_CS6_PHYS_BASE, SZ_32M);\r\n} else {\r\nep93xx_register_flash(2, EP93XX_CS6_PHYS_BASE, SZ_16M);\r\n}\r\n}\r\nstatic void __init edb93xx_register_i2c(void)\r\n{\r\nif (machine_is_edb9302a() || machine_is_edb9307a() ||\r\nmachine_is_edb9315a()) {\r\nep93xx_register_i2c(&edb93xx_i2c_gpio_data,\r\nedb93xxa_i2c_board_info,\r\nARRAY_SIZE(edb93xxa_i2c_board_info));\r\n} else if (machine_is_edb9307() || machine_is_edb9312() ||\r\nmachine_is_edb9315()) {\r\nep93xx_register_i2c(&edb93xx_i2c_gpio_data,\r\nedb93xx_i2c_board_info,\r\nARRAY_SIZE(edb93xx_i2c_board_info));\r\n}\r\n}\r\nstatic int edb93xx_cs4271_hw_setup(struct spi_device *spi)\r\n{\r\nreturn gpio_request_one(EP93XX_GPIO_LINE_EGPIO6,\r\nGPIOF_OUT_INIT_HIGH, spi->modalias);\r\n}\r\nstatic void edb93xx_cs4271_hw_cleanup(struct spi_device *spi)\r\n{\r\ngpio_free(EP93XX_GPIO_LINE_EGPIO6);\r\n}\r\nstatic void edb93xx_cs4271_hw_cs_control(struct spi_device *spi, int value)\r\n{\r\ngpio_set_value(EP93XX_GPIO_LINE_EGPIO6, value);\r\n}\r\nstatic void __init edb93xx_register_spi(void)\r\n{\r\nif (machine_is_edb9301() || machine_is_edb9302())\r\nedb93xx_cs4271_data.gpio_nreset = EP93XX_GPIO_LINE_EGPIO1;\r\nelse if (machine_is_edb9302a() || machine_is_edb9307a())\r\nedb93xx_cs4271_data.gpio_nreset = EP93XX_GPIO_LINE_H(2);\r\nelse if (machine_is_edb9315a())\r\nedb93xx_cs4271_data.gpio_nreset = EP93XX_GPIO_LINE_EGPIO14;\r\nep93xx_register_spi(&edb93xx_spi_info, edb93xx_spi_board_info,\r\nARRAY_SIZE(edb93xx_spi_board_info));\r\n}\r\nstatic int __init edb93xx_has_audio(void)\r\n{\r\nreturn (machine_is_edb9301() || machine_is_edb9302() ||\r\nmachine_is_edb9302a() || machine_is_edb9307a() ||\r\nmachine_is_edb9315a());\r\n}\r\nstatic void __init edb93xx_register_i2s(void)\r\n{\r\nif (edb93xx_has_audio()) {\r\nep93xx_register_i2s();\r\n}\r\n}\r\nstatic void __init edb93xx_register_pwm(void)\r\n{\r\nif (machine_is_edb9301() ||\r\nmachine_is_edb9302() || machine_is_edb9302a()) {\r\nep93xx_register_pwm(0, 1);\r\n} else if (machine_is_edb9307() || machine_is_edb9307a()) {\r\nep93xx_register_pwm(1, 0);\r\n} else {\r\nep93xx_register_pwm(1, 1);\r\n}\r\n}\r\nstatic int __init edb93xx_has_fb(void)\r\n{\r\nreturn machine_is_edb9307() || machine_is_edb9307a() ||\r\nmachine_is_edb9312() || machine_is_edb9315() ||\r\nmachine_is_edb9315a();\r\n}\r\nstatic void __init edb93xx_register_fb(void)\r\n{\r\nif (!edb93xx_has_fb())\r\nreturn;\r\nif (machine_is_edb9307a() || machine_is_edb9315a())\r\nedb93xxfb_info.flags |= EP93XXFB_USE_SDCSN0;\r\nelse\r\nedb93xxfb_info.flags |= EP93XXFB_USE_SDCSN3;\r\nep93xx_register_fb(&edb93xxfb_info);\r\n}\r\nstatic void __init edb93xx_init_machine(void)\r\n{\r\nep93xx_init_devices();\r\nedb93xx_register_flash();\r\nep93xx_register_eth(&edb93xx_eth_data, 1);\r\nedb93xx_register_i2c();\r\nedb93xx_register_spi();\r\nedb93xx_register_i2s();\r\nedb93xx_register_pwm();\r\nedb93xx_register_fb();\r\n}
