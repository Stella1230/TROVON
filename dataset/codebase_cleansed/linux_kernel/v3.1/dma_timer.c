static cycle_t cf_dt_get_cycles(struct clocksource *cs)\r\n{\r\nreturn __raw_readl(DTCN0);\r\n}\r\nstatic int __init init_cf_dt_clocksource(void)\r\n{\r\n__raw_writeb(0x00, DTXMR0);\r\n__raw_writeb(0x00, DTER0);\r\n__raw_writel(0x00000000, DTRR0);\r\n__raw_writew(DMA_DTMR_CLK_DIV_16 | DMA_DTMR_ENABLE, DTMR0);\r\nclocksource_cf_dt.mult = clocksource_hz2mult(DMA_FREQ,\r\nclocksource_cf_dt.shift);\r\nreturn clocksource_register(&clocksource_cf_dt);\r\n}\r\nstatic unsigned long long cycles2ns(unsigned long cycl)\r\n{\r\nreturn (unsigned long long) ((unsigned long long)cycl *\r\nCYC2NS_SCALE) >> CYC2NS_SCALE_FACTOR;\r\n}\r\nunsigned long long sched_clock(void)\r\n{\r\nunsigned long cycl = __raw_readl(DTCN0);\r\nreturn cycles2ns(cycl);\r\n}
