struct cflayer *cfdbgl_create(u8 channel_id, struct dev_info *dev_info)\r\n{\r\nstruct cfsrvl *dbg = kmalloc(sizeof(struct cfsrvl), GFP_ATOMIC);\r\nif (!dbg) {\r\npr_warn("Out of memory\n");\r\nreturn NULL;\r\n}\r\ncaif_assert(offsetof(struct cfsrvl, layer) == 0);\r\nmemset(dbg, 0, sizeof(struct cfsrvl));\r\ncfsrvl_init(dbg, channel_id, dev_info, false);\r\ndbg->layer.receive = cfdbgl_receive;\r\ndbg->layer.transmit = cfdbgl_transmit;\r\nsnprintf(dbg->layer.name, CAIF_LAYER_NAME_SZ - 1, "dbg%d", channel_id);\r\nreturn &dbg->layer;\r\n}\r\nstatic int cfdbgl_receive(struct cflayer *layr, struct cfpkt *pkt)\r\n{\r\nreturn layr->up->receive(layr->up, pkt);\r\n}\r\nstatic int cfdbgl_transmit(struct cflayer *layr, struct cfpkt *pkt)\r\n{\r\nstruct cfsrvl *service = container_obj(layr);\r\nstruct caif_payload_info *info;\r\nint ret;\r\nif (!cfsrvl_ready(service, &ret))\r\nreturn ret;\r\ninfo = cfpkt_info(pkt);\r\ninfo->channel_id = service->layer.id;\r\ninfo->dev_info = &service->dev_info;\r\nreturn layr->dn->transmit(layr->dn, pkt);\r\n}
