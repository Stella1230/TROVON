void fpu_emulator_init_fpu(void)\r\n{\r\nstatic int first = 1;\r\nint i;\r\nif (first) {\r\nfirst = 0;\r\nprintk("Algorithmics/MIPS FPU Emulator v1.5\n");\r\n}\r\ncurrent->thread.fpu.fcr31 = 0;\r\nfor (i = 0; i < 32; i++) {\r\ncurrent->thread.fpu.fpr[i] = SIGNALLING_NAN;\r\n}\r\n}\r\nint fpu_emulator_save_context(struct sigcontext __user *sc)\r\n{\r\nint i;\r\nint err = 0;\r\nfor (i = 0; i < 32; i++) {\r\nerr |=\r\n__put_user(current->thread.fpu.fpr[i], &sc->sc_fpregs[i]);\r\n}\r\nerr |= __put_user(current->thread.fpu.fcr31, &sc->sc_fpc_csr);\r\nreturn err;\r\n}\r\nint fpu_emulator_restore_context(struct sigcontext __user *sc)\r\n{\r\nint i;\r\nint err = 0;\r\nfor (i = 0; i < 32; i++) {\r\nerr |=\r\n__get_user(current->thread.fpu.fpr[i], &sc->sc_fpregs[i]);\r\n}\r\nerr |= __get_user(current->thread.fpu.fcr31, &sc->sc_fpc_csr);\r\nreturn err;\r\n}\r\nint fpu_emulator_save_context32(struct sigcontext32 __user *sc)\r\n{\r\nint i;\r\nint err = 0;\r\nfor (i = 0; i < 32; i+=2) {\r\nerr |=\r\n__put_user(current->thread.fpu.fpr[i], &sc->sc_fpregs[i]);\r\n}\r\nerr |= __put_user(current->thread.fpu.fcr31, &sc->sc_fpc_csr);\r\nreturn err;\r\n}\r\nint fpu_emulator_restore_context32(struct sigcontext32 __user *sc)\r\n{\r\nint i;\r\nint err = 0;\r\nfor (i = 0; i < 32; i+=2) {\r\nerr |=\r\n__get_user(current->thread.fpu.fpr[i], &sc->sc_fpregs[i]);\r\n}\r\nerr |= __get_user(current->thread.fpu.fcr31, &sc->sc_fpc_csr);\r\nreturn err;\r\n}
