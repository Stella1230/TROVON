void\r\nxfs_tosspages(\r\nxfs_inode_t *ip,\r\nxfs_off_t first,\r\nxfs_off_t last,\r\nint fiopt)\r\n{\r\nlast &= ~(PAGE_SIZE - 1);\r\ntruncate_inode_pages_range(VFS_I(ip)->i_mapping, first, last - 1);\r\n}\r\nint\r\nxfs_flushinval_pages(\r\nxfs_inode_t *ip,\r\nxfs_off_t first,\r\nxfs_off_t last,\r\nint fiopt)\r\n{\r\nstruct address_space *mapping = VFS_I(ip)->i_mapping;\r\nint ret = 0;\r\ntrace_xfs_pagecache_inval(ip, first, last);\r\nxfs_iflags_clear(ip, XFS_ITRUNCATED);\r\nret = filemap_write_and_wait_range(mapping, first,\r\nlast == -1 ? LLONG_MAX : last);\r\nif (!ret)\r\ntruncate_inode_pages_range(mapping, first, last);\r\nreturn -ret;\r\n}\r\nint\r\nxfs_flush_pages(\r\nxfs_inode_t *ip,\r\nxfs_off_t first,\r\nxfs_off_t last,\r\nuint64_t flags,\r\nint fiopt)\r\n{\r\nstruct address_space *mapping = VFS_I(ip)->i_mapping;\r\nint ret = 0;\r\nint ret2;\r\nxfs_iflags_clear(ip, XFS_ITRUNCATED);\r\nret = -filemap_fdatawrite_range(mapping, first,\r\nlast == -1 ? LLONG_MAX : last);\r\nif (flags & XBF_ASYNC)\r\nreturn ret;\r\nret2 = xfs_wait_on_pages(ip, first, last);\r\nif (!ret)\r\nret = ret2;\r\nreturn ret;\r\n}\r\nint\r\nxfs_wait_on_pages(\r\nxfs_inode_t *ip,\r\nxfs_off_t first,\r\nxfs_off_t last)\r\n{\r\nstruct address_space *mapping = VFS_I(ip)->i_mapping;\r\nif (mapping_tagged(mapping, PAGECACHE_TAG_WRITEBACK)) {\r\nreturn -filemap_fdatawait_range(mapping, first,\r\nlast == -1 ? ip->i_size - 1 : last);\r\n}\r\nreturn 0;\r\n}
