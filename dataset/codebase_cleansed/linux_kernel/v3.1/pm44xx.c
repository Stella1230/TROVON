static int omap4_pm_suspend(void)\r\n{\r\ndo_wfi();\r\nreturn 0;\r\n}\r\nstatic int omap4_pm_enter(suspend_state_t suspend_state)\r\n{\r\nint ret = 0;\r\nswitch (suspend_state) {\r\ncase PM_SUSPEND_STANDBY:\r\ncase PM_SUSPEND_MEM:\r\nret = omap4_pm_suspend();\r\nbreak;\r\ndefault:\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic int omap4_pm_begin(suspend_state_t state)\r\n{\r\ndisable_hlt();\r\nreturn 0;\r\n}\r\nstatic void omap4_pm_end(void)\r\n{\r\nenable_hlt();\r\nreturn;\r\n}\r\nstatic int __init pwrdms_setup(struct powerdomain *pwrdm, void *unused)\r\n{\r\nstruct power_state *pwrst;\r\nif (!pwrdm->pwrsts)\r\nreturn 0;\r\npwrst = kmalloc(sizeof(struct power_state), GFP_ATOMIC);\r\nif (!pwrst)\r\nreturn -ENOMEM;\r\npwrst->pwrdm = pwrdm;\r\npwrst->next_state = PWRDM_POWER_ON;\r\nlist_add(&pwrst->node, &pwrst_list);\r\nreturn pwrdm_set_next_pwrst(pwrst->pwrdm, pwrst->next_state);\r\n}\r\nstatic int __init omap4_pm_init(void)\r\n{\r\nint ret;\r\nif (!cpu_is_omap44xx())\r\nreturn -ENODEV;\r\npr_err("Power Management for TI OMAP4.\n");\r\nret = pwrdm_for_each(pwrdms_setup, NULL);\r\nif (ret) {\r\npr_err("Failed to setup powerdomains\n");\r\ngoto err2;\r\n}\r\n#ifdef CONFIG_SUSPEND\r\nsuspend_set_ops(&omap_pm_ops);\r\n#endif\r\nerr2:\r\nreturn ret;\r\n}
