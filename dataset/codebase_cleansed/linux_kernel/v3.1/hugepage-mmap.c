static void check_bytes(char *addr)\r\n{\r\nprintf("First hex is %x\n", *((unsigned int *)addr));\r\n}\r\nstatic void write_bytes(char *addr)\r\n{\r\nunsigned long i;\r\nfor (i = 0; i < LENGTH; i++)\r\n*(addr + i) = (char)i;\r\n}\r\nstatic void read_bytes(char *addr)\r\n{\r\nunsigned long i;\r\ncheck_bytes(addr);\r\nfor (i = 0; i < LENGTH; i++)\r\nif (*(addr + i) != (char)i) {\r\nprintf("Mismatch at %lu\n", i);\r\nbreak;\r\n}\r\n}\r\nint main(void)\r\n{\r\nvoid *addr;\r\nint fd;\r\nfd = open(FILE_NAME, O_CREAT | O_RDWR, 0755);\r\nif (fd < 0) {\r\nperror("Open failed");\r\nexit(1);\r\n}\r\naddr = mmap(ADDR, LENGTH, PROTECTION, FLAGS, fd, 0);\r\nif (addr == MAP_FAILED) {\r\nperror("mmap");\r\nunlink(FILE_NAME);\r\nexit(1);\r\n}\r\nprintf("Returned address is %p\n", addr);\r\ncheck_bytes(addr);\r\nwrite_bytes(addr);\r\nread_bytes(addr);\r\nmunmap(addr, LENGTH);\r\nclose(fd);\r\nunlink(FILE_NAME);\r\nreturn 0;\r\n}
