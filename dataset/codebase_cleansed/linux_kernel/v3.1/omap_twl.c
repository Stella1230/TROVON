static unsigned long twl4030_vsel_to_uv(const u8 vsel)\r\n{\r\nreturn (((vsel * 125) + 6000)) * 100;\r\n}\r\nstatic u8 twl4030_uv_to_vsel(unsigned long uv)\r\n{\r\nreturn DIV_ROUND_UP(uv - 600000, 12500);\r\n}\r\nstatic unsigned long twl6030_vsel_to_uv(const u8 vsel)\r\n{\r\nif (!is_offset_valid) {\r\ntwl_i2c_read_u8(TWL6030_MODULE_ID0, &smps_offset,\r\nREG_SMPS_OFFSET);\r\nis_offset_valid = true;\r\n}\r\nif (vsel == 0x3A)\r\nreturn 1350000;\r\nif (smps_offset & 0x8)\r\nreturn ((((vsel - 1) * 125) + 7000)) * 100;\r\nelse\r\nreturn ((((vsel - 1) * 125) + 6000)) * 100;\r\n}\r\nstatic u8 twl6030_uv_to_vsel(unsigned long uv)\r\n{\r\nif (!is_offset_valid) {\r\ntwl_i2c_read_u8(TWL6030_MODULE_ID0, &smps_offset,\r\nREG_SMPS_OFFSET);\r\nis_offset_valid = true;\r\n}\r\nif (uv == 1350000)\r\nreturn 0x3A;\r\nif (smps_offset & 0x8)\r\nreturn DIV_ROUND_UP(uv - 700000, 12500) + 1;\r\nelse\r\nreturn DIV_ROUND_UP(uv - 600000, 12500) + 1;\r\n}\r\nint __init omap4_twl_init(void)\r\n{\r\nstruct voltagedomain *voltdm;\r\nif (!cpu_is_omap44xx())\r\nreturn -ENODEV;\r\nvoltdm = omap_voltage_domain_lookup("mpu");\r\nomap_voltage_register_pmic(voltdm, &omap4_mpu_volt_info);\r\nvoltdm = omap_voltage_domain_lookup("iva");\r\nomap_voltage_register_pmic(voltdm, &omap4_iva_volt_info);\r\nvoltdm = omap_voltage_domain_lookup("core");\r\nomap_voltage_register_pmic(voltdm, &omap4_core_volt_info);\r\nreturn 0;\r\n}\r\nint __init omap3_twl_init(void)\r\n{\r\nstruct voltagedomain *voltdm;\r\nif (!cpu_is_omap34xx())\r\nreturn -ENODEV;\r\nif (cpu_is_omap3630()) {\r\nomap3_mpu_volt_info.vp_vddmin = OMAP3630_VP1_VLIMITTO_VDDMIN;\r\nomap3_mpu_volt_info.vp_vddmax = OMAP3630_VP1_VLIMITTO_VDDMAX;\r\nomap3_core_volt_info.vp_vddmin = OMAP3630_VP2_VLIMITTO_VDDMIN;\r\nomap3_core_volt_info.vp_vddmax = OMAP3630_VP2_VLIMITTO_VDDMAX;\r\n}\r\nif (!twl_sr_enable_autoinit)\r\nomap3_twl_set_sr_bit(true);\r\nvoltdm = omap_voltage_domain_lookup("mpu");\r\nomap_voltage_register_pmic(voltdm, &omap3_mpu_volt_info);\r\nvoltdm = omap_voltage_domain_lookup("core");\r\nomap_voltage_register_pmic(voltdm, &omap3_core_volt_info);\r\nreturn 0;\r\n}\r\nint __init omap3_twl_set_sr_bit(bool enable)\r\n{\r\nu8 temp;\r\nint ret;\r\nif (twl_sr_enable_autoinit)\r\npr_warning("%s: unexpected multiple calls\n", __func__);\r\nret = twl_i2c_read_u8(TWL4030_MODULE_PM_RECEIVER, &temp,\r\nTWL4030_DCDC_GLOBAL_CFG);\r\nif (ret)\r\ngoto err;\r\nif (enable)\r\ntemp |= SMARTREFLEX_ENABLE;\r\nelse\r\ntemp &= ~SMARTREFLEX_ENABLE;\r\nret = twl_i2c_write_u8(TWL4030_MODULE_PM_RECEIVER, temp,\r\nTWL4030_DCDC_GLOBAL_CFG);\r\nif (!ret) {\r\ntwl_sr_enable_autoinit = true;\r\nreturn 0;\r\n}\r\nerr:\r\npr_err("%s: Error access to TWL4030 (%d)\n", __func__, ret);\r\nreturn ret;\r\n}
