static void early_write(const char *s, unsigned n)\r\n{\r\nwhile (n-- > 0) {\r\nif (*s == '\n')\r\nprintch('\r');\r\nprintch(*s);\r\ns++;\r\n}\r\n}\r\nstatic void early_console_write(struct console *con, const char *s, unsigned n)\r\n{\r\nearly_write(s, n);\r\n}\r\nasmlinkage void early_printk(const char *fmt, ...)\r\n{\r\nchar buf[512];\r\nint n;\r\nva_list ap;\r\nva_start(ap, fmt);\r\nn = vscnprintf(buf, sizeof(buf), fmt, ap);\r\nearly_write(buf, n);\r\nva_end(ap);\r\n}\r\nstatic int __init setup_early_printk(char *buf)\r\n{\r\nregister_console(&early_console);\r\nreturn 0;\r\n}
