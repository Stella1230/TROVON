void mx5_cpu_lp_set(enum mxc_cpu_pwr_mode mode)\r\n{\r\nu32 plat_lpc, arm_srpgcr, ccm_clpcr;\r\nu32 empgc0, empgc1;\r\nint stop_mode = 0;\r\nplat_lpc = __raw_readl(MXC_CORTEXA8_PLAT_LPC) &\r\n~(MXC_CORTEXA8_PLAT_LPC_DSM);\r\nccm_clpcr = __raw_readl(MXC_CCM_CLPCR) & ~(MXC_CCM_CLPCR_LPM_MASK);\r\narm_srpgcr = __raw_readl(MXC_SRPG_ARM_SRPGCR) & ~(MXC_SRPGCR_PCR);\r\nempgc0 = __raw_readl(MXC_SRPG_EMPGC0_SRPGCR) & ~(MXC_SRPGCR_PCR);\r\nempgc1 = __raw_readl(MXC_SRPG_EMPGC1_SRPGCR) & ~(MXC_SRPGCR_PCR);\r\nswitch (mode) {\r\ncase WAIT_CLOCKED:\r\nbreak;\r\ncase WAIT_UNCLOCKED:\r\nccm_clpcr |= 0x1 << MXC_CCM_CLPCR_LPM_OFFSET;\r\nbreak;\r\ncase WAIT_UNCLOCKED_POWER_OFF:\r\ncase STOP_POWER_OFF:\r\nplat_lpc |= MXC_CORTEXA8_PLAT_LPC_DSM\r\n| MXC_CORTEXA8_PLAT_LPC_DBG_DSM;\r\nif (mode == WAIT_UNCLOCKED_POWER_OFF) {\r\nccm_clpcr |= 0x1 << MXC_CCM_CLPCR_LPM_OFFSET;\r\nccm_clpcr &= ~MXC_CCM_CLPCR_VSTBY;\r\nccm_clpcr &= ~MXC_CCM_CLPCR_SBYOS;\r\nstop_mode = 0;\r\n} else {\r\nccm_clpcr |= 0x2 << MXC_CCM_CLPCR_LPM_OFFSET;\r\nccm_clpcr |= 0x3 << MXC_CCM_CLPCR_STBY_COUNT_OFFSET;\r\nccm_clpcr |= MXC_CCM_CLPCR_VSTBY;\r\nccm_clpcr |= MXC_CCM_CLPCR_SBYOS;\r\nstop_mode = 1;\r\n}\r\narm_srpgcr |= MXC_SRPGCR_PCR;\r\nif (tzic_enable_wake(1) != 0)\r\nreturn;\r\nbreak;\r\ncase STOP_POWER_ON:\r\nccm_clpcr |= 0x2 << MXC_CCM_CLPCR_LPM_OFFSET;\r\nbreak;\r\ndefault:\r\nprintk(KERN_WARNING "UNKNOWN cpu power mode: %d\n", mode);\r\nreturn;\r\n}\r\n__raw_writel(plat_lpc, MXC_CORTEXA8_PLAT_LPC);\r\n__raw_writel(ccm_clpcr, MXC_CCM_CLPCR);\r\n__raw_writel(arm_srpgcr, MXC_SRPG_ARM_SRPGCR);\r\nif (mx50_revision() != IMX_CHIP_REVISION_1_0)\r\n__raw_writel(arm_srpgcr, MXC_SRPG_NEON_SRPGCR);\r\nif (stop_mode) {\r\nempgc0 |= MXC_SRPGCR_PCR;\r\nempgc1 |= MXC_SRPGCR_PCR;\r\n__raw_writel(empgc0, MXC_SRPG_EMPGC0_SRPGCR);\r\n__raw_writel(empgc1, MXC_SRPG_EMPGC1_SRPGCR);\r\n}\r\n}
