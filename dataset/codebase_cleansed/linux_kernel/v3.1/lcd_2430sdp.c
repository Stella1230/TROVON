static int sdp2430_panel_init(struct lcd_panel *panel,\r\nstruct omapfb_device *fbdev)\r\n{\r\nif (machine_is_omap_3430sdp()) {\r\nenable_gpio = SDP3430_LCD_PANEL_ENABLE_GPIO;\r\nbacklight_gpio = SDP3430_LCD_PANEL_BACKLIGHT_GPIO;\r\n} else {\r\nenable_gpio = SDP2430_LCD_PANEL_ENABLE_GPIO;\r\nbacklight_gpio = SDP2430_LCD_PANEL_BACKLIGHT_GPIO;\r\n}\r\ngpio_request(enable_gpio, "LCD enable");\r\ngpio_request(backlight_gpio, "LCD bl");\r\ngpio_direction_output(enable_gpio, 0);\r\ngpio_direction_output(backlight_gpio, 0);\r\nreturn 0;\r\n}\r\nstatic void sdp2430_panel_cleanup(struct lcd_panel *panel)\r\n{\r\ngpio_free(backlight_gpio);\r\ngpio_free(enable_gpio);\r\n}\r\nstatic int sdp2430_panel_enable(struct lcd_panel *panel)\r\n{\r\nu8 ded_val, ded_reg;\r\nu8 grp_val, grp_reg;\r\nif (machine_is_omap_3430sdp()) {\r\nded_reg = TWL4030_VAUX3_DEDICATED;\r\nded_val = ENABLE_VAUX3_DEDICATED;\r\ngrp_reg = TWL4030_VAUX3_DEV_GRP;\r\ngrp_val = ENABLE_VAUX3_DEV_GRP;\r\nif (omap_rev() > OMAP3430_REV_ES1_0) {\r\nt2_out(PM_RECEIVER, ENABLE_VPLL2_DEDICATED,\r\nTWL4030_VPLL2_DEDICATED);\r\nt2_out(PM_RECEIVER, ENABLE_VPLL2_DEV_GRP,\r\nTWL4030_VPLL2_DEV_GRP);\r\n}\r\n} else {\r\nded_reg = TWL4030_VAUX2_DEDICATED;\r\nded_val = ENABLE_VAUX2_DEDICATED;\r\ngrp_reg = TWL4030_VAUX2_DEV_GRP;\r\ngrp_val = ENABLE_VAUX2_DEV_GRP;\r\n}\r\ngpio_set_value(enable_gpio, 1);\r\ngpio_set_value(backlight_gpio, 1);\r\nif (0 != t2_out(PM_RECEIVER, ded_val, ded_reg))\r\nreturn -EIO;\r\nif (0 != t2_out(PM_RECEIVER, grp_val, grp_reg))\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic void sdp2430_panel_disable(struct lcd_panel *panel)\r\n{\r\ngpio_set_value(enable_gpio, 0);\r\ngpio_set_value(backlight_gpio, 0);\r\nif (omap_rev() > OMAP3430_REV_ES1_0) {\r\nt2_out(PM_RECEIVER, 0x0, TWL4030_VPLL2_DEDICATED);\r\nt2_out(PM_RECEIVER, 0x0, TWL4030_VPLL2_DEV_GRP);\r\nmsleep(4);\r\n}\r\n}\r\nstatic unsigned long sdp2430_panel_get_caps(struct lcd_panel *panel)\r\n{\r\nreturn 0;\r\n}\r\nstatic int sdp2430_panel_probe(struct platform_device *pdev)\r\n{\r\nomapfb_register_panel(&sdp2430_panel);\r\nreturn 0;\r\n}\r\nstatic int sdp2430_panel_remove(struct platform_device *pdev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int sdp2430_panel_suspend(struct platform_device *pdev,\r\npm_message_t mesg)\r\n{\r\nreturn 0;\r\n}\r\nstatic int sdp2430_panel_resume(struct platform_device *pdev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int __init sdp2430_panel_drv_init(void)\r\n{\r\nreturn platform_driver_register(&sdp2430_panel_driver);\r\n}\r\nstatic void __exit sdp2430_panel_drv_exit(void)\r\n{\r\nplatform_driver_unregister(&sdp2430_panel_driver);\r\n}
