int save_fp_registers(int pid, unsigned long *fp_regs)\r\n{\r\nif (ptrace(PTRACE_GETFPREGS, pid, 0, fp_regs) < 0)\r\nreturn -errno;\r\nreturn 0;\r\n}\r\nint restore_fp_registers(int pid, unsigned long *fp_regs)\r\n{\r\nif (ptrace(PTRACE_SETFPREGS, pid, 0, fp_regs) < 0)\r\nreturn -errno;\r\nreturn 0;\r\n}\r\nunsigned long get_thread_reg(int reg, jmp_buf *buf)\r\n{\r\nswitch (reg) {\r\ncase RIP:\r\nreturn buf[0]->__rip;\r\ncase RSP:\r\nreturn buf[0]->__rsp;\r\ncase RBP:\r\nreturn buf[0]->__rbp;\r\ndefault:\r\nprintk(UM_KERN_ERR "get_thread_regs - unknown register %d\n",\r\nreg);\r\nreturn 0;\r\n}\r\n}\r\nint get_fp_registers(int pid, unsigned long *regs)\r\n{\r\nreturn save_fp_registers(pid, regs);\r\n}\r\nint put_fp_registers(int pid, unsigned long *regs)\r\n{\r\nreturn restore_fp_registers(pid, regs);\r\n}
