int mantis_input_init(struct mantis_pci *mantis)\r\n{\r\nstruct rc_dev *dev;\r\nint err;\r\nerr = rc_map_register(&ir_mantis_map);\r\nif (err)\r\ngoto out;\r\ndev = rc_allocate_device();\r\nif (!dev) {\r\ndprintk(MANTIS_ERROR, 1, "Remote device allocation failed");\r\nerr = -ENOMEM;\r\ngoto out_map;\r\n}\r\nsprintf(mantis->input_name, "Mantis %s IR receiver", mantis->hwconfig->model_name);\r\nsprintf(mantis->input_phys, "pci-%s/ir0", pci_name(mantis->pdev));\r\ndev->input_name = mantis->input_name;\r\ndev->input_phys = mantis->input_phys;\r\ndev->input_id.bustype = BUS_PCI;\r\ndev->input_id.vendor = mantis->vendor_id;\r\ndev->input_id.product = mantis->device_id;\r\ndev->input_id.version = 1;\r\ndev->driver_name = MODULE_NAME;\r\ndev->map_name = RC_MAP_MANTIS;\r\ndev->dev.parent = &mantis->pdev->dev;\r\nerr = rc_register_device(dev);\r\nif (err) {\r\ndprintk(MANTIS_ERROR, 1, "IR device registration failed, ret = %d", err);\r\ngoto out_dev;\r\n}\r\nmantis->rc = dev;\r\nreturn 0;\r\nout_dev:\r\nrc_free_device(dev);\r\nout_map:\r\nrc_map_unregister(&ir_mantis_map);\r\nout:\r\nreturn err;\r\n}\r\nint mantis_exit(struct mantis_pci *mantis)\r\n{\r\nrc_unregister_device(mantis->rc);\r\nrc_map_unregister(&ir_mantis_map);\r\nreturn 0;\r\n}
