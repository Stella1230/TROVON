struct ui_progress *ui_progress__new(const char *title, u64 total)\r\n{\r\nstruct ui_progress *self = malloc(sizeof(*self));\r\nif (self != NULL) {\r\nint cols;\r\nif (use_browser <= 0)\r\nreturn self;\r\nnewtGetScreenSize(&cols, NULL);\r\ncols -= 4;\r\nnewtCenteredWindow(cols, 1, title);\r\nself->form = newtForm(NULL, NULL, 0);\r\nif (self->form == NULL)\r\ngoto out_free_self;\r\nself->scale = newtScale(0, 0, cols, total);\r\nif (self->scale == NULL)\r\ngoto out_free_form;\r\nnewtFormAddComponent(self->form, self->scale);\r\nnewtRefresh();\r\n}\r\nreturn self;\r\nout_free_form:\r\nnewtFormDestroy(self->form);\r\nout_free_self:\r\nfree(self);\r\nreturn NULL;\r\n}\r\nvoid ui_progress__update(struct ui_progress *self, u64 curr)\r\n{\r\nif (use_browser <= 0)\r\nreturn;\r\nnewtScaleSet(self->scale, curr);\r\nnewtRefresh();\r\n}\r\nvoid ui_progress__delete(struct ui_progress *self)\r\n{\r\nif (use_browser > 0) {\r\nnewtFormDestroy(self->form);\r\nnewtPopWindow();\r\n}\r\nfree(self);\r\n}
