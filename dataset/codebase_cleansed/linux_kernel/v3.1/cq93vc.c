static inline unsigned int cq93vc_read(struct snd_soc_codec *codec,\r\nunsigned int reg)\r\n{\r\nstruct davinci_vc *davinci_vc = codec->control_data;\r\nreturn readl(davinci_vc->base + reg);\r\n}\r\nstatic inline int cq93vc_write(struct snd_soc_codec *codec, unsigned int reg,\r\nunsigned int value)\r\n{\r\nstruct davinci_vc *davinci_vc = codec->control_data;\r\nwritel(value, davinci_vc->base + reg);\r\nreturn 0;\r\n}\r\nstatic int cq93vc_mute(struct snd_soc_dai *dai, int mute)\r\n{\r\nstruct snd_soc_codec *codec = dai->codec;\r\nu8 reg = cq93vc_read(codec, DAVINCI_VC_REG09) & ~DAVINCI_VC_REG09_MUTE;\r\nif (mute)\r\ncq93vc_write(codec, DAVINCI_VC_REG09,\r\nreg | DAVINCI_VC_REG09_MUTE);\r\nelse\r\ncq93vc_write(codec, DAVINCI_VC_REG09, reg);\r\nreturn 0;\r\n}\r\nstatic int cq93vc_set_dai_sysclk(struct snd_soc_dai *codec_dai,\r\nint clk_id, unsigned int freq, int dir)\r\n{\r\nstruct snd_soc_codec *codec = codec_dai->codec;\r\nstruct davinci_vc *davinci_vc = codec->control_data;\r\nswitch (freq) {\r\ncase 22579200:\r\ncase 27000000:\r\ncase 33868800:\r\ndavinci_vc->cq93vc.sysclk = freq;\r\nreturn 0;\r\n}\r\nreturn -EINVAL;\r\n}\r\nstatic int cq93vc_set_bias_level(struct snd_soc_codec *codec,\r\nenum snd_soc_bias_level level)\r\n{\r\nswitch (level) {\r\ncase SND_SOC_BIAS_ON:\r\ncq93vc_write(codec, DAVINCI_VC_REG12,\r\nDAVINCI_VC_REG12_POWER_ALL_ON);\r\nbreak;\r\ncase SND_SOC_BIAS_PREPARE:\r\nbreak;\r\ncase SND_SOC_BIAS_STANDBY:\r\ncq93vc_write(codec, DAVINCI_VC_REG12,\r\nDAVINCI_VC_REG12_POWER_ALL_OFF);\r\nbreak;\r\ncase SND_SOC_BIAS_OFF:\r\ncq93vc_write(codec, DAVINCI_VC_REG12,\r\nDAVINCI_VC_REG12_POWER_ALL_OFF);\r\nbreak;\r\n}\r\ncodec->dapm.bias_level = level;\r\nreturn 0;\r\n}\r\nstatic int cq93vc_resume(struct snd_soc_codec *codec)\r\n{\r\ncq93vc_set_bias_level(codec, SND_SOC_BIAS_STANDBY);\r\nreturn 0;\r\n}\r\nstatic int cq93vc_probe(struct snd_soc_codec *codec)\r\n{\r\nstruct davinci_vc *davinci_vc = codec->dev->platform_data;\r\ndavinci_vc->cq93vc.codec = codec;\r\ncodec->control_data = davinci_vc;\r\nsnd_soc_add_controls(codec, cq93vc_snd_controls,\r\nARRAY_SIZE(cq93vc_snd_controls));\r\ncq93vc_set_bias_level(codec, SND_SOC_BIAS_STANDBY);\r\nreturn 0;\r\n}\r\nstatic int cq93vc_remove(struct snd_soc_codec *codec)\r\n{\r\ncq93vc_set_bias_level(codec, SND_SOC_BIAS_OFF);\r\nreturn 0;\r\n}\r\nstatic int cq93vc_platform_probe(struct platform_device *pdev)\r\n{\r\nreturn snd_soc_register_codec(&pdev->dev,\r\n&soc_codec_dev_cq93vc, &cq93vc_dai, 1);\r\n}\r\nstatic int cq93vc_platform_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_codec(&pdev->dev);\r\nreturn 0;\r\n}\r\nstatic int __init cq93vc_init(void)\r\n{\r\nreturn platform_driver_register(&cq93vc_codec_driver);\r\n}\r\nstatic void __exit cq93vc_exit(void)\r\n{\r\nplatform_driver_unregister(&cq93vc_codec_driver);\r\n}
