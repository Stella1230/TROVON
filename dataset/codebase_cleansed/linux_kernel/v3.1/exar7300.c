void exar7300_init(struct channel *sc)\r\n{\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG1, 0);\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG2, 0);\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG3, 0);\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG4,\r\nSBE_2T3E3_LIU_VAL_T3_MODE_SELECT |\r\nSBE_2T3E3_LIU_VAL_LOOPBACK_OFF);\r\n}\r\nvoid exar7300_set_loopback(struct channel *sc, u32 mode)\r\n{\r\nu32 val;\r\nswitch (mode) {\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_OFF:\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_REMOTE:\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_ANALOG:\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_DIGITAL:\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nval = exar7300_read(sc, SBE_2T3E3_LIU_REG_REG4);\r\nval &= ~(SBE_2T3E3_LIU_VAL_LOCAL_LOOPBACK | SBE_2T3E3_LIU_VAL_REMOTE_LOOPBACK);\r\nval |= mode;\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG4, val);\r\n#if 0\r\nswitch (mode) {\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_OFF:\r\nbreak;\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_REMOTE:\r\nexar7300_receive_equalization_onoff(sc, SBE_2T3E3_ON);\r\nbreak;\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_ANALOG:\r\nexar7300_receive_equalization_onoff(sc, SBE_2T3E3_OFF);\r\nbreak;\r\ncase SBE_2T3E3_LIU_VAL_LOOPBACK_DIGITAL:\r\nexar7300_receive_equalization_onoff(sc, SBE_2T3E3_ON);\r\nbreak;\r\n}\r\n#endif\r\n}\r\nvoid exar7300_set_frame_type(struct channel *sc, u32 type)\r\n{\r\nu32 val;\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nval = exar7300_read(sc, SBE_2T3E3_LIU_REG_REG4);\r\nval &= ~(SBE_2T3E3_LIU_VAL_T3_MODE_SELECT |\r\nSBE_2T3E3_LIU_VAL_E3_MODE_SELECT);\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\nval |= SBE_2T3E3_LIU_VAL_T3_MODE_SELECT;\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\nval |= SBE_2T3E3_LIU_VAL_E3_MODE_SELECT;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nexar7300_write(sc, SBE_2T3E3_LIU_REG_REG4, val);\r\n}\r\nvoid exar7300_transmit_all_ones_onoff(struct channel *sc, u32 mode)\r\n{\r\nif (sc->p.transmit_all_ones == mode)\r\nreturn;\r\nswitch (mode) {\r\ncase SBE_2T3E3_ON:\r\nexar7300_set_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_ALL_ONES);\r\nbreak;\r\ncase SBE_2T3E3_OFF:\r\nexar7300_clear_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_ALL_ONES);\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nsc->p.transmit_all_ones = mode;\r\n}\r\nvoid exar7300_receive_equalization_onoff(struct channel *sc, u32 mode)\r\n{\r\nif (sc->p.receive_equalization == mode)\r\nreturn;\r\nswitch (mode) {\r\ncase SBE_2T3E3_OFF:\r\nexar7300_set_bit(sc, SBE_2T3E3_LIU_REG_REG2,\r\nSBE_2T3E3_LIU_VAL_RECEIVE_EQUALIZATION_DISABLE);\r\nbreak;\r\ncase SBE_2T3E3_ON:\r\nexar7300_clear_bit(sc, SBE_2T3E3_LIU_REG_REG2,\r\nSBE_2T3E3_LIU_VAL_RECEIVE_EQUALIZATION_DISABLE);\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nsc->p.receive_equalization = mode;\r\n}\r\nvoid exar7300_line_build_out_onoff(struct channel *sc, u32 mode)\r\n{\r\nif (sc->p.line_build_out == mode)\r\nreturn;\r\nswitch (mode) {\r\ncase SBE_2T3E3_OFF:\r\nexar7300_set_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_LEVEL_SELECT);\r\nexar7300_receive_equalization_onoff(sc, SBE_2T3E3_OFF);\r\nbreak;\r\ncase SBE_2T3E3_ON:\r\nexar7300_clear_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_LEVEL_SELECT);\r\nexar7300_receive_equalization_onoff(sc, SBE_2T3E3_ON);\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nsc->p.line_build_out = mode;\r\n}\r\nvoid exar7300_unipolar_onoff(struct channel *sc, u32 mode)\r\n{\r\nswitch (mode) {\r\ncase SBE_2T3E3_OFF:\r\nexar7300_clear_bit(sc, SBE_2T3E3_LIU_REG_REG3,\r\nSBE_2T3E3_LIU_VAL_DECODER_DISABLE);\r\nexar7300_clear_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_BINARY_DATA);\r\nbreak;\r\ncase SBE_2T3E3_ON:\r\nexar7300_set_bit(sc, SBE_2T3E3_LIU_REG_REG3,\r\nSBE_2T3E3_LIU_VAL_DECODER_DISABLE);\r\nexar7300_set_bit(sc, SBE_2T3E3_LIU_REG_REG1,\r\nSBE_2T3E3_LIU_VAL_TRANSMIT_BINARY_DATA);\r\nbreak;\r\n}\r\n}
