static int keywest_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\ni2c_set_clientdata(client, keywest_ctx);\r\nreturn 0;\r\n}\r\nstatic int keywest_attach_adapter(struct i2c_adapter *adapter)\r\n{\r\nstruct i2c_board_info info;\r\nif (! keywest_ctx)\r\nreturn -EINVAL;\r\nif (strncmp(adapter->name, "mac-io", 6))\r\nreturn 0;\r\nmemset(&info, 0, sizeof(struct i2c_board_info));\r\nstrlcpy(info.type, "keywest", I2C_NAME_SIZE);\r\ninfo.addr = keywest_ctx->addr;\r\nkeywest_ctx->client = i2c_new_device(adapter, &info);\r\nif (!keywest_ctx->client)\r\nreturn -ENODEV;\r\nif (!keywest_ctx->client->driver) {\r\ni2c_unregister_device(keywest_ctx->client);\r\nkeywest_ctx->client = NULL;\r\nreturn -ENODEV;\r\n}\r\nlist_add_tail(&keywest_ctx->client->detected,\r\n&keywest_ctx->client->driver->clients);\r\nreturn 0;\r\n}\r\nstatic int keywest_remove(struct i2c_client *client)\r\n{\r\ni2c_set_clientdata(client, NULL);\r\nif (! keywest_ctx)\r\nreturn 0;\r\nif (client == keywest_ctx->client)\r\nkeywest_ctx->client = NULL;\r\nreturn 0;\r\n}\r\nvoid snd_pmac_keywest_cleanup(struct pmac_keywest *i2c)\r\n{\r\nif (keywest_ctx && keywest_ctx == i2c) {\r\ni2c_del_driver(&keywest_driver);\r\nkeywest_ctx = NULL;\r\n}\r\n}\r\nint __devinit snd_pmac_tumbler_post_init(void)\r\n{\r\nint err;\r\nif (!keywest_ctx || !keywest_ctx->client)\r\nreturn -ENXIO;\r\nif ((err = keywest_ctx->init_client(keywest_ctx)) < 0) {\r\nsnd_printk(KERN_ERR "tumbler: %i :cannot initialize the MCS\n", err);\r\nreturn err;\r\n}\r\nreturn 0;\r\n}\r\nint __devinit snd_pmac_keywest_init(struct pmac_keywest *i2c)\r\n{\r\nint err;\r\nif (keywest_ctx)\r\nreturn -EBUSY;\r\nkeywest_ctx = i2c;\r\nif ((err = i2c_add_driver(&keywest_driver))) {\r\nsnd_printk(KERN_ERR "cannot register keywest i2c driver\n");\r\nreturn err;\r\n}\r\nreturn 0;\r\n}
