static void sclp_cpu_capability_notify(struct work_struct *work)\r\n{\r\nint cpu;\r\nstruct sys_device *sysdev;\r\ns390_adjust_jiffies();\r\npr_warning("cpu capability changed.\n");\r\nget_online_cpus();\r\nfor_each_online_cpu(cpu) {\r\nsysdev = get_cpu_sysdev(cpu);\r\nkobject_uevent(&sysdev->kobj, KOBJ_CHANGE);\r\n}\r\nput_online_cpus();\r\n}\r\nstatic void __ref sclp_cpu_change_notify(struct work_struct *work)\r\n{\r\nsmp_rescan_cpus();\r\n}\r\nstatic void sclp_conf_receiver_fn(struct evbuf_header *evbuf)\r\n{\r\nstruct conf_mgm_data *cdata;\r\ncdata = (struct conf_mgm_data *)(evbuf + 1);\r\nswitch (cdata->ev_qualifier) {\r\ncase EV_QUAL_CPU_CHANGE:\r\nschedule_work(&sclp_cpu_change_work);\r\nbreak;\r\ncase EV_QUAL_CAP_CHANGE:\r\nschedule_work(&sclp_cpu_capability_work);\r\nbreak;\r\n}\r\n}\r\nstatic int __init sclp_conf_init(void)\r\n{\r\nINIT_WORK(&sclp_cpu_capability_work, sclp_cpu_capability_notify);\r\nINIT_WORK(&sclp_cpu_change_work, sclp_cpu_change_notify);\r\nreturn sclp_register(&sclp_conf_register);\r\n}
