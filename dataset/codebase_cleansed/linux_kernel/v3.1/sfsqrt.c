unsigned int\r\nsgl_fsqrt(\r\nsgl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\nsgl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int src, result;\r\nregister int src_exponent;\r\nregister unsigned int newbit, sum;\r\nregister boolean guardbit = FALSE, even_exponent;\r\nsrc = *srcptr;\r\nif ((src_exponent = Sgl_exponent(src)) == SGL_INFINITY_EXPONENT) {\r\nif (Sgl_isone_signaling(src)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_set_quiet(src);\r\n}\r\nif (Sgl_iszero_sign(src) || Sgl_isnotzero_mantissa(src)) {\r\n*dstptr = src;\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nif (Sgl_iszero_exponentmantissa(src)) {\r\n*dstptr = src;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Sgl_isone_sign(src)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_makequietnan(src);\r\n*dstptr = src;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (src_exponent > 0) {\r\neven_exponent = Sgl_hidden(src);\r\nSgl_clear_signexponent_set_hidden(src);\r\n}\r\nelse {\r\nSgl_clear_signexponent(src);\r\nsrc_exponent++;\r\nSgl_normalize(src,src_exponent);\r\neven_exponent = src_exponent & 1;\r\n}\r\nif (even_exponent) {\r\nSgl_leftshiftby1(src);\r\n}\r\nSgl_setzero(result);\r\nnewbit = 1 << SGL_P;\r\nwhile (newbit && Sgl_isnotzero(src)) {\r\nSgl_addition(result,newbit,sum);\r\nif(sum <= Sgl_all(src)) {\r\nSgl_addition(result,(newbit<<1),result);\r\nSgl_subtract(src,sum,src);\r\n}\r\nSgl_rightshiftby1(newbit);\r\nSgl_leftshiftby1(src);\r\n}\r\nif (even_exponent) {\r\nSgl_rightshiftby1(result);\r\n}\r\nif (Sgl_isnotzero(src)) {\r\nif (!even_exponent && Sgl_islessthan(result,src))\r\nSgl_increment(result);\r\nguardbit = Sgl_lowmantissa(result);\r\nSgl_rightshiftby1(result);\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nSgl_increment(result);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit) {\r\nSgl_increment(result);\r\n}\r\nbreak;\r\n}\r\nif (Sgl_isone_hiddenoverflow(result)) src_exponent+=2;\r\nif (Is_inexacttrap_enabled()) {\r\nSgl_set_exponent(result,\r\n((src_exponent-SGL_BIAS)>>1)+SGL_BIAS);\r\n*dstptr = result;\r\nreturn(INEXACTEXCEPTION);\r\n}\r\nelse Set_inexactflag();\r\n}\r\nelse {\r\nSgl_rightshiftby1(result);\r\n}\r\nSgl_set_exponent(result,((src_exponent-SGL_BIAS)>>1)+SGL_BIAS);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}
