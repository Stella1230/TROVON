int viafb_ioctl_get_viafb_info(u_long arg)\r\n{\r\nstruct viafb_ioctl_info viainfo;\r\nmemset(&viainfo, 0, sizeof(struct viafb_ioctl_info));\r\nviainfo.viafb_id = VIAID;\r\nviainfo.vendor_id = PCI_VIA_VENDOR_ID;\r\nswitch (viaparinfo->chip_info->gfx_chip_name) {\r\ncase UNICHROME_CLE266:\r\nviainfo.device_id = UNICHROME_CLE266_DID;\r\nbreak;\r\ncase UNICHROME_K400:\r\nviainfo.device_id = UNICHROME_K400_DID;\r\nbreak;\r\ncase UNICHROME_K800:\r\nviainfo.device_id = UNICHROME_K800_DID;\r\nbreak;\r\ncase UNICHROME_PM800:\r\nviainfo.device_id = UNICHROME_PM800_DID;\r\nbreak;\r\ncase UNICHROME_CN700:\r\nviainfo.device_id = UNICHROME_CN700_DID;\r\nbreak;\r\ncase UNICHROME_CX700:\r\nviainfo.device_id = UNICHROME_CX700_DID;\r\nbreak;\r\ncase UNICHROME_K8M890:\r\nviainfo.device_id = UNICHROME_K8M890_DID;\r\nbreak;\r\ncase UNICHROME_P4M890:\r\nviainfo.device_id = UNICHROME_P4M890_DID;\r\nbreak;\r\ncase UNICHROME_P4M900:\r\nviainfo.device_id = UNICHROME_P4M900_DID;\r\nbreak;\r\n}\r\nviainfo.version = VERSION_MAJOR;\r\nviainfo.revision = VERSION_MINOR;\r\nif (copy_to_user((void __user *)arg, &viainfo, sizeof(viainfo)))\r\nreturn -EFAULT;\r\nreturn 0;\r\n}\r\nint viafb_ioctl_hotplug(int hres, int vres, int bpp)\r\n{\r\nint DVIsense, status = 0;\r\nDEBUG_MSG(KERN_INFO "viafb_ioctl_hotplug!!\n");\r\nif (viaparinfo->chip_info->tmds_chip_info.tmds_chip_name !=\r\nNON_TMDS_TRANSMITTER) {\r\nDVIsense = viafb_dvi_sense();\r\nif (DVIsense) {\r\nDEBUG_MSG(KERN_INFO "DVI Attached...\n");\r\nif (viafb_DeviceStatus != DVI_Device) {\r\nviafb_DVI_ON = 1;\r\nviafb_CRT_ON = 0;\r\nviafb_LCD_ON = 0;\r\nviafb_DeviceStatus = DVI_Device;\r\nviafb_set_iga_path();\r\nreturn viafb_DeviceStatus;\r\n}\r\nstatus = 1;\r\n} else\r\nDEBUG_MSG(KERN_INFO "DVI De-attached...\n");\r\n}\r\nif ((viafb_DeviceStatus != CRT_Device) && (status == 0)) {\r\nviafb_CRT_ON = 1;\r\nviafb_DVI_ON = 0;\r\nviafb_LCD_ON = 0;\r\nviafb_DeviceStatus = CRT_Device;\r\nviafb_set_iga_path();\r\nreturn viafb_DeviceStatus;\r\n}\r\nreturn 0;\r\n}
