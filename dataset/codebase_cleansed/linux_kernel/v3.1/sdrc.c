void omap2_sms_save_context(void)\r\n{\r\nsms_context.sms_sysconfig = sms_read_reg(SMS_SYSCONFIG);\r\n}\r\nvoid omap2_sms_restore_context(void)\r\n{\r\nsms_write_reg(sms_context.sms_sysconfig, SMS_SYSCONFIG);\r\n}\r\nint omap2_sdrc_get_params(unsigned long r,\r\nstruct omap_sdrc_params **sdrc_cs0,\r\nstruct omap_sdrc_params **sdrc_cs1)\r\n{\r\nstruct omap_sdrc_params *sp0, *sp1;\r\nif (!sdrc_init_params_cs0)\r\nreturn -1;\r\nsp0 = sdrc_init_params_cs0;\r\nsp1 = sdrc_init_params_cs1;\r\nwhile (sp0->rate && sp0->rate != r) {\r\nsp0++;\r\nif (sdrc_init_params_cs1)\r\nsp1++;\r\n}\r\nif (!sp0->rate)\r\nreturn -1;\r\n*sdrc_cs0 = sp0;\r\n*sdrc_cs1 = sp1;\r\nreturn 0;\r\n}\r\nvoid __init omap2_set_globals_sdrc(struct omap_globals *omap2_globals)\r\n{\r\nif (omap2_globals->sdrc) {\r\nomap2_sdrc_base = ioremap(omap2_globals->sdrc, SZ_64K);\r\nWARN_ON(!omap2_sdrc_base);\r\n}\r\nif (omap2_globals->sms) {\r\nomap2_sms_base = ioremap(omap2_globals->sms, SZ_64K);\r\nWARN_ON(!omap2_sms_base);\r\n}\r\n}\r\nvoid __init omap2_sdrc_init(struct omap_sdrc_params *sdrc_cs0,\r\nstruct omap_sdrc_params *sdrc_cs1)\r\n{\r\nu32 l;\r\nl = sms_read_reg(SMS_SYSCONFIG);\r\nl &= ~(0x3 << 3);\r\nl |= (0x2 << 3);\r\nsms_write_reg(l, SMS_SYSCONFIG);\r\nl = sdrc_read_reg(SDRC_SYSCONFIG);\r\nl &= ~(0x3 << 3);\r\nl |= (0x2 << 3);\r\nsdrc_write_reg(l, SDRC_SYSCONFIG);\r\nsdrc_init_params_cs0 = sdrc_cs0;\r\nsdrc_init_params_cs1 = sdrc_cs1;\r\nl = (1 << SDRC_POWER_EXTCLKDIS_SHIFT) |\r\n(1 << SDRC_POWER_PAGEPOLICY_SHIFT);\r\nsdrc_write_reg(l, SDRC_POWER);\r\nomap2_sms_save_context();\r\n}\r\nvoid omap2_sms_write_rot_control(u32 val, unsigned ctx)\r\n{\r\nsms_write_reg(val, SMS_ROT_CONTROL(ctx));\r\n}\r\nvoid omap2_sms_write_rot_size(u32 val, unsigned ctx)\r\n{\r\nsms_write_reg(val, SMS_ROT_SIZE(ctx));\r\n}\r\nvoid omap2_sms_write_rot_physical_ba(u32 val, unsigned ctx)\r\n{\r\nsms_write_reg(val, SMS_ROT_PHYSICAL_BA(ctx));\r\n}
