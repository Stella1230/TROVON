acpi_status acpi_ev_initialize_events(void)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ev_initialize_events);\r\nstatus = acpi_ev_fixed_event_initialize();\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Unable to initialize fixed events"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_ev_gpe_initialize();\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Unable to initialize general purpose events"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ev_install_xrupt_handlers(void)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ev_install_xrupt_handlers);\r\nstatus = acpi_ev_install_sci_handler();\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Unable to install System Control Interrupt handler"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_ev_init_global_lock_handler();\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Unable to initialize Global Lock handler"));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_gbl_events_initialized = TRUE;\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatic acpi_status acpi_ev_fixed_event_initialize(void)\r\n{\r\nu32 i;\r\nacpi_status status;\r\nfor (i = 0; i < ACPI_NUM_FIXED_EVENTS; i++) {\r\nacpi_gbl_fixed_event_handlers[i].handler = NULL;\r\nacpi_gbl_fixed_event_handlers[i].context = NULL;\r\nif (acpi_gbl_fixed_event_info[i].enable_register_id != 0xFF) {\r\nstatus =\r\nacpi_write_bit_register(acpi_gbl_fixed_event_info\r\n[i].enable_register_id,\r\nACPI_DISABLE_EVENT);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\n}\r\nreturn (AE_OK);\r\n}\r\nu32 acpi_ev_fixed_event_detect(void)\r\n{\r\nu32 int_status = ACPI_INTERRUPT_NOT_HANDLED;\r\nu32 fixed_status;\r\nu32 fixed_enable;\r\nu32 i;\r\nACPI_FUNCTION_NAME(ev_fixed_event_detect);\r\n(void)acpi_hw_register_read(ACPI_REGISTER_PM1_STATUS, &fixed_status);\r\n(void)acpi_hw_register_read(ACPI_REGISTER_PM1_ENABLE, &fixed_enable);\r\nACPI_DEBUG_PRINT((ACPI_DB_INTERRUPTS,\r\n"Fixed Event Block: Enable %08X Status %08X\n",\r\nfixed_enable, fixed_status));\r\nfor (i = 0; i < ACPI_NUM_FIXED_EVENTS; i++) {\r\nif ((fixed_status & acpi_gbl_fixed_event_info[i].\r\nstatus_bit_mask)\r\n&& (fixed_enable & acpi_gbl_fixed_event_info[i].\r\nenable_bit_mask)) {\r\nacpi_fixed_event_count[i]++;\r\nif (acpi_gbl_global_event_handler) {\r\nacpi_gbl_global_event_handler\r\n(ACPI_EVENT_TYPE_FIXED, NULL, i,\r\nacpi_gbl_global_event_handler_context);\r\n}\r\nint_status |= acpi_ev_fixed_event_dispatch(i);\r\n}\r\n}\r\nreturn (int_status);\r\n}\r\nstatic u32 acpi_ev_fixed_event_dispatch(u32 event)\r\n{\r\nACPI_FUNCTION_ENTRY();\r\n(void)acpi_write_bit_register(acpi_gbl_fixed_event_info[event].\r\nstatus_register_id, ACPI_CLEAR_STATUS);\r\nif (NULL == acpi_gbl_fixed_event_handlers[event].handler) {\r\n(void)acpi_write_bit_register(acpi_gbl_fixed_event_info[event].\r\nenable_register_id,\r\nACPI_DISABLE_EVENT);\r\nACPI_ERROR((AE_INFO,\r\n"No installed handler for fixed event [0x%08X]",\r\nevent));\r\nreturn (ACPI_INTERRUPT_NOT_HANDLED);\r\n}\r\nreturn ((acpi_gbl_fixed_event_handlers[event].\r\nhandler) (acpi_gbl_fixed_event_handlers[event].context));\r\n}
