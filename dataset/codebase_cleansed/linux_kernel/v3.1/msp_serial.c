void __init msp_serial_setup(void)\r\n{\r\nchar *s;\r\nchar *endp;\r\nstruct uart_port up;\r\nunsigned int uartclk;\r\nmemset(&up, 0, sizeof(up));\r\ns = prom_getenv("uartfreqhz");\r\nif(!(s && *s && (uartclk = simple_strtoul(s, &endp, 10)) && *endp == 0))\r\nuartclk = MSP_BASE_BAUD;\r\nppfinit("UART clock set to %d\n", uartclk);\r\nup.mapbase = MSP_UART0_BASE;\r\nup.membase = ioremap_nocache(up.mapbase, MSP_UART_REG_LEN);\r\nup.irq = MSP_INT_UART0;\r\nup.uartclk = uartclk;\r\nup.regshift = 2;\r\nup.iotype = UPIO_DWAPB;\r\nup.flags = ASYNC_BOOT_AUTOCONF | ASYNC_SKIP_TEST;\r\nup.type = PORT_16550A;\r\nup.line = 0;\r\nup.private_data = (void*)UART0_STATUS_REG;\r\nif (early_serial_setup(&up))\r\nprintk(KERN_ERR "Early serial init of port 0 failed\n");\r\nswitch (mips_machtype) {\r\ncase MACH_MSP4200_EVAL:\r\ncase MACH_MSP4200_GW:\r\ncase MACH_MSP4200_FPGA:\r\ncase MACH_MSP7120_EVAL:\r\ncase MACH_MSP7120_GW:\r\ncase MACH_MSP7120_FPGA:\r\n*GPIO_CFG2_REG = 0x00002299;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nup.mapbase = MSP_UART1_BASE;\r\nup.membase = ioremap_nocache(up.mapbase, MSP_UART_REG_LEN);\r\nup.irq = MSP_INT_UART1;\r\nup.line = 1;\r\nup.private_data = (void*)UART1_STATUS_REG;\r\nif (early_serial_setup(&up))\r\nprintk(KERN_ERR "Early serial init of port 1 failed\n");\r\n}
