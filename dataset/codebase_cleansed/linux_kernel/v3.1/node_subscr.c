void tipc_nodesub_subscribe(struct tipc_node_subscr *node_sub, u32 addr,\r\nvoid *usr_handle, net_ev_handler handle_down)\r\n{\r\nif (addr == tipc_own_addr) {\r\nnode_sub->node = NULL;\r\nreturn;\r\n}\r\nnode_sub->node = tipc_node_find(addr);\r\nif (!node_sub->node) {\r\nwarn("Node subscription rejected, unknown node 0x%x\n", addr);\r\nreturn;\r\n}\r\nnode_sub->handle_node_down = handle_down;\r\nnode_sub->usr_handle = usr_handle;\r\ntipc_node_lock(node_sub->node);\r\nlist_add_tail(&node_sub->nodesub_list, &node_sub->node->nsub);\r\ntipc_node_unlock(node_sub->node);\r\n}\r\nvoid tipc_nodesub_unsubscribe(struct tipc_node_subscr *node_sub)\r\n{\r\nif (!node_sub->node)\r\nreturn;\r\ntipc_node_lock(node_sub->node);\r\nlist_del_init(&node_sub->nodesub_list);\r\ntipc_node_unlock(node_sub->node);\r\n}\r\nvoid tipc_nodesub_notify(struct tipc_node *node)\r\n{\r\nstruct tipc_node_subscr *ns;\r\nlist_for_each_entry(ns, &node->nsub, nodesub_list) {\r\nif (ns->handle_node_down) {\r\ntipc_k_signal((Handler)ns->handle_node_down,\r\n(unsigned long)ns->usr_handle);\r\nns->handle_node_down = NULL;\r\n}\r\n}\r\n}
