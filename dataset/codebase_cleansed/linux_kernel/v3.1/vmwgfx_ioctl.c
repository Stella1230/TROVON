int vmw_getparam_ioctl(struct drm_device *dev, void *data,\r\nstruct drm_file *file_priv)\r\n{\r\nstruct vmw_private *dev_priv = vmw_priv(dev);\r\nstruct drm_vmw_getparam_arg *param =\r\n(struct drm_vmw_getparam_arg *)data;\r\nswitch (param->param) {\r\ncase DRM_VMW_PARAM_NUM_STREAMS:\r\nparam->value = vmw_overlay_num_overlays(dev_priv);\r\nbreak;\r\ncase DRM_VMW_PARAM_NUM_FREE_STREAMS:\r\nparam->value = vmw_overlay_num_free_overlays(dev_priv);\r\nbreak;\r\ncase DRM_VMW_PARAM_3D:\r\nparam->value = vmw_fifo_have_3d(dev_priv) ? 1 : 0;\r\nbreak;\r\ncase DRM_VMW_PARAM_FIFO_OFFSET:\r\nparam->value = dev_priv->mmio_start;\r\nbreak;\r\ncase DRM_VMW_PARAM_HW_CAPS:\r\nparam->value = dev_priv->capabilities;\r\nbreak;\r\ncase DRM_VMW_PARAM_FIFO_CAPS:\r\nparam->value = dev_priv->fifo.capabilities;\r\nbreak;\r\ncase DRM_VMW_PARAM_MAX_FB_SIZE:\r\nparam->value = dev_priv->vram_size;\r\nbreak;\r\ndefault:\r\nDRM_ERROR("Illegal vmwgfx get param request: %d\n",\r\nparam->param);\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nint vmw_fifo_debug_ioctl(struct drm_device *dev, void *data,\r\nstruct drm_file *file_priv)\r\n{\r\nstruct vmw_private *dev_priv = vmw_priv(dev);\r\nstruct vmw_fifo_state *fifo_state = &dev_priv->fifo;\r\nstruct drm_vmw_fifo_debug_arg *arg =\r\n(struct drm_vmw_fifo_debug_arg *)data;\r\n__le32 __user *buffer = (__le32 __user *)\r\n(unsigned long)arg->debug_buffer;\r\nif (unlikely(fifo_state->last_buffer == NULL))\r\nreturn -EINVAL;\r\nif (arg->debug_buffer_size < fifo_state->last_data_size) {\r\narg->used_size = arg->debug_buffer_size;\r\narg->did_not_fit = 1;\r\n} else {\r\narg->used_size = fifo_state->last_data_size;\r\narg->did_not_fit = 0;\r\n}\r\nreturn copy_to_user(buffer, fifo_state->last_buffer, arg->used_size);\r\n}
