acpi_status\r\nacpi_ut_execute_HID(struct acpi_namespace_node *device_node,\r\nstruct acpica_device_id **return_id)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nstruct acpica_device_id *hid;\r\nu32 length;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_execute_HID);\r\nstatus = acpi_ut_evaluate_object(device_node, METHOD_NAME__HID,\r\nACPI_BTYPE_INTEGER | ACPI_BTYPE_STRING,\r\n&obj_desc);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (obj_desc->common.type == ACPI_TYPE_INTEGER) {\r\nlength = ACPI_EISAID_STRING_SIZE;\r\n} else {\r\nlength = obj_desc->string.length + 1;\r\n}\r\nhid =\r\nACPI_ALLOCATE_ZEROED(sizeof(struct acpica_device_id) +\r\n(acpi_size) length);\r\nif (!hid) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nhid->string = ACPI_ADD_PTR(char, hid, sizeof(struct acpica_device_id));\r\nif (obj_desc->common.type == ACPI_TYPE_INTEGER) {\r\nacpi_ex_eisa_id_to_string(hid->string, obj_desc->integer.value);\r\n} else {\r\nACPI_STRCPY(hid->string, obj_desc->string.pointer);\r\n}\r\nhid->length = length;\r\n*return_id = hid;\r\ncleanup:\r\nacpi_ut_remove_reference(obj_desc);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ut_execute_UID(struct acpi_namespace_node *device_node,\r\nstruct acpica_device_id **return_id)\r\n{\r\nunion acpi_operand_object *obj_desc;\r\nstruct acpica_device_id *uid;\r\nu32 length;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_execute_UID);\r\nstatus = acpi_ut_evaluate_object(device_node, METHOD_NAME__UID,\r\nACPI_BTYPE_INTEGER | ACPI_BTYPE_STRING,\r\n&obj_desc);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (obj_desc->common.type == ACPI_TYPE_INTEGER) {\r\nlength = ACPI_MAX64_DECIMAL_DIGITS + 1;\r\n} else {\r\nlength = obj_desc->string.length + 1;\r\n}\r\nuid =\r\nACPI_ALLOCATE_ZEROED(sizeof(struct acpica_device_id) +\r\n(acpi_size) length);\r\nif (!uid) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nuid->string = ACPI_ADD_PTR(char, uid, sizeof(struct acpica_device_id));\r\nif (obj_desc->common.type == ACPI_TYPE_INTEGER) {\r\nacpi_ex_integer_to_string(uid->string, obj_desc->integer.value);\r\n} else {\r\nACPI_STRCPY(uid->string, obj_desc->string.pointer);\r\n}\r\nuid->length = length;\r\n*return_id = uid;\r\ncleanup:\r\nacpi_ut_remove_reference(obj_desc);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ut_execute_CID(struct acpi_namespace_node *device_node,\r\nstruct acpica_device_id_list **return_cid_list)\r\n{\r\nunion acpi_operand_object **cid_objects;\r\nunion acpi_operand_object *obj_desc;\r\nstruct acpica_device_id_list *cid_list;\r\nchar *next_id_string;\r\nu32 string_area_size;\r\nu32 length;\r\nu32 cid_list_size;\r\nacpi_status status;\r\nu32 count;\r\nu32 i;\r\nACPI_FUNCTION_TRACE(ut_execute_CID);\r\nstatus = acpi_ut_evaluate_object(device_node, METHOD_NAME__CID,\r\nACPI_BTYPE_INTEGER | ACPI_BTYPE_STRING\r\n| ACPI_BTYPE_PACKAGE, &obj_desc);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (obj_desc->common.type == ACPI_TYPE_PACKAGE) {\r\ncount = obj_desc->package.count;\r\ncid_objects = obj_desc->package.elements;\r\n} else {\r\ncount = 1;\r\ncid_objects = &obj_desc;\r\n}\r\nstring_area_size = 0;\r\nfor (i = 0; i < count; i++) {\r\nswitch (cid_objects[i]->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nstring_area_size += ACPI_EISAID_STRING_SIZE;\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nstring_area_size += cid_objects[i]->string.length + 1;\r\nbreak;\r\ndefault:\r\nstatus = AE_TYPE;\r\ngoto cleanup;\r\n}\r\n}\r\ncid_list_size = sizeof(struct acpica_device_id_list) +\r\n((count - 1) * sizeof(struct acpica_device_id)) + string_area_size;\r\ncid_list = ACPI_ALLOCATE_ZEROED(cid_list_size);\r\nif (!cid_list) {\r\nstatus = AE_NO_MEMORY;\r\ngoto cleanup;\r\n}\r\nnext_id_string = ACPI_CAST_PTR(char, cid_list->ids) +\r\n((acpi_size) count * sizeof(struct acpica_device_id));\r\nfor (i = 0; i < count; i++) {\r\nif (cid_objects[i]->common.type == ACPI_TYPE_INTEGER) {\r\nacpi_ex_eisa_id_to_string(next_id_string,\r\ncid_objects[i]->integer.\r\nvalue);\r\nlength = ACPI_EISAID_STRING_SIZE;\r\n} else {\r\nACPI_STRCPY(next_id_string,\r\ncid_objects[i]->string.pointer);\r\nlength = cid_objects[i]->string.length + 1;\r\n}\r\ncid_list->ids[i].string = next_id_string;\r\ncid_list->ids[i].length = length;\r\nnext_id_string += length;\r\n}\r\ncid_list->count = count;\r\ncid_list->list_size = cid_list_size;\r\n*return_cid_list = cid_list;\r\ncleanup:\r\nacpi_ut_remove_reference(obj_desc);\r\nreturn_ACPI_STATUS(status);\r\n}
