INT SearchSfid(PMINI_ADAPTER Adapter,UINT uiSfid)\r\n{\r\nINT iIndex=0;\r\nfor(iIndex=(NO_OF_QUEUES-1); iIndex>=0; iIndex--)\r\nif(Adapter->PackInfo[iIndex].ulSFID==uiSfid)\r\nreturn iIndex;\r\nreturn NO_OF_QUEUES+1;\r\n}\r\nstatic INT SearchFreeSfid(PMINI_ADAPTER Adapter)\r\n{\r\nUINT uiIndex=0;\r\nfor(uiIndex=0; uiIndex < (NO_OF_QUEUES-1); uiIndex++)\r\nif(Adapter->PackInfo[uiIndex].ulSFID==0)\r\nreturn uiIndex;\r\nreturn NO_OF_QUEUES+1;\r\n}\r\nstatic int SearchClsid(PMINI_ADAPTER Adapter,ULONG ulSFID,B_UINT16 uiClassifierID)\r\n{\r\nunsigned int uiClassifierIndex = 0;\r\nfor(uiClassifierIndex=0;uiClassifierIndex<MAX_CLASSIFIERS;uiClassifierIndex++)\r\n{\r\nif((Adapter->astClassifierTable[uiClassifierIndex].bUsed) &&\r\n(Adapter->astClassifierTable[uiClassifierIndex].uiClassifierRuleIndex == uiClassifierID)&&\r\n(Adapter->astClassifierTable[uiClassifierIndex].ulSFID == ulSFID))\r\nreturn uiClassifierIndex;\r\n}\r\nreturn MAX_CLASSIFIERS+1;\r\n}\r\nstatic int SearchFreeClsid(PMINI_ADAPTER Adapter\r\n)\r\n{\r\nunsigned int uiClassifierIndex = 0;\r\nfor(uiClassifierIndex=0;uiClassifierIndex<MAX_CLASSIFIERS;uiClassifierIndex++)\r\n{\r\nif(!Adapter->astClassifierTable[uiClassifierIndex].bUsed)\r\nreturn uiClassifierIndex;\r\n}\r\nreturn MAX_CLASSIFIERS+1;\r\n}\r\nstatic VOID deleteSFBySfid(PMINI_ADAPTER Adapter, UINT uiSearchRuleIndex)\r\n{\r\nflush_queue(Adapter,uiSearchRuleIndex);\r\nDeleteAllClassifiersForSF(Adapter,uiSearchRuleIndex);\r\nmemset((PVOID)&Adapter->PackInfo[uiSearchRuleIndex], 0, sizeof(S_MIBS_SERVICEFLOW_TABLE));\r\n}\r\nstatic inline VOID\r\nCopyIpAddrToClassifier(S_CLASSIFIER_RULE *pstClassifierEntry ,\r\nB_UINT8 u8IpAddressLen , B_UINT8 *pu8IpAddressMaskSrc ,\r\nBOOLEAN bIpVersion6 , E_IPADDR_CONTEXT eIpAddrContext)\r\n{\r\nUINT ucLoopIndex=0;\r\nUINT nSizeOfIPAddressInBytes = IP_LENGTH_OF_ADDRESS;\r\nUCHAR *ptrClassifierIpAddress = NULL;\r\nUCHAR *ptrClassifierIpMask = NULL;\r\nPMINI_ADAPTER Adapter = GET_BCM_ADAPTER(gblpnetdev);\r\nif(bIpVersion6)\r\n{\r\nnSizeOfIPAddressInBytes = IPV6_ADDRESS_SIZEINBYTES;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Ip Address Range Length:0x%X ",\r\nu8IpAddressLen);\r\nif((bIpVersion6?(IPV6_ADDRESS_SIZEINBYTES * MAX_IP_RANGE_LENGTH * 2):\r\n(TOTAL_MASKED_ADDRESS_IN_BYTES)) >= u8IpAddressLen)\r\n{\r\nif(eIpAddrContext == eDestIpAddress)\r\n{\r\npstClassifierEntry->ucIPDestinationAddressLength =\r\nu8IpAddressLen/(nSizeOfIPAddressInBytes * 2);\r\nif(bIpVersion6)\r\n{\r\nptrClassifierIpAddress =\r\npstClassifierEntry->stDestIpAddress.ucIpv6Address;\r\nptrClassifierIpMask =\r\npstClassifierEntry->stDestIpAddress.ucIpv6Mask;\r\n}\r\nelse\r\n{\r\nptrClassifierIpAddress =\r\npstClassifierEntry->stDestIpAddress.ucIpv4Address;\r\nptrClassifierIpMask =\r\npstClassifierEntry->stDestIpAddress.ucIpv4Mask;\r\n}\r\n}\r\nelse if(eIpAddrContext == eSrcIpAddress)\r\n{\r\npstClassifierEntry->ucIPSourceAddressLength =\r\nu8IpAddressLen/(nSizeOfIPAddressInBytes * 2);\r\nif(bIpVersion6)\r\n{\r\nptrClassifierIpAddress =\r\npstClassifierEntry->stSrcIpAddress.ucIpv6Address;\r\nptrClassifierIpMask =\r\npstClassifierEntry->stSrcIpAddress.ucIpv6Mask;\r\n}\r\nelse\r\n{\r\nptrClassifierIpAddress =\r\npstClassifierEntry->stSrcIpAddress.ucIpv4Address;\r\nptrClassifierIpMask =\r\npstClassifierEntry->stSrcIpAddress.ucIpv4Mask;\r\n}\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Address Length:0x%X \n",\r\npstClassifierEntry->ucIPDestinationAddressLength);\r\nwhile((u8IpAddressLen>= nSizeOfIPAddressInBytes) &&\r\n(ucLoopIndex < MAX_IP_RANGE_LENGTH))\r\n{\r\nmemcpy(ptrClassifierIpAddress +\r\n(ucLoopIndex * nSizeOfIPAddressInBytes),\r\n(pu8IpAddressMaskSrc+(ucLoopIndex*nSizeOfIPAddressInBytes*2)),\r\nnSizeOfIPAddressInBytes);\r\nif(!bIpVersion6)\r\n{\r\nif(eIpAddrContext == eSrcIpAddress)\r\n{\r\npstClassifierEntry->stSrcIpAddress.ulIpv4Addr[ucLoopIndex]=\r\nntohl(pstClassifierEntry->stSrcIpAddress.\r\nulIpv4Addr[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Src Ip Address:0x%luX ",pstClassifierEntry->stSrcIpAddress.ulIpv4Addr[ucLoopIndex]);\r\n}\r\nelse if(eIpAddrContext == eDestIpAddress)\r\n{\r\npstClassifierEntry->stDestIpAddress.ulIpv4Addr[ucLoopIndex]= ntohl(pstClassifierEntry->stDestIpAddress.\r\nulIpv4Addr[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Dest Ip Address:0x%luX ",pstClassifierEntry->stDestIpAddress.ulIpv4Addr[ucLoopIndex]);\r\n}\r\n}\r\nu8IpAddressLen-=nSizeOfIPAddressInBytes;\r\nif(u8IpAddressLen >= nSizeOfIPAddressInBytes)\r\n{\r\nmemcpy(ptrClassifierIpMask +\r\n(ucLoopIndex * nSizeOfIPAddressInBytes),\r\n(pu8IpAddressMaskSrc+nSizeOfIPAddressInBytes +\r\n(ucLoopIndex*nSizeOfIPAddressInBytes*2)),\r\nnSizeOfIPAddressInBytes);\r\nif(!bIpVersion6)\r\n{\r\nif(eIpAddrContext == eSrcIpAddress)\r\n{\r\npstClassifierEntry->stSrcIpAddress.\r\nulIpv4Mask[ucLoopIndex]=\r\nntohl(pstClassifierEntry->stSrcIpAddress.\r\nulIpv4Mask[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Src Ip Mask Address:0x%luX ",pstClassifierEntry->stSrcIpAddress.ulIpv4Mask[ucLoopIndex]);\r\n}\r\nelse if(eIpAddrContext == eDestIpAddress)\r\n{\r\npstClassifierEntry->stDestIpAddress.\r\nulIpv4Mask[ucLoopIndex] =\r\nntohl(pstClassifierEntry->stDestIpAddress.\r\nulIpv4Mask[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Dest Ip Mask Address:0x%luX ",pstClassifierEntry->stDestIpAddress.ulIpv4Mask[ucLoopIndex]);\r\n}\r\n}\r\nu8IpAddressLen-=nSizeOfIPAddressInBytes;\r\n}\r\nif(0==u8IpAddressLen)\r\n{\r\npstClassifierEntry->bDestIpValid=TRUE;\r\n}\r\nucLoopIndex++;\r\n}\r\nif(bIpVersion6)\r\n{\r\nfor(ucLoopIndex =0 ; ucLoopIndex < MAX_IP_RANGE_LENGTH * 4 ;\r\nucLoopIndex++)\r\n{\r\nif(eIpAddrContext == eSrcIpAddress)\r\n{\r\npstClassifierEntry->stSrcIpAddress.ulIpv6Addr[ucLoopIndex]=\r\nntohl(pstClassifierEntry->stSrcIpAddress.\r\nulIpv6Addr[ucLoopIndex]);\r\npstClassifierEntry->stSrcIpAddress.ulIpv6Mask[ucLoopIndex]= ntohl(pstClassifierEntry->stSrcIpAddress.\r\nulIpv6Mask[ucLoopIndex]);\r\n}\r\nelse if(eIpAddrContext == eDestIpAddress)\r\n{\r\npstClassifierEntry->stDestIpAddress.ulIpv6Addr[ucLoopIndex]= ntohl(pstClassifierEntry->stDestIpAddress.\r\nulIpv6Addr[ucLoopIndex]);\r\npstClassifierEntry->stDestIpAddress.ulIpv6Mask[ucLoopIndex]= ntohl(pstClassifierEntry->stDestIpAddress.\r\nulIpv6Mask[ucLoopIndex]);\r\n}\r\n}\r\n}\r\n}\r\n}\r\nvoid ClearTargetDSXBuffer(PMINI_ADAPTER Adapter,B_UINT16 TID,BOOLEAN bFreeAll)\r\n{\r\nULONG ulIndex;\r\nfor(ulIndex=0; ulIndex < Adapter->ulTotalTargetBuffersAvailable; ulIndex++)\r\n{\r\nif(Adapter->astTargetDsxBuffer[ulIndex].valid)\r\ncontinue;\r\nif ((bFreeAll) || (Adapter->astTargetDsxBuffer[ulIndex].tid == TID)){\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "ClearTargetDSXBuffer: found tid %d buffer cleared %lx\n",\r\nTID, Adapter->astTargetDsxBuffer[ulIndex].ulTargetDsxBuffer);\r\nAdapter->astTargetDsxBuffer[ulIndex].valid=1;\r\nAdapter->astTargetDsxBuffer[ulIndex].tid=0;\r\nAdapter->ulFreeTargetBufferCnt++;\r\n}\r\n}\r\n}\r\nstatic inline VOID CopyClassifierRuleToSF(PMINI_ADAPTER Adapter,stConvergenceSLTypes *psfCSType,UINT uiSearchRuleIndex,UINT nClassifierIndex)\r\n{\r\nS_CLASSIFIER_RULE *pstClassifierEntry = NULL;\r\nUINT ucLoopIndex=0;\r\nif(Adapter->PackInfo[uiSearchRuleIndex].usVCID_Value == 0 ||\r\nnClassifierIndex > (MAX_CLASSIFIERS-1))\r\nreturn;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Storing Classifier Rule Index : %X",ntohs(psfCSType->cCPacketClassificationRule.u16PacketClassificationRuleIndex));\r\nif(nClassifierIndex > MAX_CLASSIFIERS-1)\r\nreturn;\r\npstClassifierEntry = &Adapter->astClassifierTable[nClassifierIndex];\r\nif(pstClassifierEntry)\r\n{\r\npstClassifierEntry->bIpv6Protocol =\r\n(Adapter->PackInfo[uiSearchRuleIndex].ucIpVersion == IPV6)?TRUE:FALSE;\r\npstClassifierEntry->ucDestPortRangeLength=psfCSType->cCPacketClassificationRule.u8ProtocolDestPortRangeLength/4;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Destination Port Range Length:0x%X ",pstClassifierEntry->ucDestPortRangeLength);\r\nif( MAX_PORT_RANGE >= psfCSType->cCPacketClassificationRule.u8ProtocolDestPortRangeLength)\r\n{\r\nfor(ucLoopIndex=0;ucLoopIndex<(pstClassifierEntry->ucDestPortRangeLength);ucLoopIndex++)\r\n{\r\npstClassifierEntry->usDestPortRangeLo[ucLoopIndex] =\r\n*((PUSHORT)(psfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange+ucLoopIndex));\r\npstClassifierEntry->usDestPortRangeHi[ucLoopIndex] =\r\n*((PUSHORT)(psfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange+2+ucLoopIndex));\r\npstClassifierEntry->usDestPortRangeLo[ucLoopIndex]=ntohs(pstClassifierEntry->usDestPortRangeLo[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Destination Port Range Lo:0x%X ",pstClassifierEntry->usDestPortRangeLo[ucLoopIndex]);\r\npstClassifierEntry->usDestPortRangeHi[ucLoopIndex]=ntohs(pstClassifierEntry->usDestPortRangeHi[ucLoopIndex]);\r\n}\r\n}\r\nelse\r\n{\r\npstClassifierEntry->ucDestPortRangeLength=0;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Source Port Range Length:0x%X ",psfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRangeLength);\r\nif(MAX_PORT_RANGE >=\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRangeLength)\r\n{\r\npstClassifierEntry->ucSrcPortRangeLength =\r\npsfCSType->cCPacketClassificationRule.\r\nu8ProtocolSourcePortRangeLength/4;\r\nfor(ucLoopIndex = 0; ucLoopIndex <\r\n(pstClassifierEntry->ucSrcPortRangeLength); ucLoopIndex++)\r\n{\r\npstClassifierEntry->usSrcPortRangeLo[ucLoopIndex] =\r\n*((PUSHORT)(psfCSType->cCPacketClassificationRule.\r\nu8ProtocolSourcePortRange+ucLoopIndex));\r\npstClassifierEntry->usSrcPortRangeHi[ucLoopIndex] =\r\n*((PUSHORT)(psfCSType->cCPacketClassificationRule.\r\nu8ProtocolSourcePortRange+2+ucLoopIndex));\r\npstClassifierEntry->usSrcPortRangeLo[ucLoopIndex] =\r\nntohs(pstClassifierEntry->usSrcPortRangeLo[ucLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Source Port Range Lo:0x%X ",pstClassifierEntry->usSrcPortRangeLo[ucLoopIndex]);\r\npstClassifierEntry->usSrcPortRangeHi[ucLoopIndex]=ntohs(pstClassifierEntry->usSrcPortRangeHi[ucLoopIndex]);\r\n}\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Ip Destination Parameters : ");\r\nCopyIpAddrToClassifier(pstClassifierEntry,\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddressLength,\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddress,\r\n(Adapter->PackInfo[uiSearchRuleIndex].ucIpVersion == IPV6)?\r\nTRUE:FALSE, eDestIpAddress);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Ip Source Parameters : ");\r\nCopyIpAddrToClassifier(pstClassifierEntry,\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddressLength,\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddress,\r\n(Adapter->PackInfo[uiSearchRuleIndex].ucIpVersion == IPV6)?TRUE:FALSE,\r\neSrcIpAddress);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"TOS Length:0x%X ",psfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength);\r\nif(3 == psfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength)\r\n{\r\npstClassifierEntry->ucIPTypeOfServiceLength =\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength;\r\npstClassifierEntry->ucTosLow =\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[0];\r\npstClassifierEntry->ucTosHigh =\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[1];\r\npstClassifierEntry->ucTosMask =\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[2];\r\npstClassifierEntry->bTOSValid = TRUE;\r\n}\r\nif(psfCSType->cCPacketClassificationRule.u8Protocol == 0)\r\n{\r\npstClassifierEntry->ucProtocolLength=0;\r\n}\r\nelse\r\n{\r\npstClassifierEntry->ucProtocolLength=1;\r\n}\r\npstClassifierEntry->ucProtocol[0] =\r\npsfCSType->cCPacketClassificationRule.u8Protocol;\r\npstClassifierEntry->u8ClassifierRulePriority =\r\npsfCSType->cCPacketClassificationRule.u8ClassifierRulePriority;\r\npstClassifierEntry->ucDirection =\r\nAdapter->PackInfo[uiSearchRuleIndex].ucDirection;\r\npstClassifierEntry->uiClassifierRuleIndex = ntohs(psfCSType->\r\ncCPacketClassificationRule.u16PacketClassificationRuleIndex);\r\npstClassifierEntry->usVCID_Value =\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value;\r\npstClassifierEntry->ulSFID =\r\nAdapter->PackInfo[uiSearchRuleIndex].ulSFID;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Search Index %d Dir: %d, Index: %d, Vcid: %d\n",\r\nuiSearchRuleIndex, pstClassifierEntry->ucDirection,\r\npstClassifierEntry->uiClassifierRuleIndex,\r\npstClassifierEntry->usVCID_Value);\r\nif(psfCSType->cCPacketClassificationRule.u8AssociatedPHSI)\r\n{\r\npstClassifierEntry->u8AssociatedPHSI = psfCSType->cCPacketClassificationRule.u8AssociatedPHSI;\r\n}\r\npstClassifierEntry->ucEthCSSrcMACLen = (psfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddressLength);\r\nmemcpy(pstClassifierEntry->au8EThCSSrcMAC,psfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress,MAC_ADDRESS_SIZE);\r\nmemcpy(pstClassifierEntry->au8EThCSSrcMACMask,psfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress+MAC_ADDRESS_SIZE,MAC_ADDRESS_SIZE);\r\npstClassifierEntry->ucEthCSDestMACLen = (psfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nmemcpy(pstClassifierEntry->au8EThCSDestMAC,psfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress,MAC_ADDRESS_SIZE);\r\nmemcpy(pstClassifierEntry->au8EThCSDestMACMask,psfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress+MAC_ADDRESS_SIZE,MAC_ADDRESS_SIZE);\r\npstClassifierEntry->ucEtherTypeLen = (psfCSType->cCPacketClassificationRule.u8EthertypeLength);\r\nmemcpy(pstClassifierEntry->au8EthCSEtherType,psfCSType->cCPacketClassificationRule.u8Ethertype,NUM_ETHERTYPE_BYTES);\r\nmemcpy(pstClassifierEntry->usUserPriority, &psfCSType->cCPacketClassificationRule.u16UserPriority, 2);\r\npstClassifierEntry->usVLANID = ntohs(psfCSType->cCPacketClassificationRule.u16VLANID);\r\npstClassifierEntry->usValidityBitMap = ntohs(psfCSType->cCPacketClassificationRule.u16ValidityBitMap);\r\npstClassifierEntry->bUsed = TRUE;\r\n}\r\n}\r\nstatic inline VOID DeleteClassifierRuleFromSF(PMINI_ADAPTER Adapter,UINT uiSearchRuleIndex,UINT nClassifierIndex)\r\n{\r\nS_CLASSIFIER_RULE *pstClassifierEntry = NULL;\r\nB_UINT16 u16PacketClassificationRuleIndex;\r\nUSHORT usVCID;\r\nusVCID = Adapter->PackInfo[uiSearchRuleIndex].usVCID_Value;\r\nif(nClassifierIndex > MAX_CLASSIFIERS-1)\r\nreturn;\r\nif(usVCID == 0)\r\nreturn;\r\nu16PacketClassificationRuleIndex = Adapter->astClassifierTable[nClassifierIndex].uiClassifierRuleIndex;\r\npstClassifierEntry = &Adapter->astClassifierTable[nClassifierIndex];\r\nif(pstClassifierEntry)\r\n{\r\npstClassifierEntry->bUsed = FALSE;\r\npstClassifierEntry->uiClassifierRuleIndex = 0;\r\nmemset(pstClassifierEntry,0,sizeof(S_CLASSIFIER_RULE));\r\nPhsDeleteClassifierRule(\r\n&Adapter->stBCMPhsContext,\r\nusVCID,\r\nu16PacketClassificationRuleIndex);\r\n}\r\n}\r\nVOID DeleteAllClassifiersForSF(PMINI_ADAPTER Adapter,UINT uiSearchRuleIndex)\r\n{\r\nS_CLASSIFIER_RULE *pstClassifierEntry = NULL;\r\nUINT nClassifierIndex;\r\nUSHORT ulVCID;\r\nulVCID = Adapter->PackInfo[uiSearchRuleIndex].usVCID_Value;\r\nif(ulVCID == 0)\r\nreturn;\r\nfor(nClassifierIndex =0 ; nClassifierIndex < MAX_CLASSIFIERS ; nClassifierIndex++)\r\n{\r\nif(Adapter->astClassifierTable[nClassifierIndex].usVCID_Value == ulVCID)\r\n{\r\npstClassifierEntry = &Adapter->astClassifierTable[nClassifierIndex];\r\nif(pstClassifierEntry->bUsed)\r\n{\r\nDeleteClassifierRuleFromSF(Adapter,uiSearchRuleIndex,nClassifierIndex);\r\n}\r\n}\r\n}\r\nPhsDeleteSFRules(\r\n&Adapter->stBCMPhsContext,\r\nulVCID);\r\n}\r\nstatic VOID CopyToAdapter( register PMINI_ADAPTER Adapter,\r\nregister pstServiceFlowParamSI psfLocalSet,\r\nregister UINT uiSearchRuleIndex,\r\nregister UCHAR ucDsxType,\r\nstLocalSFAddIndicationAlt *pstAddIndication)\r\n{\r\nULONG ulSFID;\r\nUINT nClassifierIndex = 0;\r\nE_CLASSIFIER_ACTION eClassifierAction = eInvalidClassifierAction;\r\nB_UINT16 u16PacketClassificationRuleIndex=0;\r\nUINT nIndex=0;\r\nstConvergenceSLTypes *psfCSType = NULL;\r\nS_PHS_RULE sPhsRule;\r\nUSHORT uVCID = Adapter->PackInfo[uiSearchRuleIndex].usVCID_Value;\r\nUINT UGIValue = 0;\r\nAdapter->PackInfo[uiSearchRuleIndex].bValid=TRUE;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Search Rule Index = %d\n", uiSearchRuleIndex);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"%s: SFID= %x ",__FUNCTION__, ntohl(psfLocalSet->u32SFID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Updating Queue %d",uiSearchRuleIndex);\r\nulSFID = ntohl(psfLocalSet->u32SFID);\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = 0;\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport = 0;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"CopyToAdapter : u8CSSpecification : %X\n",psfLocalSet->u8CSSpecification);\r\nswitch(psfLocalSet->u8CSSpecification)\r\n{\r\ncase eCSPacketIPV4:\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = IPV4_CS;\r\nbreak;\r\n}\r\ncase eCSPacketIPV6:\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = IPV6_CS;\r\nbreak;\r\n}\r\ncase eCS802_3PacketEthernet:\r\ncase eCS802_1QPacketVLAN:\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport = ETH_CS_802_3;\r\nbreak;\r\n}\r\ncase eCSPacketIPV4Over802_1QVLAN:\r\ncase eCSPacketIPV4Over802_3Ethernet:\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = IPV4_CS;\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport = ETH_CS_802_3;\r\nbreak;\r\n}\r\ncase eCSPacketIPV6Over802_1QVLAN:\r\ncase eCSPacketIPV6Over802_3Ethernet:\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = IPV6_CS;\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport = ETH_CS_802_3;\r\nbreak;\r\n}\r\ndefault:\r\n{\r\nBCM_DEBUG_PRINT (Adapter, DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Error in value of CS Classification.. setting default to IP CS\n");\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport = IPV4_CS;\r\nbreak;\r\n}\r\n}\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"CopyToAdapter : Queue No : %X ETH CS Support : %X , IP CS Support : %X \n",\r\nuiSearchRuleIndex,\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport,\r\nAdapter->PackInfo[uiSearchRuleIndex].bIPCSSupport);\r\nif(Adapter->PackInfo[uiSearchRuleIndex].bIPCSSupport == IPV6_CS)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].ucIpVersion = IPV6;\r\n}\r\nelse\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].ucIpVersion = IPV4;\r\n}\r\nif(!Adapter->bETHCSEnabled)\r\nAdapter->PackInfo[uiSearchRuleIndex].bEthCSSupport = 0;\r\nif(psfLocalSet->u8ServiceClassNameLength > 0 &&\r\npsfLocalSet->u8ServiceClassNameLength < 32)\r\n{\r\nmemcpy(Adapter->PackInfo[uiSearchRuleIndex].ucServiceClassName,\r\npsfLocalSet->u8ServiceClassName,\r\npsfLocalSet->u8ServiceClassNameLength);\r\n}\r\nAdapter->PackInfo[uiSearchRuleIndex].u8QueueType =\r\npsfLocalSet->u8ServiceFlowSchedulingType;\r\nif(Adapter->PackInfo[uiSearchRuleIndex].u8QueueType==BE &&\r\nAdapter->PackInfo[uiSearchRuleIndex].ucDirection)\r\n{\r\nAdapter->usBestEffortQueueIndex=uiSearchRuleIndex;\r\n}\r\nAdapter->PackInfo[uiSearchRuleIndex].ulSFID = ntohl(psfLocalSet->u32SFID);\r\nAdapter->PackInfo[uiSearchRuleIndex].u8TrafficPriority = psfLocalSet->u8TrafficPriority;\r\nfor(nIndex=0; nIndex<psfLocalSet->u8TotalClassifiers; nIndex++)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Classifier index =%d",nIndex);\r\npsfCSType = &psfLocalSet->cConvergenceSLTypes[nIndex];\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Classifier index =%d",nIndex);\r\nif(psfCSType->cCPacketClassificationRule.u8ClassifierRulePriority)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bClassifierPriority=TRUE;\r\n}\r\nif(psfCSType->cCPacketClassificationRule.u8ClassifierRulePriority)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bClassifierPriority=TRUE;\r\n}\r\nif(ucDsxType== DSA_ACK)\r\n{\r\neClassifierAction = eAddClassifier;\r\n}\r\nelse if(ucDsxType == DSC_ACK)\r\n{\r\nswitch(psfCSType->u8ClassfierDSCAction)\r\n{\r\ncase 0:\r\n{\r\neClassifierAction = eAddClassifier;\r\n}\r\nbreak;\r\ncase 1:\r\n{\r\neClassifierAction = eReplaceClassifier;\r\n}\r\nbreak;\r\ncase 2:\r\n{\r\neClassifierAction = eDeleteClassifier;\r\n}\r\nbreak;\r\ndefault:\r\n{\r\neClassifierAction = eInvalidClassifierAction;\r\n}\r\n}\r\n}\r\nu16PacketClassificationRuleIndex = ntohs(psfCSType->cCPacketClassificationRule.u16PacketClassificationRuleIndex);\r\nswitch(eClassifierAction)\r\n{\r\ncase eAddClassifier:\r\n{\r\nnClassifierIndex = SearchClsid(Adapter,ulSFID,u16PacketClassificationRuleIndex);\r\nif(nClassifierIndex > MAX_CLASSIFIERS)\r\n{\r\nnClassifierIndex = SearchFreeClsid(Adapter);\r\nif(nClassifierIndex > MAX_CLASSIFIERS)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Error Failed To get a free Classifier Entry");\r\nbreak;\r\n}\r\nCopyClassifierRuleToSF(Adapter,psfCSType,uiSearchRuleIndex,nClassifierIndex);\r\n}\r\nelse\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"CopyToAdapter : Error The Specified Classifier Already Exists \\r\nand attempted To Add Classifier with Same PCRI : 0x%x\n", u16PacketClassificationRuleIndex);\r\n}\r\n}\r\nbreak;\r\ncase eReplaceClassifier:\r\n{\r\nnClassifierIndex = SearchClsid(Adapter,ulSFID,u16PacketClassificationRuleIndex);\r\nif(nClassifierIndex > MAX_CLASSIFIERS)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Error Search for Classifier To be replaced failed");\r\nbreak;\r\n}\r\nCopyClassifierRuleToSF(Adapter,psfCSType,uiSearchRuleIndex,nClassifierIndex);\r\n}\r\nbreak;\r\ncase eDeleteClassifier:\r\n{\r\nnClassifierIndex = SearchClsid(Adapter,ulSFID,u16PacketClassificationRuleIndex);\r\nif(nClassifierIndex > MAX_CLASSIFIERS)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Error Search for Classifier To be deleted failed");\r\nbreak;\r\n}\r\nDeleteClassifierRuleFromSF(Adapter,uiSearchRuleIndex,nClassifierIndex);\r\n}\r\nbreak;\r\ndefault:\r\n{\r\nbreak;\r\n}\r\n}\r\n}\r\nfor(nIndex=0; nIndex < psfLocalSet->u8TotalClassifiers; nIndex++)\r\n{\r\npsfCSType = &psfLocalSet->cConvergenceSLTypes[nIndex];\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "psfCSType->u8PhsDSCAction : 0x%x\n",\r\npsfCSType->u8PhsDSCAction );\r\nswitch (psfCSType->u8PhsDSCAction)\r\n{\r\ncase eDeleteAllPHSRules:\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Deleting All PHS Rules For VCID: 0x%X\n",uVCID);\r\nPhsDeleteSFRules(\r\n&Adapter->stBCMPhsContext,\r\nuVCID);\r\nbreak;\r\n}\r\ncase eDeletePHSRule:\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"PHS DSC Action = Delete PHS Rule \n");\r\nif(psfCSType->cPhsRule.u8PHSI)\r\n{\r\nPhsDeletePHSRule(\r\n&Adapter->stBCMPhsContext,\r\nuVCID,\r\npsfCSType->cCPacketClassificationRule.u8AssociatedPHSI);\r\n}\r\nelse\r\n{\r\n}\r\nbreak;\r\n}\r\ndefault :\r\n{\r\nif(ucDsxType == DSC_ACK)\r\n{\r\nbreak;\r\n}\r\n}\r\ncase eAddPHSRule:\r\ncase eSetPHSRule:\r\n{\r\nif(psfCSType->cPhsRule.u8PHSI)\r\n{\r\nunsigned int uiClassifierIndex = 0;\r\nif(pstAddIndication->u8Direction == UPLINK_DIR )\r\n{\r\nfor(uiClassifierIndex=0;uiClassifierIndex<MAX_CLASSIFIERS;uiClassifierIndex++)\r\n{\r\nif((Adapter->astClassifierTable[uiClassifierIndex].bUsed) &&\r\n(Adapter->astClassifierTable[uiClassifierIndex].ulSFID == Adapter->PackInfo[uiSearchRuleIndex].ulSFID) &&\r\n(Adapter->astClassifierTable[uiClassifierIndex].u8AssociatedPHSI == psfCSType->cPhsRule.u8PHSI))\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Adding PHS Rule For Classifier : 0x%x cPhsRule.u8PHSI : 0x%x\n",\r\nAdapter->astClassifierTable[uiClassifierIndex].uiClassifierRuleIndex,\r\npsfCSType->cPhsRule.u8PHSI);\r\nsPhsRule.u8PHSI = psfCSType->cPhsRule.u8PHSI;\r\nsPhsRule.u8PHSFLength = psfCSType->cPhsRule.u8PHSFLength;\r\nsPhsRule.u8PHSMLength = psfCSType->cPhsRule.u8PHSMLength;\r\nsPhsRule.u8PHSS = psfCSType->cPhsRule.u8PHSS;\r\nsPhsRule.u8PHSV = psfCSType->cPhsRule.u8PHSV;\r\nmemcpy(sPhsRule.u8PHSF,psfCSType->cPhsRule.u8PHSF,MAX_PHS_LENGTHS);\r\nmemcpy(sPhsRule.u8PHSM,psfCSType->cPhsRule.u8PHSM,MAX_PHS_LENGTHS);\r\nsPhsRule.u8RefCnt = 0;\r\nsPhsRule.bUnclassifiedPHSRule = FALSE;\r\nsPhsRule.PHSModifiedBytes = 0;\r\nsPhsRule.PHSModifiedNumPackets = 0;\r\nsPhsRule.PHSErrorNumPackets = 0;\r\nPhsUpdateClassifierRule(\r\n&Adapter->stBCMPhsContext,\r\nuVCID,\r\nAdapter->astClassifierTable[uiClassifierIndex].uiClassifierRuleIndex,\r\n&sPhsRule,\r\nAdapter->astClassifierTable[uiClassifierIndex].u8AssociatedPHSI);\r\nif(sPhsRule.u8PHSI)\r\n{\r\nAdapter->astClassifierTable[uiClassifierIndex].u32PHSRuleID = sPhsRule.u8PHSI;\r\nmemcpy(&Adapter->astClassifierTable[uiClassifierIndex].sPhsRule,&sPhsRule,sizeof(S_PHS_RULE));\r\n}\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nsPhsRule.u8PHSI = psfCSType->cPhsRule.u8PHSI;\r\nsPhsRule.u8PHSFLength = psfCSType->cPhsRule.u8PHSFLength;\r\nsPhsRule.u8PHSMLength = psfCSType->cPhsRule.u8PHSMLength;\r\nsPhsRule.u8PHSS = psfCSType->cPhsRule.u8PHSS;\r\nsPhsRule.u8PHSV = psfCSType->cPhsRule.u8PHSV;\r\nmemcpy(sPhsRule.u8PHSF,psfCSType->cPhsRule.u8PHSF,MAX_PHS_LENGTHS);\r\nmemcpy(sPhsRule.u8PHSM,psfCSType->cPhsRule.u8PHSM,MAX_PHS_LENGTHS);\r\nsPhsRule.u8RefCnt = 0;\r\nsPhsRule.bUnclassifiedPHSRule = TRUE;\r\nsPhsRule.PHSModifiedBytes = 0;\r\nsPhsRule.PHSModifiedNumPackets = 0;\r\nsPhsRule.PHSErrorNumPackets = 0;\r\nPhsUpdateClassifierRule(\r\n&Adapter->stBCMPhsContext,\r\nuVCID,\r\nsPhsRule.u8PHSI,\r\n&sPhsRule,\r\nsPhsRule.u8PHSI);\r\n}\r\n}\r\n}\r\nbreak;\r\n}\r\n}\r\nif(psfLocalSet->u32MaxSustainedTrafficRate == 0 )\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate =\r\nWIMAX_MAX_ALLOWED_RATE;\r\n}\r\nelse if (ntohl(psfLocalSet->u32MaxSustainedTrafficRate) >\r\nWIMAX_MAX_ALLOWED_RATE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate =\r\nWIMAX_MAX_ALLOWED_RATE;\r\n}\r\nelse\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate =\r\nntohl(psfLocalSet->u32MaxSustainedTrafficRate);\r\n}\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxLatency = ntohl(psfLocalSet->u32MaximumLatency);\r\nif(Adapter->PackInfo[uiSearchRuleIndex].uiMaxLatency == 0)\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxLatency = MAX_LATENCY_ALLOWED;\r\nif(( Adapter->PackInfo[uiSearchRuleIndex].u8QueueType == ERTPS ||\r\nAdapter->PackInfo[uiSearchRuleIndex].u8QueueType == UGS ) )\r\nUGIValue = ntohs(psfLocalSet->u16UnsolicitedGrantInterval);\r\nif(UGIValue == 0)\r\nUGIValue = DEFAULT_UG_INTERVAL;\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize =\r\n(DEFAULT_UGI_FACTOR*Adapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate*UGIValue)/1000;\r\nif(Adapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize < WIMAX_MAX_MTU*8)\r\n{\r\nUINT UGIFactor = 0;\r\nUGIFactor = (Adapter->PackInfo[uiSearchRuleIndex].uiMaxLatency/UGIValue + 1);\r\nif(UGIFactor > DEFAULT_UGI_FACTOR)\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize =\r\n(UGIFactor*Adapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate*UGIValue)/1000;\r\nif(Adapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize > WIMAX_MAX_MTU*8)\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize = WIMAX_MAX_MTU*8;\r\n}\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"LAT: %d, UGI: %d \n", Adapter->PackInfo[uiSearchRuleIndex].uiMaxLatency, UGIValue);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"uiMaxAllowedRate: 0x%x, u32MaxSustainedTrafficRate: 0x%x ,uiMaxBucketSize: 0x%x",\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxAllowedRate,\r\nntohl(psfLocalSet->u32MaxSustainedTrafficRate),\r\nAdapter->PackInfo[uiSearchRuleIndex].uiMaxBucketSize);\r\nCopyMIBSExtendedSFParameters(Adapter,psfLocalSet,uiSearchRuleIndex);\r\nAdapter->PackInfo[uiSearchRuleIndex].bHeaderSuppressionEnabled =\r\n!(psfLocalSet->u8RequesttransmissionPolicy &\r\nMASK_DISABLE_HEADER_SUPPRESSION);\r\nkfree(Adapter->PackInfo[uiSearchRuleIndex].pstSFIndication);\r\nAdapter->PackInfo[uiSearchRuleIndex].pstSFIndication = pstAddIndication;\r\nSortPackInfo(Adapter);\r\nSortClassifiers(Adapter);\r\nDumpPhsRules(&Adapter->stBCMPhsContext);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"%s <=====", __FUNCTION__);\r\n}\r\nstatic VOID DumpCmControlPacket(PVOID pvBuffer)\r\n{\r\nUINT uiLoopIndex;\r\nUINT nIndex;\r\nstLocalSFAddIndicationAlt *pstAddIndication;\r\nUINT nCurClassifierCnt;\r\nPMINI_ADAPTER Adapter = GET_BCM_ADAPTER(gblpnetdev);\r\npstAddIndication = (stLocalSFAddIndicationAlt *)pvBuffer;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "======>");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Type : 0x%X",pstAddIndication->u8Type);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Direction : 0x%X",pstAddIndication->u8Direction);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16TID: 0x%X", ntohs(pstAddIndication->u16TID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16CID : 0x%X",ntohs(pstAddIndication->u16CID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16VCID : 0x%X",ntohs(pstAddIndication->u16VCID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " AuthorizedSet--->");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32SFID : 0x%X",htonl(pstAddIndication->sfAuthorizedSet.u32SFID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16CID : 0x%X",htons(pstAddIndication->sfAuthorizedSet.u16CID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassNameLength : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassNameLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassName : 0x%X ,0x%X , 0x%X, 0x%X, 0x%X, 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[0],\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[1],\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[2],\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[3],\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[4],\r\npstAddIndication->sfAuthorizedSet.u8ServiceClassName[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8MBSService : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8MBSService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8QosParamSet : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8QosParamSet);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TrafficPriority : 0x%X, %p",\r\npstAddIndication->sfAuthorizedSet.u8TrafficPriority, &pstAddIndication->sfAuthorizedSet.u8TrafficPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaxSustainedTrafficRate : 0x%X 0x%p",\r\npstAddIndication->sfAuthorizedSet.u32MaxSustainedTrafficRate,\r\n&pstAddIndication->sfAuthorizedSet.u32MaxSustainedTrafficRate);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaxTrafficBurst : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u32MaxTrafficBurst);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MinReservedTrafficRate : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u32MinReservedTrafficRate);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParamLength : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8VendorSpecificQoSParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParam : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8VendorSpecificQoSParam[0]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceFlowSchedulingType : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8ServiceFlowSchedulingType);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32ToleratedJitter : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u32ToleratedJitter);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaximumLatency : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u32MaximumLatency);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8FixedLengthVSVariableLengthSDUIndicator: 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8FixedLengthVSVariableLengthSDUIndicator);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8SDUSize : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8SDUSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16TargetSAID : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16TargetSAID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ARQEnable : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8ARQEnable);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQWindowSize : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQWindowSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRetryTxTimeOut : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQRetryTxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRetryRxTimeOut : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQRetryRxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQBlockLifeTime : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQBlockLifeTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQSyncLossTimeOut : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQSyncLossTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ARQDeliverInOrder : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8ARQDeliverInOrder);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRxPurgeTimeOut : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQRxPurgeTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQBlockSize : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16ARQBlockSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8CSSpecification : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8CSSpecification);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TypeOfDataDeliveryService : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8TypeOfDataDeliveryService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16SDUInterArrivalTime : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16SDUInterArrivalTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16TimeBase : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16TimeBase);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8PagingPreference : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8PagingPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16UnsolicitedPollingInterval : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u16UnsolicitedPollingInterval);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "sfAuthorizedSet.u8HARQChannelMapping %x %x %x ",\r\n*(unsigned int*)pstAddIndication->sfAuthorizedSet.u8HARQChannelMapping,\r\n*(unsigned int*)&pstAddIndication->sfAuthorizedSet.u8HARQChannelMapping[4],\r\n*(USHORT*) &pstAddIndication->sfAuthorizedSet.u8HARQChannelMapping[8]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TrafficIndicationPreference : 0x%X",\r\npstAddIndication->sfAuthorizedSet.u8TrafficIndicationPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " Total Classifiers Received : 0x%X",pstAddIndication->sfAuthorizedSet.u8TotalClassifiers);\r\nnCurClassifierCnt = pstAddIndication->sfAuthorizedSet.u8TotalClassifiers;\r\nif(nCurClassifierCnt > MAX_CLASSIFIERS_IN_SF)\r\n{\r\nnCurClassifierCnt = MAX_CLASSIFIERS_IN_SF;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "pstAddIndication->sfAuthorizedSet.bValid %d", pstAddIndication->sfAuthorizedSet.bValid);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "pstAddIndication->sfAuthorizedSet.u16MacOverhead %x", pstAddIndication->sfAuthorizedSet.u16MacOverhead);\r\nif(!pstAddIndication->sfAuthorizedSet.bValid)\r\npstAddIndication->sfAuthorizedSet.bValid=1;\r\nfor(nIndex = 0 ; nIndex < nCurClassifierCnt ; nIndex++)\r\n{\r\nstConvergenceSLTypes *psfCSType = NULL;\r\npsfCSType = &pstAddIndication->sfAuthorizedSet.cConvergenceSLTypes[nIndex];\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "psfCSType = %p", psfCSType);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "CCPacketClassificationRuleSI====>");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ClassifierRulePriority :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ClassifierRulePriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPTypeOfServiceLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPTypeOfService[3] :0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[0],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[1],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[2]);\r\nfor(uiLoopIndex=0; uiLoopIndex < 1; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Protocol : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8Protocol);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddressLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddressLength);\r\nfor(uiLoopIndex=0; uiLoopIndex < 32; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddress[32] : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPDestinationAddressLength : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddressLength);\r\nfor(uiLoopIndex=0; uiLoopIndex < 32; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPDestinationAddress[32] : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolSourcePortRangeLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolSourcePortRange[4]: 0x%02X ,0x%02X ,0x%02X ,0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolDestPortRangeLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolDestPortRange[4]: 0x%02X ,0x%02X ,0x%02X ,0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetDestMacAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetDestMacAddress[6] : 0x %02X %02X %02X %02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetSourceMACAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetSourceMACAddress[6] : 0x %02X %02X %02X %02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthertypeLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthertypeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Ethertype[3] : 0x%02X ,0x%02X ,0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[0],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[1],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[2]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16UserPriority : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16UserPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16VLANID : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16VLANID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8AssociatedPHSI : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8AssociatedPHSI);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16PacketClassificationRuleIndex : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16PacketClassificationRuleIndex);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificClassifierParamLength : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificClassifierParam[1] : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParam[0]);\r\n#ifdef VERSION_D5\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPv6FlowLableLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLableLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPv6FlowLable[6] : 0x %02X %02X %02X %02X %02X %02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[0],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[1],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[2],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[3],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[4],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[5]);\r\n#endif\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "bValid : 0x%02X",pstAddIndication->sfAuthorizedSet.bValid);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "AdmittedSet--->");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32SFID : 0x%X",pstAddIndication->sfAdmittedSet.u32SFID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16CID : 0x%X",pstAddIndication->sfAdmittedSet.u16CID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassNameLength : 0x%X",\r\npstAddIndication->sfAdmittedSet.u8ServiceClassNameLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassName : 0x %02X %02X %02X %02X %02X %02X",\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[0],\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[1],\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[2],\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[3],\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[4],\r\npstAddIndication->sfAdmittedSet.u8ServiceClassName[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8MBSService : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8MBSService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8QosParamSet : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8QosParamSet);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TrafficPriority : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8TrafficPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaxTrafficBurst : 0x%X",\r\npstAddIndication->sfAdmittedSet.u32MaxTrafficBurst);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MinReservedTrafficRate : 0x%X",\r\npstAddIndication->sfAdmittedSet.u32MinReservedTrafficRate);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParamLength : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8VendorSpecificQoSParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParam : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8VendorSpecificQoSParam[0]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceFlowSchedulingType : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8ServiceFlowSchedulingType);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32ToleratedJitter : 0x%X",\r\npstAddIndication->sfAdmittedSet.u32ToleratedJitter);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaximumLatency : 0x%X",\r\npstAddIndication->sfAdmittedSet.u32MaximumLatency);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8FixedLengthVSVariableLengthSDUIndicator: 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8FixedLengthVSVariableLengthSDUIndicator);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8SDUSize : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8SDUSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16TargetSAID : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u16TargetSAID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ARQEnable : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8ARQEnable);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQWindowSize : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQWindowSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRetryTxTimeOut : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQRetryTxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRetryRxTimeOut : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQRetryRxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQBlockLifeTime : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQBlockLifeTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQSyncLossTimeOut : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQSyncLossTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ARQDeliverInOrder : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8ARQDeliverInOrder);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQRxPurgeTimeOut : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQRxPurgeTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16ARQBlockSize : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16ARQBlockSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8CSSpecification : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8CSSpecification);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TypeOfDataDeliveryService : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8TypeOfDataDeliveryService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16SDUInterArrivalTime : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16SDUInterArrivalTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16TimeBase : 0x%X",\r\npstAddIndication->sfAdmittedSet.u16TimeBase);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8PagingPreference : 0x%X",\r\npstAddIndication->sfAdmittedSet.u8PagingPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TrafficIndicationPreference : 0x%02X",\r\npstAddIndication->sfAdmittedSet.u8TrafficIndicationPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " Total Classifiers Received : 0x%X",pstAddIndication->sfAdmittedSet.u8TotalClassifiers);\r\nnCurClassifierCnt = pstAddIndication->sfAdmittedSet.u8TotalClassifiers;\r\nif(nCurClassifierCnt > MAX_CLASSIFIERS_IN_SF)\r\n{\r\nnCurClassifierCnt = MAX_CLASSIFIERS_IN_SF;\r\n}\r\nfor(nIndex = 0 ; nIndex < nCurClassifierCnt ; nIndex++)\r\n{\r\nstConvergenceSLTypes *psfCSType = NULL;\r\npsfCSType = &pstAddIndication->sfAdmittedSet.cConvergenceSLTypes[nIndex];\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " CCPacketClassificationRuleSI====>");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ClassifierRulePriority :0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ClassifierRulePriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPTypeOfServiceLength :0x%02X",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPTypeOfService[3] :0x%02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[0],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[1],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[2]);\r\nfor(uiLoopIndex=0; uiLoopIndex < 1; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Protocol: 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8Protocol);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddressLength :0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddressLength);\r\nfor(uiLoopIndex=0; uiLoopIndex < 32; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddress[32] : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPDestinationAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddressLength);\r\nfor(uiLoopIndex=0; uiLoopIndex < 32; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPDestinationAddress[32] : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolSourcePortRangeLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolSourcePortRange[4] : 0x %02X %02X %02X %02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolDestPortRangeLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ProtocolDestPortRange[4] : 0x %02X %02X %02X %02X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetDestMacAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetDestMacAddress[6] : 0x %02X %02X %02X %02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetSourceMACAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetSourceMACAddress[6] : 0x %02X %02X %02X %02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthertypeLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8EthertypeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8Ethertype[3] : 0x%02X %02X %02X",\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[0],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[1],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[2]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16UserPriority : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16UserPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16VLANID : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16VLANID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8AssociatedPHSI : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8AssociatedPHSI);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16PacketClassificationRuleIndex : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16PacketClassificationRuleIndex);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificClassifierParamLength : 0x%02X",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificClassifierParam[1] : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParam[0]);\r\n#ifdef VERSION_D5\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPv6FlowLableLength : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLableLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPv6FlowLable[6] : 0x %02X %02X %02X %02X %02X %02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[0],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[1],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[2],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[3],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[4],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[5]);\r\n#endif\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "bValid : 0x%X",pstAddIndication->sfAdmittedSet.bValid);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " ActiveSet--->");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32SFID : 0x%X",pstAddIndication->sfActiveSet.u32SFID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u16CID : 0x%X",pstAddIndication->sfActiveSet.u16CID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassNameLength : 0x%X",\r\npstAddIndication->sfActiveSet.u8ServiceClassNameLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceClassName : 0x %02X %02X %02X %02X %02X %02X",\r\npstAddIndication->sfActiveSet.u8ServiceClassName[0],\r\npstAddIndication->sfActiveSet.u8ServiceClassName[1],\r\npstAddIndication->sfActiveSet.u8ServiceClassName[2],\r\npstAddIndication->sfActiveSet.u8ServiceClassName[3],\r\npstAddIndication->sfActiveSet.u8ServiceClassName[4],\r\npstAddIndication->sfActiveSet.u8ServiceClassName[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8MBSService : 0x%02X",\r\npstAddIndication->sfActiveSet.u8MBSService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8QosParamSet : 0x%02X",\r\npstAddIndication->sfActiveSet.u8QosParamSet);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8TrafficPriority : 0x%02X",\r\npstAddIndication->sfActiveSet.u8TrafficPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaxTrafficBurst : 0x%X",\r\npstAddIndication->sfActiveSet.u32MaxTrafficBurst);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MinReservedTrafficRate : 0x%X",\r\npstAddIndication->sfActiveSet.u32MinReservedTrafficRate);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParamLength : 0x%02X",\r\npstAddIndication->sfActiveSet.u8VendorSpecificQoSParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8VendorSpecificQoSParam : 0x%02X",\r\npstAddIndication->sfActiveSet.u8VendorSpecificQoSParam[0]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8ServiceFlowSchedulingType : 0x%02X",\r\npstAddIndication->sfActiveSet.u8ServiceFlowSchedulingType);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32ToleratedJitter : 0x%X",\r\npstAddIndication->sfActiveSet.u32ToleratedJitter);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u32MaximumLatency : 0x%X",\r\npstAddIndication->sfActiveSet.u32MaximumLatency);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8FixedLengthVSVariableLengthSDUIndicator: 0x%02X",\r\npstAddIndication->sfActiveSet.u8FixedLengthVSVariableLengthSDUIndicator);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8SDUSize : 0x%X",\r\npstAddIndication->sfActiveSet.u8SDUSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16TargetSAID : 0x%X",\r\npstAddIndication->sfActiveSet.u16TargetSAID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ARQEnable : 0x%X",\r\npstAddIndication->sfActiveSet.u8ARQEnable);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQWindowSize : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQWindowSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQRetryTxTimeOut : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQRetryTxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQRetryRxTimeOut : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQRetryRxTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQBlockLifeTime : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQBlockLifeTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQSyncLossTimeOut : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQSyncLossTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ARQDeliverInOrder : 0x%X",\r\npstAddIndication->sfActiveSet.u8ARQDeliverInOrder);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQRxPurgeTimeOut : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQRxPurgeTimeOut);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16ARQBlockSize : 0x%X",\r\npstAddIndication->sfActiveSet.u16ARQBlockSize);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8CSSpecification : 0x%X",\r\npstAddIndication->sfActiveSet.u8CSSpecification);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8TypeOfDataDeliveryService : 0x%X",\r\npstAddIndication->sfActiveSet.u8TypeOfDataDeliveryService);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16SDUInterArrivalTime : 0x%X",\r\npstAddIndication->sfActiveSet.u16SDUInterArrivalTime);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16TimeBase : 0x%X",\r\npstAddIndication->sfActiveSet.u16TimeBase);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8PagingPreference : 0x%X",\r\npstAddIndication->sfActiveSet.u8PagingPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8TrafficIndicationPreference : 0x%X",\r\npstAddIndication->sfActiveSet.u8TrafficIndicationPreference);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " Total Classifiers Received : 0x%X",pstAddIndication->sfActiveSet.u8TotalClassifiers);\r\nnCurClassifierCnt = pstAddIndication->sfActiveSet.u8TotalClassifiers;\r\nif(nCurClassifierCnt > MAX_CLASSIFIERS_IN_SF)\r\n{\r\nnCurClassifierCnt = MAX_CLASSIFIERS_IN_SF;\r\n}\r\nfor(nIndex = 0 ; nIndex < nCurClassifierCnt ; nIndex++)\r\n{\r\nstConvergenceSLTypes *psfCSType = NULL;\r\npsfCSType = &pstAddIndication->sfActiveSet.cConvergenceSLTypes[nIndex];\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " CCPacketClassificationRuleSI====>");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ClassifierRulePriority :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ClassifierRulePriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8IPTypeOfServiceLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfServiceLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8IPTypeOfService[3] :0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[0],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[1],\r\npsfCSType->cCPacketClassificationRule.u8IPTypeOfService[2]);\r\nfor(uiLoopIndex=0; uiLoopIndex < 1; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8Protocol : 0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8Protocol);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddressLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddressLength);\r\nfor(uiLoopIndex=0; uiLoopIndex < 32; uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPMaskedSourceAddress[32]:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPMaskedSourceAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8IPDestinationAddressLength : 0x%02X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddressLength);\r\nfor(uiLoopIndex=0;uiLoopIndex<32;uiLoopIndex++)\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8IPDestinationAddress[32]:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPDestinationAddress[uiLoopIndex]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ProtocolSourcePortRangeLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ProtocolSourcePortRange[4]:0x%X ,0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolSourcePortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ProtocolDestPortRangeLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRangeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8ProtocolDestPortRange[4]:0x%X ,0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[0],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[1],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[2],\r\npsfCSType->cCPacketClassificationRule.u8ProtocolDestPortRange[3]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8EthernetDestMacAddressLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8EthernetDestMacAddress[6]:0x%X ,0x%X ,0x%X ,0x%X ,0x%X ,0x%X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8EthernetSourceMACAddressLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8EthernetDestMacAddressLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, "u8EthernetSourceMACAddress[6]:0x%X ,0x%X ,0x%X ,0x%X ,0x%X ,0x%X",\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[0],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[1],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[2],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[3],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[4],\r\npsfCSType->cCPacketClassificationRule.u8EthernetSourceMACAddress[5]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8EthertypeLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8EthertypeLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8Ethertype[3] :0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[0],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[1],\r\npsfCSType->cCPacketClassificationRule.u8Ethertype[2]);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16UserPriority :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16UserPriority);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16VLANID :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16VLANID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8AssociatedPHSI :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8AssociatedPHSI);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u16PacketClassificationRuleIndex:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u16PacketClassificationRuleIndex);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8VendorSpecificClassifierParamLength:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParamLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8VendorSpecificClassifierParam[1]:0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8VendorSpecificClassifierParam[0]);\r\n#ifdef VERSION_D5\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8IPv6FlowLableLength :0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLableLength);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " u8IPv6FlowLable[6] :0x%X ,0x%X ,0x%X ,0x%X ,0x%X ,0x%X ",\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[0],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[1],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[2],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[3],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[4],\r\npsfCSType->cCPacketClassificationRule.u8IPv6FlowLable[5]);\r\n#endif\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, DUMP_CONTROL, DBG_LVL_ALL, " bValid : 0x%X",pstAddIndication->sfActiveSet.bValid);\r\n}\r\nstatic inline ULONG RestoreSFParam(PMINI_ADAPTER Adapter, ULONG ulAddrSFParamSet,PUCHAR pucDestBuffer)\r\n{\r\nUINT nBytesToRead = sizeof(stServiceFlowParamSI);\r\nif(ulAddrSFParamSet == 0 || NULL == pucDestBuffer)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Got Param address as 0!!");\r\nreturn 0;\r\n}\r\nulAddrSFParamSet = ntohl(ulAddrSFParamSet);\r\nif(rdm(Adapter, ulAddrSFParamSet, (PUCHAR)pucDestBuffer, nBytesToRead) < 0)\r\nreturn STATUS_FAILURE;\r\nreturn 1;\r\n}\r\nstatic ULONG StoreSFParam(PMINI_ADAPTER Adapter,PUCHAR pucSrcBuffer,ULONG ulAddrSFParamSet)\r\n{\r\nUINT nBytesToWrite = sizeof(stServiceFlowParamSI);\r\nint ret = 0;\r\nif(ulAddrSFParamSet == 0 || NULL == pucSrcBuffer)\r\n{\r\nreturn 0;\r\n}\r\nret = wrm(Adapter, ulAddrSFParamSet, (u8 *)pucSrcBuffer, nBytesToWrite);\r\nif (ret < 0) {\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "%s:%d WRM failed",__FUNCTION__, __LINE__);\r\nreturn ret;\r\n}\r\nreturn 1;\r\n}\r\nULONG StoreCmControlResponseMessage(PMINI_ADAPTER Adapter,PVOID pvBuffer,UINT *puBufferLength)\r\n{\r\nstLocalSFAddIndicationAlt *pstAddIndicationAlt = NULL;\r\nstLocalSFAddIndication * pstAddIndication = NULL;\r\nstLocalSFDeleteRequest *pstDeletionRequest;\r\nUINT uiSearchRuleIndex;\r\nULONG ulSFID;\r\npstAddIndicationAlt = (stLocalSFAddIndicationAlt *)(pvBuffer);\r\nif(pstAddIndicationAlt->u8Type == DSD_REQ)\r\n{\r\npstDeletionRequest = (stLocalSFDeleteRequest *)pvBuffer;\r\nulSFID = ntohl(pstDeletionRequest->u32SFID);\r\nuiSearchRuleIndex=SearchSfid(Adapter,ulSFID);\r\nif(uiSearchRuleIndex < NO_OF_QUEUES)\r\n{\r\ndeleteSFBySfid(Adapter,uiSearchRuleIndex);\r\nAdapter->u32TotalDSD++;\r\n}\r\nreturn 1;\r\n}\r\nif( (pstAddIndicationAlt->u8Type == DSD_RSP) ||\r\n(pstAddIndicationAlt->u8Type == DSD_ACK))\r\n{\r\nreturn 1;\r\n}\r\npstAddIndication=kmalloc(sizeof(*pstAddIndication), GFP_KERNEL);\r\nif(NULL==pstAddIndication)\r\nreturn 0;\r\npstAddIndication->psfAuthorizedSet = (stServiceFlowParamSI *)\r\nGetNextTargetBufferLocation(Adapter, pstAddIndicationAlt->u16TID);\r\nif(!pstAddIndication->psfAuthorizedSet)\r\nreturn 0;\r\nif(StoreSFParam(Adapter,(PUCHAR)&pstAddIndicationAlt->sfAuthorizedSet,\r\n(ULONG)pstAddIndication->psfAuthorizedSet)!= 1)\r\nreturn 0;\r\npstAddIndication->psfAuthorizedSet = (stServiceFlowParamSI *)ntohl((ULONG)pstAddIndication->psfAuthorizedSet);\r\nif(pstAddIndicationAlt->u8Type == DSA_REQ)\r\n{\r\nstLocalSFAddRequest AddRequest;\r\nAddRequest.u8Type = pstAddIndicationAlt->u8Type;\r\nAddRequest.eConnectionDir = pstAddIndicationAlt->u8Direction;\r\nAddRequest.u16TID = pstAddIndicationAlt->u16TID;\r\nAddRequest.u16CID = pstAddIndicationAlt->u16CID;\r\nAddRequest.u16VCID = pstAddIndicationAlt->u16VCID;\r\nAddRequest.psfParameterSet =pstAddIndication->psfAuthorizedSet ;\r\n(*puBufferLength) = sizeof(stLocalSFAddRequest);\r\nmemcpy(pvBuffer,&AddRequest,sizeof(stLocalSFAddRequest));\r\nreturn 1;\r\n}\r\npstAddIndication->u8Type = pstAddIndicationAlt->u8Type;\r\npstAddIndication->eConnectionDir= pstAddIndicationAlt->u8Direction ;\r\npstAddIndication->u16TID = pstAddIndicationAlt->u16TID;\r\npstAddIndication->u16CID = pstAddIndicationAlt->u16CID;\r\npstAddIndication->u16VCID = pstAddIndicationAlt->u16VCID;\r\npstAddIndication->u8CC = pstAddIndicationAlt->u8CC;\r\npstAddIndication->psfAdmittedSet = (stServiceFlowParamSI *)\r\nGetNextTargetBufferLocation(Adapter, pstAddIndicationAlt->u16TID);\r\nif(!pstAddIndication->psfAdmittedSet)\r\nreturn 0;\r\nif(StoreSFParam(Adapter,(PUCHAR)&pstAddIndicationAlt->sfAdmittedSet,(ULONG)pstAddIndication->psfAdmittedSet) != 1)\r\nreturn 0;\r\npstAddIndication->psfAdmittedSet = (stServiceFlowParamSI *)ntohl((ULONG)pstAddIndication->psfAdmittedSet);\r\npstAddIndication->psfActiveSet = (stServiceFlowParamSI *)\r\nGetNextTargetBufferLocation(Adapter, pstAddIndicationAlt->u16TID);\r\nif(!pstAddIndication->psfActiveSet)\r\nreturn 0;\r\nif(StoreSFParam(Adapter,(PUCHAR)&pstAddIndicationAlt->sfActiveSet,(ULONG)pstAddIndication->psfActiveSet) != 1)\r\nreturn 0;\r\npstAddIndication->psfActiveSet = (stServiceFlowParamSI *)ntohl((ULONG)pstAddIndication->psfActiveSet);\r\n(*puBufferLength) = sizeof(stLocalSFAddIndication);\r\n*(stLocalSFAddIndication *)pvBuffer = *pstAddIndication;\r\nkfree(pstAddIndication);\r\nreturn 1;\r\n}\r\nstatic inline stLocalSFAddIndicationAlt\r\n*RestoreCmControlResponseMessage(register PMINI_ADAPTER Adapter,register PVOID pvBuffer)\r\n{\r\nULONG ulStatus=0;\r\nstLocalSFAddIndication *pstAddIndication = NULL;\r\nstLocalSFAddIndicationAlt *pstAddIndicationDest = NULL;\r\npstAddIndication = (stLocalSFAddIndication *)(pvBuffer);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "=====>" );\r\nif ((pstAddIndication->u8Type == DSD_REQ) ||\r\n(pstAddIndication->u8Type == DSD_RSP) ||\r\n(pstAddIndication->u8Type == DSD_ACK))\r\n{\r\nreturn (stLocalSFAddIndicationAlt *)pvBuffer;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Inside RestoreCmControlResponseMessage ");\r\npstAddIndicationDest=kmalloc(sizeof(stLocalSFAddIndicationAlt), GFP_KERNEL);\r\nif(pstAddIndicationDest)\r\n{\r\nmemset(pstAddIndicationDest,0,sizeof(stLocalSFAddIndicationAlt));\r\n}\r\nelse\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Failed to allocate memory for SF Add Indication Structure ");\r\nreturn NULL;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-u8Type : 0x%X",pstAddIndication->u8Type);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-u8Direction : 0x%X",pstAddIndication->eConnectionDir);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-u8TID : 0x%X",ntohs(pstAddIndication->u16TID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-u8CID : 0x%X",ntohs(pstAddIndication->u16CID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-u16VCID : 0x%X",ntohs(pstAddIndication->u16VCID));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-autorized set loc : %p",pstAddIndication->psfAuthorizedSet);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-admitted set loc : %p",pstAddIndication->psfAdmittedSet);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "AddIndication-Active set loc : %p",pstAddIndication->psfActiveSet);\r\npstAddIndicationDest->u8Type = pstAddIndication->u8Type;\r\npstAddIndicationDest->u8Direction = pstAddIndication->eConnectionDir;\r\npstAddIndicationDest->u16TID = pstAddIndication->u16TID;\r\npstAddIndicationDest->u16CID = pstAddIndication->u16CID;\r\npstAddIndicationDest->u16VCID = pstAddIndication->u16VCID;\r\npstAddIndicationDest->u8CC = pstAddIndication->u8CC;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Restoring Active Set ");\r\nulStatus=RestoreSFParam(Adapter,(ULONG)pstAddIndication->psfActiveSet, (PUCHAR)&pstAddIndicationDest->sfActiveSet);\r\nif(ulStatus != 1)\r\n{\r\ngoto failed_restore_sf_param;\r\n}\r\nif(pstAddIndicationDest->sfActiveSet.u8TotalClassifiers > MAX_CLASSIFIERS_IN_SF)\r\npstAddIndicationDest->sfActiveSet.u8TotalClassifiers = MAX_CLASSIFIERS_IN_SF;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Restoring Admitted Set ");\r\nulStatus=RestoreSFParam(Adapter,(ULONG)pstAddIndication->psfAdmittedSet,(PUCHAR)&pstAddIndicationDest->sfAdmittedSet);\r\nif(ulStatus != 1)\r\n{\r\ngoto failed_restore_sf_param;\r\n}\r\nif(pstAddIndicationDest->sfAdmittedSet.u8TotalClassifiers > MAX_CLASSIFIERS_IN_SF)\r\npstAddIndicationDest->sfAdmittedSet.u8TotalClassifiers = MAX_CLASSIFIERS_IN_SF;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Restoring Authorized Set ");\r\nulStatus=RestoreSFParam(Adapter,(ULONG)pstAddIndication->psfAuthorizedSet,(PUCHAR)&pstAddIndicationDest->sfAuthorizedSet);\r\nif(ulStatus != 1)\r\n{\r\ngoto failed_restore_sf_param;\r\n}\r\nif(pstAddIndicationDest->sfAuthorizedSet.u8TotalClassifiers > MAX_CLASSIFIERS_IN_SF)\r\npstAddIndicationDest->sfAuthorizedSet.u8TotalClassifiers = MAX_CLASSIFIERS_IN_SF;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Dumping the whole raw packet");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "============================================================");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, " pstAddIndicationDest->sfActiveSet size %zx %p", sizeof(*pstAddIndicationDest), pstAddIndicationDest);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "============================================================");\r\nreturn pstAddIndicationDest;\r\nfailed_restore_sf_param:\r\nkfree(pstAddIndicationDest);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "<=====" );\r\nreturn NULL;\r\n}\r\nULONG SetUpTargetDsxBuffers(PMINI_ADAPTER Adapter)\r\n{\r\nULONG ulTargetDsxBuffersBase = 0;\r\nULONG ulCntTargetBuffers;\r\nULONG ulIndex=0;\r\nint Status;\r\nif (!Adapter) {\r\nBCM_DEBUG_PRINT(Adapter, DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Adapter was NULL!!!");\r\nreturn 0;\r\n}\r\nif(Adapter->astTargetDsxBuffer[0].ulTargetDsxBuffer)\r\nreturn 1;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Size of Each DSX Buffer(Also size of ServiceFlowParamSI): %zx ",sizeof(stServiceFlowParamSI));\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Reading DSX buffer From Target location %x ",DSX_MESSAGE_EXCHANGE_BUFFER);\r\nStatus = rdmalt(Adapter, DSX_MESSAGE_EXCHANGE_BUFFER,\r\n(PUINT)&ulTargetDsxBuffersBase, sizeof(UINT));\r\nif(Status < 0)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "RDM failed!!");\r\nreturn 0;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Base Address Of DSX Target Buffer : 0x%lx",ulTargetDsxBuffersBase);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Tgt Buffer is Now %lx :",ulTargetDsxBuffersBase);\r\nulCntTargetBuffers = DSX_MESSAGE_EXCHANGE_BUFFER_SIZE/sizeof(stServiceFlowParamSI);\r\nAdapter->ulTotalTargetBuffersAvailable =\r\nulCntTargetBuffers > MAX_TARGET_DSX_BUFFERS ?\r\nMAX_TARGET_DSX_BUFFERS : ulCntTargetBuffers;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, " Total Target DSX Buffer setup %lx ",Adapter->ulTotalTargetBuffersAvailable);\r\nfor(ulIndex=0; ulIndex < Adapter->ulTotalTargetBuffersAvailable ; ulIndex++)\r\n{\r\nAdapter->astTargetDsxBuffer[ulIndex].ulTargetDsxBuffer = ulTargetDsxBuffersBase;\r\nAdapter->astTargetDsxBuffer[ulIndex].valid=1;\r\nAdapter->astTargetDsxBuffer[ulIndex].tid=0;\r\nulTargetDsxBuffersBase+=sizeof(stServiceFlowParamSI);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, " Target DSX Buffer %lx setup at 0x%lx",\r\nulIndex, Adapter->astTargetDsxBuffer[ulIndex].ulTargetDsxBuffer);\r\n}\r\nAdapter->ulCurrentTargetBuffer = 0;\r\nAdapter->ulFreeTargetBufferCnt = Adapter->ulTotalTargetBuffersAvailable;\r\nreturn 1;\r\n}\r\nstatic ULONG GetNextTargetBufferLocation(PMINI_ADAPTER Adapter,B_UINT16 tid)\r\n{\r\nULONG ulTargetDSXBufferAddress;\r\nULONG ulTargetDsxBufferIndexToUse,ulMaxTry;\r\nif((Adapter->ulTotalTargetBuffersAvailable == 0)||\r\n(Adapter->ulFreeTargetBufferCnt == 0))\r\n{\r\nClearTargetDSXBuffer(Adapter,tid,FALSE);\r\nreturn 0;\r\n}\r\nulTargetDsxBufferIndexToUse = Adapter->ulCurrentTargetBuffer;\r\nulMaxTry = Adapter->ulTotalTargetBuffersAvailable;\r\nwhile((ulMaxTry)&&(Adapter->astTargetDsxBuffer[ulTargetDsxBufferIndexToUse].valid != 1))\r\n{\r\nulTargetDsxBufferIndexToUse = (ulTargetDsxBufferIndexToUse+1)%\r\nAdapter->ulTotalTargetBuffersAvailable;\r\nulMaxTry--;\r\n}\r\nif(ulMaxTry==0)\r\n{\r\nBCM_DEBUG_PRINT (Adapter, DBG_TYPE_PRINTK, 0, 0, "\n GetNextTargetBufferLocation : Error No Free Target DSX Buffers FreeCnt : %lx ",Adapter->ulFreeTargetBufferCnt);\r\nClearTargetDSXBuffer(Adapter,tid,FALSE);\r\nreturn 0;\r\n}\r\nulTargetDSXBufferAddress =\r\nAdapter->astTargetDsxBuffer[ulTargetDsxBufferIndexToUse].ulTargetDsxBuffer;\r\nAdapter->astTargetDsxBuffer[ulTargetDsxBufferIndexToUse].valid=0;\r\nAdapter->astTargetDsxBuffer[ulTargetDsxBufferIndexToUse].tid=tid;\r\nAdapter->ulFreeTargetBufferCnt--;\r\nulTargetDsxBufferIndexToUse =\r\n(ulTargetDsxBufferIndexToUse+1)%Adapter->ulTotalTargetBuffersAvailable;\r\nAdapter->ulCurrentTargetBuffer = ulTargetDsxBufferIndexToUse;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "GetNextTargetBufferLocation :Returning address %lx tid %d\n",\r\nulTargetDSXBufferAddress,tid);\r\nreturn ulTargetDSXBufferAddress;\r\n}\r\nINT AllocAdapterDsxBuffer(PMINI_ADAPTER Adapter)\r\n{\r\nAdapter->caDsxReqResp=kmalloc(sizeof(stLocalSFAddIndicationAlt)+LEADER_SIZE, GFP_KERNEL);\r\nif(!Adapter->caDsxReqResp)\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}\r\nINT FreeAdapterDsxBuffer(PMINI_ADAPTER Adapter)\r\n{\r\nkfree(Adapter->caDsxReqResp);\r\nreturn 0;\r\n}\r\nBOOLEAN CmControlResponseMessage(PMINI_ADAPTER Adapter,\r\nPVOID pvBuffer\r\n)\r\n{\r\nstServiceFlowParamSI *psfLocalSet=NULL;\r\nstLocalSFAddIndicationAlt *pstAddIndication = NULL;\r\nstLocalSFChangeIndicationAlt *pstChangeIndication = NULL;\r\nPLEADER pLeader=NULL;\r\nif((pstAddIndication = RestoreCmControlResponseMessage(Adapter,pvBuffer))\r\n== NULL)\r\n{\r\nClearTargetDSXBuffer(Adapter,((stLocalSFAddIndication *)pvBuffer)->u16TID, FALSE);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_PRINTK, 0, 0, "Error in restoring Service Flow param structure from DSx message");\r\nreturn FALSE;\r\n}\r\nDumpCmControlPacket(pstAddIndication);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "====>");\r\npLeader = (PLEADER)Adapter->caDsxReqResp;\r\npLeader->Status =CM_CONTROL_NEWDSX_MULTICLASSIFIER_REQ;\r\npLeader->Vcid = 0;\r\nClearTargetDSXBuffer(Adapter,pstAddIndication->u16TID,FALSE);\r\nBCM_DEBUG_PRINT (Adapter, DBG_TYPE_PRINTK, 0, 0, "### TID RECEIVED %d\n",pstAddIndication->u16TID);\r\nswitch(pstAddIndication->u8Type)\r\n{\r\ncase DSA_REQ:\r\n{\r\npLeader->PLength = sizeof(stLocalSFAddIndicationAlt);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "Sending DSA Response....\n");\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SENDING DSA RESPONSE TO MAC %d", pLeader->PLength );\r\n*((stLocalSFAddIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))\r\n= *pstAddIndication;\r\n((stLocalSFAddIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))->u8Type = DSA_RSP;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, " VCID = %x", ntohs(pstAddIndication->u16VCID));\r\nCopyBufferToControlPacket(Adapter,(PVOID)Adapter->caDsxReqResp);\r\nkfree(pstAddIndication);\r\n}\r\nbreak;\r\ncase DSA_RSP:\r\n{\r\npLeader->PLength = sizeof(stLocalSFAddIndicationAlt);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SENDING DSA ACK TO MAC %d",\r\npLeader->PLength);\r\n*((stLocalSFAddIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))\r\n= *pstAddIndication;\r\n((stLocalSFAddIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))->u8Type = DSA_ACK;\r\n}\r\ncase DSA_ACK:\r\n{\r\nUINT uiSearchRuleIndex=0;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "VCID:0x%X",\r\nntohs(pstAddIndication->u16VCID));\r\nuiSearchRuleIndex=SearchFreeSfid(Adapter);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"uiSearchRuleIndex:0x%X ",\r\nuiSearchRuleIndex);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Direction:0x%X ",\r\npstAddIndication->u8Direction);\r\nif((uiSearchRuleIndex< NO_OF_QUEUES) )\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].ucDirection =\r\npstAddIndication->u8Direction;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "bValid:0x%X ",\r\npstAddIndication->sfActiveSet.bValid);\r\nif(pstAddIndication->sfActiveSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActiveSet=TRUE;\r\n}\r\nif(pstAddIndication->sfAuthorizedSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bAuthorizedSet=TRUE;\r\n}\r\nif(pstAddIndication->sfAdmittedSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bAdmittedSet=TRUE;\r\n}\r\nif(FALSE == pstAddIndication->sfActiveSet.bValid)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive = FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].bActivateRequestSent = FALSE;\r\nif(pstAddIndication->sfAdmittedSet.bValid)\r\n{\r\npsfLocalSet = &pstAddIndication->sfAdmittedSet;\r\n}\r\nelse if(pstAddIndication->sfAuthorizedSet.bValid)\r\n{\r\npsfLocalSet = &pstAddIndication->sfAuthorizedSet;\r\n}\r\n}\r\nelse\r\n{\r\npsfLocalSet = &pstAddIndication->sfActiveSet;\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=TRUE;\r\n}\r\nif(!psfLocalSet)\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "No set is valid\n");\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].bValid=FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value=0;\r\nkfree(pstAddIndication);\r\n}\r\nelse if(psfLocalSet->bValid && (pstAddIndication->u8CC == 0))\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "DSA ACK");\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value =\r\nntohs(pstAddIndication->u16VCID);\r\nAdapter->PackInfo[uiSearchRuleIndex].usCID =\r\nntohs(pstAddIndication->u16CID);\r\nif(UPLINK_DIR == pstAddIndication->u8Direction)\r\natomic_set(&Adapter->PackInfo[uiSearchRuleIndex].uiPerSFTxResourceCount, DEFAULT_PERSFCOUNT);\r\nCopyToAdapter(Adapter,psfLocalSet,uiSearchRuleIndex,\r\nDSA_ACK, pstAddIndication);\r\nmemcpy((((PUCHAR)pvBuffer)+1), &psfLocalSet->u32SFID, 4);\r\nif(pstAddIndication->sfActiveSet.bValid == TRUE)\r\n{\r\nif(UPLINK_DIR == pstAddIndication->u8Direction)\r\n{\r\nif(!Adapter->LinkUpStatus)\r\n{\r\nnetif_carrier_on(Adapter->dev);\r\nnetif_start_queue(Adapter->dev);\r\nAdapter->LinkUpStatus = 1;\r\nif (netif_msg_link(Adapter))\r\npr_info(PFX "%s: link up\n", Adapter->dev->name);\r\natomic_set(&Adapter->TxPktAvail, 1);\r\nwake_up(&Adapter->tx_packet_wait_queue);\r\nAdapter->liTimeSinceLastNetEntry = get_seconds();\r\n}\r\n}\r\n}\r\n}\r\nelse\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].bValid=FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value=0;\r\nkfree(pstAddIndication);\r\n}\r\n}\r\nelse\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_PRINTK, 0, 0, "DSA ACK did not get valid SFID");\r\nkfree(pstAddIndication);\r\nreturn FALSE;\r\n}\r\n}\r\nbreak;\r\ncase DSC_REQ:\r\n{\r\npLeader->PLength = sizeof(stLocalSFChangeIndicationAlt);\r\npstChangeIndication = (stLocalSFChangeIndicationAlt*)pstAddIndication;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SENDING DSC RESPONSE TO MAC %d", pLeader->PLength);\r\n*((stLocalSFChangeIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE])) = *pstChangeIndication;\r\n((stLocalSFChangeIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))->u8Type = DSC_RSP;\r\nCopyBufferToControlPacket(Adapter,(PVOID)Adapter->caDsxReqResp);\r\nkfree(pstAddIndication);\r\n}\r\nbreak;\r\ncase DSC_RSP:\r\n{\r\npLeader->PLength = sizeof(stLocalSFChangeIndicationAlt);\r\npstChangeIndication = (stLocalSFChangeIndicationAlt*)pstAddIndication;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SENDING DSC ACK TO MAC %d", pLeader->PLength);\r\n*((stLocalSFChangeIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE])) = *pstChangeIndication;\r\n((stLocalSFChangeIndicationAlt*)&(Adapter->caDsxReqResp[LEADER_SIZE]))->u8Type = DSC_ACK;\r\n}\r\ncase DSC_ACK:\r\n{\r\nUINT uiSearchRuleIndex=0;\r\npstChangeIndication = (stLocalSFChangeIndicationAlt *)pstAddIndication;\r\nuiSearchRuleIndex=SearchSfid(Adapter,ntohl(pstChangeIndication->sfActiveSet.u32SFID));\r\nif(uiSearchRuleIndex > NO_OF_QUEUES-1)\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_PRINTK, 0, 0, "SF doesn't exist for which DSC_ACK is received");\r\n}\r\nif((uiSearchRuleIndex < NO_OF_QUEUES))\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].ucDirection = pstChangeIndication->u8Direction;\r\nif(pstChangeIndication->sfActiveSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActiveSet=TRUE;\r\n}\r\nif(pstChangeIndication->sfAuthorizedSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bAuthorizedSet=TRUE;\r\n}\r\nif(pstChangeIndication->sfAdmittedSet.bValid==TRUE)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bAdmittedSet=TRUE;\r\n}\r\nif(FALSE==pstChangeIndication->sfActiveSet.bValid)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive = FALSE;\r\nAdapter->PackInfo[uiSearchRuleIndex].bActivateRequestSent = FALSE;\r\nif(pstChangeIndication->sfAdmittedSet.bValid)\r\n{\r\npsfLocalSet = &pstChangeIndication->sfAdmittedSet;\r\n}\r\nelse if(pstChangeIndication->sfAuthorizedSet.bValid)\r\n{\r\npsfLocalSet = &pstChangeIndication->sfAuthorizedSet;\r\n}\r\n}\r\nelse\r\n{\r\npsfLocalSet = &pstChangeIndication->sfActiveSet;\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=TRUE;\r\n}\r\nif(psfLocalSet->bValid && (pstChangeIndication->u8CC == 0))\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value =\r\nntohs(pstChangeIndication->u16VCID);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "CC field is %d bvalid = %d\n",\r\npstChangeIndication->u8CC, psfLocalSet->bValid);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "VCID= %d\n", ntohs(pstChangeIndication->u16VCID));\r\nAdapter->PackInfo[uiSearchRuleIndex].usCID =\r\nntohs(pstChangeIndication->u16CID);\r\nCopyToAdapter(Adapter,psfLocalSet,uiSearchRuleIndex,\r\nDSC_ACK, pstAddIndication);\r\n*(PULONG)(((PUCHAR)pvBuffer)+1)=psfLocalSet->u32SFID;\r\n}\r\nelse if(pstChangeIndication->u8CC == 6)\r\n{\r\ndeleteSFBySfid(Adapter,uiSearchRuleIndex);\r\nkfree(pstAddIndication);\r\n}\r\n}\r\nelse\r\n{\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_PRINTK, 0, 0, "DSC ACK did not get valid SFID");\r\nkfree(pstAddIndication);\r\nreturn FALSE;\r\n}\r\n}\r\nbreak;\r\ncase DSD_REQ:\r\n{\r\nUINT uiSearchRuleIndex;\r\nULONG ulSFID;\r\npLeader->PLength = sizeof(stLocalSFDeleteIndication);\r\n*((stLocalSFDeleteIndication*)&(Adapter->caDsxReqResp[LEADER_SIZE])) = *((stLocalSFDeleteIndication*)pstAddIndication);\r\nulSFID = ntohl(((stLocalSFDeleteIndication*)pstAddIndication)->u32SFID);\r\nuiSearchRuleIndex=SearchSfid(Adapter,ulSFID);\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "DSD - Removing connection %x",uiSearchRuleIndex);\r\nif(uiSearchRuleIndex < NO_OF_QUEUES)\r\n{\r\ndeleteSFBySfid(Adapter,uiSearchRuleIndex);\r\nAdapter->u32TotalDSD++;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SENDING DSD RESPONSE TO MAC");\r\n((stLocalSFDeleteIndication*)&(Adapter->caDsxReqResp[LEADER_SIZE]))->u8Type = DSD_RSP;\r\nCopyBufferToControlPacket(Adapter,(PVOID)Adapter->caDsxReqResp);\r\n}\r\ncase DSD_RSP:\r\n{\r\n}\r\nbreak;\r\ncase DSD_ACK:\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "DSD ACK Rcd, let App handle it\n");\r\nbreak;\r\ndefault:\r\nkfree(pstAddIndication);\r\nreturn FALSE ;\r\n}\r\nreturn TRUE;\r\n}\r\nint get_dsx_sf_data_to_application(PMINI_ADAPTER Adapter, UINT uiSFId, void __user *user_buffer)\r\n{\r\nint status = 0;\r\nstruct _packet_info *psSfInfo=NULL;\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "status =%d",status);\r\nstatus = SearchSfid(Adapter, uiSFId);\r\nif (status >= NO_OF_QUEUES) {\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "SFID %d not present in queue !!!", uiSFId );\r\nreturn -EINVAL;\r\n}\r\nBCM_DEBUG_PRINT( Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "status =%d",status);\r\npsSfInfo=&Adapter->PackInfo[status];\r\nif(psSfInfo->pstSFIndication && copy_to_user(user_buffer,\r\npsSfInfo->pstSFIndication, sizeof(stLocalSFAddIndicationAlt)))\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_PRINTK, 0, 0, "copy to user failed SFID %d, present in queue !!!", uiSFId );\r\nstatus = -EFAULT;\r\nreturn status;\r\n}\r\nreturn STATUS_SUCCESS;\r\n}\r\nVOID OverrideServiceFlowParams(PMINI_ADAPTER Adapter,PUINT puiBuffer)\r\n{\r\nB_UINT32 u32NumofSFsinMsg = ntohl(*(puiBuffer + 1));\r\nstIM_SFHostNotify *pHostInfo = NULL;\r\nUINT uiSearchRuleIndex = 0;\r\nULONG ulSFID = 0;\r\npuiBuffer+=2;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL, "u32NumofSFsinMsg: 0x%x\n",u32NumofSFsinMsg);\r\nwhile(u32NumofSFsinMsg != 0 && u32NumofSFsinMsg < NO_OF_QUEUES)\r\n{\r\nu32NumofSFsinMsg--;\r\npHostInfo = (stIM_SFHostNotify *)puiBuffer;\r\npuiBuffer = (PUINT)(pHostInfo + 1);\r\nulSFID = ntohl(pHostInfo->SFID);\r\nuiSearchRuleIndex=SearchSfid(Adapter,ulSFID);\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"SFID: 0x%lx\n",ulSFID);\r\nif(uiSearchRuleIndex >= NO_OF_QUEUES || uiSearchRuleIndex == HiPriority)\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"The SFID <%lx> doesn't exist in host entry or is Invalid\n", ulSFID);\r\ncontinue;\r\n}\r\nif(pHostInfo->RetainSF == FALSE)\r\n{\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"Going to Delete SF");\r\ndeleteSFBySfid(Adapter,uiSearchRuleIndex);\r\n}\r\nelse\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].usVCID_Value = ntohs(pHostInfo->VCID);\r\nAdapter->PackInfo[uiSearchRuleIndex].usCID = ntohs(pHostInfo->newCID);\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=FALSE;\r\nBCM_DEBUG_PRINT(Adapter,DBG_TYPE_OTHERS, CONN_MSG, DBG_LVL_ALL,"pHostInfo->QoSParamSet: 0x%x\n",pHostInfo->QoSParamSet);\r\nif(pHostInfo->QoSParamSet & 0x1)\r\nAdapter->PackInfo[uiSearchRuleIndex].bAuthorizedSet =TRUE;\r\nif(pHostInfo->QoSParamSet & 0x2)\r\nAdapter->PackInfo[uiSearchRuleIndex].bAdmittedSet =TRUE;\r\nif(pHostInfo->QoSParamSet & 0x4)\r\n{\r\nAdapter->PackInfo[uiSearchRuleIndex].bActiveSet =TRUE;\r\nAdapter->PackInfo[uiSearchRuleIndex].bActive=TRUE;\r\n}\r\n}\r\n}\r\n}
