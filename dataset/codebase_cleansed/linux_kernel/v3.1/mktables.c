static uint8_t gfmul(uint8_t a, uint8_t b)\r\n{\r\nuint8_t v = 0;\r\nwhile (b) {\r\nif (b & 1)\r\nv ^= a;\r\na = (a << 1) ^ (a & 0x80 ? 0x1d : 0);\r\nb >>= 1;\r\n}\r\nreturn v;\r\n}\r\nstatic uint8_t gfpow(uint8_t a, int b)\r\n{\r\nuint8_t v = 1;\r\nb %= 255;\r\nif (b < 0)\r\nb += 255;\r\nwhile (b) {\r\nif (b & 1)\r\nv = gfmul(v, a);\r\na = gfmul(a, a);\r\nb >>= 1;\r\n}\r\nreturn v;\r\n}\r\nint main(int argc, char *argv[])\r\n{\r\nint i, j, k;\r\nuint8_t v;\r\nuint8_t exptbl[256], invtbl[256];\r\nprintf("#include <linux/raid/pq.h>\n");\r\nprintf("\nconst u8 __attribute__((aligned(256)))\n"\r\n"raid6_gfmul[256][256] =\n"\r\n"{\n");\r\nfor (i = 0; i < 256; i++) {\r\nprintf("\t{\n");\r\nfor (j = 0; j < 256; j += 8) {\r\nprintf("\t\t");\r\nfor (k = 0; k < 8; k++)\r\nprintf("0x%02x,%c", gfmul(i, j + k),\r\n(k == 7) ? '\n' : ' ');\r\n}\r\nprintf("\t},\n");\r\n}\r\nprintf("};\n");\r\nprintf("#ifdef __KERNEL__\n");\r\nprintf("EXPORT_SYMBOL(raid6_gfmul);\n");\r\nprintf("#endif\n");\r\nv = 1;\r\nprintf("\nconst u8 __attribute__((aligned(256)))\n"\r\n"raid6_gfexp[256] =\n" "{\n");\r\nfor (i = 0; i < 256; i += 8) {\r\nprintf("\t");\r\nfor (j = 0; j < 8; j++) {\r\nexptbl[i + j] = v;\r\nprintf("0x%02x,%c", v, (j == 7) ? '\n' : ' ');\r\nv = gfmul(v, 2);\r\nif (v == 1)\r\nv = 0;\r\n}\r\n}\r\nprintf("};\n");\r\nprintf("#ifdef __KERNEL__\n");\r\nprintf("EXPORT_SYMBOL(raid6_gfexp);\n");\r\nprintf("#endif\n");\r\nprintf("\nconst u8 __attribute__((aligned(256)))\n"\r\n"raid6_gfinv[256] =\n" "{\n");\r\nfor (i = 0; i < 256; i += 8) {\r\nprintf("\t");\r\nfor (j = 0; j < 8; j++) {\r\ninvtbl[i + j] = v = gfpow(i + j, 254);\r\nprintf("0x%02x,%c", v, (j == 7) ? '\n' : ' ');\r\n}\r\n}\r\nprintf("};\n");\r\nprintf("#ifdef __KERNEL__\n");\r\nprintf("EXPORT_SYMBOL(raid6_gfinv);\n");\r\nprintf("#endif\n");\r\nprintf("\nconst u8 __attribute__((aligned(256)))\n"\r\n"raid6_gfexi[256] =\n" "{\n");\r\nfor (i = 0; i < 256; i += 8) {\r\nprintf("\t");\r\nfor (j = 0; j < 8; j++)\r\nprintf("0x%02x,%c", invtbl[exptbl[i + j] ^ 1],\r\n(j == 7) ? '\n' : ' ');\r\n}\r\nprintf("};\n");\r\nprintf("#ifdef __KERNEL__\n");\r\nprintf("EXPORT_SYMBOL(raid6_gfexi);\n");\r\nprintf("#endif\n");\r\nreturn 0;\r\n}
