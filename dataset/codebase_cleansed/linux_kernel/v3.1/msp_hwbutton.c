static void softreset_push(void *data)\r\n{\r\nprintk(KERN_WARNING "SOFTRESET switch was pushed\n");\r\nmsp_restart(NULL);\r\n}\r\nstatic void softreset_release(void *data)\r\n{\r\nprintk(KERN_WARNING "SOFTRESET switch was released\n");\r\n}\r\nstatic void standby_on(void *data)\r\n{\r\nprintk(KERN_WARNING "STANDBY switch was set to ON (not implemented)\n");\r\n}\r\nstatic void standby_off(void *data)\r\n{\r\nprintk(KERN_WARNING\r\n"STANDBY switch was set to OFF (not implemented)\n");\r\n}\r\nstatic irqreturn_t hwbutton_handler(int irq, void *data)\r\n{\r\nstruct hwbutton_interrupt *hirq = data;\r\nunsigned long cic_ext = *CIC_EXT_CFG_REG;\r\nif (CIC_EXT_IS_ACTIVE_HI(cic_ext, hirq->eirq)) {\r\nCIC_EXT_SET_ACTIVE_LO(cic_ext, hirq->eirq);\r\nhirq->handle_hi(hirq->data);\r\n} else {\r\nCIC_EXT_SET_ACTIVE_HI(cic_ext, hirq->eirq);\r\nhirq->handle_lo(hirq->data);\r\n}\r\n*CIC_EXT_CFG_REG = cic_ext;\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic int msp_hwbutton_register(struct hwbutton_interrupt *hirq)\r\n{\r\nunsigned long cic_ext;\r\nif (hirq->handle_hi == NULL || hirq->handle_lo == NULL)\r\nreturn -EINVAL;\r\ncic_ext = *CIC_EXT_CFG_REG;\r\nCIC_EXT_SET_TRIGGER_LEVEL(cic_ext, hirq->eirq);\r\nif (hirq->initial_state == HWBUTTON_HI)\r\nCIC_EXT_SET_ACTIVE_LO(cic_ext, hirq->eirq);\r\nelse\r\nCIC_EXT_SET_ACTIVE_HI(cic_ext, hirq->eirq);\r\n*CIC_EXT_CFG_REG = cic_ext;\r\nreturn request_irq(hirq->irq, hwbutton_handler, IRQF_DISABLED,\r\nhirq->name, hirq);\r\n}\r\nstatic int __init msp_hwbutton_setup(void)\r\n{\r\n#ifdef CONFIG_PMC_MSP7120_GW\r\nmsp_hwbutton_register(&softreset_sw);\r\nmsp_hwbutton_register(&standby_sw);\r\n#endif\r\nreturn 0;\r\n}
