static int\r\njornada720_pcmcia_configure_socket(struct soc_pcmcia_socket *skt, const socket_state_t *state)\r\n{\r\nstruct sa1111_pcmcia_socket *s = to_skt(skt);\r\nunsigned int pa_dwr_mask, pa_dwr_set;\r\nint ret;\r\nprintk(KERN_INFO "%s(): config socket %d vcc %d vpp %d\n", __func__,\r\nskt->nr, state->Vcc, state->Vpp);\r\nswitch (skt->nr) {\r\ncase 0:\r\npa_dwr_mask = SOCKET0_POWER | SOCKET0_3V;\r\nswitch (state->Vcc) {\r\ndefault:\r\ncase 0:\r\npa_dwr_set = 0;\r\nbreak;\r\ncase 33:\r\npa_dwr_set = SOCKET0_POWER | SOCKET0_3V;\r\nbreak;\r\ncase 50:\r\npa_dwr_set = SOCKET0_POWER;\r\nbreak;\r\n}\r\nbreak;\r\ncase 1:\r\npa_dwr_mask = SOCKET1_POWER;\r\nswitch (state->Vcc) {\r\ndefault:\r\ncase 0:\r\npa_dwr_set = 0;\r\nbreak;\r\ncase 33:\r\npa_dwr_set = SOCKET1_POWER;\r\nbreak;\r\ncase 50:\r\npa_dwr_set = SOCKET1_POWER;\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nreturn -1;\r\n}\r\nif (state->Vpp != state->Vcc && state->Vpp != 0) {\r\nprintk(KERN_ERR "%s(): slot cannot support VPP %u\n",\r\n__func__, state->Vpp);\r\nreturn -EPERM;\r\n}\r\nret = sa1111_pcmcia_configure_socket(skt, state);\r\nif (ret == 0) {\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nsa1111_set_io(s->dev, pa_dwr_mask, pa_dwr_set);\r\nlocal_irq_restore(flags);\r\n}\r\nreturn ret;\r\n}\r\nint __devinit pcmcia_jornada720_init(struct device *dev)\r\n{\r\nint ret = -ENODEV;\r\nif (machine_is_jornada720()) {\r\nunsigned int pin = GPIO_A0 | GPIO_A1 | GPIO_A2 | GPIO_A3;\r\nGRER |= 0x00000002;\r\nsa1111_set_io_dir(dev, pin, 0, 0);\r\nsa1111_set_io(dev, pin, 0);\r\nsa1111_set_sleep_io(dev, pin, 0);\r\nsa11xx_drv_pcmcia_ops(&jornada720_pcmcia_ops);\r\nret = sa1111_pcmcia_add(dev, &jornada720_pcmcia_ops,\r\nsa11xx_drv_pcmcia_add_one);\r\n}\r\nreturn ret;\r\n}
