void __secure_computing(int this_syscall)\r\n{\r\nint mode = current->seccomp.mode;\r\nint * syscall;\r\nswitch (mode) {\r\ncase 1:\r\nsyscall = mode1_syscalls;\r\n#ifdef CONFIG_COMPAT\r\nif (is_compat_task())\r\nsyscall = mode1_syscalls_32;\r\n#endif\r\ndo {\r\nif (*syscall == this_syscall)\r\nreturn;\r\n} while (*++syscall);\r\nbreak;\r\ndefault:\r\nBUG();\r\n}\r\n#ifdef SECCOMP_DEBUG\r\ndump_stack();\r\n#endif\r\ndo_exit(SIGKILL);\r\n}\r\nlong prctl_get_seccomp(void)\r\n{\r\nreturn current->seccomp.mode;\r\n}\r\nlong prctl_set_seccomp(unsigned long seccomp_mode)\r\n{\r\nlong ret;\r\nret = -EPERM;\r\nif (unlikely(current->seccomp.mode))\r\ngoto out;\r\nret = -EINVAL;\r\nif (seccomp_mode && seccomp_mode <= NR_SECCOMP_MODES) {\r\ncurrent->seccomp.mode = seccomp_mode;\r\nset_thread_flag(TIF_SECCOMP);\r\n#ifdef TIF_NOTSC\r\ndisable_TSC();\r\n#endif\r\nret = 0;\r\n}\r\nout:\r\nreturn ret;\r\n}
