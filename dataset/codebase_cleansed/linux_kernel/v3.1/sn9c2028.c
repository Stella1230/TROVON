static int sn9c2028_command(struct gspca_dev *gspca_dev, u8 *command)\r\n{\r\nint rc;\r\nPDEBUG(D_USBO, "sending command %02x%02x%02x%02x%02x%02x", command[0],\r\ncommand[1], command[2], command[3], command[4], command[5]);\r\nmemcpy(gspca_dev->usb_buf, command, 6);\r\nrc = usb_control_msg(gspca_dev->dev,\r\nusb_sndctrlpipe(gspca_dev->dev, 0),\r\nUSB_REQ_GET_CONFIGURATION,\r\nUSB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\r\n2, 0, gspca_dev->usb_buf, 6, 500);\r\nif (rc < 0) {\r\nerr("command write [%02x] error %d",\r\ngspca_dev->usb_buf[0], rc);\r\nreturn rc;\r\n}\r\nreturn 0;\r\n}\r\nstatic int sn9c2028_read1(struct gspca_dev *gspca_dev)\r\n{\r\nint rc;\r\nrc = usb_control_msg(gspca_dev->dev,\r\nusb_rcvctrlpipe(gspca_dev->dev, 0),\r\nUSB_REQ_GET_STATUS,\r\nUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\r\n1, 0, gspca_dev->usb_buf, 1, 500);\r\nif (rc != 1) {\r\nerr("read1 error %d", rc);\r\nreturn (rc < 0) ? rc : -EIO;\r\n}\r\nPDEBUG(D_USBI, "read1 response %02x", gspca_dev->usb_buf[0]);\r\nreturn gspca_dev->usb_buf[0];\r\n}\r\nstatic int sn9c2028_read4(struct gspca_dev *gspca_dev, u8 *reading)\r\n{\r\nint rc;\r\nrc = usb_control_msg(gspca_dev->dev,\r\nusb_rcvctrlpipe(gspca_dev->dev, 0),\r\nUSB_REQ_GET_STATUS,\r\nUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\r\n4, 0, gspca_dev->usb_buf, 4, 500);\r\nif (rc != 4) {\r\nerr("read4 error %d", rc);\r\nreturn (rc < 0) ? rc : -EIO;\r\n}\r\nmemcpy(reading, gspca_dev->usb_buf, 4);\r\nPDEBUG(D_USBI, "read4 response %02x%02x%02x%02x", reading[0],\r\nreading[1], reading[2], reading[3]);\r\nreturn rc;\r\n}\r\nstatic int sn9c2028_long_command(struct gspca_dev *gspca_dev, u8 *command)\r\n{\r\nint i, status;\r\n__u8 reading[4];\r\nstatus = sn9c2028_command(gspca_dev, command);\r\nif (status < 0)\r\nreturn status;\r\nstatus = -1;\r\nfor (i = 0; i < 256 && status < 2; i++)\r\nstatus = sn9c2028_read1(gspca_dev);\r\nif (status != 2) {\r\nerr("long command status read error %d", status);\r\nreturn (status < 0) ? status : -EIO;\r\n}\r\nmemset(reading, 0, 4);\r\nstatus = sn9c2028_read4(gspca_dev, reading);\r\nif (status < 0)\r\nreturn status;\r\nstatus = sn9c2028_read1(gspca_dev);\r\nif (status < 0)\r\nreturn status;\r\nreturn 0;\r\n}\r\nstatic int sn9c2028_short_command(struct gspca_dev *gspca_dev, u8 *command)\r\n{\r\nint err_code;\r\nerr_code = sn9c2028_command(gspca_dev, command);\r\nif (err_code < 0)\r\nreturn err_code;\r\nerr_code = sn9c2028_read1(gspca_dev);\r\nif (err_code < 0)\r\nreturn err_code;\r\nreturn 0;\r\n}\r\nstatic int sd_config(struct gspca_dev *gspca_dev,\r\nconst struct usb_device_id *id)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nstruct cam *cam = &gspca_dev->cam;\r\nPDEBUG(D_PROBE, "SN9C2028 camera detected (vid/pid 0x%04X:0x%04X)",\r\nid->idVendor, id->idProduct);\r\nsd->model = id->idProduct;\r\nswitch (sd->model) {\r\ncase 0x7005:\r\nPDEBUG(D_PROBE, "Genius Smart 300 camera");\r\nbreak;\r\ncase 0x8000:\r\nPDEBUG(D_PROBE, "DC31VC");\r\nbreak;\r\ncase 0x8001:\r\nPDEBUG(D_PROBE, "Spy camera");\r\nbreak;\r\ncase 0x8003:\r\nPDEBUG(D_PROBE, "CIF camera");\r\nbreak;\r\ncase 0x8008:\r\nPDEBUG(D_PROBE, "Mini-Shotz ms-350 camera");\r\nbreak;\r\ncase 0x800a:\r\nPDEBUG(D_PROBE, "Vivitar 3350b type camera");\r\ncam->input_flags = V4L2_IN_ST_VFLIP | V4L2_IN_ST_HFLIP;\r\nbreak;\r\n}\r\nswitch (sd->model) {\r\ncase 0x8000:\r\ncase 0x8001:\r\ncase 0x8003:\r\ncam->cam_mode = cif_mode;\r\ncam->nmodes = ARRAY_SIZE(cif_mode);\r\nbreak;\r\ndefault:\r\ncam->cam_mode = vga_mode;\r\ncam->nmodes = ARRAY_SIZE(vga_mode);\r\n}\r\nreturn 0;\r\n}\r\nstatic int sd_init(struct gspca_dev *gspca_dev)\r\n{\r\nint status = -1;\r\nsn9c2028_read1(gspca_dev);\r\nsn9c2028_read1(gspca_dev);\r\nstatus = sn9c2028_read1(gspca_dev);\r\nreturn (status < 0) ? status : 0;\r\n}\r\nstatic int run_start_commands(struct gspca_dev *gspca_dev,\r\nstruct init_command *cam_commands, int n)\r\n{\r\nint i, err_code = -1;\r\nfor (i = 0; i < n; i++) {\r\nswitch (cam_commands[i].to_read) {\r\ncase 4:\r\nerr_code = sn9c2028_long_command(gspca_dev,\r\ncam_commands[i].instruction);\r\nbreak;\r\ncase 1:\r\nerr_code = sn9c2028_short_command(gspca_dev,\r\ncam_commands[i].instruction);\r\nbreak;\r\ncase 0:\r\nerr_code = sn9c2028_command(gspca_dev,\r\ncam_commands[i].instruction);\r\nbreak;\r\n}\r\nif (err_code < 0)\r\nreturn err_code;\r\n}\r\nreturn 0;\r\n}\r\nstatic int start_spy_cam(struct gspca_dev *gspca_dev)\r\n{\r\nstruct init_command spy_start_commands[] = {\r\n{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x22, 0x01, 0x04, 0x00, 0x00}, 4},\r\n{{0x13, 0x23, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x68, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\r\n{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\r\n{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x02, 0x06, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x03, 0x13, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x04, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x05, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x06, 0xb1, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x07, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x08, 0x0b, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x09, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0a, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0b, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0c, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0d, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0e, 0x04, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0f, 0x04, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x10, 0x06, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x11, 0x06, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x14, 0x02, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x13, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x02, 0x11, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x13, 0x11, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1},\r\n};\r\nreturn run_start_commands(gspca_dev, spy_start_commands,\r\nARRAY_SIZE(spy_start_commands));\r\n}\r\nstatic int start_cif_cam(struct gspca_dev *gspca_dev)\r\n{\r\nstruct init_command cif_start_commands[] = {\r\n{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x21, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x17, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x19, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x02, 0x06, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x03, 0x5a, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x04, 0x27, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x05, 0x01, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x12, 0x14, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x13, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x14, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x15, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x16, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x77, 0xa2, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x06, 0x0f, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x07, 0x14, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x08, 0x0f, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x09, 0x10, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x0e, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x0f, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x12, 0x07, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x10, 0x1f, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\r\n{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 1},\r\n{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 1},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x01, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x08, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x06, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x04, 0x6d, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x05, 0x03, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x36, 0x06, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x0e, 0x01, 0x00, 0x00, 0x00}, 1},\r\n{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x0f, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x36, 0x05, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x10, 0x0f, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x02, 0x06, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1},\r\n};\r\nreturn run_start_commands(gspca_dev, cif_start_commands,\r\nARRAY_SIZE(cif_start_commands));\r\n}\r\nstatic int start_ms350_cam(struct gspca_dev *gspca_dev)\r\n{\r\nstruct init_command ms350_start_commands[] = {\r\n{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x16, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x22, 0x01, 0x04, 0x00, 0x00}, 4},\r\n{{0x13, 0x23, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x28, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\r\n{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\r\n{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x00, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x01, 0x70, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x02, 0x05, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x03, 0x5d, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x04, 0x07, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x05, 0x25, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x06, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x07, 0x09, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x08, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x09, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0a, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0b, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0c, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0d, 0x0c, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0e, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x0f, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x11, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x13, 0x63, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x15, 0x70, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x18, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x11, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x28, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x40, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\r\n{{0x1b, 0x02, 0x05, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x18, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x02, 0x0a, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 0},\r\n};\r\nreturn run_start_commands(gspca_dev, ms350_start_commands,\r\nARRAY_SIZE(ms350_start_commands));\r\n}\r\nstatic int start_genius_cam(struct gspca_dev *gspca_dev)\r\n{\r\nstruct init_command genius_start_commands[] = {\r\n{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x16, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x10, 0x00, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x22, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\r\n{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x11, 0x64, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x13, 0x91, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x15, 0x20, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x16, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x17, 0x60, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x25, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x26, 0x02, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x27, 0x88, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x30, 0x38, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x31, 0x2a, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x32, 0x2a, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x33, 0x2a, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x34, 0x02, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x5b, 0x0a, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x62, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\r\n{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x21, 0x2a, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x23, 0x28, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x11, 0x04, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x13, 0x03, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x15, 0xe0, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x16, 0x02, 0x00, 0x00, 0x00}, 4},\r\n{{0x11, 0x17, 0x80, 0x00, 0x00, 0x00}, 4},\r\n{{0x1c, 0x20, 0x00, 0x2a, 0x00, 0x00}, 1},\r\n{{0x1c, 0x20, 0x00, 0x2a, 0x00, 0x00}, 1},\r\n{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 0}\r\n};\r\nreturn run_start_commands(gspca_dev, genius_start_commands,\r\nARRAY_SIZE(genius_start_commands));\r\n}\r\nstatic int start_vivitar_cam(struct gspca_dev *gspca_dev)\r\n{\r\nstruct init_command vivitar_start_commands[] = {\r\n{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x22, 0x01, 0x01, 0x00, 0x00}, 4},\r\n{{0x13, 0x23, 0x01, 0x01, 0x00, 0x00}, 4},\r\n{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},\r\n{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},\r\n{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\r\n{{0x13, 0x28, 0x01, 0x0a, 0x00, 0x00}, 4},\r\n{{0x13, 0x29, 0x01, 0x20, 0x00, 0x00}, 4},\r\n{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\r\n{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\r\n{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\r\n{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\r\n{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\r\n{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x12, 0x80, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x01, 0x77, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x02, 0x3a, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x12, 0x78, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x13, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x14, 0x80, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x15, 0x34, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x1b, 0x04, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x20, 0x44, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x23, 0xee, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x26, 0xa0, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x27, 0x9a, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x28, 0xa0, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x29, 0x30, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x2a, 0x80, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x2b, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x2f, 0x3d, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x30, 0x24, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x32, 0x86, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x60, 0xa9, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x61, 0x42, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x65, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x69, 0x38, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x6f, 0x88, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x70, 0x0b, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x71, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x74, 0x21, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x75, 0x86, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x76, 0x00, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x7d, 0xf3, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x17, 0x1c, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x18, 0xc0, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x19, 0x05, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x1a, 0xf6, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x36, 0x06, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x10, 0x26, 0x00, 0x00, 0x00}, 1},\r\n{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x1b, 0x76, 0x03, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x36, 0x05, 0x00, 0x00, 0x00}, 1},\r\n{{0x1b, 0x00, 0x3f, 0x00, 0x00, 0x00}, 1},\r\n{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\r\n{{0x20, 0x29, 0x30, 0x00, 0x00, 0x00}, 1},\r\n{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1}\r\n};\r\nreturn run_start_commands(gspca_dev, vivitar_start_commands,\r\nARRAY_SIZE(vivitar_start_commands));\r\n}\r\nstatic int sd_start(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nint err_code;\r\nsd->sof_read = 0;\r\nswitch (sd->model) {\r\ncase 0x7005:\r\nerr_code = start_genius_cam(gspca_dev);\r\nbreak;\r\ncase 0x8001:\r\nerr_code = start_spy_cam(gspca_dev);\r\nbreak;\r\ncase 0x8003:\r\nerr_code = start_cif_cam(gspca_dev);\r\nbreak;\r\ncase 0x8008:\r\nerr_code = start_ms350_cam(gspca_dev);\r\nbreak;\r\ncase 0x800a:\r\nerr_code = start_vivitar_cam(gspca_dev);\r\nbreak;\r\ndefault:\r\nerr("Starting unknown camera, please report this");\r\nreturn -ENXIO;\r\n}\r\nreturn err_code;\r\n}\r\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\r\n{\r\nint result;\r\n__u8 data[6];\r\nresult = sn9c2028_read1(gspca_dev);\r\nif (result < 0)\r\nPDEBUG(D_ERR, "Camera Stop read failed");\r\nmemset(data, 0, 6);\r\ndata[0] = 0x14;\r\nresult = sn9c2028_command(gspca_dev, data);\r\nif (result < 0)\r\nPDEBUG(D_ERR, "Camera Stop command failed");\r\n}\r\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\r\n__u8 *data,\r\nint len)\r\n{\r\nunsigned char *sof;\r\nsof = sn9c2028_find_sof(gspca_dev, data, len);\r\nif (sof) {\r\nint n;\r\nn = sof - data;\r\nif (n > sizeof sn9c2028_sof_marker)\r\nn -= sizeof sn9c2028_sof_marker;\r\nelse\r\nn = 0;\r\ngspca_frame_add(gspca_dev, LAST_PACKET, data, n);\r\ngspca_frame_add(gspca_dev, FIRST_PACKET,\r\nsn9c2028_sof_marker, sizeof sn9c2028_sof_marker);\r\nlen -= sof - data;\r\ndata = sof;\r\n}\r\ngspca_frame_add(gspca_dev, INTER_PACKET, data, len);\r\n}\r\nstatic int sd_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nreturn gspca_dev_probe(intf, id, &sd_desc, sizeof(struct sd),\r\nTHIS_MODULE);\r\n}\r\nstatic int __init sd_mod_init(void)\r\n{\r\nreturn usb_register(&sd_driver);\r\n}\r\nstatic void __exit sd_mod_exit(void)\r\n{\r\nusb_deregister(&sd_driver);\r\n}
