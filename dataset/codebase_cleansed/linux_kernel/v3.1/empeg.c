static int empeg_startup(struct usb_serial *serial)\r\n{\r\nint r;\r\ndbg("%s", __func__);\r\nif (serial->dev->actconfig->desc.bConfigurationValue != 1) {\r\ndev_err(&serial->dev->dev, "active config #%d != 1 ??\n",\r\nserial->dev->actconfig->desc.bConfigurationValue);\r\nreturn -ENODEV;\r\n}\r\ndbg("%s - reset config", __func__);\r\nr = usb_reset_configuration(serial->dev);\r\nreturn r;\r\n}\r\nstatic void empeg_init_termios(struct tty_struct *tty)\r\n{\r\nstruct ktermios *termios = tty->termios;\r\ntermios->c_iflag\r\n&= ~(IGNBRK\r\n| BRKINT\r\n| PARMRK\r\n| ISTRIP\r\n| INLCR\r\n| IGNCR\r\n| ICRNL\r\n| IXON);\r\ntermios->c_oflag\r\n&= ~OPOST;\r\ntermios->c_lflag\r\n&= ~(ECHO\r\n| ECHONL\r\n| ICANON\r\n| ISIG\r\n| IEXTEN);\r\ntermios->c_cflag\r\n&= ~(CSIZE\r\n| PARENB\r\n| CBAUD);\r\ntermios->c_cflag\r\n|= CS8;\r\ntty_encode_baud_rate(tty, 115200, 115200);\r\n}\r\nstatic int __init empeg_init(void)\r\n{\r\nint retval;\r\nretval = usb_serial_register(&empeg_device);\r\nif (retval)\r\nreturn retval;\r\nretval = usb_register(&empeg_driver);\r\nif (retval) {\r\nusb_serial_deregister(&empeg_device);\r\nreturn retval;\r\n}\r\nprintk(KERN_INFO KBUILD_MODNAME ": " DRIVER_VERSION ":"\r\nDRIVER_DESC "\n");\r\nreturn 0;\r\n}\r\nstatic void __exit empeg_exit(void)\r\n{\r\nusb_deregister(&empeg_driver);\r\nusb_serial_deregister(&empeg_device);\r\n}
