static int __cmd_record(int argc, const char **argv)\r\n{\r\nint rec_argc, i = 0, j;\r\nconst char **rec_argv;\r\nrec_argc = argc + 2;\r\nrec_argv = calloc(rec_argc + 1, sizeof(char *));\r\nrec_argv[i++] = strdup("record");\r\nrec_argv[i++] = strdup("-o");\r\nrec_argv[i++] = strdup(file_name);\r\nfor (j = 1; j < argc; j++, i++)\r\nrec_argv[i] = argv[j];\r\nBUG_ON(i != rec_argc);\r\nreturn cmd_record(i, rec_argv, NULL);\r\n}\r\nstatic int __cmd_report(int argc, const char **argv)\r\n{\r\nint rec_argc, i = 0, j;\r\nconst char **rec_argv;\r\nrec_argc = argc + 2;\r\nrec_argv = calloc(rec_argc + 1, sizeof(char *));\r\nrec_argv[i++] = strdup("report");\r\nrec_argv[i++] = strdup("-i");\r\nrec_argv[i++] = strdup(file_name);\r\nfor (j = 1; j < argc; j++, i++)\r\nrec_argv[i] = argv[j];\r\nBUG_ON(i != rec_argc);\r\nreturn cmd_report(i, rec_argv, NULL);\r\n}\r\nstatic int __cmd_buildid_list(int argc, const char **argv)\r\n{\r\nint rec_argc, i = 0, j;\r\nconst char **rec_argv;\r\nrec_argc = argc + 2;\r\nrec_argv = calloc(rec_argc + 1, sizeof(char *));\r\nrec_argv[i++] = strdup("buildid-list");\r\nrec_argv[i++] = strdup("-i");\r\nrec_argv[i++] = strdup(file_name);\r\nfor (j = 1; j < argc; j++, i++)\r\nrec_argv[i] = argv[j];\r\nBUG_ON(i != rec_argc);\r\nreturn cmd_buildid_list(i, rec_argv, NULL);\r\n}\r\nint cmd_kvm(int argc, const char **argv, const char *prefix __used)\r\n{\r\nperf_host = perf_guest = 0;\r\nargc = parse_options(argc, argv, kvm_options, kvm_usage,\r\nPARSE_OPT_STOP_AT_NON_OPTION);\r\nif (!argc)\r\nusage_with_options(kvm_usage, kvm_options);\r\nif (!perf_host)\r\nperf_guest = 1;\r\nif (!file_name) {\r\nif (perf_host && !perf_guest)\r\nsprintf(name_buffer, "perf.data.host");\r\nelse if (!perf_host && perf_guest)\r\nsprintf(name_buffer, "perf.data.guest");\r\nelse\r\nsprintf(name_buffer, "perf.data.kvm");\r\nfile_name = name_buffer;\r\n}\r\nif (!strncmp(argv[0], "rec", 3))\r\nreturn __cmd_record(argc, argv);\r\nelse if (!strncmp(argv[0], "rep", 3))\r\nreturn __cmd_report(argc, argv);\r\nelse if (!strncmp(argv[0], "diff", 4))\r\nreturn cmd_diff(argc, argv, NULL);\r\nelse if (!strncmp(argv[0], "top", 3))\r\nreturn cmd_top(argc, argv, NULL);\r\nelse if (!strncmp(argv[0], "buildid-list", 12))\r\nreturn __cmd_buildid_list(argc, argv);\r\nelse\r\nusage_with_options(kvm_usage, kvm_options);\r\nreturn 0;\r\n}
