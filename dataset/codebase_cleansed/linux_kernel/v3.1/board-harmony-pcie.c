static int __init harmony_pcie_init(void)\r\n{\r\nstruct regulator *regulator = NULL;\r\nint err;\r\nif (!machine_is_harmony())\r\nreturn 0;\r\nerr = gpio_request(EN_VDD_1V05_GPIO, "EN_VDD_1V05");\r\nif (err)\r\nreturn err;\r\ngpio_direction_output(EN_VDD_1V05_GPIO, 1);\r\nregulator = regulator_get(NULL, "pex_clk");\r\nif (IS_ERR_OR_NULL(regulator))\r\ngoto err_reg;\r\nregulator_enable(regulator);\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_GPV, TEGRA_TRI_NORMAL);\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_SLXA, TEGRA_TRI_NORMAL);\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_SLXK, TEGRA_TRI_NORMAL);\r\nerr = tegra_pcie_init(true, true);\r\nif (err)\r\ngoto err_pcie;\r\nreturn 0;\r\nerr_pcie:\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_GPV, TEGRA_TRI_TRISTATE);\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_SLXA, TEGRA_TRI_TRISTATE);\r\ntegra_pinmux_set_tristate(TEGRA_PINGROUP_SLXK, TEGRA_TRI_TRISTATE);\r\nregulator_disable(regulator);\r\nregulator_put(regulator);\r\nerr_reg:\r\ngpio_free(EN_VDD_1V05_GPIO);\r\nreturn err;\r\n}
