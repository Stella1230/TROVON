static int __init init_svme182(void)\r\n{\r\nstruct mtd_partition *partitions;\r\nint num_parts = ARRAY_SIZE(svme182_partitions);\r\npartitions = svme182_partitions;\r\nsvme182_map.virt = ioremap(FLASH_BASE_ADDR, svme182_map.size);\r\nif (svme182_map.virt == 0) {\r\nprintk("Failed to ioremap FLASH memory area.\n");\r\nreturn -EIO;\r\n}\r\nsimple_map_init(&svme182_map);\r\nthis_mtd = do_map_probe("cfi_probe", &svme182_map);\r\nif (!this_mtd)\r\n{\r\niounmap((void *)svme182_map.virt);\r\nreturn -ENXIO;\r\n}\r\nprintk(KERN_NOTICE "SVME182 flash device: %dMiB at 0x%08x\n",\r\nthis_mtd->size >> 20, FLASH_BASE_ADDR);\r\nthis_mtd->owner = THIS_MODULE;\r\nmtd_device_register(this_mtd, partitions, num_parts);\r\nreturn 0;\r\n}\r\nstatic void __exit cleanup_svme182(void)\r\n{\r\nif (this_mtd)\r\n{\r\nmtd_device_unregister(this_mtd);\r\nmap_destroy(this_mtd);\r\n}\r\nif (svme182_map.virt)\r\n{\r\niounmap((void *)svme182_map.virt);\r\nsvme182_map.virt = 0;\r\n}\r\nreturn;\r\n}
