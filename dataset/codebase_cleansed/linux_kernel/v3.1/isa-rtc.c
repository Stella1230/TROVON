void __init isa_rtc_init(void)\r\n{\r\nint reg_d, reg_b;\r\nreg_d = CMOS_READ(RTC_REG_D);\r\nCMOS_WRITE(RTC_REF_CLCK_32KHZ, RTC_REG_A);\r\nreg_b = CMOS_READ(RTC_REG_B) & 0x7f;\r\nreg_b |= 2;\r\nCMOS_WRITE(reg_b, RTC_REG_B);\r\nif ((CMOS_READ(RTC_REG_A) & 0x7f) == RTC_REF_CLCK_32KHZ &&\r\nCMOS_READ(RTC_REG_B) == reg_b) {\r\nif ((reg_d & 0x80) == 0)\r\nprintk(KERN_WARNING "RTC: *** warning: CMOS battery bad\n");\r\n}\r\n}
