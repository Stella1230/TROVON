long get_cs3_shadow(void)\r\n{\r\nreturn cs3_shadow;\r\n}\r\nvoid set_cs3(long value)\r\n{\r\n*(CS3BUSTYPE *)(CS3_BASE) = cs3_shadow = value;\r\n}\r\nvoid set_cs3_bit(int value)\r\n{\r\ncs3_shadow |= value;\r\n*(CS3BUSTYPE *)(CS3_BASE) = cs3_shadow;\r\n}\r\nvoid clear_cs3_bit(int value)\r\n{\r\ncs3_shadow &= ~value;\r\n*(CS3BUSTYPE *)(CS3_BASE) = cs3_shadow;\r\n}\r\nstatic void simpad_uart_pm(struct uart_port *port, u_int state, u_int oldstate)\r\n{\r\nif (port->mapbase == (u_int)&Ser1UTCR0) {\r\nif (state)\r\n{\r\nclear_cs3_bit(RS232_ON);\r\nclear_cs3_bit(DECT_POWER_ON);\r\n}else\r\n{\r\nset_cs3_bit(RS232_ON);\r\nset_cs3_bit(DECT_POWER_ON);\r\n}\r\n}\r\n}\r\nstatic void __init simpad_map_io(void)\r\n{\r\nsa1100_map_io();\r\niotable_init(simpad_io_desc, ARRAY_SIZE(simpad_io_desc));\r\nset_cs3_bit (EN1 | EN0 | LED2_ON | DISPLAY_ON | RS232_ON |\r\nENABLE_5V | RESET_SIMCARD | DECT_POWER_ON);\r\nsa1100_register_uart_fns(&simpad_port_fns);\r\nsa1100_register_uart(0, 3);\r\nsa1100_register_uart(1, 1);\r\nGAFR |= GPIO_UART_TXD | GPIO_UART_RXD;\r\nGPDR |= GPIO_UART_TXD | GPIO_LDD13 | GPIO_LDD15;\r\nGPDR &= ~GPIO_UART_RXD;\r\nPPAR |= PPAR_UPR;\r\nPWER = PWER_GPIO0| PWER_RTC;\r\nPGSR = 0x818;\r\nPCFR = 0;\r\nPSDR = 0;\r\n}\r\nstatic void simpad_power_off(void)\r\n{\r\nlocal_irq_disable();\r\nset_cs3(0x800);\r\nPCFR = (PCFR_OPDE | PCFR_FP | PCFR_FS);\r\nPWER = GFER = GRER = 1;\r\nPSPR = 0;\r\nPGSR = 0;\r\nPMCR = PMCR_SF;\r\nwhile(1);\r\nlocal_irq_enable();\r\n}\r\nstatic int __init simpad_init(void)\r\n{\r\nint ret;\r\npm_power_off = simpad_power_off;\r\nsa11x0_register_mtd(&simpad_flash_data, simpad_flash_resources,\r\nARRAY_SIZE(simpad_flash_resources));\r\nsa11x0_register_mcp(&simpad_mcp_data);\r\nret = platform_add_devices(devices, ARRAY_SIZE(devices));\r\nif(ret)\r\nprintk(KERN_WARNING "simpad: Unable to register mq200 framebuffer device");\r\nreturn 0;\r\n}
