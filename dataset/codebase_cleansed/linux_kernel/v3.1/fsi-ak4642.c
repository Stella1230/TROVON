static int fsi_ak4642_dai_init(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_dai *codec = rtd->codec_dai;\r\nstruct snd_soc_dai *cpu = rtd->cpu_dai;\r\nint ret;\r\nret = snd_soc_dai_set_fmt(codec, SND_SOC_DAIFMT_LEFT_J |\r\nSND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(codec, 0, 11289600, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_fmt(cpu, SND_SOC_DAIFMT_LEFT_J |\r\nSND_SOC_DAIFMT_CBS_CFS);\r\nreturn ret;\r\n}\r\nstatic int fsi_ak4642_probe(struct platform_device *pdev)\r\n{\r\nint ret = -ENOMEM;\r\nconst struct platform_device_id *id_entry;\r\nstruct fsi_ak4642_data *pdata;\r\nid_entry = pdev->id_entry;\r\nif (!id_entry) {\r\ndev_err(&pdev->dev, "unknown fsi ak4642\n");\r\nreturn -ENODEV;\r\n}\r\npdata = (struct fsi_ak4642_data *)id_entry->driver_data;\r\nfsi_snd_device = platform_device_alloc("soc-audio", pdata->id);\r\nif (!fsi_snd_device)\r\ngoto out;\r\nfsi_dai_link.name = pdata->name;\r\nfsi_dai_link.stream_name = pdata->name;\r\nfsi_dai_link.cpu_dai_name = pdata->cpu_dai;\r\nfsi_dai_link.platform_name = pdata->platform;\r\nfsi_dai_link.codec_name = pdata->codec;\r\nfsi_soc_card.name = pdata->card;\r\nplatform_set_drvdata(fsi_snd_device, &fsi_soc_card);\r\nret = platform_device_add(fsi_snd_device);\r\nif (ret)\r\nplatform_device_put(fsi_snd_device);\r\nout:\r\nreturn ret;\r\n}\r\nstatic int fsi_ak4642_remove(struct platform_device *pdev)\r\n{\r\nplatform_device_unregister(fsi_snd_device);\r\nreturn 0;\r\n}\r\nstatic int __init fsi_ak4642_init(void)\r\n{\r\nreturn platform_driver_register(&fsi_ak4642);\r\n}\r\nstatic void __exit fsi_ak4642_exit(void)\r\n{\r\nplatform_driver_unregister(&fsi_ak4642);\r\n}
