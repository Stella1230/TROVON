static void __iomem *scu_base_addr(void)\r\n{\r\nreturn (void __iomem *)0xf0000000;\r\n}\r\nstatic void modify_scu_cpu_psr(unsigned long set, unsigned long clr)\r\n{\r\nvoid __iomem *scu_base = scu_base_addr();\r\nspin_lock(&scu_lock);\r\ntmp = __raw_readl(scu_base + 8);\r\ntmp &= ~clr;\r\ntmp |= set;\r\nspin_unlock(&scu_lock);\r\n__raw_writel(tmp, scu_base + 8);\r\n}\r\nunsigned int __init sh73a0_get_core_count(void)\r\n{\r\nvoid __iomem *scu_base = scu_base_addr();\r\n#ifdef CONFIG_HAVE_ARM_TWD\r\ntwd_base = (void __iomem *)0xf0000600;\r\n#endif\r\nreturn scu_get_core_count(scu_base);\r\n}\r\nvoid __cpuinit sh73a0_secondary_init(unsigned int cpu)\r\n{\r\ngic_secondary_init(0);\r\n}\r\nint __cpuinit sh73a0_boot_secondary(unsigned int cpu)\r\n{\r\nmodify_scu_cpu_psr(0, 3 << (cpu * 8));\r\nif (((__raw_readw(__io(PSTR)) >> (4 * cpu)) & 3) == 3)\r\n__raw_writel(1 << cpu, __io(WUPCR));\r\nelse\r\n__raw_writel(1 << cpu, __io(SRESCR));\r\nreturn 0;\r\n}\r\nvoid __init sh73a0_smp_prepare_cpus(void)\r\n{\r\nscu_enable(scu_base_addr());\r\n__raw_writel(0, __io(APARMBAREA));\r\n__raw_writel(__pa(shmobile_secondary_vector), __io(SBAR));\r\nmodify_scu_cpu_psr(0, 3 << (0 * 8));\r\n}
