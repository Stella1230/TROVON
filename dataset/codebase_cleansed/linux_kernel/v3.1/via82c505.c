static int\r\nvia82c505_read_config(struct pci_bus *bus, unsigned int devfn, int where,\r\nint size, u32 *value)\r\n{\r\noutl(CONFIG_CMD(bus,devfn,where),0xCF8);\r\nswitch (size) {\r\ncase 1:\r\n*value=inb(0xCFC + (where&3));\r\nbreak;\r\ncase 2:\r\n*value=inw(0xCFC + (where&2));\r\nbreak;\r\ncase 4:\r\n*value=inl(0xCFC);\r\nbreak;\r\n}\r\nreturn PCIBIOS_SUCCESSFUL;\r\n}\r\nstatic int\r\nvia82c505_write_config(struct pci_bus *bus, unsigned int devfn, int where,\r\nint size, u32 value)\r\n{\r\noutl(CONFIG_CMD(bus,devfn,where),0xCF8);\r\nswitch (size) {\r\ncase 1:\r\noutb(value, 0xCFC + (where&3));\r\nbreak;\r\ncase 2:\r\noutw(value, 0xCFC + (where&2));\r\nbreak;\r\ncase 4:\r\noutl(value, 0xCFC);\r\nbreak;\r\n}\r\nreturn PCIBIOS_SUCCESSFUL;\r\n}\r\nvoid __init via82c505_preinit(void)\r\n{\r\nprintk(KERN_DEBUG "PCI: VIA 82c505\n");\r\nif (!request_region(0xA8,2,"via config")) {\r\nprintk(KERN_WARNING"VIA 82c505: Unable to request region 0xA8\n");\r\nreturn;\r\n}\r\nif (!request_region(0xCF8,8,"pci config")) {\r\nprintk(KERN_WARNING"VIA 82c505: Unable to request region 0xCF8\n");\r\nrelease_region(0xA8, 2);\r\nreturn;\r\n}\r\noutb(0x96,0xA8);\r\noutb(0x18,0xA9);\r\noutb(0x93,0xA8);\r\noutb(0xd0,0xA9);\r\n}\r\nint __init via82c505_setup(int nr, struct pci_sys_data *sys)\r\n{\r\nreturn (nr == 0);\r\n}\r\nstruct pci_bus * __init via82c505_scan_bus(int nr, struct pci_sys_data *sysdata)\r\n{\r\nif (nr == 0)\r\nreturn pci_scan_bus(0, &via82c505_ops, sysdata);\r\nreturn NULL;\r\n}
