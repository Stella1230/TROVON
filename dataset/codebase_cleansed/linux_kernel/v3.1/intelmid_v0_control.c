static int fs_init_card(void)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{0x180, 0x00, 0x0},\r\n{0x181, 0x00, 0x0},\r\n{0x182, 0xF8, 0x0},\r\n{0x183, 0x08, 0x0},\r\n{0x184, 0x00, 0x0},\r\n{0x185, 0x40, 0x0},\r\n{0x186, 0x06, 0x0},\r\n{0x187, 0x80, 0x0},\r\n{0x188, 0x40, 0x0},\r\n{0x189, 0x39, 0x0},\r\n{0x18a, 0x39, 0x0},\r\n{0x18b, 0x1F, 0x0},\r\n{0x18c, 0x00, 0x0},\r\n{0x18d, 0x00, 0x0},\r\n{0x18e, 0x39, 0x0},\r\n{0x18f, 0x39, 0x0},\r\n{0x190, 0x39, 0x0},\r\n{0x191, 0x11, 0x0},\r\n{0x192, 0x0E, 0x0},\r\n{0x193, 0x00, 0x0},\r\n{0x194, 0x00, 0x0},\r\n{0x195, 0x00, 0x0},\r\n{0x196, 0x7C, 0x0},\r\n{0x197, 0x00, 0x0},\r\n{0x198, 0x0B, 0x0},\r\n{0x199, 0x00, 0x0},\r\n{0x037, 0x3F, 0x0},\r\n};\r\nsnd_pmic_ops_fs.card_status = SND_CARD_INIT_DONE;\r\nsnd_pmic_ops_fs.master_mute = UNMUTE;\r\nsnd_pmic_ops_fs.mute_status = UNMUTE;\r\nsnd_pmic_ops_fs.num_channel = 2;\r\nreturn sst_sc_reg_access(sc_access, PMIC_WRITE, 27);\r\n}\r\nstatic int fs_enable_audiodac(int value)\r\n{\r\nstruct sc_reg_access sc_access[3];\r\nsc_access[0].reg_addr = AUD16;\r\nsc_access[1].reg_addr = AUD17;\r\nsc_access[2].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask = sc_access[2].mask = MASK7;\r\nif (snd_pmic_ops_fs.mute_status == MUTE)\r\nreturn 0;\r\nif (value == MUTE) {\r\nsc_access[0].value = sc_access[1].value =\r\nsc_access[2].value = 0x80;\r\n} else {\r\nsc_access[0].value = sc_access[1].value =\r\nsc_access[2].value = 0x0;\r\n}\r\nif (snd_pmic_ops_fs.num_channel == 1)\r\nsc_access[1].value = sc_access[2].value = 0x80;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 3);\r\n}\r\nstatic int fs_power_up_pb(unsigned int port)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{AUDIOBIAS, 0x00, MASK7},\r\n{POWERCTRL1, 0xC6, 0xC6},\r\n{POWERCTRL2, 0x30, 0x30},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nretval = fs_enable_audiodac(MUTE);\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 3);\r\nif (retval)\r\nreturn retval;\r\npr_debug("in fs power up pb\n");\r\nreturn fs_enable_audiodac(UNMUTE);\r\n}\r\nstatic int fs_power_down_pb(unsigned int device)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{POWERCTRL1, 0x00, 0xC6},\r\n{POWERCTRL2, 0x00, 0x30},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nretval = fs_enable_audiodac(MUTE);\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\nif (retval)\r\nreturn retval;\r\npr_debug("in fsl power down pb\n");\r\nreturn fs_enable_audiodac(UNMUTE);\r\n}\r\nstatic int fs_power_up_cp(unsigned int port)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{POWERCTRL2, 0x32, 0x32},\r\n{AUDIOBIAS, 0x00, MASK7},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n}\r\nstatic int fs_power_down_cp(unsigned int device)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{POWERCTRL2, 0x00, 0x03},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 1);\r\n}\r\nstatic int fs_power_down(void)\r\n{\r\nint retval = 0;\r\nstruct sc_reg_access sc_access[] = {\r\n{AUDIOBIAS, MASK7, MASK7},\r\n};\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 1);\r\n}\r\nstatic int fs_set_pcm_voice_params(void)\r\n{\r\nstruct sc_reg_access sc_access[] = {\r\n{0x180, 0xA0, 0},\r\n{0x181, 0x04, 0},\r\n{0x182, 0x0, 0},\r\n{0x183, 0x0, 0},\r\n{0x184, 0x18, 0},\r\n{0x185, 0x40, 0},\r\n{0x186, 0x06, 0},\r\n{0x187, 0x0, 0},\r\n{0x188, 0x10, 0},\r\n{0x189, 0x39, 0},\r\n{0x18a, 0x39, 0},\r\n{0x18b, 0x02, 0},\r\n{0x18c, 0x0, 0},\r\n{0x18d, 0x0, 0},\r\n{0x18e, 0x39, 0},\r\n{0x18f, 0x0, 0},\r\n{0x190, 0x0, 0},\r\n{0x191, 0x20, 0},\r\n{0x192, 0x20, 0},\r\n{0x193, 0x0, 0},\r\n{0x194, 0x0, 0},\r\n{0x195, 0x06, 0},\r\n{0x196, 0x25, 0},\r\n{0x197, 0x0, 0},\r\n{0x198, 0xF, 0},\r\n{0x199, 0x0, 0},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nreturn sst_sc_reg_access(sc_access, PMIC_WRITE, 26);\r\n}\r\nstatic int fs_set_audio_port(int status)\r\n{\r\nstruct sc_reg_access sc_access[2];\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nif (status == DEACTIVATE) {\r\nsc_access[0].value = 0x00;\r\nsc_access[0].mask = MASK6|MASK7;\r\nsc_access[0].reg_addr = AUDIOPORT1;\r\nsc_access[1].value = 0x00;\r\nsc_access[1].mask = MASK4|MASK5;\r\nsc_access[1].reg_addr = POWERCTRL2;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n} else if (status == ACTIVATE) {\r\nsc_access[0].value = 0xC0;\r\nsc_access[0].mask = MASK6|MASK7;\r\nsc_access[0].reg_addr = AUDIOPORT1;\r\nsc_access[1].value = 0x30;\r\nsc_access[1].mask = MASK4|MASK5;\r\nsc_access[1].reg_addr = POWERCTRL2;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n} else\r\nreturn -EINVAL;\r\n}\r\nstatic int fs_set_voice_port(int status)\r\n{\r\nstruct sc_reg_access sc_access[2];\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nif (status == DEACTIVATE) {\r\nsc_access[0].value = 0x00;\r\nsc_access[0].mask = MASK6|MASK7;\r\nsc_access[0].reg_addr = VOICEPORT1;\r\nsc_access[1].value = 0x00;\r\nsc_access[1].mask = MASK0|MASK1;\r\nsc_access[1].reg_addr = POWERCTRL2;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n} else if (status == ACTIVATE) {\r\nsc_access[0].value = 0xC0;\r\nsc_access[0].mask = MASK6|MASK7;\r\nsc_access[0].reg_addr = VOICEPORT1;\r\nsc_access[1].value = 0x03;\r\nsc_access[1].mask = MASK0|MASK1;\r\nsc_access[1].reg_addr = POWERCTRL2;\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n} else\r\nreturn -EINVAL;\r\n}\r\nstatic int fs_set_pcm_audio_params(int sfreq, int word_size, int num_channel)\r\n{\r\nu8 config1 = 0;\r\nstruct sc_reg_access sc_access[4];\r\nint retval = 0, num_value = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (sfreq) {\r\ncase 8000:\r\nconfig1 = 0x00;\r\nbreak;\r\ncase 11025:\r\nconfig1 = 0x01;\r\nbreak;\r\ncase 12000:\r\nconfig1 = 0x02;\r\nbreak;\r\ncase 16000:\r\nconfig1 = 0x03;\r\nbreak;\r\ncase 22050:\r\nconfig1 = 0x04;\r\nbreak;\r\ncase 24000:\r\nconfig1 = 0x05;\r\nbreak;\r\ncase 26000:\r\nconfig1 = 0x06;\r\nbreak;\r\ncase 32000:\r\nconfig1 = 0x07;\r\nbreak;\r\ncase 44100:\r\nconfig1 = 0x08;\r\nbreak;\r\ncase 48000:\r\nconfig1 = 0x09;\r\nbreak;\r\n}\r\nsnd_pmic_ops_fs.num_channel = num_channel;\r\nif (snd_pmic_ops_fs.num_channel == 1) {\r\nsc_access[0].reg_addr = AUD17;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask = MASK7;\r\nsc_access[0].value = sc_access[1].value = 0x80;\r\nsst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n} else {\r\nsc_access[0].reg_addr = AUD17;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask = MASK7;\r\nsc_access[0].value = sc_access[1].value = 0x00;\r\nsst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 2);\r\n}\r\npr_debug("sfreq:%d,Register value = %x\n", sfreq, config1);\r\nif (word_size == 24) {\r\nsc_access[0].reg_addr = AUDIOPORT1;\r\nsc_access[0].mask = MASK0|MASK1|MASK2|MASK3;\r\nsc_access[0].value = 0xFB;\r\nsc_access[1].reg_addr = AUDIOPORT2;\r\nsc_access[1].value = config1 | 0x10;\r\nsc_access[1].mask = MASK0 | MASK1 | MASK2 | MASK3\r\n| MASK4 | MASK5 | MASK6;\r\nsc_access[2].reg_addr = MISCAUDCTRL;\r\nsc_access[2].value = 0x02;\r\nsc_access[2].mask = 0x02;\r\nnum_value = 3 ;\r\n} else {\r\nsc_access[0].reg_addr = AUDIOPORT2;\r\nsc_access[0].value = config1;\r\nsc_access[0].mask = MASK0|MASK1|MASK2|MASK3;\r\nsc_access[1].reg_addr = MISCAUDCTRL;\r\nsc_access[1].value = 0x00;\r\nsc_access[1].mask = 0x02;\r\nnum_value = 2;\r\n}\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, num_value);\r\n}\r\nstatic int fs_set_selected_input_dev(u8 value)\r\n{\r\nstruct sc_reg_access sc_access_dmic[] = {\r\n{MICCTRL, 0x81, 0xf7},\r\n{MICLICTRL3, 0x00, 0xE0},\r\n};\r\nstruct sc_reg_access sc_access_mic[] = {\r\n{MICCTRL, 0x40, MASK2|MASK4|MASK5|MASK6|MASK7},\r\n{MICLICTRL3, 0x00, 0xE0},\r\n};\r\nstruct sc_reg_access sc_access_hsmic[] = {\r\n{MICCTRL, 0x10, MASK2|MASK4|MASK5|MASK6|MASK7},\r\n{MICLICTRL3, 0x00, 0xE0},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (value) {\r\ncase AMIC:\r\npr_debug("Selecting amic not supported in mono cfg\n");\r\nreturn sst_sc_reg_access(sc_access_mic, PMIC_READ_MODIFY, 2);\r\nbreak;\r\ncase HS_MIC:\r\npr_debug("Selecting hsmic\n");\r\nreturn sst_sc_reg_access(sc_access_hsmic,\r\nPMIC_READ_MODIFY, 2);\r\nbreak;\r\ncase DMIC:\r\npr_debug("Selecting dmic\n");\r\nreturn sst_sc_reg_access(sc_access_dmic, PMIC_READ_MODIFY, 2);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n}\r\nstatic int fs_set_selected_output_dev(u8 value)\r\n{\r\nstruct sc_reg_access sc_access_hp[] = {\r\n{0x191, 0x11, 0x0},\r\n{0x192, 0x0E, 0x0},\r\n};\r\nstruct sc_reg_access sc_access_is[] = {\r\n{0x191, 0x17, 0xFF},\r\n{0x192, 0x08, 0xFF},\r\n};\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (value) {\r\ncase STEREO_HEADPHONE:\r\npr_debug("SST DBG:Selecting headphone\n");\r\nreturn sst_sc_reg_access(sc_access_hp, PMIC_WRITE, 2);\r\nbreak;\r\ncase MONO_EARPIECE:\r\ncase INTERNAL_SPKR:\r\npr_debug("SST DBG:Selecting internal spkr\n");\r\nreturn sst_sc_reg_access(sc_access_is, PMIC_READ_MODIFY, 2);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n}\r\nstatic int fs_set_mute(int dev_id, u8 value)\r\n{\r\nstruct sc_reg_access sc_access[6] = {{0,},};\r\nint reg_num = 0;\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\npr_debug("dev_id:0x%x value:0x%x\n", dev_id, value);\r\nswitch (dev_id) {\r\ncase PMIC_SND_DMIC_MUTE:\r\nsc_access[0].reg_addr = MICCTRL;\r\nsc_access[1].reg_addr = MICLICTRL1;\r\nsc_access[2].reg_addr = MICLICTRL2;\r\nsc_access[0].mask = MASK5;\r\nsc_access[1].mask = sc_access[2].mask = MASK6;\r\nif (value == MUTE) {\r\nsc_access[0].value = 0x20;\r\nsc_access[2].value = sc_access[1].value = 0x40;\r\n} else\r\nsc_access[0].value = sc_access[1].value\r\n= sc_access[2].value = 0x0;\r\nreg_num = 3;\r\nbreak;\r\ncase PMIC_SND_HP_MIC_MUTE:\r\ncase PMIC_SND_AMIC_MUTE:\r\nsc_access[0].reg_addr = MICLICTRL1;\r\nsc_access[1].reg_addr = MICLICTRL2;\r\nsc_access[0].mask = sc_access[1].mask = MASK6;\r\nif (value == MUTE)\r\nsc_access[0].value = sc_access[1].value = 0x40;\r\nelse\r\nsc_access[0].value = sc_access[1].value = 0x0;\r\nreg_num = 2;\r\nbreak;\r\ncase PMIC_SND_LEFT_SPEAKER_MUTE:\r\ncase PMIC_SND_LEFT_HP_MUTE:\r\nsc_access[0].reg_addr = AUD16;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask = MASK7;\r\nif (value == MUTE)\r\nsc_access[0].value = sc_access[1].value = 0x80;\r\nelse\r\nsc_access[0].value = sc_access[1].value = 0x0;\r\nreg_num = 2;\r\nsnd_pmic_ops_fs.mute_status = value;\r\nbreak;\r\ncase PMIC_SND_RIGHT_HP_MUTE:\r\ncase PMIC_SND_RIGHT_SPEAKER_MUTE:\r\nsc_access[0].reg_addr = AUD17;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask = MASK7;\r\nif (value == MUTE)\r\nsc_access[0].value = sc_access[1].value = 0x80;\r\nelse\r\nsc_access[0].value = sc_access[1].value = 0x0;\r\nsnd_pmic_ops_fs.mute_status = value;\r\nif (snd_pmic_ops_fs.num_channel == 1)\r\nsc_access[0].value = sc_access[1].value = 0x80;\r\nreg_num = 2;\r\nbreak;\r\ncase PMIC_SND_MUTE_ALL:\r\nsc_access[0].reg_addr = AUD16;\r\nsc_access[1].reg_addr = AUD17;\r\nsc_access[2].reg_addr = AUD15;\r\nsc_access[3].reg_addr = MICCTRL;\r\nsc_access[4].reg_addr = MICLICTRL1;\r\nsc_access[5].reg_addr = MICLICTRL2;\r\nsc_access[0].mask = sc_access[1].mask =\r\nsc_access[2].mask = MASK7;\r\nsc_access[3].mask = MASK5;\r\nsc_access[4].mask = sc_access[5].mask = MASK6;\r\nif (value == MUTE) {\r\nsc_access[0].value =\r\nsc_access[1].value = sc_access[2].value = 0x80;\r\nsc_access[3].value = 0x20;\r\nsc_access[4].value = sc_access[5].value = 0x40;\r\n} else {\r\nsc_access[0].value = sc_access[1].value =\r\nsc_access[2].value = sc_access[3].value =\r\nsc_access[4].value = sc_access[5].value = 0x0;\r\n}\r\nif (snd_pmic_ops_fs.num_channel == 1)\r\nsc_access[1].value = sc_access[2].value = 0x80;\r\nreg_num = 6;\r\nsnd_pmic_ops_fs.mute_status = value;\r\nsnd_pmic_ops_fs.master_mute = value;\r\nbreak;\r\n}\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, reg_num);\r\n}\r\nstatic int fs_set_vol(int dev_id, int value)\r\n{\r\nstruct sc_reg_access sc_acces, sc_access[4] = {{0},};\r\nint reg_num = 0;\r\nint retval = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (dev_id) {\r\ncase PMIC_SND_LEFT_PB_VOL:\r\npr_debug("PMIC_SND_LEFT_PB_VOL:%d\n", value);\r\nsc_access[0].value = sc_access[1].value = value;\r\nsc_access[0].reg_addr = AUD16;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask =\r\n(MASK0|MASK1|MASK2|MASK3|MASK4|MASK5);\r\nreg_num = 2;\r\nbreak;\r\ncase PMIC_SND_RIGHT_PB_VOL:\r\npr_debug("PMIC_SND_RIGHT_PB_VOL:%d\n", value);\r\nsc_access[0].value = sc_access[1].value = value;\r\nsc_access[0].reg_addr = AUD17;\r\nsc_access[1].reg_addr = AUD15;\r\nsc_access[0].mask = sc_access[1].mask =\r\n(MASK0|MASK1|MASK2|MASK3|MASK4|MASK5);\r\nif (snd_pmic_ops_fs.num_channel == 1) {\r\nsc_access[0].value = sc_access[1].value = 0x80;\r\nsc_access[0].mask = sc_access[1].mask = MASK7;\r\n}\r\nreg_num = 2;\r\nbreak;\r\ncase PMIC_SND_CAPTURE_VOL:\r\npr_debug("PMIC_SND_CAPTURE_VOL:%d\n", value);\r\nsc_access[0].reg_addr = MICLICTRL1;\r\nsc_access[1].reg_addr = MICLICTRL2;\r\nsc_access[2].reg_addr = DMICCTRL1;\r\nsc_access[2].value = value;\r\nsc_access[0].value = sc_access[1].value = value;\r\nsc_acces.reg_addr = MICLICTRL3;\r\nsc_acces.value = value;\r\nsc_acces.mask = (MASK0|MASK1|MASK2|MASK3|MASK5|MASK6|MASK7);\r\nretval = sst_sc_reg_access(&sc_acces, PMIC_READ_MODIFY, 1);\r\nsc_access[0].mask = sc_access[1].mask =\r\nsc_access[2].mask = (MASK0|MASK1|MASK2|MASK3|MASK4|MASK5);\r\nreg_num = 3;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn sst_sc_reg_access(sc_access, PMIC_READ_MODIFY, reg_num);\r\n}\r\nstatic int fs_get_mute(int dev_id, u8 *value)\r\n{\r\nstruct sc_reg_access sc_access[6] = {{0,},};\r\nint retval = 0, temp_value = 0, mask = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (dev_id) {\r\ncase PMIC_SND_AMIC_MUTE:\r\ncase PMIC_SND_HP_MIC_MUTE:\r\nsc_access[0].reg_addr = MICLICTRL1;\r\nmask = MASK6;\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ, 1);\r\nif (sc_access[0].value & mask)\r\n*value = MUTE;\r\nelse\r\n*value = UNMUTE;\r\nbreak;\r\ncase PMIC_SND_DMIC_MUTE:\r\nsc_access[0].reg_addr = MICCTRL;\r\nmask = MASK5;\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ, 1);\r\ntemp_value = (sc_access[0].value & mask);\r\nif (temp_value == 0)\r\n*value = UNMUTE;\r\nelse\r\n*value = MUTE;\r\nbreak;\r\ncase PMIC_SND_LEFT_HP_MUTE:\r\ncase PMIC_SND_LEFT_SPEAKER_MUTE:\r\nsc_access[0].reg_addr = AUD16;\r\nmask = MASK7;\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ, 1);\r\ntemp_value = sc_access[0].value & mask;\r\nif (temp_value == 0)\r\n*value = UNMUTE;\r\nelse\r\n*value = MUTE;\r\nbreak;\r\ncase PMIC_SND_RIGHT_HP_MUTE:\r\ncase PMIC_SND_RIGHT_SPEAKER_MUTE:\r\nsc_access[0].reg_addr = AUD17;\r\nmask = MASK7;\r\nretval = sst_sc_reg_access(sc_access, PMIC_READ, 1);\r\ntemp_value = sc_access[0].value & mask;\r\nif (temp_value == 0)\r\n*value = UNMUTE;\r\nelse\r\n*value = MUTE;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn retval;\r\n}\r\nstatic int fs_get_vol(int dev_id, int *value)\r\n{\r\nstruct sc_reg_access sc_access = {0,};\r\nint retval = 0, mask = 0;\r\nif (snd_pmic_ops_fs.card_status == SND_CARD_UN_INIT)\r\nretval = fs_init_card();\r\nif (retval)\r\nreturn retval;\r\nswitch (dev_id) {\r\ncase PMIC_SND_CAPTURE_VOL:\r\npr_debug("PMIC_SND_CAPTURE_VOL\n");\r\nsc_access.reg_addr = MICLICTRL1;\r\nmask = (MASK5|MASK4|MASK3|MASK2|MASK1|MASK0);\r\nbreak;\r\ncase PMIC_SND_LEFT_PB_VOL:\r\npr_debug("PMIC_SND_LEFT_PB_VOL\n");\r\nsc_access.reg_addr = AUD16;\r\nmask = (MASK5|MASK4|MASK3|MASK2|MASK1|MASK0);\r\nbreak;\r\ncase PMIC_SND_RIGHT_PB_VOL:\r\npr_debug("PMIC_SND_RT_PB_VOL\n");\r\nsc_access.reg_addr = AUD17;\r\nmask = (MASK5|MASK4|MASK3|MASK2|MASK1|MASK0);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nretval = sst_sc_reg_access(&sc_access, PMIC_READ, 1);\r\npr_debug("value read = 0x%x\n", sc_access.value);\r\n*value = (int) (sc_access.value & mask);\r\npr_debug("value returned = 0x%x\n", *value);\r\nreturn retval;\r\n}\r\nstatic void fs_pmic_irq_enable(void *data)\r\n{\r\nstruct snd_intelmad *intelmaddata = data;\r\nstruct sc_reg_access sc_access[] = {\r\n{0x187, 0x00, MASK7},\r\n{0x188, 0x10, MASK4},\r\n{0x18b, 0x10, MASK4},\r\n};\r\nstruct sc_reg_access sc_access_write[] = {\r\n{0x198, 0x00, 0x0},\r\n};\r\npr_debug("Audio interrupt enable\n");\r\nsst_sc_reg_access(sc_access, PMIC_READ_MODIFY, 3);\r\nsst_sc_reg_access(sc_access_write, PMIC_WRITE, 1);\r\nintelmaddata->jack[0].jack_status = 0;\r\njack_det_enabled = true;\r\nreturn;\r\n}\r\nstatic void fs_pmic_irq_cb(void *cb_data, u8 value)\r\n{\r\nstruct mad_jack *mjack = NULL;\r\nstruct snd_intelmad *intelmaddata = cb_data;\r\nunsigned int present = 0, jack_event_flag = 0, buttonpressflag = 0;\r\nmjack = &intelmaddata->jack[0];\r\nif (value & 0x4) {\r\nif (!jack_det_enabled)\r\nfs_pmic_irq_enable(intelmaddata);\r\npr_debug(":MAD headphone %d\n", value & 0x4);\r\npresent = !(mjack->jack_status);\r\nmjack->jack_status = present;\r\njack_event_flag = 1;\r\nmjack->jack.type = SND_JACK_HEADPHONE;\r\n}\r\nif (value & 0x2) {\r\npr_debug(":MAD short push %d\n", value & 0x2);\r\npresent = 1;\r\njack_event_flag = 1;\r\nbuttonpressflag = 1;\r\nmjack->jack.type = MID_JACK_HS_SHORT_PRESS;\r\n}\r\nif (value & 0x1) {\r\npr_debug(":MAD long push %d\n", value & 0x1);\r\npresent = 1;\r\njack_event_flag = 1;\r\nbuttonpressflag = 1;\r\nmjack->jack.type = MID_JACK_HS_LONG_PRESS;\r\n}\r\nif (value & 0x8) {\r\nif (!jack_det_enabled)\r\nfs_pmic_irq_enable(intelmaddata);\r\npr_debug(":MAD headset = %d\n", value & 0x8);\r\npresent = !(mjack->jack_status);\r\nmjack->jack_status = present;\r\njack_event_flag = 1;\r\nmjack->jack.type = SND_JACK_HEADSET;\r\n}\r\nif (jack_event_flag)\r\nsst_mad_send_jack_report(&mjack->jack,\r\nbuttonpressflag, present);\r\nreturn;\r\n}\r\nstatic int fs_jack_enable(void)\r\n{\r\nreturn 0;\r\n}
