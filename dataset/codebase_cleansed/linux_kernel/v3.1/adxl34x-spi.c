static int adxl34x_spi_read(struct device *dev, unsigned char reg)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nunsigned char cmd;\r\ncmd = ADXL34X_READCMD(reg);\r\nreturn spi_w8r8(spi, cmd);\r\n}\r\nstatic int adxl34x_spi_write(struct device *dev,\r\nunsigned char reg, unsigned char val)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nunsigned char buf[2];\r\nbuf[0] = ADXL34X_WRITECMD(reg);\r\nbuf[1] = val;\r\nreturn spi_write(spi, buf, sizeof(buf));\r\n}\r\nstatic int adxl34x_spi_read_block(struct device *dev,\r\nunsigned char reg, int count,\r\nvoid *buf)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nssize_t status;\r\nreg = ADXL34X_READMB_CMD(reg);\r\nstatus = spi_write_then_read(spi, &reg, 1, buf, count);\r\nreturn (status < 0) ? status : 0;\r\n}\r\nstatic int __devinit adxl34x_spi_probe(struct spi_device *spi)\r\n{\r\nstruct adxl34x *ac;\r\nif (spi->max_speed_hz > MAX_SPI_FREQ_HZ) {\r\ndev_err(&spi->dev, "SPI CLK %d Hz too fast\n", spi->max_speed_hz);\r\nreturn -EINVAL;\r\n}\r\nac = adxl34x_probe(&spi->dev, spi->irq,\r\nspi->max_speed_hz > MAX_FREQ_NO_FIFODELAY,\r\n&adxl34x_spi_bops);\r\nif (IS_ERR(ac))\r\nreturn PTR_ERR(ac);\r\nspi_set_drvdata(spi, ac);\r\nreturn 0;\r\n}\r\nstatic int __devexit adxl34x_spi_remove(struct spi_device *spi)\r\n{\r\nstruct adxl34x *ac = dev_get_drvdata(&spi->dev);\r\nreturn adxl34x_remove(ac);\r\n}\r\nstatic int adxl34x_spi_suspend(struct device *dev)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nstruct adxl34x *ac = dev_get_drvdata(&spi->dev);\r\nadxl34x_suspend(ac);\r\nreturn 0;\r\n}\r\nstatic int adxl34x_spi_resume(struct device *dev)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nstruct adxl34x *ac = dev_get_drvdata(&spi->dev);\r\nadxl34x_resume(ac);\r\nreturn 0;\r\n}\r\nstatic int __init adxl34x_spi_init(void)\r\n{\r\nreturn spi_register_driver(&adxl34x_driver);\r\n}\r\nstatic void __exit adxl34x_spi_exit(void)\r\n{\r\nspi_unregister_driver(&adxl34x_driver);\r\n}
