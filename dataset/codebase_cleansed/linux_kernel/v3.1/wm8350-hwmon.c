static ssize_t show_name(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "wm8350\n");\r\n}\r\nstatic ssize_t show_voltage(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct wm8350 *wm8350 = dev_get_drvdata(dev);\r\nint channel = to_sensor_dev_attr(attr)->index;\r\nint val;\r\nval = wm8350_read_auxadc(wm8350, channel, 0, 0) * WM8350_AUX_COEFF;\r\nval = DIV_ROUND_CLOSEST(val, 1000);\r\nreturn sprintf(buf, "%d\n", val);\r\n}\r\nstatic ssize_t show_label(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nint channel = to_sensor_dev_attr(attr)->index;\r\nreturn sprintf(buf, "%s\n", input_names[channel]);\r\n}\r\nstatic int __devinit wm8350_hwmon_probe(struct platform_device *pdev)\r\n{\r\nstruct wm8350 *wm8350 = platform_get_drvdata(pdev);\r\nint ret;\r\nret = sysfs_create_group(&pdev->dev.kobj, &wm8350_attr_group);\r\nif (ret)\r\ngoto err;\r\nwm8350->hwmon.classdev = hwmon_device_register(&pdev->dev);\r\nif (IS_ERR(wm8350->hwmon.classdev)) {\r\nret = PTR_ERR(wm8350->hwmon.classdev);\r\ngoto err_group;\r\n}\r\nreturn 0;\r\nerr_group:\r\nsysfs_remove_group(&pdev->dev.kobj, &wm8350_attr_group);\r\nerr:\r\nreturn ret;\r\n}\r\nstatic int __devexit wm8350_hwmon_remove(struct platform_device *pdev)\r\n{\r\nstruct wm8350 *wm8350 = platform_get_drvdata(pdev);\r\nhwmon_device_unregister(wm8350->hwmon.classdev);\r\nsysfs_remove_group(&pdev->dev.kobj, &wm8350_attr_group);\r\nreturn 0;\r\n}\r\nstatic int __init wm8350_hwmon_init(void)\r\n{\r\nreturn platform_driver_register(&wm8350_hwmon_driver);\r\n}\r\nstatic void __exit wm8350_hwmon_exit(void)\r\n{\r\nplatform_driver_unregister(&wm8350_hwmon_driver);\r\n}
