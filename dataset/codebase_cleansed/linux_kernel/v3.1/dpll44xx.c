int omap4_dpllmx_gatectrl_read(struct clk *clk)\r\n{\r\nu32 v;\r\nu32 mask;\r\nif (!clk || !clk->clksel_reg || !cpu_is_omap44xx())\r\nreturn -EINVAL;\r\nmask = clk->flags & CLOCK_CLKOUTX2 ?\r\nOMAP4430_DPLL_CLKOUTX2_GATE_CTRL_MASK :\r\nOMAP4430_DPLL_CLKOUT_GATE_CTRL_MASK;\r\nv = __raw_readl(clk->clksel_reg);\r\nv &= mask;\r\nv >>= __ffs(mask);\r\nreturn v;\r\n}\r\nvoid omap4_dpllmx_allow_gatectrl(struct clk *clk)\r\n{\r\nu32 v;\r\nu32 mask;\r\nif (!clk || !clk->clksel_reg || !cpu_is_omap44xx())\r\nreturn;\r\nmask = clk->flags & CLOCK_CLKOUTX2 ?\r\nOMAP4430_DPLL_CLKOUTX2_GATE_CTRL_MASK :\r\nOMAP4430_DPLL_CLKOUT_GATE_CTRL_MASK;\r\nv = __raw_readl(clk->clksel_reg);\r\nv &= ~mask;\r\n__raw_writel(v, clk->clksel_reg);\r\n}\r\nvoid omap4_dpllmx_deny_gatectrl(struct clk *clk)\r\n{\r\nu32 v;\r\nu32 mask;\r\nif (!clk || !clk->clksel_reg || !cpu_is_omap44xx())\r\nreturn;\r\nmask = clk->flags & CLOCK_CLKOUTX2 ?\r\nOMAP4430_DPLL_CLKOUTX2_GATE_CTRL_MASK :\r\nOMAP4430_DPLL_CLKOUT_GATE_CTRL_MASK;\r\nv = __raw_readl(clk->clksel_reg);\r\nv |= mask;\r\n__raw_writel(v, clk->clksel_reg);\r\n}
