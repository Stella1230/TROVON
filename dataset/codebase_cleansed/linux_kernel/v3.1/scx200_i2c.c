static void scx200_i2c_setscl(void *data, int state)\r\n{\r\nscx200_gpio_set(scl, state);\r\n}\r\nstatic void scx200_i2c_setsda(void *data, int state)\r\n{\r\nscx200_gpio_set(sda, state);\r\n}\r\nstatic int scx200_i2c_getscl(void *data)\r\n{\r\nreturn scx200_gpio_get(scl);\r\n}\r\nstatic int scx200_i2c_getsda(void *data)\r\n{\r\nreturn scx200_gpio_get(sda);\r\n}\r\nstatic int scx200_i2c_init(void)\r\n{\r\npr_debug(NAME ": NatSemi SCx200 I2C Driver\n");\r\nif (!scx200_gpio_present()) {\r\nprintk(KERN_ERR NAME ": no SCx200 gpio pins available\n");\r\nreturn -ENODEV;\r\n}\r\npr_debug(NAME ": SCL=GPIO%02u, SDA=GPIO%02u\n", scl, sda);\r\nif (scl == -1 || sda == -1 || scl == sda) {\r\nprintk(KERN_ERR NAME ": scl and sda must be specified\n");\r\nreturn -EINVAL;\r\n}\r\nscx200_gpio_configure(scl, ~2, 5);\r\nscx200_gpio_configure(sda, ~2, 5);\r\nif (i2c_bit_add_bus(&scx200_i2c_ops) < 0) {\r\nprintk(KERN_ERR NAME ": adapter %s registration failed\n",\r\nscx200_i2c_ops.name);\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nstatic void scx200_i2c_cleanup(void)\r\n{\r\ni2c_del_adapter(&scx200_i2c_ops);\r\n}
