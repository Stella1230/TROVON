static void qpolicy_simple_push(struct sock *sk, struct sk_buff *skb)\r\n{\r\nskb_queue_tail(&sk->sk_write_queue, skb);\r\n}\r\nstatic bool qpolicy_simple_full(struct sock *sk)\r\n{\r\nreturn dccp_sk(sk)->dccps_tx_qlen &&\r\nsk->sk_write_queue.qlen >= dccp_sk(sk)->dccps_tx_qlen;\r\n}\r\nstatic struct sk_buff *qpolicy_simple_top(struct sock *sk)\r\n{\r\nreturn skb_peek(&sk->sk_write_queue);\r\n}\r\nstatic struct sk_buff *qpolicy_prio_best_skb(struct sock *sk)\r\n{\r\nstruct sk_buff *skb, *best = NULL;\r\nskb_queue_walk(&sk->sk_write_queue, skb)\r\nif (best == NULL || skb->priority > best->priority)\r\nbest = skb;\r\nreturn best;\r\n}\r\nstatic struct sk_buff *qpolicy_prio_worst_skb(struct sock *sk)\r\n{\r\nstruct sk_buff *skb, *worst = NULL;\r\nskb_queue_walk(&sk->sk_write_queue, skb)\r\nif (worst == NULL || skb->priority < worst->priority)\r\nworst = skb;\r\nreturn worst;\r\n}\r\nstatic bool qpolicy_prio_full(struct sock *sk)\r\n{\r\nif (qpolicy_simple_full(sk))\r\ndccp_qpolicy_drop(sk, qpolicy_prio_worst_skb(sk));\r\nreturn false;\r\n}\r\nvoid dccp_qpolicy_push(struct sock *sk, struct sk_buff *skb)\r\n{\r\nqpol_table[dccp_sk(sk)->dccps_qpolicy].push(sk, skb);\r\n}\r\nbool dccp_qpolicy_full(struct sock *sk)\r\n{\r\nreturn qpol_table[dccp_sk(sk)->dccps_qpolicy].full(sk);\r\n}\r\nvoid dccp_qpolicy_drop(struct sock *sk, struct sk_buff *skb)\r\n{\r\nif (skb != NULL) {\r\nskb_unlink(skb, &sk->sk_write_queue);\r\nkfree_skb(skb);\r\n}\r\n}\r\nstruct sk_buff *dccp_qpolicy_top(struct sock *sk)\r\n{\r\nreturn qpol_table[dccp_sk(sk)->dccps_qpolicy].top(sk);\r\n}\r\nstruct sk_buff *dccp_qpolicy_pop(struct sock *sk)\r\n{\r\nstruct sk_buff *skb = dccp_qpolicy_top(sk);\r\nif (skb != NULL) {\r\nskb->priority = 0;\r\nskb_unlink(skb, &sk->sk_write_queue);\r\n}\r\nreturn skb;\r\n}\r\nbool dccp_qpolicy_param_ok(struct sock *sk, __be32 param)\r\n{\r\nif (!param || (param & (param - 1)))\r\nreturn false;\r\nreturn (qpol_table[dccp_sk(sk)->dccps_qpolicy].params & param) == param;\r\n}
