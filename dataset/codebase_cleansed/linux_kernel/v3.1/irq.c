static void int1_mask(struct irq_data *d)\r\n{\r\nu32 intmr1;\r\nintmr1 = clps_readl(INTMR1);\r\nintmr1 &= ~(1 << d->irq);\r\nclps_writel(intmr1, INTMR1);\r\n}\r\nstatic void int1_ack(struct irq_data *d)\r\n{\r\nu32 intmr1;\r\nintmr1 = clps_readl(INTMR1);\r\nintmr1 &= ~(1 << d->irq);\r\nclps_writel(intmr1, INTMR1);\r\nswitch (d->irq) {\r\ncase IRQ_CSINT: clps_writel(0, COEOI); break;\r\ncase IRQ_TC1OI: clps_writel(0, TC1EOI); break;\r\ncase IRQ_TC2OI: clps_writel(0, TC2EOI); break;\r\ncase IRQ_RTCMI: clps_writel(0, RTCEOI); break;\r\ncase IRQ_TINT: clps_writel(0, TEOI); break;\r\ncase IRQ_UMSINT: clps_writel(0, UMSEOI); break;\r\n}\r\n}\r\nstatic void int1_unmask(struct irq_data *d)\r\n{\r\nu32 intmr1;\r\nintmr1 = clps_readl(INTMR1);\r\nintmr1 |= 1 << d->irq;\r\nclps_writel(intmr1, INTMR1);\r\n}\r\nstatic void int2_mask(struct irq_data *d)\r\n{\r\nu32 intmr2;\r\nintmr2 = clps_readl(INTMR2);\r\nintmr2 &= ~(1 << (d->irq - 16));\r\nclps_writel(intmr2, INTMR2);\r\n}\r\nstatic void int2_ack(struct irq_data *d)\r\n{\r\nu32 intmr2;\r\nintmr2 = clps_readl(INTMR2);\r\nintmr2 &= ~(1 << (d->irq - 16));\r\nclps_writel(intmr2, INTMR2);\r\nswitch (d->irq) {\r\ncase IRQ_KBDINT: clps_writel(0, KBDEOI); break;\r\n}\r\n}\r\nstatic void int2_unmask(struct irq_data *d)\r\n{\r\nu32 intmr2;\r\nintmr2 = clps_readl(INTMR2);\r\nintmr2 |= 1 << (d->irq - 16);\r\nclps_writel(intmr2, INTMR2);\r\n}\r\nvoid __init clps711x_init_irq(void)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < NR_IRQS; i++) {\r\nif (INT1_IRQS & (1 << i)) {\r\nirq_set_chip_and_handler(i, &int1_chip,\r\nhandle_level_irq);\r\nset_irq_flags(i, IRQF_VALID | IRQF_PROBE);\r\n}\r\nif (INT2_IRQS & (1 << i)) {\r\nirq_set_chip_and_handler(i, &int2_chip,\r\nhandle_level_irq);\r\nset_irq_flags(i, IRQF_VALID | IRQF_PROBE);\r\n}\r\n}\r\nclps_writel(0, INTMR1);\r\nclps_writel(0, INTMR2);\r\nclps_writel(0, COEOI);\r\nclps_writel(0, TC1EOI);\r\nclps_writel(0, TC2EOI);\r\nclps_writel(0, RTCEOI);\r\nclps_writel(0, TEOI);\r\nclps_writel(0, UMSEOI);\r\nclps_writel(0, SYNCIO);\r\nclps_writel(0, KBDEOI);\r\n}
