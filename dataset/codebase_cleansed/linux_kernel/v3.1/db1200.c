static int db1200_i2s_startup(struct snd_pcm_substream *substream)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nstruct snd_soc_dai *cpu_dai = rtd->cpu_dai;\r\nint ret;\r\nsnd_soc_dai_set_sysclk(codec_dai, WM8731_SYSCLK_XTAL,\r\n12000000, SND_SOC_CLOCK_IN);\r\nret = snd_soc_dai_set_fmt(codec_dai, SND_SOC_DAIFMT_LEFT_J |\r\nSND_SOC_DAIFMT_NB_NF | SND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\ngoto out;\r\nret = snd_soc_dai_set_fmt(cpu_dai, SND_SOC_DAIFMT_LEFT_J |\r\nSND_SOC_DAIFMT_NB_NF | SND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\ngoto out;\r\nret = 0;\r\nout:\r\nreturn ret;\r\n}\r\nstatic int __init db1200_audio_load(void)\r\n{\r\nint ret;\r\nret = -ENOMEM;\r\ndb1200_asoc_dev = platform_device_alloc("soc-audio", 1);\r\nif (!db1200_asoc_dev)\r\ngoto out;\r\nif (bcsr_read(BCSR_RESETS) & BCSR_RESETS_PSC1MUX)\r\nplatform_set_drvdata(db1200_asoc_dev, &db1200_i2s_machine);\r\nelse\r\nplatform_set_drvdata(db1200_asoc_dev, &db1200_ac97_machine);\r\nret = platform_device_add(db1200_asoc_dev);\r\nif (ret) {\r\nplatform_device_put(db1200_asoc_dev);\r\ndb1200_asoc_dev = NULL;\r\n}\r\nout:\r\nreturn ret;\r\n}\r\nstatic void __exit db1200_audio_unload(void)\r\n{\r\nplatform_device_unregister(db1200_asoc_dev);\r\n}
