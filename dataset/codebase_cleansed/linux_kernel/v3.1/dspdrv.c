u32 dsp_init(u32 *init_status)\r\n{\r\nchar dev_node[MAXREGPATHLENGTH] = "TIOMAP1510";\r\nint status = -EPERM;\r\nstruct drv_object *drv_obj = NULL;\r\nu32 device_node;\r\nu32 device_node_string;\r\nif (!api_init())\r\ngoto func_cont;\r\nstatus = drv_create(&drv_obj);\r\nif (status) {\r\napi_exit();\r\ngoto func_cont;\r\n}\r\nstatus = drv_request_resources((u32) &dev_node, &device_node_string);\r\nif (!status) {\r\nstatus = dev_start_device((struct cfg_devnode *)\r\ndevice_node_string);\r\nif (status)\r\n(void)drv_release_resources\r\n((u32) device_node_string, drv_obj);\r\n} else {\r\ndev_dbg(bridge, "%s: drv_request_resources Failed\n", __func__);\r\nstatus = -EPERM;\r\n}\r\nif (status) {\r\nfor (device_node = drv_get_first_dev_extension();\r\ndevice_node != 0;\r\ndevice_node = drv_get_next_dev_extension(device_node)) {\r\n(void)dev_remove_device((struct cfg_devnode *)\r\ndevice_node);\r\n(void)drv_release_resources((u32) device_node, drv_obj);\r\n}\r\n(void)drv_destroy(drv_obj);\r\ndrv_obj = NULL;\r\napi_exit();\r\ndev_dbg(bridge, "%s: Logical device failed init\n", __func__);\r\n}\r\nfunc_cont:\r\nif (!status) {\r\n(void)api_init_complete2();\r\n} else {\r\ndev_dbg(bridge, "%s: Failed\n", __func__);\r\n}\r\nDBC_ENSURE((!status && drv_obj != NULL) ||\r\n(status && drv_obj == NULL));\r\n*init_status = status;\r\nreturn (u32) drv_obj;\r\n}\r\nbool dsp_deinit(u32 device_context)\r\n{\r\nbool ret = true;\r\nu32 device_node;\r\nstruct mgr_object *mgr_obj = NULL;\r\nstruct drv_data *drv_datap = dev_get_drvdata(bridge);\r\nwhile ((device_node = drv_get_first_dev_extension()) != 0) {\r\n(void)dev_remove_device((struct cfg_devnode *)device_node);\r\n(void)drv_release_resources((u32) device_node,\r\n(struct drv_object *)device_context);\r\n}\r\n(void)drv_destroy((struct drv_object *)device_context);\r\nif (drv_datap && drv_datap->mgr_object) {\r\nmgr_obj = drv_datap->mgr_object;\r\n(void)mgr_destroy(mgr_obj);\r\n} else {\r\npr_err("%s: Failed to retrieve the object handle\n", __func__);\r\n}\r\napi_exit();\r\nreturn ret;\r\n}
