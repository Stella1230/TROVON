void ov9655_init_settings(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nsd->vcur.backlight = 0;\r\nsd->vcur.brightness = 128;\r\nsd->vcur.sharpness = 0;\r\nsd->vcur.contrast = 0;\r\nsd->vcur.gamma = 0;\r\nsd->vcur.hue = 0;\r\nsd->vcur.saturation = 0;\r\nsd->vcur.whitebal = 0;\r\nsd->vmax.backlight = 0;\r\nsd->vmax.brightness = 255;\r\nsd->vmax.sharpness = 0;\r\nsd->vmax.contrast = 0;\r\nsd->vmax.gamma = 0;\r\nsd->vmax.hue = 0 + 1;\r\nsd->vmax.saturation = 0;\r\nsd->vmax.whitebal = 0;\r\nsd->vmax.mirror = 0;\r\nsd->vmax.flip = 0;\r\nsd->vmax.AC50Hz = 0;\r\nsd->dev_camera_settings = ov9655_camera_settings;\r\nsd->dev_init_at_startup = ov9655_init_at_startup;\r\nsd->dev_configure_alt = ov9655_configure_alt;\r\nsd->dev_init_pre_alt = ov9655_init_pre_alt;\r\nsd->dev_post_unset_alt = ov9655_post_unset_alt;\r\n}\r\nstatic int ov9655_init_at_startup(struct gspca_dev *gspca_dev)\r\n{\r\nfetch_validx(gspca_dev, tbl_init_at_startup,\r\nARRAY_SIZE(tbl_init_at_startup));\r\nfetch_validx(gspca_dev, tbl_commmon, ARRAY_SIZE(tbl_commmon));\r\nreturn 0;\r\n}\r\nstatic int ov9655_init_pre_alt(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nsd->vold.brightness = -1;\r\nsd->vold.hue = -1;\r\nfetch_validx(gspca_dev, tbl_commmon, ARRAY_SIZE(tbl_commmon));\r\nov9655_init_post_alt(gspca_dev);\r\nreturn 0;\r\n}\r\nstatic int ov9655_init_post_alt(struct gspca_dev *gspca_dev)\r\n{\r\ns32 reso = gspca_dev->cam.cam_mode[(s32) gspca_dev->curr_mode].priv;\r\ns32 n;\r\ns32 i;\r\nu8 **tbl;\r\nctrl_out(gspca_dev, 0x40, 5, 0x0001, 0x0000, 0, NULL);\r\ntbl = (reso == IMAGE_640) ? tbl_640 : tbl_1280;\r\nctrl_out(gspca_dev, 0x40, 3, 0x0000, 0x0200,\r\ntbl_length[0], tbl[0]);\r\nfor (i = 1; i < 7; i++)\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200,\r\ntbl_length[i], tbl[i]);\r\nctrl_out(gspca_dev, 0x40, 3, 0x0000, 0x0200,\r\ntbl_length[7], tbl[7]);\r\nn = fetch_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt));\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post1);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post1);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_in(gspca_dev, 0xc0, 2, 0x6000, 0x801e, 1, c04);\r\nkeep_on_fetching_validx(gspca_dev, tbl_init_post_alt,\r\nARRAY_SIZE(tbl_init_post_alt), n);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post1);\r\nctrl_out(gspca_dev, 0x40, 3, 0x0000, 0x0200, 4, dat_post2);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post3);\r\nctrl_out(gspca_dev, 0x40, 3, 0x0000, 0x0200, 4, dat_post4);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post5);\r\nctrl_out(gspca_dev, 0x40, 3, 0x0000, 0x0200, 4, dat_post6);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post7);\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_post8);\r\nov9655_camera_settings(gspca_dev);\r\nreturn 0;\r\n}\r\nstatic int ov9655_configure_alt(struct gspca_dev *gspca_dev)\r\n{\r\ns32 reso = gspca_dev->cam.cam_mode[(s32) gspca_dev->curr_mode].priv;\r\nswitch (reso) {\r\ncase IMAGE_640:\r\ngspca_dev->alt = 1 + 1;\r\nbreak;\r\ndefault:\r\ngspca_dev->alt = 1 + 1;\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ov9655_camera_settings(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nu8 dat_bright[] = "\x04\x00\x10\x7c\xa1\x00\x00\x70";\r\ns32 bright = sd->vcur.brightness;\r\ns32 hue = sd->vcur.hue;\r\nif (bright != sd->vold.brightness) {\r\nsd->vold.brightness = bright;\r\nif (bright < 0 || bright > sd->vmax.brightness)\r\nbright = 0;\r\ndat_bright[3] = bright;\r\nctrl_out(gspca_dev, 0x40, 3, 0x6000, 0x0200, 8, dat_bright);\r\n}\r\nif (hue != sd->vold.hue) {\r\nsd->vold.hue = hue;\r\nsd->swapRB = (hue != 0);\r\n}\r\nreturn 0;\r\n}\r\nstatic void ov9655_post_unset_alt(struct gspca_dev *gspca_dev)\r\n{\r\nctrl_out(gspca_dev, 0x40, 5, 0x0000, 0x0000, 0, NULL);\r\nctrl_out(gspca_dev, 0x40, 1, 0x0061, 0x0000, 0, NULL);\r\n}
