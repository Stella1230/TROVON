int s3c_gpio_cfgpin(unsigned int pin, unsigned int config)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset;\r\nint ret;\r\nif (!chip)\r\nreturn -EINVAL;\r\noffset = pin - chip->chip.base;\r\ns3c_gpio_lock(chip, flags);\r\nret = s3c_gpio_do_setcfg(chip, offset, config);\r\ns3c_gpio_unlock(chip, flags);\r\nreturn ret;\r\n}\r\nint s3c_gpio_cfgpin_range(unsigned int start, unsigned int nr,\r\nunsigned int cfg)\r\n{\r\nint ret;\r\nfor (; nr > 0; nr--, start++) {\r\nret = s3c_gpio_cfgpin(start, cfg);\r\nif (ret != 0)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nint s3c_gpio_cfgall_range(unsigned int start, unsigned int nr,\r\nunsigned int cfg, s3c_gpio_pull_t pull)\r\n{\r\nint ret;\r\nfor (; nr > 0; nr--, start++) {\r\ns3c_gpio_setpull(start, pull);\r\nret = s3c_gpio_cfgpin(start, cfg);\r\nif (ret != 0)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nunsigned s3c_gpio_getcfg(unsigned int pin)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nunsigned ret = 0;\r\nint offset;\r\nif (chip) {\r\noffset = pin - chip->chip.base;\r\ns3c_gpio_lock(chip, flags);\r\nret = s3c_gpio_do_getcfg(chip, offset);\r\ns3c_gpio_unlock(chip, flags);\r\n}\r\nreturn ret;\r\n}\r\nint s3c_gpio_setpull(unsigned int pin, s3c_gpio_pull_t pull)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset, ret;\r\nif (!chip)\r\nreturn -EINVAL;\r\noffset = pin - chip->chip.base;\r\ns3c_gpio_lock(chip, flags);\r\nret = s3c_gpio_do_setpull(chip, offset, pull);\r\ns3c_gpio_unlock(chip, flags);\r\nreturn ret;\r\n}\r\ns3c_gpio_pull_t s3c_gpio_getpull(unsigned int pin)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset;\r\nu32 pup = 0;\r\nif (chip) {\r\noffset = pin - chip->chip.base;\r\ns3c_gpio_lock(chip, flags);\r\npup = s3c_gpio_do_getpull(chip, offset);\r\ns3c_gpio_unlock(chip, flags);\r\n}\r\nreturn (__force s3c_gpio_pull_t)pup;\r\n}\r\nint s3c_gpio_setcfg_s3c24xx_a(struct s3c_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = off;\r\nu32 con;\r\nif (s3c_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\ncfg -= 1;\r\nif (cfg > 1)\r\nreturn -EINVAL;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0x1 << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nunsigned s3c_gpio_getcfg_s3c24xx_a(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nu32 con;\r\ncon = __raw_readl(chip->base);\r\ncon >>= off;\r\ncon &= 1;\r\ncon++;\r\nreturn S3C_GPIO_SFN(con);\r\n}\r\nint s3c_gpio_setcfg_s3c24xx(struct s3c_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = off * 2;\r\nu32 con;\r\nif (s3c_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\nif (cfg > 3)\r\nreturn -EINVAL;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0x3 << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nunsigned int s3c_gpio_getcfg_s3c24xx(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nu32 con;\r\ncon = __raw_readl(chip->base);\r\ncon >>= off * 2;\r\ncon &= 3;\r\nreturn S3C_GPIO_SPECIAL(con);\r\n}\r\nint s3c_gpio_setcfg_s3c64xx_4bit(struct s3c_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = (off & 7) * 4;\r\nu32 con;\r\nif (off < 8 && chip->chip.ngpio > 8)\r\nreg -= 4;\r\nif (s3c_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0xf << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nunsigned s3c_gpio_getcfg_s3c64xx_4bit(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = (off & 7) * 4;\r\nu32 con;\r\nif (off < 8 && chip->chip.ngpio > 8)\r\nreg -= 4;\r\ncon = __raw_readl(reg);\r\ncon >>= shift;\r\ncon &= 0xf;\r\nreturn S3C_GPIO_SPECIAL(con);\r\n}\r\nint s3c_gpio_setpull_updown(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t pull)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nint shift = off * 2;\r\nu32 pup;\r\npup = __raw_readl(reg);\r\npup &= ~(3 << shift);\r\npup |= pull << shift;\r\n__raw_writel(pup, reg);\r\nreturn 0;\r\n}\r\ns3c_gpio_pull_t s3c_gpio_getpull_updown(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nint shift = off * 2;\r\nu32 pup = __raw_readl(reg);\r\npup >>= shift;\r\npup &= 0x3;\r\nreturn (__force s3c_gpio_pull_t)pup;\r\n}\r\nint s3c_gpio_setpull_s3c2443(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t pull)\r\n{\r\nswitch (pull) {\r\ncase S3C_GPIO_PULL_NONE:\r\npull = 0x01;\r\nbreak;\r\ncase S3C_GPIO_PULL_UP:\r\npull = 0x00;\r\nbreak;\r\ncase S3C_GPIO_PULL_DOWN:\r\npull = 0x02;\r\nbreak;\r\n}\r\nreturn s3c_gpio_setpull_updown(chip, off, pull);\r\n}\r\ns3c_gpio_pull_t s3c_gpio_getpull_s3c2443(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\ns3c_gpio_pull_t pull;\r\npull = s3c_gpio_getpull_updown(chip, off);\r\nswitch (pull) {\r\ncase 0x00:\r\npull = S3C_GPIO_PULL_UP;\r\nbreak;\r\ncase 0x01:\r\ncase 0x03:\r\npull = S3C_GPIO_PULL_NONE;\r\nbreak;\r\ncase 0x02:\r\npull = S3C_GPIO_PULL_DOWN;\r\nbreak;\r\n}\r\nreturn pull;\r\n}\r\nstatic int s3c_gpio_setpull_1(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t pull,\r\ns3c_gpio_pull_t updown)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nu32 pup = __raw_readl(reg);\r\nif (pull == updown)\r\npup &= ~(1 << off);\r\nelse if (pull == S3C_GPIO_PULL_NONE)\r\npup |= (1 << off);\r\nelse\r\nreturn -EINVAL;\r\n__raw_writel(pup, reg);\r\nreturn 0;\r\n}\r\nstatic s3c_gpio_pull_t s3c_gpio_getpull_1(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t updown)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nu32 pup = __raw_readl(reg);\r\npup &= (1 << off);\r\nreturn pup ? S3C_GPIO_PULL_NONE : updown;\r\n}\r\ns3c_gpio_pull_t s3c_gpio_getpull_1up(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nreturn s3c_gpio_getpull_1(chip, off, S3C_GPIO_PULL_UP);\r\n}\r\nint s3c_gpio_setpull_1up(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t pull)\r\n{\r\nreturn s3c_gpio_setpull_1(chip, off, pull, S3C_GPIO_PULL_UP);\r\n}\r\ns3c_gpio_pull_t s3c_gpio_getpull_1down(struct s3c_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nreturn s3c_gpio_getpull_1(chip, off, S3C_GPIO_PULL_DOWN);\r\n}\r\nint s3c_gpio_setpull_1down(struct s3c_gpio_chip *chip,\r\nunsigned int off, s3c_gpio_pull_t pull)\r\n{\r\nreturn s3c_gpio_setpull_1(chip, off, pull, S3C_GPIO_PULL_DOWN);\r\n}\r\ns5p_gpio_drvstr_t s5p_gpio_get_drvstr(unsigned int pin)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned int off;\r\nvoid __iomem *reg;\r\nint shift;\r\nu32 drvstr;\r\nif (!chip)\r\nreturn -EINVAL;\r\noff = pin - chip->chip.base;\r\nshift = off * 2;\r\nreg = chip->base + 0x0C;\r\ndrvstr = __raw_readl(reg);\r\ndrvstr = drvstr >> shift;\r\ndrvstr &= 0x3;\r\nreturn (__force s5p_gpio_drvstr_t)drvstr;\r\n}\r\nint s5p_gpio_set_drvstr(unsigned int pin, s5p_gpio_drvstr_t drvstr)\r\n{\r\nstruct s3c_gpio_chip *chip = s3c_gpiolib_getchip(pin);\r\nunsigned int off;\r\nvoid __iomem *reg;\r\nint shift;\r\nu32 tmp;\r\nif (!chip)\r\nreturn -EINVAL;\r\noff = pin - chip->chip.base;\r\nshift = off * 2;\r\nreg = chip->base + 0x0C;\r\ntmp = __raw_readl(reg);\r\ntmp &= ~(0x3 << shift);\r\ntmp |= drvstr << shift;\r\n__raw_writel(tmp, reg);\r\nreturn 0;\r\n}
