void __init u8500_map_io(void)\r\n{\r\niotable_init(u8500_uart_io_desc, ARRAY_SIZE(u8500_uart_io_desc));\r\nux500_map_io();\r\niotable_init(u8500_io_desc, ARRAY_SIZE(u8500_io_desc));\r\nif (cpu_is_u8500ed())\r\niotable_init(u8500_ed_io_desc, ARRAY_SIZE(u8500_ed_io_desc));\r\nelse if (cpu_is_u8500v1())\r\niotable_init(u8500_v1_io_desc, ARRAY_SIZE(u8500_v1_io_desc));\r\nelse if (cpu_is_u8500v2())\r\niotable_init(u8500_v2_io_desc, ARRAY_SIZE(u8500_v2_io_desc));\r\n_PRCMU_BASE = __io_address(U8500_PRCMU_BASE);\r\n}\r\nstatic irqreturn_t db8500_pmu_handler(int irq, void *dev, irq_handler_t handler)\r\n{\r\nirqreturn_t ret = handler(irq, dev);\r\nint other = !smp_processor_id();\r\nif (ret == IRQ_NONE && cpu_online(other))\r\nirq_set_affinity(irq, cpumask_of(other));\r\nreturn ret;\r\n}\r\nstatic void __init db8500_add_gpios(void)\r\n{\r\nstruct nmk_gpio_platform_data pdata = {\r\n};\r\nif (cpu_is_u8500v2())\r\npdata.supports_sleepmode = true;\r\ndbx500_add_gpios(ARRAY_AND_SIZE(db8500_gpio_base),\r\nIRQ_DB8500_GPIO0, &pdata);\r\n}\r\nvoid __init u8500_init_devices(void)\r\n{\r\nif (cpu_is_u8500ed())\r\ndma40_u8500ed_fixup();\r\ndb8500_add_rtc();\r\ndb8500_add_gpios();\r\ndb8500_add_usb(usb_db8500_rx_dma_cfg, usb_db8500_tx_dma_cfg);\r\nplatform_device_register_simple("cpufreq-u8500", -1, NULL, 0);\r\nplatform_add_devices(platform_devs, ARRAY_SIZE(platform_devs));\r\nreturn ;\r\n}
