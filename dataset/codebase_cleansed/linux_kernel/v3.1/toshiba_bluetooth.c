static int toshiba_bluetooth_enable(acpi_handle handle)\r\n{\r\nacpi_status res1, res2;\r\nu64 result;\r\nres1 = acpi_evaluate_integer(handle, "BTST", NULL, &result);\r\nif (ACPI_FAILURE(res1))\r\nreturn res1;\r\nif (!(result & 0x01))\r\nreturn 0;\r\npr_info("Re-enabling Toshiba Bluetooth\n");\r\nres1 = acpi_evaluate_object(handle, "AUSB", NULL, NULL);\r\nres2 = acpi_evaluate_object(handle, "BTPO", NULL, NULL);\r\nif (!ACPI_FAILURE(res1) || !ACPI_FAILURE(res2))\r\nreturn 0;\r\npr_warn("Failed to re-enable Toshiba Bluetooth\n");\r\nreturn -ENODEV;\r\n}\r\nstatic void toshiba_bt_rfkill_notify(struct acpi_device *device, u32 event)\r\n{\r\ntoshiba_bluetooth_enable(device->handle);\r\n}\r\nstatic int toshiba_bt_resume(struct acpi_device *device)\r\n{\r\nreturn toshiba_bluetooth_enable(device->handle);\r\n}\r\nstatic int toshiba_bt_rfkill_add(struct acpi_device *device)\r\n{\r\nacpi_status status;\r\nu64 bt_present;\r\nint result = -ENODEV;\r\nstatus = acpi_evaluate_integer(device->handle, "_STA", NULL,\r\n&bt_present);\r\nif (!ACPI_FAILURE(status) && bt_present) {\r\npr_info("Detected Toshiba ACPI Bluetooth device - "\r\n"installing RFKill handler\n");\r\nresult = toshiba_bluetooth_enable(device->handle);\r\n}\r\nreturn result;\r\n}\r\nstatic int __init toshiba_bt_rfkill_init(void)\r\n{\r\nint result;\r\nresult = acpi_bus_register_driver(&toshiba_bt_rfkill_driver);\r\nif (result < 0) {\r\nACPI_DEBUG_PRINT((ACPI_DB_ERROR,\r\n"Error registering driver\n"));\r\nreturn result;\r\n}\r\nreturn 0;\r\n}\r\nstatic int toshiba_bt_rfkill_remove(struct acpi_device *device, int type)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __exit toshiba_bt_rfkill_exit(void)\r\n{\r\nacpi_bus_unregister_driver(&toshiba_bt_rfkill_driver);\r\n}
