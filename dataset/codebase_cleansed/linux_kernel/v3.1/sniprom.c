void prom_putchar(char c)\r\n{\r\n_prom_putchar(c);\r\n}\r\nchar *prom_getenv(char *s)\r\n{\r\nreturn _prom_getenv(s);\r\n}\r\nvoid *prom_get_hwconf(void)\r\n{\r\nu32 hwconf = _prom_get_hwconf();\r\nif (hwconf == 0xffffffff)\r\nreturn NULL;\r\nreturn (void *)CKSEG1ADDR(hwconf);\r\n}\r\nvoid __init prom_free_prom_memory(void)\r\n{\r\n}\r\nconst char *get_system_type(void)\r\n{\r\nreturn system_type;\r\n}\r\nstatic void __init sni_mem_init(void)\r\n{\r\nint i, memsize;\r\nstruct membank {\r\nu32 size;\r\nu32 base;\r\nu32 size2;\r\nu32 pad1;\r\nu32 pad2;\r\n} memconf[8];\r\nint brd_type = *(unsigned char *)SNI_IDPROM_BRDTYPE;\r\nmemsize = *((unsigned char *) SNI_IDPROM_MEMSIZE) * 16;\r\npr_debug("IDProm memsize: %u MByte\n", memsize);\r\n_prom_get_memconf(&memconf);\r\npr_debug("prom_get_mem_conf memory configuration:\n");\r\nfor (i = 0; i < 8 && memconf[i].size; i++) {\r\nif (brd_type == SNI_BRD_PCI_TOWER ||\r\nbrd_type == SNI_BRD_PCI_TOWER_CPLUS) {\r\nif (memconf[i].base >= 0x20000000 &&\r\nmemconf[i].base < 0x30000000)\r\nmemconf[i].base -= 0x20000000;\r\n}\r\npr_debug("Bank%d: %08x @ %08x\n", i,\r\nmemconf[i].size, memconf[i].base);\r\nadd_memory_region(memconf[i].base, memconf[i].size,\r\nBOOT_MEM_RAM);\r\n}\r\n}\r\nvoid __init prom_init(void)\r\n{\r\nint argc = fw_arg0;\r\nu32 *argv = (u32 *)CKSEG0ADDR(fw_arg1);\r\nint i;\r\nsni_mem_init();\r\nfor (i = 1; i < argc; i++) {\r\nstrcat(arcs_cmdline, (char *)CKSEG0ADDR(argv[i]));\r\nif (i < (argc - 1))\r\nstrcat(arcs_cmdline, " ");\r\n}\r\n}
