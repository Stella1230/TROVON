void sun3_disable_interrupts(void)\r\n{\r\nsun3_disable_irq(0);\r\n}\r\nvoid sun3_enable_interrupts(void)\r\n{\r\nsun3_enable_irq(0);\r\n}\r\nvoid sun3_enable_irq(unsigned int irq)\r\n{\r\n*sun3_intreg |= (1 << irq);\r\n}\r\nvoid sun3_disable_irq(unsigned int irq)\r\n{\r\n*sun3_intreg &= ~(1 << irq);\r\n}\r\nstatic irqreturn_t sun3_int7(int irq, void *dev_id)\r\n{\r\n*sun3_intreg |= (1 << irq);\r\nif (!(kstat_cpu(0).irqs[irq] % 2000))\r\nsun3_leds(led_pattern[(kstat_cpu(0).irqs[irq] % 16000) / 2000]);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic irqreturn_t sun3_int5(int irq, void *dev_id)\r\n{\r\n#ifdef CONFIG_SUN3\r\nintersil_clear();\r\n#endif\r\n*sun3_intreg |= (1 << irq);\r\n#ifdef CONFIG_SUN3\r\nintersil_clear();\r\n#endif\r\nxtime_update(1);\r\nupdate_process_times(user_mode(get_irq_regs()));\r\nif (!(kstat_cpu(0).irqs[irq] % 20))\r\nsun3_leds(led_pattern[(kstat_cpu(0).irqs[irq] % 160) / 20]);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic irqreturn_t sun3_vec255(int irq, void *dev_id)\r\n{\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic void sun3_inthandle(unsigned int irq, struct pt_regs *fp)\r\n{\r\n*sun3_intreg &= ~(1 << irq);\r\n__m68k_handle_int(irq, fp);\r\n}\r\nvoid __init sun3_init_IRQ(void)\r\n{\r\n*sun3_intreg = 1;\r\nm68k_setup_auto_interrupt(sun3_inthandle);\r\nm68k_setup_irq_controller(&sun3_irq_controller, IRQ_AUTO_1, 7);\r\nm68k_setup_user_interrupt(VEC_USER, 128, NULL);\r\nif (request_irq(IRQ_AUTO_5, sun3_int5, 0, "int5", NULL))\r\npr_err("Couldn't register %s interrupt\n", "int5");\r\nif (request_irq(IRQ_AUTO_7, sun3_int7, 0, "int7", NULL))\r\npr_err("Couldn't register %s interrupt\n", "int7");\r\nif (request_irq(IRQ_USER+127, sun3_vec255, 0, "vec255", NULL))\r\npr_err("Couldn't register %s interrupt\n", "vec255");\r\n}
