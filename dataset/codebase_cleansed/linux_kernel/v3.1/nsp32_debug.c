static void print_opcodek(unsigned char opcode)\r\n{\r\nconst char **table = commands[ group(opcode) ];\r\nswitch ((unsigned long) table) {\r\ncase RESERVED_GROUP:\r\nprintk("%s[%02x] ", reserved, opcode);\r\nbreak;\r\ncase NOTEXT_GROUP:\r\nprintk("%s(notext)[%02x] ", unknown, opcode);\r\nbreak;\r\ncase VENDOR_GROUP:\r\nprintk("%s[%02x] ", vendor, opcode);\r\nbreak;\r\ndefault:\r\nif (table[opcode & 0x1f] != unknown)\r\nprintk("%s[%02x] ", table[opcode & 0x1f], opcode);\r\nelse\r\nprintk("%s[%02x] ", unknown, opcode);\r\nbreak;\r\n}\r\n}\r\nstatic void print_commandk (unsigned char *command)\r\n{\r\nint i,s;\r\nprint_opcodek(command[0]);\r\nif ((command[0] >> 5) == 6 ||\r\n(command[0] >> 5) == 7 ) {\r\ns = 12;\r\n} else {\r\ns = COMMAND_SIZE(command[0]);\r\n}\r\nfor ( i = 1; i < s; ++i) {\r\nprintk("%02x ", command[i]);\r\n}\r\nswitch (s) {\r\ncase 6:\r\nprintk("LBA=%d len=%d",\r\n(((unsigned int)command[1] & 0x0f) << 16) |\r\n( (unsigned int)command[2] << 8) |\r\n( (unsigned int)command[3] ),\r\n(unsigned int)command[4]\r\n);\r\nbreak;\r\ncase 10:\r\nprintk("LBA=%d len=%d",\r\n((unsigned int)command[2] << 24) |\r\n((unsigned int)command[3] << 16) |\r\n((unsigned int)command[4] << 8) |\r\n((unsigned int)command[5] ),\r\n((unsigned int)command[7] << 8) |\r\n((unsigned int)command[8] )\r\n);\r\nbreak;\r\ncase 12:\r\nprintk("LBA=%d len=%d",\r\n((unsigned int)command[2] << 24) |\r\n((unsigned int)command[3] << 16) |\r\n((unsigned int)command[4] << 8) |\r\n((unsigned int)command[5] ),\r\n((unsigned int)command[6] << 24) |\r\n((unsigned int)command[7] << 16) |\r\n((unsigned int)command[8] << 8) |\r\n((unsigned int)command[9] )\r\n);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nprintk("\n");\r\n}\r\nstatic void show_command(Scsi_Cmnd *SCpnt)\r\n{\r\nprint_commandk(SCpnt->cmnd);\r\n}\r\nstatic void show_busphase(unsigned char stat)\r\n{\r\nswitch(stat) {\r\ncase BUSPHASE_COMMAND:\r\nprintk( "BUSPHASE_COMMAND\n");\r\nbreak;\r\ncase BUSPHASE_MESSAGE_IN:\r\nprintk( "BUSPHASE_MESSAGE_IN\n");\r\nbreak;\r\ncase BUSPHASE_MESSAGE_OUT:\r\nprintk( "BUSPHASE_MESSAGE_OUT\n");\r\nbreak;\r\ncase BUSPHASE_DATA_IN:\r\nprintk( "BUSPHASE_DATA_IN\n");\r\nbreak;\r\ncase BUSPHASE_DATA_OUT:\r\nprintk( "BUSPHASE_DATA_OUT\n");\r\nbreak;\r\ncase BUSPHASE_STATUS:\r\nprintk( "BUSPHASE_STATUS\n");\r\nbreak;\r\ncase BUSPHASE_SELECT:\r\nprintk( "BUSPHASE_SELECT\n");\r\nbreak;\r\ndefault:\r\nprintk( "BUSPHASE_other: 0x%x\n", stat);\r\nbreak;\r\n}\r\n}\r\nstatic void show_autophase(unsigned short i)\r\n{\r\nprintk("auto: 0x%x,", i);\r\nif(i & COMMAND_PHASE) {\r\nprintk(" cmd");\r\n}\r\nif(i & DATA_IN_PHASE) {\r\nprintk(" din");\r\n}\r\nif(i & DATA_OUT_PHASE) {\r\nprintk(" dout");\r\n}\r\nif(i & MSGOUT_PHASE) {\r\nprintk(" mout");\r\n}\r\nif(i & STATUS_PHASE) {\r\nprintk(" stat");\r\n}\r\nif(i & ILLEGAL_PHASE) {\r\nprintk(" ill");\r\n}\r\nif(i & BUS_FREE_OCCUER) {\r\nprintk(" bfree-o");\r\n}\r\nif(i & MSG_IN_OCCUER) {\r\nprintk(" min-o");\r\n}\r\nif(i & MSG_OUT_OCCUER) {\r\nprintk(" mout-o");\r\n}\r\nif(i & SELECTION_TIMEOUT) {\r\nprintk(" sel");\r\n}\r\nif(i & MSGIN_00_VALID) {\r\nprintk(" m0");\r\n}\r\nif(i & MSGIN_02_VALID) {\r\nprintk(" m2");\r\n}\r\nif(i & MSGIN_03_VALID) {\r\nprintk(" m3");\r\n}\r\nif(i & MSGIN_04_VALID) {\r\nprintk(" m4");\r\n}\r\nif(i & AUTOSCSI_BUSY) {\r\nprintk(" busy");\r\n}\r\nprintk("\n");\r\n}\r\nstatic void nsp32_print_register(int base)\r\n{\r\nif (!(NSP32_DEBUG_MASK & NSP32_SPECIAL_PRINT_REGISTER))\r\nreturn;\r\nprintk("Phase=0x%x, ", nsp32_read1(base, SCSI_BUS_MONITOR));\r\nprintk("OldPhase=0x%x, ", nsp32_index_read1(base, OLD_SCSI_PHASE));\r\nprintk("syncreg=0x%x, ", nsp32_read1(base, SYNC_REG));\r\nprintk("ackwidth=0x%x, ", nsp32_read1(base, ACK_WIDTH));\r\nprintk("sgtpaddr=0x%lx, ", nsp32_read4(base, SGT_ADR));\r\nprintk("scsioutlatch=0x%x, ", nsp32_read1(base, SCSI_OUT_LATCH_TARGET_ID));\r\nprintk("msgout=0x%lx, ", nsp32_read4(base, SCSI_MSG_OUT));\r\nprintk("miscrd=0x%x, ", nsp32_index_read2(base, MISC_WR));\r\nprintk("seltimeout=0x%x, ", nsp32_read2(base, SEL_TIME_OUT));\r\nprintk("sreqrate=0x%x, ", nsp32_read1(base, SREQ_SMPL_RATE));\r\nprintk("transStatus=0x%x, ", nsp32_read2(base, TRANSFER_STATUS));\r\nprintk("reselectid=0x%x, ", nsp32_read2(base, COMMAND_CONTROL));\r\nprintk("arbit=0x%x, ", nsp32_read1(base, ARBIT_STATUS));\r\nprintk("BmStart=0x%lx, ", nsp32_read4(base, BM_START_ADR));\r\nprintk("BmCount=0x%lx, ", nsp32_read4(base, BM_CNT));\r\nprintk("SackCnt=0x%lx, ", nsp32_read4(base, SACK_CNT));\r\nprintk("SReqCnt=0x%lx, ", nsp32_read4(base, SREQ_CNT));\r\nprintk("SavedSackCnt=0x%lx, ", nsp32_read4(base, SAVED_SACK_CNT));\r\nprintk("ScsiBusControl=0x%x, ", nsp32_read1(base, SCSI_BUS_CONTROL));\r\nprintk("FifoRestCnt=0x%x, ", nsp32_read2(base, FIFO_REST_CNT));\r\nprintk("CdbIn=0x%x, ", nsp32_read1(base, SCSI_CSB_IN));\r\nprintk("\n");\r\nif (0) {\r\nprintk("execph=0x%x, ", nsp32_read2(base, SCSI_EXECUTE_PHASE));\r\nprintk("IrqStatus=0x%x, ", nsp32_read2(base, IRQ_STATUS));\r\nprintk("\n");\r\n}\r\n}
