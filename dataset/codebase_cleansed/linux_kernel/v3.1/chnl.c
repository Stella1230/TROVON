int chnl_create(struct chnl_mgr **channel_mgr,\r\nstruct dev_object *hdev_obj,\r\nconst struct chnl_mgrattrs *mgr_attrts)\r\n{\r\nint status;\r\nstruct chnl_mgr *hchnl_mgr;\r\nstruct chnl_mgr_ *chnl_mgr_obj = NULL;\r\nDBC_REQUIRE(refs > 0);\r\nDBC_REQUIRE(channel_mgr != NULL);\r\nDBC_REQUIRE(mgr_attrts != NULL);\r\n*channel_mgr = NULL;\r\nif ((0 < mgr_attrts->max_channels) &&\r\n(mgr_attrts->max_channels <= CHNL_MAXCHANNELS))\r\nstatus = 0;\r\nelse if (mgr_attrts->max_channels == 0)\r\nstatus = -EINVAL;\r\nelse\r\nstatus = -ECHRNG;\r\nif (mgr_attrts->word_size == 0)\r\nstatus = -EINVAL;\r\nif (!status) {\r\nstatus = dev_get_chnl_mgr(hdev_obj, &hchnl_mgr);\r\nif (!status && hchnl_mgr != NULL)\r\nstatus = -EEXIST;\r\n}\r\nif (!status) {\r\nstruct bridge_drv_interface *intf_fxns;\r\ndev_get_intf_fxns(hdev_obj, &intf_fxns);\r\nstatus = (*intf_fxns->chnl_create) (&hchnl_mgr, hdev_obj,\r\nmgr_attrts);\r\nif (!status) {\r\nchnl_mgr_obj = (struct chnl_mgr_ *)hchnl_mgr;\r\nchnl_mgr_obj->intf_fxns = intf_fxns;\r\n*channel_mgr = hchnl_mgr;\r\n}\r\n}\r\nDBC_ENSURE(status || chnl_mgr_obj);\r\nreturn status;\r\n}\r\nint chnl_destroy(struct chnl_mgr *hchnl_mgr)\r\n{\r\nstruct chnl_mgr_ *chnl_mgr_obj = (struct chnl_mgr_ *)hchnl_mgr;\r\nstruct bridge_drv_interface *intf_fxns;\r\nint status;\r\nDBC_REQUIRE(refs > 0);\r\nif (chnl_mgr_obj) {\r\nintf_fxns = chnl_mgr_obj->intf_fxns;\r\nstatus = (*intf_fxns->chnl_destroy) (hchnl_mgr);\r\n} else {\r\nstatus = -EFAULT;\r\n}\r\nreturn status;\r\n}\r\nvoid chnl_exit(void)\r\n{\r\nDBC_REQUIRE(refs > 0);\r\nrefs--;\r\nDBC_ENSURE(refs >= 0);\r\n}\r\nbool chnl_init(void)\r\n{\r\nbool ret = true;\r\nDBC_REQUIRE(refs >= 0);\r\nif (ret)\r\nrefs++;\r\nDBC_ENSURE((ret && (refs > 0)) || (!ret && (refs >= 0)));\r\nreturn ret;\r\n}
