static inline struct s3c24xx_gpio_led *pdev_to_gpio(struct platform_device *dev)\r\n{\r\nreturn platform_get_drvdata(dev);\r\n}\r\nstatic inline struct s3c24xx_gpio_led *to_gpio(struct led_classdev *led_cdev)\r\n{\r\nreturn container_of(led_cdev, struct s3c24xx_gpio_led, cdev);\r\n}\r\nstatic void s3c24xx_led_set(struct led_classdev *led_cdev,\r\nenum led_brightness value)\r\n{\r\nstruct s3c24xx_gpio_led *led = to_gpio(led_cdev);\r\nstruct s3c24xx_led_platdata *pd = led->pdata;\r\ns3c2410_gpio_setpin(pd->gpio, (value ? 1 : 0) ^\r\n(pd->flags & S3C24XX_LEDF_ACTLOW));\r\nif (pd->flags & S3C24XX_LEDF_TRISTATE)\r\ns3c2410_gpio_cfgpin(pd->gpio,\r\nvalue ? S3C2410_GPIO_OUTPUT : S3C2410_GPIO_INPUT);\r\n}\r\nstatic int s3c24xx_led_remove(struct platform_device *dev)\r\n{\r\nstruct s3c24xx_gpio_led *led = pdev_to_gpio(dev);\r\nled_classdev_unregister(&led->cdev);\r\nkfree(led);\r\nreturn 0;\r\n}\r\nstatic int s3c24xx_led_probe(struct platform_device *dev)\r\n{\r\nstruct s3c24xx_led_platdata *pdata = dev->dev.platform_data;\r\nstruct s3c24xx_gpio_led *led;\r\nint ret;\r\nled = kzalloc(sizeof(struct s3c24xx_gpio_led), GFP_KERNEL);\r\nif (led == NULL) {\r\ndev_err(&dev->dev, "No memory for device\n");\r\nreturn -ENOMEM;\r\n}\r\nplatform_set_drvdata(dev, led);\r\nled->cdev.brightness_set = s3c24xx_led_set;\r\nled->cdev.default_trigger = pdata->def_trigger;\r\nled->cdev.name = pdata->name;\r\nled->cdev.flags |= LED_CORE_SUSPENDRESUME;\r\nled->pdata = pdata;\r\nif (pdata->flags & S3C24XX_LEDF_TRISTATE) {\r\ns3c2410_gpio_setpin(pdata->gpio, 0);\r\ns3c2410_gpio_cfgpin(pdata->gpio, S3C2410_GPIO_INPUT);\r\n} else {\r\ns3c2410_gpio_pullup(pdata->gpio, 0);\r\ns3c2410_gpio_setpin(pdata->gpio, 0);\r\ns3c2410_gpio_cfgpin(pdata->gpio, S3C2410_GPIO_OUTPUT);\r\n}\r\nret = led_classdev_register(&dev->dev, &led->cdev);\r\nif (ret < 0) {\r\ndev_err(&dev->dev, "led_classdev_register failed\n");\r\nkfree(led);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init s3c24xx_led_init(void)\r\n{\r\nreturn platform_driver_register(&s3c24xx_led_driver);\r\n}\r\nstatic void __exit s3c24xx_led_exit(void)\r\n{\r\nplatform_driver_unregister(&s3c24xx_led_driver);\r\n}
