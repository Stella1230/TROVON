static u32 starfire_get_time(void)\r\n{\r\nstatic char obp_gettod[32];\r\nstatic u32 unix_tod;\r\nsprintf(obp_gettod, "h# %08x unix-gettod",\r\n(unsigned int) (long) &unix_tod);\r\nprom_feval(obp_gettod);\r\nreturn unix_tod;\r\n}\r\nstatic int starfire_read_time(struct device *dev, struct rtc_time *tm)\r\n{\r\nrtc_time_to_tm(starfire_get_time(), tm);\r\nreturn rtc_valid_tm(tm);\r\n}\r\nstatic int __init starfire_rtc_probe(struct platform_device *pdev)\r\n{\r\nstruct rtc_device *rtc = rtc_device_register("starfire", &pdev->dev,\r\n&starfire_rtc_ops, THIS_MODULE);\r\nif (IS_ERR(rtc))\r\nreturn PTR_ERR(rtc);\r\nplatform_set_drvdata(pdev, rtc);\r\nreturn 0;\r\n}\r\nstatic int __exit starfire_rtc_remove(struct platform_device *pdev)\r\n{\r\nstruct rtc_device *rtc = platform_get_drvdata(pdev);\r\nrtc_device_unregister(rtc);\r\nreturn 0;\r\n}\r\nstatic int __init starfire_rtc_init(void)\r\n{\r\nreturn platform_driver_probe(&starfire_rtc_driver, starfire_rtc_probe);\r\n}\r\nstatic void __exit starfire_rtc_exit(void)\r\n{\r\nplatform_driver_unregister(&starfire_rtc_driver);\r\n}
