static void clock_source_select(const char *dev_id, unsigned int clkval)\r\n{\r\nunsigned int clksel, offset;\r\nclksel = __raw_readl(REG_CLKSEL);\r\nif (strcmp(dev_id, "nuc900-ms") == 0)\r\noffset = MSOFFSET;\r\nelse if (strcmp(dev_id, "nuc900-atapi") == 0)\r\noffset = ATAOFFSET;\r\nelse if (strcmp(dev_id, "nuc900-lcd") == 0)\r\noffset = LCDOFFSET;\r\nelse if (strcmp(dev_id, "nuc900-audio") == 0)\r\noffset = AUDOFFSET;\r\nelse\r\noffset = CPUOFFSET;\r\nclksel &= ~(0x03 << offset);\r\nclksel |= (clkval << offset);\r\n__raw_writel(clksel, REG_CLKSEL);\r\n}\r\nvoid nuc900_clock_source(struct device *dev, unsigned char *src)\r\n{\r\nunsigned int clkval;\r\nconst char *dev_id;\r\nBUG_ON(!src);\r\nclkval = 0;\r\nmutex_lock(&clksel_sem);\r\nif (dev)\r\ndev_id = dev_name(dev);\r\nelse\r\ndev_id = "cpufreq";\r\nif (strcmp(src, "pll0") == 0)\r\nclkval = PLL0;\r\nelse if (strcmp(src, "pll1") == 0)\r\nclkval = PLL1;\r\nelse if (strcmp(src, "ext") == 0)\r\nclkval = EXT;\r\nelse if (strcmp(src, "oth") == 0)\r\nclkval = OTHER;\r\nclock_source_select(dev_id, clkval);\r\nmutex_unlock(&clksel_sem);\r\n}
