void\r\n_fp_udivmodti4(_FP_W_TYPE q[2], _FP_W_TYPE r[2],\r\n_FP_W_TYPE n1, _FP_W_TYPE n0,\r\n_FP_W_TYPE d1, _FP_W_TYPE d0)\r\n{\r\n_FP_W_TYPE q0, q1, r0, r1;\r\n_FP_I_TYPE b, bm;\r\nif (d1 == 0)\r\n{\r\n#if !UDIV_NEEDS_NORMALIZATION\r\nif (d0 > n1)\r\n{\r\nudiv_qrnnd (q0, n0, n1, n0, d0);\r\nq1 = 0;\r\n}\r\nelse\r\n{\r\nif (d0 == 0)\r\nd0 = 1 / d0;\r\nudiv_qrnnd (q1, n1, 0, n1, d0);\r\nudiv_qrnnd (q0, n0, n1, n0, d0);\r\n}\r\nr0 = n0;\r\nr1 = 0;\r\n#else\r\nif (d0 > n1)\r\n{\r\ncount_leading_zeros (bm, d0);\r\nif (bm != 0)\r\n{\r\nd0 = d0 << bm;\r\nn1 = (n1 << bm) | (n0 >> (_FP_W_TYPE_SIZE - bm));\r\nn0 = n0 << bm;\r\n}\r\nudiv_qrnnd (q0, n0, n1, n0, d0);\r\nq1 = 0;\r\n}\r\nelse\r\n{\r\nif (d0 == 0)\r\nd0 = 1 / d0;\r\ncount_leading_zeros (bm, d0);\r\nif (bm == 0)\r\n{\r\nn1 -= d0;\r\nq1 = 1;\r\n}\r\nelse\r\n{\r\n_FP_W_TYPE n2;\r\nb = _FP_W_TYPE_SIZE - bm;\r\nd0 = d0 << bm;\r\nn2 = n1 >> b;\r\nn1 = (n1 << bm) | (n0 >> b);\r\nn0 = n0 << bm;\r\nudiv_qrnnd (q1, n1, n2, n1, d0);\r\n}\r\nudiv_qrnnd (q0, n0, n1, n0, d0);\r\n}\r\nr0 = n0 >> bm;\r\nr1 = 0;\r\n#endif\r\n}\r\nelse\r\n{\r\nif (d1 > n1)\r\n{\r\nq0 = 0;\r\nq1 = 0;\r\nr0 = n0;\r\nr1 = n1;\r\n}\r\nelse\r\n{\r\ncount_leading_zeros (bm, d1);\r\nif (bm == 0)\r\n{\r\nif (n1 > d1 || n0 >= d0)\r\n{\r\nq0 = 1;\r\nsub_ddmmss (n1, n0, n1, n0, d1, d0);\r\n}\r\nelse\r\nq0 = 0;\r\nq1 = 0;\r\nr0 = n0;\r\nr1 = n1;\r\n}\r\nelse\r\n{\r\n_FP_W_TYPE m1, m0, n2;\r\nb = _FP_W_TYPE_SIZE - bm;\r\nd1 = (d1 << bm) | (d0 >> b);\r\nd0 = d0 << bm;\r\nn2 = n1 >> b;\r\nn1 = (n1 << bm) | (n0 >> b);\r\nn0 = n0 << bm;\r\nudiv_qrnnd (q0, n1, n2, n1, d1);\r\numul_ppmm (m1, m0, q0, d0);\r\nif (m1 > n1 || (m1 == n1 && m0 > n0))\r\n{\r\nq0--;\r\nsub_ddmmss (m1, m0, m1, m0, d1, d0);\r\n}\r\nq1 = 0;\r\nsub_ddmmss (n1, n0, n1, n0, m1, m0);\r\nr0 = (n1 << b) | (n0 >> bm);\r\nr1 = n1 >> bm;\r\n}\r\n}\r\n}\r\nq[0] = q0; q[1] = q1;\r\nr[0] = r0, r[1] = r1;\r\n}
