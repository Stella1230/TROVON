unsigned long find_last_bit(const unsigned long *addr, unsigned long size)\r\n{\r\nunsigned long words;\r\nunsigned long tmp;\r\nwords = size / BITS_PER_LONG;\r\nif (size & (BITS_PER_LONG-1)) {\r\ntmp = (addr[words] & (~0UL >> (BITS_PER_LONG\r\n- (size & (BITS_PER_LONG-1)))));\r\nif (tmp)\r\ngoto found;\r\n}\r\nwhile (words) {\r\ntmp = addr[--words];\r\nif (tmp) {\r\nfound:\r\nreturn words * BITS_PER_LONG + __fls(tmp);\r\n}\r\n}\r\nreturn size;\r\n}
