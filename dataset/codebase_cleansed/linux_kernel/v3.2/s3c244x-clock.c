static int s3c2440_setparent_armclk(struct clk *clk, struct clk *parent)\r\n{\r\nunsigned long camdivn;\r\nunsigned long dvs;\r\nif (parent == &clk_f)\r\ndvs = 0;\r\nelse if (parent == &clk_h)\r\ndvs = S3C2440_CAMDIVN_DVSEN;\r\nelse\r\nreturn -EINVAL;\r\nclk->parent = parent;\r\ncamdivn = __raw_readl(S3C2440_CAMDIVN);\r\ncamdivn &= ~S3C2440_CAMDIVN_DVSEN;\r\ncamdivn |= dvs;\r\n__raw_writel(camdivn, S3C2440_CAMDIVN);\r\nreturn 0;\r\n}\r\nstatic int s3c244x_clk_add(struct sys_device *sysdev)\r\n{\r\nunsigned long camdivn = __raw_readl(S3C2440_CAMDIVN);\r\nunsigned long clkdivn;\r\nstruct clk *clock_upll;\r\nint ret;\r\nprintk("S3C244X: Clock Support, DVS %s\n",\r\n(camdivn & S3C2440_CAMDIVN_DVSEN) ? "on" : "off");\r\nclk_arm.parent = (camdivn & S3C2440_CAMDIVN_DVSEN) ? &clk_h : &clk_f;\r\nret = s3c24xx_register_clock(&clk_arm);\r\nif (ret < 0) {\r\nprintk(KERN_ERR "S3C24XX: Failed to add armclk (%d)\n", ret);\r\nreturn ret;\r\n}\r\nclock_upll = clk_get(NULL, "upll");\r\nif (IS_ERR(clock_upll)) {\r\nprintk(KERN_ERR "S3C244X: Failed to get upll clock\n");\r\nreturn -ENOENT;\r\n}\r\nif (clk_get_rate(clock_upll) > (94 * MHZ)) {\r\nclk_usb_bus.rate = clk_get_rate(clock_upll) / 2;\r\nspin_lock(&clocks_lock);\r\nclkdivn = __raw_readl(S3C2410_CLKDIVN);\r\nclkdivn |= S3C2440_CLKDIVN_UCLK;\r\n__raw_writel(clkdivn, S3C2410_CLKDIVN);\r\nspin_unlock(&clocks_lock);\r\n}\r\nreturn 0;\r\n}\r\nstatic int s3c2440_clk_init(void)\r\n{\r\nreturn sysdev_driver_register(&s3c2440_sysclass, &s3c2440_clk_driver);\r\n}\r\nstatic int s3c2442_clk_init(void)\r\n{\r\nreturn sysdev_driver_register(&s3c2442_sysclass, &s3c2442_clk_driver);\r\n}
