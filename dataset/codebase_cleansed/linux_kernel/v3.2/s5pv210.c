static int s5pv210_serial_setsource(struct uart_port *port,\r\nstruct s3c24xx_uart_clksrc *clk)\r\n{\r\nstruct s3c2410_uartcfg *cfg = port->dev->platform_data;\r\nunsigned long ucon = rd_regl(port, S3C2410_UCON);\r\nif (cfg->flags & NO_NEED_CHECK_CLKSRC)\r\nreturn 0;\r\nif (strcmp(clk->name, "pclk") == 0)\r\nucon &= ~S5PV210_UCON_CLKMASK;\r\nelse if (strcmp(clk->name, "uclk1") == 0)\r\nucon |= S5PV210_UCON_CLKMASK;\r\nelse {\r\nprintk(KERN_ERR "unknown clock source %s\n", clk->name);\r\nreturn -EINVAL;\r\n}\r\nwr_regl(port, S3C2410_UCON, ucon);\r\nreturn 0;\r\n}\r\nstatic int s5pv210_serial_getsource(struct uart_port *port,\r\nstruct s3c24xx_uart_clksrc *clk)\r\n{\r\nstruct s3c2410_uartcfg *cfg = port->dev->platform_data;\r\nu32 ucon = rd_regl(port, S3C2410_UCON);\r\nclk->divisor = 1;\r\nif (cfg->flags & NO_NEED_CHECK_CLKSRC)\r\nreturn 0;\r\nswitch (ucon & S5PV210_UCON_CLKMASK) {\r\ncase S5PV210_UCON_PCLK:\r\nclk->name = "pclk";\r\nbreak;\r\ncase S5PV210_UCON_UCLK:\r\nclk->name = "uclk1";\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int s5pv210_serial_resetport(struct uart_port *port,\r\nstruct s3c2410_uartcfg *cfg)\r\n{\r\nunsigned long ucon = rd_regl(port, S3C2410_UCON);\r\nucon &= S5PV210_UCON_CLKMASK;\r\nwr_regl(port, S3C2410_UCON, ucon | cfg->ucon);\r\nwr_regl(port, S3C2410_ULCON, cfg->ulcon);\r\nwr_regl(port, S3C2410_UFCON, cfg->ufcon | S3C2410_UFCON_RESETBOTH);\r\nwr_regl(port, S3C2410_UFCON, cfg->ufcon);\r\nudelay(1);\r\nreturn 0;\r\n}\r\nstatic int s5p_serial_probe(struct platform_device *pdev)\r\n{\r\nreturn s3c24xx_serial_probe(pdev, s5p_uart_inf[pdev->id]);\r\n}\r\nstatic int __init s5p_serial_init(void)\r\n{\r\nreturn s3c24xx_serial_init(&s5p_serial_driver, *s5p_uart_inf);\r\n}\r\nstatic void __exit s5p_serial_exit(void)\r\n{\r\nplatform_driver_unregister(&s5p_serial_driver);\r\n}
