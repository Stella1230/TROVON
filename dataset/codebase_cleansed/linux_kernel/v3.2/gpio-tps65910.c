static int tps65910_gpio_get(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65910 *tps65910 = container_of(gc, struct tps65910, gpio);\r\nuint8_t val;\r\ntps65910->read(tps65910, TPS65910_GPIO0 + offset, 1, &val);\r\nif (val & GPIO_STS_MASK)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic void tps65910_gpio_set(struct gpio_chip *gc, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65910 *tps65910 = container_of(gc, struct tps65910, gpio);\r\nif (value)\r\ntps65910_set_bits(tps65910, TPS65910_GPIO0 + offset,\r\nGPIO_SET_MASK);\r\nelse\r\ntps65910_clear_bits(tps65910, TPS65910_GPIO0 + offset,\r\nGPIO_SET_MASK);\r\n}\r\nstatic int tps65910_gpio_output(struct gpio_chip *gc, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65910 *tps65910 = container_of(gc, struct tps65910, gpio);\r\ntps65910_gpio_set(gc, 0, value);\r\nreturn tps65910_set_bits(tps65910, TPS65910_GPIO0 + offset,\r\nGPIO_CFG_MASK);\r\n}\r\nstatic int tps65910_gpio_input(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65910 *tps65910 = container_of(gc, struct tps65910, gpio);\r\nreturn tps65910_clear_bits(tps65910, TPS65910_GPIO0 + offset,\r\nGPIO_CFG_MASK);\r\n}\r\nvoid tps65910_gpio_init(struct tps65910 *tps65910, int gpio_base)\r\n{\r\nint ret;\r\nif (!gpio_base)\r\nreturn;\r\ntps65910->gpio.owner = THIS_MODULE;\r\ntps65910->gpio.label = tps65910->i2c_client->name;\r\ntps65910->gpio.dev = tps65910->dev;\r\ntps65910->gpio.base = gpio_base;\r\nswitch(tps65910_chip_id(tps65910)) {\r\ncase TPS65910:\r\ntps65910->gpio.ngpio = 6;\r\nbreak;\r\ncase TPS65911:\r\ntps65910->gpio.ngpio = 9;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\ntps65910->gpio.can_sleep = 1;\r\ntps65910->gpio.direction_input = tps65910_gpio_input;\r\ntps65910->gpio.direction_output = tps65910_gpio_output;\r\ntps65910->gpio.set = tps65910_gpio_set;\r\ntps65910->gpio.get = tps65910_gpio_get;\r\nret = gpiochip_add(&tps65910->gpio);\r\nif (ret)\r\ndev_warn(tps65910->dev, "GPIO registration failed: %d\n", ret);\r\n}
