static void\r\nbfa_hwct_msix_dummy(struct bfa_s *bfa, int vec)\r\n{\r\n}\r\nvoid\r\nbfa_hwct_reginit(struct bfa_s *bfa)\r\n{\r\nstruct bfa_iocfc_regs_s *bfa_regs = &bfa->iocfc.bfa_regs;\r\nvoid __iomem *kva = bfa_ioc_bar0(&bfa->ioc);\r\nint fn = bfa_ioc_pcifn(&bfa->ioc);\r\nif (fn == 0) {\r\nbfa_regs->intr_status = (kva + HOSTFN0_INT_STATUS);\r\nbfa_regs->intr_mask = (kva + HOSTFN0_INT_MSK);\r\n} else {\r\nbfa_regs->intr_status = (kva + HOSTFN1_INT_STATUS);\r\nbfa_regs->intr_mask = (kva + HOSTFN1_INT_MSK);\r\n}\r\n}\r\nvoid\r\nbfa_hwct2_reginit(struct bfa_s *bfa)\r\n{\r\nstruct bfa_iocfc_regs_s *bfa_regs = &bfa->iocfc.bfa_regs;\r\nvoid __iomem *kva = bfa_ioc_bar0(&bfa->ioc);\r\nbfa_regs->intr_status = (kva + CT2_HOSTFN_INT_STATUS);\r\nbfa_regs->intr_mask = (kva + CT2_HOSTFN_INTR_MASK);\r\n}\r\nvoid\r\nbfa_hwct_reqq_ack(struct bfa_s *bfa, int reqq)\r\n{\r\nu32 r32;\r\nr32 = readl(bfa->iocfc.bfa_regs.cpe_q_ctrl[reqq]);\r\nwritel(r32, bfa->iocfc.bfa_regs.cpe_q_ctrl[reqq]);\r\n}\r\nvoid\r\nbfa_hwct_rspq_ack(struct bfa_s *bfa, int rspq, u32 ci)\r\n{\r\nu32 r32;\r\nr32 = readl(bfa->iocfc.bfa_regs.rme_q_ctrl[rspq]);\r\nwritel(r32, bfa->iocfc.bfa_regs.rme_q_ctrl[rspq]);\r\nbfa_rspq_ci(bfa, rspq) = ci;\r\nwritel(ci, bfa->iocfc.bfa_regs.rme_q_ci[rspq]);\r\nmmiowb();\r\n}\r\nvoid\r\nbfa_hwct2_rspq_ack(struct bfa_s *bfa, int rspq, u32 ci)\r\n{\r\nbfa_rspq_ci(bfa, rspq) = ci;\r\nwritel(ci, bfa->iocfc.bfa_regs.rme_q_ci[rspq]);\r\nmmiowb();\r\n}\r\nvoid\r\nbfa_hwct_msix_getvecs(struct bfa_s *bfa, u32 *msix_vecs_bmap,\r\nu32 *num_vecs, u32 *max_vec_bit)\r\n{\r\n*msix_vecs_bmap = (1 << BFI_MSIX_CT_MAX) - 1;\r\n*max_vec_bit = (1 << (BFI_MSIX_CT_MAX - 1));\r\n*num_vecs = BFI_MSIX_CT_MAX;\r\n}\r\nvoid\r\nbfa_hwct_msix_init(struct bfa_s *bfa, int nvecs)\r\n{\r\nWARN_ON((nvecs != 1) && (nvecs != BFI_MSIX_CT_MAX));\r\nbfa_trc(bfa, nvecs);\r\nbfa->msix.nvecs = nvecs;\r\nbfa_hwct_msix_uninstall(bfa);\r\n}\r\nvoid\r\nbfa_hwct_msix_ctrl_install(struct bfa_s *bfa)\r\n{\r\nif (bfa->msix.nvecs == 0)\r\nreturn;\r\nif (bfa->msix.nvecs == 1)\r\nbfa->msix.handler[BFI_MSIX_LPU_ERR_CT] = bfa_msix_all;\r\nelse\r\nbfa->msix.handler[BFI_MSIX_LPU_ERR_CT] = bfa_msix_lpu_err;\r\n}\r\nvoid\r\nbfa_hwct_msix_queue_install(struct bfa_s *bfa)\r\n{\r\nint i;\r\nif (bfa->msix.nvecs == 0)\r\nreturn;\r\nif (bfa->msix.nvecs == 1) {\r\nfor (i = BFI_MSIX_CPE_QMIN_CT; i < BFI_MSIX_CT_MAX; i++)\r\nbfa->msix.handler[i] = bfa_msix_all;\r\nreturn;\r\n}\r\nfor (i = BFI_MSIX_CPE_QMIN_CT; i <= BFI_MSIX_CPE_QMAX_CT; i++)\r\nbfa->msix.handler[i] = bfa_msix_reqq;\r\nfor (i = BFI_MSIX_RME_QMIN_CT; i <= BFI_MSIX_RME_QMAX_CT; i++)\r\nbfa->msix.handler[i] = bfa_msix_rspq;\r\n}\r\nvoid\r\nbfa_hwct_msix_uninstall(struct bfa_s *bfa)\r\n{\r\nint i;\r\nfor (i = 0; i < BFI_MSIX_CT_MAX; i++)\r\nbfa->msix.handler[i] = bfa_hwct_msix_dummy;\r\n}\r\nvoid\r\nbfa_hwct_isr_mode_set(struct bfa_s *bfa, bfa_boolean_t msix)\r\n{\r\nbfa_trc(bfa, 0);\r\nbfa_ioc_isr_mode_set(&bfa->ioc, msix);\r\n}\r\nvoid\r\nbfa_hwct_msix_get_rme_range(struct bfa_s *bfa, u32 *start, u32 *end)\r\n{\r\n*start = BFI_MSIX_RME_QMIN_CT;\r\n*end = BFI_MSIX_RME_QMAX_CT;\r\n}
