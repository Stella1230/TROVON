static inline char *iscsit_na_get_initiatorname(\r\nstruct iscsi_node_acl *nacl)\r\n{\r\nstruct se_node_acl *se_nacl = &nacl->se_node_acl;\r\nreturn &se_nacl->initiatorname[0];\r\n}\r\nvoid iscsit_set_default_node_attribues(\r\nstruct iscsi_node_acl *acl)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\na->dataout_timeout = NA_DATAOUT_TIMEOUT;\r\na->dataout_timeout_retries = NA_DATAOUT_TIMEOUT_RETRIES;\r\na->nopin_timeout = NA_NOPIN_TIMEOUT;\r\na->nopin_response_timeout = NA_NOPIN_RESPONSE_TIMEOUT;\r\na->random_datain_pdu_offsets = NA_RANDOM_DATAIN_PDU_OFFSETS;\r\na->random_datain_seq_offsets = NA_RANDOM_DATAIN_SEQ_OFFSETS;\r\na->random_r2t_offsets = NA_RANDOM_R2T_OFFSETS;\r\na->default_erl = NA_DEFAULT_ERL;\r\n}\r\nextern int iscsit_na_dataout_timeout(\r\nstruct iscsi_node_acl *acl,\r\nu32 dataout_timeout)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (dataout_timeout > NA_DATAOUT_TIMEOUT_MAX) {\r\npr_err("Requested DataOut Timeout %u larger than"\r\n" maximum %u\n", dataout_timeout,\r\nNA_DATAOUT_TIMEOUT_MAX);\r\nreturn -EINVAL;\r\n} else if (dataout_timeout < NA_DATAOUT_TIMEOUT_MIX) {\r\npr_err("Requested DataOut Timeout %u smaller than"\r\n" minimum %u\n", dataout_timeout,\r\nNA_DATAOUT_TIMEOUT_MIX);\r\nreturn -EINVAL;\r\n}\r\na->dataout_timeout = dataout_timeout;\r\npr_debug("Set DataOut Timeout to %u for Initiator Node"\r\n" %s\n", a->dataout_timeout, iscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_dataout_timeout_retries(\r\nstruct iscsi_node_acl *acl,\r\nu32 dataout_timeout_retries)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (dataout_timeout_retries > NA_DATAOUT_TIMEOUT_RETRIES_MAX) {\r\npr_err("Requested DataOut Timeout Retries %u larger"\r\n" than maximum %u", dataout_timeout_retries,\r\nNA_DATAOUT_TIMEOUT_RETRIES_MAX);\r\nreturn -EINVAL;\r\n} else if (dataout_timeout_retries < NA_DATAOUT_TIMEOUT_RETRIES_MIN) {\r\npr_err("Requested DataOut Timeout Retries %u smaller"\r\n" than minimum %u", dataout_timeout_retries,\r\nNA_DATAOUT_TIMEOUT_RETRIES_MIN);\r\nreturn -EINVAL;\r\n}\r\na->dataout_timeout_retries = dataout_timeout_retries;\r\npr_debug("Set DataOut Timeout Retries to %u for"\r\n" Initiator Node %s\n", a->dataout_timeout_retries,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_nopin_timeout(\r\nstruct iscsi_node_acl *acl,\r\nu32 nopin_timeout)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nstruct iscsi_session *sess;\r\nstruct iscsi_conn *conn;\r\nstruct se_node_acl *se_nacl = &a->nacl->se_node_acl;\r\nstruct se_session *se_sess;\r\nu32 orig_nopin_timeout = a->nopin_timeout;\r\nif (nopin_timeout > NA_NOPIN_TIMEOUT_MAX) {\r\npr_err("Requested NopIn Timeout %u larger than maximum"\r\n" %u\n", nopin_timeout, NA_NOPIN_TIMEOUT_MAX);\r\nreturn -EINVAL;\r\n} else if ((nopin_timeout < NA_NOPIN_TIMEOUT_MIN) &&\r\n(nopin_timeout != 0)) {\r\npr_err("Requested NopIn Timeout %u smaller than"\r\n" minimum %u and not 0\n", nopin_timeout,\r\nNA_NOPIN_TIMEOUT_MIN);\r\nreturn -EINVAL;\r\n}\r\na->nopin_timeout = nopin_timeout;\r\npr_debug("Set NopIn Timeout to %u for Initiator"\r\n" Node %s\n", a->nopin_timeout,\r\niscsit_na_get_initiatorname(acl));\r\nif (!orig_nopin_timeout) {\r\nspin_lock_bh(&se_nacl->nacl_sess_lock);\r\nse_sess = se_nacl->nacl_sess;\r\nif (se_sess) {\r\nsess = (struct iscsi_session *)se_sess->fabric_sess_ptr;\r\nspin_lock(&sess->conn_lock);\r\nlist_for_each_entry(conn, &sess->sess_conn_list,\r\nconn_list) {\r\nif (conn->conn_state !=\r\nTARG_CONN_STATE_LOGGED_IN)\r\ncontinue;\r\nspin_lock(&conn->nopin_timer_lock);\r\n__iscsit_start_nopin_timer(conn);\r\nspin_unlock(&conn->nopin_timer_lock);\r\n}\r\nspin_unlock(&sess->conn_lock);\r\n}\r\nspin_unlock_bh(&se_nacl->nacl_sess_lock);\r\n}\r\nreturn 0;\r\n}\r\nextern int iscsit_na_nopin_response_timeout(\r\nstruct iscsi_node_acl *acl,\r\nu32 nopin_response_timeout)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (nopin_response_timeout > NA_NOPIN_RESPONSE_TIMEOUT_MAX) {\r\npr_err("Requested NopIn Response Timeout %u larger"\r\n" than maximum %u\n", nopin_response_timeout,\r\nNA_NOPIN_RESPONSE_TIMEOUT_MAX);\r\nreturn -EINVAL;\r\n} else if (nopin_response_timeout < NA_NOPIN_RESPONSE_TIMEOUT_MIN) {\r\npr_err("Requested NopIn Response Timeout %u smaller"\r\n" than minimum %u\n", nopin_response_timeout,\r\nNA_NOPIN_RESPONSE_TIMEOUT_MIN);\r\nreturn -EINVAL;\r\n}\r\na->nopin_response_timeout = nopin_response_timeout;\r\npr_debug("Set NopIn Response Timeout to %u for"\r\n" Initiator Node %s\n", a->nopin_timeout,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_random_datain_pdu_offsets(\r\nstruct iscsi_node_acl *acl,\r\nu32 random_datain_pdu_offsets)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (random_datain_pdu_offsets != 0 && random_datain_pdu_offsets != 1) {\r\npr_err("Requested Random DataIN PDU Offsets: %u not"\r\n" 0 or 1\n", random_datain_pdu_offsets);\r\nreturn -EINVAL;\r\n}\r\na->random_datain_pdu_offsets = random_datain_pdu_offsets;\r\npr_debug("Set Random DataIN PDU Offsets to %u for"\r\n" Initiator Node %s\n", a->random_datain_pdu_offsets,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_random_datain_seq_offsets(\r\nstruct iscsi_node_acl *acl,\r\nu32 random_datain_seq_offsets)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (random_datain_seq_offsets != 0 && random_datain_seq_offsets != 1) {\r\npr_err("Requested Random DataIN Sequence Offsets: %u"\r\n" not 0 or 1\n", random_datain_seq_offsets);\r\nreturn -EINVAL;\r\n}\r\na->random_datain_seq_offsets = random_datain_seq_offsets;\r\npr_debug("Set Random DataIN Sequence Offsets to %u for"\r\n" Initiator Node %s\n", a->random_datain_seq_offsets,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_random_r2t_offsets(\r\nstruct iscsi_node_acl *acl,\r\nu32 random_r2t_offsets)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (random_r2t_offsets != 0 && random_r2t_offsets != 1) {\r\npr_err("Requested Random R2T Offsets: %u not"\r\n" 0 or 1\n", random_r2t_offsets);\r\nreturn -EINVAL;\r\n}\r\na->random_r2t_offsets = random_r2t_offsets;\r\npr_debug("Set Random R2T Offsets to %u for"\r\n" Initiator Node %s\n", a->random_r2t_offsets,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}\r\nextern int iscsit_na_default_erl(\r\nstruct iscsi_node_acl *acl,\r\nu32 default_erl)\r\n{\r\nstruct iscsi_node_attrib *a = &acl->node_attrib;\r\nif (default_erl != 0 && default_erl != 1 && default_erl != 2) {\r\npr_err("Requested default ERL: %u not 0, 1, or 2\n",\r\ndefault_erl);\r\nreturn -EINVAL;\r\n}\r\na->default_erl = default_erl;\r\npr_debug("Set use ERL0 flag to %u for Initiator"\r\n" Node %s\n", a->default_erl,\r\niscsit_na_get_initiatorname(acl));\r\nreturn 0;\r\n}
