static int nfsd_proc_show(struct seq_file *seq, void *v)\r\n{\r\nint i;\r\nseq_printf(seq, "rc %u %u %u\nfh %u %u %u %u %u\nio %u %u\n",\r\nnfsdstats.rchits,\r\nnfsdstats.rcmisses,\r\nnfsdstats.rcnocache,\r\nnfsdstats.fh_stale,\r\nnfsdstats.fh_lookup,\r\nnfsdstats.fh_anon,\r\nnfsdstats.fh_nocache_dir,\r\nnfsdstats.fh_nocache_nondir,\r\nnfsdstats.io_read,\r\nnfsdstats.io_write);\r\nseq_printf(seq, "th %u %u", nfsdstats.th_cnt, nfsdstats.th_fullcnt);\r\nfor (i=0; i<10; i++) {\r\nunsigned int jifs = nfsdstats.th_usage[i];\r\nunsigned int sec = jifs / HZ, msec = (jifs % HZ)*1000/HZ;\r\nseq_printf(seq, " %u.%03u", sec, msec);\r\n}\r\nseq_printf(seq, "\nra %u", nfsdstats.ra_size);\r\nfor (i=0; i<11; i++)\r\nseq_printf(seq, " %u", nfsdstats.ra_depth[i]);\r\nseq_putc(seq, '\n');\r\nsvc_seq_show(seq, &nfsd_svcstats);\r\n#ifdef CONFIG_NFSD_V4\r\nseq_printf(seq,"proc4ops %u", LAST_NFS4_OP + 1);\r\nfor (i = 0; i <= LAST_NFS4_OP; i++)\r\nseq_printf(seq, " %u", nfsdstats.nfs4_opcount[i]);\r\nseq_putc(seq, '\n');\r\n#endif\r\nreturn 0;\r\n}\r\nstatic int nfsd_proc_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, nfsd_proc_show, NULL);\r\n}\r\nvoid\r\nnfsd_stat_init(void)\r\n{\r\nsvc_proc_register(&nfsd_svcstats, &nfsd_proc_fops);\r\n}\r\nvoid\r\nnfsd_stat_shutdown(void)\r\n{\r\nsvc_proc_unregister("nfsd");\r\n}
