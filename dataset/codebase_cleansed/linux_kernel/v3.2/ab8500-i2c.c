static int ab8500_i2c_write(struct ab8500 *ab8500, u16 addr, u8 data)\r\n{\r\nint ret;\r\nret = prcmu_abb_write((u8)(addr >> 8), (u8)(addr & 0xFF), &data, 1);\r\nif (ret < 0)\r\ndev_err(ab8500->dev, "prcmu i2c error %d\n", ret);\r\nreturn ret;\r\n}\r\nstatic int ab8500_i2c_read(struct ab8500 *ab8500, u16 addr)\r\n{\r\nint ret;\r\nu8 data;\r\nret = prcmu_abb_read((u8)(addr >> 8), (u8)(addr & 0xFF), &data, 1);\r\nif (ret < 0) {\r\ndev_err(ab8500->dev, "prcmu i2c error %d\n", ret);\r\nreturn ret;\r\n}\r\nreturn (int)data;\r\n}\r\nstatic int __devinit ab8500_i2c_probe(struct platform_device *plf)\r\n{\r\nstruct ab8500 *ab8500;\r\nstruct resource *resource;\r\nint ret;\r\nab8500 = kzalloc(sizeof *ab8500, GFP_KERNEL);\r\nif (!ab8500)\r\nreturn -ENOMEM;\r\nab8500->dev = &plf->dev;\r\nresource = platform_get_resource(plf, IORESOURCE_IRQ, 0);\r\nif (!resource) {\r\nkfree(ab8500);\r\nreturn -ENODEV;\r\n}\r\nab8500->irq = resource->start;\r\nab8500->read = ab8500_i2c_read;\r\nab8500->write = ab8500_i2c_write;\r\nplatform_set_drvdata(plf, ab8500);\r\nret = ab8500_init(ab8500);\r\nif (ret)\r\nkfree(ab8500);\r\nreturn ret;\r\n}\r\nstatic int __devexit ab8500_i2c_remove(struct platform_device *plf)\r\n{\r\nstruct ab8500 *ab8500 = platform_get_drvdata(plf);\r\nab8500_exit(ab8500);\r\nkfree(ab8500);\r\nreturn 0;\r\n}\r\nstatic int __init ab8500_i2c_init(void)\r\n{\r\nreturn platform_driver_register(&ab8500_i2c_driver);\r\n}\r\nstatic void __exit ab8500_i2c_exit(void)\r\n{\r\nplatform_driver_unregister(&ab8500_i2c_driver);\r\n}
