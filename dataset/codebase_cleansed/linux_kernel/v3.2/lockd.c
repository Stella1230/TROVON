static __be32\r\nnlm_fopen(struct svc_rqst *rqstp, struct nfs_fh *f, struct file **filp)\r\n{\r\n__be32 nfserr;\r\nstruct svc_fh fh;\r\nfh_init(&fh,0);\r\nfh.fh_handle.fh_size = f->size;\r\nmemcpy((char*)&fh.fh_handle.fh_base, f->data, f->size);\r\nfh.fh_export = NULL;\r\nnfserr = nfsd_open(rqstp, &fh, S_IFREG, NFSD_MAY_LOCK, filp);\r\nfh_put(&fh);\r\nswitch (nfserr) {\r\ncase nfs_ok:\r\nreturn 0;\r\ncase nfserr_dropit:\r\nreturn nlm_drop_reply;\r\ncase nfserr_stale:\r\nreturn nlm_stale_fh;\r\ndefault:\r\nreturn nlm_failed;\r\n}\r\n}\r\nstatic void\r\nnlm_fclose(struct file *filp)\r\n{\r\nfput(filp);\r\n}\r\nvoid\r\nnfsd_lockd_init(void)\r\n{\r\ndprintk("nfsd: initializing lockd\n");\r\nnlmsvc_ops = &nfsd_nlm_ops;\r\n}\r\nvoid\r\nnfsd_lockd_shutdown(void)\r\n{\r\nnlmsvc_ops = NULL;\r\n}
