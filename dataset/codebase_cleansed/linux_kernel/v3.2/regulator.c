void u300_pm_poweroff(void)\r\n{\r\nsigset_t old, all;\r\nsigfillset(&all);\r\nif (!sigprocmask(SIG_BLOCK, &all, &old)) {\r\nif (main_power_15)\r\nregulator_disable(main_power_15);\r\nelse\r\npr_err("regulator not available to shut down system\n");\r\n(void) sigprocmask(SIG_SETMASK, &old, NULL);\r\n}\r\nreturn;\r\n}\r\nstatic int __init u300_init_boardpower(void)\r\n{\r\nint err;\r\nu32 val;\r\npr_info("U300: setting up board power\n");\r\nmain_power_15 = regulator_get(NULL, "vana15");\r\nif (IS_ERR(main_power_15)) {\r\npr_err("could not get vana15");\r\nreturn PTR_ERR(main_power_15);\r\n}\r\nerr = regulator_enable(main_power_15);\r\nif (err) {\r\npr_err("could not enable vana15\n");\r\nreturn err;\r\n}\r\npr_info("U300: disable system controller pull-up\n");\r\nval = readw(U300_SYSCON_VBASE + U300_SYSCON_PMCR);\r\nval &= ~U300_SYSCON_PMCR_DCON_ENABLE;\r\nwritew(val, U300_SYSCON_VBASE + U300_SYSCON_PMCR);\r\npm_power_off = u300_pm_poweroff;\r\nreturn 0;\r\n}
