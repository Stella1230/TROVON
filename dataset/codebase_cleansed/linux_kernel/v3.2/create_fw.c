int write_blob(struct isci_orom *isci_orom)\r\n{\r\nFILE *fd;\r\nint err;\r\nsize_t count;\r\nfd = fopen(blob_name, "w+");\r\nif (!fd) {\r\nperror("Open file for write failed");\r\nfclose(fd);\r\nreturn -EIO;\r\n}\r\ncount = fwrite(isci_orom, sizeof(struct isci_orom), 1, fd);\r\nif (count != 1) {\r\nperror("Write data failed");\r\nfclose(fd);\r\nreturn -EIO;\r\n}\r\nfclose(fd);\r\nreturn 0;\r\n}\r\nvoid set_binary_values(struct isci_orom *isci_orom)\r\n{\r\nint ctrl_idx, phy_idx, port_idx;\r\nstrncpy(isci_orom->hdr.signature, sig, strlen(sig));\r\nisci_orom->hdr.version = version;\r\nisci_orom->hdr.total_block_length = sizeof(struct isci_orom);\r\nisci_orom->hdr.hdr_length = sizeof(struct sci_bios_oem_param_block_hdr);\r\nisci_orom->hdr.num_elements = num_elements;\r\nfor (ctrl_idx = 0; ctrl_idx < 2; ctrl_idx++) {\r\nisci_orom->ctrl[ctrl_idx].controller.mode_type = mode_type;\r\nisci_orom->ctrl[ctrl_idx].controller.max_concurrent_dev_spin_up =\r\nmax_num_concurrent_dev_spin_up;\r\nisci_orom->ctrl[ctrl_idx].controller.do_enable_ssc =\r\nenable_ssc;\r\nfor (port_idx = 0; port_idx < 4; port_idx++)\r\nisci_orom->ctrl[ctrl_idx].ports[port_idx].phy_mask =\r\nphy_mask[ctrl_idx][port_idx];\r\nfor (phy_idx = 0; phy_idx < 4; phy_idx++) {\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].sas_address.high =\r\n(__u32)(sas_addr[ctrl_idx][phy_idx] >> 32);\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].sas_address.low =\r\n(__u32)(sas_addr[ctrl_idx][phy_idx]);\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].afe_tx_amp_control0 =\r\nafe_tx_amp_control0;\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].afe_tx_amp_control1 =\r\nafe_tx_amp_control1;\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].afe_tx_amp_control2 =\r\nafe_tx_amp_control2;\r\nisci_orom->ctrl[ctrl_idx].phys[phy_idx].afe_tx_amp_control3 =\r\nafe_tx_amp_control3;\r\n}\r\n}\r\n}\r\nint main(void)\r\n{\r\nint err;\r\nstruct isci_orom *isci_orom;\r\nisci_orom = malloc(sizeof(struct isci_orom));\r\nmemset(isci_orom, 0, sizeof(struct isci_orom));\r\nset_binary_values(isci_orom);\r\nerr = write_blob(isci_orom);\r\nif (err < 0) {\r\nfree(isci_orom);\r\nreturn err;\r\n}\r\nfree(isci_orom);\r\nreturn 0;\r\n}
