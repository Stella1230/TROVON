static void *ia64_swiotlb_alloc_coherent(struct device *dev, size_t size,\r\ndma_addr_t *dma_handle, gfp_t gfp)\r\n{\r\nif (dev->coherent_dma_mask != DMA_BIT_MASK(64))\r\ngfp |= GFP_DMA;\r\nreturn swiotlb_alloc_coherent(dev, size, dma_handle, gfp);\r\n}\r\nvoid __init swiotlb_dma_init(void)\r\n{\r\ndma_ops = &swiotlb_dma_ops;\r\nswiotlb_init(1);\r\n}\r\nvoid __init pci_swiotlb_init(void)\r\n{\r\nif (!iommu_detected) {\r\n#ifdef CONFIG_IA64_GENERIC\r\nswiotlb = 1;\r\nprintk(KERN_INFO "PCI-DMA: Re-initialize machine vector.\n");\r\nmachvec_init("dig");\r\nswiotlb_init(1);\r\ndma_ops = &swiotlb_dma_ops;\r\n#else\r\npanic("Unable to find Intel IOMMU");\r\n#endif\r\n}\r\n}
