int diag14(unsigned long rx, unsigned long ry1, unsigned long subcode)\r\n{\r\nregister unsigned long _ry1 asm("2") = ry1;\r\nregister unsigned long _ry2 asm("3") = subcode;\r\nint rc = 0;\r\nasm volatile(\r\n#ifdef CONFIG_64BIT\r\n" sam31\n"\r\n" diag %2,2,0x14\n"\r\n" sam64\n"\r\n#else\r\n" diag %2,2,0x14\n"\r\n#endif\r\n" ipm %0\n"\r\n" srl %0,28\n"\r\n: "=d" (rc), "+d" (_ry2)\r\n: "d" (rx), "d" (_ry1)\r\n: "cc");\r\nreturn rc;\r\n}\r\nint diag210(struct diag210 *addr)\r\n{\r\nstatic struct diag210 diag210_tmp;\r\nstatic DEFINE_SPINLOCK(diag210_lock);\r\nunsigned long flags;\r\nint ccode;\r\nspin_lock_irqsave(&diag210_lock, flags);\r\ndiag210_tmp = *addr;\r\n#ifdef CONFIG_64BIT\r\nasm volatile(\r\n" lhi %0,-1\n"\r\n" sam31\n"\r\n" diag %1,0,0x210\n"\r\n"0: ipm %0\n"\r\n" srl %0,28\n"\r\n"1: sam64\n"\r\nEX_TABLE(0b, 1b)\r\n: "=&d" (ccode) : "a" (&diag210_tmp) : "cc", "memory");\r\n#else\r\nasm volatile(\r\n" lhi %0,-1\n"\r\n" diag %1,0,0x210\n"\r\n"0: ipm %0\n"\r\n" srl %0,28\n"\r\n"1:\n"\r\nEX_TABLE(0b, 1b)\r\n: "=&d" (ccode) : "a" (&diag210_tmp) : "cc", "memory");\r\n#endif\r\n*addr = diag210_tmp;\r\nspin_unlock_irqrestore(&diag210_lock, flags);\r\nreturn ccode;\r\n}
