int\r\nmain(int argc, char **argv)\r\n{\r\nunsigned char ei[EI_NIDENT];\r\nunion { short s; char c[2]; } endian_test;\r\nif (fread(ei, 1, EI_NIDENT, stdin) != EI_NIDENT) {\r\nfprintf(stderr, "Error: input truncated\n");\r\nreturn 1;\r\n}\r\nif (memcmp(ei, ELFMAG, SELFMAG) != 0) {\r\nfprintf(stderr, "Error: not ELF\n");\r\nreturn 1;\r\n}\r\nswitch (ei[EI_CLASS]) {\r\ncase ELFCLASS32:\r\nprintf("#define KERNEL_ELFCLASS ELFCLASS32\n");\r\nbreak;\r\ncase ELFCLASS64:\r\nprintf("#define KERNEL_ELFCLASS ELFCLASS64\n");\r\nbreak;\r\ndefault:\r\nexit(1);\r\n}\r\nswitch (ei[EI_DATA]) {\r\ncase ELFDATA2LSB:\r\nprintf("#define KERNEL_ELFDATA ELFDATA2LSB\n");\r\nbreak;\r\ncase ELFDATA2MSB:\r\nprintf("#define KERNEL_ELFDATA ELFDATA2MSB\n");\r\nbreak;\r\ndefault:\r\nexit(1);\r\n}\r\nif (sizeof(unsigned long) == 4) {\r\nprintf("#define HOST_ELFCLASS ELFCLASS32\n");\r\n} else if (sizeof(unsigned long) == 8) {\r\nprintf("#define HOST_ELFCLASS ELFCLASS64\n");\r\n}\r\nendian_test.s = 0x0102;\r\nif (memcmp(endian_test.c, "\x01\x02", 2) == 0)\r\nprintf("#define HOST_ELFDATA ELFDATA2MSB\n");\r\nelse if (memcmp(endian_test.c, "\x02\x01", 2) == 0)\r\nprintf("#define HOST_ELFDATA ELFDATA2LSB\n");\r\nelse\r\nexit(1);\r\nreturn 0;\r\n}
