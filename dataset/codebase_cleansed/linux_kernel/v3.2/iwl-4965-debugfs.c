static int iwl4965_statistics_flag(struct iwl_priv *priv, char *buf, int bufsz)\r\n{\r\nint p = 0;\r\nu32 flag;\r\nflag = le32_to_cpu(priv->_4965.statistics.flag);\r\np += scnprintf(buf + p, bufsz - p, "Statistics Flag(0x%X):\n", flag);\r\nif (flag & UCODE_STATISTICS_CLEAR_MSK)\r\np += scnprintf(buf + p, bufsz - p,\r\n"\tStatistics have been cleared\n");\r\np += scnprintf(buf + p, bufsz - p, "\tOperational Frequency: %s\n",\r\n(flag & UCODE_STATISTICS_FREQUENCY_MSK)\r\n? "2.4 GHz" : "5.2 GHz");\r\np += scnprintf(buf + p, bufsz - p, "\tTGj Narrow Band: %s\n",\r\n(flag & UCODE_STATISTICS_NARROW_BAND_MSK)\r\n? "enabled" : "disabled");\r\nreturn p;\r\n}\r\nssize_t iwl4965_ucode_rx_stats_read(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct iwl_priv *priv = file->private_data;\r\nint pos = 0;\r\nchar *buf;\r\nint bufsz = sizeof(struct statistics_rx_phy) * 40 +\r\nsizeof(struct statistics_rx_non_phy) * 40 +\r\nsizeof(struct statistics_rx_ht_phy) * 40 + 400;\r\nssize_t ret;\r\nstruct statistics_rx_phy *ofdm, *accum_ofdm, *delta_ofdm, *max_ofdm;\r\nstruct statistics_rx_phy *cck, *accum_cck, *delta_cck, *max_cck;\r\nstruct statistics_rx_non_phy *general, *accum_general;\r\nstruct statistics_rx_non_phy *delta_general, *max_general;\r\nstruct statistics_rx_ht_phy *ht, *accum_ht, *delta_ht, *max_ht;\r\nif (!iwl_legacy_is_alive(priv))\r\nreturn -EAGAIN;\r\nbuf = kzalloc(bufsz, GFP_KERNEL);\r\nif (!buf) {\r\nIWL_ERR(priv, "Can not allocate Buffer\n");\r\nreturn -ENOMEM;\r\n}\r\nofdm = &priv->_4965.statistics.rx.ofdm;\r\ncck = &priv->_4965.statistics.rx.cck;\r\ngeneral = &priv->_4965.statistics.rx.general;\r\nht = &priv->_4965.statistics.rx.ofdm_ht;\r\naccum_ofdm = &priv->_4965.accum_statistics.rx.ofdm;\r\naccum_cck = &priv->_4965.accum_statistics.rx.cck;\r\naccum_general = &priv->_4965.accum_statistics.rx.general;\r\naccum_ht = &priv->_4965.accum_statistics.rx.ofdm_ht;\r\ndelta_ofdm = &priv->_4965.delta_statistics.rx.ofdm;\r\ndelta_cck = &priv->_4965.delta_statistics.rx.cck;\r\ndelta_general = &priv->_4965.delta_statistics.rx.general;\r\ndelta_ht = &priv->_4965.delta_statistics.rx.ofdm_ht;\r\nmax_ofdm = &priv->_4965.max_delta.rx.ofdm;\r\nmax_cck = &priv->_4965.max_delta.rx.cck;\r\nmax_general = &priv->_4965.max_delta.rx.general;\r\nmax_ht = &priv->_4965.max_delta.rx.ofdm_ht;\r\npos += iwl4965_statistics_flag(priv, buf, bufsz);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_Rx - OFDM:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "ina_cnt:",\r\nle32_to_cpu(ofdm->ina_cnt),\r\naccum_ofdm->ina_cnt,\r\ndelta_ofdm->ina_cnt, max_ofdm->ina_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_cnt:",\r\nle32_to_cpu(ofdm->fina_cnt), accum_ofdm->fina_cnt,\r\ndelta_ofdm->fina_cnt, max_ofdm->fina_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "plcp_err:",\r\nle32_to_cpu(ofdm->plcp_err), accum_ofdm->plcp_err,\r\ndelta_ofdm->plcp_err, max_ofdm->plcp_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_err:",\r\nle32_to_cpu(ofdm->crc32_err), accum_ofdm->crc32_err,\r\ndelta_ofdm->crc32_err, max_ofdm->crc32_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "overrun_err:",\r\nle32_to_cpu(ofdm->overrun_err),\r\naccum_ofdm->overrun_err, delta_ofdm->overrun_err,\r\nmax_ofdm->overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "early_overrun_err:",\r\nle32_to_cpu(ofdm->early_overrun_err),\r\naccum_ofdm->early_overrun_err,\r\ndelta_ofdm->early_overrun_err,\r\nmax_ofdm->early_overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_good:",\r\nle32_to_cpu(ofdm->crc32_good),\r\naccum_ofdm->crc32_good, delta_ofdm->crc32_good,\r\nmax_ofdm->crc32_good);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "false_alarm_cnt:",\r\nle32_to_cpu(ofdm->false_alarm_cnt),\r\naccum_ofdm->false_alarm_cnt,\r\ndelta_ofdm->false_alarm_cnt,\r\nmax_ofdm->false_alarm_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_sync_err_cnt:",\r\nle32_to_cpu(ofdm->fina_sync_err_cnt),\r\naccum_ofdm->fina_sync_err_cnt,\r\ndelta_ofdm->fina_sync_err_cnt,\r\nmax_ofdm->fina_sync_err_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sfd_timeout:",\r\nle32_to_cpu(ofdm->sfd_timeout),\r\naccum_ofdm->sfd_timeout, delta_ofdm->sfd_timeout,\r\nmax_ofdm->sfd_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_timeout:",\r\nle32_to_cpu(ofdm->fina_timeout),\r\naccum_ofdm->fina_timeout, delta_ofdm->fina_timeout,\r\nmax_ofdm->fina_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "unresponded_rts:",\r\nle32_to_cpu(ofdm->unresponded_rts),\r\naccum_ofdm->unresponded_rts,\r\ndelta_ofdm->unresponded_rts,\r\nmax_ofdm->unresponded_rts);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "rxe_frame_lmt_ovrun:",\r\nle32_to_cpu(ofdm->rxe_frame_limit_overrun),\r\naccum_ofdm->rxe_frame_limit_overrun,\r\ndelta_ofdm->rxe_frame_limit_overrun,\r\nmax_ofdm->rxe_frame_limit_overrun);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_ack_cnt:",\r\nle32_to_cpu(ofdm->sent_ack_cnt),\r\naccum_ofdm->sent_ack_cnt, delta_ofdm->sent_ack_cnt,\r\nmax_ofdm->sent_ack_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_cts_cnt:",\r\nle32_to_cpu(ofdm->sent_cts_cnt),\r\naccum_ofdm->sent_cts_cnt, delta_ofdm->sent_cts_cnt,\r\nmax_ofdm->sent_cts_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_ba_rsp_cnt:",\r\nle32_to_cpu(ofdm->sent_ba_rsp_cnt),\r\naccum_ofdm->sent_ba_rsp_cnt,\r\ndelta_ofdm->sent_ba_rsp_cnt,\r\nmax_ofdm->sent_ba_rsp_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "dsp_self_kill:",\r\nle32_to_cpu(ofdm->dsp_self_kill),\r\naccum_ofdm->dsp_self_kill,\r\ndelta_ofdm->dsp_self_kill,\r\nmax_ofdm->dsp_self_kill);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "mh_format_err:",\r\nle32_to_cpu(ofdm->mh_format_err),\r\naccum_ofdm->mh_format_err,\r\ndelta_ofdm->mh_format_err,\r\nmax_ofdm->mh_format_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "re_acq_main_rssi_sum:",\r\nle32_to_cpu(ofdm->re_acq_main_rssi_sum),\r\naccum_ofdm->re_acq_main_rssi_sum,\r\ndelta_ofdm->re_acq_main_rssi_sum,\r\nmax_ofdm->re_acq_main_rssi_sum);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_Rx - CCK:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "ina_cnt:",\r\nle32_to_cpu(cck->ina_cnt), accum_cck->ina_cnt,\r\ndelta_cck->ina_cnt, max_cck->ina_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_cnt:",\r\nle32_to_cpu(cck->fina_cnt), accum_cck->fina_cnt,\r\ndelta_cck->fina_cnt, max_cck->fina_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "plcp_err:",\r\nle32_to_cpu(cck->plcp_err), accum_cck->plcp_err,\r\ndelta_cck->plcp_err, max_cck->plcp_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_err:",\r\nle32_to_cpu(cck->crc32_err), accum_cck->crc32_err,\r\ndelta_cck->crc32_err, max_cck->crc32_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "overrun_err:",\r\nle32_to_cpu(cck->overrun_err),\r\naccum_cck->overrun_err, delta_cck->overrun_err,\r\nmax_cck->overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "early_overrun_err:",\r\nle32_to_cpu(cck->early_overrun_err),\r\naccum_cck->early_overrun_err,\r\ndelta_cck->early_overrun_err,\r\nmax_cck->early_overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_good:",\r\nle32_to_cpu(cck->crc32_good), accum_cck->crc32_good,\r\ndelta_cck->crc32_good, max_cck->crc32_good);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "false_alarm_cnt:",\r\nle32_to_cpu(cck->false_alarm_cnt),\r\naccum_cck->false_alarm_cnt,\r\ndelta_cck->false_alarm_cnt, max_cck->false_alarm_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_sync_err_cnt:",\r\nle32_to_cpu(cck->fina_sync_err_cnt),\r\naccum_cck->fina_sync_err_cnt,\r\ndelta_cck->fina_sync_err_cnt,\r\nmax_cck->fina_sync_err_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sfd_timeout:",\r\nle32_to_cpu(cck->sfd_timeout),\r\naccum_cck->sfd_timeout, delta_cck->sfd_timeout,\r\nmax_cck->sfd_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "fina_timeout:",\r\nle32_to_cpu(cck->fina_timeout),\r\naccum_cck->fina_timeout, delta_cck->fina_timeout,\r\nmax_cck->fina_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "unresponded_rts:",\r\nle32_to_cpu(cck->unresponded_rts),\r\naccum_cck->unresponded_rts, delta_cck->unresponded_rts,\r\nmax_cck->unresponded_rts);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "rxe_frame_lmt_ovrun:",\r\nle32_to_cpu(cck->rxe_frame_limit_overrun),\r\naccum_cck->rxe_frame_limit_overrun,\r\ndelta_cck->rxe_frame_limit_overrun,\r\nmax_cck->rxe_frame_limit_overrun);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_ack_cnt:",\r\nle32_to_cpu(cck->sent_ack_cnt),\r\naccum_cck->sent_ack_cnt, delta_cck->sent_ack_cnt,\r\nmax_cck->sent_ack_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_cts_cnt:",\r\nle32_to_cpu(cck->sent_cts_cnt),\r\naccum_cck->sent_cts_cnt, delta_cck->sent_cts_cnt,\r\nmax_cck->sent_cts_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sent_ba_rsp_cnt:",\r\nle32_to_cpu(cck->sent_ba_rsp_cnt),\r\naccum_cck->sent_ba_rsp_cnt,\r\ndelta_cck->sent_ba_rsp_cnt,\r\nmax_cck->sent_ba_rsp_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "dsp_self_kill:",\r\nle32_to_cpu(cck->dsp_self_kill),\r\naccum_cck->dsp_self_kill, delta_cck->dsp_self_kill,\r\nmax_cck->dsp_self_kill);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "mh_format_err:",\r\nle32_to_cpu(cck->mh_format_err),\r\naccum_cck->mh_format_err, delta_cck->mh_format_err,\r\nmax_cck->mh_format_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "re_acq_main_rssi_sum:",\r\nle32_to_cpu(cck->re_acq_main_rssi_sum),\r\naccum_cck->re_acq_main_rssi_sum,\r\ndelta_cck->re_acq_main_rssi_sum,\r\nmax_cck->re_acq_main_rssi_sum);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_Rx - GENERAL:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "bogus_cts:",\r\nle32_to_cpu(general->bogus_cts),\r\naccum_general->bogus_cts, delta_general->bogus_cts,\r\nmax_general->bogus_cts);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "bogus_ack:",\r\nle32_to_cpu(general->bogus_ack),\r\naccum_general->bogus_ack, delta_general->bogus_ack,\r\nmax_general->bogus_ack);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "non_bssid_frames:",\r\nle32_to_cpu(general->non_bssid_frames),\r\naccum_general->non_bssid_frames,\r\ndelta_general->non_bssid_frames,\r\nmax_general->non_bssid_frames);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "filtered_frames:",\r\nle32_to_cpu(general->filtered_frames),\r\naccum_general->filtered_frames,\r\ndelta_general->filtered_frames,\r\nmax_general->filtered_frames);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "non_channel_beacons:",\r\nle32_to_cpu(general->non_channel_beacons),\r\naccum_general->non_channel_beacons,\r\ndelta_general->non_channel_beacons,\r\nmax_general->non_channel_beacons);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "channel_beacons:",\r\nle32_to_cpu(general->channel_beacons),\r\naccum_general->channel_beacons,\r\ndelta_general->channel_beacons,\r\nmax_general->channel_beacons);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "num_missed_bcon:",\r\nle32_to_cpu(general->num_missed_bcon),\r\naccum_general->num_missed_bcon,\r\ndelta_general->num_missed_bcon,\r\nmax_general->num_missed_bcon);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "adc_rx_saturation_time:",\r\nle32_to_cpu(general->adc_rx_saturation_time),\r\naccum_general->adc_rx_saturation_time,\r\ndelta_general->adc_rx_saturation_time,\r\nmax_general->adc_rx_saturation_time);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "ina_detect_search_tm:",\r\nle32_to_cpu(general->ina_detection_search_time),\r\naccum_general->ina_detection_search_time,\r\ndelta_general->ina_detection_search_time,\r\nmax_general->ina_detection_search_time);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_silence_rssi_a:",\r\nle32_to_cpu(general->beacon_silence_rssi_a),\r\naccum_general->beacon_silence_rssi_a,\r\ndelta_general->beacon_silence_rssi_a,\r\nmax_general->beacon_silence_rssi_a);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_silence_rssi_b:",\r\nle32_to_cpu(general->beacon_silence_rssi_b),\r\naccum_general->beacon_silence_rssi_b,\r\ndelta_general->beacon_silence_rssi_b,\r\nmax_general->beacon_silence_rssi_b);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_silence_rssi_c:",\r\nle32_to_cpu(general->beacon_silence_rssi_c),\r\naccum_general->beacon_silence_rssi_c,\r\ndelta_general->beacon_silence_rssi_c,\r\nmax_general->beacon_silence_rssi_c);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "interference_data_flag:",\r\nle32_to_cpu(general->interference_data_flag),\r\naccum_general->interference_data_flag,\r\ndelta_general->interference_data_flag,\r\nmax_general->interference_data_flag);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "channel_load:",\r\nle32_to_cpu(general->channel_load),\r\naccum_general->channel_load,\r\ndelta_general->channel_load,\r\nmax_general->channel_load);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "dsp_false_alarms:",\r\nle32_to_cpu(general->dsp_false_alarms),\r\naccum_general->dsp_false_alarms,\r\ndelta_general->dsp_false_alarms,\r\nmax_general->dsp_false_alarms);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_rssi_a:",\r\nle32_to_cpu(general->beacon_rssi_a),\r\naccum_general->beacon_rssi_a,\r\ndelta_general->beacon_rssi_a,\r\nmax_general->beacon_rssi_a);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_rssi_b:",\r\nle32_to_cpu(general->beacon_rssi_b),\r\naccum_general->beacon_rssi_b,\r\ndelta_general->beacon_rssi_b,\r\nmax_general->beacon_rssi_b);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_rssi_c:",\r\nle32_to_cpu(general->beacon_rssi_c),\r\naccum_general->beacon_rssi_c,\r\ndelta_general->beacon_rssi_c,\r\nmax_general->beacon_rssi_c);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_energy_a:",\r\nle32_to_cpu(general->beacon_energy_a),\r\naccum_general->beacon_energy_a,\r\ndelta_general->beacon_energy_a,\r\nmax_general->beacon_energy_a);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_energy_b:",\r\nle32_to_cpu(general->beacon_energy_b),\r\naccum_general->beacon_energy_b,\r\ndelta_general->beacon_energy_b,\r\nmax_general->beacon_energy_b);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "beacon_energy_c:",\r\nle32_to_cpu(general->beacon_energy_c),\r\naccum_general->beacon_energy_c,\r\ndelta_general->beacon_energy_c,\r\nmax_general->beacon_energy_c);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_Rx - OFDM_HT:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "plcp_err:",\r\nle32_to_cpu(ht->plcp_err), accum_ht->plcp_err,\r\ndelta_ht->plcp_err, max_ht->plcp_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "overrun_err:",\r\nle32_to_cpu(ht->overrun_err), accum_ht->overrun_err,\r\ndelta_ht->overrun_err, max_ht->overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "early_overrun_err:",\r\nle32_to_cpu(ht->early_overrun_err),\r\naccum_ht->early_overrun_err,\r\ndelta_ht->early_overrun_err,\r\nmax_ht->early_overrun_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_good:",\r\nle32_to_cpu(ht->crc32_good), accum_ht->crc32_good,\r\ndelta_ht->crc32_good, max_ht->crc32_good);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "crc32_err:",\r\nle32_to_cpu(ht->crc32_err), accum_ht->crc32_err,\r\ndelta_ht->crc32_err, max_ht->crc32_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "mh_format_err:",\r\nle32_to_cpu(ht->mh_format_err),\r\naccum_ht->mh_format_err,\r\ndelta_ht->mh_format_err, max_ht->mh_format_err);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg_crc32_good:",\r\nle32_to_cpu(ht->agg_crc32_good),\r\naccum_ht->agg_crc32_good,\r\ndelta_ht->agg_crc32_good, max_ht->agg_crc32_good);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg_mpdu_cnt:",\r\nle32_to_cpu(ht->agg_mpdu_cnt),\r\naccum_ht->agg_mpdu_cnt,\r\ndelta_ht->agg_mpdu_cnt, max_ht->agg_mpdu_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg_cnt:",\r\nle32_to_cpu(ht->agg_cnt), accum_ht->agg_cnt,\r\ndelta_ht->agg_cnt, max_ht->agg_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "unsupport_mcs:",\r\nle32_to_cpu(ht->unsupport_mcs),\r\naccum_ht->unsupport_mcs,\r\ndelta_ht->unsupport_mcs, max_ht->unsupport_mcs);\r\nret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\r\nkfree(buf);\r\nreturn ret;\r\n}\r\nssize_t iwl4965_ucode_tx_stats_read(struct file *file,\r\nchar __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct iwl_priv *priv = file->private_data;\r\nint pos = 0;\r\nchar *buf;\r\nint bufsz = (sizeof(struct statistics_tx) * 48) + 250;\r\nssize_t ret;\r\nstruct statistics_tx *tx, *accum_tx, *delta_tx, *max_tx;\r\nif (!iwl_legacy_is_alive(priv))\r\nreturn -EAGAIN;\r\nbuf = kzalloc(bufsz, GFP_KERNEL);\r\nif (!buf) {\r\nIWL_ERR(priv, "Can not allocate Buffer\n");\r\nreturn -ENOMEM;\r\n}\r\ntx = &priv->_4965.statistics.tx;\r\naccum_tx = &priv->_4965.accum_statistics.tx;\r\ndelta_tx = &priv->_4965.delta_statistics.tx;\r\nmax_tx = &priv->_4965.max_delta.tx;\r\npos += iwl4965_statistics_flag(priv, buf, bufsz);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_Tx:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "preamble:",\r\nle32_to_cpu(tx->preamble_cnt),\r\naccum_tx->preamble_cnt,\r\ndelta_tx->preamble_cnt, max_tx->preamble_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "rx_detected_cnt:",\r\nle32_to_cpu(tx->rx_detected_cnt),\r\naccum_tx->rx_detected_cnt,\r\ndelta_tx->rx_detected_cnt, max_tx->rx_detected_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "bt_prio_defer_cnt:",\r\nle32_to_cpu(tx->bt_prio_defer_cnt),\r\naccum_tx->bt_prio_defer_cnt,\r\ndelta_tx->bt_prio_defer_cnt,\r\nmax_tx->bt_prio_defer_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "bt_prio_kill_cnt:",\r\nle32_to_cpu(tx->bt_prio_kill_cnt),\r\naccum_tx->bt_prio_kill_cnt,\r\ndelta_tx->bt_prio_kill_cnt,\r\nmax_tx->bt_prio_kill_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "few_bytes_cnt:",\r\nle32_to_cpu(tx->few_bytes_cnt),\r\naccum_tx->few_bytes_cnt,\r\ndelta_tx->few_bytes_cnt, max_tx->few_bytes_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "cts_timeout:",\r\nle32_to_cpu(tx->cts_timeout), accum_tx->cts_timeout,\r\ndelta_tx->cts_timeout, max_tx->cts_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "ack_timeout:",\r\nle32_to_cpu(tx->ack_timeout),\r\naccum_tx->ack_timeout,\r\ndelta_tx->ack_timeout, max_tx->ack_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "expected_ack_cnt:",\r\nle32_to_cpu(tx->expected_ack_cnt),\r\naccum_tx->expected_ack_cnt,\r\ndelta_tx->expected_ack_cnt,\r\nmax_tx->expected_ack_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "actual_ack_cnt:",\r\nle32_to_cpu(tx->actual_ack_cnt),\r\naccum_tx->actual_ack_cnt,\r\ndelta_tx->actual_ack_cnt,\r\nmax_tx->actual_ack_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "dump_msdu_cnt:",\r\nle32_to_cpu(tx->dump_msdu_cnt),\r\naccum_tx->dump_msdu_cnt,\r\ndelta_tx->dump_msdu_cnt,\r\nmax_tx->dump_msdu_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "abort_nxt_frame_mismatch:",\r\nle32_to_cpu(tx->burst_abort_next_frame_mismatch_cnt),\r\naccum_tx->burst_abort_next_frame_mismatch_cnt,\r\ndelta_tx->burst_abort_next_frame_mismatch_cnt,\r\nmax_tx->burst_abort_next_frame_mismatch_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "abort_missing_nxt_frame:",\r\nle32_to_cpu(tx->burst_abort_missing_next_frame_cnt),\r\naccum_tx->burst_abort_missing_next_frame_cnt,\r\ndelta_tx->burst_abort_missing_next_frame_cnt,\r\nmax_tx->burst_abort_missing_next_frame_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "cts_timeout_collision:",\r\nle32_to_cpu(tx->cts_timeout_collision),\r\naccum_tx->cts_timeout_collision,\r\ndelta_tx->cts_timeout_collision,\r\nmax_tx->cts_timeout_collision);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "ack_ba_timeout_collision:",\r\nle32_to_cpu(tx->ack_or_ba_timeout_collision),\r\naccum_tx->ack_or_ba_timeout_collision,\r\ndelta_tx->ack_or_ba_timeout_collision,\r\nmax_tx->ack_or_ba_timeout_collision);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg ba_timeout:",\r\nle32_to_cpu(tx->agg.ba_timeout),\r\naccum_tx->agg.ba_timeout,\r\ndelta_tx->agg.ba_timeout,\r\nmax_tx->agg.ba_timeout);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg ba_resched_frames:",\r\nle32_to_cpu(tx->agg.ba_reschedule_frames),\r\naccum_tx->agg.ba_reschedule_frames,\r\ndelta_tx->agg.ba_reschedule_frames,\r\nmax_tx->agg.ba_reschedule_frames);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg scd_query_agg_frame:",\r\nle32_to_cpu(tx->agg.scd_query_agg_frame_cnt),\r\naccum_tx->agg.scd_query_agg_frame_cnt,\r\ndelta_tx->agg.scd_query_agg_frame_cnt,\r\nmax_tx->agg.scd_query_agg_frame_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg scd_query_no_agg:",\r\nle32_to_cpu(tx->agg.scd_query_no_agg),\r\naccum_tx->agg.scd_query_no_agg,\r\ndelta_tx->agg.scd_query_no_agg,\r\nmax_tx->agg.scd_query_no_agg);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg scd_query_agg:",\r\nle32_to_cpu(tx->agg.scd_query_agg),\r\naccum_tx->agg.scd_query_agg,\r\ndelta_tx->agg.scd_query_agg,\r\nmax_tx->agg.scd_query_agg);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg scd_query_mismatch:",\r\nle32_to_cpu(tx->agg.scd_query_mismatch),\r\naccum_tx->agg.scd_query_mismatch,\r\ndelta_tx->agg.scd_query_mismatch,\r\nmax_tx->agg.scd_query_mismatch);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg frame_not_ready:",\r\nle32_to_cpu(tx->agg.frame_not_ready),\r\naccum_tx->agg.frame_not_ready,\r\ndelta_tx->agg.frame_not_ready,\r\nmax_tx->agg.frame_not_ready);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg underrun:",\r\nle32_to_cpu(tx->agg.underrun),\r\naccum_tx->agg.underrun,\r\ndelta_tx->agg.underrun, max_tx->agg.underrun);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg bt_prio_kill:",\r\nle32_to_cpu(tx->agg.bt_prio_kill),\r\naccum_tx->agg.bt_prio_kill,\r\ndelta_tx->agg.bt_prio_kill,\r\nmax_tx->agg.bt_prio_kill);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "agg rx_ba_rsp_cnt:",\r\nle32_to_cpu(tx->agg.rx_ba_rsp_cnt),\r\naccum_tx->agg.rx_ba_rsp_cnt,\r\ndelta_tx->agg.rx_ba_rsp_cnt,\r\nmax_tx->agg.rx_ba_rsp_cnt);\r\nret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\r\nkfree(buf);\r\nreturn ret;\r\n}\r\nssize_t\r\niwl4965_ucode_general_stats_read(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct iwl_priv *priv = file->private_data;\r\nint pos = 0;\r\nchar *buf;\r\nint bufsz = sizeof(struct statistics_general) * 10 + 300;\r\nssize_t ret;\r\nstruct statistics_general_common *general, *accum_general;\r\nstruct statistics_general_common *delta_general, *max_general;\r\nstruct statistics_dbg *dbg, *accum_dbg, *delta_dbg, *max_dbg;\r\nstruct statistics_div *div, *accum_div, *delta_div, *max_div;\r\nif (!iwl_legacy_is_alive(priv))\r\nreturn -EAGAIN;\r\nbuf = kzalloc(bufsz, GFP_KERNEL);\r\nif (!buf) {\r\nIWL_ERR(priv, "Can not allocate Buffer\n");\r\nreturn -ENOMEM;\r\n}\r\ngeneral = &priv->_4965.statistics.general.common;\r\ndbg = &priv->_4965.statistics.general.common.dbg;\r\ndiv = &priv->_4965.statistics.general.common.div;\r\naccum_general = &priv->_4965.accum_statistics.general.common;\r\naccum_dbg = &priv->_4965.accum_statistics.general.common.dbg;\r\naccum_div = &priv->_4965.accum_statistics.general.common.div;\r\ndelta_general = &priv->_4965.delta_statistics.general.common;\r\nmax_general = &priv->_4965.max_delta.general.common;\r\ndelta_dbg = &priv->_4965.delta_statistics.general.common.dbg;\r\nmax_dbg = &priv->_4965.max_delta.general.common.dbg;\r\ndelta_div = &priv->_4965.delta_statistics.general.common.div;\r\nmax_div = &priv->_4965.max_delta.general.common.div;\r\npos += iwl4965_statistics_flag(priv, buf, bufsz);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_header, "Statistics_General:");\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_value, "temperature:",\r\nle32_to_cpu(general->temperature));\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_value, "ttl_timestamp:",\r\nle32_to_cpu(general->ttl_timestamp));\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "burst_check:",\r\nle32_to_cpu(dbg->burst_check),\r\naccum_dbg->burst_check,\r\ndelta_dbg->burst_check, max_dbg->burst_check);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "burst_count:",\r\nle32_to_cpu(dbg->burst_count),\r\naccum_dbg->burst_count,\r\ndelta_dbg->burst_count, max_dbg->burst_count);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "wait_for_silence_timeout_count:",\r\nle32_to_cpu(dbg->wait_for_silence_timeout_cnt),\r\naccum_dbg->wait_for_silence_timeout_cnt,\r\ndelta_dbg->wait_for_silence_timeout_cnt,\r\nmax_dbg->wait_for_silence_timeout_cnt);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "sleep_time:",\r\nle32_to_cpu(general->sleep_time),\r\naccum_general->sleep_time,\r\ndelta_general->sleep_time, max_general->sleep_time);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "slots_out:",\r\nle32_to_cpu(general->slots_out),\r\naccum_general->slots_out,\r\ndelta_general->slots_out, max_general->slots_out);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "slots_idle:",\r\nle32_to_cpu(general->slots_idle),\r\naccum_general->slots_idle,\r\ndelta_general->slots_idle, max_general->slots_idle);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "tx_on_a:",\r\nle32_to_cpu(div->tx_on_a), accum_div->tx_on_a,\r\ndelta_div->tx_on_a, max_div->tx_on_a);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "tx_on_b:",\r\nle32_to_cpu(div->tx_on_b), accum_div->tx_on_b,\r\ndelta_div->tx_on_b, max_div->tx_on_b);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "exec_time:",\r\nle32_to_cpu(div->exec_time), accum_div->exec_time,\r\ndelta_div->exec_time, max_div->exec_time);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "probe_time:",\r\nle32_to_cpu(div->probe_time), accum_div->probe_time,\r\ndelta_div->probe_time, max_div->probe_time);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "rx_enable_counter:",\r\nle32_to_cpu(general->rx_enable_counter),\r\naccum_general->rx_enable_counter,\r\ndelta_general->rx_enable_counter,\r\nmax_general->rx_enable_counter);\r\npos += scnprintf(buf + pos, bufsz - pos,\r\nfmt_table, "num_of_sos_states:",\r\nle32_to_cpu(general->num_of_sos_states),\r\naccum_general->num_of_sos_states,\r\ndelta_general->num_of_sos_states,\r\nmax_general->num_of_sos_states);\r\nret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\r\nkfree(buf);\r\nreturn ret;\r\n}
