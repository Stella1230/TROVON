void __init ath79_register_gpio_keys_polled(int id,\r\nunsigned poll_interval,\r\nunsigned nbuttons,\r\nstruct gpio_keys_button *buttons)\r\n{\r\nstruct platform_device *pdev;\r\nstruct gpio_keys_platform_data pdata;\r\nstruct gpio_keys_button *p;\r\nint err;\r\np = kmalloc(nbuttons * sizeof(*p), GFP_KERNEL);\r\nif (!p)\r\nreturn;\r\nmemcpy(p, buttons, nbuttons * sizeof(*p));\r\npdev = platform_device_alloc("gpio-keys-polled", id);\r\nif (!pdev)\r\ngoto err_free_buttons;\r\nmemset(&pdata, 0, sizeof(pdata));\r\npdata.poll_interval = poll_interval;\r\npdata.nbuttons = nbuttons;\r\npdata.buttons = p;\r\nerr = platform_device_add_data(pdev, &pdata, sizeof(pdata));\r\nif (err)\r\ngoto err_put_pdev;\r\nerr = platform_device_add(pdev);\r\nif (err)\r\ngoto err_put_pdev;\r\nreturn;\r\nerr_put_pdev:\r\nplatform_device_put(pdev);\r\nerr_free_buttons:\r\nkfree(p);\r\n}
