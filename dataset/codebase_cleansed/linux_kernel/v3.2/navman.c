static void navman_read_int_callback(struct urb *urb)\r\n{\r\nstruct usb_serial_port *port = urb->context;\r\nunsigned char *data = urb->transfer_buffer;\r\nstruct tty_struct *tty;\r\nint status = urb->status;\r\nint result;\r\nswitch (status) {\r\ncase 0:\r\nbreak;\r\ncase -ECONNRESET:\r\ncase -ENOENT:\r\ncase -ESHUTDOWN:\r\ndbg("%s - urb shutting down with status: %d",\r\n__func__, status);\r\nreturn;\r\ndefault:\r\ndbg("%s - nonzero urb status received: %d",\r\n__func__, status);\r\ngoto exit;\r\n}\r\nusb_serial_debug_data(debug, &port->dev, __func__,\r\nurb->actual_length, data);\r\ntty = tty_port_tty_get(&port->port);\r\nif (tty && urb->actual_length) {\r\ntty_insert_flip_string(tty, data, urb->actual_length);\r\ntty_flip_buffer_push(tty);\r\n}\r\ntty_kref_put(tty);\r\nexit:\r\nresult = usb_submit_urb(urb, GFP_ATOMIC);\r\nif (result)\r\ndev_err(&urb->dev->dev,\r\n"%s - Error %d submitting interrupt urb\n",\r\n__func__, result);\r\n}\r\nstatic int navman_open(struct tty_struct *tty, struct usb_serial_port *port)\r\n{\r\nint result = 0;\r\ndbg("%s - port %d", __func__, port->number);\r\nif (port->interrupt_in_urb) {\r\ndbg("%s - adding interrupt input for treo", __func__);\r\nresult = usb_submit_urb(port->interrupt_in_urb, GFP_KERNEL);\r\nif (result)\r\ndev_err(&port->dev,\r\n"%s - failed submitting interrupt urb, error %d\n",\r\n__func__, result);\r\n}\r\nreturn result;\r\n}\r\nstatic void navman_close(struct usb_serial_port *port)\r\n{\r\ndbg("%s - port %d", __func__, port->number);\r\nusb_kill_urb(port->interrupt_in_urb);\r\n}\r\nstatic int navman_write(struct tty_struct *tty, struct usb_serial_port *port,\r\nconst unsigned char *buf, int count)\r\n{\r\ndbg("%s - port %d", __func__, port->number);\r\nreturn -EOPNOTSUPP;\r\n}\r\nstatic int __init navman_init(void)\r\n{\r\nint retval;\r\nretval = usb_serial_register(&navman_device);\r\nif (retval)\r\nreturn retval;\r\nretval = usb_register(&navman_driver);\r\nif (retval)\r\nusb_serial_deregister(&navman_device);\r\nreturn retval;\r\n}\r\nstatic void __exit navman_exit(void)\r\n{\r\nusb_deregister(&navman_driver);\r\nusb_serial_deregister(&navman_device);\r\n}
