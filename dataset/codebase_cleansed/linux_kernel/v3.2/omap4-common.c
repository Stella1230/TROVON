void __init gic_init_irq(void)\r\n{\r\ngic_dist_base_addr = ioremap(OMAP44XX_GIC_DIST_BASE, SZ_4K);\r\nBUG_ON(!gic_dist_base_addr);\r\nomap_irq_base = ioremap(OMAP44XX_GIC_CPU_BASE, SZ_512);\r\nBUG_ON(!omap_irq_base);\r\ngic_init(0, 29, gic_dist_base_addr, omap_irq_base);\r\n}\r\nstatic void omap4_l2x0_disable(void)\r\n{\r\nomap_smc1(0x102, 0x0);\r\n}\r\nstatic void omap4_l2x0_set_debug(unsigned long val)\r\n{\r\nomap_smc1(0x100, val);\r\n}\r\nstatic int __init omap_l2_cache_init(void)\r\n{\r\nu32 aux_ctrl = 0;\r\nif (!cpu_is_omap44xx())\r\nreturn -ENODEV;\r\nl2cache_base = ioremap(OMAP44XX_L2CACHE_BASE, SZ_4K);\r\nBUG_ON(!l2cache_base);\r\naux_ctrl = ((1 << L2X0_AUX_CTRL_ASSOCIATIVITY_SHIFT) |\r\n(0x1 << 25) |\r\n(0x1 << L2X0_AUX_CTRL_NS_LOCKDOWN_SHIFT) |\r\n(0x1 << L2X0_AUX_CTRL_NS_INT_CTRL_SHIFT));\r\nif (omap_rev() == OMAP4430_REV_ES1_0) {\r\naux_ctrl |= 0x2 << L2X0_AUX_CTRL_WAY_SIZE_SHIFT;\r\n} else {\r\naux_ctrl |= ((0x3 << L2X0_AUX_CTRL_WAY_SIZE_SHIFT) |\r\n(1 << L2X0_AUX_CTRL_SHARE_OVERRIDE_SHIFT) |\r\n(1 << L2X0_AUX_CTRL_DATA_PREFETCH_SHIFT) |\r\n(1 << L2X0_AUX_CTRL_INSTR_PREFETCH_SHIFT) |\r\n(1 << L2X0_AUX_CTRL_EARLY_BRESP_SHIFT));\r\n}\r\nif (omap_rev() != OMAP4430_REV_ES1_0)\r\nomap_smc1(0x109, aux_ctrl);\r\nomap_smc1(0x102, 0x1);\r\nl2x0_init(l2cache_base, aux_ctrl, L2X0_AUX_CTRL_MASK);\r\nouter_cache.disable = omap4_l2x0_disable;\r\nouter_cache.set_debug = omap4_l2x0_set_debug;\r\nreturn 0;\r\n}
