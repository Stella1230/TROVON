void __init plat_mem_setup(void)\r\n{\r\nchar *ctype;\r\nchar *cserial;\r\nboard_be_init = ip22_be_init;\r\nsgihpc_init();\r\nsgimc_init();\r\n#ifdef CONFIG_BOARD_SCACHE\r\nindy_sc_init();\r\n#endif\r\nset_io_port_base((unsigned long)ioremap(0x00080000,\r\n0x1fffffff - 0x00080000));\r\nctype = ArcGetEnvironmentVariable("console");\r\ncserial = ArcGetEnvironmentVariable("ConsoleOut");\r\nif ((ctype && *ctype == 'd') || (cserial && *cserial == 's')) {\r\nstatic char options[8] __initdata;\r\nchar *baud = ArcGetEnvironmentVariable("dbaud");\r\nif (baud)\r\nstrcpy(options, baud);\r\nadd_preferred_console("ttyS", *(ctype + 1) == '2' ? 1 : 0,\r\nbaud ? options : NULL);\r\n} else if (!ctype || *ctype != 'g') {\r\nprom_flags |= PROM_FLAG_USE_AS_CONSOLE;\r\nadd_preferred_console("arc", 0, NULL);\r\n}\r\n#if defined(CONFIG_VT) && defined(CONFIG_SGI_NEWPORT_CONSOLE)\r\n{\r\nULONG *gfxinfo;\r\nULONG * (*__vec)(void) = (void *) (long)\r\n*((_PULONG *)(long)((PROMBLOCK)->pvector + 0x20));\r\ngfxinfo = __vec();\r\nsgi_gfxaddr = ((gfxinfo[1] >= 0xa0000000\r\n&& gfxinfo[1] <= 0xc0000000)\r\n? gfxinfo[1] - 0xa0000000 : 0);\r\nif (sgi_gfxaddr == 0x1f0f0000 || sgi_gfxaddr == 0x1f4f0000) {\r\nconswitchp = &newport_con;\r\n}\r\n}\r\n#endif\r\n}
