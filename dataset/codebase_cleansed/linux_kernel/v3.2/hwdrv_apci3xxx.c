static int i_APCI3XXX_TestConversionStarted(struct comedi_device *dev)\r\n{\r\nif ((readl(devpriv->dw_AiBase + 8) & 0x80000UL) == 0x80000UL)\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nstatic int i_APCI3XXX_AnalogInputConfigOperatingMode(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_TimeBase = 0;\r\nunsigned char b_SingleDiff = 0;\r\nunsigned int dw_ReloadValue = 0;\r\nunsigned int dw_TestReloadValue = 0;\r\nif (insn->n == 4) {\r\nb_SingleDiff = (unsigned char) data[1];\r\nb_TimeBase = (unsigned char) data[2];\r\ndw_ReloadValue = (unsigned int) data[3];\r\nif ((this_board->b_AvailableConvertUnit & (1 << b_TimeBase)) !=\r\n0) {\r\nif (dw_ReloadValue <= 65535) {\r\ndw_TestReloadValue = dw_ReloadValue;\r\nif (b_TimeBase == 1) {\r\ndw_TestReloadValue =\r\ndw_TestReloadValue * 1000UL;\r\n}\r\nif (b_TimeBase == 2) {\r\ndw_TestReloadValue =\r\ndw_TestReloadValue * 1000000UL;\r\n}\r\nif (dw_TestReloadValue >=\r\ndevpriv->s_EeParameters.\r\nui_MinAcquisitiontimeNs) {\r\nif ((b_SingleDiff == APCI3XXX_SINGLE)\r\n|| (b_SingleDiff ==\r\nAPCI3XXX_DIFF)) {\r\nif (((b_SingleDiff == APCI3XXX_SINGLE)\r\n&& (devpriv->s_EeParameters.i_NbrAiChannel == 0))\r\n|| ((b_SingleDiff == APCI3XXX_DIFF)\r\n&& (this_board->i_NbrAiChannelDiff == 0))\r\n) {\r\nprintk("Single/Diff selection error\n");\r\ni_ReturnValue = -1;\r\n} else {\r\nif (i_APCI3XXX_TestConversionStarted(dev) == 0) {\r\ndevpriv->\r\nui_EocEosConversionTime\r\n=\r\n(unsigned int)\r\ndw_ReloadValue;\r\ndevpriv->\r\nb_EocEosConversionTimeBase\r\n=\r\nb_TimeBase;\r\ndevpriv->\r\nb_SingelDiff\r\n=\r\nb_SingleDiff;\r\ndevpriv->\r\nb_AiInitialisation\r\n= 1;\r\nwritel((unsigned int)b_TimeBase,\r\ndevpriv->dw_AiBase + 36);\r\nwritel(dw_ReloadValue, devpriv->dw_AiBase + 32);\r\n} else {\r\nprintk("Any conversion started\n");\r\ni_ReturnValue =\r\n-10;\r\n}\r\n}\r\n} else {\r\nprintk("Single/Diff selection error\n");\r\ni_ReturnValue = -1;\r\n}\r\n} else {\r\nprintk("Convert time value selection error\n");\r\ni_ReturnValue = -3;\r\n}\r\n} else {\r\nprintk("Convert time value selection error\n");\r\ni_ReturnValue = -3;\r\n}\r\n} else {\r\nprintk("Convert time base unity selection error\n");\r\ni_ReturnValue = -2;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnConfigAnalogInput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nif (insn->n >= 1) {\r\nswitch ((unsigned char) data[0]) {\r\ncase APCI3XXX_CONFIGURATION:\r\ni_ReturnValue =\r\ni_APCI3XXX_AnalogInputConfigOperatingMode(dev,\r\ns, insn, data);\r\nbreak;\r\ndefault:\r\ni_ReturnValue = -100;\r\nprintk("Config command error %d\n", data[0]);\r\nbreak;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnReadAnalogInput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Configuration = (unsigned char) CR_RANGE(insn->chanspec);\r\nunsigned char b_Channel = (unsigned char) CR_CHAN(insn->chanspec);\r\nunsigned int dw_Temp = 0;\r\nunsigned int dw_Configuration = 0;\r\nunsigned int dw_AcquisitionCpt = 0;\r\nunsigned char b_Interrupt = 0;\r\nif (devpriv->b_AiInitialisation) {\r\nif (((b_Channel < devpriv->s_EeParameters.i_NbrAiChannel)\r\n&& (devpriv->b_SingelDiff == APCI3XXX_SINGLE))\r\n|| ((b_Channel < this_board->i_NbrAiChannelDiff)\r\n&& (devpriv->b_SingelDiff == APCI3XXX_DIFF))) {\r\nif (b_Configuration > 7) {\r\ni_ReturnValue = -4;\r\nprintk("Channel %d range %d selection error\n",\r\nb_Channel, b_Configuration);\r\n}\r\n} else {\r\ni_ReturnValue = -3;\r\nprintk("Channel %d selection error\n", b_Channel);\r\n}\r\nif (i_ReturnValue >= 0) {\r\nif ((b_Interrupt != 0) || ((b_Interrupt == 0)\r\n&& (insn->n >= 1))) {\r\nif (i_APCI3XXX_TestConversionStarted(dev) == 0) {\r\nwritel(0x10000UL, devpriv->dw_AiBase + 12);\r\ndw_Temp = readl(devpriv->dw_AiBase + 4);\r\ndw_Temp = dw_Temp & 0xFFFFFEF0UL;\r\nwritel(dw_Temp, devpriv->dw_AiBase + 4);\r\ndw_Configuration =\r\n(b_Configuration & 3) |\r\n((unsigned int) (b_Configuration >> 2)\r\n<< 6) | ((unsigned int) devpriv->\r\nb_SingelDiff << 7);\r\nwritel(dw_Configuration,\r\ndevpriv->dw_AiBase + 0);\r\nwritel(dw_Temp | 0x100UL,\r\ndevpriv->dw_AiBase + 4);\r\nwritel((unsigned int) b_Channel,\r\ndevpriv->dw_AiBase + 0);\r\nwritel(dw_Temp, devpriv->dw_AiBase + 4);\r\nwritel(1, devpriv->dw_AiBase + 48);\r\ndevpriv->b_EocEosInterrupt =\r\nb_Interrupt;\r\ndevpriv->ui_AiNbrofChannels = 1;\r\nif (b_Interrupt == 0) {\r\nfor (dw_AcquisitionCpt = 0;\r\ndw_AcquisitionCpt <\r\ninsn->n;\r\ndw_AcquisitionCpt++) {\r\nwritel(0x80000UL, devpriv->dw_AiBase + 8);\r\ndo {\r\ndw_Temp = readl(devpriv->dw_AiBase + 20);\r\ndw_Temp = dw_Temp & 1;\r\n} while (dw_Temp != 1);\r\ndata[dw_AcquisitionCpt] = (unsigned int)readl(devpriv->dw_AiBase + 28);\r\n}\r\n} else {\r\nwritel(0x180000UL, devpriv->dw_AiBase + 8);\r\n}\r\n} else {\r\nprintk("Any conversion started\n");\r\ni_ReturnValue = -10;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\n}\r\n} else {\r\nprintk("Operating mode not configured\n");\r\ni_ReturnValue = -1;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic void v_APCI3XXX_Interrupt(int irq, void *d)\r\n{\r\nstruct comedi_device *dev = d;\r\nunsigned char b_CopyCpt = 0;\r\nunsigned int dw_Status = 0;\r\ndw_Status = readl(devpriv->dw_AiBase + 16);\r\nif ( (dw_Status & 0x2UL) == 0x2UL) {\r\nwritel(dw_Status, devpriv->dw_AiBase + 16);\r\nif (devpriv->b_EocEosInterrupt == 1) {\r\nfor (b_CopyCpt = 0;\r\nb_CopyCpt < devpriv->ui_AiNbrofChannels;\r\nb_CopyCpt++) {\r\ndevpriv->ui_AiReadData[b_CopyCpt] =\r\n(unsigned int)readl(devpriv->dw_AiBase + 28);\r\n}\r\ndevpriv->b_EocEosInterrupt = 2;\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\n}\r\n}\r\n}\r\nstatic int i_APCI3XXX_InsnWriteAnalogOutput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nunsigned char b_Range = (unsigned char) CR_RANGE(insn->chanspec);\r\nunsigned char b_Channel = (unsigned char) CR_CHAN(insn->chanspec);\r\nunsigned int dw_Status = 0;\r\nint i_ReturnValue = insn->n;\r\nif (insn->n >= 1) {\r\nif (b_Channel < devpriv->s_EeParameters.i_NbrAoChannel) {\r\nif (b_Range < 2) {\r\nwritel(b_Range, devpriv->dw_AiBase + 96);\r\nwritel((data[0] << 8) | b_Channel,\r\ndevpriv->dw_AiBase + 100);\r\ndo {\r\ndw_Status = readl(devpriv->dw_AiBase + 96);\r\n} while ((dw_Status & 0x100) != 0x100);\r\n} else {\r\ni_ReturnValue = -4;\r\nprintk("Channel %d range %d selection error\n",\r\nb_Channel, b_Range);\r\n}\r\n} else {\r\ni_ReturnValue = -3;\r\nprintk("Channel %d selection error\n", b_Channel);\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnConfigInitTTLIO(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Command = 0;\r\nif (insn->n >= 1) {\r\nb_Command = (unsigned char) data[0];\r\nif (b_Command == APCI3XXX_TTL_INIT_DIRECTION_PORT2) {\r\nif ((b_Command == APCI3XXX_TTL_INIT_DIRECTION_PORT2)\r\n&& (insn->n != 2)) {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\n} else {\r\nprintk("Command selection error\n");\r\ni_ReturnValue = -100;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nif ((i_ReturnValue >= 0)\r\n&& (b_Command == APCI3XXX_TTL_INIT_DIRECTION_PORT2)) {\r\nif ((data[1] == 0) || (data[1] == 0xFF)) {\r\ndevpriv->ul_TTLPortConfiguration[0] =\r\ndevpriv->ul_TTLPortConfiguration[0] | data[1];\r\n} else {\r\nprintk("Port 2 direction selection error\n");\r\ni_ReturnValue = -1;\r\n}\r\n}\r\nif (i_ReturnValue >= 0) {\r\nif (b_Command == APCI3XXX_TTL_INIT_DIRECTION_PORT2) {\r\noutl(data[1], devpriv->iobase + 224);\r\n}\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnBitsTTLIO(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_ChannelCpt = 0;\r\nunsigned int dw_ChannelMask = 0;\r\nunsigned int dw_BitMask = 0;\r\nunsigned int dw_Status = 0;\r\nif (insn->n >= 2) {\r\ndw_ChannelMask = data[0];\r\ndw_BitMask = data[1];\r\nif (((dw_ChannelMask & 0XFF00FF00) == 0) &&\r\n(((devpriv->ul_TTLPortConfiguration[0] & 0xFF) == 0xFF)\r\n|| (((devpriv->ul_TTLPortConfiguration[0] &\r\n0xFF) == 0)\r\n&& ((dw_ChannelMask & 0XFF0000) ==\r\n0)))) {\r\nif (dw_ChannelMask) {\r\nif (dw_ChannelMask & 0xFF) {\r\ndw_Status = inl(devpriv->iobase + 80);\r\nfor (b_ChannelCpt = 0; b_ChannelCpt < 8;\r\nb_ChannelCpt++) {\r\nif ((dw_ChannelMask >>\r\nb_ChannelCpt) &\r\n1) {\r\ndw_Status =\r\n(dw_Status &\r\n(0xFF - (1 << b_ChannelCpt))) | (dw_BitMask & (1 << b_ChannelCpt));\r\n}\r\n}\r\noutl(dw_Status, devpriv->iobase + 80);\r\n}\r\nif (dw_ChannelMask & 0xFF0000) {\r\ndw_BitMask = dw_BitMask >> 16;\r\ndw_ChannelMask = dw_ChannelMask >> 16;\r\ndw_Status = inl(devpriv->iobase + 112);\r\nfor (b_ChannelCpt = 0; b_ChannelCpt < 8;\r\nb_ChannelCpt++) {\r\nif ((dw_ChannelMask >>\r\nb_ChannelCpt) &\r\n1) {\r\ndw_Status =\r\n(dw_Status &\r\n(0xFF - (1 << b_ChannelCpt))) | (dw_BitMask & (1 << b_ChannelCpt));\r\n}\r\n}\r\noutl(dw_Status, devpriv->iobase + 112);\r\n}\r\n}\r\ndata[1] = inl(devpriv->iobase + 80);\r\ndata[1] = data[1] | (inl(devpriv->iobase + 64) << 8);\r\nif ((devpriv->ul_TTLPortConfiguration[0] & 0xFF) == 0) {\r\ndata[1] =\r\ndata[1] | (inl(devpriv->iobase +\r\n96) << 16);\r\n} else {\r\ndata[1] =\r\ndata[1] | (inl(devpriv->iobase +\r\n112) << 16);\r\n}\r\n} else {\r\nprintk("Channel mask error\n");\r\ni_ReturnValue = -4;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnReadTTLIO(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nunsigned char b_Channel = (unsigned char) CR_CHAN(insn->chanspec);\r\nint i_ReturnValue = insn->n;\r\nunsigned int *pls_ReadData = data;\r\nif (insn->n >= 1) {\r\nif (b_Channel < 8) {\r\npls_ReadData[0] = inl(devpriv->iobase + 80);\r\npls_ReadData[0] = (pls_ReadData[0] >> b_Channel) & 1;\r\n} else {\r\nif ((b_Channel > 7) && (b_Channel < 16)) {\r\npls_ReadData[0] = inl(devpriv->iobase + 64);\r\npls_ReadData[0] =\r\n(pls_ReadData[0] >> (b_Channel -\r\n8)) & 1;\r\n} else {\r\nif ((b_Channel > 15) && (b_Channel < 24)) {\r\nif ((devpriv->ul_TTLPortConfiguration[0]\r\n& 0xFF) == 0) {\r\npls_ReadData[0] =\r\ninl(devpriv->iobase +\r\n96);\r\npls_ReadData[0] =\r\n(pls_ReadData[0] >>\r\n(b_Channel - 16)) & 1;\r\n} else {\r\npls_ReadData[0] =\r\ninl(devpriv->iobase +\r\n112);\r\npls_ReadData[0] =\r\n(pls_ReadData[0] >>\r\n(b_Channel - 16)) & 1;\r\n}\r\n} else {\r\ni_ReturnValue = -3;\r\nprintk("Channel %d selection error\n",\r\nb_Channel);\r\n}\r\n}\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnWriteTTLIO(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Channel = (unsigned char) CR_CHAN(insn->chanspec);\r\nunsigned char b_State = 0;\r\nunsigned int dw_Status = 0;\r\nif (insn->n >= 1) {\r\nb_State = (unsigned char) data[0];\r\nif (b_Channel < 8) {\r\ndw_Status = inl(devpriv->iobase + 80);\r\ndw_Status =\r\n(dw_Status & (0xFF -\r\n(1 << b_Channel))) | ((b_State & 1) <<\r\nb_Channel);\r\noutl(dw_Status, devpriv->iobase + 80);\r\n} else {\r\nif ((b_Channel > 15) && (b_Channel < 24)) {\r\nif ((devpriv->ul_TTLPortConfiguration[0] & 0xFF)\r\n== 0xFF) {\r\ndw_Status = inl(devpriv->iobase + 112);\r\ndw_Status =\r\n(dw_Status & (0xFF -\r\n(1 << (b_Channel -\r\n16)))) |\r\n((b_State & 1) << (b_Channel -\r\n16));\r\noutl(dw_Status, devpriv->iobase + 112);\r\n} else {\r\ni_ReturnValue = -3;\r\nprintk("Channel %d selection error\n",\r\nb_Channel);\r\n}\r\n} else {\r\ni_ReturnValue = -3;\r\nprintk("Channel %d selection error\n",\r\nb_Channel);\r\n}\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnReadDigitalInput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Channel = (unsigned char) CR_CHAN(insn->chanspec);\r\nunsigned int dw_Temp = 0;\r\nif (b_Channel <= devpriv->s_EeParameters.i_NbrDiChannel) {\r\nif (insn->n >= 1) {\r\ndw_Temp = inl(devpriv->iobase + 32);\r\n*data = (dw_Temp >> b_Channel) & 1;\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\n} else {\r\nprintk("Channel selection error\n");\r\ni_ReturnValue = -3;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnBitsDigitalInput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned int dw_Temp = 0;\r\nif (insn->n >= 1) {\r\ndw_Temp = inl(devpriv->iobase + 32);\r\n*data = dw_Temp & 0xf;\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnBitsDigitalOutput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_ChannelCpt = 0;\r\nunsigned int dw_ChannelMask = 0;\r\nunsigned int dw_BitMask = 0;\r\nunsigned int dw_Status = 0;\r\nif (insn->n >= 2) {\r\ndw_ChannelMask = data[0];\r\ndw_BitMask = data[1];\r\nif ((dw_ChannelMask & 0XFFFFFFF0) == 0) {\r\nif (dw_ChannelMask & 0xF) {\r\ndw_Status = inl(devpriv->iobase + 48);\r\nfor (b_ChannelCpt = 0; b_ChannelCpt < 4;\r\nb_ChannelCpt++) {\r\nif ((dw_ChannelMask >> b_ChannelCpt) &\r\n1) {\r\ndw_Status =\r\n(dw_Status & (0xF -\r\n(1 << b_ChannelCpt))) | (dw_BitMask & (1 << b_ChannelCpt));\r\n}\r\n}\r\noutl(dw_Status, devpriv->iobase + 48);\r\n}\r\ndata[1] = inl(devpriv->iobase + 48);\r\n} else {\r\nprintk("Channel mask error\n");\r\ni_ReturnValue = -4;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnWriteDigitalOutput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Channel = CR_CHAN(insn->chanspec);\r\nunsigned char b_State = 0;\r\nunsigned int dw_Status = 0;\r\nif (insn->n >= 1) {\r\nif (b_Channel < devpriv->s_EeParameters.i_NbrDoChannel) {\r\nb_State = (unsigned char) data[0];\r\ndw_Status = inl(devpriv->iobase + 48);\r\ndw_Status =\r\n(dw_Status & (0xF -\r\n(1 << b_Channel))) | ((b_State & 1) <<\r\nb_Channel);\r\noutl(dw_Status, devpriv->iobase + 48);\r\n} else {\r\nprintk("Channel selection error\n");\r\ni_ReturnValue = -3;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_InsnReadDigitalOutput(struct comedi_device *dev,\r\nstruct comedi_subdevice *s,\r\nstruct comedi_insn *insn,\r\nunsigned int *data)\r\n{\r\nint i_ReturnValue = insn->n;\r\nunsigned char b_Channel = CR_CHAN(insn->chanspec);\r\nunsigned int dw_Status = 0;\r\nif (insn->n >= 1) {\r\nif (b_Channel < devpriv->s_EeParameters.i_NbrDoChannel) {\r\ndw_Status = inl(devpriv->iobase + 48);\r\ndw_Status = (dw_Status >> b_Channel) & 1;\r\n*data = dw_Status;\r\n} else {\r\nprintk("Channel selection error\n");\r\ni_ReturnValue = -3;\r\n}\r\n} else {\r\nprintk("Buffer size error\n");\r\ni_ReturnValue = -101;\r\n}\r\nreturn i_ReturnValue;\r\n}\r\nstatic int i_APCI3XXX_Reset(struct comedi_device *dev)\r\n{\r\nunsigned char b_Cpt = 0;\r\ndisable_irq(dev->irq);\r\ndevpriv->b_EocEosInterrupt = 0;\r\nwritel(0, devpriv->dw_AiBase + 8);\r\nwritel(readl(devpriv->dw_AiBase + 16), devpriv->dw_AiBase + 16);\r\nreadl(devpriv->dw_AiBase + 20);\r\nfor (b_Cpt = 0; b_Cpt < 16; b_Cpt++) {\r\nreadl(devpriv->dw_AiBase + 28);\r\n}\r\nenable_irq(dev->irq);\r\nreturn 0;\r\n}
