static int mfld_set_brightness(struct backlight_device *bd)\r\n{\r\nstruct drm_device *dev = bl_get_data(mdfld_backlight_device);\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nint level = bd->props.brightness;\r\nif (level < 1)\r\nlevel = 1;\r\nif (gma_power_begin(dev, 0)) {\r\nu32 adjusted_level;\r\nadjusted_level = level * dev_priv->blc_adj2;\r\nadjusted_level = adjusted_level / 100;\r\n#if 0\r\n#ifndef CONFIG_MDFLD_DSI_DPU\r\nif(!(dev_priv->dsr_fb_update & MDFLD_DSR_MIPI_CONTROL) &&\r\n(dev_priv->dbi_panel_on || dev_priv->dbi_panel_on2)){\r\nmdfld_dsi_dbi_exit_dsr(dev,MDFLD_DSR_MIPI_CONTROL, 0, 0);\r\ndev_dbg(dev->dev, "Out of DSR before set brightness to %d.\n",adjusted_level);\r\n}\r\n#endif\r\nmdfld_dsi_brightness_control(dev, 0, adjusted_level);\r\nif ((dev_priv->dbi_panel_on2) || (dev_priv->dpi_panel_on2))\r\nmdfld_dsi_brightness_control(dev, 2, adjusted_level);\r\n#endif\r\ngma_power_end(dev);\r\n}\r\nmdfld_brightness = level;\r\nreturn 0;\r\n}\r\nint psb_get_brightness(struct backlight_device *bd)\r\n{\r\nreturn mdfld_brightness;\r\n}\r\nstatic int mdfld_backlight_init(struct drm_device *dev)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nstruct backlight_properties props;\r\nmemset(&props, 0, sizeof(struct backlight_properties));\r\nprops.max_brightness = 100;\r\nprops.type = BACKLIGHT_PLATFORM;\r\nmdfld_backlight_device = backlight_device_register("mfld-bl",\r\nNULL, (void *)dev, &mfld_ops, &props);\r\nif (IS_ERR(mdfld_backlight_device))\r\nreturn PTR_ERR(mdfld_backlight_device);\r\ndev_priv->blc_adj1 = 100;\r\ndev_priv->blc_adj2 = 100;\r\nmdfld_backlight_device->props.brightness = 100;\r\nmdfld_backlight_device->props.max_brightness = 100;\r\nbacklight_update_status(mdfld_backlight_device);\r\ndev_priv->backlight_device = mdfld_backlight_device;\r\nreturn 0;\r\n}\r\nstatic void mdfld_init_pm(struct drm_device *dev)\r\n{\r\n}\r\nstatic int mdfld_save_display_registers(struct drm_device *dev, int pipe)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nint i;\r\nu32 dpll_reg = MRST_DPLL_A;\r\nu32 fp_reg = MRST_FPA0;\r\nu32 pipeconf_reg = PIPEACONF;\r\nu32 htot_reg = HTOTAL_A;\r\nu32 hblank_reg = HBLANK_A;\r\nu32 hsync_reg = HSYNC_A;\r\nu32 vtot_reg = VTOTAL_A;\r\nu32 vblank_reg = VBLANK_A;\r\nu32 vsync_reg = VSYNC_A;\r\nu32 pipesrc_reg = PIPEASRC;\r\nu32 dspstride_reg = DSPASTRIDE;\r\nu32 dsplinoff_reg = DSPALINOFF;\r\nu32 dsptileoff_reg = DSPATILEOFF;\r\nu32 dspsize_reg = DSPASIZE;\r\nu32 dsppos_reg = DSPAPOS;\r\nu32 dspsurf_reg = DSPASURF;\r\nu32 mipi_reg = MIPI;\r\nu32 dspcntr_reg = DSPACNTR;\r\nu32 dspstatus_reg = PIPEASTAT;\r\nu32 palette_reg = PALETTE_A;\r\nu32 *dpll_val = &dev_priv->saveDPLL_A;\r\nu32 *fp_val = &dev_priv->saveFPA0;\r\nu32 *pipeconf_val = &dev_priv->savePIPEACONF;\r\nu32 *htot_val = &dev_priv->saveHTOTAL_A;\r\nu32 *hblank_val = &dev_priv->saveHBLANK_A;\r\nu32 *hsync_val = &dev_priv->saveHSYNC_A;\r\nu32 *vtot_val = &dev_priv->saveVTOTAL_A;\r\nu32 *vblank_val = &dev_priv->saveVBLANK_A;\r\nu32 *vsync_val = &dev_priv->saveVSYNC_A;\r\nu32 *pipesrc_val = &dev_priv->savePIPEASRC;\r\nu32 *dspstride_val = &dev_priv->saveDSPASTRIDE;\r\nu32 *dsplinoff_val = &dev_priv->saveDSPALINOFF;\r\nu32 *dsptileoff_val = &dev_priv->saveDSPATILEOFF;\r\nu32 *dspsize_val = &dev_priv->saveDSPASIZE;\r\nu32 *dsppos_val = &dev_priv->saveDSPAPOS;\r\nu32 *dspsurf_val = &dev_priv->saveDSPASURF;\r\nu32 *mipi_val = &dev_priv->saveMIPI;\r\nu32 *dspcntr_val = &dev_priv->saveDSPACNTR;\r\nu32 *dspstatus_val = &dev_priv->saveDSPASTATUS;\r\nu32 *palette_val = dev_priv->save_palette_a;\r\nswitch (pipe) {\r\ncase 0:\r\nbreak;\r\ncase 1:\r\ndpll_reg = MDFLD_DPLL_B;\r\nfp_reg = MDFLD_DPLL_DIV0;\r\npipeconf_reg = PIPEBCONF;\r\nhtot_reg = HTOTAL_B;\r\nhblank_reg = HBLANK_B;\r\nhsync_reg = HSYNC_B;\r\nvtot_reg = VTOTAL_B;\r\nvblank_reg = VBLANK_B;\r\nvsync_reg = VSYNC_B;\r\npipesrc_reg = PIPEBSRC;\r\ndspstride_reg = DSPBSTRIDE;\r\ndsplinoff_reg = DSPBLINOFF;\r\ndsptileoff_reg = DSPBTILEOFF;\r\ndspsize_reg = DSPBSIZE;\r\ndsppos_reg = DSPBPOS;\r\ndspsurf_reg = DSPBSURF;\r\ndspcntr_reg = DSPBCNTR;\r\ndspstatus_reg = PIPEBSTAT;\r\npalette_reg = PALETTE_B;\r\ndpll_val = &dev_priv->saveDPLL_B;\r\nfp_val = &dev_priv->saveFPB0;\r\npipeconf_val = &dev_priv->savePIPEBCONF;\r\nhtot_val = &dev_priv->saveHTOTAL_B;\r\nhblank_val = &dev_priv->saveHBLANK_B;\r\nhsync_val = &dev_priv->saveHSYNC_B;\r\nvtot_val = &dev_priv->saveVTOTAL_B;\r\nvblank_val = &dev_priv->saveVBLANK_B;\r\nvsync_val = &dev_priv->saveVSYNC_B;\r\npipesrc_val = &dev_priv->savePIPEBSRC;\r\ndspstride_val = &dev_priv->saveDSPBSTRIDE;\r\ndsplinoff_val = &dev_priv->saveDSPBLINOFF;\r\ndsptileoff_val = &dev_priv->saveDSPBTILEOFF;\r\ndspsize_val = &dev_priv->saveDSPBSIZE;\r\ndsppos_val = &dev_priv->saveDSPBPOS;\r\ndspsurf_val = &dev_priv->saveDSPBSURF;\r\ndspcntr_val = &dev_priv->saveDSPBCNTR;\r\ndspstatus_val = &dev_priv->saveDSPBSTATUS;\r\npalette_val = dev_priv->save_palette_b;\r\nbreak;\r\ncase 2:\r\npipeconf_reg = PIPECCONF;\r\nhtot_reg = HTOTAL_C;\r\nhblank_reg = HBLANK_C;\r\nhsync_reg = HSYNC_C;\r\nvtot_reg = VTOTAL_C;\r\nvblank_reg = VBLANK_C;\r\nvsync_reg = VSYNC_C;\r\npipesrc_reg = PIPECSRC;\r\ndspstride_reg = DSPCSTRIDE;\r\ndsplinoff_reg = DSPCLINOFF;\r\ndsptileoff_reg = DSPCTILEOFF;\r\ndspsize_reg = DSPCSIZE;\r\ndsppos_reg = DSPCPOS;\r\ndspsurf_reg = DSPCSURF;\r\nmipi_reg = MIPI_C;\r\ndspcntr_reg = DSPCCNTR;\r\ndspstatus_reg = PIPECSTAT;\r\npalette_reg = PALETTE_C;\r\npipeconf_val = &dev_priv->savePIPECCONF;\r\nhtot_val = &dev_priv->saveHTOTAL_C;\r\nhblank_val = &dev_priv->saveHBLANK_C;\r\nhsync_val = &dev_priv->saveHSYNC_C;\r\nvtot_val = &dev_priv->saveVTOTAL_C;\r\nvblank_val = &dev_priv->saveVBLANK_C;\r\nvsync_val = &dev_priv->saveVSYNC_C;\r\npipesrc_val = &dev_priv->savePIPECSRC;\r\ndspstride_val = &dev_priv->saveDSPCSTRIDE;\r\ndsplinoff_val = &dev_priv->saveDSPCLINOFF;\r\ndsptileoff_val = &dev_priv->saveDSPCTILEOFF;\r\ndspsize_val = &dev_priv->saveDSPCSIZE;\r\ndsppos_val = &dev_priv->saveDSPCPOS;\r\ndspsurf_val = &dev_priv->saveDSPCSURF;\r\nmipi_val = &dev_priv->saveMIPI_C;\r\ndspcntr_val = &dev_priv->saveDSPCCNTR;\r\ndspstatus_val = &dev_priv->saveDSPCSTATUS;\r\npalette_val = dev_priv->save_palette_c;\r\nbreak;\r\ndefault:\r\nDRM_ERROR("%s, invalid pipe number.\n", __func__);\r\nreturn -EINVAL;\r\n}\r\n*dpll_val = PSB_RVDC32(dpll_reg);\r\n*fp_val = PSB_RVDC32(fp_reg);\r\n*pipeconf_val = PSB_RVDC32(pipeconf_reg);\r\n*htot_val = PSB_RVDC32(htot_reg);\r\n*hblank_val = PSB_RVDC32(hblank_reg);\r\n*hsync_val = PSB_RVDC32(hsync_reg);\r\n*vtot_val = PSB_RVDC32(vtot_reg);\r\n*vblank_val = PSB_RVDC32(vblank_reg);\r\n*vsync_val = PSB_RVDC32(vsync_reg);\r\n*pipesrc_val = PSB_RVDC32(pipesrc_reg);\r\n*dspstride_val = PSB_RVDC32(dspstride_reg);\r\n*dsplinoff_val = PSB_RVDC32(dsplinoff_reg);\r\n*dsptileoff_val = PSB_RVDC32(dsptileoff_reg);\r\n*dspsize_val = PSB_RVDC32(dspsize_reg);\r\n*dsppos_val = PSB_RVDC32(dsppos_reg);\r\n*dspsurf_val = PSB_RVDC32(dspsurf_reg);\r\n*dspcntr_val = PSB_RVDC32(dspcntr_reg);\r\n*dspstatus_val = PSB_RVDC32(dspstatus_reg);\r\nfor (i = 0; i < 256; i++)\r\npalette_val[i] = PSB_RVDC32(palette_reg + (i<<2));\r\nif (pipe == 1) {\r\ndev_priv->savePFIT_CONTROL = PSB_RVDC32(PFIT_CONTROL);\r\ndev_priv->savePFIT_PGM_RATIOS = PSB_RVDC32(PFIT_PGM_RATIOS);\r\ndev_priv->saveHDMIPHYMISCCTL = PSB_RVDC32(HDMIPHYMISCCTL);\r\ndev_priv->saveHDMIB_CONTROL = PSB_RVDC32(HDMIB_CONTROL);\r\nreturn 0;\r\n}\r\n*mipi_val = PSB_RVDC32(mipi_reg);\r\nreturn 0;\r\n}\r\nstatic int mdfld_save_cursor_overlay_registers(struct drm_device *dev)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\ndev_priv->saveDSPACURSOR_CTRL = PSB_RVDC32(CURACNTR);\r\ndev_priv->saveDSPACURSOR_BASE = PSB_RVDC32(CURABASE);\r\ndev_priv->saveDSPACURSOR_POS = PSB_RVDC32(CURAPOS);\r\ndev_priv->saveDSPBCURSOR_CTRL = PSB_RVDC32(CURBCNTR);\r\ndev_priv->saveDSPBCURSOR_BASE = PSB_RVDC32(CURBBASE);\r\ndev_priv->saveDSPBCURSOR_POS = PSB_RVDC32(CURBPOS);\r\ndev_priv->saveDSPCCURSOR_CTRL = PSB_RVDC32(CURCCNTR);\r\ndev_priv->saveDSPCCURSOR_BASE = PSB_RVDC32(CURCBASE);\r\ndev_priv->saveDSPCCURSOR_POS = PSB_RVDC32(CURCPOS);\r\ndev_priv->saveOV_OVADD = PSB_RVDC32(OV_OVADD);\r\ndev_priv->saveOV_OGAMC0 = PSB_RVDC32(OV_OGAMC0);\r\ndev_priv->saveOV_OGAMC1 = PSB_RVDC32(OV_OGAMC1);\r\ndev_priv->saveOV_OGAMC2 = PSB_RVDC32(OV_OGAMC2);\r\ndev_priv->saveOV_OGAMC3 = PSB_RVDC32(OV_OGAMC3);\r\ndev_priv->saveOV_OGAMC4 = PSB_RVDC32(OV_OGAMC4);\r\ndev_priv->saveOV_OGAMC5 = PSB_RVDC32(OV_OGAMC5);\r\ndev_priv->saveOV_OVADD_C = PSB_RVDC32(OV_OVADD + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC0_C = PSB_RVDC32(OV_OGAMC0 + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC1_C = PSB_RVDC32(OV_OGAMC1 + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC2_C = PSB_RVDC32(OV_OGAMC2 + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC3_C = PSB_RVDC32(OV_OGAMC3 + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC4_C = PSB_RVDC32(OV_OGAMC4 + OV_C_OFFSET);\r\ndev_priv->saveOV_OGAMC5_C = PSB_RVDC32(OV_OGAMC5 + OV_C_OFFSET);\r\nreturn 0;\r\n}\r\nstatic int mdfld_restore_display_registers(struct drm_device *dev, int pipe)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nstruct mdfld_dsi_config *dsi_config = NULL;\r\nu32 i = 0;\r\nu32 dpll = 0;\r\nu32 timeout = 0;\r\nu32 reg_offset = 0;\r\nu32 dpll_reg = MRST_DPLL_A;\r\nu32 fp_reg = MRST_FPA0;\r\nu32 pipeconf_reg = PIPEACONF;\r\nu32 htot_reg = HTOTAL_A;\r\nu32 hblank_reg = HBLANK_A;\r\nu32 hsync_reg = HSYNC_A;\r\nu32 vtot_reg = VTOTAL_A;\r\nu32 vblank_reg = VBLANK_A;\r\nu32 vsync_reg = VSYNC_A;\r\nu32 pipesrc_reg = PIPEASRC;\r\nu32 dspstride_reg = DSPASTRIDE;\r\nu32 dsplinoff_reg = DSPALINOFF;\r\nu32 dsptileoff_reg = DSPATILEOFF;\r\nu32 dspsize_reg = DSPASIZE;\r\nu32 dsppos_reg = DSPAPOS;\r\nu32 dspsurf_reg = DSPASURF;\r\nu32 dspstatus_reg = PIPEASTAT;\r\nu32 mipi_reg = MIPI;\r\nu32 dspcntr_reg = DSPACNTR;\r\nu32 palette_reg = PALETTE_A;\r\nu32 dpll_val = dev_priv->saveDPLL_A & ~DPLL_VCO_ENABLE;\r\nu32 fp_val = dev_priv->saveFPA0;\r\nu32 pipeconf_val = dev_priv->savePIPEACONF;\r\nu32 htot_val = dev_priv->saveHTOTAL_A;\r\nu32 hblank_val = dev_priv->saveHBLANK_A;\r\nu32 hsync_val = dev_priv->saveHSYNC_A;\r\nu32 vtot_val = dev_priv->saveVTOTAL_A;\r\nu32 vblank_val = dev_priv->saveVBLANK_A;\r\nu32 vsync_val = dev_priv->saveVSYNC_A;\r\nu32 pipesrc_val = dev_priv->savePIPEASRC;\r\nu32 dspstride_val = dev_priv->saveDSPASTRIDE;\r\nu32 dsplinoff_val = dev_priv->saveDSPALINOFF;\r\nu32 dsptileoff_val = dev_priv->saveDSPATILEOFF;\r\nu32 dspsize_val = dev_priv->saveDSPASIZE;\r\nu32 dsppos_val = dev_priv->saveDSPAPOS;\r\nu32 dspsurf_val = dev_priv->saveDSPASURF;\r\nu32 dspstatus_val = dev_priv->saveDSPASTATUS;\r\nu32 mipi_val = dev_priv->saveMIPI;\r\nu32 dspcntr_val = dev_priv->saveDSPACNTR;\r\nu32 *palette_val = dev_priv->save_palette_a;\r\nswitch (pipe) {\r\ncase 0:\r\ndsi_config = dev_priv->dsi_configs[0];\r\nbreak;\r\ncase 1:\r\ndpll_reg = MDFLD_DPLL_B;\r\nfp_reg = MDFLD_DPLL_DIV0;\r\npipeconf_reg = PIPEBCONF;\r\nhtot_reg = HTOTAL_B;\r\nhblank_reg = HBLANK_B;\r\nhsync_reg = HSYNC_B;\r\nvtot_reg = VTOTAL_B;\r\nvblank_reg = VBLANK_B;\r\nvsync_reg = VSYNC_B;\r\npipesrc_reg = PIPEBSRC;\r\ndspstride_reg = DSPBSTRIDE;\r\ndsplinoff_reg = DSPBLINOFF;\r\ndsptileoff_reg = DSPBTILEOFF;\r\ndspsize_reg = DSPBSIZE;\r\ndsppos_reg = DSPBPOS;\r\ndspsurf_reg = DSPBSURF;\r\ndspcntr_reg = DSPBCNTR;\r\npalette_reg = PALETTE_B;\r\ndspstatus_reg = PIPEBSTAT;\r\ndpll_val = dev_priv->saveDPLL_B & ~DPLL_VCO_ENABLE;\r\nfp_val = dev_priv->saveFPB0;\r\npipeconf_val = dev_priv->savePIPEBCONF;\r\nhtot_val = dev_priv->saveHTOTAL_B;\r\nhblank_val = dev_priv->saveHBLANK_B;\r\nhsync_val = dev_priv->saveHSYNC_B;\r\nvtot_val = dev_priv->saveVTOTAL_B;\r\nvblank_val = dev_priv->saveVBLANK_B;\r\nvsync_val = dev_priv->saveVSYNC_B;\r\npipesrc_val = dev_priv->savePIPEBSRC;\r\ndspstride_val = dev_priv->saveDSPBSTRIDE;\r\ndsplinoff_val = dev_priv->saveDSPBLINOFF;\r\ndsptileoff_val = dev_priv->saveDSPBTILEOFF;\r\ndspsize_val = dev_priv->saveDSPBSIZE;\r\ndsppos_val = dev_priv->saveDSPBPOS;\r\ndspsurf_val = dev_priv->saveDSPBSURF;\r\ndspcntr_val = dev_priv->saveDSPBCNTR;\r\ndspstatus_val = dev_priv->saveDSPBSTATUS;\r\npalette_val = dev_priv->save_palette_b;\r\nbreak;\r\ncase 2:\r\nreg_offset = MIPIC_REG_OFFSET;\r\npipeconf_reg = PIPECCONF;\r\nhtot_reg = HTOTAL_C;\r\nhblank_reg = HBLANK_C;\r\nhsync_reg = HSYNC_C;\r\nvtot_reg = VTOTAL_C;\r\nvblank_reg = VBLANK_C;\r\nvsync_reg = VSYNC_C;\r\npipesrc_reg = PIPECSRC;\r\ndspstride_reg = DSPCSTRIDE;\r\ndsplinoff_reg = DSPCLINOFF;\r\ndsptileoff_reg = DSPCTILEOFF;\r\ndspsize_reg = DSPCSIZE;\r\ndsppos_reg = DSPCPOS;\r\ndspsurf_reg = DSPCSURF;\r\nmipi_reg = MIPI_C;\r\ndspcntr_reg = DSPCCNTR;\r\npalette_reg = PALETTE_C;\r\ndspstatus_reg = PIPECSTAT;\r\npipeconf_val = dev_priv->savePIPECCONF;\r\nhtot_val = dev_priv->saveHTOTAL_C;\r\nhblank_val = dev_priv->saveHBLANK_C;\r\nhsync_val = dev_priv->saveHSYNC_C;\r\nvtot_val = dev_priv->saveVTOTAL_C;\r\nvblank_val = dev_priv->saveVBLANK_C;\r\nvsync_val = dev_priv->saveVSYNC_C;\r\npipesrc_val = dev_priv->savePIPECSRC;\r\ndspstride_val = dev_priv->saveDSPCSTRIDE;\r\ndsplinoff_val = dev_priv->saveDSPCLINOFF;\r\ndsptileoff_val = dev_priv->saveDSPCTILEOFF;\r\ndspsize_val = dev_priv->saveDSPCSIZE;\r\ndsppos_val = dev_priv->saveDSPCPOS;\r\ndspsurf_val = dev_priv->saveDSPCSURF;\r\ndspstatus_val = dev_priv->saveDSPCSTATUS;\r\nmipi_val = dev_priv->saveMIPI_C;\r\ndspcntr_val = dev_priv->saveDSPCCNTR;\r\npalette_val = dev_priv->save_palette_c;\r\ndsi_config = dev_priv->dsi_configs[1];\r\nbreak;\r\ndefault:\r\nDRM_ERROR("%s, invalid pipe number.\n", __func__);\r\nreturn -EINVAL;\r\n}\r\nPSB_WVDC32(0x80000000, VGACNTRL);\r\nif (pipe == 1) {\r\nPSB_WVDC32(dpll_val & ~DPLL_VCO_ENABLE, dpll_reg);\r\nPSB_RVDC32(dpll_reg);\r\nPSB_WVDC32(fp_val, fp_reg);\r\n} else {\r\ndpll = PSB_RVDC32(dpll_reg);\r\nif (!(dpll & DPLL_VCO_ENABLE)) {\r\nif (dpll & MDFLD_PWR_GATE_EN) {\r\ndpll &= ~MDFLD_PWR_GATE_EN;\r\nPSB_WVDC32(dpll, dpll_reg);\r\nudelay(500);\r\n}\r\nPSB_WVDC32(fp_val, fp_reg);\r\nPSB_WVDC32(dpll_val, dpll_reg);\r\nudelay(500);\r\ndpll_val |= DPLL_VCO_ENABLE;\r\nPSB_WVDC32(dpll_val, dpll_reg);\r\nPSB_RVDC32(dpll_reg);\r\nwhile ((timeout < 20000) && !(PSB_RVDC32(pipeconf_reg) & PIPECONF_DSIPLL_LOCK)) {\r\nudelay(150);\r\ntimeout++;\r\n}\r\nif (timeout == 20000) {\r\nDRM_ERROR("%s, can't lock DSIPLL.\n",\r\n__func__);\r\nreturn -EINVAL;\r\n}\r\n}\r\n}\r\nPSB_WVDC32(htot_val, htot_reg);\r\nPSB_WVDC32(hblank_val, hblank_reg);\r\nPSB_WVDC32(hsync_val, hsync_reg);\r\nPSB_WVDC32(vtot_val, vtot_reg);\r\nPSB_WVDC32(vblank_val, vblank_reg);\r\nPSB_WVDC32(vsync_val, vsync_reg);\r\nPSB_WVDC32(pipesrc_val, pipesrc_reg);\r\nPSB_WVDC32(dspstatus_val, dspstatus_reg);\r\nPSB_WVDC32(dspstride_val, dspstride_reg);\r\nPSB_WVDC32(dsplinoff_val, dsplinoff_reg);\r\nPSB_WVDC32(dsptileoff_val, dsptileoff_reg);\r\nPSB_WVDC32(dspsize_val, dspsize_reg);\r\nPSB_WVDC32(dsppos_val, dsppos_reg);\r\nPSB_WVDC32(dspsurf_val, dspsurf_reg);\r\nif (pipe == 1) {\r\nPSB_WVDC32(dev_priv->savePFIT_CONTROL, PFIT_CONTROL);\r\nPSB_WVDC32(dev_priv->savePFIT_PGM_RATIOS, PFIT_PGM_RATIOS);\r\nPSB_WVDC32(dev_priv->saveHDMIPHYMISCCTL, HDMIPHYMISCCTL);\r\nPSB_WVDC32(dev_priv->saveHDMIB_CONTROL, HDMIB_CONTROL);\r\n} else {\r\nPSB_WVDC32(mipi_val, mipi_reg);\r\nmdfld_dsi_controller_init(dsi_config, pipe);\r\nmsleep(20);\r\n}\r\nPSB_WVDC32(dspcntr_val, dspcntr_reg);\r\nmsleep(20);\r\nPSB_WVDC32(pipeconf_val, pipeconf_reg);\r\nfor (i = 0; i < 256; i++)\r\nPSB_WVDC32(palette_val[i], palette_reg + (i<<2));\r\nif (pipe == 1)\r\nreturn 0;\r\nif (!mdfld_panel_dpi(dev))\r\nmdfld_enable_te(dev, pipe);\r\nreturn 0;\r\n}\r\nstatic int mdfld_restore_cursor_overlay_registers(struct drm_device *dev)\r\n{\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nPSB_WVDC32(dev_priv->saveDSPACURSOR_CTRL, CURACNTR);\r\nPSB_WVDC32(dev_priv->saveDSPACURSOR_POS, CURAPOS);\r\nPSB_WVDC32(dev_priv->saveDSPACURSOR_BASE, CURABASE);\r\nPSB_WVDC32(dev_priv->saveDSPBCURSOR_CTRL, CURBCNTR);\r\nPSB_WVDC32(dev_priv->saveDSPBCURSOR_POS, CURBPOS);\r\nPSB_WVDC32(dev_priv->saveDSPBCURSOR_BASE, CURBBASE);\r\nPSB_WVDC32(dev_priv->saveDSPCCURSOR_CTRL, CURCCNTR);\r\nPSB_WVDC32(dev_priv->saveDSPCCURSOR_POS, CURCPOS);\r\nPSB_WVDC32(dev_priv->saveDSPCCURSOR_BASE, CURCBASE);\r\nPSB_WVDC32(dev_priv->saveOV_OVADD, OV_OVADD);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC0, OV_OGAMC0);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC1, OV_OGAMC1);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC2, OV_OGAMC2);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC3, OV_OGAMC3);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC4, OV_OGAMC4);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC5, OV_OGAMC5);\r\nPSB_WVDC32(dev_priv->saveOV_OVADD_C, OV_OVADD + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC0_C, OV_OGAMC0 + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC1_C, OV_OGAMC1 + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC2_C, OV_OGAMC2 + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC3_C, OV_OGAMC3 + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC4_C, OV_OGAMC4 + OV_C_OFFSET);\r\nPSB_WVDC32(dev_priv->saveOV_OGAMC5_C, OV_OGAMC5 + OV_C_OFFSET);\r\nreturn 0;\r\n}\r\nstatic int mdfld_save_registers(struct drm_device *dev)\r\n{\r\nmdfld_save_cursor_overlay_registers(dev);\r\nmdfld_save_display_registers(dev, 0);\r\nmdfld_save_display_registers(dev, 0);\r\nmdfld_save_display_registers(dev, 2);\r\nmdfld_save_display_registers(dev, 1);\r\nmdfld_disable_crtc(dev, 0);\r\nmdfld_disable_crtc(dev, 2);\r\nmdfld_disable_crtc(dev, 1);\r\nreturn 0;\r\n}\r\nstatic int mdfld_restore_registers(struct drm_device *dev)\r\n{\r\nmdfld_restore_display_registers(dev, 1);\r\nmdfld_restore_display_registers(dev, 0);\r\nmdfld_restore_display_registers(dev, 2);\r\nmdfld_restore_cursor_overlay_registers(dev);\r\nreturn 0;\r\n}\r\nstatic int mdfld_power_down(struct drm_device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int mdfld_power_up(struct drm_device *dev)\r\n{\r\nreturn 0;\r\n}
