unsigned long cmpxchg_386_u8(volatile void *ptr, u8 old, u8 new)\r\n{\r\nu8 prev;\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nprev = *(u8 *)ptr;\r\nif (prev == old)\r\n*(u8 *)ptr = new;\r\nlocal_irq_restore(flags);\r\nreturn prev;\r\n}\r\nunsigned long cmpxchg_386_u16(volatile void *ptr, u16 old, u16 new)\r\n{\r\nu16 prev;\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nprev = *(u16 *)ptr;\r\nif (prev == old)\r\n*(u16 *)ptr = new;\r\nlocal_irq_restore(flags);\r\nreturn prev;\r\n}\r\nunsigned long cmpxchg_386_u32(volatile void *ptr, u32 old, u32 new)\r\n{\r\nu32 prev;\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nprev = *(u32 *)ptr;\r\nif (prev == old)\r\n*(u32 *)ptr = new;\r\nlocal_irq_restore(flags);\r\nreturn prev;\r\n}
