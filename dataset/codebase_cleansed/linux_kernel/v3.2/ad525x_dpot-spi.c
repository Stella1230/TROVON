static int write8(void *client, u8 val)\r\n{\r\nu8 data = val;\r\nreturn spi_write(client, &data, 1);\r\n}\r\nstatic int write16(void *client, u8 reg, u8 val)\r\n{\r\nu8 data[2] = {reg, val};\r\nreturn spi_write(client, data, 2);\r\n}\r\nstatic int write24(void *client, u8 reg, u16 val)\r\n{\r\nu8 data[3] = {reg, val >> 8, val};\r\nreturn spi_write(client, data, 3);\r\n}\r\nstatic int read8(void *client)\r\n{\r\nint ret;\r\nu8 data;\r\nret = spi_read(client, &data, 1);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn data;\r\n}\r\nstatic int read16(void *client, u8 reg)\r\n{\r\nint ret;\r\nu8 buf_rx[2];\r\nwrite16(client, reg, 0);\r\nret = spi_read(client, buf_rx, 2);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn (buf_rx[0] << 8) | buf_rx[1];\r\n}\r\nstatic int read24(void *client, u8 reg)\r\n{\r\nint ret;\r\nu8 buf_rx[3];\r\nwrite24(client, reg, 0);\r\nret = spi_read(client, buf_rx, 3);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn (buf_rx[1] << 8) | buf_rx[2];\r\n}\r\nstatic const struct ad_dpot_id *dpot_match_id(const struct ad_dpot_id *id,\r\nchar *name)\r\n{\r\nwhile (id->name && id->name[0]) {\r\nif (strcmp(name, id->name) == 0)\r\nreturn id;\r\nid++;\r\n}\r\nreturn NULL;\r\n}\r\nstatic int __devinit ad_dpot_spi_probe(struct spi_device *spi)\r\n{\r\nchar *name = spi->dev.platform_data;\r\nconst struct ad_dpot_id *dpot_id;\r\nstruct ad_dpot_bus_data bdata = {\r\n.client = spi,\r\n.bops = &bops,\r\n};\r\ndpot_id = dpot_match_id(ad_dpot_spi_devlist, name);\r\nif (dpot_id == NULL) {\r\ndev_err(&spi->dev, "%s not in supported device list", name);\r\nreturn -ENODEV;\r\n}\r\nreturn ad_dpot_probe(&spi->dev, &bdata, dpot_id);\r\n}\r\nstatic int __devexit ad_dpot_spi_remove(struct spi_device *spi)\r\n{\r\nreturn ad_dpot_remove(&spi->dev);\r\n}\r\nstatic int __init ad_dpot_spi_init(void)\r\n{\r\nreturn spi_register_driver(&ad_dpot_spi_driver);\r\n}\r\nstatic void __exit ad_dpot_spi_exit(void)\r\n{\r\nspi_unregister_driver(&ad_dpot_spi_driver);\r\n}
