static int enable_slot(struct hotplug_slot *hotplug_slot)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic int disable_slot(struct hotplug_slot *hotplug_slot)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic int set_attention_status(struct hotplug_slot *hotplug_slot, u8 status)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nswitch (status) {\r\ncase 0:\r\nbreak;\r\ncase 1:\r\ndefault:\r\nbreak;\r\n}\r\nreturn retval;\r\n}\r\nstatic int hardware_test(struct hotplug_slot *hotplug_slot, u32 value)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nswitch (value) {\r\ncase 0:\r\nbreak;\r\ncase 1:\r\nbreak;\r\n}\r\nreturn retval;\r\n}\r\nstatic int get_power_status(struct hotplug_slot *hotplug_slot, u8 *value)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic int get_attention_status(struct hotplug_slot *hotplug_slot, u8 *value)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic int get_latch_status(struct hotplug_slot *hotplug_slot, u8 *value)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic int get_adapter_status(struct hotplug_slot *hotplug_slot, u8 *value)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\nint retval = 0;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nreturn retval;\r\n}\r\nstatic void release_slot(struct hotplug_slot *hotplug_slot)\r\n{\r\nstruct slot *slot = hotplug_slot->private;\r\ndbg("%s - physical_slot = %s\n", __func__, hotplug_slot->name);\r\nkfree(slot->hotplug_slot->info);\r\nkfree(slot->hotplug_slot);\r\nkfree(slot);\r\n}\r\nstatic void make_slot_name(struct slot *slot)\r\n{\r\nsnprintf(slot->hotplug_slot->name, SLOT_NAME_SIZE, "%d", slot->number);\r\n}\r\nstatic int __init init_slots(void)\r\n{\r\nstruct slot *slot;\r\nstruct hotplug_slot *hotplug_slot;\r\nstruct hotplug_slot_info *info;\r\nint retval = -ENOMEM;\r\nint i;\r\nfor (i = 0; i < num_slots; ++i) {\r\nslot = kzalloc(sizeof(*slot), GFP_KERNEL);\r\nif (!slot)\r\ngoto error;\r\nhotplug_slot = kzalloc(sizeof(*hotplug_slot), GFP_KERNEL);\r\nif (!hotplug_slot)\r\ngoto error_slot;\r\nslot->hotplug_slot = hotplug_slot;\r\ninfo = kzalloc(sizeof(*info), GFP_KERNEL);\r\nif (!info)\r\ngoto error_hpslot;\r\nhotplug_slot->info = info;\r\nslot->number = i;\r\nhotplug_slot->name = slot->name;\r\nhotplug_slot->private = slot;\r\nhotplug_slot->release = &release_slot;\r\nmake_slot_name(slot);\r\nhotplug_slot->ops = &skel_hotplug_slot_ops;\r\nget_power_status(hotplug_slot, &info->power_status);\r\nget_attention_status(hotplug_slot, &info->attention_status);\r\nget_latch_status(hotplug_slot, &info->latch_status);\r\nget_adapter_status(hotplug_slot, &info->adapter_status);\r\ndbg("registering slot %d\n", i);\r\nretval = pci_hp_register(slot->hotplug_slot);\r\nif (retval) {\r\nerr("pci_hp_register failed with error %d\n", retval);\r\ngoto error_info;\r\n}\r\nlist_add(&slot->slot_list, &slot_list);\r\n}\r\nreturn 0;\r\nerror_info:\r\nkfree(info);\r\nerror_hpslot:\r\nkfree(hotplug_slot);\r\nerror_slot:\r\nkfree(slot);\r\nerror:\r\nreturn retval;\r\n}\r\nstatic void __exit cleanup_slots(void)\r\n{\r\nstruct list_head *tmp;\r\nstruct list_head *next;\r\nstruct slot *slot;\r\nlist_for_each_safe(tmp, next, &slot_list) {\r\nslot = list_entry(tmp, struct slot, slot_list);\r\nlist_del(&slot->slot_list);\r\npci_hp_deregister(slot->hotplug_slot);\r\n}\r\n}\r\nstatic int __init pcihp_skel_init(void)\r\n{\r\nint retval;\r\ninfo(DRIVER_DESC " version: " DRIVER_VERSION "\n");\r\nnum_slots = 5;\r\nreturn init_slots();\r\n}\r\nstatic void __exit pcihp_skel_exit(void)\r\n{\r\ncleanup_slots();\r\n}
