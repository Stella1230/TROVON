unsigned int rds_tcp_stats_info_copy(struct rds_info_iterator *iter,\r\nunsigned int avail)\r\n{\r\nstruct rds_tcp_statistics stats = {0, };\r\nuint64_t *src;\r\nuint64_t *sum;\r\nsize_t i;\r\nint cpu;\r\nif (avail < ARRAY_SIZE(rds_tcp_stat_names))\r\ngoto out;\r\nfor_each_online_cpu(cpu) {\r\nsrc = (uint64_t *)&(per_cpu(rds_tcp_stats, cpu));\r\nsum = (uint64_t *)&stats;\r\nfor (i = 0; i < sizeof(stats) / sizeof(uint64_t); i++)\r\n*(sum++) += *(src++);\r\n}\r\nrds_stats_info_copy(iter, (uint64_t *)&stats, rds_tcp_stat_names,\r\nARRAY_SIZE(rds_tcp_stat_names));\r\nout:\r\nreturn ARRAY_SIZE(rds_tcp_stat_names);\r\n}
