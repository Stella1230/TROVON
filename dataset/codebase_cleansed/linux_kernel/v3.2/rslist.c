acpi_status\r\nacpi_rs_convert_aml_to_resources(u8 * aml,\r\nu32 length,\r\nu32 offset, u8 resource_index, void **context)\r\n{\r\nstruct acpi_resource **resource_ptr =\r\nACPI_CAST_INDIRECT_PTR(struct acpi_resource, context);\r\nstruct acpi_resource *resource;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(rs_convert_aml_to_resources);\r\nresource = *resource_ptr;\r\nif (ACPI_IS_MISALIGNED(resource)) {\r\nACPI_WARNING((AE_INFO,\r\n"Misaligned resource pointer %p", resource));\r\n}\r\nstatus =\r\nacpi_rs_convert_aml_to_resource(resource,\r\nACPI_CAST_PTR(union aml_resource,\r\naml),\r\nacpi_gbl_get_resource_dispatch\r\n[resource_index]);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Could not convert AML resource (Type 0x%X)",\r\n*aml));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_RESOURCES,\r\n"Type %.2X, AmlLength %.2X InternalLength %.2X\n",\r\nacpi_ut_get_resource_type(aml), length,\r\nresource->length));\r\n*resource_ptr = ACPI_ADD_PTR(void, resource, resource->length);\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status\r\nacpi_rs_convert_resources_to_aml(struct acpi_resource *resource,\r\nacpi_size aml_size_needed, u8 * output_buffer)\r\n{\r\nu8 *aml = output_buffer;\r\nu8 *end_aml = output_buffer + aml_size_needed;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(rs_convert_resources_to_aml);\r\nwhile (aml < end_aml) {\r\nif (resource->type > ACPI_RESOURCE_TYPE_MAX) {\r\nACPI_ERROR((AE_INFO,\r\n"Invalid descriptor type (0x%X) in resource list",\r\nresource->type));\r\nreturn_ACPI_STATUS(AE_BAD_DATA);\r\n}\r\nstatus = acpi_rs_convert_resource_to_aml(resource, ACPI_CAST_PTR(union\r\naml_resource,\r\naml),\r\nacpi_gbl_set_resource_dispatch\r\n[resource->type]);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Could not convert resource (type 0x%X) to AML",\r\nresource->type));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus =\r\nacpi_ut_validate_resource(ACPI_CAST_PTR\r\n(union aml_resource, aml), NULL);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (resource->type == ACPI_RESOURCE_TYPE_END_TAG) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\naml += acpi_ut_get_descriptor_length(aml);\r\nresource =\r\nACPI_ADD_PTR(struct acpi_resource, resource,\r\nresource->length);\r\n}\r\nreturn_ACPI_STATUS(AE_AML_NO_RESOURCE_END_TAG);\r\n}
