void v9fs_register_trans(struct p9_trans_module *m)\r\n{\r\nspin_lock(&v9fs_trans_lock);\r\nlist_add_tail(&m->list, &v9fs_trans_list);\r\nspin_unlock(&v9fs_trans_lock);\r\n}\r\nvoid v9fs_unregister_trans(struct p9_trans_module *m)\r\n{\r\nspin_lock(&v9fs_trans_lock);\r\nlist_del_init(&m->list);\r\nspin_unlock(&v9fs_trans_lock);\r\n}\r\nstruct p9_trans_module *v9fs_get_trans_by_name(char *s)\r\n{\r\nstruct p9_trans_module *t, *found = NULL;\r\nspin_lock(&v9fs_trans_lock);\r\nlist_for_each_entry(t, &v9fs_trans_list, list)\r\nif (strcmp(t->name, s) == 0 &&\r\ntry_module_get(t->owner)) {\r\nfound = t;\r\nbreak;\r\n}\r\nspin_unlock(&v9fs_trans_lock);\r\nreturn found;\r\n}\r\nstruct p9_trans_module *v9fs_get_default_trans(void)\r\n{\r\nstruct p9_trans_module *t, *found = NULL;\r\nspin_lock(&v9fs_trans_lock);\r\nlist_for_each_entry(t, &v9fs_trans_list, list)\r\nif (t->def && try_module_get(t->owner)) {\r\nfound = t;\r\nbreak;\r\n}\r\nif (!found)\r\nlist_for_each_entry(t, &v9fs_trans_list, list)\r\nif (try_module_get(t->owner)) {\r\nfound = t;\r\nbreak;\r\n}\r\nspin_unlock(&v9fs_trans_lock);\r\nreturn found;\r\n}\r\nvoid v9fs_put_trans(struct p9_trans_module *m)\r\n{\r\nif (m)\r\nmodule_put(m->owner);\r\n}\r\nstatic int __init init_p9(void)\r\n{\r\nint ret = 0;\r\np9_error_init();\r\nprintk(KERN_INFO "Installing 9P2000 support\n");\r\np9_trans_fd_init();\r\nreturn ret;\r\n}\r\nstatic void __exit exit_p9(void)\r\n{\r\nprintk(KERN_INFO "Unloading 9P2000 support\n");\r\np9_trans_fd_exit();\r\n}
