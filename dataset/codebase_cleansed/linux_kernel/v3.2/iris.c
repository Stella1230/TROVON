static void iris_power_off(void)\r\n{\r\noutb(IRIS_GIO_PULSE, IRIS_GIO_OUTPUT);\r\nmsleep(850);\r\noutb(IRIS_GIO_REST, IRIS_GIO_OUTPUT);\r\n}\r\nstatic int iris_init(void)\r\n{\r\nunsigned char status;\r\nif (force != 1) {\r\nprintk(KERN_ERR "The force parameter has not been set to 1 so the Iris poweroff handler will not be installed.\n");\r\nreturn -ENODEV;\r\n}\r\nstatus = inb(IRIS_GIO_INPUT);\r\nif (status == IRIS_GIO_NODEV) {\r\nprintk(KERN_ERR "This machine does not seem to be an Iris. Power_off handler not installed.\n");\r\nreturn -ENODEV;\r\n}\r\nold_pm_power_off = pm_power_off;\r\npm_power_off = &iris_power_off;\r\nprintk(KERN_INFO "Iris power_off handler installed.\n");\r\nreturn 0;\r\n}\r\nstatic void iris_exit(void)\r\n{\r\npm_power_off = old_pm_power_off;\r\nprintk(KERN_INFO "Iris power_off handler uninstalled.\n");\r\n}
