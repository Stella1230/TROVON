int iscsit_get_lun_for_tmr(\r\nstruct iscsi_cmd *cmd,\r\nu64 lun)\r\n{\r\nu32 unpacked_lun = scsilun_to_int((struct scsi_lun *)&lun);\r\nreturn transport_lookup_tmr_lun(&cmd->se_cmd, unpacked_lun);\r\n}\r\nint iscsit_get_lun_for_cmd(\r\nstruct iscsi_cmd *cmd,\r\nunsigned char *cdb,\r\nu64 lun)\r\n{\r\nu32 unpacked_lun = scsilun_to_int((struct scsi_lun *)&lun);\r\nreturn transport_lookup_cmd_lun(&cmd->se_cmd, unpacked_lun);\r\n}\r\nvoid iscsit_determine_maxcmdsn(struct iscsi_session *sess)\r\n{\r\nstruct se_node_acl *se_nacl;\r\nif (sess->sess_ops->SessionType)\r\nreturn;\r\nse_nacl = sess->se_sess->se_node_acl;\r\nsess->cmdsn_window = se_nacl->queue_depth;\r\nsess->max_cmd_sn = (sess->max_cmd_sn + se_nacl->queue_depth) - 1;\r\n}\r\nvoid iscsit_increment_maxcmdsn(struct iscsi_cmd *cmd, struct iscsi_session *sess)\r\n{\r\nif (cmd->immediate_cmd || cmd->maxcmdsn_inc)\r\nreturn;\r\ncmd->maxcmdsn_inc = 1;\r\nmutex_lock(&sess->cmdsn_mutex);\r\nsess->max_cmd_sn += 1;\r\npr_debug("Updated MaxCmdSN to 0x%08x\n", sess->max_cmd_sn);\r\nmutex_unlock(&sess->cmdsn_mutex);\r\n}
