static int __init esi_sir_init(void)\r\n{\r\nreturn irda_register_dongle(&esi);\r\n}\r\nstatic void __exit esi_sir_cleanup(void)\r\n{\r\nirda_unregister_dongle(&esi);\r\n}\r\nstatic int esi_open(struct sir_dev *dev)\r\n{\r\nstruct qos_info *qos = &dev->qos;\r\nsirdev_set_dtr_rts(dev, FALSE, TRUE);\r\nqos->baud_rate.bits &= IR_9600|IR_19200|IR_115200;\r\nqos->min_turn_time.bits = 0x01;\r\nirda_qos_bits_to_value(qos);\r\nreturn 0;\r\n}\r\nstatic int esi_close(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, FALSE, FALSE);\r\nreturn 0;\r\n}\r\nstatic int esi_change_speed(struct sir_dev *dev, unsigned speed)\r\n{\r\nint ret = 0;\r\nint dtr, rts;\r\nswitch (speed) {\r\ncase 19200:\r\ndtr = TRUE;\r\nrts = FALSE;\r\nbreak;\r\ncase 115200:\r\ndtr = rts = TRUE;\r\nbreak;\r\ndefault:\r\nret = -EINVAL;\r\nspeed = 9600;\r\ncase 9600:\r\ndtr = FALSE;\r\nrts = TRUE;\r\nbreak;\r\n}\r\nsirdev_set_dtr_rts(dev, dtr, rts);\r\ndev->speed = speed;\r\nreturn ret;\r\n}\r\nstatic int esi_reset(struct sir_dev *dev)\r\n{\r\nsirdev_set_dtr_rts(dev, FALSE, FALSE);\r\nsirdev_set_dtr_rts(dev, FALSE, TRUE);\r\ndev->speed = 9600;\r\nreturn 0;\r\n}
