static int omap_hdmi_dai_startup(struct snd_pcm_substream *substream,\r\nstruct snd_soc_dai *dai)\r\n{\r\nint err;\r\nerr = snd_pcm_hw_constraint_step(substream->runtime, 0,\r\nSNDRV_PCM_HW_PARAM_PERIOD_BYTES, 128);\r\nif (err < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int omap_hdmi_dai_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params,\r\nstruct snd_soc_dai *dai)\r\n{\r\nint err = 0;\r\nswitch (params_format(params)) {\r\ncase SNDRV_PCM_FORMAT_S16_LE:\r\nomap_hdmi_dai_dma_params.packet_size = 16;\r\nbreak;\r\ncase SNDRV_PCM_FORMAT_S24_LE:\r\nomap_hdmi_dai_dma_params.packet_size = 32;\r\nbreak;\r\ndefault:\r\nerr = -EINVAL;\r\n}\r\nomap_hdmi_dai_dma_params.data_type = OMAP_DMA_DATA_TYPE_S32;\r\nsnd_soc_dai_set_dma_data(dai, substream,\r\n&omap_hdmi_dai_dma_params);\r\nreturn err;\r\n}\r\nstatic __devinit int omap_hdmi_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nstruct resource *hdmi_rsrc;\r\nhdmi_rsrc = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nif (!hdmi_rsrc) {\r\ndev_err(&pdev->dev, "Cannot obtain IORESOURCE_MEM HDMI\n");\r\nreturn -EINVAL;\r\n}\r\nomap_hdmi_dai_dma_params.port_addr = hdmi_rsrc->start\r\n+ OMAP_HDMI_AUDIO_DMA_PORT;\r\nhdmi_rsrc = platform_get_resource(pdev, IORESOURCE_DMA, 0);\r\nif (!hdmi_rsrc) {\r\ndev_err(&pdev->dev, "Cannot obtain IORESOURCE_DMA HDMI\n");\r\nreturn -EINVAL;\r\n}\r\nomap_hdmi_dai_dma_params.dma_req = hdmi_rsrc->start;\r\nret = snd_soc_register_dai(&pdev->dev, &omap_hdmi_dai);\r\nreturn ret;\r\n}\r\nstatic int __devexit omap_hdmi_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_dai(&pdev->dev);\r\nreturn 0;\r\n}\r\nstatic int __init hdmi_dai_init(void)\r\n{\r\nreturn platform_driver_register(&hdmi_dai_driver);\r\n}\r\nstatic void __exit hdmi_dai_exit(void)\r\n{\r\nplatform_driver_unregister(&hdmi_dai_driver);\r\n}
