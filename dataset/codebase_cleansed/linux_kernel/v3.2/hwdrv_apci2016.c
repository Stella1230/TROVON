int i_APCI2016_ConfigDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nif ((data[0] != 0) && (data[0] != 1)) {\r\ncomedi_error(dev,\r\n"Not a valid Data !!! ,Data should be 1 or 0\n");\r\nreturn -EINVAL;\r\n}\r\nif (data[0]) {\r\ndevpriv->b_OutputMemoryStatus = ADDIDATA_ENABLE;\r\n}\r\nelse {\r\ndevpriv->b_OutputMemoryStatus = ADDIDATA_DISABLE;\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_WriteDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_NoOfChannel;\r\nunsigned int ui_Temp, ui_Temp1;\r\nui_NoOfChannel = CR_CHAN(insn->chanspec);\r\nif (ui_NoOfChannel > 15) {\r\ncomedi_error(dev,\r\n"Invalid Channel Numbers !!!, Channel Numbers must be between 0 and 15\n");\r\nreturn -EINVAL;\r\n}\r\nif (devpriv->b_OutputMemoryStatus) {\r\nui_Temp = inw(devpriv->iobase + APCI2016_DIGITAL_OP);\r\n}\r\nelse {\r\nui_Temp = 0;\r\n}\r\nif ((data[1] != 0) && (data[1] != 1)) {\r\ncomedi_error(dev,\r\n"Invalid Data[1] value !!!, Data[1] should be 0 or 1\n");\r\nreturn -EINVAL;\r\n}\r\nif (data[3] == 0) {\r\nif (data[1] == 0) {\r\ndata[0] = (data[0] << ui_NoOfChannel) | ui_Temp;\r\noutw(data[0], devpriv->iobase + APCI2016_DIGITAL_OP);\r\n}\r\nelse {\r\nif (data[1] == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\ndata[0] =\r\n(data[0] << (2 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 4:\r\ndata[0] =\r\n(data[0] << (4 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 8:\r\ndata[0] =\r\n(data[0] << (8 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 15:\r\ndata[0] = data[0] | ui_Temp;\r\nbreak;\r\ndefault:\r\ncomedi_error(dev, " chan spec wrong");\r\nreturn -EINVAL;\r\n}\r\noutw(data[0],\r\ndevpriv->iobase + APCI2016_DIGITAL_OP);\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported\n");\r\n}\r\n}\r\n}\r\nelse {\r\nif (data[3] == 1) {\r\nif (data[1] == 0) {\r\ndata[0] = ~data[0] & 0x1;\r\nui_Temp1 = 1;\r\nui_Temp1 = ui_Temp1 << ui_NoOfChannel;\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] = (data[0] << ui_NoOfChannel) ^ 0xffff;\r\ndata[0] = data[0] & ui_Temp;\r\noutw(data[0],\r\ndevpriv->iobase + APCI2016_DIGITAL_OP);\r\n}\r\nelse {\r\nif (data[1] == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\ndata[0] = ~data[0] & 0x3;\r\nui_Temp1 = 3;\r\nui_Temp1 =\r\nui_Temp1 << 2 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (2 *\r\ndata\r\n[2])) ^\r\n0xffff) & ui_Temp;\r\nbreak;\r\ncase 4:\r\ndata[0] = ~data[0] & 0xf;\r\nui_Temp1 = 15;\r\nui_Temp1 =\r\nui_Temp1 << 4 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (4 *\r\ndata\r\n[2])) ^\r\n0xffff) & ui_Temp;\r\nbreak;\r\ncase 8:\r\ndata[0] = ~data[0] & 0xff;\r\nui_Temp1 = 255;\r\nui_Temp1 =\r\nui_Temp1 << 8 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (8 *\r\ndata\r\n[2])) ^\r\n0xffff) & ui_Temp;\r\nbreak;\r\ncase 15:\r\nbreak;\r\ndefault:\r\ncomedi_error(dev,\r\n" chan spec wrong");\r\nreturn -EINVAL;\r\n}\r\noutw(data[0],\r\ndevpriv->iobase +\r\nAPCI2016_DIGITAL_OP);\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported\n");\r\n}\r\n}\r\n}\r\nelse {\r\nprintk("\nSpecified functionality does not exist\n");\r\nreturn -EINVAL;\r\n}\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_BitsDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_Temp;\r\nunsigned int ui_NoOfChannel;\r\nui_NoOfChannel = CR_CHAN(insn->chanspec);\r\nif (ui_NoOfChannel > 15) {\r\ncomedi_error(dev,\r\n"Invalid Channel Numbers !!!, Channel Numbers must be between 0 and 15\n");\r\nreturn -EINVAL;\r\n}\r\nif ((data[0] != 0) && (data[0] != 1)) {\r\ncomedi_error(dev,\r\n"Invalid Data[0] value !!!, Data[0] should be 0 or 1\n");\r\nreturn -EINVAL;\r\n}\r\nui_Temp = data[0];\r\n*data = inw(devpriv->iobase + APCI2016_DIGITAL_OP_RW);\r\nif (ui_Temp == 0) {\r\n*data = (*data >> ui_NoOfChannel) & 0x1;\r\n}\r\nelse {\r\nif (ui_Temp == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\n*data = (*data >> (2 * data[1])) & 3;\r\nbreak;\r\ncase 4:\r\n*data = (*data >> (4 * data[1])) & 15;\r\nbreak;\r\ncase 8:\r\n*data = (*data >> (8 * data[1])) & 255;\r\nbreak;\r\ncase 15:\r\nbreak;\r\ndefault:\r\ncomedi_error(dev, " chan spec wrong");\r\nreturn -EINVAL;\r\n}\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported \n");\r\n}\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_ConfigWatchdog(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nif (data[0] == 0) {\r\noutw(0x0,\r\ndevpriv->i_IobaseAddon +\r\nAPCI2016_WATCHDOG_ENABLEDISABLE);\r\noutw(data[1],\r\ndevpriv->i_IobaseAddon +\r\nAPCI2016_WATCHDOG_RELOAD_VALUE);\r\ndata[1] = data[1] >> 16;\r\noutw(data[1],\r\ndevpriv->i_IobaseAddon +\r\nAPCI2016_WATCHDOG_RELOAD_VALUE + 2);\r\n} else {\r\nprintk("\nThe input parameters are wrong\n");\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_StartStopWriteWatchdog(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nswitch (data[0]) {\r\ncase 0:\r\noutw(0x0, devpriv->i_IobaseAddon + APCI2016_WATCHDOG_ENABLEDISABLE);\r\nbreak;\r\ncase 1:\r\noutw(0x0001,\r\ndevpriv->i_IobaseAddon +\r\nAPCI2016_WATCHDOG_ENABLEDISABLE);\r\nbreak;\r\ncase 2:\r\noutw(0x0201,\r\ndevpriv->i_IobaseAddon +\r\nAPCI2016_WATCHDOG_ENABLEDISABLE);\r\nbreak;\r\ndefault:\r\nprintk("\nSpecified functionality does not exist\n");\r\nreturn -EINVAL;\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_ReadWatchdog(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nudelay(5);\r\ndata[0] = inw(devpriv->i_IobaseAddon + APCI2016_WATCHDOG_STATUS) & 0x1;\r\nreturn insn->n;\r\n}\r\nint i_APCI2016_Reset(struct comedi_device *dev)\r\n{\r\noutw(0x0, devpriv->iobase + APCI2016_DIGITAL_OP);\r\noutw(0x0, devpriv->i_IobaseAddon + APCI2016_WATCHDOG_ENABLEDISABLE);\r\noutw(0x0, devpriv->i_IobaseAddon + APCI2016_WATCHDOG_RELOAD_VALUE);\r\noutw(0x0, devpriv->i_IobaseAddon + APCI2016_WATCHDOG_RELOAD_VALUE + 2);\r\nreturn 0;\r\n}
