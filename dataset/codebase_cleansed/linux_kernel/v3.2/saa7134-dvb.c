static int pinnacle_antenna_pwr(struct saa7134_dev *dev, int on)\r\n{\r\nu32 ok;\r\nif (!on) {\r\nsaa_setl(SAA7134_GPIO_GPMODE0 >> 2, (1 << 26));\r\nsaa_clearl(SAA7134_GPIO_GPSTATUS0 >> 2, (1 << 26));\r\nreturn 0;\r\n}\r\nsaa_setl(SAA7134_GPIO_GPMODE0 >> 2, (1 << 26));\r\nsaa_setl(SAA7134_GPIO_GPSTATUS0 >> 2, (1 << 26));\r\nudelay(10);\r\nsaa_setl(SAA7134_GPIO_GPMODE0 >> 2, (1 << 28));\r\nsaa_clearl(SAA7134_GPIO_GPSTATUS0 >> 2, (1 << 28));\r\nudelay(10);\r\nsaa_setl(SAA7134_GPIO_GPSTATUS0 >> 2, (1 << 28));\r\nudelay(10);\r\nok = saa_readl(SAA7134_GPIO_GPSTATUS0) & (1 << 27);\r\ndprintk("%s %s\n", __func__, ok ? "on" : "off");\r\nif (!ok)\r\nsaa_clearl(SAA7134_GPIO_GPSTATUS0 >> 2, (1 << 26));\r\nreturn ok;\r\n}\r\nstatic int mt352_pinnacle_init(struct dvb_frontend* fe)\r\n{\r\nstatic u8 clock_config [] = { CLOCK_CTL, 0x3d, 0x28 };\r\nstatic u8 reset [] = { RESET, 0x80 };\r\nstatic u8 adc_ctl_1_cfg [] = { ADC_CTL_1, 0x40 };\r\nstatic u8 agc_cfg [] = { AGC_TARGET, 0x28, 0xa0 };\r\nstatic u8 capt_range_cfg[] = { CAPT_RANGE, 0x31 };\r\nstatic u8 fsm_ctl_cfg[] = { 0x7b, 0x04 };\r\nstatic u8 gpp_ctl_cfg [] = { GPP_CTL, 0x0f };\r\nstatic u8 scan_ctl_cfg [] = { SCAN_CTL, 0x0d };\r\nstatic u8 irq_cfg [] = { INTERRUPT_EN_0, 0x00, 0x00, 0x00, 0x00 };\r\nstruct saa7134_dev *dev= fe->dvb->priv;\r\ndprintk("%s called\n", __func__);\r\nmt352_write(fe, clock_config, sizeof(clock_config));\r\nudelay(200);\r\nmt352_write(fe, reset, sizeof(reset));\r\nmt352_write(fe, adc_ctl_1_cfg, sizeof(adc_ctl_1_cfg));\r\nmt352_write(fe, agc_cfg, sizeof(agc_cfg));\r\nmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\r\nmt352_write(fe, gpp_ctl_cfg, sizeof(gpp_ctl_cfg));\r\nmt352_write(fe, fsm_ctl_cfg, sizeof(fsm_ctl_cfg));\r\nmt352_write(fe, scan_ctl_cfg, sizeof(scan_ctl_cfg));\r\nmt352_write(fe, irq_cfg, sizeof(irq_cfg));\r\nreturn 0;\r\n}\r\nstatic int mt352_aver777_init(struct dvb_frontend* fe)\r\n{\r\nstatic u8 clock_config [] = { CLOCK_CTL, 0x38, 0x2d };\r\nstatic u8 reset [] = { RESET, 0x80 };\r\nstatic u8 adc_ctl_1_cfg [] = { ADC_CTL_1, 0x40 };\r\nstatic u8 agc_cfg [] = { AGC_TARGET, 0x28, 0xa0 };\r\nstatic u8 capt_range_cfg[] = { CAPT_RANGE, 0x33 };\r\nmt352_write(fe, clock_config, sizeof(clock_config));\r\nudelay(200);\r\nmt352_write(fe, reset, sizeof(reset));\r\nmt352_write(fe, adc_ctl_1_cfg, sizeof(adc_ctl_1_cfg));\r\nmt352_write(fe, agc_cfg, sizeof(agc_cfg));\r\nmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\r\nreturn 0;\r\n}\r\nstatic int mt352_avermedia_xc3028_init(struct dvb_frontend *fe)\r\n{\r\nstatic u8 clock_config [] = { CLOCK_CTL, 0x38, 0x2d };\r\nstatic u8 reset [] = { RESET, 0x80 };\r\nstatic u8 adc_ctl_1_cfg [] = { ADC_CTL_1, 0x40 };\r\nstatic u8 agc_cfg [] = { AGC_TARGET, 0xe };\r\nstatic u8 capt_range_cfg[] = { CAPT_RANGE, 0x33 };\r\nmt352_write(fe, clock_config, sizeof(clock_config));\r\nudelay(200);\r\nmt352_write(fe, reset, sizeof(reset));\r\nmt352_write(fe, adc_ctl_1_cfg, sizeof(adc_ctl_1_cfg));\r\nmt352_write(fe, agc_cfg, sizeof(agc_cfg));\r\nmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\r\nreturn 0;\r\n}\r\nstatic int mt352_pinnacle_tuner_set_params(struct dvb_frontend* fe,\r\nstruct dvb_frontend_parameters* params)\r\n{\r\nu8 off[] = { 0x00, 0xf1};\r\nu8 on[] = { 0x00, 0x71};\r\nstruct i2c_msg msg = {.addr=0x43, .flags=0, .buf=off, .len = sizeof(off)};\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct v4l2_frequency f;\r\nf.tuner = 0;\r\nf.type = V4L2_TUNER_DIGITAL_TV;\r\nf.frequency = params->frequency / 1000 * 16 / 1000;\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\ni2c_transfer(&dev->i2c_adap, &msg, 1);\r\nsaa_call_all(dev, tuner, s_frequency, &f);\r\nmsg.buf = on;\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\ni2c_transfer(&dev->i2c_adap, &msg, 1);\r\npinnacle_antenna_pwr(dev, antenna_pwr);\r\nreturn mt352_pinnacle_init(fe);\r\n}\r\nstatic int kworld_sbtvd_gate_ctrl(struct dvb_frontend* fe, int enable)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nunsigned char initmsg[] = {0x45, 0x97};\r\nunsigned char msg_enable[] = {0x45, 0xc1};\r\nunsigned char msg_disable[] = {0x45, 0x81};\r\nstruct i2c_msg msg = {.addr = 0x4b, .flags = 0, .buf = initmsg, .len = 2};\r\nif (i2c_transfer(&dev->i2c_adap, &msg, 1) != 1) {\r\nwprintk("could not access the I2C gate\n");\r\nreturn -EIO;\r\n}\r\nif (enable)\r\nmsg.buf = msg_enable;\r\nelse\r\nmsg.buf = msg_disable;\r\nif (i2c_transfer(&dev->i2c_adap, &msg, 1) != 1) {\r\nwprintk("could not access the I2C gate\n");\r\nreturn -EIO;\r\n}\r\nmsleep(20);\r\nreturn 0;\r\n}\r\nstatic int philips_tda1004x_request_firmware(struct dvb_frontend *fe,\r\nconst struct firmware **fw, char *name)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nreturn request_firmware(fw, name, &dev->pci->dev);\r\n}\r\nstatic int philips_tda6651_pll_set(struct dvb_frontend *fe, struct dvb_frontend_parameters *params)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nu8 addr = state->config->tuner_address;\r\nu8 tuner_buf[4];\r\nstruct i2c_msg tuner_msg = {.addr = addr,.flags = 0,.buf = tuner_buf,.len =\r\nsizeof(tuner_buf) };\r\nint tuner_frequency = 0;\r\nu8 band, cp, filter;\r\ntuner_frequency = params->frequency + 36166000;\r\nif (tuner_frequency < 87000000)\r\nreturn -EINVAL;\r\nelse if (tuner_frequency < 130000000)\r\ncp = 3;\r\nelse if (tuner_frequency < 160000000)\r\ncp = 5;\r\nelse if (tuner_frequency < 200000000)\r\ncp = 6;\r\nelse if (tuner_frequency < 290000000)\r\ncp = 3;\r\nelse if (tuner_frequency < 420000000)\r\ncp = 5;\r\nelse if (tuner_frequency < 480000000)\r\ncp = 6;\r\nelse if (tuner_frequency < 620000000)\r\ncp = 3;\r\nelse if (tuner_frequency < 830000000)\r\ncp = 5;\r\nelse if (tuner_frequency < 895000000)\r\ncp = 7;\r\nelse\r\nreturn -EINVAL;\r\nif (params->frequency < 49000000)\r\nreturn -EINVAL;\r\nelse if (params->frequency < 161000000)\r\nband = 1;\r\nelse if (params->frequency < 444000000)\r\nband = 2;\r\nelse if (params->frequency < 861000000)\r\nband = 4;\r\nelse\r\nreturn -EINVAL;\r\nswitch (params->u.ofdm.bandwidth) {\r\ncase BANDWIDTH_6_MHZ:\r\nfilter = 0;\r\nbreak;\r\ncase BANDWIDTH_7_MHZ:\r\nfilter = 0;\r\nbreak;\r\ncase BANDWIDTH_8_MHZ:\r\nfilter = 1;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\ntuner_frequency = (((params->frequency / 1000) * 6) + 217496) / 1000;\r\ntuner_buf[0] = (tuner_frequency >> 8) & 0x7f;\r\ntuner_buf[1] = tuner_frequency & 0xff;\r\ntuner_buf[2] = 0xca;\r\ntuner_buf[3] = (cp << 5) | (filter << 3) | band;\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (i2c_transfer(&dev->i2c_adap, &tuner_msg, 1) != 1) {\r\nwprintk("could not write to tuner at addr: 0x%02x\n",\r\naddr << 1);\r\nreturn -EIO;\r\n}\r\nmsleep(1);\r\nreturn 0;\r\n}\r\nstatic int philips_tu1216_init(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nu8 addr = state->config->tuner_address;\r\nstatic u8 tu1216_init[] = { 0x0b, 0xf5, 0x85, 0xab };\r\nstruct i2c_msg tuner_msg = {.addr = addr,.flags = 0,.buf = tu1216_init,.len = sizeof(tu1216_init) };\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (i2c_transfer(&dev->i2c_adap, &tuner_msg, 1) != 1)\r\nreturn -EIO;\r\nmsleep(1);\r\nreturn 0;\r\n}\r\nstatic int philips_td1316_tuner_init(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nu8 addr = state->config->tuner_address;\r\nstatic u8 msg[] = { 0x0b, 0xf5, 0x86, 0xab };\r\nstruct i2c_msg init_msg = {.addr = addr,.flags = 0,.buf = msg,.len = sizeof(msg) };\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (i2c_transfer(&dev->i2c_adap, &init_msg, 1) != 1)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int philips_td1316_tuner_set_params(struct dvb_frontend *fe, struct dvb_frontend_parameters *params)\r\n{\r\nreturn philips_tda6651_pll_set(fe, params);\r\n}\r\nstatic int philips_td1316_tuner_sleep(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nu8 addr = state->config->tuner_address;\r\nstatic u8 msg[] = { 0x0b, 0xdc, 0x86, 0xa4 };\r\nstruct i2c_msg analog_msg = {.addr = addr,.flags = 0,.buf = msg,.len = sizeof(msg) };\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (i2c_transfer(&dev->i2c_adap, &analog_msg, 1) != 1)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int philips_europa_tuner_init(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstatic u8 msg[] = { 0x00, 0x40};\r\nstruct i2c_msg init_msg = {.addr = 0x43,.flags = 0,.buf = msg,.len = sizeof(msg) };\r\nif (philips_td1316_tuner_init(fe))\r\nreturn -EIO;\r\nmsleep(1);\r\nif (i2c_transfer(&dev->i2c_adap, &init_msg, 1) != 1)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int philips_europa_tuner_sleep(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstatic u8 msg[] = { 0x00, 0x14 };\r\nstruct i2c_msg analog_msg = {.addr = 0x43,.flags = 0,.buf = msg,.len = sizeof(msg) };\r\nif (philips_td1316_tuner_sleep(fe))\r\nreturn -EIO;\r\nif (fe->ops.i2c_gate_ctrl)\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\ni2c_transfer(&dev->i2c_adap, &analog_msg, 1);\r\nreturn 0;\r\n}\r\nstatic int philips_europa_demod_sleep(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nif (dev->original_demod_sleep)\r\ndev->original_demod_sleep(fe);\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nreturn 0;\r\n}\r\nstatic int tda8290_i2c_gate_ctrl( struct dvb_frontend* fe, int enable)\r\n{\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nu8 addr = state->config->i2c_gate;\r\nstatic u8 tda8290_close[] = { 0x21, 0xc0};\r\nstatic u8 tda8290_open[] = { 0x21, 0x80};\r\nstruct i2c_msg tda8290_msg = {.addr = addr,.flags = 0, .len = 2};\r\nif (enable) {\r\ntda8290_msg.buf = tda8290_close;\r\n} else {\r\ntda8290_msg.buf = tda8290_open;\r\n}\r\nif (i2c_transfer(state->i2c, &tda8290_msg, 1) != 1) {\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nwprintk("could not access tda8290 I2C gate\n");\r\nreturn -EIO;\r\n}\r\nmsleep(20);\r\nreturn 0;\r\n}\r\nstatic int philips_tda827x_tuner_init(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nswitch (state->config->antenna_switch) {\r\ncase 0: break;\r\ncase 1: dprintk("setting GPIO21 to 0 (TV antenna?)\n");\r\nsaa7134_set_gpio(dev, 21, 0);\r\nbreak;\r\ncase 2: dprintk("setting GPIO21 to 1 (Radio antenna?)\n");\r\nsaa7134_set_gpio(dev, 21, 1);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int philips_tda827x_tuner_sleep(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nstruct tda1004x_state *state = fe->demodulator_priv;\r\nswitch (state->config->antenna_switch) {\r\ncase 0: break;\r\ncase 1: dprintk("setting GPIO21 to 1 (Radio antenna?)\n");\r\nsaa7134_set_gpio(dev, 21, 1);\r\nbreak;\r\ncase 2: dprintk("setting GPIO21 to 0 (TV antenna?)\n");\r\nsaa7134_set_gpio(dev, 21, 0);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int configure_tda827x_fe(struct saa7134_dev *dev,\r\nstruct tda1004x_config *cdec_conf,\r\nstruct tda827x_config *tuner_conf)\r\n{\r\nstruct videobuf_dvb_frontend *fe0;\r\nfe0 = videobuf_dvb_get_frontend(&dev->frontends, 1);\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach, cdec_conf, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (cdec_conf->i2c_gate)\r\nfe0->dvb.frontend->ops.i2c_gate_ctrl = tda8290_i2c_gate_ctrl;\r\nif (dvb_attach(tda827x_attach, fe0->dvb.frontend,\r\ncdec_conf->tuner_address,\r\n&dev->i2c_adap, tuner_conf))\r\nreturn 0;\r\nwprintk("no tda827x tuner found at addr: %02x\n",\r\ncdec_conf->tuner_address);\r\n}\r\nreturn -EINVAL;\r\n}\r\nstatic int ads_duo_tuner_init(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nphilips_tda827x_tuner_init(fe);\r\nsaa7134_set_gpio(dev, 22, 1);\r\nreturn 0;\r\n}\r\nstatic int ads_duo_tuner_sleep(struct dvb_frontend *fe)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nsaa7134_set_gpio(dev, 22, 0);\r\nphilips_tda827x_tuner_sleep(fe);\r\nreturn 0;\r\n}\r\nstatic int md8800_set_voltage(struct dvb_frontend *fe, fe_sec_voltage_t voltage)\r\n{\r\nint res = -EIO;\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nif (fe->ops.i2c_gate_ctrl) {\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (dev->original_set_voltage)\r\nres = dev->original_set_voltage(fe, voltage);\r\nfe->ops.i2c_gate_ctrl(fe, 0);\r\n}\r\nreturn res;\r\n}\r\nstatic int md8800_set_high_voltage(struct dvb_frontend *fe, long arg)\r\n{\r\nint res = -EIO;\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nif (fe->ops.i2c_gate_ctrl) {\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (dev->original_set_high_voltage)\r\nres = dev->original_set_high_voltage(fe, arg);\r\nfe->ops.i2c_gate_ctrl(fe, 0);\r\n}\r\nreturn res;\r\n}\r\nstatic int md8800_set_voltage2(struct dvb_frontend *fe, fe_sec_voltage_t voltage)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nu8 wbuf[2] = { 0x1f, 00 };\r\nu8 rbuf;\r\nstruct i2c_msg msg[] = { { .addr = 0x08, .flags = 0, .buf = wbuf, .len = 1 },\r\n{ .addr = 0x08, .flags = I2C_M_RD, .buf = &rbuf, .len = 1 } };\r\nif (i2c_transfer(&dev->i2c_adap, msg, 2) != 2)\r\nreturn -EIO;\r\nif (voltage == SEC_VOLTAGE_18)\r\nwbuf[1] = rbuf | 0x10;\r\nelse\r\nwbuf[1] = rbuf & 0xef;\r\nmsg[0].len = 2;\r\ni2c_transfer(&dev->i2c_adap, msg, 1);\r\nreturn 0;\r\n}\r\nstatic int md8800_set_high_voltage2(struct dvb_frontend *fe, long arg)\r\n{\r\nstruct saa7134_dev *dev = fe->dvb->priv;\r\nwprintk("%s: sorry can't set high LNB supply voltage from here\n", __func__);\r\nreturn -EIO;\r\n}\r\nstatic int dvb_init(struct saa7134_dev *dev)\r\n{\r\nint ret;\r\nint attach_xc3028 = 0;\r\nstruct videobuf_dvb_frontend *fe0;\r\nmutex_init(&dev->frontends.lock);\r\nINIT_LIST_HEAD(&dev->frontends.felist);\r\nprintk(KERN_INFO "%s() allocating 1 frontend\n", __func__);\r\nfe0 = videobuf_dvb_alloc_frontend(&dev->frontends, 1);\r\nif (!fe0) {\r\nprintk(KERN_ERR "%s() failed to alloc\n", __func__);\r\nreturn -ENOMEM;\r\n}\r\ndev->ts.nr_bufs = 32;\r\ndev->ts.nr_packets = 32*4;\r\nfe0->dvb.name = dev->name;\r\nvideobuf_queue_sg_init(&fe0->dvb.dvbq, &saa7134_ts_qops,\r\n&dev->pci->dev, &dev->slock,\r\nV4L2_BUF_TYPE_VIDEO_CAPTURE,\r\nV4L2_FIELD_ALTERNATE,\r\nsizeof(struct saa7134_buf),\r\ndev, NULL);\r\nswitch (dev->board) {\r\ncase SAA7134_BOARD_PINNACLE_300I_DVBT_PAL:\r\ndprintk("pinnacle 300i dvb setup\n");\r\nfe0->dvb.frontend = dvb_attach(mt352_attach, &pinnacle_300i,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = mt352_pinnacle_tuner_set_params;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_777:\r\ncase SAA7134_BOARD_AVERMEDIA_A16AR:\r\ndprintk("avertv 777 dvb setup\n");\r\nfe0->dvb.frontend = dvb_attach(mt352_attach, &avermedia_777,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(simple_tuner_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x61,\r\nTUNER_PHILIPS_TD1316);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_A16D:\r\ndprintk("AverMedia A16D dvb setup\n");\r\nfe0->dvb.frontend = dvb_attach(mt352_attach,\r\n&avermedia_xc3028_mt352_dev,\r\n&dev->i2c_adap);\r\nattach_xc3028 = 1;\r\nbreak;\r\ncase SAA7134_BOARD_MD7134:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&medion_cardbus,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(simple_tuner_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, medion_cardbus.tuner_address,\r\nTUNER_PHILIPS_FMD1216ME_MK3);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_PHILIPS_TOUGH:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&philips_tu1216_60_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nfe0->dvb.frontend->ops.tuner_ops.init = philips_tu1216_init;\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = philips_tda6651_pll_set;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_FLYDVBTDUO:\r\ncase SAA7134_BOARD_FLYDVBT_DUO_CARDBUS:\r\nif (configure_tda827x_fe(dev, &tda827x_lifeview_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_PHILIPS_EUROPA:\r\ncase SAA7134_BOARD_VIDEOMATE_DVBT_300:\r\ncase SAA7134_BOARD_ASUS_EUROPA_HYBRID:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&philips_europa_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndev->original_demod_sleep = fe0->dvb.frontend->ops.sleep;\r\nfe0->dvb.frontend->ops.sleep = philips_europa_demod_sleep;\r\nfe0->dvb.frontend->ops.tuner_ops.init = philips_europa_tuner_init;\r\nfe0->dvb.frontend->ops.tuner_ops.sleep = philips_europa_tuner_sleep;\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = philips_td1316_tuner_set_params;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_TECHNOTREND_BUDGET_T3000:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&technotrend_budget_t3000_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndev->original_demod_sleep = fe0->dvb.frontend->ops.sleep;\r\nfe0->dvb.frontend->ops.sleep = philips_europa_demod_sleep;\r\nfe0->dvb.frontend->ops.tuner_ops.init = philips_europa_tuner_init;\r\nfe0->dvb.frontend->ops.tuner_ops.sleep = philips_europa_tuner_sleep;\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = philips_td1316_tuner_set_params;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_VIDEOMATE_DVBT_200:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&philips_tu1216_61_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nfe0->dvb.frontend->ops.tuner_ops.init = philips_tu1216_init;\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = philips_tda6651_pll_set;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_KWORLD_DVBT_210:\r\nif (configure_tda827x_fe(dev, &kworld_dvb_t_210_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_HAUPPAUGE_HVR1120:\r\nfe0->dvb.frontend = dvb_attach(tda10048_attach,\r\n&hcw_tda10048_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&hcw_tda18271_config);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_PHILIPS_TIGER:\r\nif (configure_tda827x_fe(dev, &philips_tiger_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_PINNACLE_PCTV_310i:\r\nif (configure_tda827x_fe(dev, &pinnacle_pctv_310i_config,\r\n&tda827x_cfg_1) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_HAUPPAUGE_HVR1110:\r\nif (configure_tda827x_fe(dev, &hauppauge_hvr_1110_config,\r\n&tda827x_cfg_1) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_HAUPPAUGE_HVR1150:\r\nfe0->dvb.frontend = dvb_attach(lgdt3305_attach,\r\n&hcw_lgdt3305_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&hcw_tda18271_config);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_ASUSTeK_P7131_DUAL:\r\nif (configure_tda827x_fe(dev, &asus_p7131_dual_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_FLYDVBT_LR301:\r\nif (configure_tda827x_fe(dev, &tda827x_lifeview_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_FLYDVB_TRIO:\r\nif (!use_frontend) {\r\nif (configure_tda827x_fe(dev, &lifeview_trio_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\n} else {\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach, &flydvbs, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(tda826x_attach, fe0->dvb.frontend, 0x63,\r\n&dev->i2c_adap, 0) == NULL) {\r\nwprintk("%s: Lifeview Trio, No tda826x found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dvb_attach(isl6421_attach, fe0->dvb.frontend, &dev->i2c_adap,\r\n0x08, 0, 0) == NULL) {\r\nwprintk("%s: Lifeview Trio, No ISL6421 found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_ADS_DUO_CARDBUS_PTV331:\r\ncase SAA7134_BOARD_FLYDVBT_HYBRID_CARDBUS:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&ads_tech_duo_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(tda827x_attach,fe0->dvb.frontend,\r\nads_tech_duo_config.tuner_address, &dev->i2c_adap,\r\n&ads_duo_cfg) == NULL) {\r\nwprintk("no tda827x tuner found at addr: %02x\n",\r\nads_tech_duo_config.tuner_address);\r\ngoto dettach_frontend;\r\n}\r\n} else\r\nwprintk("failed to attach tda10046\n");\r\nbreak;\r\ncase SAA7134_BOARD_TEVION_DVBT_220RF:\r\nif (configure_tda827x_fe(dev, &tevion_dvbt220rf_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_MEDION_MD8800_QUADRO:\r\nif (!use_frontend) {\r\nif (configure_tda827x_fe(dev, &md8800_dvbt_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\n} else {\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach,\r\n&flydvbs, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nstruct dvb_frontend *fe = fe0->dvb.frontend;\r\nu8 dev_id = dev->eedata[2];\r\nu8 data = 0xc4;\r\nstruct i2c_msg msg = {.addr = 0x08, .flags = 0, .len = 1};\r\nif (dvb_attach(tda826x_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap, 0) == NULL) {\r\nwprintk("%s: Medion Quadro, no tda826x "\r\n"found !\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dev_id != 0x08) {\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (dvb_attach(isl6405_attach, fe,\r\n&dev->i2c_adap, 0x08, 0, 0) == NULL) {\r\nwprintk("%s: Medion Quadro, no ISL6405 "\r\n"found !\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dev_id == 0x07) {\r\nmsg.buf = &data;\r\ni2c_transfer(&dev->i2c_adap, &msg, 1);\r\n}\r\nfe->ops.i2c_gate_ctrl(fe, 0);\r\ndev->original_set_voltage = fe->ops.set_voltage;\r\nfe->ops.set_voltage = md8800_set_voltage;\r\ndev->original_set_high_voltage = fe->ops.enable_high_lnb_voltage;\r\nfe->ops.enable_high_lnb_voltage = md8800_set_high_voltage;\r\n} else {\r\nfe->ops.set_voltage = md8800_set_voltage2;\r\nfe->ops.enable_high_lnb_voltage = md8800_set_high_voltage2;\r\n}\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_AVERTVHD_A180:\r\nfe0->dvb.frontend = dvb_attach(nxt200x_attach, &avertvhda180,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend)\r\ndvb_attach(dvb_pll_attach, fe0->dvb.frontend, 0x61,\r\nNULL, DVB_PLL_TDHU2);\r\nbreak;\r\ncase SAA7134_BOARD_ADS_INSTANT_HDTV_PCI:\r\ncase SAA7134_BOARD_KWORLD_ATSC110:\r\nfe0->dvb.frontend = dvb_attach(nxt200x_attach, &kworldatsc110,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend)\r\ndvb_attach(simple_tuner_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x61,\r\nTUNER_PHILIPS_TUV1236D);\r\nbreak;\r\ncase SAA7134_BOARD_FLYDVBS_LR300:\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach, &flydvbs,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(tda826x_attach, fe0->dvb.frontend, 0x60,\r\n&dev->i2c_adap, 0) == NULL) {\r\nwprintk("%s: No tda826x found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dvb_attach(isl6421_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x08, 0, 0) == NULL) {\r\nwprintk("%s: No ISL6421 found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_ASUS_EUROPA2_HYBRID:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&medion_cardbus,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndev->original_demod_sleep = fe0->dvb.frontend->ops.sleep;\r\nfe0->dvb.frontend->ops.sleep = philips_europa_demod_sleep;\r\ndvb_attach(simple_tuner_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, medion_cardbus.tuner_address,\r\nTUNER_PHILIPS_FMD1216ME_MK3);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_VIDEOMATE_DVBT_200A:\r\nfe0->dvb.frontend = dvb_attach(tda10046_attach,\r\n&philips_europa_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nfe0->dvb.frontend->ops.tuner_ops.init = philips_td1316_tuner_init;\r\nfe0->dvb.frontend->ops.tuner_ops.set_params = philips_td1316_tuner_set_params;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_CINERGY_HT_PCMCIA:\r\nif (configure_tda827x_fe(dev, &cinergy_ht_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_CINERGY_HT_PCI:\r\nif (configure_tda827x_fe(dev, &cinergy_ht_pci_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_PHILIPS_TIGER_S:\r\nif (configure_tda827x_fe(dev, &philips_tiger_s_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_ASUS_P7131_4871:\r\nif (configure_tda827x_fe(dev, &asus_p7131_4871_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_ASUSTeK_P7131_HYBRID_LNA:\r\nif (configure_tda827x_fe(dev, &asus_p7131_hybrid_lna_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_SUPER_007:\r\nif (configure_tda827x_fe(dev, &avermedia_super_007_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_TWINHAN_DTV_DVB_3056:\r\nif (configure_tda827x_fe(dev, &twinhan_dtv_dvb_3056_config,\r\n&tda827x_cfg_2_sw42) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_PHILIPS_SNAKE:\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach, &flydvbs,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(tda826x_attach, fe0->dvb.frontend, 0x60,\r\n&dev->i2c_adap, 0) == NULL) {\r\nwprintk("%s: No tda826x found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dvb_attach(lnbp21_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0, 0) == NULL) {\r\nwprintk("%s: No lnbp21 found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_CREATIX_CTX953:\r\nif (configure_tda827x_fe(dev, &md8800_dvbt_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_MSI_TVANYWHERE_AD11:\r\nif (configure_tda827x_fe(dev, &philips_tiger_s_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_CARDBUS_506:\r\ndprintk("AverMedia E506R dvb setup\n");\r\nsaa7134_set_gpio(dev, 25, 0);\r\nmsleep(10);\r\nsaa7134_set_gpio(dev, 25, 1);\r\nfe0->dvb.frontend = dvb_attach(mt352_attach,\r\n&avermedia_xc3028_mt352_dev,\r\n&dev->i2c_adap);\r\nattach_xc3028 = 1;\r\nbreak;\r\ncase SAA7134_BOARD_MD7134_BRIDGE_2:\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach,\r\n&sd1878_4m, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nstruct dvb_frontend *fe;\r\nif (dvb_attach(dvb_pll_attach, fe0->dvb.frontend, 0x60,\r\n&dev->i2c_adap, DVB_PLL_PHILIPS_SD1878_TDA8261) == NULL) {\r\nwprintk("%s: MD7134 DVB-S, no SD1878 "\r\n"found !\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nfe = fe0->dvb.frontend;\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\nif (dvb_attach(isl6405_attach, fe,\r\n&dev->i2c_adap, 0x08, 0, 0) == NULL) {\r\nwprintk("%s: MD7134 DVB-S, no ISL6405 "\r\n"found !\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nfe->ops.i2c_gate_ctrl(fe, 0);\r\ndev->original_set_voltage = fe->ops.set_voltage;\r\nfe->ops.set_voltage = md8800_set_voltage;\r\ndev->original_set_high_voltage = fe->ops.enable_high_lnb_voltage;\r\nfe->ops.enable_high_lnb_voltage = md8800_set_high_voltage;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_M103:\r\nsaa7134_set_gpio(dev, 25, 0);\r\nmsleep(10);\r\nsaa7134_set_gpio(dev, 25, 1);\r\nfe0->dvb.frontend = dvb_attach(mt352_attach,\r\n&avermedia_xc3028_mt352_dev,\r\n&dev->i2c_adap);\r\nattach_xc3028 = 1;\r\nbreak;\r\ncase SAA7134_BOARD_ASUSTeK_TIGER_3IN1:\r\nif (!use_frontend) {\r\nif (configure_tda827x_fe(dev, &asus_tiger_3in1_config,\r\n&tda827x_cfg_2) < 0)\r\ngoto dettach_frontend;\r\n} else {\r\nfe0->dvb.frontend = dvb_attach(tda10086_attach,\r\n&flydvbs, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(tda826x_attach,\r\nfe0->dvb.frontend, 0x60,\r\n&dev->i2c_adap, 0) == NULL) {\r\nwprintk("%s: Asus Tiger 3in1, no "\r\n"tda826x found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\nif (dvb_attach(lnbp21_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0, 0) == NULL) {\r\nwprintk("%s: Asus Tiger 3in1, no lnbp21"\r\n" found!\n", __func__);\r\ngoto dettach_frontend;\r\n}\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_ASUSTeK_TIGER:\r\nif (configure_tda827x_fe(dev, &philips_tiger_config,\r\n&tda827x_cfg_0) < 0)\r\ngoto dettach_frontend;\r\nbreak;\r\ncase SAA7134_BOARD_BEHOLD_H6:\r\nfe0->dvb.frontend = dvb_attach(zl10353_attach,\r\n&behold_h6_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(simple_tuner_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x61,\r\nTUNER_PHILIPS_FMD1216MEX_MK3);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_BEHOLD_X7:\r\nfe0->dvb.frontend = dvb_attach(zl10353_attach,\r\n&behold_x7_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(xc5000_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, &behold_x7_tunerconfig);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_BEHOLD_H7:\r\nfe0->dvb.frontend = dvb_attach(zl10353_attach,\r\n&behold_x7_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\ndvb_attach(xc5000_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, &behold_x7_tunerconfig);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_AVERMEDIA_A700_PRO:\r\ncase SAA7134_BOARD_AVERMEDIA_A700_HYBRID:\r\nfe0->dvb.frontend = dvb_attach(mt312_attach,\r\n&avertv_a700_mt312, &dev->i2c_adap);\r\nif (fe0->dvb.frontend) {\r\nif (dvb_attach(zl10036_attach, fe0->dvb.frontend,\r\n&avertv_a700_tuner, &dev->i2c_adap) == NULL) {\r\nwprintk("%s: No zl10036 found!\n",\r\n__func__);\r\n}\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_VIDEOMATE_S350:\r\nfe0->dvb.frontend = dvb_attach(mt312_attach,\r\n&zl10313_compro_s350_config, &dev->i2c_adap);\r\nif (fe0->dvb.frontend)\r\nif (dvb_attach(zl10039_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap) == NULL)\r\nwprintk("%s: No zl10039 found!\n",\r\n__func__);\r\nbreak;\r\ncase SAA7134_BOARD_VIDEOMATE_T750:\r\nfe0->dvb.frontend = dvb_attach(zl10353_attach,\r\n&videomate_t750_zl10353_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\nif (dvb_attach(qt1010_attach,\r\nfe0->dvb.frontend,\r\n&dev->i2c_adap,\r\n&videomate_t750_qt1010_config) == NULL)\r\nwprintk("error attaching QT1010\n");\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_ZOLID_HYBRID_PCI:\r\nfe0->dvb.frontend = dvb_attach(tda10048_attach,\r\n&zolid_tda10048_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&zolid_tda18271_config);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_LEADTEK_WINFAST_DTV1000S:\r\nfe0->dvb.frontend = dvb_attach(tda10048_attach,\r\n&dtv1000s_tda10048_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&dtv1000s_tda18271_config);\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_KWORLD_PCI_SBTVD_FULLSEG:\r\nsaa7134_tuner_callback(dev, 0,\r\nTDA18271_CALLBACK_CMD_AGC_ENABLE, 1);\r\nfe0->dvb.frontend = dvb_attach(mb86a20s_attach,\r\n&kworld_mb86a20s_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&kworld_tda18271_config);\r\nfe0->dvb.frontend->ops.i2c_gate_ctrl = kworld_sbtvd_gate_ctrl;\r\n}\r\nbreak;\r\ncase SAA7134_BOARD_MAGICPRO_PROHDTV_PRO2:\r\nfe0->dvb.frontend = dvb_attach(lgs8gxx_attach,\r\n&prohdtv_pro2_lgs8g75_config,\r\n&dev->i2c_adap);\r\nif (fe0->dvb.frontend != NULL) {\r\ndvb_attach(tda829x_attach, fe0->dvb.frontend,\r\n&dev->i2c_adap, 0x4b,\r\n&tda829x_no_probe);\r\ndvb_attach(tda18271_attach, fe0->dvb.frontend,\r\n0x60, &dev->i2c_adap,\r\n&prohdtv_pro2_tda18271_config);\r\n}\r\nbreak;\r\ndefault:\r\nwprintk("Huh? unknown DVB card?\n");\r\nbreak;\r\n}\r\nif (attach_xc3028) {\r\nstruct dvb_frontend *fe;\r\nstruct xc2028_config cfg = {\r\n.i2c_adap = &dev->i2c_adap,\r\n.i2c_addr = 0x61,\r\n};\r\nif (!fe0->dvb.frontend)\r\ngoto dettach_frontend;\r\nfe = dvb_attach(xc2028_attach, fe0->dvb.frontend, &cfg);\r\nif (!fe) {\r\nprintk(KERN_ERR "%s/2: xc3028 attach failed\n",\r\ndev->name);\r\ngoto dettach_frontend;\r\n}\r\n}\r\nif (NULL == fe0->dvb.frontend) {\r\nprintk(KERN_ERR "%s/dvb: frontend initialization failed\n", dev->name);\r\ngoto dettach_frontend;\r\n}\r\nfe0->dvb.frontend->callback = saa7134_tuner_callback;\r\nret = videobuf_dvb_register_bus(&dev->frontends, THIS_MODULE, dev,\r\n&dev->pci->dev, adapter_nr, 0, NULL);\r\nif (!ret) {\r\nif (fe0->dvb.frontend->ops.init)\r\nfe0->dvb.frontend->ops.init(fe0->dvb.frontend);\r\nif (fe0->dvb.frontend->ops.sleep)\r\nfe0->dvb.frontend->ops.sleep(fe0->dvb.frontend);\r\nif (fe0->dvb.frontend->ops.tuner_ops.sleep)\r\nfe0->dvb.frontend->ops.tuner_ops.sleep(fe0->dvb.frontend);\r\n}\r\nreturn ret;\r\ndettach_frontend:\r\nvideobuf_dvb_dealloc_frontends(&dev->frontends);\r\nreturn -EINVAL;\r\n}\r\nstatic int dvb_fini(struct saa7134_dev *dev)\r\n{\r\nstruct videobuf_dvb_frontend *fe0;\r\nfe0 = videobuf_dvb_get_frontend(&dev->frontends, 1);\r\nif (!fe0)\r\nreturn -EINVAL;\r\nif (dev->board == SAA7134_BOARD_PINNACLE_300I_DVBT_PAL) {\r\nstruct v4l2_priv_tun_config tda9887_cfg;\r\nstatic int on = TDA9887_PRESENT | TDA9887_PORT2_INACTIVE;\r\ntda9887_cfg.tuner = TUNER_TDA9887;\r\ntda9887_cfg.priv = &on;\r\nsaa_call_all(dev, tuner, s_config, &tda9887_cfg);\r\n} else if (dev->board == SAA7134_BOARD_MEDION_MD8800_QUADRO) {\r\nif ((dev->eedata[2] == 0x07) && use_frontend) {\r\nu8 data = 0x80;\r\nstruct i2c_msg msg = {.addr = 0x08, .buf = &data, .flags = 0, .len = 1};\r\nstruct dvb_frontend *fe;\r\nfe = fe0->dvb.frontend;\r\nif (fe->ops.i2c_gate_ctrl) {\r\nfe->ops.i2c_gate_ctrl(fe, 1);\r\ni2c_transfer(&dev->i2c_adap, &msg, 1);\r\nfe->ops.i2c_gate_ctrl(fe, 0);\r\n}\r\n}\r\n}\r\nvideobuf_dvb_unregister_bus(&dev->frontends);\r\nreturn 0;\r\n}\r\nstatic int __init dvb_register(void)\r\n{\r\nreturn saa7134_ts_register(&dvb_ops);\r\n}\r\nstatic void __exit dvb_unregister(void)\r\n{\r\nsaa7134_ts_unregister(&dvb_ops);\r\n}
