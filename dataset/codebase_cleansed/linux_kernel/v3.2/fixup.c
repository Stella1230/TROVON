static void __devinit pci_fixup_video(struct pci_dev *pdev)\r\n{\r\nstruct pci_dev *bridge;\r\nstruct pci_bus *bus;\r\nu16 config;\r\nif ((strcmp(platform_name, "dig") != 0)\r\n&& (strcmp(platform_name, "hpzx1") != 0))\r\nreturn;\r\nif ((pdev->class >> 8) != PCI_CLASS_DISPLAY_VGA)\r\nreturn;\r\nbus = pdev->bus;\r\nwhile (bus) {\r\nbridge = bus->self;\r\nif (bridge\r\n&&((bridge->hdr_type == PCI_HEADER_TYPE_BRIDGE)\r\n||(bridge->hdr_type == PCI_HEADER_TYPE_CARDBUS))) {\r\npci_read_config_word(bridge, PCI_BRIDGE_CONTROL,\r\n&config);\r\nif (!(config & PCI_BRIDGE_CTL_VGA))\r\nreturn;\r\n}\r\nbus = bus->parent;\r\n}\r\npci_read_config_word(pdev, PCI_COMMAND, &config);\r\nif (config & (PCI_COMMAND_IO | PCI_COMMAND_MEMORY)) {\r\npdev->resource[PCI_ROM_RESOURCE].flags |= IORESOURCE_ROM_SHADOW;\r\ndev_printk(KERN_DEBUG, &pdev->dev, "Boot video device\n");\r\n}\r\n}
