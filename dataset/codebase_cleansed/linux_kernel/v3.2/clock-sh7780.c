static void master_clk_init(struct clk *clk)\r\n{\r\nclk->rate *= pfc_divisors[__raw_readl(FRQCR) & 0x0003];\r\n}\r\nstatic unsigned long module_clk_recalc(struct clk *clk)\r\n{\r\nint idx = (__raw_readl(FRQCR) & 0x0003);\r\nreturn clk->parent->rate / pfc_divisors[idx];\r\n}\r\nstatic unsigned long bus_clk_recalc(struct clk *clk)\r\n{\r\nint idx = ((__raw_readl(FRQCR) >> 16) & 0x0007);\r\nreturn clk->parent->rate / bfc_divisors[idx];\r\n}\r\nstatic unsigned long cpu_clk_recalc(struct clk *clk)\r\n{\r\nint idx = ((__raw_readl(FRQCR) >> 24) & 0x0001);\r\nreturn clk->parent->rate / ifc_divisors[idx];\r\n}\r\nvoid __init arch_init_clk_ops(struct clk_ops **ops, int idx)\r\n{\r\nif (idx < ARRAY_SIZE(sh7780_clk_ops))\r\n*ops = sh7780_clk_ops[idx];\r\n}\r\nstatic unsigned long shyway_clk_recalc(struct clk *clk)\r\n{\r\nint idx = ((__raw_readl(FRQCR) >> 20) & 0x0007);\r\nreturn clk->parent->rate / cfc_divisors[idx];\r\n}\r\nint __init arch_clk_init(void)\r\n{\r\nstruct clk *clk;\r\nint i, ret = 0;\r\ncpg_clk_init();\r\nclk = clk_get(NULL, "master_clk");\r\nfor (i = 0; i < ARRAY_SIZE(sh7780_onchip_clocks); i++) {\r\nstruct clk *clkp = sh7780_onchip_clocks[i];\r\nclkp->parent = clk;\r\nret |= clk_register(clkp);\r\n}\r\nclk_put(clk);\r\nclkdev_add_table(lookups, ARRAY_SIZE(lookups));\r\nreturn ret;\r\n}
