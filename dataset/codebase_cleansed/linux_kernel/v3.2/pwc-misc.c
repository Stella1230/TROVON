int pwc_decode_size(struct pwc_device *pdev, int width, int height)\r\n{\r\nint i, find;\r\nif (pdev->pixfmt != V4L2_PIX_FMT_YUV420)\r\n{\r\nif (width > pdev->abs_max.x || height > pdev->abs_max.y)\r\n{\r\nPWC_DEBUG_SIZE("VIDEO_PALETTE_RAW: going beyond abs_max.\n");\r\nreturn -1;\r\n}\r\n}\r\nelse\r\n{\r\nif (width > pdev->view_max.x || height > pdev->view_max.y)\r\n{\r\nPWC_DEBUG_SIZE("VIDEO_PALETTE_not RAW: going beyond view_max.\n");\r\nreturn -1;\r\n}\r\n}\r\nfind = -1;\r\nfor (i = 0; i < PSZ_MAX; i++) {\r\nif (pdev->image_mask & (1 << i)) {\r\nif (pwc_image_sizes[i].x <= width && pwc_image_sizes[i].y <= height)\r\nfind = i;\r\n}\r\n}\r\nreturn find;\r\n}\r\nvoid pwc_construct(struct pwc_device *pdev)\r\n{\r\nif (DEVICE_USE_CODEC1(pdev->type)) {\r\npdev->view_min.x = 128;\r\npdev->view_min.y = 96;\r\npdev->view_max.x = 352;\r\npdev->view_max.y = 288;\r\npdev->abs_max.x = 352;\r\npdev->abs_max.y = 288;\r\npdev->image_mask = 1 << PSZ_SQCIF | 1 << PSZ_QCIF | 1 << PSZ_CIF;\r\npdev->vcinterface = 2;\r\npdev->vendpoint = 4;\r\npdev->frame_header_size = 0;\r\npdev->frame_trailer_size = 0;\r\n} else if (DEVICE_USE_CODEC3(pdev->type)) {\r\npdev->view_min.x = 160;\r\npdev->view_min.y = 120;\r\npdev->view_max.x = 640;\r\npdev->view_max.y = 480;\r\npdev->image_mask = 1 << PSZ_QSIF | 1 << PSZ_SIF | 1 << PSZ_VGA;\r\npdev->abs_max.x = 640;\r\npdev->abs_max.y = 480;\r\npdev->vcinterface = 3;\r\npdev->vendpoint = 5;\r\npdev->frame_header_size = TOUCAM_HEADER_SIZE;\r\npdev->frame_trailer_size = TOUCAM_TRAILER_SIZE;\r\n} else {\r\npdev->view_min.x = 128;\r\npdev->view_min.y = 96;\r\npdev->view_max.x = 640;\r\npdev->view_max.y = 480;\r\npdev->image_mask = 1 << PSZ_SQCIF | 1 << PSZ_QSIF | 1 << PSZ_QCIF | 1 << PSZ_SIF | 1 << PSZ_CIF | 1 << PSZ_VGA;\r\npdev->abs_max.x = 640;\r\npdev->abs_max.y = 480;\r\npdev->vcinterface = 3;\r\npdev->vendpoint = 4;\r\npdev->frame_header_size = 0;\r\npdev->frame_trailer_size = 0;\r\n}\r\npdev->pixfmt = V4L2_PIX_FMT_YUV420;\r\npdev->view_min.size = pdev->view_min.x * pdev->view_min.y;\r\npdev->view_max.size = pdev->view_max.x * pdev->view_max.y;\r\n}
