unsigned long long sched_clock(void)\r\n{\r\nunsigned long long v = cnt32_to_63(readl(OST_OSCR));\r\nv = ((v & 0x7fffffffffffffffULL) * 2235) >> 5;\r\nreturn v;\r\n}\r\nstatic void puv3_cpu_pm_save(unsigned long *sleep_save)\r\n{\r\n}\r\nstatic void puv3_cpu_pm_restore(unsigned long *sleep_save)\r\n{\r\n}\r\nstatic int puv3_cpu_pm_prepare(void)\r\n{\r\nwritel(virt_to_phys(puv3_cpu_resume), PM_DIVCFG);\r\nreturn 0;\r\n}\r\nstatic void puv3_cpu_pm_enter(suspend_state_t state)\r\n{\r\nwritel(RESETC_RSSR_HWR | RESETC_RSSR_WDR\r\n| RESETC_RSSR_SMR | RESETC_RSSR_SWR, RESETC_RSSR);\r\nswitch (state) {\r\ncase PM_SUSPEND_MEM:\r\npuv3_cpu_pm_prepare();\r\npuv3_cpu_suspend(PM_PMCR_SFB);\r\nbreak;\r\n}\r\n}\r\nstatic int puv3_cpu_pm_valid(suspend_state_t state)\r\n{\r\nreturn state == PM_SUSPEND_MEM;\r\n}\r\nstatic void puv3_cpu_pm_finish(void)\r\n{\r\n}\r\nstatic void __init puv3_init_pm(void)\r\n{\r\npuv3_cpu_pm_fns = &puv3_cpu_pm_fnss;\r\n}\r\nstatic inline void puv3_init_pm(void) {}\r\nvoid puv3_ps2_init(void)\r\n{\r\nstruct clk *bclk32;\r\nbclk32 = clk_get(NULL, "BUS32_CLK");\r\nwritel(clk_get_rate(bclk32) / 200000, PS2_CNT);\r\n}\r\nvoid __init puv3_core_init(void)\r\n{\r\npuv3_init_pm();\r\npuv3_ps2_init();\r\nplatform_device_register_simple("PKUnity-v3-RTC", -1,\r\npuv3_rtc_resources, ARRAY_SIZE(puv3_rtc_resources));\r\nplatform_device_register_simple("PKUnity-v3-UMAL", -1,\r\npuv3_umal_resources, ARRAY_SIZE(puv3_umal_resources));\r\nplatform_device_register_simple("PKUnity-v3-MMC", -1,\r\npuv3_mmc_resources, ARRAY_SIZE(puv3_mmc_resources));\r\nplatform_device_register_simple("PKUnity-v3-UNIGFX", -1,\r\npuv3_unigfx_resources, ARRAY_SIZE(puv3_unigfx_resources));\r\nplatform_device_register_simple("PKUnity-v3-PWM", -1,\r\npuv3_pwm_resources, ARRAY_SIZE(puv3_pwm_resources));\r\nplatform_device_register_simple("PKUnity-v3-UART", 0,\r\npuv3_uart0_resources, ARRAY_SIZE(puv3_uart0_resources));\r\nplatform_device_register_simple("PKUnity-v3-UART", 1,\r\npuv3_uart1_resources, ARRAY_SIZE(puv3_uart1_resources));\r\nplatform_device_register_simple("PKUnity-v3-AC97", -1, NULL, 0);\r\nplatform_device_register_resndata(&platform_bus, "musb_hdrc", -1,\r\npuv3_usb_resources, ARRAY_SIZE(puv3_usb_resources),\r\n&puv3_usb_plat, sizeof(puv3_usb_plat));\r\n}
