void __cpuinit map_cpu_to_node(int cpu, int nid)\r\n{\r\nint oldnid;\r\nif (nid < 0) {\r\ncpu_to_node_map[cpu] = 0;\r\nreturn;\r\n}\r\noldnid = cpu_to_node_map[cpu];\r\nif (cpu_isset(cpu, node_to_cpu_mask[oldnid])) {\r\nreturn;\r\n}\r\nif (!node_online(nid))\r\nnid = first_online_node;\r\ncpu_to_node_map[cpu] = nid;\r\ncpu_set(cpu, node_to_cpu_mask[nid]);\r\nreturn;\r\n}\r\nvoid __cpuinit unmap_cpu_from_node(int cpu, int nid)\r\n{\r\nWARN_ON(!cpu_isset(cpu, node_to_cpu_mask[nid]));\r\nWARN_ON(cpu_to_node_map[cpu] != nid);\r\ncpu_to_node_map[cpu] = 0;\r\ncpu_clear(cpu, node_to_cpu_mask[nid]);\r\n}\r\nvoid __init build_cpu_to_node_map(void)\r\n{\r\nint cpu, i, node;\r\nfor(node=0; node < MAX_NUMNODES; node++)\r\ncpus_clear(node_to_cpu_mask[node]);\r\nfor_each_possible_early_cpu(cpu) {\r\nnode = -1;\r\nfor (i = 0; i < NR_CPUS; ++i)\r\nif (cpu_physical_id(cpu) == node_cpuid[i].phys_id) {\r\nnode = node_cpuid[i].nid;\r\nbreak;\r\n}\r\nmap_cpu_to_node(cpu, node);\r\n}\r\n}
