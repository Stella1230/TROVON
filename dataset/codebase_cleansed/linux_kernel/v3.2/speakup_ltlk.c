static void synth_interrogate(struct spk_synth *synth)\r\n{\r\nunsigned char *t, i;\r\nunsigned char buf[50], rom_v[20];\r\nspk_synth_immediate(synth, "\x18\x01?");\r\nfor (i = 0; i < 50; i++) {\r\nbuf[i] = spk_serial_in();\r\nif (i > 2 && buf[i] == 0x7f)\r\nbreak;\r\n}\r\nt = buf+2;\r\nfor (i = 0; *t != '\r'; t++) {\r\nrom_v[i] = *t;\r\nif (++i >= 19)\r\nbreak;\r\n}\r\nrom_v[i] = 0;\r\npr_info("%s: ROM version: %s\n", synth->long_name, rom_v);\r\n}\r\nstatic int synth_probe(struct spk_synth *synth)\r\n{\r\nint failed = 0;\r\nfailed = serial_synth_probe(synth);\r\nif (failed == 0)\r\nsynth_interrogate(synth);\r\nsynth->alive = !failed;\r\nreturn failed;\r\n}\r\nstatic int __init ltlk_init(void)\r\n{\r\nreturn synth_add(&synth_ltlk);\r\n}\r\nstatic void __exit ltlk_exit(void)\r\n{\r\nsynth_remove(&synth_ltlk);\r\n}
