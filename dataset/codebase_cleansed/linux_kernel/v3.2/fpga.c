static void __iomem *sdk7786_fpga_probe(void)\r\n{\r\nunsigned long area;\r\nvoid __iomem *base;\r\nfor (area = PA_AREA0; area < PA_AREA7; area += SZ_64M) {\r\nbase = ioremap_nocache(area + FPGA_REGS_OFFSET, FPGA_REGS_SIZE);\r\nif (!base) {\r\ncontinue;\r\n}\r\nif (ioread16(base + SRSTR) == SRSTR_MAGIC)\r\nreturn base;\r\niounmap(base);\r\n}\r\nreturn NULL;\r\n}\r\nvoid __init sdk7786_fpga_init(void)\r\n{\r\nu16 version, date;\r\nsdk7786_fpga_base = sdk7786_fpga_probe();\r\nif (unlikely(!sdk7786_fpga_base)) {\r\npanic("FPGA detection failed.\n");\r\nreturn;\r\n}\r\nversion = fpga_read_reg(FPGAVR);\r\ndate = fpga_read_reg(FPGADR);\r\npr_info("\tFPGA version:\t%d.%d (built on %d/%d/%d)\n",\r\nbcd2bin(version >> 8) & 0xf, bcd2bin(version & 0xf),\r\n((date >> 12) & 0xf) + 2000,\r\n(date >> 8) & 0xf, bcd2bin(date & 0xff));\r\n}
