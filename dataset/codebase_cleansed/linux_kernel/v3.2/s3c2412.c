static int s3c2412_serial_setsource(struct uart_port *port,\r\nstruct s3c24xx_uart_clksrc *clk)\r\n{\r\nunsigned long ucon = rd_regl(port, S3C2410_UCON);\r\nucon &= ~S3C2412_UCON_CLKMASK;\r\nif (strcmp(clk->name, "uclk") == 0)\r\nucon |= S3C2440_UCON_UCLK;\r\nelse if (strcmp(clk->name, "pclk") == 0)\r\nucon |= S3C2440_UCON_PCLK;\r\nelse if (strcmp(clk->name, "usysclk") == 0)\r\nucon |= S3C2412_UCON_USYSCLK;\r\nelse {\r\nprintk(KERN_ERR "unknown clock source %s\n", clk->name);\r\nreturn -EINVAL;\r\n}\r\nwr_regl(port, S3C2410_UCON, ucon);\r\nreturn 0;\r\n}\r\nstatic int s3c2412_serial_getsource(struct uart_port *port,\r\nstruct s3c24xx_uart_clksrc *clk)\r\n{\r\nunsigned long ucon = rd_regl(port, S3C2410_UCON);\r\nswitch (ucon & S3C2412_UCON_CLKMASK) {\r\ncase S3C2412_UCON_UCLK:\r\nclk->divisor = 1;\r\nclk->name = "uclk";\r\nbreak;\r\ncase S3C2412_UCON_PCLK:\r\ncase S3C2412_UCON_PCLK2:\r\nclk->divisor = 1;\r\nclk->name = "pclk";\r\nbreak;\r\ncase S3C2412_UCON_USYSCLK:\r\nclk->divisor = 1;\r\nclk->name = "usysclk";\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int s3c2412_serial_resetport(struct uart_port *port,\r\nstruct s3c2410_uartcfg *cfg)\r\n{\r\nunsigned long ucon = rd_regl(port, S3C2410_UCON);\r\ndbg("%s: port=%p (%08lx), cfg=%p\n",\r\n__func__, port, port->mapbase, cfg);\r\nucon &= S3C2412_UCON_CLKMASK;\r\nwr_regl(port, S3C2410_UCON, ucon | cfg->ucon);\r\nwr_regl(port, S3C2410_ULCON, cfg->ulcon);\r\nwr_regl(port, S3C2410_UFCON, cfg->ufcon | S3C2410_UFCON_RESETBOTH);\r\nwr_regl(port, S3C2410_UFCON, cfg->ufcon);\r\nreturn 0;\r\n}\r\nstatic int s3c2412_serial_probe(struct platform_device *dev)\r\n{\r\ndbg("s3c2440_serial_probe: dev=%p\n", dev);\r\nreturn s3c24xx_serial_probe(dev, &s3c2412_uart_inf);\r\n}\r\nstatic inline int s3c2412_serial_init(void)\r\n{\r\nreturn s3c24xx_serial_init(&s3c2412_serial_driver, &s3c2412_uart_inf);\r\n}\r\nstatic inline void s3c2412_serial_exit(void)\r\n{\r\nplatform_driver_unregister(&s3c2412_serial_driver);\r\n}
