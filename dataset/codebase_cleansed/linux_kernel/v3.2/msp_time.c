void __init plat_time_init(void)\r\n{\r\nchar *endp, *s;\r\nunsigned long cpu_rate = 0;\r\nif (cpu_rate == 0) {\r\ns = prom_getenv("clkfreqhz");\r\ncpu_rate = simple_strtoul(s, &endp, 10);\r\nif (endp != NULL && *endp != 0) {\r\nprintk(KERN_ERR\r\n"Clock rate in Hz parse error: %s\n", s);\r\ncpu_rate = 0;\r\n}\r\n}\r\nif (cpu_rate == 0) {\r\ns = prom_getenv("clkfreq");\r\ncpu_rate = 1000 * simple_strtoul(s, &endp, 10);\r\nif (endp != NULL && *endp != 0) {\r\nprintk(KERN_ERR\r\n"Clock rate in MHz parse error: %s\n", s);\r\ncpu_rate = 0;\r\n}\r\n}\r\nif (cpu_rate == 0) {\r\n#if defined(CONFIG_PMC_MSP7120_EVAL) \\r\n|| defined(CONFIG_PMC_MSP7120_GW)\r\ncpu_rate = 400000000;\r\n#elif defined(CONFIG_PMC_MSP7120_FPGA)\r\ncpu_rate = 25000000;\r\n#else\r\ncpu_rate = 150000000;\r\n#endif\r\nprintk(KERN_ERR\r\n"Failed to determine CPU clock rate, "\r\n"assuming %ld hz ...\n", cpu_rate);\r\n}\r\nprintk(KERN_WARNING "Clock rate set to %ld\n", cpu_rate);\r\nmips_hpt_frequency = cpu_rate/2;\r\n}\r\nunsigned int __cpuinit get_c0_compare_int(void)\r\n{\r\nif ((get_current_vpe()) && !tim_installed) {\r\nmemcpy(&timer_vpe1, &c0_compare_irqaction, sizeof(timer_vpe1));\r\nsetup_irq(MSP_INT_VPE1_TIMER, &timer_vpe1);\r\ntim_installed++;\r\n}\r\nreturn get_current_vpe() ? MSP_INT_VPE1_TIMER : MSP_INT_VPE0_TIMER;\r\n}
