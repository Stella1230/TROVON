static void crc32init_le(void)\r\n{\r\nunsigned i, j;\r\nuint32_t crc = 1;\r\ncrc32table_le[0][0] = 0;\r\nfor (i = 1 << (CRC_LE_BITS - 1); i; i >>= 1) {\r\ncrc = (crc >> 1) ^ ((crc & 1) ? CRCPOLY_LE : 0);\r\nfor (j = 0; j < LE_TABLE_SIZE; j += 2 * i)\r\ncrc32table_le[0][i + j] = crc ^ crc32table_le[0][j];\r\n}\r\nfor (i = 0; i < LE_TABLE_SIZE; i++) {\r\ncrc = crc32table_le[0][i];\r\nfor (j = 1; j < 4; j++) {\r\ncrc = crc32table_le[0][crc & 0xff] ^ (crc >> 8);\r\ncrc32table_le[j][i] = crc;\r\n}\r\n}\r\n}\r\nstatic void crc32init_be(void)\r\n{\r\nunsigned i, j;\r\nuint32_t crc = 0x80000000;\r\ncrc32table_be[0][0] = 0;\r\nfor (i = 1; i < BE_TABLE_SIZE; i <<= 1) {\r\ncrc = (crc << 1) ^ ((crc & 0x80000000) ? CRCPOLY_BE : 0);\r\nfor (j = 0; j < i; j++)\r\ncrc32table_be[0][i + j] = crc ^ crc32table_be[0][j];\r\n}\r\nfor (i = 0; i < BE_TABLE_SIZE; i++) {\r\ncrc = crc32table_be[0][i];\r\nfor (j = 1; j < 4; j++) {\r\ncrc = crc32table_be[0][(crc >> 24) & 0xff] ^ (crc << 8);\r\ncrc32table_be[j][i] = crc;\r\n}\r\n}\r\n}\r\nstatic void output_table(uint32_t table[4][256], int len, char *trans)\r\n{\r\nint i, j;\r\nfor (j = 0 ; j < 4; j++) {\r\nprintf("{");\r\nfor (i = 0; i < len - 1; i++) {\r\nif (i % ENTRIES_PER_LINE == 0)\r\nprintf("\n");\r\nprintf("%s(0x%8.8xL), ", trans, table[j][i]);\r\n}\r\nprintf("%s(0x%8.8xL)},\n", trans, table[j][len - 1]);\r\n}\r\n}\r\nint main(int argc, char** argv)\r\n{\r\nprintf("/* this file is generated - do not edit */\n\n");\r\nif (CRC_LE_BITS > 1) {\r\ncrc32init_le();\r\nprintf("static const u32 crc32table_le[4][256] = {");\r\noutput_table(crc32table_le, LE_TABLE_SIZE, "tole");\r\nprintf("};\n");\r\n}\r\nif (CRC_BE_BITS > 1) {\r\ncrc32init_be();\r\nprintf("static const u32 crc32table_be[4][256] = {");\r\noutput_table(crc32table_be, BE_TABLE_SIZE, "tobe");\r\nprintf("};\n");\r\n}\r\nreturn 0;\r\n}
