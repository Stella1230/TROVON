int s5p_mfc_init_pm(struct s5p_mfc_dev *dev)\r\n{\r\nint ret = 0;\r\npm = &dev->pm;\r\np_dev = dev;\r\npm->clock_gate = clk_get(&dev->plat_dev->dev, MFC_GATE_CLK_NAME);\r\nif (IS_ERR(pm->clock_gate)) {\r\nmfc_err("Failed to get clock-gating control\n");\r\nret = -ENOENT;\r\ngoto err_g_ip_clk;\r\n}\r\npm->clock = clk_get(&dev->plat_dev->dev, MFC_CLKNAME);\r\nif (IS_ERR(pm->clock)) {\r\nmfc_err("Failed to get MFC clock\n");\r\nret = -ENOENT;\r\ngoto err_g_ip_clk_2;\r\n}\r\natomic_set(&pm->power, 0);\r\n#ifdef CONFIG_PM_RUNTIME\r\npm->device = &dev->plat_dev->dev;\r\npm_runtime_enable(pm->device);\r\n#endif\r\n#ifdef CLK_DEBUG\r\natomic_set(&clk_ref, 0);\r\n#endif\r\nreturn 0;\r\nerr_g_ip_clk_2:\r\nclk_put(pm->clock_gate);\r\nerr_g_ip_clk:\r\nreturn ret;\r\n}\r\nvoid s5p_mfc_final_pm(struct s5p_mfc_dev *dev)\r\n{\r\nclk_put(pm->clock_gate);\r\nclk_put(pm->clock);\r\n#ifdef CONFIG_PM_RUNTIME\r\npm_runtime_disable(pm->device);\r\n#endif\r\n}\r\nint s5p_mfc_clock_on(void)\r\n{\r\nint ret;\r\n#ifdef CLK_DEBUG\r\natomic_inc(&clk_ref);\r\nmfc_debug(3, "+ %d", atomic_read(&clk_ref));\r\n#endif\r\nret = clk_enable(pm->clock_gate);\r\nreturn ret;\r\n}\r\nvoid s5p_mfc_clock_off(void)\r\n{\r\n#ifdef CLK_DEBUG\r\natomic_dec(&clk_ref);\r\nmfc_debug(3, "- %d", atomic_read(&clk_ref));\r\n#endif\r\nclk_disable(pm->clock_gate);\r\n}\r\nint s5p_mfc_power_on(void)\r\n{\r\n#ifdef CONFIG_PM_RUNTIME\r\nreturn pm_runtime_get_sync(pm->device);\r\n#else\r\natomic_set(&pm->power, 1);\r\nreturn 0;\r\n#endif\r\n}\r\nint s5p_mfc_power_off(void)\r\n{\r\n#ifdef CONFIG_PM_RUNTIME\r\nreturn pm_runtime_put_sync(pm->device);\r\n#else\r\natomic_set(&pm->power, 0);\r\nreturn 0;\r\n#endif\r\n}
