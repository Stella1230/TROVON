static int\r\ntitan_parse_c_misc(u64 c_misc, int print)\r\n{\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nchar *src;\r\nint nxs = 0;\r\n#endif\r\nint status = MCHK_DISPOSITION_REPORT;\r\n#define TITAN__CCHIP_MISC__NXM (1UL << 28)\r\n#define TITAN__CCHIP_MISC__NXS__S (29)\r\n#define TITAN__CCHIP_MISC__NXS__M (0x7)\r\nif (!(c_misc & TITAN__CCHIP_MISC__NXM))\r\nreturn MCHK_DISPOSITION_UNKNOWN_ERROR;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (!print)\r\nreturn status;\r\nnxs = EXTRACT(c_misc, TITAN__CCHIP_MISC__NXS);\r\nswitch(nxs) {\r\ncase 0:\r\ncase 1:\r\ncase 2:\r\ncase 3:\r\nsrc = "CPU";\r\nbreak;\r\ncase 4:\r\ncase 5:\r\nsrc = "Pchip";\r\nnxs -= 4;\r\nbreak;\r\ndefault:\r\nsrc = "Unknown, NXS =";\r\nbreak;\r\n}\r\nprintk("%s Non-existent memory access from: %s %d\n",\r\nerr_print_prefix, src, nxs);\r\n#endif\r\nreturn status;\r\n}\r\nstatic int\r\ntitan_parse_p_serror(int which, u64 serror, int print)\r\n{\r\nint status = MCHK_DISPOSITION_REPORT;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nstatic const char * const serror_src[] = {\r\n"GPCI", "APCI", "AGP HP", "AGP LP"\r\n};\r\nstatic const char * const serror_cmd[] = {\r\n"DMA Read", "DMA RMW", "SGTE Read", "Reserved"\r\n};\r\n#endif\r\n#define TITAN__PCHIP_SERROR__LOST_UECC (1UL << 0)\r\n#define TITAN__PCHIP_SERROR__UECC (1UL << 1)\r\n#define TITAN__PCHIP_SERROR__CRE (1UL << 2)\r\n#define TITAN__PCHIP_SERROR__NXIO (1UL << 3)\r\n#define TITAN__PCHIP_SERROR__LOST_CRE (1UL << 4)\r\n#define TITAN__PCHIP_SERROR__ECCMASK (TITAN__PCHIP_SERROR__UECC | \\r\nTITAN__PCHIP_SERROR__CRE)\r\n#define TITAN__PCHIP_SERROR__ERRMASK (TITAN__PCHIP_SERROR__LOST_UECC | \\r\nTITAN__PCHIP_SERROR__UECC | \\r\nTITAN__PCHIP_SERROR__CRE | \\r\nTITAN__PCHIP_SERROR__NXIO | \\r\nTITAN__PCHIP_SERROR__LOST_CRE)\r\n#define TITAN__PCHIP_SERROR__SRC__S (52)\r\n#define TITAN__PCHIP_SERROR__SRC__M (0x3)\r\n#define TITAN__PCHIP_SERROR__CMD__S (54)\r\n#define TITAN__PCHIP_SERROR__CMD__M (0x3)\r\n#define TITAN__PCHIP_SERROR__SYN__S (56)\r\n#define TITAN__PCHIP_SERROR__SYN__M (0xff)\r\n#define TITAN__PCHIP_SERROR__ADDR__S (15)\r\n#define TITAN__PCHIP_SERROR__ADDR__M (0xffffffffUL)\r\nif (!(serror & TITAN__PCHIP_SERROR__ERRMASK))\r\nreturn MCHK_DISPOSITION_UNKNOWN_ERROR;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (!print)\r\nreturn status;\r\nprintk("%s PChip %d SERROR: %016llx\n",\r\nerr_print_prefix, which, serror);\r\nif (serror & TITAN__PCHIP_SERROR__ECCMASK) {\r\nprintk("%s %sorrectable ECC Error:\n"\r\n" Source: %-6s Command: %-8s Syndrome: 0x%08x\n"\r\n" Address: 0x%llx\n",\r\nerr_print_prefix,\r\n(serror & TITAN__PCHIP_SERROR__UECC) ? "Unc" : "C",\r\nserror_src[EXTRACT(serror, TITAN__PCHIP_SERROR__SRC)],\r\nserror_cmd[EXTRACT(serror, TITAN__PCHIP_SERROR__CMD)],\r\n(unsigned)EXTRACT(serror, TITAN__PCHIP_SERROR__SYN),\r\nEXTRACT(serror, TITAN__PCHIP_SERROR__ADDR));\r\n}\r\nif (serror & TITAN__PCHIP_SERROR__NXIO)\r\nprintk("%s Non Existent I/O Error\n", err_print_prefix);\r\nif (serror & TITAN__PCHIP_SERROR__LOST_UECC)\r\nprintk("%s Lost Uncorrectable ECC Error\n",\r\nerr_print_prefix);\r\nif (serror & TITAN__PCHIP_SERROR__LOST_CRE)\r\nprintk("%s Lost Correctable ECC Error\n", err_print_prefix);\r\n#endif\r\nreturn status;\r\n}\r\nstatic int\r\ntitan_parse_p_perror(int which, int port, u64 perror, int print)\r\n{\r\nint cmd;\r\nunsigned long addr;\r\nint status = MCHK_DISPOSITION_REPORT;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nstatic const char * const perror_cmd[] = {\r\n"Interrupt Acknowledge", "Special Cycle",\r\n"I/O Read", "I/O Write",\r\n"Reserved", "Reserved",\r\n"Memory Read", "Memory Write",\r\n"Reserved", "Reserved",\r\n"Configuration Read", "Configuration Write",\r\n"Memory Read Multiple", "Dual Address Cycle",\r\n"Memory Read Line", "Memory Write and Invalidate"\r\n};\r\n#endif\r\n#define TITAN__PCHIP_PERROR__LOST (1UL << 0)\r\n#define TITAN__PCHIP_PERROR__SERR (1UL << 1)\r\n#define TITAN__PCHIP_PERROR__PERR (1UL << 2)\r\n#define TITAN__PCHIP_PERROR__DCRTO (1UL << 3)\r\n#define TITAN__PCHIP_PERROR__SGE (1UL << 4)\r\n#define TITAN__PCHIP_PERROR__APE (1UL << 5)\r\n#define TITAN__PCHIP_PERROR__TA (1UL << 6)\r\n#define TITAN__PCHIP_PERROR__DPE (1UL << 7)\r\n#define TITAN__PCHIP_PERROR__NDS (1UL << 8)\r\n#define TITAN__PCHIP_PERROR__IPTPR (1UL << 9)\r\n#define TITAN__PCHIP_PERROR__IPTPW (1UL << 10)\r\n#define TITAN__PCHIP_PERROR__ERRMASK (TITAN__PCHIP_PERROR__LOST | \\r\nTITAN__PCHIP_PERROR__SERR | \\r\nTITAN__PCHIP_PERROR__PERR | \\r\nTITAN__PCHIP_PERROR__DCRTO | \\r\nTITAN__PCHIP_PERROR__SGE | \\r\nTITAN__PCHIP_PERROR__APE | \\r\nTITAN__PCHIP_PERROR__TA | \\r\nTITAN__PCHIP_PERROR__DPE | \\r\nTITAN__PCHIP_PERROR__NDS | \\r\nTITAN__PCHIP_PERROR__IPTPR | \\r\nTITAN__PCHIP_PERROR__IPTPW)\r\n#define TITAN__PCHIP_PERROR__DAC (1UL << 47)\r\n#define TITAN__PCHIP_PERROR__MWIN (1UL << 48)\r\n#define TITAN__PCHIP_PERROR__CMD__S (52)\r\n#define TITAN__PCHIP_PERROR__CMD__M (0x0f)\r\n#define TITAN__PCHIP_PERROR__ADDR__S (14)\r\n#define TITAN__PCHIP_PERROR__ADDR__M (0x1fffffffful)\r\nif (!(perror & TITAN__PCHIP_PERROR__ERRMASK))\r\nreturn MCHK_DISPOSITION_UNKNOWN_ERROR;\r\ncmd = EXTRACT(perror, TITAN__PCHIP_PERROR__CMD);\r\naddr = EXTRACT(perror, TITAN__PCHIP_PERROR__ADDR) << 2;\r\nif (((perror & TITAN__PCHIP_PERROR__NDS) ||\r\n((perror & TITAN__PCHIP_PERROR__ERRMASK) ==\r\nTITAN__PCHIP_PERROR__LOST)) &&\r\n((((cmd & 0xE) == 2) && (addr < 0x1000)) ||\r\n(((cmd & 0xE) == 6) && (addr >= 0xA0000) && (addr < 0x100000)))) {\r\nstatus = MCHK_DISPOSITION_DISMISS;\r\n}\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (!print)\r\nreturn status;\r\nprintk("%s PChip %d %cPERROR: %016llx\n",\r\nerr_print_prefix, which,\r\nport ? 'A' : 'G', perror);\r\nif (perror & TITAN__PCHIP_PERROR__IPTPW)\r\nprintk("%s Invalid Peer-to-Peer Write\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__IPTPR)\r\nprintk("%s Invalid Peer-to-Peer Read\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__NDS)\r\nprintk("%s No DEVSEL as PCI Master [Master Abort]\n",\r\nerr_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__DPE)\r\nprintk("%s Data Parity Error\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__TA)\r\nprintk("%s Target Abort\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__APE)\r\nprintk("%s Address Parity Error\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__SGE)\r\nprintk("%s Scatter-Gather Error, Invalid PTE\n",\r\nerr_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__DCRTO)\r\nprintk("%s Delayed-Completion Retry Timeout\n",\r\nerr_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__PERR)\r\nprintk("%s PERR Asserted\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__SERR)\r\nprintk("%s SERR Asserted\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__LOST)\r\nprintk("%s Lost Error\n", err_print_prefix);\r\nprintk("%s Command: 0x%x - %s\n"\r\n" Address: 0x%lx\n",\r\nerr_print_prefix,\r\ncmd, perror_cmd[cmd],\r\naddr);\r\nif (perror & TITAN__PCHIP_PERROR__DAC)\r\nprintk("%s Dual Address Cycle\n", err_print_prefix);\r\nif (perror & TITAN__PCHIP_PERROR__MWIN)\r\nprintk("%s Hit in Monster Window\n", err_print_prefix);\r\n#endif\r\nreturn status;\r\n}\r\nstatic int\r\ntitan_parse_p_agperror(int which, u64 agperror, int print)\r\n{\r\nint status = MCHK_DISPOSITION_REPORT;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nint cmd, len;\r\nunsigned long addr;\r\nstatic const char * const agperror_cmd[] = {\r\n"Read (low-priority)", "Read (high-priority)",\r\n"Write (low-priority)", "Write (high-priority)",\r\n"Reserved", "Reserved",\r\n"Flush", "Fence"\r\n};\r\n#endif\r\n#define TITAN__PCHIP_AGPERROR__LOST (1UL << 0)\r\n#define TITAN__PCHIP_AGPERROR__LPQFULL (1UL << 1)\r\n#define TITAN__PCHIP_AGPERROR__HPQFULL (1UL << 2)\r\n#define TITAN__PCHIP_AGPERROR__RESCMD (1UL << 3)\r\n#define TITAN__PCHIP_AGPERROR__IPTE (1UL << 4)\r\n#define TITAN__PCHIP_AGPERROR__PTP (1UL << 5)\r\n#define TITAN__PCHIP_AGPERROR__NOWINDOW (1UL << 6)\r\n#define TITAN__PCHIP_AGPERROR__ERRMASK (TITAN__PCHIP_AGPERROR__LOST | \\r\nTITAN__PCHIP_AGPERROR__LPQFULL | \\r\nTITAN__PCHIP_AGPERROR__HPQFULL | \\r\nTITAN__PCHIP_AGPERROR__RESCMD | \\r\nTITAN__PCHIP_AGPERROR__IPTE | \\r\nTITAN__PCHIP_AGPERROR__PTP | \\r\nTITAN__PCHIP_AGPERROR__NOWINDOW)\r\n#define TITAN__PCHIP_AGPERROR__DAC (1UL << 48)\r\n#define TITAN__PCHIP_AGPERROR__MWIN (1UL << 49)\r\n#define TITAN__PCHIP_AGPERROR__FENCE (1UL << 59)\r\n#define TITAN__PCHIP_AGPERROR__CMD__S (50)\r\n#define TITAN__PCHIP_AGPERROR__CMD__M (0x07)\r\n#define TITAN__PCHIP_AGPERROR__ADDR__S (15)\r\n#define TITAN__PCHIP_AGPERROR__ADDR__M (0xffffffffUL)\r\n#define TITAN__PCHIP_AGPERROR__LEN__S (53)\r\n#define TITAN__PCHIP_AGPERROR__LEN__M (0x3f)\r\nif (!(agperror & TITAN__PCHIP_AGPERROR__ERRMASK))\r\nreturn MCHK_DISPOSITION_UNKNOWN_ERROR;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nif (!print)\r\nreturn status;\r\ncmd = EXTRACT(agperror, TITAN__PCHIP_AGPERROR__CMD);\r\naddr = EXTRACT(agperror, TITAN__PCHIP_AGPERROR__ADDR) << 3;\r\nlen = EXTRACT(agperror, TITAN__PCHIP_AGPERROR__LEN);\r\nprintk("%s PChip %d AGPERROR: %016llx\n", err_print_prefix,\r\nwhich, agperror);\r\nif (agperror & TITAN__PCHIP_AGPERROR__NOWINDOW)\r\nprintk("%s No Window\n", err_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__PTP)\r\nprintk("%s Peer-to-Peer set\n", err_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__IPTE)\r\nprintk("%s Invalid PTE\n", err_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__RESCMD)\r\nprintk("%s Reserved Command\n", err_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__HPQFULL)\r\nprintk("%s HP Transaction Received while Queue Full\n",\r\nerr_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__LPQFULL)\r\nprintk("%s LP Transaction Received while Queue Full\n",\r\nerr_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__LOST)\r\nprintk("%s Lost Error\n", err_print_prefix);\r\nprintk("%s Command: 0x%x - %s, %d Quadwords%s\n"\r\n" Address: 0x%lx\n",\r\nerr_print_prefix, cmd, agperror_cmd[cmd], len,\r\n(agperror & TITAN__PCHIP_AGPERROR__FENCE) ? ", FENCE" : "",\r\naddr);\r\nif (agperror & TITAN__PCHIP_AGPERROR__DAC)\r\nprintk("%s Dual Address Cycle\n", err_print_prefix);\r\nif (agperror & TITAN__PCHIP_AGPERROR__MWIN)\r\nprintk("%s Hit in Monster Window\n", err_print_prefix);\r\n#endif\r\nreturn status;\r\n}\r\nstatic int\r\ntitan_parse_p_chip(int which, u64 serror, u64 gperror,\r\nu64 aperror, u64 agperror, int print)\r\n{\r\nint status = MCHK_DISPOSITION_UNKNOWN_ERROR;\r\nstatus |= titan_parse_p_serror(which, serror, print);\r\nstatus |= titan_parse_p_perror(which, 0, gperror, print);\r\nstatus |= titan_parse_p_perror(which, 1, aperror, print);\r\nstatus |= titan_parse_p_agperror(which, agperror, print);\r\nreturn status;\r\n}\r\nint\r\ntitan_process_logout_frame(struct el_common *mchk_header, int print)\r\n{\r\nstruct el_TITAN_sysdata_mcheck *tmchk =\r\n(struct el_TITAN_sysdata_mcheck *)\r\n((unsigned long)mchk_header + mchk_header->sys_offset);\r\nint status = MCHK_DISPOSITION_UNKNOWN_ERROR;\r\nstatus |= titan_parse_c_misc(tmchk->c_misc, print);\r\nstatus |= titan_parse_p_chip(0, tmchk->p0_serror, tmchk->p0_gperror,\r\ntmchk->p0_aperror, tmchk->p0_agperror,\r\nprint);\r\nstatus |= titan_parse_p_chip(1, tmchk->p1_serror, tmchk->p1_gperror,\r\ntmchk->p1_aperror, tmchk->p1_agperror,\r\nprint);\r\nreturn status;\r\n}\r\nvoid\r\ntitan_machine_check(unsigned long vector, unsigned long la_ptr)\r\n{\r\nstruct el_common *mchk_header = (struct el_common *)la_ptr;\r\nstruct el_TITAN_sysdata_mcheck *tmchk =\r\n(struct el_TITAN_sysdata_mcheck *)\r\n((unsigned long)mchk_header + mchk_header->sys_offset);\r\nu64 irqmask;\r\n#define TITAN_MCHECK_INTERRUPT_MASK 0xF800000000000000UL\r\nmb();\r\ndraina();\r\nif ((vector != SCB_Q_SYSMCHK) && (vector != SCB_Q_SYSERR)) {\r\nev6_machine_check(vector, la_ptr);\r\nreturn;\r\n}\r\nif (titan_process_logout_frame(mchk_header, 0) !=\r\nMCHK_DISPOSITION_DISMISS) {\r\nchar *saved_err_prefix = err_print_prefix;\r\nerr_print_prefix = KERN_CRIT;\r\nprintk("%s"\r\n"*System %s Error (Vector 0x%x) reported on CPU %d:\n",\r\nerr_print_prefix,\r\n(vector == SCB_Q_SYSERR)?"Correctable":"Uncorrectable",\r\n(unsigned int)vector, (int)smp_processor_id());\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\ntitan_process_logout_frame(mchk_header, alpha_verbose_mcheck);\r\nif (alpha_verbose_mcheck)\r\ndik_show_regs(get_irq_regs(), NULL);\r\n#endif\r\nerr_print_prefix = saved_err_prefix;\r\nirqmask = tmchk->c_dirx & TITAN_MCHECK_INTERRUPT_MASK;\r\ntitan_dispatch_irqs(irqmask);\r\n}\r\nwrmces(0x7);\r\nmb();\r\n}\r\nstatic struct el_subpacket *\r\nel_process_regatta_subpacket(struct el_subpacket *header)\r\n{\r\nif (header->class != EL_CLASS__REGATTA_FAMILY) {\r\nprintk("%s ** Unexpected header CLASS %d TYPE %d, aborting\n",\r\nerr_print_prefix,\r\nheader->class, header->type);\r\nreturn NULL;\r\n}\r\nswitch(header->type) {\r\ncase EL_TYPE__REGATTA__PROCESSOR_ERROR_FRAME:\r\ncase EL_TYPE__REGATTA__SYSTEM_ERROR_FRAME:\r\ncase EL_TYPE__REGATTA__ENVIRONMENTAL_FRAME:\r\ncase EL_TYPE__REGATTA__PROCESSOR_DBL_ERROR_HALT:\r\ncase EL_TYPE__REGATTA__SYSTEM_DBL_ERROR_HALT:\r\nprintk("%s ** Occurred on CPU %d:\n",\r\nerr_print_prefix,\r\n(int)header->by_type.regatta_frame.cpuid);\r\nprivateer_process_logout_frame((struct el_common *)\r\nheader->by_type.regatta_frame.data_start, 1);\r\nbreak;\r\ndefault:\r\nprintk("%s ** REGATTA TYPE %d SUBPACKET\n",\r\nerr_print_prefix, header->type);\r\nel_annotate_subpacket(header);\r\nbreak;\r\n}\r\nreturn (struct el_subpacket *)((unsigned long)header + header->length);\r\n}\r\nvoid __init\r\ntitan_register_error_handlers(void)\r\n{\r\nsize_t i;\r\nfor (i = 0; i < ARRAY_SIZE (el_titan_annotations); i++)\r\ncdl_register_subpacket_annotation(&el_titan_annotations[i]);\r\ncdl_register_subpacket_handler(&titan_subpacket_handler);\r\nev6_register_error_handlers();\r\n}\r\nstatic int\r\nprivateer_process_680_frame(struct el_common *mchk_header, int print)\r\n{\r\nint status = MCHK_DISPOSITION_UNKNOWN_ERROR;\r\n#ifdef CONFIG_VERBOSE_MCHECK\r\nstruct el_PRIVATEER_envdata_mcheck *emchk =\r\n(struct el_PRIVATEER_envdata_mcheck *)\r\n((unsigned long)mchk_header + mchk_header->sys_offset);\r\nif (!print)\r\nreturn status;\r\nprintk("%s Summary Flags: %016llx\n"\r\n" CChip DIRx: %016llx\n"\r\n" System Management IR: %016llx\n"\r\n" CPU IR: %016llx\n"\r\n" Power Supply IR: %016llx\n"\r\n" LM78 Fault Status: %016llx\n"\r\n" System Doors: %016llx\n"\r\n" Temperature Warning: %016llx\n"\r\n" Fan Control: %016llx\n"\r\n" Fatal Power Down Code: %016llx\n",\r\nerr_print_prefix,\r\nemchk->summary,\r\nemchk->c_dirx,\r\nemchk->smir,\r\nemchk->cpuir,\r\nemchk->psir,\r\nemchk->fault,\r\nemchk->sys_doors,\r\nemchk->temp_warn,\r\nemchk->fan_ctrl,\r\nemchk->code);\r\n#endif\r\nreturn status;\r\n}\r\nint\r\nprivateer_process_logout_frame(struct el_common *mchk_header, int print)\r\n{\r\nstruct el_common_EV6_mcheck *ev6mchk =\r\n(struct el_common_EV6_mcheck *)mchk_header;\r\nint status = MCHK_DISPOSITION_UNKNOWN_ERROR;\r\n#define PRIVATEER_MCHK__CORR_ECC 0x86\r\n#define PRIVATEER_MCHK__DC_TAG_PERR 0x9E\r\n#define PRIVATEER_MCHK__PAL_BUGCHECK 0x8E\r\n#define PRIVATEER_MCHK__OS_BUGCHECK 0x90\r\n#define PRIVATEER_MCHK__PROC_HRD_ERR 0x98\r\n#define PRIVATEER_MCHK__ISTREAM_CMOV_PRX 0xA0\r\n#define PRIVATEER_MCHK__ISTREAM_CMOV_FLT 0xA2\r\n#define PRIVATEER_MCHK__SYS_HRD_ERR 0x202\r\n#define PRIVATEER_MCHK__SYS_CORR_ERR 0x204\r\n#define PRIVATEER_MCHK__SYS_ENVIRON 0x206\r\nswitch(ev6mchk->MCHK_Code) {\r\ncase PRIVATEER_MCHK__CORR_ECC:\r\ncase PRIVATEER_MCHK__DC_TAG_PERR:\r\ncase PRIVATEER_MCHK__PAL_BUGCHECK:\r\ncase PRIVATEER_MCHK__OS_BUGCHECK:\r\ncase PRIVATEER_MCHK__PROC_HRD_ERR:\r\ncase PRIVATEER_MCHK__ISTREAM_CMOV_PRX:\r\ncase PRIVATEER_MCHK__ISTREAM_CMOV_FLT:\r\nstatus |= ev6_process_logout_frame(mchk_header, print);\r\nbreak;\r\ncase PRIVATEER_MCHK__SYS_CORR_ERR:\r\ncase PRIVATEER_MCHK__SYS_HRD_ERR:\r\nstatus |= titan_process_logout_frame(mchk_header, print);\r\nbreak;\r\ncase PRIVATEER_MCHK__SYS_ENVIRON:\r\nstatus |= privateer_process_680_frame(mchk_header, print);\r\nbreak;\r\ndefault:\r\nstatus |= MCHK_DISPOSITION_REPORT;\r\nif (print) {\r\nprintk("%s** Unknown Error, frame follows\n",\r\nerr_print_prefix);\r\nmchk_dump_logout_frame(mchk_header);\r\n}\r\n}\r\nreturn status;\r\n}\r\nvoid\r\nprivateer_machine_check(unsigned long vector, unsigned long la_ptr)\r\n{\r\nstruct el_common *mchk_header = (struct el_common *)la_ptr;\r\nstruct el_TITAN_sysdata_mcheck *tmchk =\r\n(struct el_TITAN_sysdata_mcheck *)\r\n(la_ptr + mchk_header->sys_offset);\r\nu64 irqmask;\r\nchar *saved_err_prefix = err_print_prefix;\r\n#define PRIVATEER_680_INTERRUPT_MASK (0xE00UL)\r\n#define PRIVATEER_HOTPLUG_INTERRUPT_MASK (0xE00UL)\r\nmb();\r\ndraina();\r\nif (vector != SCB_Q_SYSEVENT)\r\nreturn titan_machine_check(vector, la_ptr);\r\nerr_print_prefix = KERN_CRIT;\r\nprintk("%s*System Event (Vector 0x%x) reported on CPU %d:\n",\r\nerr_print_prefix,\r\n(unsigned int)vector, (int)smp_processor_id());\r\nprivateer_process_680_frame(mchk_header, 1);\r\nerr_print_prefix = saved_err_prefix;\r\nirqmask = tmchk->c_dirx & PRIVATEER_680_INTERRUPT_MASK;\r\ntitan_dispatch_irqs(irqmask);\r\nwrmces(0x7);\r\nmb();\r\n}
