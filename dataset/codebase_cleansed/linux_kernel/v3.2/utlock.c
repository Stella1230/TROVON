acpi_status acpi_ut_create_rw_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_status status;\r\nlock->num_readers = 0;\r\nstatus = acpi_os_create_mutex(&lock->reader_mutex);\r\nif (ACPI_FAILURE(status)) {\r\nreturn status;\r\n}\r\nstatus = acpi_os_create_mutex(&lock->writer_mutex);\r\nreturn status;\r\n}\r\nvoid acpi_ut_delete_rw_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_os_delete_mutex(lock->reader_mutex);\r\nacpi_os_delete_mutex(lock->writer_mutex);\r\nlock->num_readers = 0;\r\nlock->reader_mutex = NULL;\r\nlock->writer_mutex = NULL;\r\n}\r\nacpi_status acpi_ut_acquire_read_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_status status;\r\nstatus = acpi_os_acquire_mutex(lock->reader_mutex, ACPI_WAIT_FOREVER);\r\nif (ACPI_FAILURE(status)) {\r\nreturn status;\r\n}\r\nlock->num_readers++;\r\nif (lock->num_readers == 1) {\r\nstatus =\r\nacpi_os_acquire_mutex(lock->writer_mutex,\r\nACPI_WAIT_FOREVER);\r\n}\r\nacpi_os_release_mutex(lock->reader_mutex);\r\nreturn status;\r\n}\r\nacpi_status acpi_ut_release_read_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_status status;\r\nstatus = acpi_os_acquire_mutex(lock->reader_mutex, ACPI_WAIT_FOREVER);\r\nif (ACPI_FAILURE(status)) {\r\nreturn status;\r\n}\r\nlock->num_readers--;\r\nif (lock->num_readers == 0) {\r\nacpi_os_release_mutex(lock->writer_mutex);\r\n}\r\nacpi_os_release_mutex(lock->reader_mutex);\r\nreturn status;\r\n}\r\nacpi_status acpi_ut_acquire_write_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_status status;\r\nstatus = acpi_os_acquire_mutex(lock->writer_mutex, ACPI_WAIT_FOREVER);\r\nreturn status;\r\n}\r\nvoid acpi_ut_release_write_lock(struct acpi_rw_lock *lock)\r\n{\r\nacpi_os_release_mutex(lock->writer_mutex);\r\n}
