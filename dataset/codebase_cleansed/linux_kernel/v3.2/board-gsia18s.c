static void __init gsia18s_init_early(void)\r\n{\r\nstamp9g20_init_early();\r\nat91_register_uart(AT91SAM9260_ID_US0, 1,\r\nATMEL_UART_CTS | ATMEL_UART_RTS |\r\nATMEL_UART_DTR | ATMEL_UART_DSR |\r\nATMEL_UART_DCD | ATMEL_UART_RI);\r\nat91_register_uart(AT91SAM9260_ID_US1, 2,\r\nATMEL_UART_CTS | ATMEL_UART_RTS);\r\nat91_register_uart(AT91SAM9260_ID_US2, 3,\r\nATMEL_UART_CTS | ATMEL_UART_RTS);\r\nat91_register_uart(AT91SAM9260_ID_US3, 4, ATMEL_UART_RTS);\r\nat91_register_uart(AT91SAM9260_ID_US4, 5, 0);\r\n}\r\nstatic void __init gsia18s_leds_init(void)\r\n{\r\nplatform_device_register(&leds);\r\n}\r\nstatic void __init gsia18s_pcf_leds_init(void)\r\n{\r\nplatform_device_register(&pcf_leds1);\r\nplatform_device_register(&pcf_leds2);\r\nplatform_device_register(&pcf_leds3);\r\n}\r\nstatic void __init gsia18s_add_device_buttons(void)\r\n{\r\nat91_set_gpio_input(GPIO_TRIG_NET_IN, 1);\r\nat91_set_deglitch(GPIO_TRIG_NET_IN, 1);\r\nat91_set_gpio_input(GPIO_CARD_UNMOUNT_0, 1);\r\nat91_set_deglitch(GPIO_CARD_UNMOUNT_0, 1);\r\nat91_set_gpio_input(GPIO_CARD_UNMOUNT_1, 1);\r\nat91_set_deglitch(GPIO_CARD_UNMOUNT_1, 1);\r\nat91_set_gpio_input(GPIO_KEY_POWER, 0);\r\nat91_set_deglitch(GPIO_KEY_POWER, 1);\r\nplatform_device_register(&button_device);\r\n}\r\nstatic int pcf8574x_0x20_setup(struct i2c_client *client, int gpio,\r\nunsigned int ngpio, void *context)\r\n{\r\nint status;\r\nstatus = gpio_request(gpio + PCF_GPIO_ETH_DETECT, "eth_det");\r\nif (status < 0) {\r\npr_err("error: can't request GPIO%d\n",\r\ngpio + PCF_GPIO_ETH_DETECT);\r\nreturn status;\r\n}\r\nstatus = gpio_direction_input(gpio + PCF_GPIO_ETH_DETECT);\r\nif (status < 0) {\r\npr_err("error: can't setup GPIO%d as input\n",\r\ngpio + PCF_GPIO_ETH_DETECT);\r\nreturn status;\r\n}\r\nstatus = gpio_export(gpio + PCF_GPIO_ETH_DETECT, false);\r\nif (status < 0) {\r\npr_err("error: can't export GPIO%d\n",\r\ngpio + PCF_GPIO_ETH_DETECT);\r\nreturn status;\r\n}\r\nstatus = gpio_sysfs_set_active_low(gpio + PCF_GPIO_ETH_DETECT, 1);\r\nif (status < 0) {\r\npr_err("error: gpio_sysfs_set active_low(GPIO%d, 1)\n",\r\ngpio + PCF_GPIO_ETH_DETECT);\r\nreturn status;\r\n}\r\nreturn 0;\r\n}\r\nstatic int pcf8574x_0x20_teardown(struct i2c_client *client, int gpio,\r\nunsigned ngpio, void *context)\r\n{\r\ngpio_free(gpio + PCF_GPIO_ETH_DETECT);\r\nreturn 0;\r\n}\r\nstatic void gsia18s_power_off(void)\r\n{\r\npr_notice("Power supply will be switched off automatically now or after 60 seconds without ArmDAS.\n");\r\nat91_set_gpio_output(AT91_PIN_PA25, 1);\r\nwhile (1)\r\n;\r\n}\r\nstatic int __init gsia18s_power_off_init(void)\r\n{\r\npm_power_off = gsia18s_power_off;\r\nreturn 0;\r\n}\r\nstatic void __init gsia18s_board_init(void)\r\n{\r\nstamp9g20_board_init();\r\nat91_add_device_usbh(&usbh_data);\r\nat91_add_device_udc(&udc_data);\r\nat91_add_device_eth(&macb_data);\r\ngsia18s_leds_init();\r\ngsia18s_pcf_leds_init();\r\ngsia18s_add_device_buttons();\r\nat91_add_device_i2c(gsia18s_i2c_devices,\r\nARRAY_SIZE(gsia18s_i2c_devices));\r\nat91_add_device_cf(&gsia18s_cf1_data);\r\nat91_add_device_spi(gsia18s_spi_devices,\r\nARRAY_SIZE(gsia18s_spi_devices));\r\ngsia18s_power_off_init();\r\n}
