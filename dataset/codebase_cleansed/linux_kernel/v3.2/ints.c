static void intc_irq_unmask(struct irq_data *d)\r\n{\r\npquicc->intr_cimr |= (1 << d->irq);\r\n}\r\nstatic void intc_irq_mask(struct irq_data *d)\r\n{\r\npquicc->intr_cimr &= ~(1 << d->irq);\r\n}\r\nstatic void intc_irq_ack(struct irq_data *d)\r\n{\r\npquicc->intr_cisr = (1 << d->irq);\r\n}\r\nvoid __init trap_init(void)\r\n{\r\nint vba = (CPM_VECTOR_BASE<<4);\r\n_ramvec[2] = buserr;\r\n_ramvec[3] = trap;\r\n_ramvec[4] = trap;\r\n_ramvec[5] = trap;\r\n_ramvec[6] = trap;\r\n_ramvec[7] = trap;\r\n_ramvec[8] = trap;\r\n_ramvec[9] = trap;\r\n_ramvec[10] = trap;\r\n_ramvec[11] = trap;\r\n_ramvec[12] = trap;\r\n_ramvec[13] = trap;\r\n_ramvec[14] = trap;\r\n_ramvec[15] = trap;\r\n_ramvec[32] = system_call;\r\n_ramvec[33] = trap;\r\ncpm_interrupt_init();\r\npquicc->intr_cicr = 0x00e49f00 | vba;\r\n_ramvec[vba+CPMVEC_ERROR] = bad_interrupt;\r\n_ramvec[vba+CPMVEC_PIO_PC11] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC10] = inthandler;\r\n_ramvec[vba+CPMVEC_SMC2] = inthandler;\r\n_ramvec[vba+CPMVEC_SMC1] = inthandler;\r\n_ramvec[vba+CPMVEC_SPI] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC9] = inthandler;\r\n_ramvec[vba+CPMVEC_TIMER4] = inthandler;\r\n_ramvec[vba+CPMVEC_RESERVED1] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC8] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC7] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC6] = inthandler;\r\n_ramvec[vba+CPMVEC_TIMER3] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC5] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC4] = inthandler;\r\n_ramvec[vba+CPMVEC_RESERVED2] = inthandler;\r\n_ramvec[vba+CPMVEC_RISCTIMER] = inthandler;\r\n_ramvec[vba+CPMVEC_TIMER2] = inthandler;\r\n_ramvec[vba+CPMVEC_RESERVED3] = inthandler;\r\n_ramvec[vba+CPMVEC_IDMA2] = inthandler;\r\n_ramvec[vba+CPMVEC_IDMA1] = inthandler;\r\n_ramvec[vba+CPMVEC_SDMA_CB_ERR] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC3] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC2] = inthandler;\r\n_ramvec[vba+CPMVEC_TIMER1] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC1] = inthandler;\r\n_ramvec[vba+CPMVEC_SCC4] = inthandler;\r\n_ramvec[vba+CPMVEC_SCC3] = inthandler;\r\n_ramvec[vba+CPMVEC_SCC2] = inthandler;\r\n_ramvec[vba+CPMVEC_SCC1] = inthandler;\r\n_ramvec[vba+CPMVEC_PIO_PC0] = inthandler;\r\npquicc->intr_cimr = 0x00000000;\r\n}\r\nvoid init_IRQ(void)\r\n{\r\nint i;\r\nfor (i = 0; (i < NR_IRQS); i++) {\r\nirq_set_chip(i, &intc_irq_chip);\r\nirq_set_handler(i, handle_level_irq);\r\n}\r\n}
