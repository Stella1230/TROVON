void hw_cursor_enable(struct lynx_cursor *cursor)\r\n{\r\nu32 reg;\r\nreg = FIELD_VALUE(0, HWC_ADDRESS, ADDRESS, cursor->offset)|\r\nFIELD_SET(0, HWC_ADDRESS, EXT, LOCAL)|\r\nFIELD_SET(0, HWC_ADDRESS, ENABLE, ENABLE);\r\nPOKE32(HWC_ADDRESS, reg);\r\n}\r\nvoid hw_cursor_disable(struct lynx_cursor *cursor)\r\n{\r\nPOKE32(HWC_ADDRESS, 0);\r\n}\r\nvoid hw_cursor_setSize(struct lynx_cursor *cursor,\r\nint w, int h)\r\n{\r\ncursor->w = w;\r\ncursor->h = h;\r\n}\r\nvoid hw_cursor_setPos(struct lynx_cursor *cursor,\r\nint x, int y)\r\n{\r\nu32 reg;\r\nreg = FIELD_VALUE(0, HWC_LOCATION, Y, y)|\r\nFIELD_VALUE(0, HWC_LOCATION, X, x);\r\nPOKE32(HWC_LOCATION, reg);\r\n}\r\nvoid hw_cursor_setColor(struct lynx_cursor *cursor,\r\nu32 fg, u32 bg)\r\n{\r\nPOKE32(HWC_COLOR_12, (fg<<16)|(bg&0xffff));\r\nPOKE32(HWC_COLOR_3, 0xffe0);\r\n}\r\nvoid hw_cursor_setData(struct lynx_cursor *cursor,\r\nu16 rop, const u8 *pcol, const u8 *pmsk)\r\n{\r\nint i, j, count, pitch, offset;\r\nu8 color, mask, opr;\r\nu16 data;\r\nvoid __iomem *pbuffer, *pstart;\r\npitch = cursor->w >> 3;\r\ncount = pitch * cursor->h;\r\noffset = cursor->maxW * 2 / 8;\r\ndata = 0;\r\npstart = cursor->vstart;\r\npbuffer = pstart;\r\nfor (i = 0; i < count; i++) {\r\ncolor = *pcol++;\r\nmask = *pmsk++;\r\ndata = 0;\r\nfor (j = 0; j < 8; j++) {\r\nif (mask & (0x80>>j)) {\r\nif (rop == ROP_XOR)\r\nopr = mask ^ color;\r\nelse\r\nopr = mask & color;\r\ndata |= ((opr & (0x80>>j))?2:1)<<(j*2);\r\n}\r\n}\r\niowrite16(data, pbuffer);\r\nif ((i+1) % pitch == 0)\r\n{\r\npstart += offset;\r\npbuffer = pstart;\r\n} else {\r\npbuffer += sizeof(u16);\r\n}\r\n}\r\n}\r\nvoid hw_cursor_setData2(struct lynx_cursor *cursor,\r\nu16 rop, const u8 *pcol, const u8 *pmsk)\r\n{\r\nint i, j, count, pitch, offset;\r\nu8 color, mask;\r\nu16 data;\r\nvoid __iomem *pbuffer, *pstart;\r\npitch = cursor->w >> 3;\r\ncount = pitch * cursor->h;\r\noffset = cursor->maxW * 2 / 8;\r\ndata = 0;\r\npstart = cursor->vstart;\r\npbuffer = pstart;\r\nfor (i = 0; i < count; i++) {\r\ncolor = *pcol++;\r\nmask = *pmsk++;\r\ndata = 0;\r\nfor (j = 0; j < 8; j++) {\r\nif (mask & (1<<j))\r\ndata |= ((color & (1<<j))?1:2)<<(j*2);\r\n}\r\niowrite16(data, pbuffer);\r\nif (!(i&(pitch-1))) {\r\npstart += offset;\r\npbuffer = pstart;\r\n} else {\r\npbuffer += sizeof(u16);\r\n}\r\n}\r\n}
