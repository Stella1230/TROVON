int __init pcibios_map_platform_irq(const struct pci_dev *, u8 slot, u8 pin)\r\n{\r\nswitch (slot) {\r\ncase 0: return evt2irq(0x3a0);\r\ncase 1: return evt2irq(0x3a0);\r\ncase 2: return -1;\r\ncase 3: return -1;\r\ncase 4: return -1;\r\ndefault:\r\nprintk("PCI: Bad IRQ mapping request for slot %d\n", slot);\r\nreturn -1;\r\n}\r\n}\r\nint pci_fixup_pcic(struct pci_channel *chan)\r\n{\r\nunsigned long bcr1, wcr1, wcr2, wcr3, mcr;\r\nunsigned short bcr2;\r\nbcr1 = (*(volatile unsigned long*)(SH7751_BCR1));\r\nbcr2 = (*(volatile unsigned short*)(SH7751_BCR2));\r\nwcr1 = (*(volatile unsigned long*)(SH7751_WCR1));\r\nwcr2 = (*(volatile unsigned long*)(SH7751_WCR2));\r\nwcr3 = (*(volatile unsigned long*)(SH7751_WCR3));\r\nmcr = (*(volatile unsigned long*)(SH7751_MCR));\r\nbcr1 = bcr1 | 0x00080000;\r\n(*(volatile unsigned long*)(SH7751_BCR1)) = bcr1;\r\nbcr1 = bcr1 | 0x40080000;\r\nPCIC_WRITE(SH7751_PCIBCR1, bcr1);\r\nPCIC_WRITE(SH7751_PCIBCR2, bcr2);\r\nPCIC_WRITE(SH7751_PCIWCR1, wcr1);\r\nPCIC_WRITE(SH7751_PCIWCR2, wcr2);\r\nPCIC_WRITE(SH7751_PCIWCR3, wcr3);\r\nmcr = (mcr & PCIMCR_MRSET_OFF) & PCIMCR_RFSH_OFF;\r\nPCIC_WRITE(SH7751_PCIMCR, mcr);\r\nPCIC_WRITE(SH7751_PCIINTM, 0x0000c3ff);\r\nPCIC_WRITE(SH7751_PCIAINTM, 0x0000380f);\r\nPCIC_WRITE(SH7751_PCICONF1, 0xF39000C7);\r\nPCIC_WRITE(SH7751_PCICONF2, 0x00000000);\r\nPCIC_WRITE(SH7751_PCICONF4, 0xab000001);\r\nPCIC_WRITE(SH7751_PCICONF5, 0x0c000000);\r\nPCIC_WRITE(SH7751_PCICONF6, 0xd0000000);\r\nPCIC_WRITE(SH7751_PCICONF11, 0x35051054);\r\nPCIC_WRITE(SH7751_PCILSR0, 0x03f00000);\r\nPCIC_WRITE(SH7751_PCILSR1, 0x00000000);\r\nPCIC_WRITE(SH7751_PCILAR0, 0x0c000000);\r\nPCIC_WRITE(SH7751_PCILAR1, 0x00000000);\r\nPCIC_WRITE(SH7751_PCICR, 0xa5000001);\r\nBUG_ON(chan->resources[1].start != SH7751_PCI_MEMORY_BASE);\r\nPCIC_WRITE(SH7751_PCIMBR, chan->resources[1].start);\r\nPCIC_WRITE(SH7751_PCIIOBR, (chan->resources[0].start & SH7751_PCIIOBR_MASK));\r\nprintk("SH7751 PCI: Finished initialization of the PCI controller\n");\r\nreturn 1;\r\n}
