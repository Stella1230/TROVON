int trace_event__init(struct trace_event *t)\r\n{\r\nstruct pevent *pevent = pevent_alloc();\r\nif (pevent) {\r\nt->plugin_list = traceevent_load_plugins(pevent);\r\nt->pevent = pevent;\r\n}\r\nreturn pevent ? 0 : -1;\r\n}\r\nstatic int trace_event__init2(void)\r\n{\r\nint be = traceevent_host_bigendian();\r\nstruct pevent *pevent;\r\nif (trace_event__init(&tevent))\r\nreturn -1;\r\npevent = tevent.pevent;\r\npevent_set_flag(pevent, PEVENT_NSEC_OUTPUT);\r\npevent_set_file_bigendian(pevent, be);\r\npevent_set_host_bigendian(pevent, be);\r\ntevent_initialized = true;\r\nreturn 0;\r\n}\r\nint trace_event__register_resolver(struct machine *machine,\r\npevent_func_resolver_t *func)\r\n{\r\nif (!tevent_initialized && trace_event__init2())\r\nreturn -1;\r\nreturn pevent_set_function_resolver(tevent.pevent, func, machine);\r\n}\r\nvoid trace_event__cleanup(struct trace_event *t)\r\n{\r\ntraceevent_unload_plugins(t->plugin_list, t->pevent);\r\npevent_free(t->pevent);\r\n}\r\nstatic struct event_format*\r\ntp_format(const char *sys, const char *name)\r\n{\r\nstruct pevent *pevent = tevent.pevent;\r\nstruct event_format *event = NULL;\r\nchar path[PATH_MAX];\r\nsize_t size;\r\nchar *data;\r\nint err;\r\nscnprintf(path, PATH_MAX, "%s/%s/%s/format",\r\ntracing_events_path, sys, name);\r\nerr = filename__read_str(path, &data, &size);\r\nif (err)\r\nreturn ERR_PTR(err);\r\npevent_parse_format(pevent, &event, data, size, sys);\r\nfree(data);\r\nreturn event;\r\n}\r\nstruct event_format*\r\ntrace_event__tp_format(const char *sys, const char *name)\r\n{\r\nif (!tevent_initialized && trace_event__init2())\r\nreturn ERR_PTR(-ENOMEM);\r\nreturn tp_format(sys, name);\r\n}
