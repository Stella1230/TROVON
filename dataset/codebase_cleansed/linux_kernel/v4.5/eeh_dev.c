void *eeh_dev_init(struct pci_dn *pdn, void *data)\r\n{\r\nstruct pci_controller *phb = data;\r\nstruct eeh_dev *edev;\r\nedev = kzalloc(sizeof(*edev), GFP_KERNEL);\r\nif (!edev) {\r\npr_warn("%s: out of memory\n",\r\n__func__);\r\nreturn NULL;\r\n}\r\npdn->edev = edev;\r\nedev->pdn = pdn;\r\nedev->phb = phb;\r\nINIT_LIST_HEAD(&edev->list);\r\nreturn NULL;\r\n}\r\nvoid eeh_dev_phb_init_dynamic(struct pci_controller *phb)\r\n{\r\nstruct pci_dn *root = phb->pci_data;\r\neeh_phb_pe_create(phb);\r\neeh_dev_init(root, phb);\r\ntraverse_pci_dn(root, eeh_dev_init, phb);\r\n}\r\nstatic int __init eeh_dev_phb_init(void)\r\n{\r\nstruct pci_controller *phb, *tmp;\r\nlist_for_each_entry_safe(phb, tmp, &hose_list, list_node)\r\neeh_dev_phb_init_dynamic(phb);\r\npr_info("EEH: devices created\n");\r\nreturn 0;\r\n}
