static int rt5033_i2c_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct rt5033_dev *rt5033;\r\nunsigned int dev_id;\r\nint ret;\r\nrt5033 = devm_kzalloc(&i2c->dev, sizeof(*rt5033), GFP_KERNEL);\r\nif (!rt5033)\r\nreturn -ENOMEM;\r\ni2c_set_clientdata(i2c, rt5033);\r\nrt5033->dev = &i2c->dev;\r\nrt5033->irq = i2c->irq;\r\nrt5033->wakeup = true;\r\nrt5033->regmap = devm_regmap_init_i2c(i2c, &rt5033_regmap_config);\r\nif (IS_ERR(rt5033->regmap)) {\r\ndev_err(&i2c->dev, "Failed to allocate register map.\n");\r\nreturn PTR_ERR(rt5033->regmap);\r\n}\r\nret = regmap_read(rt5033->regmap, RT5033_REG_DEVICE_ID, &dev_id);\r\nif (ret) {\r\ndev_err(&i2c->dev, "Device not found\n");\r\nreturn -ENODEV;\r\n}\r\ndev_info(&i2c->dev, "Device found Device ID: %04x\n", dev_id);\r\nret = regmap_add_irq_chip(rt5033->regmap, rt5033->irq,\r\nIRQF_TRIGGER_FALLING | IRQF_ONESHOT,\r\n0, &rt5033_irq_chip, &rt5033->irq_data);\r\nif (ret) {\r\ndev_err(&i2c->dev, "Failed to request IRQ %d: %d\n",\r\nrt5033->irq, ret);\r\nreturn ret;\r\n}\r\nret = mfd_add_devices(rt5033->dev, -1, rt5033_devs,\r\nARRAY_SIZE(rt5033_devs), NULL, 0,\r\nregmap_irq_get_domain(rt5033->irq_data));\r\nif (ret < 0) {\r\ndev_err(&i2c->dev, "Failed to add RT5033 child devices.\n");\r\nreturn ret;\r\n}\r\ndevice_init_wakeup(rt5033->dev, rt5033->wakeup);\r\nreturn 0;\r\n}\r\nstatic int rt5033_i2c_remove(struct i2c_client *i2c)\r\n{\r\nmfd_remove_devices(&i2c->dev);\r\nreturn 0;\r\n}
