static void s3c_rtc_enable_clk(struct s3c_rtc *info)\r\n{\r\nunsigned long irq_flags;\r\nspin_lock_irqsave(&info->alarm_clk_lock, irq_flags);\r\nif (info->clk_disabled) {\r\nclk_enable(info->rtc_clk);\r\nif (info->data->needs_src_clk)\r\nclk_enable(info->rtc_src_clk);\r\ninfo->clk_disabled = false;\r\n}\r\nspin_unlock_irqrestore(&info->alarm_clk_lock, irq_flags);\r\n}\r\nstatic void s3c_rtc_disable_clk(struct s3c_rtc *info)\r\n{\r\nunsigned long irq_flags;\r\nspin_lock_irqsave(&info->alarm_clk_lock, irq_flags);\r\nif (!info->clk_disabled) {\r\nif (info->data->needs_src_clk)\r\nclk_disable(info->rtc_src_clk);\r\nclk_disable(info->rtc_clk);\r\ninfo->clk_disabled = true;\r\n}\r\nspin_unlock_irqrestore(&info->alarm_clk_lock, irq_flags);\r\n}\r\nstatic irqreturn_t s3c_rtc_tickirq(int irq, void *id)\r\n{\r\nstruct s3c_rtc *info = (struct s3c_rtc *)id;\r\nif (info->data->irq_handler)\r\ninfo->data->irq_handler(info, S3C2410_INTP_TIC);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic irqreturn_t s3c_rtc_alarmirq(int irq, void *id)\r\n{\r\nstruct s3c_rtc *info = (struct s3c_rtc *)id;\r\nif (info->data->irq_handler)\r\ninfo->data->irq_handler(info, S3C2410_INTP_ALM);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic int s3c_rtc_setaie(struct device *dev, unsigned int enabled)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nunsigned int tmp;\r\ndev_dbg(info->dev, "%s: aie=%d\n", __func__, enabled);\r\ns3c_rtc_enable_clk(info);\r\ntmp = readb(info->base + S3C2410_RTCALM) & ~S3C2410_RTCALM_ALMEN;\r\nif (enabled)\r\ntmp |= S3C2410_RTCALM_ALMEN;\r\nwriteb(tmp, info->base + S3C2410_RTCALM);\r\ns3c_rtc_disable_clk(info);\r\nif (enabled)\r\ns3c_rtc_enable_clk(info);\r\nelse\r\ns3c_rtc_disable_clk(info);\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_setfreq(struct s3c_rtc *info, int freq)\r\n{\r\nif (!is_power_of_2(freq))\r\nreturn -EINVAL;\r\nspin_lock_irq(&info->pie_lock);\r\nif (info->data->set_freq)\r\ninfo->data->set_freq(info, freq);\r\nspin_unlock_irq(&info->pie_lock);\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_gettime(struct device *dev, struct rtc_time *rtc_tm)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nunsigned int have_retried = 0;\r\ns3c_rtc_enable_clk(info);\r\nretry_get_time:\r\nrtc_tm->tm_min = readb(info->base + S3C2410_RTCMIN);\r\nrtc_tm->tm_hour = readb(info->base + S3C2410_RTCHOUR);\r\nrtc_tm->tm_mday = readb(info->base + S3C2410_RTCDATE);\r\nrtc_tm->tm_mon = readb(info->base + S3C2410_RTCMON);\r\nrtc_tm->tm_year = readb(info->base + S3C2410_RTCYEAR);\r\nrtc_tm->tm_sec = readb(info->base + S3C2410_RTCSEC);\r\nif (rtc_tm->tm_sec == 0 && !have_retried) {\r\nhave_retried = 1;\r\ngoto retry_get_time;\r\n}\r\nrtc_tm->tm_sec = bcd2bin(rtc_tm->tm_sec);\r\nrtc_tm->tm_min = bcd2bin(rtc_tm->tm_min);\r\nrtc_tm->tm_hour = bcd2bin(rtc_tm->tm_hour);\r\nrtc_tm->tm_mday = bcd2bin(rtc_tm->tm_mday);\r\nrtc_tm->tm_mon = bcd2bin(rtc_tm->tm_mon);\r\nrtc_tm->tm_year = bcd2bin(rtc_tm->tm_year);\r\ns3c_rtc_disable_clk(info);\r\nrtc_tm->tm_year += 100;\r\ndev_dbg(dev, "read time %04d.%02d.%02d %02d:%02d:%02d\n",\r\n1900 + rtc_tm->tm_year, rtc_tm->tm_mon, rtc_tm->tm_mday,\r\nrtc_tm->tm_hour, rtc_tm->tm_min, rtc_tm->tm_sec);\r\nrtc_tm->tm_mon -= 1;\r\nreturn rtc_valid_tm(rtc_tm);\r\n}\r\nstatic int s3c_rtc_settime(struct device *dev, struct rtc_time *tm)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nint year = tm->tm_year - 100;\r\ndev_dbg(dev, "set time %04d.%02d.%02d %02d:%02d:%02d\n",\r\n1900 + tm->tm_year, tm->tm_mon, tm->tm_mday,\r\ntm->tm_hour, tm->tm_min, tm->tm_sec);\r\nif (year < 0 || year >= 100) {\r\ndev_err(dev, "rtc only supports 100 years\n");\r\nreturn -EINVAL;\r\n}\r\ns3c_rtc_enable_clk(info);\r\nwriteb(bin2bcd(tm->tm_sec), info->base + S3C2410_RTCSEC);\r\nwriteb(bin2bcd(tm->tm_min), info->base + S3C2410_RTCMIN);\r\nwriteb(bin2bcd(tm->tm_hour), info->base + S3C2410_RTCHOUR);\r\nwriteb(bin2bcd(tm->tm_mday), info->base + S3C2410_RTCDATE);\r\nwriteb(bin2bcd(tm->tm_mon + 1), info->base + S3C2410_RTCMON);\r\nwriteb(bin2bcd(year), info->base + S3C2410_RTCYEAR);\r\ns3c_rtc_disable_clk(info);\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_getalarm(struct device *dev, struct rtc_wkalrm *alrm)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nstruct rtc_time *alm_tm = &alrm->time;\r\nunsigned int alm_en;\r\ns3c_rtc_enable_clk(info);\r\nalm_tm->tm_sec = readb(info->base + S3C2410_ALMSEC);\r\nalm_tm->tm_min = readb(info->base + S3C2410_ALMMIN);\r\nalm_tm->tm_hour = readb(info->base + S3C2410_ALMHOUR);\r\nalm_tm->tm_mon = readb(info->base + S3C2410_ALMMON);\r\nalm_tm->tm_mday = readb(info->base + S3C2410_ALMDATE);\r\nalm_tm->tm_year = readb(info->base + S3C2410_ALMYEAR);\r\nalm_en = readb(info->base + S3C2410_RTCALM);\r\ns3c_rtc_disable_clk(info);\r\nalrm->enabled = (alm_en & S3C2410_RTCALM_ALMEN) ? 1 : 0;\r\ndev_dbg(dev, "read alarm %d, %04d.%02d.%02d %02d:%02d:%02d\n",\r\nalm_en,\r\n1900 + alm_tm->tm_year, alm_tm->tm_mon, alm_tm->tm_mday,\r\nalm_tm->tm_hour, alm_tm->tm_min, alm_tm->tm_sec);\r\nif (alm_en & S3C2410_RTCALM_SECEN)\r\nalm_tm->tm_sec = bcd2bin(alm_tm->tm_sec);\r\nelse\r\nalm_tm->tm_sec = -1;\r\nif (alm_en & S3C2410_RTCALM_MINEN)\r\nalm_tm->tm_min = bcd2bin(alm_tm->tm_min);\r\nelse\r\nalm_tm->tm_min = -1;\r\nif (alm_en & S3C2410_RTCALM_HOUREN)\r\nalm_tm->tm_hour = bcd2bin(alm_tm->tm_hour);\r\nelse\r\nalm_tm->tm_hour = -1;\r\nif (alm_en & S3C2410_RTCALM_DAYEN)\r\nalm_tm->tm_mday = bcd2bin(alm_tm->tm_mday);\r\nelse\r\nalm_tm->tm_mday = -1;\r\nif (alm_en & S3C2410_RTCALM_MONEN) {\r\nalm_tm->tm_mon = bcd2bin(alm_tm->tm_mon);\r\nalm_tm->tm_mon -= 1;\r\n} else {\r\nalm_tm->tm_mon = -1;\r\n}\r\nif (alm_en & S3C2410_RTCALM_YEAREN)\r\nalm_tm->tm_year = bcd2bin(alm_tm->tm_year);\r\nelse\r\nalm_tm->tm_year = -1;\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_setalarm(struct device *dev, struct rtc_wkalrm *alrm)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nstruct rtc_time *tm = &alrm->time;\r\nunsigned int alrm_en;\r\nint year = tm->tm_year - 100;\r\ndev_dbg(dev, "s3c_rtc_setalarm: %d, %04d.%02d.%02d %02d:%02d:%02d\n",\r\nalrm->enabled,\r\n1900 + tm->tm_year, tm->tm_mon + 1, tm->tm_mday,\r\ntm->tm_hour, tm->tm_min, tm->tm_sec);\r\ns3c_rtc_enable_clk(info);\r\nalrm_en = readb(info->base + S3C2410_RTCALM) & S3C2410_RTCALM_ALMEN;\r\nwriteb(0x00, info->base + S3C2410_RTCALM);\r\nif (tm->tm_sec < 60 && tm->tm_sec >= 0) {\r\nalrm_en |= S3C2410_RTCALM_SECEN;\r\nwriteb(bin2bcd(tm->tm_sec), info->base + S3C2410_ALMSEC);\r\n}\r\nif (tm->tm_min < 60 && tm->tm_min >= 0) {\r\nalrm_en |= S3C2410_RTCALM_MINEN;\r\nwriteb(bin2bcd(tm->tm_min), info->base + S3C2410_ALMMIN);\r\n}\r\nif (tm->tm_hour < 24 && tm->tm_hour >= 0) {\r\nalrm_en |= S3C2410_RTCALM_HOUREN;\r\nwriteb(bin2bcd(tm->tm_hour), info->base + S3C2410_ALMHOUR);\r\n}\r\nif (year < 100 && year >= 0) {\r\nalrm_en |= S3C2410_RTCALM_YEAREN;\r\nwriteb(bin2bcd(year), info->base + S3C2410_ALMYEAR);\r\n}\r\nif (tm->tm_mon < 12 && tm->tm_mon >= 0) {\r\nalrm_en |= S3C2410_RTCALM_MONEN;\r\nwriteb(bin2bcd(tm->tm_mon + 1), info->base + S3C2410_ALMMON);\r\n}\r\nif (tm->tm_mday <= 31 && tm->tm_mday >= 1) {\r\nalrm_en |= S3C2410_RTCALM_DAYEN;\r\nwriteb(bin2bcd(tm->tm_mday), info->base + S3C2410_ALMDATE);\r\n}\r\ndev_dbg(dev, "setting S3C2410_RTCALM to %08x\n", alrm_en);\r\nwriteb(alrm_en, info->base + S3C2410_RTCALM);\r\ns3c_rtc_disable_clk(info);\r\ns3c_rtc_setaie(dev, alrm->enabled);\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_proc(struct device *dev, struct seq_file *seq)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\ns3c_rtc_enable_clk(info);\r\nif (info->data->enable_tick)\r\ninfo->data->enable_tick(info, seq);\r\ns3c_rtc_disable_clk(info);\r\nreturn 0;\r\n}\r\nstatic void s3c24xx_rtc_enable(struct s3c_rtc *info)\r\n{\r\nunsigned int con, tmp;\r\ncon = readw(info->base + S3C2410_RTCCON);\r\nif ((con & S3C2410_RTCCON_RTCEN) == 0) {\r\ndev_info(info->dev, "rtc disabled, re-enabling\n");\r\ntmp = readw(info->base + S3C2410_RTCCON);\r\nwritew(tmp | S3C2410_RTCCON_RTCEN,\r\ninfo->base + S3C2410_RTCCON);\r\n}\r\nif (con & S3C2410_RTCCON_CNTSEL) {\r\ndev_info(info->dev, "removing RTCCON_CNTSEL\n");\r\ntmp = readw(info->base + S3C2410_RTCCON);\r\nwritew(tmp & ~S3C2410_RTCCON_CNTSEL,\r\ninfo->base + S3C2410_RTCCON);\r\n}\r\nif (con & S3C2410_RTCCON_CLKRST) {\r\ndev_info(info->dev, "removing RTCCON_CLKRST\n");\r\ntmp = readw(info->base + S3C2410_RTCCON);\r\nwritew(tmp & ~S3C2410_RTCCON_CLKRST,\r\ninfo->base + S3C2410_RTCCON);\r\n}\r\n}\r\nstatic void s3c24xx_rtc_disable(struct s3c_rtc *info)\r\n{\r\nunsigned int con;\r\ncon = readw(info->base + S3C2410_RTCCON);\r\ncon &= ~S3C2410_RTCCON_RTCEN;\r\nwritew(con, info->base + S3C2410_RTCCON);\r\ncon = readb(info->base + S3C2410_TICNT);\r\ncon &= ~S3C2410_TICNT_ENABLE;\r\nwriteb(con, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c6410_rtc_disable(struct s3c_rtc *info)\r\n{\r\nunsigned int con;\r\ncon = readw(info->base + S3C2410_RTCCON);\r\ncon &= ~S3C64XX_RTCCON_TICEN;\r\ncon &= ~S3C2410_RTCCON_RTCEN;\r\nwritew(con, info->base + S3C2410_RTCCON);\r\n}\r\nstatic int s3c_rtc_remove(struct platform_device *pdev)\r\n{\r\nstruct s3c_rtc *info = platform_get_drvdata(pdev);\r\ns3c_rtc_setaie(info->dev, 0);\r\nif (info->data->needs_src_clk)\r\nclk_unprepare(info->rtc_src_clk);\r\nclk_unprepare(info->rtc_clk);\r\nreturn 0;\r\n}\r\nstatic struct s3c_rtc_data *s3c_rtc_get_data(struct platform_device *pdev)\r\n{\r\nconst struct of_device_id *match;\r\nmatch = of_match_node(s3c_rtc_dt_match, pdev->dev.of_node);\r\nreturn (struct s3c_rtc_data *)match->data;\r\n}\r\nstatic int s3c_rtc_probe(struct platform_device *pdev)\r\n{\r\nstruct s3c_rtc *info = NULL;\r\nstruct rtc_time rtc_tm;\r\nstruct resource *res;\r\nint ret;\r\ninfo = devm_kzalloc(&pdev->dev, sizeof(*info), GFP_KERNEL);\r\nif (!info)\r\nreturn -ENOMEM;\r\ninfo->irq_tick = platform_get_irq(pdev, 1);\r\nif (info->irq_tick < 0) {\r\ndev_err(&pdev->dev, "no irq for rtc tick\n");\r\nreturn info->irq_tick;\r\n}\r\ninfo->dev = &pdev->dev;\r\ninfo->data = s3c_rtc_get_data(pdev);\r\nif (!info->data) {\r\ndev_err(&pdev->dev, "failed getting s3c_rtc_data\n");\r\nreturn -EINVAL;\r\n}\r\nspin_lock_init(&info->pie_lock);\r\nspin_lock_init(&info->alarm_clk_lock);\r\nplatform_set_drvdata(pdev, info);\r\ninfo->irq_alarm = platform_get_irq(pdev, 0);\r\nif (info->irq_alarm < 0) {\r\ndev_err(&pdev->dev, "no irq for alarm\n");\r\nreturn info->irq_alarm;\r\n}\r\ndev_dbg(&pdev->dev, "s3c2410_rtc: tick irq %d, alarm irq %d\n",\r\ninfo->irq_tick, info->irq_alarm);\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\ninfo->base = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(info->base))\r\nreturn PTR_ERR(info->base);\r\ninfo->rtc_clk = devm_clk_get(&pdev->dev, "rtc");\r\nif (IS_ERR(info->rtc_clk)) {\r\ndev_err(&pdev->dev, "failed to find rtc clock\n");\r\nreturn PTR_ERR(info->rtc_clk);\r\n}\r\nclk_prepare_enable(info->rtc_clk);\r\nif (info->data->needs_src_clk) {\r\ninfo->rtc_src_clk = devm_clk_get(&pdev->dev, "rtc_src");\r\nif (IS_ERR(info->rtc_src_clk)) {\r\ndev_err(&pdev->dev,\r\n"failed to find rtc source clock\n");\r\nclk_disable_unprepare(info->rtc_clk);\r\nreturn PTR_ERR(info->rtc_src_clk);\r\n}\r\nclk_prepare_enable(info->rtc_src_clk);\r\n}\r\nif (info->data->enable)\r\ninfo->data->enable(info);\r\ndev_dbg(&pdev->dev, "s3c2410_rtc: RTCCON=%02x\n",\r\nreadw(info->base + S3C2410_RTCCON));\r\ndevice_init_wakeup(&pdev->dev, 1);\r\nif (s3c_rtc_gettime(&pdev->dev, &rtc_tm)) {\r\nrtc_tm.tm_year = 100;\r\nrtc_tm.tm_mon = 0;\r\nrtc_tm.tm_mday = 1;\r\nrtc_tm.tm_hour = 0;\r\nrtc_tm.tm_min = 0;\r\nrtc_tm.tm_sec = 0;\r\ns3c_rtc_settime(&pdev->dev, &rtc_tm);\r\ndev_warn(&pdev->dev, "warning: invalid RTC value so initializing it\n");\r\n}\r\ninfo->rtc = devm_rtc_device_register(&pdev->dev, "s3c", &s3c_rtcops,\r\nTHIS_MODULE);\r\nif (IS_ERR(info->rtc)) {\r\ndev_err(&pdev->dev, "cannot attach rtc\n");\r\nret = PTR_ERR(info->rtc);\r\ngoto err_nortc;\r\n}\r\nret = devm_request_irq(&pdev->dev, info->irq_alarm, s3c_rtc_alarmirq,\r\n0, "s3c2410-rtc alarm", info);\r\nif (ret) {\r\ndev_err(&pdev->dev, "IRQ%d error %d\n", info->irq_alarm, ret);\r\ngoto err_nortc;\r\n}\r\nret = devm_request_irq(&pdev->dev, info->irq_tick, s3c_rtc_tickirq,\r\n0, "s3c2410-rtc tick", info);\r\nif (ret) {\r\ndev_err(&pdev->dev, "IRQ%d error %d\n", info->irq_tick, ret);\r\ngoto err_nortc;\r\n}\r\nif (info->data->select_tick_clk)\r\ninfo->data->select_tick_clk(info);\r\ns3c_rtc_setfreq(info, 1);\r\ns3c_rtc_disable_clk(info);\r\nreturn 0;\r\nerr_nortc:\r\nif (info->data->disable)\r\ninfo->data->disable(info);\r\nif (info->data->needs_src_clk)\r\nclk_disable_unprepare(info->rtc_src_clk);\r\nclk_disable_unprepare(info->rtc_clk);\r\nreturn ret;\r\n}\r\nstatic int s3c_rtc_suspend(struct device *dev)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\ns3c_rtc_enable_clk(info);\r\nif (info->data->save_tick_cnt)\r\ninfo->data->save_tick_cnt(info);\r\nif (info->data->disable)\r\ninfo->data->disable(info);\r\nif (device_may_wakeup(dev) && !info->wake_en) {\r\nif (enable_irq_wake(info->irq_alarm) == 0)\r\ninfo->wake_en = true;\r\nelse\r\ndev_err(dev, "enable_irq_wake failed\n");\r\n}\r\nreturn 0;\r\n}\r\nstatic int s3c_rtc_resume(struct device *dev)\r\n{\r\nstruct s3c_rtc *info = dev_get_drvdata(dev);\r\nif (info->data->enable)\r\ninfo->data->enable(info);\r\nif (info->data->restore_tick_cnt)\r\ninfo->data->restore_tick_cnt(info);\r\ns3c_rtc_disable_clk(info);\r\nif (device_may_wakeup(dev) && info->wake_en) {\r\ndisable_irq_wake(info->irq_alarm);\r\ninfo->wake_en = false;\r\n}\r\nreturn 0;\r\n}\r\nstatic void s3c24xx_rtc_irq(struct s3c_rtc *info, int mask)\r\n{\r\nrtc_update_irq(info->rtc, 1, RTC_AF | RTC_IRQF);\r\n}\r\nstatic void s3c6410_rtc_irq(struct s3c_rtc *info, int mask)\r\n{\r\nrtc_update_irq(info->rtc, 1, RTC_AF | RTC_IRQF);\r\nwriteb(mask, info->base + S3C2410_INTP);\r\n}\r\nstatic void s3c2410_rtc_setfreq(struct s3c_rtc *info, int freq)\r\n{\r\nunsigned int tmp = 0;\r\nint val;\r\ntmp = readb(info->base + S3C2410_TICNT);\r\ntmp &= S3C2410_TICNT_ENABLE;\r\nval = (info->rtc->max_user_freq / freq) - 1;\r\ntmp |= val;\r\nwritel(tmp, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c2416_rtc_setfreq(struct s3c_rtc *info, int freq)\r\n{\r\nunsigned int tmp = 0;\r\nint val;\r\ntmp = readb(info->base + S3C2410_TICNT);\r\ntmp &= S3C2410_TICNT_ENABLE;\r\nval = (info->rtc->max_user_freq / freq) - 1;\r\ntmp |= S3C2443_TICNT_PART(val);\r\nwritel(S3C2443_TICNT1_PART(val), info->base + S3C2443_TICNT1);\r\nwritel(S3C2416_TICNT2_PART(val), info->base + S3C2416_TICNT2);\r\nwritel(tmp, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c2443_rtc_setfreq(struct s3c_rtc *info, int freq)\r\n{\r\nunsigned int tmp = 0;\r\nint val;\r\ntmp = readb(info->base + S3C2410_TICNT);\r\ntmp &= S3C2410_TICNT_ENABLE;\r\nval = (info->rtc->max_user_freq / freq) - 1;\r\ntmp |= S3C2443_TICNT_PART(val);\r\nwritel(S3C2443_TICNT1_PART(val), info->base + S3C2443_TICNT1);\r\nwritel(tmp, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c6410_rtc_setfreq(struct s3c_rtc *info, int freq)\r\n{\r\nint val;\r\nval = (info->rtc->max_user_freq / freq) - 1;\r\nwritel(val, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c24xx_rtc_enable_tick(struct s3c_rtc *info, struct seq_file *seq)\r\n{\r\nunsigned int ticnt;\r\nticnt = readb(info->base + S3C2410_TICNT);\r\nticnt &= S3C2410_TICNT_ENABLE;\r\nseq_printf(seq, "periodic_IRQ\t: %s\n", ticnt ? "yes" : "no");\r\n}\r\nstatic void s3c2416_rtc_select_tick_clk(struct s3c_rtc *info)\r\n{\r\nunsigned int con;\r\ncon = readw(info->base + S3C2410_RTCCON);\r\ncon |= S3C2443_RTCCON_TICSEL;\r\nwritew(con, info->base + S3C2410_RTCCON);\r\n}\r\nstatic void s3c6410_rtc_enable_tick(struct s3c_rtc *info, struct seq_file *seq)\r\n{\r\nunsigned int ticnt;\r\nticnt = readw(info->base + S3C2410_RTCCON);\r\nticnt &= S3C64XX_RTCCON_TICEN;\r\nseq_printf(seq, "periodic_IRQ\t: %s\n", ticnt ? "yes" : "no");\r\n}\r\nstatic void s3c24xx_rtc_save_tick_cnt(struct s3c_rtc *info)\r\n{\r\ninfo->ticnt_save = readb(info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c24xx_rtc_restore_tick_cnt(struct s3c_rtc *info)\r\n{\r\nwriteb(info->ticnt_save, info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c6410_rtc_save_tick_cnt(struct s3c_rtc *info)\r\n{\r\ninfo->ticnt_en_save = readw(info->base + S3C2410_RTCCON);\r\ninfo->ticnt_en_save &= S3C64XX_RTCCON_TICEN;\r\ninfo->ticnt_save = readl(info->base + S3C2410_TICNT);\r\n}\r\nstatic void s3c6410_rtc_restore_tick_cnt(struct s3c_rtc *info)\r\n{\r\nunsigned int con;\r\nwritel(info->ticnt_save, info->base + S3C2410_TICNT);\r\nif (info->ticnt_en_save) {\r\ncon = readw(info->base + S3C2410_RTCCON);\r\nwritew(con | info->ticnt_en_save,\r\ninfo->base + S3C2410_RTCCON);\r\n}\r\n}
