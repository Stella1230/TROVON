int exynos_drm_subdrv_register(struct exynos_drm_subdrv *subdrv)\r\n{\r\nif (!subdrv)\r\nreturn -EINVAL;\r\nlist_add_tail(&subdrv->list, &exynos_drm_subdrv_list);\r\nreturn 0;\r\n}\r\nint exynos_drm_subdrv_unregister(struct exynos_drm_subdrv *subdrv)\r\n{\r\nif (!subdrv)\r\nreturn -EINVAL;\r\nlist_del(&subdrv->list);\r\nreturn 0;\r\n}\r\nint exynos_drm_device_subdrv_probe(struct drm_device *dev)\r\n{\r\nstruct exynos_drm_subdrv *subdrv, *n;\r\nint err;\r\nif (!dev)\r\nreturn -EINVAL;\r\nlist_for_each_entry_safe(subdrv, n, &exynos_drm_subdrv_list, list) {\r\nif (subdrv->probe) {\r\nsubdrv->drm_dev = dev;\r\nerr = subdrv->probe(dev, subdrv->dev);\r\nif (err) {\r\nDRM_DEBUG("exynos drm subdrv probe failed.\n");\r\nlist_del(&subdrv->list);\r\ncontinue;\r\n}\r\n}\r\n}\r\nreturn 0;\r\n}\r\nint exynos_drm_device_subdrv_remove(struct drm_device *dev)\r\n{\r\nstruct exynos_drm_subdrv *subdrv;\r\nif (!dev) {\r\nWARN(1, "Unexpected drm device unregister!\n");\r\nreturn -EINVAL;\r\n}\r\nlist_for_each_entry(subdrv, &exynos_drm_subdrv_list, list) {\r\nif (subdrv->remove)\r\nsubdrv->remove(dev, subdrv->dev);\r\n}\r\nreturn 0;\r\n}\r\nint exynos_drm_subdrv_open(struct drm_device *dev, struct drm_file *file)\r\n{\r\nstruct exynos_drm_subdrv *subdrv;\r\nint ret;\r\nlist_for_each_entry(subdrv, &exynos_drm_subdrv_list, list) {\r\nif (subdrv->open) {\r\nret = subdrv->open(dev, subdrv->dev, file);\r\nif (ret)\r\ngoto err;\r\n}\r\n}\r\nreturn 0;\r\nerr:\r\nlist_for_each_entry_reverse(subdrv, &subdrv->list, list) {\r\nif (subdrv->close)\r\nsubdrv->close(dev, subdrv->dev, file);\r\n}\r\nreturn ret;\r\n}\r\nvoid exynos_drm_subdrv_close(struct drm_device *dev, struct drm_file *file)\r\n{\r\nstruct exynos_drm_subdrv *subdrv;\r\nlist_for_each_entry(subdrv, &exynos_drm_subdrv_list, list) {\r\nif (subdrv->close)\r\nsubdrv->close(dev, subdrv->dev, file);\r\n}\r\n}
