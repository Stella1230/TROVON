static ssize_t state_show(struct medialb_bus *bus, char *buf)\r\n{\r\nbool state = dim2_sysfs_get_state_cb();\r\nreturn sprintf(buf, "%s\n", state ? "locked" : "");\r\n}\r\nstatic void bus_kobj_release(struct kobject *kobj)\r\n{\r\n}\r\nstatic ssize_t bus_kobj_attr_show(struct kobject *kobj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct medialb_bus *bus =\r\ncontainer_of(kobj, struct medialb_bus, kobj_group);\r\nstruct bus_attr *xattr = container_of(attr, struct bus_attr, attr);\r\nif (!xattr->show)\r\nreturn -EIO;\r\nreturn xattr->show(bus, buf);\r\n}\r\nstatic ssize_t bus_kobj_attr_store(struct kobject *kobj, struct attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nssize_t ret;\r\nstruct medialb_bus *bus =\r\ncontainer_of(kobj, struct medialb_bus, kobj_group);\r\nstruct bus_attr *xattr = container_of(attr, struct bus_attr, attr);\r\nif (!xattr->store)\r\nreturn -EIO;\r\nret = xattr->store(bus, buf, count);\r\nreturn ret;\r\n}\r\nint dim2_sysfs_probe(struct medialb_bus *bus, struct kobject *parent_kobj)\r\n{\r\nint err;\r\nkobject_init(&bus->kobj_group, &bus_ktype);\r\nerr = kobject_add(&bus->kobj_group, parent_kobj, "bus");\r\nif (err) {\r\npr_err("kobject_add() failed: %d\n", err);\r\ngoto err_kobject_add;\r\n}\r\nerr = sysfs_create_group(&bus->kobj_group, &bus_attr_group);\r\nif (err) {\r\npr_err("sysfs_create_group() failed: %d\n", err);\r\ngoto err_create_group;\r\n}\r\nreturn 0;\r\nerr_create_group:\r\nkobject_put(&bus->kobj_group);\r\nerr_kobject_add:\r\nreturn err;\r\n}\r\nvoid dim2_sysfs_destroy(struct medialb_bus *bus)\r\n{\r\nkobject_put(&bus->kobj_group);\r\n}
