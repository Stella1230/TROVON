static u8\r\nnvbios_ramcfg_strap(struct nvkm_subdev *subdev)\r\n{\r\nreturn (nvkm_rd32(subdev->device, 0x101000) & 0x0000003c) >> 2;\r\n}\r\nu8\r\nnvbios_ramcfg_count(struct nvkm_bios *bios)\r\n{\r\nstruct bit_entry bit_M;\r\nif (!bit_entry(bios, 'M', &bit_M)) {\r\nif (bit_M.version == 1 && bit_M.length >= 5)\r\nreturn nvbios_rd08(bios, bit_M.offset + 2);\r\nif (bit_M.version == 2 && bit_M.length >= 3)\r\nreturn nvbios_rd08(bios, bit_M.offset + 0);\r\n}\r\nreturn 0x00;\r\n}\r\nu8\r\nnvbios_ramcfg_index(struct nvkm_subdev *subdev)\r\n{\r\nstruct nvkm_bios *bios = subdev->device->bios;\r\nu8 strap = nvbios_ramcfg_strap(subdev);\r\nu32 xlat = 0x00000000;\r\nstruct bit_entry bit_M;\r\nstruct nvbios_M0203E M0203E;\r\nu8 ver, hdr;\r\nif (!bit_entry(bios, 'M', &bit_M)) {\r\nif (bit_M.version == 1 && bit_M.length >= 5)\r\nxlat = nvbios_rd16(bios, bit_M.offset + 3);\r\nif (bit_M.version == 2 && bit_M.length >= 3) {\r\nif (bit_M.length >= 7 &&\r\nnvbios_M0203Em(bios, strap, &ver, &hdr, &M0203E))\r\nreturn M0203E.group;\r\nxlat = nvbios_rd16(bios, bit_M.offset + 1);\r\n}\r\n}\r\nif (xlat)\r\nstrap = nvbios_rd08(bios, xlat + strap);\r\nreturn strap;\r\n}
