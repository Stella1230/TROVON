static char *mv88e6171_probe(struct device *host_dev, int sw_addr)\r\n{\r\nreturn mv88e6xxx_lookup_name(host_dev, sw_addr, mv88e6171_table,\r\nARRAY_SIZE(mv88e6171_table));\r\n}\r\nstatic int mv88e6171_setup_global(struct dsa_switch *ds)\r\n{\r\nu32 upstream_port = dsa_upstream_port(ds);\r\nint ret;\r\nu32 reg;\r\nret = mv88e6xxx_setup_global(ds);\r\nif (ret)\r\nreturn ret;\r\nREG_WRITE(REG_GLOBAL, GLOBAL_CONTROL,\r\nGLOBAL_CONTROL_PPU_ENABLE | GLOBAL_CONTROL_DISCARD_EXCESS);\r\nreg = upstream_port << GLOBAL_MONITOR_CONTROL_INGRESS_SHIFT |\r\nupstream_port << GLOBAL_MONITOR_CONTROL_EGRESS_SHIFT |\r\nupstream_port << GLOBAL_MONITOR_CONTROL_ARP_SHIFT |\r\nupstream_port << GLOBAL_MONITOR_CONTROL_MIRROR_SHIFT;\r\nREG_WRITE(REG_GLOBAL, GLOBAL_MONITOR_CONTROL, reg);\r\nREG_WRITE(REG_GLOBAL, GLOBAL_CONTROL_2, ds->index & 0x1f);\r\nreturn 0;\r\n}\r\nstatic int mv88e6171_setup(struct dsa_switch *ds)\r\n{\r\nstruct mv88e6xxx_priv_state *ps = ds_to_priv(ds);\r\nint ret;\r\nret = mv88e6xxx_setup_common(ds);\r\nif (ret < 0)\r\nreturn ret;\r\nps->num_ports = 7;\r\nret = mv88e6xxx_switch_reset(ds, true);\r\nif (ret < 0)\r\nreturn ret;\r\nret = mv88e6171_setup_global(ds);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn mv88e6xxx_setup_ports(ds);\r\n}
