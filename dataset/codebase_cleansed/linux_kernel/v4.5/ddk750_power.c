void ddk750_setDPMS(DPMS_t state)\r\n{\r\nunsigned int value;\r\nif (getChipType() == SM750LE) {\r\nvalue = PEEK32(CRT_DISPLAY_CTRL);\r\nPOKE32(CRT_DISPLAY_CTRL, FIELD_VALUE(value, CRT_DISPLAY_CTRL,\r\nDPMS, state));\r\n} else {\r\nvalue = PEEK32(SYSTEM_CTRL);\r\nvalue = FIELD_VALUE(value, SYSTEM_CTRL, DPMS, state);\r\nPOKE32(SYSTEM_CTRL, value);\r\n}\r\n}\r\nstatic unsigned int getPowerMode(void)\r\n{\r\nif (getChipType() == SM750LE)\r\nreturn 0;\r\nreturn FIELD_GET(PEEK32(POWER_MODE_CTRL), POWER_MODE_CTRL, MODE);\r\n}\r\nvoid setPowerMode(unsigned int powerMode)\r\n{\r\nunsigned int control_value = 0;\r\ncontrol_value = PEEK32(POWER_MODE_CTRL);\r\nif (getChipType() == SM750LE)\r\nreturn;\r\nswitch (powerMode) {\r\ncase POWER_MODE_CTRL_MODE_MODE0:\r\ncontrol_value = FIELD_SET(control_value, POWER_MODE_CTRL, MODE,\r\nMODE0);\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_MODE1:\r\ncontrol_value = FIELD_SET(control_value, POWER_MODE_CTRL, MODE,\r\nMODE1);\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_SLEEP:\r\ncontrol_value = FIELD_SET(control_value, POWER_MODE_CTRL, MODE,\r\nSLEEP);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (powerMode == POWER_MODE_CTRL_MODE_SLEEP) {\r\ncontrol_value =\r\n#ifdef VALIDATION_CHIP\r\nFIELD_SET(control_value, POWER_MODE_CTRL, 336CLK, OFF) |\r\n#endif\r\nFIELD_SET(control_value, POWER_MODE_CTRL, OSC_INPUT, OFF);\r\n} else {\r\ncontrol_value =\r\n#ifdef VALIDATION_CHIP\r\nFIELD_SET(control_value, POWER_MODE_CTRL, 336CLK, ON) |\r\n#endif\r\nFIELD_SET(control_value, POWER_MODE_CTRL, OSC_INPUT, ON);\r\n}\r\nPOKE32(POWER_MODE_CTRL, control_value);\r\n}\r\nvoid setCurrentGate(unsigned int gate)\r\n{\r\nunsigned int gate_reg;\r\nunsigned int mode;\r\nmode = getPowerMode();\r\nswitch (mode) {\r\ncase POWER_MODE_CTRL_MODE_MODE0:\r\ngate_reg = MODE0_GATE;\r\nbreak;\r\ncase POWER_MODE_CTRL_MODE_MODE1:\r\ngate_reg = MODE1_GATE;\r\nbreak;\r\ndefault:\r\ngate_reg = MODE0_GATE;\r\nbreak;\r\n}\r\nPOKE32(gate_reg, gate);\r\n}\r\nvoid enable2DEngine(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable) {\r\ngate = FIELD_SET(gate, CURRENT_GATE, DE, ON);\r\ngate = FIELD_SET(gate, CURRENT_GATE, CSC, ON);\r\n} else {\r\ngate = FIELD_SET(gate, CURRENT_GATE, DE, OFF);\r\ngate = FIELD_SET(gate, CURRENT_GATE, CSC, OFF);\r\n}\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableDMA(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate = FIELD_SET(gate, CURRENT_GATE, DMA, ON);\r\nelse\r\ngate = FIELD_SET(gate, CURRENT_GATE, DMA, OFF);\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableGPIO(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate = FIELD_SET(gate, CURRENT_GATE, GPIO, ON);\r\nelse\r\ngate = FIELD_SET(gate, CURRENT_GATE, GPIO, OFF);\r\nsetCurrentGate(gate);\r\n}\r\nvoid enableI2C(unsigned int enable)\r\n{\r\nu32 gate;\r\ngate = PEEK32(CURRENT_GATE);\r\nif (enable)\r\ngate = FIELD_SET(gate, CURRENT_GATE, I2C, ON);\r\nelse\r\ngate = FIELD_SET(gate, CURRENT_GATE, I2C, OFF);\r\nsetCurrentGate(gate);\r\n}
