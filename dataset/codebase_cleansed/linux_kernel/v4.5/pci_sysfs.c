static ssize_t recover_store(struct device *dev, struct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct pci_dev *pdev = to_pci_dev(dev);\r\nstruct zpci_dev *zdev = to_zpci(pdev);\r\nint ret;\r\nif (!device_remove_file_self(dev, attr))\r\nreturn count;\r\npci_lock_rescan_remove();\r\npci_stop_and_remove_bus_device(pdev);\r\nret = zpci_disable_device(zdev);\r\nif (ret)\r\ngoto error;\r\nret = zpci_enable_device(zdev);\r\nif (ret)\r\ngoto error;\r\npci_rescan_bus(zdev->bus);\r\npci_unlock_rescan_remove();\r\nreturn count;\r\nerror:\r\npci_unlock_rescan_remove();\r\nreturn ret;\r\n}\r\nstatic ssize_t util_string_read(struct file *filp, struct kobject *kobj,\r\nstruct bin_attribute *attr, char *buf,\r\nloff_t off, size_t count)\r\n{\r\nstruct device *dev = kobj_to_dev(kobj);\r\nstruct pci_dev *pdev = to_pci_dev(dev);\r\nstruct zpci_dev *zdev = to_zpci(pdev);\r\nreturn memory_read_from_buffer(buf, count, &off, zdev->util_str,\r\nsizeof(zdev->util_str));\r\n}
