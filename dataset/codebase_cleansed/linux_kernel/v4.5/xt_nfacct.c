static bool nfacct_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nint overquota;\r\nconst struct xt_nfacct_match_info *info = par->targinfo;\r\nnfnl_acct_update(skb, info->nfacct);\r\noverquota = nfnl_acct_overquota(skb, info->nfacct);\r\nreturn overquota == NFACCT_UNDERQUOTA ? false : true;\r\n}\r\nstatic int\r\nnfacct_mt_checkentry(const struct xt_mtchk_param *par)\r\n{\r\nstruct xt_nfacct_match_info *info = par->matchinfo;\r\nstruct nf_acct *nfacct;\r\nnfacct = nfnl_acct_find_get(par->net, info->name);\r\nif (nfacct == NULL) {\r\npr_info("xt_nfacct: accounting object with name `%s' "\r\n"does not exists\n", info->name);\r\nreturn -ENOENT;\r\n}\r\ninfo->nfacct = nfacct;\r\nreturn 0;\r\n}\r\nstatic void\r\nnfacct_mt_destroy(const struct xt_mtdtor_param *par)\r\n{\r\nconst struct xt_nfacct_match_info *info = par->matchinfo;\r\nnfnl_acct_put(info->nfacct);\r\n}\r\nstatic int __init nfacct_mt_init(void)\r\n{\r\nreturn xt_register_match(&nfacct_mt_reg);\r\n}\r\nstatic void __exit nfacct_mt_exit(void)\r\n{\r\nxt_unregister_match(&nfacct_mt_reg);\r\n}
