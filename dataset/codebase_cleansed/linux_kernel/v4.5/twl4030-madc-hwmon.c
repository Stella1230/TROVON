static ssize_t madc_read(struct device *dev,\r\nstruct device_attribute *devattr, char *buf)\r\n{\r\nstruct sensor_device_attribute *attr = to_sensor_dev_attr(devattr);\r\nstruct twl4030_madc_request req = {\r\n.channels = 1 << attr->index,\r\n.method = TWL4030_MADC_SW2,\r\n.type = TWL4030_MADC_WAIT,\r\n};\r\nlong val;\r\nval = twl4030_madc_conversion(&req);\r\nif (val < 0)\r\nreturn val;\r\nreturn sprintf(buf, "%d\n", req.rbuf[attr->index]);\r\n}\r\nstatic int twl4030_madc_hwmon_probe(struct platform_device *pdev)\r\n{\r\nstruct device *hwmon;\r\nhwmon = devm_hwmon_device_register_with_groups(&pdev->dev,\r\n"twl4030_madc", NULL,\r\ntwl4030_madc_groups);\r\nreturn PTR_ERR_OR_ZERO(hwmon);\r\n}
