static void hdmi_phy_8x60_destroy(struct hdmi_phy *phy)\r\n{\r\nstruct hdmi_phy_8x60 *phy_8x60 = to_hdmi_phy_8x60(phy);\r\nkfree(phy_8x60);\r\n}\r\nstatic void hdmi_phy_8x60_powerup(struct hdmi_phy *phy,\r\nunsigned long int pixclock)\r\n{\r\nstruct hdmi_phy_8x60 *phy_8x60 = to_hdmi_phy_8x60(phy);\r\nstruct hdmi *hdmi = phy_8x60->hdmi;\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG0,\r\nHDMI_8x60_PHY_REG0_DESER_DEL_CTRL(3));\r\nif (pixclock == 27000000) {\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG1,\r\nHDMI_8x60_PHY_REG1_DTEST_MUX_SEL(5) |\r\nHDMI_8x60_PHY_REG1_OUTVOL_SWING_CTRL(3));\r\n} else {\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG1,\r\nHDMI_8x60_PHY_REG1_DTEST_MUX_SEL(5) |\r\nHDMI_8x60_PHY_REG1_OUTVOL_SWING_CTRL(4));\r\n}\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_PD_PWRGEN |\r\nHDMI_8x60_PHY_REG2_PD_PLL |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_4 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_3 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_2 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_1 |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_PD_PLL |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_4 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_3 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_2 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_1 |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_4 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_3 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_2 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_1 |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG3,\r\nHDMI_8x60_PHY_REG3_PLL_ENABLE);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG9, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG12,\r\nHDMI_8x60_PHY_REG12_RETIMING_EN |\r\nHDMI_8x60_PHY_REG12_PLL_LOCK_DETECT_EN);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_RCV_SENSE_EN |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG4, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG5, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG6, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG7, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG8, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG9, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG10, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG11, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG12,\r\nHDMI_8x60_PHY_REG12_RETIMING_EN |\r\nHDMI_8x60_PHY_REG12_PLL_LOCK_DETECT_EN |\r\nHDMI_8x60_PHY_REG12_FORCE_LOCK);\r\n}\r\nstatic void hdmi_phy_8x60_powerdown(struct hdmi_phy *phy)\r\n{\r\nstruct hdmi_phy_8x60 *phy_8x60 = to_hdmi_phy_8x60(phy);\r\nstruct hdmi *hdmi = phy_8x60->hdmi;\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nHDMI_PHY_CTRL_SW_RESET);\r\nudelay(10);\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_4 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_3 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_2 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_1 |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\nudelay(10);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG3, 0);\r\nhdmi_write(hdmi, REG_HDMI_8x60_PHY_REG2,\r\nHDMI_8x60_PHY_REG2_RCV_SENSE_EN |\r\nHDMI_8x60_PHY_REG2_PD_PWRGEN |\r\nHDMI_8x60_PHY_REG2_PD_PLL |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_4 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_3 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_2 |\r\nHDMI_8x60_PHY_REG2_PD_DRIVE_1 |\r\nHDMI_8x60_PHY_REG2_PD_DESER);\r\n}\r\nstruct hdmi_phy *hdmi_phy_8x60_init(struct hdmi *hdmi)\r\n{\r\nstruct hdmi_phy_8x60 *phy_8x60;\r\nstruct hdmi_phy *phy = NULL;\r\nint ret;\r\nphy_8x60 = kzalloc(sizeof(*phy_8x60), GFP_KERNEL);\r\nif (!phy_8x60) {\r\nret = -ENOMEM;\r\ngoto fail;\r\n}\r\nphy = &phy_8x60->base;\r\nphy->funcs = &hdmi_phy_8x60_funcs;\r\nphy_8x60->hdmi = hdmi;\r\nreturn phy;\r\nfail:\r\nif (phy)\r\nhdmi_phy_8x60_destroy(phy);\r\nreturn ERR_PTR(ret);\r\n}
