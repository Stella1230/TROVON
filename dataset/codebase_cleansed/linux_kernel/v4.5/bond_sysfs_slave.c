static ssize_t state_show(struct slave *slave, char *buf)\r\n{\r\nswitch (bond_slave_state(slave)) {\r\ncase BOND_STATE_ACTIVE:\r\nreturn sprintf(buf, "active\n");\r\ncase BOND_STATE_BACKUP:\r\nreturn sprintf(buf, "backup\n");\r\ndefault:\r\nreturn sprintf(buf, "UNKNOWN\n");\r\n}\r\n}\r\nstatic ssize_t mii_status_show(struct slave *slave, char *buf)\r\n{\r\nreturn sprintf(buf, "%s\n", bond_slave_link_status(slave->link));\r\n}\r\nstatic ssize_t link_failure_count_show(struct slave *slave, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", slave->link_failure_count);\r\n}\r\nstatic ssize_t perm_hwaddr_show(struct slave *slave, char *buf)\r\n{\r\nreturn sprintf(buf, "%pM\n", slave->perm_hwaddr);\r\n}\r\nstatic ssize_t queue_id_show(struct slave *slave, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", slave->queue_id);\r\n}\r\nstatic ssize_t ad_aggregator_id_show(struct slave *slave, char *buf)\r\n{\r\nconst struct aggregator *agg;\r\nif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\r\nagg = SLAVE_AD_INFO(slave)->port.aggregator;\r\nif (agg)\r\nreturn sprintf(buf, "%d\n",\r\nagg->aggregator_identifier);\r\n}\r\nreturn sprintf(buf, "N/A\n");\r\n}\r\nstatic ssize_t ad_actor_oper_port_state_show(struct slave *slave, char *buf)\r\n{\r\nconst struct port *ad_port;\r\nif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\r\nad_port = &SLAVE_AD_INFO(slave)->port;\r\nif (ad_port->aggregator)\r\nreturn sprintf(buf, "%u\n",\r\nad_port->actor_oper_port_state);\r\n}\r\nreturn sprintf(buf, "N/A\n");\r\n}\r\nstatic ssize_t ad_partner_oper_port_state_show(struct slave *slave, char *buf)\r\n{\r\nconst struct port *ad_port;\r\nif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\r\nad_port = &SLAVE_AD_INFO(slave)->port;\r\nif (ad_port->aggregator)\r\nreturn sprintf(buf, "%u\n",\r\nad_port->partner_oper.port_state);\r\n}\r\nreturn sprintf(buf, "N/A\n");\r\n}\r\nstatic ssize_t slave_show(struct kobject *kobj,\r\nstruct attribute *attr, char *buf)\r\n{\r\nstruct slave_attribute *slave_attr = to_slave_attr(attr);\r\nstruct slave *slave = to_slave(kobj);\r\nreturn slave_attr->show(slave, buf);\r\n}\r\nint bond_sysfs_slave_add(struct slave *slave)\r\n{\r\nconst struct slave_attribute **a;\r\nint err;\r\nerr = kobject_init_and_add(&slave->kobj, &slave_ktype,\r\n&(slave->dev->dev.kobj), "bonding_slave");\r\nif (err)\r\nreturn err;\r\nfor (a = slave_attrs; *a; ++a) {\r\nerr = sysfs_create_file(&slave->kobj, &((*a)->attr));\r\nif (err) {\r\nkobject_put(&slave->kobj);\r\nreturn err;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nvoid bond_sysfs_slave_del(struct slave *slave)\r\n{\r\nconst struct slave_attribute **a;\r\nfor (a = slave_attrs; *a; ++a)\r\nsysfs_remove_file(&slave->kobj, &((*a)->attr));\r\nkobject_put(&slave->kobj);\r\n}
