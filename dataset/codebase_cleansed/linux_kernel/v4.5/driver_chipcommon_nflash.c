int bcma_nflash_init(struct bcma_drv_cc *cc)\r\n{\r\nstruct bcma_bus *bus = cc->core->bus;\r\nif (bus->chipinfo.id != BCMA_CHIP_ID_BCM4706 &&\r\ncc->core->id.rev != 38) {\r\nbcma_err(bus, "NAND flash on unsupported board!\n");\r\nreturn -ENOTSUPP;\r\n}\r\nif (!(cc->capabilities & BCMA_CC_CAP_NFLASH)) {\r\nbcma_err(bus, "NAND flash not present according to ChipCommon\n");\r\nreturn -ENODEV;\r\n}\r\ncc->nflash.present = true;\r\nif (cc->core->id.rev == 38 &&\r\n(cc->status & BCMA_CC_CHIPST_5357_NAND_BOOT))\r\ncc->nflash.boot = true;\r\nbcma_nflash_dev.dev.platform_data = &cc->nflash;\r\nreturn 0;\r\n}
