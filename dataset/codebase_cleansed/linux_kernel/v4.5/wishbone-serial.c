static int usb_gsi_openclose(struct usb_serial_port *port, int value)\r\n{\r\nstruct usb_device *dev = port->serial->dev;\r\nreturn usb_control_msg(\r\ndev,\r\nusb_sndctrlpipe(dev, 0),\r\nGSI_VENDOR_OPENCLOSE,\r\nUSB_DIR_OUT|USB_TYPE_VENDOR|USB_RECIP_INTERFACE,\r\nvalue,\r\nport->serial->interface->cur_altsetting->desc.bInterfaceNumber,\r\nNULL, 0,\r\n5000);\r\n}\r\nstatic int wishbone_serial_open(struct tty_struct *tty,\r\nstruct usb_serial_port *port)\r\n{\r\nint retval;\r\nretval = usb_gsi_openclose(port, 1);\r\nif (retval) {\r\ndev_err(&port->serial->dev->dev,\r\n"Could not mark device as open (%d)\n",\r\nretval);\r\nreturn retval;\r\n}\r\nretval = usb_serial_generic_open(tty, port);\r\nif (retval)\r\nusb_gsi_openclose(port, 0);\r\nreturn retval;\r\n}\r\nstatic void wishbone_serial_close(struct usb_serial_port *port)\r\n{\r\nusb_serial_generic_close(port);\r\nusb_gsi_openclose(port, 0);\r\n}
