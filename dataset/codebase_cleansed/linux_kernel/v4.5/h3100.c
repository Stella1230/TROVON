static bool h3100_lcd_request(void)\r\n{\r\nstatic bool h3100_lcd_ok;\r\nint rc;\r\nif (h3100_lcd_ok)\r\nreturn true;\r\nrc = gpio_request_array(h3100_lcd_gpio, ARRAY_SIZE(h3100_lcd_gpio));\r\nif (rc)\r\npr_err("%s: can't request GPIOs\n", __func__);\r\nelse\r\nh3100_lcd_ok = true;\r\nreturn h3100_lcd_ok;\r\n}\r\nstatic void h3100_lcd_power(int enable)\r\n{\r\nif (!h3100_lcd_request())\r\nreturn;\r\ngpio_set_value(H3100_GPIO_LCD_3V_ON, enable);\r\ngpio_set_value(H3XXX_EGPIO_LCD_ON, enable);\r\n}\r\nstatic void __init h3100_map_io(void)\r\n{\r\nh3xxx_map_io();\r\nGAFR &= ~0x000001fb;\r\n}\r\nstatic int h3100_irda_set_power(struct device *dev, unsigned int state)\r\n{\r\ngpio_set_value(H3100_GPIO_IR_ON, state);\r\nreturn 0;\r\n}\r\nstatic void h3100_irda_set_speed(struct device *dev, unsigned int speed)\r\n{\r\ngpio_set_value(H3100_GPIO_IR_FSEL, !(speed < 4000000));\r\n}\r\nstatic int h3100_irda_startup(struct device *dev)\r\n{\r\nreturn gpio_request_array(h3100_irda_gpio, sizeof(h3100_irda_gpio));\r\n}\r\nstatic void h3100_irda_shutdown(struct device *dev)\r\n{\r\nreturn gpio_free_array(h3100_irda_gpio, sizeof(h3100_irda_gpio));\r\n}\r\nstatic void __init h3100_mach_init(void)\r\n{\r\nh3xxx_mach_init();\r\nsa11x0_register_lcd(&h3100_lcd_info);\r\nsa11x0_register_irda(&h3100_irda_data);\r\n}
