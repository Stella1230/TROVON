static int imx_mc13783_hifi_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *cpu_dai = rtd->cpu_dai;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nint ret;\r\nret = snd_soc_dai_set_tdm_slot(codec_dai, 0x3, 0x3, 4, 16);\r\nif (ret)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(codec_dai, MC13783_CLK_CLIA, 26000000, 0);\r\nif (ret)\r\nreturn ret;\r\nreturn snd_soc_dai_set_tdm_slot(cpu_dai, 0x3, 0x3, 2, 16);\r\n}\r\nstatic int imx_mc13783_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nimx_mc13783.dev = &pdev->dev;\r\nret = snd_soc_register_card(&imx_mc13783);\r\nif (ret) {\r\ndev_err(&pdev->dev, "snd_soc_register_card failed (%d)\n",\r\nret);\r\nreturn ret;\r\n}\r\nif (machine_is_mx31_3ds() || machine_is_mx31moboard()) {\r\nimx_audmux_v2_configure_port(MX31_AUDMUX_PORT4_SSI_PINS_4,\r\nIMX_AUDMUX_V2_PTCR_SYN,\r\nIMX_AUDMUX_V2_PDCR_RXDSEL(MX31_AUDMUX_PORT1_SSI0) |\r\nIMX_AUDMUX_V2_PDCR_MODE(1) |\r\nIMX_AUDMUX_V2_PDCR_INMMASK(0xfc));\r\nimx_audmux_v2_configure_port(MX31_AUDMUX_PORT1_SSI0,\r\nIMX_AUDMUX_V2_PTCR_SYN |\r\nIMX_AUDMUX_V2_PTCR_TFSDIR |\r\nIMX_AUDMUX_V2_PTCR_TFSEL(MX31_AUDMUX_PORT4_SSI_PINS_4) |\r\nIMX_AUDMUX_V2_PTCR_TCLKDIR |\r\nIMX_AUDMUX_V2_PTCR_TCSEL(MX31_AUDMUX_PORT4_SSI_PINS_4) |\r\nIMX_AUDMUX_V2_PTCR_RFSDIR |\r\nIMX_AUDMUX_V2_PTCR_RFSEL(MX31_AUDMUX_PORT4_SSI_PINS_4) |\r\nIMX_AUDMUX_V2_PTCR_RCLKDIR |\r\nIMX_AUDMUX_V2_PTCR_RCSEL(MX31_AUDMUX_PORT4_SSI_PINS_4),\r\nIMX_AUDMUX_V2_PDCR_RXDSEL(MX31_AUDMUX_PORT4_SSI_PINS_4));\r\n} else if (machine_is_mx27_3ds()) {\r\nimx_audmux_v1_configure_port(MX27_AUDMUX_HPCR1_SSI0,\r\nIMX_AUDMUX_V1_PCR_SYN |\r\nIMX_AUDMUX_V1_PCR_TFSDIR |\r\nIMX_AUDMUX_V1_PCR_TCLKDIR |\r\nIMX_AUDMUX_V1_PCR_RFSDIR |\r\nIMX_AUDMUX_V1_PCR_RCLKDIR |\r\nIMX_AUDMUX_V1_PCR_TFCSEL(MX27_AUDMUX_HPCR3_SSI_PINS_4) |\r\nIMX_AUDMUX_V1_PCR_RFCSEL(MX27_AUDMUX_HPCR3_SSI_PINS_4) |\r\nIMX_AUDMUX_V1_PCR_RXDSEL(MX27_AUDMUX_HPCR3_SSI_PINS_4)\r\n);\r\nimx_audmux_v1_configure_port(MX27_AUDMUX_HPCR3_SSI_PINS_4,\r\nIMX_AUDMUX_V1_PCR_SYN |\r\nIMX_AUDMUX_V1_PCR_RXDSEL(MX27_AUDMUX_HPCR1_SSI0)\r\n);\r\n}\r\nreturn ret;\r\n}\r\nstatic int imx_mc13783_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_card(&imx_mc13783);\r\nreturn 0;\r\n}
