static inline bool\r\nhash_mac4_data_equal(const struct hash_mac4_elem *e1,\r\nconst struct hash_mac4_elem *e2,\r\nu32 *multi)\r\n{\r\nreturn ether_addr_equal(e1->ether, e2->ether);\r\n}\r\nstatic inline bool\r\nhash_mac4_data_list(struct sk_buff *skb, const struct hash_mac4_elem *e)\r\n{\r\nif (nla_put(skb, IPSET_ATTR_ETHER, ETH_ALEN, e->ether))\r\ngoto nla_put_failure;\r\nreturn false;\r\nnla_put_failure:\r\nreturn true;\r\n}\r\nstatic inline void\r\nhash_mac4_data_next(struct hash_mac4_elem *next,\r\nconst struct hash_mac4_elem *e)\r\n{\r\n}\r\nstatic int\r\nhash_mac4_kadt(struct ip_set *set, const struct sk_buff *skb,\r\nconst struct xt_action_param *par,\r\nenum ipset_adt adt, struct ip_set_adt_opt *opt)\r\n{\r\nipset_adtfn adtfn = set->variant->adt[adt];\r\nstruct hash_mac4_elem e = { { .foo[0] = 0, .foo[1] = 0 } };\r\nstruct ip_set_ext ext = IP_SET_INIT_KEXT(skb, opt, set);\r\nif (!(opt->flags & IPSET_DIM_ONE_SRC))\r\nreturn 0;\r\nif (skb_mac_header(skb) < skb->head ||\r\n(skb_mac_header(skb) + ETH_HLEN) > skb->data)\r\nreturn -EINVAL;\r\nether_addr_copy(e.ether, eth_hdr(skb)->h_source);\r\nif (memcmp(e.ether, invalid_ether, ETH_ALEN) == 0)\r\nreturn -EINVAL;\r\nreturn adtfn(set, &e, &ext, &opt->ext, opt->cmdflags);\r\n}\r\nstatic int\r\nhash_mac4_uadt(struct ip_set *set, struct nlattr *tb[],\r\nenum ipset_adt adt, u32 *lineno, u32 flags, bool retried)\r\n{\r\nipset_adtfn adtfn = set->variant->adt[adt];\r\nstruct hash_mac4_elem e = { { .foo[0] = 0, .foo[1] = 0 } };\r\nstruct ip_set_ext ext = IP_SET_INIT_UEXT(set);\r\nint ret;\r\nif (tb[IPSET_ATTR_LINENO])\r\n*lineno = nla_get_u32(tb[IPSET_ATTR_LINENO]);\r\nif (unlikely(!tb[IPSET_ATTR_ETHER]))\r\nreturn -IPSET_ERR_PROTOCOL;\r\nret = ip_set_get_extensions(set, tb, &ext);\r\nif (ret)\r\nreturn ret;\r\nether_addr_copy(e.ether, nla_data(tb[IPSET_ATTR_ETHER]));\r\nif (memcmp(e.ether, invalid_ether, ETH_ALEN) == 0)\r\nreturn -IPSET_ERR_HASH_ELEM;\r\nreturn adtfn(set, &e, &ext, &ext, flags);\r\n}\r\nstatic int __init\r\nhash_mac_init(void)\r\n{\r\nreturn ip_set_type_register(&hash_mac_type);\r\n}\r\nstatic void __exit\r\nhash_mac_fini(void)\r\n{\r\nrcu_barrier();\r\nip_set_type_unregister(&hash_mac_type);\r\n}
