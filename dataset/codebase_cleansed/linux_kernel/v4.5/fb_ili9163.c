static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nif (par->gpio.cs != -1)\r\ngpio_set_value(par->gpio.cs, 0);\r\nwrite_reg(par, CMD_SWRESET);\r\nmdelay(500);\r\nwrite_reg(par, CMD_SLPOUT);\r\nmdelay(5);\r\nwrite_reg(par, CMD_PIXFMT, 0x05);\r\nwrite_reg(par, CMD_GAMMASET, 0x02);\r\n#ifdef GAMMA_ADJ\r\nwrite_reg(par, CMD_GAMRSEL, 0x01);\r\n#endif\r\nwrite_reg(par, CMD_NORML);\r\nwrite_reg(par, CMD_DFUNCTR, 0xff, 0x06);\r\nwrite_reg(par, CMD_FRMCTR1, 0x08, 0x02);\r\nwrite_reg(par, CMD_DINVCTR, 0x07);\r\nwrite_reg(par, CMD_PWCTR1, 0x0A, 0x02);\r\nwrite_reg(par, CMD_PWCTR2, 0x02);\r\nwrite_reg(par, CMD_VCOMCTR1, 0x50, 0x63);\r\nwrite_reg(par, CMD_VCOMOFFS, 0);\r\nwrite_reg(par, CMD_CLMADRS, 0, 0, 0, WIDTH);\r\nwrite_reg(par, CMD_PGEADRS, 0, 0, 0, HEIGHT);\r\nwrite_reg(par, CMD_DISPON);\r\nwrite_reg(par, CMD_RAMWR);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys,\r\nint xe, int ye)\r\n{\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, CMD_CLMADRS, xs >> 8, xs & 0xff, xe >> 8,\r\nxe & 0xff);\r\nwrite_reg(par, CMD_PGEADRS,\r\n(ys + __OFFSET) >> 8, (ys + __OFFSET) & 0xff,\r\n(ye + __OFFSET) >> 8, (ye + __OFFSET) & 0xff);\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, CMD_CLMADRS,\r\n(xs + __OFFSET) >> 8, (xs + __OFFSET) & 0xff,\r\n(xe + __OFFSET) >> 8, (xe + __OFFSET) & 0xff);\r\nwrite_reg(par, CMD_PGEADRS, ys >> 8, ys & 0xff, ye >> 8,\r\nye & 0xff);\r\nbreak;\r\ncase 180:\r\ncase 270:\r\nwrite_reg(par, CMD_CLMADRS, xs >> 8, xs & 0xff, xe >> 8,\r\nxe & 0xff);\r\nwrite_reg(par, CMD_PGEADRS, ys >> 8, ys & 0xff, ye >> 8,\r\nye & 0xff);\r\nbreak;\r\ndefault:\r\npar->info->var.rotate = 0;\r\n}\r\nwrite_reg(par, CMD_RAMWR);\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\nu8 mactrl_data = 0;\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nmactrl_data = 0x08;\r\nbreak;\r\ncase 180:\r\nmactrl_data = 0xC8;\r\nbreak;\r\ncase 270:\r\nmactrl_data = 0xA8;\r\nbreak;\r\ncase 90:\r\nmactrl_data = 0x68;\r\nbreak;\r\n}\r\nif (par->bgr)\r\nmactrl_data |= (1 << 2);\r\nwrite_reg(par, CMD_MADCTL, mactrl_data);\r\nwrite_reg(par, CMD_RAMWR);\r\nreturn 0;\r\n}\r\nstatic int gamma_adj(struct fbtft_par *par, unsigned long *curves)\r\n{\r\nunsigned long mask[] = {\r\n0x3F, 0x3F, 0x3F, 0x3F, 0x3F,\r\n0x1f, 0x3f, 0x0f, 0x0f, 0x7f, 0x1f,\r\n0x3F, 0x3F, 0x3F, 0x3F, 0x3F};\r\nint i, j;\r\nfor (i = 0; i < GAMMA_NUM; i++)\r\nfor (j = 0; j < GAMMA_LEN; j++)\r\nCURVE(i, j) &= mask[i * par->gamma.num_values + j];\r\nwrite_reg(par, CMD_PGAMMAC,\r\nCURVE(0, 0),\r\nCURVE(0, 1),\r\nCURVE(0, 2),\r\nCURVE(0, 3),\r\nCURVE(0, 4),\r\nCURVE(0, 5),\r\nCURVE(0, 6),\r\n(CURVE(0, 7) << 4) | CURVE(0, 8),\r\nCURVE(0, 9),\r\nCURVE(0, 10),\r\nCURVE(0, 11),\r\nCURVE(0, 12),\r\nCURVE(0, 13),\r\nCURVE(0, 14),\r\nCURVE(0, 15)\r\n);\r\nwrite_reg(par, CMD_RAMWR);\r\nreturn 0;\r\n}
