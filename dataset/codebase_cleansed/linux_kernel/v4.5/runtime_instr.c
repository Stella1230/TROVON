static void disable_runtime_instr(void)\r\n{\r\nstruct pt_regs *regs = task_pt_regs(current);\r\nload_runtime_instr_cb(&runtime_instr_empty_cb);\r\nregs->psw.mask &= ~PSW_MASK_RI;\r\n}\r\nstatic void init_runtime_instr_cb(struct runtime_instr_cb *cb)\r\n{\r\ncb->buf_limit = 0xfff;\r\ncb->pstate = 1;\r\ncb->pstate_set_buf = 1;\r\ncb->pstate_sample = 1;\r\ncb->pstate_collect = 1;\r\ncb->key = PAGE_DEFAULT_KEY;\r\ncb->valid = 1;\r\n}\r\nvoid exit_thread_runtime_instr(void)\r\n{\r\nstruct task_struct *task = current;\r\nif (!task->thread.ri_cb)\r\nreturn;\r\ndisable_runtime_instr();\r\nkfree(task->thread.ri_cb);\r\ntask->thread.ri_cb = NULL;\r\n}
