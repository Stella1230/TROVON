void omap4_cpu_die(unsigned int cpu)\r\n{\r\nunsigned int boot_cpu = 0;\r\nvoid __iomem *base = omap_get_wakeupgen_base();\r\nif (omap_secure_apis_support()) {\r\nif (omap_modify_auxcoreboot0(0x0, 0x200) != 0x0)\r\npr_err("Secure clear status failed\n");\r\n} else {\r\nwritel_relaxed(0, base + OMAP_AUX_CORE_BOOT_0);\r\n}\r\nfor (;;) {\r\nomap4_hotplug_cpu(cpu, PWRDM_POWER_OFF);\r\nif (omap_secure_apis_support())\r\nboot_cpu = omap_read_auxcoreboot0();\r\nelse\r\nboot_cpu =\r\nreadl_relaxed(base + OMAP_AUX_CORE_BOOT_0) >> 5;\r\nif (boot_cpu == smp_processor_id()) {\r\nbreak;\r\n}\r\npr_debug("CPU%u: spurious wakeup call\n", cpu);\r\n}\r\n}
