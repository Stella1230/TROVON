static void nft_dup_ipv6_eval(const struct nft_expr *expr,\r\nstruct nft_regs *regs,\r\nconst struct nft_pktinfo *pkt)\r\n{\r\nstruct nft_dup_ipv6 *priv = nft_expr_priv(expr);\r\nstruct in6_addr *gw = (struct in6_addr *)&regs->data[priv->sreg_addr];\r\nint oif = regs->data[priv->sreg_dev];\r\nnf_dup_ipv6(pkt->net, pkt->skb, pkt->hook, gw, oif);\r\n}\r\nstatic int nft_dup_ipv6_init(const struct nft_ctx *ctx,\r\nconst struct nft_expr *expr,\r\nconst struct nlattr * const tb[])\r\n{\r\nstruct nft_dup_ipv6 *priv = nft_expr_priv(expr);\r\nint err;\r\nif (tb[NFTA_DUP_SREG_ADDR] == NULL)\r\nreturn -EINVAL;\r\npriv->sreg_addr = nft_parse_register(tb[NFTA_DUP_SREG_ADDR]);\r\nerr = nft_validate_register_load(priv->sreg_addr, sizeof(struct in6_addr));\r\nif (err < 0)\r\nreturn err;\r\nif (tb[NFTA_DUP_SREG_DEV] != NULL) {\r\npriv->sreg_dev = nft_parse_register(tb[NFTA_DUP_SREG_DEV]);\r\nreturn nft_validate_register_load(priv->sreg_dev, sizeof(int));\r\n}\r\nreturn 0;\r\n}\r\nstatic int nft_dup_ipv6_dump(struct sk_buff *skb, const struct nft_expr *expr)\r\n{\r\nstruct nft_dup_ipv6 *priv = nft_expr_priv(expr);\r\nif (nft_dump_register(skb, NFTA_DUP_SREG_ADDR, priv->sreg_addr) ||\r\nnft_dump_register(skb, NFTA_DUP_SREG_DEV, priv->sreg_dev))\r\ngoto nla_put_failure;\r\nreturn 0;\r\nnla_put_failure:\r\nreturn -1;\r\n}\r\nstatic int __init nft_dup_ipv6_module_init(void)\r\n{\r\nreturn nft_register_expr(&nft_dup_ipv6_type);\r\n}\r\nstatic void __exit nft_dup_ipv6_module_exit(void)\r\n{\r\nnft_unregister_expr(&nft_dup_ipv6_type);\r\n}
