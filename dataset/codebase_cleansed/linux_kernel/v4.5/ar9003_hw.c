static void ar9003_hw_init_mode_regs(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_11(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9331_1p1_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9331_1p1_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9331_1p1_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9331_1p1_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9331_1p1_radio_core);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9331_1p1_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9331_1p1_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_rx_gain_1p1);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_lowest_ob_db_tx_gain_1p1);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9331_1p1_baseband_core_txfir_coeff_japan_2484);\r\nif (ah->is_clk_25mhz)\r\nINIT_INI_ARRAY(&ah->iniAdditional,\r\nar9331_1p1_xtal_25M);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniAdditional,\r\nar9331_1p1_xtal_40M);\r\n} else if (AR_SREV_9330_12(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9331_1p2_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9331_1p2_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9331_1p2_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9331_1p2_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9331_1p2_radio_core);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9331_1p2_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9331_1p2_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_rx_gain_1p2);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_lowest_ob_db_tx_gain_1p2);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9331_1p2_baseband_core_txfir_coeff_japan_2484);\r\nif (ah->is_clk_25mhz)\r\nINIT_INI_ARRAY(&ah->iniAdditional,\r\nar9331_1p2_xtal_25M);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniAdditional,\r\nar9331_1p2_xtal_40M);\r\n} else if (AR_SREV_9340(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9340_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9340_1p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9340_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9340_1p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9340_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9340_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9340_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9340_1p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9340Common_wo_xlna_rx_gain_table_1p0);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_high_ob_db_tx_gain_table_1p0);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9340Modes_fast_clock_1p0);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9340_1p0_baseband_core_txfir_coeff_japan_2484);\r\nINIT_INI_ARRAY(&ah->ini_dfs,\r\nar9340_1p0_baseband_postamble_dfs_channel);\r\nif (!ah->is_clk_25mhz)\r\nINIT_INI_ARRAY(&ah->iniAdditional,\r\nar9340_1p0_radio_core_40M);\r\n} else if (AR_SREV_9485_11_OR_LATER(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9485_1_1_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9485_1_1_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_PRE], ar9485_1_1);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9485_1_1_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9485_1_1_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9485_1_1_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9485_1_1_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9485_1_1_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9485Common_wo_xlna_rx_gain_1_1);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485_modes_lowest_ob_db_tx_gain_1_1);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9485_1_1_baseband_core_txfir_coeff_japan_2484);\r\nif (ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9485_1_1_pll_on_cdr_on_clkreq_disable_L1);\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9485_1_1_pll_on_cdr_on_clkreq_disable_L1);\r\n} else {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9485_1_1_pcie_phy_clkreq_disable_L1);\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9485_1_1_pcie_phy_clkreq_disable_L1);\r\n}\r\n} else if (AR_SREV_9462_21(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9462_2p1_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9462_2p1_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9462_2p1_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9462_2p1_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9462_2p1_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9462_2p1_radio_postamble);\r\nINIT_INI_ARRAY(&ah->ini_radio_post_sys2ant,\r\nar9462_2p1_radio_postamble_sys2ant);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9462_2p1_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9462_2p1_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p1_common_rx_gain);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9462_2p1_modes_fast_clock);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9462_2p1_baseband_core_txfir_coeff_japan_2484);\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D3)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9462_2p1_pciephy_clkreq_disable_L1);\r\n}\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D0)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9462_2p1_pciephy_clkreq_disable_L1);\r\n}\r\n} else if (AR_SREV_9462_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE], ar9462_2p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9462_2p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9462_2p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9462_2p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9462_2p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9462_2p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->ini_radio_post_sys2ant,\r\nar9462_2p0_radio_postamble_sys2ant);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9462_2p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9462_2p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p0_common_rx_gain);\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D3)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9462_2p0_pciephy_clkreq_disable_L1);\r\n}\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D0)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9462_2p0_pciephy_clkreq_disable_L1);\r\n}\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9462_2p0_modes_fast_clock);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9462_2p0_baseband_core_txfir_coeff_japan_2484);\r\n} else if (AR_SREV_9550(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar955x_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar955x_1p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar955x_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar955x_1p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar955x_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar955x_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar955x_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar955x_1p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar955x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nar955x_1p0_common_wo_xlna_rx_gain_bounds);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar955x_1p0_modes_xpa_tx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar955x_1p0_modes_fast_clock);\r\n} else if (AR_SREV_9531(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nqca953x_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nqca953x_1p0_mac_postamble);\r\nif (AR_SREV_9531_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nqca953x_2p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nqca953x_2p0_baseband_postamble);\r\n} else {\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nqca953x_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nqca953x_1p0_baseband_postamble);\r\n}\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nqca953x_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nqca953x_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nqca953x_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nqca953x_1p0_soc_postamble);\r\nif (AR_SREV_9531_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca953x_2p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca953x_2p0_common_wo_xlna_rx_gain_bounds);\r\n} else {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca953x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca953x_1p0_common_wo_xlna_rx_gain_bounds);\r\n}\r\nif (AR_SREV_9531_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_2p0_modes_no_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p1_modes_no_xpa_tx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p0_modes_no_xpa_tx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nqca953x_1p0_modes_fast_clock);\r\n} else if (AR_SREV_9561(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nqca956x_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nqca956x_1p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nqca956x_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nqca956x_1p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nqca956x_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nqca956x_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nqca956x_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nqca956x_1p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca956x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca956x_1p0_common_wo_xlna_rx_gain_bounds);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca956x_1p0_modes_no_xpa_tx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_dfs,\r\nqca956x_1p0_baseband_postamble_dfs_channel);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nqca956x_1p0_baseband_core_txfir_coeff_japan_2484);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nqca956x_1p0_modes_fast_clock);\r\n} else if (AR_SREV_9580(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9580_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9580_1p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9580_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9580_1p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9580_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9580_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9580_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9580_1p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9580_1p0_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_low_ob_db_tx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9580_1p0_modes_fast_clock);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9580_1p0_baseband_core_txfir_coeff_japan_2484);\r\nINIT_INI_ARRAY(&ah->ini_dfs,\r\nar9580_1p0_baseband_postamble_dfs_channel);\r\n} else if (AR_SREV_9565_11_OR_LATER(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9565_1p1_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9565_1p1_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9565_1p1_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9565_1p1_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9565_1p1_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9565_1p1_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9565_1p1_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9565_1p1_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p1_Common_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p1_Modes_lowest_ob_db_tx_gain_table);\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D3)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9565_1p1_pciephy_clkreq_disable_L1);\r\n}\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D0)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9565_1p1_pciephy_clkreq_disable_L1);\r\n}\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9565_1p1_modes_fast_clock);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9565_1p1_baseband_core_txfir_coeff_japan_2484);\r\n} else if (AR_SREV_9565(ah)) {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9565_1p0_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9565_1p0_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9565_1p0_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9565_1p0_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9565_1p0_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9565_1p0_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9565_1p0_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9565_1p0_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p0_Common_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p0_Modes_lowest_ob_db_tx_gain_table);\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D3)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9565_1p0_pciephy_clkreq_disable_L1);\r\n}\r\nif ((ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_CONTROL) &&\r\n(ah->config.pll_pwrsave & AR_PCIE_PLL_PWRSAVE_ON_D0)) {\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9565_1p0_pciephy_clkreq_disable_L1);\r\n}\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9565_1p0_modes_fast_clock);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9565_1p0_baseband_core_txfir_coeff_japan_2484);\r\n} else {\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_CORE],\r\nar9300_2p2_mac_core);\r\nINIT_INI_ARRAY(&ah->iniMac[ATH_INI_POST],\r\nar9300_2p2_mac_postamble);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_CORE],\r\nar9300_2p2_baseband_core);\r\nINIT_INI_ARRAY(&ah->iniBB[ATH_INI_POST],\r\nar9300_2p2_baseband_postamble);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_CORE],\r\nar9300_2p2_radio_core);\r\nINIT_INI_ARRAY(&ah->iniRadio[ATH_INI_POST],\r\nar9300_2p2_radio_postamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_PRE],\r\nar9300_2p2_soc_preamble);\r\nINIT_INI_ARRAY(&ah->iniSOC[ATH_INI_POST],\r\nar9300_2p2_soc_postamble);\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9300Common_rx_gain_table_2p2);\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_lowest_ob_db_tx_gain_table_2p2);\r\nINIT_INI_ARRAY(&ah->iniPcieSerdes,\r\nar9300PciePhy_pll_on_clkreq_disable_L1_2p2);\r\nINIT_INI_ARRAY(&ah->iniPcieSerdesLowPower,\r\nar9300PciePhy_pll_on_clkreq_disable_L1_2p2);\r\nINIT_INI_ARRAY(&ah->iniModesFastClock,\r\nar9300Modes_fast_clock_2p2);\r\nINIT_INI_ARRAY(&ah->iniCckfirJapan2484,\r\nar9300_2p2_baseband_core_txfir_coeff_japan_2484);\r\nINIT_INI_ARRAY(&ah->ini_dfs,\r\nar9300_2p2_baseband_postamble_dfs_channel);\r\n}\r\n}\r\nstatic void ar9003_tx_gain_table_mode0(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_lowest_ob_db_tx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_lowest_ob_db_tx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_lowest_ob_db_tx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485_modes_lowest_ob_db_tx_gain_1_1);\r\nelse if (AR_SREV_9550(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar955x_1p0_modes_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531_10(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p0_modes_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p1_modes_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_2p0_modes_xpa_tx_gain_table);\r\nelse if (AR_SREV_9561(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca956x_1p0_modes_xpa_tx_gain_table);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_lowest_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9462_21(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p1_modes_low_ob_db_tx_gain);\r\nelse if (AR_SREV_9462_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p0_modes_low_ob_db_tx_gain);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p1_modes_low_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p0_modes_low_ob_db_tx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_lowest_ob_db_tx_gain_table_2p2);\r\n}\r\nstatic void ar9003_tx_gain_table_mode1(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_high_ob_db_tx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_high_ob_db_tx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_high_ob_db_tx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485Modes_high_ob_db_tx_gain_1_1);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_high_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9550(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar955x_1p0_modes_no_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531(ah)) {\r\nif (AR_SREV_9531_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_2p0_modes_no_xpa_tx_gain_table);\r\nelse if (AR_SREV_9531_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p1_modes_no_xpa_tx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca953x_1p0_modes_no_xpa_tx_gain_table);\r\n} else if (AR_SREV_9561(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca956x_1p0_modes_no_xpa_tx_gain_table);\r\nelse if (AR_SREV_9462_21(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p1_modes_high_ob_db_tx_gain);\r\nelse if (AR_SREV_9462_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p0_modes_high_ob_db_tx_gain);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p1_modes_high_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p0_modes_high_ob_db_tx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_high_ob_db_tx_gain_table_2p2);\r\n}\r\nstatic void ar9003_tx_gain_table_mode2(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_low_ob_db_tx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_low_ob_db_tx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_low_ob_db_tx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485Modes_low_ob_db_tx_gain_1_1);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_low_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9561(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca956x_1p0_modes_no_xpa_low_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p1_modes_low_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p0_modes_low_ob_db_tx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_low_ob_db_tx_gain_table_2p2);\r\n}\r\nstatic void ar9003_tx_gain_table_mode3(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_high_power_tx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9331_modes_high_power_tx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_high_power_tx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485Modes_high_power_tx_gain_1_1);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_high_power_tx_gain_table);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p1_modes_high_power_tx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9565_1p0_modes_high_power_tx_gain_table);\r\nelse {\r\nif (ah->config.tx_gain_buffalo)\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_high_power_tx_gain_table_buffalo);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_high_power_tx_gain_table_2p2);\r\n}\r\n}\r\nstatic void ar9003_tx_gain_table_mode4(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_mixed_ob_db_tx_gain_table_1p0);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_mixed_ob_db_tx_gain_table);\r\nelse if (AR_SREV_9462_21(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p1_modes_mix_ob_db_tx_gain);\r\nelse if (AR_SREV_9462_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9462_2p0_modes_mix_ob_db_tx_gain);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_mixed_ob_db_tx_gain_table_2p2);\r\n}\r\nstatic void ar9003_tx_gain_table_mode5(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485Modes_green_ob_db_tx_gain_1_1);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_type5_tx_gain_table);\r\nelse if (AR_SREV_9561(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nqca956x_1p0_modes_no_xpa_green_tx_gain_table);\r\nelse if (AR_SREV_9300_22(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9300Modes_type5_tx_gain_table_2p2);\r\n}\r\nstatic void ar9003_tx_gain_table_mode6(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340Modes_low_ob_db_and_spur_tx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9485Modes_green_spur_ob_db_tx_gain_1_1);\r\nelse if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9580_1p0_type6_tx_gain_table);\r\n}\r\nstatic void ar9003_tx_gain_table_mode7(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesTxGain,\r\nar9340_cus227_tx_gain_table_1p0);\r\n}\r\nstatic void ar9003_tx_gain_table_apply(struct ath_hw *ah)\r\n{\r\nstatic const ath_txgain_tab modes[] = {\r\nar9003_tx_gain_table_mode0,\r\nar9003_tx_gain_table_mode1,\r\nar9003_tx_gain_table_mode2,\r\nar9003_tx_gain_table_mode3,\r\nar9003_tx_gain_table_mode4,\r\nar9003_tx_gain_table_mode5,\r\nar9003_tx_gain_table_mode6,\r\nar9003_tx_gain_table_mode7,\r\n};\r\nint idx = ar9003_hw_get_tx_gain_idx(ah);\r\nif (idx >= ARRAY_SIZE(modes))\r\nidx = 0;\r\nmodes[idx](ah);\r\n}\r\nstatic void ar9003_rx_gain_table_mode0(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_rx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_rx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9340Common_rx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9485_common_rx_gain_1_1);\r\nelse if (AR_SREV_9550(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar955x_1p0_common_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nar955x_1p0_common_rx_gain_bounds);\r\n} else if (AR_SREV_9531(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca953x_1p0_common_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca953x_1p0_common_rx_gain_bounds);\r\n} else if (AR_SREV_9561(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca956x_1p0_common_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca956x_1p0_common_rx_gain_bounds);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_xlna,\r\nqca956x_1p0_xlna_only);\r\n} else if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9580_1p0_rx_gain_table);\r\nelse if (AR_SREV_9462_21(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p1_common_rx_gain);\r\nelse if (AR_SREV_9462_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p0_common_rx_gain);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p1_Common_rx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p0_Common_rx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9300Common_rx_gain_table_2p2);\r\n}\r\nstatic void ar9003_rx_gain_table_mode1(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9330_12(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_wo_xlna_rx_gain_1p2);\r\nelse if (AR_SREV_9330_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9331_common_wo_xlna_rx_gain_1p1);\r\nelse if (AR_SREV_9340(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9340Common_wo_xlna_rx_gain_table_1p0);\r\nelse if (AR_SREV_9485_11_OR_LATER(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9485Common_wo_xlna_rx_gain_1_1);\r\nelse if (AR_SREV_9462_21(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p1_common_wo_xlna_rx_gain);\r\nelse if (AR_SREV_9462_20(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p0_common_wo_xlna_rx_gain);\r\nelse if (AR_SREV_9550(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar955x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nar955x_1p0_common_wo_xlna_rx_gain_bounds);\r\n} else if (AR_SREV_9531_10(ah) || AR_SREV_9531_11(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca953x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca953x_1p0_common_wo_xlna_rx_gain_bounds);\r\n} else if (AR_SREV_9531_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca953x_2p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca953x_2p0_common_wo_xlna_rx_gain_bounds);\r\n} else if (AR_SREV_9561(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nqca956x_1p0_common_wo_xlna_rx_gain_table);\r\nINIT_INI_ARRAY(&ah->ini_modes_rx_gain_bounds,\r\nqca956x_1p0_common_wo_xlna_rx_gain_bounds);\r\n} else if (AR_SREV_9580(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9580_1p0_wo_xlna_rx_gain_table);\r\nelse if (AR_SREV_9565_11(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p1_common_wo_xlna_rx_gain_table);\r\nelse if (AR_SREV_9565(ah))\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9565_1p0_common_wo_xlna_rx_gain_table);\r\nelse\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9300Common_wo_xlna_rx_gain_table_2p2);\r\n}\r\nstatic void ar9003_rx_gain_table_mode2(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9462_21(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p1_common_mixed_rx_gain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_bb_core,\r\nar9462_2p1_baseband_core_mix_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_bb_postamble,\r\nar9462_2p1_baseband_postamble_mix_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_xlna,\r\nar9462_2p1_baseband_postamble_5g_xlna);\r\n} else if (AR_SREV_9462_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p0_common_mixed_rx_gain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_bb_core,\r\nar9462_2p0_baseband_core_mix_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_bb_postamble,\r\nar9462_2p0_baseband_postamble_mix_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_xlna,\r\nar9462_2p0_baseband_postamble_5g_xlna);\r\n}\r\n}\r\nstatic void ar9003_rx_gain_table_mode3(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9462_21(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p1_common_5g_xlna_only_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_xlna,\r\nar9462_2p1_baseband_postamble_5g_xlna);\r\n} else if (AR_SREV_9462_20(ah)) {\r\nINIT_INI_ARRAY(&ah->iniModesRxGain,\r\nar9462_2p0_common_5g_xlna_only_rxgain);\r\nINIT_INI_ARRAY(&ah->ini_modes_rxgain_xlna,\r\nar9462_2p0_baseband_postamble_5g_xlna);\r\n}\r\n}\r\nstatic void ar9003_rx_gain_table_apply(struct ath_hw *ah)\r\n{\r\nswitch (ar9003_hw_get_rx_gain_idx(ah)) {\r\ncase 0:\r\ndefault:\r\nar9003_rx_gain_table_mode0(ah);\r\nbreak;\r\ncase 1:\r\nar9003_rx_gain_table_mode1(ah);\r\nbreak;\r\ncase 2:\r\nar9003_rx_gain_table_mode2(ah);\r\nbreak;\r\ncase 3:\r\nar9003_rx_gain_table_mode3(ah);\r\nbreak;\r\n}\r\n}\r\nstatic void ar9003_hw_init_mode_gain_regs(struct ath_hw *ah)\r\n{\r\nar9003_tx_gain_table_apply(ah);\r\nar9003_rx_gain_table_apply(ah);\r\n}\r\nstatic void ar9003_hw_configpcipowersave(struct ath_hw *ah,\r\nbool power_off)\r\n{\r\nunsigned int i;\r\nstruct ar5416IniArray *array;\r\nif (AR_SREV_9462(ah)) {\r\nu32 val = ah->config.aspm_l1_fix;\r\nif ((val & 0xff000000) == 0x17000000) {\r\nval &= 0x00ffffff;\r\nval |= 0x27000000;\r\nREG_WRITE(ah, 0x570c, val);\r\n}\r\n}\r\nif (!power_off ) {\r\nREG_SET_BIT(ah, AR_PCIE_PM_CTRL, AR_PCIE_PM_CTRL_ENA);\r\nREG_WRITE(ah, AR_WA, ah->WARegVal);\r\n}\r\narray = power_off ? &ah->iniPcieSerdes :\r\n&ah->iniPcieSerdesLowPower;\r\nfor (i = 0; i < array->ia_rows; i++) {\r\nREG_WRITE(ah,\r\nINI_RA(array, i, 0),\r\nINI_RA(array, i, 1));\r\n}\r\n}\r\nstatic void ar9003_hw_init_hang_checks(struct ath_hw *ah)\r\n{\r\nah->config.hw_hang_checks |= HW_BB_WATCHDOG;\r\nah->config.hw_hang_checks |= HW_MAC_HANG;\r\nif (AR_SREV_9300_22(ah))\r\nah->config.hw_hang_checks |= HW_PHYRESTART_CLC_WAR;\r\nif (AR_SREV_9330(ah))\r\nah->bb_watchdog_timeout_ms = 85;\r\nelse\r\nah->bb_watchdog_timeout_ms = 25;\r\n}\r\nstatic bool ath9k_hw_verify_hang(struct ath_hw *ah, unsigned int queue)\r\n{\r\nu32 dma_dbg_chain, dma_dbg_complete;\r\nu8 dcu_chain_state, dcu_complete_state;\r\nint i;\r\nfor (i = 0; i < NUM_STATUS_READS; i++) {\r\nif (queue < 6)\r\ndma_dbg_chain = REG_READ(ah, AR_DMADBG_4);\r\nelse\r\ndma_dbg_chain = REG_READ(ah, AR_DMADBG_5);\r\ndma_dbg_complete = REG_READ(ah, AR_DMADBG_6);\r\ndcu_chain_state = (dma_dbg_chain >> (5 * queue)) & 0x1f;\r\ndcu_complete_state = dma_dbg_complete & 0x3;\r\nif ((dcu_chain_state != 0x6) || (dcu_complete_state != 0x1))\r\nreturn false;\r\n}\r\nath_dbg(ath9k_hw_common(ah), RESET,\r\n"MAC Hang signature found for queue: %d\n", queue);\r\nreturn true;\r\n}\r\nstatic bool ar9003_hw_detect_mac_hang(struct ath_hw *ah)\r\n{\r\nu32 dma_dbg_4, dma_dbg_5, dma_dbg_6, chk_dbg;\r\nu8 dcu_chain_state, dcu_complete_state;\r\nbool dcu_wait_frdone = false;\r\nunsigned long chk_dcu = 0;\r\nunsigned int i = 0;\r\ndma_dbg_4 = REG_READ(ah, AR_DMADBG_4);\r\ndma_dbg_5 = REG_READ(ah, AR_DMADBG_5);\r\ndma_dbg_6 = REG_READ(ah, AR_DMADBG_6);\r\ndcu_complete_state = dma_dbg_6 & 0x3;\r\nif (dcu_complete_state != 0x1)\r\ngoto exit;\r\nfor (i = 0; i < ATH9K_NUM_TX_QUEUES; i++) {\r\nif (i < 6)\r\nchk_dbg = dma_dbg_4;\r\nelse\r\nchk_dbg = dma_dbg_5;\r\ndcu_chain_state = (chk_dbg >> (5 * i)) & 0x1f;\r\nif (dcu_chain_state == 0x6) {\r\ndcu_wait_frdone = true;\r\nchk_dcu |= BIT(i);\r\n}\r\n}\r\nif ((dcu_complete_state == 0x1) && dcu_wait_frdone) {\r\nfor_each_set_bit(i, &chk_dcu, ATH9K_NUM_TX_QUEUES) {\r\nif (ath9k_hw_verify_hang(ah, i))\r\nreturn true;\r\n}\r\n}\r\nexit:\r\nreturn false;\r\n}\r\nvoid ar9003_hw_attach_ops(struct ath_hw *ah)\r\n{\r\nstruct ath_hw_private_ops *priv_ops = ath9k_hw_private_ops(ah);\r\nstruct ath_hw_ops *ops = ath9k_hw_ops(ah);\r\nar9003_hw_init_mode_regs(ah);\r\nif (AR_SREV_9003_PCOEM(ah)) {\r\nWARN_ON(!ah->iniPcieSerdes.ia_array);\r\nWARN_ON(!ah->iniPcieSerdesLowPower.ia_array);\r\n}\r\npriv_ops->init_mode_gain_regs = ar9003_hw_init_mode_gain_regs;\r\npriv_ops->init_hang_checks = ar9003_hw_init_hang_checks;\r\npriv_ops->detect_mac_hang = ar9003_hw_detect_mac_hang;\r\nops->config_pci_powersave = ar9003_hw_configpcipowersave;\r\nar9003_hw_attach_phy_ops(ah);\r\nar9003_hw_attach_calib_ops(ah);\r\nar9003_hw_attach_mac_ops(ah);\r\nar9003_hw_attach_aic_ops(ah);\r\n}
