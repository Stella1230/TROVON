int l3mdev_master_ifindex_rcu(struct net_device *dev)\r\n{\r\nint ifindex = 0;\r\nif (!dev)\r\nreturn 0;\r\nif (netif_is_l3_master(dev)) {\r\nifindex = dev->ifindex;\r\n} else if (netif_is_l3_slave(dev)) {\r\nstruct net_device *master;\r\nmaster = netdev_master_upper_dev_get_rcu(dev);\r\nif (master)\r\nifindex = master->ifindex;\r\n}\r\nreturn ifindex;\r\n}\r\nu32 l3mdev_fib_table_rcu(const struct net_device *dev)\r\n{\r\nu32 tb_id = 0;\r\nif (!dev)\r\nreturn 0;\r\nif (netif_is_l3_master(dev)) {\r\nif (dev->l3mdev_ops->l3mdev_fib_table)\r\ntb_id = dev->l3mdev_ops->l3mdev_fib_table(dev);\r\n} else if (netif_is_l3_slave(dev)) {\r\nstruct net_device *_dev = (struct net_device *) dev;\r\nconst struct net_device *master;\r\nmaster = netdev_master_upper_dev_get_rcu(_dev);\r\nif (master &&\r\nmaster->l3mdev_ops->l3mdev_fib_table)\r\ntb_id = master->l3mdev_ops->l3mdev_fib_table(master);\r\n}\r\nreturn tb_id;\r\n}\r\nu32 l3mdev_fib_table_by_index(struct net *net, int ifindex)\r\n{\r\nstruct net_device *dev;\r\nu32 tb_id = 0;\r\nif (!ifindex)\r\nreturn 0;\r\nrcu_read_lock();\r\ndev = dev_get_by_index_rcu(net, ifindex);\r\nif (dev)\r\ntb_id = l3mdev_fib_table_rcu(dev);\r\nrcu_read_unlock();\r\nreturn tb_id;\r\n}
