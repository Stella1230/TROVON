static void asp_choose_irq(struct parisc_device *dev, void *ctrl)\r\n{\r\nint irq;\r\nswitch (dev->id.sversion) {\r\ncase 0x71: irq = 9; break;\r\ncase 0x72: irq = 8; break;\r\ncase 0x73: irq = 1; break;\r\ncase 0x74: irq = 7; break;\r\ncase 0x75: irq = (dev->hw_path == 4) ? 5 : 6; break;\r\ncase 0x76: irq = 10; break;\r\ncase 0x77: irq = 11; break;\r\ncase 0x7a: irq = 13; break;\r\ncase 0x7b: irq = 13; break;\r\ncase 0x7c: irq = 3; break;\r\ncase 0x7d: irq = 4; break;\r\ncase 0x7f: irq = 13; break;\r\ndefault: return;\r\n}\r\ngsc_asic_assign_irq(ctrl, irq, &dev->irq);\r\nswitch (dev->id.sversion) {\r\ncase 0x73: irq = 2; break;\r\ncase 0x76: irq = 0; break;\r\ndefault: return;\r\n}\r\ngsc_asic_assign_irq(ctrl, irq, &dev->aux_irq);\r\n}\r\nstatic int __init asp_init_chip(struct parisc_device *dev)\r\n{\r\nstruct gsc_irq gsc_irq;\r\nint ret;\r\nasp.version = gsc_readb(dev->hpa.start + ASP_VER_OFFSET) & 0xf;\r\nasp.name = (asp.version == 1) ? "Asp" : "Cutoff";\r\nasp.hpa = ASP_INTERRUPT_ADDR;\r\nprintk(KERN_INFO "%s version %d at 0x%lx found.\n",\r\nasp.name, asp.version, (unsigned long)dev->hpa.start);\r\nret = -EBUSY;\r\ndev->irq = gsc_claim_irq(&gsc_irq, ASP_GSC_IRQ);\r\nif (dev->irq < 0) {\r\nprintk(KERN_ERR "%s(): cannot get GSC irq\n", __func__);\r\ngoto out;\r\n}\r\nasp.eim = ((u32) gsc_irq.txn_addr) | gsc_irq.txn_data;\r\nret = request_irq(gsc_irq.irq, gsc_asic_intr, 0, "asp", &asp);\r\nif (ret < 0)\r\ngoto out;\r\ngsc_writel((1 << (31 - ASP_GSC_IRQ)),VIPER_INT_WORD);\r\nret = gsc_common_setup(dev, &asp);\r\nif (ret)\r\ngoto out;\r\ngsc_fixup_irqs(dev, &asp, asp_choose_irq);\r\ngsc_fixup_irqs(parisc_parent(dev), &asp, asp_choose_irq);\r\n#ifdef CONFIG_CHASSIS_LCD_LED\r\nregister_led_driver(DISPLAY_MODEL_OLD_ASP, LED_CMD_REG_NONE,\r\nASP_LED_ADDR);\r\n#endif\r\nout:\r\nreturn ret;\r\n}
