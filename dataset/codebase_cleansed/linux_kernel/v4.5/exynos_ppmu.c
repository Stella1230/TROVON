void exynos_ppmu_reset(void __iomem *ppmu_base)\r\n{\r\n__raw_writel(PPMU_CYCLE_RESET | PPMU_COUNTER_RESET, ppmu_base);\r\n__raw_writel(PPMU_ENABLE_CYCLE |\r\nPPMU_ENABLE_COUNT0 |\r\nPPMU_ENABLE_COUNT1 |\r\nPPMU_ENABLE_COUNT2 |\r\nPPMU_ENABLE_COUNT3,\r\nppmu_base + PPMU_CNTENS);\r\n}\r\nvoid exynos_ppmu_setevent(void __iomem *ppmu_base, unsigned int ch,\r\nunsigned int evt)\r\n{\r\n__raw_writel(evt, ppmu_base + PPMU_BEVTSEL(ch));\r\n}\r\nvoid exynos_ppmu_start(void __iomem *ppmu_base)\r\n{\r\n__raw_writel(PPMU_ENABLE, ppmu_base);\r\n}\r\nvoid exynos_ppmu_stop(void __iomem *ppmu_base)\r\n{\r\n__raw_writel(PPMU_DISABLE, ppmu_base);\r\n}\r\nunsigned int exynos_ppmu_read(void __iomem *ppmu_base, unsigned int ch)\r\n{\r\nunsigned int total;\r\nif (ch == PPMU_PMNCNT3)\r\ntotal = ((__raw_readl(ppmu_base + PMCNT_OFFSET(ch)) << 8) |\r\n__raw_readl(ppmu_base + PMCNT_OFFSET(ch + 1)));\r\nelse\r\ntotal = __raw_readl(ppmu_base + PMCNT_OFFSET(ch));\r\nreturn total;\r\n}\r\nvoid busfreq_mon_reset(struct busfreq_ppmu_data *ppmu_data)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < ppmu_data->ppmu_end; i++) {\r\nvoid __iomem *ppmu_base = ppmu_data->ppmu[i].hw_base;\r\nexynos_ppmu_reset(ppmu_base);\r\nppmu_data->ppmu[i].event[PPMU_PMNCNT3] = RDWR_DATA_COUNT;\r\nexynos_ppmu_setevent(ppmu_base, PPMU_PMNCNT3,\r\nppmu_data->ppmu[i].event[PPMU_PMNCNT3]);\r\nexynos_ppmu_start(ppmu_base);\r\n}\r\n}\r\nvoid exynos_read_ppmu(struct busfreq_ppmu_data *ppmu_data)\r\n{\r\nint i, j;\r\nfor (i = 0; i < ppmu_data->ppmu_end; i++) {\r\nvoid __iomem *ppmu_base = ppmu_data->ppmu[i].hw_base;\r\nexynos_ppmu_stop(ppmu_base);\r\nppmu_data->ppmu[i].ccnt = __raw_readl(ppmu_base + PPMU_CCNT);\r\nfor (j = PPMU_PMNCNT0; j < PPMU_PMNCNT_MAX; j++) {\r\nif (ppmu_data->ppmu[i].event[j] == 0)\r\nppmu_data->ppmu[i].count[j] = 0;\r\nelse\r\nppmu_data->ppmu[i].count[j] =\r\nexynos_ppmu_read(ppmu_base, j);\r\n}\r\n}\r\nbusfreq_mon_reset(ppmu_data);\r\n}\r\nint exynos_get_busier_ppmu(struct busfreq_ppmu_data *ppmu_data)\r\n{\r\nunsigned int count = 0;\r\nint i, j, busy = 0;\r\nfor (i = 0; i < ppmu_data->ppmu_end; i++) {\r\nfor (j = PPMU_PMNCNT0; j < PPMU_PMNCNT_MAX; j++) {\r\nif (ppmu_data->ppmu[i].count[j] > count) {\r\ncount = ppmu_data->ppmu[i].count[j];\r\nbusy = i;\r\n}\r\n}\r\n}\r\nreturn busy;\r\n}
