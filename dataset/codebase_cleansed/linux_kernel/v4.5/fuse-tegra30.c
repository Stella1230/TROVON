static u32 tegra30_fuse_read_early(struct tegra_fuse *fuse, unsigned int offset)\r\n{\r\nreturn readl_relaxed(fuse->base + FUSE_BEGIN + offset);\r\n}\r\nstatic u32 tegra30_fuse_read(struct tegra_fuse *fuse, unsigned int offset)\r\n{\r\nu32 value;\r\nint err;\r\nerr = clk_prepare_enable(fuse->clk);\r\nif (err < 0) {\r\ndev_err(fuse->dev, "failed to enable FUSE clock: %d\n", err);\r\nreturn 0;\r\n}\r\nvalue = readl_relaxed(fuse->base + FUSE_BEGIN + offset);\r\nclk_disable_unprepare(fuse->clk);\r\nreturn value;\r\n}\r\nstatic void __init tegra30_fuse_add_randomness(void)\r\n{\r\nu32 randomness[12];\r\nrandomness[0] = tegra_sku_info.sku_id;\r\nrandomness[1] = tegra_read_straps();\r\nrandomness[2] = tegra_read_chipid();\r\nrandomness[3] = tegra_sku_info.cpu_process_id << 16;\r\nrandomness[3] |= tegra_sku_info.soc_process_id;\r\nrandomness[4] = tegra_sku_info.cpu_speedo_id << 16;\r\nrandomness[4] |= tegra_sku_info.soc_speedo_id;\r\nrandomness[5] = tegra_fuse_read_early(FUSE_VENDOR_CODE);\r\nrandomness[6] = tegra_fuse_read_early(FUSE_FAB_CODE);\r\nrandomness[7] = tegra_fuse_read_early(FUSE_LOT_CODE_0);\r\nrandomness[8] = tegra_fuse_read_early(FUSE_LOT_CODE_1);\r\nrandomness[9] = tegra_fuse_read_early(FUSE_WAFER_ID);\r\nrandomness[10] = tegra_fuse_read_early(FUSE_X_COORDINATE);\r\nrandomness[11] = tegra_fuse_read_early(FUSE_Y_COORDINATE);\r\nadd_device_randomness(randomness, sizeof(randomness));\r\n}\r\nstatic void __init tegra30_fuse_init(struct tegra_fuse *fuse)\r\n{\r\nfuse->read_early = tegra30_fuse_read_early;\r\nfuse->read = tegra30_fuse_read;\r\ntegra_init_revision();\r\nfuse->soc->speedo_init(&tegra_sku_info);\r\ntegra30_fuse_add_randomness();\r\n}
