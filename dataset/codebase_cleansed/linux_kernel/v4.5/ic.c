static bool\r\nprobe_monitoring_device(struct nvkm_i2c_bus *bus,\r\nstruct i2c_board_info *info, void *data)\r\n{\r\nstruct nvkm_therm *therm = data;\r\nstruct nvbios_therm_sensor *sensor = &therm->bios_sensor;\r\nstruct i2c_client *client;\r\nrequest_module("%s%s", I2C_MODULE_PREFIX, info->type);\r\nclient = i2c_new_device(&bus->i2c, info);\r\nif (!client)\r\nreturn false;\r\nif (!client->dev.driver ||\r\nto_i2c_driver(client->dev.driver)->detect(client, info)) {\r\ni2c_unregister_device(client);\r\nreturn false;\r\n}\r\nnvkm_debug(&therm->subdev,\r\n"Found an %s at address 0x%x (controlled by lm_sensors, "\r\n"temp offset %+i C)\n",\r\ninfo->type, info->addr, sensor->offset_constant);\r\ntherm->ic = client;\r\nreturn true;\r\n}\r\nvoid\r\nnvkm_therm_ic_ctor(struct nvkm_therm *therm)\r\n{\r\nstruct nvkm_device *device = therm->subdev.device;\r\nstruct nvkm_bios *bios = device->bios;\r\nstruct nvkm_i2c *i2c = device->i2c;\r\nstruct nvkm_i2c_bus *bus;\r\nstruct nvbios_extdev_func extdev_entry;\r\nbus = nvkm_i2c_bus_find(i2c, NVKM_I2C_BUS_PRI);\r\nif (!bus)\r\nreturn;\r\nif (!nvbios_extdev_find(bios, NVBIOS_EXTDEV_LM89, &extdev_entry)) {\r\nstruct nvkm_i2c_bus_probe board[] = {\r\n{ { I2C_BOARD_INFO("lm90", extdev_entry.addr >> 1) }, 0},\r\n{ }\r\n};\r\nnvkm_i2c_bus_probe(bus, "monitoring device", board,\r\nprobe_monitoring_device, therm);\r\nif (therm->ic)\r\nreturn;\r\n}\r\nif (!nvbios_extdev_find(bios, NVBIOS_EXTDEV_ADT7473, &extdev_entry)) {\r\nstruct nvkm_i2c_bus_probe board[] = {\r\n{ { I2C_BOARD_INFO("adt7473", extdev_entry.addr >> 1) }, 20 },\r\n{ }\r\n};\r\nnvkm_i2c_bus_probe(bus, "monitoring device", board,\r\nprobe_monitoring_device, therm);\r\nif (therm->ic)\r\nreturn;\r\n}\r\nnvkm_i2c_bus_probe(bus, "monitoring device", nv_board_infos,\r\nprobe_monitoring_device, therm);\r\n}
