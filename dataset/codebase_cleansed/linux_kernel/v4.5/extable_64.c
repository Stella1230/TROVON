static const struct exception_table_entry *check_exception_ranges(unsigned long addr)\r\n{\r\nif ((addr >= (unsigned long)&copy_user_memcpy) &&\r\n(addr <= (unsigned long)&copy_user_memcpy_end))\r\nreturn &__copy_user_fixup_ex;\r\nreturn NULL;\r\n}\r\nconst struct exception_table_entry *\r\nsearch_extable(const struct exception_table_entry *first,\r\nconst struct exception_table_entry *last,\r\nunsigned long value)\r\n{\r\nconst struct exception_table_entry *mid;\r\nmid = check_exception_ranges(value);\r\nif (mid)\r\nreturn mid;\r\nwhile (first <= last) {\r\nlong diff;\r\nmid = (last - first) / 2 + first;\r\ndiff = mid->insn - value;\r\nif (diff == 0)\r\nreturn mid;\r\nelse if (diff < 0)\r\nfirst = mid+1;\r\nelse\r\nlast = mid-1;\r\n}\r\nreturn NULL;\r\n}\r\nint fixup_exception(struct pt_regs *regs)\r\n{\r\nconst struct exception_table_entry *fixup;\r\nfixup = search_exception_tables(regs->pc);\r\nif (fixup) {\r\nregs->pc = fixup->fixup;\r\nreturn 1;\r\n}\r\nreturn 0;\r\n}
