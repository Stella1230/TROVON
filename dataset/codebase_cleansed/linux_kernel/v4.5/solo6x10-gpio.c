static void solo_gpio_mode(struct solo_dev *solo_dev,\r\nunsigned int port_mask, unsigned int mode)\r\n{\r\nint port;\r\nunsigned int ret;\r\nret = solo_reg_read(solo_dev, SOLO_GPIO_CONFIG_0);\r\nfor (port = 0; port < 16; port++) {\r\nif (!((1 << port) & port_mask))\r\ncontinue;\r\nret &= (~(3 << (port << 1)));\r\nret |= ((mode & 3) << (port << 1));\r\n}\r\nsolo_reg_write(solo_dev, SOLO_GPIO_CONFIG_0, ret);\r\nret = solo_reg_read(solo_dev, SOLO_GPIO_CONFIG_1);\r\nfor (port = 0; port < 16; port++) {\r\nif (!((1 << (port + 16)) & port_mask))\r\ncontinue;\r\nif (!mode)\r\nret &= ~(1 << port);\r\nelse\r\nret |= 1 << port;\r\n}\r\nsolo_reg_write(solo_dev, SOLO_GPIO_CONFIG_1, ret);\r\n}\r\nstatic void solo_gpio_set(struct solo_dev *solo_dev, unsigned int value)\r\n{\r\nsolo_reg_write(solo_dev, SOLO_GPIO_DATA_OUT,\r\nsolo_reg_read(solo_dev, SOLO_GPIO_DATA_OUT) | value);\r\n}\r\nstatic void solo_gpio_clear(struct solo_dev *solo_dev, unsigned int value)\r\n{\r\nsolo_reg_write(solo_dev, SOLO_GPIO_DATA_OUT,\r\nsolo_reg_read(solo_dev, SOLO_GPIO_DATA_OUT) & ~value);\r\n}\r\nstatic void solo_gpio_config(struct solo_dev *solo_dev)\r\n{\r\nsolo_gpio_mode(solo_dev, 0x30, 1);\r\nsolo_gpio_clear(solo_dev, 0x30);\r\nudelay(100);\r\nsolo_gpio_set(solo_dev, 0x30);\r\nudelay(100);\r\nsolo_gpio_mode(solo_dev, 0x0f, 2);\r\nsolo_gpio_mode(solo_dev, 0xff00, 1);\r\nsolo_gpio_clear(solo_dev, 0xff00);\r\n}\r\nint solo_gpio_init(struct solo_dev *solo_dev)\r\n{\r\nsolo_gpio_config(solo_dev);\r\nreturn 0;\r\n}\r\nvoid solo_gpio_exit(struct solo_dev *solo_dev)\r\n{\r\nsolo_gpio_clear(solo_dev, 0x30);\r\nsolo_gpio_config(solo_dev);\r\n}
