int copy_siginfo_to_user32(compat_siginfo_t __user *to, const siginfo_t *from)\r\n{\r\nint err = 0;\r\nbool ia32 = test_thread_flag(TIF_IA32);\r\nif (!access_ok(VERIFY_WRITE, to, sizeof(compat_siginfo_t)))\r\nreturn -EFAULT;\r\nput_user_try {\r\nput_user_ex(from->si_signo, &to->si_signo);\r\nput_user_ex(from->si_errno, &to->si_errno);\r\nput_user_ex((short)from->si_code, &to->si_code);\r\nif (from->si_code < 0) {\r\nput_user_ex(from->si_pid, &to->si_pid);\r\nput_user_ex(from->si_uid, &to->si_uid);\r\nput_user_ex(ptr_to_compat(from->si_ptr), &to->si_ptr);\r\n} else {\r\nput_user_ex(from->_sifields._pad[0],\r\n&to->_sifields._pad[0]);\r\nswitch (from->si_code >> 16) {\r\ncase __SI_FAULT >> 16:\r\nbreak;\r\ncase __SI_SYS >> 16:\r\nput_user_ex(from->si_syscall, &to->si_syscall);\r\nput_user_ex(from->si_arch, &to->si_arch);\r\nbreak;\r\ncase __SI_CHLD >> 16:\r\nif (ia32) {\r\nput_user_ex(from->si_utime, &to->si_utime);\r\nput_user_ex(from->si_stime, &to->si_stime);\r\n} else {\r\nput_user_ex(from->si_utime, &to->_sifields._sigchld_x32._utime);\r\nput_user_ex(from->si_stime, &to->_sifields._sigchld_x32._stime);\r\n}\r\nput_user_ex(from->si_status, &to->si_status);\r\ndefault:\r\ncase __SI_KILL >> 16:\r\nput_user_ex(from->si_uid, &to->si_uid);\r\nbreak;\r\ncase __SI_POLL >> 16:\r\nput_user_ex(from->si_fd, &to->si_fd);\r\nbreak;\r\ncase __SI_TIMER >> 16:\r\nput_user_ex(from->si_overrun, &to->si_overrun);\r\nput_user_ex(ptr_to_compat(from->si_ptr),\r\n&to->si_ptr);\r\nbreak;\r\ncase __SI_RT >> 16:\r\ncase __SI_MESGQ >> 16:\r\nput_user_ex(from->si_uid, &to->si_uid);\r\nput_user_ex(from->si_int, &to->si_int);\r\nbreak;\r\n}\r\n}\r\n} put_user_catch(err);\r\nreturn err;\r\n}\r\nint copy_siginfo_from_user32(siginfo_t *to, compat_siginfo_t __user *from)\r\n{\r\nint err = 0;\r\nu32 ptr32;\r\nif (!access_ok(VERIFY_READ, from, sizeof(compat_siginfo_t)))\r\nreturn -EFAULT;\r\nget_user_try {\r\nget_user_ex(to->si_signo, &from->si_signo);\r\nget_user_ex(to->si_errno, &from->si_errno);\r\nget_user_ex(to->si_code, &from->si_code);\r\nget_user_ex(to->si_pid, &from->si_pid);\r\nget_user_ex(to->si_uid, &from->si_uid);\r\nget_user_ex(ptr32, &from->si_ptr);\r\nto->si_ptr = compat_ptr(ptr32);\r\n} get_user_catch(err);\r\nreturn err;\r\n}
