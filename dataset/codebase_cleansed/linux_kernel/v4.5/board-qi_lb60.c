static void qi_lb60_nand_ident(struct platform_device *pdev,\r\nstruct nand_chip *chip, struct mtd_partition **partitions,\r\nint *num_partitions)\r\n{\r\nif (chip->page_shift == 12) {\r\nchip->ecc.layout = &qi_lb60_ecclayout_2gb;\r\n*partitions = qi_lb60_partitions_2gb;\r\n*num_partitions = ARRAY_SIZE(qi_lb60_partitions_2gb);\r\n} else {\r\nchip->ecc.layout = &qi_lb60_ecclayout_1gb;\r\n*partitions = qi_lb60_partitions_1gb;\r\n*num_partitions = ARRAY_SIZE(qi_lb60_partitions_1gb);\r\n}\r\n}\r\nstatic void __init board_gpio_setup(void)\r\n{\r\njz_gpio_disable_pullup(QI_LB60_GPIO_SD_VCC_EN_N);\r\njz_gpio_disable_pullup(QI_LB60_GPIO_SD_CD);\r\n}\r\nstatic int __init qi_lb60_init_platform_devices(void)\r\n{\r\njz4740_framebuffer_device.dev.platform_data = &qi_lb60_fb_pdata;\r\njz4740_nand_device.dev.platform_data = &qi_lb60_nand_pdata;\r\njz4740_adc_device.dev.platform_data = &qi_lb60_battery_pdata;\r\njz4740_mmc_device.dev.platform_data = &qi_lb60_mmc_pdata;\r\ngpiod_add_lookup_table(&qi_lb60_audio_gpio_table);\r\ngpiod_add_lookup_table(&qi_lb60_nand_gpio_table);\r\nspi_register_board_info(qi_lb60_spi_board_info,\r\nARRAY_SIZE(qi_lb60_spi_board_info));\r\nif (is_avt2) {\r\nplatform_device_register(&avt2_usb_regulator_device);\r\nplatform_device_register(&jz4740_usb_ohci_device);\r\n}\r\npwm_add_table(qi_lb60_pwm_lookup, ARRAY_SIZE(qi_lb60_pwm_lookup));\r\nreturn platform_add_devices(jz_platform_devices,\r\nARRAY_SIZE(jz_platform_devices));\r\n}\r\nstatic __init int board_avt2(char *str)\r\n{\r\nqi_lb60_mmc_pdata.card_detect_active_low = 1;\r\nis_avt2 = true;\r\nreturn 1;\r\n}\r\nstatic int __init qi_lb60_board_setup(void)\r\n{\r\nprintk(KERN_INFO "Qi Hardware JZ4740 QI %s setup\n",\r\nis_avt2 ? "AVT2" : "LB60");\r\nboard_gpio_setup();\r\nif (qi_lb60_init_platform_devices())\r\npanic("Failed to initialize platform devices");\r\nreturn 0;\r\n}
