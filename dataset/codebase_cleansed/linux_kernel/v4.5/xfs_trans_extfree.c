xfs_efi_log_item_t *\r\nxfs_trans_get_efi(xfs_trans_t *tp,\r\nuint nextents)\r\n{\r\nxfs_efi_log_item_t *efip;\r\nASSERT(tp != NULL);\r\nASSERT(nextents > 0);\r\nefip = xfs_efi_init(tp->t_mountp, nextents);\r\nASSERT(efip != NULL);\r\nxfs_trans_add_item(tp, &efip->efi_item);\r\nreturn efip;\r\n}\r\nvoid\r\nxfs_trans_log_efi_extent(xfs_trans_t *tp,\r\nxfs_efi_log_item_t *efip,\r\nxfs_fsblock_t start_block,\r\nxfs_extlen_t ext_len)\r\n{\r\nuint next_extent;\r\nxfs_extent_t *extp;\r\ntp->t_flags |= XFS_TRANS_DIRTY;\r\nefip->efi_item.li_desc->lid_flags |= XFS_LID_DIRTY;\r\nnext_extent = atomic_inc_return(&efip->efi_next_extent) - 1;\r\nASSERT(next_extent < efip->efi_format.efi_nextents);\r\nextp = &(efip->efi_format.efi_extents[next_extent]);\r\nextp->ext_start = start_block;\r\nextp->ext_len = ext_len;\r\n}\r\nxfs_efd_log_item_t *\r\nxfs_trans_get_efd(xfs_trans_t *tp,\r\nxfs_efi_log_item_t *efip,\r\nuint nextents)\r\n{\r\nxfs_efd_log_item_t *efdp;\r\nASSERT(tp != NULL);\r\nASSERT(nextents > 0);\r\nefdp = xfs_efd_init(tp->t_mountp, efip, nextents);\r\nASSERT(efdp != NULL);\r\nxfs_trans_add_item(tp, &efdp->efd_item);\r\nreturn efdp;\r\n}\r\nint\r\nxfs_trans_free_extent(\r\nstruct xfs_trans *tp,\r\nstruct xfs_efd_log_item *efdp,\r\nxfs_fsblock_t start_block,\r\nxfs_extlen_t ext_len)\r\n{\r\nuint next_extent;\r\nstruct xfs_extent *extp;\r\nint error;\r\nerror = xfs_free_extent(tp, start_block, ext_len);\r\ntp->t_flags |= XFS_TRANS_DIRTY;\r\nefdp->efd_item.li_desc->lid_flags |= XFS_LID_DIRTY;\r\nnext_extent = efdp->efd_next_extent;\r\nASSERT(next_extent < efdp->efd_format.efd_nextents);\r\nextp = &(efdp->efd_format.efd_extents[next_extent]);\r\nextp->ext_start = start_block;\r\nextp->ext_len = ext_len;\r\nefdp->efd_next_extent++;\r\nreturn error;\r\n}
