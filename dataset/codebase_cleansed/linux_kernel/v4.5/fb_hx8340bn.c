static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nwrite_reg(par, 0xC1, 0xFF, 0x83, 0x40);\r\nwrite_reg(par, 0x11);\r\nmdelay(150);\r\nwrite_reg(par, 0xCA, 0x70, 0x00, 0xD9);\r\nwrite_reg(par, 0xB0, 0x01, 0x11);\r\nwrite_reg(par, 0xC9, 0x90, 0x49, 0x10, 0x28, 0x28, 0x10, 0x00, 0x06);\r\nmdelay(20);\r\nwrite_reg(par, 0xB5, 0x35, 0x20, 0x45);\r\nwrite_reg(par, 0xB4, 0x33, 0x25, 0x4C);\r\nmdelay(10);\r\nwrite_reg(par, 0x3A, 0x05);\r\nwrite_reg(par, 0x29);\r\nmdelay(10);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, FBTFT_CASET, 0x00, xs, 0x00, xe);\r\nwrite_reg(par, FBTFT_RASET, 0x00, ys, 0x00, ye);\r\nwrite_reg(par, FBTFT_RAMWR);\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\n#define MY BIT(7)\r\n#define MX BIT(6)\r\n#define MV BIT(5)\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nwrite_reg(par, 0x36, par->bgr << 3);\r\nbreak;\r\ncase 270:\r\nwrite_reg(par, 0x36, MX | MV | (par->bgr << 3));\r\nbreak;\r\ncase 180:\r\nwrite_reg(par, 0x36, MX | MY | (par->bgr << 3));\r\nbreak;\r\ncase 90:\r\nwrite_reg(par, 0x36, MY | MV | (par->bgr << 3));\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, unsigned long *curves)\r\n{\r\nunsigned long mask[] = {\r\n0x0f, 0x0f, 0x1f, 0x0f, 0x0f, 0x0f, 0x1f, 0x07, 0x07, 0x07,\r\n0x07, 0x07, 0x07, 0x03, 0x03, 0x0f, 0x0f, 0x1f, 0x0f, 0x0f,\r\n0x0f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00,\r\n};\r\nint i, j;\r\nfor (i = 0; i < par->gamma.num_curves; i++)\r\nfor (j = 0; j < par->gamma.num_values; j++)\r\nCURVE(i, j) &= mask[i * par->gamma.num_values + j];\r\nwrite_reg(par, 0x26, 1 << CURVE(1, 14));\r\nif (CURVE(1, 14))\r\nreturn 0;\r\nwrite_reg(par, 0xC2,\r\n(CURVE(0, 8) << 4) | CURVE(0, 7),\r\n(CURVE(0, 10) << 4) | CURVE(0, 9),\r\n(CURVE(0, 12) << 4) | CURVE(0, 11),\r\nCURVE(0, 2),\r\n(CURVE(0, 4) << 4) | CURVE(0, 3),\r\nCURVE(0, 5),\r\nCURVE(0, 6),\r\n(CURVE(0, 1) << 4) | CURVE(0, 0),\r\n(CURVE(0, 14) << 2) | CURVE(0, 13));\r\nwrite_reg(par, 0xC3,\r\n(CURVE(1, 8) << 4) | CURVE(1, 7),\r\n(CURVE(1, 10) << 4) | CURVE(1, 9),\r\n(CURVE(1, 12) << 4) | CURVE(1, 11),\r\nCURVE(1, 2),\r\n(CURVE(1, 4) << 4) | CURVE(1, 3),\r\nCURVE(1, 5),\r\nCURVE(1, 6),\r\n(CURVE(1, 1) << 4) | CURVE(1, 0));\r\nmdelay(10);\r\nreturn 0;\r\n}
