u16\r\nnvbios_boostTe(struct nvkm_bios *bios,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len, u8 *snr, u8 *ssz)\r\n{\r\nstruct bit_entry bit_P;\r\nu16 boost = 0x0000;\r\nif (!bit_entry(bios, 'P', &bit_P)) {\r\nif (bit_P.version == 2)\r\nboost = nvbios_rd16(bios, bit_P.offset + 0x30);\r\nif (boost) {\r\n*ver = nvbios_rd08(bios, boost + 0);\r\nswitch (*ver) {\r\ncase 0x11:\r\n*hdr = nvbios_rd08(bios, boost + 1);\r\n*cnt = nvbios_rd08(bios, boost + 5);\r\n*len = nvbios_rd08(bios, boost + 2);\r\n*snr = nvbios_rd08(bios, boost + 4);\r\n*ssz = nvbios_rd08(bios, boost + 3);\r\nreturn boost;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn 0x0000;\r\n}\r\nu16\r\nnvbios_boostEe(struct nvkm_bios *bios, int idx,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len)\r\n{\r\nu8 snr, ssz;\r\nu16 data = nvbios_boostTe(bios, ver, hdr, cnt, len, &snr, &ssz);\r\nif (data && idx < *cnt) {\r\ndata = data + *hdr + (idx * (*len + (snr * ssz)));\r\n*hdr = *len;\r\n*cnt = snr;\r\n*len = ssz;\r\nreturn data;\r\n}\r\nreturn 0x0000;\r\n}\r\nu16\r\nnvbios_boostEp(struct nvkm_bios *bios, int idx,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_boostE *info)\r\n{\r\nu16 data = nvbios_boostEe(bios, idx, ver, hdr, cnt, len);\r\nmemset(info, 0x00, sizeof(*info));\r\nif (data) {\r\ninfo->pstate = (nvbios_rd16(bios, data + 0x00) & 0x01e0) >> 5;\r\ninfo->min = nvbios_rd16(bios, data + 0x02) * 1000;\r\ninfo->max = nvbios_rd16(bios, data + 0x04) * 1000;\r\n}\r\nreturn data;\r\n}\r\nu16\r\nnvbios_boostEm(struct nvkm_bios *bios, u8 pstate,\r\nu8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_boostE *info)\r\n{\r\nu32 data, idx = 0;\r\nwhile ((data = nvbios_boostEp(bios, idx++, ver, hdr, cnt, len, info))) {\r\nif (info->pstate == pstate)\r\nbreak;\r\n}\r\nreturn data;\r\n}\r\nu16\r\nnvbios_boostSe(struct nvkm_bios *bios, int idx,\r\nu16 data, u8 *ver, u8 *hdr, u8 cnt, u8 len)\r\n{\r\nif (data && idx < cnt) {\r\ndata = data + *hdr + (idx * len);\r\n*hdr = len;\r\nreturn data;\r\n}\r\nreturn 0x0000;\r\n}\r\nu16\r\nnvbios_boostSp(struct nvkm_bios *bios, int idx,\r\nu16 data, u8 *ver, u8 *hdr, u8 cnt, u8 len,\r\nstruct nvbios_boostS *info)\r\n{\r\ndata = nvbios_boostSe(bios, idx, data, ver, hdr, cnt, len);\r\nmemset(info, 0x00, sizeof(*info));\r\nif (data) {\r\ninfo->domain = nvbios_rd08(bios, data + 0x00);\r\ninfo->percent = nvbios_rd08(bios, data + 0x01);\r\ninfo->min = nvbios_rd16(bios, data + 0x02) * 1000;\r\ninfo->max = nvbios_rd16(bios, data + 0x04) * 1000;\r\n}\r\nreturn data;\r\n}
