int __init pci_xen_swiotlb_detect(void)\r\n{\r\nif (!xen_pv_domain())\r\nreturn 0;\r\nif ((xen_initial_domain() || swiotlb || swiotlb_force))\r\nxen_swiotlb = 1;\r\nswiotlb = 0;\r\n#ifdef CONFIG_X86_64\r\nif (max_pfn > MAX_DMA32_PFN)\r\nno_iommu = 1;\r\n#endif\r\nreturn xen_swiotlb;\r\n}\r\nvoid __init pci_xen_swiotlb_init(void)\r\n{\r\nif (xen_swiotlb) {\r\nxen_swiotlb_init(1, true );\r\ndma_ops = &xen_swiotlb_dma_ops;\r\n#ifdef CONFIG_PCI\r\npci_request_acs();\r\n#endif\r\n}\r\n}\r\nint pci_xen_swiotlb_init_late(void)\r\n{\r\nint rc;\r\nif (xen_swiotlb)\r\nreturn 0;\r\nrc = xen_swiotlb_init(1, false );\r\nif (rc)\r\nreturn rc;\r\ndma_ops = &xen_swiotlb_dma_ops;\r\n#ifdef CONFIG_PCI\r\npci_request_acs();\r\n#endif\r\nreturn 0;\r\n}
