static int drm_get_platform_dev(struct platform_device *platdev,\r\nstruct drm_driver *driver)\r\n{\r\nstruct drm_device *dev;\r\nint ret;\r\nDRM_DEBUG("\n");\r\ndev = drm_dev_alloc(driver, &platdev->dev);\r\nif (!dev)\r\nreturn -ENOMEM;\r\ndev->platformdev = platdev;\r\nret = drm_dev_register(dev, 0);\r\nif (ret)\r\ngoto err_free;\r\nDRM_INFO("Initialized %s %d.%d.%d %s on minor %d\n",\r\ndriver->name, driver->major, driver->minor, driver->patchlevel,\r\ndriver->date, dev->primary->index);\r\nreturn 0;\r\nerr_free:\r\ndrm_dev_unref(dev);\r\nreturn ret;\r\n}\r\nint drm_platform_set_busid(struct drm_device *dev, struct drm_master *master)\r\n{\r\nint id;\r\nid = dev->platformdev->id;\r\nif (id < 0)\r\nid = 0;\r\nmaster->unique = kasprintf(GFP_KERNEL, "platform:%s:%02d",\r\ndev->platformdev->name, id);\r\nif (!master->unique)\r\nreturn -ENOMEM;\r\nmaster->unique_len = strlen(master->unique);\r\nreturn 0;\r\n}\r\nint drm_platform_init(struct drm_driver *driver, struct platform_device *platform_device)\r\n{\r\nDRM_DEBUG("\n");\r\nreturn drm_get_platform_dev(platform_device, driver);\r\n}
