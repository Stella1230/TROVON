static void __init rev_sku_to_speedo_ids(struct tegra_sku_info *sku_info,\r\nint *threshold)\r\n{\r\nint sku = sku_info->sku_id;\r\nsku_info->cpu_speedo_id = 0;\r\nsku_info->soc_speedo_id = 0;\r\nsku_info->gpu_speedo_id = 0;\r\n*threshold = THRESHOLD_INDEX_0;\r\nswitch (sku) {\r\ncase 0x00:\r\ncase 0x0F:\r\ncase 0x23:\r\nbreak;\r\ncase 0x83:\r\nsku_info->cpu_speedo_id = 2;\r\nbreak;\r\ncase 0x1F:\r\ncase 0x87:\r\ncase 0x27:\r\nsku_info->cpu_speedo_id = 2;\r\nsku_info->soc_speedo_id = 0;\r\nsku_info->gpu_speedo_id = 1;\r\n*threshold = THRESHOLD_INDEX_0;\r\nbreak;\r\ncase 0x81:\r\ncase 0x21:\r\ncase 0x07:\r\nsku_info->cpu_speedo_id = 1;\r\nsku_info->soc_speedo_id = 1;\r\nsku_info->gpu_speedo_id = 1;\r\n*threshold = THRESHOLD_INDEX_1;\r\nbreak;\r\ncase 0x49:\r\ncase 0x4A:\r\ncase 0x48:\r\nsku_info->cpu_speedo_id = 4;\r\nsku_info->soc_speedo_id = 2;\r\nsku_info->gpu_speedo_id = 3;\r\n*threshold = THRESHOLD_INDEX_1;\r\nbreak;\r\ndefault:\r\npr_err("Tegra Unknown SKU %d\n", sku);\r\nbreak;\r\n}\r\n}\r\nvoid __init tegra124_init_speedo_data(struct tegra_sku_info *sku_info)\r\n{\r\nint i, threshold, cpu_speedo_0_value, soc_speedo_0_value;\r\nint cpu_iddq_value, gpu_iddq_value, soc_iddq_value;\r\nBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(gpu_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(soc_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\ncpu_speedo_0_value = tegra_fuse_read_early(FUSE_CPU_SPEEDO_0);\r\nsku_info->gpu_speedo_value = tegra_fuse_read_early(FUSE_CPU_SPEEDO_2);\r\nsoc_speedo_0_value = tegra_fuse_read_early(FUSE_SOC_SPEEDO_0);\r\ncpu_iddq_value = tegra_fuse_read_early(FUSE_CPU_IDDQ);\r\nsoc_iddq_value = tegra_fuse_read_early(FUSE_SOC_IDDQ);\r\ngpu_iddq_value = tegra_fuse_read_early(FUSE_GPU_IDDQ);\r\nsku_info->cpu_speedo_value = cpu_speedo_0_value;\r\nif (sku_info->cpu_speedo_value == 0) {\r\npr_warn("Tegra Warning: Speedo value not fused.\n");\r\nWARN_ON(1);\r\nreturn;\r\n}\r\nrev_sku_to_speedo_ids(sku_info, &threshold);\r\nsku_info->cpu_iddq_value = tegra_fuse_read_early(FUSE_CPU_IDDQ);\r\nfor (i = 0; i < GPU_PROCESS_CORNERS; i++)\r\nif (sku_info->gpu_speedo_value <\r\ngpu_process_speedos[threshold][i])\r\nbreak;\r\nsku_info->gpu_process_id = i;\r\nfor (i = 0; i < CPU_PROCESS_CORNERS; i++)\r\nif (sku_info->cpu_speedo_value <\r\ncpu_process_speedos[threshold][i])\r\nbreak;\r\nsku_info->cpu_process_id = i;\r\nfor (i = 0; i < SOC_PROCESS_CORNERS; i++)\r\nif (soc_speedo_0_value <\r\nsoc_process_speedos[threshold][i])\r\nbreak;\r\nsku_info->soc_process_id = i;\r\npr_debug("Tegra GPU Speedo ID=%d, Speedo Value=%d\n",\r\nsku_info->gpu_speedo_id, sku_info->gpu_speedo_value);\r\n}
