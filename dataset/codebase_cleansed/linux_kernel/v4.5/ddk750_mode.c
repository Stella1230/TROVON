static unsigned long displayControlAdjust_SM750LE(mode_parameter_t *pModeParam, unsigned long dispControl)\r\n{\r\nunsigned long x, y;\r\nx = pModeParam->horizontal_display_end;\r\ny = pModeParam->vertical_display_end;\r\nPOKE32(CRT_AUTO_CENTERING_TL,\r\nFIELD_VALUE(0, CRT_AUTO_CENTERING_TL, TOP, 0)\r\n| FIELD_VALUE(0, CRT_AUTO_CENTERING_TL, LEFT, 0));\r\nPOKE32(CRT_AUTO_CENTERING_BR,\r\nFIELD_VALUE(0, CRT_AUTO_CENTERING_BR, BOTTOM, y-1)\r\n| FIELD_VALUE(0, CRT_AUTO_CENTERING_BR, RIGHT, x-1));\r\ndispControl &= FIELD_CLEAR(CRT_DISPLAY_CTRL, CLK);\r\nif (x == 800 && y == 600)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL41);\r\nelse if (x == 1024 && y == 768)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL65);\r\nelse if (x == 1152 && y == 864)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL80);\r\nelse if (x == 1280 && y == 768)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL80);\r\nelse if (x == 1280 && y == 720)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL74);\r\nelse if (x == 1280 && y == 960)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL108);\r\nelse if (x == 1280 && y == 1024)\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL108);\r\nelse\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLK, PLL25);\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CRTSELECT, CRT);\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, RGBBIT, 24BIT);\r\ndispControl = FIELD_SET(dispControl, CRT_DISPLAY_CTRL, CLOCK_PHASE, ACTIVE_LOW);\r\nPOKE32(CRT_DISPLAY_CTRL, dispControl);\r\nreturn dispControl;\r\n}\r\nstatic int programModeRegisters(mode_parameter_t *pModeParam, pll_value_t *pll)\r\n{\r\nint ret = 0;\r\nint cnt = 0;\r\nunsigned int ulTmpValue, ulReg;\r\nif (pll->clockType == SECONDARY_PLL) {\r\nPOKE32(CRT_PLL_CTRL, formatPllReg(pll));\r\nPOKE32(CRT_HORIZONTAL_TOTAL,\r\nFIELD_VALUE(0, CRT_HORIZONTAL_TOTAL, TOTAL, pModeParam->horizontal_total - 1)\r\n| FIELD_VALUE(0, CRT_HORIZONTAL_TOTAL, DISPLAY_END, pModeParam->horizontal_display_end - 1));\r\nPOKE32(CRT_HORIZONTAL_SYNC,\r\nFIELD_VALUE(0, CRT_HORIZONTAL_SYNC, WIDTH, pModeParam->horizontal_sync_width)\r\n| FIELD_VALUE(0, CRT_HORIZONTAL_SYNC, START, pModeParam->horizontal_sync_start - 1));\r\nPOKE32(CRT_VERTICAL_TOTAL,\r\nFIELD_VALUE(0, CRT_VERTICAL_TOTAL, TOTAL, pModeParam->vertical_total - 1)\r\n| FIELD_VALUE(0, CRT_VERTICAL_TOTAL, DISPLAY_END, pModeParam->vertical_display_end - 1));\r\nPOKE32(CRT_VERTICAL_SYNC,\r\nFIELD_VALUE(0, CRT_VERTICAL_SYNC, HEIGHT, pModeParam->vertical_sync_height)\r\n| FIELD_VALUE(0, CRT_VERTICAL_SYNC, START, pModeParam->vertical_sync_start - 1));\r\nulTmpValue = FIELD_VALUE(0, CRT_DISPLAY_CTRL, VSYNC_PHASE, pModeParam->vertical_sync_polarity)|\r\nFIELD_VALUE(0, CRT_DISPLAY_CTRL, HSYNC_PHASE, pModeParam->horizontal_sync_polarity)|\r\nFIELD_SET(0, CRT_DISPLAY_CTRL, TIMING, ENABLE)|\r\nFIELD_SET(0, CRT_DISPLAY_CTRL, PLANE, ENABLE);\r\nif (getChipType() == SM750LE) {\r\ndisplayControlAdjust_SM750LE(pModeParam, ulTmpValue);\r\n} else {\r\nulReg = PEEK32(CRT_DISPLAY_CTRL)\r\n& FIELD_CLEAR(CRT_DISPLAY_CTRL, VSYNC_PHASE)\r\n& FIELD_CLEAR(CRT_DISPLAY_CTRL, HSYNC_PHASE)\r\n& FIELD_CLEAR(CRT_DISPLAY_CTRL, TIMING)\r\n& FIELD_CLEAR(CRT_DISPLAY_CTRL, PLANE);\r\nPOKE32(CRT_DISPLAY_CTRL, ulTmpValue|ulReg);\r\n}\r\n} else if (pll->clockType == PRIMARY_PLL) {\r\nunsigned int ulReservedBits;\r\nPOKE32(PANEL_PLL_CTRL, formatPllReg(pll));\r\nPOKE32(PANEL_HORIZONTAL_TOTAL,\r\nFIELD_VALUE(0, PANEL_HORIZONTAL_TOTAL, TOTAL, pModeParam->horizontal_total - 1)\r\n| FIELD_VALUE(0, PANEL_HORIZONTAL_TOTAL, DISPLAY_END, pModeParam->horizontal_display_end - 1));\r\nPOKE32(PANEL_HORIZONTAL_SYNC,\r\nFIELD_VALUE(0, PANEL_HORIZONTAL_SYNC, WIDTH, pModeParam->horizontal_sync_width)\r\n| FIELD_VALUE(0, PANEL_HORIZONTAL_SYNC, START, pModeParam->horizontal_sync_start - 1));\r\nPOKE32(PANEL_VERTICAL_TOTAL,\r\nFIELD_VALUE(0, PANEL_VERTICAL_TOTAL, TOTAL, pModeParam->vertical_total - 1)\r\n| FIELD_VALUE(0, PANEL_VERTICAL_TOTAL, DISPLAY_END, pModeParam->vertical_display_end - 1));\r\nPOKE32(PANEL_VERTICAL_SYNC,\r\nFIELD_VALUE(0, PANEL_VERTICAL_SYNC, HEIGHT, pModeParam->vertical_sync_height)\r\n| FIELD_VALUE(0, PANEL_VERTICAL_SYNC, START, pModeParam->vertical_sync_start - 1));\r\nulTmpValue = FIELD_VALUE(0, PANEL_DISPLAY_CTRL, VSYNC_PHASE, pModeParam->vertical_sync_polarity)|\r\nFIELD_VALUE(0, PANEL_DISPLAY_CTRL, HSYNC_PHASE, pModeParam->horizontal_sync_polarity)|\r\nFIELD_VALUE(0, PANEL_DISPLAY_CTRL, CLOCK_PHASE, pModeParam->clock_phase_polarity)|\r\nFIELD_SET(0, PANEL_DISPLAY_CTRL, TIMING, ENABLE)|\r\nFIELD_SET(0, PANEL_DISPLAY_CTRL, PLANE, ENABLE);\r\nulReservedBits = FIELD_SET(0, PANEL_DISPLAY_CTRL, RESERVED_1_MASK, ENABLE) |\r\nFIELD_SET(0, PANEL_DISPLAY_CTRL, RESERVED_2_MASK, ENABLE) |\r\nFIELD_SET(0, PANEL_DISPLAY_CTRL, RESERVED_3_MASK, ENABLE)|\r\nFIELD_SET(0, PANEL_DISPLAY_CTRL, VSYNC, ACTIVE_LOW);\r\nulReg = (PEEK32(PANEL_DISPLAY_CTRL) & ~ulReservedBits)\r\n& FIELD_CLEAR(PANEL_DISPLAY_CTRL, CLOCK_PHASE)\r\n& FIELD_CLEAR(PANEL_DISPLAY_CTRL, VSYNC_PHASE)\r\n& FIELD_CLEAR(PANEL_DISPLAY_CTRL, HSYNC_PHASE)\r\n& FIELD_CLEAR(PANEL_DISPLAY_CTRL, TIMING)\r\n& FIELD_CLEAR(PANEL_DISPLAY_CTRL, PLANE);\r\nPOKE32(PANEL_DISPLAY_CTRL, ulTmpValue|ulReg);\r\nwhile ((PEEK32(PANEL_DISPLAY_CTRL) & ~ulReservedBits) != (ulTmpValue|ulReg)) {\r\ncnt++;\r\nif (cnt > 1000)\r\nbreak;\r\nPOKE32(PANEL_DISPLAY_CTRL, ulTmpValue|ulReg);\r\n}\r\n} else {\r\nret = -1;\r\n}\r\nreturn ret;\r\n}\r\nint ddk750_setModeTiming(mode_parameter_t *parm, clock_type_t clock)\r\n{\r\npll_value_t pll;\r\nunsigned int uiActualPixelClk;\r\npll.inputFreq = DEFAULT_INPUT_CLOCK;\r\npll.clockType = clock;\r\nuiActualPixelClk = calcPllValue(parm->pixel_clock, &pll);\r\nif (getChipType() == SM750LE) {\r\noutb_p(0x88, 0x3d4);\r\noutb_p(0x06, 0x3d5);\r\n}\r\nprogramModeRegisters(parm, &pll);\r\nreturn 0;\r\n}
