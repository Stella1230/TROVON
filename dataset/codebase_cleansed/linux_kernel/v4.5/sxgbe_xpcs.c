static int sxgbe_xpcs_read(struct net_device *ndev, unsigned int reg)\r\n{\r\nu32 value;\r\nstruct sxgbe_priv_data *priv = netdev_priv(ndev);\r\nvalue = readl(priv->ioaddr + XPCS_OFFSET + reg);\r\nreturn value;\r\n}\r\nstatic int sxgbe_xpcs_write(struct net_device *ndev, int reg, int data)\r\n{\r\nstruct sxgbe_priv_data *priv = netdev_priv(ndev);\r\nwritel(data, priv->ioaddr + XPCS_OFFSET + reg);\r\nreturn 0;\r\n}\r\nint sxgbe_xpcs_init(struct net_device *ndev)\r\n{\r\nu32 value;\r\nvalue = sxgbe_xpcs_read(ndev, SR_PCS_MMD_CONTROL1);\r\nsxgbe_xpcs_write(ndev, SR_PCS_CONTROL2, XPCS_TYPE_SEL_X);\r\nsxgbe_xpcs_write(ndev, VR_PCS_MMD_XAUI_MODE_CONTROL, XPCS_XAUI_MODE);\r\nsxgbe_xpcs_write(ndev, VR_PCS_MMD_XAUI_MODE_CONTROL, value | BIT(13));\r\nsxgbe_xpcs_write(ndev, SR_PCS_MMD_CONTROL1, value | BIT(11));\r\ndo {\r\nvalue = sxgbe_xpcs_read(ndev, VR_PCS_MMD_DIGITAL_STATUS);\r\n} while ((value & XPCS_QSEQ_STATE_MPLLOFF) == XPCS_QSEQ_STATE_STABLE);\r\nvalue = sxgbe_xpcs_read(ndev, SR_PCS_MMD_CONTROL1);\r\nsxgbe_xpcs_write(ndev, SR_PCS_MMD_CONTROL1, value & ~BIT(11));\r\ndo {\r\nvalue = sxgbe_xpcs_read(ndev, VR_PCS_MMD_DIGITAL_STATUS);\r\n} while ((value & XPCS_QSEQ_STATE_MPLLOFF) != XPCS_QSEQ_STATE_STABLE);\r\nreturn 0;\r\n}\r\nint sxgbe_xpcs_init_1G(struct net_device *ndev)\r\n{\r\nint value;\r\nsxgbe_xpcs_write(ndev, SR_PCS_CONTROL2, XPCS_TYPE_SEL_X);\r\nsxgbe_xpcs_write(ndev, VR_PCS_MMD_XAUI_MODE_CONTROL, XPCS_XAUI_MODE);\r\nvalue = sxgbe_xpcs_read(ndev, SR_PCS_MMD_CONTROL1);\r\nsxgbe_xpcs_write(ndev, SR_PCS_MMD_CONTROL1, value & ~BIT(13));\r\nvalue = sxgbe_xpcs_read(ndev, SR_MII_MMD_CONTROL);\r\nsxgbe_xpcs_write(ndev, SR_MII_MMD_CONTROL, value | BIT(6));\r\nsxgbe_xpcs_write(ndev, SR_MII_MMD_CONTROL, value & ~BIT(13));\r\nvalue = sxgbe_xpcs_read(ndev, SR_PCS_MMD_CONTROL1);\r\nsxgbe_xpcs_write(ndev, SR_PCS_MMD_CONTROL1, value | BIT(11));\r\ndo {\r\nvalue = sxgbe_xpcs_read(ndev, VR_PCS_MMD_DIGITAL_STATUS);\r\n} while ((value & XPCS_QSEQ_STATE_MPLLOFF) != XPCS_QSEQ_STATE_STABLE);\r\nvalue = sxgbe_xpcs_read(ndev, SR_PCS_MMD_CONTROL1);\r\nsxgbe_xpcs_write(ndev, SR_PCS_MMD_CONTROL1, value & ~BIT(11));\r\nvalue = sxgbe_xpcs_read(ndev, SR_MII_MMD_CONTROL);\r\nsxgbe_xpcs_write(ndev, SR_MII_MMD_CONTROL, value | BIT(12));\r\nreturn 0;\r\n}
