static bool snd_ac97_check_id(struct snd_ac97 *ac97, unsigned int id,\r\nunsigned int id_mask)\r\n{\r\nac97->id = ac97->bus->ops->read(ac97, AC97_VENDOR_ID1) << 16;\r\nac97->id |= ac97->bus->ops->read(ac97, AC97_VENDOR_ID2);\r\nif (ac97->id == 0x0 || ac97->id == 0xffffffff)\r\nreturn false;\r\nif (id != 0 && id != (ac97->id & id_mask))\r\nreturn false;\r\nreturn true;\r\n}\r\nint snd_ac97_reset(struct snd_ac97 *ac97, bool try_warm, unsigned int id,\r\nunsigned int id_mask)\r\n{\r\nstruct snd_ac97_bus_ops *ops = ac97->bus->ops;\r\nif (try_warm && ops->warm_reset) {\r\nops->warm_reset(ac97);\r\nif (snd_ac97_check_id(ac97, id, id_mask))\r\nreturn 1;\r\n}\r\nif (ops->reset)\r\nops->reset(ac97);\r\nif (ops->warm_reset)\r\nops->warm_reset(ac97);\r\nif (snd_ac97_check_id(ac97, id, id_mask))\r\nreturn 0;\r\nreturn -ENODEV;\r\n}\r\nstatic int ac97_bus_match(struct device *dev, struct device_driver *drv)\r\n{\r\nreturn 1;\r\n}\r\nstatic int __init ac97_bus_init(void)\r\n{\r\nreturn bus_register(&ac97_bus_type);\r\n}\r\nstatic void __exit ac97_bus_exit(void)\r\n{\r\nbus_unregister(&ac97_bus_type);\r\n}
