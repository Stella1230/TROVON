static void __init davinci_ntosd2_map_io(void)\r\n{\r\ndm644x_init();\r\n}\r\nstatic __init void davinci_ntosd2_init(void)\r\n{\r\nint ret;\r\nstruct clk *aemif_clk;\r\nstruct davinci_soc_info *soc_info = &davinci_soc_info;\r\nret = dm644x_gpio_register();\r\nif (ret)\r\npr_warn("%s: GPIO init failed: %d\n", __func__, ret);\r\naemif_clk = clk_get(NULL, "aemif");\r\nclk_prepare_enable(aemif_clk);\r\nif (HAS_ATA) {\r\nif (HAS_NAND)\r\npr_warn("WARNING: both IDE and Flash are enabled, but they share AEMIF pins\n"\r\n"\tDisable IDE for NAND/NOR support\n");\r\ndavinci_init_ide();\r\n} else if (HAS_NAND) {\r\ndavinci_cfg_reg(DM644X_HPIEN_DISABLE);\r\ndavinci_cfg_reg(DM644X_ATAEN_DISABLE);\r\nif (HAS_NAND)\r\nplatform_device_register(\r\n&davinci_ntosd2_nandflash_device);\r\n}\r\nplatform_add_devices(davinci_ntosd2_devices,\r\nARRAY_SIZE(davinci_ntosd2_devices));\r\ndavinci_serial_init(dm644x_serial_device);\r\ndm644x_init_asp(&dm644x_ntosd2_snd_data);\r\nsoc_info->emac_pdata->phy_id = NEUROS_OSD2_PHY_ID;\r\ndavinci_setup_usb(1000, 8);\r\ndavinci_cfg_reg(DM644X_AEAW0);\r\ndavinci_cfg_reg(DM644X_AEAW1);\r\ndavinci_cfg_reg(DM644X_AEAW2);\r\ndavinci_cfg_reg(DM644X_AEAW3);\r\ndavinci_cfg_reg(DM644X_AEAW4);\r\ndavinci_setup_mmc(0, &davinci_ntosd2_mmc_config);\r\n}
