static void kirkwood_low_power(void)\r\n{\r\nu32 mem_pm_ctrl;\r\nmem_pm_ctrl = readl(memory_pm_ctrl);\r\nwritel_relaxed(~0, memory_pm_ctrl);\r\nwritel_relaxed(0x7, ddr_operation_base);\r\ncpu_do_idle();\r\nwritel_relaxed(mem_pm_ctrl, memory_pm_ctrl);\r\n}\r\nstatic int kirkwood_suspend_enter(suspend_state_t state)\r\n{\r\nswitch (state) {\r\ncase PM_SUSPEND_STANDBY:\r\nkirkwood_low_power();\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int kirkwood_pm_valid_standby(suspend_state_t state)\r\n{\r\nreturn state == PM_SUSPEND_STANDBY;\r\n}\r\nint __init kirkwood_pm_init(void)\r\n{\r\nddr_operation_base = ioremap(DDR_OPERATION_BASE, 4);\r\nmemory_pm_ctrl = ioremap(MEMORY_PM_CTRL_PHYS, 4);\r\nsuspend_set_ops(&kirkwood_suspend_ops);\r\nreturn 0;\r\n}
