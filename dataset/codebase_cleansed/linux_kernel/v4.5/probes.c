int probe_is_prohibited_opcode(u16 *insn)\r\n{\r\nif (!is_known_insn((unsigned char *)insn))\r\nreturn -EINVAL;\r\nswitch (insn[0] >> 8) {\r\ncase 0x0c:\r\ncase 0x0b:\r\ncase 0x83:\r\ncase 0x44:\r\ncase 0xac:\r\ncase 0xad:\r\nreturn -EINVAL;\r\ncase 0xc6:\r\nswitch (insn[0] & 0x0f) {\r\ncase 0x00:\r\nreturn -EINVAL;\r\n}\r\n}\r\nswitch (insn[0]) {\r\ncase 0x0101:\r\ncase 0xb25a:\r\ncase 0xb240:\r\ncase 0xb258:\r\ncase 0xb218:\r\ncase 0xb228:\r\ncase 0xb98d:\r\ncase 0xe560:\r\ncase 0xe561:\r\ncase 0xb2f8:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nint probe_get_fixup_type(u16 *insn)\r\n{\r\nint fixup = FIXUP_PSW_NORMAL;\r\nswitch (insn[0] >> 8) {\r\ncase 0x05:\r\ncase 0x0d:\r\nfixup = FIXUP_RETURN_REGISTER;\r\nif ((insn[0] & 0x0f) == 0)\r\nfixup |= FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\ncase 0x06:\r\ncase 0x07:\r\nfixup = FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\ncase 0x45:\r\ncase 0x4d:\r\nfixup = FIXUP_RETURN_REGISTER;\r\nbreak;\r\ncase 0x47:\r\ncase 0x46:\r\ncase 0x86:\r\ncase 0x87:\r\nfixup = FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\ncase 0x82:\r\nfixup = FIXUP_NOT_REQUIRED;\r\nbreak;\r\ncase 0xb2:\r\nif ((insn[0] & 0xff) == 0xb2)\r\nfixup = FIXUP_NOT_REQUIRED;\r\nbreak;\r\ncase 0xa7:\r\nif ((insn[0] & 0x0f) == 0x05)\r\nfixup |= FIXUP_RETURN_REGISTER;\r\nbreak;\r\ncase 0xc0:\r\nif ((insn[0] & 0x0f) == 0x05)\r\nfixup |= FIXUP_RETURN_REGISTER;\r\nbreak;\r\ncase 0xeb:\r\nswitch (insn[2] & 0xff) {\r\ncase 0x44:\r\ncase 0x45:\r\nfixup = FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\n}\r\nbreak;\r\ncase 0xe3:\r\nif ((insn[2] & 0xff) == 0x46)\r\nfixup = FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\ncase 0xec:\r\nswitch (insn[2] & 0xff) {\r\ncase 0xe5:\r\ncase 0xe6:\r\ncase 0xf6:\r\ncase 0xf7:\r\ncase 0xfc:\r\ncase 0xfd:\r\ncase 0xfe:\r\ncase 0xff:\r\nfixup = FIXUP_BRANCH_NOT_TAKEN;\r\nbreak;\r\n}\r\nbreak;\r\n}\r\nreturn fixup;\r\n}\r\nint probe_is_insn_relative_long(u16 *insn)\r\n{\r\nswitch (insn[0] >> 8) {\r\ncase 0xc0:\r\nif ((insn[0] & 0x0f) == 0x00)\r\nreturn true;\r\nbreak;\r\ncase 0xc4:\r\nswitch (insn[0] & 0x0f) {\r\ncase 0x02:\r\ncase 0x04:\r\ncase 0x05:\r\ncase 0x06:\r\ncase 0x07:\r\ncase 0x08:\r\ncase 0x0b:\r\ncase 0x0c:\r\ncase 0x0d:\r\ncase 0x0e:\r\ncase 0x0f:\r\nreturn true;\r\n}\r\nbreak;\r\ncase 0xc6:\r\nswitch (insn[0] & 0x0f) {\r\ncase 0x02:\r\ncase 0x04:\r\ncase 0x05:\r\ncase 0x06:\r\ncase 0x07:\r\ncase 0x08:\r\ncase 0x0a:\r\ncase 0x0c:\r\ncase 0x0d:\r\ncase 0x0e:\r\ncase 0x0f:\r\nreturn true;\r\n}\r\nbreak;\r\n}\r\nreturn false;\r\n}
