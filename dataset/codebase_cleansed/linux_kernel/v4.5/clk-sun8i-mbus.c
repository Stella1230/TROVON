static void sun8i_a23_get_mbus_factors(u32 *freq, u32 parent_rate,\r\nu8 *n, u8 *k, u8 *m, u8 *p)\r\n{\r\nu8 div;\r\nif (*freq > parent_rate)\r\n*freq = parent_rate;\r\ndiv = DIV_ROUND_UP(parent_rate, *freq);\r\nif (div > 8)\r\ndiv = 8;\r\n*freq = parent_rate / div;\r\nif (m == NULL)\r\nreturn;\r\n*m = div - 1;\r\n}\r\nstatic void __init sun8i_a23_mbus_setup(struct device_node *node)\r\n{\r\nstruct clk *mbus;\r\nvoid __iomem *reg;\r\nreg = of_iomap(node, 0);\r\nif (!reg) {\r\npr_err("Could not get registers for a23-mbus-clk\n");\r\nreturn;\r\n}\r\nmbus = sunxi_factors_register(node, &sun8i_a23_mbus_data,\r\n&sun8i_a23_mbus_lock, reg);\r\n__clk_get(mbus);\r\nclk_prepare_enable(mbus);\r\n}
