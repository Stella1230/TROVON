static inline struct clk_regmap_mux *to_clk_regmap_mux(struct clk_hw *hw)\r\n{\r\nreturn container_of(to_clk_regmap(hw), struct clk_regmap_mux, clkr);\r\n}\r\nstatic u8 mux_get_parent(struct clk_hw *hw)\r\n{\r\nstruct clk_regmap_mux *mux = to_clk_regmap_mux(hw);\r\nstruct clk_regmap *clkr = to_clk_regmap(hw);\r\nunsigned int mask = GENMASK(mux->width - 1, 0);\r\nunsigned int val;\r\nregmap_read(clkr->regmap, mux->reg, &val);\r\nval >>= mux->shift;\r\nval &= mask;\r\nreturn val;\r\n}\r\nstatic int mux_set_parent(struct clk_hw *hw, u8 index)\r\n{\r\nstruct clk_regmap_mux *mux = to_clk_regmap_mux(hw);\r\nstruct clk_regmap *clkr = to_clk_regmap(hw);\r\nunsigned int mask = GENMASK(mux->width + mux->shift - 1, mux->shift);\r\nunsigned int val;\r\nval = index;\r\nval <<= mux->shift;\r\nreturn regmap_update_bits(clkr->regmap, mux->reg, mask, val);\r\n}
