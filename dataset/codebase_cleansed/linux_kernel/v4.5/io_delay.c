void native_io_delay(void)\r\n{\r\nswitch (io_delay_type) {\r\ndefault:\r\ncase CONFIG_IO_DELAY_TYPE_0X80:\r\nasm volatile ("outb %al, $0x80");\r\nbreak;\r\ncase CONFIG_IO_DELAY_TYPE_0XED:\r\nasm volatile ("outb %al, $0xed");\r\nbreak;\r\ncase CONFIG_IO_DELAY_TYPE_UDELAY:\r\nudelay(2);\r\ncase CONFIG_IO_DELAY_TYPE_NONE:\r\nbreak;\r\n}\r\n}\r\nstatic int __init dmi_io_delay_0xed_port(const struct dmi_system_id *id)\r\n{\r\nif (io_delay_type == CONFIG_IO_DELAY_TYPE_0X80) {\r\npr_notice("%s: using 0xed I/O delay port\n", id->ident);\r\nio_delay_type = CONFIG_IO_DELAY_TYPE_0XED;\r\n}\r\nreturn 0;\r\n}\r\nvoid __init io_delay_init(void)\r\n{\r\nif (!io_delay_override)\r\ndmi_check_system(io_delay_0xed_port_dmi_table);\r\n}\r\nstatic int __init io_delay_param(char *s)\r\n{\r\nif (!s)\r\nreturn -EINVAL;\r\nif (!strcmp(s, "0x80"))\r\nio_delay_type = CONFIG_IO_DELAY_TYPE_0X80;\r\nelse if (!strcmp(s, "0xed"))\r\nio_delay_type = CONFIG_IO_DELAY_TYPE_0XED;\r\nelse if (!strcmp(s, "udelay"))\r\nio_delay_type = CONFIG_IO_DELAY_TYPE_UDELAY;\r\nelse if (!strcmp(s, "none"))\r\nio_delay_type = CONFIG_IO_DELAY_TYPE_NONE;\r\nelse\r\nreturn -EINVAL;\r\nio_delay_override = 1;\r\nreturn 0;\r\n}
