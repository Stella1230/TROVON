const char *sti_plane_to_str(struct sti_plane *plane)\r\n{\r\nswitch (plane->desc) {\r\ncase STI_GDP_0:\r\nreturn "GDP0";\r\ncase STI_GDP_1:\r\nreturn "GDP1";\r\ncase STI_GDP_2:\r\nreturn "GDP2";\r\ncase STI_GDP_3:\r\nreturn "GDP3";\r\ncase STI_HQVDP_0:\r\nreturn "HQVDP0";\r\ncase STI_CURSOR:\r\nreturn "CURSOR";\r\ndefault:\r\nreturn "<UNKNOWN PLANE>";\r\n}\r\n}\r\nstatic void sti_plane_destroy(struct drm_plane *drm_plane)\r\n{\r\nDRM_DEBUG_DRIVER("\n");\r\ndrm_plane_helper_disable(drm_plane);\r\ndrm_plane_cleanup(drm_plane);\r\n}\r\nstatic int sti_plane_set_property(struct drm_plane *drm_plane,\r\nstruct drm_property *property,\r\nuint64_t val)\r\n{\r\nstruct drm_device *dev = drm_plane->dev;\r\nstruct sti_private *private = dev->dev_private;\r\nstruct sti_plane *plane = to_sti_plane(drm_plane);\r\nDRM_DEBUG_DRIVER("\n");\r\nif (property == private->plane_zorder_property) {\r\nplane->zorder = val;\r\nreturn 0;\r\n}\r\nreturn -EINVAL;\r\n}\r\nstatic void sti_plane_attach_zorder_property(struct drm_plane *drm_plane)\r\n{\r\nstruct drm_device *dev = drm_plane->dev;\r\nstruct sti_private *private = dev->dev_private;\r\nstruct sti_plane *plane = to_sti_plane(drm_plane);\r\nstruct drm_property *prop;\r\nprop = private->plane_zorder_property;\r\nif (!prop) {\r\nprop = drm_property_create_range(dev, 0, "zpos", 1,\r\nGAM_MIXER_NB_DEPTH_LEVEL);\r\nif (!prop)\r\nreturn;\r\nprivate->plane_zorder_property = prop;\r\n}\r\ndrm_object_attach_property(&drm_plane->base, prop, plane->zorder);\r\n}\r\nvoid sti_plane_init_property(struct sti_plane *plane,\r\nenum drm_plane_type type)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < ARRAY_SIZE(sti_plane_default_zorder); i++)\r\nif (sti_plane_default_zorder[i] == plane->desc)\r\nbreak;\r\nplane->zorder = i + 1;\r\nif (type == DRM_PLANE_TYPE_OVERLAY)\r\nsti_plane_attach_zorder_property(&plane->drm_plane);\r\nDRM_DEBUG_DRIVER("drm plane:%d mapped to %s with zorder:%d\n",\r\nplane->drm_plane.base.id,\r\nsti_plane_to_str(plane), plane->zorder);\r\n}
