u64 hw_nmi_get_sample_period(int watchdog_thresh)\r\n{\r\nreturn (u64)(cpu_khz) * 1000 * watchdog_thresh;\r\n}\r\nstatic void nmi_raise_cpu_backtrace(cpumask_t *mask)\r\n{\r\napic->send_IPI_mask(mask, NMI_VECTOR);\r\n}\r\nvoid arch_trigger_all_cpu_backtrace(bool include_self)\r\n{\r\nnmi_trigger_all_cpu_backtrace(include_self, nmi_raise_cpu_backtrace);\r\n}\r\nstatic int\r\narch_trigger_all_cpu_backtrace_handler(unsigned int cmd, struct pt_regs *regs)\r\n{\r\nif (nmi_cpu_backtrace(regs))\r\nreturn NMI_HANDLED;\r\nreturn NMI_DONE;\r\n}\r\nstatic int __init register_trigger_all_cpu_backtrace(void)\r\n{\r\nregister_nmi_handler(NMI_LOCAL, arch_trigger_all_cpu_backtrace_handler,\r\n0, "arch_bt");\r\nreturn 0;\r\n}
