unsigned int __init scu_get_core_count(void __iomem *scu_base)\r\n{\r\nunsigned int ncores = readl_relaxed(scu_base + SCU_CONFIG);\r\nreturn (ncores & 0x03) + 1;\r\n}\r\nvoid scu_enable(void __iomem *scu_base)\r\n{\r\nu32 scu_ctrl;\r\n#ifdef CONFIG_ARM_ERRATA_764369\r\nif ((read_cpuid_id() & 0xff0ffff0) == 0x410fc090) {\r\nscu_ctrl = readl_relaxed(scu_base + 0x30);\r\nif (!(scu_ctrl & 1))\r\nwritel_relaxed(scu_ctrl | 0x1, scu_base + 0x30);\r\n}\r\n#endif\r\nscu_ctrl = readl_relaxed(scu_base + SCU_CTRL);\r\nif (scu_ctrl & SCU_ENABLE)\r\nreturn;\r\nscu_ctrl |= SCU_ENABLE;\r\nif ((read_cpuid_id() & 0xff0ffff0) == 0x410fc090 &&\r\n(read_cpuid_id() & 0x00f0000f) >= 0x00200000)\r\nscu_ctrl |= SCU_STANDBY_ENABLE;\r\nwritel_relaxed(scu_ctrl, scu_base + SCU_CTRL);\r\nflush_cache_all();\r\n}\r\nint scu_power_mode(void __iomem *scu_base, unsigned int mode)\r\n{\r\nunsigned int val;\r\nint cpu = MPIDR_AFFINITY_LEVEL(cpu_logical_map(smp_processor_id()), 0);\r\nif (mode > 3 || mode == 1 || cpu > 3)\r\nreturn -EINVAL;\r\nval = readb_relaxed(scu_base + SCU_CPU_STATUS + cpu) & ~0x03;\r\nval |= mode;\r\nwriteb_relaxed(val, scu_base + SCU_CPU_STATUS + cpu);\r\nreturn 0;\r\n}
