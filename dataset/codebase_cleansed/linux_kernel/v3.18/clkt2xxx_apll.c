static bool omap2xxx_clk_apll_locked(struct clk_hw *hw)\r\n{\r\nstruct clk_hw_omap *clk = to_clk_hw_omap(hw);\r\nu32 r, apll_mask;\r\napll_mask = EN_APLL_LOCKED << clk->enable_bit;\r\nr = omap2xxx_cm_get_pll_status();\r\nreturn ((r & apll_mask) == apll_mask) ? true : false;\r\n}\r\nint omap2_clk_apll96_enable(struct clk_hw *hw)\r\n{\r\nreturn omap2xxx_cm_apll96_enable();\r\n}\r\nint omap2_clk_apll54_enable(struct clk_hw *hw)\r\n{\r\nreturn omap2xxx_cm_apll54_enable();\r\n}\r\nstatic void _apll96_allow_idle(struct clk_hw_omap *clk)\r\n{\r\nomap2xxx_cm_set_apll96_auto_low_power_stop();\r\n}\r\nstatic void _apll96_deny_idle(struct clk_hw_omap *clk)\r\n{\r\nomap2xxx_cm_set_apll96_disable_autoidle();\r\n}\r\nstatic void _apll54_allow_idle(struct clk_hw_omap *clk)\r\n{\r\nomap2xxx_cm_set_apll54_auto_low_power_stop();\r\n}\r\nstatic void _apll54_deny_idle(struct clk_hw_omap *clk)\r\n{\r\nomap2xxx_cm_set_apll54_disable_autoidle();\r\n}\r\nvoid omap2_clk_apll96_disable(struct clk_hw *hw)\r\n{\r\nomap2xxx_cm_apll96_disable();\r\n}\r\nvoid omap2_clk_apll54_disable(struct clk_hw *hw)\r\n{\r\nomap2xxx_cm_apll54_disable();\r\n}\r\nunsigned long omap2_clk_apll54_recalc(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nreturn (omap2xxx_clk_apll_locked(hw)) ? 54000000 : 0;\r\n}\r\nunsigned long omap2_clk_apll96_recalc(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nreturn (omap2xxx_clk_apll_locked(hw)) ? 96000000 : 0;\r\n}\r\nu32 omap2xxx_get_apll_clkin(void)\r\n{\r\nu32 aplls, srate = 0;\r\naplls = omap2xxx_cm_get_pll_config();\r\naplls &= OMAP24XX_APLLS_CLKIN_MASK;\r\naplls >>= OMAP24XX_APLLS_CLKIN_SHIFT;\r\nif (aplls == APLLS_CLKIN_19_2MHZ)\r\nsrate = 19200000;\r\nelse if (aplls == APLLS_CLKIN_13MHZ)\r\nsrate = 13000000;\r\nelse if (aplls == APLLS_CLKIN_12MHZ)\r\nsrate = 12000000;\r\nreturn srate;\r\n}
