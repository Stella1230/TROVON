int hda_display_power(bool enable)\r\n{\r\nif (!get_power || !put_power)\r\nreturn -ENODEV;\r\npr_debug("HDA display power %s \n",\r\nenable ? "Enable" : "Disable");\r\nif (enable)\r\nreturn get_power();\r\nelse\r\nreturn put_power();\r\n}\r\nvoid haswell_set_bclk(struct azx *chip)\r\n{\r\nint cdclk_freq;\r\nunsigned int bclk_m, bclk_n;\r\nif (!get_cdclk)\r\nreturn;\r\ncdclk_freq = get_cdclk();\r\nswitch (cdclk_freq) {\r\ncase 337500:\r\nbclk_m = 16;\r\nbclk_n = 225;\r\nbreak;\r\ncase 450000:\r\ndefault:\r\nbclk_m = 4;\r\nbclk_n = 75;\r\nbreak;\r\ncase 540000:\r\nbclk_m = 4;\r\nbclk_n = 90;\r\nbreak;\r\ncase 675000:\r\nbclk_m = 8;\r\nbclk_n = 225;\r\nbreak;\r\n}\r\nazx_writew(chip, EM4, bclk_m);\r\nazx_writew(chip, EM5, bclk_n);\r\n}\r\nint hda_i915_init(void)\r\n{\r\nint err = 0;\r\nget_power = symbol_request(i915_request_power_well);\r\nif (!get_power) {\r\npr_warn("hda-i915: get_power symbol get fail\n");\r\nreturn -ENODEV;\r\n}\r\nput_power = symbol_request(i915_release_power_well);\r\nif (!put_power) {\r\nsymbol_put(i915_request_power_well);\r\nget_power = NULL;\r\nreturn -ENODEV;\r\n}\r\nget_cdclk = symbol_request(i915_get_cdclk_freq);\r\nif (!get_cdclk)\r\npr_warn("hda-i915: get_cdclk symbol get fail\n");\r\npr_debug("HDA driver get symbol successfully from i915 module\n");\r\nreturn err;\r\n}\r\nint hda_i915_exit(void)\r\n{\r\nif (get_power) {\r\nsymbol_put(i915_request_power_well);\r\nget_power = NULL;\r\n}\r\nif (put_power) {\r\nsymbol_put(i915_release_power_well);\r\nput_power = NULL;\r\n}\r\nif (get_cdclk) {\r\nsymbol_put(i915_get_cdclk_freq);\r\nget_cdclk = NULL;\r\n}\r\nreturn 0;\r\n}
