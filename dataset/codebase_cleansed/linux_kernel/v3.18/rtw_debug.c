int proc_get_drv_version(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "%s\n", DRIVERVERSION);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_write_reg(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\n*eof = 1;\r\nreturn 0;\r\n}\r\nint proc_set_write_reg(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nchar tmp[32];\r\nu32 addr, val, len;\r\nif (count < 3) {\r\nDBG_88E("argument size is less than 3\n");\r\nreturn -EFAULT;\r\n}\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%x %x %x", &addr, &val, &len);\r\nif (num != 3) {\r\nDBG_88E("invalid write_reg parameter!\n");\r\nreturn count;\r\n}\r\nswitch (len) {\r\ncase 1:\r\nusb_write8(padapter, addr, (u8)val);\r\nbreak;\r\ncase 2:\r\nusb_write16(padapter, addr, (u16)val);\r\nbreak;\r\ncase 4:\r\nusb_write32(padapter, addr, val);\r\nbreak;\r\ndefault:\r\nDBG_88E("error write length =%d", len);\r\nbreak;\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_read_reg(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nif (proc_get_read_addr == 0xeeeeeeee) {\r\n*eof = 1;\r\nreturn len;\r\n}\r\nswitch (proc_get_read_len) {\r\ncase 1:\r\nlen += snprintf(page + len, count - len, "usb_read8(0x%x)=0x%x\n", proc_get_read_addr, usb_read8(padapter, proc_get_read_addr));\r\nbreak;\r\ncase 2:\r\nlen += snprintf(page + len, count - len, "usb_read16(0x%x)=0x%x\n", proc_get_read_addr, usb_read16(padapter, proc_get_read_addr));\r\nbreak;\r\ncase 4:\r\nlen += snprintf(page + len, count - len, "usb_read32(0x%x)=0x%x\n", proc_get_read_addr, usb_read32(padapter, proc_get_read_addr));\r\nbreak;\r\ndefault:\r\nlen += snprintf(page + len, count - len, "error read length=%d\n", proc_get_read_len);\r\nbreak;\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_read_reg(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nchar tmp[16];\r\nu32 addr, len;\r\nif (count < 2) {\r\nDBG_88E("argument size is less than 2\n");\r\nreturn -EFAULT;\r\n}\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%x %x", &addr, &len);\r\nif (num != 2) {\r\nDBG_88E("invalid read_reg parameter!\n");\r\nreturn count;\r\n}\r\nproc_get_read_addr = addr;\r\nproc_get_read_len = len;\r\n}\r\nreturn count;\r\n}\r\nint proc_get_fwstate(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_priv *pmlmepriv = &(padapter->mlmepriv);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "fwstate=0x%x\n", get_fwstate(pmlmepriv));\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_sec_info(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct security_priv *psecuritypriv = &padapter->securitypriv;\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "auth_alg=0x%x, enc_alg=0x%x, auth_type=0x%x, enc_type=0x%x\n",\r\npsecuritypriv->dot11AuthAlgrthm, psecuritypriv->dot11PrivacyAlgrthm,\r\npsecuritypriv->ndisauthtype, psecuritypriv->ndisencryptstatus);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_mlmext_state(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\r\nstruct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "pmlmeinfo->state=0x%x\n", pmlmeinfo->state);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_qos_option(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_priv *pmlmepriv = &(padapter->mlmepriv);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "qos_option=%d\n", pmlmepriv->qospriv.qos_option);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_ht_option(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_priv *pmlmepriv = &(padapter->mlmepriv);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "ht_option=%d\n", pmlmepriv->htpriv.ht_option);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rf_info(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "cur_ch=%d, cur_bw=%d, cur_ch_offset=%d\n",\r\npmlmeext->cur_channel, pmlmeext->cur_bwmode, pmlmeext->cur_ch_offset);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_ap_info(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct sta_info *psta;\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_priv *pmlmepriv = &(padapter->mlmepriv);\r\nstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\r\nstruct wlan_network *cur_network = &(pmlmepriv->cur_network);\r\nstruct sta_priv *pstapriv = &padapter->stapriv;\r\nint len = 0;\r\npsta = rtw_get_stainfo(pstapriv, cur_network->network.MacAddress);\r\nif (psta) {\r\nint i;\r\nstruct recv_reorder_ctrl *preorder_ctrl;\r\nlen += snprintf(page + len, count - len, "SSID=%s\n", cur_network->network.Ssid.Ssid);\r\nlen += snprintf(page + len, count - len, "sta's macaddr:%pM\n", psta->hwaddr);\r\nlen += snprintf(page + len, count - len, "cur_channel=%d, cur_bwmode=%d, cur_ch_offset=%d\n", pmlmeext->cur_channel, pmlmeext->cur_bwmode, pmlmeext->cur_ch_offset);\r\nlen += snprintf(page + len, count - len, "rtsen=%d, cts2slef=%d\n", psta->rtsen, psta->cts2self);\r\nlen += snprintf(page + len, count - len, "state=0x%x, aid=%d, macid=%d, raid=%d\n", psta->state, psta->aid, psta->mac_id, psta->raid);\r\nlen += snprintf(page + len, count - len, "qos_en=%d, ht_en=%d, init_rate=%d\n", psta->qos_option, psta->htpriv.ht_option, psta->init_rate);\r\nlen += snprintf(page + len, count - len, "bwmode=%d, ch_offset=%d, sgi=%d\n", psta->htpriv.bwmode, psta->htpriv.ch_offset, psta->htpriv.sgi);\r\nlen += snprintf(page + len, count - len, "ampdu_enable = %d\n", psta->htpriv.ampdu_enable);\r\nlen += snprintf(page + len, count - len, "agg_enable_bitmap=%x, candidate_tid_bitmap=%x\n", psta->htpriv.agg_enable_bitmap, psta->htpriv.candidate_tid_bitmap);\r\nfor (i = 0; i < 16; i++) {\r\npreorder_ctrl = &psta->recvreorder_ctrl[i];\r\nif (preorder_ctrl->enable)\r\nlen += snprintf(page + len, count - len, "tid=%d, indicate_seq=%d\n", i, preorder_ctrl->indicate_seq);\r\n}\r\n} else {\r\nlen += snprintf(page + len, count - len, "can't get sta's macaddr, cur_network's macaddr: %pM\n", cur_network->network.MacAddress);\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_adapter_state(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "bSurpriseRemoved=%d, bDriverStopped=%d\n",\r\npadapter->bSurpriseRemoved, padapter->bDriverStopped);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_trx_info(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct xmit_priv *pxmitpriv = &padapter->xmitpriv;\r\nstruct recv_priv *precvpriv = &padapter->recvpriv;\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "free_xmitbuf_cnt=%d, free_xmitframe_cnt=%d, free_ext_xmitbuf_cnt=%d, free_recvframe_cnt=%d\n",\r\npxmitpriv->free_xmitbuf_cnt, pxmitpriv->free_xmitframe_cnt, pxmitpriv->free_xmit_extbuf_cnt, precvpriv->free_recvframe_cnt);\r\nlen += snprintf(page + len, count - len, "rx_urb_pending_cn=%d\n", precvpriv->rx_pending_cnt);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_mac_reg_dump1(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= MAC REG =======\n");\r\nfor (i = 0x0; i < 0x300; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_mac_reg_dump2(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= MAC REG =======\n");\r\nmemset(page, 0, count);\r\nfor (i = 0x300; i < 0x600; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_mac_reg_dump3(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= MAC REG =======\n");\r\nfor (i = 0x600; i < 0x800; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_bb_reg_dump1(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= BB REG =======\n");\r\nfor (i = 0x800; i < 0xB00; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_bb_reg_dump2(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= BB REG =======\n");\r\nfor (i = 0xB00; i < 0xE00; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_bb_reg_dump3(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1;\r\nlen += snprintf(page + len, count - len, "\n======= BB REG =======\n");\r\nfor (i = 0xE00; i < 0x1000; i += 4) {\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", usb_read32(padapter, i));\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rf_reg_dump1(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1, path;\r\nu32 value;\r\nlen += snprintf(page + len, count - len, "\n======= RF REG =======\n");\r\npath = 1;\r\nlen += snprintf(page + len, count - len, "\nRF_Path(%x)\n", path);\r\nfor (i = 0; i < 0xC0; i++) {\r\nvalue = rtw_hal_read_rfreg(padapter, path, i, 0xffffffff);\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x ", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", value);\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rf_reg_dump2(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1, path;\r\nu32 value;\r\nlen += snprintf(page + len, count - len, "\n======= RF REG =======\n");\r\npath = 1;\r\nlen += snprintf(page + len, count - len, "\nRF_Path(%x)\n", path);\r\nfor (i = 0xC0; i < 0x100; i++) {\r\nvalue = rtw_hal_read_rfreg(padapter, path, i, 0xffffffff);\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x ", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", value);\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rf_reg_dump3(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1, path;\r\nu32 value;\r\nlen += snprintf(page + len, count - len, "\n======= RF REG =======\n");\r\npath = 2;\r\nlen += snprintf(page + len, count - len, "\nRF_Path(%x)\n", path);\r\nfor (i = 0; i < 0xC0; i++) {\r\nvalue = rtw_hal_read_rfreg(padapter, path, i, 0xffffffff);\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x ", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", value);\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rf_reg_dump4(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nint i, j = 1, path;\r\nu32 value;\r\nlen += snprintf(page + len, count - len, "\n======= RF REG =======\n");\r\npath = 2;\r\nlen += snprintf(page + len, count - len, "\nRF_Path(%x)\n", path);\r\nfor (i = 0xC0; i < 0x100; i++) {\r\nvalue = rtw_hal_read_rfreg(padapter, path, i, 0xffffffff);\r\nif (j%4 == 1)\r\nlen += snprintf(page + len, count - len, "0x%02x ", i);\r\nlen += snprintf(page + len, count - len, " 0x%08x ", value);\r\nif ((j++)%4 == 0)\r\nlen += snprintf(page + len, count - len, "\n");\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rx_signal(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nlen = snprintf(page + len, count,\r\n"rssi:%d\n"\r\n"rxpwdb:%d\n"\r\n"signal_strength:%u\n"\r\n"signal_qual:%u\n"\r\n"noise:%u\n",\r\npadapter->recvpriv.rssi,\r\npadapter->recvpriv.rxpwdb,\r\npadapter->recvpriv.signal_strength,\r\npadapter->recvpriv.signal_qual,\r\npadapter->recvpriv.noise\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_rx_signal(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nchar tmp[32];\r\nu32 is_signal_dbg;\r\ns32 signal_strength;\r\nif (count < 1)\r\nreturn -EFAULT;\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%u %u", &is_signal_dbg, &signal_strength);\r\nis_signal_dbg = is_signal_dbg == 0 ? 0 : 1;\r\nif (is_signal_dbg && num != 2)\r\nreturn count;\r\nsignal_strength = signal_strength > 100 ? 100 : signal_strength;\r\nsignal_strength = signal_strength < 0 ? 0 : signal_strength;\r\npadapter->recvpriv.is_signal_dbg = is_signal_dbg;\r\npadapter->recvpriv.signal_strength_dbg = signal_strength;\r\nif (is_signal_dbg)\r\nDBG_88E("set %s %u\n", "DBG_SIGNAL_STRENGTH", signal_strength);\r\nelse\r\nDBG_88E("set %s\n", "HW_SIGNAL_STRENGTH");\r\n}\r\nreturn count;\r\n}\r\nint proc_get_ht_enable(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nint len = 0;\r\nif (pregpriv)\r\nlen += snprintf(page + len, count - len,\r\n"%d\n",\r\npregpriv->ht_enable\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_ht_enable(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nchar tmp[32];\r\ns32 mode = 0;\r\nif (count < 1)\r\nreturn -EFAULT;\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nif (pregpriv) {\r\npregpriv->ht_enable = mode;\r\npr_info("ht_enable=%d\n", pregpriv->ht_enable);\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_cbw40_enable(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nint len = 0;\r\nif (pregpriv)\r\nlen += snprintf(page + len, count - len,\r\n"%d\n",\r\npregpriv->cbw40_enable\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_cbw40_enable(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nchar tmp[32];\r\ns32 mode = 0;\r\nif (count < 1)\r\nreturn -EFAULT;\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nif (pregpriv) {\r\npregpriv->cbw40_enable = mode;\r\npr_info("cbw40_enable=%d\n", mode);\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_ampdu_enable(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nint len = 0;\r\nif (pregpriv)\r\nlen += snprintf(page + len, count - len,\r\n"%d\n",\r\npregpriv->ampdu_enable\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_ampdu_enable(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nchar tmp[32];\r\ns32 mode = 0;\r\nif (count < 1)\r\nreturn -EFAULT;\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nif (pregpriv) {\r\npregpriv->ampdu_enable = mode;\r\npr_info("ampdu_enable=%d\n", mode);\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_two_path_rssi(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nif (padapter)\r\nlen += snprintf(page + len, count - len,\r\n"%d %d\n",\r\npadapter->recvpriv.RxRssi[0],\r\npadapter->recvpriv.RxRssi[1]\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_rx_stbc(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nint len = 0;\r\nif (pregpriv)\r\nlen += snprintf(page + len, count - len,\r\n"%d\n",\r\npregpriv->rx_stbc\r\n);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_rx_stbc(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct registry_priv *pregpriv = &padapter->registrypriv;\r\nchar tmp[32];\r\nu32 mode = 0;\r\nif (count < 1)\r\nreturn -EFAULT;\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nif (pregpriv) {\r\npregpriv->rx_stbc = mode;\r\nnetdev_info(dev, "rx_stbc=%d\n", mode);\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_rssi_disp(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\n*eof = 1;\r\nreturn 0;\r\n}\r\nint proc_set_rssi_disp(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = (struct net_device *)data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nchar tmp[32];\r\nu32 enable = 0;\r\nif (count < 1) {\r\nDBG_88E("argument size is less than 1\n");\r\nreturn -EFAULT;\r\n}\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%x", &enable);\r\nif (num != 1) {\r\nDBG_88E("invalid set_rssi_disp parameter!\n");\r\nreturn count;\r\n}\r\nif (enable) {\r\nDBG_88E("Turn On Rx RSSI Display Function\n");\r\npadapter->bRxRSSIDisplay = enable;\r\n} else {\r\nDBG_88E("Turn Off Rx RSSI Display Function\n");\r\npadapter->bRxRSSIDisplay = 0;\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_all_sta_info(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct sta_info *psta;\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct sta_priv *pstapriv = &padapter->stapriv;\r\nint i, j;\r\nstruct list_head *plist, *phead;\r\nstruct recv_reorder_ctrl *preorder_ctrl;\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "sta_dz_bitmap=0x%x, tim_bitmap=0x%x\n", pstapriv->sta_dz_bitmap, pstapriv->tim_bitmap);\r\nspin_lock_bh(&pstapriv->sta_hash_lock);\r\nfor (i = 0; i < NUM_STA; i++) {\r\nphead = &(pstapriv->sta_hash[i]);\r\nplist = phead->next;\r\nwhile (phead != plist) {\r\npsta = container_of(plist, struct sta_info, hash_list);\r\nplist = plist->next;\r\nlen += snprintf(page + len, count - len, "sta's macaddr: %pM\n", psta->hwaddr);\r\nlen += snprintf(page + len, count - len, "rtsen=%d, cts2slef=%d\n", psta->rtsen, psta->cts2self);\r\nlen += snprintf(page + len, count - len, "state=0x%x, aid=%d, macid=%d, raid=%d\n", psta->state, psta->aid, psta->mac_id, psta->raid);\r\nlen += snprintf(page + len, count - len, "qos_en=%d, ht_en=%d, init_rate=%d\n", psta->qos_option, psta->htpriv.ht_option, psta->init_rate);\r\nlen += snprintf(page + len, count - len, "bwmode=%d, ch_offset=%d, sgi=%d\n", psta->htpriv.bwmode, psta->htpriv.ch_offset, psta->htpriv.sgi);\r\nlen += snprintf(page + len, count - len, "ampdu_enable = %d\n", psta->htpriv.ampdu_enable);\r\nlen += snprintf(page + len, count - len, "agg_enable_bitmap=%x, candidate_tid_bitmap=%x\n", psta->htpriv.agg_enable_bitmap, psta->htpriv.candidate_tid_bitmap);\r\nlen += snprintf(page + len, count - len, "sleepq_len=%d\n", psta->sleepq_len);\r\nlen += snprintf(page + len, count - len, "capability=0x%x\n", psta->capability);\r\nlen += snprintf(page + len, count - len, "flags=0x%x\n", psta->flags);\r\nlen += snprintf(page + len, count - len, "wpa_psk=0x%x\n", psta->wpa_psk);\r\nlen += snprintf(page + len, count - len, "wpa2_group_cipher=0x%x\n", psta->wpa2_group_cipher);\r\nlen += snprintf(page + len, count - len, "wpa2_pairwise_cipher=0x%x\n", psta->wpa2_pairwise_cipher);\r\nlen += snprintf(page + len, count - len, "qos_info=0x%x\n", psta->qos_info);\r\nlen += snprintf(page + len, count - len, "dot118021XPrivacy=0x%x\n", psta->dot118021XPrivacy);\r\nfor (j = 0; j < 16; j++) {\r\npreorder_ctrl = &psta->recvreorder_ctrl[j];\r\nif (preorder_ctrl->enable)\r\nlen += snprintf(page + len, count - len, "tid=%d, indicate_seq=%d\n", j, preorder_ctrl->indicate_seq);\r\n}\r\n}\r\n}\r\nspin_unlock_bh(&pstapriv->sta_hash_lock);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_best_channel(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\r\nint len = 0;\r\nu32 i, best_channel_24G = 1, best_channel_5G = 36, index_24G = 0, index_5G = 0;\r\nfor (i = 0; pmlmeext->channel_set[i].ChannelNum != 0; i++) {\r\nif (pmlmeext->channel_set[i].ChannelNum == 1)\r\nindex_24G = i;\r\nif (pmlmeext->channel_set[i].ChannelNum == 36)\r\nindex_5G = i;\r\n}\r\nfor (i = 0; pmlmeext->channel_set[i].ChannelNum != 0; i++) {\r\nif (pmlmeext->channel_set[i].ChannelNum == 6) {\r\nif (pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_24G].rx_count) {\r\nindex_24G = i;\r\nbest_channel_24G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nif (pmlmeext->channel_set[i].ChannelNum >= 36 &&\r\npmlmeext->channel_set[i].ChannelNum < 140) {\r\nif (((pmlmeext->channel_set[i].ChannelNum - 36) % 8 == 0) &&\r\n(pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_5G].rx_count)) {\r\nindex_5G = i;\r\nbest_channel_5G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nif (pmlmeext->channel_set[i].ChannelNum >= 149 &&\r\npmlmeext->channel_set[i].ChannelNum < 165) {\r\nif (((pmlmeext->channel_set[i].ChannelNum - 149) % 8 == 0) &&\r\n(pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_5G].rx_count)) {\r\nindex_5G = i;\r\nbest_channel_5G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nlen += snprintf(page + len, count - len, "The rx cnt of channel %3d = %d\n",\r\npmlmeext->channel_set[i].ChannelNum, pmlmeext->channel_set[i].rx_count);\r\n}\r\nlen += snprintf(page + len, count - len, "best_channel_5G = %d\n", best_channel_5G);\r\nlen += snprintf(page + len, count - len, "best_channel_24G = %d\n", best_channel_24G);\r\n*eof = 1;\r\nreturn len;\r\n}
