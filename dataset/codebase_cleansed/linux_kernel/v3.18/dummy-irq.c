static irqreturn_t dummy_interrupt(int irq, void *dev_id)\r\n{\r\nstatic int count = 0;\r\nif (count == 0) {\r\nprintk(KERN_INFO "dummy-irq: interrupt occurred on IRQ %d\n",\r\nirq);\r\ncount++;\r\n}\r\nreturn IRQ_NONE;\r\n}\r\nstatic int __init dummy_irq_init(void)\r\n{\r\nif (irq < 0) {\r\nprintk(KERN_ERR "dummy-irq: no IRQ given. Use irq=N\n");\r\nreturn -EIO;\r\n}\r\nif (request_irq(irq, &dummy_interrupt, IRQF_SHARED, "dummy_irq", &irq)) {\r\nprintk(KERN_ERR "dummy-irq: cannot register IRQ %d\n", irq);\r\nreturn -EIO;\r\n}\r\nprintk(KERN_INFO "dummy-irq: registered for IRQ %d\n", irq);\r\nreturn 0;\r\n}\r\nstatic void __exit dummy_irq_exit(void)\r\n{\r\nprintk(KERN_INFO "dummy-irq unloaded\n");\r\nfree_irq(irq, &irq);\r\n}
