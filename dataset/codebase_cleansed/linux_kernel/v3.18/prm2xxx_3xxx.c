int omap2_prm_is_hardreset_asserted(s16 prm_mod, u8 shift)\r\n{\r\nreturn omap2_prm_read_mod_bits_shift(prm_mod, OMAP2_RM_RSTCTRL,\r\n(1 << shift));\r\n}\r\nint omap2_prm_assert_hardreset(s16 prm_mod, u8 shift)\r\n{\r\nu32 mask;\r\nmask = 1 << shift;\r\nomap2_prm_rmw_mod_reg_bits(mask, mask, prm_mod, OMAP2_RM_RSTCTRL);\r\nreturn 0;\r\n}\r\nint omap2_prm_deassert_hardreset(s16 prm_mod, u8 rst_shift, u8 st_shift)\r\n{\r\nu32 rst, st;\r\nint c;\r\nrst = 1 << rst_shift;\r\nst = 1 << st_shift;\r\nif (omap2_prm_read_mod_bits_shift(prm_mod, OMAP2_RM_RSTCTRL, rst) == 0)\r\nreturn -EEXIST;\r\nomap2_prm_rmw_mod_reg_bits(0xffffffff, st, prm_mod, OMAP2_RM_RSTST);\r\nomap2_prm_rmw_mod_reg_bits(rst, 0, prm_mod, OMAP2_RM_RSTCTRL);\r\nomap_test_timeout(omap2_prm_read_mod_bits_shift(prm_mod, OMAP2_RM_RSTST,\r\nst),\r\nMAX_MODULE_HARDRESET_WAIT, c);\r\nreturn (c == MAX_MODULE_HARDRESET_WAIT) ? -EBUSY : 0;\r\n}\r\nint omap2_pwrdm_set_mem_onst(struct powerdomain *pwrdm, u8 bank,\r\nu8 pwrst)\r\n{\r\nu32 m;\r\nm = omap2_pwrdm_get_mem_bank_onstate_mask(bank);\r\nomap2_prm_rmw_mod_reg_bits(m, (pwrst << __ffs(m)), pwrdm->prcm_offs,\r\nOMAP2_PM_PWSTCTRL);\r\nreturn 0;\r\n}\r\nint omap2_pwrdm_set_mem_retst(struct powerdomain *pwrdm, u8 bank,\r\nu8 pwrst)\r\n{\r\nu32 m;\r\nm = omap2_pwrdm_get_mem_bank_retst_mask(bank);\r\nomap2_prm_rmw_mod_reg_bits(m, (pwrst << __ffs(m)), pwrdm->prcm_offs,\r\nOMAP2_PM_PWSTCTRL);\r\nreturn 0;\r\n}\r\nint omap2_pwrdm_read_mem_pwrst(struct powerdomain *pwrdm, u8 bank)\r\n{\r\nu32 m;\r\nm = omap2_pwrdm_get_mem_bank_stst_mask(bank);\r\nreturn omap2_prm_read_mod_bits_shift(pwrdm->prcm_offs, OMAP2_PM_PWSTST,\r\nm);\r\n}\r\nint omap2_pwrdm_read_mem_retst(struct powerdomain *pwrdm, u8 bank)\r\n{\r\nu32 m;\r\nm = omap2_pwrdm_get_mem_bank_retst_mask(bank);\r\nreturn omap2_prm_read_mod_bits_shift(pwrdm->prcm_offs,\r\nOMAP2_PM_PWSTCTRL, m);\r\n}\r\nint omap2_pwrdm_set_logic_retst(struct powerdomain *pwrdm, u8 pwrst)\r\n{\r\nu32 v;\r\nv = pwrst << __ffs(OMAP_LOGICRETSTATE_MASK);\r\nomap2_prm_rmw_mod_reg_bits(OMAP_LOGICRETSTATE_MASK, v, pwrdm->prcm_offs,\r\nOMAP2_PM_PWSTCTRL);\r\nreturn 0;\r\n}\r\nint omap2_pwrdm_wait_transition(struct powerdomain *pwrdm)\r\n{\r\nu32 c = 0;\r\nwhile ((omap2_prm_read_mod_reg(pwrdm->prcm_offs, OMAP2_PM_PWSTST) &\r\nOMAP_INTRANSITION_MASK) &&\r\n(c++ < PWRDM_TRANSITION_BAILOUT))\r\nudelay(1);\r\nif (c > PWRDM_TRANSITION_BAILOUT) {\r\npr_err("powerdomain: %s: waited too long to complete transition\n",\r\npwrdm->name);\r\nreturn -EAGAIN;\r\n}\r\npr_debug("powerdomain: completed transition in %d loops\n", c);\r\nreturn 0;\r\n}\r\nint omap2_clkdm_add_wkdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nomap2_prm_set_mod_reg_bits((1 << clkdm2->dep_bit),\r\nclkdm1->pwrdm.ptr->prcm_offs, PM_WKDEP);\r\nreturn 0;\r\n}\r\nint omap2_clkdm_del_wkdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nomap2_prm_clear_mod_reg_bits((1 << clkdm2->dep_bit),\r\nclkdm1->pwrdm.ptr->prcm_offs, PM_WKDEP);\r\nreturn 0;\r\n}\r\nint omap2_clkdm_read_wkdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nreturn omap2_prm_read_mod_bits_shift(clkdm1->pwrdm.ptr->prcm_offs,\r\nPM_WKDEP, (1 << clkdm2->dep_bit));\r\n}\r\nint omap2_clkdm_clear_all_wkdeps(struct clockdomain *clkdm)\r\n{\r\nstruct clkdm_dep *cd;\r\nu32 mask = 0;\r\nfor (cd = clkdm->wkdep_srcs; cd && cd->clkdm_name; cd++) {\r\nif (!cd->clkdm)\r\ncontinue;\r\nmask |= 1 << cd->clkdm->dep_bit;\r\ncd->wkdep_usecount = 0;\r\n}\r\nomap2_prm_clear_mod_reg_bits(mask, clkdm->pwrdm.ptr->prcm_offs,\r\nPM_WKDEP);\r\nreturn 0;\r\n}
