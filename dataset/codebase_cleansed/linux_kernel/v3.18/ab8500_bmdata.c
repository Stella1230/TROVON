int ab8500_bm_of_probe(struct device *dev,\r\nstruct device_node *np,\r\nstruct abx500_bm_data *bm)\r\n{\r\nconst struct batres_vs_temp *tmp_batres_tbl;\r\nstruct device_node *battery_node;\r\nconst char *btech;\r\nint i;\r\nbattery_node = of_parse_phandle(np, "battery", 0);\r\nif (!battery_node) {\r\ndev_err(dev, "battery node or reference missing\n");\r\nreturn -EINVAL;\r\n}\r\nbtech = of_get_property(battery_node, "stericsson,battery-type", NULL);\r\nif (!btech) {\r\ndev_warn(dev, "missing property battery-name/type\n");\r\nreturn -EINVAL;\r\n}\r\nif (strncmp(btech, "LION", 4) == 0) {\r\nbm->no_maintenance = true;\r\nbm->chg_unknown_bat = true;\r\nbm->bat_type[BATTERY_UNKNOWN].charge_full_design = 2600;\r\nbm->bat_type[BATTERY_UNKNOWN].termination_vol = 4150;\r\nbm->bat_type[BATTERY_UNKNOWN].recharge_cap = 95;\r\nbm->bat_type[BATTERY_UNKNOWN].normal_cur_lvl = 520;\r\nbm->bat_type[BATTERY_UNKNOWN].normal_vol_lvl = 4200;\r\n}\r\nif (of_property_read_bool(battery_node, "thermistor-on-batctrl")) {\r\nif (strncmp(btech, "LION", 4) == 0)\r\ntmp_batres_tbl = temp_to_batres_tbl_9100;\r\nelse\r\ntmp_batres_tbl = temp_to_batres_tbl_thermistor;\r\n} else {\r\nbm->n_btypes = 4;\r\nbm->bat_type = bat_type_ext_thermistor;\r\nbm->adc_therm = ABx500_ADC_THERM_BATTEMP;\r\ntmp_batres_tbl = temp_to_batres_tbl_ext_thermistor;\r\n}\r\nfor (i = 0; i < bm->n_btypes; ++i)\r\nbm->bat_type[i].batres_tbl = tmp_batres_tbl;\r\nof_node_put(battery_node);\r\nreturn 0;\r\n}
