static loff_t bad_file_llseek(struct file *file, loff_t offset, int whence)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_read(struct file *filp, char __user *buf,\r\nsize_t size, loff_t *ppos)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_write(struct file *filp, const char __user *buf,\r\nsize_t siz, loff_t *ppos)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_aio_read(struct kiocb *iocb, const struct iovec *iov,\r\nunsigned long nr_segs, loff_t pos)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_aio_write(struct kiocb *iocb, const struct iovec *iov,\r\nunsigned long nr_segs, loff_t pos)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_readdir(struct file *file, struct dir_context *ctx)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic unsigned int bad_file_poll(struct file *filp, poll_table *wait)\r\n{\r\nreturn POLLERR;\r\n}\r\nstatic long bad_file_unlocked_ioctl(struct file *file, unsigned cmd,\r\nunsigned long arg)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic long bad_file_compat_ioctl(struct file *file, unsigned int cmd,\r\nunsigned long arg)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_mmap(struct file *file, struct vm_area_struct *vma)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_open(struct inode *inode, struct file *filp)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_flush(struct file *file, fl_owner_t id)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_release(struct inode *inode, struct file *filp)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_fsync(struct file *file, loff_t start, loff_t end,\r\nint datasync)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_aio_fsync(struct kiocb *iocb, int datasync)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_fasync(int fd, struct file *filp, int on)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_lock(struct file *file, int cmd, struct file_lock *fl)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_sendpage(struct file *file, struct page *page,\r\nint off, size_t len, loff_t *pos, int more)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic unsigned long bad_file_get_unmapped_area(struct file *file,\r\nunsigned long addr, unsigned long len,\r\nunsigned long pgoff, unsigned long flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_check_flags(int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_file_flock(struct file *filp, int cmd, struct file_lock *fl)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_splice_write(struct pipe_inode_info *pipe,\r\nstruct file *out, loff_t *ppos, size_t len,\r\nunsigned int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_file_splice_read(struct file *in, loff_t *ppos,\r\nstruct pipe_inode_info *pipe, size_t len,\r\nunsigned int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_create (struct inode *dir, struct dentry *dentry,\r\numode_t mode, bool excl)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic struct dentry *bad_inode_lookup(struct inode *dir,\r\nstruct dentry *dentry, unsigned int flags)\r\n{\r\nreturn ERR_PTR(-EIO);\r\n}\r\nstatic int bad_inode_link (struct dentry *old_dentry, struct inode *dir,\r\nstruct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_unlink(struct inode *dir, struct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_symlink (struct inode *dir, struct dentry *dentry,\r\nconst char *symname)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_mkdir(struct inode *dir, struct dentry *dentry,\r\numode_t mode)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_rmdir (struct inode *dir, struct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_mknod (struct inode *dir, struct dentry *dentry,\r\numode_t mode, dev_t rdev)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_rename2(struct inode *old_dir, struct dentry *old_dentry,\r\nstruct inode *new_dir, struct dentry *new_dentry,\r\nunsigned int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_readlink(struct dentry *dentry, char __user *buffer,\r\nint buflen)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_permission(struct inode *inode, int mask)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_getattr(struct vfsmount *mnt, struct dentry *dentry,\r\nstruct kstat *stat)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_setattr(struct dentry *direntry, struct iattr *attrs)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_setxattr(struct dentry *dentry, const char *name,\r\nconst void *value, size_t size, int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_inode_getxattr(struct dentry *dentry, const char *name,\r\nvoid *buffer, size_t size)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_inode_listxattr(struct dentry *dentry, char *buffer,\r\nsize_t buffer_size)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_removexattr(struct dentry *dentry, const char *name)\r\n{\r\nreturn -EIO;\r\n}\r\nvoid make_bad_inode(struct inode *inode)\r\n{\r\nremove_inode_hash(inode);\r\ninode->i_mode = S_IFREG;\r\ninode->i_atime = inode->i_mtime = inode->i_ctime =\r\ncurrent_fs_time(inode->i_sb);\r\ninode->i_op = &bad_inode_ops;\r\ninode->i_fop = &bad_file_ops;\r\n}\r\nint is_bad_inode(struct inode *inode)\r\n{\r\nreturn (inode->i_op == &bad_inode_ops);\r\n}\r\nvoid iget_failed(struct inode *inode)\r\n{\r\nmake_bad_inode(inode);\r\nunlock_new_inode(inode);\r\niput(inode);\r\n}
