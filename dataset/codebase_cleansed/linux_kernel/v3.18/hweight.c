unsigned int __sw_hweight32(unsigned int w)\r\n{\r\n#ifdef CONFIG_ARCH_HAS_FAST_MULTIPLIER\r\nw -= (w >> 1) & 0x55555555;\r\nw = (w & 0x33333333) + ((w >> 2) & 0x33333333);\r\nw = (w + (w >> 4)) & 0x0f0f0f0f;\r\nreturn (w * 0x01010101) >> 24;\r\n#else\r\nunsigned int res = w - ((w >> 1) & 0x55555555);\r\nres = (res & 0x33333333) + ((res >> 2) & 0x33333333);\r\nres = (res + (res >> 4)) & 0x0F0F0F0F;\r\nres = res + (res >> 8);\r\nreturn (res + (res >> 16)) & 0x000000FF;\r\n#endif\r\n}\r\nunsigned int __sw_hweight16(unsigned int w)\r\n{\r\nunsigned int res = w - ((w >> 1) & 0x5555);\r\nres = (res & 0x3333) + ((res >> 2) & 0x3333);\r\nres = (res + (res >> 4)) & 0x0F0F;\r\nreturn (res + (res >> 8)) & 0x00FF;\r\n}\r\nunsigned int __sw_hweight8(unsigned int w)\r\n{\r\nunsigned int res = w - ((w >> 1) & 0x55);\r\nres = (res & 0x33) + ((res >> 2) & 0x33);\r\nreturn (res + (res >> 4)) & 0x0F;\r\n}\r\nunsigned long __sw_hweight64(__u64 w)\r\n{\r\n#if BITS_PER_LONG == 32\r\nreturn __sw_hweight32((unsigned int)(w >> 32)) +\r\n__sw_hweight32((unsigned int)w);\r\n#elif BITS_PER_LONG == 64\r\n#ifdef CONFIG_ARCH_HAS_FAST_MULTIPLIER\r\nw -= (w >> 1) & 0x5555555555555555ul;\r\nw = (w & 0x3333333333333333ul) + ((w >> 2) & 0x3333333333333333ul);\r\nw = (w + (w >> 4)) & 0x0f0f0f0f0f0f0f0ful;\r\nreturn (w * 0x0101010101010101ul) >> 56;\r\n#else\r\n__u64 res = w - ((w >> 1) & 0x5555555555555555ul);\r\nres = (res & 0x3333333333333333ul) + ((res >> 2) & 0x3333333333333333ul);\r\nres = (res + (res >> 4)) & 0x0F0F0F0F0F0F0F0Ful;\r\nres = res + (res >> 8);\r\nres = res + (res >> 16);\r\nreturn (res + (res >> 32)) & 0x00000000000000FFul;\r\n#endif\r\n#endif\r\n}
