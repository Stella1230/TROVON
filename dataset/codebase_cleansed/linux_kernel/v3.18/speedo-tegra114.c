static void __init rev_sku_to_speedo_ids(struct tegra_sku_info *sku_info,\r\nint *threshold)\r\n{\r\nu32 tmp;\r\nu32 sku = sku_info->sku_id;\r\nenum tegra_revision rev = sku_info->revision;\r\nswitch (sku) {\r\ncase 0x00:\r\ncase 0x10:\r\ncase 0x05:\r\ncase 0x06:\r\nsku_info->cpu_speedo_id = 1;\r\nsku_info->soc_speedo_id = 0;\r\n*threshold = THRESHOLD_INDEX_0;\r\nbreak;\r\ncase 0x03:\r\ncase 0x04:\r\nsku_info->cpu_speedo_id = 2;\r\nsku_info->soc_speedo_id = 1;\r\n*threshold = THRESHOLD_INDEX_1;\r\nbreak;\r\ndefault:\r\npr_err("Tegra Unknown SKU %d\n", sku);\r\nsku_info->cpu_speedo_id = 0;\r\nsku_info->soc_speedo_id = 0;\r\n*threshold = THRESHOLD_INDEX_0;\r\nbreak;\r\n}\r\nif (rev == TEGRA_REVISION_A01) {\r\ntmp = tegra30_fuse_readl(0x270) << 1;\r\ntmp |= tegra30_fuse_readl(0x26c);\r\nif (!tmp)\r\nsku_info->cpu_speedo_id = 0;\r\n}\r\n}\r\nvoid __init tegra114_init_speedo_data(struct tegra_sku_info *sku_info)\r\n{\r\nu32 cpu_speedo_val;\r\nu32 core_speedo_val;\r\nint threshold;\r\nint i;\r\nBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(core_process_speedos) !=\r\nTHRESHOLD_INDEX_COUNT);\r\nrev_sku_to_speedo_ids(sku_info, &threshold);\r\ncpu_speedo_val = tegra30_fuse_readl(0x12c) + 1024;\r\ncore_speedo_val = tegra30_fuse_readl(0x134);\r\nfor (i = 0; i < CPU_PROCESS_CORNERS; i++)\r\nif (cpu_speedo_val < cpu_process_speedos[threshold][i])\r\nbreak;\r\nsku_info->cpu_process_id = i;\r\nfor (i = 0; i < CORE_PROCESS_CORNERS; i++)\r\nif (core_speedo_val < core_process_speedos[threshold][i])\r\nbreak;\r\nsku_info->core_process_id = i;\r\n}
