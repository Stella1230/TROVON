static void __init twr_p1025_pic_init(void)\r\n{\r\nstruct mpic *mpic;\r\n#ifdef CONFIG_QUICC_ENGINE\r\nstruct device_node *np;\r\n#endif\r\nmpic = mpic_alloc(NULL, 0, MPIC_BIG_ENDIAN |\r\nMPIC_SINGLE_DEST_CPU,\r\n0, 256, " OpenPIC ");\r\nBUG_ON(mpic == NULL);\r\nmpic_init(mpic);\r\n#ifdef CONFIG_QUICC_ENGINE\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,qe-ic");\r\nif (np) {\r\nqe_ic_init(np, 0, qe_ic_cascade_low_mpic,\r\nqe_ic_cascade_high_mpic);\r\nof_node_put(np);\r\n} else\r\npr_err("Could not find qe-ic node\n");\r\n#endif\r\n}\r\nstatic void __init twr_p1025_setup_arch(void)\r\n{\r\n#ifdef CONFIG_QUICC_ENGINE\r\nstruct device_node *np;\r\n#endif\r\nif (ppc_md.progress)\r\nppc_md.progress("twr_p1025_setup_arch()", 0);\r\nmpc85xx_smp_init();\r\nfsl_pci_assign_primary();\r\n#ifdef CONFIG_QUICC_ENGINE\r\nmpc85xx_qe_init();\r\nmpc85xx_qe_par_io_init();\r\n#if defined(CONFIG_UCC_GETH) || defined(CONFIG_SERIAL_QE)\r\nif (machine_is(twr_p1025)) {\r\nstruct ccsr_guts __iomem *guts;\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,p1021-guts");\r\nif (np) {\r\nguts = of_iomap(np, 0);\r\nif (!guts)\r\npr_err("twr_p1025: could not map global utilities register\n");\r\nelse {\r\nsetbits32(&guts->pmuxcr, MPC85xx_PMUXCR_QE(0) |\r\nMPC85xx_PMUXCR_QE(3) |\r\nMPC85xx_PMUXCR_QE(9) |\r\nMPC85xx_PMUXCR_QE(12));\r\niounmap(guts);\r\n#if defined(CONFIG_SERIAL_QE)\r\npar_io_config_pin(0, 18, 0, 0, 0, 0);\r\n#endif\r\npar_io_config_pin(1, 29, 1, 0, 0, 0);\r\npar_io_data_set(1, 29, 0);\r\n}\r\nof_node_put(np);\r\n}\r\n}\r\n#endif\r\n#endif\r\npr_info("TWR-P1025 board from Freescale Semiconductor\n");\r\n}\r\nstatic int __init twr_p1025_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nreturn of_flat_dt_is_compatible(root, "fsl,TWR-P1025");\r\n}
