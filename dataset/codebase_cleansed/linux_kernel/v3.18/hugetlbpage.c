int huge_pmd_unshare(struct mm_struct *mm, unsigned long *addr, pte_t *ptep)\r\n{\r\nreturn 0;\r\n}\r\nstruct page *follow_huge_addr(struct mm_struct *mm, unsigned long address,\r\nint write)\r\n{\r\nreturn ERR_PTR(-EINVAL);\r\n}\r\nint pmd_huge(pmd_t pmd)\r\n{\r\nreturn !(pmd_val(pmd) & PMD_TABLE_BIT);\r\n}\r\nint pud_huge(pud_t pud)\r\n{\r\n#ifndef __PAGETABLE_PMD_FOLDED\r\nreturn !(pud_val(pud) & PUD_TABLE_BIT);\r\n#else\r\nreturn 0;\r\n#endif\r\n}\r\nstatic __init int setup_hugepagesz(char *opt)\r\n{\r\nunsigned long ps = memparse(opt, &opt);\r\nif (ps == PMD_SIZE) {\r\nhugetlb_add_hstate(PMD_SHIFT - PAGE_SHIFT);\r\n} else if (ps == PUD_SIZE) {\r\nhugetlb_add_hstate(PUD_SHIFT - PAGE_SHIFT);\r\n} else {\r\npr_err("hugepagesz: Unsupported page size %lu M\n", ps >> 20);\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}
