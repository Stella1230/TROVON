u8 HalPwrSeqCmdParsing23a(struct rtw_adapter *padapter, u8 CutVersion,\r\nu8 FabVersion, u8 InterfaceType,\r\nstruct wlan_pwr_cfg PwrSeqCmd[])\r\n{\r\nstruct wlan_pwr_cfg PwrCfgCmd = { 0 };\r\nu8 bPollingBit = false;\r\nu32 AryIdx = 0;\r\nu8 value = 0;\r\nu32 offset = 0;\r\nu32 pollingCount = 0;\r\nu32 maxPollingCnt = 5000;\r\ndo {\r\nPwrCfgCmd = PwrSeqCmd[AryIdx];\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: offset(%#x) cut_msk(%#x) "\r\n"fab_msk(%#x) interface_msk(%#x) base(%#x) cmd(%#x) "\r\n"msk(%#x) value(%#x)\n",\r\nGET_PWR_CFG_OFFSET(PwrCfgCmd),\r\nGET_PWR_CFG_CUT_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_FAB_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_INTF_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_BASE(PwrCfgCmd),\r\nGET_PWR_CFG_CMD(PwrCfgCmd),\r\nGET_PWR_CFG_MASK(PwrCfgCmd),\r\nGET_PWR_CFG_VALUE(PwrCfgCmd)));\r\nif ((GET_PWR_CFG_FAB_MASK(PwrCfgCmd) & FabVersion) &&\r\n(GET_PWR_CFG_CUT_MASK(PwrCfgCmd) & CutVersion) &&\r\n(GET_PWR_CFG_INTF_MASK(PwrCfgCmd) & InterfaceType)) {\r\nswitch (GET_PWR_CFG_CMD(PwrCfgCmd)) {\r\ncase PWR_CMD_READ:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"PWR_CMD_READ\n"));\r\nbreak;\r\ncase PWR_CMD_WRITE:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"PWR_CMD_WRITE\n"));\r\noffset = GET_PWR_CFG_OFFSET(PwrCfgCmd);\r\nvalue = rtl8723au_read8(padapter, offset);\r\nvalue &= ~(GET_PWR_CFG_MASK(PwrCfgCmd));\r\nvalue |= (GET_PWR_CFG_VALUE(PwrCfgCmd) &\r\nGET_PWR_CFG_MASK(PwrCfgCmd));\r\nrtl8723au_write8(padapter, offset, value);\r\nbreak;\r\ncase PWR_CMD_POLLING:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"PWR_CMD_POLLING\n"));\r\nbPollingBit = false;\r\noffset = GET_PWR_CFG_OFFSET(PwrCfgCmd);\r\ndo {\r\nvalue = rtl8723au_read8(padapter,\r\noffset);\r\nvalue &= GET_PWR_CFG_MASK(PwrCfgCmd);\r\nif (value ==\r\n(GET_PWR_CFG_VALUE(PwrCfgCmd) &\r\nGET_PWR_CFG_MASK(PwrCfgCmd)))\r\nbPollingBit = true;\r\nelse\r\nudelay(10);\r\nif (pollingCount++ > maxPollingCnt) {\r\nDBG_8723A("Fail to polling "\r\n"Offset[%#x]\n",\r\noffset);\r\nreturn false;\r\n}\r\n} while (!bPollingBit);\r\nbreak;\r\ncase PWR_CMD_DELAY:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"PWR_CMD_DELAY\n"));\r\nif (GET_PWR_CFG_VALUE(PwrCfgCmd) ==\r\nPWRSEQ_DELAY_US)\r\nudelay(GET_PWR_CFG_OFFSET(PwrCfgCmd));\r\nelse\r\nudelay(GET_PWR_CFG_OFFSET(PwrCfgCmd) *\r\n1000);\r\nbreak;\r\ncase PWR_CMD_END:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"PWR_CMD_END\n"));\r\nreturn true;\r\nbreak;\r\ndefault:\r\nRT_TRACE(_module_hal_init_c_, _drv_err_,\r\n("HalPwrSeqCmdParsing23a: "\r\n"Unknown CMD!!\n"));\r\nbreak;\r\n}\r\n}\r\nAryIdx++;\r\n} while (1);\r\nreturn true;\r\n}
