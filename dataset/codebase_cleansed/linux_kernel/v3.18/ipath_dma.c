static int ipath_mapping_error(struct ib_device *dev, u64 dma_addr)\r\n{\r\nreturn dma_addr == BAD_DMA_ADDRESS;\r\n}\r\nstatic u64 ipath_dma_map_single(struct ib_device *dev,\r\nvoid *cpu_addr, size_t size,\r\nenum dma_data_direction direction)\r\n{\r\nBUG_ON(!valid_dma_direction(direction));\r\nreturn (u64) cpu_addr;\r\n}\r\nstatic void ipath_dma_unmap_single(struct ib_device *dev,\r\nu64 addr, size_t size,\r\nenum dma_data_direction direction)\r\n{\r\nBUG_ON(!valid_dma_direction(direction));\r\n}\r\nstatic u64 ipath_dma_map_page(struct ib_device *dev,\r\nstruct page *page,\r\nunsigned long offset,\r\nsize_t size,\r\nenum dma_data_direction direction)\r\n{\r\nu64 addr;\r\nBUG_ON(!valid_dma_direction(direction));\r\nif (offset + size > PAGE_SIZE) {\r\naddr = BAD_DMA_ADDRESS;\r\ngoto done;\r\n}\r\naddr = (u64) page_address(page);\r\nif (addr)\r\naddr += offset;\r\ndone:\r\nreturn addr;\r\n}\r\nstatic void ipath_dma_unmap_page(struct ib_device *dev,\r\nu64 addr, size_t size,\r\nenum dma_data_direction direction)\r\n{\r\nBUG_ON(!valid_dma_direction(direction));\r\n}\r\nstatic int ipath_map_sg(struct ib_device *dev, struct scatterlist *sgl,\r\nint nents, enum dma_data_direction direction)\r\n{\r\nstruct scatterlist *sg;\r\nu64 addr;\r\nint i;\r\nint ret = nents;\r\nBUG_ON(!valid_dma_direction(direction));\r\nfor_each_sg(sgl, sg, nents, i) {\r\naddr = (u64) page_address(sg_page(sg));\r\nif (!addr) {\r\nret = 0;\r\nbreak;\r\n}\r\nsg->dma_address = addr + sg->offset;\r\n#ifdef CONFIG_NEED_SG_DMA_LENGTH\r\nsg->dma_length = sg->length;\r\n#endif\r\n}\r\nreturn ret;\r\n}\r\nstatic void ipath_unmap_sg(struct ib_device *dev,\r\nstruct scatterlist *sg, int nents,\r\nenum dma_data_direction direction)\r\n{\r\nBUG_ON(!valid_dma_direction(direction));\r\n}\r\nstatic void ipath_sync_single_for_cpu(struct ib_device *dev,\r\nu64 addr,\r\nsize_t size,\r\nenum dma_data_direction dir)\r\n{\r\n}\r\nstatic void ipath_sync_single_for_device(struct ib_device *dev,\r\nu64 addr,\r\nsize_t size,\r\nenum dma_data_direction dir)\r\n{\r\n}\r\nstatic void *ipath_dma_alloc_coherent(struct ib_device *dev, size_t size,\r\nu64 *dma_handle, gfp_t flag)\r\n{\r\nstruct page *p;\r\nvoid *addr = NULL;\r\np = alloc_pages(flag, get_order(size));\r\nif (p)\r\naddr = page_address(p);\r\nif (dma_handle)\r\n*dma_handle = (u64) addr;\r\nreturn addr;\r\n}\r\nstatic void ipath_dma_free_coherent(struct ib_device *dev, size_t size,\r\nvoid *cpu_addr, u64 dma_handle)\r\n{\r\nfree_pages((unsigned long) cpu_addr, get_order(size));\r\n}
