static void ci_hdrc_msm_notify_event(struct ci_hdrc *ci, unsigned event)\r\n{\r\nstruct device *dev = ci->gadget.dev.parent;\r\nswitch (event) {\r\ncase CI_HDRC_CONTROLLER_RESET_EVENT:\r\ndev_dbg(dev, "CI_HDRC_CONTROLLER_RESET_EVENT received\n");\r\nwritel(0, USB_AHBBURST);\r\nwritel(0, USB_AHBMODE);\r\nusb_phy_init(ci->transceiver);\r\nbreak;\r\ncase CI_HDRC_CONTROLLER_STOPPED_EVENT:\r\ndev_dbg(dev, "CI_HDRC_CONTROLLER_STOPPED_EVENT received\n");\r\nusb_phy_notify_disconnect(ci->transceiver, USB_SPEED_UNKNOWN);\r\nbreak;\r\ndefault:\r\ndev_dbg(dev, "unknown ci_hdrc event\n");\r\nbreak;\r\n}\r\n}\r\nstatic int ci_hdrc_msm_probe(struct platform_device *pdev)\r\n{\r\nstruct platform_device *plat_ci;\r\nstruct usb_phy *phy;\r\ndev_dbg(&pdev->dev, "ci_hdrc_msm_probe\n");\r\nphy = devm_usb_get_phy_by_phandle(&pdev->dev, "usb-phy", 0);\r\nif (IS_ERR(phy))\r\nreturn PTR_ERR(phy);\r\nci_hdrc_msm_platdata.phy = phy;\r\nplat_ci = ci_hdrc_add_device(&pdev->dev,\r\npdev->resource, pdev->num_resources,\r\n&ci_hdrc_msm_platdata);\r\nif (IS_ERR(plat_ci)) {\r\ndev_err(&pdev->dev, "ci_hdrc_add_device failed!\n");\r\nreturn PTR_ERR(plat_ci);\r\n}\r\nplatform_set_drvdata(pdev, plat_ci);\r\npm_runtime_no_callbacks(&pdev->dev);\r\npm_runtime_enable(&pdev->dev);\r\nreturn 0;\r\n}\r\nstatic int ci_hdrc_msm_remove(struct platform_device *pdev)\r\n{\r\nstruct platform_device *plat_ci = platform_get_drvdata(pdev);\r\npm_runtime_disable(&pdev->dev);\r\nci_hdrc_remove_device(plat_ci);\r\nreturn 0;\r\n}
