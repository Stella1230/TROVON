static void intcs_demux(unsigned int irq, struct irq_desc *desc)\r\n{\r\nvoid __iomem *reg = (void *)irq_get_handler_data(irq);\r\nunsigned int evtcodeas = ioread32(reg);\r\ngeneric_handle_irq(intcs_evt2irq(evtcodeas));\r\n}\r\nvoid __init sh7372_init_irq(void)\r\n{\r\nvoid __iomem *intevtsa;\r\nint n;\r\nintcs_ffd2 = ioremap_nocache(0xffd20000, PAGE_SIZE);\r\nintevtsa = intcs_ffd2 + 0x100;\r\nintcs_ffd5 = ioremap_nocache(0xffd50000, PAGE_SIZE);\r\nregister_intc_controller(&intca_desc);\r\nregister_intc_controller(&intca_irq_pins_lo_desc);\r\nregister_intc_controller(&intca_irq_pins_hi_desc);\r\nregister_intc_controller(&intcs_desc);\r\nn = evt2irq(0xf80);\r\nirq_alloc_desc_at(n, numa_node_id());\r\nirq_set_chip_and_handler_name(n, &dummy_irq_chip,\r\nhandle_level_irq, "level");\r\nset_irq_flags(n, IRQF_VALID);\r\nirq_set_handler_data(n, (void *)intevtsa);\r\nirq_set_chained_handler(n, intcs_demux);\r\niowrite16(0, intcs_ffd2 + 0x104);\r\n}\r\nvoid sh7372_intcs_suspend(void)\r\n{\r\nint k;\r\nfor (k = 0x00; k <= 0x30; k += 4)\r\nffd2[k] = __raw_readw(intcs_ffd2 + k);\r\nfor (k = 0x80; k <= 0xb0; k += 4)\r\nffd2[k] = __raw_readb(intcs_ffd2 + k);\r\nfor (k = 0x180; k <= 0x188; k += 4)\r\nffd2[k] = __raw_readb(intcs_ffd2 + k);\r\nfor (k = 0x00; k <= 0x3c; k += 4)\r\nffd5[k] = __raw_readw(intcs_ffd5 + k);\r\nfor (k = 0x80; k <= 0x9c; k += 4)\r\nffd5[k] = __raw_readb(intcs_ffd5 + k);\r\n}\r\nvoid sh7372_intcs_resume(void)\r\n{\r\nint k;\r\nfor (k = 0x00; k <= 0x30; k += 4)\r\n__raw_writew(ffd2[k], intcs_ffd2 + k);\r\nfor (k = 0x80; k <= 0xb0; k += 4)\r\n__raw_writeb(ffd2[k], intcs_ffd2 + k);\r\nfor (k = 0x180; k <= 0x188; k += 4)\r\n__raw_writeb(ffd2[k], intcs_ffd2 + k);\r\nfor (k = 0x00; k <= 0x3c; k += 4)\r\n__raw_writew(ffd5[k], intcs_ffd5 + k);\r\nfor (k = 0x80; k <= 0x9c; k += 4)\r\n__raw_writeb(ffd5[k], intcs_ffd5 + k);\r\n}\r\nvoid sh7372_intca_suspend(void)\r\n{\r\nint k;\r\nfor (k = 0x00; k <= 0x38; k += 4)\r\ne694[k] = __raw_readw(E694_BASE + k);\r\nfor (k = 0x80; k <= 0xb4; k += 4)\r\ne694[k] = __raw_readb(E694_BASE + k);\r\nfor (k = 0x180; k <= 0x1b4; k += 4)\r\ne694[k] = __raw_readb(E694_BASE + k);\r\nfor (k = 0x00; k <= 0x50; k += 4)\r\ne695[k] = __raw_readw(E695_BASE + k);\r\nfor (k = 0x80; k <= 0xa8; k += 4)\r\ne695[k] = __raw_readb(E695_BASE + k);\r\nfor (k = 0x180; k <= 0x1a8; k += 4)\r\ne695[k] = __raw_readb(E695_BASE + k);\r\n}\r\nvoid sh7372_intca_resume(void)\r\n{\r\nint k;\r\nfor (k = 0x00; k <= 0x38; k += 4)\r\n__raw_writew(e694[k], E694_BASE + k);\r\nfor (k = 0x80; k <= 0xb4; k += 4)\r\n__raw_writeb(e694[k], E694_BASE + k);\r\nfor (k = 0x180; k <= 0x1b4; k += 4)\r\n__raw_writeb(e694[k], E694_BASE + k);\r\nfor (k = 0x00; k <= 0x50; k += 4)\r\n__raw_writew(e695[k], E695_BASE + k);\r\nfor (k = 0x80; k <= 0xa8; k += 4)\r\n__raw_writeb(e695[k], E695_BASE + k);\r\nfor (k = 0x180; k <= 0x1a8; k += 4)\r\n__raw_writeb(e695[k], E695_BASE + k);\r\n}
