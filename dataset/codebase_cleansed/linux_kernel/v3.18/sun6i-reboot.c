static void sun6i_wdt_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nif (!wdt_base)\r\nreturn;\r\nwritel(0, wdt_base + SUN6I_WATCHDOG1_IRQ_REG);\r\nwritel(SUN6I_WATCHDOG1_CONFIG_RESTART,\r\nwdt_base + SUN6I_WATCHDOG1_CONFIG_REG);\r\nwritel(SUN6I_WATCHDOG1_MODE_ENABLE,\r\nwdt_base + SUN6I_WATCHDOG1_MODE_REG);\r\nwritel(SUN6I_WATCHDOG1_CTRL_RESTART,\r\nwdt_base + SUN6I_WATCHDOG1_CTRL_REG);\r\nwhile (1) {\r\nmdelay(5);\r\nwritel(SUN6I_WATCHDOG1_MODE_ENABLE,\r\nwdt_base + SUN6I_WATCHDOG1_MODE_REG);\r\n}\r\n}\r\nstatic int sun6i_reboot_probe(struct platform_device *pdev)\r\n{\r\nwdt_base = of_iomap(pdev->dev.of_node, 0);\r\nif (!wdt_base) {\r\nWARN(1, "failed to map watchdog base address");\r\nreturn -ENODEV;\r\n}\r\narm_pm_restart = sun6i_wdt_restart;\r\nreturn 0;\r\n}
