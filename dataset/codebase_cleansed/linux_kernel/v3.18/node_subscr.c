void tipc_nodesub_subscribe(struct tipc_node_subscr *node_sub, u32 addr,\r\nvoid *usr_handle, net_ev_handler handle_down)\r\n{\r\nif (in_own_node(addr)) {\r\nnode_sub->node = NULL;\r\nreturn;\r\n}\r\nnode_sub->node = tipc_node_find(addr);\r\nif (!node_sub->node) {\r\npr_warn("Node subscription rejected, unknown node 0x%x\n",\r\naddr);\r\nreturn;\r\n}\r\nnode_sub->handle_node_down = handle_down;\r\nnode_sub->usr_handle = usr_handle;\r\ntipc_node_lock(node_sub->node);\r\nlist_add_tail(&node_sub->nodesub_list, &node_sub->node->nsub);\r\ntipc_node_unlock(node_sub->node);\r\n}\r\nvoid tipc_nodesub_unsubscribe(struct tipc_node_subscr *node_sub)\r\n{\r\nif (!node_sub->node)\r\nreturn;\r\ntipc_node_lock(node_sub->node);\r\nlist_del_init(&node_sub->nodesub_list);\r\ntipc_node_unlock(node_sub->node);\r\n}\r\nvoid tipc_nodesub_notify(struct list_head *nsub_list)\r\n{\r\nstruct tipc_node_subscr *ns, *safe;\r\nnet_ev_handler handle_node_down;\r\nlist_for_each_entry_safe(ns, safe, nsub_list, nodesub_list) {\r\nhandle_node_down = ns->handle_node_down;\r\nif (handle_node_down) {\r\nns->handle_node_down = NULL;\r\nhandle_node_down(ns->usr_handle);\r\n}\r\n}\r\n}
