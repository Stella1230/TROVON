static struct drm_display_mode *tpo_vid_get_config_mode(struct drm_device *dev)\r\n{\r\nstruct drm_display_mode *mode;\r\nstruct drm_psb_private *dev_priv = dev->dev_private;\r\nstruct oaktrail_timing_info *ti = &dev_priv->gct_data.DTD;\r\nbool use_gct = false;\r\nmode = kzalloc(sizeof(*mode), GFP_KERNEL);\r\nif (!mode)\r\nreturn NULL;\r\nif (use_gct) {\r\nmode->hdisplay = (ti->hactive_hi << 8) | ti->hactive_lo;\r\nmode->vdisplay = (ti->vactive_hi << 8) | ti->vactive_lo;\r\nmode->hsync_start = mode->hdisplay +\r\n((ti->hsync_offset_hi << 8) |\r\nti->hsync_offset_lo);\r\nmode->hsync_end = mode->hsync_start +\r\n((ti->hsync_pulse_width_hi << 8) |\r\nti->hsync_pulse_width_lo);\r\nmode->htotal = mode->hdisplay + ((ti->hblank_hi << 8) |\r\nti->hblank_lo);\r\nmode->vsync_start =\r\nmode->vdisplay + ((ti->vsync_offset_hi << 8) |\r\nti->vsync_offset_lo);\r\nmode->vsync_end =\r\nmode->vsync_start + ((ti->vsync_pulse_width_hi << 8) |\r\nti->vsync_pulse_width_lo);\r\nmode->vtotal = mode->vdisplay +\r\n((ti->vblank_hi << 8) | ti->vblank_lo);\r\nmode->clock = ti->pixel_clock * 10;\r\ndev_dbg(dev->dev, "hdisplay is %d\n", mode->hdisplay);\r\ndev_dbg(dev->dev, "vdisplay is %d\n", mode->vdisplay);\r\ndev_dbg(dev->dev, "HSS is %d\n", mode->hsync_start);\r\ndev_dbg(dev->dev, "HSE is %d\n", mode->hsync_end);\r\ndev_dbg(dev->dev, "htotal is %d\n", mode->htotal);\r\ndev_dbg(dev->dev, "VSS is %d\n", mode->vsync_start);\r\ndev_dbg(dev->dev, "VSE is %d\n", mode->vsync_end);\r\ndev_dbg(dev->dev, "vtotal is %d\n", mode->vtotal);\r\ndev_dbg(dev->dev, "clock is %d\n", mode->clock);\r\n} else {\r\nmode->hdisplay = 864;\r\nmode->vdisplay = 480;\r\nmode->hsync_start = 873;\r\nmode->hsync_end = 876;\r\nmode->htotal = 887;\r\nmode->vsync_start = 487;\r\nmode->vsync_end = 490;\r\nmode->vtotal = 499;\r\nmode->clock = 33264;\r\n}\r\ndrm_mode_set_name(mode);\r\ndrm_mode_set_crtcinfo(mode, 0);\r\nmode->type |= DRM_MODE_TYPE_PREFERRED;\r\nreturn mode;\r\n}\r\nstatic int tpo_vid_get_panel_info(struct drm_device *dev,\r\nint pipe,\r\nstruct panel_info *pi)\r\n{\r\nif (!dev || !pi)\r\nreturn -EINVAL;\r\npi->width_mm = TPO_PANEL_WIDTH;\r\npi->height_mm = TPO_PANEL_HEIGHT;\r\nreturn 0;\r\n}
