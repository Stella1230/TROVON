static int __init imx_phycore_init(void)\r\n{\r\nint ret;\r\nif (machine_is_pca100()) {\r\nimx_audmux_v1_configure_port(MX27_AUDMUX_HPCR1_SSI0,\r\nIMX_AUDMUX_V1_PCR_SYN |\r\nIMX_AUDMUX_V1_PCR_TFCSEL(3) |\r\nIMX_AUDMUX_V1_PCR_TCLKDIR |\r\nIMX_AUDMUX_V1_PCR_RXDSEL(3));\r\nimx_audmux_v1_configure_port(3,\r\nIMX_AUDMUX_V1_PCR_SYN |\r\nIMX_AUDMUX_V1_PCR_TFCSEL(0) |\r\nIMX_AUDMUX_V1_PCR_TFSDIR |\r\nIMX_AUDMUX_V1_PCR_RXDSEL(0));\r\n} else if (machine_is_pcm043()) {\r\nimx_audmux_v2_configure_port(3,\r\nIMX_AUDMUX_V2_PTCR_SYN |\r\nIMX_AUDMUX_V2_PTCR_TFSEL(0) |\r\nIMX_AUDMUX_V2_PTCR_TFSDIR,\r\nIMX_AUDMUX_V2_PDCR_RXDSEL(0));\r\nimx_audmux_v2_configure_port(0,\r\nIMX_AUDMUX_V2_PTCR_SYN |\r\nIMX_AUDMUX_V2_PTCR_TCSEL(3) |\r\nIMX_AUDMUX_V2_PTCR_TCLKDIR,\r\nIMX_AUDMUX_V2_PDCR_RXDSEL(3));\r\n} else {\r\nreturn 0;\r\n}\r\nimx_phycore_snd_ac97_device = platform_device_alloc("soc-audio", -1);\r\nif (!imx_phycore_snd_ac97_device)\r\nreturn -ENOMEM;\r\nplatform_set_drvdata(imx_phycore_snd_ac97_device, &imx_phycore);\r\nret = platform_device_add(imx_phycore_snd_ac97_device);\r\nif (ret)\r\ngoto fail1;\r\nimx_phycore_snd_device = platform_device_alloc("wm9712-codec", -1);\r\nif (!imx_phycore_snd_device) {\r\nret = -ENOMEM;\r\ngoto fail2;\r\n}\r\nret = platform_device_add(imx_phycore_snd_device);\r\nif (ret) {\r\nprintk(KERN_ERR "ASoC: Platform device allocation failed\n");\r\ngoto fail3;\r\n}\r\nreturn 0;\r\nfail3:\r\nplatform_device_put(imx_phycore_snd_device);\r\nfail2:\r\nplatform_device_del(imx_phycore_snd_ac97_device);\r\nfail1:\r\nplatform_device_put(imx_phycore_snd_ac97_device);\r\nreturn ret;\r\n}\r\nstatic void __exit imx_phycore_exit(void)\r\n{\r\nplatform_device_unregister(imx_phycore_snd_device);\r\nplatform_device_unregister(imx_phycore_snd_ac97_device);\r\n}
