char *__init pcibios_setup(char *str)\r\n{\r\nif (strcmp(str, "slot4en") == 0) {\r\nslot4en = 1;\r\nreturn NULL;\r\n}\r\nreturn str;\r\n}\r\nstatic int __init sdk7786_pci_init(void)\r\n{\r\nu16 data = fpga_read_reg(PCIECR);\r\nslot4en ?: (!(data & PCIECR_PRST4) && (data & PCIECR_PRST3));\r\nif (slot4en) {\r\npr_info("Activating PCIe slot#4 (disabling slot#3)\n");\r\ndata &= ~PCIECR_PCIEMUX1;\r\nfpga_write_reg(data, PCIECR);\r\nif ((data & PCIECR_PRST3) == 0) {\r\npr_warning("Unreachable card detected in slot#3\n");\r\nreturn -EBUSY;\r\n}\r\n} else\r\npr_info("PCIe slot#4 disabled\n");\r\nreturn 0;\r\n}
