int s5p_mfc_wait_for_done_dev(struct s5p_mfc_dev *dev, int command)\r\n{\r\nint ret;\r\nret = wait_event_interruptible_timeout(dev->queue,\r\n(dev->int_cond && (dev->int_type == command\r\n|| dev->int_type == S5P_MFC_R2H_CMD_ERR_RET)),\r\nmsecs_to_jiffies(MFC_INT_TIMEOUT));\r\nif (ret == 0) {\r\nmfc_err("Interrupt (dev->int_type:%d, command:%d) timed out\n",\r\ndev->int_type, command);\r\nreturn 1;\r\n} else if (ret == -ERESTARTSYS) {\r\nmfc_err("Interrupted by a signal\n");\r\nreturn 1;\r\n}\r\nmfc_debug(1, "Finished waiting (dev->int_type:%d, command: %d)\n",\r\ndev->int_type, command);\r\nif (dev->int_type == S5P_MFC_R2H_CMD_ERR_RET)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nvoid s5p_mfc_clean_dev_int_flags(struct s5p_mfc_dev *dev)\r\n{\r\ndev->int_cond = 0;\r\ndev->int_type = 0;\r\ndev->int_err = 0;\r\n}\r\nint s5p_mfc_wait_for_done_ctx(struct s5p_mfc_ctx *ctx,\r\nint command, int interrupt)\r\n{\r\nint ret;\r\nif (interrupt) {\r\nret = wait_event_interruptible_timeout(ctx->queue,\r\n(ctx->int_cond && (ctx->int_type == command\r\n|| ctx->int_type == S5P_MFC_R2H_CMD_ERR_RET)),\r\nmsecs_to_jiffies(MFC_INT_TIMEOUT));\r\n} else {\r\nret = wait_event_timeout(ctx->queue,\r\n(ctx->int_cond && (ctx->int_type == command\r\n|| ctx->int_type == S5P_MFC_R2H_CMD_ERR_RET)),\r\nmsecs_to_jiffies(MFC_INT_TIMEOUT));\r\n}\r\nif (ret == 0) {\r\nmfc_err("Interrupt (ctx->int_type:%d, command:%d) timed out\n",\r\nctx->int_type, command);\r\nreturn 1;\r\n} else if (ret == -ERESTARTSYS) {\r\nmfc_err("Interrupted by a signal\n");\r\nreturn 1;\r\n}\r\nmfc_debug(1, "Finished waiting (ctx->int_type:%d, command: %d)\n",\r\nctx->int_type, command);\r\nif (ctx->int_type == S5P_MFC_R2H_CMD_ERR_RET)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nvoid s5p_mfc_clean_ctx_int_flags(struct s5p_mfc_ctx *ctx)\r\n{\r\nctx->int_cond = 0;\r\nctx->int_type = 0;\r\nctx->int_err = 0;\r\n}
