static void qpace_show_cpuinfo(struct seq_file *m)\r\n{\r\nstruct device_node *root;\r\nconst char *model = "";\r\nroot = of_find_node_by_path("/");\r\nif (root)\r\nmodel = of_get_property(root, "model", NULL);\r\nseq_printf(m, "machine\t\t: CHRP %s\n", model);\r\nof_node_put(root);\r\n}\r\nstatic void qpace_progress(char *s, unsigned short hex)\r\n{\r\nprintk("*** %04x : %s\n", hex, s ? s : "");\r\n}\r\nstatic int __init qpace_publish_devices(void)\r\n{\r\nint node;\r\nof_platform_bus_probe(NULL, qpace_bus_ids, NULL);\r\nfor_each_online_node(node) {\r\nif (cbe_get_cpu_mic_tm_regs(cbe_node_to_cpu(node)) == NULL)\r\ncontinue;\r\nplatform_device_register_simple("cbe-mic", node, NULL, 0);\r\n}\r\nreturn 0;\r\n}\r\nstatic void __init qpace_setup_arch(void)\r\n{\r\n#ifdef CONFIG_SPU_BASE\r\nspu_priv1_ops = &spu_priv1_mmio_ops;\r\nspu_management_ops = &spu_management_of_ops;\r\n#endif\r\ncbe_regs_init();\r\n#ifdef CONFIG_CBE_RAS\r\ncbe_ras_init();\r\n#endif\r\n#ifdef CONFIG_SMP\r\nsmp_init_cell();\r\n#endif\r\nloops_per_jiffy = 50000000;\r\ncbe_pervasive_init();\r\n#ifdef CONFIG_DUMMY_CONSOLE\r\nconswitchp = &dummy_con;\r\n#endif\r\n}\r\nstatic int __init qpace_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nif (!of_flat_dt_is_compatible(root, "IBM,QPACE"))\r\nreturn 0;\r\nhpte_init_native();\r\nreturn 1;\r\n}
