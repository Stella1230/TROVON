static int hfsplus_trusted_getxattr(struct dentry *dentry, const char *name,\r\nvoid *buffer, size_t size, int type)\r\n{\r\nchar *xattr_name;\r\nint res;\r\nif (!strcmp(name, ""))\r\nreturn -EINVAL;\r\nxattr_name = kmalloc(NLS_MAX_CHARSET_SIZE * HFSPLUS_ATTR_MAX_STRLEN + 1,\r\nGFP_KERNEL);\r\nif (!xattr_name)\r\nreturn -ENOMEM;\r\nstrcpy(xattr_name, XATTR_TRUSTED_PREFIX);\r\nstrcpy(xattr_name + XATTR_TRUSTED_PREFIX_LEN, name);\r\nres = hfsplus_getxattr(dentry, xattr_name, buffer, size);\r\nkfree(xattr_name);\r\nreturn res;\r\n}\r\nstatic int hfsplus_trusted_setxattr(struct dentry *dentry, const char *name,\r\nconst void *buffer, size_t size, int flags, int type)\r\n{\r\nchar *xattr_name;\r\nint res;\r\nif (!strcmp(name, ""))\r\nreturn -EINVAL;\r\nxattr_name = kmalloc(NLS_MAX_CHARSET_SIZE * HFSPLUS_ATTR_MAX_STRLEN + 1,\r\nGFP_KERNEL);\r\nif (!xattr_name)\r\nreturn -ENOMEM;\r\nstrcpy(xattr_name, XATTR_TRUSTED_PREFIX);\r\nstrcpy(xattr_name + XATTR_TRUSTED_PREFIX_LEN, name);\r\nres = hfsplus_setxattr(dentry, xattr_name, buffer, size, flags);\r\nkfree(xattr_name);\r\nreturn res;\r\n}\r\nstatic size_t hfsplus_trusted_listxattr(struct dentry *dentry, char *list,\r\nsize_t list_size, const char *name, size_t name_len, int type)\r\n{\r\nreturn -EOPNOTSUPP;\r\n}
