static void __init atstk1003_setup_extdac(void)\r\n{\r\nstruct clk *gclk;\r\nstruct clk *pll;\r\ngclk = clk_get(NULL, "gclk0");\r\nif (IS_ERR(gclk))\r\ngoto err_gclk;\r\npll = clk_get(NULL, "pll0");\r\nif (IS_ERR(pll))\r\ngoto err_pll;\r\nif (clk_set_parent(gclk, pll)) {\r\npr_debug("STK1000: failed to set pll0 as parent for DAC clock\n");\r\ngoto err_set_clk;\r\n}\r\nat32_select_periph(GPIO_PIOA_BASE, (1 << 30), GPIO_PERIPH_A, 0);\r\nat73c213_data.dac_clk = gclk;\r\nerr_set_clk:\r\nclk_put(pll);\r\nerr_pll:\r\nclk_put(gclk);\r\nerr_gclk:\r\nreturn;\r\n}\r\nstatic void __init atstk1003_setup_extdac(void)\r\n{\r\n}\r\nvoid __init setup_board(void)\r\n{\r\n#ifdef CONFIG_BOARD_ATSTK100X_SW2_CUSTOM\r\nat32_map_usart(0, 1, 0);\r\n#else\r\nat32_map_usart(1, 0, 0);\r\n#endif\r\nat32_map_usart(3, 2, 0);\r\nat32_setup_serial_console(0);\r\n}\r\nstatic int __init atstk1003_init(void)\r\n{\r\nat32_reserve_pin(GPIO_PIOE_BASE, ATMEL_EBI_PE_DATA_ALL);\r\n#ifdef CONFIG_BOARD_ATSTK100X_SW2_CUSTOM\r\nat32_add_device_usart(1);\r\n#else\r\nat32_add_device_usart(0);\r\n#endif\r\nat32_add_device_usart(2);\r\n#ifndef CONFIG_BOARD_ATSTK100X_SW1_CUSTOM\r\nat32_add_device_spi(0, spi0_board_info, ARRAY_SIZE(spi0_board_info));\r\n#endif\r\n#ifdef CONFIG_BOARD_ATSTK100X_SPI1\r\nat32_add_device_spi(1, spi1_board_info, ARRAY_SIZE(spi1_board_info));\r\n#endif\r\n#ifndef CONFIG_BOARD_ATSTK100X_SW2_CUSTOM\r\nat32_add_device_mci(0, &mci0_data);\r\n#endif\r\nat32_add_device_usba(0, NULL);\r\n#ifndef CONFIG_BOARD_ATSTK100X_SW3_CUSTOM\r\nat32_add_device_ssc(0, ATMEL_SSC_TX);\r\n#endif\r\natstk1000_setup_j2_leds();\r\natstk1003_setup_extdac();\r\nreturn 0;\r\n}
