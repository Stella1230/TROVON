static void corgi_wait_for_hsync(void)\r\n{\r\nwhile (gpio_get_value(CORGI_GPIO_HSYNC))\r\ncpu_relax();\r\nwhile (!gpio_get_value(CORGI_GPIO_HSYNC))\r\ncpu_relax();\r\n}\r\nstatic void corgi_bl_kick_battery(void)\r\n{\r\nvoid (*kick_batt)(void);\r\nkick_batt = symbol_get(sharpsl_battery_kick);\r\nif (kick_batt) {\r\nkick_batt();\r\nsymbol_put(sharpsl_battery_kick);\r\n}\r\n}\r\nstatic void __init corgi_init_spi(void)\r\n{\r\npxa2xx_set_spi_info(1, &corgi_spi_info);\r\nspi_register_board_info(ARRAY_AND_SIZE(corgi_spi_devices));\r\n}\r\nstatic inline void corgi_init_spi(void) {}\r\nstatic void corgi_poweroff(void)\r\n{\r\nif (!machine_is_corgi())\r\ngpio_set_value(CORGI_GPIO_LED_GREEN, 0);\r\npxa_restart(REBOOT_HARD, NULL);\r\n}\r\nstatic void corgi_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nif (!machine_is_corgi())\r\ngpio_set_value(CORGI_GPIO_LED_GREEN, 1);\r\npxa_restart(REBOOT_HARD, cmd);\r\n}\r\nstatic void __init corgi_init(void)\r\n{\r\npm_power_off = corgi_poweroff;\r\nPCFR |= PCFR_OPDE;\r\npxa2xx_mfp_config(ARRAY_AND_SIZE(corgi_pin_config));\r\ngpio_set_wake(CORGI_GPIO_KEY_INT, 1);\r\ngpio_set_wake(CORGI_GPIO_WAKEUP, 1);\r\ngpio_set_wake(CORGI_GPIO_AC_IN, 1);\r\ngpio_set_wake(CORGI_GPIO_CHRG_FULL, 1);\r\nif (!machine_is_corgi())\r\ngpio_set_wake(CORGI_GPIO_MAIN_BAT_LOW, 1);\r\npxa_set_ffuart_info(NULL);\r\npxa_set_btuart_info(NULL);\r\npxa_set_stuart_info(NULL);\r\ncorgi_init_spi();\r\npxa_set_udc_info(&udc_info);\r\npxa_set_mci_info(&corgi_mci_platform_data);\r\npxa_set_ficp_info(&corgi_ficp_platform_data);\r\npxa_set_i2c_info(NULL);\r\ni2c_register_board_info(0, ARRAY_AND_SIZE(corgi_i2c_devices));\r\nplatform_scoop_config = &corgi_pcmcia_config;\r\nif (machine_is_husky())\r\nsharpsl_nand_partitions[1].size = 53 * 1024 * 1024;\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\n}\r\nstatic void __init fixup_corgi(struct tag *tags, char **cmdline)\r\n{\r\nsharpsl_save_param();\r\nif (machine_is_corgi())\r\nmemblock_add(0xa0000000, SZ_32M);\r\nelse\r\nmemblock_add(0xa0000000, SZ_64M);\r\n}
