void __init r8a7779_register_twd(void)\r\n{\r\ntwd_local_timer_register(&twd_local_timer);\r\n}\r\nstatic int r8a7779_platform_cpu_kill(unsigned int cpu)\r\n{\r\nstruct rcar_sysc_ch *ch = NULL;\r\nint ret = -EIO;\r\ncpu = cpu_logical_map(cpu);\r\nif (cpu < ARRAY_SIZE(r8a7779_ch_cpu))\r\nch = r8a7779_ch_cpu[cpu];\r\nif (ch)\r\nret = rcar_sysc_power_down(ch);\r\nreturn ret ? ret : 1;\r\n}\r\nstatic int r8a7779_boot_secondary(unsigned int cpu, struct task_struct *idle)\r\n{\r\nstruct rcar_sysc_ch *ch = NULL;\r\nunsigned int lcpu = cpu_logical_map(cpu);\r\nint ret;\r\nif (lcpu < ARRAY_SIZE(r8a7779_ch_cpu))\r\nch = r8a7779_ch_cpu[lcpu];\r\nif (ch)\r\nret = rcar_sysc_power_up(ch);\r\nelse\r\nret = -EIO;\r\nreturn ret;\r\n}\r\nstatic void __init r8a7779_smp_prepare_cpus(unsigned int max_cpus)\r\n{\r\n__raw_writel(__pa(shmobile_boot_vector), AVECR);\r\nshmobile_boot_fn = virt_to_phys(shmobile_boot_scu);\r\nshmobile_boot_arg = (unsigned long)shmobile_scu_base;\r\nshmobile_scu_base = IOMEM(R8A7779_SCU_BASE);\r\nshmobile_smp_scu_prepare_cpus(max_cpus);\r\nr8a7779_pm_init();\r\nr8a7779_platform_cpu_kill(1);\r\nr8a7779_platform_cpu_kill(2);\r\nr8a7779_platform_cpu_kill(3);\r\n}\r\nstatic int r8a7779_cpu_kill(unsigned int cpu)\r\n{\r\nif (shmobile_smp_scu_cpu_kill(cpu))\r\nreturn r8a7779_platform_cpu_kill(cpu);\r\nreturn 0;\r\n}\r\nstatic int r8a7779_cpu_disable(unsigned int cpu)\r\n{\r\nreturn cpu == 0 ? -EPERM : 0;\r\n}
