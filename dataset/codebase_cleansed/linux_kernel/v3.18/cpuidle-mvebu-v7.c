static int mvebu_v7_enter_idle(struct cpuidle_device *dev,\r\nstruct cpuidle_driver *drv,\r\nint index)\r\n{\r\nint ret;\r\nbool deepidle = false;\r\ncpu_pm_enter();\r\nif (drv->states[index].flags & MVEBU_V7_FLAG_DEEP_IDLE)\r\ndeepidle = true;\r\nret = mvebu_v7_cpu_suspend(deepidle);\r\nif (ret)\r\nreturn ret;\r\ncpu_pm_exit();\r\nreturn index;\r\n}\r\nstatic int mvebu_v7_cpuidle_probe(struct platform_device *pdev)\r\n{\r\nmvebu_v7_cpu_suspend = pdev->dev.platform_data;\r\nif (!strcmp(pdev->dev.driver->name, "cpuidle-armada-xp"))\r\nreturn cpuidle_register(&armadaxp_idle_driver, NULL);\r\nelse if (!strcmp(pdev->dev.driver->name, "cpuidle-armada-370"))\r\nreturn cpuidle_register(&armada370_idle_driver, NULL);\r\nelse if (!strcmp(pdev->dev.driver->name, "cpuidle-armada-38x"))\r\nreturn cpuidle_register(&armada38x_idle_driver, NULL);\r\nelse\r\nreturn -EINVAL;\r\n}
