int\r\nkiblnd_tunables_init (void)\r\n{\r\nif (kiblnd_translate_mtu(*kiblnd_tunables.kib_ib_mtu) < 0) {\r\nCERROR("Invalid ib_mtu %d, expected 256/512/1024/2048/4096\n",\r\n*kiblnd_tunables.kib_ib_mtu);\r\nreturn -EINVAL;\r\n}\r\nif (*kiblnd_tunables.kib_peertxcredits < IBLND_CREDITS_DEFAULT)\r\n*kiblnd_tunables.kib_peertxcredits = IBLND_CREDITS_DEFAULT;\r\nif (*kiblnd_tunables.kib_peertxcredits > IBLND_CREDITS_MAX)\r\n*kiblnd_tunables.kib_peertxcredits = IBLND_CREDITS_MAX;\r\nif (*kiblnd_tunables.kib_peertxcredits > *kiblnd_tunables.kib_credits)\r\n*kiblnd_tunables.kib_peertxcredits = *kiblnd_tunables.kib_credits;\r\nif (*kiblnd_tunables.kib_peercredits_hiw < *kiblnd_tunables.kib_peertxcredits / 2)\r\n*kiblnd_tunables.kib_peercredits_hiw = *kiblnd_tunables.kib_peertxcredits / 2;\r\nif (*kiblnd_tunables.kib_peercredits_hiw >= *kiblnd_tunables.kib_peertxcredits)\r\n*kiblnd_tunables.kib_peercredits_hiw = *kiblnd_tunables.kib_peertxcredits - 1;\r\nif (*kiblnd_tunables.kib_map_on_demand < 0 ||\r\n*kiblnd_tunables.kib_map_on_demand > IBLND_MAX_RDMA_FRAGS)\r\n*kiblnd_tunables.kib_map_on_demand = 0;\r\nif (*kiblnd_tunables.kib_map_on_demand == 1)\r\n*kiblnd_tunables.kib_map_on_demand = 2;\r\nif (*kiblnd_tunables.kib_concurrent_sends == 0) {\r\nif (*kiblnd_tunables.kib_map_on_demand > 0 &&\r\n*kiblnd_tunables.kib_map_on_demand <= IBLND_MAX_RDMA_FRAGS / 8)\r\n*kiblnd_tunables.kib_concurrent_sends = (*kiblnd_tunables.kib_peertxcredits) * 2;\r\nelse\r\n*kiblnd_tunables.kib_concurrent_sends = (*kiblnd_tunables.kib_peertxcredits);\r\n}\r\nif (*kiblnd_tunables.kib_concurrent_sends > *kiblnd_tunables.kib_peertxcredits * 2)\r\n*kiblnd_tunables.kib_concurrent_sends = *kiblnd_tunables.kib_peertxcredits * 2;\r\nif (*kiblnd_tunables.kib_concurrent_sends < *kiblnd_tunables.kib_peertxcredits / 2)\r\n*kiblnd_tunables.kib_concurrent_sends = *kiblnd_tunables.kib_peertxcredits / 2;\r\nif (*kiblnd_tunables.kib_concurrent_sends < *kiblnd_tunables.kib_peertxcredits) {\r\nCWARN("Concurrent sends %d is lower than message queue size: %d, "\r\n"performance may drop slightly.\n",\r\n*kiblnd_tunables.kib_concurrent_sends, *kiblnd_tunables.kib_peertxcredits);\r\n}\r\nreturn 0;\r\n}
