static void da850_sata_init(struct device *dev, void __iomem *pwrdn_reg,\r\nvoid __iomem *ahci_base)\r\n{\r\nunsigned int val;\r\nval = readl(pwrdn_reg);\r\nval &= ~BIT(0);\r\nwritel(val, pwrdn_reg);\r\nval = SATA_PHY_MPY(DA850_SATA_CLK_MULTIPLIER + 1) | SATA_PHY_LOS(1) |\r\nSATA_PHY_RXCDR(4) | SATA_PHY_RXEQ(1) | SATA_PHY_TXSWING(3) |\r\nSATA_PHY_ENPLL(1);\r\nwritel(val, ahci_base + SATA_P0PHYCR_REG);\r\n}\r\nstatic int ahci_da850_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct ahci_host_priv *hpriv;\r\nstruct resource *res;\r\nvoid __iomem *pwrdn_reg;\r\nint rc;\r\nhpriv = ahci_platform_get_resources(pdev);\r\nif (IS_ERR(hpriv))\r\nreturn PTR_ERR(hpriv);\r\nrc = ahci_platform_enable_resources(hpriv);\r\nif (rc)\r\nreturn rc;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 1);\r\nif (!res)\r\ngoto disable_resources;\r\npwrdn_reg = devm_ioremap(dev, res->start, resource_size(res));\r\nif (!pwrdn_reg)\r\ngoto disable_resources;\r\nda850_sata_init(dev, pwrdn_reg, hpriv->mmio);\r\nrc = ahci_platform_init_host(pdev, hpriv, &ahci_da850_port_info);\r\nif (rc)\r\ngoto disable_resources;\r\nreturn 0;\r\ndisable_resources:\r\nahci_platform_disable_resources(hpriv);\r\nreturn rc;\r\n}
