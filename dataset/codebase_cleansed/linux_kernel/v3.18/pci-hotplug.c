void pcibios_release_device(struct pci_dev *dev)\r\n{\r\neeh_remove_device(dev);\r\n}\r\nvoid pcibios_remove_pci_devices(struct pci_bus *bus)\r\n{\r\nstruct pci_dev *dev, *tmp;\r\nstruct pci_bus *child_bus;\r\nlist_for_each_entry(child_bus, &bus->children, node)\r\npcibios_remove_pci_devices(child_bus);\r\npr_debug("PCI: Removing devices on bus %04x:%02x\n",\r\npci_domain_nr(bus), bus->number);\r\nlist_for_each_entry_safe(dev, tmp, &bus->devices, bus_list) {\r\npr_debug(" Removing %s...\n", pci_name(dev));\r\npci_stop_and_remove_bus_device(dev);\r\n}\r\n}\r\nvoid pcibios_add_pci_devices(struct pci_bus * bus)\r\n{\r\nint slotno, mode, pass, max;\r\nstruct pci_dev *dev;\r\nstruct device_node *dn = pci_bus_to_OF_node(bus);\r\neeh_add_device_tree_early(dn);\r\nmode = PCI_PROBE_NORMAL;\r\nif (ppc_md.pci_probe_mode)\r\nmode = ppc_md.pci_probe_mode(bus);\r\nif (mode == PCI_PROBE_DEVTREE) {\r\nof_rescan_bus(dn, bus);\r\n} else if (mode == PCI_PROBE_NORMAL) {\r\nslotno = PCI_SLOT(PCI_DN(dn->child)->devfn);\r\npci_scan_slot(bus, PCI_DEVFN(slotno, 0));\r\npcibios_setup_bus_devices(bus);\r\nmax = bus->busn_res.start;\r\nfor (pass = 0; pass < 2; pass++) {\r\nlist_for_each_entry(dev, &bus->devices, bus_list) {\r\nif (pci_is_bridge(dev))\r\nmax = pci_scan_bridge(bus, dev,\r\nmax, pass);\r\n}\r\n}\r\n}\r\npcibios_finish_adding_to_bus(bus);\r\n}
