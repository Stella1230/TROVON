void __cvmx_interrupt_asxx_enable(int block)\r\n{\r\nint mask;\r\nunion cvmx_asxx_int_en csr;\r\nif (OCTEON_IS_MODEL(OCTEON_CN38XX) || OCTEON_IS_MODEL(OCTEON_CN58XX))\r\nmask = 0xf;\r\nelse\r\nmask = 0x7;\r\ncsr.u64 = cvmx_read_csr(CVMX_ASXX_INT_EN(block));\r\ncsr.s.txpsh = mask;\r\ncsr.s.txpop = mask;\r\ncsr.s.ovrflw = mask;\r\ncvmx_write_csr(CVMX_ASXX_INT_EN(block), csr.u64);\r\n}\r\nvoid __cvmx_interrupt_gmxx_enable(int interface)\r\n{\r\nunion cvmx_gmxx_inf_mode mode;\r\nunion cvmx_gmxx_tx_int_en gmx_tx_int_en;\r\nint num_ports;\r\nint index;\r\nmode.u64 = cvmx_read_csr(CVMX_GMXX_INF_MODE(interface));\r\nif (OCTEON_IS_MODEL(OCTEON_CN56XX) || OCTEON_IS_MODEL(OCTEON_CN52XX)) {\r\nif (mode.s.en) {\r\nswitch (mode.cn56xx.mode) {\r\ncase 1:\r\nnum_ports = 1;\r\nbreak;\r\ncase 2:\r\ncase 3:\r\nnum_ports = 4;\r\nbreak;\r\ndefault:\r\nnum_ports = 0;\r\nbreak;\r\n}\r\n} else\r\nnum_ports = 0;\r\n} else {\r\nif (mode.s.en) {\r\nif (OCTEON_IS_MODEL(OCTEON_CN38XX)\r\n|| OCTEON_IS_MODEL(OCTEON_CN58XX)) {\r\nif (mode.s.type)\r\nnum_ports = 1;\r\nelse\r\nnum_ports = 4;\r\n} else {\r\nif (mode.s.type)\r\nnum_ports = 2;\r\nelse\r\nnum_ports = 3;\r\n}\r\n} else\r\nnum_ports = 0;\r\n}\r\ngmx_tx_int_en.u64 = 0;\r\nif (num_ports) {\r\nif (OCTEON_IS_MODEL(OCTEON_CN38XX)\r\n|| OCTEON_IS_MODEL(OCTEON_CN58XX))\r\ngmx_tx_int_en.cn38xx.ncb_nxa = 1;\r\ngmx_tx_int_en.s.pko_nxa = 1;\r\n}\r\ngmx_tx_int_en.s.undflw = (1 << num_ports) - 1;\r\ncvmx_write_csr(CVMX_GMXX_TX_INT_EN(interface), gmx_tx_int_en.u64);\r\nfor (index = 0; index < num_ports; index++)\r\n__cvmx_interrupt_gmxx_rxx_int_en_enable(index, interface);\r\n}
