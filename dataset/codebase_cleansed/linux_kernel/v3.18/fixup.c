static void pci_fixup_video(struct pci_dev *pdev)\r\n{\r\nstruct pci_dev *bridge;\r\nstruct pci_bus *bus;\r\nu16 config;\r\nif ((strcmp(ia64_platform_name, "dig") != 0)\r\n&& (strcmp(ia64_platform_name, "hpzx1") != 0))\r\nreturn;\r\nbus = pdev->bus;\r\nwhile (bus) {\r\nbridge = bus->self;\r\nif (bridge && (pci_is_bridge(bridge))) {\r\npci_read_config_word(bridge, PCI_BRIDGE_CONTROL,\r\n&config);\r\nif (!(config & PCI_BRIDGE_CTL_VGA))\r\nreturn;\r\n}\r\nbus = bus->parent;\r\n}\r\nif (!vga_default_device() || pdev == vga_default_device()) {\r\npci_read_config_word(pdev, PCI_COMMAND, &config);\r\nif (config & (PCI_COMMAND_IO | PCI_COMMAND_MEMORY)) {\r\npdev->resource[PCI_ROM_RESOURCE].flags |= IORESOURCE_ROM_SHADOW;\r\ndev_printk(KERN_DEBUG, &pdev->dev, "Video device with shadowed ROM\n");\r\n}\r\n}\r\n}
