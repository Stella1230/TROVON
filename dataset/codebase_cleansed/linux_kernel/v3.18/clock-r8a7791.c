void __init r8a7791_clock_init(void)\r\n{\r\nu32 mode = rcar_gen2_read_mode_pins();\r\nint k, ret = 0;\r\nswitch (mode & (MD(14) | MD(13))) {\r\ncase 0:\r\nR8A7791_CLOCK_ROOT(15, &extal_clk, 172, 208, 106, 88);\r\nbreak;\r\ncase MD(13):\r\nR8A7791_CLOCK_ROOT(20, &extal_clk, 130, 156, 80, 66);\r\nbreak;\r\ncase MD(14):\r\nR8A7791_CLOCK_ROOT(26, &extal_div2_clk, 200, 240, 122, 102);\r\nbreak;\r\ncase MD(13) | MD(14):\r\nR8A7791_CLOCK_ROOT(30, &extal_div2_clk, 172, 208, 106, 88);\r\nbreak;\r\n}\r\nif ((mode & (MD(3) | MD(2) | MD(1))) == MD(2))\r\nSH_CLK_SET_RATIO(&qspi_clk_ratio, 1, 16);\r\nelse\r\nSH_CLK_SET_RATIO(&qspi_clk_ratio, 1, 20);\r\nfor (k = 0; !ret && (k < ARRAY_SIZE(main_clks)); k++)\r\nret = clk_register(main_clks[k]);\r\nif (!ret)\r\nret = sh_clk_div4_register(div4_clks, DIV4_NR, &div4_table);\r\nif (!ret)\r\nret = sh_clk_div6_register(div6_clks, DIV6_NR);\r\nif (!ret)\r\nret = sh_clk_mstp_register(mstp_clks, MSTP_NR);\r\nclkdev_add_table(lookups, ARRAY_SIZE(lookups));\r\nif (!ret)\r\nshmobile_clk_init();\r\nelse\r\ngoto epanic;\r\nreturn;\r\nepanic:\r\npanic("failed to setup r8a7791 clocks\n");\r\n}
