asmlinkage int sys_tas(int __user *addr)\r\n{\r\nint oldval;\r\nif (!access_ok(VERIFY_WRITE, addr, sizeof (int)))\r\nreturn -EFAULT;\r\n__asm__ __volatile__ (\r\nDCACHE_CLEAR("%0", "r4", "%1")\r\n" .fillinsn\n"\r\n"1:\n"\r\n" lock %0, @%1 -> unlock %2, @%1\n"\r\n"2:\n"\r\n".section .fixup,\"ax\"\n"\r\n" .balign 4\n"\r\n"3: ldi %0, #%3\n"\r\n" seth r14, #high(2b)\n"\r\n" or3 r14, r14, #low(2b)\n"\r\n" jmp r14\n"\r\n".previous\n"\r\n".section __ex_table,\"a\"\n"\r\n" .balign 4\n"\r\n" .long 1b,3b\n"\r\n".previous\n"\r\n: "=&r" (oldval)\r\n: "r" (addr), "r" (1), "i"(-EFAULT)\r\n: "r14", "memory"\r\n#ifdef CONFIG_CHIP_M32700_TS1\r\n, "r4"\r\n#endif\r\n);\r\nreturn oldval;\r\n}\r\nasmlinkage int sys_cacheflush(void *addr, int bytes, int cache)\r\n{\r\n_flush_cache_all();\r\nreturn 0;\r\n}\r\nasmlinkage int sys_cachectl(char *addr, int nbytes, int op)\r\n{\r\nreturn -ENOSYS;\r\n}
