u32 cm_get_file_size(ACPI_FILE file)\r\n{\r\nlong file_size;\r\nlong current_offset;\r\nacpi_status status;\r\ncurrent_offset = acpi_os_get_file_offset(file);\r\nif (current_offset < 0) {\r\ngoto offset_error;\r\n}\r\nstatus = acpi_os_set_file_offset(file, 0, ACPI_FILE_END);\r\nif (ACPI_FAILURE(status)) {\r\ngoto seek_error;\r\n}\r\nfile_size = acpi_os_get_file_offset(file);\r\nif (file_size < 0) {\r\ngoto offset_error;\r\n}\r\nstatus = acpi_os_set_file_offset(file, current_offset, ACPI_FILE_BEGIN);\r\nif (ACPI_FAILURE(status)) {\r\ngoto seek_error;\r\n}\r\nreturn ((u32)file_size);\r\noffset_error:\r\nacpi_log_error("Could not get file offset");\r\nreturn (ACPI_UINT32_MAX);\r\nseek_error:\r\nacpi_log_error("Could not set file offset");\r\nreturn (ACPI_UINT32_MAX);\r\n}
