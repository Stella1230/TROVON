static int fpuemu_stat_get(void *data, u64 *val)\r\n{\r\nint cpu;\r\nunsigned long sum = 0;\r\nfor_each_online_cpu(cpu) {\r\nstruct mips_fpu_emulator_stats *ps;\r\nlocal_t *pv;\r\nps = &per_cpu(fpuemustats, cpu);\r\npv = (void *)ps + (unsigned long)data;\r\nsum += local_read(pv);\r\n}\r\n*val = sum;\r\nreturn 0;\r\n}\r\nstatic int __init debugfs_fpuemu(void)\r\n{\r\nstruct dentry *d, *dir;\r\nif (!mips_debugfs_dir)\r\nreturn -ENODEV;\r\ndir = debugfs_create_dir("fpuemustats", mips_debugfs_dir);\r\nif (!dir)\r\nreturn -ENOMEM;\r\n#define FPU_EMU_STAT_OFFSET(m) \\r\noffsetof(struct mips_fpu_emulator_stats, m)\r\n#define FPU_STAT_CREATE(m) \\r\ndo { \\r\nd = debugfs_create_file(#m , S_IRUGO, dir, \\r\n(void *)FPU_EMU_STAT_OFFSET(m), \\r\n&fops_fpuemu_stat); \\r\nif (!d) \\r\nreturn -ENOMEM; \\r\n} while (0)\r\nFPU_STAT_CREATE(emulated);\r\nFPU_STAT_CREATE(loads);\r\nFPU_STAT_CREATE(stores);\r\nFPU_STAT_CREATE(cp1ops);\r\nFPU_STAT_CREATE(cp1xops);\r\nFPU_STAT_CREATE(errors);\r\nFPU_STAT_CREATE(ieee754_inexact);\r\nFPU_STAT_CREATE(ieee754_underflow);\r\nFPU_STAT_CREATE(ieee754_overflow);\r\nFPU_STAT_CREATE(ieee754_zerodiv);\r\nFPU_STAT_CREATE(ieee754_invalidop);\r\nreturn 0;\r\n}
