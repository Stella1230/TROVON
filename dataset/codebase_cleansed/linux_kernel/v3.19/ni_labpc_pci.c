static int labpc_pci_mite_init(struct pci_dev *pcidev)\r\n{\r\nvoid __iomem *mite_base;\r\nu32 main_phys_addr;\r\nmite_base = pci_ioremap_bar(pcidev, 0);\r\nif (!mite_base)\r\nreturn -ENOMEM;\r\nmain_phys_addr = pci_resource_start(pcidev, 1);\r\nwritel(main_phys_addr | WENAB, mite_base + MITE_IODWBSR);\r\niounmap(mite_base);\r\nreturn 0;\r\n}\r\nstatic int labpc_pci_auto_attach(struct comedi_device *dev,\r\nunsigned long context)\r\n{\r\nstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\r\nconst struct labpc_boardinfo *board = NULL;\r\nstruct labpc_private *devpriv;\r\nint ret;\r\nif (context < ARRAY_SIZE(labpc_pci_boards))\r\nboard = &labpc_pci_boards[context];\r\nif (!board)\r\nreturn -ENODEV;\r\ndev->board_ptr = board;\r\ndev->board_name = board->name;\r\nret = comedi_pci_enable(dev);\r\nif (ret)\r\nreturn ret;\r\nret = labpc_pci_mite_init(pcidev);\r\nif (ret)\r\nreturn ret;\r\ndev->mmio = pci_ioremap_bar(pcidev, 1);\r\nif (!dev->mmio)\r\nreturn -ENOMEM;\r\ndevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\r\nif (!devpriv)\r\nreturn -ENOMEM;\r\nreturn labpc_common_attach(dev, pcidev->irq, IRQF_SHARED);\r\n}\r\nstatic int labpc_pci_probe(struct pci_dev *dev,\r\nconst struct pci_device_id *id)\r\n{\r\nreturn comedi_pci_auto_config(dev, &labpc_pci_comedi_driver,\r\nid->driver_data);\r\n}
