static void tpohvga_onoff(struct mmp_panel *panel, int status)\r\n{\r\nstruct tpohvga_plat_data *plat = panel->plat_data;\r\nint ret;\r\nif (status) {\r\nplat->plat_onoff(1);\r\nret = spi_write(plat->spi, init, sizeof(init));\r\nif (ret < 0)\r\ndev_warn(panel->dev, "init cmd failed(%d)\n", ret);\r\n} else {\r\nret = spi_write(plat->spi, poweroff, sizeof(poweroff));\r\nif (ret < 0)\r\ndev_warn(panel->dev, "poweroff cmd failed(%d)\n", ret);\r\nplat->plat_onoff(0);\r\n}\r\n}\r\nstatic int tpohvga_get_modelist(struct mmp_panel *panel,\r\nstruct mmp_mode **modelist)\r\n{\r\n*modelist = mmp_modes_tpohvga;\r\nreturn 1;\r\n}\r\nstatic int tpohvga_probe(struct spi_device *spi)\r\n{\r\nstruct mmp_mach_panel_info *mi;\r\nint ret;\r\nstruct tpohvga_plat_data *plat_data;\r\nmi = spi->dev.platform_data;\r\nif (mi == NULL) {\r\ndev_err(&spi->dev, "%s: no platform data defined\n", __func__);\r\nreturn -EINVAL;\r\n}\r\nspi->bits_per_word = 16;\r\nret = spi_setup(spi);\r\nif (ret < 0) {\r\ndev_err(&spi->dev, "spi setup failed %d", ret);\r\nreturn ret;\r\n}\r\nplat_data = kzalloc(sizeof(*plat_data), GFP_KERNEL);\r\nif (plat_data == NULL)\r\nreturn -ENOMEM;\r\nplat_data->spi = spi;\r\nplat_data->plat_onoff = mi->plat_set_onoff;\r\npanel_tpohvga.plat_data = plat_data;\r\npanel_tpohvga.plat_path_name = mi->plat_path_name;\r\npanel_tpohvga.dev = &spi->dev;\r\nmmp_register_panel(&panel_tpohvga);\r\nreturn 0;\r\n}
