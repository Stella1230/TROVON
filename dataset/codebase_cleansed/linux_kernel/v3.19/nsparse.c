acpi_status\r\nacpi_ns_one_complete_parse(u32 pass_number,\r\nu32 table_index,\r\nstruct acpi_namespace_node *start_node)\r\n{\r\nunion acpi_parse_object *parse_root;\r\nacpi_status status;\r\nu32 aml_length;\r\nu8 *aml_start;\r\nstruct acpi_walk_state *walk_state;\r\nstruct acpi_table_header *table;\r\nacpi_owner_id owner_id;\r\nACPI_FUNCTION_TRACE(ns_one_complete_parse);\r\nstatus = acpi_tb_get_owner_id(table_index, &owner_id);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nparse_root = acpi_ps_create_scope_op();\r\nif (!parse_root) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\nwalk_state = acpi_ds_create_walk_state(owner_id, NULL, NULL, NULL);\r\nif (!walk_state) {\r\nacpi_ps_free_op(parse_root);\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\nstatus = acpi_get_table_by_index(table_index, &table);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ds_delete_walk_state(walk_state);\r\nacpi_ps_free_op(parse_root);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (table->length < sizeof(struct acpi_table_header)) {\r\nstatus = AE_BAD_HEADER;\r\n} else {\r\naml_start = (u8 *) table + sizeof(struct acpi_table_header);\r\naml_length = table->length - sizeof(struct acpi_table_header);\r\nstatus = acpi_ds_init_aml_walk(walk_state, parse_root, NULL,\r\naml_start, aml_length, NULL,\r\n(u8) pass_number);\r\n}\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ds_delete_walk_state(walk_state);\r\ngoto cleanup;\r\n}\r\nif (start_node && start_node != acpi_gbl_root_node) {\r\nstatus =\r\nacpi_ds_scope_stack_push(start_node, ACPI_TYPE_METHOD,\r\nwalk_state);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_ds_delete_walk_state(walk_state);\r\ngoto cleanup;\r\n}\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_PARSE, "*PARSE* pass %u parse\n",\r\npass_number));\r\nstatus = acpi_ps_parse_aml(walk_state);\r\ncleanup:\r\nacpi_ps_delete_parse_tree(parse_root);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status\r\nacpi_ns_parse_table(u32 table_index, struct acpi_namespace_node *start_node)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ns_parse_table);\r\nACPI_DEBUG_PRINT((ACPI_DB_PARSE, "**** Start pass 1\n"));\r\nstatus = acpi_ns_one_complete_parse(ACPI_IMODE_LOAD_PASS1,\r\ntable_index, start_node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_PARSE, "**** Start pass 2\n"));\r\nstatus = acpi_ns_one_complete_parse(ACPI_IMODE_LOAD_PASS2,\r\ntable_index, start_node);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}
