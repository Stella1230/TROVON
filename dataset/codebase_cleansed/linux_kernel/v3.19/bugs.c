static void __init check_fpu(void)\r\n{\r\ns32 fdiv_bug;\r\nkernel_fpu_begin();\r\n__asm__("fninit\n\t"\r\n"fldl %1\n\t"\r\n"fdivl %2\n\t"\r\n"fmull %2\n\t"\r\n"fldl %1\n\t"\r\n"fsubp %%st,%%st(1)\n\t"\r\n"fistpl %0\n\t"\r\n"fwait\n\t"\r\n"fninit"\r\n: "=m" (*&fdiv_bug)\r\n: "m" (*&x), "m" (*&y));\r\nkernel_fpu_end();\r\nif (fdiv_bug) {\r\nset_cpu_bug(&boot_cpu_data, X86_BUG_FDIV);\r\npr_warn("Hmm, FPU with FDIV bug\n");\r\n}\r\n}\r\nvoid __init check_bugs(void)\r\n{\r\nidentify_boot_cpu();\r\n#ifndef CONFIG_SMP\r\npr_info("CPU: ");\r\nprint_cpu_info(&boot_cpu_data);\r\n#endif\r\nif (boot_cpu_data.x86 < 4)\r\npanic("Kernel requires i486+ for 'invlpg' and other features");\r\ninit_utsname()->machine[1] =\r\n'0' + (boot_cpu_data.x86 > 6 ? 6 : boot_cpu_data.x86);\r\nalternative_instructions();\r\nif (cpu_has_fpu)\r\ncheck_fpu();\r\n}
