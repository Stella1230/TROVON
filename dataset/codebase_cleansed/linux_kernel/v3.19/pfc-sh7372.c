static void __iomem *sh7372_pinmux_portcr(struct sh_pfc *pfc, unsigned int pin)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < ARRAY_SIZE(sh7372_portcr_offsets); ++i) {\r\nconst struct sh7372_portcr_group *group =\r\n&sh7372_portcr_offsets[i];\r\nif (pin <= group->end_pin)\r\nreturn pfc->windows->virt + group->offset + pin;\r\n}\r\nreturn NULL;\r\n}\r\nstatic unsigned int sh7372_pinmux_get_bias(struct sh_pfc *pfc, unsigned int pin)\r\n{\r\nvoid __iomem *addr = sh7372_pinmux_portcr(pfc, pin);\r\nu32 value = ioread8(addr) & PORTnCR_PULMD_MASK;\r\nswitch (value) {\r\ncase PORTnCR_PULMD_UP:\r\nreturn PIN_CONFIG_BIAS_PULL_UP;\r\ncase PORTnCR_PULMD_DOWN:\r\nreturn PIN_CONFIG_BIAS_PULL_DOWN;\r\ncase PORTnCR_PULMD_OFF:\r\ndefault:\r\nreturn PIN_CONFIG_BIAS_DISABLE;\r\n}\r\n}\r\nstatic void sh7372_pinmux_set_bias(struct sh_pfc *pfc, unsigned int pin,\r\nunsigned int bias)\r\n{\r\nvoid __iomem *addr = sh7372_pinmux_portcr(pfc, pin);\r\nu32 value = ioread8(addr) & ~PORTnCR_PULMD_MASK;\r\nswitch (bias) {\r\ncase PIN_CONFIG_BIAS_PULL_UP:\r\nvalue |= PORTnCR_PULMD_UP;\r\nbreak;\r\ncase PIN_CONFIG_BIAS_PULL_DOWN:\r\nvalue |= PORTnCR_PULMD_DOWN;\r\nbreak;\r\n}\r\niowrite8(value, addr);\r\n}
