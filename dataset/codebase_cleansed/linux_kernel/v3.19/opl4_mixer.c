static int snd_opl4_ctl_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_INTEGER;\r\nuinfo->count = 2;\r\nuinfo->value.integer.min = 0;\r\nuinfo->value.integer.max = 7;\r\nreturn 0;\r\n}\r\nstatic int snd_opl4_ctl_get(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_opl4 *opl4 = snd_kcontrol_chip(kcontrol);\r\nunsigned long flags;\r\nu8 reg = kcontrol->private_value;\r\nu8 value;\r\nspin_lock_irqsave(&opl4->reg_lock, flags);\r\nvalue = snd_opl4_read(opl4, reg);\r\nspin_unlock_irqrestore(&opl4->reg_lock, flags);\r\nucontrol->value.integer.value[0] = 7 - (value & 7);\r\nucontrol->value.integer.value[1] = 7 - ((value >> 3) & 7);\r\nreturn 0;\r\n}\r\nstatic int snd_opl4_ctl_put(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_opl4 *opl4 = snd_kcontrol_chip(kcontrol);\r\nunsigned long flags;\r\nu8 reg = kcontrol->private_value;\r\nu8 value, old_value;\r\nvalue = (7 - (ucontrol->value.integer.value[0] & 7)) |\r\n((7 - (ucontrol->value.integer.value[1] & 7)) << 3);\r\nspin_lock_irqsave(&opl4->reg_lock, flags);\r\nold_value = snd_opl4_read(opl4, reg);\r\nsnd_opl4_write(opl4, reg, value);\r\nspin_unlock_irqrestore(&opl4->reg_lock, flags);\r\nreturn value != old_value;\r\n}\r\nint snd_opl4_create_mixer(struct snd_opl4 *opl4)\r\n{\r\nstruct snd_card *card = opl4->card;\r\nint i, err;\r\nstrcat(card->mixername, ",OPL4");\r\nfor (i = 0; i < 2; ++i) {\r\nerr = snd_ctl_add(card, snd_ctl_new1(&snd_opl4_controls[i], opl4));\r\nif (err < 0)\r\nreturn err;\r\n}\r\nreturn 0;\r\n}
