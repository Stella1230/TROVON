static void xgene_get_drvinfo(struct net_device *ndev,\r\nstruct ethtool_drvinfo *info)\r\n{\r\nstruct xgene_enet_pdata *pdata = netdev_priv(ndev);\r\nstruct platform_device *pdev = pdata->pdev;\r\nstrcpy(info->driver, "xgene_enet");\r\nstrcpy(info->version, XGENE_DRV_VERSION);\r\nsnprintf(info->fw_version, ETHTOOL_FWVERS_LEN, "N/A");\r\nsprintf(info->bus_info, "%s", pdev->name);\r\n}\r\nstatic int xgene_get_settings(struct net_device *ndev, struct ethtool_cmd *cmd)\r\n{\r\nstruct xgene_enet_pdata *pdata = netdev_priv(ndev);\r\nstruct phy_device *phydev = pdata->phy_dev;\r\nif (pdata->phy_mode == PHY_INTERFACE_MODE_RGMII) {\r\nif (phydev == NULL)\r\nreturn -ENODEV;\r\nreturn phy_ethtool_gset(phydev, cmd);\r\n} else if (pdata->phy_mode == PHY_INTERFACE_MODE_SGMII) {\r\ncmd->supported = SUPPORTED_1000baseT_Full |\r\nSUPPORTED_Autoneg | SUPPORTED_MII;\r\ncmd->advertising = cmd->supported;\r\nethtool_cmd_speed_set(cmd, SPEED_1000);\r\ncmd->duplex = DUPLEX_FULL;\r\ncmd->port = PORT_MII;\r\ncmd->transceiver = XCVR_INTERNAL;\r\ncmd->autoneg = AUTONEG_ENABLE;\r\n} else {\r\ncmd->supported = SUPPORTED_10000baseT_Full | SUPPORTED_FIBRE;\r\ncmd->advertising = cmd->supported;\r\nethtool_cmd_speed_set(cmd, SPEED_10000);\r\ncmd->duplex = DUPLEX_FULL;\r\ncmd->port = PORT_FIBRE;\r\ncmd->transceiver = XCVR_INTERNAL;\r\ncmd->autoneg = AUTONEG_DISABLE;\r\n}\r\nreturn 0;\r\n}\r\nstatic int xgene_set_settings(struct net_device *ndev, struct ethtool_cmd *cmd)\r\n{\r\nstruct xgene_enet_pdata *pdata = netdev_priv(ndev);\r\nstruct phy_device *phydev = pdata->phy_dev;\r\nif (pdata->phy_mode == PHY_INTERFACE_MODE_RGMII) {\r\nif (phydev == NULL)\r\nreturn -ENODEV;\r\nreturn phy_ethtool_sset(phydev, cmd);\r\n}\r\nreturn -EINVAL;\r\n}\r\nstatic void xgene_get_strings(struct net_device *ndev, u32 stringset, u8 *data)\r\n{\r\nint i;\r\nu8 *p = data;\r\nif (stringset != ETH_SS_STATS)\r\nreturn;\r\nfor (i = 0; i < XGENE_STATS_LEN; i++) {\r\nmemcpy(p, gstrings_stats[i].name, ETH_GSTRING_LEN);\r\np += ETH_GSTRING_LEN;\r\n}\r\n}\r\nstatic int xgene_get_sset_count(struct net_device *ndev, int sset)\r\n{\r\nif (sset != ETH_SS_STATS)\r\nreturn -EINVAL;\r\nreturn XGENE_STATS_LEN;\r\n}\r\nstatic void xgene_get_ethtool_stats(struct net_device *ndev,\r\nstruct ethtool_stats *dummy,\r\nu64 *data)\r\n{\r\nvoid *pdata = netdev_priv(ndev);\r\nint i;\r\nfor (i = 0; i < XGENE_STATS_LEN; i++)\r\n*data++ = *(u64 *)(pdata + gstrings_stats[i].offset);\r\n}\r\nvoid xgene_enet_set_ethtool_ops(struct net_device *ndev)\r\n{\r\nndev->ethtool_ops = &xgene_ethtool_ops;\r\n}
