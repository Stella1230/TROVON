u32 acpi_ev_sci_dispatch(void)\r\n{\r\nstruct acpi_sci_handler_info *sci_handler;\r\nacpi_cpu_flags flags;\r\nu32 int_status = ACPI_INTERRUPT_NOT_HANDLED;\r\nACPI_FUNCTION_NAME(ev_sci_dispatch);\r\nif (!acpi_gbl_sci_handler_list) {\r\nreturn (int_status);\r\n}\r\nflags = acpi_os_acquire_lock(acpi_gbl_gpe_lock);\r\nsci_handler = acpi_gbl_sci_handler_list;\r\nwhile (sci_handler) {\r\nint_status |= sci_handler->address(sci_handler->context);\r\nsci_handler = sci_handler->next;\r\n}\r\nacpi_os_release_lock(acpi_gbl_gpe_lock, flags);\r\nreturn (int_status);\r\n}\r\nstatic u32 ACPI_SYSTEM_XFACE acpi_ev_sci_xrupt_handler(void *context)\r\n{\r\nstruct acpi_gpe_xrupt_info *gpe_xrupt_list = context;\r\nu32 interrupt_handled = ACPI_INTERRUPT_NOT_HANDLED;\r\nACPI_FUNCTION_TRACE(ev_sci_xrupt_handler);\r\ninterrupt_handled |= acpi_ev_fixed_event_detect();\r\ninterrupt_handled |= acpi_ev_gpe_detect(gpe_xrupt_list);\r\ninterrupt_handled |= acpi_ev_sci_dispatch();\r\nacpi_sci_count++;\r\nreturn_UINT32(interrupt_handled);\r\n}\r\nu32 ACPI_SYSTEM_XFACE acpi_ev_gpe_xrupt_handler(void *context)\r\n{\r\nstruct acpi_gpe_xrupt_info *gpe_xrupt_list = context;\r\nu32 interrupt_handled = ACPI_INTERRUPT_NOT_HANDLED;\r\nACPI_FUNCTION_TRACE(ev_gpe_xrupt_handler);\r\ninterrupt_handled |= acpi_ev_gpe_detect(gpe_xrupt_list);\r\nreturn_UINT32(interrupt_handled);\r\n}\r\nu32 acpi_ev_install_sci_handler(void)\r\n{\r\nu32 status = AE_OK;\r\nACPI_FUNCTION_TRACE(ev_install_sci_handler);\r\nstatus =\r\nacpi_os_install_interrupt_handler((u32) acpi_gbl_FADT.sci_interrupt,\r\nacpi_ev_sci_xrupt_handler,\r\nacpi_gbl_gpe_xrupt_list_head);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_ev_remove_all_sci_handlers(void)\r\n{\r\nstruct acpi_sci_handler_info *sci_handler;\r\nacpi_cpu_flags flags;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ev_remove_all_sci_handlers);\r\nstatus =\r\nacpi_os_remove_interrupt_handler((u32) acpi_gbl_FADT.sci_interrupt,\r\nacpi_ev_sci_xrupt_handler);\r\nif (!acpi_gbl_sci_handler_list) {\r\nreturn (status);\r\n}\r\nflags = acpi_os_acquire_lock(acpi_gbl_gpe_lock);\r\nwhile (acpi_gbl_sci_handler_list) {\r\nsci_handler = acpi_gbl_sci_handler_list;\r\nacpi_gbl_sci_handler_list = sci_handler->next;\r\nACPI_FREE(sci_handler);\r\n}\r\nacpi_os_release_lock(acpi_gbl_gpe_lock, flags);\r\nreturn_ACPI_STATUS(status);\r\n}
