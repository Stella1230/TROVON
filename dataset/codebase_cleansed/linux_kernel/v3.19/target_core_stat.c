static ssize_t target_stat_scsi_dev_show_attr_inst(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nstruct se_hba *hba = dev->se_hba;\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\n}\r\nstatic ssize_t target_stat_scsi_dev_show_attr_indx(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", dev->dev_index);\r\n}\r\nstatic ssize_t target_stat_scsi_dev_show_attr_role(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "Target\n");\r\n}\r\nstatic ssize_t target_stat_scsi_dev_show_attr_ports(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", dev->dev_port_count);\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_inst(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nstruct se_hba *hba = dev->se_hba;\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_indx(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", dev->dev_index);\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_num_lus(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", LU_COUNT);\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_status(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nif (dev->export_count)\r\nreturn snprintf(page, PAGE_SIZE, "activated");\r\nelse\r\nreturn snprintf(page, PAGE_SIZE, "deactivated");\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_non_access_lus(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nint non_accessible_lus;\r\nif (dev->export_count)\r\nnon_accessible_lus = 0;\r\nelse\r\nnon_accessible_lus = 1;\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", non_accessible_lus);\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_dev_show_attr_resets(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%lu\n",\r\natomic_long_read(&dev->num_resets));\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_inst(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nstruct se_hba *hba = dev->se_hba;\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_dev(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", dev->dev_index);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_indx(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", SCSI_LU_INDEX);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_lun(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "%llu\n", (unsigned long long)0);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_lu_name(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%s\n",\r\n(strlen(dev->t10_wwn.unit_serial)) ?\r\ndev->t10_wwn.unit_serial : "None");\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_vend(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nint i;\r\nchar str[sizeof(dev->t10_wwn.vendor)+1];\r\nfor (i = 0; i < sizeof(dev->t10_wwn.vendor); i++)\r\nstr[i] = ISPRINT(dev->t10_wwn.vendor[i]) ?\r\ndev->t10_wwn.vendor[i] : ' ';\r\nstr[i] = '\0';\r\nreturn snprintf(page, PAGE_SIZE, "%s\n", str);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_prod(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nint i;\r\nchar str[sizeof(dev->t10_wwn.model)+1];\r\nfor (i = 0; i < sizeof(dev->t10_wwn.vendor); i++)\r\nstr[i] = ISPRINT(dev->t10_wwn.model[i]) ?\r\ndev->t10_wwn.model[i] : ' ';\r\nstr[i] = '\0';\r\nreturn snprintf(page, PAGE_SIZE, "%s\n", str);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_rev(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nint i;\r\nchar str[sizeof(dev->t10_wwn.revision)+1];\r\nfor (i = 0; i < sizeof(dev->t10_wwn.revision); i++)\r\nstr[i] = ISPRINT(dev->t10_wwn.revision[i]) ?\r\ndev->t10_wwn.revision[i] : ' ';\r\nstr[i] = '\0';\r\nreturn snprintf(page, PAGE_SIZE, "%s\n", str);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_dev_type(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n",\r\ndev->transport->get_device_type(dev));\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_status(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%s\n",\r\n(dev->export_count) ? "available" : "notavailable");\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_state_bit(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "exposed\n");\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_num_cmds(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%lu\n",\r\natomic_long_read(&dev->num_cmds));\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_read_mbytes(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%lu\n",\r\natomic_long_read(&dev->read_bytes) >> 20);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_write_mbytes(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%lu\n",\r\natomic_long_read(&dev->write_bytes) >> 20);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_resets(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%lu\n", atomic_long_read(&dev->num_resets));\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_full_stat(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", 0);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_hs_num_cmds(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", 0);\r\n}\r\nstatic ssize_t target_stat_scsi_lu_show_attr_creation_time(\r\nstruct se_dev_stat_grps *sgrps, char *page)\r\n{\r\nstruct se_device *dev =\r\ncontainer_of(sgrps, struct se_device, dev_stat_grps);\r\nreturn snprintf(page, PAGE_SIZE, "%u\n", (u32)(((u32)dev->creation_time -\r\nINITIAL_JIFFIES) * 100 / HZ));\r\n}\r\nvoid target_stat_setup_dev_default_groups(struct se_device *dev)\r\n{\r\nstruct config_group *dev_stat_grp = &dev->dev_stat_grps.stat_group;\r\nconfig_group_init_type_name(&dev->dev_stat_grps.scsi_dev_group,\r\n"scsi_dev", &target_stat_scsi_dev_cit);\r\nconfig_group_init_type_name(&dev->dev_stat_grps.scsi_tgt_dev_group,\r\n"scsi_tgt_dev", &target_stat_scsi_tgt_dev_cit);\r\nconfig_group_init_type_name(&dev->dev_stat_grps.scsi_lu_group,\r\n"scsi_lu", &target_stat_scsi_lu_cit);\r\ndev_stat_grp->default_groups[0] = &dev->dev_stat_grps.scsi_dev_group;\r\ndev_stat_grp->default_groups[1] = &dev->dev_stat_grps.scsi_tgt_dev_group;\r\ndev_stat_grp->default_groups[2] = &dev->dev_stat_grps.scsi_lu_group;\r\ndev_stat_grp->default_groups[3] = NULL;\r\n}\r\nstatic ssize_t target_stat_scsi_port_show_attr_inst(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_hba *hba;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nhba = dev->se_hba;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_port_show_attr_dev(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_device *dev = lun->lun_se_dev;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", dev->dev_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_port_show_attr_indx(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", sep->sep_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_port_show_attr_role(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_port *sep;\r\nssize_t ret;\r\nif (!dev)\r\nreturn -ENODEV;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%s%u\n", "Device", dev->dev_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_port_show_attr_busy_count(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", 0);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_inst(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_port *sep;\r\nstruct se_hba *hba;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nhba = dev->se_hba;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_dev(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", dev->dev_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_indx(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", sep->sep_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_name(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = sep->sep_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%sPort#%u\n",\r\ntpg->se_tpg_tfo->get_fabric_name(), sep->sep_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_port_index(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = sep->sep_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%s%s%d\n",\r\ntpg->se_tpg_tfo->tpg_get_wwn(tpg), "+t+",\r\ntpg->se_tpg_tfo->tpg_get_tag(tpg));\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_in_cmds(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%llu\n", sep->sep_stats.cmd_pdus);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_write_mbytes(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\n(u32)(sep->sep_stats.rx_data_octets >> 20));\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_read_mbytes(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\n(u32)(sep->sep_stats.tx_data_octets >> 20));\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_tgt_port_show_attr_hs_in_cmds(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", 0);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_transport_show_attr_inst(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_port *sep;\r\nstruct se_hba *hba;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\nhba = dev->se_hba;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", hba->hba_index);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_transport_show_attr_device(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = sep->sep_tpg;\r\nret = snprintf(page, PAGE_SIZE, "scsiTransport%s\n",\r\ntpg->se_tpg_tfo->get_fabric_name());\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_transport_show_attr_indx(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_port *sep;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = sep->sep_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\ntpg->se_tpg_tfo->tpg_get_inst_index(tpg));\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_transport_show_attr_dev_name(\r\nstruct se_port_stat_grps *pgrps, char *page)\r\n{\r\nstruct se_lun *lun = container_of(pgrps, struct se_lun, port_stat_grps);\r\nstruct se_device *dev = lun->lun_se_dev;\r\nstruct se_port *sep;\r\nstruct se_portal_group *tpg;\r\nstruct t10_wwn *wwn;\r\nssize_t ret;\r\nspin_lock(&lun->lun_sep_lock);\r\nsep = lun->lun_sep;\r\nif (!sep) {\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = sep->sep_tpg;\r\nwwn = &dev->t10_wwn;\r\nret = snprintf(page, PAGE_SIZE, "%s+%s\n",\r\ntpg->se_tpg_tfo->tpg_get_wwn(tpg),\r\n(strlen(wwn->unit_serial)) ? wwn->unit_serial :\r\nwwn->vendor);\r\nspin_unlock(&lun->lun_sep_lock);\r\nreturn ret;\r\n}\r\nvoid target_stat_setup_port_default_groups(struct se_lun *lun)\r\n{\r\nstruct config_group *port_stat_grp = &lun->port_stat_grps.stat_group;\r\nconfig_group_init_type_name(&lun->port_stat_grps.scsi_port_group,\r\n"scsi_port", &target_stat_scsi_port_cit);\r\nconfig_group_init_type_name(&lun->port_stat_grps.scsi_tgt_port_group,\r\n"scsi_tgt_port", &target_stat_scsi_tgt_port_cit);\r\nconfig_group_init_type_name(&lun->port_stat_grps.scsi_transport_group,\r\n"scsi_transport", &target_stat_scsi_transport_cit);\r\nport_stat_grp->default_groups[0] = &lun->port_stat_grps.scsi_port_group;\r\nport_stat_grp->default_groups[1] = &lun->port_stat_grps.scsi_tgt_port_group;\r\nport_stat_grp->default_groups[2] = &lun->port_stat_grps.scsi_transport_group;\r\nport_stat_grp->default_groups[3] = NULL;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_inst(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\ntpg->se_tpg_tfo->tpg_get_inst_index(tpg));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_dev(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_lun *lun;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nlun = deve->se_lun;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", lun->lun_se_dev->dev_index);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_port(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", tpg->se_tpg_tfo->tpg_get_tag(tpg));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_indx(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", nacl->acl_index);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_dev_or_port(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", 1);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_intr_name(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%s\n", nacl->initiatorname);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_map_indx(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", 0);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_att_count(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", deve->attach_count);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_num_cmds(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", deve->total_cmds);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_read_mbytes(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", (u32)(deve->read_bytes >> 20));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_write_mbytes(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", (u32)(deve->write_bytes >> 20));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_hs_num_cmds(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", 0);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_creation_time(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", (u32)(((u32)deve->creation_time -\r\nINITIAL_JIFFIES) * 100 / HZ));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_auth_intr_show_attr_row_status(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "Ready\n");\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_inst(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\ntpg->se_tpg_tfo->tpg_get_inst_index(tpg));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_dev(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_lun *lun;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nlun = deve->se_lun;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", lun->lun_se_dev->dev_index);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_port(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n", tpg->se_tpg_tfo->tpg_get_tag(tpg));\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_indx(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_session *se_sess;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->nacl_sess_lock);\r\nse_sess = nacl->nacl_sess;\r\nif (!se_sess) {\r\nspin_unlock_irq(&nacl->nacl_sess_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nret = snprintf(page, PAGE_SIZE, "%u\n",\r\ntpg->se_tpg_tfo->sess_get_index(se_sess));\r\nspin_unlock_irq(&nacl->nacl_sess_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_port_auth_indx(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_dev_entry *deve;\r\nssize_t ret;\r\nspin_lock_irq(&nacl->device_list_lock);\r\ndeve = nacl->device_list[lacl->mapped_lun];\r\nif (!deve->se_lun || !deve->se_lun_acl) {\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn -ENODEV;\r\n}\r\nret = snprintf(page, PAGE_SIZE, "%u\n", nacl->acl_index);\r\nspin_unlock_irq(&nacl->device_list_lock);\r\nreturn ret;\r\n}\r\nstatic ssize_t target_stat_scsi_att_intr_port_show_attr_port_ident(\r\nstruct se_ml_stat_grps *lgrps, char *page)\r\n{\r\nstruct se_lun_acl *lacl = container_of(lgrps,\r\nstruct se_lun_acl, ml_stat_grps);\r\nstruct se_node_acl *nacl = lacl->se_lun_nacl;\r\nstruct se_session *se_sess;\r\nstruct se_portal_group *tpg;\r\nssize_t ret;\r\nunsigned char buf[64];\r\nspin_lock_irq(&nacl->nacl_sess_lock);\r\nse_sess = nacl->nacl_sess;\r\nif (!se_sess) {\r\nspin_unlock_irq(&nacl->nacl_sess_lock);\r\nreturn -ENODEV;\r\n}\r\ntpg = nacl->se_tpg;\r\nmemset(buf, 0, 64);\r\nif (tpg->se_tpg_tfo->sess_get_initiator_sid != NULL)\r\ntpg->se_tpg_tfo->sess_get_initiator_sid(se_sess, buf, 64);\r\nret = snprintf(page, PAGE_SIZE, "%s+i+%s\n", nacl->initiatorname, buf);\r\nspin_unlock_irq(&nacl->nacl_sess_lock);\r\nreturn ret;\r\n}\r\nvoid target_stat_setup_mappedlun_default_groups(struct se_lun_acl *lacl)\r\n{\r\nstruct config_group *ml_stat_grp = &lacl->ml_stat_grps.stat_group;\r\nconfig_group_init_type_name(&lacl->ml_stat_grps.scsi_auth_intr_group,\r\n"scsi_auth_intr", &target_stat_scsi_auth_intr_cit);\r\nconfig_group_init_type_name(&lacl->ml_stat_grps.scsi_att_intr_port_group,\r\n"scsi_att_intr_port", &target_stat_scsi_att_intr_port_cit);\r\nml_stat_grp->default_groups[0] = &lacl->ml_stat_grps.scsi_auth_intr_group;\r\nml_stat_grp->default_groups[1] = &lacl->ml_stat_grps.scsi_att_intr_port_group;\r\nml_stat_grp->default_groups[2] = NULL;\r\n}
