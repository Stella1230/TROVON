static void aztech_set_pins(void *handle, u8 pins)\r\n{\r\nstruct radio_isa_card *isa = handle;\r\nstruct aztech *az = container_of(isa, struct aztech, isa);\r\nu8 bits = az->curvol;\r\nif (pins & LM7000_DATA)\r\nbits |= AZTECH_BIT_TUN_DATA;\r\nif (pins & LM7000_CLK)\r\nbits |= AZTECH_BIT_TUN_CLK;\r\nif (pins & LM7000_CE)\r\nbits |= AZTECH_BIT_TUN_CE;\r\noutb_p(bits, az->isa.io);\r\n}\r\nstatic struct radio_isa_card *aztech_alloc(void)\r\n{\r\nstruct aztech *az = kzalloc(sizeof(*az), GFP_KERNEL);\r\nreturn az ? &az->isa : NULL;\r\n}\r\nstatic int aztech_s_frequency(struct radio_isa_card *isa, u32 freq)\r\n{\r\nlm7000_set_freq(freq, isa, aztech_set_pins);\r\nreturn 0;\r\n}\r\nstatic u32 aztech_g_rxsubchans(struct radio_isa_card *isa)\r\n{\r\nif (inb(isa->io) & AZTECH_BIT_MONO)\r\nreturn V4L2_TUNER_SUB_MONO;\r\nreturn V4L2_TUNER_SUB_STEREO;\r\n}\r\nstatic u32 aztech_g_signal(struct radio_isa_card *isa)\r\n{\r\nreturn (inb(isa->io) & AZTECH_BIT_NOT_TUNED) ? 0 : 0xffff;\r\n}\r\nstatic int aztech_s_mute_volume(struct radio_isa_card *isa, bool mute, int vol)\r\n{\r\nstruct aztech *az = container_of(isa, struct aztech, isa);\r\nif (mute)\r\nvol = 0;\r\naz->curvol = (vol & 1) + ((vol & 2) << 1);\r\noutb(az->curvol, isa->io);\r\nreturn 0;\r\n}\r\nstatic int __init aztech_init(void)\r\n{\r\nreturn isa_register_driver(&aztech_driver.driver, AZTECH_MAX);\r\n}\r\nstatic void __exit aztech_exit(void)\r\n{\r\nisa_unregister_driver(&aztech_driver.driver);\r\n}
