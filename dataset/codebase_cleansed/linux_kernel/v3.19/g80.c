static u32\r\ng80_fuse_rd32(struct nouveau_object *object, u64 addr)\r\n{\r\nstruct g80_fuse_priv *priv = (void *)object;\r\nunsigned long flags;\r\nu32 fuse_enable, val;\r\nspin_lock_irqsave(&priv->fuse_enable_lock, flags);\r\nfuse_enable = nv_mask(priv, 0x1084, 0x800, 0x800);\r\nval = nv_rd32(priv, 0x21000 + addr);\r\nnv_wr32(priv, 0x1084, fuse_enable);\r\nspin_unlock_irqrestore(&priv->fuse_enable_lock, flags);\r\nreturn val;\r\n}\r\nstatic int\r\ng80_fuse_ctor(struct nouveau_object *parent, struct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct g80_fuse_priv *priv;\r\nint ret;\r\nret = nouveau_fuse_create(parent, engine, oclass, &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\nspin_lock_init(&priv->fuse_enable_lock);\r\nreturn 0;\r\n}
