static inline u8 lm3533_ctrlbank_get_reg(struct lm3533_ctrlbank *cb, u8 base)\r\n{\r\nreturn base + cb->id;\r\n}\r\nint lm3533_ctrlbank_enable(struct lm3533_ctrlbank *cb)\r\n{\r\nu8 mask;\r\nint ret;\r\ndev_dbg(cb->dev, "%s - %d\n", __func__, cb->id);\r\nmask = 1 << cb->id;\r\nret = lm3533_update(cb->lm3533, LM3533_REG_CTRLBANK_ENABLE,\r\nmask, mask);\r\nif (ret)\r\ndev_err(cb->dev, "failed to enable ctrlbank %d\n", cb->id);\r\nreturn ret;\r\n}\r\nint lm3533_ctrlbank_disable(struct lm3533_ctrlbank *cb)\r\n{\r\nu8 mask;\r\nint ret;\r\ndev_dbg(cb->dev, "%s - %d\n", __func__, cb->id);\r\nmask = 1 << cb->id;\r\nret = lm3533_update(cb->lm3533, LM3533_REG_CTRLBANK_ENABLE, 0, mask);\r\nif (ret)\r\ndev_err(cb->dev, "failed to disable ctrlbank %d\n", cb->id);\r\nreturn ret;\r\n}\r\nint lm3533_ctrlbank_set_max_current(struct lm3533_ctrlbank *cb, u16 imax)\r\n{\r\nu8 reg;\r\nu8 val;\r\nint ret;\r\nif (imax < LM3533_MAX_CURRENT_MIN || imax > LM3533_MAX_CURRENT_MAX)\r\nreturn -EINVAL;\r\nval = (imax - LM3533_MAX_CURRENT_MIN) / LM3533_MAX_CURRENT_STEP;\r\nreg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_MAX_CURRENT_BASE);\r\nret = lm3533_write(cb->lm3533, reg, val);\r\nif (ret)\r\ndev_err(cb->dev, "failed to set max current\n");\r\nreturn ret;\r\n}
