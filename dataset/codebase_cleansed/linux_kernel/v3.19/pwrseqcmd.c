u8 rtl88eu_pwrseqcmdparsing(struct adapter *padapter, u8 cut_vers, u8 fab_vers,\r\nu8 ifacetype, struct wl_pwr_cfg pwrseqcmd[])\r\n{\r\nstruct wl_pwr_cfg pwrcfgcmd = {0};\r\nu8 poll_bit = false;\r\nu32 aryidx = 0;\r\nu8 value = 0;\r\nu32 offset = 0;\r\nu32 poll_count = 0;\r\nu32 max_poll_count = 5000;\r\ndo {\r\npwrcfgcmd = pwrseqcmd[aryidx];\r\nRT_TRACE(_module_hal_init_c_ , _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: offset(%#x) cut_msk(%#x)"\r\n"fab_msk(%#x) interface_msk(%#x) base(%#x) cmd(%#x)"\r\n"msk(%#x) value(%#x)\n",\r\nGET_PWR_CFG_OFFSET(pwrcfgcmd),\r\nGET_PWR_CFG_CUT_MASK(pwrcfgcmd),\r\nGET_PWR_CFG_FAB_MASK(pwrcfgcmd),\r\nGET_PWR_CFG_INTF_MASK(pwrcfgcmd),\r\nGET_PWR_CFG_BASE(pwrcfgcmd),\r\nGET_PWR_CFG_CMD(pwrcfgcmd),\r\nGET_PWR_CFG_MASK(pwrcfgcmd),\r\nGET_PWR_CFG_VALUE(pwrcfgcmd)));\r\nif ((GET_PWR_CFG_FAB_MASK(pwrcfgcmd) & fab_vers) &&\r\n(GET_PWR_CFG_CUT_MASK(pwrcfgcmd) & cut_vers) &&\r\n(GET_PWR_CFG_INTF_MASK(pwrcfgcmd) & ifacetype)) {\r\nswitch (GET_PWR_CFG_CMD(pwrcfgcmd)) {\r\ncase PWR_CMD_READ:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: PWR_CMD_READ\n"));\r\nbreak;\r\ncase PWR_CMD_WRITE:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: PWR_CMD_WRITE\n"));\r\noffset = GET_PWR_CFG_OFFSET(pwrcfgcmd);\r\nvalue = usb_read8(padapter, offset);\r\nvalue &= ~(GET_PWR_CFG_MASK(pwrcfgcmd));\r\nvalue |= (GET_PWR_CFG_VALUE(pwrcfgcmd) &\r\nGET_PWR_CFG_MASK(pwrcfgcmd));\r\nusb_write8(padapter, offset, value);\r\nbreak;\r\ncase PWR_CMD_POLLING:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: PWR_CMD_POLLING\n"));\r\npoll_bit = false;\r\noffset = GET_PWR_CFG_OFFSET(pwrcfgcmd);\r\ndo {\r\nvalue = usb_read8(padapter, offset);\r\nvalue &= GET_PWR_CFG_MASK(pwrcfgcmd);\r\nif (value == (GET_PWR_CFG_VALUE(pwrcfgcmd) &\r\nGET_PWR_CFG_MASK(pwrcfgcmd)))\r\npoll_bit = true;\r\nelse\r\nudelay(10);\r\nif (poll_count++ > max_poll_count) {\r\nDBG_88E("Fail to polling Offset[%#x]\n", offset);\r\nreturn false;\r\n}\r\n} while (!poll_bit);\r\nbreak;\r\ncase PWR_CMD_DELAY:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: PWR_CMD_DELAY\n"));\r\nif (GET_PWR_CFG_VALUE(pwrcfgcmd) == PWRSEQ_DELAY_US)\r\nudelay(GET_PWR_CFG_OFFSET(pwrcfgcmd));\r\nelse\r\nudelay(GET_PWR_CFG_OFFSET(pwrcfgcmd)*1000);\r\nbreak;\r\ncase PWR_CMD_END:\r\nRT_TRACE(_module_hal_init_c_, _drv_info_,\r\n("rtl88eu_pwrseqcmdparsing: PWR_CMD_END\n"));\r\nreturn true;\r\nbreak;\r\ndefault:\r\nRT_TRACE(_module_hal_init_c_, _drv_err_,\r\n("rtl88eu_pwrseqcmdparsing: Unknown CMD!!\n"));\r\nbreak;\r\n}\r\n}\r\naryidx++;\r\n} while (1);\r\nreturn true;\r\n}
