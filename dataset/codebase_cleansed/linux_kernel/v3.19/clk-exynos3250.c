static int exynos3250_clk_suspend(void)\r\n{\r\nsamsung_clk_save(reg_base, exynos3250_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_clk_regs));\r\nreturn 0;\r\n}\r\nstatic void exynos3250_clk_resume(void)\r\n{\r\nsamsung_clk_restore(reg_base, exynos3250_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_clk_regs));\r\n}\r\nstatic void exynos3250_clk_sleep_init(void)\r\n{\r\nexynos3250_clk_regs =\r\nsamsung_clk_alloc_reg_dump(exynos3250_cmu_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_clk_regs));\r\nif (!exynos3250_clk_regs) {\r\npr_warn("%s: Failed to allocate sleep save data\n", __func__);\r\ngoto err;\r\n}\r\nregister_syscore_ops(&exynos3250_clk_syscore_ops);\r\nreturn;\r\nerr:\r\nkfree(exynos3250_clk_regs);\r\n}\r\nstatic inline void exynos3250_clk_sleep_init(void) { }\r\nstatic void __init exynos3_core_down_clock(void)\r\n{\r\nunsigned int tmp;\r\ntmp = (PWR_CTRL1_CORE2_DOWN_RATIO(7) | PWR_CTRL1_CORE1_DOWN_RATIO(7) |\r\nPWR_CTRL1_DIV2_DOWN_EN | PWR_CTRL1_DIV1_DOWN_EN |\r\nPWR_CTRL1_USE_CORE1_WFE | PWR_CTRL1_USE_CORE0_WFE |\r\nPWR_CTRL1_USE_CORE1_WFI | PWR_CTRL1_USE_CORE0_WFI);\r\n__raw_writel(tmp, reg_base + PWR_CTRL1);\r\n__raw_writel(0x0, reg_base + PWR_CTRL2);\r\n}\r\nstatic void __init exynos3250_cmu_init(struct device_node *np)\r\n{\r\nstruct samsung_clk_provider *ctx;\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base)\r\npanic("%s: failed to map registers\n", __func__);\r\nctx = samsung_clk_init(np, reg_base, CLK_NR_CLKS);\r\nif (!ctx)\r\npanic("%s: unable to allocate context.\n", __func__);\r\nsamsung_clk_register_fixed_factor(ctx, fixed_factor_clks,\r\nARRAY_SIZE(fixed_factor_clks));\r\nexynos3250_plls[apll].rate_table = exynos3250_pll_rates;\r\nexynos3250_plls[mpll].rate_table = exynos3250_pll_rates;\r\nexynos3250_plls[vpll].rate_table = exynos3250_vpll_rates;\r\nexynos3250_plls[upll].rate_table = exynos3250_pll_rates;\r\nsamsung_clk_register_pll(ctx, exynos3250_plls,\r\nARRAY_SIZE(exynos3250_plls), reg_base);\r\nsamsung_clk_register_mux(ctx, mux_clks, ARRAY_SIZE(mux_clks));\r\nsamsung_clk_register_div(ctx, div_clks, ARRAY_SIZE(div_clks));\r\nsamsung_clk_register_gate(ctx, gate_clks, ARRAY_SIZE(gate_clks));\r\nexynos3_core_down_clock();\r\nexynos3250_clk_sleep_init();\r\nsamsung_clk_of_add_provider(np, ctx);\r\n}\r\nstatic int exynos3250_dmc_clk_suspend(void)\r\n{\r\nsamsung_clk_save(dmc_reg_base, exynos3250_dmc_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_dmc_clk_regs));\r\nreturn 0;\r\n}\r\nstatic void exynos3250_dmc_clk_resume(void)\r\n{\r\nsamsung_clk_restore(dmc_reg_base, exynos3250_dmc_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_dmc_clk_regs));\r\n}\r\nstatic void exynos3250_dmc_clk_sleep_init(void)\r\n{\r\nexynos3250_dmc_clk_regs =\r\nsamsung_clk_alloc_reg_dump(exynos3250_cmu_dmc_clk_regs,\r\nARRAY_SIZE(exynos3250_cmu_dmc_clk_regs));\r\nif (!exynos3250_dmc_clk_regs) {\r\npr_warn("%s: Failed to allocate sleep save data\n", __func__);\r\ngoto err;\r\n}\r\nregister_syscore_ops(&exynos3250_dmc_clk_syscore_ops);\r\nreturn;\r\nerr:\r\nkfree(exynos3250_dmc_clk_regs);\r\n}\r\nstatic inline void exynos3250_dmc_clk_sleep_init(void) { }\r\nstatic void __init exynos3250_cmu_dmc_init(struct device_node *np)\r\n{\r\nstruct samsung_clk_provider *ctx;\r\ndmc_reg_base = of_iomap(np, 0);\r\nif (!dmc_reg_base)\r\npanic("%s: failed to map registers\n", __func__);\r\nctx = samsung_clk_init(np, dmc_reg_base, NR_CLKS_DMC);\r\nif (!ctx)\r\npanic("%s: unable to allocate context.\n", __func__);\r\nexynos3250_dmc_plls[bpll].rate_table = exynos3250_pll_rates;\r\nexynos3250_dmc_plls[epll].rate_table = exynos3250_epll_rates;\r\npr_err("CLK registering epll bpll: %d, %d, %d, %d\n",\r\nexynos3250_dmc_plls[bpll].rate_table[0].rate,\r\nexynos3250_dmc_plls[bpll].rate_table[0].mdiv,\r\nexynos3250_dmc_plls[bpll].rate_table[0].pdiv,\r\nexynos3250_dmc_plls[bpll].rate_table[0].sdiv\r\n);\r\nsamsung_clk_register_pll(ctx, exynos3250_dmc_plls,\r\nARRAY_SIZE(exynos3250_dmc_plls), dmc_reg_base);\r\nsamsung_clk_register_mux(ctx, dmc_mux_clks, ARRAY_SIZE(dmc_mux_clks));\r\nsamsung_clk_register_div(ctx, dmc_div_clks, ARRAY_SIZE(dmc_div_clks));\r\nexynos3250_dmc_clk_sleep_init();\r\nsamsung_clk_of_add_provider(np, ctx);\r\n}
