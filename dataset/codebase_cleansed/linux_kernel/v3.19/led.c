static void _rtl8723be_init_led(struct ieee80211_hw *hw, struct rtl_led *pled,\r\nenum rtl_led_pin ledpin)\r\n{\r\npled->hw = hw;\r\npled->ledpin = ledpin;\r\npled->ledon = false;\r\n}\r\nvoid rtl8723be_sw_led_on(struct ieee80211_hw *hw, struct rtl_led *pled)\r\n{\r\nu8 ledcfg;\r\nstruct rtl_priv *rtlpriv = rtl_priv(hw);\r\nRT_TRACE(rtlpriv, COMP_LED, DBG_LOUD,\r\n"LedAddr:%X ledpin=%d\n", REG_LEDCFG2, pled->ledpin);\r\nswitch (pled->ledpin) {\r\ncase LED_PIN_GPIO0:\r\nbreak;\r\ncase LED_PIN_LED0:\r\nledcfg = rtl_read_byte(rtlpriv, REG_LEDCFG2);\r\nledcfg &= ~BIT(6);\r\nrtl_write_byte(rtlpriv, REG_LEDCFG2, (ledcfg & 0xf0) | BIT(5));\r\nbreak;\r\ncase LED_PIN_LED1:\r\nledcfg = rtl_read_byte(rtlpriv, REG_LEDCFG1);\r\nrtl_write_byte(rtlpriv, REG_LEDCFG1, ledcfg & 0x10);\r\nbreak;\r\ndefault:\r\nRT_TRACE(rtlpriv, COMP_ERR, DBG_EMERG,\r\n"switch case not process\n");\r\nbreak;\r\n}\r\npled->ledon = true;\r\n}\r\nvoid rtl8723be_sw_led_off(struct ieee80211_hw *hw, struct rtl_led *pled)\r\n{\r\nstruct rtl_priv *rtlpriv = rtl_priv(hw);\r\nstruct rtl_pci_priv *pcipriv = rtl_pcipriv(hw);\r\nu8 ledcfg;\r\nRT_TRACE(rtlpriv, COMP_LED, DBG_LOUD,\r\n"LedAddr:%X ledpin=%d\n", REG_LEDCFG2, pled->ledpin);\r\nledcfg = rtl_read_byte(rtlpriv, REG_LEDCFG2);\r\nswitch (pled->ledpin) {\r\ncase LED_PIN_GPIO0:\r\nbreak;\r\ncase LED_PIN_LED0:\r\nledcfg &= 0xf0;\r\nif (pcipriv->ledctl.led_opendrain) {\r\nledcfg &= 0x90;\r\nrtl_write_byte(rtlpriv, REG_LEDCFG2, (ledcfg|BIT(3)));\r\nledcfg = rtl_read_byte(rtlpriv, REG_MAC_PINMUX_CFG);\r\nledcfg &= 0xFE;\r\nrtl_write_byte(rtlpriv, REG_MAC_PINMUX_CFG, ledcfg);\r\n} else {\r\nledcfg &= ~BIT(6);\r\nrtl_write_byte(rtlpriv, REG_LEDCFG2,\r\n(ledcfg | BIT(3) | BIT(5)));\r\n}\r\nbreak;\r\ncase LED_PIN_LED1:\r\nledcfg = rtl_read_byte(rtlpriv, REG_LEDCFG1);\r\nledcfg &= 0x10;\r\nrtl_write_byte(rtlpriv, REG_LEDCFG1, ledcfg|BIT(3));\r\nbreak;\r\ndefault:\r\nRT_TRACE(rtlpriv, COMP_ERR, DBG_EMERG,\r\n"switch case not process\n");\r\nbreak;\r\n}\r\npled->ledon = false;\r\n}\r\nvoid rtl8723be_init_sw_leds(struct ieee80211_hw *hw)\r\n{\r\nstruct rtl_pci_priv *pcipriv = rtl_pcipriv(hw);\r\n_rtl8723be_init_led(hw, &(pcipriv->ledctl.sw_led0), LED_PIN_LED0);\r\n_rtl8723be_init_led(hw, &(pcipriv->ledctl.sw_led1), LED_PIN_LED1);\r\n}\r\nstatic void _rtl8723be_sw_led_control(struct ieee80211_hw *hw,\r\nenum led_ctl_mode ledaction)\r\n{\r\nstruct rtl_pci_priv *pcipriv = rtl_pcipriv(hw);\r\nstruct rtl_led *pled0 = &(pcipriv->ledctl.sw_led0);\r\nswitch (ledaction) {\r\ncase LED_CTL_POWER_ON:\r\ncase LED_CTL_LINK:\r\ncase LED_CTL_NO_LINK:\r\nrtl8723be_sw_led_on(hw, pled0);\r\nbreak;\r\ncase LED_CTL_POWER_OFF:\r\nrtl8723be_sw_led_off(hw, pled0);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nvoid rtl8723be_led_control(struct ieee80211_hw *hw,\r\nenum led_ctl_mode ledaction)\r\n{\r\nstruct rtl_priv *rtlpriv = rtl_priv(hw);\r\nstruct rtl_ps_ctl *ppsc = rtl_psc(rtl_priv(hw));\r\nif ((ppsc->rfoff_reason > RF_CHANGE_BY_PS) &&\r\n(ledaction == LED_CTL_TX ||\r\nledaction == LED_CTL_RX ||\r\nledaction == LED_CTL_SITE_SURVEY ||\r\nledaction == LED_CTL_LINK ||\r\nledaction == LED_CTL_NO_LINK ||\r\nledaction == LED_CTL_START_TO_LINK ||\r\nledaction == LED_CTL_POWER_ON)) {\r\nreturn;\r\n}\r\nRT_TRACE(rtlpriv, COMP_LED, DBG_LOUD, "ledaction %d,\n", ledaction);\r\n_rtl8723be_sw_led_control(hw, ledaction);\r\n}
