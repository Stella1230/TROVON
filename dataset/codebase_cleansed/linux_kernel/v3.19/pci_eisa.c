static int __init pci_eisa_init(struct pci_dev *pdev)\r\n{\r\nint rc, i;\r\nstruct resource *res, *bus_res = NULL;\r\nif ((rc = pci_enable_device (pdev))) {\r\ndev_err(&pdev->dev, "Could not enable device\n");\r\nreturn rc;\r\n}\r\npci_bus_for_each_resource(pdev->bus, res, i)\r\nif (res && (res->flags & IORESOURCE_IO)) {\r\nbus_res = res;\r\nbreak;\r\n}\r\nif (!bus_res) {\r\ndev_err(&pdev->dev, "No resources available\n");\r\nreturn -1;\r\n}\r\npci_eisa_root.dev = &pdev->dev;\r\npci_eisa_root.res = bus_res;\r\npci_eisa_root.bus_base_addr = bus_res->start;\r\npci_eisa_root.slots = EISA_MAX_SLOTS;\r\npci_eisa_root.dma_mask = pdev->dma_mask;\r\ndev_set_drvdata(pci_eisa_root.dev, &pci_eisa_root);\r\nif (eisa_root_register (&pci_eisa_root)) {\r\ndev_err(&pdev->dev, "Could not register EISA root\n");\r\nreturn -1;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init pci_eisa_init_early(void)\r\n{\r\nstruct pci_dev *dev = NULL;\r\nint ret;\r\nfor_each_pci_dev(dev)\r\nif ((dev->class >> 8) == PCI_CLASS_BRIDGE_EISA) {\r\nret = pci_eisa_init(dev);\r\nif (ret)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
