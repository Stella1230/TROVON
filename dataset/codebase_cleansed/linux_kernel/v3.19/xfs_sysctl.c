STATIC int\r\nxfs_stats_clear_proc_handler(\r\nstruct ctl_table *ctl,\r\nint write,\r\nvoid __user *buffer,\r\nsize_t *lenp,\r\nloff_t *ppos)\r\n{\r\nint c, ret, *valp = ctl->data;\r\n__uint32_t vn_active;\r\nret = proc_dointvec_minmax(ctl, write, buffer, lenp, ppos);\r\nif (!ret && write && *valp) {\r\nxfs_notice(NULL, "Clearing xfsstats");\r\nfor_each_possible_cpu(c) {\r\npreempt_disable();\r\nvn_active = per_cpu(xfsstats, c).vn_active;\r\nmemset(&per_cpu(xfsstats, c), 0,\r\nsizeof(struct xfsstats));\r\nper_cpu(xfsstats, c).vn_active = vn_active;\r\npreempt_enable();\r\n}\r\nxfs_stats_clear = 0;\r\n}\r\nreturn ret;\r\n}\r\nSTATIC int\r\nxfs_panic_mask_proc_handler(\r\nstruct ctl_table *ctl,\r\nint write,\r\nvoid __user *buffer,\r\nsize_t *lenp,\r\nloff_t *ppos)\r\n{\r\nint ret, *valp = ctl->data;\r\nret = proc_dointvec_minmax(ctl, write, buffer, lenp, ppos);\r\nif (!ret && write) {\r\nxfs_panic_mask = *valp;\r\n#ifdef DEBUG\r\nxfs_panic_mask |= (XFS_PTAG_SHUTDOWN_CORRUPT | XFS_PTAG_LOGRES);\r\n#endif\r\n}\r\nreturn ret;\r\n}\r\nint\r\nxfs_sysctl_register(void)\r\n{\r\nxfs_table_header = register_sysctl_table(xfs_root_table);\r\nif (!xfs_table_header)\r\nreturn -ENOMEM;\r\nreturn 0;\r\n}\r\nvoid\r\nxfs_sysctl_unregister(void)\r\n{\r\nunregister_sysctl_table(xfs_table_header);\r\n}
