static void dummy_timer_set_mode(enum clock_event_mode mode,\r\nstruct clock_event_device *evt)\r\n{\r\n}\r\nstatic void dummy_timer_setup(void)\r\n{\r\nint cpu = smp_processor_id();\r\nstruct clock_event_device *evt = raw_cpu_ptr(&dummy_timer_evt);\r\nevt->name = "dummy_timer";\r\nevt->features = CLOCK_EVT_FEAT_PERIODIC |\r\nCLOCK_EVT_FEAT_ONESHOT |\r\nCLOCK_EVT_FEAT_DUMMY;\r\nevt->rating = 100;\r\nevt->set_mode = dummy_timer_set_mode;\r\nevt->cpumask = cpumask_of(cpu);\r\nclockevents_register_device(evt);\r\n}\r\nstatic int dummy_timer_cpu_notify(struct notifier_block *self,\r\nunsigned long action, void *hcpu)\r\n{\r\nif ((action & ~CPU_TASKS_FROZEN) == CPU_STARTING)\r\ndummy_timer_setup();\r\nreturn NOTIFY_OK;\r\n}\r\nstatic int __init dummy_timer_register(void)\r\n{\r\nint err = 0;\r\ncpu_notifier_register_begin();\r\nerr = __register_cpu_notifier(&dummy_timer_cpu_nb);\r\nif (err)\r\ngoto out;\r\nif (num_possible_cpus() > 1)\r\ndummy_timer_setup();\r\nout:\r\ncpu_notifier_register_done();\r\nreturn err;\r\n}
