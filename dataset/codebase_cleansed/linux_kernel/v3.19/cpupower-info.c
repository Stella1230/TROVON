static void print_wrong_arg_exit(void)\r\n{\r\nprintf(_("invalid or unknown argument\n"));\r\nexit(EXIT_FAILURE);\r\n}\r\nint cmd_info(int argc, char **argv)\r\n{\r\nextern char *optarg;\r\nextern int optind, opterr, optopt;\r\nunsigned int cpu;\r\nunion {\r\nstruct {\r\nint perf_bias:1;\r\n};\r\nint params;\r\n} params = {};\r\nint ret = 0;\r\nsetlocale(LC_ALL, "");\r\ntextdomain(PACKAGE);\r\nwhile ((ret = getopt_long(argc, argv, "b", set_opts, NULL)) != -1) {\r\nswitch (ret) {\r\ncase 'b':\r\nif (params.perf_bias)\r\nprint_wrong_arg_exit();\r\nparams.perf_bias = 1;\r\nbreak;\r\ndefault:\r\nprint_wrong_arg_exit();\r\n}\r\n};\r\nif (!params.params)\r\nparams.params = 0x7;\r\nif (bitmask_isallclear(cpus_chosen))\r\nbitmask_setbit(cpus_chosen, 0);\r\nif (!params.perf_bias)\r\nreturn ret;\r\nif (params.perf_bias) {\r\nif (!run_as_root) {\r\nparams.perf_bias = 0;\r\nprintf(_("Intel's performance bias setting needs root privileges\n"));\r\n} else if (!(cpupower_cpu_info.caps & CPUPOWER_CAP_PERF_BIAS)) {\r\nprintf(_("System does not support Intel's performance"\r\n" bias setting\n"));\r\nparams.perf_bias = 0;\r\n}\r\n}\r\nfor (cpu = bitmask_first(cpus_chosen);\r\ncpu <= bitmask_last(cpus_chosen); cpu++) {\r\nif (!bitmask_isbitset(cpus_chosen, cpu) ||\r\ncpufreq_cpu_exists(cpu))\r\ncontinue;\r\nprintf(_("analyzing CPU %d:\n"), cpu);\r\nif (params.perf_bias) {\r\nret = msr_intel_get_perf_bias(cpu);\r\nif (ret < 0) {\r\nfprintf(stderr,\r\n_("Could not read perf-bias value[%d]\n"), ret);\r\nexit(EXIT_FAILURE);\r\n} else\r\nprintf(_("perf-bias: %d\n"), ret);\r\n}\r\n}\r\nreturn 0;\r\n}
