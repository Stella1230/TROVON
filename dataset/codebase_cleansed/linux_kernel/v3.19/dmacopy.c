void *dma_memcpy(void *pdst,\r\nconst void *psrc,\r\nunsigned int pn)\r\n{\r\nstatic etrax_dma_descr indma, outdma;\r\nD(printk(KERN_DEBUG "dma_memcpy %d bytes... ", pn));\r\n#if 0\r\n*R_GEN_CONFIG = genconfig_shadow =\r\n(genconfig_shadow & ~0x3c0000) |\r\nIO_STATE(R_GEN_CONFIG, dma6, intdma7) |\r\nIO_STATE(R_GEN_CONFIG, dma7, intdma6);\r\n#endif\r\nindma.sw_len = outdma.sw_len = pn;\r\nindma.ctrl = d_eol | d_eop;\r\noutdma.ctrl = d_eol;\r\nindma.buf = psrc;\r\noutdma.buf = pdst;\r\n*R_DMA_CH6_FIRST = &indma;\r\n*R_DMA_CH7_FIRST = &outdma;\r\n*R_DMA_CH6_CMD = IO_STATE(R_DMA_CH6_CMD, cmd, start);\r\n*R_DMA_CH7_CMD = IO_STATE(R_DMA_CH7_CMD, cmd, start);\r\nwhile (*R_DMA_CH7_CMD == 1)\r\n;\r\nD(printk(KERN_DEBUG "done\n"));\r\n}
