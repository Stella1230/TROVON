static void __init ar913x_wmac_setup(void)\r\n{\r\nath79_device_reset_set(AR913X_RESET_AMBA2WMAC);\r\nmdelay(10);\r\nath79_device_reset_clear(AR913X_RESET_AMBA2WMAC);\r\nmdelay(10);\r\nath79_wmac_resources[0].start = AR913X_WMAC_BASE;\r\nath79_wmac_resources[0].end = AR913X_WMAC_BASE + AR913X_WMAC_SIZE - 1;\r\nath79_wmac_resources[1].start = ATH79_CPU_IRQ(2);\r\nath79_wmac_resources[1].end = ATH79_CPU_IRQ(2);\r\n}\r\nstatic int ar933x_wmac_reset(void)\r\n{\r\nath79_device_reset_set(AR933X_RESET_WMAC);\r\nath79_device_reset_clear(AR933X_RESET_WMAC);\r\nreturn 0;\r\n}\r\nstatic int ar933x_r1_get_wmac_revision(void)\r\n{\r\nreturn ath79_soc_rev;\r\n}\r\nstatic void __init ar933x_wmac_setup(void)\r\n{\r\nu32 t;\r\nar933x_wmac_reset();\r\nath79_wmac_device.name = "ar933x_wmac";\r\nath79_wmac_resources[0].start = AR933X_WMAC_BASE;\r\nath79_wmac_resources[0].end = AR933X_WMAC_BASE + AR933X_WMAC_SIZE - 1;\r\nath79_wmac_resources[1].start = ATH79_CPU_IRQ(2);\r\nath79_wmac_resources[1].end = ATH79_CPU_IRQ(2);\r\nt = ath79_reset_rr(AR933X_RESET_REG_BOOTSTRAP);\r\nif (t & AR933X_BOOTSTRAP_REF_CLK_40)\r\nath79_wmac_data.is_clk_25mhz = false;\r\nelse\r\nath79_wmac_data.is_clk_25mhz = true;\r\nif (ath79_soc_rev == 1)\r\nath79_wmac_data.get_mac_revision = ar933x_r1_get_wmac_revision;\r\nath79_wmac_data.external_reset = ar933x_wmac_reset;\r\n}\r\nstatic void ar934x_wmac_setup(void)\r\n{\r\nu32 t;\r\nath79_wmac_device.name = "ar934x_wmac";\r\nath79_wmac_resources[0].start = AR934X_WMAC_BASE;\r\nath79_wmac_resources[0].end = AR934X_WMAC_BASE + AR934X_WMAC_SIZE - 1;\r\nath79_wmac_resources[1].start = ATH79_IP2_IRQ(1);\r\nath79_wmac_resources[1].end = ATH79_IP2_IRQ(1);\r\nt = ath79_reset_rr(AR934X_RESET_REG_BOOTSTRAP);\r\nif (t & AR934X_BOOTSTRAP_REF_CLK_40)\r\nath79_wmac_data.is_clk_25mhz = false;\r\nelse\r\nath79_wmac_data.is_clk_25mhz = true;\r\n}\r\nstatic void qca955x_wmac_setup(void)\r\n{\r\nu32 t;\r\nath79_wmac_device.name = "qca955x_wmac";\r\nath79_wmac_resources[0].start = QCA955X_WMAC_BASE;\r\nath79_wmac_resources[0].end = QCA955X_WMAC_BASE + QCA955X_WMAC_SIZE - 1;\r\nath79_wmac_resources[1].start = ATH79_IP2_IRQ(1);\r\nath79_wmac_resources[1].end = ATH79_IP2_IRQ(1);\r\nt = ath79_reset_rr(QCA955X_RESET_REG_BOOTSTRAP);\r\nif (t & QCA955X_BOOTSTRAP_REF_CLK_40)\r\nath79_wmac_data.is_clk_25mhz = false;\r\nelse\r\nath79_wmac_data.is_clk_25mhz = true;\r\n}\r\nvoid __init ath79_register_wmac(u8 *cal_data)\r\n{\r\nif (soc_is_ar913x())\r\nar913x_wmac_setup();\r\nelse if (soc_is_ar933x())\r\nar933x_wmac_setup();\r\nelse if (soc_is_ar934x())\r\nar934x_wmac_setup();\r\nelse if (soc_is_qca955x())\r\nqca955x_wmac_setup();\r\nelse\r\nBUG();\r\nif (cal_data)\r\nmemcpy(ath79_wmac_data.eeprom_data, cal_data,\r\nsizeof(ath79_wmac_data.eeprom_data));\r\nplatform_device_register(&ath79_wmac_device);\r\n}
