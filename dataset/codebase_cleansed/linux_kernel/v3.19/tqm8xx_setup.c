static void __init init_pins(int n, struct cpm_pin *pin)\r\n{\r\nint i;\r\nfor (i = 0; i < n; i++) {\r\ncpm1_set_pin(pin->port, pin->pin, pin->flags);\r\npin++;\r\n}\r\n}\r\nstatic void __init init_ioports(void)\r\n{\r\nstruct device_node *dnode;\r\nstruct property *prop;\r\nint len;\r\ninit_pins(ARRAY_SIZE(tqm8xx_pins), &tqm8xx_pins[0]);\r\ncpm1_clk_setup(CPM_CLK_SMC1, CPM_BRG1, CPM_CLK_RTX);\r\ndnode = of_find_node_by_name(NULL, "aliases");\r\nif (dnode == NULL)\r\nreturn;\r\nprop = of_find_property(dnode, "ethernet1", &len);\r\nif (prop == NULL)\r\nreturn;\r\ninit_pins(ARRAY_SIZE(tqm8xx_fec_pins), &tqm8xx_fec_pins[0]);\r\n}\r\nstatic void __init tqm8xx_setup_arch(void)\r\n{\r\ncpm_reset();\r\ninit_ioports();\r\n}\r\nstatic int __init tqm8xx_probe(void)\r\n{\r\nunsigned long node = of_get_flat_dt_root();\r\nreturn of_flat_dt_is_compatible(node, "tqc,tqm8xx");\r\n}\r\nstatic int __init declare_of_platform_devices(void)\r\n{\r\nof_platform_bus_probe(NULL, of_bus_ids, NULL);\r\nreturn 0;\r\n}
