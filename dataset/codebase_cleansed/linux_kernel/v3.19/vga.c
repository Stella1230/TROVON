void __init xen_init_vga(const struct dom0_vga_console_info *info, size_t size)\r\n{\r\nstruct screen_info *screen_info = &boot_params.screen_info;\r\nscreen_info->orig_video_mode = 3;\r\nscreen_info->orig_video_isVGA = 1;\r\nscreen_info->orig_video_lines = 25;\r\nscreen_info->orig_video_cols = 80;\r\nscreen_info->orig_video_ega_bx = 3;\r\nscreen_info->orig_video_points = 16;\r\nscreen_info->orig_y = screen_info->orig_video_lines - 1;\r\nswitch (info->video_type) {\r\ncase XEN_VGATYPE_TEXT_MODE_3:\r\nif (size < offsetof(struct dom0_vga_console_info, u.text_mode_3)\r\n+ sizeof(info->u.text_mode_3))\r\nbreak;\r\nscreen_info->orig_video_lines = info->u.text_mode_3.rows;\r\nscreen_info->orig_video_cols = info->u.text_mode_3.columns;\r\nscreen_info->orig_x = info->u.text_mode_3.cursor_x;\r\nscreen_info->orig_y = info->u.text_mode_3.cursor_y;\r\nscreen_info->orig_video_points =\r\ninfo->u.text_mode_3.font_height;\r\nbreak;\r\ncase XEN_VGATYPE_EFI_LFB:\r\ncase XEN_VGATYPE_VESA_LFB:\r\nif (size < offsetof(struct dom0_vga_console_info,\r\nu.vesa_lfb.gbl_caps))\r\nbreak;\r\nscreen_info->orig_video_isVGA = VIDEO_TYPE_VLFB;\r\nscreen_info->lfb_width = info->u.vesa_lfb.width;\r\nscreen_info->lfb_height = info->u.vesa_lfb.height;\r\nscreen_info->lfb_depth = info->u.vesa_lfb.bits_per_pixel;\r\nscreen_info->lfb_base = info->u.vesa_lfb.lfb_base;\r\nscreen_info->lfb_size = info->u.vesa_lfb.lfb_size;\r\nscreen_info->lfb_linelength = info->u.vesa_lfb.bytes_per_line;\r\nscreen_info->red_size = info->u.vesa_lfb.red_size;\r\nscreen_info->red_pos = info->u.vesa_lfb.red_pos;\r\nscreen_info->green_size = info->u.vesa_lfb.green_size;\r\nscreen_info->green_pos = info->u.vesa_lfb.green_pos;\r\nscreen_info->blue_size = info->u.vesa_lfb.blue_size;\r\nscreen_info->blue_pos = info->u.vesa_lfb.blue_pos;\r\nscreen_info->rsvd_size = info->u.vesa_lfb.rsvd_size;\r\nscreen_info->rsvd_pos = info->u.vesa_lfb.rsvd_pos;\r\nif (info->video_type == XEN_VGATYPE_EFI_LFB) {\r\nscreen_info->orig_video_isVGA = VIDEO_TYPE_EFI;\r\nbreak;\r\n}\r\nif (size >= offsetof(struct dom0_vga_console_info,\r\nu.vesa_lfb.gbl_caps)\r\n+ sizeof(info->u.vesa_lfb.gbl_caps))\r\nscreen_info->capabilities = info->u.vesa_lfb.gbl_caps;\r\nif (size >= offsetof(struct dom0_vga_console_info,\r\nu.vesa_lfb.mode_attrs)\r\n+ sizeof(info->u.vesa_lfb.mode_attrs))\r\nscreen_info->vesa_attributes = info->u.vesa_lfb.mode_attrs;\r\nbreak;\r\n}\r\n}
