static void versatile_reboot(enum reboot_mode mode, const char *cmd)\r\n{\r\nregmap_write(syscon_regmap, REALVIEW_SYS_LOCK_OFFSET,\r\nREALVIEW_SYS_LOCK_VAL);\r\nswitch (versatile_reboot_type) {\r\ncase REALVIEW_REBOOT_EB:\r\nregmap_write(syscon_regmap,\r\nREALVIEW_SYS_RESETCTL_OFFSET, 0x0008);\r\nbreak;\r\ncase REALVIEW_REBOOT_PB1176:\r\nregmap_write(syscon_regmap,\r\nREALVIEW_SYS_RESETCTL_OFFSET, 0x0100);\r\nbreak;\r\ncase REALVIEW_REBOOT_PB11MP:\r\ncase REALVIEW_REBOOT_PBA8:\r\nregmap_write(syscon_regmap, REALVIEW_SYS_RESETCTL_OFFSET,\r\n0x0000);\r\nregmap_write(syscon_regmap, REALVIEW_SYS_RESETCTL_OFFSET,\r\n0x0004);\r\nbreak;\r\ncase REALVIEW_REBOOT_PBX:\r\nregmap_write(syscon_regmap, REALVIEW_SYS_RESETCTL_OFFSET,\r\n0x00f0);\r\nregmap_write(syscon_regmap, REALVIEW_SYS_RESETCTL_OFFSET,\r\n0x00f4);\r\nbreak;\r\n}\r\ndsb();\r\n}\r\nstatic int __init versatile_reboot_probe(void)\r\n{\r\nconst struct of_device_id *reboot_id;\r\nstruct device_node *np;\r\nnp = of_find_matching_node_and_match(NULL, versatile_reboot_of_match,\r\n&reboot_id);\r\nif (!np)\r\nreturn -ENODEV;\r\nversatile_reboot_type = (enum versatile_reboot)reboot_id->data;\r\nsyscon_regmap = syscon_node_to_regmap(np);\r\nif (IS_ERR(syscon_regmap))\r\nreturn PTR_ERR(syscon_regmap);\r\narm_pm_restart = versatile_reboot;\r\npr_info("versatile reboot driver registered\n");\r\nreturn 0;\r\n}
