static irqreturn_t psw_irq_handler(int irq, void *arg)\r\n{\r\nstruct platform_device *pdev = arg;\r\nstruct push_switch *psw = platform_get_drvdata(pdev);\r\nstruct push_switch_platform_info *psw_info = pdev->dev.platform_data;\r\nunsigned int l, mask;\r\nint ret = 0;\r\nl = __raw_readw(PA_DBSW);\r\nif (psw->state) {\r\nret = 1;\r\ngoto out;\r\n}\r\nmask = l & 0x70;\r\nif (mask & (1 << psw_info->bit)) {\r\npsw->state = !!(mask & (1 << psw_info->bit));\r\nif (psw->state)\r\nmod_timer(&psw->debounce, jiffies + 50);\r\nret = 1;\r\n}\r\nout:\r\nl |= (0x7 << 12);\r\n__raw_writew(l, PA_DBSW);\r\nreturn IRQ_RETVAL(ret);\r\n}\r\nstatic int __init psw_init(void)\r\n{\r\nreturn platform_add_devices(psw_devices, ARRAY_SIZE(psw_devices));\r\n}
