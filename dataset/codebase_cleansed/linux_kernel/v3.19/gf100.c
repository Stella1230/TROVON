static u32\r\ngf100_fuse_rd32(struct nouveau_object *object, u64 addr)\r\n{\r\nstruct gf100_fuse_priv *priv = (void *)object;\r\nunsigned long flags;\r\nu32 fuse_enable, unk, val;\r\nspin_lock_irqsave(&priv->fuse_enable_lock, flags);\r\nfuse_enable = nv_mask(priv, 0x22400, 0x800, 0x800);\r\nunk = nv_mask(priv, 0x21000, 0x1, 0x1);\r\nval = nv_rd32(priv, 0x21100 + addr);\r\nnv_wr32(priv, 0x21000, unk);\r\nnv_wr32(priv, 0x22400, fuse_enable);\r\nspin_unlock_irqrestore(&priv->fuse_enable_lock, flags);\r\nreturn val;\r\n}\r\nstatic int\r\ngf100_fuse_ctor(struct nouveau_object *parent, struct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct gf100_fuse_priv *priv;\r\nint ret;\r\nret = nouveau_fuse_create(parent, engine, oclass, &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\nspin_lock_init(&priv->fuse_enable_lock);\r\nreturn 0;\r\n}
