int mlx5_core_alloc_pd(struct mlx5_core_dev *dev, u32 *pdn)\r\n{\r\nstruct mlx5_alloc_pd_mbox_in in;\r\nstruct mlx5_alloc_pd_mbox_out out;\r\nint err;\r\nmemset(&in, 0, sizeof(in));\r\nmemset(&out, 0, sizeof(out));\r\nin.hdr.opcode = cpu_to_be16(MLX5_CMD_OP_ALLOC_PD);\r\nerr = mlx5_cmd_exec(dev, &in, sizeof(in), &out, sizeof(out));\r\nif (err)\r\nreturn err;\r\nif (out.hdr.status)\r\nreturn mlx5_cmd_status_to_err(&out.hdr);\r\n*pdn = be32_to_cpu(out.pdn) & 0xffffff;\r\nreturn err;\r\n}\r\nint mlx5_core_dealloc_pd(struct mlx5_core_dev *dev, u32 pdn)\r\n{\r\nstruct mlx5_dealloc_pd_mbox_in in;\r\nstruct mlx5_dealloc_pd_mbox_out out;\r\nint err;\r\nmemset(&in, 0, sizeof(in));\r\nmemset(&out, 0, sizeof(out));\r\nin.hdr.opcode = cpu_to_be16(MLX5_CMD_OP_DEALLOC_PD);\r\nin.pdn = cpu_to_be32(pdn);\r\nerr = mlx5_cmd_exec(dev, &in, sizeof(in), &out, sizeof(out));\r\nif (err)\r\nreturn err;\r\nif (out.hdr.status)\r\nreturn mlx5_cmd_status_to_err(&out.hdr);\r\nreturn err;\r\n}
