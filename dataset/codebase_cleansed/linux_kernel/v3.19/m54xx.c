static void __init m54xx_uarts_init(void)\r\n{\r\n__raw_writeb(MCF_PAR_PSC_TXD | MCF_PAR_PSC_RXD, MCFGPIO_PAR_PSC0);\r\n__raw_writeb(MCF_PAR_PSC_TXD | MCF_PAR_PSC_RXD | MCF_PAR_PSC_RTS_RTS,\r\nMCFGPIO_PAR_PSC1);\r\n__raw_writeb(MCF_PAR_PSC_TXD | MCF_PAR_PSC_RXD | MCF_PAR_PSC_RTS_RTS |\r\nMCF_PAR_PSC_CTS_CTS, MCFGPIO_PAR_PSC2);\r\n__raw_writeb(MCF_PAR_PSC_TXD | MCF_PAR_PSC_RXD, MCFGPIO_PAR_PSC3);\r\n}\r\nstatic void mcf54xx_reset(void)\r\n{\r\nasm("movew #0x2700, %sr\n");\r\n__raw_writel(0, MCF_GPT_GMS0);\r\n__raw_writel(MCF_GPT_GCIR_CNT(1), MCF_GPT_GCIR0);\r\n__raw_writel(MCF_GPT_GMS_WDEN | MCF_GPT_GMS_CE | MCF_GPT_GMS_TMS(4),\r\nMCF_GPT_GMS0);\r\n}\r\nstatic void __init mcf54xx_bootmem_alloc(void)\r\n{\r\nunsigned long start_pfn;\r\nunsigned long memstart;\r\nm68k_memory[0].addr = _rambase;\r\nm68k_memory[0].size = _ramend - _rambase;\r\nnum_pages = (_ramend - _rambase) >> PAGE_SHIFT;\r\nmemstart = PAGE_ALIGN(_ramstart);\r\nmin_low_pfn = _rambase >> PAGE_SHIFT;\r\nstart_pfn = memstart >> PAGE_SHIFT;\r\nmax_low_pfn = _ramend >> PAGE_SHIFT;\r\nhigh_memory = (void *)_ramend;\r\nm68k_virt_to_node_shift = fls(_ramend - _rambase - 1) - 6;\r\nmodule_fixup(NULL, __start_fixup, __stop_fixup);\r\nm68k_setup_node(0);\r\nmemstart += init_bootmem_node(NODE_DATA(0), start_pfn,\r\nmin_low_pfn, max_low_pfn);\r\nfree_bootmem_node(NODE_DATA(0), memstart, _ramend - memstart);\r\n}\r\nvoid __init config_BSP(char *commandp, int size)\r\n{\r\n#ifdef CONFIG_MMU\r\nmcf54xx_bootmem_alloc();\r\nmmu_context_init();\r\n#endif\r\nmach_reset = mcf54xx_reset;\r\nmach_sched_init = hw_timer_init;\r\nm54xx_uarts_init();\r\n}
