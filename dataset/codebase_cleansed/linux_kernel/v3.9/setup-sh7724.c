static int __init sh7724_devices_setup(void)\r\n{\r\nplatform_resource_setup_memory(&vpu_device, "vpu", 2 << 20);\r\nplatform_resource_setup_memory(&veu0_device, "veu0", 2 << 20);\r\nplatform_resource_setup_memory(&veu1_device, "veu1", 2 << 20);\r\nplatform_resource_setup_memory(&jpu_device, "jpu", 2 << 20);\r\nplatform_resource_setup_memory(&spu0_device, "spu0", 2 << 20);\r\nplatform_resource_setup_memory(&spu1_device, "spu1", 2 << 20);\r\nreturn platform_add_devices(sh7724_devices,\r\nARRAY_SIZE(sh7724_devices));\r\n}\r\nvoid __init plat_early_device_setup(void)\r\n{\r\nearly_platform_add_devices(sh7724_early_devices,\r\nARRAY_SIZE(sh7724_early_devices));\r\n}\r\nvoid l2_cache_init(void)\r\n{\r\n__raw_writel(L2_CACHE_ENABLE, RAMCR);\r\n}\r\nvoid __init plat_irq_setup(void)\r\n{\r\nregister_intc_controller(&intc_desc);\r\n}\r\nstatic int sh7724_pre_sleep_notifier_call(struct notifier_block *nb,\r\nunsigned long flags, void *unused)\r\n{\r\nif (!(flags & SUSP_SH_RSTANDBY))\r\nreturn NOTIFY_DONE;\r\nsh7724_rstandby_state.mmselr = __raw_readl(0xff800020);\r\nsh7724_rstandby_state.mmselr |= 0xa5a50000;\r\nsh7724_rstandby_state.cs0bcr = __raw_readl(0xfec10004);\r\nsh7724_rstandby_state.cs4bcr = __raw_readl(0xfec10010);\r\nsh7724_rstandby_state.cs5abcr = __raw_readl(0xfec10014);\r\nsh7724_rstandby_state.cs5bbcr = __raw_readl(0xfec10018);\r\nsh7724_rstandby_state.cs6abcr = __raw_readl(0xfec1001c);\r\nsh7724_rstandby_state.cs6bbcr = __raw_readl(0xfec10020);\r\nsh7724_rstandby_state.cs4wcr = __raw_readl(0xfec10030);\r\nsh7724_rstandby_state.cs5awcr = __raw_readl(0xfec10034);\r\nsh7724_rstandby_state.cs5bwcr = __raw_readl(0xfec10038);\r\nsh7724_rstandby_state.cs6awcr = __raw_readl(0xfec1003c);\r\nsh7724_rstandby_state.cs6bwcr = __raw_readl(0xfec10040);\r\nsh7724_rstandby_state.ipra = __raw_readw(0xa4080000);\r\nsh7724_rstandby_state.iprb = __raw_readw(0xa4080004);\r\nsh7724_rstandby_state.iprc = __raw_readw(0xa4080008);\r\nsh7724_rstandby_state.iprd = __raw_readw(0xa408000c);\r\nsh7724_rstandby_state.ipre = __raw_readw(0xa4080010);\r\nsh7724_rstandby_state.iprf = __raw_readw(0xa4080014);\r\nsh7724_rstandby_state.iprg = __raw_readw(0xa4080018);\r\nsh7724_rstandby_state.iprh = __raw_readw(0xa408001c);\r\nsh7724_rstandby_state.ipri = __raw_readw(0xa4080020);\r\nsh7724_rstandby_state.iprj = __raw_readw(0xa4080024);\r\nsh7724_rstandby_state.iprk = __raw_readw(0xa4080028);\r\nsh7724_rstandby_state.iprl = __raw_readw(0xa408002c);\r\nsh7724_rstandby_state.imr0 = __raw_readb(0xa4080080);\r\nsh7724_rstandby_state.imr1 = __raw_readb(0xa4080084);\r\nsh7724_rstandby_state.imr2 = __raw_readb(0xa4080088);\r\nsh7724_rstandby_state.imr3 = __raw_readb(0xa408008c);\r\nsh7724_rstandby_state.imr4 = __raw_readb(0xa4080090);\r\nsh7724_rstandby_state.imr5 = __raw_readb(0xa4080094);\r\nsh7724_rstandby_state.imr6 = __raw_readb(0xa4080098);\r\nsh7724_rstandby_state.imr7 = __raw_readb(0xa408009c);\r\nsh7724_rstandby_state.imr8 = __raw_readb(0xa40800a0);\r\nsh7724_rstandby_state.imr9 = __raw_readb(0xa40800a4);\r\nsh7724_rstandby_state.imr10 = __raw_readb(0xa40800a8);\r\nsh7724_rstandby_state.imr11 = __raw_readb(0xa40800ac);\r\nsh7724_rstandby_state.imr12 = __raw_readb(0xa40800b0);\r\nsh7724_rstandby_state.rwtcnt = __raw_readb(0xa4520000);\r\nsh7724_rstandby_state.rwtcnt |= 0x5a00;\r\nsh7724_rstandby_state.rwtcsr = __raw_readb(0xa4520004);\r\nsh7724_rstandby_state.rwtcsr |= 0xa500;\r\n__raw_writew(sh7724_rstandby_state.rwtcsr & 0x07, 0xa4520004);\r\nsh7724_rstandby_state.irdaclk = __raw_readl(0xa4150018);\r\nsh7724_rstandby_state.spuclk = __raw_readl(0xa415003c);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int sh7724_post_sleep_notifier_call(struct notifier_block *nb,\r\nunsigned long flags, void *unused)\r\n{\r\nif (!(flags & SUSP_SH_RSTANDBY))\r\nreturn NOTIFY_DONE;\r\n__raw_writel(sh7724_rstandby_state.mmselr, 0xff800020);\r\n__raw_writel(sh7724_rstandby_state.cs0bcr, 0xfec10004);\r\n__raw_writel(sh7724_rstandby_state.cs4bcr, 0xfec10010);\r\n__raw_writel(sh7724_rstandby_state.cs5abcr, 0xfec10014);\r\n__raw_writel(sh7724_rstandby_state.cs5bbcr, 0xfec10018);\r\n__raw_writel(sh7724_rstandby_state.cs6abcr, 0xfec1001c);\r\n__raw_writel(sh7724_rstandby_state.cs6bbcr, 0xfec10020);\r\n__raw_writel(sh7724_rstandby_state.cs4wcr, 0xfec10030);\r\n__raw_writel(sh7724_rstandby_state.cs5awcr, 0xfec10034);\r\n__raw_writel(sh7724_rstandby_state.cs5bwcr, 0xfec10038);\r\n__raw_writel(sh7724_rstandby_state.cs6awcr, 0xfec1003c);\r\n__raw_writel(sh7724_rstandby_state.cs6bwcr, 0xfec10040);\r\n__raw_writew(sh7724_rstandby_state.ipra, 0xa4080000);\r\n__raw_writew(sh7724_rstandby_state.iprb, 0xa4080004);\r\n__raw_writew(sh7724_rstandby_state.iprc, 0xa4080008);\r\n__raw_writew(sh7724_rstandby_state.iprd, 0xa408000c);\r\n__raw_writew(sh7724_rstandby_state.ipre, 0xa4080010);\r\n__raw_writew(sh7724_rstandby_state.iprf, 0xa4080014);\r\n__raw_writew(sh7724_rstandby_state.iprg, 0xa4080018);\r\n__raw_writew(sh7724_rstandby_state.iprh, 0xa408001c);\r\n__raw_writew(sh7724_rstandby_state.ipri, 0xa4080020);\r\n__raw_writew(sh7724_rstandby_state.iprj, 0xa4080024);\r\n__raw_writew(sh7724_rstandby_state.iprk, 0xa4080028);\r\n__raw_writew(sh7724_rstandby_state.iprl, 0xa408002c);\r\n__raw_writeb(sh7724_rstandby_state.imr0, 0xa4080080);\r\n__raw_writeb(sh7724_rstandby_state.imr1, 0xa4080084);\r\n__raw_writeb(sh7724_rstandby_state.imr2, 0xa4080088);\r\n__raw_writeb(sh7724_rstandby_state.imr3, 0xa408008c);\r\n__raw_writeb(sh7724_rstandby_state.imr4, 0xa4080090);\r\n__raw_writeb(sh7724_rstandby_state.imr5, 0xa4080094);\r\n__raw_writeb(sh7724_rstandby_state.imr6, 0xa4080098);\r\n__raw_writeb(sh7724_rstandby_state.imr7, 0xa408009c);\r\n__raw_writeb(sh7724_rstandby_state.imr8, 0xa40800a0);\r\n__raw_writeb(sh7724_rstandby_state.imr9, 0xa40800a4);\r\n__raw_writeb(sh7724_rstandby_state.imr10, 0xa40800a8);\r\n__raw_writeb(sh7724_rstandby_state.imr11, 0xa40800ac);\r\n__raw_writeb(sh7724_rstandby_state.imr12, 0xa40800b0);\r\n__raw_writew(sh7724_rstandby_state.rwtcnt, 0xa4520000);\r\n__raw_writew(sh7724_rstandby_state.rwtcsr, 0xa4520004);\r\n__raw_writel(sh7724_rstandby_state.irdaclk, 0xa4150018);\r\n__raw_writel(sh7724_rstandby_state.spuclk, 0xa415003c);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int __init sh7724_sleep_setup(void)\r\n{\r\natomic_notifier_chain_register(&sh_mobile_pre_sleep_notifier_list,\r\n&sh7724_pre_sleep_notifier);\r\natomic_notifier_chain_register(&sh_mobile_post_sleep_notifier_list,\r\n&sh7724_post_sleep_notifier);\r\nreturn 0;\r\n}
