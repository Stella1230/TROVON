void exar7250_init(struct channel *sc)\r\n{\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_OPERATING_MODE,\r\nSBE_2T3E3_FRAMER_VAL_T3_CBIT |\r\nSBE_2T3E3_FRAMER_VAL_INTERRUPT_ENABLE_RESET |\r\nSBE_2T3E3_FRAMER_VAL_TIMING_ASYNCH_TXINCLK);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_IO_CONTROL,\r\nSBE_2T3E3_FRAMER_VAL_DISABLE_TX_LOSS_OF_CLOCK |\r\nSBE_2T3E3_FRAMER_VAL_DISABLE_RX_LOSS_OF_CLOCK |\r\nSBE_2T3E3_FRAMER_VAL_AMI_LINE_CODE |\r\nSBE_2T3E3_FRAMER_VAL_RX_LINE_CLOCK_INVERT);\r\nexar7250_set_frame_type(sc, SBE_2T3E3_FRAME_TYPE_T3_CBIT);\r\n}\r\nvoid exar7250_set_frame_type(struct channel *sc, u32 type)\r\n{\r\nu32 val;\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nexar7250_stop_intr(sc, type);\r\nval = exar7250_read(sc, SBE_2T3E3_FRAMER_REG_OPERATING_MODE);\r\nval &= ~(SBE_2T3E3_FRAMER_VAL_LOCAL_LOOPBACK_MODE |\r\nSBE_2T3E3_FRAMER_VAL_T3_E3_SELECT |\r\nSBE_2T3E3_FRAMER_VAL_FRAME_FORMAT_SELECT);\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\nval |= SBE_2T3E3_FRAMER_VAL_E3_G751;\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\nval |= SBE_2T3E3_FRAMER_VAL_E3_G832;\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\nval |= SBE_2T3E3_FRAMER_VAL_T3_CBIT;\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\nval |= SBE_2T3E3_FRAMER_VAL_T3_M13;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_OPERATING_MODE, val);\r\nexar7250_start_intr(sc, type);\r\n}\r\nvoid exar7250_start_intr(struct channel *sc, u32 type)\r\n{\r\nu32 val;\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\nval = exar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_CONFIGURATION_STATUS_2);\r\ncpld_LOS_update(sc);\r\nsc->s.OOF = val & SBE_2T3E3_FRAMER_VAL_E3_RX_OOF ? 1 : 0;\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_STATUS_1);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_ENABLE_1,\r\nSBE_2T3E3_FRAMER_VAL_E3_RX_OOF_INTERRUPT_ENABLE |\r\nSBE_2T3E3_FRAMER_VAL_E3_RX_LOS_INTERRUPT_ENABLE);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_STATUS_2);\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\nval = exar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_CONFIGURATION_STATUS);\r\ncpld_LOS_update(sc);\r\nsc->s.OOF = val & SBE_2T3E3_FRAMER_VAL_T3_RX_OOF ? 1 : 0;\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_INTERRUPT_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_RX_INTERRUPT_ENABLE,\r\nSBE_2T3E3_FRAMER_VAL_T3_RX_LOS_INTERRUPT_ENABLE |\r\nSBE_2T3E3_FRAMER_VAL_T3_RX_OOF_INTERRUPT_ENABLE);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_FEAC_INTERRUPT_ENABLE_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_RX_LAPD_CONTROL, 0);\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_BLOCK_INTERRUPT_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_BLOCK_INTERRUPT_ENABLE,\r\nSBE_2T3E3_FRAMER_VAL_RX_INTERRUPT_ENABLE |\r\nSBE_2T3E3_FRAMER_VAL_TX_INTERRUPT_ENABLE);\r\n}\r\nvoid exar7250_stop_intr(struct channel *sc, u32 type)\r\n{\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_BLOCK_INTERRUPT_ENABLE, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_BLOCK_INTERRUPT_STATUS);\r\nswitch (type) {\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G751:\r\ncase SBE_2T3E3_FRAME_TYPE_E3_G832:\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_ENABLE_1, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_STATUS_1);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_ENABLE_2, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_INTERRUPT_STATUS_2);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_E3_RX_LAPD_CONTROL, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_RX_LAPD_CONTROL);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_E3_TX_LAPD_STATUS, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_E3_TX_LAPD_STATUS);\r\nbreak;\r\ncase SBE_2T3E3_FRAME_TYPE_T3_CBIT:\r\ncase SBE_2T3E3_FRAME_TYPE_T3_M13:\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_RX_INTERRUPT_ENABLE, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_INTERRUPT_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_RX_FEAC_INTERRUPT_ENABLE_STATUS, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_FEAC_INTERRUPT_ENABLE_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_RX_LAPD_CONTROL, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_RX_LAPD_CONTROL);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_TX_FEAC_CONFIGURATION_STATUS, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_TX_FEAC_CONFIGURATION_STATUS);\r\nexar7250_write(sc, SBE_2T3E3_FRAMER_REG_T3_TX_LAPD_STATUS, 0);\r\nexar7250_read(sc, SBE_2T3E3_FRAMER_REG_T3_TX_LAPD_STATUS);\r\nbreak;\r\n}\r\n}\r\nvoid exar7250_unipolar_onoff(struct channel *sc, u32 mode)\r\n{\r\nswitch (mode) {\r\ncase SBE_2T3E3_OFF:\r\nexar7300_clear_bit(sc, SBE_2T3E3_FRAMER_REG_IO_CONTROL,\r\nSBE_2T3E3_FRAMER_VAL_UNIPOLAR);\r\nbreak;\r\ncase SBE_2T3E3_ON:\r\nexar7300_set_bit(sc, SBE_2T3E3_FRAMER_REG_IO_CONTROL,\r\nSBE_2T3E3_FRAMER_VAL_UNIPOLAR);\r\nbreak;\r\n}\r\n}\r\nvoid exar7250_set_loopback(struct channel *sc, u32 mode)\r\n{\r\nswitch (mode) {\r\ncase SBE_2T3E3_FRAMER_VAL_LOOPBACK_OFF:\r\nexar7300_clear_bit(sc, SBE_2T3E3_FRAMER_REG_OPERATING_MODE,\r\nSBE_2T3E3_FRAMER_VAL_LOCAL_LOOPBACK_MODE);\r\nbreak;\r\ncase SBE_2T3E3_FRAMER_VAL_LOOPBACK_ON:\r\nexar7300_set_bit(sc, SBE_2T3E3_FRAMER_REG_OPERATING_MODE,\r\nSBE_2T3E3_FRAMER_VAL_LOCAL_LOOPBACK_MODE);\r\nbreak;\r\n}\r\n}
