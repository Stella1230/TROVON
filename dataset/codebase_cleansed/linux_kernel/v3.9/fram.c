static int fram_mmap(struct file *filp, struct vm_area_struct *vma)\r\n{\r\nint ret;\r\nret = remap_pfn_range(vma,\r\nvma->vm_start,\r\nvirt_to_phys((void *)((unsigned long)FRAM_BASE)) >> PAGE_SHIFT,\r\nvma->vm_end-vma->vm_start,\r\nPAGE_SHARED);\r\nif (ret != 0)\r\nreturn -EAGAIN;\r\nreturn 0;\r\n}\r\nstatic int __init\r\nfram_init(void)\r\n{\r\nint ret;\r\nret = misc_register(&fram_dev);\r\nif (ret) {\r\nprintk(KERN_ERR "fram: can't misc_register on minor=%d\n",\r\nFRAM_MINOR);\r\nreturn ret;\r\n}\r\nprintk(KERN_INFO "FRAM memory driver v" FRAM_VERSION "\n");\r\nreturn 0;\r\n}\r\nstatic void __exit\r\nfram_cleanup_module(void)\r\n{\r\nmisc_deregister(&fram_dev);\r\n}
