static int wm8994_ldo2_list_voltage(struct regulator_dev *rdev,\r\nunsigned int selector)\r\n{\r\nstruct wm8994_ldo *ldo = rdev_get_drvdata(rdev);\r\nif (selector > WM8994_LDO2_MAX_SELECTOR)\r\nreturn -EINVAL;\r\nswitch (ldo->wm8994->type) {\r\ncase WM8994:\r\nreturn (selector * 100000) + 900000;\r\ncase WM8958:\r\nreturn (selector * 100000) + 1000000;\r\ncase WM1811:\r\nswitch (selector) {\r\ncase 0:\r\nreturn -EINVAL;\r\ndefault:\r\nreturn (selector * 100000) + 950000;\r\n}\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\n}\r\nstatic int wm8994_ldo_probe(struct platform_device *pdev)\r\n{\r\nstruct wm8994 *wm8994 = dev_get_drvdata(pdev->dev.parent);\r\nstruct wm8994_pdata *pdata = wm8994->dev->platform_data;\r\nint id = pdev->id % ARRAY_SIZE(pdata->ldo);\r\nstruct regulator_config config = { };\r\nstruct wm8994_ldo *ldo;\r\nint ret;\r\ndev_dbg(&pdev->dev, "Probing LDO%d\n", id + 1);\r\nldo = devm_kzalloc(&pdev->dev, sizeof(struct wm8994_ldo), GFP_KERNEL);\r\nif (ldo == NULL) {\r\ndev_err(&pdev->dev, "Unable to allocate private data\n");\r\nreturn -ENOMEM;\r\n}\r\nldo->wm8994 = wm8994;\r\nconfig.dev = wm8994->dev;\r\nconfig.driver_data = ldo;\r\nconfig.regmap = wm8994->regmap;\r\nif (pdata) {\r\nconfig.init_data = pdata->ldo[id].init_data;\r\nconfig.ena_gpio = pdata->ldo[id].enable;\r\n}\r\nldo->regulator = regulator_register(&wm8994_ldo_desc[id], &config);\r\nif (IS_ERR(ldo->regulator)) {\r\nret = PTR_ERR(ldo->regulator);\r\ndev_err(wm8994->dev, "Failed to register LDO%d: %d\n",\r\nid + 1, ret);\r\ngoto err;\r\n}\r\nplatform_set_drvdata(pdev, ldo);\r\nreturn 0;\r\nerr:\r\nreturn ret;\r\n}\r\nstatic int wm8994_ldo_remove(struct platform_device *pdev)\r\n{\r\nstruct wm8994_ldo *ldo = platform_get_drvdata(pdev);\r\nplatform_set_drvdata(pdev, NULL);\r\nregulator_unregister(ldo->regulator);\r\nreturn 0;\r\n}\r\nstatic int __init wm8994_ldo_init(void)\r\n{\r\nint ret;\r\nret = platform_driver_register(&wm8994_ldo_driver);\r\nif (ret != 0)\r\npr_err("Failed to register Wm8994 GP LDO driver: %d\n", ret);\r\nreturn ret;\r\n}\r\nstatic void __exit wm8994_ldo_exit(void)\r\n{\r\nplatform_driver_unregister(&wm8994_ldo_driver);\r\n}
