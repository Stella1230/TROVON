static void zpci_event_log_err(struct zpci_ccdf_err *ccdf)\r\n{\r\nstruct zpci_dev *zdev = get_zdev_by_fid(ccdf->fid);\r\nzpci_err("SEI error CCD:\n");\r\nzpci_err_hex(ccdf, sizeof(*ccdf));\r\ndev_err(&zdev->pdev->dev, "event code: 0x%x\n", ccdf->pec);\r\n}\r\nstatic void zpci_event_log_avail(struct zpci_ccdf_avail *ccdf)\r\n{\r\nstruct zpci_dev *zdev = get_zdev_by_fid(ccdf->fid);\r\npr_err("%s%s: availability event: fh: 0x%x fid: 0x%x event code: 0x%x reason:",\r\n(zdev) ? dev_driver_string(&zdev->pdev->dev) : "?",\r\n(zdev) ? dev_name(&zdev->pdev->dev) : "?",\r\nccdf->fh, ccdf->fid, ccdf->pec);\r\nprint_hex_dump(KERN_CONT, "ccdf", DUMP_PREFIX_OFFSET,\r\n16, 1, ccdf, sizeof(*ccdf), false);\r\nswitch (ccdf->pec) {\r\ncase 0x0301:\r\nzpci_enable_device(zdev);\r\nbreak;\r\ncase 0x0302:\r\nclp_add_pci_device(ccdf->fid, ccdf->fh, 0);\r\nbreak;\r\ncase 0x0306:\r\nclp_find_pci_devices();\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nvoid zpci_event_error(void *data)\r\n{\r\nstruct zpci_ccdf_err *ccdf = data;\r\nstruct zpci_dev *zdev;\r\nzpci_event_log_err(ccdf);\r\nzdev = get_zdev_by_fid(ccdf->fid);\r\nif (!zdev) {\r\npr_err("Error event for unknown fid: %x", ccdf->fid);\r\nreturn;\r\n}\r\n}\r\nvoid zpci_event_availability(void *data)\r\n{\r\nzpci_event_log_avail(data);\r\n}
