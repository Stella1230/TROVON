void tegra20_init_speedo_data(void)\r\n{\r\nu32 reg;\r\nu32 val;\r\nint i;\r\nBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) != SPEEDO_ID_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(core_process_speedos) != SPEEDO_ID_COUNT);\r\nif (SPEEDO_ID_SELECT_0(tegra_revision))\r\ntegra_soc_speedo_id = SPEEDO_ID_0;\r\nelse if (SPEEDO_ID_SELECT_1(tegra_sku_id))\r\ntegra_soc_speedo_id = SPEEDO_ID_1;\r\nelse\r\ntegra_soc_speedo_id = SPEEDO_ID_2;\r\nval = 0;\r\nfor (i = CPU_SPEEDO_MSBIT; i >= CPU_SPEEDO_LSBIT; i--) {\r\nreg = tegra_spare_fuse(i) |\r\ntegra_spare_fuse(i + CPU_SPEEDO_REDUND_OFFS);\r\nval = (val << 1) | (reg & 0x1);\r\n}\r\nval = val * SPEEDO_MULT;\r\npr_debug("%s CPU speedo value %u\n", __func__, val);\r\nfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\r\nif (val <= cpu_process_speedos[tegra_soc_speedo_id][i])\r\nbreak;\r\n}\r\ntegra_cpu_process_id = i;\r\nval = 0;\r\nfor (i = CORE_SPEEDO_MSBIT; i >= CORE_SPEEDO_LSBIT; i--) {\r\nreg = tegra_spare_fuse(i) |\r\ntegra_spare_fuse(i + CORE_SPEEDO_REDUND_OFFS);\r\nval = (val << 1) | (reg & 0x1);\r\n}\r\nval = val * SPEEDO_MULT;\r\npr_debug("%s Core speedo value %u\n", __func__, val);\r\nfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\r\nif (val <= core_process_speedos[tegra_soc_speedo_id][i])\r\nbreak;\r\n}\r\ntegra_core_process_id = i;\r\npr_info("Tegra20 Soc Speedo ID %d", tegra_soc_speedo_id);\r\n}
