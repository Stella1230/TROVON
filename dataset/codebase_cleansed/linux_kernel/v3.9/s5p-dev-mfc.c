void __init s5p_mfc_reserve_mem(phys_addr_t rbase, unsigned int rsize,\r\nphys_addr_t lbase, unsigned int lsize)\r\n{\r\nint i;\r\ns5p_mfc_mem[0].dev = &s5p_device_mfc_r.dev;\r\ns5p_mfc_mem[0].base = rbase;\r\ns5p_mfc_mem[0].size = rsize;\r\ns5p_mfc_mem[1].dev = &s5p_device_mfc_l.dev;\r\ns5p_mfc_mem[1].base = lbase;\r\ns5p_mfc_mem[1].size = lsize;\r\nfor (i = 0; i < ARRAY_SIZE(s5p_mfc_mem); i++) {\r\nstruct s5p_mfc_reserved_mem *area = &s5p_mfc_mem[i];\r\nif (memblock_remove(area->base, area->size)) {\r\nprintk(KERN_ERR "Failed to reserve memory for MFC device (%ld bytes at 0x%08lx)\n",\r\narea->size, (unsigned long) area->base);\r\narea->base = 0;\r\n}\r\n}\r\n}\r\nstatic int __init s5p_mfc_memory_init(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(s5p_mfc_mem); i++) {\r\nstruct s5p_mfc_reserved_mem *area = &s5p_mfc_mem[i];\r\nif (!area->base)\r\ncontinue;\r\nif (dma_declare_coherent_memory(area->dev, area->base,\r\narea->base, area->size,\r\nDMA_MEMORY_MAP | DMA_MEMORY_EXCLUSIVE) == 0)\r\nprintk(KERN_ERR "Failed to declare coherent memory for MFC device (%ld bytes at 0x%08lx)\n",\r\narea->size, (unsigned long) area->base);\r\n}\r\nreturn 0;\r\n}\r\nint __init s5p_fdt_find_mfc_mem(unsigned long node, const char *uname,\r\nint depth, void *data)\r\n{\r\n__be32 *prop;\r\nunsigned long len;\r\nstruct s5p_mfc_dt_meminfo *mfc_mem = data;\r\nif (!data)\r\nreturn 0;\r\nif (!of_flat_dt_is_compatible(node, mfc_mem->compatible))\r\nreturn 0;\r\nprop = of_get_flat_dt_prop(node, "samsung,mfc-l", &len);\r\nif (!prop || (len != 2 * sizeof(unsigned long)))\r\nreturn 0;\r\nmfc_mem->loff = be32_to_cpu(prop[0]);\r\nmfc_mem->lsize = be32_to_cpu(prop[1]);\r\nprop = of_get_flat_dt_prop(node, "samsung,mfc-r", &len);\r\nif (!prop || (len != 2 * sizeof(unsigned long)))\r\nreturn 0;\r\nmfc_mem->roff = be32_to_cpu(prop[0]);\r\nmfc_mem->rsize = be32_to_cpu(prop[1]);\r\nreturn 1;\r\n}
