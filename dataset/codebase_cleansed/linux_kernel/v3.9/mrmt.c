static int ads7846_pendown_state(void)\r\n{\r\nreturn !gpio_get_value( PIN_TS_EXTINT );\r\n}\r\nstatic void mrmt_power_off(void)\r\n{\r\ngpio_set_value( PIN_PWR_ON, 0 );\r\n}\r\nstatic int __init mrmt1_init(void)\r\n{\r\ngpio_set_value( PIN_PWR_ON, 1 );\r\npm_power_off = mrmt_power_off;\r\nat32_map_usart(2, 1, 0);\r\nat32_map_usart(3, 2, ATMEL_USART_RTS | ATMEL_USART_CTS);\r\nat32_add_device_usart(1);\r\nat32_add_device_usart(2);\r\nat32_select_gpio( PIN_PWR_SW_N, AT32_GPIOF_DEGLITCH);\r\nat32_select_gpio( PIN_PB_LEFT, AT32_GPIOF_DEGLITCH);\r\nat32_select_gpio( PIN_PB_RIGHT, AT32_GPIOF_DEGLITCH);\r\nplatform_device_register(&rmt_gpio_keys);\r\n#ifdef CONFIG_BOARD_MRMT_RTC_I2C\r\ni2c_register_board_info(0, &mrmt1_i2c_rtc, 1);\r\n#endif\r\n#ifndef CONFIG_BOARD_MRMT_LCD_DISABLE\r\nat32_add_device_lcdc(0, &rmt_lcdc_data,\r\nfbmem_start, fbmem_size,\r\n(ATMEL_LCDC_ALT_24BIT | ATMEL_LCDC_PE_DVAL ) );\r\n#endif\r\n#ifdef CONFIG_BOARD_MRMT_AC97\r\nat32_add_device_ac97c(0, &ac97c0_data, AC97C_BOTH);\r\n#endif\r\n#ifdef CONFIG_BOARD_MRMT_ADS7846_TS\r\nat32_select_periph( GPIO_PIOB_BASE, 1 << (PB_EXTINT_BASE+TS_IRQ),\r\nGPIO_PERIPH_A, AT32_GPIOF_DEGLITCH);\r\nirq_set_irq_type(AT32_EXTINT(TS_IRQ), IRQ_TYPE_EDGE_FALLING);\r\nat32_spi_setup_slaves(0,spi01_board_info,ARRAY_SIZE(spi01_board_info));\r\nspi_register_board_info(spi01_board_info,ARRAY_SIZE(spi01_board_info));\r\n#endif\r\n#ifdef CONFIG_BOARD_MRMT_UCB1400_TS\r\nat32_select_periph( GPIO_PIOB_BASE, 1 << (PB_EXTINT_BASE+TS_IRQ),\r\nGPIO_PERIPH_A, AT32_GPIOF_DEGLITCH);\r\nplatform_device_register(&rmt_ts_device);\r\n#endif\r\nat32_select_gpio( PIN_LCD_DISP, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_LCD_DISP, "LCD_DISP" );\r\ngpio_direction_output( PIN_LCD_DISP, 0 );\r\n#ifdef CONFIG_BOARD_MRMT_LCD_DISABLE\r\nat32_select_gpio( PIN_LCD_BL, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_LCD_BL, "LCD_BL" );\r\ngpio_direction_output( PIN_LCD_BL, 0 );\r\n#else\r\ngpio_set_value( PIN_LCD_DISP, 1 );\r\n#ifdef CONFIG_BOARD_MRMT_BL_PWM\r\nat32_add_device_pwm(1 << PWM_CH_BL);\r\nplatform_device_register(&rmt_pwm_led_dev);\r\n#else\r\nudelay( 1 );\r\nat32_select_gpio( PIN_LCD_BL, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_LCD_BL, "LCD_BL" );\r\ngpio_direction_output( PIN_LCD_BL, 1 );\r\n#endif\r\n#endif\r\nat32_select_gpio( PIN_BT_RST, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_BT_RST, "BT_RST" );\r\ngpio_direction_output( PIN_BT_RST, 1 );\r\nat32_select_gpio( PIN_ZB_RST_N, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_ZB_RST_N, "ZB_RST_N" );\r\ngpio_direction_output( PIN_ZB_RST_N, 0 );\r\n#ifdef CONFIG_BOARD_MRMT_WIRELESS_ZB\r\nudelay( 1000 );\r\ngpio_set_value( PIN_ZB_RST_N, 1 );\r\n#endif\r\n#ifdef CONFIG_BOARD_MRMT_WIRELESS_BT\r\nudelay( 1000 );\r\ngpio_set_value( PIN_BT_RST, 0 );\r\n#endif\r\nreturn 0;\r\n}\r\nstatic int __init mrmt1_early_init(void)\r\n{\r\nat32_select_gpio( PIN_PWR_ON, AT32_GPIOF_OUTPUT );\r\ngpio_request( PIN_PWR_ON, "PIN_PWR_ON" );\r\ngpio_direction_output( PIN_PWR_ON, 1 );\r\nreturn 0;\r\n}
