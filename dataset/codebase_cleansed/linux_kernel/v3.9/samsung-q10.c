static int samsungq10_bl_set_intensity(struct backlight_device *bd)\r\n{\r\nint brightness = bd->props.brightness;\r\nunsigned char c[3] = SAMSUNGQ10_BL_8042_DATA;\r\nc[2] = (unsigned char)brightness;\r\ni8042_lock_chip();\r\ni8042_command(c, (0x30 << 8) | SAMSUNGQ10_BL_8042_CMD);\r\ni8042_unlock_chip();\r\nsamsungq10_bl_brightness = brightness;\r\nreturn 0;\r\n}\r\nstatic int samsungq10_bl_get_intensity(struct backlight_device *bd)\r\n{\r\nreturn samsungq10_bl_brightness;\r\n}\r\nstatic int samsungq10_suspend(struct device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int samsungq10_resume(struct device *dev)\r\n{\r\nstruct backlight_device *bd = dev_get_drvdata(dev);\r\nsamsungq10_bl_set_intensity(bd);\r\nreturn 0;\r\n}\r\nstatic int samsungq10_probe(struct platform_device *pdev)\r\n{\r\nstruct backlight_properties props;\r\nstruct backlight_device *bd;\r\nmemset(&props, 0, sizeof(struct backlight_properties));\r\nprops.type = BACKLIGHT_PLATFORM;\r\nprops.max_brightness = SAMSUNGQ10_BL_MAX_INTENSITY;\r\nbd = backlight_device_register("samsung", &pdev->dev, NULL,\r\n&samsungq10_bl_ops, &props);\r\nif (IS_ERR(bd))\r\nreturn PTR_ERR(bd);\r\nplatform_set_drvdata(pdev, bd);\r\nbd->props.brightness = SAMSUNGQ10_BL_DEFAULT_INTENSITY;\r\nsamsungq10_bl_set_intensity(bd);\r\nreturn 0;\r\n}\r\nstatic int samsungq10_remove(struct platform_device *pdev)\r\n{\r\nstruct backlight_device *bd = platform_get_drvdata(pdev);\r\nbd->props.brightness = SAMSUNGQ10_BL_DEFAULT_INTENSITY;\r\nsamsungq10_bl_set_intensity(bd);\r\nbacklight_device_unregister(bd);\r\nreturn 0;\r\n}\r\nstatic int __init dmi_check_callback(const struct dmi_system_id *id)\r\n{\r\nprintk(KERN_INFO KBUILD_MODNAME ": found model '%s'\n", id->ident);\r\nreturn 1;\r\n}\r\nstatic int __init samsungq10_init(void)\r\n{\r\nif (!force && !dmi_check_system(samsungq10_dmi_table))\r\nreturn -ENODEV;\r\nsamsungq10_device = platform_create_bundle(&samsungq10_driver,\r\nsamsungq10_probe,\r\nNULL, 0, NULL, 0);\r\nif (IS_ERR(samsungq10_device))\r\nreturn PTR_ERR(samsungq10_device);\r\nreturn 0;\r\n}\r\nstatic void __exit samsungq10_exit(void)\r\n{\r\nplatform_device_unregister(samsungq10_device);\r\nplatform_driver_unregister(&samsungq10_driver);\r\n}
