static int tps6105x_regulator_enable(struct regulator_dev *rdev)\r\n{\r\nstruct tps6105x *tps6105x = rdev_get_drvdata(rdev);\r\nint ret;\r\nret = tps6105x_mask_and_set(tps6105x, TPS6105X_REG_0,\r\nTPS6105X_REG0_MODE_MASK,\r\nTPS6105X_REG0_MODE_VOLTAGE << TPS6105X_REG0_MODE_SHIFT);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int tps6105x_regulator_disable(struct regulator_dev *rdev)\r\n{\r\nstruct tps6105x *tps6105x = rdev_get_drvdata(rdev);\r\nint ret;\r\nret = tps6105x_mask_and_set(tps6105x, TPS6105X_REG_0,\r\nTPS6105X_REG0_MODE_MASK,\r\nTPS6105X_REG0_MODE_SHUTDOWN << TPS6105X_REG0_MODE_SHIFT);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int tps6105x_regulator_is_enabled(struct regulator_dev *rdev)\r\n{\r\nstruct tps6105x *tps6105x = rdev_get_drvdata(rdev);\r\nu8 regval;\r\nint ret;\r\nret = tps6105x_get(tps6105x, TPS6105X_REG_0, &regval);\r\nif (ret)\r\nreturn ret;\r\nregval &= TPS6105X_REG0_MODE_MASK;\r\nregval >>= TPS6105X_REG0_MODE_SHIFT;\r\nif (regval == TPS6105X_REG0_MODE_VOLTAGE)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic int tps6105x_regulator_get_voltage_sel(struct regulator_dev *rdev)\r\n{\r\nstruct tps6105x *tps6105x = rdev_get_drvdata(rdev);\r\nu8 regval;\r\nint ret;\r\nret = tps6105x_get(tps6105x, TPS6105X_REG_0, &regval);\r\nif (ret)\r\nreturn ret;\r\nregval &= TPS6105X_REG0_VOLTAGE_MASK;\r\nregval >>= TPS6105X_REG0_VOLTAGE_SHIFT;\r\nreturn (int) regval;\r\n}\r\nstatic int tps6105x_regulator_set_voltage_sel(struct regulator_dev *rdev,\r\nunsigned selector)\r\n{\r\nstruct tps6105x *tps6105x = rdev_get_drvdata(rdev);\r\nint ret;\r\nret = tps6105x_mask_and_set(tps6105x, TPS6105X_REG_0,\r\nTPS6105X_REG0_VOLTAGE_MASK,\r\nselector << TPS6105X_REG0_VOLTAGE_SHIFT);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int tps6105x_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct tps6105x *tps6105x = dev_get_platdata(&pdev->dev);\r\nstruct tps6105x_platform_data *pdata = tps6105x->pdata;\r\nstruct regulator_config config = { };\r\nint ret;\r\nif (pdata->mode != TPS6105X_MODE_VOLTAGE) {\r\ndev_info(&pdev->dev,\r\n"chip not in voltage mode mode, exit probe \n");\r\nreturn 0;\r\n}\r\nconfig.dev = &tps6105x->client->dev;\r\nconfig.init_data = pdata->regulator_data;\r\nconfig.driver_data = tps6105x;\r\ntps6105x->regulator = regulator_register(&tps6105x_regulator_desc,\r\n&config);\r\nif (IS_ERR(tps6105x->regulator)) {\r\nret = PTR_ERR(tps6105x->regulator);\r\ndev_err(&tps6105x->client->dev,\r\n"failed to register regulator\n");\r\nreturn ret;\r\n}\r\nplatform_set_drvdata(pdev, tps6105x);\r\nreturn 0;\r\n}\r\nstatic int tps6105x_regulator_remove(struct platform_device *pdev)\r\n{\r\nstruct tps6105x *tps6105x = dev_get_platdata(&pdev->dev);\r\nregulator_unregister(tps6105x->regulator);\r\nreturn 0;\r\n}\r\nstatic __init int tps6105x_regulator_init(void)\r\n{\r\nreturn platform_driver_register(&tps6105x_regulator_driver);\r\n}\r\nstatic __exit void tps6105x_regulator_exit(void)\r\n{\r\nplatform_driver_unregister(&tps6105x_regulator_driver);\r\n}
