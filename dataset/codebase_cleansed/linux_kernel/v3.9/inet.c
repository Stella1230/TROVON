static int uf_inetaddr_event(struct notifier_block *notif, unsigned long event, void *ifa)\r\n{\r\nstruct net_device *ndev;\r\nunifi_priv_t *priv;\r\nstruct in_ifaddr *if_addr;\r\nnetInterface_priv_t *InterfacePriv = (netInterface_priv_t *)NULL;\r\nif (!ifa || !((struct in_ifaddr *)ifa)->ifa_dev) {\r\nunifi_trace(NULL, UDBG1, "uf_inetaddr_event (%lu) ifa=%p\n", event, ifa);\r\nreturn NOTIFY_DONE;\r\n}\r\nndev = ((struct in_ifaddr *)ifa)->ifa_dev->dev;\r\nInterfacePriv = (netInterface_priv_t*) netdev_priv(ndev);\r\nif (uf_find_netdev_priv(InterfacePriv) == -1) {\r\nunifi_trace(NULL, UDBG1, "uf_inetaddr_event (%lu) ndev=%p, other netdev_priv=%p\n",\r\nevent, ndev, InterfacePriv);\r\nreturn NOTIFY_DONE;\r\n}\r\nif (!InterfacePriv->privPtr) {\r\nunifi_error(NULL, "uf_inetaddr_event null priv (%lu) ndev=%p, InterfacePriv=%p\n",\r\nevent, ndev, InterfacePriv);\r\nreturn NOTIFY_DONE;\r\n}\r\npriv = InterfacePriv->privPtr;\r\nif_addr = (struct in_ifaddr *)ifa;\r\nif (uf_find_priv(priv) != -1) {\r\nswitch (event) {\r\ncase NETDEV_UP:\r\nunifi_info(priv, "IP address assigned for %s\n", priv->netdev[InterfacePriv->InterfaceTag]->name);\r\npriv->sta_ip_address = if_addr->ifa_address;\r\n#ifdef CSR_SUPPORT_WEXT\r\nsme_mgt_packet_filter_set(priv);\r\n#endif\r\nbreak;\r\ncase NETDEV_DOWN:\r\nunifi_info(priv, "IP address removed for %s\n", priv->netdev[InterfacePriv->InterfaceTag]->name);\r\npriv->sta_ip_address = 0xFFFFFFFF;\r\n#ifdef CSR_SUPPORT_WEXT\r\nsme_mgt_packet_filter_set(priv);\r\n#endif\r\nbreak;\r\n}\r\n}\r\nreturn NOTIFY_DONE;\r\n}\r\nvoid uf_register_inet_notifier(void)\r\n{\r\nif (atomic_inc_return(&inet_notif_refs) == 1)\r\nregister_inetaddr_notifier(&uf_inetaddr_notifier);\r\n}\r\nvoid uf_unregister_inet_notifier(void)\r\n{\r\nif (atomic_dec_return(&inet_notif_refs) == 0)\r\nunregister_inetaddr_notifier(&uf_inetaddr_notifier);\r\n}
