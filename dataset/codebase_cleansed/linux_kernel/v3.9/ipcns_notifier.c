static int ipcns_callback(struct notifier_block *self,\r\nunsigned long action, void *arg)\r\n{\r\nstruct ipc_namespace *ns;\r\nswitch (action) {\r\ncase IPCNS_MEMCHANGED:\r\ncase IPCNS_CREATED:\r\ncase IPCNS_REMOVED:\r\nns = container_of(self, struct ipc_namespace, ipcns_nb);\r\nrecompute_msgmni(ns);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn NOTIFY_OK;\r\n}\r\nint register_ipcns_notifier(struct ipc_namespace *ns)\r\n{\r\nint rc;\r\nmemset(&ns->ipcns_nb, 0, sizeof(ns->ipcns_nb));\r\nns->ipcns_nb.notifier_call = ipcns_callback;\r\nns->ipcns_nb.priority = IPCNS_CALLBACK_PRI;\r\nrc = blocking_notifier_chain_register(&ipcns_chain, &ns->ipcns_nb);\r\nif (!rc)\r\nns->auto_msgmni = 1;\r\nreturn rc;\r\n}\r\nint cond_register_ipcns_notifier(struct ipc_namespace *ns)\r\n{\r\nint rc;\r\nmemset(&ns->ipcns_nb, 0, sizeof(ns->ipcns_nb));\r\nns->ipcns_nb.notifier_call = ipcns_callback;\r\nns->ipcns_nb.priority = IPCNS_CALLBACK_PRI;\r\nrc = blocking_notifier_chain_cond_register(&ipcns_chain,\r\n&ns->ipcns_nb);\r\nif (!rc)\r\nns->auto_msgmni = 1;\r\nreturn rc;\r\n}\r\nvoid unregister_ipcns_notifier(struct ipc_namespace *ns)\r\n{\r\nblocking_notifier_chain_unregister(&ipcns_chain, &ns->ipcns_nb);\r\nns->auto_msgmni = 0;\r\n}\r\nint ipcns_notify(unsigned long val)\r\n{\r\nreturn blocking_notifier_call_chain(&ipcns_chain, val, NULL);\r\n}
