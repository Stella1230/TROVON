static int cyttsp_i2c_read_block_data(struct cyttsp *ts,\r\nu8 addr, u8 length, void *values)\r\n{\r\nstruct i2c_client *client = to_i2c_client(ts->dev);\r\nstruct i2c_msg msgs[] = {\r\n{\r\n.addr = client->addr,\r\n.flags = 0,\r\n.len = 1,\r\n.buf = &addr,\r\n},\r\n{\r\n.addr = client->addr,\r\n.flags = I2C_M_RD,\r\n.len = length,\r\n.buf = values,\r\n},\r\n};\r\nint retval;\r\nretval = i2c_transfer(client->adapter, msgs, ARRAY_SIZE(msgs));\r\nif (retval < 0)\r\nreturn retval;\r\nreturn retval != ARRAY_SIZE(msgs) ? -EIO : 0;\r\n}\r\nstatic int cyttsp_i2c_write_block_data(struct cyttsp *ts,\r\nu8 addr, u8 length, const void *values)\r\n{\r\nstruct i2c_client *client = to_i2c_client(ts->dev);\r\nint retval;\r\nts->xfer_buf[0] = addr;\r\nmemcpy(&ts->xfer_buf[1], values, length);\r\nretval = i2c_master_send(client, ts->xfer_buf, length + 1);\r\nreturn retval < 0 ? retval : 0;\r\n}\r\nstatic int cyttsp_i2c_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct cyttsp *ts;\r\nif (!i2c_check_functionality(client->adapter, I2C_FUNC_I2C)) {\r\ndev_err(&client->dev, "I2C functionality not Supported\n");\r\nreturn -EIO;\r\n}\r\nts = cyttsp_probe(&cyttsp_i2c_bus_ops, &client->dev, client->irq,\r\nCY_I2C_DATA_SIZE);\r\nif (IS_ERR(ts))\r\nreturn PTR_ERR(ts);\r\ni2c_set_clientdata(client, ts);\r\nreturn 0;\r\n}\r\nstatic int cyttsp_i2c_remove(struct i2c_client *client)\r\n{\r\nstruct cyttsp *ts = i2c_get_clientdata(client);\r\ncyttsp_remove(ts);\r\nreturn 0;\r\n}
