void integrator_impd1_clk_init(void __iomem *base, unsigned int id)\r\n{\r\nstruct impd1_clk *imc;\r\nstruct clk *clk;\r\nint i;\r\nif (id > 3) {\r\npr_crit("no more than 4 LMs can be attached\n");\r\nreturn;\r\n}\r\nimc = &impd1_clks[id];\r\nclk = icst_clk_register(NULL, &impd1_icst1_desc, base);\r\nimc->vcoclk = clk;\r\nimc->clks[0] = clkdev_alloc(clk, NULL, "lm%x:01000", id);\r\nclk = clk_register_fixed_rate(NULL, "uartclk", NULL, CLK_IS_ROOT,\r\n14745600);\r\nimc->uartclk = clk;\r\nimc->clks[1] = clkdev_alloc(clk, NULL, "lm%x:00100", id);\r\nimc->clks[2] = clkdev_alloc(clk, NULL, "lm%x:00200", id);\r\nfor (i = 0; i < ARRAY_SIZE(imc->clks); i++)\r\nclkdev_add(imc->clks[i]);\r\n}\r\nvoid integrator_impd1_clk_exit(unsigned int id)\r\n{\r\nint i;\r\nstruct impd1_clk *imc;\r\nif (id > 3)\r\nreturn;\r\nimc = &impd1_clks[id];\r\nfor (i = 0; i < ARRAY_SIZE(imc->clks); i++)\r\nclkdev_drop(imc->clks[i]);\r\nclk_unregister(imc->uartclk);\r\nclk_unregister(imc->vcoclk);\r\n}
