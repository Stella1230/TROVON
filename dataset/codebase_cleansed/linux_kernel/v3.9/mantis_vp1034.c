int vp1034_set_voltage(struct dvb_frontend *fe, fe_sec_voltage_t voltage)\r\n{\r\nstruct mantis_pci *mantis = fe->dvb->priv;\r\nswitch (voltage) {\r\ncase SEC_VOLTAGE_13:\r\ndprintk(MANTIS_ERROR, 1, "Polarization=[13V]");\r\nmantis_gpio_set_bits(mantis, 13, 1);\r\nmantis_gpio_set_bits(mantis, 14, 0);\r\nbreak;\r\ncase SEC_VOLTAGE_18:\r\ndprintk(MANTIS_ERROR, 1, "Polarization=[18V]");\r\nmantis_gpio_set_bits(mantis, 13, 1);\r\nmantis_gpio_set_bits(mantis, 14, 1);\r\nbreak;\r\ncase SEC_VOLTAGE_OFF:\r\ndprintk(MANTIS_ERROR, 1, "Frontend (dummy) POWERDOWN");\r\nbreak;\r\ndefault:\r\ndprintk(MANTIS_ERROR, 1, "Invalid = (%d)", (u32) voltage);\r\nreturn -EINVAL;\r\n}\r\nmmwrite(0x00, MANTIS_GPIF_DOUT);\r\nreturn 0;\r\n}\r\nstatic int vp1034_frontend_init(struct mantis_pci *mantis, struct dvb_frontend *fe)\r\n{\r\nstruct i2c_adapter *adapter = &mantis->adapter;\r\nint err = 0;\r\nerr = mantis_frontend_power(mantis, POWER_ON);\r\nif (err == 0) {\r\nmantis_frontend_soft_reset(mantis);\r\nmsleep(250);\r\ndprintk(MANTIS_ERROR, 1, "Probing for MB86A16 (DVB-S/DSS)");\r\nfe = dvb_attach(mb86a16_attach, &vp1034_mb86a16_config, adapter);\r\nif (fe) {\r\ndprintk(MANTIS_ERROR, 1,\r\n"found MB86A16 DVB-S/DSS frontend @0x%02x",\r\nvp1034_mb86a16_config.demod_address);\r\n} else {\r\nreturn -1;\r\n}\r\n} else {\r\ndprintk(MANTIS_ERROR, 1, "Frontend on <%s> POWER ON failed! <%d>",\r\nadapter->name,\r\nerr);\r\nreturn -EIO;\r\n}\r\nmantis->fe = fe;\r\ndprintk(MANTIS_ERROR, 1, "Done!");\r\nreturn 0;\r\n}
