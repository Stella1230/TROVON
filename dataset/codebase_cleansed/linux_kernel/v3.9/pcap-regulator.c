static int pcap_regulator_set_voltage_sel(struct regulator_dev *rdev,\r\nunsigned selector)\r\n{\r\nstruct pcap_regulator *vreg = &vreg_table[rdev_get_id(rdev)];\r\nvoid *pcap = rdev_get_drvdata(rdev);\r\nif (rdev->desc->n_voltages == 1)\r\nreturn -EINVAL;\r\nreturn ezx_pcap_set_bits(pcap, vreg->reg,\r\n(rdev->desc->n_voltages - 1) << vreg->index,\r\nselector << vreg->index);\r\n}\r\nstatic int pcap_regulator_get_voltage_sel(struct regulator_dev *rdev)\r\n{\r\nstruct pcap_regulator *vreg = &vreg_table[rdev_get_id(rdev)];\r\nvoid *pcap = rdev_get_drvdata(rdev);\r\nu32 tmp;\r\nif (rdev->desc->n_voltages == 1)\r\nreturn 0;\r\nezx_pcap_read(pcap, vreg->reg, &tmp);\r\ntmp = ((tmp >> vreg->index) & (rdev->desc->n_voltages - 1));\r\nreturn tmp;\r\n}\r\nstatic int pcap_regulator_enable(struct regulator_dev *rdev)\r\n{\r\nstruct pcap_regulator *vreg = &vreg_table[rdev_get_id(rdev)];\r\nvoid *pcap = rdev_get_drvdata(rdev);\r\nif (vreg->en == NA)\r\nreturn -EINVAL;\r\nreturn ezx_pcap_set_bits(pcap, vreg->reg, 1 << vreg->en, 1 << vreg->en);\r\n}\r\nstatic int pcap_regulator_disable(struct regulator_dev *rdev)\r\n{\r\nstruct pcap_regulator *vreg = &vreg_table[rdev_get_id(rdev)];\r\nvoid *pcap = rdev_get_drvdata(rdev);\r\nif (vreg->en == NA)\r\nreturn -EINVAL;\r\nreturn ezx_pcap_set_bits(pcap, vreg->reg, 1 << vreg->en, 0);\r\n}\r\nstatic int pcap_regulator_is_enabled(struct regulator_dev *rdev)\r\n{\r\nstruct pcap_regulator *vreg = &vreg_table[rdev_get_id(rdev)];\r\nvoid *pcap = rdev_get_drvdata(rdev);\r\nu32 tmp;\r\nif (vreg->en == NA)\r\nreturn -EINVAL;\r\nezx_pcap_read(pcap, vreg->reg, &tmp);\r\nreturn (tmp >> vreg->en) & 1;\r\n}\r\nstatic int pcap_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct regulator_dev *rdev;\r\nvoid *pcap = dev_get_drvdata(pdev->dev.parent);\r\nstruct regulator_config config = { };\r\nconfig.dev = &pdev->dev;\r\nconfig.init_data = pdev->dev.platform_data;\r\nconfig.driver_data = pcap;\r\nrdev = regulator_register(&pcap_regulators[pdev->id], &config);\r\nif (IS_ERR(rdev))\r\nreturn PTR_ERR(rdev);\r\nplatform_set_drvdata(pdev, rdev);\r\nreturn 0;\r\n}\r\nstatic int pcap_regulator_remove(struct platform_device *pdev)\r\n{\r\nstruct regulator_dev *rdev = platform_get_drvdata(pdev);\r\nregulator_unregister(rdev);\r\nplatform_set_drvdata(pdev, NULL);\r\nreturn 0;\r\n}\r\nstatic int __init pcap_regulator_init(void)\r\n{\r\nreturn platform_driver_register(&pcap_regulator_driver);\r\n}\r\nstatic void __exit pcap_regulator_exit(void)\r\n{\r\nplatform_driver_unregister(&pcap_regulator_driver);\r\n}
