void brcmf_debugfs_init(void)\r\n{\r\nroot_folder = debugfs_create_dir(KBUILD_MODNAME, NULL);\r\nif (IS_ERR(root_folder))\r\nroot_folder = NULL;\r\n}\r\nvoid brcmf_debugfs_exit(void)\r\n{\r\nif (!root_folder)\r\nreturn;\r\ndebugfs_remove_recursive(root_folder);\r\nroot_folder = NULL;\r\n}\r\nint brcmf_debugfs_attach(struct brcmf_pub *drvr)\r\n{\r\nstruct device *dev = drvr->bus_if->dev;\r\nif (!root_folder)\r\nreturn -ENODEV;\r\ndrvr->dbgfs_dir = debugfs_create_dir(dev_name(dev), root_folder);\r\nreturn PTR_RET(drvr->dbgfs_dir);\r\n}\r\nvoid brcmf_debugfs_detach(struct brcmf_pub *drvr)\r\n{\r\nif (!IS_ERR_OR_NULL(drvr->dbgfs_dir))\r\ndebugfs_remove_recursive(drvr->dbgfs_dir);\r\n}\r\nstruct dentry *brcmf_debugfs_get_devdir(struct brcmf_pub *drvr)\r\n{\r\nreturn drvr->dbgfs_dir;\r\n}\r\nstatic\r\nssize_t brcmf_debugfs_sdio_counter_read(struct file *f, char __user *data,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct brcmf_sdio_count *sdcnt = f->private_data;\r\nchar buf[750];\r\nint res;\r\nif (*ppos > 0)\r\nreturn 0;\r\nres = scnprintf(buf, sizeof(buf),\r\n"intrcount: %u\nlastintrs: %u\n"\r\n"pollcnt: %u\nregfails: %u\n"\r\n"tx_sderrs: %u\nfcqueued: %u\n"\r\n"rxrtx: %u\nrx_toolong: %u\n"\r\n"rxc_errors: %u\nrx_hdrfail: %u\n"\r\n"rx_badhdr: %u\nrx_badseq: %u\n"\r\n"fc_rcvd: %u\nfc_xoff: %u\n"\r\n"fc_xon: %u\nrxglomfail: %u\n"\r\n"rxglomframes: %u\nrxglompkts: %u\n"\r\n"f2rxhdrs: %u\nf2rxdata: %u\n"\r\n"f2txdata: %u\nf1regdata: %u\n"\r\n"tickcnt: %u\ntx_ctlerrs: %lu\n"\r\n"tx_ctlpkts: %lu\nrx_ctlerrs: %lu\n"\r\n"rx_ctlpkts: %lu\nrx_readahead: %lu\n",\r\nsdcnt->intrcount, sdcnt->lastintrs,\r\nsdcnt->pollcnt, sdcnt->regfails,\r\nsdcnt->tx_sderrs, sdcnt->fcqueued,\r\nsdcnt->rxrtx, sdcnt->rx_toolong,\r\nsdcnt->rxc_errors, sdcnt->rx_hdrfail,\r\nsdcnt->rx_badhdr, sdcnt->rx_badseq,\r\nsdcnt->fc_rcvd, sdcnt->fc_xoff,\r\nsdcnt->fc_xon, sdcnt->rxglomfail,\r\nsdcnt->rxglomframes, sdcnt->rxglompkts,\r\nsdcnt->f2rxhdrs, sdcnt->f2rxdata,\r\nsdcnt->f2txdata, sdcnt->f1regdata,\r\nsdcnt->tickcnt, sdcnt->tx_ctlerrs,\r\nsdcnt->tx_ctlpkts, sdcnt->rx_ctlerrs,\r\nsdcnt->rx_ctlpkts, sdcnt->rx_readahead_cnt);\r\nreturn simple_read_from_buffer(data, count, ppos, buf, res);\r\n}\r\nvoid brcmf_debugfs_create_sdio_count(struct brcmf_pub *drvr,\r\nstruct brcmf_sdio_count *sdcnt)\r\n{\r\nstruct dentry *dentry = drvr->dbgfs_dir;\r\nif (!IS_ERR_OR_NULL(dentry))\r\ndebugfs_create_file("counters", S_IRUGO, dentry,\r\nsdcnt, &brcmf_debugfs_sdio_counter_ops);\r\n}
