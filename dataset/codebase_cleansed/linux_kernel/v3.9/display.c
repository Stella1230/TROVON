void omapdss_default_get_resolution(struct omap_dss_device *dssdev,\r\nu16 *xres, u16 *yres)\r\n{\r\n*xres = dssdev->panel.timings.x_res;\r\n*yres = dssdev->panel.timings.y_res;\r\n}\r\nint omapdss_default_get_recommended_bpp(struct omap_dss_device *dssdev)\r\n{\r\nswitch (dssdev->type) {\r\ncase OMAP_DISPLAY_TYPE_DPI:\r\nif (dssdev->phy.dpi.data_lines == 24)\r\nreturn 24;\r\nelse\r\nreturn 16;\r\ncase OMAP_DISPLAY_TYPE_DBI:\r\nif (dssdev->ctrl.pixel_size == 24)\r\nreturn 24;\r\nelse\r\nreturn 16;\r\ncase OMAP_DISPLAY_TYPE_DSI:\r\nif (dsi_get_pixel_size(dssdev->panel.dsi_pix_fmt) > 16)\r\nreturn 24;\r\nelse\r\nreturn 16;\r\ncase OMAP_DISPLAY_TYPE_VENC:\r\ncase OMAP_DISPLAY_TYPE_SDI:\r\ncase OMAP_DISPLAY_TYPE_HDMI:\r\nreturn 24;\r\ndefault:\r\nBUG();\r\nreturn 0;\r\n}\r\n}\r\nvoid omapdss_default_get_timings(struct omap_dss_device *dssdev,\r\nstruct omap_video_timings *timings)\r\n{\r\n*timings = dssdev->panel.timings;\r\n}\r\nstatic int dss_suspend_device(struct device *dev, void *data)\r\n{\r\nstruct omap_dss_device *dssdev = to_dss_device(dev);\r\nif (dssdev->state != OMAP_DSS_DISPLAY_ACTIVE) {\r\ndssdev->activate_after_resume = false;\r\nreturn 0;\r\n}\r\ndssdev->driver->disable(dssdev);\r\ndssdev->activate_after_resume = true;\r\nreturn 0;\r\n}\r\nint dss_suspend_all_devices(void)\r\n{\r\nint r;\r\nstruct bus_type *bus = dss_get_bus();\r\nr = bus_for_each_dev(bus, NULL, NULL, dss_suspend_device);\r\nif (r) {\r\ndss_resume_all_devices();\r\nreturn r;\r\n}\r\nreturn 0;\r\n}\r\nstatic int dss_resume_device(struct device *dev, void *data)\r\n{\r\nint r;\r\nstruct omap_dss_device *dssdev = to_dss_device(dev);\r\nif (dssdev->activate_after_resume) {\r\nr = dssdev->driver->enable(dssdev);\r\nif (r)\r\nreturn r;\r\n}\r\ndssdev->activate_after_resume = false;\r\nreturn 0;\r\n}\r\nint dss_resume_all_devices(void)\r\n{\r\nstruct bus_type *bus = dss_get_bus();\r\nreturn bus_for_each_dev(bus, NULL, NULL, dss_resume_device);\r\n}\r\nstatic int dss_disable_device(struct device *dev, void *data)\r\n{\r\nstruct omap_dss_device *dssdev = to_dss_device(dev);\r\nif (dssdev->state != OMAP_DSS_DISPLAY_DISABLED)\r\ndssdev->driver->disable(dssdev);\r\nreturn 0;\r\n}\r\nvoid dss_disable_all_devices(void)\r\n{\r\nstruct bus_type *bus = dss_get_bus();\r\nbus_for_each_dev(bus, NULL, NULL, dss_disable_device);\r\n}\r\nvoid omap_dss_get_device(struct omap_dss_device *dssdev)\r\n{\r\nget_device(&dssdev->dev);\r\n}\r\nvoid omap_dss_put_device(struct omap_dss_device *dssdev)\r\n{\r\nput_device(&dssdev->dev);\r\n}\r\nint match(struct device *dev, void *data)\r\n{\r\nreturn 1;\r\n}\r\nstruct omap_dss_device *omap_dss_find_device(void *data,\r\nint (*match)(struct omap_dss_device *dssdev, void *data))\r\n{\r\nstruct omap_dss_device *dssdev = NULL;\r\nwhile ((dssdev = omap_dss_get_next_device(dssdev)) != NULL) {\r\nif (match(dssdev, data))\r\nreturn dssdev;\r\n}\r\nreturn NULL;\r\n}\r\nint omap_dss_start_device(struct omap_dss_device *dssdev)\r\n{\r\nif (!dssdev->driver) {\r\nDSSDBG("no driver\n");\r\nreturn -ENODEV;\r\n}\r\nif (!try_module_get(dssdev->dev.driver->owner)) {\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nvoid omap_dss_stop_device(struct omap_dss_device *dssdev)\r\n{\r\nmodule_put(dssdev->dev.driver->owner);\r\n}
