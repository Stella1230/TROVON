static int twl6040_bitclk_is_enabled(struct clk_hw *hw)\r\n{\r\nstruct twl6040_clk *twl6040_clk = container_of(hw, struct twl6040_clk,\r\nmcpdm_fclk);\r\nreturn twl6040_clk->enabled;\r\n}\r\nstatic int twl6040_bitclk_prepare(struct clk_hw *hw)\r\n{\r\nstruct twl6040_clk *twl6040_clk = container_of(hw, struct twl6040_clk,\r\nmcpdm_fclk);\r\nint ret;\r\nret = twl6040_power(twl6040_clk->twl6040, 1);\r\nif (!ret)\r\ntwl6040_clk->enabled = 1;\r\nreturn ret;\r\n}\r\nstatic void twl6040_bitclk_unprepare(struct clk_hw *hw)\r\n{\r\nstruct twl6040_clk *twl6040_clk = container_of(hw, struct twl6040_clk,\r\nmcpdm_fclk);\r\nint ret;\r\nret = twl6040_power(twl6040_clk->twl6040, 0);\r\nif (!ret)\r\ntwl6040_clk->enabled = 0;\r\n}\r\nstatic int twl6040_clk_probe(struct platform_device *pdev)\r\n{\r\nstruct twl6040 *twl6040 = dev_get_drvdata(pdev->dev.parent);\r\nstruct twl6040_clk *clkdata;\r\nclkdata = devm_kzalloc(&pdev->dev, sizeof(*clkdata), GFP_KERNEL);\r\nif (!clkdata)\r\nreturn -ENOMEM;\r\nclkdata->dev = &pdev->dev;\r\nclkdata->twl6040 = twl6040;\r\nclkdata->mcpdm_fclk.init = &wm831x_clkout_init;\r\nclkdata->clk = clk_register(&pdev->dev, &clkdata->mcpdm_fclk);\r\nif (IS_ERR(clkdata->clk))\r\nreturn PTR_ERR(clkdata->clk);\r\ndev_set_drvdata(&pdev->dev, clkdata);\r\nreturn 0;\r\n}\r\nstatic int twl6040_clk_remove(struct platform_device *pdev)\r\n{\r\nstruct twl6040_clk *clkdata = dev_get_drvdata(&pdev->dev);\r\nclk_unregister(clkdata->clk);\r\nreturn 0;\r\n}
