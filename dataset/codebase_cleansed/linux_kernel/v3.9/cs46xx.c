static int snd_card_cs46xx_probe(struct pci_dev *pci,\r\nconst struct pci_device_id *pci_id)\r\n{\r\nstatic int dev;\r\nstruct snd_card *card;\r\nstruct snd_cs46xx *chip;\r\nint err;\r\nif (dev >= SNDRV_CARDS)\r\nreturn -ENODEV;\r\nif (!enable[dev]) {\r\ndev++;\r\nreturn -ENOENT;\r\n}\r\nerr = snd_card_create(index[dev], id[dev], THIS_MODULE, 0, &card);\r\nif (err < 0)\r\nreturn err;\r\nif ((err = snd_cs46xx_create(card, pci,\r\nexternal_amp[dev], thinkpad[dev],\r\n&chip)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\ncard->private_data = chip;\r\nchip->accept_valid = mmap_valid[dev];\r\nif ((err = snd_cs46xx_pcm(chip, 0, NULL)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\n#ifdef CONFIG_SND_CS46XX_NEW_DSP\r\nif ((err = snd_cs46xx_pcm_rear(chip,1, NULL)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\nif ((err = snd_cs46xx_pcm_iec958(chip,2,NULL)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\n#endif\r\nif ((err = snd_cs46xx_mixer(chip, 2)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\n#ifdef CONFIG_SND_CS46XX_NEW_DSP\r\nif (chip->nr_ac97_codecs ==2) {\r\nif ((err = snd_cs46xx_pcm_center_lfe(chip,3,NULL)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\n}\r\n#endif\r\nif ((err = snd_cs46xx_midi(chip, 0, NULL)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\nif ((err = snd_cs46xx_start_dsp(chip)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\nsnd_cs46xx_gameport(chip);\r\nstrcpy(card->driver, "CS46xx");\r\nstrcpy(card->shortname, "Sound Fusion CS46xx");\r\nsprintf(card->longname, "%s at 0x%lx/0x%lx, irq %i",\r\ncard->shortname,\r\nchip->ba0_addr,\r\nchip->ba1_addr,\r\nchip->irq);\r\nif ((err = snd_card_register(card)) < 0) {\r\nsnd_card_free(card);\r\nreturn err;\r\n}\r\npci_set_drvdata(pci, card);\r\ndev++;\r\nreturn 0;\r\n}\r\nstatic void snd_card_cs46xx_remove(struct pci_dev *pci)\r\n{\r\nsnd_card_free(pci_get_drvdata(pci));\r\npci_set_drvdata(pci, NULL);\r\n}
