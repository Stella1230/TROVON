static int\r\nnv04_software_set_ref(struct nouveau_object *object, u32 mthd,\r\nvoid *data, u32 size)\r\n{\r\nstruct nouveau_object *channel = (void *)nv_engctx(object->parent);\r\nstruct nouveau_fifo_chan *fifo = (void *)channel->parent;\r\natomic_set(&fifo->refcnt, *(u32*)data);\r\nreturn 0;\r\n}\r\nstatic int\r\nnv04_software_flip(struct nouveau_object *object, u32 mthd,\r\nvoid *args, u32 size)\r\n{\r\nstruct nv04_software_chan *chan = (void *)nv_engctx(object->parent);\r\nif (chan->base.flip)\r\nreturn chan->base.flip(chan->base.flip_data);\r\nreturn -EINVAL;\r\n}\r\nstatic int\r\nnv04_software_context_ctor(struct nouveau_object *parent,\r\nstruct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct nv04_software_chan *chan;\r\nint ret;\r\nret = nouveau_software_context_create(parent, engine, oclass, &chan);\r\n*pobject = nv_object(chan);\r\nif (ret)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nvoid\r\nnv04_software_intr(struct nouveau_subdev *subdev)\r\n{\r\nnv_mask(subdev, 0x000100, 0x80000000, 0x00000000);\r\n}\r\nstatic int\r\nnv04_software_ctor(struct nouveau_object *parent, struct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct nv04_software_priv *priv;\r\nint ret;\r\nret = nouveau_software_create(parent, engine, oclass, &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\nnv_engine(priv)->cclass = &nv04_software_cclass;\r\nnv_engine(priv)->sclass = nv04_software_sclass;\r\nnv_subdev(priv)->intr = nv04_software_intr;\r\nreturn 0;\r\n}
