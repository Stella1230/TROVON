int\r\nsgl_to_dbl_fcnvff(\r\nsgl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\ndbl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int src, resultp1, resultp2;\r\nregister int src_exponent;\r\nsrc = *srcptr;\r\nsrc_exponent = Sgl_exponent(src);\r\nDbl_allp1(resultp1) = Sgl_all(src);\r\nif (src_exponent == SGL_INFINITY_EXPONENT) {\r\nif (Sgl_iszero_mantissa(src)) {\r\nDbl_setinfinity_exponentmantissa(resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nelse {\r\nif (Sgl_isone_signaling(src)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nelse {\r\nSet_invalidflag();\r\nSgl_set_quiet(src);\r\n}\r\n}\r\nDbl_setinfinity_exponent(resultp1);\r\nSgl_to_dbl_mantissa(src,resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nif (src_exponent == 0) {\r\nif (Sgl_isnotzero_mantissa(src)) {\r\nSgl_clear_signexponent(src);\r\nSgl_leftshiftby1(src);\r\nSgl_normalize(src,src_exponent);\r\nSgl_to_dbl_exponent(src_exponent,resultp1);\r\nSgl_to_dbl_mantissa(src,resultp1,resultp2);\r\n}\r\nelse {\r\nDbl_setzero_exponentmantissa(resultp1,resultp2);\r\n}\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nSgl_to_dbl_exponent(src_exponent, resultp1);\r\nSgl_to_dbl_mantissa(Sgl_mantissa(src), resultp1,resultp2);\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nint\r\ndbl_to_sgl_fcnvff(\r\ndbl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\nsgl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int srcp1, srcp2, result;\r\nregister int src_exponent, dest_exponent, dest_mantissa;\r\nregister boolean inexact = FALSE, guardbit = FALSE, stickybit = FALSE;\r\nregister boolean lsb_odd = FALSE;\r\nboolean is_tiny;\r\nDbl_copyfromptr(srcptr,srcp1,srcp2);\r\nsrc_exponent = Dbl_exponent(srcp1);\r\nSgl_all(result) = Dbl_allp1(srcp1);\r\nif (src_exponent == DBL_INFINITY_EXPONENT) {\r\nif (Dbl_iszero_mantissa(srcp1,srcp2)) {\r\nSgl_setinfinity_exponentmantissa(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Dbl_isone_signaling(srcp1)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nelse {\r\nSet_invalidflag();\r\nDbl_set_quiet(srcp1);\r\n}\r\n}\r\nSgl_setinfinity_exponent(result);\r\nSgl_set_mantissa(result,Dallp1(srcp1)<<3 | Dallp2(srcp2)>>29);\r\nif (Sgl_iszero_mantissa(result)) Sgl_set_quiet(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\nDbl_to_sgl_exponent(src_exponent,dest_exponent);\r\nif (dest_exponent > 0) {\r\nDbl_to_sgl_mantissa(srcp1,srcp2,dest_mantissa,inexact,guardbit,\r\nstickybit,lsb_odd);\r\n}\r\nelse {\r\nif (Dbl_iszero_exponentmantissa(srcp1,srcp2)){\r\nSgl_setzero_exponentmantissa(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Is_underflowtrap_enabled()) {\r\nDbl_to_sgl_mantissa(srcp1,srcp2,dest_mantissa,inexact,\r\nguardbit,stickybit,lsb_odd);\r\n}\r\nelse {\r\nDbl_to_sgl_denormalized(srcp1,srcp2,dest_exponent,\r\ndest_mantissa,inexact,guardbit,stickybit,lsb_odd,\r\nis_tiny);\r\n}\r\n}\r\nif (inexact) {\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Sgl_iszero_sign(result)) dest_mantissa++;\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Sgl_isone_sign(result)) dest_mantissa++;\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (guardbit) {\r\nif (stickybit || lsb_odd) dest_mantissa++;\r\n}\r\n}\r\n}\r\nSgl_set_exponentmantissa(result,dest_mantissa);\r\nif ((dest_exponent>0 || Is_underflowtrap_enabled()) &&\r\nSgl_isone_hidden(result)) dest_exponent++;\r\nif (dest_exponent >= SGL_INFINITY_EXPONENT) {\r\nif (Is_overflowtrap_enabled()) {\r\nif (dest_exponent >= SGL_INFINITY_EXPONENT+SGL_WRAP)\r\nreturn(UNIMPLEMENTEDEXCEPTION);\r\nSgl_setwrapped_exponent(result,dest_exponent,ovfl);\r\n*dstptr = result;\r\nif (inexact)\r\nif (Is_inexacttrap_enabled())\r\nreturn(OVERFLOWEXCEPTION|INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\nreturn(OVERFLOWEXCEPTION);\r\n}\r\nSet_overflowflag();\r\ninexact = TRUE;\r\nSgl_setoverflow(result);\r\n}\r\nelse if (dest_exponent <= 0) {\r\nif (Is_underflowtrap_enabled()) {\r\nif (dest_exponent <= -(SGL_WRAP))\r\nreturn(UNIMPLEMENTEDEXCEPTION);\r\nSgl_setwrapped_exponent(result,dest_exponent,unfl);\r\n*dstptr = result;\r\nif (inexact)\r\nif (Is_inexacttrap_enabled())\r\nreturn(UNDERFLOWEXCEPTION|INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\nreturn(UNDERFLOWEXCEPTION);\r\n}\r\nif (inexact && is_tiny) Set_underflowflag();\r\n}\r\nelse Sgl_set_exponent(result,dest_exponent);\r\n*dstptr = result;\r\nif (inexact)\r\nif (Is_inexacttrap_enabled()) return(INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\nreturn(NOEXCEPTION);\r\n}
