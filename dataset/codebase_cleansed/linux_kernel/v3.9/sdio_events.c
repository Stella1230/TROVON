void unifi_suspend(void *ospriv)\r\n{\r\nunifi_priv_t *priv = ospriv;\r\nint interfaceTag=0;\r\npriv->wol_suspend = (enable_wol == UNIFI_WOL_OFF) ? FALSE : TRUE;\r\nunifi_trace(priv, UDBG1, "unifi_suspend: wol_suspend %d, enable_wol %d",\r\npriv->wol_suspend, enable_wol );\r\nfor( interfaceTag=0;interfaceTag<CSR_WIFI_NUM_INTERFACES;interfaceTag++)\r\n{\r\nnetInterface_priv_t *interfacePriv = priv->interfacePriv[interfaceTag];\r\nif (interfacePriv->netdev_registered == 1)\r\n{\r\nif( priv->wol_suspend ) {\r\nunifi_trace(priv, UDBG1, "unifi_suspend: Don't netif_carrier_off");\r\n} else {\r\nunifi_trace(priv, UDBG1, "unifi_suspend: netif_carrier_off");\r\nnetif_carrier_off(priv->netdev[interfaceTag]);\r\n}\r\nnetif_tx_stop_all_queues(priv->netdev[interfaceTag]);\r\n}\r\n}\r\nunifi_trace(priv, UDBG1, "unifi_suspend: suspend SME");\r\nsme_sys_suspend(priv);\r\n}\r\nvoid unifi_resume(void *ospriv)\r\n{\r\nunifi_priv_t *priv = ospriv;\r\nint interfaceTag=0;\r\nint r;\r\nint wol = priv->wol_suspend;\r\nunifi_trace(priv, UDBG1, "unifi_resume: resume SME, enable_wol=%d", enable_wol);\r\nr = sme_sys_resume(priv);\r\nif (r) {\r\nunifi_error(priv, "Failed to resume UniFi\n");\r\n}\r\nif (wol) {\r\nunifi_trace(priv, UDBG1, "unifi_resume: try to enable carrier");\r\nfor( interfaceTag=0;interfaceTag<CSR_WIFI_NUM_INTERFACES;interfaceTag++) {\r\nnetInterface_priv_t *interfacePriv = priv->interfacePriv[interfaceTag];\r\nunifi_trace(priv, UDBG1, "unifi_resume: interfaceTag %d netdev_registered %d mode %d\n",\r\ninterfaceTag, interfacePriv->netdev_registered, interfacePriv->interfaceMode);\r\nif (interfacePriv->netdev_registered == 1)\r\n{\r\nnetif_carrier_on(priv->netdev[interfaceTag]);\r\nnetif_tx_start_all_queues(priv->netdev[interfaceTag]);\r\n}\r\n}\r\nunifi_send_signal(priv->card, NULL, 0, NULL);\r\n}\r\n}
