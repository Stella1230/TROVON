static ssize_t mlog_mask_show(u64 mask, char *buf)\r\n{\r\nchar *state;\r\nif (__mlog_test_u64(mask, r2_mlog_and_bits))\r\nstate = "allow";\r\nelse if (__mlog_test_u64(mask, r2_mlog_not_bits))\r\nstate = "deny";\r\nelse\r\nstate = "off";\r\nreturn snprintf(buf, PAGE_SIZE, "%s\n", state);\r\n}\r\nstatic ssize_t mlog_mask_store(u64 mask, const char *buf, size_t count)\r\n{\r\nif (!strnicmp(buf, "allow", 5)) {\r\n__mlog_set_u64(mask, r2_mlog_and_bits);\r\n__mlog_clear_u64(mask, r2_mlog_not_bits);\r\n} else if (!strnicmp(buf, "deny", 4)) {\r\n__mlog_set_u64(mask, r2_mlog_not_bits);\r\n__mlog_clear_u64(mask, r2_mlog_and_bits);\r\n} else if (!strnicmp(buf, "off", 3)) {\r\n__mlog_clear_u64(mask, r2_mlog_not_bits);\r\n__mlog_clear_u64(mask, r2_mlog_and_bits);\r\n} else\r\nreturn -EINVAL;\r\nreturn count;\r\n}\r\nstatic ssize_t mlog_show(struct kobject *obj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct mlog_attribute *mlog_attr = to_mlog_attr(attr);\r\nreturn mlog_mask_show(mlog_attr->mask, buf);\r\n}\r\nstatic ssize_t mlog_store(struct kobject *obj, struct attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct mlog_attribute *mlog_attr = to_mlog_attr(attr);\r\nreturn mlog_mask_store(mlog_attr->mask, buf, count);\r\n}\r\nint r2_mlog_sys_init(struct kset *r2cb_kset)\r\n{\r\nint i = 0;\r\nwhile (mlog_attrs[i].attr.mode) {\r\nmlog_attr_ptrs[i] = &mlog_attrs[i].attr;\r\ni++;\r\n}\r\nmlog_attr_ptrs[i] = NULL;\r\nkobject_set_name(&mlog_kset.kobj, "logmask");\r\nmlog_kset.kobj.kset = r2cb_kset;\r\nreturn kset_register(&mlog_kset);\r\n}\r\nvoid r2_mlog_sys_shutdown(void)\r\n{\r\nkset_unregister(&mlog_kset);\r\n}
