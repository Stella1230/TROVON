static void locomoled_brightness_set(struct led_classdev *led_cdev,\r\nenum led_brightness value, int offset)\r\n{\r\nstruct locomo_dev *locomo_dev = LOCOMO_DEV(led_cdev->dev->parent);\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\nif (value)\r\nlocomo_writel(LOCOMO_LPT_TOFH, locomo_dev->mapbase + offset);\r\nelse\r\nlocomo_writel(LOCOMO_LPT_TOFL, locomo_dev->mapbase + offset);\r\nlocal_irq_restore(flags);\r\n}\r\nstatic void locomoled_brightness_set0(struct led_classdev *led_cdev,\r\nenum led_brightness value)\r\n{\r\nlocomoled_brightness_set(led_cdev, value, LOCOMO_LPT0);\r\n}\r\nstatic void locomoled_brightness_set1(struct led_classdev *led_cdev,\r\nenum led_brightness value)\r\n{\r\nlocomoled_brightness_set(led_cdev, value, LOCOMO_LPT1);\r\n}\r\nstatic int locomoled_probe(struct locomo_dev *ldev)\r\n{\r\nint ret;\r\nret = led_classdev_register(&ldev->dev, &locomo_led0);\r\nif (ret < 0)\r\nreturn ret;\r\nret = led_classdev_register(&ldev->dev, &locomo_led1);\r\nif (ret < 0)\r\nled_classdev_unregister(&locomo_led0);\r\nreturn ret;\r\n}\r\nstatic int locomoled_remove(struct locomo_dev *dev)\r\n{\r\nled_classdev_unregister(&locomo_led0);\r\nled_classdev_unregister(&locomo_led1);\r\nreturn 0;\r\n}\r\nstatic int __init locomoled_init(void)\r\n{\r\nreturn locomo_driver_register(&locomoled_driver);\r\n}
