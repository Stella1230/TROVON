static int\r\nnvc0_clock_pll_set(struct nouveau_clock *clk, u32 type, u32 freq)\r\n{\r\nstruct nvc0_clock_priv *priv = (void *)clk;\r\nstruct nouveau_bios *bios = nouveau_bios(priv);\r\nstruct nvbios_pll info;\r\nint N, fN, M, P;\r\nint ret;\r\nret = nvbios_pll_parse(bios, type, &info);\r\nif (ret)\r\nreturn ret;\r\nret = nva3_pll_calc(clk, &info, freq, &N, &fN, &M, &P);\r\nif (ret < 0)\r\nreturn ret;\r\nswitch (info.type) {\r\ncase PLL_VPLL0:\r\ncase PLL_VPLL1:\r\ncase PLL_VPLL2:\r\ncase PLL_VPLL3:\r\nnv_mask(priv, info.reg + 0x0c, 0x00000000, 0x00000100);\r\nnv_wr32(priv, info.reg + 0x04, (P << 16) | (N << 8) | M);\r\nnv_wr32(priv, info.reg + 0x10, fN << 16);\r\nbreak;\r\ndefault:\r\nnv_warn(priv, "0x%08x/%dKhz unimplemented\n", type, freq);\r\nret = -EINVAL;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int\r\nnvc0_clock_ctor(struct nouveau_object *parent, struct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct nvc0_clock_priv *priv;\r\nint ret;\r\nret = nouveau_clock_create(parent, engine, oclass, &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\npriv->base.pll_set = nvc0_clock_pll_set;\r\npriv->base.pll_calc = nva3_clock_pll_calc;\r\nreturn 0;\r\n}
