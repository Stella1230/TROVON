static int adis_data_rdy_trigger_set_state(struct iio_trigger *trig,\r\nbool state)\r\n{\r\nstruct adis *adis = trig->private_data;\r\nreturn adis_enable_irq(adis, state);\r\n}\r\nint adis_probe_trigger(struct adis *adis, struct iio_dev *indio_dev)\r\n{\r\nint ret;\r\nadis->trig = iio_trigger_alloc("%s-dev%d", indio_dev->name,\r\nindio_dev->id);\r\nif (adis->trig == NULL)\r\nreturn -ENOMEM;\r\nret = request_irq(adis->spi->irq,\r\n&iio_trigger_generic_data_rdy_poll,\r\nIRQF_TRIGGER_RISING,\r\nindio_dev->name,\r\nadis->trig);\r\nif (ret)\r\ngoto error_free_trig;\r\nadis->trig->dev.parent = &adis->spi->dev;\r\nadis->trig->ops = &adis_trigger_ops;\r\nadis->trig->private_data = adis;\r\nret = iio_trigger_register(adis->trig);\r\nindio_dev->trig = adis->trig;\r\nif (ret)\r\ngoto error_free_irq;\r\nreturn 0;\r\nerror_free_irq:\r\nfree_irq(adis->spi->irq, adis->trig);\r\nerror_free_trig:\r\niio_trigger_free(adis->trig);\r\nreturn ret;\r\n}\r\nvoid adis_remove_trigger(struct adis *adis)\r\n{\r\niio_trigger_unregister(adis->trig);\r\nfree_irq(adis->spi->irq, adis->trig);\r\niio_trigger_free(adis->trig);\r\n}
