static void debug_data(struct device *dev, const char *function, int len,\r\nconst unsigned char *data, int result)\r\n{\r\ndev_dbg(dev, "result = %d\n", result);\r\nif (result == len)\r\ndev_dbg(dev, "%s - length = %d, data = %*ph\n", function,\r\nlen, len, data);\r\n}\r\nstatic int zte_ev_usb_serial_open(struct tty_struct *tty,\r\nstruct usb_serial_port *port)\r\n{\r\nstruct usb_device *udev = port->serial->dev;\r\nstruct device *dev = &port->dev;\r\nint result = 0;\r\nint len;\r\nunsigned char *buf;\r\nif (port->number != 0)\r\nreturn -ENODEV;\r\nbuf = kmalloc(MAX_SETUP_DATA_SIZE, GFP_KERNEL);\r\nif (!buf)\r\nreturn -ENOMEM;\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0001, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nlen = 0x0007;\r\nresult = usb_control_msg(udev, usb_rcvctrlpipe(udev, 0),\r\n0x21, 0xa1,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0x0007;\r\nbuf[0] = 0x80;\r\nbuf[1] = 0x25;\r\nbuf[2] = 0x00;\r\nbuf[3] = 0x00;\r\nbuf[4] = 0x00;\r\nbuf[5] = 0x00;\r\nbuf[6] = 0x08;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x20, 0x21,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0003, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nlen = 0x0007;\r\nresult = usb_control_msg(udev, usb_rcvctrlpipe(udev, 0),\r\n0x21, 0xa1,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0x0007;\r\nbuf[0] = 0x80;\r\nbuf[1] = 0x25;\r\nbuf[2] = 0x00;\r\nbuf[3] = 0x00;\r\nbuf[4] = 0x00;\r\nbuf[5] = 0x00;\r\nbuf[6] = 0x08;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x20, 0x21,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nkfree(buf);\r\nreturn usb_serial_generic_open(tty, port);\r\n}\r\nstatic void zte_ev_usb_serial_close(struct usb_serial_port *port)\r\n{\r\nstruct usb_device *udev = port->serial->dev;\r\nstruct device *dev = &port->dev;\r\nint result = 0;\r\nint len;\r\nunsigned char *buf;\r\nif (port->number != 0)\r\nreturn;\r\nbuf = kmalloc(MAX_SETUP_DATA_SIZE, GFP_KERNEL);\r\nif (!buf)\r\nreturn;\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0002, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0003, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nlen = 0x0007;\r\nresult = usb_control_msg(udev, usb_rcvctrlpipe(udev, 0),\r\n0x21, 0xa1,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0x0007;\r\nbuf[0] = 0x00;\r\nbuf[1] = 0xc2;\r\nbuf[2] = 0x01;\r\nbuf[3] = 0x00;\r\nbuf[4] = 0x00;\r\nbuf[5] = 0x00;\r\nbuf[6] = 0x08;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x20, 0x21,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0003, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nlen = 0x0007;\r\nresult = usb_control_msg(udev, usb_rcvctrlpipe(udev, 0),\r\n0x21, 0xa1,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0x0007;\r\nbuf[0] = 0x00;\r\nbuf[1] = 0xc2;\r\nbuf[2] = 0x01;\r\nbuf[3] = 0x00;\r\nbuf[4] = 0x00;\r\nbuf[5] = 0x00;\r\nbuf[6] = 0x08;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x20, 0x21,\r\n0x0000, 0x0000, buf, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndebug_data(dev, __func__, len, buf, result);\r\nlen = 0;\r\nresult = usb_control_msg(udev, usb_sndctrlpipe(udev, 0),\r\n0x22, 0x21,\r\n0x0003, 0x0000, NULL, len,\r\nHZ * USB_CTRL_GET_TIMEOUT);\r\ndev_dbg(dev, "result = %d\n", result);\r\nkfree(buf);\r\nusb_serial_generic_close(port);\r\n}
