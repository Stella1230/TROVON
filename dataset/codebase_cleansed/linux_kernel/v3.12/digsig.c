int integrity_digsig_verify(const unsigned int id, const char *sig, int siglen,\r\nconst char *digest, int digestlen)\r\n{\r\nif (id >= INTEGRITY_KEYRING_MAX)\r\nreturn -EINVAL;\r\nif (!keyring[id]) {\r\nkeyring[id] =\r\nrequest_key(&key_type_keyring, keyring_name[id], NULL);\r\nif (IS_ERR(keyring[id])) {\r\nint err = PTR_ERR(keyring[id]);\r\npr_err("no %s keyring: %d\n", keyring_name[id], err);\r\nkeyring[id] = NULL;\r\nreturn err;\r\n}\r\n}\r\nswitch (sig[0]) {\r\ncase 1:\r\nreturn digsig_verify(keyring[id], sig, siglen,\r\ndigest, digestlen);\r\ncase 2:\r\nreturn asymmetric_verify(keyring[id], sig, siglen,\r\ndigest, digestlen);\r\n}\r\nreturn -EOPNOTSUPP;\r\n}
