static int ixp4xx_rng_data_read(struct hwrng *rng, u32 *buffer)\r\n{\r\nvoid __iomem * rng_base = (void __iomem *)rng->priv;\r\n*buffer = __raw_readl(rng_base);\r\nreturn 4;\r\n}\r\nstatic int __init ixp4xx_rng_init(void)\r\n{\r\nvoid __iomem * rng_base;\r\nint err;\r\nif (!cpu_is_ixp46x())\r\nreturn -ENOSYS;\r\nrng_base = ioremap(0x70002100, 4);\r\nif (!rng_base)\r\nreturn -ENOMEM;\r\nixp4xx_rng_ops.priv = (unsigned long)rng_base;\r\nerr = hwrng_register(&ixp4xx_rng_ops);\r\nif (err)\r\niounmap(rng_base);\r\nreturn err;\r\n}\r\nstatic void __exit ixp4xx_rng_exit(void)\r\n{\r\nvoid __iomem * rng_base = (void __iomem *)ixp4xx_rng_ops.priv;\r\nhwrng_unregister(&ixp4xx_rng_ops);\r\niounmap(rng_base);\r\n}
