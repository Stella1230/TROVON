struct pci_dev *comedi_to_pci_dev(struct comedi_device *dev)\r\n{\r\nreturn dev->hw_dev ? to_pci_dev(dev->hw_dev) : NULL;\r\n}\r\nint comedi_pci_enable(struct comedi_device *dev)\r\n{\r\nstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\r\nint rc;\r\nif (!pcidev)\r\nreturn -ENODEV;\r\nrc = pci_enable_device(pcidev);\r\nif (rc < 0)\r\nreturn rc;\r\nrc = pci_request_regions(pcidev, dev->board_name);\r\nif (rc < 0)\r\npci_disable_device(pcidev);\r\nelse\r\ndev->ioenabled = true;\r\nreturn rc;\r\n}\r\nvoid comedi_pci_disable(struct comedi_device *dev)\r\n{\r\nstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\r\nif (pcidev && dev->ioenabled) {\r\npci_release_regions(pcidev);\r\npci_disable_device(pcidev);\r\n}\r\ndev->ioenabled = false;\r\n}\r\nint comedi_pci_auto_config(struct pci_dev *pcidev,\r\nstruct comedi_driver *driver,\r\nunsigned long context)\r\n{\r\nreturn comedi_auto_config(&pcidev->dev, driver, context);\r\n}\r\nvoid comedi_pci_auto_unconfig(struct pci_dev *pcidev)\r\n{\r\ncomedi_auto_unconfig(&pcidev->dev);\r\n}\r\nint comedi_pci_driver_register(struct comedi_driver *comedi_driver,\r\nstruct pci_driver *pci_driver)\r\n{\r\nint ret;\r\nret = comedi_driver_register(comedi_driver);\r\nif (ret < 0)\r\nreturn ret;\r\nret = pci_register_driver(pci_driver);\r\nif (ret < 0) {\r\ncomedi_driver_unregister(comedi_driver);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nvoid comedi_pci_driver_unregister(struct comedi_driver *comedi_driver,\r\nstruct pci_driver *pci_driver)\r\n{\r\npci_unregister_driver(pci_driver);\r\ncomedi_driver_unregister(comedi_driver);\r\n}
