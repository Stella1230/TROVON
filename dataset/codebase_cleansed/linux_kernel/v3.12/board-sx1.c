int sx1_i2c_write_byte(u8 devaddr, u8 regoffset, u8 value)\r\n{\r\nstruct i2c_adapter *adap;\r\nint err;\r\nstruct i2c_msg msg[1];\r\nunsigned char data[2];\r\nadap = i2c_get_adapter(0);\r\nif (!adap)\r\nreturn -ENODEV;\r\nmsg->addr = devaddr;\r\nmsg->flags = 0;\r\nmsg->len = 2;\r\nmsg->buf = data;\r\ndata[0] = regoffset;\r\ndata[1] = value;\r\nerr = i2c_transfer(adap, msg, 1);\r\ni2c_put_adapter(adap);\r\nif (err >= 0)\r\nreturn 0;\r\nreturn err;\r\n}\r\nint sx1_i2c_read_byte(u8 devaddr, u8 regoffset, u8 *value)\r\n{\r\nstruct i2c_adapter *adap;\r\nint err;\r\nstruct i2c_msg msg[1];\r\nunsigned char data[2];\r\nadap = i2c_get_adapter(0);\r\nif (!adap)\r\nreturn -ENODEV;\r\nmsg->addr = devaddr;\r\nmsg->flags = 0;\r\nmsg->len = 1;\r\nmsg->buf = data;\r\ndata[0] = regoffset;\r\nerr = i2c_transfer(adap, msg, 1);\r\nmsg->addr = devaddr;\r\nmsg->flags = I2C_M_RD;\r\nmsg->len = 1;\r\nmsg->buf = data;\r\nerr = i2c_transfer(adap, msg, 1);\r\n*value = data[0];\r\ni2c_put_adapter(adap);\r\nif (err >= 0)\r\nreturn 0;\r\nreturn err;\r\n}\r\nint sx1_setkeylight(u8 keylight)\r\n{\r\nif (keylight > SOFIA_MAX_LIGHT_VAL)\r\nkeylight = SOFIA_MAX_LIGHT_VAL;\r\nreturn sx1_i2c_write_byte(SOFIA_I2C_ADDR, SOFIA_KEYLIGHT_REG, keylight);\r\n}\r\nint sx1_getkeylight(u8 * keylight)\r\n{\r\nreturn sx1_i2c_read_byte(SOFIA_I2C_ADDR, SOFIA_KEYLIGHT_REG, keylight);\r\n}\r\nint sx1_setbacklight(u8 backlight)\r\n{\r\nif (backlight > SOFIA_MAX_LIGHT_VAL)\r\nbacklight = SOFIA_MAX_LIGHT_VAL;\r\nreturn sx1_i2c_write_byte(SOFIA_I2C_ADDR, SOFIA_BACKLIGHT_REG,\r\nbacklight);\r\n}\r\nint sx1_getbacklight (u8 * backlight)\r\n{\r\nreturn sx1_i2c_read_byte(SOFIA_I2C_ADDR, SOFIA_BACKLIGHT_REG,\r\nbacklight);\r\n}\r\nint sx1_setmmipower(u8 onoff)\r\n{\r\nint err;\r\nu8 dat = 0;\r\nerr = sx1_i2c_read_byte(SOFIA_I2C_ADDR, SOFIA_POWER1_REG, &dat);\r\nif (err < 0)\r\nreturn err;\r\nif (onoff)\r\ndat |= SOFIA_MMILIGHT_POWER;\r\nelse\r\ndat &= ~SOFIA_MMILIGHT_POWER;\r\nreturn sx1_i2c_write_byte(SOFIA_I2C_ADDR, SOFIA_POWER1_REG, dat);\r\n}\r\nint sx1_setusbpower(u8 onoff)\r\n{\r\nint err;\r\nu8 dat = 0;\r\nerr = sx1_i2c_read_byte(SOFIA_I2C_ADDR, SOFIA_POWER1_REG, &dat);\r\nif (err < 0)\r\nreturn err;\r\nif (onoff)\r\ndat |= SOFIA_USB_POWER;\r\nelse\r\ndat &= ~SOFIA_USB_POWER;\r\nreturn sx1_i2c_write_byte(SOFIA_I2C_ADDR, SOFIA_POWER1_REG, dat);\r\n}\r\nstatic void __init omap_sx1_init(void)\r\n{\r\nomap_cfg_reg(UART1_TX);\r\nomap_cfg_reg(UART1_RTS);\r\nomap_cfg_reg(UART2_TX);\r\nomap_cfg_reg(UART2_RTS);\r\nomap_cfg_reg(UART3_TX);\r\nomap_cfg_reg(UART3_RX);\r\nplatform_add_devices(sx1_devices, ARRAY_SIZE(sx1_devices));\r\nomap_serial_init();\r\nomap_register_i2c_bus(1, 100, NULL, 0);\r\nomap1_usb_init(&sx1_usb_config);\r\nsx1_mmc_init();\r\ngpio_request(1, "A_IRDA_OFF");\r\ngpio_request(11, "A_SWITCH");\r\ngpio_request(15, "A_USB_ON");\r\ngpio_direction_output(1, 1);\r\ngpio_direction_output(11, 0);\r\ngpio_direction_output(15, 0);\r\nomapfb_set_lcd_config(&sx1_lcd_config);\r\n}
