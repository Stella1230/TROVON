static int inline ek_have_2mmc(void)\r\n{\r\nreturn machine_is_at91sam9g20ek_2mmc() || (system_rev & HAVE_2MMC);\r\n}\r\nstatic void __init ek_init_early(void)\r\n{\r\nat91_initialize(18432000);\r\n}\r\nstatic void __init ek_add_device_macb(void)\r\n{\r\nif (ek_have_2mmc())\r\nek_macb_data.phy_irq_pin = AT91_PIN_PB0;\r\nat91_add_device_eth(&ek_macb_data);\r\n}\r\nstatic void __init ek_add_device_nand(void)\r\n{\r\nek_nand_data.bus_width_16 = board_have_nand_16bit();\r\nif (ek_nand_data.bus_width_16)\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_16;\r\nelse\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_8;\r\nsam9_smc_configure(0, 3, &ek_nand_smc_config);\r\nat91_add_device_nand(&ek_nand_data);\r\n}\r\nstatic void __init ek_add_device_mmc(void)\r\n{\r\nif (ek_have_2mmc()) {\r\nek_mmc_data.slot[0].bus_width = 4;\r\nek_mmc_data.slot[0].detect_pin = AT91_PIN_PC2;\r\nek_mmc_data.slot[0].wp_pin = -1;\r\n}\r\nat91_add_device_mci(0, &ek_mmc_data);\r\n}\r\nstatic void __init ek_add_device_gpio_leds(void)\r\n{\r\nif (ek_have_2mmc()) {\r\nek_leds[0].gpio = AT91_PIN_PB8;\r\nek_leds[1].gpio = AT91_PIN_PB9;\r\n}\r\nat91_gpio_leds(ek_leds, ARRAY_SIZE(ek_leds));\r\n}\r\nstatic void __init ek_add_device_buttons(void)\r\n{\r\nat91_set_gpio_input(AT91_PIN_PA30, 1);\r\nat91_set_deglitch(AT91_PIN_PA30, 1);\r\nat91_set_gpio_input(AT91_PIN_PA31, 1);\r\nat91_set_deglitch(AT91_PIN_PA31, 1);\r\nplatform_device_register(&ek_button_device);\r\n}\r\nstatic void __init ek_add_device_buttons(void) {}\r\nstatic void __init ek_add_regulators(void)\r\n{\r\nplatform_device_register(&ek_voltage_regulator);\r\n}\r\nstatic void __init ek_add_regulators(void) {}\r\nstatic void __init ek_add_device_audio(void)\r\n{\r\nplatform_device_register(&sam9g20ek_audio_device);\r\n}\r\nstatic void __init ek_board_init(void)\r\n{\r\nat91_register_uart(0, 0, 0);\r\nat91_register_uart(AT91SAM9260_ID_US0, 1, ATMEL_UART_CTS | ATMEL_UART_RTS\r\n| ATMEL_UART_DTR | ATMEL_UART_DSR | ATMEL_UART_DCD\r\n| ATMEL_UART_RI);\r\nat91_register_uart(AT91SAM9260_ID_US1, 2, ATMEL_UART_CTS | ATMEL_UART_RTS);\r\nat91_add_device_serial();\r\nat91_add_device_usbh(&ek_usbh_data);\r\nat91_add_device_udc(&ek_udc_data);\r\nat91_add_device_spi(ek_spi_devices, ARRAY_SIZE(ek_spi_devices));\r\nek_add_device_nand();\r\nek_add_device_macb();\r\nek_add_regulators();\r\nek_add_device_mmc();\r\nat91_add_device_i2c(ek_i2c_devices, ARRAY_SIZE(ek_i2c_devices));\r\nek_add_device_gpio_leds();\r\nek_add_device_buttons();\r\nat91_add_device_adc(&ek_adc_data);\r\nat91_set_B_periph(AT91_PIN_PC1, 0);\r\nat91_add_device_ssc(AT91SAM9260_ID_SSC, ATMEL_SSC_TX);\r\nek_add_device_audio();\r\n}
