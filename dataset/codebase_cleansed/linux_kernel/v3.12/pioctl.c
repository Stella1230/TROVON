static int coda_ioctl_permission(struct inode *inode, int mask)\r\n{\r\nreturn (mask & MAY_EXEC) ? -EACCES : 0;\r\n}\r\nstatic long coda_pioctl(struct file *filp, unsigned int cmd,\r\nunsigned long user_data)\r\n{\r\nstruct path path;\r\nint error;\r\nstruct PioctlData data;\r\nstruct inode *inode = file_inode(filp);\r\nstruct inode *target_inode = NULL;\r\nstruct coda_inode_info *cnp;\r\nif (copy_from_user(&data, (void __user *)user_data, sizeof(data)))\r\nreturn -EINVAL;\r\nif (data.follow)\r\nerror = user_path(data.path, &path);\r\nelse\r\nerror = user_lpath(data.path, &path);\r\nif (error)\r\nreturn error;\r\ntarget_inode = path.dentry->d_inode;\r\nif (target_inode->i_sb != inode->i_sb) {\r\nerror = -EINVAL;\r\ngoto out;\r\n}\r\ncnp = ITOC(target_inode);\r\nerror = venus_pioctl(inode->i_sb, &(cnp->c_fid), cmd, &data);\r\nout:\r\npath_put(&path);\r\nreturn error;\r\n}
