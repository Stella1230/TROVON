static void tuntap_init(struct net_device *dev, void *data)\r\n{\r\nstruct uml_net_private *pri;\r\nstruct tuntap_data *tpri;\r\nstruct tuntap_init *init = data;\r\npri = netdev_priv(dev);\r\ntpri = (struct tuntap_data *) pri->user;\r\ntpri->dev_name = init->dev_name;\r\ntpri->fixed_config = (init->dev_name != NULL);\r\ntpri->gate_addr = init->gate_addr;\r\ntpri->fd = -1;\r\ntpri->dev = dev;\r\nprintk(KERN_INFO "TUN/TAP backend - ");\r\nif (tpri->gate_addr != NULL)\r\nprintk(KERN_CONT "IP = %s", tpri->gate_addr);\r\nprintk(KERN_CONT "\n");\r\n}\r\nstatic int tuntap_read(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn net_read(fd, skb_mac_header(skb),\r\nskb->dev->mtu + ETH_HEADER_OTHER);\r\n}\r\nstatic int tuntap_write(int fd, struct sk_buff *skb, struct uml_net_private *lp)\r\n{\r\nreturn net_write(fd, skb->data, skb->len);\r\n}\r\nint tuntap_setup(char *str, char **mac_out, void *data)\r\n{\r\nstruct tuntap_init *init = data;\r\n*init = ((struct tuntap_init)\r\n{ .dev_name = NULL,\r\n.gate_addr = NULL });\r\nif (tap_setup_common(str, "tuntap", &init->dev_name, mac_out,\r\n&init->gate_addr))\r\nreturn 0;\r\nreturn 1;\r\n}\r\nstatic int register_tuntap(void)\r\n{\r\nregister_transport(&tuntap_transport);\r\nreturn 0;\r\n}
