static int cit_write_reg(struct gspca_dev *gspca_dev, u16 value, u16 index)\r\n{\r\nstruct usb_device *udev = gspca_dev->dev;\r\nint err;\r\nerr = usb_control_msg(udev, usb_sndctrlpipe(udev, 0), 0x00,\r\nUSB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_ENDPOINT,\r\nvalue, index, NULL, 0, 1000);\r\nif (err < 0)\r\npr_err("Failed to write a register (index 0x%04X, value 0x%02X, error %d)\n",\r\nindex, value, err);\r\nreturn 0;\r\n}\r\nstatic int cit_read_reg(struct gspca_dev *gspca_dev, u16 index, int verbose)\r\n{\r\nstruct usb_device *udev = gspca_dev->dev;\r\n__u8 *buf = gspca_dev->usb_buf;\r\nint res;\r\nres = usb_control_msg(udev, usb_rcvctrlpipe(udev, 0), 0x01,\r\nUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_ENDPOINT,\r\n0x00, index, buf, 8, 1000);\r\nif (res < 0) {\r\npr_err("Failed to read a register (index 0x%04X, error %d)\n",\r\nindex, res);\r\nreturn res;\r\n}\r\nif (verbose)\r\nPDEBUG(D_PROBE, "Register %04x value: %02x", index, buf[0]);\r\nreturn 0;\r\n}\r\nstatic void cit_send_FF_04_02(struct gspca_dev *gspca_dev)\r\n{\r\ncit_write_reg(gspca_dev, 0x00FF, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0004, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0124);\r\n}\r\nstatic void cit_send_00_04_06(struct gspca_dev *gspca_dev)\r\n{\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0004, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0006, 0x0124);\r\n}\r\nstatic void cit_send_x_00(struct gspca_dev *gspca_dev, unsigned short x)\r\n{\r\ncit_write_reg(gspca_dev, x, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0124);\r\n}\r\nstatic void cit_send_x_00_05(struct gspca_dev *gspca_dev, unsigned short x)\r\n{\r\ncit_send_x_00(gspca_dev, x);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0124);\r\n}\r\nstatic void cit_send_x_00_05_02(struct gspca_dev *gspca_dev, unsigned short x)\r\n{\r\ncit_write_reg(gspca_dev, x, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0124);\r\n}\r\nstatic void cit_send_x_01_00_05(struct gspca_dev *gspca_dev, u16 x)\r\n{\r\ncit_write_reg(gspca_dev, x, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0124);\r\n}\r\nstatic void cit_send_x_00_05_02_01(struct gspca_dev *gspca_dev, u16 x)\r\n{\r\ncit_write_reg(gspca_dev, x, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0124);\r\n}\r\nstatic void cit_send_x_00_05_02_08_01(struct gspca_dev *gspca_dev, u16 x)\r\n{\r\ncit_write_reg(gspca_dev, x, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0124);\r\n}\r\nstatic void cit_Packet_Format1(struct gspca_dev *gspca_dev, u16 fkey, u16 val)\r\n{\r\ncit_send_x_01_00_05(gspca_dev, 0x0088);\r\ncit_send_x_00_05(gspca_dev, fkey);\r\ncit_send_x_00_05_02_08_01(gspca_dev, val);\r\ncit_send_x_00_05(gspca_dev, 0x0088);\r\ncit_send_x_00_05_02_01(gspca_dev, fkey);\r\ncit_send_x_00_05(gspca_dev, 0x0089);\r\ncit_send_x_00(gspca_dev, fkey);\r\ncit_send_00_04_06(gspca_dev);\r\ncit_read_reg(gspca_dev, 0x0126, 0);\r\ncit_send_FF_04_02(gspca_dev);\r\n}\r\nstatic void cit_PacketFormat2(struct gspca_dev *gspca_dev, u16 fkey, u16 val)\r\n{\r\ncit_send_x_01_00_05(gspca_dev, 0x0088);\r\ncit_send_x_00_05(gspca_dev, fkey);\r\ncit_send_x_00_05_02(gspca_dev, val);\r\n}\r\nstatic void cit_model2_Packet2(struct gspca_dev *gspca_dev)\r\n{\r\ncit_write_reg(gspca_dev, 0x00ff, 0x012d);\r\ncit_write_reg(gspca_dev, 0xfea3, 0x0124);\r\n}\r\nstatic void cit_model2_Packet1(struct gspca_dev *gspca_dev, u16 v1, u16 v2)\r\n{\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x00ff, 0x012e);\r\ncit_write_reg(gspca_dev, v1, 0x012f);\r\ncit_write_reg(gspca_dev, 0x00ff, 0x0130);\r\ncit_write_reg(gspca_dev, 0xc719, 0x0124);\r\ncit_write_reg(gspca_dev, v2, 0x0127);\r\ncit_model2_Packet2(gspca_dev);\r\n}\r\nstatic void cit_model3_Packet1(struct gspca_dev *gspca_dev, u16 v1, u16 v2)\r\n{\r\ncit_write_reg(gspca_dev, 0x0078, 0x012d);\r\ncit_write_reg(gspca_dev, v1, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, v2, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\n}\r\nstatic void cit_model4_Packet1(struct gspca_dev *gspca_dev, u16 v1, u16 v2)\r\n{\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, v1, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, v2, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\n}\r\nstatic void cit_model4_BrightnessPacket(struct gspca_dev *gspca_dev, u16 val)\r\n{\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0026, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, val, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0038, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0004, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\n}\r\nstatic int sd_config(struct gspca_dev *gspca_dev,\r\nconst struct usb_device_id *id)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nstruct cam *cam;\r\nsd->model = id->driver_info;\r\nif (sd->model == CIT_MODEL3 && ibm_netcam_pro)\r\nsd->model = CIT_IBM_NETCAM_PRO;\r\ncam = &gspca_dev->cam;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncam->cam_mode = model0_mode;\r\ncam->nmodes = ARRAY_SIZE(model0_mode);\r\nsd->sof_len = 4;\r\nbreak;\r\ncase CIT_MODEL1:\r\ncam->cam_mode = cif_yuv_mode;\r\ncam->nmodes = ARRAY_SIZE(cif_yuv_mode);\r\nsd->sof_len = 4;\r\nbreak;\r\ncase CIT_MODEL2:\r\ncam->cam_mode = model2_mode + 1;\r\ncam->nmodes = 3;\r\nbreak;\r\ncase CIT_MODEL3:\r\ncam->cam_mode = vga_yuv_mode;\r\ncam->nmodes = ARRAY_SIZE(vga_yuv_mode);\r\nsd->stop_on_control_change = 1;\r\nsd->sof_len = 4;\r\nbreak;\r\ncase CIT_MODEL4:\r\ncam->cam_mode = model2_mode;\r\ncam->nmodes = ARRAY_SIZE(model2_mode);\r\nbreak;\r\ncase CIT_IBM_NETCAM_PRO:\r\ncam->cam_mode = vga_yuv_mode;\r\ncam->nmodes = 2;\r\ncam->input_flags = V4L2_IN_ST_VFLIP;\r\nsd->stop_on_control_change = 1;\r\nsd->sof_len = 4;\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_init_model0(struct gspca_dev *gspca_dev)\r\n{\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0112);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0400);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0400);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0420);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0420);\r\ncit_write_reg(gspca_dev, 0x000d, 0x0409);\r\ncit_write_reg(gspca_dev, 0x0002, 0x040a);\r\ncit_write_reg(gspca_dev, 0x0018, 0x0405);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0435);\r\ncit_write_reg(gspca_dev, 0x0026, 0x040b);\r\ncit_write_reg(gspca_dev, 0x0007, 0x0437);\r\ncit_write_reg(gspca_dev, 0x0015, 0x042f);\r\ncit_write_reg(gspca_dev, 0x002b, 0x0439);\r\ncit_write_reg(gspca_dev, 0x0026, 0x043a);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0438);\r\ncit_write_reg(gspca_dev, 0x001e, 0x042b);\r\ncit_write_reg(gspca_dev, 0x0041, 0x042c);\r\nreturn 0;\r\n}\r\nstatic int cit_init_ibm_netcam_pro(struct gspca_dev *gspca_dev)\r\n{\r\ncit_read_reg(gspca_dev, 0x128, 1);\r\ncit_write_reg(gspca_dev, 0x0003, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0112);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0040, 0x0108);\r\ncit_write_reg(gspca_dev, 0x0019, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0115);\r\ncit_write_reg(gspca_dev, 0x000b, 0x0115);\r\ncit_write_reg(gspca_dev, 0x0078, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0001, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0079, 0x012d);\r\ncit_write_reg(gspca_dev, 0x00ff, 0x0130);\r\ncit_write_reg(gspca_dev, 0xcd41, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_read_reg(gspca_dev, 0x0126, 1);\r\ncit_model3_Packet1(gspca_dev, 0x0000, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0000, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x000b, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x000c, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x000d, 0x003a);\r\ncit_model3_Packet1(gspca_dev, 0x000e, 0x0060);\r\ncit_model3_Packet1(gspca_dev, 0x000f, 0x0060);\r\ncit_model3_Packet1(gspca_dev, 0x0010, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0011, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x0012, 0x0028);\r\ncit_model3_Packet1(gspca_dev, 0x0013, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0014, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0015, 0x00fb);\r\ncit_model3_Packet1(gspca_dev, 0x0016, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0017, 0x0037);\r\ncit_model3_Packet1(gspca_dev, 0x0018, 0x0036);\r\ncit_model3_Packet1(gspca_dev, 0x001e, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x001f, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0020, 0x00c1);\r\ncit_model3_Packet1(gspca_dev, 0x0021, 0x0034);\r\ncit_model3_Packet1(gspca_dev, 0x0022, 0x0034);\r\ncit_model3_Packet1(gspca_dev, 0x0025, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0028, 0x0022);\r\ncit_model3_Packet1(gspca_dev, 0x0029, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x002b, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x002c, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x002d, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x002e, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x002f, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x0030, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x0031, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x0032, 0x0007);\r\ncit_model3_Packet1(gspca_dev, 0x0033, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x0037, 0x0040);\r\ncit_model3_Packet1(gspca_dev, 0x0039, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x003a, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x003b, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x003c, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0040, 0x000c);\r\ncit_model3_Packet1(gspca_dev, 0x0041, 0x00fb);\r\ncit_model3_Packet1(gspca_dev, 0x0042, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0043, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0045, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0046, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0047, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0048, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0049, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x004a, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x004b, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x004c, 0x00ff);\r\ncit_model3_Packet1(gspca_dev, 0x004f, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0050, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0051, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0055, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0056, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0057, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0058, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0059, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x005c, 0x0016);\r\ncit_model3_Packet1(gspca_dev, 0x005d, 0x0022);\r\ncit_model3_Packet1(gspca_dev, 0x005e, 0x003c);\r\ncit_model3_Packet1(gspca_dev, 0x005f, 0x0050);\r\ncit_model3_Packet1(gspca_dev, 0x0060, 0x0044);\r\ncit_model3_Packet1(gspca_dev, 0x0061, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x006a, 0x007e);\r\ncit_model3_Packet1(gspca_dev, 0x006f, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0072, 0x001b);\r\ncit_model3_Packet1(gspca_dev, 0x0073, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x0074, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0075, 0x001b);\r\ncit_model3_Packet1(gspca_dev, 0x0076, 0x002a);\r\ncit_model3_Packet1(gspca_dev, 0x0077, 0x003c);\r\ncit_model3_Packet1(gspca_dev, 0x0078, 0x0050);\r\ncit_model3_Packet1(gspca_dev, 0x007b, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x007c, 0x0011);\r\ncit_model3_Packet1(gspca_dev, 0x007d, 0x0024);\r\ncit_model3_Packet1(gspca_dev, 0x007e, 0x0043);\r\ncit_model3_Packet1(gspca_dev, 0x007f, 0x005a);\r\ncit_model3_Packet1(gspca_dev, 0x0084, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x0085, 0x0033);\r\ncit_model3_Packet1(gspca_dev, 0x0086, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0087, 0x0030);\r\ncit_model3_Packet1(gspca_dev, 0x0088, 0x0070);\r\ncit_model3_Packet1(gspca_dev, 0x008b, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x008f, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0090, 0x0006);\r\ncit_model3_Packet1(gspca_dev, 0x0091, 0x0028);\r\ncit_model3_Packet1(gspca_dev, 0x0092, 0x005a);\r\ncit_model3_Packet1(gspca_dev, 0x0093, 0x0082);\r\ncit_model3_Packet1(gspca_dev, 0x0096, 0x0014);\r\ncit_model3_Packet1(gspca_dev, 0x0097, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x0098, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00b0, 0x0046);\r\ncit_model3_Packet1(gspca_dev, 0x00b1, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00b2, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00b3, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x00b4, 0x0007);\r\ncit_model3_Packet1(gspca_dev, 0x00b6, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x00b7, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x00bb, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00bc, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00bd, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00bf, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00c0, 0x00c8);\r\ncit_model3_Packet1(gspca_dev, 0x00c1, 0x0014);\r\ncit_model3_Packet1(gspca_dev, 0x00c2, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00c3, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00c4, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x00cb, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00cc, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00cd, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00ce, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00cf, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x00d0, 0x0040);\r\ncit_model3_Packet1(gspca_dev, 0x00d1, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00d1, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00d2, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00d3, 0x00bf);\r\ncit_model3_Packet1(gspca_dev, 0x00ea, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x00eb, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00ec, 0x00e8);\r\ncit_model3_Packet1(gspca_dev, 0x00ed, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00ef, 0x0022);\r\ncit_model3_Packet1(gspca_dev, 0x00f0, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00f2, 0x0028);\r\ncit_model3_Packet1(gspca_dev, 0x00f4, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x00f5, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00fa, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00fb, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00fc, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00fd, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00fe, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00ff, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00be, 0x0003);\r\ncit_model3_Packet1(gspca_dev, 0x00c8, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00c9, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x00ca, 0x0040);\r\ncit_model3_Packet1(gspca_dev, 0x0053, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0082, 0x000e);\r\ncit_model3_Packet1(gspca_dev, 0x0083, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x0034, 0x003c);\r\ncit_model3_Packet1(gspca_dev, 0x006e, 0x0055);\r\ncit_model3_Packet1(gspca_dev, 0x0062, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x0063, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0066, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0067, 0x0006);\r\ncit_model3_Packet1(gspca_dev, 0x006b, 0x0010);\r\ncit_model3_Packet1(gspca_dev, 0x005a, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x005b, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0023, 0x0006);\r\ncit_model3_Packet1(gspca_dev, 0x0026, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x0036, 0x0069);\r\ncit_model3_Packet1(gspca_dev, 0x0038, 0x0064);\r\ncit_model3_Packet1(gspca_dev, 0x003d, 0x0003);\r\ncit_model3_Packet1(gspca_dev, 0x003e, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00b8, 0x0014);\r\ncit_model3_Packet1(gspca_dev, 0x00b9, 0x0014);\r\ncit_model3_Packet1(gspca_dev, 0x00e6, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x00e8, 0x0001);\r\nreturn 0;\r\n}\r\nstatic int sd_init(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncit_init_model0(gspca_dev);\r\nsd_stop0(gspca_dev);\r\nbreak;\r\ncase CIT_MODEL1:\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL3:\r\ncase CIT_MODEL4:\r\nbreak;\r\ncase CIT_IBM_NETCAM_PRO:\r\ncit_init_ibm_netcam_pro(gspca_dev);\r\nsd_stop0(gspca_dev);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_set_brightness(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nint i;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\ncase CIT_MODEL1:\r\ncit_Packet_Format1(gspca_dev, 0x0031, val);\r\ncit_Packet_Format1(gspca_dev, 0x0032, val);\r\ncit_Packet_Format1(gspca_dev, 0x0033, val);\r\nbreak;\r\ncase CIT_MODEL2:\r\ni = 0x60 + val * 2254 / 1000;\r\ncit_model2_Packet1(gspca_dev, 0x001a, i);\r\nbreak;\r\ncase CIT_MODEL3:\r\ni = val;\r\nif (i < 0x0c)\r\ni = 0x0c;\r\ncit_model3_Packet1(gspca_dev, 0x0036, i);\r\nbreak;\r\ncase CIT_MODEL4:\r\ni = 0x04 + val * 2794 / 1000;\r\ncit_model4_BrightnessPacket(gspca_dev, i);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_set_contrast(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0: {\r\nint i;\r\ni = val * 1000 / 1333;\r\ncit_write_reg(gspca_dev, i, 0x0422);\r\ni = val * 2000 / 1333;\r\ncit_write_reg(gspca_dev, i, 0x0423);\r\ni = val * 4000 / 1333;\r\ncit_write_reg(gspca_dev, i, 0x0424);\r\ni = val * 8000 / 1333;\r\ncit_write_reg(gspca_dev, i, 0x0425);\r\nbreak;\r\n}\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL4:\r\nbreak;\r\ncase CIT_MODEL1:\r\n{\r\nint i, new_contrast = (20 - val) * 1000 / 1333;\r\nfor (i = 0; i < cit_model1_ntries; i++) {\r\ncit_Packet_Format1(gspca_dev, 0x0014, new_contrast);\r\ncit_send_FF_04_02(gspca_dev);\r\n}\r\nbreak;\r\n}\r\ncase CIT_MODEL3:\r\n{\r\nstatic const struct {\r\nunsigned short cv1;\r\nunsigned short cv2;\r\nunsigned short cv3;\r\n} cv[7] = {\r\n{ 0x05, 0x05, 0x0f },\r\n{ 0x04, 0x04, 0x16 },\r\n{ 0x02, 0x03, 0x16 },\r\n{ 0x02, 0x08, 0x16 },\r\n{ 0x01, 0x0c, 0x16 },\r\n{ 0x01, 0x0e, 0x16 },\r\n{ 0x01, 0x10, 0x16 }\r\n};\r\nint i = val / 3;\r\ncit_model3_Packet1(gspca_dev, 0x0067, cv[i].cv1);\r\ncit_model3_Packet1(gspca_dev, 0x005b, cv[i].cv2);\r\ncit_model3_Packet1(gspca_dev, 0x005c, cv[i].cv3);\r\nbreak;\r\n}\r\ncase CIT_IBM_NETCAM_PRO:\r\ncit_model3_Packet1(gspca_dev, 0x005b, val + 1);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_set_hue(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL1:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\ncase CIT_MODEL2:\r\ncit_model2_Packet1(gspca_dev, 0x0024, val);\r\nbreak;\r\ncase CIT_MODEL3: {\r\nif (0) {\r\nint i = 0x05 + val * 1000 / 2540;\r\ncit_model3_Packet1(gspca_dev, 0x007e, i);\r\n}\r\nbreak;\r\n}\r\ncase CIT_MODEL4:\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 160, 0x0127);\r\ncit_write_reg(gspca_dev, 160, 0x012e);\r\ncit_write_reg(gspca_dev, 160, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, val, 0x012d);\r\ncit_write_reg(gspca_dev, 0xf545, 0x0124);\r\nbreak;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_set_sharpness(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL4:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\ncase CIT_MODEL1: {\r\nint i;\r\nconst unsigned short sa[] = {\r\n0x11, 0x13, 0x16, 0x18, 0x1a, 0x8, 0x0a };\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_PacketFormat2(gspca_dev, 0x0013, sa[val]);\r\nbreak;\r\n}\r\ncase CIT_MODEL3:\r\n{\r\nstatic const struct {\r\nunsigned short sv1;\r\nunsigned short sv2;\r\nunsigned short sv3;\r\nunsigned short sv4;\r\n} sv[7] = {\r\n{ 0x00, 0x00, 0x05, 0x14 },\r\n{ 0x01, 0x04, 0x05, 0x14 },\r\n{ 0x02, 0x04, 0x05, 0x14 },\r\n{ 0x03, 0x04, 0x05, 0x14 },\r\n{ 0x03, 0x05, 0x05, 0x14 },\r\n{ 0x03, 0x06, 0x05, 0x14 },\r\n{ 0x03, 0x07, 0x05, 0x14 }\r\n};\r\ncit_model3_Packet1(gspca_dev, 0x0060, sv[val].sv1);\r\ncit_model3_Packet1(gspca_dev, 0x0061, sv[val].sv2);\r\ncit_model3_Packet1(gspca_dev, 0x0062, sv[val].sv3);\r\ncit_model3_Packet1(gspca_dev, 0x0063, sv[val].sv4);\r\nbreak;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic void cit_set_lighting(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL3:\r\ncase CIT_MODEL4:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\ncase CIT_MODEL1: {\r\nint i;\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x0027, val);\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic void cit_set_hflip(struct gspca_dev *gspca_dev, s32 val)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\nif (val)\r\ncit_write_reg(gspca_dev, 0x0020, 0x0115);\r\nelse\r\ncit_write_reg(gspca_dev, 0x0040, 0x0115);\r\nbreak;\r\ncase CIT_MODEL1:\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL3:\r\ncase CIT_MODEL4:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\n}\r\n}\r\nstatic int cit_restart_stream(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL1:\r\ncit_write_reg(gspca_dev, 0x0001, 0x0114);\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL4:\r\ncit_write_reg(gspca_dev, 0x00c0, 0x010c);\r\nusb_clear_halt(gspca_dev->dev, gspca_dev->urb[0]->pipe);\r\nbreak;\r\ncase CIT_MODEL3:\r\ncase CIT_IBM_NETCAM_PRO:\r\ncit_write_reg(gspca_dev, 0x0001, 0x0114);\r\ncit_write_reg(gspca_dev, 0x00c0, 0x010c);\r\nusb_clear_halt(gspca_dev->dev, gspca_dev->urb[0]->pipe);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0113);\r\nbreak;\r\n}\r\nsd->sof_read = 0;\r\nreturn 0;\r\n}\r\nstatic int cit_get_packet_size(struct gspca_dev *gspca_dev)\r\n{\r\nstruct usb_host_interface *alt;\r\nstruct usb_interface *intf;\r\nintf = usb_ifnum_to_if(gspca_dev->dev, gspca_dev->iface);\r\nalt = usb_altnum_to_altsetting(intf, gspca_dev->alt);\r\nif (!alt) {\r\npr_err("Couldn't get altsetting\n");\r\nreturn -EIO;\r\n}\r\nreturn le16_to_cpu(alt->endpoint[0].desc.wMaxPacketSize);\r\n}\r\nstatic int cit_get_clock_div(struct gspca_dev *gspca_dev)\r\n{\r\nint clock_div = 7;\r\nint fps[8] = { 30, 25, 20, 15, 12, 8, 6, 3 };\r\nint packet_size;\r\npacket_size = cit_get_packet_size(gspca_dev);\r\nif (packet_size < 0)\r\nreturn packet_size;\r\nwhile (clock_div > 3 &&\r\n1000 * packet_size >\r\ngspca_dev->width * gspca_dev->height *\r\nfps[clock_div - 1] * 3 / 2)\r\nclock_div--;\r\nPDEBUG(D_PROBE,\r\n"PacketSize: %d, res: %dx%d -> using clockdiv: %d (%d fps)",\r\npacket_size, gspca_dev->width, gspca_dev->height, clock_div,\r\nfps[clock_div]);\r\nreturn clock_div;\r\n}\r\nstatic int cit_start_model0(struct gspca_dev *gspca_dev)\r\n{\r\nconst unsigned short compression = 0;\r\nint clock_div;\r\nclock_div = cit_get_clock_div(gspca_dev);\r\nif (clock_div < 0)\r\nreturn clock_div;\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_write_reg(gspca_dev, 0x0003, 0x0438);\r\ncit_write_reg(gspca_dev, 0x001e, 0x042b);\r\ncit_write_reg(gspca_dev, 0x0041, 0x042c);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0436);\r\ncit_write_reg(gspca_dev, 0x0024, 0x0403);\r\ncit_write_reg(gspca_dev, 0x002c, 0x0404);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0426);\r\ncit_write_reg(gspca_dev, 0x0014, 0x0427);\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\ncit_write_reg(gspca_dev, 0x0004, 0x010b);\r\ncit_write_reg(gspca_dev, 0x0001, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0010, 0x0102);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0078, 0x0105);\r\nbreak;\r\ncase 176:\r\ncit_write_reg(gspca_dev, 0x0006, 0x010b);\r\ncit_write_reg(gspca_dev, 0x0000, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0102);\r\ncit_write_reg(gspca_dev, 0x00b0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0090, 0x0105);\r\nbreak;\r\ncase 320:\r\ncit_write_reg(gspca_dev, 0x0008, 0x010b);\r\ncit_write_reg(gspca_dev, 0x0004, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0005, 0x0102);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0010, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0078, 0x0105);\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, compression, 0x0109);\r\ncit_write_reg(gspca_dev, clock_div, 0x0111);\r\nreturn 0;\r\n}\r\nstatic int cit_start_model1(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nint i, clock_div;\r\nclock_div = cit_get_clock_div(gspca_dev);\r\nif (clock_div < 0)\r\nreturn clock_div;\r\ncit_read_reg(gspca_dev, 0x0128, 1);\r\ncit_read_reg(gspca_dev, 0x0100, 0);\r\ncit_write_reg(gspca_dev, 0x01, 0x0100);\r\ncit_read_reg(gspca_dev, 0x0100, 0);\r\ncit_write_reg(gspca_dev, 0x81, 0x0100);\r\ncit_read_reg(gspca_dev, 0x0100, 0);\r\ncit_write_reg(gspca_dev, 0x01, 0x0100);\r\ncit_write_reg(gspca_dev, 0x01, 0x0108);\r\ncit_write_reg(gspca_dev, 0x03, 0x0112);\r\ncit_read_reg(gspca_dev, 0x0115, 0);\r\ncit_write_reg(gspca_dev, 0x06, 0x0115);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x44, 0x0116);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x40, 0x0116);\r\ncit_read_reg(gspca_dev, 0x0115, 0);\r\ncit_write_reg(gspca_dev, 0x0e, 0x0115);\r\ncit_write_reg(gspca_dev, 0x19, 0x012c);\r\ncit_Packet_Format1(gspca_dev, 0x00, 0x1e);\r\ncit_Packet_Format1(gspca_dev, 0x39, 0x0d);\r\ncit_Packet_Format1(gspca_dev, 0x39, 0x09);\r\ncit_Packet_Format1(gspca_dev, 0x3b, 0x00);\r\ncit_Packet_Format1(gspca_dev, 0x28, 0x22);\r\ncit_Packet_Format1(gspca_dev, 0x27, 0x00);\r\ncit_Packet_Format1(gspca_dev, 0x2b, 0x1f);\r\ncit_Packet_Format1(gspca_dev, 0x39, 0x08);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x2c, 0x00);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x30, 0x14);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x02);\r\ncit_PacketFormat2(gspca_dev, 0x01, 0xe1);\r\ncit_PacketFormat2(gspca_dev, 0x02, 0xcd);\r\ncit_PacketFormat2(gspca_dev, 0x03, 0xcd);\r\ncit_PacketFormat2(gspca_dev, 0x04, 0xfa);\r\ncit_PacketFormat2(gspca_dev, 0x3f, 0xff);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x00);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x02);\r\ncit_PacketFormat2(gspca_dev, 0x0a, 0x37);\r\ncit_PacketFormat2(gspca_dev, 0x0b, 0xb8);\r\ncit_PacketFormat2(gspca_dev, 0x0c, 0xf3);\r\ncit_PacketFormat2(gspca_dev, 0x0d, 0xe3);\r\ncit_PacketFormat2(gspca_dev, 0x0e, 0x0d);\r\ncit_PacketFormat2(gspca_dev, 0x0f, 0xf2);\r\ncit_PacketFormat2(gspca_dev, 0x10, 0xd5);\r\ncit_PacketFormat2(gspca_dev, 0x11, 0xba);\r\ncit_PacketFormat2(gspca_dev, 0x12, 0x53);\r\ncit_PacketFormat2(gspca_dev, 0x3f, 0xff);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x00);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x02);\r\ncit_PacketFormat2(gspca_dev, 0x16, 0x00);\r\ncit_PacketFormat2(gspca_dev, 0x17, 0x28);\r\ncit_PacketFormat2(gspca_dev, 0x18, 0x7d);\r\ncit_PacketFormat2(gspca_dev, 0x19, 0xbe);\r\ncit_PacketFormat2(gspca_dev, 0x3f, 0xff);\r\ncit_PacketFormat2(gspca_dev, 0x39, 0x00);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x00, 0x18);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x13, 0x18);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x14, 0x06);\r\nif (0) {\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x31, 0x37);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x32, 0x46);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x33, 0x55);\r\n}\r\ncit_Packet_Format1(gspca_dev, 0x2e, 0x04);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x2d, 0x04);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x29, 0x80);\r\ncit_Packet_Format1(gspca_dev, 0x2c, 0x01);\r\ncit_Packet_Format1(gspca_dev, 0x30, 0x17);\r\ncit_Packet_Format1(gspca_dev, 0x39, 0x08);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x34, 0x00);\r\ncit_write_reg(gspca_dev, 0x00, 0x0101);\r\ncit_write_reg(gspca_dev, 0x00, 0x010a);\r\nswitch (gspca_dev->width) {\r\ncase 128:\r\ncit_write_reg(gspca_dev, 0x80, 0x0103);\r\ncit_write_reg(gspca_dev, 0x60, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0c, 0x010b);\r\ncit_write_reg(gspca_dev, 0x04, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0b, 0x011d);\r\ncit_write_reg(gspca_dev, 0x00, 0x011e);\r\ncit_write_reg(gspca_dev, 0x00, 0x0129);\r\nbreak;\r\ncase 176:\r\ncit_write_reg(gspca_dev, 0xb0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x8f, 0x0105);\r\ncit_write_reg(gspca_dev, 0x06, 0x010b);\r\ncit_write_reg(gspca_dev, 0x04, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0d, 0x011d);\r\ncit_write_reg(gspca_dev, 0x00, 0x011e);\r\ncit_write_reg(gspca_dev, 0x03, 0x0129);\r\nbreak;\r\ncase 352:\r\ncit_write_reg(gspca_dev, 0xb0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x90, 0x0105);\r\ncit_write_reg(gspca_dev, 0x02, 0x010b);\r\ncit_write_reg(gspca_dev, 0x04, 0x011b);\r\ncit_write_reg(gspca_dev, 0x05, 0x011d);\r\ncit_write_reg(gspca_dev, 0x00, 0x011e);\r\ncit_write_reg(gspca_dev, 0x00, 0x0129);\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, 0xff, 0x012b);\r\nif (0) {\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x31, 0xc3);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x32, 0xd2);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x33, 0xe1);\r\nfor (i = 0; i < cit_model1_ntries; i++)\r\ncit_Packet_Format1(gspca_dev, 0x14, 0x0a);\r\nfor (i = 0; i < cit_model1_ntries2; i++)\r\ncit_PacketFormat2(gspca_dev, 0x13, 0x1a);\r\ncit_Packet_Format1(gspca_dev, 0x0027,\r\nv4l2_ctrl_g_ctrl(sd->lighting));\r\n}\r\nswitch (gspca_dev->width) {\r\ncase 128:\r\ncit_Packet_Format1(gspca_dev, 0x2b, 0x1e);\r\ncit_write_reg(gspca_dev, 0xc9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x80, 0x0109);\r\ncit_write_reg(gspca_dev, 0x36, 0x0102);\r\ncit_write_reg(gspca_dev, 0x1a, 0x0104);\r\ncit_write_reg(gspca_dev, 0x04, 0x011a);\r\ncit_write_reg(gspca_dev, 0x2b, 0x011c);\r\ncit_write_reg(gspca_dev, 0x23, 0x012a);\r\nbreak;\r\ncase 176:\r\ncit_Packet_Format1(gspca_dev, 0x2b, 0x1e);\r\ncit_write_reg(gspca_dev, 0xc9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x80, 0x0109);\r\ncit_write_reg(gspca_dev, 0x04, 0x0102);\r\ncit_write_reg(gspca_dev, 0x02, 0x0104);\r\ncit_write_reg(gspca_dev, 0x04, 0x011a);\r\ncit_write_reg(gspca_dev, 0x2b, 0x011c);\r\ncit_write_reg(gspca_dev, 0x23, 0x012a);\r\nbreak;\r\ncase 352:\r\ncit_Packet_Format1(gspca_dev, 0x2b, 0x1f);\r\ncit_write_reg(gspca_dev, 0xc9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x80, 0x0109);\r\ncit_write_reg(gspca_dev, 0x08, 0x0102);\r\ncit_write_reg(gspca_dev, 0x01, 0x0104);\r\ncit_write_reg(gspca_dev, 0x04, 0x011a);\r\ncit_write_reg(gspca_dev, 0x2f, 0x011c);\r\ncit_write_reg(gspca_dev, 0x23, 0x012a);\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, 0x01, 0x0100);\r\ncit_write_reg(gspca_dev, clock_div, 0x0111);\r\nreturn 0;\r\n}\r\nstatic int cit_start_model2(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nint clock_div = 0;\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0112);\r\ncit_write_reg(gspca_dev, 0x00bc, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0108);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\nswitch (gspca_dev->width) {\r\ncase 176:\r\ncit_write_reg(gspca_dev, 0x002c, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0024, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00b9, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0038, 0x0119);\r\nsd->sof_len = 10;\r\nbreak;\r\ncase 320:\r\ncit_write_reg(gspca_dev, 0x0028, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x001e, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\nsd->sof_len = 2;\r\nbreak;\r\ncit_write_reg(gspca_dev, 0x002c, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x001e, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\nsd->sof_len = 2;\r\nbreak;\r\ncase 352:\r\ncit_write_reg(gspca_dev, 0x002c, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0024, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\nsd->sof_len = 2;\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\nswitch (gspca_dev->width) {\r\ncase 176:\r\ncit_write_reg(gspca_dev, 0x0050, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0111);\r\nbreak;\r\ncase 320:\r\ncase 352:\r\ncit_write_reg(gspca_dev, 0x0040, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00c0, 0x0111);\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, 0x009b, 0x010f);\r\ncit_write_reg(gspca_dev, 0x00bb, 0x010f);\r\ncit_model2_Packet1(gspca_dev, 0x000a, 0x005c);\r\ncit_model2_Packet1(gspca_dev, 0x0004, 0x0000);\r\ncit_model2_Packet1(gspca_dev, 0x0006, 0x00fb);\r\ncit_model2_Packet1(gspca_dev, 0x0008, 0x0000);\r\ncit_model2_Packet1(gspca_dev, 0x000c, 0x0009);\r\ncit_model2_Packet1(gspca_dev, 0x0012, 0x000a);\r\ncit_model2_Packet1(gspca_dev, 0x002a, 0x0000);\r\ncit_model2_Packet1(gspca_dev, 0x002c, 0x0000);\r\ncit_model2_Packet1(gspca_dev, 0x002e, 0x0008);\r\ncit_model2_Packet1(gspca_dev, 0x0030, 0x0000);\r\nswitch (gspca_dev->width) {\r\ncase 176:\r\ncit_model2_Packet1(gspca_dev, 0x0014, 0x0002);\r\ncit_model2_Packet1(gspca_dev, 0x0016, 0x0002);\r\ncit_model2_Packet1(gspca_dev, 0x0018, 0x004a);\r\nclock_div = 6;\r\nbreak;\r\ncase 320:\r\ncit_model2_Packet1(gspca_dev, 0x0014, 0x0009);\r\ncit_model2_Packet1(gspca_dev, 0x0016, 0x0005);\r\ncit_model2_Packet1(gspca_dev, 0x0018, 0x0044);\r\nclock_div = 8;\r\nbreak;\r\ncit_model2_Packet1(gspca_dev, 0x0014, 0x0009);\r\ncit_model2_Packet1(gspca_dev, 0x0016, 0x0003);\r\ncit_model2_Packet1(gspca_dev, 0x0018, 0x0044);\r\nclock_div = 10;\r\nbreak;\r\ncase 352:\r\ncit_model2_Packet1(gspca_dev, 0x0014, 0x0003);\r\ncit_model2_Packet1(gspca_dev, 0x0016, 0x0002);\r\ncit_model2_Packet1(gspca_dev, 0x0018, 0x004a);\r\nclock_div = 16;\r\nbreak;\r\n}\r\nif (0)\r\ncit_model2_Packet1(gspca_dev, 0x001a, 0x005a);\r\ncit_model2_Packet1(gspca_dev, 0x001c, clock_div);\r\nswitch (gspca_dev->width) {\r\ncase 176:\r\ncit_model2_Packet1(gspca_dev, 0x0026, 0x00c2);\r\nbreak;\r\ncase 320:\r\ncit_model2_Packet1(gspca_dev, 0x0026, 0x0044);\r\nbreak;\r\ncit_model2_Packet1(gspca_dev, 0x0026, 0x0046);\r\nbreak;\r\ncase 352:\r\ncit_model2_Packet1(gspca_dev, 0x0026, 0x0048);\r\nbreak;\r\n}\r\ncit_model2_Packet1(gspca_dev, 0x0028, v4l2_ctrl_g_ctrl(sd->lighting));\r\nv4l2_ctrl_grab(sd->lighting, true);\r\ncit_model2_Packet1(gspca_dev, 0x001e, 0x002f);\r\ncit_model2_Packet1(gspca_dev, 0x0020, 0x0034);\r\ncit_model2_Packet1(gspca_dev, 0x0022, 0x00a0);\r\ncit_model2_Packet1(gspca_dev, 0x0030, 0x0004);\r\nreturn 0;\r\n}\r\nstatic int cit_start_model3(struct gspca_dev *gspca_dev)\r\n{\r\nconst unsigned short compression = 0;\r\nint i, clock_div = 0;\r\ncit_read_reg(gspca_dev, 0x128, 1);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0112);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0040, 0x0108);\r\ncit_write_reg(gspca_dev, 0x0019, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0002, 0x0115);\r\ncit_write_reg(gspca_dev, 0x0003, 0x0115);\r\ncit_read_reg(gspca_dev, 0x0115, 0);\r\ncit_write_reg(gspca_dev, 0x000b, 0x0115);\r\nif (0) {\r\ncit_write_reg(gspca_dev, 0x0078, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0001, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0079, 0x012d);\r\ncit_write_reg(gspca_dev, 0x00ff, 0x0130);\r\ncit_write_reg(gspca_dev, 0xcd41, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_read_reg(gspca_dev, 0x0126, 1);\r\n}\r\ncit_model3_Packet1(gspca_dev, 0x000a, 0x0040);\r\ncit_model3_Packet1(gspca_dev, 0x000b, 0x00f6);\r\ncit_model3_Packet1(gspca_dev, 0x000c, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x000d, 0x0020);\r\ncit_model3_Packet1(gspca_dev, 0x000e, 0x0033);\r\ncit_model3_Packet1(gspca_dev, 0x000f, 0x0007);\r\ncit_model3_Packet1(gspca_dev, 0x0010, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0011, 0x0070);\r\ncit_model3_Packet1(gspca_dev, 0x0012, 0x0030);\r\ncit_model3_Packet1(gspca_dev, 0x0013, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0014, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0015, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0016, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0017, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0018, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x001e, 0x00c3);\r\ncit_model3_Packet1(gspca_dev, 0x0020, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0028, 0x0010);\r\ncit_model3_Packet1(gspca_dev, 0x0029, 0x0054);\r\ncit_model3_Packet1(gspca_dev, 0x002a, 0x0013);\r\ncit_model3_Packet1(gspca_dev, 0x002b, 0x0007);\r\ncit_model3_Packet1(gspca_dev, 0x002d, 0x0028);\r\ncit_model3_Packet1(gspca_dev, 0x002e, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0031, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0032, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0033, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0034, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0035, 0x0038);\r\ncit_model3_Packet1(gspca_dev, 0x003a, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x003c, 0x001e);\r\ncit_model3_Packet1(gspca_dev, 0x003f, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0041, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0046, 0x003f);\r\ncit_model3_Packet1(gspca_dev, 0x0047, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0050, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x0052, 0x001a);\r\ncit_model3_Packet1(gspca_dev, 0x0053, 0x0003);\r\ncit_model3_Packet1(gspca_dev, 0x005a, 0x006b);\r\ncit_model3_Packet1(gspca_dev, 0x005d, 0x001e);\r\ncit_model3_Packet1(gspca_dev, 0x005e, 0x0030);\r\ncit_model3_Packet1(gspca_dev, 0x005f, 0x0041);\r\ncit_model3_Packet1(gspca_dev, 0x0064, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0065, 0x0015);\r\ncit_model3_Packet1(gspca_dev, 0x0068, 0x000f);\r\ncit_model3_Packet1(gspca_dev, 0x0079, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x007a, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x007c, 0x003f);\r\ncit_model3_Packet1(gspca_dev, 0x0082, 0x000f);\r\ncit_model3_Packet1(gspca_dev, 0x0085, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0099, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x009b, 0x0023);\r\ncit_model3_Packet1(gspca_dev, 0x009c, 0x0022);\r\ncit_model3_Packet1(gspca_dev, 0x009d, 0x0096);\r\ncit_model3_Packet1(gspca_dev, 0x009e, 0x0096);\r\ncit_model3_Packet1(gspca_dev, 0x009f, 0x000a);\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\ncit_write_reg(gspca_dev, 0x0000, 0x0101);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0078, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0000, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0024, 0x010b);\r\ncit_write_reg(gspca_dev, 0x00a9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x0016, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0002, 0x011d);\r\ncit_write_reg(gspca_dev, 0x0003, 0x011e);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0129);\r\ncit_write_reg(gspca_dev, 0x00fc, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0018, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0004, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0004, 0x011a);\r\ncit_write_reg(gspca_dev, 0x0028, 0x011c);\r\ncit_write_reg(gspca_dev, 0x0022, 0x012a);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0118);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0132);\r\ncit_model3_Packet1(gspca_dev, 0x0021, 0x0001);\r\ncit_write_reg(gspca_dev, compression, 0x0109);\r\nclock_div = 3;\r\nbreak;\r\ncase 320:\r\ncit_write_reg(gspca_dev, 0x0000, 0x0101);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0078, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0000, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0028, 0x010b);\r\ncit_write_reg(gspca_dev, 0x0002, 0x011d);\r\ncit_write_reg(gspca_dev, 0x0000, 0x011e);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0129);\r\ncit_write_reg(gspca_dev, 0x00fc, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0022, 0x012a);\r\ncit_model3_Packet1(gspca_dev, 0x0021, 0x0001);\r\ncit_write_reg(gspca_dev, compression, 0x0109);\r\ncit_write_reg(gspca_dev, 0x00d9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x0006, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0021, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0010, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0004, 0x011a);\r\ncit_write_reg(gspca_dev, 0x003f, 0x011c);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0118);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0132);\r\nclock_div = 5;\r\nbreak;\r\ncase 640:\r\ncit_write_reg(gspca_dev, 0x00f0, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0000, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0038, 0x010b);\r\ncit_write_reg(gspca_dev, 0x00d9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x0006, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0004, 0x011d);\r\ncit_write_reg(gspca_dev, 0x0003, 0x011e);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0129);\r\ncit_write_reg(gspca_dev, 0x00fc, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0021, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0016, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0004, 0x011a);\r\ncit_write_reg(gspca_dev, 0x003f, 0x011c);\r\ncit_write_reg(gspca_dev, 0x0022, 0x012a);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0118);\r\ncit_model3_Packet1(gspca_dev, 0x0021, 0x0001);\r\ncit_write_reg(gspca_dev, compression, 0x0109);\r\ncit_write_reg(gspca_dev, 0x0040, 0x0101);\r\ncit_write_reg(gspca_dev, 0x0040, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0132);\r\nclock_div = 7;\r\nbreak;\r\n}\r\ncit_model3_Packet1(gspca_dev, 0x007e, 0x000e);\r\ncit_model3_Packet1(gspca_dev, 0x0036, 0x0011);\r\ncit_model3_Packet1(gspca_dev, 0x0060, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0061, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x0062, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x0063, 0x0014);\r\ncit_model3_Packet1(gspca_dev, 0x0096, 0x00a0);\r\ncit_model3_Packet1(gspca_dev, 0x0097, 0x0096);\r\ncit_model3_Packet1(gspca_dev, 0x0067, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x005b, 0x000c);\r\ncit_model3_Packet1(gspca_dev, 0x005c, 0x0016);\r\ncit_model3_Packet1(gspca_dev, 0x0098, 0x000b);\r\ncit_model3_Packet1(gspca_dev, 0x002c, 0x0003);\r\ncit_model3_Packet1(gspca_dev, 0x002f, 0x002a);\r\ncit_model3_Packet1(gspca_dev, 0x0030, 0x0029);\r\ncit_model3_Packet1(gspca_dev, 0x0037, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0038, 0x0059);\r\ncit_model3_Packet1(gspca_dev, 0x003d, 0x002e);\r\ncit_model3_Packet1(gspca_dev, 0x003e, 0x0028);\r\ncit_model3_Packet1(gspca_dev, 0x0078, 0x0005);\r\ncit_model3_Packet1(gspca_dev, 0x007b, 0x0011);\r\ncit_model3_Packet1(gspca_dev, 0x007d, 0x004b);\r\ncit_model3_Packet1(gspca_dev, 0x007f, 0x0022);\r\ncit_model3_Packet1(gspca_dev, 0x0080, 0x000c);\r\ncit_model3_Packet1(gspca_dev, 0x0081, 0x000b);\r\ncit_model3_Packet1(gspca_dev, 0x0083, 0x00fd);\r\ncit_model3_Packet1(gspca_dev, 0x0086, 0x000b);\r\ncit_model3_Packet1(gspca_dev, 0x0087, 0x000b);\r\ncit_model3_Packet1(gspca_dev, 0x007e, 0x000e);\r\ncit_model3_Packet1(gspca_dev, 0x0096, 0x00a0);\r\ncit_model3_Packet1(gspca_dev, 0x0097, 0x0096);\r\ncit_model3_Packet1(gspca_dev, 0x0098, 0x000b);\r\ncit_write_reg(gspca_dev, clock_div, 0x0111);\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\ncit_model3_Packet1(gspca_dev, 0x001f, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0039, 0x001f);\r\ncit_model3_Packet1(gspca_dev, 0x003b, 0x003c);\r\ncit_model3_Packet1(gspca_dev, 0x0040, 0x000a);\r\ncit_model3_Packet1(gspca_dev, 0x0051, 0x000a);\r\nbreak;\r\ncase 320:\r\ncit_model3_Packet1(gspca_dev, 0x001f, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0039, 0x001f);\r\ncit_model3_Packet1(gspca_dev, 0x003b, 0x003c);\r\ncit_model3_Packet1(gspca_dev, 0x0040, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0051, 0x000b);\r\nbreak;\r\ncase 640:\r\ncit_model3_Packet1(gspca_dev, 0x001f, 0x0002);\r\ncit_model3_Packet1(gspca_dev, 0x0039, 0x003e);\r\ncit_model3_Packet1(gspca_dev, 0x0040, 0x0008);\r\ncit_model3_Packet1(gspca_dev, 0x0051, 0x000a);\r\nbreak;\r\n}\r\nif (rca_input) {\r\nfor (i = 0; i < ARRAY_SIZE(rca_initdata); i++) {\r\nif (rca_initdata[i][0])\r\ncit_read_reg(gspca_dev, rca_initdata[i][2], 0);\r\nelse\r\ncit_write_reg(gspca_dev, rca_initdata[i][1],\r\nrca_initdata[i][2]);\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int cit_start_model4(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_write_reg(gspca_dev, 0x00c0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00bc, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0080, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0108);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0133);\r\ncit_write_reg(gspca_dev, 0x009b, 0x010f);\r\ncit_write_reg(gspca_dev, 0x00bb, 0x010f);\r\ncit_model4_Packet1(gspca_dev, 0x0038, 0x0000);\r\ncit_model4_Packet1(gspca_dev, 0x000a, 0x005c);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0004, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00fb, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x000c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0009, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0012, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x002a, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0000, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_model4_Packet1(gspca_dev, 0x0034, 0x0000);\r\nswitch (gspca_dev->width) {\r\ncase 128:\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0028, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x001e, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0016, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x000a, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0014, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012e);\r\ncit_write_reg(gspca_dev, 0x001a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a0a, 0x0124);\r\ncit_write_reg(gspca_dev, 0x005a, 0x012d);\r\ncit_write_reg(gspca_dev, 0x9545, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0018, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0043, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00eb, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0032, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0036, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0017, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0013, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0031, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0017, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0078, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\nsd->sof_len = 2;\r\nbreak;\r\ncase 160:\r\ncit_write_reg(gspca_dev, 0x0038, 0x0119);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00b9, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0028, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x001e, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0016, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x000b, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0014, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012e);\r\ncit_write_reg(gspca_dev, 0x001a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a0a, 0x0124);\r\ncit_write_reg(gspca_dev, 0x005a, 0x012d);\r\ncit_write_reg(gspca_dev, 0x9545, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0018, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0043, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00c7, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0032, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0025, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0036, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0048, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0035, 0x012e);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0048, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0090, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\nsd->sof_len = 2;\r\nbreak;\r\ncase 176:\r\ncit_write_reg(gspca_dev, 0x0038, 0x0119);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00b9, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\ncit_write_reg(gspca_dev, 0x002c, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0024, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0016, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0007, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0014, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0001, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012e);\r\ncit_write_reg(gspca_dev, 0x001a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a0a, 0x0124);\r\ncit_write_reg(gspca_dev, 0x005e, 0x012d);\r\ncit_write_reg(gspca_dev, 0x9545, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0018, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0049, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00c7, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0032, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0028, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0036, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0010, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0013, 0x012e);\r\ncit_write_reg(gspca_dev, 0x002a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0010, 0x012d);\r\ncit_write_reg(gspca_dev, 0x006d, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\nsd->sof_len = 10;\r\nbreak;\r\ncase 320:\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\ncit_write_reg(gspca_dev, 0x00d0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\ncit_write_reg(gspca_dev, 0x0028, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x001e, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0016, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x000a, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0014, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012e);\r\ncit_write_reg(gspca_dev, 0x001a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a0a, 0x0124);\r\ncit_write_reg(gspca_dev, 0x005a, 0x012d);\r\ncit_write_reg(gspca_dev, 0x9545, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0018, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0043, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00eb, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0032, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0036, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0017, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0013, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0031, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0017, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0078, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\nsd->sof_len = 2;\r\nbreak;\r\ncase 352:\r\ncit_write_reg(gspca_dev, 0x0070, 0x0119);\r\ncit_write_reg(gspca_dev, 0x00c0, 0x0111);\r\ncit_write_reg(gspca_dev, 0x0039, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0102);\r\ncit_write_reg(gspca_dev, 0x002c, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0024, 0x0105);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0016, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0006, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0014, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0002, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012e);\r\ncit_write_reg(gspca_dev, 0x001a, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a0a, 0x0124);\r\ncit_write_reg(gspca_dev, 0x005e, 0x012d);\r\ncit_write_reg(gspca_dev, 0x9545, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0018, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0049, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd055, 0x0124);\r\ncit_write_reg(gspca_dev, 0x001c, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00cf, 0x012e);\r\ncit_write_reg(gspca_dev, 0xaa28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0032, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x0130);\r\ncit_write_reg(gspca_dev, 0x82a8, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0036, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0008, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0xfffa, 0x0124);\r\ncit_write_reg(gspca_dev, 0x00aa, 0x012d);\r\ncit_write_reg(gspca_dev, 0x001e, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd141, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0010, 0x0127);\r\ncit_write_reg(gspca_dev, 0x0013, 0x012e);\r\ncit_write_reg(gspca_dev, 0x0025, 0x0130);\r\ncit_write_reg(gspca_dev, 0x8a28, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0010, 0x012d);\r\ncit_write_reg(gspca_dev, 0x0048, 0x012f);\r\ncit_write_reg(gspca_dev, 0xd145, 0x0124);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0127);\r\ncit_write_reg(gspca_dev, 0xfea8, 0x0124);\r\nsd->sof_len = 2;\r\nbreak;\r\n}\r\ncit_model4_Packet1(gspca_dev, 0x0038, 0x0004);\r\nreturn 0;\r\n}\r\nstatic int cit_start_ibm_netcam_pro(struct gspca_dev *gspca_dev)\r\n{\r\nconst unsigned short compression = 0;\r\nint i, clock_div;\r\nclock_div = cit_get_clock_div(gspca_dev);\r\nif (clock_div < 0)\r\nreturn clock_div;\r\ncit_write_reg(gspca_dev, 0x0003, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0100);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0001, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0040, 0x0108);\r\ncit_write_reg(gspca_dev, 0x0019, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0060, 0x0116);\r\ncit_model3_Packet1(gspca_dev, 0x0049, 0x0000);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0101);\r\ncit_write_reg(gspca_dev, 0x003a, 0x0102);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0103);\r\ncit_write_reg(gspca_dev, 0x0078, 0x0105);\r\ncit_write_reg(gspca_dev, 0x0000, 0x010a);\r\ncit_write_reg(gspca_dev, 0x0002, 0x011d);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0129);\r\ncit_write_reg(gspca_dev, 0x00fc, 0x012b);\r\ncit_write_reg(gspca_dev, 0x0022, 0x012a);\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\ncit_write_reg(gspca_dev, 0x0024, 0x010b);\r\ncit_write_reg(gspca_dev, 0x0089, 0x0119);\r\ncit_write_reg(gspca_dev, 0x000a, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0003, 0x011e);\r\ncit_write_reg(gspca_dev, 0x0007, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0009, 0x011a);\r\ncit_write_reg(gspca_dev, 0x008b, 0x011c);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0118);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0132);\r\nbreak;\r\ncase 320:\r\ncit_write_reg(gspca_dev, 0x0028, 0x010b);\r\ncit_write_reg(gspca_dev, 0x00d9, 0x0119);\r\ncit_write_reg(gspca_dev, 0x0006, 0x011b);\r\ncit_write_reg(gspca_dev, 0x0000, 0x011e);\r\ncit_write_reg(gspca_dev, 0x000e, 0x0104);\r\ncit_write_reg(gspca_dev, 0x0004, 0x011a);\r\ncit_write_reg(gspca_dev, 0x003f, 0x011c);\r\ncit_write_reg(gspca_dev, 0x000c, 0x0118);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0132);\r\nbreak;\r\n}\r\ncit_model3_Packet1(gspca_dev, 0x0019, 0x0031);\r\ncit_model3_Packet1(gspca_dev, 0x001a, 0x0003);\r\ncit_model3_Packet1(gspca_dev, 0x001b, 0x0038);\r\ncit_model3_Packet1(gspca_dev, 0x001c, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0024, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0027, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x002a, 0x0004);\r\ncit_model3_Packet1(gspca_dev, 0x0035, 0x000b);\r\ncit_model3_Packet1(gspca_dev, 0x003f, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x0044, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x0054, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00c4, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00e7, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00e9, 0x0001);\r\ncit_model3_Packet1(gspca_dev, 0x00ee, 0x0000);\r\ncit_model3_Packet1(gspca_dev, 0x00f3, 0x00c0);\r\ncit_write_reg(gspca_dev, compression, 0x0109);\r\ncit_write_reg(gspca_dev, clock_div, 0x0111);\r\nif (rca_input) {\r\nfor (i = 0; i < ARRAY_SIZE(rca_initdata); i++) {\r\nif (rca_initdata[i][0])\r\ncit_read_reg(gspca_dev, rca_initdata[i][2], 0);\r\nelse\r\ncit_write_reg(gspca_dev, rca_initdata[i][1],\r\nrca_initdata[i][2]);\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int sd_start(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nint packet_size;\r\npacket_size = cit_get_packet_size(gspca_dev);\r\nif (packet_size < 0)\r\nreturn packet_size;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncit_start_model0(gspca_dev);\r\nbreak;\r\ncase CIT_MODEL1:\r\ncit_start_model1(gspca_dev);\r\nbreak;\r\ncase CIT_MODEL2:\r\ncit_start_model2(gspca_dev);\r\nbreak;\r\ncase CIT_MODEL3:\r\ncit_start_model3(gspca_dev);\r\nbreak;\r\ncase CIT_MODEL4:\r\ncit_start_model4(gspca_dev);\r\nbreak;\r\ncase CIT_IBM_NETCAM_PRO:\r\ncit_start_ibm_netcam_pro(gspca_dev);\r\nbreak;\r\n}\r\ncit_write_reg(gspca_dev, packet_size >> 8, 0x0106);\r\ncit_write_reg(gspca_dev, packet_size & 0xff, 0x0107);\r\ncit_restart_stream(gspca_dev);\r\nreturn 0;\r\n}\r\nstatic int sd_isoc_init(struct gspca_dev *gspca_dev)\r\n{\r\nstruct usb_host_interface *alt;\r\nint max_packet_size;\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\nmax_packet_size = 450;\r\nbreak;\r\ncase 176:\r\nmax_packet_size = 600;\r\nbreak;\r\ndefault:\r\nmax_packet_size = 1022;\r\nbreak;\r\n}\r\nalt = &gspca_dev->dev->actconfig->intf_cache[0]->altsetting[1];\r\nalt->endpoint[0].desc.wMaxPacketSize = cpu_to_le16(max_packet_size);\r\nreturn 0;\r\n}\r\nstatic int sd_isoc_nego(struct gspca_dev *gspca_dev)\r\n{\r\nint ret, packet_size, min_packet_size;\r\nstruct usb_host_interface *alt;\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\nmin_packet_size = 200;\r\nbreak;\r\ncase 176:\r\nmin_packet_size = 266;\r\nbreak;\r\ndefault:\r\nmin_packet_size = 400;\r\nbreak;\r\n}\r\nalt = &gspca_dev->dev->actconfig->intf_cache[0]->altsetting[1];\r\npacket_size = le16_to_cpu(alt->endpoint[0].desc.wMaxPacketSize);\r\nif (packet_size <= min_packet_size)\r\nreturn -EIO;\r\npacket_size -= 100;\r\nif (packet_size < min_packet_size)\r\npacket_size = min_packet_size;\r\nalt->endpoint[0].desc.wMaxPacketSize = cpu_to_le16(packet_size);\r\nret = usb_set_interface(gspca_dev->dev, gspca_dev->iface, 1);\r\nif (ret < 0)\r\npr_err("set alt 1 err %d\n", ret);\r\nreturn ret;\r\n}\r\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\r\n{\r\ncit_write_reg(gspca_dev, 0x0000, 0x010c);\r\n}\r\nstatic void sd_stop0(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nif (!gspca_dev->present)\r\nreturn;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncit_write_reg(gspca_dev, 0x00c0, 0x0100);\r\nbreak;\r\ncase CIT_MODEL1:\r\ncit_send_FF_04_02(gspca_dev);\r\ncit_read_reg(gspca_dev, 0x0100, 0);\r\ncit_write_reg(gspca_dev, 0x81, 0x0100);\r\nbreak;\r\ncase CIT_MODEL2:\r\nv4l2_ctrl_grab(sd->lighting, false);\r\ncase CIT_MODEL4:\r\ncit_model2_Packet1(gspca_dev, 0x0030, 0x0004);\r\ncit_write_reg(gspca_dev, 0x0080, 0x0100);\r\ncit_write_reg(gspca_dev, 0x0020, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00a0, 0x0111);\r\ncit_model2_Packet1(gspca_dev, 0x0030, 0x0002);\r\ncit_write_reg(gspca_dev, 0x0020, 0x0111);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0112);\r\nbreak;\r\ncase CIT_MODEL3:\r\ncit_write_reg(gspca_dev, 0x0006, 0x012c);\r\ncit_model3_Packet1(gspca_dev, 0x0046, 0x0000);\r\ncit_read_reg(gspca_dev, 0x0116, 0);\r\ncit_write_reg(gspca_dev, 0x0064, 0x0116);\r\ncit_read_reg(gspca_dev, 0x0115, 0);\r\ncit_write_reg(gspca_dev, 0x0003, 0x0115);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0112);\r\ncit_write_reg(gspca_dev, 0x0080, 0x0100);\r\nbreak;\r\ncase CIT_IBM_NETCAM_PRO:\r\ncit_model3_Packet1(gspca_dev, 0x0049, 0x00ff);\r\ncit_write_reg(gspca_dev, 0x0006, 0x012c);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0116);\r\ncit_write_reg(gspca_dev, 0x0008, 0x0123);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0117);\r\ncit_write_reg(gspca_dev, 0x0003, 0x0133);\r\ncit_write_reg(gspca_dev, 0x0000, 0x0111);\r\ncit_write_reg(gspca_dev, 0x00c0, 0x0100);\r\nbreak;\r\n}\r\n#if IS_ENABLED(CONFIG_INPUT)\r\nif (sd->button_state) {\r\ninput_report_key(gspca_dev->input_dev, KEY_CAMERA, 0);\r\ninput_sync(gspca_dev->input_dev);\r\nsd->button_state = 0;\r\n}\r\n#endif\r\n}\r\nstatic u8 *cit_find_sof(struct gspca_dev *gspca_dev, u8 *data, int len)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nu8 byte3 = 0, byte4 = 0;\r\nint i;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL1:\r\ncase CIT_MODEL3:\r\ncase CIT_IBM_NETCAM_PRO:\r\nswitch (gspca_dev->width) {\r\ncase 160:\r\nbyte3 = 0x02;\r\nbyte4 = 0x0a;\r\nbreak;\r\ncase 176:\r\nbyte3 = 0x02;\r\nbyte4 = 0x0e;\r\nbreak;\r\ncase 320:\r\nbyte3 = 0x02;\r\nbyte4 = 0x08;\r\nbreak;\r\ncase 352:\r\nbyte3 = 0x02;\r\nbyte4 = 0x00;\r\nbreak;\r\ncase 640:\r\nbyte3 = 0x03;\r\nbyte4 = 0x08;\r\nbreak;\r\n}\r\nif (sd->model <= CIT_MODEL1)\r\nbyte3 = 0x00;\r\nfor (i = 0; i < len; i++) {\r\nif (sd->model == CIT_MODEL0 && sd->sof_read != i)\r\nbreak;\r\nswitch (sd->sof_read) {\r\ncase 0:\r\nif (data[i] == 0x00)\r\nsd->sof_read++;\r\nbreak;\r\ncase 1:\r\nif (data[i] == 0xff)\r\nsd->sof_read++;\r\nelse if (data[i] == 0x00)\r\nsd->sof_read = 1;\r\nelse\r\nsd->sof_read = 0;\r\nbreak;\r\ncase 2:\r\nif (data[i] == byte3)\r\nsd->sof_read++;\r\nelse if (data[i] == 0x00)\r\nsd->sof_read = 1;\r\nelse\r\nsd->sof_read = 0;\r\nbreak;\r\ncase 3:\r\nif (data[i] == byte4) {\r\nsd->sof_read = 0;\r\nreturn data + i + (sd->sof_len - 3);\r\n}\r\nif (byte3 == 0x00 && data[i] == 0xff)\r\nsd->sof_read = 2;\r\nelse if (data[i] == 0x00)\r\nsd->sof_read = 1;\r\nelse\r\nsd->sof_read = 0;\r\nbreak;\r\n}\r\n}\r\nbreak;\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL4:\r\nfor (i = 0; i < len; i++) {\r\nswitch (sd->sof_read) {\r\ncase 0:\r\nif (data[i] == 0x00)\r\nsd->sof_read++;\r\nbreak;\r\ncase 1:\r\nsd->sof_read = 0;\r\nif (data[i] == 0xff) {\r\nif (i >= 4)\r\nPDEBUG(D_FRAM,\r\n"header found at offset: %d: %02x %02x 00 %02x %02x %02x\n",\r\ni - 1,\r\ndata[i - 4],\r\ndata[i - 3],\r\ndata[i],\r\ndata[i + 1],\r\ndata[i + 2]);\r\nelse\r\nPDEBUG(D_FRAM,\r\n"header found at offset: %d: 00 %02x %02x %02x\n",\r\ni - 1,\r\ndata[i],\r\ndata[i + 1],\r\ndata[i + 2]);\r\nreturn data + i + (sd->sof_len - 1);\r\n}\r\nbreak;\r\n}\r\n}\r\nbreak;\r\n}\r\nreturn NULL;\r\n}\r\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\r\nu8 *data, int len)\r\n{\r\nstruct sd *sd = (struct sd *) gspca_dev;\r\nunsigned char *sof;\r\nsof = cit_find_sof(gspca_dev, data, len);\r\nif (sof) {\r\nint n;\r\nn = sof - data;\r\nif (n > sd->sof_len)\r\nn -= sd->sof_len;\r\nelse\r\nn = 0;\r\ngspca_frame_add(gspca_dev, LAST_PACKET,\r\ndata, n);\r\ngspca_frame_add(gspca_dev, FIRST_PACKET, NULL, 0);\r\nlen -= sof - data;\r\ndata = sof;\r\n}\r\ngspca_frame_add(gspca_dev, INTER_PACKET, data, len);\r\n}\r\nstatic void cit_check_button(struct gspca_dev *gspca_dev)\r\n{\r\nint new_button_state;\r\nstruct sd *sd = (struct sd *)gspca_dev;\r\nswitch (sd->model) {\r\ncase CIT_MODEL3:\r\ncase CIT_IBM_NETCAM_PRO:\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\ncit_read_reg(gspca_dev, 0x0113, 0);\r\nnew_button_state = !gspca_dev->usb_buf[0];\r\nif (new_button_state)\r\ncit_write_reg(gspca_dev, 0x01, 0x0113);\r\nif (sd->button_state != new_button_state) {\r\ninput_report_key(gspca_dev->input_dev, KEY_CAMERA,\r\nnew_button_state);\r\ninput_sync(gspca_dev->input_dev);\r\nsd->button_state = new_button_state;\r\n}\r\n}\r\nstatic int sd_s_ctrl(struct v4l2_ctrl *ctrl)\r\n{\r\nstruct gspca_dev *gspca_dev =\r\ncontainer_of(ctrl->handler, struct gspca_dev, ctrl_handler);\r\nstruct sd *sd = (struct sd *)gspca_dev;\r\ngspca_dev->usb_err = 0;\r\nif (!gspca_dev->streaming)\r\nreturn 0;\r\nif (sd->stop_on_control_change)\r\nsd_stopN(gspca_dev);\r\nswitch (ctrl->id) {\r\ncase V4L2_CID_BRIGHTNESS:\r\ncit_set_brightness(gspca_dev, ctrl->val);\r\nbreak;\r\ncase V4L2_CID_CONTRAST:\r\ncit_set_contrast(gspca_dev, ctrl->val);\r\nbreak;\r\ncase V4L2_CID_HUE:\r\ncit_set_hue(gspca_dev, ctrl->val);\r\nbreak;\r\ncase V4L2_CID_HFLIP:\r\ncit_set_hflip(gspca_dev, ctrl->val);\r\nbreak;\r\ncase V4L2_CID_SHARPNESS:\r\ncit_set_sharpness(gspca_dev, ctrl->val);\r\nbreak;\r\ncase V4L2_CID_BACKLIGHT_COMPENSATION:\r\ncit_set_lighting(gspca_dev, ctrl->val);\r\nbreak;\r\n}\r\nif (sd->stop_on_control_change)\r\ncit_restart_stream(gspca_dev);\r\nreturn gspca_dev->usb_err;\r\n}\r\nstatic int sd_init_controls(struct gspca_dev *gspca_dev)\r\n{\r\nstruct sd *sd = (struct sd *)gspca_dev;\r\nstruct v4l2_ctrl_handler *hdl = &gspca_dev->ctrl_handler;\r\nbool has_brightness;\r\nbool has_contrast;\r\nbool has_hue;\r\nbool has_sharpness;\r\nbool has_lighting;\r\nbool has_hflip;\r\nhas_brightness = has_contrast = has_hue =\r\nhas_sharpness = has_hflip = has_lighting = false;\r\nswitch (sd->model) {\r\ncase CIT_MODEL0:\r\nhas_contrast = has_hflip = true;\r\nbreak;\r\ncase CIT_MODEL1:\r\nhas_brightness = has_contrast =\r\nhas_sharpness = has_lighting = true;\r\nbreak;\r\ncase CIT_MODEL2:\r\nhas_brightness = has_hue = has_lighting = true;\r\nbreak;\r\ncase CIT_MODEL3:\r\nhas_brightness = has_contrast = has_sharpness = true;\r\nbreak;\r\ncase CIT_MODEL4:\r\nhas_brightness = has_hue = true;\r\nbreak;\r\ncase CIT_IBM_NETCAM_PRO:\r\nhas_brightness = has_hue =\r\nhas_sharpness = has_hflip = has_lighting = true;\r\nbreak;\r\n}\r\ngspca_dev->vdev.ctrl_handler = hdl;\r\nv4l2_ctrl_handler_init(hdl, 5);\r\nif (has_brightness)\r\nv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_BRIGHTNESS, 0, 63, 1, 32);\r\nif (has_contrast)\r\nv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_CONTRAST, 0, 20, 1, 10);\r\nif (has_hue)\r\nv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_HUE, 0, 127, 1, 63);\r\nif (has_sharpness)\r\nv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_SHARPNESS, 0, 6, 1, 3);\r\nif (has_lighting)\r\nsd->lighting = v4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_BACKLIGHT_COMPENSATION, 0, 2, 1, 1);\r\nif (has_hflip)\r\nv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\r\nV4L2_CID_HFLIP, 0, 1, 1, 0);\r\nif (hdl->error) {\r\npr_err("Could not initialize controls\n");\r\nreturn hdl->error;\r\n}\r\nreturn 0;\r\n}\r\nstatic int sd_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nconst struct sd_desc *desc = &sd_desc;\r\nswitch (id->driver_info) {\r\ncase CIT_MODEL0:\r\ncase CIT_MODEL1:\r\nif (intf->cur_altsetting->desc.bInterfaceNumber != 2)\r\nreturn -ENODEV;\r\nbreak;\r\ncase CIT_MODEL2:\r\ncase CIT_MODEL4:\r\nif (intf->cur_altsetting->desc.bInterfaceNumber != 0)\r\nreturn -ENODEV;\r\nbreak;\r\ncase CIT_MODEL3:\r\nif (intf->cur_altsetting->desc.bInterfaceNumber != 0)\r\nreturn -ENODEV;\r\nif (ibm_netcam_pro)\r\ndesc = &sd_desc_isoc_nego;\r\nbreak;\r\n}\r\nreturn gspca_dev_probe2(intf, id, desc, sizeof(struct sd), THIS_MODULE);\r\n}
