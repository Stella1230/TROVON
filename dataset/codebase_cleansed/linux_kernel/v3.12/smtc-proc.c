static int smtc_proc_show(struct seq_file *m, void *v)\r\n{\r\nint i;\r\nextern unsigned long ebase;\r\nseq_printf(m, "SMTC Status Word: 0x%08x\n", smtc_status);\r\nseq_printf(m, "Config7: 0x%08x\n", read_c0_config7());\r\nseq_printf(m, "EBASE: 0x%08lx\n", ebase);\r\nseq_printf(m, "Counter Interrupts taken per CPU (TC)\n");\r\nfor (i=0; i < NR_CPUS; i++)\r\nseq_printf(m, "%d: %ld\n", i, smtc_cpu_stats[i].timerints);\r\nseq_printf(m, "Self-IPIs by CPU:\n");\r\nfor(i = 0; i < NR_CPUS; i++)\r\nseq_printf(m, "%d: %ld\n", i, smtc_cpu_stats[i].selfipis);\r\nseq_printf(m, "%d Recoveries of \"stolen\" FPU\n",\r\natomic_read(&smtc_fpu_recoveries));\r\nreturn 0;\r\n}\r\nstatic int smtc_proc_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, smtc_proc_show, NULL);\r\n}\r\nvoid init_smtc_stats(void)\r\n{\r\nint i;\r\nfor (i=0; i<NR_CPUS; i++) {\r\nsmtc_cpu_stats[i].timerints = 0;\r\nsmtc_cpu_stats[i].selfipis = 0;\r\n}\r\natomic_set(&smtc_fpu_recoveries, 0);\r\nproc_create("smtc", 0444, NULL, &smtc_proc_fops);\r\n}
