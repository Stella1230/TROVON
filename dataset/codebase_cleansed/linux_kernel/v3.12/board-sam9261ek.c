static void __init ek_init_early(void)\r\n{\r\nat91_initialize(18432000);\r\n}\r\nstatic void __init ek_add_device_dm9000(void)\r\n{\r\nstruct resource *r = &dm9000_resource[2];\r\nsam9_smc_configure(0, 2, &dm9000_smc_config);\r\nat91_set_gpio_output(AT91_PIN_PC10, 0);\r\nat91_set_gpio_input(AT91_PIN_PC11, 0);\r\nr->start = r->end = gpio_to_irq(AT91_PIN_PC11);\r\nplatform_device_register(&dm9000_device);\r\n}\r\nstatic void __init ek_add_device_dm9000(void) {}\r\nstatic void __init ek_add_device_nand(void)\r\n{\r\nek_nand_data.bus_width_16 = board_have_nand_16bit();\r\nif (ek_nand_data.bus_width_16)\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_16;\r\nelse\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_8;\r\nsam9_smc_configure(0, 3, &ek_nand_smc_config);\r\nat91_add_device_nand(&ek_nand_data);\r\n}\r\nstatic int ads7843_pendown_state(void)\r\n{\r\nreturn !at91_get_gpio_value(AT91_PIN_PC2);\r\n}\r\nstatic void __init ek_add_device_ts(void)\r\n{\r\nat91_set_B_periph(AT91_PIN_PC2, 1);\r\nat91_set_gpio_input(AT91_PIN_PA11, 1);\r\n}\r\nstatic void __init ek_add_device_ts(void) {}\r\nstatic void __init at73c213_set_clk(struct at73c213_board_info *info)\r\n{\r\nstruct clk *pck2;\r\nstruct clk *plla;\r\npck2 = clk_get(NULL, "pck2");\r\nplla = clk_get(NULL, "plla");\r\nat91_set_B_periph(AT91_PIN_PB31, 0);\r\nclk_set_parent(pck2, plla);\r\nclk_put(plla);\r\ninfo->dac_clk = pck2;\r\n}\r\nstatic void __init at73c213_set_clk(struct at73c213_board_info *info) {}\r\nstatic void at91_lcdc_stn_power_control(int on)\r\n{\r\nif (on) {\r\nat91_set_gpio_value(AT91_PIN_PC14, 0);\r\nat91_set_gpio_value(AT91_PIN_PC15, 0);\r\n} else {\r\nat91_set_gpio_value(AT91_PIN_PC14, 1);\r\nat91_set_gpio_value(AT91_PIN_PC15, 1);\r\n}\r\n}\r\nstatic void at91_lcdc_tft_power_control(int on)\r\n{\r\nif (on)\r\nat91_set_gpio_value(AT91_PIN_PA12, 0);\r\nelse\r\nat91_set_gpio_value(AT91_PIN_PA12, 1);\r\n}\r\nstatic void __init ek_add_device_buttons(void)\r\n{\r\nat91_set_gpio_input(AT91_PIN_PA27, 1);\r\nat91_set_deglitch(AT91_PIN_PA27, 1);\r\nat91_set_gpio_input(AT91_PIN_PA26, 1);\r\nat91_set_deglitch(AT91_PIN_PA26, 1);\r\nat91_set_gpio_input(AT91_PIN_PA25, 1);\r\nat91_set_deglitch(AT91_PIN_PA25, 1);\r\nat91_set_gpio_input(AT91_PIN_PA24, 1);\r\nat91_set_deglitch(AT91_PIN_PA24, 1);\r\nplatform_device_register(&ek_button_device);\r\n}\r\nstatic void __init ek_add_device_buttons(void) {}\r\nstatic void __init ek_board_init(void)\r\n{\r\nat91_register_uart(0, 0, 0);\r\nat91_add_device_serial();\r\nif (cpu_is_at91sam9g10())\r\nek_lcdc_data.lcd_wiring_mode = ATMEL_LCDC_WIRING_RGB;\r\nat91_add_device_usbh(&ek_usbh_data);\r\nat91_add_device_udc(&ek_udc_data);\r\nat91_add_device_i2c(NULL, 0);\r\nek_add_device_nand();\r\nek_add_device_dm9000();\r\n#if defined(CONFIG_SPI_ATMEL) || defined(CONFIG_SPI_ATMEL_MODULE)\r\nat91_add_device_spi(ek_spi_devices, ARRAY_SIZE(ek_spi_devices));\r\nek_add_device_ts();\r\nat73c213_set_clk(&at73c213_data);\r\nat91_add_device_ssc(AT91SAM9261_ID_SSC1, ATMEL_SSC_TX);\r\n#else\r\nat91_add_device_mci(0, &mci0_data);\r\n#endif\r\nat91_add_device_lcdc(&ek_lcdc_data);\r\nek_add_device_buttons();\r\nat91_gpio_leds(ek_leds, ARRAY_SIZE(ek_leds));\r\n}
