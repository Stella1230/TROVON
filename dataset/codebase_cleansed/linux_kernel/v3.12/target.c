enum perf_target_errno perf_target__validate(struct perf_target *target)\r\n{\r\nenum perf_target_errno ret = PERF_ERRNO_TARGET__SUCCESS;\r\nif (target->pid)\r\ntarget->tid = target->pid;\r\nif (target->tid && target->cpu_list) {\r\ntarget->cpu_list = NULL;\r\nif (ret == PERF_ERRNO_TARGET__SUCCESS)\r\nret = PERF_ERRNO_TARGET__PID_OVERRIDE_CPU;\r\n}\r\nif (target->tid && target->uid_str) {\r\ntarget->uid_str = NULL;\r\nif (ret == PERF_ERRNO_TARGET__SUCCESS)\r\nret = PERF_ERRNO_TARGET__PID_OVERRIDE_UID;\r\n}\r\nif (target->uid_str && target->cpu_list) {\r\ntarget->cpu_list = NULL;\r\nif (ret == PERF_ERRNO_TARGET__SUCCESS)\r\nret = PERF_ERRNO_TARGET__UID_OVERRIDE_CPU;\r\n}\r\nif (target->tid && target->system_wide) {\r\ntarget->system_wide = false;\r\nif (ret == PERF_ERRNO_TARGET__SUCCESS)\r\nret = PERF_ERRNO_TARGET__PID_OVERRIDE_SYSTEM;\r\n}\r\nif (target->uid_str && target->system_wide) {\r\ntarget->system_wide = false;\r\nif (ret == PERF_ERRNO_TARGET__SUCCESS)\r\nret = PERF_ERRNO_TARGET__UID_OVERRIDE_SYSTEM;\r\n}\r\nreturn ret;\r\n}\r\nenum perf_target_errno perf_target__parse_uid(struct perf_target *target)\r\n{\r\nstruct passwd pwd, *result;\r\nchar buf[1024];\r\nconst char *str = target->uid_str;\r\ntarget->uid = UINT_MAX;\r\nif (str == NULL)\r\nreturn PERF_ERRNO_TARGET__SUCCESS;\r\ngetpwnam_r(str, &pwd, buf, sizeof(buf), &result);\r\nif (result == NULL) {\r\nchar *endptr;\r\nint uid = strtol(str, &endptr, 10);\r\nif (*endptr != '\0')\r\nreturn PERF_ERRNO_TARGET__INVALID_UID;\r\ngetpwuid_r(uid, &pwd, buf, sizeof(buf), &result);\r\nif (result == NULL)\r\nreturn PERF_ERRNO_TARGET__USER_NOT_FOUND;\r\n}\r\ntarget->uid = result->pw_uid;\r\nreturn PERF_ERRNO_TARGET__SUCCESS;\r\n}\r\nint perf_target__strerror(struct perf_target *target, int errnum,\r\nchar *buf, size_t buflen)\r\n{\r\nint idx;\r\nconst char *msg;\r\nBUG_ON(buflen == 0);\r\nif (errnum >= 0) {\r\nconst char *err = strerror_r(errnum, buf, buflen);\r\nif (err != buf) {\r\nsize_t len = strlen(err);\r\nmemcpy(buf, err, min(buflen - 1, len));\r\n*(buf + min(buflen - 1, len)) = '\0';\r\n}\r\nreturn 0;\r\n}\r\nif (errnum < __PERF_ERRNO_TARGET__START ||\r\nerrnum >= __PERF_ERRNO_TARGET__END)\r\nreturn -1;\r\nidx = errnum - __PERF_ERRNO_TARGET__START;\r\nmsg = perf_target__error_str[idx];\r\nswitch (errnum) {\r\ncase PERF_ERRNO_TARGET__PID_OVERRIDE_CPU\r\n... PERF_ERRNO_TARGET__UID_OVERRIDE_SYSTEM:\r\nsnprintf(buf, buflen, "%s", msg);\r\nbreak;\r\ncase PERF_ERRNO_TARGET__INVALID_UID:\r\ncase PERF_ERRNO_TARGET__USER_NOT_FOUND:\r\nsnprintf(buf, buflen, msg, target->uid_str);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nreturn 0;\r\n}
