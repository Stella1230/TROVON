void acpi_ns_print_pathname(u32 num_segments, char *pathname)\r\n{\r\nu32 i;\r\nACPI_FUNCTION_NAME(ns_print_pathname);\r\nif (!ACPI_IS_DEBUG_ENABLED(ACPI_LV_NAMES, ACPI_NAMESPACE)) {\r\nreturn;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES, "["));\r\nwhile (num_segments) {\r\nfor (i = 0; i < 4; i++) {\r\nACPI_IS_PRINT(pathname[i]) ?\r\nacpi_os_printf("%c", pathname[i]) :\r\nacpi_os_printf("?");\r\n}\r\npathname += ACPI_NAME_SIZE;\r\nnum_segments--;\r\nif (num_segments) {\r\nacpi_os_printf(".");\r\n}\r\n}\r\nacpi_os_printf("]\n");\r\n}\r\nvoid\r\nacpi_ns_dump_pathname(acpi_handle handle, char *msg, u32 level, u32 component)\r\n{\r\nACPI_FUNCTION_TRACE(ns_dump_pathname);\r\nif (!ACPI_IS_DEBUG_ENABLED(level, component)) {\r\nreturn_VOID;\r\n}\r\nacpi_ns_print_node_pathname(handle, msg);\r\nacpi_os_printf("\n");\r\nreturn_VOID;\r\n}\r\nacpi_status\r\nacpi_ns_dump_one_object(acpi_handle obj_handle,\r\nu32 level, void *context, void **return_value)\r\n{\r\nstruct acpi_walk_info *info = (struct acpi_walk_info *)context;\r\nstruct acpi_namespace_node *this_node;\r\nunion acpi_operand_object *obj_desc = NULL;\r\nacpi_object_type obj_type;\r\nacpi_object_type type;\r\nu32 bytes_to_dump;\r\nu32 dbg_level;\r\nu32 i;\r\nACPI_FUNCTION_NAME(ns_dump_one_object);\r\nif (!(acpi_dbg_level & info->debug_level)) {\r\nreturn (AE_OK);\r\n}\r\nif (!obj_handle) {\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO, "Null object handle\n"));\r\nreturn (AE_OK);\r\n}\r\nthis_node = acpi_ns_validate_handle(obj_handle);\r\nif (!this_node) {\r\nACPI_DEBUG_PRINT((ACPI_DB_INFO, "Invalid object handle %p\n",\r\nobj_handle));\r\nreturn (AE_OK);\r\n}\r\ntype = this_node->type;\r\nif ((info->owner_id != ACPI_OWNER_ID_MAX) &&\r\n(info->owner_id != this_node->owner_id)) {\r\nreturn (AE_OK);\r\n}\r\nif (!(info->display_type & ACPI_DISPLAY_SHORT)) {\r\nacpi_os_printf("%2d%*s", (u32) level - 1, (int)level * 2, " ");\r\nif (type > ACPI_TYPE_LOCAL_MAX) {\r\nACPI_WARNING((AE_INFO,\r\n"Invalid ACPI Object Type 0x%08X", type));\r\n}\r\nacpi_os_printf("%4.4s", acpi_ut_get_node_name(this_node));\r\n}\r\nacpi_os_printf(" %-12s %p %2.2X ",\r\nacpi_ut_get_type_name(type), this_node,\r\nthis_node->owner_id);\r\ndbg_level = acpi_dbg_level;\r\nacpi_dbg_level = 0;\r\nobj_desc = acpi_ns_get_attached_object(this_node);\r\nacpi_dbg_level = dbg_level;\r\nif (this_node->flags & ANOBJ_TEMPORARY) {\r\nacpi_os_printf("(T) ");\r\n}\r\nswitch (info->display_type & ACPI_DISPLAY_MASK) {\r\ncase ACPI_DISPLAY_SUMMARY:\r\nif (!obj_desc) {\r\nswitch (type) {\r\ncase ACPI_TYPE_INTEGER:\r\ncase ACPI_TYPE_PACKAGE:\r\ncase ACPI_TYPE_BUFFER:\r\ncase ACPI_TYPE_STRING:\r\ncase ACPI_TYPE_METHOD:\r\nacpi_os_printf("<No attached object>");\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nacpi_os_printf("\n");\r\nreturn (AE_OK);\r\n}\r\nswitch (type) {\r\ncase ACPI_TYPE_PROCESSOR:\r\nacpi_os_printf("ID %02X Len %02X Addr %p\n",\r\nobj_desc->processor.proc_id,\r\nobj_desc->processor.length,\r\nACPI_CAST_PTR(void,\r\nobj_desc->processor.\r\naddress));\r\nbreak;\r\ncase ACPI_TYPE_DEVICE:\r\nacpi_os_printf("Notify Object: %p\n", obj_desc);\r\nbreak;\r\ncase ACPI_TYPE_METHOD:\r\nacpi_os_printf("Args %X Len %.4X Aml %p\n",\r\n(u32) obj_desc->method.param_count,\r\nobj_desc->method.aml_length,\r\nobj_desc->method.aml_start);\r\nbreak;\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf("= %8.8X%8.8X\n",\r\nACPI_FORMAT_UINT64(obj_desc->integer.\r\nvalue));\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nif (obj_desc->common.flags & AOPOBJ_DATA_VALID) {\r\nacpi_os_printf("Elements %.2X\n",\r\nobj_desc->package.count);\r\n} else {\r\nacpi_os_printf("[Length not yet evaluated]\n");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nif (obj_desc->common.flags & AOPOBJ_DATA_VALID) {\r\nacpi_os_printf("Len %.2X",\r\nobj_desc->buffer.length);\r\nif (obj_desc->buffer.length > 0) {\r\nacpi_os_printf(" =");\r\nfor (i = 0;\r\n(i < obj_desc->buffer.length\r\n&& i < 12); i++) {\r\nacpi_os_printf(" %.2hX",\r\nobj_desc->buffer.\r\npointer[i]);\r\n}\r\n}\r\nacpi_os_printf("\n");\r\n} else {\r\nacpi_os_printf("[Length not yet evaluated]\n");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf("Len %.2X ", obj_desc->string.length);\r\nacpi_ut_print_string(obj_desc->string.pointer, 32);\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_TYPE_REGION:\r\nacpi_os_printf("[%s]",\r\nacpi_ut_get_region_name(obj_desc->region.\r\nspace_id));\r\nif (obj_desc->region.flags & AOPOBJ_DATA_VALID) {\r\nacpi_os_printf(" Addr %8.8X%8.8X Len %.4X\n",\r\nACPI_FORMAT_NATIVE_UINT\r\n(obj_desc->region.address),\r\nobj_desc->region.length);\r\n} else {\r\nacpi_os_printf\r\n(" [Address/Length not yet evaluated]\n");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nacpi_os_printf("[%s]\n",\r\nacpi_ut_get_reference_name(obj_desc));\r\nbreak;\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\nif (obj_desc->buffer_field.buffer_obj &&\r\nobj_desc->buffer_field.buffer_obj->buffer.node) {\r\nacpi_os_printf("Buf [%4.4s]",\r\nacpi_ut_get_node_name(obj_desc->\r\nbuffer_field.\r\nbuffer_obj->\r\nbuffer.\r\nnode));\r\n}\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\nacpi_os_printf("Rgn [%4.4s]",\r\nacpi_ut_get_node_name(obj_desc->\r\ncommon_field.\r\nregion_obj->region.\r\nnode));\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\nacpi_os_printf("Rgn [%4.4s] Bnk [%4.4s]",\r\nacpi_ut_get_node_name(obj_desc->\r\ncommon_field.\r\nregion_obj->region.\r\nnode),\r\nacpi_ut_get_node_name(obj_desc->\r\nbank_field.\r\nbank_obj->\r\ncommon_field.\r\nnode));\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nacpi_os_printf("Idx [%4.4s] Dat [%4.4s]",\r\nacpi_ut_get_node_name(obj_desc->\r\nindex_field.\r\nindex_obj->\r\ncommon_field.node),\r\nacpi_ut_get_node_name(obj_desc->\r\nindex_field.\r\ndata_obj->\r\ncommon_field.\r\nnode));\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_ALIAS:\r\ncase ACPI_TYPE_LOCAL_METHOD_ALIAS:\r\nacpi_os_printf("Target %4.4s (%p)\n",\r\nacpi_ut_get_node_name(obj_desc),\r\nobj_desc);\r\nbreak;\r\ndefault:\r\nacpi_os_printf("Object %p\n", obj_desc);\r\nbreak;\r\n}\r\nswitch (type) {\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nacpi_os_printf(" Off %.3X Len %.2X Acc %.2hd\n",\r\n(obj_desc->common_field.\r\nbase_byte_offset * 8)\r\n+\r\nobj_desc->common_field.\r\nstart_field_bit_offset,\r\nobj_desc->common_field.bit_length,\r\nobj_desc->common_field.\r\naccess_byte_width);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_DISPLAY_OBJECTS:\r\nacpi_os_printf("O:%p", obj_desc);\r\nif (!obj_desc) {\r\nacpi_os_printf("\n");\r\nreturn (AE_OK);\r\n}\r\nacpi_os_printf("(R%u)", obj_desc->common.reference_count);\r\nswitch (type) {\r\ncase ACPI_TYPE_METHOD:\r\nacpi_os_printf(" M:%p-%X\n", obj_desc->method.aml_start,\r\nobj_desc->method.aml_length);\r\nbreak;\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf(" I:%8.8X8.8%X\n",\r\nACPI_FORMAT_UINT64(obj_desc->integer.\r\nvalue));\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf(" S:%p-%X\n", obj_desc->string.pointer,\r\nobj_desc->string.length);\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nacpi_os_printf(" B:%p-%X\n", obj_desc->buffer.pointer,\r\nobj_desc->buffer.length);\r\nbreak;\r\ndefault:\r\nacpi_os_printf("\n");\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nacpi_os_printf("\n");\r\nbreak;\r\n}\r\nif (!(acpi_dbg_level & ACPI_LV_VALUES)) {\r\nreturn (AE_OK);\r\n}\r\ndbg_level = acpi_dbg_level;\r\nacpi_dbg_level = 0;\r\nobj_desc = acpi_ns_get_attached_object(this_node);\r\nacpi_dbg_level = dbg_level;\r\nwhile (obj_desc) {\r\nobj_type = ACPI_TYPE_INVALID;\r\nacpi_os_printf("Attached Object %p: ", obj_desc);\r\nswitch (ACPI_GET_DESCRIPTOR_TYPE(obj_desc)) {\r\ncase ACPI_DESC_TYPE_NAMED:\r\nacpi_os_printf("(Ptr to Node)\n");\r\nbytes_to_dump = sizeof(struct acpi_namespace_node);\r\nACPI_DUMP_BUFFER(obj_desc, bytes_to_dump);\r\nbreak;\r\ncase ACPI_DESC_TYPE_OPERAND:\r\nobj_type = obj_desc->common.type;\r\nif (obj_type > ACPI_TYPE_LOCAL_MAX) {\r\nacpi_os_printf\r\n("(Pointer to ACPI Object type %.2X [UNKNOWN])\n",\r\nobj_type);\r\nbytes_to_dump = 32;\r\n} else {\r\nacpi_os_printf\r\n("(Pointer to ACPI Object type %.2X [%s])\n",\r\nobj_type, acpi_ut_get_type_name(obj_type));\r\nbytes_to_dump =\r\nsizeof(union acpi_operand_object);\r\n}\r\nACPI_DUMP_BUFFER(obj_desc, bytes_to_dump);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) !=\r\nACPI_DESC_TYPE_OPERAND) {\r\ngoto cleanup;\r\n}\r\nswitch (obj_type) {\r\ncase ACPI_TYPE_BUFFER:\r\ncase ACPI_TYPE_STRING:\r\nbytes_to_dump = obj_desc->string.length;\r\nobj_desc = (void *)obj_desc->string.pointer;\r\nacpi_os_printf("(Buffer/String pointer %p length %X)\n",\r\nobj_desc, bytes_to_dump);\r\nACPI_DUMP_BUFFER(obj_desc, bytes_to_dump);\r\ngoto cleanup;\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\nobj_desc =\r\n(union acpi_operand_object *)obj_desc->buffer_field.\r\nbuffer_obj;\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nobj_desc = (void *)obj_desc->package.elements;\r\nbreak;\r\ncase ACPI_TYPE_METHOD:\r\nobj_desc = (void *)obj_desc->method.aml_start;\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REGION_FIELD:\r\nobj_desc = (void *)obj_desc->field.region_obj;\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_BANK_FIELD:\r\nobj_desc = (void *)obj_desc->bank_field.region_obj;\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_INDEX_FIELD:\r\nobj_desc = (void *)obj_desc->index_field.index_obj;\r\nbreak;\r\ndefault:\r\ngoto cleanup;\r\n}\r\nobj_type = ACPI_TYPE_INVALID;\r\n}\r\ncleanup:\r\nacpi_os_printf("\n");\r\nreturn (AE_OK);\r\n}\r\nvoid\r\nacpi_ns_dump_objects(acpi_object_type type,\r\nu8 display_type,\r\nu32 max_depth,\r\nacpi_owner_id owner_id, acpi_handle start_handle)\r\n{\r\nstruct acpi_walk_info info;\r\nacpi_status status;\r\nACPI_FUNCTION_ENTRY();\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_os_printf("Could not acquire namespace mutex\n");\r\nreturn;\r\n}\r\ninfo.debug_level = ACPI_LV_TABLES;\r\ninfo.owner_id = owner_id;\r\ninfo.display_type = display_type;\r\n(void)acpi_ns_walk_namespace(type, start_handle, max_depth,\r\nACPI_NS_WALK_NO_UNLOCK |\r\nACPI_NS_WALK_TEMP_NODES,\r\nacpi_ns_dump_one_object, NULL,\r\n(void *)&info, NULL);\r\n(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\r\n}\r\nvoid acpi_ns_dump_entry(acpi_handle handle, u32 debug_level)\r\n{\r\nstruct acpi_walk_info info;\r\nACPI_FUNCTION_ENTRY();\r\ninfo.debug_level = debug_level;\r\ninfo.owner_id = ACPI_OWNER_ID_MAX;\r\ninfo.display_type = ACPI_DISPLAY_SUMMARY;\r\n(void)acpi_ns_dump_one_object(handle, 1, &info, NULL);\r\n}\r\nvoid acpi_ns_dump_tables(acpi_handle search_base, u32 max_depth)\r\n{\r\nacpi_handle search_handle = search_base;\r\nACPI_FUNCTION_TRACE(ns_dump_tables);\r\nif (!acpi_gbl_root_node) {\r\nACPI_DEBUG_PRINT((ACPI_DB_TABLES,\r\n"namespace not initialized!\n"));\r\nreturn_VOID;\r\n}\r\nif (ACPI_NS_ALL == search_base) {\r\nsearch_handle = acpi_gbl_root_node;\r\nACPI_DEBUG_PRINT((ACPI_DB_TABLES, "\\\n"));\r\n}\r\nacpi_ns_dump_objects(ACPI_TYPE_ANY, ACPI_DISPLAY_OBJECTS, max_depth,\r\nACPI_OWNER_ID_MAX, search_handle);\r\nreturn_VOID;\r\n}
