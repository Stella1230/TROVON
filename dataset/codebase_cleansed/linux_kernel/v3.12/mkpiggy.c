int main(int argc, char *argv[])\r\n{\r\nuint32_t olen;\r\nlong ilen;\r\nunsigned long offs;\r\nFILE *f;\r\nif (argc < 2) {\r\nfprintf(stderr, "Usage: %s compressed_file\n", argv[0]);\r\nreturn 1;\r\n}\r\nf = fopen(argv[1], "r");\r\nif (!f) {\r\nperror(argv[1]);\r\nreturn 1;\r\n}\r\nif (fseek(f, -4L, SEEK_END)) {\r\nperror(argv[1]);\r\n}\r\nif (fread(&olen, sizeof(olen), 1, f) != 1) {\r\nperror(argv[1]);\r\nreturn 1;\r\n}\r\nilen = ftell(f);\r\nolen = get_unaligned_le32(&olen);\r\nfclose(f);\r\noffs = (olen > ilen) ? olen - ilen : 0;\r\noffs += olen >> 12;\r\noffs += 64*1024 + 128;\r\noffs = (offs+4095) & ~4095;\r\nprintf(".section \".rodata..compressed\",\"a\",@progbits\n");\r\nprintf(".globl z_input_len\n");\r\nprintf("z_input_len = %lu\n", ilen);\r\nprintf(".globl z_output_len\n");\r\nprintf("z_output_len = %lu\n", (unsigned long)olen);\r\nprintf(".globl z_extract_offset\n");\r\nprintf("z_extract_offset = 0x%lx\n", offs);\r\nprintf(".globl z_extract_offset_negative\n");\r\nprintf("z_extract_offset_negative = -0x%lx\n", offs);\r\nprintf(".globl input_data, input_data_end\n");\r\nprintf("input_data:\n");\r\nprintf(".incbin \"%s\"\n", argv[1]);\r\nprintf("input_data_end:\n");\r\nreturn 0;\r\n}
