static void i2c_av_write(struct i2c_adapter *i2c, u16 reg, u8 val)\r\n{\r\nint ret;\r\nu8 buf[3];\r\nstruct i2c_msg msg = {\r\n.addr = 0x88 >> 1,\r\n.flags = 0,\r\n.buf = buf,\r\n.len = 3\r\n};\r\nbuf[0] = reg >> 8;\r\nbuf[1] = reg & 0xff;\r\nbuf[2] = val;\r\nret = i2c_transfer(i2c, &msg, 1);\r\nif (ret != 1)\r\nprintk(KERN_ERR "%s: i2c write error!\n", __func__);\r\n}\r\nstatic void i2c_av_write4(struct i2c_adapter *i2c, u16 reg, u32 val)\r\n{\r\nint ret;\r\nu8 buf[6];\r\nstruct i2c_msg msg = {\r\n.addr = 0x88 >> 1,\r\n.flags = 0,\r\n.buf = buf,\r\n.len = 6\r\n};\r\nbuf[0] = reg >> 8;\r\nbuf[1] = reg & 0xff;\r\nbuf[2] = val & 0xff;\r\nbuf[3] = (val >> 8) & 0xff;\r\nbuf[4] = (val >> 16) & 0xff;\r\nbuf[5] = val >> 24;\r\nret = i2c_transfer(i2c, &msg, 1);\r\nif (ret != 1)\r\nprintk(KERN_ERR "%s: i2c write error!\n", __func__);\r\n}\r\nstatic u8 i2c_av_read(struct i2c_adapter *i2c, u16 reg)\r\n{\r\nint ret;\r\nu8 buf[2];\r\nstruct i2c_msg msg = {\r\n.addr = 0x88 >> 1,\r\n.flags = 0,\r\n.buf = buf,\r\n.len = 2\r\n};\r\nbuf[0] = reg >> 8;\r\nbuf[1] = reg & 0xff;\r\nret = i2c_transfer(i2c, &msg, 1);\r\nif (ret != 1)\r\nprintk(KERN_ERR "%s: i2c write error!\n", __func__);\r\nmsg.flags = I2C_M_RD;\r\nmsg.len = 1;\r\nret = i2c_transfer(i2c, &msg, 1);\r\nif (ret != 1)\r\nprintk(KERN_ERR "%s: i2c read error!\n", __func__);\r\nreturn buf[0];\r\n}\r\nstatic void i2c_av_and_or(struct i2c_adapter *i2c, u16 reg, unsigned and_mask,\r\nu8 or_value)\r\n{\r\ni2c_av_write(i2c, reg, (i2c_av_read(i2c, reg) & and_mask) | or_value);\r\n}\r\nvoid netup_initialize(struct cx23885_dev *dev)\r\n{\r\nstruct cx23885_i2c *i2c_bus = &dev->i2c_bus[2];\r\nstruct i2c_adapter *i2c = &i2c_bus->i2c_adap;\r\ni2c_av_and_or(i2c, 0x803, ~0x10, 0x00);\r\ni2c_av_write4(i2c, 0x114, 0xea0eb3);\r\ni2c_av_write4(i2c, 0x110, 0x090319);\r\ni2c_av_and_or(i2c, 0x803, ~0x10, 0x10);\r\n}
