static void udbg_putc_beat(char c)\r\n{\r\nunsigned long rc;\r\nif (c == '\n')\r\nudbg_putc_beat('\r');\r\nrc = beat_put_term_char(celleb_vtermno, 1, (uint64_t)c << 56, 0);\r\n}\r\nstatic int udbg_getc_poll_beat(void)\r\n{\r\nchar ch, *buf = (char *)inbuf;\r\nint i;\r\nlong rc;\r\nif (inbuflen == 0) {\r\ninbuflen = 0;\r\nrc = beat_get_term_char(celleb_vtermno, &inbuflen,\r\ninbuf+0, inbuf+1);\r\nif (rc != 0)\r\ninbuflen = 0;\r\n}\r\nif (inbuflen <= 0 || inbuflen > 16) {\r\ninbuflen = 0;\r\nreturn -1;\r\n}\r\nch = buf[0];\r\nfor (i = 1; i < inbuflen; i++)\r\nbuf[i-1] = buf[i];\r\ninbuflen--;\r\nreturn ch;\r\n}\r\nstatic int udbg_getc_beat(void)\r\n{\r\nint ch;\r\nfor (;;) {\r\nch = udbg_getc_poll_beat();\r\nif (ch == -1) {\r\nvolatile unsigned long delay;\r\nfor (delay = 0; delay < 2000000; delay++)\r\n;\r\n} else {\r\nreturn ch;\r\n}\r\n}\r\n}\r\nvoid __init udbg_init_debug_beat(void)\r\n{\r\nudbg_putc = udbg_putc_beat;\r\nudbg_getc = udbg_getc_beat;\r\nudbg_getc_poll = udbg_getc_poll_beat;\r\n}
