void show_mem(unsigned int filter)\r\n{\r\npg_data_t *pgdat;\r\nunsigned long total = 0, reserved = 0, shared = 0,\r\nnonshared = 0, highmem = 0;\r\nprintk("Mem-Info:\n");\r\nshow_free_areas(filter);\r\nif (filter & SHOW_MEM_FILTER_PAGE_COUNT)\r\nreturn;\r\nfor_each_online_pgdat(pgdat) {\r\nunsigned long i, flags;\r\npgdat_resize_lock(pgdat, &flags);\r\nfor (i = 0; i < pgdat->node_spanned_pages; i++) {\r\nstruct page *page;\r\nunsigned long pfn = pgdat->node_start_pfn + i;\r\nif (unlikely(!(i % MAX_ORDER_NR_PAGES)))\r\ntouch_nmi_watchdog();\r\nif (!pfn_valid(pfn))\r\ncontinue;\r\npage = pfn_to_page(pfn);\r\nif (PageHighMem(page))\r\nhighmem++;\r\nif (PageReserved(page))\r\nreserved++;\r\nelse if (page_count(page) == 1)\r\nnonshared++;\r\nelse if (page_count(page) > 1)\r\nshared += page_count(page) - 1;\r\ntotal++;\r\n}\r\npgdat_resize_unlock(pgdat, &flags);\r\n}\r\nprintk("%lu pages RAM\n", total);\r\n#ifdef CONFIG_HIGHMEM\r\nprintk("%lu pages HighMem\n", highmem);\r\n#endif\r\nprintk("%lu pages reserved\n", reserved);\r\nprintk("%lu pages shared\n", shared);\r\nprintk("%lu pages non-shared\n", nonshared);\r\n#ifdef CONFIG_QUICKLIST\r\nprintk("%lu pages in pagetable cache\n",\r\nquicklist_total_size());\r\n#endif\r\n}
