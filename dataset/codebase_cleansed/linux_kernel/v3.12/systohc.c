int rtc_set_ntp_time(struct timespec now)\r\n{\r\nstruct rtc_device *rtc;\r\nstruct rtc_time tm;\r\nint err = -ENODEV;\r\nif (now.tv_nsec < (NSEC_PER_SEC >> 1))\r\nrtc_time_to_tm(now.tv_sec, &tm);\r\nelse\r\nrtc_time_to_tm(now.tv_sec + 1, &tm);\r\nrtc = rtc_class_open(CONFIG_RTC_HCTOSYS_DEVICE);\r\nif (rtc) {\r\nif (rtc->ops && (rtc->ops->set_time || rtc->ops->set_mmss))\r\nerr = rtc_set_time(rtc, &tm);\r\nrtc_class_close(rtc);\r\n}\r\nreturn err;\r\n}
