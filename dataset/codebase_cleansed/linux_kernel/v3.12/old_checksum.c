__wsum csum_partial(const void *p, int len, __wsum __sum)\r\n{\r\nu32 sum = (__force u32)__sum;\r\nconst u16 *buff = p;\r\nconst void *endMarker = p + len;\r\nconst void *marker = endMarker - (len % 16);\r\n#if 0\r\nif((int)buff & 0x3)\r\nprintk("unaligned buff %p\n", buff);\r\n__delay(900);\r\n#endif\r\nBITON;\r\nwhile (buff < marker) {\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\nsum += *buff++;\r\n}\r\nmarker = endMarker - (len % 2);\r\nwhile (buff < marker)\r\nsum += *buff++;\r\nif (endMarker > buff)\r\nsum += *(const u8 *)buff;\r\nBITOFF;\r\nreturn (__force __wsum)sum;\r\n}
