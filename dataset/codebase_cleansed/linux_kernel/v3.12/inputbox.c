static void print_buttons(WINDOW * dialog, int height, int width, int selected)\r\n{\r\nint x = width / 2 - 11;\r\nint y = height - 2;\r\nprint_button(dialog, gettext(" Ok "), y, x, selected == 0);\r\nprint_button(dialog, gettext(" Help "), y, x + 14, selected == 1);\r\nwmove(dialog, y, x + 1 + 14 * selected);\r\nwrefresh(dialog);\r\n}\r\nint dialog_inputbox(const char *title, const char *prompt, int height, int width,\r\nconst char *init)\r\n{\r\nint i, x, y, box_y, box_x, box_width;\r\nint input_x = 0, key = 0, button = -1;\r\nint show_x, len, pos;\r\nchar *instr = dialog_input_result;\r\nWINDOW *dialog;\r\nif (!init)\r\ninstr[0] = '\0';\r\nelse\r\nstrcpy(instr, init);\r\ndo_resize:\r\nif (getmaxy(stdscr) <= (height - INPUTBOX_HEIGTH_MIN))\r\nreturn -ERRDISPLAYTOOSMALL;\r\nif (getmaxx(stdscr) <= (width - INPUTBOX_WIDTH_MIN))\r\nreturn -ERRDISPLAYTOOSMALL;\r\nx = (getmaxx(stdscr) - width) / 2;\r\ny = (getmaxy(stdscr) - height) / 2;\r\ndraw_shadow(stdscr, y, x, height, width);\r\ndialog = newwin(height, width, y, x);\r\nkeypad(dialog, TRUE);\r\ndraw_box(dialog, 0, 0, height, width,\r\ndlg.dialog.atr, dlg.border.atr);\r\nwattrset(dialog, dlg.border.atr);\r\nmvwaddch(dialog, height - 3, 0, ACS_LTEE);\r\nfor (i = 0; i < width - 2; i++)\r\nwaddch(dialog, ACS_HLINE);\r\nwattrset(dialog, dlg.dialog.atr);\r\nwaddch(dialog, ACS_RTEE);\r\nprint_title(dialog, title, width);\r\nwattrset(dialog, dlg.dialog.atr);\r\nprint_autowrap(dialog, prompt, width - 2, 1, 3);\r\nbox_width = width - 6;\r\ngetyx(dialog, y, x);\r\nbox_y = y + 2;\r\nbox_x = (width - box_width) / 2;\r\ndraw_box(dialog, y + 1, box_x - 1, 3, box_width + 2,\r\ndlg.dialog.atr, dlg.border.atr);\r\nprint_buttons(dialog, height, width, 0);\r\nwmove(dialog, box_y, box_x);\r\nwattrset(dialog, dlg.inputbox.atr);\r\nlen = strlen(instr);\r\npos = len;\r\nif (len >= box_width) {\r\nshow_x = len - box_width + 1;\r\ninput_x = box_width - 1;\r\nfor (i = 0; i < box_width - 1; i++)\r\nwaddch(dialog, instr[show_x + i]);\r\n} else {\r\nshow_x = 0;\r\ninput_x = len;\r\nwaddstr(dialog, instr);\r\n}\r\nwmove(dialog, box_y, box_x + input_x);\r\nwrefresh(dialog);\r\nwhile (key != KEY_ESC) {\r\nkey = wgetch(dialog);\r\nif (button == -1) {\r\nswitch (key) {\r\ncase TAB:\r\ncase KEY_UP:\r\ncase KEY_DOWN:\r\nbreak;\r\ncase KEY_BACKSPACE:\r\ncase 127:\r\nif (pos) {\r\nwattrset(dialog, dlg.inputbox.atr);\r\nif (input_x == 0) {\r\nshow_x--;\r\n} else\r\ninput_x--;\r\nif (pos < len) {\r\nfor (i = pos - 1; i < len; i++) {\r\ninstr[i] = instr[i+1];\r\n}\r\n}\r\npos--;\r\nlen--;\r\ninstr[len] = '\0';\r\nwmove(dialog, box_y, box_x);\r\nfor (i = 0; i < box_width; i++) {\r\nif (!instr[show_x + i]) {\r\nwaddch(dialog, ' ');\r\nbreak;\r\n}\r\nwaddch(dialog, instr[show_x + i]);\r\n}\r\nwmove(dialog, box_y, input_x + box_x);\r\nwrefresh(dialog);\r\n}\r\ncontinue;\r\ncase KEY_LEFT:\r\nif (pos > 0) {\r\nif (input_x > 0) {\r\nwmove(dialog, box_y, --input_x + box_x);\r\n} else if (input_x == 0) {\r\nshow_x--;\r\nwmove(dialog, box_y, box_x);\r\nfor (i = 0; i < box_width; i++) {\r\nif (!instr[show_x + i]) {\r\nwaddch(dialog, ' ');\r\nbreak;\r\n}\r\nwaddch(dialog, instr[show_x + i]);\r\n}\r\nwmove(dialog, box_y, box_x);\r\n}\r\npos--;\r\n}\r\ncontinue;\r\ncase KEY_RIGHT:\r\nif (pos < len) {\r\nif (input_x < box_width - 1) {\r\nwmove(dialog, box_y, ++input_x + box_x);\r\n} else if (input_x == box_width - 1) {\r\nshow_x++;\r\nwmove(dialog, box_y, box_x);\r\nfor (i = 0; i < box_width; i++) {\r\nif (!instr[show_x + i]) {\r\nwaddch(dialog, ' ');\r\nbreak;\r\n}\r\nwaddch(dialog, instr[show_x + i]);\r\n}\r\nwmove(dialog, box_y, input_x + box_x);\r\n}\r\npos++;\r\n}\r\ncontinue;\r\ndefault:\r\nif (key < 0x100 && isprint(key)) {\r\nif (len < MAX_LEN) {\r\nwattrset(dialog, dlg.inputbox.atr);\r\nif (pos < len) {\r\nfor (i = len; i > pos; i--)\r\ninstr[i] = instr[i-1];\r\ninstr[pos] = key;\r\n} else {\r\ninstr[len] = key;\r\n}\r\npos++;\r\nlen++;\r\ninstr[len] = '\0';\r\nif (input_x == box_width - 1) {\r\nshow_x++;\r\n} else {\r\ninput_x++;\r\n}\r\nwmove(dialog, box_y, box_x);\r\nfor (i = 0; i < box_width; i++) {\r\nif (!instr[show_x + i]) {\r\nwaddch(dialog, ' ');\r\nbreak;\r\n}\r\nwaddch(dialog, instr[show_x + i]);\r\n}\r\nwmove(dialog, box_y, input_x + box_x);\r\nwrefresh(dialog);\r\n} else\r\nflash();\r\ncontinue;\r\n}\r\n}\r\n}\r\nswitch (key) {\r\ncase 'O':\r\ncase 'o':\r\ndelwin(dialog);\r\nreturn 0;\r\ncase 'H':\r\ncase 'h':\r\ndelwin(dialog);\r\nreturn 1;\r\ncase KEY_UP:\r\ncase KEY_LEFT:\r\nswitch (button) {\r\ncase -1:\r\nbutton = 1;\r\nprint_buttons(dialog, height, width, 1);\r\nbreak;\r\ncase 0:\r\nbutton = -1;\r\nprint_buttons(dialog, height, width, 0);\r\nwmove(dialog, box_y, box_x + input_x);\r\nwrefresh(dialog);\r\nbreak;\r\ncase 1:\r\nbutton = 0;\r\nprint_buttons(dialog, height, width, 0);\r\nbreak;\r\n}\r\nbreak;\r\ncase TAB:\r\ncase KEY_DOWN:\r\ncase KEY_RIGHT:\r\nswitch (button) {\r\ncase -1:\r\nbutton = 0;\r\nprint_buttons(dialog, height, width, 0);\r\nbreak;\r\ncase 0:\r\nbutton = 1;\r\nprint_buttons(dialog, height, width, 1);\r\nbreak;\r\ncase 1:\r\nbutton = -1;\r\nprint_buttons(dialog, height, width, 0);\r\nwmove(dialog, box_y, box_x + input_x);\r\nwrefresh(dialog);\r\nbreak;\r\n}\r\nbreak;\r\ncase ' ':\r\ncase '\n':\r\ndelwin(dialog);\r\nreturn (button == -1 ? 0 : button);\r\ncase 'X':\r\ncase 'x':\r\nkey = KEY_ESC;\r\nbreak;\r\ncase KEY_ESC:\r\nkey = on_key_esc(dialog);\r\nbreak;\r\ncase KEY_RESIZE:\r\ndelwin(dialog);\r\non_key_resize();\r\ngoto do_resize;\r\n}\r\n}\r\ndelwin(dialog);\r\nreturn KEY_ESC;\r\n}
