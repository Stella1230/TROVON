static int sata_miphy_init(struct device *dev, void __iomem *addr)\r\n{\r\nwritel(SPEAR1340_SATA_CFG_VAL, SPEAR1340_PCIE_SATA_CFG);\r\nwritel(SPEAR1340_PCIE_SATA_MIPHY_CFG_SATA_25M_CRYSTAL_CLK,\r\nSPEAR1340_PCIE_MIPHY_CFG);\r\nwritel((readl(SPEAR1340_PCM_CFG) | (0x800)), SPEAR1340_PCM_CFG);\r\nmsleep(20);\r\nwritel((readl(SPEAR1340_PERIP1_SW_RST) & (~0x1000)),\r\nSPEAR1340_PERIP1_SW_RST);\r\nmsleep(20);\r\nreturn 0;\r\n}\r\nvoid sata_miphy_exit(struct device *dev)\r\n{\r\nwritel(0, SPEAR1340_PCIE_SATA_CFG);\r\nwritel(0, SPEAR1340_PCIE_MIPHY_CFG);\r\nwritel((readl(SPEAR1340_PERIP1_SW_RST) | (0x1000)),\r\nSPEAR1340_PERIP1_SW_RST);\r\nmsleep(20);\r\nwritel((readl(SPEAR1340_PCM_CFG) & (~0x800)), SPEAR1340_PCM_CFG);\r\nmsleep(20);\r\n}\r\nint sata_suspend(struct device *dev)\r\n{\r\nif (dev->power.power_state.event == PM_EVENT_FREEZE)\r\nreturn 0;\r\nsata_miphy_exit(dev);\r\nreturn 0;\r\n}\r\nint sata_resume(struct device *dev)\r\n{\r\nif (dev->power.power_state.event == PM_EVENT_THAW)\r\nreturn 0;\r\nreturn sata_miphy_init(dev, NULL);\r\n}\r\nstatic void __init spear1340_dt_init(void)\r\n{\r\nof_platform_populate(NULL, of_default_bus_match_table,\r\nspear1340_auxdata_lookup, NULL);\r\n}
