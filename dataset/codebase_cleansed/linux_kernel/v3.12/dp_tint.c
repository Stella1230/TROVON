int ieee754dp_tint(ieee754dp x)\r\n{\r\nCOMPXDP;\r\nCLEARCX;\r\nEXPLODEXDP;\r\nFLUSHXDP;\r\nswitch (xc) {\r\ncase IEEE754_CLASS_SNAN:\r\ncase IEEE754_CLASS_QNAN:\r\ncase IEEE754_CLASS_INF:\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_xcpt(ieee754si_indef(), "dp_tint", x);\r\ncase IEEE754_CLASS_ZERO:\r\nreturn 0;\r\ncase IEEE754_CLASS_DNORM:\r\ncase IEEE754_CLASS_NORM:\r\nbreak;\r\n}\r\nif (xe > 31) {\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_xcpt(ieee754si_indef(), "dp_tint", x);\r\n}\r\nif (xe > DP_MBITS) {\r\nxm <<= xe - DP_MBITS;\r\n} else if (xe < DP_MBITS) {\r\nu64 residue;\r\nint round;\r\nint sticky;\r\nint odd;\r\nif (xe < -1) {\r\nresidue = xm;\r\nround = 0;\r\nsticky = residue != 0;\r\nxm = 0;\r\n} else {\r\nresidue = xm << (64 - DP_MBITS + xe);\r\nround = (residue >> 63) != 0;\r\nsticky = (residue << 1) != 0;\r\nxm >>= DP_MBITS - xe;\r\n}\r\nodd = (xm & 0x1) != 0x0;\r\nswitch (ieee754_csr.rm) {\r\ncase IEEE754_RN:\r\nif (round && (sticky || odd))\r\nxm++;\r\nbreak;\r\ncase IEEE754_RZ:\r\nbreak;\r\ncase IEEE754_RU:\r\nif ((round || sticky) && !xs)\r\nxm++;\r\nbreak;\r\ncase IEEE754_RD:\r\nif ((round || sticky) && xs)\r\nxm++;\r\nbreak;\r\n}\r\nif ((xm >> 31) != 0 && (xs == 0 || xm != 0x80000000)) {\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754si_xcpt(ieee754si_indef(), "dp_tint", x);\r\n}\r\nif (round || sticky)\r\nSETCX(IEEE754_INEXACT);\r\n}\r\nif (xs)\r\nreturn -xm;\r\nelse\r\nreturn xm;\r\n}\r\nunsigned int ieee754dp_tuns(ieee754dp x)\r\n{\r\nieee754dp hb = ieee754dp_1e31();\r\nif (ieee754dp_lt(x, hb))\r\nreturn (unsigned) ieee754dp_tint(x);\r\nreturn (unsigned) ieee754dp_tint(ieee754dp_sub(x, hb)) |\r\n((unsigned) 1 << 31);\r\n}
