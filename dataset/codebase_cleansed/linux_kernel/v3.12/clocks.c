void set_au1x00_speed(unsigned int new_freq)\r\n{\r\nau1x00_clock = new_freq;\r\n}\r\nunsigned int get_au1x00_speed(void)\r\n{\r\nreturn au1x00_clock;\r\n}\r\nunsigned long get_au1x00_uart_baud_base(void)\r\n{\r\nreturn uart_baud_base;\r\n}\r\nvoid set_au1x00_uart_baud_base(unsigned long new_baud_base)\r\n{\r\nuart_baud_base = new_baud_base;\r\n}\r\nunsigned long au1xxx_calc_clock(void)\r\n{\r\nunsigned long cpu_speed;\r\nif (au1xxx_cpu_has_pll_wo())\r\ncpu_speed = 396000000;\r\nelse\r\ncpu_speed = (au_readl(SYS_CPUPLL) & 0x0000003f) * AU1000_SRC_CLK;\r\nmips_hpt_frequency = cpu_speed;\r\nset_au1x00_uart_baud_base(cpu_speed / (2 * ((int)(au_readl(SYS_POWERCTRL)\r\n& 0x03) + 2) * 16));\r\nset_au1x00_speed(cpu_speed);\r\nreturn cpu_speed;\r\n}
