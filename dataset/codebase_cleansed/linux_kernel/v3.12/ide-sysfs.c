char *ide_media_string(ide_drive_t *drive)\r\n{\r\nswitch (drive->media) {\r\ncase ide_disk:\r\nreturn "disk";\r\ncase ide_cdrom:\r\nreturn "cdrom";\r\ncase ide_tape:\r\nreturn "tape";\r\ncase ide_floppy:\r\nreturn "floppy";\r\ncase ide_optical:\r\nreturn "optical";\r\ndefault:\r\nreturn "UNKNOWN";\r\n}\r\n}\r\nstatic ssize_t media_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "%s\n", ide_media_string(drive));\r\n}\r\nstatic ssize_t drivename_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "%s\n", drive->name);\r\n}\r\nstatic ssize_t modalias_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "ide:m-%s\n", ide_media_string(drive));\r\n}\r\nstatic ssize_t model_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "%s\n", (char *)&drive->id[ATA_ID_PROD]);\r\n}\r\nstatic ssize_t firmware_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "%s\n", (char *)&drive->id[ATA_ID_FW_REV]);\r\n}\r\nstatic ssize_t serial_show(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nide_drive_t *drive = to_ide_device(dev);\r\nreturn sprintf(buf, "%s\n", (char *)&drive->id[ATA_ID_SERNO]);\r\n}\r\nstatic ssize_t store_delete_devices(struct device *portdev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t n)\r\n{\r\nide_hwif_t *hwif = dev_get_drvdata(portdev);\r\nif (strncmp(buf, "1", n))\r\nreturn -EINVAL;\r\nide_port_unregister_devices(hwif);\r\nreturn n;\r\n}\r\nstatic ssize_t store_scan(struct device *portdev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t n)\r\n{\r\nide_hwif_t *hwif = dev_get_drvdata(portdev);\r\nif (strncmp(buf, "1", n))\r\nreturn -EINVAL;\r\nide_port_unregister_devices(hwif);\r\nide_port_scan(hwif);\r\nreturn n;\r\n}\r\nint ide_sysfs_register_port(ide_hwif_t *hwif)\r\n{\r\nint i, uninitialized_var(rc);\r\nfor (i = 0; ide_port_attrs[i]; i++) {\r\nrc = device_create_file(hwif->portdev, ide_port_attrs[i]);\r\nif (rc)\r\nbreak;\r\n}\r\nreturn rc;\r\n}
