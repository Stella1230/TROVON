static void *dgrp_ports_seq_start(struct seq_file *seq, loff_t *pos)\r\n{\r\nif (*pos == 0)\r\nseq_puts(seq, "#num tty_open pr_open tot_wait MSTAT IFLAG OFLAG CFLAG BPS DIGIFLAGS\n");\r\nreturn pos;\r\n}\r\nstatic void *dgrp_ports_seq_next(struct seq_file *seq, void *v, loff_t *pos)\r\n{\r\nstruct nd_struct *nd = seq->private;\r\nif (*pos >= nd->nd_chan_count)\r\nreturn NULL;\r\n*pos += 1;\r\nreturn pos;\r\n}\r\nstatic void dgrp_ports_seq_stop(struct seq_file *seq, void *v)\r\n{\r\n}\r\nstatic int dgrp_ports_seq_show(struct seq_file *seq, void *v)\r\n{\r\nloff_t *pos = v;\r\nstruct nd_struct *nd;\r\nstruct ch_struct *ch;\r\nstruct un_struct *tun, *pun;\r\nunsigned int totcnt;\r\nnd = seq->private;\r\nif (!nd)\r\nreturn 0;\r\nif (*pos >= nd->nd_chan_count)\r\nreturn 0;\r\nch = &nd->nd_chan[*pos];\r\ntun = &ch->ch_tun;\r\npun = &ch->ch_pun;\r\ntotcnt = tun->un_open_count +\r\npun->un_open_count +\r\nch->ch_wait_count[0] +\r\nch->ch_wait_count[1] +\r\nch->ch_wait_count[2];\r\nseq_printf(seq, "%02d %02d %02d %02d 0x%04X 0x%04X 0x%04X 0x%04X %-6d 0x%04X\n",\r\n(int) *pos,\r\ntun->un_open_count,\r\npun->un_open_count,\r\nch->ch_wait_count[0] +\r\nch->ch_wait_count[1] +\r\nch->ch_wait_count[2],\r\n(totcnt ? ch->ch_s_mlast : 0),\r\nch->ch_s_iflag,\r\nch->ch_s_oflag,\r\nch->ch_s_cflag,\r\n(ch->ch_s_brate ? (1843200 / ch->ch_s_brate) : 0),\r\nch->ch_digi.digi_flags);\r\nreturn 0;\r\n}\r\nstatic int dgrp_ports_open(struct inode *inode, struct file *file)\r\n{\r\nstruct seq_file *seq;\r\nint rtn;\r\nrtn = seq_open(file, &ports_seq_ops);\r\nif (!rtn) {\r\nseq = file->private_data;\r\nseq->private = PDE_DATA(inode);\r\n}\r\nreturn rtn;\r\n}
