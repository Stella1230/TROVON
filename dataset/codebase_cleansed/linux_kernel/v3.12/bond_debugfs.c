static int bond_debug_rlb_hash_show(struct seq_file *m, void *v)\r\n{\r\nstruct bonding *bond = m->private;\r\nstruct alb_bond_info *bond_info = &(BOND_ALB_INFO(bond));\r\nstruct rlb_client_info *client_info;\r\nu32 hash_index;\r\nif (bond->params.mode != BOND_MODE_ALB)\r\nreturn 0;\r\nseq_printf(m, "SourceIP DestinationIP "\r\n"Destination MAC DEV\n");\r\nspin_lock_bh(&(BOND_ALB_INFO(bond).rx_hashtbl_lock));\r\nhash_index = bond_info->rx_hashtbl_used_head;\r\nfor (; hash_index != RLB_NULL_INDEX;\r\nhash_index = client_info->used_next) {\r\nclient_info = &(bond_info->rx_hashtbl[hash_index]);\r\nseq_printf(m, "%-15pI4 %-15pI4 %-17pM %s\n",\r\n&client_info->ip_src,\r\n&client_info->ip_dst,\r\n&client_info->mac_dst,\r\nclient_info->slave->dev->name);\r\n}\r\nspin_unlock_bh(&(BOND_ALB_INFO(bond).rx_hashtbl_lock));\r\nreturn 0;\r\n}\r\nstatic int bond_debug_rlb_hash_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, bond_debug_rlb_hash_show, inode->i_private);\r\n}\r\nvoid bond_debug_register(struct bonding *bond)\r\n{\r\nif (!bonding_debug_root)\r\nreturn;\r\nbond->debug_dir =\r\ndebugfs_create_dir(bond->dev->name, bonding_debug_root);\r\nif (!bond->debug_dir) {\r\npr_warning("%s: Warning: failed to register to debugfs\n",\r\nbond->dev->name);\r\nreturn;\r\n}\r\ndebugfs_create_file("rlb_hash_table", 0400, bond->debug_dir,\r\nbond, &bond_debug_rlb_hash_fops);\r\n}\r\nvoid bond_debug_unregister(struct bonding *bond)\r\n{\r\nif (!bonding_debug_root)\r\nreturn;\r\ndebugfs_remove_recursive(bond->debug_dir);\r\n}\r\nvoid bond_debug_reregister(struct bonding *bond)\r\n{\r\nstruct dentry *d;\r\nif (!bonding_debug_root)\r\nreturn;\r\nd = debugfs_rename(bonding_debug_root, bond->debug_dir,\r\nbonding_debug_root, bond->dev->name);\r\nif (d) {\r\nbond->debug_dir = d;\r\n} else {\r\npr_warning("%s: Warning: failed to reregister, "\r\n"so just unregister old one\n",\r\nbond->dev->name);\r\nbond_debug_unregister(bond);\r\n}\r\n}\r\nvoid bond_create_debugfs(void)\r\n{\r\nbonding_debug_root = debugfs_create_dir("bonding", NULL);\r\nif (!bonding_debug_root) {\r\npr_warning("Warning: Cannot create bonding directory"\r\n" in debugfs\n");\r\n}\r\n}\r\nvoid bond_destroy_debugfs(void)\r\n{\r\ndebugfs_remove_recursive(bonding_debug_root);\r\nbonding_debug_root = NULL;\r\n}\r\nvoid bond_debug_register(struct bonding *bond)\r\n{\r\n}\r\nvoid bond_debug_unregister(struct bonding *bond)\r\n{\r\n}\r\nvoid bond_debug_reregister(struct bonding *bond)\r\n{\r\n}\r\nvoid bond_create_debugfs(void)\r\n{\r\n}\r\nvoid bond_destroy_debugfs(void)\r\n{\r\n}
