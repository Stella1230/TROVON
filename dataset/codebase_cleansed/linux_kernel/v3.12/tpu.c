static irqreturn_t timer_interrupt(int irq, void *dev_id)\r\n{\r\nh8300_timer_tick();\r\nctrl_bclr(0, TPUBASE + _TSR);\r\nreturn IRQ_HANDLED;\r\n}\r\nvoid __init h8300_timer_setup(void)\r\n{\r\nunsigned int cnt;\r\nunsigned int div;\r\ncalc_param(cnt, div, divide_rate, 0x10000);\r\nsetup_irq(TPUIRQ, &tpu_irq);\r\nctrl_bclr(3, MSTPCRH);\r\nctrl_outb(0, TSTR);\r\nctrl_outb(CCLR0 | div, TPUBASE + _TCR);\r\nctrl_outb(0, TPUBASE + _TMDR);\r\nctrl_outw(0, TPUBASE + _TIOR);\r\nctrl_outb(0x01, TPUBASE + _TIER);\r\nctrl_outw(cnt, TPUBASE + _GRA);\r\nctrl_bset(CONFIG_H8300_TPU_CH, TSTR);\r\n}
