static int __init kvm_vmm_init(void)\r\n{\r\nvmm_fpswa_interface = fpswa_interface;\r\nreturn kvm_init(&vmm_info, 1024, 0, THIS_MODULE);\r\n}\r\nstatic void __exit kvm_vmm_exit(void)\r\n{\r\nkvm_exit();\r\nreturn ;\r\n}\r\nvoid vmm_spin_lock(vmm_spinlock_t *lock)\r\n{\r\n_vmm_raw_spin_lock(lock);\r\n}\r\nvoid vmm_spin_unlock(vmm_spinlock_t *lock)\r\n{\r\n_vmm_raw_spin_unlock(lock);\r\n}\r\nstatic void vcpu_debug_exit(struct kvm_vcpu *vcpu)\r\n{\r\nstruct exit_ctl_data *p = &vcpu->arch.exit_data;\r\nlong psr;\r\nlocal_irq_save(psr);\r\np->exit_reason = EXIT_REASON_DEBUG;\r\nvmm_transition(vcpu);\r\nlocal_irq_restore(psr);\r\n}\r\nasmlinkage int printk(const char *fmt, ...)\r\n{\r\nstruct kvm_vcpu *vcpu = current_vcpu;\r\nva_list args;\r\nint r;\r\nmemset(vcpu->arch.log_buf, 0, VMM_LOG_LEN);\r\nva_start(args, fmt);\r\nr = vsnprintf(vcpu->arch.log_buf, VMM_LOG_LEN, fmt, args);\r\nva_end(args);\r\nvcpu_debug_exit(vcpu);\r\nreturn r;\r\n}
