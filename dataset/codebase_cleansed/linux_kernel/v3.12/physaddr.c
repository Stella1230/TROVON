unsigned long __phys_addr(unsigned long x)\r\n{\r\nunsigned long y = x - __START_KERNEL_map;\r\nif (unlikely(x > y)) {\r\nx = y + phys_base;\r\nVIRTUAL_BUG_ON(y >= KERNEL_IMAGE_SIZE);\r\n} else {\r\nx = y + (__START_KERNEL_map - PAGE_OFFSET);\r\nVIRTUAL_BUG_ON((x > y) || !phys_addr_valid(x));\r\n}\r\nreturn x;\r\n}\r\nunsigned long __phys_addr_symbol(unsigned long x)\r\n{\r\nunsigned long y = x - __START_KERNEL_map;\r\nVIRTUAL_BUG_ON(y >= KERNEL_IMAGE_SIZE);\r\nreturn y + phys_base;\r\n}\r\nbool __virt_addr_valid(unsigned long x)\r\n{\r\nunsigned long y = x - __START_KERNEL_map;\r\nif (unlikely(x > y)) {\r\nx = y + phys_base;\r\nif (y >= KERNEL_IMAGE_SIZE)\r\nreturn false;\r\n} else {\r\nx = y + (__START_KERNEL_map - PAGE_OFFSET);\r\nif ((x > y) || !phys_addr_valid(x))\r\nreturn false;\r\n}\r\nreturn pfn_valid(x >> PAGE_SHIFT);\r\n}\r\nunsigned long __phys_addr(unsigned long x)\r\n{\r\nunsigned long phys_addr = x - PAGE_OFFSET;\r\nVIRTUAL_BUG_ON(x < PAGE_OFFSET);\r\nVIRTUAL_BUG_ON(__vmalloc_start_set && is_vmalloc_addr((void *) x));\r\nif (max_low_pfn) {\r\nVIRTUAL_BUG_ON((phys_addr >> PAGE_SHIFT) > max_low_pfn);\r\nBUG_ON(slow_virt_to_phys((void *)x) != phys_addr);\r\n}\r\nreturn phys_addr;\r\n}\r\nbool __virt_addr_valid(unsigned long x)\r\n{\r\nif (x < PAGE_OFFSET)\r\nreturn false;\r\nif (__vmalloc_start_set && is_vmalloc_addr((void *) x))\r\nreturn false;\r\nif (x >= FIXADDR_START)\r\nreturn false;\r\nreturn pfn_valid((x - PAGE_OFFSET) >> PAGE_SHIFT);\r\n}
