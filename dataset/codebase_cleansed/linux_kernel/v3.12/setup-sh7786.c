void __init sh7786_usb_use_exclock(void)\r\n{\r\nu32 val = __raw_readl(USBCTL0) & CLOCK_MODE_MASK;\r\n__raw_writel(val | EXT_CLOCK_MODE, USBCTL0);\r\n}\r\nstatic void __init sh7786_usb_setup(void)\r\n{\r\nint i = 1000000;\r\n__raw_writel(USBINITVAL1, USBINITREG1);\r\n__raw_writel(USBINITVAL2, USBINITREG2);\r\n__raw_writel(PHY_ENB | PLL_ENB, USBPCTL1);\r\nwhile (i--) {\r\nif (ACT_PLL_STATUS == (__raw_readl(USBST) & ACT_PLL_STATUS)) {\r\n__raw_writel(PHY_ENB | PLL_ENB | PHY_RST, USBPCTL1);\r\nprintk(KERN_INFO "sh7786 usb setup done\n");\r\nbreak;\r\n}\r\ncpu_relax();\r\n}\r\n}\r\nvoid __init plat_irq_setup(void)\r\n{\r\n__raw_writel(0xff000000, INTC_INTMSK0);\r\n__raw_writel(0xc0000000, INTC_INTMSK1);\r\n__raw_writel(0xfffefffe, INTC_INTMSK2);\r\n__raw_writel(__raw_readl(INTC_ICR0) & ~0x00c00000, INTC_ICR0);\r\nregister_intc_controller(&sh7786_intc_desc);\r\n}\r\nvoid __init plat_irq_setup_pins(int mode)\r\n{\r\nswitch (mode) {\r\ncase IRQ_MODE_IRQ7654:\r\n__raw_writel(__raw_readl(INTC_ICR0) | 0x00400000, INTC_ICR0);\r\nregister_intc_controller(&intc_desc_irq4567);\r\nbreak;\r\ncase IRQ_MODE_IRQ3210:\r\n__raw_writel(__raw_readl(INTC_ICR0) | 0x00800000, INTC_ICR0);\r\nregister_intc_controller(&intc_desc_irq0123);\r\nbreak;\r\ncase IRQ_MODE_IRL7654:\r\n__raw_writel(0x40000000, INTC_INTMSKCLR1);\r\n__raw_writel(0x0000fffe, INTC_INTMSKCLR2);\r\nbreak;\r\ncase IRQ_MODE_IRL3210:\r\n__raw_writel(0x80000000, INTC_INTMSKCLR1);\r\n__raw_writel(0xfffe0000, INTC_INTMSKCLR2);\r\nbreak;\r\ncase IRQ_MODE_IRL7654_MASK:\r\n__raw_writel(0x40000000, INTC_INTMSKCLR1);\r\nregister_intc_controller(&intc_desc_irl4567);\r\nbreak;\r\ncase IRQ_MODE_IRL3210_MASK:\r\n__raw_writel(0x80000000, INTC_INTMSKCLR1);\r\nregister_intc_controller(&intc_desc_irl0123);\r\nbreak;\r\ndefault:\r\nBUG();\r\n}\r\n}\r\nvoid __init plat_mem_setup(void)\r\n{\r\n}\r\nstatic int __init sh7786_devices_setup(void)\r\n{\r\nint ret, irq;\r\nsh7786_usb_setup();\r\nirq = intc_irq_lookup(sh7786_intc_desc.name, TXI1);\r\nif (irq > 0) {\r\nscif1_platform_data.irqs[SCIx_TXI_IRQ] = irq;\r\nscif1_platform_data.irqs[SCIx_ERI_IRQ] =\r\nintc_irq_lookup(sh7786_intc_desc.name, ERI1);\r\nscif1_platform_data.irqs[SCIx_BRI_IRQ] =\r\nintc_irq_lookup(sh7786_intc_desc.name, BRI1);\r\nscif1_platform_data.irqs[SCIx_RXI_IRQ] =\r\nintc_irq_lookup(sh7786_intc_desc.name, RXI1);\r\n}\r\nret = platform_add_devices(sh7786_early_devices,\r\nARRAY_SIZE(sh7786_early_devices));\r\nif (unlikely(ret != 0))\r\nreturn ret;\r\nreturn platform_add_devices(sh7786_devices,\r\nARRAY_SIZE(sh7786_devices));\r\n}\r\nvoid __init plat_early_device_setup(void)\r\n{\r\nearly_platform_add_devices(sh7786_early_devices,\r\nARRAY_SIZE(sh7786_early_devices));\r\n}
