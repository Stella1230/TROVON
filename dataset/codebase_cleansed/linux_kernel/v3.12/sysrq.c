void show_trace(struct task_struct *task, unsigned long * stack)\r\n{\r\nunsigned long addr;\r\nif (!stack) {\r\nstack = (unsigned long*) &stack;\r\nWARN_ON(1);\r\n}\r\nprintk(KERN_INFO "Call Trace: \n");\r\nwhile (((long) stack & (THREAD_SIZE-1)) != 0) {\r\naddr = *stack;\r\nif (__kernel_text_address(addr)) {\r\nprintk(KERN_INFO "%08lx: [<%08lx>]",\r\n(unsigned long) stack, addr);\r\nprint_symbol(KERN_CONT " %s", addr);\r\nprintk(KERN_CONT "\n");\r\n}\r\nstack++;\r\n}\r\nprintk(KERN_INFO "\n");\r\n}\r\nvoid show_stack(struct task_struct *task, unsigned long *esp)\r\n{\r\nunsigned long *stack;\r\nint i;\r\nif (esp == NULL) {\r\nif (task != current && task != NULL) {\r\nesp = (unsigned long *) KSTK_ESP(task);\r\n} else {\r\nesp = (unsigned long *) &esp;\r\n}\r\n}\r\nstack = esp;\r\nfor (i = 0; i < kstack_depth_to_print; i++) {\r\nif (kstack_end(stack))\r\nbreak;\r\nif (i && ((i % 8) == 0))\r\nprintk(KERN_INFO " ");\r\nprintk(KERN_CONT "%08lx ", *stack++);\r\n}\r\nshow_trace(task, esp);\r\n}
