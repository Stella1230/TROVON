static void\r\nnouveau_dp_probe_oui(struct drm_device *dev, struct nouveau_i2c_port *auxch,\r\nu8 *dpcd)\r\n{\r\nstruct nouveau_drm *drm = nouveau_drm(dev);\r\nu8 buf[3];\r\nif (!(dpcd[DP_DOWN_STREAM_PORT_COUNT] & DP_OUI_SUPPORT))\r\nreturn;\r\nif (!nv_rdaux(auxch, DP_SINK_OUI, buf, 3))\r\nNV_DEBUG(drm, "Sink OUI: %02hx%02hx%02hx\n",\r\nbuf[0], buf[1], buf[2]);\r\nif (!nv_rdaux(auxch, DP_BRANCH_OUI, buf, 3))\r\nNV_DEBUG(drm, "Branch OUI: %02hx%02hx%02hx\n",\r\nbuf[0], buf[1], buf[2]);\r\n}\r\nbool\r\nnouveau_dp_detect(struct drm_encoder *encoder)\r\n{\r\nstruct nouveau_encoder *nv_encoder = nouveau_encoder(encoder);\r\nstruct drm_device *dev = encoder->dev;\r\nstruct nouveau_drm *drm = nouveau_drm(dev);\r\nstruct nouveau_i2c_port *auxch;\r\nu8 *dpcd = nv_encoder->dp.dpcd;\r\nint ret;\r\nauxch = nv_encoder->i2c;\r\nif (!auxch)\r\nreturn false;\r\nret = nv_rdaux(auxch, DP_DPCD_REV, dpcd, 8);\r\nif (ret)\r\nreturn false;\r\nnv_encoder->dp.link_bw = 27000 * dpcd[1];\r\nnv_encoder->dp.link_nr = dpcd[2] & DP_MAX_LANE_COUNT_MASK;\r\nNV_DEBUG(drm, "display: %dx%d dpcd 0x%02x\n",\r\nnv_encoder->dp.link_nr, nv_encoder->dp.link_bw, dpcd[0]);\r\nNV_DEBUG(drm, "encoder: %dx%d\n",\r\nnv_encoder->dcb->dpconf.link_nr,\r\nnv_encoder->dcb->dpconf.link_bw);\r\nif (nv_encoder->dcb->dpconf.link_nr < nv_encoder->dp.link_nr)\r\nnv_encoder->dp.link_nr = nv_encoder->dcb->dpconf.link_nr;\r\nif (nv_encoder->dcb->dpconf.link_bw < nv_encoder->dp.link_bw)\r\nnv_encoder->dp.link_bw = nv_encoder->dcb->dpconf.link_bw;\r\nNV_DEBUG(drm, "maximum: %dx%d\n",\r\nnv_encoder->dp.link_nr, nv_encoder->dp.link_bw);\r\nnouveau_dp_probe_oui(dev, auxch, dpcd);\r\nreturn true;\r\n}
