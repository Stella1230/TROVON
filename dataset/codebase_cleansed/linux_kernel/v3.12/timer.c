static void setup_ports(int card)\r\n{\r\noutb((sc_adapter[card]->rambase >> 12), sc_adapter[card]->ioport[EXP_BASE]);\r\noutb((sc_adapter[card]->interrupt | 0x80),\r\nsc_adapter[card]->ioport[IRQ_SELECT]);\r\n}\r\nvoid sc_check_reset(unsigned long data)\r\n{\r\nunsigned long flags;\r\nunsigned long sig;\r\nint card = (unsigned int) data;\r\npr_debug("%s: check_timer timer called\n",\r\nsc_adapter[card]->devicename);\r\nsetup_ports(card);\r\nspin_lock_irqsave(&sc_adapter[card]->lock, flags);\r\noutb(sc_adapter[card]->ioport[sc_adapter[card]->shmem_pgport],\r\n(sc_adapter[card]->shmem_magic >> 14) | 0x80);\r\nsig = (unsigned long) *((unsigned long *)(sc_adapter[card]->rambase + SIG_OFFSET));\r\nif (sig == SIGNATURE) {\r\nflushreadfifo(card);\r\nspin_unlock_irqrestore(&sc_adapter[card]->lock, flags);\r\nif (sc_adapter[card]->StartOnReset)\r\nstartproc(card);\r\n} else {\r\npr_debug("%s: No signature yet, waiting another %lu jiffies.\n",\r\nsc_adapter[card]->devicename, CHECKRESET_TIME);\r\nmod_timer(&sc_adapter[card]->reset_timer, jiffies + CHECKRESET_TIME);\r\nspin_unlock_irqrestore(&sc_adapter[card]->lock, flags);\r\n}\r\n}\r\nvoid check_phystat(unsigned long data)\r\n{\r\nunsigned long flags;\r\nint card = (unsigned int) data;\r\npr_debug("%s: Checking status...\n", sc_adapter[card]->devicename);\r\nif (sc_adapter[card]->nphystat && !sc_adapter[card]->phystat) {\r\npr_debug("PhyStat transition to RUN\n");\r\npr_info("%s: Switch contacted, transmitter enabled\n",\r\nsc_adapter[card]->devicename);\r\nindicate_status(card, ISDN_STAT_RUN, 0, NULL);\r\n}\r\nelse if (!sc_adapter[card]->nphystat && sc_adapter[card]->phystat) {\r\npr_debug("PhyStat transition to STOP\n");\r\npr_info("%s: Switch connection lost, transmitter disabled\n",\r\nsc_adapter[card]->devicename);\r\nindicate_status(card, ISDN_STAT_STOP, 0, NULL);\r\n}\r\nsc_adapter[card]->phystat = sc_adapter[card]->nphystat;\r\nspin_lock_irqsave(&sc_adapter[card]->lock, flags);\r\nmod_timer(&sc_adapter[card]->stat_timer, jiffies + CHECKSTAT_TIME);\r\nspin_unlock_irqrestore(&sc_adapter[card]->lock, flags);\r\nsendmessage(card, CEPID, ceReqTypePhy, ceReqClass2,\r\nceReqPhyStatus, 0, 0, NULL);\r\n}
