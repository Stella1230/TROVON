void MTO_Init(struct wbsoft_priv *adapter)\r\n{\r\nint i;\r\nMTO_PREAMBLE_TYPE() = MTO_PREAMBLE_SHORT;\r\nMTO_CNT_ANT(0) = 0;\r\nMTO_CNT_ANT(1) = 0;\r\nMTO_SQ_ANT(0) = 0;\r\nMTO_SQ_ANT(1) = 0;\r\nMTO_AGING_TIMEOUT() = 0;\r\nMTO_RATE_LEVEL() = 0;\r\nMTO_FRAG_TH_LEVEL() = 4;\r\nMTO_RTS_THRESHOLD() = MTO_FRAG_TH() + 1;\r\nMTO_RTS_THRESHOLD_SETUP() = MTO_FRAG_TH() + 1;\r\nMTO_RATE_CHANGE_ENABLE() = 1;\r\nMTO_FRAG_CHANGE_ENABLE() = 0;\r\nMTO_POWER_CHANGE_ENABLE() = 1;\r\nMTO_PREAMBLE_CHANGE_ENABLE() = 1;\r\nMTO_RTS_CHANGE_ENABLE() = 0;\r\nfor (i = 0; i < MTO_MAX_DATA_RATE_LEVELS; i++)\r\nretryrate_rec[i] = 5;\r\nMTO_TXFLOWCOUNT() = 0;\r\nMTOPARA_PERIODIC_CHECK_CYCLE() = 10;\r\nMTOPARA_RSSI_TH_FOR_ANTDIV() = 10;\r\nMTOPARA_TXCOUNT_TH_FOR_CALC_RATE() = 50;\r\nMTOPARA_TXRATE_INC_TH() = 10;\r\nMTOPARA_TXRATE_DEC_TH() = 30;\r\nMTOPARA_TXRATE_EQ_TH() = 40;\r\nMTOPARA_TXRATE_BACKOFF() = 12;\r\nMTOPARA_TXRETRYRATE_REDUCE() = 6;\r\nif (MTO_TXPOWER_FROM_EEPROM == 0xff) {\r\nswitch (MTO_HAL()->phy_type) {\r\ncase RF_AIROHA_2230:\r\ncase RF_AIROHA_2230S:\r\nMTOPARA_TXPOWER_INDEX() = 46;\r\nbreak;\r\ncase RF_AIROHA_7230:\r\nMTOPARA_TXPOWER_INDEX() = 49;\r\nbreak;\r\ncase RF_WB_242:\r\nMTOPARA_TXPOWER_INDEX() = 10;\r\nbreak;\r\ncase RF_WB_242_1:\r\nMTOPARA_TXPOWER_INDEX() = 24;\r\nbreak;\r\n}\r\n} else {\r\nMTOPARA_TXPOWER_INDEX() = MTO_TXPOWER_FROM_EEPROM;\r\n}\r\nRFSynthesizer_SetPowerIndex(MTO_HAL(), (u8) MTOPARA_TXPOWER_INDEX());\r\nMTO_DATA().RSSI_high = -41;\r\nMTO_DATA().RSSI_low = -60;\r\n}\r\nvoid MTO_SetTxCount(struct wbsoft_priv *adapter, u8 tx_rate, u8 index)\r\n{\r\nMTO_TXFLOWCOUNT()++;\r\nif ((MTO_ENABLE == 1) && (MTO_RATE_CHANGE_ENABLE() == 1)) {\r\nif (tx_rate == MTO_DATA_RATE()) {\r\nif (index == 0) {\r\nif (boSparseTxTraffic)\r\nMTO_HAL()->dto_tx_frag_count += MTOPARA_PERIODIC_CHECK_CYCLE();\r\nelse\r\nMTO_HAL()->dto_tx_frag_count += 1;\r\n} else {\r\nif (index < 8) {\r\nMTO_HAL()->dto_tx_retry_count += index;\r\nMTO_HAL()->dto_tx_frag_count += (index + 1);\r\n} else {\r\nMTO_HAL()->dto_tx_retry_count += 7;\r\nMTO_HAL()->dto_tx_frag_count += 7;\r\n}\r\n}\r\n} else if (MTO_DATA_RATE() > 48 && tx_rate == 48) {\r\nif (index < 3) {\r\nMTO_HAL()->dto_tx_retry_count += index;\r\nMTO_HAL()->dto_tx_frag_count += (index + 1);\r\n} else {\r\nMTO_HAL()->dto_tx_retry_count += 3;\r\nMTO_HAL()->dto_tx_frag_count += 3;\r\n}\r\n}\r\n} else {\r\nMTO_HAL()->dto_tx_retry_count += index;\r\nMTO_HAL()->dto_tx_frag_count += (index + 1);\r\n}\r\n}
