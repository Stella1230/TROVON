void exit (void)\r\n{\r\nfor (;;);\r\n}\r\nvoid *zalloc(unsigned size)\r\n{\r\nvoid *p = avail_ram;\r\nsize = (size + 7) & -8;\r\navail_ram += size;\r\nif (avail_ram > end_avail) {\r\nexit ();\r\n}\r\nreturn p;\r\n}\r\nvoid gunzip (void *dst, int dstlen, unsigned char *src, int *lenp)\r\n{\r\nz_stream s;\r\nint r, i, flags;\r\ni = 10;\r\nflags = src[3];\r\nif (src[2] != DEFLATED || (flags & RESERVED) != 0) {\r\nexit();\r\n}\r\nif ((flags & EXTRA_FIELD) != 0)\r\ni = 12 + src[10] + (src[11] << 8);\r\nif ((flags & ORIG_NAME) != 0)\r\nwhile (src[i++] != 0)\r\n;\r\nif ((flags & COMMENT) != 0)\r\nwhile (src[i++] != 0)\r\n;\r\nif ((flags & HEAD_CRC) != 0)\r\ni += 2;\r\nif (i >= *lenp) {\r\nexit();\r\n}\r\ns.workspace = zalloc(zlib_inflate_workspacesize());\r\nr = zlib_inflateInit2(&s, -MAX_WBITS);\r\nif (r != Z_OK) {\r\nexit();\r\n}\r\ns.next_in = src + i;\r\ns.avail_in = *lenp - i;\r\ns.next_out = dst;\r\ns.avail_out = dstlen;\r\nr = zlib_inflate(&s, Z_FINISH);\r\nif (r != Z_OK && r != Z_STREAM_END) {\r\nexit();\r\n}\r\n*lenp = s.next_out - (unsigned char *) dst;\r\nzlib_inflateEnd(&s);\r\n}
