static void pca100_ac97_warm_reset(struct snd_ac97 *ac97)\r\n{\r\nmxc_gpio_mode(GPIO_PORTC | 20 | GPIO_GPIO | GPIO_OUT);\r\ngpio_set_value(GPIO_PORTC + 20, 1);\r\nudelay(2);\r\ngpio_set_value(GPIO_PORTC + 20, 0);\r\nmxc_gpio_mode(PC20_PF_SSI1_FS);\r\nmsleep(2);\r\n}\r\nstatic void pca100_ac97_cold_reset(struct snd_ac97 *ac97)\r\n{\r\nmxc_gpio_mode(GPIO_PORTC | 20 | GPIO_GPIO | GPIO_OUT);\r\ngpio_set_value(GPIO_PORTC + 20, 0);\r\nmxc_gpio_mode(GPIO_PORTC | 22 | GPIO_GPIO | GPIO_OUT);\r\ngpio_set_value(GPIO_PORTC + 22, 0);\r\nmxc_gpio_mode(GPIO_PORTC | 28 | GPIO_GPIO | GPIO_OUT);\r\ngpio_set_value(GPIO_PORTC + 28, 0);\r\nudelay(10);\r\ngpio_set_value(GPIO_PORTC + 28, 1);\r\nmxc_gpio_mode(PC20_PF_SSI1_FS);\r\nmxc_gpio_mode(PC22_PF_SSI1_TXD);\r\nmsleep(2);\r\n}\r\nstatic int pca100_sdhc2_init(struct device *dev, irq_handler_t detect_irq,\r\nvoid *data)\r\n{\r\nint ret;\r\nret = request_irq(gpio_to_irq(IMX_GPIO_NR(3, 29)), detect_irq,\r\nIRQF_DISABLED | IRQF_TRIGGER_FALLING,\r\n"imx-mmc-detect", data);\r\nif (ret)\r\nprintk(KERN_ERR\r\n"pca100: Failed to reuest irq for sd/mmc detection\n");\r\nreturn ret;\r\n}\r\nstatic void pca100_sdhc2_exit(struct device *dev, void *data)\r\n{\r\nfree_irq(gpio_to_irq(IMX_GPIO_NR(3, 29)), data);\r\n}\r\nstatic int otg_phy_init(struct platform_device *pdev)\r\n{\r\ngpio_set_value(OTG_PHY_CS_GPIO, 0);\r\nmdelay(10);\r\nreturn mx27_initialize_usb_hw(pdev->id, MXC_EHCI_INTERFACE_DIFF_UNI);\r\n}\r\nstatic int usbh2_phy_init(struct platform_device *pdev)\r\n{\r\ngpio_set_value(USBH2_PHY_CS_GPIO, 0);\r\nmdelay(10);\r\nreturn mx27_initialize_usb_hw(pdev->id, MXC_EHCI_INTERFACE_DIFF_UNI);\r\n}\r\nstatic int __init pca100_otg_mode(char *options)\r\n{\r\nif (!strcmp(options, "host"))\r\notg_mode_host = true;\r\nelse if (!strcmp(options, "device"))\r\notg_mode_host = false;\r\nelse\r\npr_info("otg_mode neither \"host\" nor \"device\". "\r\n"Defaulting to device\n");\r\nreturn 1;\r\n}\r\nstatic void __init pca100_init(void)\r\n{\r\nint ret;\r\nimx27_soc_init();\r\nret = mxc_gpio_setup_multiple_pins(pca100_pins,\r\nARRAY_SIZE(pca100_pins), "PCA100");\r\nif (ret)\r\nprintk(KERN_ERR "pca100: Failed to setup pins (%d)\n", ret);\r\nimx27_add_imx_ssi(0, &pca100_ssi_pdata);\r\nimx27_add_imx_uart0(&uart_pdata);\r\nimx27_add_mxc_mmc(1, &sdhc_pdata);\r\nimx27_add_mxc_nand(&pca100_nand_board_info);\r\ni2c_register_board_info(1, pca100_i2c_devices,\r\nARRAY_SIZE(pca100_i2c_devices));\r\nimx27_add_imx_i2c(1, &pca100_i2c1_data);\r\nmxc_gpio_mode(GPIO_PORTD | 28 | GPIO_GPIO | GPIO_IN);\r\nmxc_gpio_mode(GPIO_PORTD | 27 | GPIO_GPIO | GPIO_IN);\r\nspi_register_board_info(pca100_spi_board_info,\r\nARRAY_SIZE(pca100_spi_board_info));\r\nimx27_add_spi_imx0(&pca100_spi0_data);\r\ngpio_request(OTG_PHY_CS_GPIO, "usb-otg-cs");\r\ngpio_direction_output(OTG_PHY_CS_GPIO, 1);\r\ngpio_request(USBH2_PHY_CS_GPIO, "usb-host2-cs");\r\ngpio_direction_output(USBH2_PHY_CS_GPIO, 1);\r\nif (otg_mode_host) {\r\notg_pdata.otg = imx_otg_ulpi_create(ULPI_OTG_DRVVBUS |\r\nULPI_OTG_DRVVBUS_EXT);\r\nif (otg_pdata.otg)\r\nimx27_add_mxc_ehci_otg(&otg_pdata);\r\n} else {\r\ngpio_set_value(OTG_PHY_CS_GPIO, 0);\r\nimx27_add_fsl_usb2_udc(&otg_device_pdata);\r\n}\r\nusbh2_pdata.otg = imx_otg_ulpi_create(\r\nULPI_OTG_DRVVBUS | ULPI_OTG_DRVVBUS_EXT);\r\nif (usbh2_pdata.otg)\r\nimx27_add_mxc_ehci_hs(2, &usbh2_pdata);\r\nimx27_add_imx_fb(&pca100_fb_data);\r\nimx27_add_fec(NULL);\r\nimx27_add_imx2_wdt();\r\nimx27_add_mxc_w1();\r\n}\r\nstatic void __init pca100_timer_init(void)\r\n{\r\nmx27_clocks_init(26000000);\r\n}
