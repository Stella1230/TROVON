static void sh4a_ubc_enable(struct arch_hw_breakpoint *info, int idx)\r\n{\r\n__raw_writel(UBC_CBR_CE | info->len | info->type, UBC_CBR(idx));\r\n__raw_writel(info->address, UBC_CAR(idx));\r\n}\r\nstatic void sh4a_ubc_disable(struct arch_hw_breakpoint *info, int idx)\r\n{\r\n__raw_writel(0, UBC_CBR(idx));\r\n__raw_writel(0, UBC_CAR(idx));\r\n}\r\nstatic void sh4a_ubc_enable_all(unsigned long mask)\r\n{\r\nint i;\r\nfor (i = 0; i < sh4a_ubc.num_events; i++)\r\nif (mask & (1 << i))\r\n__raw_writel(__raw_readl(UBC_CBR(i)) | UBC_CBR_CE,\r\nUBC_CBR(i));\r\n}\r\nstatic void sh4a_ubc_disable_all(void)\r\n{\r\nint i;\r\nfor (i = 0; i < sh4a_ubc.num_events; i++)\r\n__raw_writel(__raw_readl(UBC_CBR(i)) & ~UBC_CBR_CE,\r\nUBC_CBR(i));\r\n}\r\nstatic unsigned long sh4a_ubc_active_mask(void)\r\n{\r\nunsigned long active = 0;\r\nint i;\r\nfor (i = 0; i < sh4a_ubc.num_events; i++)\r\nif (__raw_readl(UBC_CBR(i)) & UBC_CBR_CE)\r\nactive |= (1 << i);\r\nreturn active;\r\n}\r\nstatic unsigned long sh4a_ubc_triggered_mask(void)\r\n{\r\nreturn __raw_readl(UBC_CCMFR);\r\n}\r\nstatic void sh4a_ubc_clear_triggered_mask(unsigned long mask)\r\n{\r\n__raw_writel(__raw_readl(UBC_CCMFR) & ~mask, UBC_CCMFR);\r\n}\r\nstatic int __init sh4a_ubc_init(void)\r\n{\r\nstruct clk *ubc_iclk = clk_get(NULL, "ubc0");\r\nint i;\r\nif (IS_ERR(ubc_iclk))\r\nubc_iclk = NULL;\r\nclk_enable(ubc_iclk);\r\n__raw_writel(0, UBC_CBCR);\r\nfor (i = 0; i < sh4a_ubc.num_events; i++) {\r\n__raw_writel(0, UBC_CAMR(i));\r\n__raw_writel(0, UBC_CBR(i));\r\n__raw_writel(UBC_CRR_BIE | UBC_CRR_PCB, UBC_CRR(i));\r\n(void)__raw_readl(UBC_CRR(i));\r\n}\r\nclk_disable(ubc_iclk);\r\nsh4a_ubc.clk = ubc_iclk;\r\nreturn register_sh_ubc(&sh4a_ubc);\r\n}
