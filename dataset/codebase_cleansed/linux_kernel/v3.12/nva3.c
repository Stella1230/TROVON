static int\r\nnva3_devinit_pll_set(struct nouveau_devinit *devinit, u32 type, u32 freq)\r\n{\r\nstruct nva3_devinit_priv *priv = (void *)devinit;\r\nstruct nouveau_bios *bios = nouveau_bios(priv);\r\nstruct nvbios_pll info;\r\nint N, fN, M, P;\r\nint ret;\r\nret = nvbios_pll_parse(bios, type, &info);\r\nif (ret)\r\nreturn ret;\r\nret = nva3_pll_calc(nv_subdev(devinit), &info, freq, &N, &fN, &M, &P);\r\nif (ret < 0)\r\nreturn ret;\r\nswitch (info.type) {\r\ncase PLL_VPLL0:\r\ncase PLL_VPLL1:\r\nnv_wr32(priv, info.reg + 0, 0x50000610);\r\nnv_mask(priv, info.reg + 4, 0x003fffff,\r\n(P << 16) | (M << 8) | N);\r\nnv_wr32(priv, info.reg + 8, fN);\r\nbreak;\r\ndefault:\r\nnv_warn(priv, "0x%08x/%dKhz unimplemented\n", type, freq);\r\nret = -EINVAL;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int\r\nnva3_devinit_ctor(struct nouveau_object *parent, struct nouveau_object *engine,\r\nstruct nouveau_oclass *oclass, void *data, u32 size,\r\nstruct nouveau_object **pobject)\r\n{\r\nstruct nv50_devinit_priv *priv;\r\nint ret;\r\nret = nouveau_devinit_create(parent, engine, oclass, &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\npriv->base.pll_set = nva3_devinit_pll_set;\r\nreturn 0;\r\n}
