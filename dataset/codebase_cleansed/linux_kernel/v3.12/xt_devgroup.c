static bool devgroup_mt(const struct sk_buff *skb, struct xt_action_param *par)\r\n{\r\nconst struct xt_devgroup_info *info = par->matchinfo;\r\nif (info->flags & XT_DEVGROUP_MATCH_SRC &&\r\n(((info->src_group ^ par->in->group) & info->src_mask ? 1 : 0) ^\r\n((info->flags & XT_DEVGROUP_INVERT_SRC) ? 1 : 0)))\r\nreturn false;\r\nif (info->flags & XT_DEVGROUP_MATCH_DST &&\r\n(((info->dst_group ^ par->out->group) & info->dst_mask ? 1 : 0) ^\r\n((info->flags & XT_DEVGROUP_INVERT_DST) ? 1 : 0)))\r\nreturn false;\r\nreturn true;\r\n}\r\nstatic int devgroup_mt_checkentry(const struct xt_mtchk_param *par)\r\n{\r\nconst struct xt_devgroup_info *info = par->matchinfo;\r\nif (info->flags & ~(XT_DEVGROUP_MATCH_SRC | XT_DEVGROUP_INVERT_SRC |\r\nXT_DEVGROUP_MATCH_DST | XT_DEVGROUP_INVERT_DST))\r\nreturn -EINVAL;\r\nif (info->flags & XT_DEVGROUP_MATCH_SRC &&\r\npar->hook_mask & ~((1 << NF_INET_PRE_ROUTING) |\r\n(1 << NF_INET_LOCAL_IN) |\r\n(1 << NF_INET_FORWARD)))\r\nreturn -EINVAL;\r\nif (info->flags & XT_DEVGROUP_MATCH_DST &&\r\npar->hook_mask & ~((1 << NF_INET_FORWARD) |\r\n(1 << NF_INET_LOCAL_OUT) |\r\n(1 << NF_INET_POST_ROUTING)))\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nstatic int __init devgroup_mt_init(void)\r\n{\r\nreturn xt_register_match(&devgroup_mt_reg);\r\n}\r\nstatic void __exit devgroup_mt_exit(void)\r\n{\r\nxt_unregister_match(&devgroup_mt_reg);\r\n}
