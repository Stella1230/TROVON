static void gtk_progress_update(u64 curr, u64 total, const char *title)\r\n{\r\ndouble fraction = total ? 1.0 * curr / total : 0.0;\r\nchar buf[1024];\r\nif (dialog == NULL) {\r\nGtkWidget *vbox = gtk_vbox_new(TRUE, 5);\r\nGtkWidget *label = gtk_label_new(title);\r\ndialog = gtk_window_new(GTK_WINDOW_TOPLEVEL);\r\nprogress = gtk_progress_bar_new();\r\ngtk_box_pack_start(GTK_BOX(vbox), label, TRUE, FALSE, 3);\r\ngtk_box_pack_start(GTK_BOX(vbox), progress, TRUE, TRUE, 3);\r\ngtk_container_add(GTK_CONTAINER(dialog), vbox);\r\ngtk_window_set_title(GTK_WINDOW(dialog), "perf");\r\ngtk_window_resize(GTK_WINDOW(dialog), 300, 80);\r\ngtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);\r\ngtk_widget_show_all(dialog);\r\n}\r\ngtk_progress_bar_set_fraction(GTK_PROGRESS_BAR(progress), fraction);\r\nsnprintf(buf, sizeof(buf), "%"PRIu64" / %"PRIu64, curr, total);\r\ngtk_progress_bar_set_text(GTK_PROGRESS_BAR(progress), buf);\r\nwhile (gtk_events_pending())\r\ngtk_main_iteration();\r\n}\r\nstatic void gtk_progress_finish(void)\r\n{\r\ngtk_widget_destroy(dialog);\r\ndialog = NULL;\r\n}\r\nvoid perf_gtk__init_progress(void)\r\n{\r\nprogress_fns = &gtk_progress_fns;\r\n}
