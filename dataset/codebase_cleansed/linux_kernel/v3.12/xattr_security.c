static int v9fs_xattr_security_get(struct dentry *dentry, const char *name,\r\nvoid *buffer, size_t size, int type)\r\n{\r\nint retval;\r\nchar *full_name;\r\nsize_t name_len;\r\nsize_t prefix_len = XATTR_SECURITY_PREFIX_LEN;\r\nif (name == NULL)\r\nreturn -EINVAL;\r\nif (strcmp(name, "") == 0)\r\nreturn -EINVAL;\r\nname_len = strlen(name);\r\nfull_name = kmalloc(prefix_len + name_len + 1 , GFP_KERNEL);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nmemcpy(full_name, XATTR_SECURITY_PREFIX, prefix_len);\r\nmemcpy(full_name+prefix_len, name, name_len);\r\nfull_name[prefix_len + name_len] = '\0';\r\nretval = v9fs_xattr_get(dentry, full_name, buffer, size);\r\nkfree(full_name);\r\nreturn retval;\r\n}\r\nstatic int v9fs_xattr_security_set(struct dentry *dentry, const char *name,\r\nconst void *value, size_t size, int flags, int type)\r\n{\r\nint retval;\r\nchar *full_name;\r\nsize_t name_len;\r\nsize_t prefix_len = XATTR_SECURITY_PREFIX_LEN;\r\nif (name == NULL)\r\nreturn -EINVAL;\r\nif (strcmp(name, "") == 0)\r\nreturn -EINVAL;\r\nname_len = strlen(name);\r\nfull_name = kmalloc(prefix_len + name_len + 1 , GFP_KERNEL);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nmemcpy(full_name, XATTR_SECURITY_PREFIX, prefix_len);\r\nmemcpy(full_name + prefix_len, name, name_len);\r\nfull_name[prefix_len + name_len] = '\0';\r\nretval = v9fs_xattr_set(dentry, full_name, value, size, flags);\r\nkfree(full_name);\r\nreturn retval;\r\n}
