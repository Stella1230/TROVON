bool llist_add_batch(struct llist_node *new_first, struct llist_node *new_last,\r\nstruct llist_head *head)\r\n{\r\nstruct llist_node *first;\r\ndo {\r\nnew_last->next = first = ACCESS_ONCE(head->first);\r\n} while (cmpxchg(&head->first, first, new_first) != first);\r\nreturn !first;\r\n}\r\nstruct llist_node *llist_del_first(struct llist_head *head)\r\n{\r\nstruct llist_node *entry, *old_entry, *next;\r\nentry = head->first;\r\nfor (;;) {\r\nif (entry == NULL)\r\nreturn NULL;\r\nold_entry = entry;\r\nnext = entry->next;\r\nentry = cmpxchg(&head->first, old_entry, next);\r\nif (entry == old_entry)\r\nbreak;\r\n}\r\nreturn entry;\r\n}
