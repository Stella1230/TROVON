static void __init cpu8815_map_io(void)\r\n{\r\niotable_init(cpu8815_io_desc, ARRAY_SIZE(cpu8815_io_desc));\r\n}\r\nstatic void cpu8815_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nvoid __iomem *srcbase = ioremap(NOMADIK_SRC_BASE, SZ_4K);\r\nwritel(1, srcbase + 0x18);\r\n}\r\nstatic void __init cpu8815_timer_init_of(void)\r\n{\r\nstruct device_node *mtu;\r\nvoid __iomem *base;\r\nint irq;\r\nu32 src_cr;\r\nnomadik_clk_init();\r\nmtu = of_find_node_by_path("/mtu@101e2000");\r\nif (!mtu)\r\nreturn;\r\nbase = of_iomap(mtu, 0);\r\nif (WARN_ON(!base))\r\nreturn;\r\nirq = irq_of_parse_and_map(mtu, 0);\r\npr_info("Remapped MTU @ %p, irq: %d\n", base, irq);\r\nsrc_cr = readl(base);\r\nsrc_cr &= SRC_CR_INIT_MASK;\r\nsrc_cr |= SRC_CR_INIT_VAL;\r\nwritel(src_cr, base);\r\nclocksource_of_init();\r\n}\r\nstatic int __init cpu8815_eth_init(void)\r\n{\r\nstruct device_node *eth;\r\nint gpio, irq, err;\r\neth = of_find_node_by_path("/usb-s8815/ethernet-gpio");\r\nif (!eth) {\r\npr_info("could not find any ethernet GPIO\n");\r\nreturn 0;\r\n}\r\ngpio = of_get_gpio(eth, 0);\r\nerr = gpio_request(gpio, "eth_irq");\r\nif (err) {\r\npr_info("failed to request ethernet GPIO\n");\r\nreturn -ENODEV;\r\n}\r\nerr = gpio_direction_input(gpio);\r\nif (err) {\r\npr_info("failed to set ethernet GPIO as input\n");\r\nreturn -ENODEV;\r\n}\r\nirq = gpio_to_irq(gpio);\r\npr_info("enabled USB-S8815 ethernet GPIO %d, IRQ %d\n", gpio, irq);\r\nreturn 0;\r\n}\r\nstatic int __init cpu8815_mmcsd_init(void)\r\n{\r\nstruct device_node *cdbias;\r\nint gpio, err;\r\ncdbias = of_find_node_by_path("/usb-s8815/mmcsd-gpio");\r\nif (!cdbias) {\r\npr_info("could not find MMC/SD card detect bias node\n");\r\nreturn 0;\r\n}\r\ngpio = of_get_gpio(cdbias, 0);\r\nif (gpio < 0) {\r\npr_info("could not obtain MMC/SD card detect bias GPIO\n");\r\nreturn 0;\r\n}\r\nerr = gpio_request(gpio, "card detect bias");\r\nif (err) {\r\npr_info("failed to request card detect bias GPIO %d\n", gpio);\r\nreturn -ENODEV;\r\n}\r\nerr = gpio_direction_output(gpio, 0);\r\nif (err){\r\npr_info("failed to set GPIO %d as output, low\n", gpio);\r\nreturn err;\r\n}\r\npr_info("enabled USB-S8815 CD bias GPIO %d, low\n", gpio);\r\nreturn 0;\r\n}\r\nstatic void __init cpu8815_init_of(void)\r\n{\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_of_init(0x00730249, 0xfe000fff);\r\n#endif\r\nof_platform_populate(NULL, of_default_bus_match_table,\r\ncpu8815_auxdata_lookup, NULL);\r\n}
