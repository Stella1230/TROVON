static inline void __iomem *iram_phys_to_virt(unsigned long p)\r\n{\r\nreturn iram_virt_base + (p - iram_phys_base);\r\n}\r\nvoid __iomem *iram_alloc(unsigned int size, unsigned long *dma_addr)\r\n{\r\nif (!iram_pool)\r\nreturn NULL;\r\n*dma_addr = gen_pool_alloc(iram_pool, size);\r\npr_debug("iram alloc - %dB@0x%lX\n", size, *dma_addr);\r\nif (!*dma_addr)\r\nreturn NULL;\r\nreturn iram_phys_to_virt(*dma_addr);\r\n}\r\nvoid iram_free(unsigned long addr, unsigned int size)\r\n{\r\nif (!iram_pool)\r\nreturn;\r\ngen_pool_free(iram_pool, addr, size);\r\n}\r\nint __init iram_init(unsigned long base, unsigned long size)\r\n{\r\niram_phys_base = base;\r\niram_pool = gen_pool_create(PAGE_SHIFT, -1);\r\nif (!iram_pool)\r\nreturn -ENOMEM;\r\ngen_pool_add(iram_pool, base, size, -1);\r\niram_virt_base = ioremap(iram_phys_base, size);\r\nif (!iram_virt_base)\r\nreturn -EIO;\r\npr_debug("i.MX IRAM pool: %ld KB@0x%p\n", size / 1024, iram_virt_base);\r\nreturn 0;\r\n}
