bool intel_ddc_probe(struct intel_encoder *intel_encoder, int ddc_bus)\r\n{\r\nstruct drm_i915_private *dev_priv = intel_encoder->base.dev->dev_private;\r\nu8 out_buf[] = { 0x0, 0x0};\r\nu8 buf[2];\r\nstruct i2c_msg msgs[] = {\r\n{\r\n.addr = 0x50,\r\n.flags = 0,\r\n.len = 1,\r\n.buf = out_buf,\r\n},\r\n{\r\n.addr = 0x50,\r\n.flags = I2C_M_RD,\r\n.len = 1,\r\n.buf = buf,\r\n}\r\n};\r\nreturn i2c_transfer(&dev_priv->gmbus[ddc_bus].adapter, msgs, 2) == 2;\r\n}\r\nint intel_ddc_get_modes(struct drm_connector *connector,\r\nstruct i2c_adapter *adapter)\r\n{\r\nstruct edid *edid;\r\nint ret = 0;\r\nedid = drm_get_edid(connector, adapter);\r\nif (edid) {\r\ndrm_mode_connector_update_edid_property(connector, edid);\r\nret = drm_add_edid_modes(connector, edid);\r\ndrm_edid_to_eld(connector, edid);\r\nconnector->display_info.raw_edid = NULL;\r\nkfree(edid);\r\n}\r\nreturn ret;\r\n}\r\nvoid\r\nintel_attach_force_audio_property(struct drm_connector *connector)\r\n{\r\nstruct drm_device *dev = connector->dev;\r\nstruct drm_i915_private *dev_priv = dev->dev_private;\r\nstruct drm_property *prop;\r\nint i;\r\nprop = dev_priv->force_audio_property;\r\nif (prop == NULL) {\r\nprop = drm_property_create(dev, DRM_MODE_PROP_ENUM,\r\n"audio",\r\nARRAY_SIZE(force_audio_names));\r\nif (prop == NULL)\r\nreturn;\r\nfor (i = 0; i < ARRAY_SIZE(force_audio_names); i++)\r\ndrm_property_add_enum(prop, i, i-1, force_audio_names[i]);\r\ndev_priv->force_audio_property = prop;\r\n}\r\ndrm_connector_attach_property(connector, prop, 0);\r\n}\r\nvoid\r\nintel_attach_broadcast_rgb_property(struct drm_connector *connector)\r\n{\r\nstruct drm_device *dev = connector->dev;\r\nstruct drm_i915_private *dev_priv = dev->dev_private;\r\nstruct drm_property *prop;\r\nint i;\r\nprop = dev_priv->broadcast_rgb_property;\r\nif (prop == NULL) {\r\nprop = drm_property_create(dev, DRM_MODE_PROP_ENUM,\r\n"Broadcast RGB",\r\nARRAY_SIZE(broadcast_rgb_names));\r\nif (prop == NULL)\r\nreturn;\r\nfor (i = 0; i < ARRAY_SIZE(broadcast_rgb_names); i++)\r\ndrm_property_add_enum(prop, i, i, broadcast_rgb_names[i]);\r\ndev_priv->broadcast_rgb_property = prop;\r\n}\r\ndrm_connector_attach_property(connector, prop, 0);\r\n}
