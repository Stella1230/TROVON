static __net_init int sunrpc_init_net(struct net *net)\r\n{\r\nint err;\r\nerr = rpc_proc_init(net);\r\nif (err)\r\ngoto err_proc;\r\nerr = ip_map_cache_create(net);\r\nif (err)\r\ngoto err_ipmap;\r\nreturn 0;\r\nerr_ipmap:\r\nrpc_proc_exit(net);\r\nerr_proc:\r\nreturn err;\r\n}\r\nstatic __net_exit void sunrpc_exit_net(struct net *net)\r\n{\r\nip_map_cache_destroy(net);\r\nrpc_proc_exit(net);\r\n}\r\nstatic int __init\r\ninit_sunrpc(void)\r\n{\r\nint err = register_rpc_pipefs();\r\nif (err)\r\ngoto out;\r\nerr = rpc_init_mempool();\r\nif (err)\r\ngoto out2;\r\nerr = rpcauth_init_module();\r\nif (err)\r\ngoto out3;\r\ncache_initialize();\r\nerr = register_pernet_subsys(&sunrpc_net_ops);\r\nif (err)\r\ngoto out4;\r\n#ifdef RPC_DEBUG\r\nrpc_register_sysctl();\r\n#endif\r\ncache_register(&unix_gid_cache);\r\nsvc_init_xprt_sock();\r\ninit_socket_xprt();\r\nreturn 0;\r\nout4:\r\nrpcauth_remove_module();\r\nout3:\r\nrpc_destroy_mempool();\r\nout2:\r\nunregister_rpc_pipefs();\r\nout:\r\nreturn err;\r\n}\r\nstatic void __exit\r\ncleanup_sunrpc(void)\r\n{\r\nrpcauth_remove_module();\r\ncleanup_socket_xprt();\r\nsvc_cleanup_xprt_sock();\r\nunregister_rpc_pipefs();\r\nrpc_destroy_mempool();\r\ncache_unregister(&unix_gid_cache);\r\nunregister_pernet_subsys(&sunrpc_net_ops);\r\n#ifdef RPC_DEBUG\r\nrpc_unregister_sysctl();\r\n#endif\r\nrcu_barrier();\r\n}
