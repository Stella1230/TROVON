static void do_sync(void)\r\n{\r\n__builtin_bfin_ssync();\r\n}\r\nvoid init_clocks(void)\r\n{\r\nsize_t i;\r\nfor (i = 0; i < MAX_DMA_CHANNELS; ++i) {\r\nstruct dma_register *dma = dma_io_base_addr[i];\r\ndma->cfg = 0;\r\n}\r\ndo_sync();\r\n#ifdef SIC_IWR0\r\nbfin_write_SIC_IWR0(IWR_ENABLE(0));\r\n# ifdef SIC_IWR1\r\nif (ANOMALY_05000435)\r\nbfin_write_SIC_IWR1(IWR_ENABLE(10) | IWR_ENABLE(11));\r\nelse\r\nbfin_write_SIC_IWR1(IWR_DISABLE_ALL);\r\n# endif\r\n# ifdef SIC_IWR2\r\nbfin_write_SIC_IWR2(IWR_DISABLE_ALL);\r\n# endif\r\n#else\r\nbfin_write_SIC_IWR(IWR_ENABLE(0));\r\n#endif\r\ndo_sync();\r\n#ifdef EBIU_SDGCTL\r\nbfin_write_EBIU_SDGCTL(bfin_read_EBIU_SDGCTL() | SRFS);\r\ndo_sync();\r\n#endif\r\n#ifdef CLKBUFOE\r\nbfin_write16(VR_CTL, bfin_read_VR_CTL() | CLKBUFOE);\r\ndo_sync();\r\n__asm__ __volatile__("IDLE;");\r\n#endif\r\nbfin_write_PLL_LOCKCNT(0x300);\r\ndo_sync();\r\nbfin_write16(PLL_CTL, PLL_CTL_VAL);\r\n__asm__ __volatile__("IDLE;");\r\nbfin_write_PLL_DIV(CONFIG_CCLK_ACT_DIV | CONFIG_SCLK_DIV);\r\n#ifdef EBIU_SDGCTL\r\nbfin_write_EBIU_SDRRC(mem_SDRRC);\r\nbfin_write_EBIU_SDGCTL((bfin_read_EBIU_SDGCTL() & SDGCTL_WIDTH) | mem_SDGCTL);\r\n#else\r\nbfin_write_EBIU_RSTCTL(bfin_read_EBIU_RSTCTL() & ~(SRREQ));\r\ndo_sync();\r\nbfin_write_EBIU_RSTCTL(bfin_read_EBIU_RSTCTL() | 0x1);\r\nbfin_write_EBIU_DDRCTL0(mem_DDRCTL0);\r\nbfin_write_EBIU_DDRCTL1(mem_DDRCTL1);\r\nbfin_write_EBIU_DDRCTL2(mem_DDRCTL2);\r\n#ifdef CONFIG_MEM_EBIU_DDRQUE\r\nbfin_write_EBIU_DDRQUE(CONFIG_MEM_EBIU_DDRQUE);\r\n#endif\r\n#endif\r\ndo_sync();\r\nbfin_read16(0);\r\n}
