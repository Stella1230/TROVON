static int regmap_spi_write(struct device *dev, const void *data, size_t count)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nreturn spi_write(spi, data, count);\r\n}\r\nstatic int regmap_spi_gather_write(struct device *dev,\r\nconst void *reg, size_t reg_len,\r\nconst void *val, size_t val_len)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nstruct spi_message m;\r\nstruct spi_transfer t[2] = { { .tx_buf = reg, .len = reg_len, },\r\n{ .tx_buf = val, .len = val_len, }, };\r\nspi_message_init(&m);\r\nspi_message_add_tail(&t[0], &m);\r\nspi_message_add_tail(&t[1], &m);\r\nreturn spi_sync(spi, &m);\r\n}\r\nstatic int regmap_spi_read(struct device *dev,\r\nconst void *reg, size_t reg_size,\r\nvoid *val, size_t val_size)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nreturn spi_write_then_read(spi, reg, reg_size, val, val_size);\r\n}\r\nstruct regmap *regmap_init_spi(struct spi_device *spi,\r\nconst struct regmap_config *config)\r\n{\r\nreturn regmap_init(&spi->dev, &regmap_spi, config);\r\n}
