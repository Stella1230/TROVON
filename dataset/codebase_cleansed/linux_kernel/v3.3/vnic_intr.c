void vnic_intr_free(struct vnic_intr *intr)\r\n{\r\nintr->ctrl = NULL;\r\n}\r\nint vnic_intr_alloc(struct vnic_dev *vdev, struct vnic_intr *intr,\r\nunsigned int index)\r\n{\r\nintr->index = index;\r\nintr->vdev = vdev;\r\nintr->ctrl = vnic_dev_get_res(vdev, RES_TYPE_INTR_CTRL, index);\r\nif (!intr->ctrl) {\r\nprintk(KERN_ERR "Failed to hook INTR[%d].ctrl resource\n",\r\nindex);\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nvoid vnic_intr_init(struct vnic_intr *intr, unsigned int coalescing_timer,\r\nunsigned int coalescing_type, unsigned int mask_on_assertion)\r\n{\r\niowrite32(coalescing_timer, &intr->ctrl->coalescing_timer);\r\niowrite32(coalescing_type, &intr->ctrl->coalescing_type);\r\niowrite32(mask_on_assertion, &intr->ctrl->mask_on_assertion);\r\niowrite32(0, &intr->ctrl->int_credits);\r\n}\r\nvoid vnic_intr_clean(struct vnic_intr *intr)\r\n{\r\niowrite32(0, &intr->ctrl->int_credits);\r\n}
