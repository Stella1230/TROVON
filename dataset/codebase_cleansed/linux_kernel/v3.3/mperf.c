static void read_measured_perf_ctrs(void *_cur)\r\n{\r\nstruct aperfmperf *am = _cur;\r\nget_aperfmperf(am);\r\n}\r\nunsigned int cpufreq_get_measured_perf(struct cpufreq_policy *policy,\r\nunsigned int cpu)\r\n{\r\nstruct aperfmperf perf;\r\nunsigned long ratio;\r\nunsigned int retval;\r\nif (smp_call_function_single(cpu, read_measured_perf_ctrs, &perf, 1))\r\nreturn 0;\r\nratio = calc_aperfmperf_ratio(&per_cpu(acfreq_old_perf, cpu), &perf);\r\nper_cpu(acfreq_old_perf, cpu) = perf;\r\nretval = (policy->cpuinfo.max_freq * ratio) >> APERFMPERF_SHIFT;\r\nreturn retval;\r\n}
