static int lxt970_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_read(phydev, MII_BMSR);\r\nif (err < 0)\r\nreturn err;\r\nerr = phy_read(phydev, MII_LXT970_ISR);\r\nif (err < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int lxt970_config_intr(struct phy_device *phydev)\r\n{\r\nint err;\r\nif(phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_write(phydev, MII_LXT970_IER, MII_LXT970_IER_IEN);\r\nelse\r\nerr = phy_write(phydev, MII_LXT970_IER, 0);\r\nreturn err;\r\n}\r\nstatic int lxt970_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_LXT970_CONFIG, 0);\r\nreturn err;\r\n}\r\nstatic int lxt971_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err = phy_read(phydev, MII_LXT971_ISR);\r\nif (err < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int lxt971_config_intr(struct phy_device *phydev)\r\n{\r\nint err;\r\nif(phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_write(phydev, MII_LXT971_IER, MII_LXT971_IER_IEN);\r\nelse\r\nerr = phy_write(phydev, MII_LXT971_IER, 0);\r\nreturn err;\r\n}\r\nstatic int lxt973_probe(struct phy_device *phydev)\r\n{\r\nint val = phy_read(phydev, MII_LXT973_PCR);\r\nif (val & PCR_FIBER_SELECT) {\r\nval = phy_read(phydev, MII_BMCR);\r\nval |= (BMCR_SPEED100 | BMCR_FULLDPLX);\r\nval &= ~BMCR_ANENABLE;\r\nphy_write(phydev, MII_BMCR, val);\r\nphydev->priv = lxt973_probe;\r\n} else {\r\nphydev->priv = NULL;\r\n}\r\nreturn 0;\r\n}\r\nstatic int lxt973_config_aneg(struct phy_device *phydev)\r\n{\r\nreturn phydev->priv ? 0 : genphy_config_aneg(phydev);\r\n}\r\nstatic int __init lxt_init(void)\r\n{\r\nint ret;\r\nret = phy_driver_register(&lxt970_driver);\r\nif (ret)\r\ngoto err1;\r\nret = phy_driver_register(&lxt971_driver);\r\nif (ret)\r\ngoto err2;\r\nret = phy_driver_register(&lxt973_driver);\r\nif (ret)\r\ngoto err3;\r\nreturn 0;\r\nerr3:\r\nphy_driver_unregister(&lxt971_driver);\r\nerr2:\r\nphy_driver_unregister(&lxt970_driver);\r\nerr1:\r\nreturn ret;\r\n}\r\nstatic void __exit lxt_exit(void)\r\n{\r\nphy_driver_unregister(&lxt970_driver);\r\nphy_driver_unregister(&lxt971_driver);\r\nphy_driver_unregister(&lxt973_driver);\r\n}
