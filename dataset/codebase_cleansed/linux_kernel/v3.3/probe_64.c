static int apicid_phys_pkg_id(int initial_apic_id, int index_msb)\r\n{\r\nreturn hard_smp_processor_id() >> index_msb;\r\n}\r\nvoid __init default_setup_apic_routing(void)\r\n{\r\nstruct apic **drv;\r\nenable_IR_x2apic();\r\nfor (drv = __apicdrivers; drv < __apicdrivers_end; drv++) {\r\nif ((*drv)->probe && (*drv)->probe()) {\r\nif (apic != *drv) {\r\napic = *drv;\r\npr_info("Switched APIC routing to %s.\n",\r\napic->name);\r\n}\r\nbreak;\r\n}\r\n}\r\nif (is_vsmp_box()) {\r\napic->phys_pkg_id = apicid_phys_pkg_id;\r\n}\r\n}\r\nvoid apic_send_IPI_self(int vector)\r\n{\r\n__default_send_IPI_shortcut(APIC_DEST_SELF, vector, APIC_DEST_PHYSICAL);\r\n}\r\nint __init default_acpi_madt_oem_check(char *oem_id, char *oem_table_id)\r\n{\r\nstruct apic **drv;\r\nfor (drv = __apicdrivers; drv < __apicdrivers_end; drv++) {\r\nif ((*drv)->acpi_madt_oem_check(oem_id, oem_table_id)) {\r\nif (apic != *drv) {\r\napic = *drv;\r\npr_info("Setting APIC routing to %s.\n",\r\napic->name);\r\n}\r\nreturn 1;\r\n}\r\n}\r\nreturn 0;\r\n}
