static void stdio_announce(char *dev_name, int dev)\r\n{\r\nprintk(KERN_INFO "Virtual console %d assigned device '%s'\n", dev,\r\ndev_name);\r\n}\r\nstatic int con_config(char *str, char **error_out)\r\n{\r\nreturn line_config(vts, ARRAY_SIZE(vts), str, &opts, error_out);\r\n}\r\nstatic int con_get_config(char *dev, char *str, int size, char **error_out)\r\n{\r\nreturn line_get_config(dev, vts, ARRAY_SIZE(vts), str, size, error_out);\r\n}\r\nstatic int con_remove(int n, char **error_out)\r\n{\r\nreturn line_remove(vts, ARRAY_SIZE(vts), n, error_out);\r\n}\r\nstatic int con_open(struct tty_struct *tty, struct file *filp)\r\n{\r\nint err = line_open(vts, tty);\r\nif (err)\r\nprintk(KERN_ERR "Failed to open console %d, err = %d\n",\r\ntty->index, err);\r\nreturn err;\r\n}\r\nstatic void uml_console_write(struct console *console, const char *string,\r\nunsigned len)\r\n{\r\nstruct line *line = &vts[console->index];\r\nunsigned long flags;\r\nspin_lock_irqsave(&line->lock, flags);\r\nconsole_write_chan(&line->chan_list, string, len);\r\nspin_unlock_irqrestore(&line->lock, flags);\r\n}\r\nstatic struct tty_driver *uml_console_device(struct console *c, int *index)\r\n{\r\n*index = c->index;\r\nreturn console_driver;\r\n}\r\nstatic int uml_console_setup(struct console *co, char *options)\r\n{\r\nstruct line *line = &vts[co->index];\r\nreturn console_open_chan(line, co);\r\n}\r\nstatic int stdio_init(void)\r\n{\r\nchar *new_title;\r\nconsole_driver = register_lines(&driver, &console_ops, vts,\r\nARRAY_SIZE(vts));\r\nif (console_driver == NULL)\r\nreturn -1;\r\nprintk(KERN_INFO "Initialized stdio console driver\n");\r\nnew_title = add_xterm_umid(opts.xterm_title);\r\nif(new_title != NULL)\r\nopts.xterm_title = new_title;\r\nlines_init(vts, ARRAY_SIZE(vts), &opts);\r\ncon_init_done = 1;\r\nregister_console(&stdiocons);\r\nreturn 0;\r\n}\r\nstatic void console_exit(void)\r\n{\r\nif (!con_init_done)\r\nreturn;\r\nclose_lines(vts, ARRAY_SIZE(vts));\r\n}\r\nstatic int console_chan_setup(char *str)\r\n{\r\nchar *error;\r\nint ret;\r\nret = line_setup(vts, ARRAY_SIZE(vts), str, &error);\r\nif(ret < 0)\r\nprintk(KERN_ERR "Failed to set up console with "\r\n"configuration string \"%s\" : %s\n", str, error);\r\nreturn 1;\r\n}
