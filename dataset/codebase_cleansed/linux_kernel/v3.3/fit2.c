static void fit2_write_regr( PIA *pi, int cont, int regr, int val)\r\n{ if (cont == 1) return;\r\nw2(0xc); w0(regr); w2(4); w0(val); w2(5); w0(0); w2(4);\r\n}\r\nstatic int fit2_read_regr( PIA *pi, int cont, int regr )\r\n{ int a, b, r;\r\nif (cont) {\r\nif (regr != 6) return 0xff;\r\nr = 7;\r\n} else r = regr + 0x10;\r\nw2(0xc); w0(r); w2(4); w2(5);\r\nw0(0); a = r1();\r\nw0(1); b = r1();\r\nw2(4);\r\nreturn j44(a,b);\r\n}\r\nstatic void fit2_read_block( PIA *pi, char * buf, int count )\r\n{ int k, a, b, c, d;\r\nw2(0xc); w0(0x10);\r\nfor (k=0;k<count/4;k++) {\r\nw2(4); w2(5);\r\nw0(0); a = r1(); w0(1); b = r1();\r\nw0(3); c = r1(); w0(2); d = r1();\r\nbuf[4*k+0] = j44(a,b);\r\nbuf[4*k+1] = j44(d,c);\r\nw2(4); w2(5);\r\na = r1(); w0(3); b = r1();\r\nw0(1); c = r1(); w0(0); d = r1();\r\nbuf[4*k+2] = j44(d,c);\r\nbuf[4*k+3] = j44(a,b);\r\n}\r\nw2(4);\r\n}\r\nstatic void fit2_write_block( PIA *pi, char * buf, int count )\r\n{ int k;\r\nw2(0xc); w0(0);\r\nfor (k=0;k<count/2;k++) {\r\nw2(4); w0(buf[2*k]);\r\nw2(5); w0(buf[2*k+1]);\r\n}\r\nw2(4);\r\n}\r\nstatic void fit2_connect ( PIA *pi )\r\n{ pi->saved_r0 = r0();\r\npi->saved_r2 = r2();\r\nw2(0xcc);\r\n}\r\nstatic void fit2_disconnect ( PIA *pi )\r\n{ w0(pi->saved_r0);\r\nw2(pi->saved_r2);\r\n}\r\nstatic void fit2_log_adapter( PIA *pi, char * scratch, int verbose )\r\n{ printk("%s: fit2 %s, FIT 2000 adapter at 0x%x, delay %d\n",\r\npi->device,FIT2_VERSION,pi->port,pi->delay);\r\n}\r\nstatic int __init fit2_init(void)\r\n{\r\nreturn paride_register(&fit2);\r\n}\r\nstatic void __exit fit2_exit(void)\r\n{\r\nparide_unregister(&fit2);\r\n}
