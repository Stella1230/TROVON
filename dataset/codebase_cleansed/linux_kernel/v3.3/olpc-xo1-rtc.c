static void rtc_wake_on(struct device *dev)\r\n{\r\nolpc_xo1_pm_wakeup_set(CS5536_PM_RTC);\r\n}\r\nstatic void rtc_wake_off(struct device *dev)\r\n{\r\nolpc_xo1_pm_wakeup_clear(CS5536_PM_RTC);\r\n}\r\nstatic int __init xo1_rtc_init(void)\r\n{\r\nint r;\r\nstruct device_node *node;\r\nnode = of_find_compatible_node(NULL, NULL, "olpc,xo1-rtc");\r\nif (!node)\r\nreturn 0;\r\nof_node_put(node);\r\npr_info("olpc-xo1-rtc: Initializing OLPC XO-1 RTC\n");\r\nrdmsrl(MSR_RTC_DOMA_OFFSET, rtc_info.rtc_day_alarm);\r\nrdmsrl(MSR_RTC_MONA_OFFSET, rtc_info.rtc_mon_alarm);\r\nrdmsrl(MSR_RTC_CEN_OFFSET, rtc_info.rtc_century);\r\nr = platform_device_register(&xo1_rtc_device);\r\nif (r)\r\nreturn r;\r\ndevice_init_wakeup(&xo1_rtc_device.dev, 1);\r\nreturn 0;\r\n}
