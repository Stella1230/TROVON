size_t perf_top__header_snprintf(struct perf_top *top, char *bf, size_t size)\r\n{\r\nfloat samples_per_sec = top->samples / top->delay_secs;\r\nfloat ksamples_per_sec = top->kernel_samples / top->delay_secs;\r\nfloat esamples_percent = (100.0 * top->exact_samples) / top->samples;\r\nsize_t ret = 0;\r\nif (!perf_guest) {\r\nret = SNPRINTF(bf, size,\r\n" PerfTop:%8.0f irqs/sec kernel:%4.1f%%"\r\n" exact: %4.1f%% [", samples_per_sec,\r\n100.0 - (100.0 * ((samples_per_sec - ksamples_per_sec) /\r\nsamples_per_sec)),\r\nesamples_percent);\r\n} else {\r\nfloat us_samples_per_sec = top->us_samples / top->delay_secs;\r\nfloat guest_kernel_samples_per_sec = top->guest_kernel_samples / top->delay_secs;\r\nfloat guest_us_samples_per_sec = top->guest_us_samples / top->delay_secs;\r\nret = SNPRINTF(bf, size,\r\n" PerfTop:%8.0f irqs/sec kernel:%4.1f%% us:%4.1f%%"\r\n" guest kernel:%4.1f%% guest us:%4.1f%%"\r\n" exact: %4.1f%% [", samples_per_sec,\r\n100.0 - (100.0 * ((samples_per_sec - ksamples_per_sec) /\r\nsamples_per_sec)),\r\n100.0 - (100.0 * ((samples_per_sec - us_samples_per_sec) /\r\nsamples_per_sec)),\r\n100.0 - (100.0 * ((samples_per_sec -\r\nguest_kernel_samples_per_sec) /\r\nsamples_per_sec)),\r\n100.0 - (100.0 * ((samples_per_sec -\r\nguest_us_samples_per_sec) /\r\nsamples_per_sec)),\r\nesamples_percent);\r\n}\r\nif (top->evlist->nr_entries == 1) {\r\nstruct perf_evsel *first;\r\nfirst = list_entry(top->evlist->entries.next, struct perf_evsel, node);\r\nret += SNPRINTF(bf + ret, size - ret, "%" PRIu64 "%s ",\r\n(uint64_t)first->attr.sample_period,\r\ntop->freq ? "Hz" : "");\r\n}\r\nret += SNPRINTF(bf + ret, size - ret, "%s", event_name(top->sym_evsel));\r\nret += SNPRINTF(bf + ret, size - ret, "], ");\r\nif (top->target_pid != -1)\r\nret += SNPRINTF(bf + ret, size - ret, " (target_pid: %d",\r\ntop->target_pid);\r\nelse if (top->target_tid != -1)\r\nret += SNPRINTF(bf + ret, size - ret, " (target_tid: %d",\r\ntop->target_tid);\r\nelse\r\nret += SNPRINTF(bf + ret, size - ret, " (all");\r\nif (top->cpu_list)\r\nret += SNPRINTF(bf + ret, size - ret, ", CPU%s: %s)",\r\ntop->evlist->cpus->nr > 1 ? "s" : "", top->cpu_list);\r\nelse {\r\nif (top->target_tid != -1)\r\nret += SNPRINTF(bf + ret, size - ret, ")");\r\nelse\r\nret += SNPRINTF(bf + ret, size - ret, ", %d CPU%s)",\r\ntop->evlist->cpus->nr,\r\ntop->evlist->cpus->nr > 1 ? "s" : "");\r\n}\r\nreturn ret;\r\n}\r\nvoid perf_top__reset_sample_counters(struct perf_top *top)\r\n{\r\ntop->samples = top->us_samples = top->kernel_samples =\r\ntop->exact_samples = top->guest_kernel_samples =\r\ntop->guest_us_samples = 0;\r\n}
