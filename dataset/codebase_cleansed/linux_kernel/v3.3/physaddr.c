unsigned long __phys_addr(unsigned long x)\r\n{\r\nif (x >= __START_KERNEL_map) {\r\nx -= __START_KERNEL_map;\r\nVIRTUAL_BUG_ON(x >= KERNEL_IMAGE_SIZE);\r\nx += phys_base;\r\n} else {\r\nVIRTUAL_BUG_ON(x < PAGE_OFFSET);\r\nx -= PAGE_OFFSET;\r\nVIRTUAL_BUG_ON(!phys_addr_valid(x));\r\n}\r\nreturn x;\r\n}\r\nbool __virt_addr_valid(unsigned long x)\r\n{\r\nif (x >= __START_KERNEL_map) {\r\nx -= __START_KERNEL_map;\r\nif (x >= KERNEL_IMAGE_SIZE)\r\nreturn false;\r\nx += phys_base;\r\n} else {\r\nif (x < PAGE_OFFSET)\r\nreturn false;\r\nx -= PAGE_OFFSET;\r\nif (!phys_addr_valid(x))\r\nreturn false;\r\n}\r\nreturn pfn_valid(x >> PAGE_SHIFT);\r\n}\r\nunsigned long __phys_addr(unsigned long x)\r\n{\r\nVIRTUAL_BUG_ON(x < PAGE_OFFSET);\r\nVIRTUAL_BUG_ON(__vmalloc_start_set && is_vmalloc_addr((void *) x));\r\nreturn x - PAGE_OFFSET;\r\n}\r\nbool __virt_addr_valid(unsigned long x)\r\n{\r\nif (x < PAGE_OFFSET)\r\nreturn false;\r\nif (__vmalloc_start_set && is_vmalloc_addr((void *) x))\r\nreturn false;\r\nif (x >= FIXADDR_START)\r\nreturn false;\r\nreturn pfn_valid((x - PAGE_OFFSET) >> PAGE_SHIFT);\r\n}
