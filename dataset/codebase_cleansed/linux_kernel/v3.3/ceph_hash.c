unsigned ceph_str_hash_rjenkins(const char *str, unsigned length)\r\n{\r\nconst unsigned char *k = (const unsigned char *)str;\r\n__u32 a, b, c;\r\n__u32 len;\r\nlen = length;\r\na = 0x9e3779b9;\r\nb = a;\r\nc = 0;\r\nwhile (len >= 12) {\r\na = a + (k[0] + ((__u32)k[1] << 8) + ((__u32)k[2] << 16) +\r\n((__u32)k[3] << 24));\r\nb = b + (k[4] + ((__u32)k[5] << 8) + ((__u32)k[6] << 16) +\r\n((__u32)k[7] << 24));\r\nc = c + (k[8] + ((__u32)k[9] << 8) + ((__u32)k[10] << 16) +\r\n((__u32)k[11] << 24));\r\nmix(a, b, c);\r\nk = k + 12;\r\nlen = len - 12;\r\n}\r\nc = c + length;\r\nswitch (len) {\r\ncase 11:\r\nc = c + ((__u32)k[10] << 24);\r\ncase 10:\r\nc = c + ((__u32)k[9] << 16);\r\ncase 9:\r\nc = c + ((__u32)k[8] << 8);\r\ncase 8:\r\nb = b + ((__u32)k[7] << 24);\r\ncase 7:\r\nb = b + ((__u32)k[6] << 16);\r\ncase 6:\r\nb = b + ((__u32)k[5] << 8);\r\ncase 5:\r\nb = b + k[4];\r\ncase 4:\r\na = a + ((__u32)k[3] << 24);\r\ncase 3:\r\na = a + ((__u32)k[2] << 16);\r\ncase 2:\r\na = a + ((__u32)k[1] << 8);\r\ncase 1:\r\na = a + k[0];\r\n}\r\nmix(a, b, c);\r\nreturn c;\r\n}\r\nunsigned ceph_str_hash_linux(const char *str, unsigned length)\r\n{\r\nunsigned long hash = 0;\r\nunsigned char c;\r\nwhile (length--) {\r\nc = *str++;\r\nhash = (hash + (c << 4) + (c >> 4)) * 11;\r\n}\r\nreturn hash;\r\n}\r\nunsigned ceph_str_hash(int type, const char *s, unsigned len)\r\n{\r\nswitch (type) {\r\ncase CEPH_STR_HASH_LINUX:\r\nreturn ceph_str_hash_linux(s, len);\r\ncase CEPH_STR_HASH_RJENKINS:\r\nreturn ceph_str_hash_rjenkins(s, len);\r\ndefault:\r\nreturn -1;\r\n}\r\n}\r\nconst char *ceph_str_hash_name(int type)\r\n{\r\nswitch (type) {\r\ncase CEPH_STR_HASH_LINUX:\r\nreturn "linux";\r\ncase CEPH_STR_HASH_RJENKINS:\r\nreturn "rjenkins";\r\ndefault:\r\nreturn "unknown";\r\n}\r\n}
