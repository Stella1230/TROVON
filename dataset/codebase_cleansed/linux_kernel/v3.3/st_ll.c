static void send_ll_cmd(struct st_data_s *st_data,\r\nunsigned char cmd)\r\n{\r\npr_debug("%s: writing %x", __func__, cmd);\r\nst_int_write(st_data, &cmd, 1);\r\nreturn;\r\n}\r\nstatic void ll_device_want_to_sleep(struct st_data_s *st_data)\r\n{\r\nstruct kim_data_s *kim_data;\r\nstruct ti_st_plat_data *pdata;\r\npr_debug("%s", __func__);\r\nif (st_data->ll_state != ST_LL_AWAKE)\r\npr_err("ERR hcill: ST_LL_GO_TO_SLEEP_IND"\r\n"in state %ld", st_data->ll_state);\r\nsend_ll_cmd(st_data, LL_SLEEP_ACK);\r\nst_data->ll_state = ST_LL_ASLEEP;\r\nkim_data = st_data->kim_data;\r\npdata = kim_data->kim_pdev->dev.platform_data;\r\nif (pdata->chip_asleep)\r\npdata->chip_asleep(NULL);\r\n}\r\nstatic void ll_device_want_to_wakeup(struct st_data_s *st_data)\r\n{\r\nstruct kim_data_s *kim_data;\r\nstruct ti_st_plat_data *pdata;\r\nswitch (st_data->ll_state) {\r\ncase ST_LL_ASLEEP:\r\nsend_ll_cmd(st_data, LL_WAKE_UP_ACK);\r\nbreak;\r\ncase ST_LL_ASLEEP_TO_AWAKE:\r\npr_err("duplicate wake_ind while waiting for Wake ack");\r\nbreak;\r\ncase ST_LL_AWAKE:\r\npr_err("duplicate wake_ind already AWAKE");\r\nbreak;\r\ncase ST_LL_AWAKE_TO_ASLEEP:\r\npr_err("duplicate wake_ind");\r\nbreak;\r\n}\r\nst_data->ll_state = ST_LL_AWAKE;\r\nkim_data = st_data->kim_data;\r\npdata = kim_data->kim_pdev->dev.platform_data;\r\nif (pdata->chip_asleep)\r\npdata->chip_awake(NULL);\r\n}\r\nvoid st_ll_enable(struct st_data_s *ll)\r\n{\r\nll->ll_state = ST_LL_AWAKE;\r\n}\r\nvoid st_ll_disable(struct st_data_s *ll)\r\n{\r\nll->ll_state = ST_LL_INVALID;\r\n}\r\nvoid st_ll_wakeup(struct st_data_s *ll)\r\n{\r\nif (likely(ll->ll_state != ST_LL_AWAKE)) {\r\nsend_ll_cmd(ll, LL_WAKE_UP_IND);\r\nll->ll_state = ST_LL_ASLEEP_TO_AWAKE;\r\n} else {\r\npr_err(" Chip already AWAKE ");\r\n}\r\n}\r\nunsigned long st_ll_getstate(struct st_data_s *ll)\r\n{\r\npr_debug(" returning state %ld", ll->ll_state);\r\nreturn ll->ll_state;\r\n}\r\nunsigned long st_ll_sleep_state(struct st_data_s *st_data,\r\nunsigned char cmd)\r\n{\r\nswitch (cmd) {\r\ncase LL_SLEEP_IND:\r\npr_debug("sleep indication recvd");\r\nll_device_want_to_sleep(st_data);\r\nbreak;\r\ncase LL_SLEEP_ACK:\r\npr_err("sleep ack rcvd: host shouldn't");\r\nbreak;\r\ncase LL_WAKE_UP_IND:\r\npr_debug("wake indication recvd");\r\nll_device_want_to_wakeup(st_data);\r\nbreak;\r\ncase LL_WAKE_UP_ACK:\r\npr_debug("wake ack rcvd");\r\nst_data->ll_state = ST_LL_AWAKE;\r\nbreak;\r\ndefault:\r\npr_err(" unknown input/state ");\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nlong st_ll_init(struct st_data_s *ll)\r\n{\r\nll->ll_state = ST_LL_INVALID;\r\nreturn 0;\r\n}\r\nlong st_ll_deinit(struct st_data_s *ll)\r\n{\r\nreturn 0;\r\n}
