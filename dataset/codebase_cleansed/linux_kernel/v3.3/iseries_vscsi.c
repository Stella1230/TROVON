static void iseriesvscsi_handle_event(struct HvLpEvent *lpevt)\r\n{\r\nstruct srp_lp_event *evt = (struct srp_lp_event *)lpevt;\r\nif (!evt) {\r\nprintk(KERN_ERR "ibmvscsi: received null event\n");\r\nreturn;\r\n}\r\nif (single_host_data == NULL) {\r\nprintk(KERN_ERR\r\n"ibmvscsi: received event, no adapter present\n");\r\nreturn;\r\n}\r\nibmvscsi_handle_crq(&evt->crq, single_host_data);\r\n}\r\nstatic int iseriesvscsi_init_crq_queue(struct crq_queue *queue,\r\nstruct ibmvscsi_host_data *hostdata,\r\nint max_requests)\r\n{\r\nint rc;\r\nsingle_host_data = hostdata;\r\nrc = viopath_open(viopath_hostLp, viomajorsubtype_scsi, max_requests);\r\nif (rc < 0) {\r\nprintk("viopath_open failed with rc %d in open_event_path\n",\r\nrc);\r\ngoto viopath_open_failed;\r\n}\r\nrc = vio_setHandler(viomajorsubtype_scsi, iseriesvscsi_handle_event);\r\nif (rc < 0) {\r\nprintk("vio_setHandler failed with rc %d in open_event_path\n",\r\nrc);\r\ngoto vio_setHandler_failed;\r\n}\r\nreturn 0;\r\nvio_setHandler_failed:\r\nviopath_close(viopath_hostLp, viomajorsubtype_scsi, max_requests);\r\nviopath_open_failed:\r\nreturn -1;\r\n}\r\nstatic void iseriesvscsi_release_crq_queue(struct crq_queue *queue,\r\nstruct ibmvscsi_host_data *hostdata,\r\nint max_requests)\r\n{\r\nvio_clearHandler(viomajorsubtype_scsi);\r\nviopath_close(viopath_hostLp, viomajorsubtype_scsi, max_requests);\r\n}\r\nstatic int iseriesvscsi_reset_crq_queue(struct crq_queue *queue,\r\nstruct ibmvscsi_host_data *hostdata)\r\n{\r\nreturn 0;\r\n}\r\nstatic int iseriesvscsi_reenable_crq_queue(struct crq_queue *queue,\r\nstruct ibmvscsi_host_data *hostdata)\r\n{\r\nreturn 0;\r\n}\r\nstatic int iseriesvscsi_send_crq(struct ibmvscsi_host_data *hostdata,\r\nu64 word1, u64 word2)\r\n{\r\nsingle_host_data = hostdata;\r\nreturn HvCallEvent_signalLpEventFast(viopath_hostLp,\r\nHvLpEvent_Type_VirtualIo,\r\nviomajorsubtype_scsi,\r\nHvLpEvent_AckInd_NoAck,\r\nHvLpEvent_AckType_ImmediateAck,\r\nviopath_sourceinst(viopath_hostLp),\r\nviopath_targetinst(viopath_hostLp),\r\n0,\r\nVIOVERSION << 16, word1, word2, 0,\r\n0);\r\n}\r\nstatic int iseriesvscsi_resume(struct ibmvscsi_host_data *hostdata)\r\n{\r\nreturn 0;\r\n}
