ieee754dp ieee754dp_modf(ieee754dp x, ieee754dp *ip)\r\n{\r\nCOMPXDP;\r\nCLEARCX;\r\nEXPLODEXDP;\r\nswitch (xc) {\r\ncase IEEE754_CLASS_SNAN:\r\ncase IEEE754_CLASS_QNAN:\r\ncase IEEE754_CLASS_INF:\r\ncase IEEE754_CLASS_ZERO:\r\n*ip = x;\r\nreturn x;\r\ncase IEEE754_CLASS_DNORM:\r\n*ip = ieee754dp_zero(xs);\r\nreturn x;\r\ncase IEEE754_CLASS_NORM:\r\nbreak;\r\n}\r\nif (xe < 0) {\r\n*ip = ieee754dp_zero(xs);\r\nreturn x;\r\n}\r\nif (xe >= DP_MBITS) {\r\n*ip = x;\r\nreturn ieee754dp_zero(xs);\r\n}\r\n*ip = builddp(xs, xe + DP_EBIAS,\r\n((xm >> (DP_MBITS - xe)) << (DP_MBITS - xe)) &\r\n~DP_HIDDEN_BIT);\r\nxm = (xm << (64 - (DP_MBITS - xe))) >> (64 - (DP_MBITS - xe));\r\nif (xm == 0)\r\nreturn ieee754dp_zero(xs);\r\nwhile ((xm >> DP_MBITS) == 0) {\r\nxm <<= 1;\r\nxe--;\r\n}\r\nreturn builddp(xs, xe + DP_EBIAS, xm & ~DP_HIDDEN_BIT);\r\n}
