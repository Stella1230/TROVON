void __devinit pcibios_fixup_bus(struct pci_bus *b)\r\n{\r\n}\r\nchar * __devinit pcibios_setup(char *str)\r\n{\r\nreturn NULL;\r\n}\r\nvoid pcibios_set_master(struct pci_dev *dev)\r\n{\r\nu8 lat;\r\npci_read_config_byte(dev, PCI_LATENCY_TIMER, &lat);\r\nprintk(KERN_DEBUG "PCI: Setting latency timer of device %s to %d\n", pci_name(dev), lat);\r\npci_write_config_byte(dev, PCI_LATENCY_TIMER, lat);\r\n}\r\nint pci_mmap_page_range(struct pci_dev *dev, struct vm_area_struct *vma,\r\nenum pci_mmap_state mmap_state, int write_combine)\r\n{\r\nunsigned long prot;\r\nprot = pgprot_val(vma->vm_page_prot);\r\nvma->vm_page_prot = __pgprot(prot);\r\nif (remap_pfn_range(vma, vma->vm_start, vma->vm_pgoff,\r\nvma->vm_end - vma->vm_start,\r\nvma->vm_page_prot))\r\nreturn -EAGAIN;\r\nreturn 0;\r\n}\r\nresource_size_t\r\npcibios_align_resource(void *data, const struct resource *res,\r\nresource_size_t size, resource_size_t align)\r\n{\r\nresource_size_t start = res->start;\r\nif ((res->flags & IORESOURCE_IO) && (start & 0x300))\r\nstart = (start + 0x3ff) & ~0x3ff;\r\nreturn start;\r\n}\r\nint pcibios_enable_resources(struct pci_dev *dev, int mask)\r\n{\r\nu16 cmd, old_cmd;\r\nint idx;\r\nstruct resource *r;\r\npci_read_config_word(dev, PCI_COMMAND, &cmd);\r\nold_cmd = cmd;\r\nfor(idx=0; idx<6; idx++) {\r\nif (!(mask & (1<<idx)))\r\ncontinue;\r\nr = &dev->resource[idx];\r\nif (!r->start && r->end) {\r\nprintk(KERN_ERR "PCI: Device %s not available because of resource collisions\n", pci_name(dev));\r\nreturn -EINVAL;\r\n}\r\nif (r->flags & IORESOURCE_IO)\r\ncmd |= PCI_COMMAND_IO;\r\nif (r->flags & IORESOURCE_MEM)\r\ncmd |= PCI_COMMAND_MEMORY;\r\n}\r\nif (dev->resource[PCI_ROM_RESOURCE].start)\r\ncmd |= PCI_COMMAND_MEMORY;\r\nif (cmd != old_cmd) {\r\nprintk("PCI: Enabling device %s (%04x -> %04x)\n", pci_name(dev), old_cmd, cmd);\r\npci_write_config_word(dev, PCI_COMMAND, cmd);\r\n}\r\nreturn 0;\r\n}\r\nint pcibios_enable_irq(struct pci_dev *dev)\r\n{\r\ndev->irq = EXT_INTR_VECT;\r\nreturn 0;\r\n}\r\nint pcibios_enable_device(struct pci_dev *dev, int mask)\r\n{\r\nint err;\r\nif ((err = pcibios_enable_resources(dev, mask)) < 0)\r\nreturn err;\r\nif (!dev->msi_enabled)\r\npcibios_enable_irq(dev);\r\nreturn 0;\r\n}\r\nint pcibios_assign_resources(void)\r\n{\r\nstruct pci_dev *dev = NULL;\r\nint idx;\r\nstruct resource *r;\r\nwhile ((dev = pci_get_device(PCI_ANY_ID, PCI_ANY_ID, dev)) != NULL) {\r\nint class = dev->class >> 8;\r\nif (!class || class == PCI_CLASS_BRIDGE_HOST)\r\ncontinue;\r\nfor(idx=0; idx<6; idx++) {\r\nr = &dev->resource[idx];\r\nif (!r->start && r->end)\r\npci_assign_resource(dev, idx);\r\n}\r\n}\r\nreturn 0;\r\n}
