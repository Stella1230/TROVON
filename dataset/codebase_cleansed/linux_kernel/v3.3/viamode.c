static struct VideoModeTable *get_modes(struct VideoModeTable *vmt, int n,\r\nint hres, int vres)\r\n{\r\nint i;\r\nfor (i = 0; i < n; i++)\r\nif (vmt[i].mode_array &&\r\nvmt[i].crtc[0].crtc.hor_addr == hres &&\r\nvmt[i].crtc[0].crtc.ver_addr == vres)\r\nreturn &viafb_modes[i];\r\nreturn NULL;\r\n}\r\nstatic struct crt_mode_table *get_best_mode(struct VideoModeTable *vmt,\r\nint refresh)\r\n{\r\nstruct crt_mode_table *best;\r\nint i;\r\nif (!vmt)\r\nreturn NULL;\r\nbest = &vmt->crtc[0];\r\nfor (i = 1; i < vmt->mode_array; i++) {\r\nif (abs(vmt->crtc[i].refresh_rate - refresh)\r\n< abs(best->refresh_rate - refresh))\r\nbest = &vmt->crtc[i];\r\n}\r\nreturn best;\r\n}\r\nstatic struct VideoModeTable *viafb_get_mode(int hres, int vres)\r\n{\r\nreturn get_modes(viafb_modes, ARRAY_SIZE(viafb_modes), hres, vres);\r\n}\r\nstruct crt_mode_table *viafb_get_best_mode(int hres, int vres, int refresh)\r\n{\r\nreturn get_best_mode(viafb_get_mode(hres, vres), refresh);\r\n}\r\nstatic struct VideoModeTable *viafb_get_rb_mode(int hres, int vres)\r\n{\r\nreturn get_modes(viafb_rb_modes, ARRAY_SIZE(viafb_rb_modes), hres,\r\nvres);\r\n}\r\nstruct crt_mode_table *viafb_get_best_rb_mode(int hres, int vres, int refresh)\r\n{\r\nreturn get_best_mode(viafb_get_rb_mode(hres, vres), refresh);\r\n}
