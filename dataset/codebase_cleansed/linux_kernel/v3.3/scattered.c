void __cpuinit init_scattered_cpuid_features(struct cpuinfo_x86 *c)\r\n{\r\nu32 max_level;\r\nu32 regs[4];\r\nconst struct cpuid_bit *cb;\r\nstatic const struct cpuid_bit __cpuinitconst cpuid_bits[] = {\r\n{ X86_FEATURE_DTS, CR_EAX, 0, 0x00000006, 0 },\r\n{ X86_FEATURE_IDA, CR_EAX, 1, 0x00000006, 0 },\r\n{ X86_FEATURE_ARAT, CR_EAX, 2, 0x00000006, 0 },\r\n{ X86_FEATURE_PLN, CR_EAX, 4, 0x00000006, 0 },\r\n{ X86_FEATURE_PTS, CR_EAX, 6, 0x00000006, 0 },\r\n{ X86_FEATURE_APERFMPERF, CR_ECX, 0, 0x00000006, 0 },\r\n{ X86_FEATURE_EPB, CR_ECX, 3, 0x00000006, 0 },\r\n{ X86_FEATURE_XSAVEOPT, CR_EAX, 0, 0x0000000d, 1 },\r\n{ X86_FEATURE_CPB, CR_EDX, 9, 0x80000007, 0 },\r\n{ X86_FEATURE_NPT, CR_EDX, 0, 0x8000000a, 0 },\r\n{ X86_FEATURE_LBRV, CR_EDX, 1, 0x8000000a, 0 },\r\n{ X86_FEATURE_SVML, CR_EDX, 2, 0x8000000a, 0 },\r\n{ X86_FEATURE_NRIPS, CR_EDX, 3, 0x8000000a, 0 },\r\n{ X86_FEATURE_TSCRATEMSR, CR_EDX, 4, 0x8000000a, 0 },\r\n{ X86_FEATURE_VMCBCLEAN, CR_EDX, 5, 0x8000000a, 0 },\r\n{ X86_FEATURE_FLUSHBYASID, CR_EDX, 6, 0x8000000a, 0 },\r\n{ X86_FEATURE_DECODEASSISTS, CR_EDX, 7, 0x8000000a, 0 },\r\n{ X86_FEATURE_PAUSEFILTER, CR_EDX,10, 0x8000000a, 0 },\r\n{ X86_FEATURE_PFTHRESHOLD, CR_EDX,12, 0x8000000a, 0 },\r\n{ 0, 0, 0, 0, 0 }\r\n};\r\nfor (cb = cpuid_bits; cb->feature; cb++) {\r\nmax_level = cpuid_eax(cb->level & 0xffff0000);\r\nif (max_level < cb->level ||\r\nmax_level > (cb->level | 0xffff))\r\ncontinue;\r\ncpuid_count(cb->level, cb->sub_leaf, &regs[CR_EAX],\r\n&regs[CR_EBX], &regs[CR_ECX], &regs[CR_EDX]);\r\nif (regs[cb->reg] & (1 << cb->bit))\r\nset_cpu_cap(c, cb->feature);\r\n}\r\n}
