static int __init gate_vma_init(void)\r\n{\r\nif (!FIXADDR_USER_START)\r\nreturn 0;\r\ngate_vma.vm_mm = NULL;\r\ngate_vma.vm_start = FIXADDR_USER_START;\r\ngate_vma.vm_end = FIXADDR_USER_END;\r\ngate_vma.vm_flags = VM_READ | VM_MAYREAD | VM_EXEC | VM_MAYEXEC;\r\ngate_vma.vm_page_prot = __P101;\r\ngate_vma.vm_flags |= VM_ALWAYSDUMP;\r\nreturn 0;\r\n}\r\nstruct vm_area_struct *get_gate_vma(struct mm_struct *mm)\r\n{\r\nreturn FIXADDR_USER_START ? &gate_vma : NULL;\r\n}\r\nint in_gate_area_no_mm(unsigned long addr)\r\n{\r\nif (!FIXADDR_USER_START)\r\nreturn 0;\r\nif ((addr >= FIXADDR_USER_START) && (addr < FIXADDR_USER_END))\r\nreturn 1;\r\nreturn 0;\r\n}\r\nint in_gate_area(struct mm_struct *mm, unsigned long addr)\r\n{\r\nstruct vm_area_struct *vma = get_gate_vma(mm);\r\nif (!vma)\r\nreturn 0;\r\nreturn (addr >= vma->vm_start) && (addr < vma->vm_end);\r\n}
