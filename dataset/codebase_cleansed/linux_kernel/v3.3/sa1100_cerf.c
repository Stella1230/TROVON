static int cerf_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nskt->socket.pci_irq = CERF_IRQ_GPIO_CF_IRQ;\r\nreturn soc_pcmcia_request_irqs(skt, irqs, ARRAY_SIZE(irqs));\r\n}\r\nstatic void cerf_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\r\n{\r\nsoc_pcmcia_free_irqs(skt, irqs, ARRAY_SIZE(irqs));\r\n}\r\nstatic void\r\ncerf_pcmcia_socket_state(struct soc_pcmcia_socket *skt, struct pcmcia_state *state)\r\n{\r\nunsigned long levels = GPLR;\r\nstate->detect = (levels & CERF_GPIO_CF_CD) ?0:1;\r\nstate->ready = (levels & CERF_GPIO_CF_IRQ) ?1:0;\r\nstate->bvd1 = (levels & CERF_GPIO_CF_BVD1)?1:0;\r\nstate->bvd2 = (levels & CERF_GPIO_CF_BVD2)?1:0;\r\nstate->wrprot = 0;\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nstatic int\r\ncerf_pcmcia_configure_socket(struct soc_pcmcia_socket *skt,\r\nconst socket_state_t *state)\r\n{\r\nswitch (state->Vcc) {\r\ncase 0:\r\ncase 50:\r\ncase 33:\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "%s(): unrecognized Vcc %u\n",\r\n__func__, state->Vcc);\r\nreturn -1;\r\n}\r\nif (state->flags & SS_RESET) {\r\nGPSR = CERF_GPIO_CF_RESET;\r\n} else {\r\nGPCR = CERF_GPIO_CF_RESET;\r\n}\r\nreturn 0;\r\n}\r\nstatic void cerf_pcmcia_socket_init(struct soc_pcmcia_socket *skt)\r\n{\r\nsoc_pcmcia_enable_irqs(skt, irqs, ARRAY_SIZE(irqs));\r\n}\r\nstatic void cerf_pcmcia_socket_suspend(struct soc_pcmcia_socket *skt)\r\n{\r\nsoc_pcmcia_disable_irqs(skt, irqs, ARRAY_SIZE(irqs));\r\n}\r\nint __devinit pcmcia_cerf_init(struct device *dev)\r\n{\r\nint ret = -ENODEV;\r\nif (machine_is_cerf())\r\nret = sa11xx_drv_pcmcia_probe(dev, &cerf_pcmcia_ops, CERF_SOCKET, 1);\r\nreturn ret;\r\n}
