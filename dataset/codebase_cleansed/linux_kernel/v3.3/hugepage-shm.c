int main(void)\r\n{\r\nint shmid;\r\nunsigned long i;\r\nchar *shmaddr;\r\nif ((shmid = shmget(2, LENGTH,\r\nSHM_HUGETLB | IPC_CREAT | SHM_R | SHM_W)) < 0) {\r\nperror("shmget");\r\nexit(1);\r\n}\r\nprintf("shmid: 0x%x\n", shmid);\r\nshmaddr = shmat(shmid, ADDR, SHMAT_FLAGS);\r\nif (shmaddr == (char *)-1) {\r\nperror("Shared memory attach failure");\r\nshmctl(shmid, IPC_RMID, NULL);\r\nexit(2);\r\n}\r\nprintf("shmaddr: %p\n", shmaddr);\r\ndprintf("Starting the writes:\n");\r\nfor (i = 0; i < LENGTH; i++) {\r\nshmaddr[i] = (char)(i);\r\nif (!(i % (1024 * 1024)))\r\ndprintf(".");\r\n}\r\ndprintf("\n");\r\ndprintf("Starting the Check...");\r\nfor (i = 0; i < LENGTH; i++)\r\nif (shmaddr[i] != (char)i)\r\nprintf("\nIndex %lu mismatched\n", i);\r\ndprintf("Done.\n");\r\nif (shmdt((const void *)shmaddr) != 0) {\r\nperror("Detach failure");\r\nshmctl(shmid, IPC_RMID, NULL);\r\nexit(3);\r\n}\r\nshmctl(shmid, IPC_RMID, NULL);\r\nreturn 0;\r\n}
