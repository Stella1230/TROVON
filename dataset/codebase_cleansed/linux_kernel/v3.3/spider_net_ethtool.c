static int\r\nspider_net_ethtool_get_settings(struct net_device *netdev,\r\nstruct ethtool_cmd *cmd)\r\n{\r\nstruct spider_net_card *card;\r\ncard = netdev_priv(netdev);\r\ncmd->supported = (SUPPORTED_1000baseT_Full |\r\nSUPPORTED_FIBRE);\r\ncmd->advertising = (ADVERTISED_1000baseT_Full |\r\nADVERTISED_FIBRE);\r\ncmd->port = PORT_FIBRE;\r\nethtool_cmd_speed_set(cmd, card->phy.speed);\r\ncmd->duplex = DUPLEX_FULL;\r\nreturn 0;\r\n}\r\nstatic void\r\nspider_net_ethtool_get_drvinfo(struct net_device *netdev,\r\nstruct ethtool_drvinfo *drvinfo)\r\n{\r\nstruct spider_net_card *card;\r\ncard = netdev_priv(netdev);\r\nmemset(drvinfo, 0, sizeof(struct ethtool_drvinfo));\r\nstrncpy(drvinfo->driver, spider_net_driver_name, 32);\r\nstrncpy(drvinfo->version, VERSION, 32);\r\nstrcpy(drvinfo->fw_version, "no information");\r\nstrncpy(drvinfo->bus_info, pci_name(card->pdev), 32);\r\n}\r\nstatic void\r\nspider_net_ethtool_get_wol(struct net_device *netdev,\r\nstruct ethtool_wolinfo *wolinfo)\r\n{\r\nwolinfo->supported = 0;\r\nwolinfo->wolopts = 0;\r\n}\r\nstatic u32\r\nspider_net_ethtool_get_msglevel(struct net_device *netdev)\r\n{\r\nstruct spider_net_card *card;\r\ncard = netdev_priv(netdev);\r\nreturn card->msg_enable;\r\n}\r\nstatic void\r\nspider_net_ethtool_set_msglevel(struct net_device *netdev,\r\nu32 level)\r\n{\r\nstruct spider_net_card *card;\r\ncard = netdev_priv(netdev);\r\ncard->msg_enable = level;\r\n}\r\nstatic int\r\nspider_net_ethtool_nway_reset(struct net_device *netdev)\r\n{\r\nif (netif_running(netdev)) {\r\nspider_net_stop(netdev);\r\nspider_net_open(netdev);\r\n}\r\nreturn 0;\r\n}\r\nstatic void\r\nspider_net_ethtool_get_ringparam(struct net_device *netdev,\r\nstruct ethtool_ringparam *ering)\r\n{\r\nstruct spider_net_card *card = netdev_priv(netdev);\r\nering->tx_max_pending = SPIDER_NET_TX_DESCRIPTORS_MAX;\r\nering->tx_pending = card->tx_chain.num_desc;\r\nering->rx_max_pending = SPIDER_NET_RX_DESCRIPTORS_MAX;\r\nering->rx_pending = card->rx_chain.num_desc;\r\n}\r\nstatic int spider_net_get_sset_count(struct net_device *netdev, int sset)\r\n{\r\nswitch (sset) {\r\ncase ETH_SS_STATS:\r\nreturn ARRAY_SIZE(ethtool_stats_keys);\r\ndefault:\r\nreturn -EOPNOTSUPP;\r\n}\r\n}\r\nstatic void spider_net_get_ethtool_stats(struct net_device *netdev,\r\nstruct ethtool_stats *stats, u64 *data)\r\n{\r\nstruct spider_net_card *card = netdev_priv(netdev);\r\ndata[0] = netdev->stats.tx_packets;\r\ndata[1] = netdev->stats.tx_bytes;\r\ndata[2] = netdev->stats.rx_packets;\r\ndata[3] = netdev->stats.rx_bytes;\r\ndata[4] = netdev->stats.tx_errors;\r\ndata[5] = netdev->stats.tx_dropped;\r\ndata[6] = netdev->stats.rx_dropped;\r\ndata[7] = card->spider_stats.rx_desc_error;\r\ndata[8] = card->spider_stats.tx_timeouts;\r\ndata[9] = card->spider_stats.alloc_rx_skb_error;\r\ndata[10] = card->spider_stats.rx_iommu_map_error;\r\ndata[11] = card->spider_stats.tx_iommu_map_error;\r\ndata[12] = card->spider_stats.rx_desc_unk_state;\r\n}\r\nstatic void spider_net_get_strings(struct net_device *netdev, u32 stringset,\r\nu8 *data)\r\n{\r\nmemcpy(data, ethtool_stats_keys, sizeof(ethtool_stats_keys));\r\n}
