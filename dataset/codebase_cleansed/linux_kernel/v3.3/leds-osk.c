static void mistral_setled(void)\r\n{\r\nint red = 0;\r\nint green = 0;\r\nif (hw_led_state & TIMER_LED)\r\nred = 1;\r\nelse if (hw_led_state & IDLE_LED)\r\ngreen = 1;\r\ngpio_set_value(GPIO_LED_GREEN, green);\r\ngpio_set_value(GPIO_LED_RED, red);\r\n}\r\nvoid osk_leds_event(led_event_t evt)\r\n{\r\nunsigned long flags;\r\nu16 leds;\r\nlocal_irq_save(flags);\r\nif (!(led_state & LED_STATE_ENABLED) && evt != led_start)\r\ngoto done;\r\nleds = hw_led_state;\r\nswitch (evt) {\r\ncase led_start:\r\nled_state |= LED_STATE_ENABLED;\r\nhw_led_state = 0;\r\nleds = ~0;\r\nbreak;\r\ncase led_halted:\r\ncase led_stop:\r\nled_state &= ~LED_STATE_ENABLED;\r\nhw_led_state = 0;\r\nbreak;\r\ncase led_claim:\r\nled_state |= LED_STATE_CLAIMED;\r\nhw_led_state = 0;\r\nleds = ~0;\r\nbreak;\r\ncase led_release:\r\nled_state &= ~LED_STATE_CLAIMED;\r\nhw_led_state = 0;\r\nbreak;\r\n#ifdef CONFIG_OMAP_OSK_MISTRAL\r\ncase led_timer:\r\nhw_led_state ^= TIMER_LED;\r\nmistral_setled();\r\nbreak;\r\ncase led_idle_start:\r\nhw_led_state &= ~IDLE_LED;\r\nmistral_setled();\r\nbreak;\r\ncase led_idle_end:\r\nhw_led_state |= IDLE_LED;\r\nmistral_setled();\r\nbreak;\r\n#endif\r\ndefault:\r\nbreak;\r\n}\r\nleds ^= hw_led_state;\r\ndone:\r\nlocal_irq_restore(flags);\r\n}
