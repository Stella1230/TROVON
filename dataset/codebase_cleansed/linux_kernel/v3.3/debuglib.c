void\r\nmyDbgPrint_EVL (long msgID, ...)\r\n{ va_list ap ;\r\nif ( myDriverDebugHandle.dbg_ev )\r\n{ va_start (ap, msgID) ;\r\n(myDriverDebugHandle.dbg_ev)\r\n(myDriverDebugHandle.id, (unsigned long)msgID, ap) ;\r\nva_end (ap) ;\r\n} }\r\nint\r\nDbgRegister (char *drvName, char *drvTag, unsigned long dbgMask)\r\n{\r\nint len;\r\nDbgDeregister () ;\r\nmyDriverDebugHandle.Version = DBG_HANDLE_VERSION ;\r\nmyDriverDebugHandle.id = -1 ;\r\nmyDriverDebugHandle.dbgMask = dbgMask | (DL_EVL | DL_FTL | DL_LOG) ;\r\nlen = strlen (drvName) ;\r\nmemcpy (myDriverDebugHandle.drvName, drvName,\r\n(len < sizeof(myDriverDebugHandle.drvName)) ?\r\nlen : sizeof(myDriverDebugHandle.drvName) - 1) ;\r\nlen = strlen (drvTag) ;\r\nmemcpy (myDriverDebugHandle.drvTag, drvTag,\r\n(len < sizeof(myDriverDebugHandle.drvTag)) ?\r\nlen : sizeof(myDriverDebugHandle.drvTag) - 1) ;\r\ndprintf("\000\377", &myDriverDebugHandle) ;\r\nif ( myDriverDebugHandle.dbg_prt )\r\n{\r\nreturn (1) ;\r\n}\r\nif ( myDriverDebugHandle.dbg_end != NULL\r\n&& (myDriverDebugHandle.regTime.LowPart ||\r\nmyDriverDebugHandle.regTime.HighPart ) )\r\n{\r\ndprintf("%s: Cannot log to old maint driver !", drvName) ;\r\nmyDriverDebugHandle.dbg_end =\r\n((_OldDbgHandle_ *)&myDriverDebugHandle)->dbg_end ;\r\nDbgDeregister () ;\r\n}\r\nreturn (0) ;\r\n}\r\nvoid\r\nDbgSetLevel (unsigned long dbgMask)\r\n{\r\nmyDriverDebugHandle.dbgMask = dbgMask | (DL_EVL | DL_FTL | DL_LOG) ;\r\n}\r\nvoid\r\nDbgDeregister (void)\r\n{\r\nif ( myDriverDebugHandle.dbg_end )\r\n{\r\n(myDriverDebugHandle.dbg_end)(&myDriverDebugHandle) ;\r\n}\r\nmemset (&myDriverDebugHandle, 0, sizeof(myDriverDebugHandle)) ;\r\n}\r\nvoid xdi_dbg_xlog (char* x, ...) {\r\nva_list ap;\r\nva_start (ap, x);\r\nif (myDriverDebugHandle.dbg_end &&\r\n(myDriverDebugHandle.dbg_irq || myDriverDebugHandle.dbg_old) &&\r\n(myDriverDebugHandle.dbgMask & DL_STAT)) {\r\nif (myDriverDebugHandle.dbg_irq) {\r\n(*(myDriverDebugHandle.dbg_irq))(myDriverDebugHandle.id,\r\n(x[0] != 0) ? DLI_TRC : DLI_XLOG, x, ap);\r\n} else {\r\n(*(myDriverDebugHandle.dbg_old))(myDriverDebugHandle.id, x, ap);\r\n}\r\n}\r\nva_end(ap);\r\n}
