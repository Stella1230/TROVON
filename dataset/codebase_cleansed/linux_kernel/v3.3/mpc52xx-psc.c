static int psc_open(void)\r\n{\r\nreturn 0;\r\n}\r\nstatic void psc_putc(unsigned char c)\r\n{\r\nwhile (!(in_be16(psc + MPC52xx_PSC_SR) & MPC52xx_PSC_SR_TXRDY)) ;\r\nout_8(psc + MPC52xx_PSC_BUFFER, c);\r\n}\r\nstatic unsigned char psc_tstc(void)\r\n{\r\nreturn (in_be16(psc + MPC52xx_PSC_SR) & MPC52xx_PSC_SR_RXRDY) != 0;\r\n}\r\nstatic unsigned char psc_getc(void)\r\n{\r\nwhile (!(in_be16(psc + MPC52xx_PSC_SR) & MPC52xx_PSC_SR_RXRDY)) ;\r\nreturn in_8(psc + MPC52xx_PSC_BUFFER);\r\n}\r\nint mpc5200_psc_console_init(void *devp, struct serial_console_data *scdp)\r\n{\r\nif (dt_get_virtual_reg(devp, &psc, 1) < 1)\r\nreturn -1;\r\nscdp->open = psc_open;\r\nscdp->putc = psc_putc;\r\nscdp->getc = psc_getc;\r\nscdp->tstc = psc_tstc;\r\nreturn 0;\r\n}
