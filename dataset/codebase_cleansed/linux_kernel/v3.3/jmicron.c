static u8 jmicron_cable_detect(ide_hwif_t *hwif)\r\n{\r\nstruct pci_dev *pdev = to_pci_dev(hwif->dev);\r\nu32 control;\r\nu32 control5;\r\nint port = hwif->channel;\r\nport_type port_map[2];\r\npci_read_config_dword(pdev, 0x40, &control);\r\nif (control & (1 << 23)) {\r\nport_map[0] = PORT_SATA;\r\nport_map[1] = PORT_PATA0;\r\n} else {\r\nport_map[0] = PORT_SATA;\r\nport_map[1] = PORT_SATA;\r\n}\r\npci_read_config_dword(pdev, 0x80, &control5);\r\nif (control5 & (1<<24))\r\nport_map[0] = PORT_PATA1;\r\nif (control & (1 << 22))\r\nport = port ^ 1;\r\nswitch (port_map[port]) {\r\ncase PORT_PATA0:\r\nif (control & (1 << 3))\r\nreturn ATA_CBL_PATA40;\r\nreturn ATA_CBL_PATA80;\r\ncase PORT_PATA1:\r\nif (control5 & (1 << 19))\r\nreturn ATA_CBL_PATA40;\r\nreturn ATA_CBL_PATA80;\r\ncase PORT_SATA:\r\nbreak;\r\n}\r\nreturn ATA_CBL_PATA80;\r\n}\r\nstatic void jmicron_set_pio_mode(ide_hwif_t *hwif, ide_drive_t *drive)\r\n{\r\n}\r\nstatic void jmicron_set_dma_mode(ide_hwif_t *hwif, ide_drive_t *drive)\r\n{\r\n}\r\nstatic int __devinit jmicron_init_one(struct pci_dev *dev, const struct pci_device_id *id)\r\n{\r\nreturn ide_pci_init_one(dev, &jmicron_chipset, NULL);\r\n}\r\nstatic int __init jmicron_ide_init(void)\r\n{\r\nreturn ide_pci_register_driver(&jmicron_pci_driver);\r\n}\r\nstatic void __exit jmicron_ide_exit(void)\r\n{\r\npci_unregister_driver(&jmicron_pci_driver);\r\n}
