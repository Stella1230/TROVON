static int __devinit of_pci_phb_probe(struct platform_device *dev)\r\n{\r\nstruct pci_controller *phb;\r\nif (ppc_md.pci_setup_phb == NULL)\r\nreturn -ENODEV;\r\npr_info("Setting up PCI bus %s\n", dev->dev.of_node->full_name);\r\nphb = pcibios_alloc_controller(dev->dev.of_node);\r\nif (!phb)\r\nreturn -ENODEV;\r\nphb->parent = &dev->dev;\r\nif (ppc_md.pci_setup_phb(phb)) {\r\npcibios_free_controller(phb);\r\nreturn -ENODEV;\r\n}\r\npci_process_bridge_OF_ranges(phb, dev->dev.of_node, 0);\r\npci_devs_phb_init_dynamic(phb);\r\n#ifdef CONFIG_EEH\r\nif (dev->dev.of_node->child)\r\neeh_add_device_tree_early(dev->dev.of_node);\r\n#endif\r\npcibios_scan_phb(phb);\r\nif (phb->bus == NULL)\r\nreturn -ENXIO;\r\npcibios_claim_one_bus(phb->bus);\r\n#ifdef CONFIG_EEH\r\neeh_add_device_tree_late(phb->bus);\r\n#endif\r\npci_bus_add_devices(phb->bus);\r\nreturn 0;\r\n}\r\nstatic __init int of_pci_phb_init(void)\r\n{\r\nreturn platform_driver_register(&of_pci_phb_driver);\r\n}
