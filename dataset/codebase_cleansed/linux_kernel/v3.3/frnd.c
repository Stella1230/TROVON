int\r\nsgl_frnd(sgl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\nsgl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int src, result;\r\nregister int src_exponent;\r\nregister boolean inexact = FALSE;\r\nsrc = *srcptr;\r\nif ((src_exponent = Sgl_exponent(src)) == SGL_INFINITY_EXPONENT) {\r\nif (Sgl_isone_signaling(src)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_set_quiet(src);\r\n}\r\n*dstptr = src;\r\nreturn(NOEXCEPTION);\r\n}\r\nif ((src_exponent -= SGL_BIAS) >= SGL_P - 1) {\r\n*dstptr = src;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (src_exponent >= 0) {\r\nSgl_clear_exponent_set_hidden(src);\r\nresult = src;\r\nSgl_rightshift(result,(SGL_P-1) - (src_exponent));\r\nif (Sgl_isinexact_to_fix(src,src_exponent)) {\r\ninexact = TRUE;\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Sgl_iszero_sign(src)) Sgl_increment(result);\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Sgl_isone_sign(src)) Sgl_increment(result);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (Sgl_isone_roundbit(src,src_exponent))\r\nif (Sgl_isone_stickybit(src,src_exponent)\r\n|| (Sgl_isone_lowmantissa(result)))\r\nSgl_increment(result);\r\n}\r\n}\r\nSgl_leftshift(result,(SGL_P-1) - (src_exponent));\r\nif (Sgl_isone_hiddenoverflow(result))\r\nSgl_set_exponent(result,src_exponent + (SGL_BIAS+1));\r\nelse Sgl_set_exponent(result,src_exponent + SGL_BIAS);\r\n}\r\nelse {\r\nresult = src;\r\nSgl_setzero_exponentmantissa(result);\r\nif (Sgl_isnotzero_exponentmantissa(src)) {\r\ninexact = TRUE;\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Sgl_iszero_sign(src))\r\nSgl_set_exponent(result,SGL_BIAS);\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Sgl_isone_sign(src))\r\nSgl_set_exponent(result,SGL_BIAS);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (src_exponent == -1)\r\nif (Sgl_isnotzero_mantissa(src))\r\nSgl_set_exponent(result,SGL_BIAS);\r\n}\r\n}\r\n}\r\n*dstptr = result;\r\nif (inexact) {\r\nif (Is_inexacttrap_enabled()) return(INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\n}\r\nreturn(NOEXCEPTION);\r\n}\r\nint\r\ndbl_frnd(\r\ndbl_floating_point *srcptr,\r\nunsigned int *nullptr,\r\ndbl_floating_point *dstptr,\r\nunsigned int *status)\r\n{\r\nregister unsigned int srcp1, srcp2, resultp1, resultp2;\r\nregister int src_exponent;\r\nregister boolean inexact = FALSE;\r\nDbl_copyfromptr(srcptr,srcp1,srcp2);\r\nif ((src_exponent = Dbl_exponent(srcp1)) == DBL_INFINITY_EXPONENT) {\r\nif (Dbl_isone_signaling(srcp1)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nDbl_set_quiet(srcp1);\r\n}\r\nDbl_copytoptr(srcp1,srcp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif ((src_exponent -= DBL_BIAS) >= DBL_P - 1) {\r\nDbl_copytoptr(srcp1,srcp2,dstptr);\r\nreturn(NOEXCEPTION);\r\n}\r\nif (src_exponent >= 0) {\r\nDbl_clear_exponent_set_hidden(srcp1);\r\nresultp1 = srcp1;\r\nresultp2 = srcp2;\r\nDbl_rightshift(resultp1,resultp2,(DBL_P-1) - (src_exponent));\r\nif (Dbl_isinexact_to_fix(srcp1,srcp2,src_exponent)) {\r\ninexact = TRUE;\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Dbl_iszero_sign(srcp1))\r\nDbl_increment(resultp1,resultp2);\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Dbl_isone_sign(srcp1))\r\nDbl_increment(resultp1,resultp2);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (Dbl_isone_roundbit(srcp1,srcp2,src_exponent))\r\nif (Dbl_isone_stickybit(srcp1,srcp2,src_exponent)\r\n|| (Dbl_isone_lowmantissap2(resultp2)))\r\nDbl_increment(resultp1,resultp2);\r\n}\r\n}\r\nDbl_leftshift(resultp1,resultp2,(DBL_P-1) - (src_exponent));\r\nif (Dbl_isone_hiddenoverflow(resultp1))\r\nDbl_set_exponent(resultp1,src_exponent + (DBL_BIAS+1));\r\nelse Dbl_set_exponent(resultp1,src_exponent + DBL_BIAS);\r\n}\r\nelse {\r\nresultp1 = srcp1;\r\nDbl_setzero_exponentmantissa(resultp1,resultp2);\r\nif (Dbl_isnotzero_exponentmantissa(srcp1,srcp2)) {\r\ninexact = TRUE;\r\nswitch (Rounding_mode()) {\r\ncase ROUNDPLUS:\r\nif (Dbl_iszero_sign(srcp1))\r\nDbl_set_exponent(resultp1,DBL_BIAS);\r\nbreak;\r\ncase ROUNDMINUS:\r\nif (Dbl_isone_sign(srcp1))\r\nDbl_set_exponent(resultp1,DBL_BIAS);\r\nbreak;\r\ncase ROUNDNEAREST:\r\nif (src_exponent == -1)\r\nif (Dbl_isnotzero_mantissa(srcp1,srcp2))\r\nDbl_set_exponent(resultp1,DBL_BIAS);\r\n}\r\n}\r\n}\r\nDbl_copytoptr(resultp1,resultp2,dstptr);\r\nif (inexact) {\r\nif (Is_inexacttrap_enabled()) return(INEXACTEXCEPTION);\r\nelse Set_inexactflag();\r\n}\r\nreturn(NOEXCEPTION);\r\n}
