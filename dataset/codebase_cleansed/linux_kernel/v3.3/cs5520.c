static void cs5520_set_pio_mode(ide_hwif_t *hwif, ide_drive_t *drive)\r\n{\r\nstruct pci_dev *pdev = to_pci_dev(hwif->dev);\r\nint controller = drive->dn > 1 ? 1 : 0;\r\nconst u8 pio = drive->pio_mode - XFER_PIO_0;\r\npci_write_config_byte(pdev, 0x62 + controller,\r\n(cs5520_pio_clocks[pio].recovery << 4) |\r\n(cs5520_pio_clocks[pio].assert));\r\npci_write_config_byte(pdev, 0x64 + 4*controller + (drive->dn&1),\r\n(cs5520_pio_clocks[pio].recovery << 4) |\r\n(cs5520_pio_clocks[pio].assert));\r\npci_write_config_byte(pdev, 0x66 + 4*controller + (drive->dn&1),\r\n(cs5520_pio_clocks[pio].recovery << 4) |\r\n(cs5520_pio_clocks[pio].assert));\r\n}\r\nstatic void cs5520_set_dma_mode(ide_hwif_t *hwif, ide_drive_t *drive)\r\n{\r\nprintk(KERN_ERR "cs55x0: bad ide timing.\n");\r\ndrive->pio_mode = XFER_PIO_0 + 0;\r\ncs5520_set_pio_mode(hwif, drive);\r\n}\r\nstatic int __devinit cs5520_init_one(struct pci_dev *dev, const struct pci_device_id *id)\r\n{\r\nconst struct ide_port_info *d = &cyrix_chipset;\r\nstruct ide_hw hw[2], *hws[] = { NULL, NULL };\r\nide_setup_pci_noise(dev, d);\r\nif (pci_enable_device_io(dev)) {\r\nprintk(KERN_WARNING "%s: Unable to enable 55x0.\n", d->name);\r\nreturn -ENODEV;\r\n}\r\npci_set_master(dev);\r\nif (pci_set_dma_mask(dev, DMA_BIT_MASK(32))) {\r\nprintk(KERN_WARNING "%s: No suitable DMA available.\n",\r\nd->name);\r\nreturn -ENODEV;\r\n}\r\nide_pci_setup_ports(dev, d, &hw[0], &hws[0]);\r\nhw[0].irq = 14;\r\nhw[1].irq = 15;\r\nreturn ide_host_add(d, hws, 2, NULL);\r\n}\r\nstatic int __init cs5520_ide_init(void)\r\n{\r\nreturn ide_pci_register_driver(&cs5520_pci_driver);\r\n}
