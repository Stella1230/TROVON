static bool check_condition(struct adapter *adapt, const u32 condition)\r\n{\r\nstruct odm_dm_struct *odm = &GET_HAL_DATA(adapt)->odmpriv;\r\nu32 _board = odm->BoardType;\r\nu32 _platform = odm->SupportPlatform;\r\nu32 _interface = odm->SupportInterface;\r\nu32 cond = condition;\r\nif (condition == 0xCDCDCDCD)\r\nreturn true;\r\ncond = condition & 0x000000FF;\r\nif ((_board == cond) && cond != 0x00)\r\nreturn false;\r\ncond = condition & 0x0000FF00;\r\ncond >>= 8;\r\nif ((_interface & cond) == 0 && cond != 0x07)\r\nreturn false;\r\ncond = condition & 0x00FF0000;\r\ncond >>= 16;\r\nif ((_platform & cond) == 0 && cond != 0x0F)\r\nreturn false;\r\nreturn true;\r\n}\r\nstatic void rtl_rfreg_delay(struct adapter *adapt, enum rf_radio_path rfpath, u32 addr, u32 mask, u32 data)\r\n{\r\nif (addr == 0xfe) {\r\nmdelay(50);\r\n} else if (addr == 0xfd) {\r\nmdelay(5);\r\n} else if (addr == 0xfc) {\r\nmdelay(1);\r\n} else if (addr == 0xfb) {\r\nudelay(50);\r\n} else if (addr == 0xfa) {\r\nudelay(5);\r\n} else if (addr == 0xf9) {\r\nudelay(1);\r\n} else {\r\nphy_set_rf_reg(adapt, rfpath, addr, mask, data);\r\nudelay(1);\r\n}\r\n}\r\nstatic void rtl8188e_config_rf_reg(struct adapter *adapt,\r\nu32 addr, u32 data)\r\n{\r\nu32 content = 0x1000;\r\nu32 maskforphyset = (u32)(content & 0xE000);\r\nrtl_rfreg_delay(adapt, RF90_PATH_A, addr | maskforphyset,\r\nRFREG_OFFSET_MASK,\r\ndata);\r\n}\r\nstatic bool rtl88e_phy_config_rf_with_headerfile(struct adapter *adapt)\r\n{\r\nu32 i;\r\nu32 array_len = sizeof(Array_RadioA_1T_8188E)/sizeof(u32);\r\nu32 *array = Array_RadioA_1T_8188E;\r\nfor (i = 0; i < array_len; i += 2) {\r\nu32 v1 = array[i];\r\nu32 v2 = array[i+1];\r\nif (v1 < 0xCDCDCDCD) {\r\nrtl8188e_config_rf_reg(adapt, v1, v2);\r\ncontinue;\r\n} else {\r\nif (!check_condition(adapt, array[i])) {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD && v2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < array_len - 2)\r\nREAD_NEXT_PAIR(v1, v2, i);\r\ni -= 2;\r\n} else {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD && v2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < array_len - 2) {\r\nrtl8188e_config_rf_reg(adapt, v1, v2);\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\nwhile (v2 != 0xDEAD && i < array_len - 2)\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\n}\r\n}\r\nreturn true;\r\n}\r\nstatic bool rf6052_conf_para(struct adapter *adapt)\r\n{\r\nstruct hal_data_8188e *hal_data = GET_HAL_DATA(adapt);\r\nu32 u4val = 0;\r\nu8 rfpath;\r\nbool rtstatus = true;\r\nstruct bb_reg_def *pphyreg;\r\nfor (rfpath = 0; rfpath < hal_data->NumTotalRFPath; rfpath++) {\r\npphyreg = &hal_data->PHYRegDef[rfpath];\r\nswitch (rfpath) {\r\ncase RF90_PATH_A:\r\ncase RF90_PATH_C:\r\nu4val = phy_query_bb_reg(adapt, pphyreg->rfintfs,\r\nBRFSI_RFENV);\r\nbreak;\r\ncase RF90_PATH_B:\r\ncase RF90_PATH_D:\r\nu4val = phy_query_bb_reg(adapt, pphyreg->rfintfs,\r\nBRFSI_RFENV << 16);\r\nbreak;\r\n}\r\nphy_set_bb_reg(adapt, pphyreg->rfintfe, BRFSI_RFENV << 16, 0x1);\r\nudelay(1);\r\nphy_set_bb_reg(adapt, pphyreg->rfintfo, BRFSI_RFENV, 0x1);\r\nudelay(1);\r\nphy_set_bb_reg(adapt, pphyreg->rfHSSIPara2,\r\nB3WIREADDREAALENGTH, 0x0);\r\nudelay(1);\r\nphy_set_bb_reg(adapt, pphyreg->rfHSSIPara2,\r\nB3WIREDATALENGTH, 0x0);\r\nudelay(1);\r\nswitch (rfpath) {\r\ncase RF90_PATH_A:\r\nrtstatus = rtl88e_phy_config_rf_with_headerfile(adapt);\r\nbreak;\r\ncase RF90_PATH_B:\r\nrtstatus = rtl88e_phy_config_rf_with_headerfile(adapt);\r\nbreak;\r\ncase RF90_PATH_C:\r\nbreak;\r\ncase RF90_PATH_D:\r\nbreak;\r\n}\r\nswitch (rfpath) {\r\ncase RF90_PATH_A:\r\ncase RF90_PATH_C:\r\nphy_set_bb_reg(adapt, pphyreg->rfintfs,\r\nBRFSI_RFENV, u4val);\r\nbreak;\r\ncase RF90_PATH_B:\r\ncase RF90_PATH_D:\r\nphy_set_bb_reg(adapt, pphyreg->rfintfs,\r\nBRFSI_RFENV << 16, u4val);\r\nbreak;\r\n}\r\nif (rtstatus != true)\r\nreturn false;\r\n}\r\nreturn rtstatus;\r\n}\r\nstatic bool rtl88e_phy_rf6052_config(struct adapter *adapt)\r\n{\r\nstruct hal_data_8188e *hal_data = GET_HAL_DATA(adapt);\r\nif (hal_data->rf_type == RF_1T1R)\r\nhal_data->NumTotalRFPath = 1;\r\nelse\r\nhal_data->NumTotalRFPath = 2;\r\nreturn rf6052_conf_para(adapt);\r\n}\r\nbool rtl88eu_phy_rf_config(struct adapter *adapt)\r\n{\r\nreturn rtl88e_phy_rf6052_config(adapt);\r\n}
