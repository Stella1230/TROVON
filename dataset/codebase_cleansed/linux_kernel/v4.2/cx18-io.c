void cx18_memset_io(struct cx18 *cx, void __iomem *addr, int val, size_t count)\r\n{\r\nu8 __iomem *dst = addr;\r\nu16 val2 = val | (val << 8);\r\nu32 val4 = val2 | (val2 << 16);\r\nif ((count > 0) && ((unsigned long)dst & 1)) {\r\ncx18_writeb(cx, (u8) val, dst);\r\ncount--;\r\ndst++;\r\n}\r\nif ((count > 1) && ((unsigned long)dst & 2)) {\r\ncx18_writew(cx, val2, dst);\r\ncount -= 2;\r\ndst += 2;\r\n}\r\nwhile (count > 3) {\r\ncx18_writel(cx, val4, dst);\r\ncount -= 4;\r\ndst += 4;\r\n}\r\nif (count > 1) {\r\ncx18_writew(cx, val2, dst);\r\ncount -= 2;\r\ndst += 2;\r\n}\r\nif (count > 0)\r\ncx18_writeb(cx, (u8) val, dst);\r\n}\r\nvoid cx18_sw1_irq_enable(struct cx18 *cx, u32 val)\r\n{\r\ncx18_write_reg_expect(cx, val, SW1_INT_STATUS, ~val, val);\r\ncx->sw1_irq_mask = cx18_read_reg(cx, SW1_INT_ENABLE_PCI) | val;\r\ncx18_write_reg(cx, cx->sw1_irq_mask, SW1_INT_ENABLE_PCI);\r\n}\r\nvoid cx18_sw1_irq_disable(struct cx18 *cx, u32 val)\r\n{\r\ncx->sw1_irq_mask = cx18_read_reg(cx, SW1_INT_ENABLE_PCI) & ~val;\r\ncx18_write_reg(cx, cx->sw1_irq_mask, SW1_INT_ENABLE_PCI);\r\n}\r\nvoid cx18_sw2_irq_enable(struct cx18 *cx, u32 val)\r\n{\r\ncx18_write_reg_expect(cx, val, SW2_INT_STATUS, ~val, val);\r\ncx->sw2_irq_mask = cx18_read_reg(cx, SW2_INT_ENABLE_PCI) | val;\r\ncx18_write_reg(cx, cx->sw2_irq_mask, SW2_INT_ENABLE_PCI);\r\n}\r\nvoid cx18_sw2_irq_disable(struct cx18 *cx, u32 val)\r\n{\r\ncx->sw2_irq_mask = cx18_read_reg(cx, SW2_INT_ENABLE_PCI) & ~val;\r\ncx18_write_reg(cx, cx->sw2_irq_mask, SW2_INT_ENABLE_PCI);\r\n}\r\nvoid cx18_sw2_irq_disable_cpu(struct cx18 *cx, u32 val)\r\n{\r\nu32 r;\r\nr = cx18_read_reg(cx, SW2_INT_ENABLE_CPU);\r\ncx18_write_reg(cx, r & ~val, SW2_INT_ENABLE_CPU);\r\n}\r\nvoid cx18_setup_page(struct cx18 *cx, u32 addr)\r\n{\r\nu32 val;\r\nval = cx18_read_reg(cx, 0xD000F8);\r\nval = (val & ~0x1f00) | ((addr >> 17) & 0x1f00);\r\ncx18_write_reg(cx, val, 0xD000F8);\r\n}
