static int am335x_init(struct usb_phy *phy)\r\n{\r\nstruct am335x_phy *am_phy = dev_get_drvdata(phy->dev);\r\nphy_ctrl_power(am_phy->phy_ctrl, am_phy->id, true);\r\nreturn 0;\r\n}\r\nstatic void am335x_shutdown(struct usb_phy *phy)\r\n{\r\nstruct am335x_phy *am_phy = dev_get_drvdata(phy->dev);\r\nphy_ctrl_power(am_phy->phy_ctrl, am_phy->id, false);\r\n}\r\nstatic int am335x_phy_probe(struct platform_device *pdev)\r\n{\r\nstruct am335x_phy *am_phy;\r\nstruct device *dev = &pdev->dev;\r\nint ret;\r\nam_phy = devm_kzalloc(dev, sizeof(*am_phy), GFP_KERNEL);\r\nif (!am_phy)\r\nreturn -ENOMEM;\r\nam_phy->phy_ctrl = am335x_get_phy_control(dev);\r\nif (!am_phy->phy_ctrl)\r\nreturn -EPROBE_DEFER;\r\nam_phy->id = of_alias_get_id(pdev->dev.of_node, "phy");\r\nif (am_phy->id < 0) {\r\ndev_err(&pdev->dev, "Missing PHY id: %d\n", am_phy->id);\r\nreturn am_phy->id;\r\n}\r\nret = usb_phy_gen_create_phy(dev, &am_phy->usb_phy_gen, NULL);\r\nif (ret)\r\nreturn ret;\r\nret = usb_add_phy_dev(&am_phy->usb_phy_gen.phy);\r\nif (ret)\r\nreturn ret;\r\nam_phy->usb_phy_gen.phy.init = am335x_init;\r\nam_phy->usb_phy_gen.phy.shutdown = am335x_shutdown;\r\nplatform_set_drvdata(pdev, am_phy);\r\ndevice_init_wakeup(dev, true);\r\ndevice_set_wakeup_enable(dev, false);\r\nphy_ctrl_power(am_phy->phy_ctrl, am_phy->id, false);\r\nreturn 0;\r\n}\r\nstatic int am335x_phy_remove(struct platform_device *pdev)\r\n{\r\nstruct am335x_phy *am_phy = platform_get_drvdata(pdev);\r\nusb_remove_phy(&am_phy->usb_phy_gen.phy);\r\nreturn 0;\r\n}\r\nstatic int am335x_phy_suspend(struct device *dev)\r\n{\r\nstruct platform_device *pdev = to_platform_device(dev);\r\nstruct am335x_phy *am_phy = platform_get_drvdata(pdev);\r\nif (device_may_wakeup(dev))\r\nphy_ctrl_wkup(am_phy->phy_ctrl, am_phy->id, true);\r\nphy_ctrl_power(am_phy->phy_ctrl, am_phy->id, false);\r\nreturn 0;\r\n}\r\nstatic int am335x_phy_resume(struct device *dev)\r\n{\r\nstruct platform_device *pdev = to_platform_device(dev);\r\nstruct am335x_phy *am_phy = platform_get_drvdata(pdev);\r\nphy_ctrl_power(am_phy->phy_ctrl, am_phy->id, true);\r\nif (device_may_wakeup(dev))\r\nphy_ctrl_wkup(am_phy->phy_ctrl, am_phy->id, false);\r\nreturn 0;\r\n}
