static void\r\nnv04_cursor_show(struct nouveau_crtc *nv_crtc, bool update)\r\n{\r\nnv_show_cursor(nv_crtc->base.dev, nv_crtc->index, true);\r\n}\r\nstatic void\r\nnv04_cursor_hide(struct nouveau_crtc *nv_crtc, bool update)\r\n{\r\nnv_show_cursor(nv_crtc->base.dev, nv_crtc->index, false);\r\n}\r\nstatic void\r\nnv04_cursor_set_pos(struct nouveau_crtc *nv_crtc, int x, int y)\r\n{\r\nnv_crtc->cursor_saved_x = x; nv_crtc->cursor_saved_y = y;\r\nNVWriteRAMDAC(nv_crtc->base.dev, nv_crtc->index,\r\nNV_PRAMDAC_CU_START_POS,\r\nXLATE(y, 0, NV_PRAMDAC_CU_START_POS_Y) |\r\nXLATE(x, 0, NV_PRAMDAC_CU_START_POS_X));\r\n}\r\nstatic void\r\ncrtc_wr_cio_state(struct drm_crtc *crtc, struct nv04_crtc_reg *crtcstate, int index)\r\n{\r\nNVWriteVgaCrtc(crtc->dev, nouveau_crtc(crtc)->index, index,\r\ncrtcstate->CRTC[index]);\r\n}\r\nstatic void\r\nnv04_cursor_set_offset(struct nouveau_crtc *nv_crtc, uint32_t offset)\r\n{\r\nstruct drm_device *dev = nv_crtc->base.dev;\r\nstruct nouveau_drm *drm = nouveau_drm(dev);\r\nstruct nv04_crtc_reg *regp = &nv04_display(dev)->mode_reg.crtc_reg[nv_crtc->index];\r\nstruct drm_crtc *crtc = &nv_crtc->base;\r\nregp->CRTC[NV_CIO_CRE_HCUR_ADDR0_INDEX] =\r\nMASK(NV_CIO_CRE_HCUR_ASI) |\r\nXLATE(offset, 17, NV_CIO_CRE_HCUR_ADDR0_ADR);\r\nregp->CRTC[NV_CIO_CRE_HCUR_ADDR1_INDEX] =\r\nXLATE(offset, 11, NV_CIO_CRE_HCUR_ADDR1_ADR);\r\nif (crtc->mode.flags & DRM_MODE_FLAG_DBLSCAN)\r\nregp->CRTC[NV_CIO_CRE_HCUR_ADDR1_INDEX] |=\r\nMASK(NV_CIO_CRE_HCUR_ADDR1_CUR_DBL);\r\nregp->CRTC[NV_CIO_CRE_HCUR_ADDR2_INDEX] = offset >> 24;\r\ncrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR0_INDEX);\r\ncrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR1_INDEX);\r\ncrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR2_INDEX);\r\nif (drm->device.info.family == NV_DEVICE_INFO_V0_CURIE)\r\nnv_fix_nv40_hw_cursor(dev, nv_crtc->index);\r\n}\r\nint\r\nnv04_cursor_init(struct nouveau_crtc *crtc)\r\n{\r\ncrtc->cursor.set_offset = nv04_cursor_set_offset;\r\ncrtc->cursor.set_pos = nv04_cursor_set_pos;\r\ncrtc->cursor.hide = nv04_cursor_hide;\r\ncrtc->cursor.show = nv04_cursor_show;\r\nreturn 0;\r\n}
