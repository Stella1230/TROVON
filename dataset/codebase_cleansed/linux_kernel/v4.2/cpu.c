static int cnmips_cu2_call(struct notifier_block *nfb, unsigned long action,\r\nvoid *data)\r\n{\r\nunsigned long flags;\r\nunsigned int status;\r\nswitch (action) {\r\ncase CU2_EXCEPTION:\r\nprefetch(&current->thread.cp2);\r\nlocal_irq_save(flags);\r\nKSTK_STATUS(current) |= ST0_CU2;\r\nstatus = read_c0_status();\r\nwrite_c0_status(status | ST0_CU2);\r\nocteon_cop2_restore(&(current->thread.cp2));\r\nwrite_c0_status(status & ~ST0_CU2);\r\nlocal_irq_restore(flags);\r\nreturn NOTIFY_BAD;\r\n}\r\nreturn NOTIFY_OK;\r\n}\r\nstatic int __init cnmips_cu2_setup(void)\r\n{\r\nreturn cu2_notifier(cnmips_cu2_call, 0);\r\n}
