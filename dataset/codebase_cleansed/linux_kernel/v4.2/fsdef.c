static uint16_t fscache_fsdef_netfs_get_key(const void *cookie_netfs_data,\r\nvoid *buffer, uint16_t bufmax)\r\n{\r\nconst struct fscache_netfs *netfs = cookie_netfs_data;\r\nunsigned klen;\r\n_enter("{%s.%u},", netfs->name, netfs->version);\r\nklen = strlen(netfs->name);\r\nif (klen > bufmax)\r\nreturn 0;\r\nmemcpy(buffer, netfs->name, klen);\r\nreturn klen;\r\n}\r\nstatic uint16_t fscache_fsdef_netfs_get_aux(const void *cookie_netfs_data,\r\nvoid *buffer, uint16_t bufmax)\r\n{\r\nconst struct fscache_netfs *netfs = cookie_netfs_data;\r\nunsigned dlen;\r\n_enter("{%s.%u},", netfs->name, netfs->version);\r\ndlen = sizeof(uint32_t);\r\nif (dlen > bufmax)\r\nreturn 0;\r\nmemcpy(buffer, &netfs->version, dlen);\r\nreturn dlen;\r\n}\r\nstatic enum fscache_checkaux fscache_fsdef_netfs_check_aux(\r\nvoid *cookie_netfs_data,\r\nconst void *data,\r\nuint16_t datalen)\r\n{\r\nstruct fscache_netfs *netfs = cookie_netfs_data;\r\nuint32_t version;\r\n_enter("{%s},,%hu", netfs->name, datalen);\r\nif (datalen != sizeof(version)) {\r\n_leave(" = OBSOLETE [dl=%d v=%zu]", datalen, sizeof(version));\r\nreturn FSCACHE_CHECKAUX_OBSOLETE;\r\n}\r\nmemcpy(&version, data, sizeof(version));\r\nif (version != netfs->version) {\r\n_leave(" = OBSOLETE [ver=%x net=%x]", version, netfs->version);\r\nreturn FSCACHE_CHECKAUX_OBSOLETE;\r\n}\r\n_leave(" = OKAY");\r\nreturn FSCACHE_CHECKAUX_OKAY;\r\n}
