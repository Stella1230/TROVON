static int\r\nnv50_pior_tmds_ctor(struct nvkm_object *parent,\r\nstruct nvkm_object *engine,\r\nstruct nvkm_oclass *oclass, void *info, u32 index,\r\nstruct nvkm_object **pobject)\r\n{\r\nstruct nvkm_i2c *i2c = nvkm_i2c(parent);\r\nstruct nvkm_output *outp;\r\nint ret;\r\nret = nvkm_output_create(parent, engine, oclass, info, index, &outp);\r\n*pobject = nv_object(outp);\r\nif (ret)\r\nreturn ret;\r\noutp->edid = i2c->find_type(i2c, NV_I2C_TYPE_EXTDDC(outp->info.extdev));\r\nreturn 0;\r\n}\r\nstatic int\r\nnv50_pior_dp_pattern(struct nvkm_output_dp *outp, int pattern)\r\n{\r\nstruct nvkm_i2c_port *port = outp->base.edid;\r\nif (port && port->func->pattern)\r\nreturn port->func->pattern(port, pattern);\r\nreturn port ? 0 : -ENODEV;\r\n}\r\nstatic int\r\nnv50_pior_dp_lnk_pwr(struct nvkm_output_dp *outp, int nr)\r\n{\r\nreturn 0;\r\n}\r\nstatic int\r\nnv50_pior_dp_lnk_ctl(struct nvkm_output_dp *outp, int nr, int bw, bool ef)\r\n{\r\nstruct nvkm_i2c_port *port = outp->base.edid;\r\nif (port && port->func->lnk_ctl)\r\nreturn port->func->lnk_ctl(port, nr, bw, ef);\r\nreturn port ? 0 : -ENODEV;\r\n}\r\nstatic int\r\nnv50_pior_dp_drv_ctl(struct nvkm_output_dp *outp, int ln, int vs, int pe, int pc)\r\n{\r\nstruct nvkm_i2c_port *port = outp->base.edid;\r\nif (port && port->func->drv_ctl)\r\nreturn port->func->drv_ctl(port, ln, vs, pe);\r\nreturn port ? 0 : -ENODEV;\r\n}\r\nstatic int\r\nnv50_pior_dp_ctor(struct nvkm_object *parent,\r\nstruct nvkm_object *engine,\r\nstruct nvkm_oclass *oclass, void *info, u32 index,\r\nstruct nvkm_object **pobject)\r\n{\r\nstruct nvkm_i2c *i2c = nvkm_i2c(parent);\r\nstruct nvkm_output_dp *outp;\r\nint ret;\r\nret = nvkm_output_dp_create(parent, engine, oclass, info, index, &outp);\r\n*pobject = nv_object(outp);\r\nif (ret)\r\nreturn ret;\r\noutp->base.edid = i2c->find_type(i2c, NV_I2C_TYPE_EXTAUX(\r\noutp->base.info.extdev));\r\nreturn 0;\r\n}\r\nint\r\nnv50_pior_power(NV50_DISP_MTHD_V1)\r\n{\r\nconst u32 soff = outp->or * 0x800;\r\nunion {\r\nstruct nv50_disp_pior_pwr_v0 v0;\r\n} *args = data;\r\nu32 ctrl, type;\r\nint ret;\r\nnv_ioctl(object, "disp pior pwr size %d\n", size);\r\nif (nvif_unpack(args->v0, 0, 0, false)) {\r\nnv_ioctl(object, "disp pior pwr vers %d state %d type %x\n",\r\nargs->v0.version, args->v0.state, args->v0.type);\r\nif (args->v0.type > 0x0f)\r\nreturn -EINVAL;\r\nctrl = !!args->v0.state;\r\ntype = args->v0.type;\r\n} else\r\nreturn ret;\r\nnv_wait(priv, 0x61e004 + soff, 0x80000000, 0x00000000);\r\nnv_mask(priv, 0x61e004 + soff, 0x80000101, 0x80000000 | ctrl);\r\nnv_wait(priv, 0x61e004 + soff, 0x80000000, 0x00000000);\r\npriv->pior.type[outp->or] = type;\r\nreturn 0;\r\n}
