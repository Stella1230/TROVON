static void *rxrpc_call_seq_start(struct seq_file *seq, loff_t *_pos)\r\n{\r\nread_lock(&rxrpc_call_lock);\r\nreturn seq_list_start_head(&rxrpc_calls, *_pos);\r\n}\r\nstatic void *rxrpc_call_seq_next(struct seq_file *seq, void *v, loff_t *pos)\r\n{\r\nreturn seq_list_next(v, &rxrpc_calls, pos);\r\n}\r\nstatic void rxrpc_call_seq_stop(struct seq_file *seq, void *v)\r\n{\r\nread_unlock(&rxrpc_call_lock);\r\n}\r\nstatic int rxrpc_call_seq_show(struct seq_file *seq, void *v)\r\n{\r\nstruct rxrpc_transport *trans;\r\nstruct rxrpc_call *call;\r\nchar lbuff[4 + 4 + 4 + 4 + 5 + 1], rbuff[4 + 4 + 4 + 4 + 5 + 1];\r\nif (v == &rxrpc_calls) {\r\nseq_puts(seq,\r\n"Proto Local Remote "\r\n" SvID ConnID CallID End Use State Abort "\r\n" UserID\n");\r\nreturn 0;\r\n}\r\ncall = list_entry(v, struct rxrpc_call, link);\r\ntrans = call->conn->trans;\r\nsprintf(lbuff, "%pI4:%u",\r\n&trans->local->srx.transport.sin.sin_addr,\r\nntohs(trans->local->srx.transport.sin.sin_port));\r\nsprintf(rbuff, "%pI4:%u",\r\n&trans->peer->srx.transport.sin.sin_addr,\r\nntohs(trans->peer->srx.transport.sin.sin_port));\r\nseq_printf(seq,\r\n"UDP %-22.22s %-22.22s %4x %08x %08x %s %3u"\r\n" %-8.8s %08x %lx\n",\r\nlbuff,\r\nrbuff,\r\nntohs(call->conn->service_id),\r\nntohl(call->conn->cid),\r\nntohl(call->call_id),\r\ncall->conn->in_clientflag ? "Svc" : "Clt",\r\natomic_read(&call->usage),\r\nrxrpc_call_states[call->state],\r\ncall->abort_code,\r\ncall->user_call_ID);\r\nreturn 0;\r\n}\r\nstatic int rxrpc_call_seq_open(struct inode *inode, struct file *file)\r\n{\r\nreturn seq_open(file, &rxrpc_call_seq_ops);\r\n}\r\nstatic void *rxrpc_connection_seq_start(struct seq_file *seq, loff_t *_pos)\r\n{\r\nread_lock(&rxrpc_connection_lock);\r\nreturn seq_list_start_head(&rxrpc_connections, *_pos);\r\n}\r\nstatic void *rxrpc_connection_seq_next(struct seq_file *seq, void *v,\r\nloff_t *pos)\r\n{\r\nreturn seq_list_next(v, &rxrpc_connections, pos);\r\n}\r\nstatic void rxrpc_connection_seq_stop(struct seq_file *seq, void *v)\r\n{\r\nread_unlock(&rxrpc_connection_lock);\r\n}\r\nstatic int rxrpc_connection_seq_show(struct seq_file *seq, void *v)\r\n{\r\nstruct rxrpc_connection *conn;\r\nstruct rxrpc_transport *trans;\r\nchar lbuff[4 + 4 + 4 + 4 + 5 + 1], rbuff[4 + 4 + 4 + 4 + 5 + 1];\r\nif (v == &rxrpc_connections) {\r\nseq_puts(seq,\r\n"Proto Local Remote "\r\n" SvID ConnID Calls End Use State Key "\r\n" Serial ISerial\n"\r\n);\r\nreturn 0;\r\n}\r\nconn = list_entry(v, struct rxrpc_connection, link);\r\ntrans = conn->trans;\r\nsprintf(lbuff, "%pI4:%u",\r\n&trans->local->srx.transport.sin.sin_addr,\r\nntohs(trans->local->srx.transport.sin.sin_port));\r\nsprintf(rbuff, "%pI4:%u",\r\n&trans->peer->srx.transport.sin.sin_addr,\r\nntohs(trans->peer->srx.transport.sin.sin_port));\r\nseq_printf(seq,\r\n"UDP %-22.22s %-22.22s %4x %08x %08x %s %3u"\r\n" %s %08x %08x %08x\n",\r\nlbuff,\r\nrbuff,\r\nntohs(conn->service_id),\r\nntohl(conn->cid),\r\nconn->call_counter,\r\nconn->in_clientflag ? "Svc" : "Clt",\r\natomic_read(&conn->usage),\r\nrxrpc_conn_states[conn->state],\r\nkey_serial(conn->key),\r\natomic_read(&conn->serial),\r\natomic_read(&conn->hi_serial));\r\nreturn 0;\r\n}\r\nstatic int rxrpc_connection_seq_open(struct inode *inode, struct file *file)\r\n{\r\nreturn seq_open(file, &rxrpc_connection_seq_ops);\r\n}
