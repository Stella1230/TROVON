unsigned int *ltq_get_cp1_base(void)\r\n{\r\nif (!cp1_base)\r\npanic("no cp1 base was set\n");\r\nreturn cp1_base;\r\n}\r\nstatic int vmmc_probe(struct platform_device *pdev)\r\n{\r\n#define CP1_SIZE (1 << 20)\r\nint gpio_count;\r\ndma_addr_t dma;\r\ncp1_base =\r\n(void *) CPHYSADDR(dma_alloc_coherent(NULL, CP1_SIZE,\r\n&dma, GFP_ATOMIC));\r\ngpio_count = of_gpio_count(pdev->dev.of_node);\r\nwhile (gpio_count > 0) {\r\nenum of_gpio_flags flags;\r\nint gpio = of_get_gpio_flags(pdev->dev.of_node,\r\n--gpio_count, &flags);\r\nif (gpio_request(gpio, "vmmc-relay"))\r\ncontinue;\r\ndev_info(&pdev->dev, "requested GPIO %d\n", gpio);\r\ngpio_direction_output(gpio,\r\n(flags & OF_GPIO_ACTIVE_LOW) ? (0) : (1));\r\n}\r\ndev_info(&pdev->dev, "reserved %dMB at 0x%p", CP1_SIZE >> 20, cp1_base);\r\nreturn 0;\r\n}
