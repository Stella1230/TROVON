static void resource_clip(struct resource *res, resource_size_t start,\r\nresource_size_t end)\r\n{\r\nresource_size_t low = 0, high = 0;\r\nif (res->end < start || res->start > end)\r\nreturn;\r\nif (res->start < start)\r\nlow = start - res->start;\r\nif (res->end > end)\r\nhigh = res->end - end;\r\nif (low > high)\r\nres->end = start - 1;\r\nelse\r\nres->start = end + 1;\r\n}\r\nstatic void remove_e820_regions(struct resource *avail)\r\n{\r\nint i;\r\nstruct e820entry *entry;\r\nfor (i = 0; i < e820.nr_map; i++) {\r\nentry = &e820.map[i];\r\nresource_clip(avail, entry->addr,\r\nentry->addr + entry->size - 1);\r\n}\r\n}\r\nvoid arch_remove_reservations(struct resource *avail)\r\n{\r\nif (avail->flags & IORESOURCE_MEM) {\r\nresource_clip(avail, BIOS_ROM_BASE, BIOS_ROM_END);\r\nremove_e820_regions(avail);\r\n}\r\n}
