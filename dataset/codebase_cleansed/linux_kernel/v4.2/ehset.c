static int ehset_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nint ret = -EINVAL;\r\nstruct usb_device *dev = interface_to_usbdev(intf);\r\nstruct usb_device *hub_udev = dev->parent;\r\nstruct usb_device_descriptor *buf;\r\nu8 portnum = dev->portnum;\r\nu16 test_pid = le16_to_cpu(dev->descriptor.idProduct);\r\nswitch (test_pid) {\r\ncase TEST_SE0_NAK_PID:\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_TEST,\r\n(TEST_SE0_NAK << 8) | portnum,\r\nNULL, 0, 1000);\r\nbreak;\r\ncase TEST_J_PID:\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_TEST,\r\n(TEST_J << 8) | portnum,\r\nNULL, 0, 1000);\r\nbreak;\r\ncase TEST_K_PID:\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_TEST,\r\n(TEST_K << 8) | portnum,\r\nNULL, 0, 1000);\r\nbreak;\r\ncase TEST_PACKET_PID:\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_TEST,\r\n(TEST_PACKET << 8) | portnum,\r\nNULL, 0, 1000);\r\nbreak;\r\ncase TEST_HS_HOST_PORT_SUSPEND_RESUME:\r\nmsleep(15 * 1000);\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_SUSPEND, portnum,\r\nNULL, 0, 1000);\r\nif (ret < 0)\r\nbreak;\r\nmsleep(15 * 1000);\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_CLEAR_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_SUSPEND, portnum,\r\nNULL, 0, 1000);\r\nbreak;\r\ncase TEST_SINGLE_STEP_GET_DEV_DESC:\r\nmsleep(15 * 1000);\r\nbuf = kmalloc(USB_DT_DEVICE_SIZE, GFP_KERNEL);\r\nif (!buf)\r\nreturn -ENOMEM;\r\nret = usb_control_msg(dev, usb_rcvctrlpipe(dev, 0),\r\nUSB_REQ_GET_DESCRIPTOR, USB_DIR_IN,\r\nUSB_DT_DEVICE << 8, 0,\r\nbuf, USB_DT_DEVICE_SIZE,\r\nUSB_CTRL_GET_TIMEOUT);\r\nkfree(buf);\r\nbreak;\r\ncase TEST_SINGLE_STEP_SET_FEATURE:\r\nif (hub_udev != dev->bus->root_hub) {\r\ndev_err(&intf->dev, "SINGLE_STEP_SET_FEATURE test only supported on root hub\n");\r\nbreak;\r\n}\r\nret = usb_control_msg(hub_udev, usb_sndctrlpipe(hub_udev, 0),\r\nUSB_REQ_SET_FEATURE, USB_RT_PORT,\r\nUSB_PORT_FEAT_TEST,\r\n(6 << 8) | portnum,\r\nNULL, 0, 60 * 1000);\r\nbreak;\r\ndefault:\r\ndev_err(&intf->dev, "%s: unsupported PID: 0x%x\n",\r\n__func__, test_pid);\r\n}\r\nreturn (ret < 0) ? ret : 0;\r\n}\r\nstatic void ehset_disconnect(struct usb_interface *intf)\r\n{\r\n}
