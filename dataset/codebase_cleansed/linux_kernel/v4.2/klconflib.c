void\r\nformat_module_id(char *buffer, moduleid_t m, int fmt)\r\n{\r\nint rack, position;\r\nunsigned char brickchar;\r\nrack = MODULE_GET_RACK(m);\r\nbrickchar = MODULE_GET_BTCHAR(m);\r\nswitch (brickchar)\r\n{\r\ncase L1_BRICKTYPE_GA:\r\ncase L1_BRICKTYPE_OPUS_TIO:\r\nbrickchar = L1_BRICKTYPE_C;\r\nbreak;\r\ncase L1_BRICKTYPE_PX:\r\ncase L1_BRICKTYPE_PE:\r\ncase L1_BRICKTYPE_PA:\r\ncase L1_BRICKTYPE_SA:\r\nbrickchar = L1_BRICKTYPE_P;\r\nbreak;\r\ncase L1_BRICKTYPE_IX:\r\ncase L1_BRICKTYPE_IA:\r\nbrickchar = L1_BRICKTYPE_I;\r\nbreak;\r\n}\r\nposition = MODULE_GET_BPOS(m);\r\nif ((fmt == MODULE_FORMAT_BRIEF) || (fmt == MODULE_FORMAT_LCD)) {\r\n*buffer++ = '0' + RACK_GET_CLASS(rack);\r\n*buffer++ = '0' + RACK_GET_GROUP(rack);\r\n*buffer++ = '0' + RACK_GET_NUM(rack);\r\n*buffer++ = brickchar;\r\n}\r\nelse if (fmt == MODULE_FORMAT_LONG) {\r\nstrcpy(buffer, "rack" "/"); buffer += strlen(buffer);\r\n*buffer++ = '0' + RACK_GET_CLASS(rack);\r\n*buffer++ = '0' + RACK_GET_GROUP(rack);\r\n*buffer++ = '0' + RACK_GET_NUM(rack);\r\nstrcpy(buffer, "/" "bay" "/"); buffer += strlen(buffer);\r\n}\r\nif (position < 10)\r\n*buffer++ = '0';\r\nsprintf(buffer, "%d", position);\r\n}
