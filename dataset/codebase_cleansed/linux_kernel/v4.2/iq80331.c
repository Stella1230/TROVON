static void __init iq80331_timer_init(void)\r\n{\r\nif (*IOP3XX_ATURID >= 0xa)\r\niop_init_time(333000000);\r\nelse\r\niop_init_time(266000000);\r\n}\r\nstatic int __init\r\niq80331_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nint irq;\r\nif (slot == 1 && pin == 1) {\r\nirq = IRQ_IOP33X_XINT1;\r\n} else if (slot == 1 && pin == 2) {\r\nirq = IRQ_IOP33X_XINT2;\r\n} else if (slot == 1 && pin == 3) {\r\nirq = IRQ_IOP33X_XINT3;\r\n} else if (slot == 1 && pin == 4) {\r\nirq = IRQ_IOP33X_XINT0;\r\n} else if (slot == 2) {\r\nirq = IRQ_IOP33X_XINT2;\r\n} else {\r\nprintk(KERN_ERR "iq80331_pci_map_irq() called for unknown "\r\n"device PCI:%d:%d:%d\n", dev->bus->number,\r\nPCI_SLOT(dev->devfn), PCI_FUNC(dev->devfn));\r\nirq = -1;\r\n}\r\nreturn irq;\r\n}\r\nstatic int __init iq80331_pci_init(void)\r\n{\r\nif ((iop3xx_get_init_atu() == IOP3XX_INIT_ATU_ENABLE) &&\r\nmachine_is_iq80331())\r\npci_common_init(&iq80331_pci);\r\nreturn 0;\r\n}\r\nstatic void __init iq80331_init_machine(void)\r\n{\r\nplatform_device_register_simple("gpio-iop", 0,\r\niq80331_gpio_res,\r\nARRAY_SIZE(iq80331_gpio_res));\r\nplatform_device_register(&iop3xx_i2c0_device);\r\nplatform_device_register(&iop3xx_i2c1_device);\r\nplatform_device_register(&iop33x_uart0_device);\r\nplatform_device_register(&iop33x_uart1_device);\r\nplatform_device_register(&iq80331_flash_device);\r\nplatform_device_register(&iop3xx_dma_0_channel);\r\nplatform_device_register(&iop3xx_dma_1_channel);\r\nplatform_device_register(&iop3xx_aau_channel);\r\n}
