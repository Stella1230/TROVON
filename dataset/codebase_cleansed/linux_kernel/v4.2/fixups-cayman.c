int __init pcibios_map_platform_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nint result = -1;\r\nstruct slot_pin {\r\nint slot;\r\nint pin;\r\n} path[4];\r\nint i=0;\r\nwhile (dev->bus->number > 0) {\r\nslot = path[i].slot = PCI_SLOT(dev->devfn);\r\npin = path[i].pin = pci_swizzle_interrupt_pin(dev, pin);\r\ndev = dev->bus->self;\r\ni++;\r\nif (i > 3) panic("PCI path to root bus too long!\n");\r\n}\r\nslot = PCI_SLOT(dev->devfn);\r\nif ((slot < 3) || (i == 0)) {\r\nresult = IRQ_INTA + pci_swizzle_interrupt_pin(dev, pin) - 1;\r\n} else {\r\ni--;\r\nslot = path[i].slot;\r\npin = path[i].pin;\r\nif (slot > 0) {\r\npanic("PCI expansion bus device found - not handled!\n");\r\n} else {\r\nif (i > 0) {\r\ni--;\r\nslot = path[i].slot;\r\npin = path[i].pin;\r\nresult = IRQ_P2INTA + (pin - 1);\r\n} else {\r\nresult = -1;\r\n}\r\n}\r\n}\r\nreturn result;\r\n}
