static int snd_seq_call_port_info_ioctl(struct snd_seq_client *client, unsigned int cmd,\r\nstruct snd_seq_port_info32 __user *data32)\r\n{\r\nint err = -EFAULT;\r\nstruct snd_seq_port_info *data;\r\nmm_segment_t fs;\r\ndata = memdup_user(data32, sizeof(*data32));\r\nif (IS_ERR(data))\r\nreturn PTR_ERR(data);\r\nif (get_user(data->flags, &data32->flags) ||\r\nget_user(data->time_queue, &data32->time_queue))\r\ngoto error;\r\ndata->kernel = NULL;\r\nfs = snd_enter_user();\r\nerr = snd_seq_do_ioctl(client, cmd, data);\r\nsnd_leave_user(fs);\r\nif (err < 0)\r\ngoto error;\r\nif (copy_to_user(data32, data, sizeof(*data32)) ||\r\nput_user(data->flags, &data32->flags) ||\r\nput_user(data->time_queue, &data32->time_queue))\r\nerr = -EFAULT;\r\nerror:\r\nkfree(data);\r\nreturn err;\r\n}\r\nstatic long snd_seq_ioctl_compat(struct file *file, unsigned int cmd, unsigned long arg)\r\n{\r\nstruct snd_seq_client *client = file->private_data;\r\nvoid __user *argp = compat_ptr(arg);\r\nif (snd_BUG_ON(!client))\r\nreturn -ENXIO;\r\nswitch (cmd) {\r\ncase SNDRV_SEQ_IOCTL_PVERSION:\r\ncase SNDRV_SEQ_IOCTL_CLIENT_ID:\r\ncase SNDRV_SEQ_IOCTL_SYSTEM_INFO:\r\ncase SNDRV_SEQ_IOCTL_GET_CLIENT_INFO:\r\ncase SNDRV_SEQ_IOCTL_SET_CLIENT_INFO:\r\ncase SNDRV_SEQ_IOCTL_SUBSCRIBE_PORT:\r\ncase SNDRV_SEQ_IOCTL_UNSUBSCRIBE_PORT:\r\ncase SNDRV_SEQ_IOCTL_CREATE_QUEUE:\r\ncase SNDRV_SEQ_IOCTL_DELETE_QUEUE:\r\ncase SNDRV_SEQ_IOCTL_GET_QUEUE_INFO:\r\ncase SNDRV_SEQ_IOCTL_SET_QUEUE_INFO:\r\ncase SNDRV_SEQ_IOCTL_GET_NAMED_QUEUE:\r\ncase SNDRV_SEQ_IOCTL_GET_QUEUE_STATUS:\r\ncase SNDRV_SEQ_IOCTL_GET_QUEUE_TEMPO:\r\ncase SNDRV_SEQ_IOCTL_SET_QUEUE_TEMPO:\r\ncase SNDRV_SEQ_IOCTL_GET_QUEUE_TIMER:\r\ncase SNDRV_SEQ_IOCTL_SET_QUEUE_TIMER:\r\ncase SNDRV_SEQ_IOCTL_GET_QUEUE_CLIENT:\r\ncase SNDRV_SEQ_IOCTL_SET_QUEUE_CLIENT:\r\ncase SNDRV_SEQ_IOCTL_GET_CLIENT_POOL:\r\ncase SNDRV_SEQ_IOCTL_SET_CLIENT_POOL:\r\ncase SNDRV_SEQ_IOCTL_REMOVE_EVENTS:\r\ncase SNDRV_SEQ_IOCTL_QUERY_SUBS:\r\ncase SNDRV_SEQ_IOCTL_GET_SUBSCRIPTION:\r\ncase SNDRV_SEQ_IOCTL_QUERY_NEXT_CLIENT:\r\ncase SNDRV_SEQ_IOCTL_RUNNING_MODE:\r\nreturn snd_seq_do_ioctl(client, cmd, argp);\r\ncase SNDRV_SEQ_IOCTL_CREATE_PORT32:\r\nreturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_CREATE_PORT, argp);\r\ncase SNDRV_SEQ_IOCTL_DELETE_PORT32:\r\nreturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_DELETE_PORT, argp);\r\ncase SNDRV_SEQ_IOCTL_GET_PORT_INFO32:\r\nreturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_GET_PORT_INFO, argp);\r\ncase SNDRV_SEQ_IOCTL_SET_PORT_INFO32:\r\nreturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_SET_PORT_INFO, argp);\r\ncase SNDRV_SEQ_IOCTL_QUERY_NEXT_PORT32:\r\nreturn snd_seq_call_port_info_ioctl(client, SNDRV_SEQ_IOCTL_QUERY_NEXT_PORT, argp);\r\n}\r\nreturn -ENOIOCTLCMD;\r\n}
