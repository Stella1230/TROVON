static void vgpio_set(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\nif (value)\r\n__raw_writew(PBC_BCTRL1_LCDON, PBC_BCTRL1_SET_REG);\r\nelse\r\n__raw_writew(PBC_BCTRL1_LCDON, PBC_BCTRL1_CLEAR_REG);\r\n}\r\nstatic int vgpio_dir_out(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __init mx27ads_regulator_init(void)\r\n{\r\nstruct gpio_chip *vchip;\r\nvchip = kzalloc(sizeof(*vchip), GFP_KERNEL);\r\nvchip->owner = THIS_MODULE;\r\nvchip->label = "LCD";\r\nvchip->base = MX27ADS_LCD_GPIO;\r\nvchip->ngpio = 1;\r\nvchip->direction_output = vgpio_dir_out;\r\nvchip->set = vgpio_set;\r\ngpiochip_add(vchip);\r\nplatform_device_register_data(NULL, "reg-fixed-voltage",\r\nPLATFORM_DEVID_AUTO,\r\n&mx27ads_lcd_regulator_pdata,\r\nsizeof(mx27ads_lcd_regulator_pdata));\r\n}\r\nstatic int mx27ads_sdhc1_init(struct device *dev, irq_handler_t detect_irq,\r\nvoid *data)\r\n{\r\nreturn request_irq(gpio_to_irq(IMX_GPIO_NR(5, 21)), detect_irq,\r\nIRQF_TRIGGER_RISING, "sdhc1-card-detect", data);\r\n}\r\nstatic int mx27ads_sdhc2_init(struct device *dev, irq_handler_t detect_irq,\r\nvoid *data)\r\n{\r\nreturn request_irq(gpio_to_irq(IMX_GPIO_NR(2, 7)), detect_irq,\r\nIRQF_TRIGGER_RISING, "sdhc2-card-detect", data);\r\n}\r\nstatic void mx27ads_sdhc1_exit(struct device *dev, void *data)\r\n{\r\nfree_irq(gpio_to_irq(IMX_GPIO_NR(5, 21)), data);\r\n}\r\nstatic void mx27ads_sdhc2_exit(struct device *dev, void *data)\r\n{\r\nfree_irq(gpio_to_irq(IMX_GPIO_NR(2, 7)), data);\r\n}\r\nstatic void __init mx27ads_board_init(void)\r\n{\r\nimx27_soc_init();\r\nmxc_gpio_setup_multiple_pins(mx27ads_pins, ARRAY_SIZE(mx27ads_pins),\r\n"mx27ads");\r\nimx27_add_imx_uart0(&uart_pdata);\r\nimx27_add_imx_uart1(&uart_pdata);\r\nimx27_add_imx_uart2(&uart_pdata);\r\nimx27_add_imx_uart3(&uart_pdata);\r\nimx27_add_imx_uart4(&uart_pdata);\r\nimx27_add_imx_uart5(&uart_pdata);\r\nimx27_add_mxc_nand(&mx27ads_nand_board_info);\r\ni2c_register_board_info(1, mx27ads_i2c_devices,\r\nARRAY_SIZE(mx27ads_i2c_devices));\r\nimx27_add_imx_i2c(1, &mx27ads_i2c1_data);\r\nmx27ads_regulator_init();\r\nimx27_add_imx_fb(&mx27ads_fb_data);\r\nimx27_add_mxc_mmc(0, &sdhc1_pdata);\r\nimx27_add_mxc_mmc(1, &sdhc2_pdata);\r\nimx27_add_fec(NULL);\r\nplatform_add_devices(platform_devices, ARRAY_SIZE(platform_devices));\r\nimx27_add_mxc_w1();\r\n}\r\nstatic void __init mx27ads_timer_init(void)\r\n{\r\nunsigned long fref = 26000000;\r\nif ((__raw_readw(PBC_VERSION_REG) & CKIH_27MHZ_BIT_SET) == 0)\r\nfref = 27000000;\r\nmx27_clocks_init(fref);\r\n}\r\nstatic void __init mx27ads_map_io(void)\r\n{\r\nmx27_map_io();\r\niotable_init(mx27ads_io_desc, ARRAY_SIZE(mx27ads_io_desc));\r\n}
