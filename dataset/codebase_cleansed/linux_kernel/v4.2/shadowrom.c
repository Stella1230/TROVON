static u32\r\nprom_read(void *data, u32 offset, u32 length, struct nvkm_bios *bios)\r\n{\r\nu32 i;\r\nif (offset + length <= 0x00100000) {\r\nfor (i = offset; i < offset + length; i += 4)\r\n*(u32 *)&bios->data[i] = nv_rd32(bios, 0x300000 + i);\r\nreturn length;\r\n}\r\nreturn 0;\r\n}\r\nstatic void\r\nprom_fini(void *data)\r\n{\r\nstruct nvkm_bios *bios = data;\r\nif (nv_device(bios)->card_type < NV_50)\r\nnv_mask(bios, 0x001850, 0x00000001, 0x00000001);\r\nelse\r\nnv_mask(bios, 0x088050, 0x00000001, 0x00000001);\r\n}\r\nstatic void *\r\nprom_init(struct nvkm_bios *bios, const char *name)\r\n{\r\nif (nv_device(bios)->card_type < NV_50) {\r\nif (nv_device(bios)->card_type == NV_40 &&\r\nnv_device(bios)->chipset >= 0x4c)\r\nreturn ERR_PTR(-ENODEV);\r\nnv_mask(bios, 0x001850, 0x00000001, 0x00000000);\r\n} else {\r\nnv_mask(bios, 0x088050, 0x00000001, 0x00000000);\r\n}\r\nreturn bios;\r\n}
