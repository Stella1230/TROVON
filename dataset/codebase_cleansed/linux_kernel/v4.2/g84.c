static int\r\ng84_cipher_object_ctor(struct nvkm_object *parent,\r\nstruct nvkm_object *engine,\r\nstruct nvkm_oclass *oclass, void *data, u32 size,\r\nstruct nvkm_object **pobject)\r\n{\r\nstruct nvkm_gpuobj *obj;\r\nint ret;\r\nret = nvkm_gpuobj_create(parent, engine, oclass, 0, parent,\r\n16, 16, 0, &obj);\r\n*pobject = nv_object(obj);\r\nif (ret)\r\nreturn ret;\r\nnv_wo32(obj, 0x00, nv_mclass(obj));\r\nnv_wo32(obj, 0x04, 0x00000000);\r\nnv_wo32(obj, 0x08, 0x00000000);\r\nnv_wo32(obj, 0x0c, 0x00000000);\r\nreturn 0;\r\n}\r\nstatic void\r\ng84_cipher_intr(struct nvkm_subdev *subdev)\r\n{\r\nstruct nvkm_fifo *pfifo = nvkm_fifo(subdev);\r\nstruct nvkm_engine *engine = nv_engine(subdev);\r\nstruct nvkm_object *engctx;\r\nstruct g84_cipher_priv *priv = (void *)subdev;\r\nu32 stat = nv_rd32(priv, 0x102130);\r\nu32 mthd = nv_rd32(priv, 0x102190);\r\nu32 data = nv_rd32(priv, 0x102194);\r\nu32 inst = nv_rd32(priv, 0x102188) & 0x7fffffff;\r\nint chid;\r\nengctx = nvkm_engctx_get(engine, inst);\r\nchid = pfifo->chid(pfifo, engctx);\r\nif (stat) {\r\nnv_error(priv, "%s", "");\r\nnvkm_bitfield_print(g84_cipher_intr_mask, stat);\r\npr_cont(" ch %d [0x%010llx %s] mthd 0x%04x data 0x%08x\n",\r\nchid, (u64)inst << 12, nvkm_client_name(engctx),\r\nmthd, data);\r\n}\r\nnv_wr32(priv, 0x102130, stat);\r\nnv_wr32(priv, 0x10200c, 0x10);\r\nnvkm_engctx_put(engctx);\r\n}\r\nstatic int\r\ng84_cipher_ctor(struct nvkm_object *parent, struct nvkm_object *engine,\r\nstruct nvkm_oclass *oclass, void *data, u32 size,\r\nstruct nvkm_object **pobject)\r\n{\r\nstruct g84_cipher_priv *priv;\r\nint ret;\r\nret = nvkm_engine_create(parent, engine, oclass, true,\r\n"PCIPHER", "cipher", &priv);\r\n*pobject = nv_object(priv);\r\nif (ret)\r\nreturn ret;\r\nnv_subdev(priv)->unit = 0x00004000;\r\nnv_subdev(priv)->intr = g84_cipher_intr;\r\nnv_engine(priv)->cclass = &g84_cipher_cclass;\r\nnv_engine(priv)->sclass = g84_cipher_sclass;\r\nreturn 0;\r\n}\r\nstatic int\r\ng84_cipher_init(struct nvkm_object *object)\r\n{\r\nstruct g84_cipher_priv *priv = (void *)object;\r\nint ret;\r\nret = nvkm_engine_init(&priv->base);\r\nif (ret)\r\nreturn ret;\r\nnv_wr32(priv, 0x102130, 0xffffffff);\r\nnv_wr32(priv, 0x102140, 0xffffffbf);\r\nnv_wr32(priv, 0x10200c, 0x00000010);\r\nreturn 0;\r\n}
