static inline struct lpc32xx_gpio_chip *to_lpc32xx_gpio(\r\nstruct gpio_chip *gpc)\r\n{\r\nreturn container_of(gpc, struct lpc32xx_gpio_chip, chip);\r\n}\r\nstatic void __set_gpio_dir_p012(struct lpc32xx_gpio_chip *group,\r\nunsigned pin, int input)\r\n{\r\nif (input)\r\n__raw_writel(GPIO012_PIN_TO_BIT(pin),\r\ngroup->gpio_grp->dir_clr);\r\nelse\r\n__raw_writel(GPIO012_PIN_TO_BIT(pin),\r\ngroup->gpio_grp->dir_set);\r\n}\r\nstatic void __set_gpio_dir_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin, int input)\r\n{\r\nu32 u = GPIO3_PIN_TO_BIT(pin);\r\nif (input)\r\n__raw_writel(u, group->gpio_grp->dir_clr);\r\nelse\r\n__raw_writel(u, group->gpio_grp->dir_set);\r\n}\r\nstatic void __set_gpio_level_p012(struct lpc32xx_gpio_chip *group,\r\nunsigned pin, int high)\r\n{\r\nif (high)\r\n__raw_writel(GPIO012_PIN_TO_BIT(pin),\r\ngroup->gpio_grp->outp_set);\r\nelse\r\n__raw_writel(GPIO012_PIN_TO_BIT(pin),\r\ngroup->gpio_grp->outp_clr);\r\n}\r\nstatic void __set_gpio_level_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin, int high)\r\n{\r\nu32 u = GPIO3_PIN_TO_BIT(pin);\r\nif (high)\r\n__raw_writel(u, group->gpio_grp->outp_set);\r\nelse\r\n__raw_writel(u, group->gpio_grp->outp_clr);\r\n}\r\nstatic void __set_gpo_level_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin, int high)\r\n{\r\nif (high)\r\n__raw_writel(GPO3_PIN_TO_BIT(pin), group->gpio_grp->outp_set);\r\nelse\r\n__raw_writel(GPO3_PIN_TO_BIT(pin), group->gpio_grp->outp_clr);\r\n}\r\nstatic int __get_gpio_state_p012(struct lpc32xx_gpio_chip *group,\r\nunsigned pin)\r\n{\r\nreturn GPIO012_PIN_IN_SEL(__raw_readl(group->gpio_grp->inp_state),\r\npin);\r\n}\r\nstatic int __get_gpio_state_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin)\r\n{\r\nint state = __raw_readl(group->gpio_grp->inp_state);\r\nreturn GPIO3_PIN_IN_SEL(state, pin);\r\n}\r\nstatic int __get_gpi_state_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin)\r\n{\r\nreturn GPI3_PIN_IN_SEL(__raw_readl(group->gpio_grp->inp_state), pin);\r\n}\r\nstatic int __get_gpo_state_p3(struct lpc32xx_gpio_chip *group,\r\nunsigned pin)\r\n{\r\nreturn GPO3_PIN_IN_SEL(__raw_readl(group->gpio_grp->outp_state), pin);\r\n}\r\nstatic int lpc32xx_gpio_dir_input_p012(struct gpio_chip *chip,\r\nunsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_dir_p012(group, pin, 1);\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_gpio_dir_input_p3(struct gpio_chip *chip,\r\nunsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_dir_p3(group, pin, 1);\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_gpio_dir_in_always(struct gpio_chip *chip,\r\nunsigned pin)\r\n{\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_gpio_get_value_p012(struct gpio_chip *chip, unsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\nreturn __get_gpio_state_p012(group, pin);\r\n}\r\nstatic int lpc32xx_gpio_get_value_p3(struct gpio_chip *chip, unsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\nreturn __get_gpio_state_p3(group, pin);\r\n}\r\nstatic int lpc32xx_gpi_get_value(struct gpio_chip *chip, unsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\nreturn __get_gpi_state_p3(group, pin);\r\n}\r\nstatic int lpc32xx_gpio_dir_output_p012(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_level_p012(group, pin, value);\r\n__set_gpio_dir_p012(group, pin, 0);\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_gpio_dir_output_p3(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_level_p3(group, pin, value);\r\n__set_gpio_dir_p3(group, pin, 0);\r\nreturn 0;\r\n}\r\nstatic int lpc32xx_gpio_dir_out_always(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpo_level_p3(group, pin, value);\r\nreturn 0;\r\n}\r\nstatic void lpc32xx_gpio_set_value_p012(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_level_p012(group, pin, value);\r\n}\r\nstatic void lpc32xx_gpio_set_value_p3(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpio_level_p3(group, pin, value);\r\n}\r\nstatic void lpc32xx_gpo_set_value(struct gpio_chip *chip, unsigned pin,\r\nint value)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\n__set_gpo_level_p3(group, pin, value);\r\n}\r\nstatic int lpc32xx_gpo_get_value(struct gpio_chip *chip, unsigned pin)\r\n{\r\nstruct lpc32xx_gpio_chip *group = to_lpc32xx_gpio(chip);\r\nreturn __get_gpo_state_p3(group, pin);\r\n}\r\nstatic int lpc32xx_gpio_request(struct gpio_chip *chip, unsigned pin)\r\n{\r\nif (pin < chip->ngpio)\r\nreturn 0;\r\nreturn -EINVAL;\r\n}\r\nstatic int lpc32xx_gpio_to_irq_p01(struct gpio_chip *chip, unsigned offset)\r\n{\r\nreturn IRQ_LPC32XX_P0_P1_IRQ;\r\n}\r\nstatic int lpc32xx_gpio_to_irq_gpio_p3(struct gpio_chip *chip, unsigned offset)\r\n{\r\nif (offset < ARRAY_SIZE(lpc32xx_gpio_to_irq_gpio_p3_table))\r\nreturn lpc32xx_gpio_to_irq_gpio_p3_table[offset];\r\nreturn -ENXIO;\r\n}\r\nstatic int lpc32xx_gpio_to_irq_gpi_p3(struct gpio_chip *chip, unsigned offset)\r\n{\r\nif (offset < ARRAY_SIZE(lpc32xx_gpio_to_irq_gpi_p3_table))\r\nreturn lpc32xx_gpio_to_irq_gpi_p3_table[offset];\r\nreturn -ENXIO;\r\n}\r\nstatic int lpc32xx_of_xlate(struct gpio_chip *gc,\r\nconst struct of_phandle_args *gpiospec, u32 *flags)\r\n{\r\nu32 bank = gpiospec->args[0];\r\nif ((bank >= ARRAY_SIZE(lpc32xx_gpiochip) ||\r\n(gc != &lpc32xx_gpiochip[bank].chip)))\r\nreturn -EINVAL;\r\nif (flags)\r\n*flags = gpiospec->args[2];\r\nreturn gpiospec->args[1];\r\n}\r\nstatic int lpc32xx_gpio_probe(struct platform_device *pdev)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(lpc32xx_gpiochip); i++) {\r\nif (pdev->dev.of_node) {\r\nlpc32xx_gpiochip[i].chip.of_xlate = lpc32xx_of_xlate;\r\nlpc32xx_gpiochip[i].chip.of_gpio_n_cells = 3;\r\nlpc32xx_gpiochip[i].chip.of_node = pdev->dev.of_node;\r\n}\r\ngpiochip_add(&lpc32xx_gpiochip[i].chip);\r\n}\r\nreturn 0;\r\n}
