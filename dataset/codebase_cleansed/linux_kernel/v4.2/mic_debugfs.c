static int mic_intr_test(struct seq_file *s, void *unused)\r\n{\r\nstruct mic_driver *mdrv = s->private;\r\nstruct mic_device *mdev = &mdrv->mdev;\r\nmic_send_intr(mdev, 0);\r\nmsleep(1000);\r\nmic_send_intr(mdev, 1);\r\nmsleep(1000);\r\nmic_send_intr(mdev, 2);\r\nmsleep(1000);\r\nmic_send_intr(mdev, 3);\r\nmsleep(1000);\r\nreturn 0;\r\n}\r\nstatic int mic_intr_test_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, mic_intr_test, inode->i_private);\r\n}\r\nstatic int mic_intr_test_release(struct inode *inode, struct file *file)\r\n{\r\nreturn single_release(inode, file);\r\n}\r\nvoid __init mic_create_card_debug_dir(struct mic_driver *mdrv)\r\n{\r\nstruct dentry *d;\r\nif (!mic_dbg)\r\nreturn;\r\nmdrv->dbg_dir = debugfs_create_dir(mdrv->name, mic_dbg);\r\nif (!mdrv->dbg_dir) {\r\ndev_err(mdrv->dev, "Cant create dbg_dir %s\n", mdrv->name);\r\nreturn;\r\n}\r\nd = debugfs_create_file("intr_test", 0444, mdrv->dbg_dir,\r\nmdrv, &intr_test_ops);\r\nif (!d) {\r\ndev_err(mdrv->dev,\r\n"Cant create dbg intr_test %s\n", mdrv->name);\r\nreturn;\r\n}\r\n}\r\nvoid mic_delete_card_debug_dir(struct mic_driver *mdrv)\r\n{\r\nif (!mdrv->dbg_dir)\r\nreturn;\r\ndebugfs_remove_recursive(mdrv->dbg_dir);\r\n}\r\nvoid __init mic_init_card_debugfs(void)\r\n{\r\nmic_dbg = debugfs_create_dir(KBUILD_MODNAME, NULL);\r\nif (!mic_dbg)\r\npr_err("can't create debugfs dir\n");\r\n}\r\nvoid mic_exit_card_debugfs(void)\r\n{\r\ndebugfs_remove(mic_dbg);\r\n}
