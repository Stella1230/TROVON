static ssize_t pccard_show_type(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!(s->state & SOCKET_PRESENT))\r\nreturn -ENODEV;\r\nif (s->state & SOCKET_CARDBUS)\r\nreturn sprintf(buf, "32-bit\n");\r\nreturn sprintf(buf, "16-bit\n");\r\n}\r\nstatic ssize_t pccard_show_voltage(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!(s->state & SOCKET_PRESENT))\r\nreturn -ENODEV;\r\nif (s->socket.Vcc)\r\nreturn sprintf(buf, "%d.%dV\n", s->socket.Vcc / 10,\r\ns->socket.Vcc % 10);\r\nreturn sprintf(buf, "X.XV\n");\r\n}\r\nstatic ssize_t pccard_show_vpp(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!(s->state & SOCKET_PRESENT))\r\nreturn -ENODEV;\r\nreturn sprintf(buf, "%d.%dV\n", s->socket.Vpp / 10, s->socket.Vpp % 10);\r\n}\r\nstatic ssize_t pccard_show_vcc(struct device *dev, struct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!(s->state & SOCKET_PRESENT))\r\nreturn -ENODEV;\r\nreturn sprintf(buf, "%d.%dV\n", s->socket.Vcc / 10, s->socket.Vcc % 10);\r\n}\r\nstatic ssize_t pccard_store_insert(struct device *dev, struct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!count)\r\nreturn -EINVAL;\r\npcmcia_parse_uevents(s, PCMCIA_UEVENT_INSERT);\r\nreturn count;\r\n}\r\nstatic ssize_t pccard_show_card_pm_state(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nreturn sprintf(buf, "%s\n", s->state & SOCKET_SUSPEND ? "off" : "on");\r\n}\r\nstatic ssize_t pccard_store_card_pm_state(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nssize_t ret = count;\r\nif (!count)\r\nreturn -EINVAL;\r\nif (!strncmp(buf, "off", 3))\r\npcmcia_parse_uevents(s, PCMCIA_UEVENT_SUSPEND);\r\nelse {\r\nif (!strncmp(buf, "on", 2))\r\npcmcia_parse_uevents(s, PCMCIA_UEVENT_RESUME);\r\nelse\r\nret = -EINVAL;\r\n}\r\nreturn ret;\r\n}\r\nstatic ssize_t pccard_store_eject(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!count)\r\nreturn -EINVAL;\r\npcmcia_parse_uevents(s, PCMCIA_UEVENT_EJECT);\r\nreturn count;\r\n}\r\nstatic ssize_t pccard_show_irq_mask(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nreturn sprintf(buf, "0x%04x\n", s->irq_mask);\r\n}\r\nstatic ssize_t pccard_store_irq_mask(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nssize_t ret;\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nu32 mask;\r\nif (!count)\r\nreturn -EINVAL;\r\nret = sscanf(buf, "0x%x\n", &mask);\r\nif (ret == 1) {\r\nmutex_lock(&s->ops_mutex);\r\ns->irq_mask &= mask;\r\nmutex_unlock(&s->ops_mutex);\r\nret = 0;\r\n}\r\nreturn ret ? ret : count;\r\n}\r\nstatic ssize_t pccard_show_resource(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nreturn sprintf(buf, "%s\n", s->resource_setup_done ? "yes" : "no");\r\n}\r\nstatic ssize_t pccard_store_resource(struct device *dev,\r\nstruct device_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct pcmcia_socket *s = to_socket(dev);\r\nif (!count)\r\nreturn -EINVAL;\r\nmutex_lock(&s->ops_mutex);\r\nif (!s->resource_setup_done)\r\ns->resource_setup_done = 1;\r\nmutex_unlock(&s->ops_mutex);\r\npcmcia_parse_uevents(s, PCMCIA_UEVENT_REQUERY);\r\nreturn count;\r\n}\r\nint pccard_sysfs_add_socket(struct device *dev)\r\n{\r\nreturn sysfs_create_group(&dev->kobj, &socket_attrs);\r\n}\r\nvoid pccard_sysfs_remove_socket(struct device *dev)\r\n{\r\nsysfs_remove_group(&dev->kobj, &socket_attrs);\r\n}
