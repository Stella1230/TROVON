static void nft_redir_ipv4_eval(const struct nft_expr *expr,\r\nstruct nft_regs *regs,\r\nconst struct nft_pktinfo *pkt)\r\n{\r\nstruct nft_redir *priv = nft_expr_priv(expr);\r\nstruct nf_nat_ipv4_multi_range_compat mr;\r\nmemset(&mr, 0, sizeof(mr));\r\nif (priv->sreg_proto_min) {\r\nmr.range[0].min.all =\r\n*(__be16 *)&regs->data[priv->sreg_proto_min];\r\nmr.range[0].max.all =\r\n*(__be16 *)&regs->data[priv->sreg_proto_max];\r\nmr.range[0].flags |= NF_NAT_RANGE_PROTO_SPECIFIED;\r\n}\r\nmr.range[0].flags |= priv->flags;\r\nregs->verdict.code = nf_nat_redirect_ipv4(pkt->skb, &mr,\r\npkt->ops->hooknum);\r\n}\r\nstatic int __init nft_redir_ipv4_module_init(void)\r\n{\r\nreturn nft_register_expr(&nft_redir_ipv4_type);\r\n}\r\nstatic void __exit nft_redir_ipv4_module_exit(void)\r\n{\r\nnft_unregister_expr(&nft_redir_ipv4_type);\r\n}
