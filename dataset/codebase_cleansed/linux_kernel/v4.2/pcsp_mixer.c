static int pcsp_enable_info(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_BOOLEAN;\r\nuinfo->count = 1;\r\nuinfo->value.integer.min = 0;\r\nuinfo->value.integer.max = 1;\r\nreturn 0;\r\n}\r\nstatic int pcsp_enable_get(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nucontrol->value.integer.value[0] = chip->enable;\r\nreturn 0;\r\n}\r\nstatic int pcsp_enable_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nint changed = 0;\r\nint enab = ucontrol->value.integer.value[0];\r\nif (enab != chip->enable) {\r\nchip->enable = enab;\r\nchanged = 1;\r\n}\r\nreturn changed;\r\n}\r\nstatic int pcsp_treble_info(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_info *uinfo)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_ENUMERATED;\r\nuinfo->count = 1;\r\nuinfo->value.enumerated.items = chip->max_treble + 1;\r\nif (uinfo->value.enumerated.item > chip->max_treble)\r\nuinfo->value.enumerated.item = chip->max_treble;\r\nsprintf(uinfo->value.enumerated.name, "%lu",\r\n(unsigned long)PCSP_CALC_RATE(uinfo->value.enumerated.item));\r\nreturn 0;\r\n}\r\nstatic int pcsp_treble_get(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nucontrol->value.enumerated.item[0] = chip->treble;\r\nreturn 0;\r\n}\r\nstatic int pcsp_treble_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nint changed = 0;\r\nint treble = ucontrol->value.enumerated.item[0];\r\nif (treble != chip->treble) {\r\nchip->treble = treble;\r\n#if PCSP_DEBUG\r\nprintk(KERN_INFO "PCSP: rate set to %li\n", PCSP_RATE());\r\n#endif\r\nchanged = 1;\r\n}\r\nreturn changed;\r\n}\r\nstatic int pcsp_pcspkr_info(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_info *uinfo)\r\n{\r\nuinfo->type = SNDRV_CTL_ELEM_TYPE_BOOLEAN;\r\nuinfo->count = 1;\r\nuinfo->value.integer.min = 0;\r\nuinfo->value.integer.max = 1;\r\nreturn 0;\r\n}\r\nstatic int pcsp_pcspkr_get(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nucontrol->value.integer.value[0] = chip->pcspkr;\r\nreturn 0;\r\n}\r\nstatic int pcsp_pcspkr_put(struct snd_kcontrol *kcontrol,\r\nstruct snd_ctl_elem_value *ucontrol)\r\n{\r\nstruct snd_pcsp *chip = snd_kcontrol_chip(kcontrol);\r\nint changed = 0;\r\nint spkr = ucontrol->value.integer.value[0];\r\nif (spkr != chip->pcspkr) {\r\nchip->pcspkr = spkr;\r\nchanged = 1;\r\n}\r\nreturn changed;\r\n}\r\nstatic int snd_pcsp_ctls_add(struct snd_pcsp *chip,\r\nstruct snd_kcontrol_new *ctls, int num)\r\n{\r\nint i, err;\r\nstruct snd_card *card = chip->card;\r\nfor (i = 0; i < num; i++) {\r\nerr = snd_ctl_add(card, snd_ctl_new1(ctls + i, chip));\r\nif (err < 0)\r\nreturn err;\r\n}\r\nreturn 0;\r\n}\r\nint snd_pcsp_new_mixer(struct snd_pcsp *chip, int nopcm)\r\n{\r\nint err;\r\nstruct snd_card *card = chip->card;\r\nif (!nopcm) {\r\nerr = snd_pcsp_ctls_add(chip, snd_pcsp_controls_pcm,\r\nARRAY_SIZE(snd_pcsp_controls_pcm));\r\nif (err < 0)\r\nreturn err;\r\n}\r\nerr = snd_pcsp_ctls_add(chip, snd_pcsp_controls_spkr,\r\nARRAY_SIZE(snd_pcsp_controls_spkr));\r\nif (err < 0)\r\nreturn err;\r\nstrcpy(card->mixername, "PC-Speaker");\r\nreturn 0;\r\n}
