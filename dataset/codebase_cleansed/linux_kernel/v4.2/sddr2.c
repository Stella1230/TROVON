static inline int\r\nramxlat(const struct ramxlat *xlat, int id)\r\n{\r\nwhile (xlat->id >= 0) {\r\nif (xlat->id == id)\r\nreturn xlat->enc;\r\nxlat++;\r\n}\r\nreturn -EINVAL;\r\n}\r\nint\r\nnvkm_sddr2_calc(struct nvkm_ram *ram)\r\n{\r\nint CL, WR, DLL = 0, ODT = 0;\r\nswitch (ram->next->bios.timing_ver) {\r\ncase 0x10:\r\nCL = ram->next->bios.timing_10_CL;\r\nWR = ram->next->bios.timing_10_WR;\r\nDLL = !ram->next->bios.ramcfg_10_DLLoff;\r\nODT = ram->next->bios.timing_10_ODT & 3;\r\nbreak;\r\ncase 0x20:\r\nCL = (ram->next->bios.timing[1] & 0x0000001f);\r\nWR = (ram->next->bios.timing[2] & 0x007f0000) >> 16;\r\nbreak;\r\ndefault:\r\nreturn -ENOSYS;\r\n}\r\nCL = ramxlat(ramddr2_cl, CL);\r\nWR = ramxlat(ramddr2_wr, WR);\r\nif (CL < 0 || WR < 0)\r\nreturn -EINVAL;\r\nram->mr[0] &= ~0xf70;\r\nram->mr[0] |= (WR & 0x07) << 9;\r\nram->mr[0] |= (CL & 0x07) << 4;\r\nram->mr[1] &= ~0x045;\r\nram->mr[1] |= (ODT & 0x1) << 2;\r\nram->mr[1] |= (ODT & 0x2) << 5;\r\nram->mr[1] |= !DLL;\r\nreturn 0;\r\n}
