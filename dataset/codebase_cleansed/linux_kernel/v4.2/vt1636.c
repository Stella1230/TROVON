u8 viafb_gpio_i2c_read_lvds(struct lvds_setting_information\r\n*plvds_setting_info, struct lvds_chip_information *plvds_chip_info,\r\nu8 index)\r\n{\r\nu8 data;\r\nviafb_i2c_readbyte(plvds_chip_info->i2c_port,\r\nplvds_chip_info->lvds_chip_slave_addr, index, &data);\r\nreturn data;\r\n}\r\nvoid viafb_gpio_i2c_write_mask_lvds(struct lvds_setting_information\r\n*plvds_setting_info, struct lvds_chip_information\r\n*plvds_chip_info, struct IODATA io_data)\r\n{\r\nint index, data;\r\nindex = io_data.Index;\r\ndata = viafb_gpio_i2c_read_lvds(plvds_setting_info, plvds_chip_info,\r\nindex);\r\ndata = (data & (~io_data.Mask)) | io_data.Data;\r\nviafb_i2c_writebyte(plvds_chip_info->i2c_port,\r\nplvds_chip_info->lvds_chip_slave_addr, index, data);\r\n}\r\nvoid viafb_init_lvds_vt1636(struct lvds_setting_information\r\n*plvds_setting_info, struct lvds_chip_information *plvds_chip_info)\r\n{\r\nint reg_num, i;\r\nreg_num = ARRAY_SIZE(common_init_data);\r\nfor (i = 0; i < reg_num; i++)\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, common_init_data[i]);\r\nif (plvds_setting_info->device_lcd_dualedge)\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, dual_channel_enable_data);\r\nelse\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, single_channel_enable_data);\r\nif (plvds_setting_info->LCDDithering)\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, dithering_enable_data);\r\nelse\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, dithering_disable_data);\r\n}\r\nvoid viafb_enable_lvds_vt1636(struct lvds_setting_information\r\n*plvds_setting_info,\r\nstruct lvds_chip_information *plvds_chip_info)\r\n{\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info, plvds_chip_info,\r\nvdd_on_data);\r\n}\r\nvoid viafb_disable_lvds_vt1636(struct lvds_setting_information\r\n*plvds_setting_info,\r\nstruct lvds_chip_information *plvds_chip_info)\r\n{\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info, plvds_chip_info,\r\nvdd_off_data);\r\n}\r\nbool viafb_lvds_identify_vt1636(u8 i2c_adapter)\r\n{\r\nu8 Buffer[2];\r\nDEBUG_MSG(KERN_INFO "viafb_lvds_identify_vt1636.\n");\r\nviaparinfo->chip_info->lvds_chip_info.lvds_chip_slave_addr =\r\nVT1636_LVDS_I2C_ADDR;\r\nif (viafb_i2c_readbyte(i2c_adapter, VT1636_LVDS_I2C_ADDR,\r\n0x00, &Buffer[0]))\r\nreturn false;\r\nviafb_i2c_readbyte(i2c_adapter, VT1636_LVDS_I2C_ADDR, 0x01, &Buffer[1]);\r\nif (!((Buffer[0] == 0x06) && (Buffer[1] == 0x11)))\r\nreturn false;\r\nviafb_i2c_readbyte(i2c_adapter, VT1636_LVDS_I2C_ADDR, 0x02, &Buffer[0]);\r\nviafb_i2c_readbyte(i2c_adapter, VT1636_LVDS_I2C_ADDR, 0x03, &Buffer[1]);\r\nif ((Buffer[0] == 0x45) && (Buffer[1] == 0x33)) {\r\nviaparinfo->chip_info->lvds_chip_info.lvds_chip_name =\r\nVT1636_LVDS;\r\nreturn true;\r\n}\r\nreturn false;\r\n}\r\nstatic int get_clk_range_index(u32 Clk)\r\n{\r\nif (Clk < DPA_CLK_30M)\r\nreturn DPA_CLK_RANGE_30M;\r\nelse if (Clk < DPA_CLK_50M)\r\nreturn DPA_CLK_RANGE_30_50M;\r\nelse if (Clk < DPA_CLK_70M)\r\nreturn DPA_CLK_RANGE_50_70M;\r\nelse if (Clk < DPA_CLK_100M)\r\nreturn DPA_CLK_RANGE_70_100M;\r\nelse if (Clk < DPA_CLK_150M)\r\nreturn DPA_CLK_RANGE_100_150M;\r\nelse\r\nreturn DPA_CLK_RANGE_150M;\r\n}\r\nstatic void set_dpa_vt1636(struct lvds_setting_information\r\n*plvds_setting_info, struct lvds_chip_information *plvds_chip_info,\r\nstruct VT1636_DPA_SETTING *p_vt1636_dpa_setting)\r\n{\r\nstruct IODATA io_data;\r\nio_data.Index = 0x09;\r\nio_data.Mask = 0x1F;\r\nio_data.Data = p_vt1636_dpa_setting->CLK_SEL_ST1;\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info,\r\nplvds_chip_info, io_data);\r\nio_data.Index = 0x08;\r\nio_data.Mask = 0x0F;\r\nio_data.Data = p_vt1636_dpa_setting->CLK_SEL_ST2;\r\nviafb_gpio_i2c_write_mask_lvds(plvds_setting_info, plvds_chip_info,\r\nio_data);\r\n}\r\nvoid viafb_vt1636_patch_skew_on_vt3324(\r\nstruct lvds_setting_information *plvds_setting_info,\r\nstruct lvds_chip_information *plvds_chip_info)\r\n{\r\nstruct VT1636_DPA_SETTING dpa = {0x00, 0x00}, dpa_16x12 = {0x0B, 0x03},\r\n*pdpa;\r\nint index;\r\nDEBUG_MSG(KERN_INFO "viafb_vt1636_patch_skew_on_vt3324.\n");\r\nindex = get_clk_range_index(plvds_setting_info->vclk);\r\nviafb_set_dpa_gfx(plvds_chip_info->output_interface,\r\n&GFX_DPA_SETTING_TBL_VT3324[index]);\r\nif (plvds_setting_info->lcd_panel_hres == 1600 &&\r\nplvds_setting_info->lcd_panel_vres == 1200)\r\npdpa = &dpa_16x12;\r\nelse\r\npdpa = &dpa;\r\nset_dpa_vt1636(plvds_setting_info, plvds_chip_info, pdpa);\r\n}\r\nvoid viafb_vt1636_patch_skew_on_vt3327(\r\nstruct lvds_setting_information *plvds_setting_info,\r\nstruct lvds_chip_information *plvds_chip_info)\r\n{\r\nstruct VT1636_DPA_SETTING dpa = {0x00, 0x00};\r\nint index;\r\nDEBUG_MSG(KERN_INFO "viafb_vt1636_patch_skew_on_vt3327.\n");\r\nindex = get_clk_range_index(plvds_setting_info->vclk);\r\nviafb_set_dpa_gfx(plvds_chip_info->output_interface,\r\n&GFX_DPA_SETTING_TBL_VT3327[index]);\r\nset_dpa_vt1636(plvds_setting_info, plvds_chip_info, &dpa);\r\n}\r\nvoid viafb_vt1636_patch_skew_on_vt3364(\r\nstruct lvds_setting_information *plvds_setting_info,\r\nstruct lvds_chip_information *plvds_chip_info)\r\n{\r\nint index;\r\nDEBUG_MSG(KERN_INFO "viafb_vt1636_patch_skew_on_vt3364.\n");\r\nindex = get_clk_range_index(plvds_setting_info->vclk);\r\nviafb_set_dpa_gfx(plvds_chip_info->output_interface,\r\n&GFX_DPA_SETTING_TBL_VT3364[index]);\r\n}
