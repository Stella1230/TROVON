struct ceph_snap_context *ceph_create_snap_context(u32 snap_count,\r\ngfp_t gfp_flags)\r\n{\r\nstruct ceph_snap_context *snapc;\r\nsize_t size;\r\nsize = sizeof (struct ceph_snap_context);\r\nsize += snap_count * sizeof (snapc->snaps[0]);\r\nsnapc = kzalloc(size, gfp_flags);\r\nif (!snapc)\r\nreturn NULL;\r\natomic_set(&snapc->nref, 1);\r\nsnapc->num_snaps = snap_count;\r\nreturn snapc;\r\n}\r\nstruct ceph_snap_context *ceph_get_snap_context(struct ceph_snap_context *sc)\r\n{\r\nif (sc)\r\natomic_inc(&sc->nref);\r\nreturn sc;\r\n}\r\nvoid ceph_put_snap_context(struct ceph_snap_context *sc)\r\n{\r\nif (!sc)\r\nreturn;\r\nif (atomic_dec_and_test(&sc->nref)) {\r\nkfree(sc);\r\n}\r\n}
