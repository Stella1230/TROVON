int arch_apei_enable_cmcff(struct acpi_hest_header *hest_hdr, void *data)\r\n{\r\n#ifdef CONFIG_X86_MCE\r\nint i;\r\nstruct acpi_hest_ia_corrected *cmc;\r\nstruct acpi_hest_ia_error_bank *mc_bank;\r\nif (hest_hdr->type != ACPI_HEST_TYPE_IA32_CORRECTED_CHECK)\r\nreturn 0;\r\ncmc = (struct acpi_hest_ia_corrected *)hest_hdr;\r\nif (!cmc->enabled)\r\nreturn 0;\r\nif (!(cmc->flags & ACPI_HEST_FIRMWARE_FIRST) ||\r\n!cmc->num_hardware_banks)\r\nreturn 1;\r\npr_info("HEST: Enabling Firmware First mode for corrected errors.\n");\r\nmc_bank = (struct acpi_hest_ia_error_bank *)(cmc + 1);\r\nfor (i = 0; i < cmc->num_hardware_banks; i++, mc_bank++)\r\nmce_disable_bank(mc_bank->bank_number);\r\n#endif\r\nreturn 1;\r\n}\r\nvoid arch_apei_report_mem_error(int sev, struct cper_sec_mem_err *mem_err)\r\n{\r\n#ifdef CONFIG_X86_MCE\r\napei_mce_report_mem_error(sev, mem_err);\r\n#endif\r\n}\r\nvoid arch_apei_flush_tlb_one(unsigned long addr)\r\n{\r\n__flush_tlb_one(addr);\r\n}
