static ssize_t read_file_modal_eeprom(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct ath_hw *ah = file->private_data;\r\nu32 len = 0, size = 6000;\r\nchar *buf;\r\nsize_t retval;\r\nbuf = kzalloc(size, GFP_KERNEL);\r\nif (buf == NULL)\r\nreturn -ENOMEM;\r\nlen = ah->eep_ops->dump_eeprom(ah, false, buf, len, size);\r\nretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\r\nkfree(buf);\r\nreturn retval;\r\n}\r\nvoid ath9k_cmn_debug_modal_eeprom(struct dentry *debugfs_phy,\r\nstruct ath_hw *ah)\r\n{\r\ndebugfs_create_file("modal_eeprom", S_IRUSR, debugfs_phy, ah,\r\n&fops_modal_eeprom);\r\n}\r\nstatic ssize_t read_file_base_eeprom(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\nstruct ath_hw *ah = file->private_data;\r\nu32 len = 0, size = 1500;\r\nssize_t retval = 0;\r\nchar *buf;\r\nbuf = kzalloc(size, GFP_KERNEL);\r\nif (!buf)\r\nreturn -ENOMEM;\r\nlen = ah->eep_ops->dump_eeprom(ah, true, buf, len, size);\r\nretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\r\nkfree(buf);\r\nreturn retval;\r\n}\r\nvoid ath9k_cmn_debug_base_eeprom(struct dentry *debugfs_phy,\r\nstruct ath_hw *ah)\r\n{\r\ndebugfs_create_file("base_eeprom", S_IRUSR, debugfs_phy, ah,\r\n&fops_base_eeprom);\r\n}\r\nvoid ath9k_cmn_debug_stat_rx(struct ath_rx_stats *rxstats,\r\nstruct ath_rx_status *rs)\r\n{\r\n#define RX_PHY_ERR_INC(c) rxstats->phy_err_stats[c]++\r\n#define RX_CMN_STAT_INC(c) (rxstats->c++)\r\nRX_CMN_STAT_INC(rx_pkts_all);\r\nrxstats->rx_bytes_all += rs->rs_datalen;\r\nif (rs->rs_status & ATH9K_RXERR_CRC)\r\nRX_CMN_STAT_INC(crc_err);\r\nif (rs->rs_status & ATH9K_RXERR_DECRYPT)\r\nRX_CMN_STAT_INC(decrypt_crc_err);\r\nif (rs->rs_status & ATH9K_RXERR_MIC)\r\nRX_CMN_STAT_INC(mic_err);\r\nif (rs->rs_status & ATH9K_RX_DELIM_CRC_PRE)\r\nRX_CMN_STAT_INC(pre_delim_crc_err);\r\nif (rs->rs_status & ATH9K_RX_DELIM_CRC_POST)\r\nRX_CMN_STAT_INC(post_delim_crc_err);\r\nif (rs->rs_status & ATH9K_RX_DECRYPT_BUSY)\r\nRX_CMN_STAT_INC(decrypt_busy_err);\r\nif (rs->rs_status & ATH9K_RXERR_PHY) {\r\nRX_CMN_STAT_INC(phy_err);\r\nif (rs->rs_phyerr < ATH9K_PHYERR_MAX)\r\nRX_PHY_ERR_INC(rs->rs_phyerr);\r\n}\r\n#undef RX_CMN_STAT_INC\r\n#undef RX_PHY_ERR_INC\r\n}\r\nstatic ssize_t read_file_recv(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\n#define RXS_ERR(s, e) \\r\ndo { \\r\nlen += scnprintf(buf + len, size - len, \\r\n"%18s : %10u\n", s, \\r\nrxstats->e); \\r\n} while (0)\r\nstruct ath_rx_stats *rxstats = file->private_data;\r\nchar *buf;\r\nunsigned int len = 0, size = 1600;\r\nssize_t retval = 0;\r\nbuf = kzalloc(size, GFP_KERNEL);\r\nif (buf == NULL)\r\nreturn -ENOMEM;\r\nRXS_ERR("PKTS-ALL", rx_pkts_all);\r\nRXS_ERR("BYTES-ALL", rx_bytes_all);\r\nRXS_ERR("BEACONS", rx_beacons);\r\nRXS_ERR("FRAGS", rx_frags);\r\nRXS_ERR("SPECTRAL", rx_spectral);\r\nRXS_ERR("CRC ERR", crc_err);\r\nRXS_ERR("DECRYPT CRC ERR", decrypt_crc_err);\r\nRXS_ERR("PHY ERR", phy_err);\r\nRXS_ERR("MIC ERR", mic_err);\r\nRXS_ERR("PRE-DELIM CRC ERR", pre_delim_crc_err);\r\nRXS_ERR("POST-DELIM CRC ERR", post_delim_crc_err);\r\nRXS_ERR("DECRYPT BUSY ERR", decrypt_busy_err);\r\nRXS_ERR("LENGTH-ERR", rx_len_err);\r\nRXS_ERR("OOM-ERR", rx_oom_err);\r\nRXS_ERR("RATE-ERR", rx_rate_err);\r\nRXS_ERR("TOO-MANY-FRAGS", rx_too_many_frags_err);\r\nif (len > size)\r\nlen = size;\r\nretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\r\nkfree(buf);\r\nreturn retval;\r\n#undef RXS_ERR\r\n}\r\nvoid ath9k_cmn_debug_recv(struct dentry *debugfs_phy,\r\nstruct ath_rx_stats *rxstats)\r\n{\r\ndebugfs_create_file("recv", S_IRUSR, debugfs_phy, rxstats,\r\n&fops_recv);\r\n}\r\nstatic ssize_t read_file_phy_err(struct file *file, char __user *user_buf,\r\nsize_t count, loff_t *ppos)\r\n{\r\n#define PHY_ERR(s, p) \\r\nlen += scnprintf(buf + len, size - len, "%22s : %10u\n", s, \\r\nrxstats->phy_err_stats[p]);\r\nstruct ath_rx_stats *rxstats = file->private_data;\r\nchar *buf;\r\nunsigned int len = 0, size = 1600;\r\nssize_t retval = 0;\r\nbuf = kzalloc(size, GFP_KERNEL);\r\nif (buf == NULL)\r\nreturn -ENOMEM;\r\nPHY_ERR("UNDERRUN ERR", ATH9K_PHYERR_UNDERRUN);\r\nPHY_ERR("TIMING ERR", ATH9K_PHYERR_TIMING);\r\nPHY_ERR("PARITY ERR", ATH9K_PHYERR_PARITY);\r\nPHY_ERR("RATE ERR", ATH9K_PHYERR_RATE);\r\nPHY_ERR("LENGTH ERR", ATH9K_PHYERR_LENGTH);\r\nPHY_ERR("RADAR ERR", ATH9K_PHYERR_RADAR);\r\nPHY_ERR("SERVICE ERR", ATH9K_PHYERR_SERVICE);\r\nPHY_ERR("TOR ERR", ATH9K_PHYERR_TOR);\r\nPHY_ERR("OFDM-TIMING ERR", ATH9K_PHYERR_OFDM_TIMING);\r\nPHY_ERR("OFDM-SIGNAL-PARITY ERR", ATH9K_PHYERR_OFDM_SIGNAL_PARITY);\r\nPHY_ERR("OFDM-RATE ERR", ATH9K_PHYERR_OFDM_RATE_ILLEGAL);\r\nPHY_ERR("OFDM-LENGTH ERR", ATH9K_PHYERR_OFDM_LENGTH_ILLEGAL);\r\nPHY_ERR("OFDM-POWER-DROP ERR", ATH9K_PHYERR_OFDM_POWER_DROP);\r\nPHY_ERR("OFDM-SERVICE ERR", ATH9K_PHYERR_OFDM_SERVICE);\r\nPHY_ERR("OFDM-RESTART ERR", ATH9K_PHYERR_OFDM_RESTART);\r\nPHY_ERR("FALSE-RADAR-EXT ERR", ATH9K_PHYERR_FALSE_RADAR_EXT);\r\nPHY_ERR("CCK-TIMING ERR", ATH9K_PHYERR_CCK_TIMING);\r\nPHY_ERR("CCK-HEADER-CRC ERR", ATH9K_PHYERR_CCK_HEADER_CRC);\r\nPHY_ERR("CCK-RATE ERR", ATH9K_PHYERR_CCK_RATE_ILLEGAL);\r\nPHY_ERR("CCK-SERVICE ERR", ATH9K_PHYERR_CCK_SERVICE);\r\nPHY_ERR("CCK-RESTART ERR", ATH9K_PHYERR_CCK_RESTART);\r\nPHY_ERR("CCK-LENGTH ERR", ATH9K_PHYERR_CCK_LENGTH_ILLEGAL);\r\nPHY_ERR("CCK-POWER-DROP ERR", ATH9K_PHYERR_CCK_POWER_DROP);\r\nPHY_ERR("HT-CRC ERR", ATH9K_PHYERR_HT_CRC_ERROR);\r\nPHY_ERR("HT-LENGTH ERR", ATH9K_PHYERR_HT_LENGTH_ILLEGAL);\r\nPHY_ERR("HT-RATE ERR", ATH9K_PHYERR_HT_RATE_ILLEGAL);\r\nif (len > size)\r\nlen = size;\r\nretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\r\nkfree(buf);\r\nreturn retval;\r\n#undef PHY_ERR\r\n}\r\nvoid ath9k_cmn_debug_phy_err(struct dentry *debugfs_phy,\r\nstruct ath_rx_stats *rxstats)\r\n{\r\ndebugfs_create_file("phy_err", S_IRUSR, debugfs_phy, rxstats,\r\n&fops_phy_err);\r\n}
