static void\r\nnv31_bus_intr(struct nvkm_subdev *subdev)\r\n{\r\nstruct nvkm_bus *pbus = nvkm_bus(subdev);\r\nu32 stat = nv_rd32(pbus, 0x001100) & nv_rd32(pbus, 0x001140);\r\nu32 gpio = nv_rd32(pbus, 0x001104) & nv_rd32(pbus, 0x001144);\r\nif (gpio) {\r\nsubdev = nvkm_subdev(pbus, NVDEV_SUBDEV_GPIO);\r\nif (subdev && subdev->intr)\r\nsubdev->intr(subdev);\r\n}\r\nif (stat & 0x00000008) {\r\nu32 addr = nv_rd32(pbus, 0x009084);\r\nu32 data = nv_rd32(pbus, 0x009088);\r\nnv_error(pbus, "MMIO %s of 0x%08x FAULT at 0x%06x\n",\r\n(addr & 0x00000002) ? "write" : "read", data,\r\n(addr & 0x00fffffc));\r\nstat &= ~0x00000008;\r\nnv_wr32(pbus, 0x001100, 0x00000008);\r\n}\r\nif (stat & 0x00070000) {\r\nsubdev = nvkm_subdev(pbus, NVDEV_SUBDEV_THERM);\r\nif (subdev && subdev->intr)\r\nsubdev->intr(subdev);\r\nstat &= ~0x00070000;\r\nnv_wr32(pbus, 0x001100, 0x00070000);\r\n}\r\nif (stat) {\r\nnv_error(pbus, "unknown intr 0x%08x\n", stat);\r\nnv_mask(pbus, 0x001140, stat, 0x00000000);\r\n}\r\n}\r\nstatic int\r\nnv31_bus_init(struct nvkm_object *object)\r\n{\r\nstruct nv04_bus_priv *priv = (void *)object;\r\nint ret;\r\nret = nvkm_bus_init(&priv->base);\r\nif (ret)\r\nreturn ret;\r\nnv_wr32(priv, 0x001100, 0xffffffff);\r\nnv_wr32(priv, 0x001140, 0x00070008);\r\nreturn 0;\r\n}
