static inline void __hmatrix_write_reg(unsigned long offset, u32 value)\r\n{\r\n__raw_writel(value, (void __iomem __force *)(HMATRIX_BASE + offset));\r\n}\r\nstatic inline u32 __hmatrix_read_reg(unsigned long offset)\r\n{\r\nreturn __raw_readl((void __iomem __force *)(HMATRIX_BASE + offset));\r\n}\r\nvoid hmatrix_write_reg(unsigned long offset, u32 value)\r\n{\r\nclk_enable(&at32_hmatrix_clk);\r\n__hmatrix_write_reg(offset, value);\r\n__hmatrix_read_reg(offset);\r\nclk_disable(&at32_hmatrix_clk);\r\n}\r\nu32 hmatrix_read_reg(unsigned long offset)\r\n{\r\nu32 value;\r\nclk_enable(&at32_hmatrix_clk);\r\nvalue = __hmatrix_read_reg(offset);\r\nclk_disable(&at32_hmatrix_clk);\r\nreturn value;\r\n}\r\nvoid hmatrix_sfr_set_bits(unsigned int slave_id, u32 mask)\r\n{\r\nu32 value;\r\nclk_enable(&at32_hmatrix_clk);\r\nvalue = __hmatrix_read_reg(HMATRIX_SFR(slave_id));\r\nvalue |= mask;\r\n__hmatrix_write_reg(HMATRIX_SFR(slave_id), value);\r\n__hmatrix_read_reg(HMATRIX_SFR(slave_id));\r\nclk_disable(&at32_hmatrix_clk);\r\n}\r\nvoid hmatrix_sfr_clear_bits(unsigned int slave_id, u32 mask)\r\n{\r\nu32 value;\r\nclk_enable(&at32_hmatrix_clk);\r\nvalue = __hmatrix_read_reg(HMATRIX_SFR(slave_id));\r\nvalue &= ~mask;\r\n__hmatrix_write_reg(HMATRIX_SFR(slave_id), value);\r\n__hmatrix_read_reg(HMATRIX_SFR(slave_id));\r\nclk_disable(&at32_hmatrix_clk);\r\n}
