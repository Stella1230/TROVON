int samsung_gpio_setpull_updown(struct samsung_gpio_chip *chip,\r\nunsigned int off, samsung_gpio_pull_t pull)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nint shift = off * 2;\r\nu32 pup;\r\npup = __raw_readl(reg);\r\npup &= ~(3 << shift);\r\npup |= pull << shift;\r\n__raw_writel(pup, reg);\r\nreturn 0;\r\n}\r\nsamsung_gpio_pull_t samsung_gpio_getpull_updown(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nint shift = off * 2;\r\nu32 pup = __raw_readl(reg);\r\npup >>= shift;\r\npup &= 0x3;\r\nreturn (__force samsung_gpio_pull_t)pup;\r\n}\r\nint s3c2443_gpio_setpull(struct samsung_gpio_chip *chip,\r\nunsigned int off, samsung_gpio_pull_t pull)\r\n{\r\nswitch (pull) {\r\ncase S3C_GPIO_PULL_NONE:\r\npull = 0x01;\r\nbreak;\r\ncase S3C_GPIO_PULL_UP:\r\npull = 0x00;\r\nbreak;\r\ncase S3C_GPIO_PULL_DOWN:\r\npull = 0x02;\r\nbreak;\r\n}\r\nreturn samsung_gpio_setpull_updown(chip, off, pull);\r\n}\r\nsamsung_gpio_pull_t s3c2443_gpio_getpull(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nsamsung_gpio_pull_t pull;\r\npull = samsung_gpio_getpull_updown(chip, off);\r\nswitch (pull) {\r\ncase 0x00:\r\npull = S3C_GPIO_PULL_UP;\r\nbreak;\r\ncase 0x01:\r\ncase 0x03:\r\npull = S3C_GPIO_PULL_NONE;\r\nbreak;\r\ncase 0x02:\r\npull = S3C_GPIO_PULL_DOWN;\r\nbreak;\r\n}\r\nreturn pull;\r\n}\r\nstatic int s3c24xx_gpio_setpull_1(struct samsung_gpio_chip *chip,\r\nunsigned int off, samsung_gpio_pull_t pull,\r\nsamsung_gpio_pull_t updown)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nu32 pup = __raw_readl(reg);\r\nif (pull == updown)\r\npup &= ~(1 << off);\r\nelse if (pull == S3C_GPIO_PULL_NONE)\r\npup |= (1 << off);\r\nelse\r\nreturn -EINVAL;\r\n__raw_writel(pup, reg);\r\nreturn 0;\r\n}\r\nstatic samsung_gpio_pull_t s3c24xx_gpio_getpull_1(struct samsung_gpio_chip *chip,\r\nunsigned int off,\r\nsamsung_gpio_pull_t updown)\r\n{\r\nvoid __iomem *reg = chip->base + 0x08;\r\nu32 pup = __raw_readl(reg);\r\npup &= (1 << off);\r\nreturn pup ? S3C_GPIO_PULL_NONE : updown;\r\n}\r\nsamsung_gpio_pull_t s3c24xx_gpio_getpull_1up(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nreturn s3c24xx_gpio_getpull_1(chip, off, S3C_GPIO_PULL_UP);\r\n}\r\nint s3c24xx_gpio_setpull_1up(struct samsung_gpio_chip *chip,\r\nunsigned int off, samsung_gpio_pull_t pull)\r\n{\r\nreturn s3c24xx_gpio_setpull_1(chip, off, pull, S3C_GPIO_PULL_UP);\r\n}\r\nsamsung_gpio_pull_t s3c24xx_gpio_getpull_1down(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nreturn s3c24xx_gpio_getpull_1(chip, off, S3C_GPIO_PULL_DOWN);\r\n}\r\nint s3c24xx_gpio_setpull_1down(struct samsung_gpio_chip *chip,\r\nunsigned int off, samsung_gpio_pull_t pull)\r\n{\r\nreturn s3c24xx_gpio_setpull_1(chip, off, pull, S3C_GPIO_PULL_DOWN);\r\n}\r\nstatic int samsung_gpio_setcfg_2bit(struct samsung_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = off * 2;\r\nu32 con;\r\nif (samsung_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\nif (cfg > 3)\r\nreturn -EINVAL;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0x3 << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nstatic unsigned int samsung_gpio_getcfg_2bit(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nu32 con;\r\ncon = __raw_readl(chip->base);\r\ncon >>= off * 2;\r\ncon &= 3;\r\nreturn S3C_GPIO_SPECIAL(con);\r\n}\r\nstatic int samsung_gpio_setcfg_4bit(struct samsung_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = (off & 7) * 4;\r\nu32 con;\r\nif (off < 8 && chip->chip.ngpio > 8)\r\nreg -= 4;\r\nif (samsung_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0xf << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nstatic unsigned samsung_gpio_getcfg_4bit(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = (off & 7) * 4;\r\nu32 con;\r\nif (off < 8 && chip->chip.ngpio > 8)\r\nreg -= 4;\r\ncon = __raw_readl(reg);\r\ncon >>= shift;\r\ncon &= 0xf;\r\nreturn S3C_GPIO_SPECIAL(con);\r\n}\r\nstatic int s3c24xx_gpio_setcfg_abank(struct samsung_gpio_chip *chip,\r\nunsigned int off, unsigned int cfg)\r\n{\r\nvoid __iomem *reg = chip->base;\r\nunsigned int shift = off;\r\nu32 con;\r\nif (samsung_gpio_is_cfg_special(cfg)) {\r\ncfg &= 0xf;\r\ncfg -= 1;\r\nif (cfg > 1)\r\nreturn -EINVAL;\r\ncfg <<= shift;\r\n}\r\ncon = __raw_readl(reg);\r\ncon &= ~(0x1 << shift);\r\ncon |= cfg;\r\n__raw_writel(con, reg);\r\nreturn 0;\r\n}\r\nstatic unsigned s3c24xx_gpio_getcfg_abank(struct samsung_gpio_chip *chip,\r\nunsigned int off)\r\n{\r\nu32 con;\r\ncon = __raw_readl(chip->base);\r\ncon >>= off;\r\ncon &= 1;\r\ncon++;\r\nreturn S3C_GPIO_SFN(con);\r\n}\r\nstatic void __init samsung_gpiolib_set_cfg(struct samsung_gpio_cfg *chipcfg,\r\nint nr_chips)\r\n{\r\nfor (; nr_chips > 0; nr_chips--, chipcfg++) {\r\nif (!chipcfg->set_config)\r\nchipcfg->set_config = samsung_gpio_setcfg_4bit;\r\nif (!chipcfg->get_config)\r\nchipcfg->get_config = samsung_gpio_getcfg_4bit;\r\nif (!chipcfg->set_pull)\r\nchipcfg->set_pull = samsung_gpio_setpull_updown;\r\nif (!chipcfg->get_pull)\r\nchipcfg->get_pull = samsung_gpio_getpull_updown;\r\n}\r\n}\r\nstatic int samsung_gpiolib_2bit_input(struct gpio_chip *chip, unsigned offset)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long flags;\r\nunsigned long con;\r\nsamsung_gpio_lock(ourchip, flags);\r\ncon = __raw_readl(base + 0x00);\r\ncon &= ~(3 << (offset * 2));\r\n__raw_writel(con, base + 0x00);\r\nsamsung_gpio_unlock(ourchip, flags);\r\nreturn 0;\r\n}\r\nstatic int samsung_gpiolib_2bit_output(struct gpio_chip *chip,\r\nunsigned offset, int value)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long flags;\r\nunsigned long dat;\r\nunsigned long con;\r\nsamsung_gpio_lock(ourchip, flags);\r\ndat = __raw_readl(base + 0x04);\r\ndat &= ~(1 << offset);\r\nif (value)\r\ndat |= 1 << offset;\r\n__raw_writel(dat, base + 0x04);\r\ncon = __raw_readl(base + 0x00);\r\ncon &= ~(3 << (offset * 2));\r\ncon |= 1 << (offset * 2);\r\n__raw_writel(con, base + 0x00);\r\n__raw_writel(dat, base + 0x04);\r\nsamsung_gpio_unlock(ourchip, flags);\r\nreturn 0;\r\n}\r\nstatic int samsung_gpiolib_4bit_input(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long con;\r\ncon = __raw_readl(base + GPIOCON_OFF);\r\nif (ourchip->bitmap_gpio_int & BIT(offset))\r\ncon |= 0xf << con_4bit_shift(offset);\r\nelse\r\ncon &= ~(0xf << con_4bit_shift(offset));\r\n__raw_writel(con, base + GPIOCON_OFF);\r\npr_debug("%s: %p: CON now %08lx\n", __func__, base, con);\r\nreturn 0;\r\n}\r\nstatic int samsung_gpiolib_4bit_output(struct gpio_chip *chip,\r\nunsigned int offset, int value)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long con;\r\nunsigned long dat;\r\ncon = __raw_readl(base + GPIOCON_OFF);\r\ncon &= ~(0xf << con_4bit_shift(offset));\r\ncon |= 0x1 << con_4bit_shift(offset);\r\ndat = __raw_readl(base + GPIODAT_OFF);\r\nif (value)\r\ndat |= 1 << offset;\r\nelse\r\ndat &= ~(1 << offset);\r\n__raw_writel(dat, base + GPIODAT_OFF);\r\n__raw_writel(con, base + GPIOCON_OFF);\r\n__raw_writel(dat, base + GPIODAT_OFF);\r\npr_debug("%s: %p: CON %08lx, DAT %08lx\n", __func__, base, con, dat);\r\nreturn 0;\r\n}\r\nstatic int samsung_gpiolib_4bit2_input(struct gpio_chip *chip,\r\nunsigned int offset)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nvoid __iomem *regcon = base;\r\nunsigned long con;\r\nif (offset > 7)\r\noffset -= 8;\r\nelse\r\nregcon -= 4;\r\ncon = __raw_readl(regcon);\r\ncon &= ~(0xf << con_4bit_shift(offset));\r\n__raw_writel(con, regcon);\r\npr_debug("%s: %p: CON %08lx\n", __func__, base, con);\r\nreturn 0;\r\n}\r\nstatic int samsung_gpiolib_4bit2_output(struct gpio_chip *chip,\r\nunsigned int offset, int value)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nvoid __iomem *regcon = base;\r\nunsigned long con;\r\nunsigned long dat;\r\nunsigned con_offset = offset;\r\nif (con_offset > 7)\r\ncon_offset -= 8;\r\nelse\r\nregcon -= 4;\r\ncon = __raw_readl(regcon);\r\ncon &= ~(0xf << con_4bit_shift(con_offset));\r\ncon |= 0x1 << con_4bit_shift(con_offset);\r\ndat = __raw_readl(base + GPIODAT_OFF);\r\nif (value)\r\ndat |= 1 << offset;\r\nelse\r\ndat &= ~(1 << offset);\r\n__raw_writel(dat, base + GPIODAT_OFF);\r\n__raw_writel(con, regcon);\r\n__raw_writel(dat, base + GPIODAT_OFF);\r\npr_debug("%s: %p: CON %08lx, DAT %08lx\n", __func__, base, con, dat);\r\nreturn 0;\r\n}\r\nstatic int s3c24xx_gpiolib_banka_input(struct gpio_chip *chip, unsigned offset)\r\n{\r\nreturn -EINVAL;\r\n}\r\nstatic int s3c24xx_gpiolib_banka_output(struct gpio_chip *chip,\r\nunsigned offset, int value)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long flags;\r\nunsigned long dat;\r\nunsigned long con;\r\nlocal_irq_save(flags);\r\ncon = __raw_readl(base + 0x00);\r\ndat = __raw_readl(base + 0x04);\r\ndat &= ~(1 << offset);\r\nif (value)\r\ndat |= 1 << offset;\r\n__raw_writel(dat, base + 0x04);\r\ncon &= ~(1 << offset);\r\n__raw_writel(con, base + 0x00);\r\n__raw_writel(dat, base + 0x04);\r\nlocal_irq_restore(flags);\r\nreturn 0;\r\n}\r\nstatic void samsung_gpiolib_set(struct gpio_chip *chip,\r\nunsigned offset, int value)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nvoid __iomem *base = ourchip->base;\r\nunsigned long flags;\r\nunsigned long dat;\r\nsamsung_gpio_lock(ourchip, flags);\r\ndat = __raw_readl(base + 0x04);\r\ndat &= ~(1 << offset);\r\nif (value)\r\ndat |= 1 << offset;\r\n__raw_writel(dat, base + 0x04);\r\nsamsung_gpio_unlock(ourchip, flags);\r\n}\r\nstatic int samsung_gpiolib_get(struct gpio_chip *chip, unsigned offset)\r\n{\r\nstruct samsung_gpio_chip *ourchip = to_samsung_gpio(chip);\r\nunsigned long val;\r\nval = __raw_readl(ourchip->base + 0x04);\r\nval >>= offset;\r\nval &= 1;\r\nreturn val;\r\n}\r\nstatic __init void s3c_gpiolib_track(struct samsung_gpio_chip *chip)\r\n{\r\nunsigned int gpn;\r\nint i;\r\ngpn = chip->chip.base;\r\nfor (i = 0; i < chip->chip.ngpio; i++, gpn++) {\r\nBUG_ON(gpn >= ARRAY_SIZE(s3c_gpios));\r\ns3c_gpios[gpn] = chip;\r\n}\r\n}\r\nstatic void __init samsung_gpiolib_add(struct samsung_gpio_chip *chip)\r\n{\r\nstruct gpio_chip *gc = &chip->chip;\r\nint ret;\r\nBUG_ON(!chip->base);\r\nBUG_ON(!gc->label);\r\nBUG_ON(!gc->ngpio);\r\nspin_lock_init(&chip->lock);\r\nif (!gc->direction_input)\r\ngc->direction_input = samsung_gpiolib_2bit_input;\r\nif (!gc->direction_output)\r\ngc->direction_output = samsung_gpiolib_2bit_output;\r\nif (!gc->set)\r\ngc->set = samsung_gpiolib_set;\r\nif (!gc->get)\r\ngc->get = samsung_gpiolib_get;\r\n#ifdef CONFIG_PM\r\nif (chip->pm != NULL) {\r\nif (!chip->pm->save || !chip->pm->resume)\r\npr_err("gpio: %s has missing PM functions\n",\r\ngc->label);\r\n} else\r\npr_err("gpio: %s has no PM function\n", gc->label);\r\n#endif\r\nret = gpiochip_add(gc);\r\nif (ret >= 0)\r\ns3c_gpiolib_track(chip);\r\n}\r\nstatic void __init s3c24xx_gpiolib_add_chips(struct samsung_gpio_chip *chip,\r\nint nr_chips, void __iomem *base)\r\n{\r\nint i;\r\nstruct gpio_chip *gc = &chip->chip;\r\nfor (i = 0 ; i < nr_chips; i++, chip++) {\r\nif (chip->chip.base >= S3C_GPIO_END)\r\ncontinue;\r\nif (!chip->config)\r\nchip->config = &s3c24xx_gpiocfg_default;\r\nif (!chip->pm)\r\nchip->pm = __gpio_pm(&samsung_gpio_pm_2bit);\r\nif ((base != NULL) && (chip->base == NULL))\r\nchip->base = base + ((i) * 0x10);\r\nif (!gc->direction_input)\r\ngc->direction_input = samsung_gpiolib_2bit_input;\r\nif (!gc->direction_output)\r\ngc->direction_output = samsung_gpiolib_2bit_output;\r\nsamsung_gpiolib_add(chip);\r\n}\r\n}\r\nstatic void __init samsung_gpiolib_add_2bit_chips(struct samsung_gpio_chip *chip,\r\nint nr_chips, void __iomem *base,\r\nunsigned int offset)\r\n{\r\nint i;\r\nfor (i = 0 ; i < nr_chips; i++, chip++) {\r\nchip->chip.direction_input = samsung_gpiolib_2bit_input;\r\nchip->chip.direction_output = samsung_gpiolib_2bit_output;\r\nif (!chip->config)\r\nchip->config = &samsung_gpio_cfgs[7];\r\nif (!chip->pm)\r\nchip->pm = __gpio_pm(&samsung_gpio_pm_2bit);\r\nif ((base != NULL) && (chip->base == NULL))\r\nchip->base = base + ((i) * offset);\r\nsamsung_gpiolib_add(chip);\r\n}\r\n}\r\nstatic void __init samsung_gpiolib_add_4bit_chips(struct samsung_gpio_chip *chip,\r\nint nr_chips, void __iomem *base)\r\n{\r\nint i;\r\nfor (i = 0 ; i < nr_chips; i++, chip++) {\r\nchip->chip.direction_input = samsung_gpiolib_4bit_input;\r\nchip->chip.direction_output = samsung_gpiolib_4bit_output;\r\nif (!chip->config)\r\nchip->config = &samsung_gpio_cfgs[2];\r\nif (!chip->pm)\r\nchip->pm = __gpio_pm(&samsung_gpio_pm_4bit);\r\nif ((base != NULL) && (chip->base == NULL))\r\nchip->base = base + ((i) * 0x20);\r\nchip->bitmap_gpio_int = 0;\r\nsamsung_gpiolib_add(chip);\r\n}\r\n}\r\nstatic void __init samsung_gpiolib_add_4bit2_chips(struct samsung_gpio_chip *chip,\r\nint nr_chips)\r\n{\r\nfor (; nr_chips > 0; nr_chips--, chip++) {\r\nchip->chip.direction_input = samsung_gpiolib_4bit2_input;\r\nchip->chip.direction_output = samsung_gpiolib_4bit2_output;\r\nif (!chip->config)\r\nchip->config = &samsung_gpio_cfgs[2];\r\nif (!chip->pm)\r\nchip->pm = __gpio_pm(&samsung_gpio_pm_4bit);\r\nsamsung_gpiolib_add(chip);\r\n}\r\n}\r\nint samsung_gpiolib_to_irq(struct gpio_chip *chip, unsigned int offset)\r\n{\r\nstruct samsung_gpio_chip *samsung_chip = container_of(chip, struct samsung_gpio_chip, chip);\r\nreturn samsung_chip->irq_base + offset;\r\n}\r\nstatic int s3c24xx_gpiolib_fbank_to_irq(struct gpio_chip *chip, unsigned offset)\r\n{\r\nif (offset < 4) {\r\nif (soc_is_s3c2412())\r\nreturn IRQ_EINT0_2412 + offset;\r\nelse\r\nreturn IRQ_EINT0 + offset;\r\n}\r\nif (offset < 8)\r\nreturn IRQ_EINT4 + offset - 4;\r\nreturn -EINVAL;\r\n}\r\nstatic int s3c64xx_gpiolib_mbank_to_irq(struct gpio_chip *chip, unsigned pin)\r\n{\r\nreturn pin < 5 ? IRQ_EINT(23) + pin : -ENXIO;\r\n}\r\nstatic int s3c64xx_gpiolib_lbank_to_irq(struct gpio_chip *chip, unsigned pin)\r\n{\r\nreturn pin >= 8 ? IRQ_EINT(16) + pin - 8 : -ENXIO;\r\n}\r\nstatic __init int samsung_gpiolib_init(void)\r\n{\r\nif (of_have_populated_dt())\r\nreturn -ENODEV;\r\nsamsung_gpiolib_set_cfg(samsung_gpio_cfgs, ARRAY_SIZE(samsung_gpio_cfgs));\r\nif (soc_is_s3c24xx()) {\r\ns3c24xx_gpiolib_add_chips(s3c24xx_gpios,\r\nARRAY_SIZE(s3c24xx_gpios), S3C24XX_VA_GPIO);\r\n} else if (soc_is_s3c64xx()) {\r\nsamsung_gpiolib_add_2bit_chips(s3c64xx_gpios_2bit,\r\nARRAY_SIZE(s3c64xx_gpios_2bit),\r\nS3C64XX_VA_GPIO + 0xE0, 0x20);\r\nsamsung_gpiolib_add_4bit_chips(s3c64xx_gpios_4bit,\r\nARRAY_SIZE(s3c64xx_gpios_4bit),\r\nS3C64XX_VA_GPIO);\r\nsamsung_gpiolib_add_4bit2_chips(s3c64xx_gpios_4bit2,\r\nARRAY_SIZE(s3c64xx_gpios_4bit2));\r\n} else {\r\nWARN(1, "Unknown SoC in gpio-samsung, no GPIOs added\n");\r\nreturn -ENODEV;\r\n}\r\nreturn 0;\r\n}\r\nint s3c_gpio_cfgpin(unsigned int pin, unsigned int config)\r\n{\r\nstruct samsung_gpio_chip *chip = samsung_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset;\r\nint ret;\r\nif (!chip)\r\nreturn -EINVAL;\r\noffset = pin - chip->chip.base;\r\nsamsung_gpio_lock(chip, flags);\r\nret = samsung_gpio_do_setcfg(chip, offset, config);\r\nsamsung_gpio_unlock(chip, flags);\r\nreturn ret;\r\n}\r\nint s3c_gpio_cfgpin_range(unsigned int start, unsigned int nr,\r\nunsigned int cfg)\r\n{\r\nint ret;\r\nfor (; nr > 0; nr--, start++) {\r\nret = s3c_gpio_cfgpin(start, cfg);\r\nif (ret != 0)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nint s3c_gpio_cfgall_range(unsigned int start, unsigned int nr,\r\nunsigned int cfg, samsung_gpio_pull_t pull)\r\n{\r\nint ret;\r\nfor (; nr > 0; nr--, start++) {\r\ns3c_gpio_setpull(start, pull);\r\nret = s3c_gpio_cfgpin(start, cfg);\r\nif (ret != 0)\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nunsigned s3c_gpio_getcfg(unsigned int pin)\r\n{\r\nstruct samsung_gpio_chip *chip = samsung_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nunsigned ret = 0;\r\nint offset;\r\nif (chip) {\r\noffset = pin - chip->chip.base;\r\nsamsung_gpio_lock(chip, flags);\r\nret = samsung_gpio_do_getcfg(chip, offset);\r\nsamsung_gpio_unlock(chip, flags);\r\n}\r\nreturn ret;\r\n}\r\nint s3c_gpio_setpull(unsigned int pin, samsung_gpio_pull_t pull)\r\n{\r\nstruct samsung_gpio_chip *chip = samsung_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset, ret;\r\nif (!chip)\r\nreturn -EINVAL;\r\noffset = pin - chip->chip.base;\r\nsamsung_gpio_lock(chip, flags);\r\nret = samsung_gpio_do_setpull(chip, offset, pull);\r\nsamsung_gpio_unlock(chip, flags);\r\nreturn ret;\r\n}\r\nsamsung_gpio_pull_t s3c_gpio_getpull(unsigned int pin)\r\n{\r\nstruct samsung_gpio_chip *chip = samsung_gpiolib_getchip(pin);\r\nunsigned long flags;\r\nint offset;\r\nu32 pup = 0;\r\nif (chip) {\r\noffset = pin - chip->chip.base;\r\nsamsung_gpio_lock(chip, flags);\r\npup = samsung_gpio_do_getpull(chip, offset);\r\nsamsung_gpio_unlock(chip, flags);\r\n}\r\nreturn (__force samsung_gpio_pull_t)pup;\r\n}\r\nunsigned int s3c2410_modify_misccr(unsigned int clear, unsigned int change)\r\n{\r\nunsigned long flags;\r\nunsigned long misccr;\r\nlocal_irq_save(flags);\r\nmisccr = __raw_readl(S3C24XX_MISCCR);\r\nmisccr &= ~clear;\r\nmisccr ^= change;\r\n__raw_writel(misccr, S3C24XX_MISCCR);\r\nlocal_irq_restore(flags);\r\nreturn misccr;\r\n}
