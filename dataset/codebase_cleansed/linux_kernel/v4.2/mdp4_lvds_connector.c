static enum drm_connector_status mdp4_lvds_connector_detect(\r\nstruct drm_connector *connector, bool force)\r\n{\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector =\r\nto_mdp4_lvds_connector(connector);\r\nreturn mdp4_lvds_connector->panel ?\r\nconnector_status_connected :\r\nconnector_status_disconnected;\r\n}\r\nstatic void mdp4_lvds_connector_destroy(struct drm_connector *connector)\r\n{\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector =\r\nto_mdp4_lvds_connector(connector);\r\nstruct drm_panel *panel = mdp4_lvds_connector->panel;\r\nif (panel)\r\ndrm_panel_detach(panel);\r\ndrm_connector_unregister(connector);\r\ndrm_connector_cleanup(connector);\r\nkfree(mdp4_lvds_connector);\r\n}\r\nstatic int mdp4_lvds_connector_get_modes(struct drm_connector *connector)\r\n{\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector =\r\nto_mdp4_lvds_connector(connector);\r\nstruct drm_panel *panel = mdp4_lvds_connector->panel;\r\nint ret = 0;\r\nif (panel)\r\nret = panel->funcs->get_modes(panel);\r\nreturn ret;\r\n}\r\nstatic int mdp4_lvds_connector_mode_valid(struct drm_connector *connector,\r\nstruct drm_display_mode *mode)\r\n{\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector =\r\nto_mdp4_lvds_connector(connector);\r\nstruct drm_encoder *encoder = mdp4_lvds_connector->encoder;\r\nlong actual, requested;\r\nrequested = 1000 * mode->clock;\r\nactual = mdp4_lcdc_round_pixclk(encoder, requested);\r\nDBG("requested=%ld, actual=%ld", requested, actual);\r\nif (actual != requested)\r\nreturn MODE_CLOCK_RANGE;\r\nreturn MODE_OK;\r\n}\r\nstatic struct drm_encoder *\r\nmdp4_lvds_connector_best_encoder(struct drm_connector *connector)\r\n{\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector =\r\nto_mdp4_lvds_connector(connector);\r\nreturn mdp4_lvds_connector->encoder;\r\n}\r\nstruct drm_connector *mdp4_lvds_connector_init(struct drm_device *dev,\r\nstruct drm_panel *panel, struct drm_encoder *encoder)\r\n{\r\nstruct drm_connector *connector = NULL;\r\nstruct mdp4_lvds_connector *mdp4_lvds_connector;\r\nint ret;\r\nmdp4_lvds_connector = kzalloc(sizeof(*mdp4_lvds_connector), GFP_KERNEL);\r\nif (!mdp4_lvds_connector) {\r\nret = -ENOMEM;\r\ngoto fail;\r\n}\r\nmdp4_lvds_connector->encoder = encoder;\r\nmdp4_lvds_connector->panel = panel;\r\nconnector = &mdp4_lvds_connector->base;\r\ndrm_connector_init(dev, connector, &mdp4_lvds_connector_funcs,\r\nDRM_MODE_CONNECTOR_LVDS);\r\ndrm_connector_helper_add(connector, &mdp4_lvds_connector_helper_funcs);\r\nconnector->polled = 0;\r\nconnector->interlace_allowed = 0;\r\nconnector->doublescan_allowed = 0;\r\ndrm_connector_register(connector);\r\ndrm_mode_connector_attach_encoder(connector, encoder);\r\nif (panel)\r\ndrm_panel_attach(panel, connector);\r\nreturn connector;\r\nfail:\r\nif (connector)\r\nmdp4_lvds_connector_destroy(connector);\r\nreturn ERR_PTR(ret);\r\n}
