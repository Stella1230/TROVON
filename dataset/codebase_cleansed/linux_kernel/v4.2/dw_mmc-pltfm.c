static void dw_mci_pltfm_prepare_command(struct dw_mci *host, u32 *cmdr)\r\n{\r\n*cmdr |= SDMMC_CMD_USE_HOLD_REG;\r\n}\r\nint dw_mci_pltfm_register(struct platform_device *pdev,\r\nconst struct dw_mci_drv_data *drv_data)\r\n{\r\nstruct dw_mci *host;\r\nstruct resource *regs;\r\nhost = devm_kzalloc(&pdev->dev, sizeof(struct dw_mci), GFP_KERNEL);\r\nif (!host)\r\nreturn -ENOMEM;\r\nhost->irq = platform_get_irq(pdev, 0);\r\nif (host->irq < 0)\r\nreturn host->irq;\r\nhost->drv_data = drv_data;\r\nhost->dev = &pdev->dev;\r\nhost->irq_flags = 0;\r\nhost->pdata = pdev->dev.platform_data;\r\nregs = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nhost->regs = devm_ioremap_resource(&pdev->dev, regs);\r\nif (IS_ERR(host->regs))\r\nreturn PTR_ERR(host->regs);\r\nplatform_set_drvdata(pdev, host);\r\nreturn dw_mci_probe(host);\r\n}\r\nstatic int dw_mci_pltfm_suspend(struct device *dev)\r\n{\r\nstruct dw_mci *host = dev_get_drvdata(dev);\r\nreturn dw_mci_suspend(host);\r\n}\r\nstatic int dw_mci_pltfm_resume(struct device *dev)\r\n{\r\nstruct dw_mci *host = dev_get_drvdata(dev);\r\nreturn dw_mci_resume(host);\r\n}\r\nstatic int dw_mci_pltfm_probe(struct platform_device *pdev)\r\n{\r\nconst struct dw_mci_drv_data *drv_data = NULL;\r\nconst struct of_device_id *match;\r\nif (pdev->dev.of_node) {\r\nmatch = of_match_node(dw_mci_pltfm_match, pdev->dev.of_node);\r\ndrv_data = match->data;\r\n}\r\nreturn dw_mci_pltfm_register(pdev, drv_data);\r\n}\r\nint dw_mci_pltfm_remove(struct platform_device *pdev)\r\n{\r\nstruct dw_mci *host = platform_get_drvdata(pdev);\r\ndw_mci_remove(host);\r\nreturn 0;\r\n}
