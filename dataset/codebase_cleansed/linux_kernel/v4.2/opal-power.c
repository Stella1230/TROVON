static int opal_power_control_event(struct notifier_block *nb,\r\nunsigned long msg_type, void *msg)\r\n{\r\nstruct opal_msg *power_msg = msg;\r\nuint64_t type;\r\ntype = be64_to_cpu(power_msg->params[0]);\r\nswitch (type) {\r\ncase SOFT_REBOOT:\r\npr_info("OPAL: reboot requested\n");\r\norderly_reboot();\r\nbreak;\r\ncase SOFT_OFF:\r\npr_info("OPAL: poweroff requested\n");\r\norderly_poweroff(true);\r\nbreak;\r\ndefault:\r\npr_err("OPAL: power control type unexpected %016llx\n", type);\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init opal_power_control_init(void)\r\n{\r\nint ret;\r\nret = opal_message_notifier_register(OPAL_MSG_SHUTDOWN,\r\n&opal_power_control_nb);\r\nif (ret) {\r\npr_err("%s: Can't register OPAL event notifier (%d)\n",\r\n__func__, ret);\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
