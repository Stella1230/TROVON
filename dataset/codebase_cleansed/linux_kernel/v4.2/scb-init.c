inline void scb_mi_write(unsigned long scb_mi_arbw, unsigned int slots,\r\nunsigned char *scb_mi_prio)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < slots; ++i)\r\nbfin_write32(scb_mi_arbw, (i << SCB_SLOT_OFFSET) | scb_mi_prio[i]);\r\n}\r\ninline void scb_mi_read(unsigned long scb_mi_arbw, unsigned int slots,\r\nunsigned char *scb_mi_prio)\r\n{\r\nunsigned int i;\r\nfor (i = 0; i < slots; ++i) {\r\nbfin_write32(scb_mi_arbw, (0xFF << SCB_SLOT_OFFSET) | i);\r\nscb_mi_prio[i] = bfin_read32(scb_mi_arbw);\r\n}\r\n}\r\nvoid init_scb(void)\r\n{\r\nunsigned int i, j;\r\nunsigned char scb_tmp_prio[32];\r\npr_info("Init System Crossbar\n");\r\nfor (i = 0; scb_data[i].scb_mi_arbr > 0; ++i) {\r\nscb_mi_write(scb_data[i].scb_mi_arbw, scb_data[i].scb_mi_slots, scb_data[i].scb_mi_prio);\r\npr_debug("scb priority at 0x%lx:\n", scb_data[i].scb_mi_arbr);\r\nscb_mi_read(scb_data[i].scb_mi_arbw, scb_data[i].scb_mi_slots, scb_tmp_prio);\r\nfor (j = 0; j < scb_data[i].scb_mi_slots; ++j)\r\npr_debug("slot %d = %d\n", j, scb_tmp_prio[j]);\r\n}\r\n}
