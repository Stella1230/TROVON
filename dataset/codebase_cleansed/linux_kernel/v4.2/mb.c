static int show_cpuinfo(struct seq_file *m, void *v)\r\n{\r\nchar *fpga_family = "Unknown";\r\nchar *cpu_ver = "Unknown";\r\nint i;\r\nfor (i = 0; family_string_lookup[i].s != NULL; i++) {\r\nif (cpuinfo.fpga_family_code == family_string_lookup[i].k) {\r\nfpga_family = (char *)family_string_lookup[i].s;\r\nbreak;\r\n}\r\n}\r\nfor (i = 0; cpu_ver_lookup[i].s != NULL; i++) {\r\nif (cpuinfo.ver_code == cpu_ver_lookup[i].k) {\r\ncpu_ver = (char *)cpu_ver_lookup[i].s;\r\nbreak;\r\n}\r\n}\r\nseq_printf(m,\r\n"CPU-Family: MicroBlaze\n"\r\n"FPGA-Arch: %s\n"\r\n"CPU-Ver: %s, %s endian\n"\r\n"CPU-MHz: %d.%02d\n"\r\n"BogoMips: %lu.%02lu\n",\r\nfpga_family,\r\ncpu_ver,\r\ncpuinfo.endian ? "little" : "big",\r\ncpuinfo.cpu_clock_freq / 1000000,\r\ncpuinfo.cpu_clock_freq % 1000000,\r\nloops_per_jiffy / (500000 / HZ),\r\n(loops_per_jiffy / (5000 / HZ)) % 100);\r\nseq_printf(m,\r\n"HW:\n Shift:\t\t%s\n"\r\n" MSR:\t\t%s\n"\r\n" PCMP:\t\t%s\n"\r\n" DIV:\t\t%s\n",\r\n(cpuinfo.use_instr & PVR0_USE_BARREL_MASK) ? "yes" : "no",\r\n(cpuinfo.use_instr & PVR2_USE_MSR_INSTR) ? "yes" : "no",\r\n(cpuinfo.use_instr & PVR2_USE_PCMP_INSTR) ? "yes" : "no",\r\n(cpuinfo.use_instr & PVR0_USE_DIV_MASK) ? "yes" : "no");\r\nseq_printf(m, " MMU:\t\t%x\n", cpuinfo.mmu);\r\nseq_printf(m,\r\n" MUL:\t\t%s\n"\r\n" FPU:\t\t%s\n",\r\n(cpuinfo.use_mult & PVR2_USE_MUL64_MASK) ? "v2" :\r\n(cpuinfo.use_mult & PVR0_USE_HW_MUL_MASK) ? "v1" : "no",\r\n(cpuinfo.use_fpu & PVR2_USE_FPU2_MASK) ? "v2" :\r\n(cpuinfo.use_fpu & PVR0_USE_FPU_MASK) ? "v1" : "no");\r\nseq_printf(m,\r\n" Exc:\t\t%s%s%s%s%s%s%s%s\n",\r\n(cpuinfo.use_exc & PVR2_OPCODE_0x0_ILL_MASK) ? "op0x0 " : "",\r\n(cpuinfo.use_exc & PVR2_UNALIGNED_EXC_MASK) ? "unal " : "",\r\n(cpuinfo.use_exc & PVR2_ILL_OPCODE_EXC_MASK) ? "ill " : "",\r\n(cpuinfo.use_exc & PVR2_IOPB_BUS_EXC_MASK) ? "iopb " : "",\r\n(cpuinfo.use_exc & PVR2_DOPB_BUS_EXC_MASK) ? "dopb " : "",\r\n(cpuinfo.use_exc & PVR2_DIV_ZERO_EXC_MASK) ? "zero " : "",\r\n(cpuinfo.use_exc & PVR2_FPU_EXC_MASK) ? "fpu " : "",\r\n(cpuinfo.use_exc & PVR2_USE_FSL_EXC) ? "fsl " : "");\r\nseq_printf(m,\r\n"Stream-insns:\t%sprivileged\n",\r\ncpuinfo.mmu_privins ? "un" : "");\r\nif (cpuinfo.use_icache)\r\nseq_printf(m,\r\n"Icache:\t\t%ukB\tline length:\t%dB\n",\r\ncpuinfo.icache_size >> 10,\r\ncpuinfo.icache_line_length);\r\nelse\r\nseq_puts(m, "Icache:\t\tno\n");\r\nif (cpuinfo.use_dcache) {\r\nseq_printf(m,\r\n"Dcache:\t\t%ukB\tline length:\t%dB\n",\r\ncpuinfo.dcache_size >> 10,\r\ncpuinfo.dcache_line_length);\r\nseq_puts(m, "Dcache-Policy:\t");\r\nif (cpuinfo.dcache_wb)\r\nseq_puts(m, "write-back\n");\r\nelse\r\nseq_puts(m, "write-through\n");\r\n} else {\r\nseq_puts(m, "Dcache:\t\tno\n");\r\n}\r\nseq_printf(m,\r\n"HW-Debug:\t%s\n",\r\ncpuinfo.hw_debug ? "yes" : "no");\r\nseq_printf(m,\r\n"PVR-USR1:\t%02x\n"\r\n"PVR-USR2:\t%08x\n",\r\ncpuinfo.pvr_user1,\r\ncpuinfo.pvr_user2);\r\nseq_printf(m, "Page size:\t%lu\n", PAGE_SIZE);\r\nreturn 0;\r\n}\r\nstatic void *c_start(struct seq_file *m, loff_t *pos)\r\n{\r\nint i = *pos;\r\nreturn i < NR_CPUS ? (void *) (i + 1) : NULL;\r\n}\r\nstatic void *c_next(struct seq_file *m, void *v, loff_t *pos)\r\n{\r\n++*pos;\r\nreturn c_start(m, pos);\r\n}\r\nstatic void c_stop(struct seq_file *m, void *v)\r\n{\r\n}
