static void radeon_ucode_print_common_hdr(const struct common_firmware_header *hdr)\r\n{\r\nDRM_DEBUG("size_bytes: %u\n", le32_to_cpu(hdr->size_bytes));\r\nDRM_DEBUG("header_size_bytes: %u\n", le32_to_cpu(hdr->header_size_bytes));\r\nDRM_DEBUG("header_version_major: %u\n", le16_to_cpu(hdr->header_version_major));\r\nDRM_DEBUG("header_version_minor: %u\n", le16_to_cpu(hdr->header_version_minor));\r\nDRM_DEBUG("ip_version_major: %u\n", le16_to_cpu(hdr->ip_version_major));\r\nDRM_DEBUG("ip_version_minor: %u\n", le16_to_cpu(hdr->ip_version_minor));\r\nDRM_DEBUG("ucode_version: 0x%08x\n", le32_to_cpu(hdr->ucode_version));\r\nDRM_DEBUG("ucode_size_bytes: %u\n", le32_to_cpu(hdr->ucode_size_bytes));\r\nDRM_DEBUG("ucode_array_offset_bytes: %u\n",\r\nle32_to_cpu(hdr->ucode_array_offset_bytes));\r\nDRM_DEBUG("crc32: 0x%08x\n", le32_to_cpu(hdr->crc32));\r\n}\r\nvoid radeon_ucode_print_mc_hdr(const struct common_firmware_header *hdr)\r\n{\r\nuint16_t version_major = le16_to_cpu(hdr->header_version_major);\r\nuint16_t version_minor = le16_to_cpu(hdr->header_version_minor);\r\nDRM_DEBUG("MC\n");\r\nradeon_ucode_print_common_hdr(hdr);\r\nif (version_major == 1) {\r\nconst struct mc_firmware_header_v1_0 *mc_hdr =\r\ncontainer_of(hdr, struct mc_firmware_header_v1_0, header);\r\nDRM_DEBUG("io_debug_size_bytes: %u\n",\r\nle32_to_cpu(mc_hdr->io_debug_size_bytes));\r\nDRM_DEBUG("io_debug_array_offset_bytes: %u\n",\r\nle32_to_cpu(mc_hdr->io_debug_array_offset_bytes));\r\n} else {\r\nDRM_ERROR("Unknown MC ucode version: %u.%u\n", version_major, version_minor);\r\n}\r\n}\r\nvoid radeon_ucode_print_smc_hdr(const struct common_firmware_header *hdr)\r\n{\r\nuint16_t version_major = le16_to_cpu(hdr->header_version_major);\r\nuint16_t version_minor = le16_to_cpu(hdr->header_version_minor);\r\nDRM_DEBUG("SMC\n");\r\nradeon_ucode_print_common_hdr(hdr);\r\nif (version_major == 1) {\r\nconst struct smc_firmware_header_v1_0 *smc_hdr =\r\ncontainer_of(hdr, struct smc_firmware_header_v1_0, header);\r\nDRM_DEBUG("ucode_start_addr: %u\n", le32_to_cpu(smc_hdr->ucode_start_addr));\r\n} else {\r\nDRM_ERROR("Unknown SMC ucode version: %u.%u\n", version_major, version_minor);\r\n}\r\n}\r\nvoid radeon_ucode_print_gfx_hdr(const struct common_firmware_header *hdr)\r\n{\r\nuint16_t version_major = le16_to_cpu(hdr->header_version_major);\r\nuint16_t version_minor = le16_to_cpu(hdr->header_version_minor);\r\nDRM_DEBUG("GFX\n");\r\nradeon_ucode_print_common_hdr(hdr);\r\nif (version_major == 1) {\r\nconst struct gfx_firmware_header_v1_0 *gfx_hdr =\r\ncontainer_of(hdr, struct gfx_firmware_header_v1_0, header);\r\nDRM_DEBUG("ucode_feature_version: %u\n",\r\nle32_to_cpu(gfx_hdr->ucode_feature_version));\r\nDRM_DEBUG("jt_offset: %u\n", le32_to_cpu(gfx_hdr->jt_offset));\r\nDRM_DEBUG("jt_size: %u\n", le32_to_cpu(gfx_hdr->jt_size));\r\n} else {\r\nDRM_ERROR("Unknown GFX ucode version: %u.%u\n", version_major, version_minor);\r\n}\r\n}\r\nvoid radeon_ucode_print_rlc_hdr(const struct common_firmware_header *hdr)\r\n{\r\nuint16_t version_major = le16_to_cpu(hdr->header_version_major);\r\nuint16_t version_minor = le16_to_cpu(hdr->header_version_minor);\r\nDRM_DEBUG("RLC\n");\r\nradeon_ucode_print_common_hdr(hdr);\r\nif (version_major == 1) {\r\nconst struct rlc_firmware_header_v1_0 *rlc_hdr =\r\ncontainer_of(hdr, struct rlc_firmware_header_v1_0, header);\r\nDRM_DEBUG("ucode_feature_version: %u\n",\r\nle32_to_cpu(rlc_hdr->ucode_feature_version));\r\nDRM_DEBUG("save_and_restore_offset: %u\n",\r\nle32_to_cpu(rlc_hdr->save_and_restore_offset));\r\nDRM_DEBUG("clear_state_descriptor_offset: %u\n",\r\nle32_to_cpu(rlc_hdr->clear_state_descriptor_offset));\r\nDRM_DEBUG("avail_scratch_ram_locations: %u\n",\r\nle32_to_cpu(rlc_hdr->avail_scratch_ram_locations));\r\nDRM_DEBUG("master_pkt_description_offset: %u\n",\r\nle32_to_cpu(rlc_hdr->master_pkt_description_offset));\r\n} else {\r\nDRM_ERROR("Unknown RLC ucode version: %u.%u\n", version_major, version_minor);\r\n}\r\n}\r\nvoid radeon_ucode_print_sdma_hdr(const struct common_firmware_header *hdr)\r\n{\r\nuint16_t version_major = le16_to_cpu(hdr->header_version_major);\r\nuint16_t version_minor = le16_to_cpu(hdr->header_version_minor);\r\nDRM_DEBUG("SDMA\n");\r\nradeon_ucode_print_common_hdr(hdr);\r\nif (version_major == 1) {\r\nconst struct sdma_firmware_header_v1_0 *sdma_hdr =\r\ncontainer_of(hdr, struct sdma_firmware_header_v1_0, header);\r\nDRM_DEBUG("ucode_feature_version: %u\n",\r\nle32_to_cpu(sdma_hdr->ucode_feature_version));\r\nDRM_DEBUG("ucode_change_version: %u\n",\r\nle32_to_cpu(sdma_hdr->ucode_change_version));\r\nDRM_DEBUG("jt_offset: %u\n", le32_to_cpu(sdma_hdr->jt_offset));\r\nDRM_DEBUG("jt_size: %u\n", le32_to_cpu(sdma_hdr->jt_size));\r\n} else {\r\nDRM_ERROR("Unknown SDMA ucode version: %u.%u\n",\r\nversion_major, version_minor);\r\n}\r\n}\r\nint radeon_ucode_validate(const struct firmware *fw)\r\n{\r\nconst struct common_firmware_header *hdr =\r\n(const struct common_firmware_header *)fw->data;\r\nif (fw->size == le32_to_cpu(hdr->size_bytes))\r\nreturn 0;\r\nreturn -EINVAL;\r\n}
