static void\r\nnv20_devinit_meminit(struct nvkm_devinit *devinit)\r\n{\r\nstruct nv04_devinit_priv *priv = (void *)devinit;\r\nstruct nvkm_device *device = nv_device(priv);\r\nuint32_t mask = (device->chipset >= 0x25 ? 0x300 : 0x900);\r\nuint32_t amount, off;\r\nstruct io_mapping *fb;\r\nfb = fbmem_init(nv_device(priv));\r\nif (!fb) {\r\nnv_error(priv, "failed to map fb\n");\r\nreturn;\r\n}\r\nnv_wr32(priv, NV10_PFB_REFCTRL, NV10_PFB_REFCTRL_VALID_1);\r\nnv_mask(priv, NV04_PFB_CFG0, 0, mask);\r\namount = nv_rd32(priv, 0x10020c);\r\nfor (off = amount; off > 0x2000000; off -= 0x2000000)\r\nfbmem_poke(fb, off - 4, off);\r\namount = nv_rd32(priv, 0x10020c);\r\nif (amount != fbmem_peek(fb, amount - 4))\r\nnv_mask(priv, NV04_PFB_CFG0, mask, 0);\r\nfbmem_fini(fb);\r\n}
