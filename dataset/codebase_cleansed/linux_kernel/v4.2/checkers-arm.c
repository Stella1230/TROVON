static enum probes_insn __kprobes arm_check_stack(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nstatic const union decode_item table[] = {\r\nDECODE_OR (0x0e10000f, 0x0600000d),\r\nDECODE_OR (0x0e1f0000, 0x060d0000),\r\nDECODE_OR (0x0e5000bf, 0x000000bd),\r\nDECODE_CUSTOM (0x0e5f00b0, 0x000d00b0, STACK_USE_UNKNOWN),\r\nDECODE_CUSTOM (0x0edf0000, 0x080d0000, STACK_USE_STMDX),\r\nDECODE_CUSTOM (0x0f9f0000, 0x050d0000, STACK_USE_FIXED_XXX),\r\nDECODE_CUSTOM (0x0fdf00b0, 0x014d00b0, STACK_USE_FIXED_X0X),\r\nDECODE_CUSTOM (0, 0, STACK_USE_NONE),\r\nDECODE_END\r\n};\r\nreturn probes_decode_insn(insn, asi, table, false, false, stack_check_actions, NULL);\r\n}\r\nstatic enum probes_insn __kprobes arm_check_regs_nouse(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nasi->register_usage_flags = 0;\r\nreturn INSN_GOOD;\r\n}\r\nstatic enum probes_insn arm_check_regs_normal(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nu32 regs = h->type_regs.bits >> DECODE_TYPE_BITS;\r\nint i;\r\nasi->register_usage_flags = 0;\r\nfor (i = 0; i < 5; regs >>= 4, insn >>= 4, i++)\r\nif (regs & 0xf)\r\nasi->register_usage_flags |= 1 << (insn & 0xf);\r\nreturn INSN_GOOD;\r\n}\r\nstatic enum probes_insn arm_check_regs_ldmstm(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nunsigned int reglist = insn & 0xffff;\r\nunsigned int rn = (insn >> 16) & 0xf;\r\nasi->register_usage_flags = reglist | (1 << rn);\r\nreturn INSN_GOOD;\r\n}\r\nstatic enum probes_insn arm_check_regs_mov_ip_sp(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nasi->register_usage_flags = (1 << 12) | (1<< 13);\r\nreturn INSN_GOOD;\r\n}\r\nstatic enum probes_insn arm_check_regs_ldrdstrd(probes_opcode_t insn,\r\nstruct arch_probes_insn *asi,\r\nconst struct decode_header *h)\r\n{\r\nint rdt = (insn >> 12) & 0xf;\r\narm_check_regs_normal(insn, asi, h);\r\nasi->register_usage_flags |= 1 << (rdt + 1);\r\nreturn INSN_GOOD;\r\n}
