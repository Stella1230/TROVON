static u32 __init armada_38x_get_tclk_freq(void __iomem *sar)\r\n{\r\nu8 tclk_freq_select;\r\ntclk_freq_select = ((readl(sar) >> SAR_A380_TCLK_FREQ_OPT) &\r\nSAR_A380_TCLK_FREQ_OPT_MASK);\r\nreturn armada_38x_tclk_frequencies[tclk_freq_select];\r\n}\r\nstatic u32 __init armada_38x_get_cpu_freq(void __iomem *sar)\r\n{\r\nu8 cpu_freq_select;\r\ncpu_freq_select = ((readl(sar) >> SAR_A380_CPU_DDR_L2_FREQ_OPT) &\r\nSAR_A380_CPU_DDR_L2_FREQ_OPT_MASK);\r\nif (cpu_freq_select >= ARRAY_SIZE(armada_38x_cpu_frequencies)) {\r\npr_err("Selected CPU frequency (%d) unsupported\n",\r\ncpu_freq_select);\r\nreturn 0;\r\n}\r\nreturn armada_38x_cpu_frequencies[cpu_freq_select];\r\n}\r\nstatic void __init armada_38x_get_clk_ratio(\r\nvoid __iomem *sar, int id, int *mult, int *div)\r\n{\r\nu32 opt = ((readl(sar) >> SAR_A380_CPU_DDR_L2_FREQ_OPT) &\r\nSAR_A380_CPU_DDR_L2_FREQ_OPT_MASK);\r\nswitch (id) {\r\ncase A380_CPU_TO_L2:\r\n*mult = armada_38x_cpu_l2_ratios[opt][0];\r\n*div = armada_38x_cpu_l2_ratios[opt][1];\r\nbreak;\r\ncase A380_CPU_TO_DDR:\r\n*mult = armada_38x_cpu_ddr_ratios[opt][0];\r\n*div = armada_38x_cpu_ddr_ratios[opt][1];\r\nbreak;\r\n}\r\n}\r\nstatic void __init armada_38x_coreclk_init(struct device_node *np)\r\n{\r\nmvebu_coreclk_setup(np, &armada_38x_coreclks);\r\n}\r\nstatic void __init armada_38x_clk_gating_init(struct device_node *np)\r\n{\r\nmvebu_clk_gating_setup(np, armada_38x_gating_desc);\r\n}
