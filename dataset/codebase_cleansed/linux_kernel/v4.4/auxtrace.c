static\r\nstruct auxtrace_record *auxtrace_record__init_intel(struct perf_evlist *evlist,\r\nint *err)\r\n{\r\nstruct perf_pmu *intel_pt_pmu;\r\nstruct perf_pmu *intel_bts_pmu;\r\nstruct perf_evsel *evsel;\r\nbool found_pt = false;\r\nbool found_bts = false;\r\nintel_pt_pmu = perf_pmu__find(INTEL_PT_PMU_NAME);\r\nintel_bts_pmu = perf_pmu__find(INTEL_BTS_PMU_NAME);\r\nif (evlist) {\r\nevlist__for_each(evlist, evsel) {\r\nif (intel_pt_pmu &&\r\nevsel->attr.type == intel_pt_pmu->type)\r\nfound_pt = true;\r\nif (intel_bts_pmu &&\r\nevsel->attr.type == intel_bts_pmu->type)\r\nfound_bts = true;\r\n}\r\n}\r\nif (found_pt && found_bts) {\r\npr_err("intel_pt and intel_bts may not be used together\n");\r\n*err = -EINVAL;\r\nreturn NULL;\r\n}\r\nif (found_pt)\r\nreturn intel_pt_recording_init(err);\r\nif (found_bts)\r\nreturn intel_bts_recording_init(err);\r\nreturn NULL;\r\n}\r\nstruct auxtrace_record *auxtrace_record__init(struct perf_evlist *evlist,\r\nint *err)\r\n{\r\nchar buffer[64];\r\nint ret;\r\n*err = 0;\r\nret = get_cpuid(buffer, sizeof(buffer));\r\nif (ret) {\r\n*err = ret;\r\nreturn NULL;\r\n}\r\nif (!strncmp(buffer, "GenuineIntel,", 13))\r\nreturn auxtrace_record__init_intel(evlist, err);\r\nreturn NULL;\r\n}
