static int rcar_du_lvds_connector_get_modes(struct drm_connector *connector)\r\n{\r\nstruct rcar_du_lvds_connector *lvdscon =\r\nto_rcar_lvds_connector(connector);\r\nstruct drm_display_mode *mode;\r\nmode = drm_mode_create(connector->dev);\r\nif (mode == NULL)\r\nreturn 0;\r\nmode->type = DRM_MODE_TYPE_PREFERRED | DRM_MODE_TYPE_DRIVER;\r\ndrm_display_mode_from_videomode(&lvdscon->panel.mode, mode);\r\ndrm_mode_probed_add(connector, mode);\r\nreturn 1;\r\n}\r\nstatic void rcar_du_lvds_connector_destroy(struct drm_connector *connector)\r\n{\r\ndrm_connector_unregister(connector);\r\ndrm_connector_cleanup(connector);\r\n}\r\nstatic enum drm_connector_status\r\nrcar_du_lvds_connector_detect(struct drm_connector *connector, bool force)\r\n{\r\nreturn connector_status_connected;\r\n}\r\nint rcar_du_lvds_connector_init(struct rcar_du_device *rcdu,\r\nstruct rcar_du_encoder *renc,\r\nstruct device_node *np)\r\n{\r\nstruct drm_encoder *encoder = rcar_encoder_to_drm_encoder(renc);\r\nstruct rcar_du_lvds_connector *lvdscon;\r\nstruct drm_connector *connector;\r\nstruct display_timing timing;\r\nint ret;\r\nlvdscon = devm_kzalloc(rcdu->dev, sizeof(*lvdscon), GFP_KERNEL);\r\nif (lvdscon == NULL)\r\nreturn -ENOMEM;\r\nret = of_get_display_timing(np, "panel-timing", &timing);\r\nif (ret < 0)\r\nreturn ret;\r\nvideomode_from_timing(&timing, &lvdscon->panel.mode);\r\nof_property_read_u32(np, "width-mm", &lvdscon->panel.width_mm);\r\nof_property_read_u32(np, "height-mm", &lvdscon->panel.height_mm);\r\nconnector = &lvdscon->connector.connector;\r\nconnector->display_info.width_mm = lvdscon->panel.width_mm;\r\nconnector->display_info.height_mm = lvdscon->panel.height_mm;\r\nret = drm_connector_init(rcdu->ddev, connector, &connector_funcs,\r\nDRM_MODE_CONNECTOR_LVDS);\r\nif (ret < 0)\r\nreturn ret;\r\ndrm_connector_helper_add(connector, &connector_helper_funcs);\r\nret = drm_connector_register(connector);\r\nif (ret < 0)\r\nreturn ret;\r\nconnector->dpms = DRM_MODE_DPMS_OFF;\r\ndrm_object_property_set_value(&connector->base,\r\nrcdu->ddev->mode_config.dpms_property, DRM_MODE_DPMS_OFF);\r\nret = drm_mode_connector_attach_encoder(connector, encoder);\r\nif (ret < 0)\r\nreturn ret;\r\nlvdscon->connector.encoder = renc;\r\nreturn 0;\r\n}
