u32 crc32c(u32 crc, const void *address, unsigned int length)\r\n{\r\nSHASH_DESC_ON_STACK(shash, tfm);\r\nu32 *ctx = (u32 *)shash_desc_ctx(shash);\r\nint err;\r\nshash->tfm = tfm;\r\nshash->flags = 0;\r\n*ctx = crc;\r\nerr = crypto_shash_update(shash, address, length);\r\nBUG_ON(err);\r\nreturn *ctx;\r\n}\r\nstatic int __init libcrc32c_mod_init(void)\r\n{\r\ntfm = crypto_alloc_shash("crc32c", 0, 0);\r\nreturn PTR_ERR_OR_ZERO(tfm);\r\n}\r\nstatic void __exit libcrc32c_mod_fini(void)\r\n{\r\ncrypto_free_shash(tfm);\r\n}
