int\r\nhandle_fpe(struct pt_regs *regs)\r\n{\r\nextern void printbinary(unsigned long x, int nbits);\r\nstruct siginfo si;\r\nunsigned int orig_sw, sw;\r\nint signalcode;\r\n__u64 frcopy[36];\r\nmemcpy(frcopy, regs->fr, sizeof regs->fr);\r\nfrcopy[32] = 0;\r\nmemcpy(&orig_sw, frcopy, sizeof(orig_sw));\r\nif (FPUDEBUG) {\r\nprintk(KERN_DEBUG "FP VZOUICxxxxCQCQCQCQCQCRMxxTDVZOUI ->\n ");\r\nprintbinary(orig_sw, 32);\r\nprintk(KERN_DEBUG "\n");\r\n}\r\nsignalcode = decode_fpu(frcopy, 0x666);\r\nmemcpy(&sw, frcopy, sizeof(sw));\r\nif (FPUDEBUG) {\r\nprintk(KERN_DEBUG "VZOUICxxxxCQCQCQCQCQCRMxxTDVZOUI decode_fpu returns %d|0x%x\n",\r\nsignalcode >> 24, signalcode & 0xffffff);\r\nprintbinary(sw, 32);\r\nprintk(KERN_DEBUG "\n");\r\n}\r\nmemcpy(regs->fr, frcopy, sizeof regs->fr);\r\nif (signalcode != 0) {\r\nsi.si_signo = signalcode >> 24;\r\nsi.si_errno = 0;\r\nsi.si_code = signalcode & 0xffffff;\r\nsi.si_addr = (void __user *) regs->iaoq[0];\r\nforce_sig_info(si.si_signo, &si, current);\r\nreturn -1;\r\n}\r\nreturn signalcode ? -1 : 0;\r\n}
