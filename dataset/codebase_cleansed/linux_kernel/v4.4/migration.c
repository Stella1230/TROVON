void irq_move_masked_irq(struct irq_data *idata)\r\n{\r\nstruct irq_desc *desc = irq_data_to_desc(idata);\r\nstruct irq_chip *chip = desc->irq_data.chip;\r\nif (likely(!irqd_is_setaffinity_pending(&desc->irq_data)))\r\nreturn;\r\nirqd_clr_move_pending(&desc->irq_data);\r\nif (irqd_is_per_cpu(&desc->irq_data)) {\r\nWARN_ON(1);\r\nreturn;\r\n}\r\nif (unlikely(cpumask_empty(desc->pending_mask)))\r\nreturn;\r\nif (!chip->irq_set_affinity)\r\nreturn;\r\nassert_raw_spin_locked(&desc->lock);\r\nif (cpumask_any_and(desc->pending_mask, cpu_online_mask) < nr_cpu_ids)\r\nirq_do_set_affinity(&desc->irq_data, desc->pending_mask, false);\r\ncpumask_clear(desc->pending_mask);\r\n}\r\nvoid irq_move_irq(struct irq_data *idata)\r\n{\r\nbool masked;\r\nidata = irq_desc_get_irq_data(irq_data_to_desc(idata));\r\nif (likely(!irqd_is_setaffinity_pending(idata)))\r\nreturn;\r\nif (unlikely(irqd_irq_disabled(idata)))\r\nreturn;\r\nmasked = irqd_irq_masked(idata);\r\nif (!masked)\r\nidata->chip->irq_mask(idata);\r\nirq_move_masked_irq(idata);\r\nif (!masked)\r\nidata->chip->irq_unmask(idata);\r\n}
