static bool rn5t618_volatile_reg(struct device *dev, unsigned int reg)\r\n{\r\nswitch (reg) {\r\ncase RN5T618_WATCHDOGCNT:\r\ncase RN5T618_DCIRQ:\r\ncase RN5T618_ILIMDATAH ... RN5T618_AIN0DATAL:\r\ncase RN5T618_IR_ADC1 ... RN5T618_IR_ADC3:\r\ncase RN5T618_IR_GPR:\r\ncase RN5T618_IR_GPF:\r\ncase RN5T618_MON_IOIN:\r\ncase RN5T618_INTMON:\r\nreturn true;\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic void rn5t618_power_off(void)\r\n{\r\nregmap_update_bits(rn5t618_pm_power_off->regmap, RN5T618_REPCNT,\r\nRN5T618_REPCNT_REPWRON, 0);\r\nregmap_update_bits(rn5t618_pm_power_off->regmap, RN5T618_SLPCNT,\r\nRN5T618_SLPCNT_SWPWROFF, RN5T618_SLPCNT_SWPWROFF);\r\n}\r\nstatic int rn5t618_i2c_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct rn5t618 *priv;\r\nint ret;\r\npriv = devm_kzalloc(&i2c->dev, sizeof(*priv), GFP_KERNEL);\r\nif (!priv)\r\nreturn -ENOMEM;\r\ni2c_set_clientdata(i2c, priv);\r\npriv->regmap = devm_regmap_init_i2c(i2c, &rn5t618_regmap_config);\r\nif (IS_ERR(priv->regmap)) {\r\nret = PTR_ERR(priv->regmap);\r\ndev_err(&i2c->dev, "regmap init failed: %d\n", ret);\r\nreturn ret;\r\n}\r\nret = mfd_add_devices(&i2c->dev, -1, rn5t618_cells,\r\nARRAY_SIZE(rn5t618_cells), NULL, 0, NULL);\r\nif (ret) {\r\ndev_err(&i2c->dev, "failed to add sub-devices: %d\n", ret);\r\nreturn ret;\r\n}\r\nif (!pm_power_off) {\r\nrn5t618_pm_power_off = priv;\r\npm_power_off = rn5t618_power_off;\r\n}\r\nreturn 0;\r\n}\r\nstatic int rn5t618_i2c_remove(struct i2c_client *i2c)\r\n{\r\nstruct rn5t618 *priv = i2c_get_clientdata(i2c);\r\nif (priv == rn5t618_pm_power_off) {\r\nrn5t618_pm_power_off = NULL;\r\npm_power_off = NULL;\r\n}\r\nmfd_remove_devices(&i2c->dev);\r\nreturn 0;\r\n}
