unsigned int __init pc873xx_get_base()\r\n{\r\nreturn base;\r\n}\r\nchar *__init pc873xx_get_model()\r\n{\r\nreturn pc873xx_names[model];\r\n}\r\nstatic unsigned char __init pc873xx_read(unsigned int base, int reg)\r\n{\r\noutb(reg, base);\r\nreturn inb(base + 1);\r\n}\r\nstatic void __init pc873xx_write(unsigned int base, int reg, unsigned char data)\r\n{\r\nunsigned long flags;\r\nlocal_irq_save(flags);\r\noutb(reg, base);\r\noutb(data, base + 1);\r\noutb(data, base + 1);\r\nlocal_irq_restore(flags);\r\n}\r\nint __init pc873xx_probe(void)\r\n{\r\nint val, index = 0;\r\nwhile ((base = pc873xx_probelist[index++])) {\r\nif (request_region(base, 2, "Super IO PC873xx") == NULL)\r\ncontinue;\r\nval = pc873xx_read(base, REG_SID);\r\nif ((val & 0xf0) == 0x10) {\r\nmodel = PC87332;\r\nbreak;\r\n} else if ((val & 0xf8) == 0x70) {\r\nmodel = PC87306;\r\nbreak;\r\n} else if ((val & 0xf8) == 0x50) {\r\nmodel = PC87334;\r\nbreak;\r\n} else if ((val & 0xf8) == 0x40) {\r\nmodel = PC87303;\r\nbreak;\r\n}\r\nrelease_region(base, 2);\r\n}\r\nreturn (base == 0) ? -1 : 1;\r\n}\r\nvoid __init pc873xx_enable_epp19(void)\r\n{\r\nunsigned char data;\r\nprintk(KERN_INFO "PC873xx enabling EPP v1.9\n");\r\ndata = pc873xx_read(base, REG_PCR);\r\npc873xx_write(base, REG_PCR, (data & 0xFC) | 0x02);\r\n}\r\nvoid __init pc873xx_enable_ide(void)\r\n{\r\nunsigned char data;\r\nprintk(KERN_INFO "PC873xx enabling IDE interrupt\n");\r\ndata = pc873xx_read(base, REG_FER);\r\npc873xx_write(base, REG_FER, data | 0x40);\r\n}
