static int find_vdso_map(void **start, void **end)\r\n{\r\nFILE *maps;\r\nchar line[128];\r\nint found = 0;\r\nmaps = fopen("/proc/self/maps", "r");\r\nif (!maps) {\r\nfprintf(stderr, "vdso: cannot open maps\n");\r\nreturn -1;\r\n}\r\nwhile (!found && fgets(line, sizeof(line), maps)) {\r\nint m = -1;\r\nif (2 != sscanf(line, "%p-%p r-xp %*x %*x:%*x %*u %n",\r\nstart, end, &m))\r\ncontinue;\r\nif (m < 0)\r\ncontinue;\r\nif (!strncmp(&line[m], VDSO__MAP_NAME,\r\nsizeof(VDSO__MAP_NAME) - 1))\r\nfound = 1;\r\n}\r\nfclose(maps);\r\nreturn !found;\r\n}
