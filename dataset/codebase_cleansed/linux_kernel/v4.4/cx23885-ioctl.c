int cx23885_g_chip_info(struct file *file, void *fh,\r\nstruct v4l2_dbg_chip_info *chip)\r\n{\r\nstruct cx23885_dev *dev = video_drvdata(file);\r\nif (chip->match.addr > 1)\r\nreturn -EINVAL;\r\nif (chip->match.addr == 1) {\r\nif (dev->v4l_device == NULL)\r\nreturn -EINVAL;\r\nstrlcpy(chip->name, "cx23417", sizeof(chip->name));\r\n} else {\r\nstrlcpy(chip->name, dev->v4l2_dev.name, sizeof(chip->name));\r\n}\r\nreturn 0;\r\n}\r\nstatic int cx23417_g_register(struct cx23885_dev *dev,\r\nstruct v4l2_dbg_register *reg)\r\n{\r\nu32 value;\r\nif (dev->v4l_device == NULL)\r\nreturn -EINVAL;\r\nif ((reg->reg & 0x3) != 0 || reg->reg >= 0x10000)\r\nreturn -EINVAL;\r\nif (mc417_register_read(dev, (u16) reg->reg, &value))\r\nreturn -EINVAL;\r\nreg->size = 4;\r\nreg->val = value;\r\nreturn 0;\r\n}\r\nint cx23885_g_register(struct file *file, void *fh,\r\nstruct v4l2_dbg_register *reg)\r\n{\r\nstruct cx23885_dev *dev = video_drvdata(file);\r\nif (reg->match.addr > 1)\r\nreturn -EINVAL;\r\nif (reg->match.addr)\r\nreturn cx23417_g_register(dev, reg);\r\nif ((reg->reg & 0x3) != 0 || reg->reg >= pci_resource_len(dev->pci, 0))\r\nreturn -EINVAL;\r\nreg->size = 4;\r\nreg->val = cx_read(reg->reg);\r\nreturn 0;\r\n}\r\nstatic int cx23417_s_register(struct cx23885_dev *dev,\r\nconst struct v4l2_dbg_register *reg)\r\n{\r\nif (dev->v4l_device == NULL)\r\nreturn -EINVAL;\r\nif ((reg->reg & 0x3) != 0 || reg->reg >= 0x10000)\r\nreturn -EINVAL;\r\nif (mc417_register_write(dev, (u16) reg->reg, (u32) reg->val))\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nint cx23885_s_register(struct file *file, void *fh,\r\nconst struct v4l2_dbg_register *reg)\r\n{\r\nstruct cx23885_dev *dev = video_drvdata(file);\r\nif (reg->match.addr > 1)\r\nreturn -EINVAL;\r\nif (reg->match.addr)\r\nreturn cx23417_s_register(dev, reg);\r\nif ((reg->reg & 0x3) != 0 || reg->reg >= pci_resource_len(dev->pci, 0))\r\nreturn -EINVAL;\r\ncx_write(reg->reg, reg->val);\r\nreturn 0;\r\n}
