static void __init rcar_gen2_sysc_init(u32 syscier)\r\n{\r\nvoid __iomem *base = rcar_sysc_init(0xe6180000);\r\niowrite32(syscier, base + SYSCIER);\r\niowrite32(0, base + SYSCIMR);\r\n}\r\nstatic inline void rcar_gen2_sysc_init(u32 syscier) {}\r\nvoid __init rcar_gen2_pm_init(void)\r\n{\r\nvoid __iomem *p;\r\nu32 bar;\r\nstatic int once;\r\nstruct device_node *np, *cpus;\r\nbool has_a7 = false;\r\nbool has_a15 = false;\r\nphys_addr_t boot_vector_addr = 0;\r\nu32 syscier = 0;\r\nif (once++)\r\nreturn;\r\ncpus = of_find_node_by_path("/cpus");\r\nif (!cpus)\r\nreturn;\r\nfor_each_child_of_node(cpus, np) {\r\nif (of_device_is_compatible(np, "arm,cortex-a15"))\r\nhas_a15 = true;\r\nelse if (of_device_is_compatible(np, "arm,cortex-a7"))\r\nhas_a7 = true;\r\n}\r\nif (of_machine_is_compatible("renesas,r8a7790")) {\r\nboot_vector_addr = MERAM;\r\nsyscier = 0x013111ef;\r\n} else if (of_machine_is_compatible("renesas,r8a7791")) {\r\nboot_vector_addr = RAM;\r\nsyscier = 0x00111003;\r\n}\r\np = ioremap_nocache(boot_vector_addr, shmobile_boot_size);\r\nmemcpy_toio(p, shmobile_boot_vector, shmobile_boot_size);\r\niounmap(p);\r\np = ioremap_nocache(RST, 0x63);\r\nbar = (boot_vector_addr >> 8) & 0xfffffc00;\r\nif (has_a15) {\r\nwritel_relaxed(bar, p + CA15BAR);\r\nwritel_relaxed(bar | 0x10, p + CA15BAR);\r\nwritel_relaxed((readl_relaxed(p + CA15RESCNT) & ~0x0f) |\r\n0xa5a50000, p + CA15RESCNT);\r\n}\r\nif (has_a7) {\r\nwritel_relaxed(bar, p + CA7BAR);\r\nwritel_relaxed(bar | 0x10, p + CA7BAR);\r\nwritel_relaxed((readl_relaxed(p + CA7RESCNT) & ~0x0f) |\r\n0x5a5a0000, p + CA7RESCNT);\r\n}\r\niounmap(p);\r\nrcar_gen2_sysc_init(syscier);\r\nshmobile_smp_apmu_suspend_init();\r\n}
