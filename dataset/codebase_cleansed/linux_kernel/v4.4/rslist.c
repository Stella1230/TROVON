acpi_status\r\nacpi_rs_convert_aml_to_resources(u8 * aml,\r\nu32 length,\r\nu32 offset, u8 resource_index, void **context)\r\n{\r\nstruct acpi_resource **resource_ptr =\r\nACPI_CAST_INDIRECT_PTR(struct acpi_resource, context);\r\nstruct acpi_resource *resource;\r\nunion aml_resource *aml_resource;\r\nstruct acpi_rsconvert_info *conversion_table;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(rs_convert_aml_to_resources);\r\nresource = *resource_ptr;\r\nif (ACPI_IS_MISALIGNED(resource)) {\r\nACPI_WARNING((AE_INFO,\r\n"Misaligned resource pointer %p", resource));\r\n}\r\naml_resource = ACPI_CAST_PTR(union aml_resource, aml);\r\nif (acpi_ut_get_resource_type(aml) == ACPI_RESOURCE_NAME_SERIAL_BUS) {\r\nif (aml_resource->common_serial_bus.type >\r\nAML_RESOURCE_MAX_SERIALBUSTYPE) {\r\nconversion_table = NULL;\r\n} else {\r\nconversion_table =\r\nacpi_gbl_convert_resource_serial_bus_dispatch\r\n[aml_resource->common_serial_bus.type];\r\n}\r\n} else {\r\nconversion_table =\r\nacpi_gbl_get_resource_dispatch[resource_index];\r\n}\r\nif (!conversion_table) {\r\nACPI_ERROR((AE_INFO,\r\n"Invalid/unsupported resource descriptor: Type 0x%2.2X",\r\nresource_index));\r\nreturn_ACPI_STATUS(AE_AML_INVALID_RESOURCE_TYPE);\r\n}\r\nstatus =\r\nacpi_rs_convert_aml_to_resource(resource, aml_resource,\r\nconversion_table);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Could not convert AML resource (Type 0x%X)",\r\n*aml));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_RESOURCES,\r\n"Type %.2X, AmlLength %.2X InternalLength %.2X\n",\r\nacpi_ut_get_resource_type(aml), length,\r\nresource->length));\r\n*resource_ptr = ACPI_NEXT_RESOURCE(resource);\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nacpi_status\r\nacpi_rs_convert_resources_to_aml(struct acpi_resource *resource,\r\nacpi_size aml_size_needed, u8 * output_buffer)\r\n{\r\nu8 *aml = output_buffer;\r\nu8 *end_aml = output_buffer + aml_size_needed;\r\nstruct acpi_rsconvert_info *conversion_table;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(rs_convert_resources_to_aml);\r\nwhile (aml < end_aml) {\r\nif (resource->type > ACPI_RESOURCE_TYPE_MAX) {\r\nACPI_ERROR((AE_INFO,\r\n"Invalid descriptor type (0x%X) in resource list",\r\nresource->type));\r\nreturn_ACPI_STATUS(AE_BAD_DATA);\r\n}\r\nif (!resource->length) {\r\nACPI_ERROR((AE_INFO,\r\n"Invalid zero length descriptor in resource list\n"));\r\nreturn_ACPI_STATUS(AE_AML_BAD_RESOURCE_LENGTH);\r\n}\r\nif (resource->type == ACPI_RESOURCE_TYPE_SERIAL_BUS) {\r\nif (resource->data.common_serial_bus.type >\r\nAML_RESOURCE_MAX_SERIALBUSTYPE) {\r\nconversion_table = NULL;\r\n} else {\r\nconversion_table =\r\nacpi_gbl_convert_resource_serial_bus_dispatch\r\n[resource->data.common_serial_bus.type];\r\n}\r\n} else {\r\nconversion_table =\r\nacpi_gbl_set_resource_dispatch[resource->type];\r\n}\r\nif (!conversion_table) {\r\nACPI_ERROR((AE_INFO,\r\n"Invalid/unsupported resource descriptor: Type 0x%2.2X",\r\nresource->type));\r\nreturn_ACPI_STATUS(AE_AML_INVALID_RESOURCE_TYPE);\r\n}\r\nstatus = acpi_rs_convert_resource_to_aml(resource,\r\nACPI_CAST_PTR(union\r\naml_resource,\r\naml),\r\nconversion_table);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_EXCEPTION((AE_INFO, status,\r\n"Could not convert resource (type 0x%X) to AML",\r\nresource->type));\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatus = acpi_ut_validate_resource(NULL,\r\nACPI_CAST_PTR(union\r\naml_resource,\r\naml), NULL);\r\nif (ACPI_FAILURE(status)) {\r\nreturn_ACPI_STATUS(status);\r\n}\r\nif (resource->type == ACPI_RESOURCE_TYPE_END_TAG) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\naml += acpi_ut_get_descriptor_length(aml);\r\nresource = ACPI_NEXT_RESOURCE(resource);\r\n}\r\nreturn_ACPI_STATUS(AE_AML_NO_RESOURCE_END_TAG);\r\n}
