acpi_status\r\nacpi_ut_add_address_range(acpi_adr_space_type space_id,\r\nacpi_physical_address address,\r\nu32 length, struct acpi_namespace_node *region_node)\r\n{\r\nstruct acpi_address_range *range_info;\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(ut_add_address_range);\r\nif ((space_id != ACPI_ADR_SPACE_SYSTEM_MEMORY) &&\r\n(space_id != ACPI_ADR_SPACE_SYSTEM_IO)) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nrange_info = ACPI_ALLOCATE(sizeof(struct acpi_address_range));\r\nif (!range_info) {\r\nreturn_ACPI_STATUS(AE_NO_MEMORY);\r\n}\r\nrange_info->start_address = address;\r\nrange_info->end_address = (address + length - 1);\r\nrange_info->region_node = region_node;\r\nstatus = acpi_ut_acquire_mutex(ACPI_MTX_NAMESPACE);\r\nif (ACPI_FAILURE(status)) {\r\nACPI_FREE(range_info);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nrange_info->next = acpi_gbl_address_range_list[space_id];\r\nacpi_gbl_address_range_list[space_id] = range_info;\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"\nAdded [%4.4s] address range: 0x%8.8X%8.8X-0x%8.8X%8.8X\n",\r\nacpi_ut_get_node_name(range_info->region_node),\r\nACPI_FORMAT_UINT64(address),\r\nACPI_FORMAT_UINT64(range_info->end_address)));\r\n(void)acpi_ut_release_mutex(ACPI_MTX_NAMESPACE);\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nvoid\r\nacpi_ut_remove_address_range(acpi_adr_space_type space_id,\r\nstruct acpi_namespace_node *region_node)\r\n{\r\nstruct acpi_address_range *range_info;\r\nstruct acpi_address_range *prev;\r\nACPI_FUNCTION_TRACE(ut_remove_address_range);\r\nif ((space_id != ACPI_ADR_SPACE_SYSTEM_MEMORY) &&\r\n(space_id != ACPI_ADR_SPACE_SYSTEM_IO)) {\r\nreturn_VOID;\r\n}\r\nrange_info = prev = acpi_gbl_address_range_list[space_id];\r\nwhile (range_info) {\r\nif (range_info->region_node == region_node) {\r\nif (range_info == prev) {\r\nacpi_gbl_address_range_list[space_id] =\r\nrange_info->next;\r\n} else {\r\nprev->next = range_info->next;\r\n}\r\nACPI_DEBUG_PRINT((ACPI_DB_NAMES,\r\n"\nRemoved [%4.4s] address range: 0x%8.8X%8.8X-0x%8.8X%8.8X\n",\r\nacpi_ut_get_node_name(range_info->\r\nregion_node),\r\nACPI_FORMAT_UINT64(range_info->\r\nstart_address),\r\nACPI_FORMAT_UINT64(range_info->\r\nend_address)));\r\nACPI_FREE(range_info);\r\nreturn_VOID;\r\n}\r\nprev = range_info;\r\nrange_info = range_info->next;\r\n}\r\nreturn_VOID;\r\n}\r\nu32\r\nacpi_ut_check_address_range(acpi_adr_space_type space_id,\r\nacpi_physical_address address, u32 length, u8 warn)\r\n{\r\nstruct acpi_address_range *range_info;\r\nacpi_physical_address end_address;\r\nchar *pathname;\r\nu32 overlap_count = 0;\r\nACPI_FUNCTION_TRACE(ut_check_address_range);\r\nif ((space_id != ACPI_ADR_SPACE_SYSTEM_MEMORY) &&\r\n(space_id != ACPI_ADR_SPACE_SYSTEM_IO)) {\r\nreturn_UINT32(0);\r\n}\r\nrange_info = acpi_gbl_address_range_list[space_id];\r\nend_address = address + length - 1;\r\nwhile (range_info) {\r\nif ((address <= range_info->end_address) &&\r\n(end_address >= range_info->start_address)) {\r\noverlap_count++;\r\nif (warn) {\r\npathname =\r\nacpi_ns_get_external_pathname(range_info->\r\nregion_node);\r\nACPI_WARNING((AE_INFO,\r\n"%s range 0x%8.8X%8.8X-0x%8.8X%8.8X conflicts with OpRegion 0x%8.8X%8.8X-0x%8.8X%8.8X (%s)",\r\nacpi_ut_get_region_name(space_id),\r\nACPI_FORMAT_UINT64(address),\r\nACPI_FORMAT_UINT64(end_address),\r\nACPI_FORMAT_UINT64(range_info->\r\nstart_address),\r\nACPI_FORMAT_UINT64(range_info->\r\nend_address),\r\npathname));\r\nACPI_FREE(pathname);\r\n}\r\n}\r\nrange_info = range_info->next;\r\n}\r\nreturn_UINT32(overlap_count);\r\n}\r\nvoid acpi_ut_delete_address_lists(void)\r\n{\r\nstruct acpi_address_range *next;\r\nstruct acpi_address_range *range_info;\r\nint i;\r\nfor (i = 0; i < ACPI_ADDRESS_RANGE_MAX; i++) {\r\nnext = acpi_gbl_address_range_list[i];\r\nwhile (next) {\r\nrange_info = next;\r\nnext = range_info->next;\r\nACPI_FREE(range_info);\r\n}\r\nacpi_gbl_address_range_list[i] = NULL;\r\n}\r\n}
