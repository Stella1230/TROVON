static int compat_i915_getparam(struct file *file, unsigned int cmd,\r\nunsigned long arg)\r\n{\r\nstruct drm_i915_getparam32 req32;\r\ndrm_i915_getparam_t __user *request;\r\nif (copy_from_user(&req32, (void __user *)arg, sizeof(req32)))\r\nreturn -EFAULT;\r\nrequest = compat_alloc_user_space(sizeof(*request));\r\nif (!access_ok(VERIFY_WRITE, request, sizeof(*request))\r\n|| __put_user(req32.param, &request->param)\r\n|| __put_user((void __user *)(unsigned long)req32.value,\r\n&request->value))\r\nreturn -EFAULT;\r\nreturn drm_ioctl(file, DRM_IOCTL_I915_GETPARAM,\r\n(unsigned long)request);\r\n}\r\nlong i915_compat_ioctl(struct file *filp, unsigned int cmd, unsigned long arg)\r\n{\r\nunsigned int nr = DRM_IOCTL_NR(cmd);\r\ndrm_ioctl_compat_t *fn = NULL;\r\nint ret;\r\nif (nr < DRM_COMMAND_BASE || nr >= DRM_COMMAND_END)\r\nreturn drm_compat_ioctl(filp, cmd, arg);\r\nif (nr < DRM_COMMAND_BASE + ARRAY_SIZE(i915_compat_ioctls))\r\nfn = i915_compat_ioctls[nr - DRM_COMMAND_BASE];\r\nif (fn != NULL)\r\nret = (*fn) (filp, cmd, arg);\r\nelse\r\nret = drm_ioctl(filp, cmd, arg);\r\nreturn ret;\r\n}
