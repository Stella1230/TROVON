static int\r\nwebcam_config_bind(struct usb_configuration *c)\r\n{\r\nint status = 0;\r\nf_uvc = usb_get_function(fi_uvc);\r\nif (IS_ERR(f_uvc))\r\nreturn PTR_ERR(f_uvc);\r\nstatus = usb_add_function(c, f_uvc);\r\nif (status < 0)\r\nusb_put_function(f_uvc);\r\nreturn status;\r\n}\r\nstatic int\r\nwebcam_unbind(struct usb_composite_dev *cdev)\r\n{\r\nif (!IS_ERR_OR_NULL(f_uvc))\r\nusb_put_function(f_uvc);\r\nif (!IS_ERR_OR_NULL(fi_uvc))\r\nusb_put_function_instance(fi_uvc);\r\nreturn 0;\r\n}\r\nstatic int\r\nwebcam_bind(struct usb_composite_dev *cdev)\r\n{\r\nstruct f_uvc_opts *uvc_opts;\r\nint ret;\r\nfi_uvc = usb_get_function_instance("uvc");\r\nif (IS_ERR(fi_uvc))\r\nreturn PTR_ERR(fi_uvc);\r\nuvc_opts = container_of(fi_uvc, struct f_uvc_opts, func_inst);\r\nuvc_opts->streaming_interval = streaming_interval;\r\nuvc_opts->streaming_maxpacket = streaming_maxpacket;\r\nuvc_opts->streaming_maxburst = streaming_maxburst;\r\nuvc_set_trace_param(trace);\r\nuvc_opts->fs_control = uvc_fs_control_cls;\r\nuvc_opts->ss_control = uvc_ss_control_cls;\r\nuvc_opts->fs_streaming = uvc_fs_streaming_cls;\r\nuvc_opts->hs_streaming = uvc_hs_streaming_cls;\r\nuvc_opts->ss_streaming = uvc_ss_streaming_cls;\r\nret = usb_string_ids_tab(cdev, webcam_strings);\r\nif (ret < 0)\r\ngoto error;\r\nwebcam_device_descriptor.iManufacturer =\r\nwebcam_strings[USB_GADGET_MANUFACTURER_IDX].id;\r\nwebcam_device_descriptor.iProduct =\r\nwebcam_strings[USB_GADGET_PRODUCT_IDX].id;\r\nwebcam_config_driver.iConfiguration =\r\nwebcam_strings[STRING_DESCRIPTION_IDX].id;\r\nif ((ret = usb_add_config(cdev, &webcam_config_driver,\r\nwebcam_config_bind)) < 0)\r\ngoto error;\r\nusb_composite_overwrite_options(cdev, &coverwrite);\r\nINFO(cdev, "Webcam Video Gadget\n");\r\nreturn 0;\r\nerror:\r\nusb_put_function_instance(fi_uvc);\r\nreturn ret;\r\n}
