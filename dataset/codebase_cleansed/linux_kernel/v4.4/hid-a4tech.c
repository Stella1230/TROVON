static int a4_input_mapped(struct hid_device *hdev, struct hid_input *hi,\r\nstruct hid_field *field, struct hid_usage *usage,\r\nunsigned long **bit, int *max)\r\n{\r\nstruct a4tech_sc *a4 = hid_get_drvdata(hdev);\r\nif (usage->type == EV_REL && usage->code == REL_WHEEL)\r\nset_bit(REL_HWHEEL, *bit);\r\nif ((a4->quirks & A4_2WHEEL_MOUSE_HACK_7) && usage->hid == 0x00090007)\r\nreturn -1;\r\nreturn 0;\r\n}\r\nstatic int a4_event(struct hid_device *hdev, struct hid_field *field,\r\nstruct hid_usage *usage, __s32 value)\r\n{\r\nstruct a4tech_sc *a4 = hid_get_drvdata(hdev);\r\nstruct input_dev *input;\r\nif (!(hdev->claimed & HID_CLAIMED_INPUT) || !field->hidinput ||\r\n!usage->type)\r\nreturn 0;\r\ninput = field->hidinput->input;\r\nif (a4->quirks & A4_2WHEEL_MOUSE_HACK_B8) {\r\nif (usage->type == EV_REL && usage->code == REL_WHEEL) {\r\na4->delayed_value = value;\r\nreturn 1;\r\n}\r\nif (usage->hid == 0x000100b8) {\r\ninput_event(input, EV_REL, value ? REL_HWHEEL :\r\nREL_WHEEL, a4->delayed_value);\r\nreturn 1;\r\n}\r\n}\r\nif ((a4->quirks & A4_2WHEEL_MOUSE_HACK_7) && usage->hid == 0x00090007) {\r\na4->hw_wheel = !!value;\r\nreturn 1;\r\n}\r\nif (usage->code == REL_WHEEL && a4->hw_wheel) {\r\ninput_event(input, usage->type, REL_HWHEEL, value);\r\nreturn 1;\r\n}\r\nreturn 0;\r\n}\r\nstatic int a4_probe(struct hid_device *hdev, const struct hid_device_id *id)\r\n{\r\nstruct a4tech_sc *a4;\r\nint ret;\r\na4 = devm_kzalloc(&hdev->dev, sizeof(*a4), GFP_KERNEL);\r\nif (a4 == NULL) {\r\nhid_err(hdev, "can't alloc device descriptor\n");\r\nreturn -ENOMEM;\r\n}\r\na4->quirks = id->driver_data;\r\nhid_set_drvdata(hdev, a4);\r\nret = hid_parse(hdev);\r\nif (ret) {\r\nhid_err(hdev, "parse failed\n");\r\nreturn ret;\r\n}\r\nret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\r\nif (ret) {\r\nhid_err(hdev, "hw start failed\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}
