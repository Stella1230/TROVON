static int twl6040gpo_get(struct gpio_chip *chip, unsigned offset)\r\n{\r\nstruct twl6040 *twl6040 = dev_get_drvdata(chip->dev->parent);\r\nint ret = 0;\r\nret = twl6040_reg_read(twl6040, TWL6040_REG_GPOCTL);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn (ret >> offset) & 1;\r\n}\r\nstatic int twl6040gpo_direction_out(struct gpio_chip *chip, unsigned offset,\r\nint value)\r\n{\r\nreturn 0;\r\n}\r\nstatic void twl6040gpo_set(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\nstruct twl6040 *twl6040 = dev_get_drvdata(chip->dev->parent);\r\nint ret;\r\nu8 gpoctl;\r\nret = twl6040_reg_read(twl6040, TWL6040_REG_GPOCTL);\r\nif (ret < 0)\r\nreturn;\r\nif (value)\r\ngpoctl = ret | (1 << offset);\r\nelse\r\ngpoctl = ret & ~(1 << offset);\r\ntwl6040_reg_write(twl6040, TWL6040_REG_GPOCTL, gpoctl);\r\n}\r\nstatic int gpo_twl6040_probe(struct platform_device *pdev)\r\n{\r\nstruct device *twl6040_core_dev = pdev->dev.parent;\r\nstruct twl6040 *twl6040 = dev_get_drvdata(twl6040_core_dev);\r\nint ret;\r\ntwl6040gpo_chip.base = -1;\r\nif (twl6040_get_revid(twl6040) < TWL6041_REV_ES2_0)\r\ntwl6040gpo_chip.ngpio = 3;\r\nelse\r\ntwl6040gpo_chip.ngpio = 1;\r\ntwl6040gpo_chip.dev = &pdev->dev;\r\n#ifdef CONFIG_OF_GPIO\r\ntwl6040gpo_chip.of_node = twl6040_core_dev->of_node;\r\n#endif\r\nret = gpiochip_add(&twl6040gpo_chip);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "could not register gpiochip, %d\n", ret);\r\ntwl6040gpo_chip.ngpio = 0;\r\n}\r\nreturn ret;\r\n}\r\nstatic int gpo_twl6040_remove(struct platform_device *pdev)\r\n{\r\ngpiochip_remove(&twl6040gpo_chip);\r\nreturn 0;\r\n}
