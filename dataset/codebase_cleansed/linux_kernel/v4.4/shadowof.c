static u32\r\nof_read(void *data, u32 offset, u32 length, struct nvkm_bios *bios)\r\n{\r\nstruct priv *priv = data;\r\nif (offset < priv->size) {\r\nlength = min_t(u32, length, priv->size - offset);\r\nmemcpy_fromio(bios->data + offset, priv->data + offset, length);\r\nreturn length;\r\n}\r\nreturn 0;\r\n}\r\nstatic u32\r\nof_size(void *data)\r\n{\r\nstruct priv *priv = data;\r\nreturn priv->size;\r\n}\r\nstatic void *\r\nof_init(struct nvkm_bios *bios, const char *name)\r\n{\r\nstruct nvkm_device *device = bios->subdev.device;\r\nstruct pci_dev *pdev = device->func->pci(device)->pdev;\r\nstruct device_node *dn;\r\nstruct priv *priv;\r\nif (!(dn = pci_device_to_OF_node(pdev)))\r\nreturn ERR_PTR(-ENODEV);\r\nif (!(priv = kzalloc(sizeof(*priv), GFP_KERNEL)))\r\nreturn ERR_PTR(-ENOMEM);\r\nif ((priv->data = of_get_property(dn, "NVDA,BMP", &priv->size)))\r\nreturn priv;\r\nkfree(priv);\r\nreturn ERR_PTR(-EINVAL);\r\n}
