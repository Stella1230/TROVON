static void dsi_20nm_dphy_set_timing(struct msm_dsi_phy *phy,\r\nstruct msm_dsi_dphy_timing *timing)\r\n{\r\nvoid __iomem *base = phy->base;\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_0,\r\nDSI_20nm_PHY_TIMING_CTRL_0_CLK_ZERO(timing->clk_zero));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_1,\r\nDSI_20nm_PHY_TIMING_CTRL_1_CLK_TRAIL(timing->clk_trail));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_2,\r\nDSI_20nm_PHY_TIMING_CTRL_2_CLK_PREPARE(timing->clk_prepare));\r\nif (timing->clk_zero & BIT(8))\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_3,\r\nDSI_20nm_PHY_TIMING_CTRL_3_CLK_ZERO_8);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_4,\r\nDSI_20nm_PHY_TIMING_CTRL_4_HS_EXIT(timing->hs_exit));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_5,\r\nDSI_20nm_PHY_TIMING_CTRL_5_HS_ZERO(timing->hs_zero));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_6,\r\nDSI_20nm_PHY_TIMING_CTRL_6_HS_PREPARE(timing->hs_prepare));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_7,\r\nDSI_20nm_PHY_TIMING_CTRL_7_HS_TRAIL(timing->hs_trail));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_8,\r\nDSI_20nm_PHY_TIMING_CTRL_8_HS_RQST(timing->hs_rqst));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_9,\r\nDSI_20nm_PHY_TIMING_CTRL_9_TA_GO(timing->ta_go) |\r\nDSI_20nm_PHY_TIMING_CTRL_9_TA_SURE(timing->ta_sure));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_10,\r\nDSI_20nm_PHY_TIMING_CTRL_10_TA_GET(timing->ta_get));\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_TIMING_CTRL_11,\r\nDSI_20nm_PHY_TIMING_CTRL_11_TRIG3_CMD(0));\r\n}\r\nstatic void dsi_20nm_phy_regulator_ctrl(struct msm_dsi_phy *phy, bool enable)\r\n{\r\nvoid __iomem *base = phy->reg_base;\r\nif (!enable) {\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CAL_PWR_CFG, 0);\r\nreturn;\r\n}\r\nif (phy->regulator_ldo_mode) {\r\ndsi_phy_write(phy->base + REG_DSI_20nm_PHY_LDO_CNTRL, 0x1d);\r\nreturn;\r\n}\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CTRL_1, 0x03);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CTRL_2, 0x03);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CTRL_3, 0x00);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CTRL_4, 0x20);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CAL_PWR_CFG, 0x01);\r\ndsi_phy_write(phy->base + REG_DSI_20nm_PHY_LDO_CNTRL, 0x00);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_REGULATOR_CTRL_0, 0x03);\r\n}\r\nstatic int dsi_20nm_phy_enable(struct msm_dsi_phy *phy, int src_pll_id,\r\nconst unsigned long bit_rate, const unsigned long esc_rate)\r\n{\r\nstruct msm_dsi_dphy_timing *timing = &phy->timing;\r\nint i;\r\nvoid __iomem *base = phy->base;\r\nu32 cfg_4[4] = {0x20, 0x40, 0x20, 0x00};\r\nDBG("");\r\nif (msm_dsi_dphy_timing_calc(timing, bit_rate, esc_rate)) {\r\ndev_err(&phy->pdev->dev,\r\n"%s: D-PHY timing calculation failed\n", __func__);\r\nreturn -EINVAL;\r\n}\r\ndsi_20nm_phy_regulator_ctrl(phy, true);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_STRENGTH_0, 0xff);\r\nmsm_dsi_phy_set_src_pll(phy, src_pll_id,\r\nREG_DSI_20nm_PHY_GLBL_TEST_CTRL,\r\nDSI_20nm_PHY_GLBL_TEST_CTRL_BITCLK_HS_SEL);\r\nfor (i = 0; i < 4; i++) {\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_CFG_3(i),\r\n(i >> 1) * 0x40);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_TEST_STR_0(i), 0x01);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_TEST_STR_1(i), 0x46);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_CFG_0(i), 0x02);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_CFG_1(i), 0xa0);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LN_CFG_4(i), cfg_4[i]);\r\n}\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_CFG_3, 0x80);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_TEST_STR0, 0x01);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_TEST_STR1, 0x46);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_CFG_0, 0x00);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_CFG_1, 0xa0);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_CFG_2, 0x00);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_LNCK_CFG_4, 0x00);\r\ndsi_20nm_dphy_set_timing(phy, timing);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_CTRL_1, 0x00);\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_STRENGTH_1, 0x06);\r\nwmb();\r\ndsi_phy_write(base + REG_DSI_20nm_PHY_CTRL_0, 0x7f);\r\nreturn 0;\r\n}\r\nstatic void dsi_20nm_phy_disable(struct msm_dsi_phy *phy)\r\n{\r\ndsi_phy_write(phy->base + REG_DSI_20nm_PHY_CTRL_0, 0);\r\ndsi_20nm_phy_regulator_ctrl(phy, false);\r\n}
