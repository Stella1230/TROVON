void __lockfunc tty_lock(struct tty_struct *tty)\r\n{\r\nif (tty->magic != TTY_MAGIC) {\r\npr_err("L Bad %p\n", tty);\r\nWARN_ON(1);\r\nreturn;\r\n}\r\ntty_kref_get(tty);\r\nmutex_lock(&tty->legacy_mutex);\r\n}\r\nvoid __lockfunc tty_unlock(struct tty_struct *tty)\r\n{\r\nif (tty->magic != TTY_MAGIC) {\r\npr_err("U Bad %p\n", tty);\r\nWARN_ON(1);\r\nreturn;\r\n}\r\nmutex_unlock(&tty->legacy_mutex);\r\ntty_kref_put(tty);\r\n}\r\nvoid __lockfunc tty_lock_slave(struct tty_struct *tty)\r\n{\r\nif (tty && tty != tty->link)\r\ntty_lock(tty);\r\n}\r\nvoid __lockfunc tty_unlock_slave(struct tty_struct *tty)\r\n{\r\nif (tty && tty != tty->link)\r\ntty_unlock(tty);\r\n}\r\nvoid tty_set_lock_subclass(struct tty_struct *tty)\r\n{\r\nlockdep_set_subclass(&tty->legacy_mutex, TTY_LOCK_SLAVE);\r\n}
