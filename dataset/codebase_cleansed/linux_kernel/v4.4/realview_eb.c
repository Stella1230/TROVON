static void __init realview_eb_map_io(void)\r\n{\r\niotable_init(realview_eb_io_desc, ARRAY_SIZE(realview_eb_io_desc));\r\nif (core_tile_eb11mp() || core_tile_a9mp())\r\niotable_init(realview_eb11mp_io_desc, ARRAY_SIZE(realview_eb11mp_io_desc));\r\n}\r\nstatic int eth_device_register(void)\r\n{\r\nvoid __iomem *eth_addr = ioremap(REALVIEW_EB_ETH_BASE, SZ_4K);\r\nconst char *name = NULL;\r\nu32 idrev;\r\nif (!eth_addr)\r\nreturn -ENOMEM;\r\nidrev = readl(eth_addr + 0x50);\r\nif ((idrev & 0xFFFF0000) != 0x01180000)\r\nname = "smc91x";\r\niounmap(eth_addr);\r\nreturn realview_eth_register(name, realview_eb_eth_resources);\r\n}\r\nstatic void __init gic_init_irq(void)\r\n{\r\nif (core_tile_eb11mp() || core_tile_a9mp()) {\r\nunsigned int pldctrl;\r\nwritel(0x0000a05f, __io_address(REALVIEW_SYS_LOCK));\r\npldctrl = readl(__io_address(REALVIEW_SYS_BASE) + REALVIEW_EB11MP_SYS_PLD_CTRL1);\r\npldctrl |= 0x00800000;\r\nwritel(pldctrl, __io_address(REALVIEW_SYS_BASE) + REALVIEW_EB11MP_SYS_PLD_CTRL1);\r\nwritel(0x00000000, __io_address(REALVIEW_SYS_LOCK));\r\ngic_init(0, 29, __io_address(REALVIEW_EB11MP_GIC_DIST_BASE),\r\n__io_address(REALVIEW_EB11MP_GIC_CPU_BASE));\r\n#ifndef CONFIG_REALVIEW_EB_ARM11MP_REVB\r\ngic_init(1, 96, __io_address(REALVIEW_EB_GIC_DIST_BASE),\r\n__io_address(REALVIEW_EB_GIC_CPU_BASE));\r\ngic_cascade_irq(1, IRQ_EB11MP_EB_IRQ1);\r\n#endif\r\n} else {\r\ngic_init(0, 29, __io_address(REALVIEW_EB_GIC_DIST_BASE),\r\n__io_address(REALVIEW_EB_GIC_CPU_BASE));\r\n}\r\n}\r\nstatic void realview_eb11mp_fixup(void)\r\n{\r\ndmac_device.irq[0] = IRQ_EB11MP_DMA;\r\nuart0_device.irq[0] = IRQ_EB11MP_UART0;\r\nuart1_device.irq[0] = IRQ_EB11MP_UART1;\r\nuart2_device.irq[0] = IRQ_EB11MP_UART2;\r\nuart3_device.irq[0] = IRQ_EB11MP_UART3;\r\nclcd_device.irq[0] = IRQ_EB11MP_CLCD;\r\nwdog_device.irq[0] = IRQ_EB11MP_WDOG;\r\ngpio0_device.irq[0] = IRQ_EB11MP_GPIO0;\r\ngpio1_device.irq[0] = IRQ_EB11MP_GPIO1;\r\ngpio2_device.irq[0] = IRQ_EB11MP_GPIO2;\r\nrtc_device.irq[0] = IRQ_EB11MP_RTC;\r\nsci0_device.irq[0] = IRQ_EB11MP_SCI;\r\nssp0_device.irq[0] = IRQ_EB11MP_SSP;\r\naaci_device.irq[0] = IRQ_EB11MP_AACI;\r\nmmc0_device.irq[0] = IRQ_EB11MP_MMCI0A;\r\nmmc0_device.irq[1] = IRQ_EB11MP_MMCI0B;\r\nkmi0_device.irq[0] = IRQ_EB11MP_KMI0;\r\nkmi1_device.irq[0] = IRQ_EB11MP_KMI1;\r\nrealview_eb_eth_resources[1].start = IRQ_EB11MP_ETH;\r\nrealview_eb_eth_resources[1].end = IRQ_EB11MP_ETH;\r\nrealview_eb_isp1761_resources[1].start = IRQ_EB11MP_USB;\r\nrealview_eb_isp1761_resources[1].end = IRQ_EB11MP_USB;\r\n}\r\nstatic void __init realview_eb_twd_init(void)\r\n{\r\nif (core_tile_eb11mp() || core_tile_a9mp()) {\r\nint err = twd_local_timer_register(&twd_local_timer);\r\nif (err)\r\npr_err("twd_local_timer_register failed %d\n", err);\r\n}\r\n}\r\nstatic void __init realview_eb_timer_init(void)\r\n{\r\nunsigned int timer_irq;\r\ntimer0_va_base = __io_address(REALVIEW_EB_TIMER0_1_BASE);\r\ntimer1_va_base = __io_address(REALVIEW_EB_TIMER0_1_BASE) + 0x20;\r\ntimer2_va_base = __io_address(REALVIEW_EB_TIMER2_3_BASE);\r\ntimer3_va_base = __io_address(REALVIEW_EB_TIMER2_3_BASE) + 0x20;\r\nif (core_tile_eb11mp() || core_tile_a9mp())\r\ntimer_irq = IRQ_EB11MP_TIMER0_1;\r\nelse\r\ntimer_irq = IRQ_EB_TIMER0_1;\r\nrealview_clk_init(__io_address(REALVIEW_SYS_BASE), false);\r\nrealview_timer_init(timer_irq);\r\nrealview_eb_twd_init();\r\n}\r\nstatic void realview_eb_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nvoid __iomem *reset_ctrl = __io_address(REALVIEW_SYS_RESETCTL);\r\nvoid __iomem *lock_ctrl = __io_address(REALVIEW_SYS_LOCK);\r\n__raw_writel(REALVIEW_SYS_LOCK_VAL, lock_ctrl);\r\nif (core_tile_eb11mp())\r\n__raw_writel(0x0008, reset_ctrl);\r\ndsb();\r\n}\r\nstatic void __init realview_eb_init(void)\r\n{\r\nint i;\r\nif (core_tile_eb11mp() || core_tile_a9mp()) {\r\nrealview_eb11mp_fixup();\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_init(__io_address(REALVIEW_EB11MP_L220_BASE), 0x00790000, 0xfe000fff);\r\n#endif\r\npmu_device.name = core_tile_a9mp() ? "armv7-pmu" : "armv6-pmu";\r\nplatform_device_register(&pmu_device);\r\n}\r\nrealview_flash_register(&realview_eb_flash_resource, 1);\r\nplatform_device_register(&realview_i2c_device);\r\nplatform_device_register(&char_lcd_device);\r\nplatform_device_register(&realview_leds_device);\r\neth_device_register();\r\nrealview_usb_register(realview_eb_isp1761_resources);\r\nfor (i = 0; i < ARRAY_SIZE(amba_devs); i++) {\r\nstruct amba_device *d = amba_devs[i];\r\namba_device_register(d, &iomem_resource);\r\n}\r\n}
