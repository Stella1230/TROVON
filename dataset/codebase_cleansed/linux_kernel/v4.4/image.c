static bool\r\nnvbios_imagen(struct nvkm_bios *bios, struct nvbios_image *image)\r\n{\r\nstruct nvkm_subdev *subdev = &bios->subdev;\r\nstruct nvbios_pcirT pcir;\r\nstruct nvbios_npdeT npde;\r\nu8 ver;\r\nu16 hdr;\r\nu32 data;\r\nswitch ((data = nvbios_rd16(bios, image->base + 0x00))) {\r\ncase 0xaa55:\r\ncase 0xbb77:\r\ncase 0x4e56:\r\nbreak;\r\ndefault:\r\nnvkm_debug(subdev, "%08x: ROM signature (%04x) unknown\n",\r\nimage->base, data);\r\nreturn false;\r\n}\r\nif (!(data = nvbios_pcirTp(bios, image->base, &ver, &hdr, &pcir)))\r\nreturn false;\r\nimage->size = pcir.image_size;\r\nimage->type = pcir.image_type;\r\nimage->last = pcir.last;\r\nif (image->type != 0x70) {\r\nif (!(data = nvbios_npdeTp(bios, image->base, &npde)))\r\nreturn true;\r\nimage->size = npde.image_size;\r\nimage->last = npde.last;\r\n} else {\r\nimage->last = true;\r\n}\r\nreturn true;\r\n}\r\nbool\r\nnvbios_image(struct nvkm_bios *bios, int idx, struct nvbios_image *image)\r\n{\r\nmemset(image, 0x00, sizeof(*image));\r\ndo {\r\nimage->base += image->size;\r\nif (image->last || !nvbios_imagen(bios, image))\r\nreturn false;\r\n} while(idx--);\r\nreturn true;\r\n}
