static int sky81452_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct device *dev = &client->dev;\r\nconst struct sky81452_platform_data *pdata = dev_get_platdata(dev);\r\nstruct mfd_cell cells[2];\r\nstruct regmap *regmap;\r\nint ret;\r\nif (!pdata) {\r\npdata = devm_kzalloc(dev, sizeof(*pdata), GFP_KERNEL);\r\nif (!pdata)\r\nreturn -ENOMEM;\r\n}\r\nregmap = devm_regmap_init_i2c(client, &sky81452_config);\r\nif (IS_ERR(regmap)) {\r\ndev_err(dev, "failed to initialize.err=%ld\n", PTR_ERR(regmap));\r\nreturn PTR_ERR(regmap);\r\n}\r\ni2c_set_clientdata(client, regmap);\r\nmemset(cells, 0, sizeof(cells));\r\ncells[0].name = "sky81452-backlight";\r\ncells[0].of_compatible = "skyworks,sky81452-backlight";\r\ncells[0].platform_data = pdata->bl_pdata;\r\ncells[0].pdata_size = sizeof(*pdata->bl_pdata);\r\ncells[1].name = "sky81452-regulator";\r\ncells[1].platform_data = pdata->regulator_init_data;\r\ncells[1].pdata_size = sizeof(*pdata->regulator_init_data);\r\nret = mfd_add_devices(dev, -1, cells, ARRAY_SIZE(cells), NULL, 0, NULL);\r\nif (ret)\r\ndev_err(dev, "failed to add child devices. err=%d\n", ret);\r\nreturn ret;\r\n}\r\nstatic int sky81452_remove(struct i2c_client *client)\r\n{\r\nmfd_remove_devices(&client->dev);\r\nreturn 0;\r\n}
