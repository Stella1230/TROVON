static void nfs_init_server_aclclient(struct nfs_server *server)\r\n{\r\nif (server->flags & NFS_MOUNT_NOACL)\r\ngoto out_noacl;\r\nserver->client_acl = rpc_bind_new_program(server->client, &nfsacl_program, 3);\r\nif (IS_ERR(server->client_acl))\r\ngoto out_noacl;\r\nserver->caps |= NFS_CAP_ACLS;\r\nreturn;\r\nout_noacl:\r\nserver->caps &= ~NFS_CAP_ACLS;\r\n}\r\nstatic inline void nfs_init_server_aclclient(struct nfs_server *server)\r\n{\r\nserver->flags &= ~NFS_MOUNT_NOACL;\r\nserver->caps &= ~NFS_CAP_ACLS;\r\n}\r\nstruct nfs_server *nfs3_create_server(struct nfs_mount_info *mount_info,\r\nstruct nfs_subversion *nfs_mod)\r\n{\r\nstruct nfs_server *server = nfs_create_server(mount_info, nfs_mod);\r\nif (!IS_ERR(server))\r\nnfs_init_server_aclclient(server);\r\nreturn server;\r\n}\r\nstruct nfs_server *nfs3_clone_server(struct nfs_server *source,\r\nstruct nfs_fh *fh,\r\nstruct nfs_fattr *fattr,\r\nrpc_authflavor_t flavor)\r\n{\r\nstruct nfs_server *server = nfs_clone_server(source, fh, fattr, flavor);\r\nif (!IS_ERR(server) && !IS_ERR(source->client_acl))\r\nnfs_init_server_aclclient(server);\r\nreturn server;\r\n}\r\nstruct nfs_client *nfs3_set_ds_client(struct nfs_client *mds_clp,\r\nconst struct sockaddr *ds_addr, int ds_addrlen,\r\nint ds_proto, unsigned int ds_timeo, unsigned int ds_retrans,\r\nrpc_authflavor_t au_flavor)\r\n{\r\nstruct nfs_client_initdata cl_init = {\r\n.addr = ds_addr,\r\n.addrlen = ds_addrlen,\r\n.nfs_mod = &nfs_v3,\r\n.proto = ds_proto,\r\n.net = mds_clp->cl_net,\r\n};\r\nstruct rpc_timeout ds_timeout;\r\nstruct nfs_client *clp;\r\nchar buf[INET6_ADDRSTRLEN + 1];\r\nif (rpc_ntop(ds_addr, buf, sizeof(buf)) <= 0)\r\nreturn ERR_PTR(-EINVAL);\r\ncl_init.hostname = buf;\r\nnfs_init_timeout_values(&ds_timeout, ds_proto, ds_timeo, ds_retrans);\r\nclp = nfs_get_client(&cl_init, &ds_timeout, mds_clp->cl_ipaddr,\r\nau_flavor);\r\nreturn clp;\r\n}
