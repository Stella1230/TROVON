void acpi_enable_wakeup_devices(u8 sleep_state)\r\n{\r\nstruct list_head *node, *next;\r\nlist_for_each_safe(node, next, &acpi_wakeup_device_list) {\r\nstruct acpi_device *dev =\r\ncontainer_of(node, struct acpi_device, wakeup_list);\r\nif (!dev->wakeup.flags.valid\r\n|| sleep_state > (u32) dev->wakeup.sleep_state\r\n|| !(device_may_wakeup(&dev->dev)\r\n|| dev->wakeup.prepare_count))\r\ncontinue;\r\nif (device_may_wakeup(&dev->dev))\r\nacpi_enable_wakeup_device_power(dev, sleep_state);\r\nacpi_set_gpe_wake_mask(dev->wakeup.gpe_device, dev->wakeup.gpe_number,\r\nACPI_GPE_ENABLE);\r\n}\r\n}\r\nvoid acpi_disable_wakeup_devices(u8 sleep_state)\r\n{\r\nstruct list_head *node, *next;\r\nlist_for_each_safe(node, next, &acpi_wakeup_device_list) {\r\nstruct acpi_device *dev =\r\ncontainer_of(node, struct acpi_device, wakeup_list);\r\nif (!dev->wakeup.flags.valid\r\n|| sleep_state > (u32) dev->wakeup.sleep_state\r\n|| !(device_may_wakeup(&dev->dev)\r\n|| dev->wakeup.prepare_count))\r\ncontinue;\r\nacpi_set_gpe_wake_mask(dev->wakeup.gpe_device, dev->wakeup.gpe_number,\r\nACPI_GPE_DISABLE);\r\nif (device_may_wakeup(&dev->dev))\r\nacpi_disable_wakeup_device_power(dev);\r\n}\r\n}\r\nint __init acpi_wakeup_device_init(void)\r\n{\r\nstruct list_head *node, *next;\r\nmutex_lock(&acpi_device_lock);\r\nlist_for_each_safe(node, next, &acpi_wakeup_device_list) {\r\nstruct acpi_device *dev = container_of(node,\r\nstruct acpi_device,\r\nwakeup_list);\r\nif (device_can_wakeup(&dev->dev)) {\r\nacpi_enable_gpe(dev->wakeup.gpe_device,\r\ndev->wakeup.gpe_number);\r\ndevice_set_wakeup_enable(&dev->dev, true);\r\n}\r\n}\r\nmutex_unlock(&acpi_device_lock);\r\nreturn 0;\r\n}
