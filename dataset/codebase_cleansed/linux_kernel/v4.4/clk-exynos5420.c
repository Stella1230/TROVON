static int exynos5420_clk_suspend(void)\r\n{\r\nsamsung_clk_save(reg_base, exynos5x_save,\r\nARRAY_SIZE(exynos5x_clk_regs));\r\nif (exynos5x_soc == EXYNOS5800)\r\nsamsung_clk_save(reg_base, exynos5800_save,\r\nARRAY_SIZE(exynos5800_clk_regs));\r\nsamsung_clk_restore(reg_base, exynos5420_set_clksrc,\r\nARRAY_SIZE(exynos5420_set_clksrc));\r\nreturn 0;\r\n}\r\nstatic void exynos5420_clk_resume(void)\r\n{\r\nsamsung_clk_restore(reg_base, exynos5x_save,\r\nARRAY_SIZE(exynos5x_clk_regs));\r\nif (exynos5x_soc == EXYNOS5800)\r\nsamsung_clk_restore(reg_base, exynos5800_save,\r\nARRAY_SIZE(exynos5800_clk_regs));\r\n}\r\nstatic void exynos5420_clk_sleep_init(void)\r\n{\r\nexynos5x_save = samsung_clk_alloc_reg_dump(exynos5x_clk_regs,\r\nARRAY_SIZE(exynos5x_clk_regs));\r\nif (!exynos5x_save) {\r\npr_warn("%s: failed to allocate sleep save data, no sleep support!\n",\r\n__func__);\r\nreturn;\r\n}\r\nif (exynos5x_soc == EXYNOS5800) {\r\nexynos5800_save =\r\nsamsung_clk_alloc_reg_dump(exynos5800_clk_regs,\r\nARRAY_SIZE(exynos5800_clk_regs));\r\nif (!exynos5800_save)\r\ngoto err_soc;\r\n}\r\nregister_syscore_ops(&exynos5420_clk_syscore_ops);\r\nreturn;\r\nerr_soc:\r\nkfree(exynos5x_save);\r\npr_warn("%s: failed to allocate sleep save data, no sleep support!\n",\r\n__func__);\r\nreturn;\r\n}\r\nstatic void exynos5420_clk_sleep_init(void) {}\r\nstatic void __init exynos5x_clk_init(struct device_node *np,\r\nenum exynos5x_soc soc)\r\n{\r\nstruct samsung_clk_provider *ctx;\r\nif (np) {\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base)\r\npanic("%s: failed to map registers\n", __func__);\r\n} else {\r\npanic("%s: unable to determine soc\n", __func__);\r\n}\r\nexynos5x_soc = soc;\r\nctx = samsung_clk_init(np, reg_base, CLK_NR_CLKS);\r\nif (!ctx)\r\npanic("%s: unable to allocate context.\n", __func__);\r\nsamsung_clk_of_register_fixed_ext(ctx, exynos5x_fixed_rate_ext_clks,\r\nARRAY_SIZE(exynos5x_fixed_rate_ext_clks),\r\next_clk_match);\r\nif (_get_rate("fin_pll") == 24 * MHZ) {\r\nexynos5x_plls[apll].rate_table = exynos5420_pll2550x_24mhz_tbl;\r\nexynos5x_plls[kpll].rate_table = exynos5420_pll2550x_24mhz_tbl;\r\n}\r\nsamsung_clk_register_pll(ctx, exynos5x_plls, ARRAY_SIZE(exynos5x_plls),\r\nreg_base);\r\nsamsung_clk_register_fixed_rate(ctx, exynos5x_fixed_rate_clks,\r\nARRAY_SIZE(exynos5x_fixed_rate_clks));\r\nsamsung_clk_register_fixed_factor(ctx, exynos5x_fixed_factor_clks,\r\nARRAY_SIZE(exynos5x_fixed_factor_clks));\r\nsamsung_clk_register_mux(ctx, exynos5x_mux_clks,\r\nARRAY_SIZE(exynos5x_mux_clks));\r\nsamsung_clk_register_div(ctx, exynos5x_div_clks,\r\nARRAY_SIZE(exynos5x_div_clks));\r\nsamsung_clk_register_gate(ctx, exynos5x_gate_clks,\r\nARRAY_SIZE(exynos5x_gate_clks));\r\nif (soc == EXYNOS5420) {\r\nsamsung_clk_register_mux(ctx, exynos5420_mux_clks,\r\nARRAY_SIZE(exynos5420_mux_clks));\r\nsamsung_clk_register_div(ctx, exynos5420_div_clks,\r\nARRAY_SIZE(exynos5420_div_clks));\r\n} else {\r\nsamsung_clk_register_fixed_factor(\r\nctx, exynos5800_fixed_factor_clks,\r\nARRAY_SIZE(exynos5800_fixed_factor_clks));\r\nsamsung_clk_register_mux(ctx, exynos5800_mux_clks,\r\nARRAY_SIZE(exynos5800_mux_clks));\r\nsamsung_clk_register_div(ctx, exynos5800_div_clks,\r\nARRAY_SIZE(exynos5800_div_clks));\r\nsamsung_clk_register_gate(ctx, exynos5800_gate_clks,\r\nARRAY_SIZE(exynos5800_gate_clks));\r\n}\r\nexynos5420_clk_sleep_init();\r\nsamsung_clk_of_add_provider(np, ctx);\r\n}\r\nstatic void __init exynos5420_clk_init(struct device_node *np)\r\n{\r\nexynos5x_clk_init(np, EXYNOS5420);\r\n}\r\nstatic void __init exynos5800_clk_init(struct device_node *np)\r\n{\r\nexynos5x_clk_init(np, EXYNOS5800);\r\n}
