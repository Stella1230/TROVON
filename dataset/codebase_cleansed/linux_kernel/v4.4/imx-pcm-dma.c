static bool filter(struct dma_chan *chan, void *param)\r\n{\r\nif (!imx_dma_is_general_purpose(chan))\r\nreturn false;\r\nchan->private = param;\r\nreturn true;\r\n}\r\nint imx_pcm_dma_init(struct platform_device *pdev, size_t size)\r\n{\r\nstruct snd_dmaengine_pcm_config *config;\r\nstruct snd_pcm_hardware *pcm_hardware;\r\nconfig = devm_kzalloc(&pdev->dev,\r\nsizeof(struct snd_dmaengine_pcm_config), GFP_KERNEL);\r\n*config = imx_dmaengine_pcm_config;\r\nif (size)\r\nconfig->prealloc_buffer_size = size;\r\npcm_hardware = devm_kzalloc(&pdev->dev,\r\nsizeof(struct snd_pcm_hardware), GFP_KERNEL);\r\n*pcm_hardware = imx_pcm_hardware;\r\nif (size)\r\npcm_hardware->buffer_bytes_max = size;\r\nconfig->pcm_hardware = pcm_hardware;\r\nreturn devm_snd_dmaengine_pcm_register(&pdev->dev,\r\nconfig,\r\nSND_DMAENGINE_PCM_FLAG_COMPAT);\r\n}
