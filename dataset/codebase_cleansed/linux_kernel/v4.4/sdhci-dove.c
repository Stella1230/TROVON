static u16 sdhci_dove_readw(struct sdhci_host *host, int reg)\r\n{\r\nu16 ret;\r\nswitch (reg) {\r\ncase SDHCI_HOST_VERSION:\r\ncase SDHCI_SLOT_INT_STATUS:\r\nreturn 0;\r\ndefault:\r\nret = readw(host->ioaddr + reg);\r\n}\r\nreturn ret;\r\n}\r\nstatic u32 sdhci_dove_readl(struct sdhci_host *host, int reg)\r\n{\r\nu32 ret;\r\nret = readl(host->ioaddr + reg);\r\nswitch (reg) {\r\ncase SDHCI_CAPABILITIES:\r\nret &= ~SDHCI_CAN_VDD_300;\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nstatic int sdhci_dove_probe(struct platform_device *pdev)\r\n{\r\nstruct sdhci_host *host;\r\nstruct sdhci_pltfm_host *pltfm_host;\r\nint ret;\r\nhost = sdhci_pltfm_init(pdev, &sdhci_dove_pdata, 0);\r\nif (IS_ERR(host))\r\nreturn PTR_ERR(host);\r\npltfm_host = sdhci_priv(host);\r\npltfm_host->clk = devm_clk_get(&pdev->dev, NULL);\r\nif (!IS_ERR(pltfm_host->clk))\r\nclk_prepare_enable(pltfm_host->clk);\r\nret = mmc_of_parse(host->mmc);\r\nif (ret)\r\ngoto err_sdhci_add;\r\nret = sdhci_add_host(host);\r\nif (ret)\r\ngoto err_sdhci_add;\r\nreturn 0;\r\nerr_sdhci_add:\r\nclk_disable_unprepare(pltfm_host->clk);\r\nsdhci_pltfm_free(pdev);\r\nreturn ret;\r\n}
