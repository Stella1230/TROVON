static void frv_mb93493_mask(struct irq_data *d)\r\n{\r\nuint32_t iqsr;\r\nvolatile void *piqsr;\r\nif (IRQ_ROUTING & (1 << (d->irq - IRQ_BASE_MB93493)))\r\npiqsr = __addr_MB93493_IQSR(1);\r\nelse\r\npiqsr = __addr_MB93493_IQSR(0);\r\niqsr = readl(piqsr);\r\niqsr &= ~(1 << (d->irq - IRQ_BASE_MB93493 + 16));\r\nwritel(iqsr, piqsr);\r\n}\r\nstatic void frv_mb93493_ack(struct irq_data *d)\r\n{\r\n}\r\nstatic void frv_mb93493_unmask(struct irq_data *d)\r\n{\r\nuint32_t iqsr;\r\nvolatile void *piqsr;\r\nif (IRQ_ROUTING & (1 << (d->irq - IRQ_BASE_MB93493)))\r\npiqsr = __addr_MB93493_IQSR(1);\r\nelse\r\npiqsr = __addr_MB93493_IQSR(0);\r\niqsr = readl(piqsr);\r\niqsr |= 1 << (d->irq - IRQ_BASE_MB93493 + 16);\r\nwritel(iqsr, piqsr);\r\n}\r\nstatic irqreturn_t mb93493_interrupt(int irq, void *_piqsr)\r\n{\r\nvolatile void *piqsr = _piqsr;\r\nuint32_t iqsr;\r\niqsr = readl(piqsr);\r\niqsr = iqsr & (iqsr >> 16) & 0xffff;\r\nwhile (iqsr) {\r\nint irq;\r\nasm("scan %1,gr0,%0" : "=r"(irq) : "r"(iqsr));\r\nirq = 31 - irq;\r\niqsr &= ~(1 << irq);\r\ngeneric_handle_irq(IRQ_BASE_MB93493 + irq);\r\n}\r\nreturn IRQ_HANDLED;\r\n}\r\nvoid __init mb93493_init(void)\r\n{\r\nint irq;\r\nfor (irq = IRQ_BASE_MB93493 + 0; irq <= IRQ_BASE_MB93493 + 10; irq++)\r\nirq_set_chip_and_handler(irq, &frv_mb93493_pic,\r\nhandle_edge_irq);\r\nsetup_irq(IRQ_CPU_MB93493_0, &mb93493_irq[0]);\r\nsetup_irq(IRQ_CPU_MB93493_1, &mb93493_irq[1]);\r\n}
