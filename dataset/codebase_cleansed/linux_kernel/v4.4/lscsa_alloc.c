int spu_alloc_lscsa(struct spu_state *csa)\r\n{\r\nstruct spu_lscsa *lscsa;\r\nunsigned char *p;\r\nlscsa = vzalloc(sizeof(struct spu_lscsa));\r\nif (!lscsa)\r\nreturn -ENOMEM;\r\ncsa->lscsa = lscsa;\r\nfor (p = lscsa->ls; p < lscsa->ls + LS_SIZE; p += PAGE_SIZE)\r\nSetPageReserved(vmalloc_to_page(p));\r\nreturn 0;\r\n}\r\nvoid spu_free_lscsa(struct spu_state *csa)\r\n{\r\nunsigned char *p;\r\nif (csa->lscsa == NULL)\r\nreturn;\r\nfor (p = csa->lscsa->ls; p < csa->lscsa->ls + LS_SIZE; p += PAGE_SIZE)\r\nClearPageReserved(vmalloc_to_page(p));\r\nvfree(csa->lscsa);\r\n}
