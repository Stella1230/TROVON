void s5p_jpeg_reset(void __iomem *regs)\r\n{\r\nunsigned long reg;\r\nwritel(1, regs + S5P_JPG_SW_RESET);\r\nreg = readl(regs + S5P_JPG_SW_RESET);\r\nwhile (reg != 0) {\r\ncpu_relax();\r\nreg = readl(regs + S5P_JPG_SW_RESET);\r\n}\r\n}\r\nvoid s5p_jpeg_poweron(void __iomem *regs)\r\n{\r\nwritel(S5P_POWER_ON, regs + S5P_JPGCLKCON);\r\n}\r\nvoid s5p_jpeg_input_raw_mode(void __iomem *regs, unsigned long mode)\r\n{\r\nunsigned long reg, m;\r\nm = S5P_MOD_SEL_565;\r\nif (mode == S5P_JPEG_RAW_IN_565)\r\nm = S5P_MOD_SEL_565;\r\nelse if (mode == S5P_JPEG_RAW_IN_422)\r\nm = S5P_MOD_SEL_422;\r\nreg = readl(regs + S5P_JPGCMOD);\r\nreg &= ~S5P_MOD_SEL_MASK;\r\nreg |= m;\r\nwritel(reg, regs + S5P_JPGCMOD);\r\n}\r\nvoid s5p_jpeg_proc_mode(void __iomem *regs, unsigned long mode)\r\n{\r\nunsigned long reg, m;\r\nm = S5P_PROC_MODE_DECOMPR;\r\nif (mode == S5P_JPEG_ENCODE)\r\nm = S5P_PROC_MODE_COMPR;\r\nelse\r\nm = S5P_PROC_MODE_DECOMPR;\r\nreg = readl(regs + S5P_JPGMOD);\r\nreg &= ~S5P_PROC_MODE_MASK;\r\nreg |= m;\r\nwritel(reg, regs + S5P_JPGMOD);\r\n}\r\nvoid s5p_jpeg_subsampling_mode(void __iomem *regs, unsigned int mode)\r\n{\r\nunsigned long reg, m;\r\nif (mode == V4L2_JPEG_CHROMA_SUBSAMPLING_420)\r\nm = S5P_SUBSAMPLING_MODE_420;\r\nelse\r\nm = S5P_SUBSAMPLING_MODE_422;\r\nreg = readl(regs + S5P_JPGMOD);\r\nreg &= ~S5P_SUBSAMPLING_MODE_MASK;\r\nreg |= m;\r\nwritel(reg, regs + S5P_JPGMOD);\r\n}\r\nunsigned int s5p_jpeg_get_subsampling_mode(void __iomem *regs)\r\n{\r\nreturn readl(regs + S5P_JPGMOD) & S5P_SUBSAMPLING_MODE_MASK;\r\n}\r\nvoid s5p_jpeg_dri(void __iomem *regs, unsigned int dri)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGDRI_U);\r\nreg &= ~0xff;\r\nreg |= (dri >> 8) & 0xff;\r\nwritel(reg, regs + S5P_JPGDRI_U);\r\nreg = readl(regs + S5P_JPGDRI_L);\r\nreg &= ~0xff;\r\nreg |= dri & 0xff;\r\nwritel(reg, regs + S5P_JPGDRI_L);\r\n}\r\nvoid s5p_jpeg_qtbl(void __iomem *regs, unsigned int t, unsigned int n)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_QTBL);\r\nreg &= ~S5P_QT_NUMt_MASK(t);\r\nreg |= (n << S5P_QT_NUMt_SHIFT(t)) & S5P_QT_NUMt_MASK(t);\r\nwritel(reg, regs + S5P_JPG_QTBL);\r\n}\r\nvoid s5p_jpeg_htbl_ac(void __iomem *regs, unsigned int t)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_HTBL);\r\nreg &= ~S5P_HT_NUMt_AC_MASK(t);\r\nreg |= (0 << S5P_HT_NUMt_AC_SHIFT(t)) & S5P_HT_NUMt_AC_MASK(t);\r\nwritel(reg, regs + S5P_JPG_HTBL);\r\n}\r\nvoid s5p_jpeg_htbl_dc(void __iomem *regs, unsigned int t)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_HTBL);\r\nreg &= ~S5P_HT_NUMt_DC_MASK(t);\r\nreg |= (0 << S5P_HT_NUMt_DC_SHIFT(t)) & S5P_HT_NUMt_DC_MASK(t);\r\nwritel(reg, regs + S5P_JPG_HTBL);\r\n}\r\nvoid s5p_jpeg_y(void __iomem *regs, unsigned int y)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGY_U);\r\nreg &= ~0xff;\r\nreg |= (y >> 8) & 0xff;\r\nwritel(reg, regs + S5P_JPGY_U);\r\nreg = readl(regs + S5P_JPGY_L);\r\nreg &= ~0xff;\r\nreg |= y & 0xff;\r\nwritel(reg, regs + S5P_JPGY_L);\r\n}\r\nvoid s5p_jpeg_x(void __iomem *regs, unsigned int x)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGX_U);\r\nreg &= ~0xff;\r\nreg |= (x >> 8) & 0xff;\r\nwritel(reg, regs + S5P_JPGX_U);\r\nreg = readl(regs + S5P_JPGX_L);\r\nreg &= ~0xff;\r\nreg |= x & 0xff;\r\nwritel(reg, regs + S5P_JPGX_L);\r\n}\r\nvoid s5p_jpeg_rst_int_enable(void __iomem *regs, bool enable)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGINTSE);\r\nreg &= ~S5P_RSTm_INT_EN_MASK;\r\nif (enable)\r\nreg |= S5P_RSTm_INT_EN;\r\nwritel(reg, regs + S5P_JPGINTSE);\r\n}\r\nvoid s5p_jpeg_data_num_int_enable(void __iomem *regs, bool enable)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGINTSE);\r\nreg &= ~S5P_DATA_NUM_INT_EN_MASK;\r\nif (enable)\r\nreg |= S5P_DATA_NUM_INT_EN;\r\nwritel(reg, regs + S5P_JPGINTSE);\r\n}\r\nvoid s5p_jpeg_final_mcu_num_int_enable(void __iomem *regs, bool enbl)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPGINTSE);\r\nreg &= ~S5P_FINAL_MCU_NUM_INT_EN_MASK;\r\nif (enbl)\r\nreg |= S5P_FINAL_MCU_NUM_INT_EN;\r\nwritel(reg, regs + S5P_JPGINTSE);\r\n}\r\nint s5p_jpeg_timer_stat(void __iomem *regs)\r\n{\r\nreturn (int)((readl(regs + S5P_JPG_TIMER_ST) & S5P_TIMER_INT_STAT_MASK)\r\n>> S5P_TIMER_INT_STAT_SHIFT);\r\n}\r\nvoid s5p_jpeg_clear_timer_stat(void __iomem *regs)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_TIMER_SE);\r\nreg &= ~S5P_TIMER_INT_STAT_MASK;\r\nwritel(reg, regs + S5P_JPG_TIMER_SE);\r\n}\r\nvoid s5p_jpeg_enc_stream_int(void __iomem *regs, unsigned long size)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_ENC_STREAM_INTSE);\r\nreg &= ~S5P_ENC_STREAM_BOUND_MASK;\r\nreg |= S5P_ENC_STREAM_INT_EN;\r\nreg |= size & S5P_ENC_STREAM_BOUND_MASK;\r\nwritel(reg, regs + S5P_JPG_ENC_STREAM_INTSE);\r\n}\r\nint s5p_jpeg_enc_stream_stat(void __iomem *regs)\r\n{\r\nreturn (int)(readl(regs + S5P_JPG_ENC_STREAM_INTST) &\r\nS5P_ENC_STREAM_INT_STAT_MASK);\r\n}\r\nvoid s5p_jpeg_clear_enc_stream_stat(void __iomem *regs)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_ENC_STREAM_INTSE);\r\nreg &= ~S5P_ENC_STREAM_INT_MASK;\r\nwritel(reg, regs + S5P_JPG_ENC_STREAM_INTSE);\r\n}\r\nvoid s5p_jpeg_outform_raw(void __iomem *regs, unsigned long format)\r\n{\r\nunsigned long reg, f;\r\nf = S5P_DEC_OUT_FORMAT_422;\r\nif (format == S5P_JPEG_RAW_OUT_422)\r\nf = S5P_DEC_OUT_FORMAT_422;\r\nelse if (format == S5P_JPEG_RAW_OUT_420)\r\nf = S5P_DEC_OUT_FORMAT_420;\r\nreg = readl(regs + S5P_JPG_OUTFORM);\r\nreg &= ~S5P_DEC_OUT_FORMAT_MASK;\r\nreg |= f;\r\nwritel(reg, regs + S5P_JPG_OUTFORM);\r\n}\r\nvoid s5p_jpeg_jpgadr(void __iomem *regs, unsigned long addr)\r\n{\r\nwritel(addr, regs + S5P_JPG_JPGADR);\r\n}\r\nvoid s5p_jpeg_imgadr(void __iomem *regs, unsigned long addr)\r\n{\r\nwritel(addr, regs + S5P_JPG_IMGADR);\r\n}\r\nvoid s5p_jpeg_coef(void __iomem *regs, unsigned int i,\r\nunsigned int j, unsigned int coef)\r\n{\r\nunsigned long reg;\r\nreg = readl(regs + S5P_JPG_COEF(i));\r\nreg &= ~S5P_COEFn_MASK(j);\r\nreg |= (coef << S5P_COEFn_SHIFT(j)) & S5P_COEFn_MASK(j);\r\nwritel(reg, regs + S5P_JPG_COEF(i));\r\n}\r\nvoid s5p_jpeg_start(void __iomem *regs)\r\n{\r\nwritel(1, regs + S5P_JSTART);\r\n}\r\nint s5p_jpeg_result_stat_ok(void __iomem *regs)\r\n{\r\nreturn (int)((readl(regs + S5P_JPGINTST) & S5P_RESULT_STAT_MASK)\r\n>> S5P_RESULT_STAT_SHIFT);\r\n}\r\nint s5p_jpeg_stream_stat_ok(void __iomem *regs)\r\n{\r\nreturn !(int)((readl(regs + S5P_JPGINTST) & S5P_STREAM_STAT_MASK)\r\n>> S5P_STREAM_STAT_SHIFT);\r\n}\r\nvoid s5p_jpeg_clear_int(void __iomem *regs)\r\n{\r\nreadl(regs + S5P_JPGINTST);\r\nwritel(S5P_INT_RELEASE, regs + S5P_JPGCOM);\r\nreadl(regs + S5P_JPGOPR);\r\n}\r\nunsigned int s5p_jpeg_compressed_size(void __iomem *regs)\r\n{\r\nunsigned long jpeg_size = 0;\r\njpeg_size |= (readl(regs + S5P_JPGCNT_U) & 0xff) << 16;\r\njpeg_size |= (readl(regs + S5P_JPGCNT_M) & 0xff) << 8;\r\njpeg_size |= (readl(regs + S5P_JPGCNT_L) & 0xff);\r\nreturn (unsigned int)jpeg_size;\r\n}
