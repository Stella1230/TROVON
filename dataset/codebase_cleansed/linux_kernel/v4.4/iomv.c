void *sn_io_addr(unsigned long port)\r\n{\r\nif (!IS_RUNNING_ON_SIMULATOR()) {\r\nif (IS_LEGACY_VGA_IOPORT(port))\r\nreturn (__ia64_mk_io_addr(port));\r\nif (port < (64 * 1024))\r\nreturn NULL;\r\nif (SN_ACPI_BASE_SUPPORT())\r\nreturn (__ia64_mk_io_addr(port));\r\nelse\r\nreturn ((void *)(port | __IA64_UNCACHED_OFFSET));\r\n} else {\r\nunsigned long addr;\r\naddr = (is_shub2() ? 0xc00000028c000000UL : 0xc0000087cc000000UL) | ((port >> 2) << 12);\r\nif ((port >= 0x1f0 && port <= 0x1f7) || port == 0x3f6 || port == 0x3f7)\r\naddr |= port;\r\nreturn (void *)addr;\r\n}\r\n}\r\nvoid __sn_mmiowb(void)\r\n{\r\nvolatile unsigned long *adr = pda->pio_write_status_addr;\r\nunsigned long val = pda->pio_write_status_val;\r\nwhile ((*adr & SH_PIO_WRITE_STATUS_PENDING_WRITE_COUNT_MASK) != val)\r\ncpu_relax();\r\n}
