static int rk3288_clk_suspend(void)\r\n{\r\nint i, reg_id;\r\nfor (i = 0; i < ARRAY_SIZE(rk3288_saved_cru_reg_ids); i++) {\r\nreg_id = rk3288_saved_cru_reg_ids[i];\r\nrk3288_saved_cru_regs[i] =\r\nreadl_relaxed(rk3288_cru_base + reg_id);\r\n}\r\nwritel_relaxed(0xf3030000, rk3288_cru_base + RK3288_MODE_CON);\r\nreturn 0;\r\n}\r\nstatic void rk3288_clk_resume(void)\r\n{\r\nint i, reg_id;\r\nfor (i = ARRAY_SIZE(rk3288_saved_cru_reg_ids) - 1; i >= 0; i--) {\r\nreg_id = rk3288_saved_cru_reg_ids[i];\r\nwritel_relaxed(rk3288_saved_cru_regs[i] | 0xffff0000,\r\nrk3288_cru_base + reg_id);\r\n}\r\n}\r\nstatic void rk3288_clk_sleep_init(void __iomem *reg_base)\r\n{\r\nrk3288_cru_base = reg_base;\r\nregister_syscore_ops(&rk3288_clk_syscore_ops);\r\n}\r\nstatic void rk3288_clk_sleep_init(void __iomem *reg_base) {}\r\nstatic void __init rk3288_clk_init(struct device_node *np)\r\n{\r\nvoid __iomem *reg_base;\r\nstruct clk *clk;\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base) {\r\npr_err("%s: could not map cru region\n", __func__);\r\nreturn;\r\n}\r\nrockchip_clk_init(np, reg_base, CLK_NR_CLKS);\r\nclk = clk_register_fixed_factor(NULL, "xin12m", "xin24m", 0, 1, 2);\r\nif (IS_ERR(clk))\r\npr_warn("%s: could not register clock xin12m: %ld\n",\r\n__func__, PTR_ERR(clk));\r\nclk = clk_register_fixed_factor(NULL, "usb480m", "xin24m", 0, 20, 1);\r\nif (IS_ERR(clk))\r\npr_warn("%s: could not register clock usb480m: %ld\n",\r\n__func__, PTR_ERR(clk));\r\nclk = clk_register_fixed_factor(NULL, "hclk_vcodec_pre",\r\n"hclk_vcodec_pre_v", 0, 1, 4);\r\nif (IS_ERR(clk))\r\npr_warn("%s: could not register clock hclk_vcodec_pre: %ld\n",\r\n__func__, PTR_ERR(clk));\r\nclk = clk_register_fixed_factor(NULL, "pclk_wdt", "pclk_pd_alive", 0, 1, 1);\r\nif (IS_ERR(clk))\r\npr_warn("%s: could not register clock pclk_wdt: %ld\n",\r\n__func__, PTR_ERR(clk));\r\nelse\r\nrockchip_clk_add_lookup(clk, PCLK_WDT);\r\nrockchip_clk_register_plls(rk3288_pll_clks,\r\nARRAY_SIZE(rk3288_pll_clks),\r\nRK3288_GRF_SOC_STATUS1);\r\nrockchip_clk_register_branches(rk3288_clk_branches,\r\nARRAY_SIZE(rk3288_clk_branches));\r\nrockchip_clk_protect_critical(rk3288_critical_clocks,\r\nARRAY_SIZE(rk3288_critical_clocks));\r\nrockchip_clk_register_armclk(ARMCLK, "armclk",\r\nmux_armclk_p, ARRAY_SIZE(mux_armclk_p),\r\n&rk3288_cpuclk_data, rk3288_cpuclk_rates,\r\nARRAY_SIZE(rk3288_cpuclk_rates));\r\nrockchip_register_softrst(np, 12, reg_base + RK3288_SOFTRST_CON(0),\r\nROCKCHIP_SOFTRST_HIWORD_MASK);\r\nrockchip_register_restart_notifier(RK3288_GLB_SRST_FST);\r\nrk3288_clk_sleep_init(reg_base);\r\n}
