static int punit_dev_state_show(struct seq_file *seq_file, void *unused)\r\n{\r\nu32 punit_pwr_status;\r\nstruct punit_device *punit_devp = seq_file->private;\r\nint index;\r\nint status;\r\nseq_puts(seq_file, "\n\nPUNIT NORTH COMPLEX DEVICES :\n");\r\nwhile (punit_devp->name) {\r\nstatus = iosf_mbi_read(PUNIT_PORT, BT_MBI_PMC_READ,\r\npunit_devp->reg,\r\n&punit_pwr_status);\r\nif (status) {\r\nseq_printf(seq_file, "%9s : Read Failed\n",\r\npunit_devp->name);\r\n} else {\r\nindex = (punit_pwr_status >> punit_devp->sss_pos) & 3;\r\nseq_printf(seq_file, "%9s : %s\n", punit_devp->name,\r\ndstates[index]);\r\n}\r\npunit_devp++;\r\n}\r\nreturn 0;\r\n}\r\nstatic int punit_dev_state_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, punit_dev_state_show, inode->i_private);\r\n}\r\nstatic int punit_dbgfs_register(struct punit_device *punit_device)\r\n{\r\nstatic struct dentry *dev_state;\r\npunit_dbg_file = debugfs_create_dir("punit_atom", NULL);\r\nif (!punit_dbg_file)\r\nreturn -ENXIO;\r\ndev_state = debugfs_create_file("dev_power_state", S_IFREG | S_IRUGO,\r\npunit_dbg_file, punit_device,\r\n&punit_dev_state_ops);\r\nif (!dev_state) {\r\npr_err("punit_dev_state register failed\n");\r\ndebugfs_remove(punit_dbg_file);\r\nreturn -ENXIO;\r\n}\r\nreturn 0;\r\n}\r\nstatic void punit_dbgfs_unregister(void)\r\n{\r\ndebugfs_remove_recursive(punit_dbg_file);\r\n}\r\nstatic int __init punit_atom_debug_init(void)\r\n{\r\nconst struct x86_cpu_id *id;\r\nint ret;\r\nid = x86_match_cpu(intel_punit_cpu_ids);\r\nif (!id)\r\nreturn -ENODEV;\r\nret = punit_dbgfs_register((struct punit_device *)id->driver_data);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic void __exit punit_atom_debug_exit(void)\r\n{\r\npunit_dbgfs_unregister();\r\n}
