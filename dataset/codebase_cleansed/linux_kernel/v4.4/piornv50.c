int\r\nnv50_pior_power(NV50_DISP_MTHD_V1)\r\n{\r\nstruct nvkm_device *device = disp->base.engine.subdev.device;\r\nconst u32 soff = outp->or * 0x800;\r\nunion {\r\nstruct nv50_disp_pior_pwr_v0 v0;\r\n} *args = data;\r\nu32 ctrl, type;\r\nint ret;\r\nnvif_ioctl(object, "disp pior pwr size %d\n", size);\r\nif (nvif_unpack(args->v0, 0, 0, false)) {\r\nnvif_ioctl(object, "disp pior pwr vers %d state %d type %x\n",\r\nargs->v0.version, args->v0.state, args->v0.type);\r\nif (args->v0.type > 0x0f)\r\nreturn -EINVAL;\r\nctrl = !!args->v0.state;\r\ntype = args->v0.type;\r\n} else\r\nreturn ret;\r\nnvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x61e004 + soff) & 0x80000000))\r\nbreak;\r\n);\r\nnvkm_mask(device, 0x61e004 + soff, 0x80000101, 0x80000000 | ctrl);\r\nnvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x61e004 + soff) & 0x80000000))\r\nbreak;\r\n);\r\ndisp->pior.type[outp->or] = type;\r\nreturn 0;\r\n}\r\nint\r\nnv50_pior_output_new(struct nvkm_disp *disp, int index,\r\nstruct dcb_output *dcbE, struct nvkm_output **poutp)\r\n{\r\nreturn nvkm_output_new_(&nv50_pior_output_func, disp,\r\nindex, dcbE, poutp);\r\n}\r\nstatic int\r\nnv50_pior_output_dp_pattern(struct nvkm_output_dp *outp, int pattern)\r\n{\r\nreturn 0;\r\n}\r\nstatic int\r\nnv50_pior_output_dp_lnk_pwr(struct nvkm_output_dp *outp, int nr)\r\n{\r\nreturn 0;\r\n}\r\nstatic int\r\nnv50_pior_output_dp_lnk_ctl(struct nvkm_output_dp *outp,\r\nint nr, int bw, bool ef)\r\n{\r\nint ret = nvkm_i2c_aux_lnk_ctl(outp->aux, nr, bw, ef);\r\nif (ret)\r\nreturn ret;\r\nreturn 1;\r\n}\r\nint\r\nnv50_pior_dp_new(struct nvkm_disp *disp, int index, struct dcb_output *dcbE,\r\nstruct nvkm_output **poutp)\r\n{\r\nstruct nvkm_i2c *i2c = disp->engine.subdev.device->i2c;\r\nstruct nvkm_i2c_aux *aux =\r\nnvkm_i2c_aux_find(i2c, NVKM_I2C_AUX_EXT(dcbE->extdev));\r\nstruct nvkm_output_dp *outp;\r\nif (!(outp = kzalloc(sizeof(*outp), GFP_KERNEL)))\r\nreturn -ENOMEM;\r\n*poutp = &outp->base;\r\nreturn nvkm_output_dp_ctor(&nv50_pior_output_dp_func, disp,\r\nindex, dcbE, aux, outp);\r\n}
