int cx18_audio_set_io(struct cx18 *cx)\r\n{\r\nconst struct cx18_card_audio_input *in;\r\nu32 u, v;\r\nint err;\r\nif (test_bit(CX18_F_I_RADIO_USER, &cx->i_flags))\r\nin = &cx->card->radio_input;\r\nelse\r\nin = &cx->card->audio_inputs[cx->audio_input];\r\nv4l2_subdev_call(cx->sd_extmux, audio, s_routing,\r\n(u32) in->muxer_input, 0, 0);\r\nerr = cx18_call_hw_err(cx, cx->card->hw_audio_ctrl,\r\naudio, s_routing, in->audio_input, 0, 0);\r\nif (err)\r\nreturn err;\r\nu = cx18_read_reg(cx, CX18_AUDIO_ENABLE);\r\nv = u & ~CX18_AI1_MUX_MASK;\r\nswitch (in->audio_input) {\r\ncase CX18_AV_AUDIO_SERIAL1:\r\nv |= CX18_AI1_MUX_I2S1;\r\nbreak;\r\ncase CX18_AV_AUDIO_SERIAL2:\r\nv |= CX18_AI1_MUX_I2S2;\r\nbreak;\r\ndefault:\r\nv |= CX18_AI1_MUX_843_I2S;\r\nbreak;\r\n}\r\nif (v == u) {\r\nu &= ~CX18_AI1_MUX_MASK;\r\nswitch (in->audio_input) {\r\ncase CX18_AV_AUDIO_SERIAL1:\r\nu |= CX18_AI1_MUX_843_I2S;\r\nbreak;\r\ncase CX18_AV_AUDIO_SERIAL2:\r\nu |= CX18_AI1_MUX_843_I2S;\r\nbreak;\r\ndefault:\r\nu |= CX18_AI1_MUX_I2S1;\r\nbreak;\r\n}\r\ncx18_write_reg_expect(cx, u | 0xb00, CX18_AUDIO_ENABLE,\r\nu, CX18_AI1_MUX_MASK);\r\n}\r\ncx18_write_reg_expect(cx, v | 0xb00, CX18_AUDIO_ENABLE,\r\nv, CX18_AI1_MUX_MASK);\r\nreturn 0;\r\n}
