static int ar9002_hw_set_channel(struct ath_hw *ah, struct ath9k_channel *chan)\r\n{\r\nu16 bMode, fracMode, aModeRefSel = 0;\r\nu32 freq, ndiv, channelSel = 0, channelFrac = 0, reg32 = 0;\r\nstruct chan_centers centers;\r\nu32 refDivA = 24;\r\nath9k_hw_get_channel_centers(ah, chan, &centers);\r\nfreq = centers.synth_center;\r\nreg32 = REG_READ(ah, AR_PHY_SYNTH_CONTROL);\r\nreg32 &= 0xc0000000;\r\nif (freq < 4800) {\r\nu32 txctl;\r\nint regWrites = 0;\r\nbMode = 1;\r\nfracMode = 1;\r\naModeRefSel = 0;\r\nchannelSel = CHANSEL_2G(freq);\r\nif (AR_SREV_9287_11_OR_LATER(ah)) {\r\nif (freq == 2484) {\r\nREG_WRITE_ARRAY(&ah->iniCckfirJapan2484,\r\n1, regWrites);\r\n} else {\r\nREG_WRITE_ARRAY(&ah->iniCckfirNormal,\r\n1, regWrites);\r\n}\r\n} else {\r\ntxctl = REG_READ(ah, AR_PHY_CCK_TX_CTRL);\r\nif (freq == 2484) {\r\nREG_WRITE(ah, AR_PHY_CCK_TX_CTRL,\r\ntxctl | AR_PHY_CCK_TX_CTRL_JAPAN);\r\n} else {\r\nREG_WRITE(ah, AR_PHY_CCK_TX_CTRL,\r\ntxctl & ~AR_PHY_CCK_TX_CTRL_JAPAN);\r\n}\r\n}\r\n} else {\r\nbMode = 0;\r\nfracMode = 0;\r\nswitch (ah->eep_ops->get_eeprom(ah, EEP_FRAC_N_5G)) {\r\ncase 0:\r\nif (IS_CHAN_HALF_RATE(chan) || IS_CHAN_QUARTER_RATE(chan))\r\naModeRefSel = 0;\r\nelse if ((freq % 20) == 0)\r\naModeRefSel = 3;\r\nelse if ((freq % 10) == 0)\r\naModeRefSel = 2;\r\nif (aModeRefSel)\r\nbreak;\r\ncase 1:\r\ndefault:\r\naModeRefSel = 0;\r\nfracMode = 1;\r\nrefDivA = 1;\r\nchannelSel = CHANSEL_5G(freq);\r\nath9k_hw_analog_shift_rmw(ah, AR_AN_SYNTH9,\r\nAR_AN_SYNTH9_REFDIVA,\r\nAR_AN_SYNTH9_REFDIVA_S, refDivA);\r\n}\r\nif (!fracMode) {\r\nndiv = (freq * (refDivA >> aModeRefSel)) / 60;\r\nchannelSel = ndiv & 0x1ff;\r\nchannelFrac = (ndiv & 0xfffffe00) * 2;\r\nchannelSel = (channelSel << 17) | channelFrac;\r\n}\r\n}\r\nreg32 = reg32 |\r\n(bMode << 29) |\r\n(fracMode << 28) | (aModeRefSel << 26) | (channelSel);\r\nREG_WRITE(ah, AR_PHY_SYNTH_CONTROL, reg32);\r\nah->curchan = chan;\r\nreturn 0;\r\n}\r\nstatic void ar9002_hw_spur_mitigate(struct ath_hw *ah,\r\nstruct ath9k_channel *chan)\r\n{\r\nint bb_spur = AR_NO_SPUR;\r\nint freq;\r\nint bin;\r\nint bb_spur_off, spur_subchannel_sd;\r\nint spur_freq_sd;\r\nint spur_delta_phase;\r\nint denominator;\r\nint tmp, newVal;\r\nint i;\r\nstruct chan_centers centers;\r\nint8_t mask_m[123];\r\nint8_t mask_p[123];\r\nint cur_bb_spur;\r\nbool is2GHz = IS_CHAN_2GHZ(chan);\r\nmemset(&mask_m, 0, sizeof(int8_t) * 123);\r\nmemset(&mask_p, 0, sizeof(int8_t) * 123);\r\nath9k_hw_get_channel_centers(ah, chan, &centers);\r\nfreq = centers.synth_center;\r\nfor (i = 0; i < AR_EEPROM_MODAL_SPURS; i++) {\r\ncur_bb_spur = ah->eep_ops->get_spur_channel(ah, i, is2GHz);\r\nif (AR_NO_SPUR == cur_bb_spur)\r\nbreak;\r\nif (is2GHz)\r\ncur_bb_spur = (cur_bb_spur / 10) + AR_BASE_FREQ_2GHZ;\r\nelse\r\ncur_bb_spur = (cur_bb_spur / 10) + AR_BASE_FREQ_5GHZ;\r\ncur_bb_spur = cur_bb_spur - freq;\r\nif (IS_CHAN_HT40(chan)) {\r\nif ((cur_bb_spur > -AR_SPUR_FEEQ_BOUND_HT40) &&\r\n(cur_bb_spur < AR_SPUR_FEEQ_BOUND_HT40)) {\r\nbb_spur = cur_bb_spur;\r\nbreak;\r\n}\r\n} else if ((cur_bb_spur > -AR_SPUR_FEEQ_BOUND_HT20) &&\r\n(cur_bb_spur < AR_SPUR_FEEQ_BOUND_HT20)) {\r\nbb_spur = cur_bb_spur;\r\nbreak;\r\n}\r\n}\r\nif (AR_NO_SPUR == bb_spur) {\r\nREG_CLR_BIT(ah, AR_PHY_FORCE_CLKEN_CCK,\r\nAR_PHY_FORCE_CLKEN_CCK_MRC_MUX);\r\nreturn;\r\n} else {\r\nREG_CLR_BIT(ah, AR_PHY_FORCE_CLKEN_CCK,\r\nAR_PHY_FORCE_CLKEN_CCK_MRC_MUX);\r\n}\r\nbin = bb_spur * 320;\r\ntmp = REG_READ(ah, AR_PHY_TIMING_CTRL4(0));\r\nENABLE_REGWRITE_BUFFER(ah);\r\nnewVal = tmp | (AR_PHY_TIMING_CTRL4_ENABLE_SPUR_RSSI |\r\nAR_PHY_TIMING_CTRL4_ENABLE_SPUR_FILTER |\r\nAR_PHY_TIMING_CTRL4_ENABLE_CHAN_MASK |\r\nAR_PHY_TIMING_CTRL4_ENABLE_PILOT_MASK);\r\nREG_WRITE(ah, AR_PHY_TIMING_CTRL4(0), newVal);\r\nnewVal = (AR_PHY_SPUR_REG_MASK_RATE_CNTL |\r\nAR_PHY_SPUR_REG_ENABLE_MASK_PPM |\r\nAR_PHY_SPUR_REG_MASK_RATE_SELECT |\r\nAR_PHY_SPUR_REG_ENABLE_VIT_SPUR_RSSI |\r\nSM(SPUR_RSSI_THRESH, AR_PHY_SPUR_REG_SPUR_RSSI_THRESH));\r\nREG_WRITE(ah, AR_PHY_SPUR_REG, newVal);\r\nif (IS_CHAN_HT40(chan)) {\r\nif (bb_spur < 0) {\r\nspur_subchannel_sd = 1;\r\nbb_spur_off = bb_spur + 10;\r\n} else {\r\nspur_subchannel_sd = 0;\r\nbb_spur_off = bb_spur - 10;\r\n}\r\n} else {\r\nspur_subchannel_sd = 0;\r\nbb_spur_off = bb_spur;\r\n}\r\nif (IS_CHAN_HT40(chan))\r\nspur_delta_phase =\r\n((bb_spur * 262144) /\r\n10) & AR_PHY_TIMING11_SPUR_DELTA_PHASE;\r\nelse\r\nspur_delta_phase =\r\n((bb_spur * 524288) /\r\n10) & AR_PHY_TIMING11_SPUR_DELTA_PHASE;\r\ndenominator = IS_CHAN_2GHZ(chan) ? 44 : 40;\r\nspur_freq_sd = ((bb_spur_off * 2048) / denominator) & 0x3ff;\r\nnewVal = (AR_PHY_TIMING11_USE_SPUR_IN_AGC |\r\nSM(spur_freq_sd, AR_PHY_TIMING11_SPUR_FREQ_SD) |\r\nSM(spur_delta_phase, AR_PHY_TIMING11_SPUR_DELTA_PHASE));\r\nREG_WRITE(ah, AR_PHY_TIMING11, newVal);\r\nnewVal = spur_subchannel_sd << AR_PHY_SFCORR_SPUR_SUBCHNL_SD_S;\r\nREG_WRITE(ah, AR_PHY_SFCORR_EXT, newVal);\r\nar5008_hw_cmn_spur_mitigate(ah, chan, bin);\r\nREGWRITE_BUFFER_FLUSH(ah);\r\n}\r\nstatic void ar9002_olc_init(struct ath_hw *ah)\r\n{\r\nu32 i;\r\nif (!OLC_FOR_AR9280_20_LATER)\r\nreturn;\r\nif (OLC_FOR_AR9287_10_LATER) {\r\nREG_SET_BIT(ah, AR_PHY_TX_PWRCTRL9,\r\nAR_PHY_TX_PWRCTRL9_RES_DC_REMOVAL);\r\nath9k_hw_analog_shift_rmw(ah, AR9287_AN_TXPC0,\r\nAR9287_AN_TXPC0_TXPCMODE,\r\nAR9287_AN_TXPC0_TXPCMODE_S,\r\nAR9287_AN_TXPC0_TXPCMODE_TEMPSENSE);\r\nudelay(100);\r\n} else {\r\nfor (i = 0; i < AR9280_TX_GAIN_TABLE_SIZE; i++)\r\nah->originalGain[i] =\r\nMS(REG_READ(ah, AR_PHY_TX_GAIN_TBL1 + i * 4),\r\nAR_PHY_TX_GAIN);\r\nah->PDADCdelta = 0;\r\n}\r\n}\r\nstatic u32 ar9002_hw_compute_pll_control(struct ath_hw *ah,\r\nstruct ath9k_channel *chan)\r\n{\r\nint ref_div = 5;\r\nint pll_div = 0x2c;\r\nu32 pll;\r\nif (chan && IS_CHAN_5GHZ(chan) && !IS_CHAN_A_FAST_CLOCK(ah, chan)) {\r\nif (AR_SREV_9280_20(ah)) {\r\nref_div = 10;\r\npll_div = 0x50;\r\n} else {\r\npll_div = 0x28;\r\n}\r\n}\r\npll = SM(ref_div, AR_RTC_9160_PLL_REFDIV);\r\npll |= SM(pll_div, AR_RTC_9160_PLL_DIV);\r\nif (chan && IS_CHAN_HALF_RATE(chan))\r\npll |= SM(0x1, AR_RTC_9160_PLL_CLKSEL);\r\nelse if (chan && IS_CHAN_QUARTER_RATE(chan))\r\npll |= SM(0x2, AR_RTC_9160_PLL_CLKSEL);\r\nreturn pll;\r\n}\r\nstatic void ar9002_hw_do_getnf(struct ath_hw *ah,\r\nint16_t nfarray[NUM_NF_READINGS])\r\n{\r\nint16_t nf;\r\nnf = MS(REG_READ(ah, AR_PHY_CCA), AR9280_PHY_MINCCA_PWR);\r\nnfarray[0] = sign_extend32(nf, 8);\r\nnf = MS(REG_READ(ah, AR_PHY_EXT_CCA), AR9280_PHY_EXT_MINCCA_PWR);\r\nif (IS_CHAN_HT40(ah->curchan))\r\nnfarray[3] = sign_extend32(nf, 8);\r\nif (!(ah->rxchainmask & BIT(1)))\r\nreturn;\r\nnf = MS(REG_READ(ah, AR_PHY_CH1_CCA), AR9280_PHY_CH1_MINCCA_PWR);\r\nnfarray[1] = sign_extend32(nf, 8);\r\nnf = MS(REG_READ(ah, AR_PHY_CH1_EXT_CCA), AR9280_PHY_CH1_EXT_MINCCA_PWR);\r\nif (IS_CHAN_HT40(ah->curchan))\r\nnfarray[4] = sign_extend32(nf, 8);\r\n}\r\nstatic void ar9002_hw_set_nf_limits(struct ath_hw *ah)\r\n{\r\nif (AR_SREV_9285(ah)) {\r\nah->nf_2g.max = AR_PHY_CCA_MAX_GOOD_VAL_9285_2GHZ;\r\nah->nf_2g.min = AR_PHY_CCA_MIN_GOOD_VAL_9285_2GHZ;\r\nah->nf_2g.nominal = AR_PHY_CCA_NOM_VAL_9285_2GHZ;\r\n} else if (AR_SREV_9287(ah)) {\r\nah->nf_2g.max = AR_PHY_CCA_MAX_GOOD_VAL_9287_2GHZ;\r\nah->nf_2g.min = AR_PHY_CCA_MIN_GOOD_VAL_9287_2GHZ;\r\nah->nf_2g.nominal = AR_PHY_CCA_NOM_VAL_9287_2GHZ;\r\n} else if (AR_SREV_9271(ah)) {\r\nah->nf_2g.max = AR_PHY_CCA_MAX_GOOD_VAL_9271_2GHZ;\r\nah->nf_2g.min = AR_PHY_CCA_MIN_GOOD_VAL_9271_2GHZ;\r\nah->nf_2g.nominal = AR_PHY_CCA_NOM_VAL_9271_2GHZ;\r\n} else {\r\nah->nf_2g.max = AR_PHY_CCA_MAX_GOOD_VAL_9280_2GHZ;\r\nah->nf_2g.min = AR_PHY_CCA_MIN_GOOD_VAL_9280_2GHZ;\r\nah->nf_2g.nominal = AR_PHY_CCA_NOM_VAL_9280_2GHZ;\r\nah->nf_5g.max = AR_PHY_CCA_MAX_GOOD_VAL_9280_5GHZ;\r\nah->nf_5g.min = AR_PHY_CCA_MIN_GOOD_VAL_9280_5GHZ;\r\nah->nf_5g.nominal = AR_PHY_CCA_NOM_VAL_9280_5GHZ;\r\n}\r\n}\r\nstatic void ar9002_hw_antdiv_comb_conf_get(struct ath_hw *ah,\r\nstruct ath_hw_antcomb_conf *antconf)\r\n{\r\nu32 regval;\r\nregval = REG_READ(ah, AR_PHY_MULTICHAIN_GAIN_CTL);\r\nantconf->main_lna_conf = (regval & AR_PHY_9285_ANT_DIV_MAIN_LNACONF) >>\r\nAR_PHY_9285_ANT_DIV_MAIN_LNACONF_S;\r\nantconf->alt_lna_conf = (regval & AR_PHY_9285_ANT_DIV_ALT_LNACONF) >>\r\nAR_PHY_9285_ANT_DIV_ALT_LNACONF_S;\r\nantconf->fast_div_bias = (regval & AR_PHY_9285_FAST_DIV_BIAS) >>\r\nAR_PHY_9285_FAST_DIV_BIAS_S;\r\nantconf->lna1_lna2_switch_delta = -1;\r\nantconf->lna1_lna2_delta = -3;\r\nantconf->div_group = 0;\r\n}\r\nstatic void ar9002_hw_antdiv_comb_conf_set(struct ath_hw *ah,\r\nstruct ath_hw_antcomb_conf *antconf)\r\n{\r\nu32 regval;\r\nregval = REG_READ(ah, AR_PHY_MULTICHAIN_GAIN_CTL);\r\nregval &= ~(AR_PHY_9285_ANT_DIV_MAIN_LNACONF |\r\nAR_PHY_9285_ANT_DIV_ALT_LNACONF |\r\nAR_PHY_9285_FAST_DIV_BIAS);\r\nregval |= ((antconf->main_lna_conf << AR_PHY_9285_ANT_DIV_MAIN_LNACONF_S)\r\n& AR_PHY_9285_ANT_DIV_MAIN_LNACONF);\r\nregval |= ((antconf->alt_lna_conf << AR_PHY_9285_ANT_DIV_ALT_LNACONF_S)\r\n& AR_PHY_9285_ANT_DIV_ALT_LNACONF);\r\nregval |= ((antconf->fast_div_bias << AR_PHY_9285_FAST_DIV_BIAS_S)\r\n& AR_PHY_9285_FAST_DIV_BIAS);\r\nREG_WRITE(ah, AR_PHY_MULTICHAIN_GAIN_CTL, regval);\r\n}\r\nstatic void ar9002_hw_set_bt_ant_diversity(struct ath_hw *ah, bool enable)\r\n{\r\nstruct ath_btcoex_hw *btcoex = &ah->btcoex_hw;\r\nu8 antdiv_ctrl1, antdiv_ctrl2;\r\nu32 regval;\r\nif (enable) {\r\nantdiv_ctrl1 = ATH_BT_COEX_ANTDIV_CONTROL1_ENABLE;\r\nantdiv_ctrl2 = ATH_BT_COEX_ANTDIV_CONTROL2_ENABLE;\r\nbtcoex->bt_coex_mode2 &= (~(AR_BT_DISABLE_BT_ANT));\r\nREG_WRITE(ah, AR_BT_COEX_MODE2, btcoex->bt_coex_mode2);\r\nREG_WRITE(ah, AR_PHY_SWITCH_COM, ATH_BT_COEX_ANT_DIV_SWITCH_COM);\r\nREG_RMW(ah, AR_PHY_SWITCH_CHAIN_0, 0, 0xf0000000);\r\n} else {\r\nantdiv_ctrl1 = ATH_BT_COEX_ANTDIV_CONTROL1_FIXED_A;\r\nantdiv_ctrl2 = ATH_BT_COEX_ANTDIV_CONTROL2_FIXED_A;\r\nbtcoex->bt_coex_mode2 |= AR_BT_DISABLE_BT_ANT;\r\nREG_WRITE(ah, AR_BT_COEX_MODE2, btcoex->bt_coex_mode2);\r\nREG_WRITE(ah, AR_PHY_SWITCH_COM, 0);\r\nREG_RMW(ah, AR_PHY_SWITCH_CHAIN_0, 0, 0xf0000000);\r\n}\r\nregval = REG_READ(ah, AR_PHY_MULTICHAIN_GAIN_CTL);\r\nregval &= (~(AR_PHY_9285_ANT_DIV_CTL_ALL));\r\nregval &= (~(AR_PHY_9285_FAST_DIV_BIAS));\r\nregval |= SM(antdiv_ctrl1, AR_PHY_9285_ANT_DIV_CTL);\r\nregval |= SM(antdiv_ctrl2, AR_PHY_9285_ANT_DIV_ALT_LNACONF);\r\nregval |= SM((antdiv_ctrl2 >> 2), AR_PHY_9285_ANT_DIV_MAIN_LNACONF);\r\nregval |= SM((antdiv_ctrl1 >> 1), AR_PHY_9285_ANT_DIV_ALT_GAINTB);\r\nregval |= SM((antdiv_ctrl1 >> 2), AR_PHY_9285_ANT_DIV_MAIN_GAINTB);\r\nREG_WRITE(ah, AR_PHY_MULTICHAIN_GAIN_CTL, regval);\r\nregval = REG_READ(ah, AR_PHY_CCK_DETECT);\r\nregval &= (~AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV);\r\nregval |= SM((antdiv_ctrl1 >> 3), AR_PHY_CCK_DETECT_BB_ENABLE_ANT_FAST_DIV);\r\nREG_WRITE(ah, AR_PHY_CCK_DETECT, regval);\r\n}\r\nstatic void ar9002_hw_spectral_scan_config(struct ath_hw *ah,\r\nstruct ath_spec_scan *param)\r\n{\r\nu8 count;\r\nif (!param->enabled) {\r\nREG_CLR_BIT(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_ENABLE);\r\nreturn;\r\n}\r\nREG_SET_BIT(ah, AR_PHY_RADAR_0, AR_PHY_RADAR_0_FFT_ENA);\r\nREG_SET_BIT(ah, AR_PHY_SPECTRAL_SCAN, AR_PHY_SPECTRAL_SCAN_ENABLE);\r\nif (param->short_repeat)\r\nREG_SET_BIT(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_SHORT_REPEAT);\r\nelse\r\nREG_CLR_BIT(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_SHORT_REPEAT);\r\ncount = param->count;\r\nif (param->endless) {\r\nif (AR_SREV_9271(ah))\r\ncount = 0;\r\nelse\r\ncount = 0x80;\r\n} else if (count & 0x80)\r\ncount = 0x7f;\r\nREG_RMW_FIELD(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_COUNT, count);\r\nREG_RMW_FIELD(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_PERIOD, param->period);\r\nREG_RMW_FIELD(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_FFT_PERIOD, param->fft_period);\r\nreturn;\r\n}\r\nstatic void ar9002_hw_spectral_scan_trigger(struct ath_hw *ah)\r\n{\r\nREG_SET_BIT(ah, AR_PHY_SPECTRAL_SCAN, AR_PHY_SPECTRAL_SCAN_ENABLE);\r\nREG_SET_BIT(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_ACTIVE);\r\n}\r\nstatic void ar9002_hw_spectral_scan_wait(struct ath_hw *ah)\r\n{\r\nstruct ath_common *common = ath9k_hw_common(ah);\r\nif (!ath9k_hw_wait(ah, AR_PHY_SPECTRAL_SCAN,\r\nAR_PHY_SPECTRAL_SCAN_ACTIVE,\r\n0, AH_WAIT_TIMEOUT)) {\r\nath_err(common, "spectral scan wait failed\n");\r\nreturn;\r\n}\r\n}\r\nstatic void ar9002_hw_tx99_start(struct ath_hw *ah, u32 qnum)\r\n{\r\nREG_SET_BIT(ah, 0x9864, 0x7f000);\r\nREG_SET_BIT(ah, 0x9924, 0x7f00fe);\r\nREG_CLR_BIT(ah, AR_DIAG_SW, AR_DIAG_RX_DIS);\r\nREG_WRITE(ah, AR_CR, AR_CR_RXD);\r\nREG_WRITE(ah, AR_DLCL_IFS(qnum), 0);\r\nREG_WRITE(ah, AR_D_GBL_IFS_SIFS, 20);\r\nREG_WRITE(ah, AR_D_GBL_IFS_EIFS, 20);\r\nREG_WRITE(ah, AR_D_FPCTL, 0x10|qnum);\r\nREG_WRITE(ah, AR_TIME_OUT, 0x00000400);\r\nREG_WRITE(ah, AR_DRETRY_LIMIT(qnum), 0xffffffff);\r\nREG_SET_BIT(ah, AR_QMISC(qnum), AR_Q_MISC_DCU_EARLY_TERM_REQ);\r\n}\r\nstatic void ar9002_hw_tx99_stop(struct ath_hw *ah)\r\n{\r\nREG_SET_BIT(ah, AR_DIAG_SW, AR_DIAG_RX_DIS);\r\n}\r\nvoid ar9002_hw_attach_phy_ops(struct ath_hw *ah)\r\n{\r\nstruct ath_hw_private_ops *priv_ops = ath9k_hw_private_ops(ah);\r\nstruct ath_hw_ops *ops = ath9k_hw_ops(ah);\r\npriv_ops->set_rf_regs = NULL;\r\npriv_ops->rf_set_freq = ar9002_hw_set_channel;\r\npriv_ops->spur_mitigate_freq = ar9002_hw_spur_mitigate;\r\npriv_ops->olc_init = ar9002_olc_init;\r\npriv_ops->compute_pll_control = ar9002_hw_compute_pll_control;\r\npriv_ops->do_getnf = ar9002_hw_do_getnf;\r\nops->antdiv_comb_conf_get = ar9002_hw_antdiv_comb_conf_get;\r\nops->antdiv_comb_conf_set = ar9002_hw_antdiv_comb_conf_set;\r\nops->spectral_scan_config = ar9002_hw_spectral_scan_config;\r\nops->spectral_scan_trigger = ar9002_hw_spectral_scan_trigger;\r\nops->spectral_scan_wait = ar9002_hw_spectral_scan_wait;\r\n#ifdef CONFIG_ATH9K_BTCOEX_SUPPORT\r\nops->set_bt_ant_diversity = ar9002_hw_set_bt_ant_diversity;\r\n#endif\r\nops->tx99_start = ar9002_hw_tx99_start;\r\nops->tx99_stop = ar9002_hw_tx99_stop;\r\nar9002_hw_set_nf_limits(ah);\r\n}
