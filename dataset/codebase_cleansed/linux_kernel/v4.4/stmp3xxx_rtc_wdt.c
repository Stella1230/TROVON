static int wdt_start(struct watchdog_device *wdd)\r\n{\r\nstruct device *dev = watchdog_get_drvdata(wdd);\r\nstruct stmp3xxx_wdt_pdata *pdata = dev_get_platdata(dev);\r\npdata->wdt_set_timeout(dev->parent, wdd->timeout * WDOG_TICK_RATE);\r\nreturn 0;\r\n}\r\nstatic int wdt_stop(struct watchdog_device *wdd)\r\n{\r\nstruct device *dev = watchdog_get_drvdata(wdd);\r\nstruct stmp3xxx_wdt_pdata *pdata = dev_get_platdata(dev);\r\npdata->wdt_set_timeout(dev->parent, 0);\r\nreturn 0;\r\n}\r\nstatic int wdt_set_timeout(struct watchdog_device *wdd, unsigned new_timeout)\r\n{\r\nwdd->timeout = new_timeout;\r\nreturn wdt_start(wdd);\r\n}\r\nstatic int stmp3xxx_wdt_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nwatchdog_set_drvdata(&stmp3xxx_wdd, &pdev->dev);\r\nstmp3xxx_wdd.timeout = clamp_t(unsigned, heartbeat, 1, STMP3XXX_MAX_TIMEOUT);\r\nstmp3xxx_wdd.parent = &pdev->dev;\r\nret = watchdog_register_device(&stmp3xxx_wdd);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "cannot register watchdog device\n");\r\nreturn ret;\r\n}\r\ndev_info(&pdev->dev, "initialized watchdog with heartbeat %ds\n",\r\nstmp3xxx_wdd.timeout);\r\nreturn 0;\r\n}\r\nstatic int stmp3xxx_wdt_remove(struct platform_device *pdev)\r\n{\r\nwatchdog_unregister_device(&stmp3xxx_wdd);\r\nreturn 0;\r\n}\r\nstatic int __maybe_unused stmp3xxx_wdt_suspend(struct device *dev)\r\n{\r\nstruct watchdog_device *wdd = &stmp3xxx_wdd;\r\nif (watchdog_active(wdd))\r\nreturn wdt_stop(wdd);\r\nreturn 0;\r\n}\r\nstatic int __maybe_unused stmp3xxx_wdt_resume(struct device *dev)\r\n{\r\nstruct watchdog_device *wdd = &stmp3xxx_wdd;\r\nif (watchdog_active(wdd))\r\nreturn wdt_start(wdd);\r\nreturn 0;\r\n}
