static void ltm022a97a_lcd_power(int on, struct fb_var_screeninfo *var)\r\n{\r\nstatic int pin_requested = 0;\r\nstruct fb_info *info = container_of(var, struct fb_info, var);\r\nint err;\r\nif (!pin_requested) {\r\nerr = gpio_request(GPIO_LCD_RESET, "lcd reset");\r\nif (err) {\r\npr_err("failed to request gpio for LCD reset\n");\r\nreturn;\r\n}\r\ngpio_direction_output(GPIO_LCD_RESET, 0);\r\npin_requested = 1;\r\n}\r\nif (on) {\r\ngpio_set_value(GPIO_LCD_RESET, 0); msleep(100);\r\ngpio_set_value(GPIO_LCD_RESET, 1); msleep(10);\r\npxafb_smart_queue(info, ARRAY_AND_SIZE(lcd_power_on));\r\npxafb_smart_queue(info, ARRAY_AND_SIZE(lcd_panel_on));\r\n} else {\r\npxafb_smart_queue(info, ARRAY_AND_SIZE(lcd_panel_off));\r\npxafb_smart_queue(info, ARRAY_AND_SIZE(lcd_power_off));\r\n}\r\nerr = pxafb_smart_flush(info);\r\nif (err)\r\npr_err("%s: timed out\n", __func__);\r\n}\r\nstatic void ltm022a97a_update(struct fb_info *info)\r\n{\r\npxafb_smart_queue(info, ARRAY_AND_SIZE(update_framedata));\r\npxafb_smart_flush(info);\r\n}\r\nstatic void __init saar_init_lcd(void)\r\n{\r\npxa_set_fb_info(NULL, &saar_lcd_info);\r\n}\r\nstatic inline void saar_init_lcd(void) {}\r\nstatic void __init saar_init_i2c(void)\r\n{\r\npxa_set_i2c_info(NULL);\r\ni2c_register_board_info(0, ARRAY_AND_SIZE(saar_i2c_info));\r\n}\r\nstatic inline void saar_init_i2c(void) {}\r\nstatic void __init saar_init_onenand(void)\r\n{\r\nplatform_device_register(&saar_device_onenand);\r\n}\r\nstatic void __init saar_init_onenand(void) {}\r\nstatic void __init saar_init(void)\r\n{\r\npxa3xx_mfp_config(ARRAY_AND_SIZE(saar_mfp_cfg));\r\npxa_set_ffuart_info(NULL);\r\npxa_set_btuart_info(NULL);\r\npxa_set_stuart_info(NULL);\r\nplatform_device_register(&smc91x_device);\r\nsaar_init_onenand();\r\nsaar_init_i2c();\r\nsaar_init_lcd();\r\n}
