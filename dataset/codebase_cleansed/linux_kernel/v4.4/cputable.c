static struct cpu_spec * __init setup_cpu_spec(unsigned long offset,\r\nstruct cpu_spec *s)\r\n{\r\nstruct cpu_spec *t = &the_cpu_spec;\r\nstruct cpu_spec old;\r\nt = PTRRELOC(t);\r\nold = *t;\r\n*t = *s;\r\nif (old.num_pmcs && !s->num_pmcs) {\r\nt->num_pmcs = old.num_pmcs;\r\nt->pmc_type = old.pmc_type;\r\nt->oprofile_type = old.oprofile_type;\r\nt->oprofile_mmcra_sihv = old.oprofile_mmcra_sihv;\r\nt->oprofile_mmcra_sipr = old.oprofile_mmcra_sipr;\r\nt->oprofile_mmcra_clear = old.oprofile_mmcra_clear;\r\nif (old.oprofile_cpu_type != NULL) {\r\nt->oprofile_cpu_type = old.oprofile_cpu_type;\r\nt->oprofile_type = old.oprofile_type;\r\n}\r\n}\r\n*PTRRELOC(&cur_cpu_spec) = &the_cpu_spec;\r\nif (*PTRRELOC(&powerpc_base_platform) == NULL)\r\n*PTRRELOC(&powerpc_base_platform) = t->platform;\r\n#if defined(CONFIG_PPC64) || defined(CONFIG_BOOKE)\r\nif (t->cpu_setup) {\r\nt->cpu_setup(offset, t);\r\n}\r\n#endif\r\nreturn t;\r\n}\r\nstruct cpu_spec * __init identify_cpu(unsigned long offset, unsigned int pvr)\r\n{\r\nstruct cpu_spec *s = cpu_specs;\r\nint i;\r\ns = PTRRELOC(s);\r\nfor (i = 0; i < ARRAY_SIZE(cpu_specs); i++,s++) {\r\nif ((pvr & s->pvr_mask) == s->pvr_value)\r\nreturn setup_cpu_spec(offset, s);\r\n}\r\nBUG();\r\nreturn NULL;\r\n}
