static int qfprom_remove(struct platform_device *pdev)\r\n{\r\nstruct nvmem_device *nvmem = platform_get_drvdata(pdev);\r\nreturn nvmem_unregister(nvmem);\r\n}\r\nstatic int qfprom_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct resource *res;\r\nstruct nvmem_device *nvmem;\r\nstruct regmap *regmap;\r\nvoid __iomem *base;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nbase = devm_ioremap_resource(dev, res);\r\nif (IS_ERR(base))\r\nreturn PTR_ERR(base);\r\nqfprom_regmap_config.max_register = resource_size(res) - 1;\r\nregmap = devm_regmap_init_mmio(dev, base, &qfprom_regmap_config);\r\nif (IS_ERR(regmap)) {\r\ndev_err(dev, "regmap init failed\n");\r\nreturn PTR_ERR(regmap);\r\n}\r\neconfig.dev = dev;\r\nnvmem = nvmem_register(&econfig);\r\nif (IS_ERR(nvmem))\r\nreturn PTR_ERR(nvmem);\r\nplatform_set_drvdata(pdev, nvmem);\r\nreturn 0;\r\n}
