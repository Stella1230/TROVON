static ssize_t show_path_cost(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->path_cost);\r\n}\r\nstatic ssize_t show_priority(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->priority);\r\n}\r\nstatic ssize_t show_designated_root(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn br_show_bridge_id(buf, &p->designated_root);\r\n}\r\nstatic ssize_t show_designated_bridge(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn br_show_bridge_id(buf, &p->designated_bridge);\r\n}\r\nstatic ssize_t show_designated_port(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->designated_port);\r\n}\r\nstatic ssize_t show_designated_cost(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->designated_cost);\r\n}\r\nstatic ssize_t show_port_id(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "0x%x\n", p->port_id);\r\n}\r\nstatic ssize_t show_port_no(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "0x%x\n", p->port_no);\r\n}\r\nstatic ssize_t show_change_ack(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->topology_change_ack);\r\n}\r\nstatic ssize_t show_config_pending(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->config_pending);\r\n}\r\nstatic ssize_t show_port_state(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->state);\r\n}\r\nstatic ssize_t show_message_age_timer(struct net_bridge_port *p,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%ld\n", br_timer_value(&p->message_age_timer));\r\n}\r\nstatic ssize_t show_forward_delay_timer(struct net_bridge_port *p,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%ld\n", br_timer_value(&p->forward_delay_timer));\r\n}\r\nstatic ssize_t show_hold_timer(struct net_bridge_port *p,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%ld\n", br_timer_value(&p->hold_timer));\r\n}\r\nstatic int store_flush(struct net_bridge_port *p, unsigned long v)\r\n{\r\nbr_fdb_delete_by_port(p->br, p, 0);\r\nreturn 0;\r\n}\r\nstatic ssize_t show_multicast_router(struct net_bridge_port *p, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", p->multicast_router);\r\n}\r\nstatic int store_multicast_router(struct net_bridge_port *p,\r\nunsigned long v)\r\n{\r\nreturn br_multicast_set_port_router(p, v);\r\n}\r\nstatic ssize_t brport_show(struct kobject *kobj,\r\nstruct attribute *attr, char *buf)\r\n{\r\nstruct brport_attribute *brport_attr = to_brport_attr(attr);\r\nstruct net_bridge_port *p = to_brport(kobj);\r\nreturn brport_attr->show(p, buf);\r\n}\r\nstatic ssize_t brport_store(struct kobject *kobj,\r\nstruct attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct brport_attribute *brport_attr = to_brport_attr(attr);\r\nstruct net_bridge_port *p = to_brport(kobj);\r\nssize_t ret = -EINVAL;\r\nchar *endp;\r\nunsigned long val;\r\nif (!ns_capable(dev_net(p->dev)->user_ns, CAP_NET_ADMIN))\r\nreturn -EPERM;\r\nval = simple_strtoul(buf, &endp, 0);\r\nif (endp != buf) {\r\nif (!rtnl_trylock())\r\nreturn restart_syscall();\r\nif (p->dev && p->br && brport_attr->store) {\r\nspin_lock_bh(&p->br->lock);\r\nret = brport_attr->store(p, val);\r\nspin_unlock_bh(&p->br->lock);\r\nif (ret == 0)\r\nret = count;\r\n}\r\nrtnl_unlock();\r\n}\r\nreturn ret;\r\n}\r\nint br_sysfs_addif(struct net_bridge_port *p)\r\n{\r\nstruct net_bridge *br = p->br;\r\nconst struct brport_attribute **a;\r\nint err;\r\nerr = sysfs_create_link(&p->kobj, &br->dev->dev.kobj,\r\nSYSFS_BRIDGE_PORT_LINK);\r\nif (err)\r\nreturn err;\r\nfor (a = brport_attrs; *a; ++a) {\r\nerr = sysfs_create_file(&p->kobj, &((*a)->attr));\r\nif (err)\r\nreturn err;\r\n}\r\nstrlcpy(p->sysfs_name, p->dev->name, IFNAMSIZ);\r\nreturn sysfs_create_link(br->ifobj, &p->kobj, p->sysfs_name);\r\n}\r\nint br_sysfs_renameif(struct net_bridge_port *p)\r\n{\r\nstruct net_bridge *br = p->br;\r\nint err;\r\nif (!strncmp(p->sysfs_name, p->dev->name, IFNAMSIZ))\r\nreturn 0;\r\nerr = sysfs_rename_link(br->ifobj, &p->kobj,\r\np->sysfs_name, p->dev->name);\r\nif (err)\r\nnetdev_notice(br->dev, "unable to rename link %s to %s",\r\np->sysfs_name, p->dev->name);\r\nelse\r\nstrlcpy(p->sysfs_name, p->dev->name, IFNAMSIZ);\r\nreturn err;\r\n}
