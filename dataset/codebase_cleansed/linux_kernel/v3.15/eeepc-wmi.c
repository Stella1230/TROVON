static void et2012_quirks(void)\r\n{\r\nconst struct dmi_device *dev = NULL;\r\nchar oemstring[30];\r\nwhile ((dev = dmi_find_device(DMI_DEV_TYPE_OEM_STRING, NULL, dev))) {\r\nif (sscanf(dev->name, "AEMS%24c", oemstring) == 1) {\r\nif (oemstring[18] == '1')\r\nquirks = &quirk_asus_et2012_type1;\r\nelse if (oemstring[18] == '3')\r\nquirks = &quirk_asus_et2012_type3;\r\nbreak;\r\n}\r\n}\r\n}\r\nstatic int dmi_matched(const struct dmi_system_id *dmi)\r\n{\r\nchar *model;\r\nquirks = dmi->driver_data;\r\nmodel = (char *)dmi->matches[1].substr;\r\nif (unlikely(strncmp(model, "ET2012", 6) == 0))\r\net2012_quirks();\r\nreturn 1;\r\n}\r\nstatic void eeepc_wmi_key_filter(struct asus_wmi_driver *asus_wmi, int *code,\r\nunsigned int *value, bool *autorelease)\r\n{\r\nswitch (*code) {\r\ncase HOME_PRESS:\r\n*value = 1;\r\n*autorelease = 0;\r\nbreak;\r\ncase HOME_HOLD:\r\n*code = ASUS_WMI_KEY_IGNORE;\r\nbreak;\r\ncase HOME_RELEASE:\r\n*code = HOME_PRESS;\r\n*value = 0;\r\n*autorelease = 0;\r\nbreak;\r\n}\r\n}\r\nstatic acpi_status eeepc_wmi_parse_device(acpi_handle handle, u32 level,\r\nvoid *context, void **retval)\r\n{\r\npr_warn("Found legacy ATKD device (%s)\n", EEEPC_ACPI_HID);\r\n*(bool *)context = true;\r\nreturn AE_CTRL_TERMINATE;\r\n}\r\nstatic int eeepc_wmi_check_atkd(void)\r\n{\r\nacpi_status status;\r\nbool found = false;\r\nstatus = acpi_get_devices(EEEPC_ACPI_HID, eeepc_wmi_parse_device,\r\n&found, NULL);\r\nif (ACPI_FAILURE(status) || !found)\r\nreturn 0;\r\nreturn -1;\r\n}\r\nstatic int eeepc_wmi_probe(struct platform_device *pdev)\r\n{\r\nif (eeepc_wmi_check_atkd()) {\r\npr_warn("WMI device present, but legacy ATKD device is also "\r\n"present and enabled\n");\r\npr_warn("You probably booted with acpi_osi=\"Linux\" or "\r\n"acpi_osi=\"!Windows 2009\"\n");\r\npr_warn("Can't load eeepc-wmi, use default acpi_osi "\r\n"(preferred) or eeepc-laptop\n");\r\nreturn -EBUSY;\r\n}\r\nreturn 0;\r\n}\r\nstatic void eeepc_wmi_quirks(struct asus_wmi_driver *driver)\r\n{\r\nquirks = &quirk_asus_unknown;\r\nquirks->hotplug_wireless = hotplug_wireless;\r\ndmi_check_system(asus_quirks);\r\ndriver->quirks = quirks;\r\ndriver->quirks->wapf = -1;\r\ndriver->panel_power = FB_BLANK_UNBLANK;\r\n}\r\nstatic int __init eeepc_wmi_init(void)\r\n{\r\nreturn asus_wmi_register_driver(&asus_wmi_driver);\r\n}\r\nstatic void __exit eeepc_wmi_exit(void)\r\n{\r\nasus_wmi_unregister_driver(&asus_wmi_driver);\r\n}
