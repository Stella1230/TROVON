void uvd_v2_2_fence_emit(struct radeon_device *rdev,\r\nstruct radeon_fence *fence)\r\n{\r\nstruct radeon_ring *ring = &rdev->ring[fence->ring];\r\nuint64_t addr = rdev->fence_drv[fence->ring].gpu_addr;\r\nradeon_ring_write(ring, PACKET0(UVD_CONTEXT_ID, 0));\r\nradeon_ring_write(ring, fence->seq);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_DATA0, 0));\r\nradeon_ring_write(ring, addr & 0xffffffff);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_DATA1, 0));\r\nradeon_ring_write(ring, upper_32_bits(addr) & 0xff);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_CMD, 0));\r\nradeon_ring_write(ring, 0);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_DATA0, 0));\r\nradeon_ring_write(ring, 0);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_DATA1, 0));\r\nradeon_ring_write(ring, 0);\r\nradeon_ring_write(ring, PACKET0(UVD_GPCOM_VCPU_CMD, 0));\r\nradeon_ring_write(ring, 2);\r\n}\r\nint uvd_v2_2_resume(struct radeon_device *rdev)\r\n{\r\nuint64_t addr;\r\nuint32_t chip_id, size;\r\nint r;\r\nr = radeon_uvd_resume(rdev);\r\nif (r)\r\nreturn r;\r\naddr = rdev->uvd.gpu_addr >> 3;\r\nsize = RADEON_GPU_PAGE_ALIGN(rdev->uvd_fw->size + 4) >> 3;\r\nWREG32(UVD_VCPU_CACHE_OFFSET0, addr);\r\nWREG32(UVD_VCPU_CACHE_SIZE0, size);\r\naddr += size;\r\nsize = RADEON_UVD_STACK_SIZE >> 3;\r\nWREG32(UVD_VCPU_CACHE_OFFSET1, addr);\r\nWREG32(UVD_VCPU_CACHE_SIZE1, size);\r\naddr += size;\r\nsize = RADEON_UVD_HEAP_SIZE >> 3;\r\nWREG32(UVD_VCPU_CACHE_OFFSET2, addr);\r\nWREG32(UVD_VCPU_CACHE_SIZE2, size);\r\naddr = (rdev->uvd.gpu_addr >> 28) & 0xF;\r\nWREG32(UVD_LMI_ADDR_EXT, (addr << 12) | (addr << 0));\r\naddr = (rdev->uvd.gpu_addr >> 32) & 0xFF;\r\nWREG32(UVD_LMI_EXT40_ADDR, addr | (0x9 << 16) | (0x1 << 31));\r\nswitch (rdev->family) {\r\ndefault:\r\nreturn -EINVAL;\r\ncase CHIP_RV710:\r\nchip_id = 0x01000005;\r\nbreak;\r\ncase CHIP_RV730:\r\nchip_id = 0x01000006;\r\nbreak;\r\ncase CHIP_RV740:\r\nchip_id = 0x01000007;\r\nbreak;\r\ncase CHIP_CYPRESS:\r\ncase CHIP_HEMLOCK:\r\nchip_id = 0x01000008;\r\nbreak;\r\ncase CHIP_JUNIPER:\r\nchip_id = 0x01000009;\r\nbreak;\r\ncase CHIP_REDWOOD:\r\nchip_id = 0x0100000a;\r\nbreak;\r\ncase CHIP_CEDAR:\r\nchip_id = 0x0100000b;\r\nbreak;\r\ncase CHIP_SUMO:\r\ncase CHIP_SUMO2:\r\nchip_id = 0x0100000c;\r\nbreak;\r\ncase CHIP_PALM:\r\nchip_id = 0x0100000e;\r\nbreak;\r\ncase CHIP_CAYMAN:\r\nchip_id = 0x0100000f;\r\nbreak;\r\ncase CHIP_BARTS:\r\nchip_id = 0x01000010;\r\nbreak;\r\ncase CHIP_TURKS:\r\nchip_id = 0x01000011;\r\nbreak;\r\ncase CHIP_CAICOS:\r\nchip_id = 0x01000012;\r\nbreak;\r\ncase CHIP_TAHITI:\r\nchip_id = 0x01000014;\r\nbreak;\r\ncase CHIP_VERDE:\r\nchip_id = 0x01000015;\r\nbreak;\r\ncase CHIP_PITCAIRN:\r\ncase CHIP_OLAND:\r\nchip_id = 0x01000016;\r\nbreak;\r\ncase CHIP_ARUBA:\r\nchip_id = 0x01000017;\r\nbreak;\r\n}\r\nWREG32(UVD_VCPU_CHIP_ID, chip_id);\r\nreturn 0;\r\n}
