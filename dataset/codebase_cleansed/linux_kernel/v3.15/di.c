void pr_out(ADAPTER *a)\r\n{\r\nbyte e_no;\r\nENTITY *this = NULL;\r\nBUFFERS *X;\r\nword length;\r\nword i;\r\nword clength;\r\nREQ *ReqOut;\r\nbyte more;\r\nbyte ReadyCount;\r\nbyte ReqCount;\r\nbyte Id;\r\ndtrc(dprintf("pr_out"));\r\ne_no = look_req(a);\r\nif (!e_no)\r\n{\r\ndtrc(dprintf("no_req"));\r\nreturn;\r\n}\r\nReadyCount = pr_ready(a);\r\nif (!ReadyCount)\r\n{\r\ndtrc(dprintf("not_ready"));\r\nreturn;\r\n}\r\nReqCount = 0;\r\nwhile (e_no && ReadyCount) {\r\nnext_req(a);\r\nthis = entity_ptr(a, e_no);\r\n#ifdef USE_EXTENDED_DEBUGS\r\nif (!this)\r\n{\r\nDBG_FTL(("XDI: [%02x] !A%d ==> NULL entity ptr - try to ignore",\r\nxdi_xlog_sec++, (int)((ISDN_ADAPTER *)a->io)->ANum))\r\ne_no = look_req(a);\r\nReadyCount--;\r\ncontinue;\r\n}\r\n{\r\nDBG_TRC((">A%d Id=0x%x Req=0x%x", ((ISDN_ADAPTER *)a->io)->ANum, this->Id, this->Req))\r\n}\r\n#else\r\ndbug(dprintf("out:Req=%x,Id=%x,Ch=%x", this->Req, this->Id, this->ReqCh));\r\n#endif\r\nReqOut = (REQ *)&PR_RAM->B[a->ram_inw(a, &PR_RAM->NextReq)];\r\n#if defined(DIVA_ISTREAM)\r\nif (!(a->tx_stream[this->Id] &&\r\nthis->Req == N_DATA)) {\r\n#endif\r\nlength = 0;\r\ni = this->XCurrent;\r\nX = PTR_X(a, this);\r\nwhile (i < this->XNum && length < 270) {\r\nclength = min((word)(270 - length), (word)(X[i].PLength-this->XOffset));\r\na->ram_out_buffer(a,\r\n&ReqOut->XBuffer.P[length],\r\nPTR_P(a, this, &X[i].P[this->XOffset]),\r\nclength);\r\nlength += clength;\r\nthis->XOffset += clength;\r\nif (this->XOffset == X[i].PLength) {\r\nthis->XCurrent = (byte)++i;\r\nthis->XOffset = 0;\r\n}\r\n}\r\n#if defined(DIVA_ISTREAM)\r\n} else {\r\ni = this->XCurrent;\r\nX = PTR_X(a, this);\r\nwhile (i < this->XNum) {\r\ndiva_istream_write(a,\r\nthis->Id,\r\nPTR_P(a, this, &X[i].P[0]),\r\nX[i].PLength,\r\n((i + 1) == this->XNum),\r\n0, 0);\r\nthis->XCurrent = (byte)++i;\r\n}\r\nlength = 0;\r\n}\r\n#endif\r\na->ram_outw(a, &ReqOut->XBuffer.length, length);\r\na->ram_out(a, &ReqOut->ReqId, this->Id);\r\na->ram_out(a, &ReqOut->ReqCh, this->ReqCh);\r\nif (this->Id & 0x1f) {\r\nthis->More++;\r\nif (i < this->XNum && this->MInd) {\r\nxdi_xlog_request(XDI_A_NR(a), this->Id, this->ReqCh, this->MInd,\r\na->IdTypeTable[this->No]);\r\na->ram_out(a, &ReqOut->Req, this->MInd);\r\nmore = true;\r\n}\r\nelse {\r\nxdi_xlog_request(XDI_A_NR(a), this->Id, this->ReqCh, this->Req,\r\na->IdTypeTable[this->No]);\r\nthis->More |= XMOREF;\r\na->ram_out(a, &ReqOut->Req, this->Req);\r\nmore = false;\r\nif (a->FlowControlIdTable[this->ReqCh] == this->Id)\r\na->FlowControlSkipTable[this->ReqCh] = true;\r\nif (this->Req == REMOVE) {\r\na->misc_flags_table[e_no] |= DIVA_MISC_FLAGS_REMOVE_PENDING;\r\n}\r\n}\r\nif (more) {\r\nreq_queue(a, this->No);\r\n}\r\n}\r\nelse {\r\nthis->MInd = 0;\r\nif (this->Id == BLLC_ID) this->MInd = LL_MDATA;\r\nif (this->Id == NL_ID ||\r\nthis->Id == TASK_ID ||\r\nthis->Id == MAN_ID\r\n) this->MInd = N_MDATA;\r\na->IdTypeTable[this->No] = this->Id;\r\nxdi_xlog_request(XDI_A_NR(a), this->Id, this->ReqCh, this->Req, this->Id);\r\nthis->More |= XMOREF;\r\na->ram_out(a, &ReqOut->Req, this->Req);\r\nassign_queue(a, this->No, a->ram_inw(a, &ReqOut->Reference));\r\n}\r\na->ram_outw(a, &PR_RAM->NextReq, a->ram_inw(a, &ReqOut->next));\r\nReadyCount--;\r\nReqCount++;\r\ne_no = look_req(a);\r\n}\r\na->ram_out(a, &PR_RAM->ReqInput,\r\n(byte)(a->ram_in(a, &PR_RAM->ReqInput) + ReqCount));\r\nif (this && (this->Req == UREMOVE) && this->Id) {\r\nId = this->Id;\r\ne_no = a->IdTable[Id];\r\nfree_entity(a, e_no);\r\nfor (i = 0; i < 256; i++)\r\n{\r\nif (a->FlowControlIdTable[i] == Id)\r\na->FlowControlIdTable[i] = 0;\r\n}\r\na->IdTable[Id] = 0;\r\nthis->Id = 0;\r\n}\r\n}\r\nstatic byte pr_ready(ADAPTER *a)\r\n{\r\nbyte ReadyCount;\r\nReadyCount = (byte)(a->ram_in(a, &PR_RAM->ReqOutput) -\r\na->ram_in(a, &PR_RAM->ReqInput));\r\nif (!ReadyCount) {\r\nif (!a->ReadyInt) {\r\na->ram_inc(a, &PR_RAM->ReadyInt);\r\na->ReadyInt++;\r\n}\r\n}\r\nreturn ReadyCount;\r\n}\r\nbyte pr_dpc(ADAPTER *a)\r\n{\r\nbyte Count;\r\nRC *RcIn;\r\nIND *IndIn;\r\nbyte c;\r\nbyte RNRId;\r\nbyte Rc;\r\nbyte Ind;\r\nif ((Count = a->ram_in(a, &PR_RAM->RcOutput)) != 0) {\r\ndtrc(dprintf("#Rc=%x", Count));\r\nRcIn = (RC *)&PR_RAM->B[a->ram_inw(a, &PR_RAM->NextRc)];\r\nwhile (Count--) {\r\nif ((Rc = a->ram_in(a, &RcIn->Rc)) != 0) {\r\ndword tmp[2];\r\na->ram_in_buffer(a,\r\n&RcIn->Reserved2[0],\r\n(byte *)&tmp[0],\r\n8);\r\nisdn_rc(a,\r\nRc,\r\na->ram_in(a, &RcIn->RcId),\r\na->ram_in(a, &RcIn->RcCh),\r\na->ram_inw(a, &RcIn->Reference),\r\ntmp[0],\r\ntmp[1]);\r\na->ram_out(a, &RcIn->Rc, 0);\r\n}\r\nRcIn = (RC *)&PR_RAM->B[a->ram_inw(a, &RcIn->next)];\r\n}\r\na->ram_out(a, &PR_RAM->RcOutput, 0);\r\npr_out(a);\r\n}\r\nRNRId = 0;\r\nif ((Count = a->ram_in(a, &PR_RAM->IndOutput)) != 0) {\r\ndtrc(dprintf("#Ind=%x", Count));\r\nIndIn = (IND *)&PR_RAM->B[a->ram_inw(a, &PR_RAM->NextInd)];\r\nwhile (Count--) {\r\nif (RNRId && RNRId == a->ram_in(a, &IndIn->IndId)) {\r\na->ram_out(a, &IndIn->Ind, 0);\r\na->ram_out(a, &IndIn->RNR, true);\r\n}\r\nelse {\r\nInd = a->ram_in(a, &IndIn->Ind);\r\nif (Ind) {\r\nRNRId = 0;\r\nc = isdn_ind(a,\r\nInd,\r\na->ram_in(a, &IndIn->IndId),\r\na->ram_in(a, &IndIn->IndCh),\r\n&IndIn->RBuffer,\r\na->ram_in(a, &IndIn->MInd),\r\na->ram_inw(a, &IndIn->MLength));\r\nif (c == 1) {\r\ndtrc(dprintf("RNR"));\r\na->ram_out(a, &IndIn->Ind, 0);\r\nRNRId = a->ram_in(a, &IndIn->IndId);\r\na->ram_out(a, &IndIn->RNR, true);\r\n}\r\n}\r\n}\r\nIndIn = (IND *)&PR_RAM->B[a->ram_inw(a, &IndIn->next)];\r\n}\r\na->ram_out(a, &PR_RAM->IndOutput, 0);\r\n}\r\nreturn false;\r\n}\r\nbyte scom_test_int(ADAPTER *a)\r\n{\r\nreturn a->ram_in(a, (void *)0x3fe);\r\n}\r\nvoid scom_clear_int(ADAPTER *a)\r\n{\r\na->ram_out(a, (void *)0x3fe, 0);\r\n}\r\nstatic byte isdn_rc(ADAPTER *a,\r\nbyte Rc,\r\nbyte Id,\r\nbyte Ch,\r\nword Ref,\r\ndword extended_info_type,\r\ndword extended_info)\r\n{\r\nENTITY *this;\r\nbyte e_no;\r\nword i;\r\nint cancel_rc;\r\n#ifdef USE_EXTENDED_DEBUGS\r\n{\r\nDBG_TRC(("<A%d Id=0x%x Rc=0x%x", ((ISDN_ADAPTER *)a->io)->ANum, Id, Rc))\r\n}\r\n#else\r\ndbug(dprintf("isdn_rc(Rc=%x,Id=%x,Ch=%x)", Rc, Id, Ch));\r\n#endif\r\nif (Rc == READY_INT) {\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 0, 0);\r\nif (a->ReadyInt) {\r\na->ReadyInt--;\r\nreturn 0;\r\n}\r\nreturn 2;\r\n}\r\ne_no = a->IdTable[Id];\r\nif (e_no) {\r\nthis = entity_ptr(a, e_no);\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 0, a->IdTypeTable[this->No]);\r\nthis->RcCh = Ch;\r\nif ((a->misc_flags_table[e_no] & DIVA_MISC_FLAGS_REMOVE_PENDING) &&\r\n(Rc == OK)) {\r\nif (a->IdTypeTable[e_no] == NL_ID) {\r\nif (a->RcExtensionSupported &&\r\n(extended_info_type != DIVA_RC_TYPE_REMOVE_COMPLETE)) {\r\ndtrc(dprintf("XDI: N-REMOVE, A(%02x) Id:%02x, ignore RC=OK",\r\nXDI_A_NR(a), Id));\r\nreturn (0);\r\n}\r\nif (extended_info_type == DIVA_RC_TYPE_REMOVE_COMPLETE)\r\na->RcExtensionSupported = true;\r\n}\r\na->misc_flags_table[e_no] &= ~DIVA_MISC_FLAGS_REMOVE_PENDING;\r\na->misc_flags_table[e_no] &= ~DIVA_MISC_FLAGS_NO_RC_CANCELLING;\r\nfree_entity(a, e_no);\r\nfor (i = 0; i < 256; i++)\r\n{\r\nif (a->FlowControlIdTable[i] == Id)\r\na->FlowControlIdTable[i] = 0;\r\n}\r\na->IdTable[Id] = 0;\r\nthis->Id = 0;\r\nif ((this->More & XMOREC) > 1) {\r\nthis->More &= ~XMOREC;\r\nthis->More |= 1;\r\ndtrc(dprintf("XDI: correct MORE on REMOVE A(%02x) Id:%02x",\r\nXDI_A_NR(a), Id));\r\n}\r\n}\r\nif (Rc == OK_FC) {\r\na->FlowControlIdTable[Ch] = Id;\r\na->FlowControlSkipTable[Ch] = false;\r\nthis->Rc = Rc;\r\nthis->More &= ~(XBUSY | XMOREC);\r\nthis->complete = 0xff;\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 1, a->IdTypeTable[this->No]);\r\nCALLBACK(a, this);\r\nreturn 0;\r\n}\r\nif (extended_info_type == DIVA_RC_TYPE_OK_FC) {\r\na->misc_flags_table[e_no] |= DIVA_MISC_FLAGS_NO_RC_CANCELLING;\r\nthis->Rc = Rc;\r\nthis->complete = 0xff;\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 1, a->IdTypeTable[this->No]);\r\nDBG_TRC(("XDI OK_FC A(%02x) Id:%02x Ch:%02x Rc:%02x",\r\nXDI_A_NR(a), Id, Ch, Rc))\r\nCALLBACK(a, this);\r\nreturn 0;\r\n}\r\ncancel_rc = !(a->misc_flags_table[e_no] & DIVA_MISC_FLAGS_NO_RC_CANCELLING);\r\nif (cancel_rc && (a->FlowControlIdTable[Ch] == Id))\r\n{\r\na->FlowControlIdTable[Ch] = 0;\r\nif ((Rc != OK) || !a->FlowControlSkipTable[Ch])\r\n{\r\nthis->Rc = Rc;\r\nif (Ch == this->ReqCh)\r\n{\r\nthis->More &= ~(XBUSY | XMOREC);\r\nthis->complete = 0xff;\r\n}\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 1, a->IdTypeTable[this->No]);\r\nCALLBACK(a, this);\r\n}\r\nreturn 0;\r\n}\r\nif (this->More & XMOREC)\r\nthis->More--;\r\nif (((!cancel_rc) || (this->More & XMOREF)) && !(this->More & XMOREC)) {\r\nthis->Rc = Rc;\r\nthis->More &= ~XBUSY;\r\nthis->complete = 0xff;\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 1, a->IdTypeTable[this->No]);\r\nCALLBACK(a, this);\r\n}\r\nreturn 0;\r\n}\r\nif ((Rc & 0xf0) == ASSIGN_RC) {\r\ne_no = get_assign(a, Ref);\r\nif (e_no) {\r\nthis = entity_ptr(a, e_no);\r\nthis->Id = Id;\r\nxdi_xlog_rc_event(XDI_A_NR(a), Id, Ch, Rc, 2, a->IdTypeTable[this->No]);\r\nthis->Rc = Rc;\r\nthis->More &= ~XBUSY;\r\nthis->complete = 0xff;\r\n#if defined(DIVA_ISTREAM)\r\nif ((Rc == ASSIGN_OK) && a->ram_offset &&\r\n(a->IdTypeTable[this->No] == NL_ID) &&\r\n((extended_info_type == DIVA_RC_TYPE_RX_DMA) ||\r\n(extended_info_type == DIVA_RC_TYPE_CMA_PTR)) &&\r\nextended_info) {\r\ndword offset = (*(a->ram_offset)) (a);\r\ndword tmp[2];\r\nextended_info -= offset;\r\n#ifdef PLATFORM_GT_32BIT\r\na->ram_in_dw(a, (void *)ULongToPtr(extended_info), (dword *)&tmp[0], 2);\r\n#else\r\na->ram_in_dw(a, (void *)extended_info, (dword *)&tmp[0], 2);\r\n#endif\r\na->tx_stream[Id] = tmp[0];\r\na->rx_stream[Id] = tmp[1];\r\nif (extended_info_type == DIVA_RC_TYPE_RX_DMA) {\r\nDBG_TRC(("Id=0x%x RxDMA=%08x:%08x",\r\nId, a->tx_stream[Id], a->rx_stream[Id]))\r\na->misc_flags_table[this->No] |= DIVA_MISC_FLAGS_RX_DMA;\r\n} else {\r\nDBG_TRC(("Id=0x%x CMA=%08x:%08x",\r\nId, a->tx_stream[Id], a->rx_stream[Id]))\r\na->misc_flags_table[this->No] &= ~DIVA_MISC_FLAGS_RX_DMA;\r\na->rx_pos[Id] = 0;\r\na->rx_stream[Id] -= offset;\r\n}\r\na->tx_pos[Id] = 0;\r\na->tx_stream[Id] -= offset;\r\n} else {\r\na->tx_stream[Id] = 0;\r\na->rx_stream[Id] = 0;\r\na->misc_flags_table[this->No] &= ~DIVA_MISC_FLAGS_RX_DMA;\r\n}\r\n#endif\r\nCALLBACK(a, this);\r\nif (Rc == ASSIGN_OK) {\r\na->IdTable[Id] = e_no;\r\n}\r\nelse\r\n{\r\nfree_entity(a, e_no);\r\nfor (i = 0; i < 256; i++)\r\n{\r\nif (a->FlowControlIdTable[i] == Id)\r\na->FlowControlIdTable[i] = 0;\r\n}\r\na->IdTable[Id] = 0;\r\nthis->Id = 0;\r\n}\r\nreturn 1;\r\n}\r\n}\r\nreturn 2;\r\n}\r\nstatic byte isdn_ind(ADAPTER *a,\r\nbyte Ind,\r\nbyte Id,\r\nbyte Ch,\r\nPBUFFER *RBuffer,\r\nbyte MInd,\r\nword MLength)\r\n{\r\nENTITY *this;\r\nword clength;\r\nword offset;\r\nBUFFERS *R;\r\nbyte *cma = NULL;\r\n#ifdef USE_EXTENDED_DEBUGS\r\n{\r\nDBG_TRC(("<A%d Id=0x%x Ind=0x%x", ((ISDN_ADAPTER *)a->io)->ANum, Id, Ind))\r\n}\r\n#else\r\ndbug(dprintf("isdn_ind(Ind=%x,Id=%x,Ch=%x)", Ind, Id, Ch));\r\n#endif\r\nif (a->IdTable[Id]) {\r\nthis = entity_ptr(a, a->IdTable[Id]);\r\nthis->IndCh = Ch;\r\nxdi_xlog_ind(XDI_A_NR(a), Id, Ch, Ind,\r\n0, 0 , a->IdTypeTable[this->No]);\r\nif (this->RCurrent == 0xff) {\r\nif (Ind == this->MInd) {\r\nthis->complete = 0;\r\nthis->Ind = MInd;\r\n}\r\nelse {\r\nthis->complete = 1;\r\nthis->Ind = Ind;\r\n}\r\nthis->RLength = MLength;\r\n#if defined(DIVA_ISTREAM)\r\nif ((a->rx_stream[this->Id] ||\r\n(a->misc_flags_table[this->No] & DIVA_MISC_FLAGS_RX_DMA)) &&\r\n((Ind == N_DATA) ||\r\n(a->protocol_capabilities & PROTCAP_CMA_ALLPR))) {\r\nPISDN_ADAPTER IoAdapter = (PISDN_ADAPTER)a->io;\r\nif (a->misc_flags_table[this->No] & DIVA_MISC_FLAGS_RX_DMA) {\r\n#if defined(DIVA_IDI_RX_DMA)\r\ndword d;\r\ndiva_get_dma_map_entry(\\r\n(struct _diva_dma_map_entry *)IoAdapter->dma_map,\r\n(int)a->rx_stream[this->Id], (void **)&cma, &d);\r\n#else\r\ncma = &a->stream_buffer[0];\r\ncma[0] = cma[1] = cma[2] = cma[3] = 0;\r\n#endif\r\nthis->RLength = MLength = (word)*(dword *)cma;\r\ncma += 4;\r\n} else {\r\nint final = 0;\r\ncma = &a->stream_buffer[0];\r\nthis->RLength = MLength = (word)diva_istream_read(a,\r\nId,\r\ncma,\r\nsizeof(a->stream_buffer),\r\n&final, NULL, NULL);\r\n}\r\nIoAdapter->RBuffer.length = min(MLength, (word)270);\r\nif (IoAdapter->RBuffer.length != MLength) {\r\nthis->complete = 0;\r\n} else {\r\nthis->complete = 1;\r\n}\r\nmemcpy(IoAdapter->RBuffer.P, cma, IoAdapter->RBuffer.length);\r\nthis->RBuffer = (DBUFFER *)&IoAdapter->RBuffer;\r\n}\r\n#endif\r\nif (!cma) {\r\na->ram_look_ahead(a, RBuffer, this);\r\n}\r\nthis->RNum = 0;\r\nCALLBACK(a, this);\r\nthis = entity_ptr(a, a->IdTable[Id]);\r\nxdi_xlog_ind(XDI_A_NR(a), Id, Ch, Ind,\r\n1, this->RNR, a->IdTypeTable[this->No]);\r\nif (this->RNR == 1) {\r\nthis->RNR = 0;\r\nreturn 1;\r\n}\r\nif (!this->RNR && !this->RNum) {\r\nxdi_xlog_ind(XDI_A_NR(a), Id, Ch, Ind,\r\n2, 0, a->IdTypeTable[this->No]);\r\nreturn 0;\r\n}\r\nthis->RCurrent = 0;\r\nthis->ROffset = 0;\r\n}\r\nif (this->RNR == 2) {\r\nif (Ind != this->MInd) {\r\nthis->RCurrent = 0xff;\r\nthis->RNR = 0;\r\n}\r\nreturn 0;\r\n}\r\noffset = 0;\r\nR = PTR_R(a, this);\r\ndo {\r\nif (this->ROffset == R[this->RCurrent].PLength) {\r\nthis->ROffset = 0;\r\nthis->RCurrent++;\r\n}\r\nif (cma) {\r\nclength = min(MLength, (word)(R[this->RCurrent].PLength-this->ROffset));\r\n} else {\r\nclength = min(a->ram_inw(a, &RBuffer->length)-offset,\r\nR[this->RCurrent].PLength-this->ROffset);\r\n}\r\nif (R[this->RCurrent].P) {\r\nif (cma) {\r\nmemcpy(PTR_P(a, this, &R[this->RCurrent].P[this->ROffset]),\r\n&cma[offset],\r\nclength);\r\n} else {\r\na->ram_in_buffer(a,\r\n&RBuffer->P[offset],\r\nPTR_P(a, this, &R[this->RCurrent].P[this->ROffset]),\r\nclength);\r\n}\r\n}\r\noffset += clength;\r\nthis->ROffset += clength;\r\nif (cma) {\r\nif (offset >= MLength) {\r\nbreak;\r\n}\r\ncontinue;\r\n}\r\n} while (offset < (a->ram_inw(a, &RBuffer->length)));\r\nif (Ind != this->MInd) {\r\nR[this->RCurrent].PLength = this->ROffset;\r\nif (this->ROffset) this->RCurrent++;\r\nthis->RNum = this->RCurrent;\r\nthis->RCurrent = 0xff;\r\nthis->Ind = Ind;\r\nthis->complete = 2;\r\nxdi_xlog_ind(XDI_A_NR(a), Id, Ch, Ind,\r\n3, 0, a->IdTypeTable[this->No]);\r\nCALLBACK(a, this);\r\n}\r\nreturn 0;\r\n}\r\nreturn 2;\r\n}\r\nstatic void xdi_xlog(byte *msg, word code, int length) {\r\nxdi_dbg_xlog("\x00\x02", msg, code, length);\r\n}\r\nstatic void xdi_xlog_rc_event(byte Adapter,\r\nbyte Id, byte Ch, byte Rc, byte cb, byte type) {\r\n#if defined(XDI_USE_XLOG)\r\nword LogInfo[4];\r\nPUT_WORD(&LogInfo[0], ((word)Adapter | (word)(xdi_xlog_sec++ << 8)));\r\nPUT_WORD(&LogInfo[1], ((word)Id | (word)(Ch << 8)));\r\nPUT_WORD(&LogInfo[2], ((word)Rc | (word)(type << 8)));\r\nPUT_WORD(&LogInfo[3], cb);\r\nxdi_xlog((byte *)&LogInfo[0], 221, sizeof(LogInfo));\r\n#endif\r\n}\r\nstatic void xdi_xlog_request(byte Adapter, byte Id,\r\nbyte Ch, byte Req, byte type) {\r\n#if defined(XDI_USE_XLOG)\r\nword LogInfo[3];\r\nPUT_WORD(&LogInfo[0], ((word)Adapter | (word)(xdi_xlog_sec++ << 8)));\r\nPUT_WORD(&LogInfo[1], ((word)Id | (word)(Ch << 8)));\r\nPUT_WORD(&LogInfo[2], ((word)Req | (word)(type << 8)));\r\nxdi_xlog((byte *)&LogInfo[0], 220, sizeof(LogInfo));\r\n#endif\r\n}\r\nstatic void xdi_xlog_ind(byte Adapter,\r\nbyte Id,\r\nbyte Ch,\r\nbyte Ind,\r\nbyte rnr_valid,\r\nbyte rnr,\r\nbyte type) {\r\n#if defined(XDI_USE_XLOG)\r\nword LogInfo[4];\r\nPUT_WORD(&LogInfo[0], ((word)Adapter | (word)(xdi_xlog_sec++ << 8)));\r\nPUT_WORD(&LogInfo[1], ((word)Id | (word)(Ch << 8)));\r\nPUT_WORD(&LogInfo[2], ((word)Ind | (word)(type << 8)));\r\nPUT_WORD(&LogInfo[3], ((word)rnr | (word)(rnr_valid << 8)));\r\nxdi_xlog((byte *)&LogInfo[0], 222, sizeof(LogInfo));\r\n#endif\r\n}
