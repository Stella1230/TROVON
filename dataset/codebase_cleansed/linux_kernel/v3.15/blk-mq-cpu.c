static int blk_mq_main_cpu_notify(struct notifier_block *self,\r\nunsigned long action, void *hcpu)\r\n{\r\nunsigned int cpu = (unsigned long) hcpu;\r\nstruct blk_mq_cpu_notifier *notify;\r\nraw_spin_lock(&blk_mq_cpu_notify_lock);\r\nlist_for_each_entry(notify, &blk_mq_cpu_notify_list, list)\r\nnotify->notify(notify->data, action, cpu);\r\nraw_spin_unlock(&blk_mq_cpu_notify_lock);\r\nreturn NOTIFY_OK;\r\n}\r\nvoid blk_mq_register_cpu_notifier(struct blk_mq_cpu_notifier *notifier)\r\n{\r\nBUG_ON(!notifier->notify);\r\nraw_spin_lock(&blk_mq_cpu_notify_lock);\r\nlist_add_tail(&notifier->list, &blk_mq_cpu_notify_list);\r\nraw_spin_unlock(&blk_mq_cpu_notify_lock);\r\n}\r\nvoid blk_mq_unregister_cpu_notifier(struct blk_mq_cpu_notifier *notifier)\r\n{\r\nraw_spin_lock(&blk_mq_cpu_notify_lock);\r\nlist_del(&notifier->list);\r\nraw_spin_unlock(&blk_mq_cpu_notify_lock);\r\n}\r\nvoid blk_mq_init_cpu_notifier(struct blk_mq_cpu_notifier *notifier,\r\nvoid (*fn)(void *, unsigned long, unsigned int),\r\nvoid *data)\r\n{\r\nnotifier->notify = fn;\r\nnotifier->data = data;\r\n}\r\nvoid __init blk_mq_cpu_init(void)\r\n{\r\nhotcpu_notifier(blk_mq_main_cpu_notify, 0);\r\n}
