int\r\nusb_gadget_get_string (struct usb_gadget_strings *table, int id, u8 *buf)\r\n{\r\nstruct usb_string *s;\r\nint len;\r\nif (id == 0) {\r\nbuf [0] = 4;\r\nbuf [1] = USB_DT_STRING;\r\nbuf [2] = (u8) table->language;\r\nbuf [3] = (u8) (table->language >> 8);\r\nreturn 4;\r\n}\r\nfor (s = table->strings; s && s->s; s++)\r\nif (s->id == id)\r\nbreak;\r\nif (!s || !s->s)\r\nreturn -EINVAL;\r\nlen = min ((size_t) 126, strlen (s->s));\r\nlen = utf8s_to_utf16s(s->s, len, UTF16_LITTLE_ENDIAN,\r\n(wchar_t *) &buf[2], 126);\r\nif (len < 0)\r\nreturn -EINVAL;\r\nbuf [0] = (len + 1) * 2;\r\nbuf [1] = USB_DT_STRING;\r\nreturn buf [0];\r\n}
