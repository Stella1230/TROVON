int libipw_is_valid_channel(struct libipw_device *ieee, u8 channel)\r\n{\r\nint i;\r\nif (ieee->geo.bg_channels == 0 && ieee->geo.a_channels == 0)\r\nreturn 0;\r\nif (ieee->freq_band & LIBIPW_24GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.bg_channels; i++)\r\nif ((ieee->geo.bg[i].channel == channel) &&\r\n!(ieee->geo.bg[i].flags & LIBIPW_CH_INVALID) &&\r\n(!(ieee->mode & IEEE_G) ||\r\n!(ieee->geo.bg[i].flags & LIBIPW_CH_B_ONLY)))\r\nreturn LIBIPW_24GHZ_BAND;\r\nif (ieee->freq_band & LIBIPW_52GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.a_channels; i++)\r\nif ((ieee->geo.a[i].channel == channel) &&\r\n!(ieee->geo.a[i].flags & LIBIPW_CH_INVALID))\r\nreturn LIBIPW_52GHZ_BAND;\r\nreturn 0;\r\n}\r\nint libipw_channel_to_index(struct libipw_device *ieee, u8 channel)\r\n{\r\nint i;\r\nif (ieee->geo.bg_channels == 0 && ieee->geo.a_channels == 0)\r\nreturn -1;\r\nif (ieee->freq_band & LIBIPW_24GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.bg_channels; i++)\r\nif (ieee->geo.bg[i].channel == channel)\r\nreturn i;\r\nif (ieee->freq_band & LIBIPW_52GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.a_channels; i++)\r\nif (ieee->geo.a[i].channel == channel)\r\nreturn i;\r\nreturn -1;\r\n}\r\nu32 libipw_channel_to_freq(struct libipw_device * ieee, u8 channel)\r\n{\r\nconst struct libipw_channel * ch;\r\nif (ieee->geo.bg_channels == 0 && ieee->geo.a_channels == 0)\r\nreturn 0;\r\nch = libipw_get_channel(ieee, channel);\r\nif (!ch->channel)\r\nreturn 0;\r\nreturn ch->freq;\r\n}\r\nu8 libipw_freq_to_channel(struct libipw_device * ieee, u32 freq)\r\n{\r\nint i;\r\nif (ieee->geo.bg_channels == 0 && ieee->geo.a_channels == 0)\r\nreturn 0;\r\nfreq /= 100000;\r\nif (ieee->freq_band & LIBIPW_24GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.bg_channels; i++)\r\nif (ieee->geo.bg[i].freq == freq)\r\nreturn ieee->geo.bg[i].channel;\r\nif (ieee->freq_band & LIBIPW_52GHZ_BAND)\r\nfor (i = 0; i < ieee->geo.a_channels; i++)\r\nif (ieee->geo.a[i].freq == freq)\r\nreturn ieee->geo.a[i].channel;\r\nreturn 0;\r\n}\r\nvoid libipw_set_geo(struct libipw_device *ieee,\r\nconst struct libipw_geo *geo)\r\n{\r\nmemcpy(ieee->geo.name, geo->name, 3);\r\nieee->geo.name[3] = '\0';\r\nieee->geo.bg_channels = geo->bg_channels;\r\nieee->geo.a_channels = geo->a_channels;\r\nmemcpy(ieee->geo.bg, geo->bg, geo->bg_channels *\r\nsizeof(struct libipw_channel));\r\nmemcpy(ieee->geo.a, geo->a, ieee->geo.a_channels *\r\nsizeof(struct libipw_channel));\r\n}\r\nconst struct libipw_geo *libipw_get_geo(struct libipw_device *ieee)\r\n{\r\nreturn &ieee->geo;\r\n}\r\nu8 libipw_get_channel_flags(struct libipw_device * ieee, u8 channel)\r\n{\r\nint index = libipw_channel_to_index(ieee, channel);\r\nif (index == -1)\r\nreturn LIBIPW_CH_INVALID;\r\nif (channel <= LIBIPW_24GHZ_CHANNELS)\r\nreturn ieee->geo.bg[index].flags;\r\nreturn ieee->geo.a[index].flags;\r\n}\r\nconst struct libipw_channel *libipw_get_channel(struct libipw_device\r\n*ieee, u8 channel)\r\n{\r\nint index = libipw_channel_to_index(ieee, channel);\r\nif (index == -1)\r\nreturn &bad_channel;\r\nif (channel <= LIBIPW_24GHZ_CHANNELS)\r\nreturn &ieee->geo.bg[index];\r\nreturn &ieee->geo.a[index];\r\n}
