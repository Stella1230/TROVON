static void hdmi_phy_8960_destroy(struct hdmi_phy *phy)\r\n{\r\nstruct hdmi_phy_8960 *phy_8960 = to_hdmi_phy_8960(phy);\r\nkfree(phy_8960);\r\n}\r\nstatic void hdmi_phy_8960_reset(struct hdmi_phy *phy)\r\n{\r\nstruct hdmi_phy_8960 *phy_8960 = to_hdmi_phy_8960(phy);\r\nstruct hdmi *hdmi = phy_8960->hdmi;\r\nunsigned int val;\r\nval = hdmi_read(hdmi, REG_HDMI_PHY_CTRL);\r\nif (val & HDMI_PHY_CTRL_SW_RESET_LOW) {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval & ~HDMI_PHY_CTRL_SW_RESET);\r\n} else {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval | HDMI_PHY_CTRL_SW_RESET);\r\n}\r\nif (val & HDMI_PHY_CTRL_SW_RESET_PLL_LOW) {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval & ~HDMI_PHY_CTRL_SW_RESET_PLL);\r\n} else {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval | HDMI_PHY_CTRL_SW_RESET_PLL);\r\n}\r\nmsleep(100);\r\nif (val & HDMI_PHY_CTRL_SW_RESET_LOW) {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval | HDMI_PHY_CTRL_SW_RESET);\r\n} else {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval & ~HDMI_PHY_CTRL_SW_RESET);\r\n}\r\nif (val & HDMI_PHY_CTRL_SW_RESET_PLL_LOW) {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval | HDMI_PHY_CTRL_SW_RESET_PLL);\r\n} else {\r\nhdmi_write(hdmi, REG_HDMI_PHY_CTRL,\r\nval & ~HDMI_PHY_CTRL_SW_RESET_PLL);\r\n}\r\n}\r\nstatic void hdmi_phy_8960_powerup(struct hdmi_phy *phy,\r\nunsigned long int pixclock)\r\n{\r\nstruct hdmi_phy_8960 *phy_8960 = to_hdmi_phy_8960(phy);\r\nstruct hdmi *hdmi = phy_8960->hdmi;\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG0, 0x1b);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG1, 0xf2);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG4, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG5, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG6, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG7, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG8, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG9, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG10, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG11, 0x00);\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG3, 0x20);\r\n}\r\nstatic void hdmi_phy_8960_powerdown(struct hdmi_phy *phy)\r\n{\r\nstruct hdmi_phy_8960 *phy_8960 = to_hdmi_phy_8960(phy);\r\nstruct hdmi *hdmi = phy_8960->hdmi;\r\nhdmi_write(hdmi, REG_HDMI_8960_PHY_REG2, 0x7f);\r\n}\r\nstruct hdmi_phy *hdmi_phy_8960_init(struct hdmi *hdmi)\r\n{\r\nstruct hdmi_phy_8960 *phy_8960;\r\nstruct hdmi_phy *phy = NULL;\r\nint ret;\r\nphy_8960 = kzalloc(sizeof(*phy_8960), GFP_KERNEL);\r\nif (!phy_8960) {\r\nret = -ENOMEM;\r\ngoto fail;\r\n}\r\nphy = &phy_8960->base;\r\nphy->funcs = &hdmi_phy_8960_funcs;\r\nphy_8960->hdmi = hdmi;\r\nreturn phy;\r\nfail:\r\nif (phy)\r\nhdmi_phy_8960_destroy(phy);\r\nreturn ERR_PTR(ret);\r\n}
