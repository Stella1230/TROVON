int omap_hdq1w_reset(struct omap_hwmod *oh)\r\n{\r\nu32 v;\r\nint c = 0;\r\nomap_hwmod_softreset(oh);\r\nv = omap_hwmod_read(oh, HDQ_CTRL_STATUS_OFFSET);\r\nv |= 1 << HDQ_CTRL_STATUS_CLOCKENABLE_SHIFT;\r\nomap_hwmod_write(v, oh, HDQ_CTRL_STATUS_OFFSET);\r\nomap_test_timeout((omap_hwmod_read(oh,\r\noh->class->sysc->syss_offs)\r\n& SYSS_RESETDONE_MASK),\r\nMAX_MODULE_SOFTRESET_WAIT, c);\r\nif (c == MAX_MODULE_SOFTRESET_WAIT)\r\npr_warning("%s: %s: softreset failed (waited %d usec)\n",\r\n__func__, oh->name, MAX_MODULE_SOFTRESET_WAIT);\r\nelse\r\npr_debug("%s: %s: softreset in %d usec\n", __func__,\r\noh->name, c);\r\nreturn 0;\r\n}\r\nstatic int __init omap_init_hdq(void)\r\n{\r\nint id = -1;\r\nstruct platform_device *pdev;\r\nstruct omap_hwmod *oh;\r\nchar *oh_name = "hdq1w";\r\nchar *devname = "omap_hdq";\r\noh = omap_hwmod_lookup(oh_name);\r\nif (!oh)\r\nreturn 0;\r\npdev = omap_device_build(devname, id, oh, NULL, 0);\r\nWARN(IS_ERR(pdev), "Can't build omap_device for %s:%s.\n",\r\ndevname, oh->name);\r\nreturn 0;\r\n}
