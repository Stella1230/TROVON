static void __init tegra_init_cache(void)\r\n{\r\n#ifdef CONFIG_CACHE_L2X0\r\nstatic const struct of_device_id pl310_ids[] __initconst = {\r\n{ .compatible = "arm,pl310-cache", },\r\n{}\r\n};\r\nstruct device_node *np;\r\nint ret;\r\nvoid __iomem *p = IO_ADDRESS(TEGRA_ARM_PERIF_BASE) + 0x3000;\r\nu32 aux_ctrl, cache_type;\r\nnp = of_find_matching_node(NULL, pl310_ids);\r\nif (!np)\r\nreturn;\r\ncache_type = readl(p + L2X0_CACHE_TYPE);\r\naux_ctrl = (cache_type & 0x700) << (17-8);\r\naux_ctrl |= 0x7C400001;\r\nret = l2x0_of_init(aux_ctrl, 0x8200c3fe);\r\nif (!ret)\r\nl2x0_saved_regs_addr = virt_to_phys(&l2x0_saved_regs);\r\n#endif\r\n}\r\nstatic void __init tegra_init_early(void)\r\n{\r\nof_register_trusted_foundations();\r\ntegra_apb_io_init();\r\ntegra_init_fuse();\r\ntegra_cpu_reset_handler_init();\r\ntegra_init_cache();\r\ntegra_powergate_init();\r\ntegra_hotplug_init();\r\n}\r\nstatic void __init tegra_dt_init_irq(void)\r\n{\r\ntegra_pmc_init_irq();\r\ntegra_init_irq();\r\nirqchip_init();\r\ntegra_legacy_irq_syscore_init();\r\n}\r\nstatic void __init tegra_dt_init(void)\r\n{\r\nstruct soc_device_attribute *soc_dev_attr;\r\nstruct soc_device *soc_dev;\r\nstruct device *parent = NULL;\r\ntegra_pmc_init();\r\ntegra_clocks_apply_init_table();\r\nsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\r\nif (!soc_dev_attr)\r\ngoto out;\r\nsoc_dev_attr->family = kasprintf(GFP_KERNEL, "Tegra");\r\nsoc_dev_attr->revision = kasprintf(GFP_KERNEL, "%d", tegra_revision);\r\nsoc_dev_attr->soc_id = kasprintf(GFP_KERNEL, "%d", tegra_chip_id);\r\nsoc_dev = soc_device_register(soc_dev_attr);\r\nif (IS_ERR(soc_dev)) {\r\nkfree(soc_dev_attr->family);\r\nkfree(soc_dev_attr->revision);\r\nkfree(soc_dev_attr->soc_id);\r\nkfree(soc_dev_attr);\r\ngoto out;\r\n}\r\nparent = soc_device_to_device(soc_dev);\r\nout:\r\nof_platform_populate(NULL, of_default_bus_match_table, NULL, parent);\r\n}\r\nstatic void __init paz00_init(void)\r\n{\r\nif (IS_ENABLED(CONFIG_ARCH_TEGRA_2x_SOC))\r\ntegra_paz00_wifikill_init();\r\n}\r\nstatic void __init tegra_dt_init_late(void)\r\n{\r\nint i;\r\ntegra_init_suspend();\r\ntegra_cpuidle_init();\r\ntegra_powergate_debugfs_init();\r\nfor (i = 0; i < ARRAY_SIZE(board_init_funcs); i++) {\r\nif (of_machine_is_compatible(board_init_funcs[i].machine)) {\r\nboard_init_funcs[i].init();\r\nbreak;\r\n}\r\n}\r\n}
