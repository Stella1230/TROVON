int mlx5_core_attach_mcg(struct mlx5_core_dev *dev, union ib_gid *mgid, u32 qpn)\r\n{\r\nstruct mlx5_attach_mcg_mbox_in in;\r\nstruct mlx5_attach_mcg_mbox_out out;\r\nint err;\r\nmemset(&in, 0, sizeof(in));\r\nmemset(&out, 0, sizeof(out));\r\nin.hdr.opcode = cpu_to_be16(MLX5_CMD_OP_ATTACH_TO_MCG);\r\nmemcpy(in.gid, mgid, sizeof(*mgid));\r\nin.qpn = cpu_to_be32(qpn);\r\nerr = mlx5_cmd_exec(dev, &in, sizeof(in), &out, sizeof(out));\r\nif (err)\r\nreturn err;\r\nif (out.hdr.status)\r\nerr = mlx5_cmd_status_to_err(&out.hdr);\r\nreturn err;\r\n}\r\nint mlx5_core_detach_mcg(struct mlx5_core_dev *dev, union ib_gid *mgid, u32 qpn)\r\n{\r\nstruct mlx5_detach_mcg_mbox_in in;\r\nstruct mlx5_detach_mcg_mbox_out out;\r\nint err;\r\nmemset(&in, 0, sizeof(in));\r\nmemset(&out, 0, sizeof(out));\r\nin.hdr.opcode = cpu_to_be16(MLX5_CMD_OP_DETACH_FROM_MCG);\r\nmemcpy(in.gid, mgid, sizeof(*mgid));\r\nin.qpn = cpu_to_be32(qpn);\r\nerr = mlx5_cmd_exec(dev, &in, sizeof(in), &out, sizeof(out));\r\nif (err)\r\nreturn err;\r\nif (out.hdr.status)\r\nerr = mlx5_cmd_status_to_err(&out.hdr);\r\nreturn err;\r\n}
