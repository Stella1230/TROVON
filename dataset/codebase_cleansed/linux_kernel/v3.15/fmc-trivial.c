static irqreturn_t t_handler(int irq, void *dev_id)\r\n{\r\nstruct fmc_device *fmc = dev_id;\r\nfmc->op->irq_ack(fmc);\r\ndev_info(&fmc->dev, "received irq %i\n", irq);\r\nreturn IRQ_HANDLED;\r\n}\r\nstatic int t_probe(struct fmc_device *fmc)\r\n{\r\nint ret;\r\nint index = 0;\r\nif (fmc->op->validate)\r\nindex = fmc->op->validate(fmc, &t_drv);\r\nif (index < 0)\r\nreturn -EINVAL;\r\nret = fmc->op->irq_request(fmc, t_handler, "fmc-trivial", IRQF_SHARED);\r\nif (ret < 0)\r\nreturn ret;\r\nfmc->op->gpio_config(fmc, t_gpio, ARRAY_SIZE(t_gpio));\r\nret = -ESRCH;\r\nif (fmc->op->reprogram)\r\nret = fmc->op->reprogram(fmc, &t_drv, "");\r\nif (ret == -ESRCH)\r\nret = 0;\r\nif (ret < 0)\r\nfmc->op->irq_free(fmc);\r\nreturn ret;\r\n}\r\nstatic int t_remove(struct fmc_device *fmc)\r\n{\r\nfmc->op->irq_free(fmc);\r\nreturn 0;\r\n}\r\nstatic int t_init(void)\r\n{\r\nint ret;\r\nret = fmc_driver_register(&t_drv);\r\nreturn ret;\r\n}\r\nstatic void t_exit(void)\r\n{\r\nfmc_driver_unregister(&t_drv);\r\n}
