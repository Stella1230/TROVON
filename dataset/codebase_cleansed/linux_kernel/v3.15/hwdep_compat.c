static int snd_hwdep_dsp_load_compat(struct snd_hwdep *hw,\r\nstruct snd_hwdep_dsp_image32 __user *src)\r\n{\r\nstruct snd_hwdep_dsp_image __user *dst;\r\ncompat_caddr_t ptr;\r\nu32 val;\r\ndst = compat_alloc_user_space(sizeof(*dst));\r\nif (copy_in_user(dst, src, 4 + 64))\r\nreturn -EFAULT;\r\nif (get_user(ptr, &src->image) ||\r\nput_user(compat_ptr(ptr), &dst->image))\r\nreturn -EFAULT;\r\nif (get_user(val, &src->length) ||\r\nput_user(val, &dst->length))\r\nreturn -EFAULT;\r\nif (get_user(val, &src->driver_data) ||\r\nput_user(val, &dst->driver_data))\r\nreturn -EFAULT;\r\nreturn snd_hwdep_dsp_load(hw, dst);\r\n}\r\nstatic long snd_hwdep_ioctl_compat(struct file * file, unsigned int cmd,\r\nunsigned long arg)\r\n{\r\nstruct snd_hwdep *hw = file->private_data;\r\nvoid __user *argp = compat_ptr(arg);\r\nswitch (cmd) {\r\ncase SNDRV_HWDEP_IOCTL_PVERSION:\r\ncase SNDRV_HWDEP_IOCTL_INFO:\r\ncase SNDRV_HWDEP_IOCTL_DSP_STATUS:\r\nreturn snd_hwdep_ioctl(file, cmd, (unsigned long)argp);\r\ncase SNDRV_HWDEP_IOCTL_DSP_LOAD32:\r\nreturn snd_hwdep_dsp_load_compat(hw, argp);\r\n}\r\nif (hw->ops.ioctl_compat)\r\nreturn hw->ops.ioctl_compat(hw, file, cmd, arg);\r\nreturn -ENOIOCTLCMD;\r\n}
