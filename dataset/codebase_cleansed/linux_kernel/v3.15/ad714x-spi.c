static int ad714x_spi_suspend(struct device *dev)\r\n{\r\nreturn ad714x_disable(spi_get_drvdata(to_spi_device(dev)));\r\n}\r\nstatic int ad714x_spi_resume(struct device *dev)\r\n{\r\nreturn ad714x_enable(spi_get_drvdata(to_spi_device(dev)));\r\n}\r\nstatic int ad714x_spi_read(struct ad714x_chip *chip,\r\nunsigned short reg, unsigned short *data, size_t len)\r\n{\r\nstruct spi_device *spi = to_spi_device(chip->dev);\r\nstruct spi_message message;\r\nstruct spi_transfer xfer[2];\r\nint i;\r\nint error;\r\nspi_message_init(&message);\r\nmemset(xfer, 0, sizeof(xfer));\r\nchip->xfer_buf[0] = cpu_to_be16(AD714x_SPI_CMD_PREFIX |\r\nAD714x_SPI_READ | reg);\r\nxfer[0].tx_buf = &chip->xfer_buf[0];\r\nxfer[0].len = sizeof(chip->xfer_buf[0]);\r\nspi_message_add_tail(&xfer[0], &message);\r\nxfer[1].rx_buf = &chip->xfer_buf[1];\r\nxfer[1].len = sizeof(chip->xfer_buf[1]) * len;\r\nspi_message_add_tail(&xfer[1], &message);\r\nerror = spi_sync(spi, &message);\r\nif (unlikely(error)) {\r\ndev_err(chip->dev, "SPI read error: %d\n", error);\r\nreturn error;\r\n}\r\nfor (i = 0; i < len; i++)\r\ndata[i] = be16_to_cpu(chip->xfer_buf[i + 1]);\r\nreturn 0;\r\n}\r\nstatic int ad714x_spi_write(struct ad714x_chip *chip,\r\nunsigned short reg, unsigned short data)\r\n{\r\nstruct spi_device *spi = to_spi_device(chip->dev);\r\nint error;\r\nchip->xfer_buf[0] = cpu_to_be16(AD714x_SPI_CMD_PREFIX | reg);\r\nchip->xfer_buf[1] = cpu_to_be16(data);\r\nerror = spi_write(spi, (u8 *)chip->xfer_buf,\r\n2 * sizeof(*chip->xfer_buf));\r\nif (unlikely(error)) {\r\ndev_err(chip->dev, "SPI write error: %d\n", error);\r\nreturn error;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ad714x_spi_probe(struct spi_device *spi)\r\n{\r\nstruct ad714x_chip *chip;\r\nint err;\r\nspi->bits_per_word = 8;\r\nerr = spi_setup(spi);\r\nif (err < 0)\r\nreturn err;\r\nchip = ad714x_probe(&spi->dev, BUS_SPI, spi->irq,\r\nad714x_spi_read, ad714x_spi_write);\r\nif (IS_ERR(chip))\r\nreturn PTR_ERR(chip);\r\nspi_set_drvdata(spi, chip);\r\nreturn 0;\r\n}\r\nstatic int ad714x_spi_remove(struct spi_device *spi)\r\n{\r\nstruct ad714x_chip *chip = spi_get_drvdata(spi);\r\nad714x_remove(chip);\r\nreturn 0;\r\n}
