static int labpc_pci_auto_attach(struct comedi_device *dev,\r\nunsigned long context)\r\n{\r\nstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\r\nconst struct labpc_boardinfo *board = NULL;\r\nstruct labpc_private *devpriv;\r\nint ret;\r\nif (context < ARRAY_SIZE(labpc_pci_boards))\r\nboard = &labpc_pci_boards[context];\r\nif (!board)\r\nreturn -ENODEV;\r\ndev->board_ptr = board;\r\ndev->board_name = board->name;\r\nret = comedi_pci_enable(dev);\r\nif (ret)\r\nreturn ret;\r\ndevpriv = comedi_alloc_devpriv(dev, sizeof(*devpriv));\r\nif (!devpriv)\r\nreturn -ENOMEM;\r\ndevpriv->mite = mite_alloc(pcidev);\r\nif (!devpriv->mite)\r\nreturn -ENOMEM;\r\nret = mite_setup(devpriv->mite);\r\nif (ret < 0)\r\nreturn ret;\r\ndev->iobase = (unsigned long)devpriv->mite->daq_io_addr;\r\nreturn labpc_common_attach(dev, mite_irq(devpriv->mite), IRQF_SHARED);\r\n}\r\nstatic void labpc_pci_detach(struct comedi_device *dev)\r\n{\r\nstruct labpc_private *devpriv = dev->private;\r\nif (devpriv && devpriv->mite) {\r\nmite_unsetup(devpriv->mite);\r\nmite_free(devpriv->mite);\r\n}\r\nif (dev->irq)\r\nfree_irq(dev->irq, dev);\r\ncomedi_pci_disable(dev);\r\n}\r\nstatic int labpc_pci_probe(struct pci_dev *dev,\r\nconst struct pci_device_id *id)\r\n{\r\nreturn comedi_pci_auto_config(dev, &labpc_pci_comedi_driver,\r\nid->driver_data);\r\n}
