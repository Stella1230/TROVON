static void enable_intc_irq(struct irq_data *data)\r\n{\r\nunsigned int irq = data->irq;\r\nunsigned long reg;\r\nunsigned long bitmask;\r\nif ((irq <= IRQ_IRL3) && (irlm == NO_PRIORITY))\r\nprintk("Trying to use straight IRL0-3 with an encoding platform.\n");\r\nif (irq < 32) {\r\nreg = INTC_INTENB_0;\r\nbitmask = 1 << irq;\r\n} else {\r\nreg = INTC_INTENB_1;\r\nbitmask = 1 << (irq - 32);\r\n}\r\n__raw_writel(bitmask, reg);\r\n}\r\nstatic void disable_intc_irq(struct irq_data *data)\r\n{\r\nunsigned int irq = data->irq;\r\nunsigned long reg;\r\nunsigned long bitmask;\r\nif (irq < 32) {\r\nreg = INTC_INTDSB_0;\r\nbitmask = 1 << irq;\r\n} else {\r\nreg = INTC_INTDSB_1;\r\nbitmask = 1 << (irq - 32);\r\n}\r\n__raw_writel(bitmask, reg);\r\n}\r\nvoid __init plat_irq_setup(void)\r\n{\r\nunsigned long long __dummy0, __dummy1=~0x00000000100000f0;\r\nunsigned long reg;\r\nint i;\r\nintc_virt = (unsigned long)ioremap_nocache(INTC_BASE, 1024);\r\nif (!intc_virt) {\r\npanic("Unable to remap INTC\n");\r\n}\r\nfor (i = 0; i < NR_INTC_IRQS; i++)\r\nirq_set_chip_and_handler(i, &intc_irq_type, handle_level_irq);\r\n__raw_writel(-1, INTC_INTDSB_0);\r\n__raw_writel(-1, INTC_INTDSB_1);\r\nfor (reg = INTC_INTPRI_0, i = 0; i < INTC_INTPRI_PREGS; i++, reg += 8)\r\n__raw_writel( NO_PRIORITY, reg);\r\n#ifdef CONFIG_SH_CAYMAN\r\n{\r\nunsigned long data;\r\nirlm = platform_int_priority[IRQ_IRL0] +\r\nplatform_int_priority[IRQ_IRL1] +\r\nplatform_int_priority[IRQ_IRL2] +\r\nplatform_int_priority[IRQ_IRL3];\r\nif (irlm == NO_PRIORITY) {\r\nreg = INTC_ICR_CLEAR;\r\ni = IRQ_INTA;\r\nprintk("Trying to use encoded IRL0-3. IRLs unsupported.\n");\r\n} else {\r\nreg = INTC_ICR_SET;\r\ni = IRQ_IRL0;\r\n}\r\n__raw_writel(INTC_ICR_IRLM, reg);\r\nfor (data = 0, reg = INTC_INTPRI_0; i < NR_INTC_IRQS; i++) {\r\ndata |= platform_int_priority[i] <<\r\n((i % INTC_INTPRI_PPREG) * 4);\r\nif ((i % INTC_INTPRI_PPREG) == (INTC_INTPRI_PPREG - 1)) {\r\n__raw_writel(data, reg);\r\ndata = 0;\r\nreg += 8;\r\n}\r\n}\r\n}\r\n#endif\r\n__asm__ __volatile__("getcon " __SR ", %0\n\t"\r\n"and %0, %1, %0\n\t"\r\n"putcon %0, " __SR "\n\t"\r\n: "=&r" (__dummy0)\r\n: "r" (__dummy1));\r\n}
