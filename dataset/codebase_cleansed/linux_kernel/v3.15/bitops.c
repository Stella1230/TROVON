void change_bit(unsigned long nr, volatile void *addr)\r\n{\r\nif (test_bit(nr, addr))\r\ngoto try_clear_bit;\r\ntry_set_bit:\r\nif (!test_and_set_bit(nr, addr))\r\nreturn;\r\ntry_clear_bit:\r\nif (test_and_clear_bit(nr, addr))\r\nreturn;\r\ngoto try_set_bit;\r\n}\r\nint test_and_change_bit(unsigned long nr, volatile void *addr)\r\n{\r\nif (test_bit(nr, addr))\r\ngoto try_clear_bit;\r\ntry_set_bit:\r\nif (!test_and_set_bit(nr, addr))\r\nreturn 0;\r\ntry_clear_bit:\r\nif (test_and_clear_bit(nr, addr))\r\nreturn 1;\r\ngoto try_set_bit;\r\n}
