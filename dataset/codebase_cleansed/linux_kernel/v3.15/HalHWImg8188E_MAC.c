static bool Checkcondition(const u32 condition, const u32 hex)\r\n{\r\nu32 _board = (hex & 0x000000FF);\r\nu32 _interface = (hex & 0x0000FF00) >> 8;\r\nu32 _platform = (hex & 0x00FF0000) >> 16;\r\nu32 cond = condition;\r\nif (condition == 0xCDCDCDCD)\r\nreturn true;\r\ncond = condition & 0x000000FF;\r\nif ((_board == cond) && cond != 0x00)\r\nreturn false;\r\ncond = condition & 0x0000FF00;\r\ncond = cond >> 8;\r\nif ((_interface & cond) == 0 && cond != 0x07)\r\nreturn false;\r\ncond = condition & 0x00FF0000;\r\ncond = cond >> 16;\r\nif ((_platform & cond) == 0 && cond != 0x0F)\r\nreturn false;\r\nreturn true;\r\n}\r\nenum HAL_STATUS ODM_ReadAndConfig_MAC_REG_8188E(struct odm_dm_struct *dm_odm)\r\n{\r\n#define READ_NEXT_PAIR(v1, v2, i) do { i += 2; v1 = array[i]; v2 = array[i+1]; } while (0)\r\nu32 hex = 0;\r\nu32 i;\r\nu8 platform = dm_odm->SupportPlatform;\r\nu8 interface_val = dm_odm->SupportInterface;\r\nu8 board = dm_odm->BoardType;\r\nu32 array_len = sizeof(array_MAC_REG_8188E)/sizeof(u32);\r\nu32 *array = array_MAC_REG_8188E;\r\nbool biol = false;\r\nstruct adapter *adapt = dm_odm->Adapter;\r\nstruct xmit_frame *pxmit_frame = NULL;\r\nu8 bndy_cnt = 1;\r\nenum HAL_STATUS rst = HAL_STATUS_SUCCESS;\r\nhex += board;\r\nhex += interface_val << 8;\r\nhex += platform << 16;\r\nhex += 0xFF000000;\r\nbiol = rtw_IOL_applied(adapt);\r\nif (biol) {\r\npxmit_frame = rtw_IOL_accquire_xmit_frame(adapt);\r\nif (pxmit_frame == NULL) {\r\npr_info("rtw_IOL_accquire_xmit_frame failed\n");\r\nreturn HAL_STATUS_FAILURE;\r\n}\r\n}\r\nfor (i = 0; i < array_len; i += 2) {\r\nu32 v1 = array[i];\r\nu32 v2 = array[i+1];\r\nif (v1 < 0xCDCDCDCD) {\r\nif (biol) {\r\nif (rtw_IOL_cmd_boundary_handle(pxmit_frame))\r\nbndy_cnt++;\r\nrtw_IOL_append_WB_cmd(pxmit_frame, (u16)v1, (u8)v2, 0xFF);\r\n} else {\r\nodm_ConfigMAC_8188E(dm_odm, v1, (u8)v2);\r\n}\r\ncontinue;\r\n} else {\r\nif (!Checkcondition(array[i], hex)) {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD &&\r\nv2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < array_len - 2) {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\ni -= 2;\r\n} else {\r\nREAD_NEXT_PAIR(v1, v2, i);\r\nwhile (v2 != 0xDEAD &&\r\nv2 != 0xCDEF &&\r\nv2 != 0xCDCD && i < array_len - 2) {\r\nif (biol) {\r\nif (rtw_IOL_cmd_boundary_handle(pxmit_frame))\r\nbndy_cnt++;\r\nrtw_IOL_append_WB_cmd(pxmit_frame, (u16)v1, (u8)v2, 0xFF);\r\n} else {\r\nodm_ConfigMAC_8188E(dm_odm, v1, (u8)v2);\r\n}\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\nwhile (v2 != 0xDEAD && i < array_len - 2)\r\nREAD_NEXT_PAIR(v1, v2, i);\r\n}\r\n}\r\n}\r\nif (biol) {\r\nif (!rtw_IOL_exec_cmds_sync(dm_odm->Adapter, pxmit_frame, 1000, bndy_cnt)) {\r\npr_info("~~~ MAC IOL_exec_cmds Failed !!!\n");\r\nrst = HAL_STATUS_FAILURE;\r\n}\r\n}\r\nreturn rst;\r\n}
