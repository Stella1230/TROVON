static int __set_phy_state(struct exynos_dp_video_phy *state, unsigned int on)\r\n{\r\nu32 reg;\r\nreg = readl(state->regs);\r\nif (on)\r\nreg |= EXYNOS_DPTX_PHY_ENABLE;\r\nelse\r\nreg &= ~EXYNOS_DPTX_PHY_ENABLE;\r\nwritel(reg, state->regs);\r\nreturn 0;\r\n}\r\nstatic int exynos_dp_video_phy_power_on(struct phy *phy)\r\n{\r\nstruct exynos_dp_video_phy *state = phy_get_drvdata(phy);\r\nreturn __set_phy_state(state, 1);\r\n}\r\nstatic int exynos_dp_video_phy_power_off(struct phy *phy)\r\n{\r\nstruct exynos_dp_video_phy *state = phy_get_drvdata(phy);\r\nreturn __set_phy_state(state, 0);\r\n}\r\nstatic int exynos_dp_video_phy_probe(struct platform_device *pdev)\r\n{\r\nstruct exynos_dp_video_phy *state;\r\nstruct device *dev = &pdev->dev;\r\nstruct resource *res;\r\nstruct phy_provider *phy_provider;\r\nstruct phy *phy;\r\nstate = devm_kzalloc(dev, sizeof(*state), GFP_KERNEL);\r\nif (!state)\r\nreturn -ENOMEM;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nstate->regs = devm_ioremap_resource(dev, res);\r\nif (IS_ERR(state->regs))\r\nreturn PTR_ERR(state->regs);\r\nphy = devm_phy_create(dev, &exynos_dp_video_phy_ops, NULL);\r\nif (IS_ERR(phy)) {\r\ndev_err(dev, "failed to create Display Port PHY\n");\r\nreturn PTR_ERR(phy);\r\n}\r\nphy_set_drvdata(phy, state);\r\nphy_provider = devm_of_phy_provider_register(dev, of_phy_simple_xlate);\r\nif (IS_ERR(phy_provider))\r\nreturn PTR_ERR(phy_provider);\r\nreturn 0;\r\n}
