static int\r\nlprocfs_fid_write_common(const char *buffer, unsigned long count,\r\nstruct lu_seq_range *range)\r\n{\r\nstruct lu_seq_range tmp;\r\nint rc;\r\nLASSERT(range != NULL);\r\nrc = sscanf(buffer, "[%llx - %llx]\n",\r\n(long long unsigned *)&tmp.lsr_start,\r\n(long long unsigned *)&tmp.lsr_end);\r\nif (rc != 2 || !range_is_sane(&tmp) || range_is_zero(&tmp))\r\nreturn -EINVAL;\r\n*range = tmp;\r\nreturn 0;\r\n}\r\nstatic ssize_t\r\nlprocfs_fid_space_seq_write(struct file *file, const char *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct lu_client_seq *seq = ((struct seq_file *)file->private_data)->private;\r\nint rc;\r\nLASSERT(seq != NULL);\r\nmutex_lock(&seq->lcs_mutex);\r\nrc = lprocfs_fid_write_common(buffer, count, &seq->lcs_space);\r\nif (rc == 0) {\r\nCDEBUG(D_INFO, "%s: Space: "DRANGE"\n",\r\nseq->lcs_name, PRANGE(&seq->lcs_space));\r\n}\r\nmutex_unlock(&seq->lcs_mutex);\r\nreturn count;\r\n}\r\nstatic int\r\nlprocfs_fid_space_seq_show(struct seq_file *m, void *unused)\r\n{\r\nstruct lu_client_seq *seq = (struct lu_client_seq *)m->private;\r\nint rc;\r\nLASSERT(seq != NULL);\r\nmutex_lock(&seq->lcs_mutex);\r\nrc = seq_printf(m, "["LPX64" - "LPX64"]:%x:%s\n", PRANGE(&seq->lcs_space));\r\nmutex_unlock(&seq->lcs_mutex);\r\nreturn rc;\r\n}\r\nstatic ssize_t\r\nlprocfs_fid_width_seq_write(struct file *file, const char *buffer,\r\nsize_t count, loff_t *off)\r\n{\r\nstruct lu_client_seq *seq = ((struct seq_file *)file->private_data)->private;\r\n__u64 max;\r\nint rc, val;\r\nLASSERT(seq != NULL);\r\nrc = lprocfs_write_helper(buffer, count, &val);\r\nif (rc)\r\nreturn rc;\r\nmutex_lock(&seq->lcs_mutex);\r\nif (seq->lcs_type == LUSTRE_SEQ_DATA)\r\nmax = LUSTRE_DATA_SEQ_MAX_WIDTH;\r\nelse\r\nmax = LUSTRE_METADATA_SEQ_MAX_WIDTH;\r\nif (val <= max && val > 0) {\r\nseq->lcs_width = val;\r\nif (rc == 0) {\r\nCDEBUG(D_INFO, "%s: Sequence size: "LPU64"\n",\r\nseq->lcs_name, seq->lcs_width);\r\n}\r\n}\r\nmutex_unlock(&seq->lcs_mutex);\r\nreturn count;\r\n}\r\nstatic int\r\nlprocfs_fid_width_seq_show(struct seq_file *m, void *unused)\r\n{\r\nstruct lu_client_seq *seq = (struct lu_client_seq *)m->private;\r\nint rc;\r\nLASSERT(seq != NULL);\r\nmutex_lock(&seq->lcs_mutex);\r\nrc = seq_printf(m, LPU64"\n", seq->lcs_width);\r\nmutex_unlock(&seq->lcs_mutex);\r\nreturn rc;\r\n}\r\nstatic int\r\nlprocfs_fid_fid_seq_show(struct seq_file *m, void *unused)\r\n{\r\nstruct lu_client_seq *seq = (struct lu_client_seq *)m->private;\r\nint rc;\r\nLASSERT(seq != NULL);\r\nmutex_lock(&seq->lcs_mutex);\r\nrc = seq_printf(m, DFID"\n", PFID(&seq->lcs_fid));\r\nmutex_unlock(&seq->lcs_mutex);\r\nreturn rc;\r\n}\r\nstatic int\r\nlprocfs_fid_server_seq_show(struct seq_file *m, void *unused)\r\n{\r\nstruct lu_client_seq *seq = (struct lu_client_seq *)m->private;\r\nstruct client_obd *cli;\r\nint rc;\r\nLASSERT(seq != NULL);\r\nif (seq->lcs_exp != NULL) {\r\ncli = &seq->lcs_exp->exp_obd->u.cli;\r\nrc = seq_printf(m, "%s\n", cli->cl_target_uuid.uuid);\r\n} else {\r\nrc = seq_printf(m, "%s\n", seq->lcs_srv->lss_name);\r\n}\r\nreturn rc;\r\n}
