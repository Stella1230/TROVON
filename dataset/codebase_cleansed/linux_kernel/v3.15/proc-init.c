asmlinkage void __init processor_init(void)\r\n{\r\nint loop;\r\nfor (loop = 0x000; loop < 0x400; loop += 8)\r\n__set_intr_stub(loop, __common_exception);\r\n__set_intr_stub(EXCEP_ITLBMISS, itlb_miss);\r\n__set_intr_stub(EXCEP_DTLBMISS, dtlb_miss);\r\n__set_intr_stub(EXCEP_IAERROR, itlb_aerror);\r\n__set_intr_stub(EXCEP_DAERROR, dtlb_aerror);\r\n__set_intr_stub(EXCEP_BUSERROR, raw_bus_error);\r\n__set_intr_stub(EXCEP_DOUBLE_FAULT, double_fault);\r\n__set_intr_stub(EXCEP_FPU_DISABLED, fpu_disabled);\r\n__set_intr_stub(EXCEP_SYSCALL0, system_call);\r\n__set_intr_stub(EXCEP_NMI, nmi_handler);\r\n__set_intr_stub(EXCEP_WDT, nmi_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL0, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL1, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL2, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL3, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL4, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL5, irq_handler);\r\n__set_intr_stub(EXCEP_IRQ_LEVEL6, irq_handler);\r\nIVAR0 = EXCEP_IRQ_LEVEL0;\r\nIVAR1 = EXCEP_IRQ_LEVEL1;\r\nIVAR2 = EXCEP_IRQ_LEVEL2;\r\nIVAR3 = EXCEP_IRQ_LEVEL3;\r\nIVAR4 = EXCEP_IRQ_LEVEL4;\r\nIVAR5 = EXCEP_IRQ_LEVEL5;\r\nIVAR6 = EXCEP_IRQ_LEVEL6;\r\n#ifndef CONFIG_MN10300_HAS_CACHE_SNOOP\r\nmn10300_dcache_flush_inv();\r\nmn10300_icache_inv();\r\n#endif\r\n#ifdef CONFIG_SMP\r\nfor (loop = 0; loop < GxICR_NUM_IRQS; loop++)\r\nGxICR(loop) = GxICR_LEVEL_6 | GxICR_DETECT;\r\n#else\r\nfor (loop = 0; loop < NR_IRQS; loop++)\r\nGxICR(loop) = GxICR_LEVEL_6 | GxICR_DETECT;\r\n#endif\r\nTM0MD = 0;\r\nTM1MD = 0;\r\nTM2MD = 0;\r\nTM3MD = 0;\r\nTM4MD = 0;\r\nTM5MD = 0;\r\nTM6MD = 0;\r\nTM6MDA = 0;\r\nTM6MDB = 0;\r\nTM7MD = 0;\r\nTM8MD = 0;\r\nTM9MD = 0;\r\nTM10MD = 0;\r\nTM11MD = 0;\r\nTM12MD = 0;\r\nTM13MD = 0;\r\nTM14MD = 0;\r\nTM15MD = 0;\r\ncalibrate_clock();\r\n}\r\nvoid __init get_mem_info(unsigned long *mem_base, unsigned long *mem_size)\r\n{\r\nunsigned long memconf = MEMCONF;\r\nunsigned long size = 0;\r\n*mem_base = 0x90000000;\r\nswitch (memconf & 0x00000003) {\r\ncase 0x01:\r\nsize = 256 / 8;\r\nbreak;\r\ncase 0x02:\r\nsize = 512 / 8;\r\nbreak;\r\ncase 0x03:\r\nsize = 1024 / 8;\r\nbreak;\r\ndefault:\r\npanic("Invalid SDRAM size");\r\nbreak;\r\n}\r\nprintk(KERN_INFO "DDR2-SDRAM: %luMB x 2 @%08lx\n", size, *mem_base);\r\n*mem_size = (size * 2) << 20;\r\n}
