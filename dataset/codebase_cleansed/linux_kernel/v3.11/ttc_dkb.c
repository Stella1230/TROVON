static void dkb_tpo_panel_power(int on)\r\n{\r\nint err;\r\nu32 spi_reset = mfp_to_gpio(MFP_PIN_GPIO106);\r\nif (on) {\r\nerr = gpio_request(spi_reset, "TPO_LCD_SPI_RESET");\r\nif (err) {\r\npr_err("failed to request GPIO for TPO LCD RESET\n");\r\nreturn;\r\n}\r\ngpio_direction_output(spi_reset, 0);\r\nudelay(100);\r\ngpio_set_value(spi_reset, 1);\r\ngpio_free(spi_reset);\r\n} else {\r\nerr = gpio_request(spi_reset, "TPO_LCD_SPI_RESET");\r\nif (err) {\r\npr_err("failed to request LCD RESET gpio\n");\r\nreturn;\r\n}\r\ngpio_set_value(spi_reset, 0);\r\ngpio_free(spi_reset);\r\n}\r\n}\r\nstatic void __init add_disp(void)\r\n{\r\npxa_register_device(&pxa910_device_disp,\r\n&dkb_disp_info, sizeof(dkb_disp_info));\r\nspi_register_board_info(spi_board_info, ARRAY_SIZE(spi_board_info));\r\npxa_register_device(&pxa910_device_fb,\r\n&dkb_fb_info, sizeof(dkb_fb_info));\r\npxa_register_device(&pxa910_device_panel,\r\n&dkb_tpo_panel_info, sizeof(dkb_tpo_panel_info));\r\n}\r\nstatic void __init ttc_dkb_init(void)\r\n{\r\nmfp_config(ARRAY_AND_SIZE(ttc_dkb_pin_config));\r\npxa910_add_uart(1);\r\n#ifdef CONFIG_MTD_NAND_PXA3xx\r\npxa910_add_nand(&dkb_nand_info);\r\n#endif\r\npxa910_add_twsi(0, NULL, ARRAY_AND_SIZE(ttc_dkb_i2c_info));\r\nplatform_device_add_data(&pxa910_device_gpio, &pxa910_gpio_pdata,\r\nsizeof(struct pxa_gpio_platform_data));\r\nplatform_add_devices(ARRAY_AND_SIZE(ttc_dkb_devices));\r\n#ifdef CONFIG_USB_MV_UDC\r\npxa168_device_u2o.dev.platform_data = &ttc_usb_pdata;\r\nplatform_device_register(&pxa168_device_u2o);\r\n#endif\r\n#ifdef CONFIG_USB_EHCI_MV_U2O\r\npxa168_device_u2oehci.dev.platform_data = &ttc_usb_pdata;\r\nplatform_device_register(&pxa168_device_u2oehci);\r\n#endif\r\n#ifdef CONFIG_USB_MV_OTG\r\npxa168_device_u2ootg.dev.platform_data = &ttc_usb_pdata;\r\nplatform_device_register(&pxa168_device_u2ootg);\r\n#endif\r\n#ifdef CONFIG_MMP_DISP\r\nadd_disp();\r\n#endif\r\n}
