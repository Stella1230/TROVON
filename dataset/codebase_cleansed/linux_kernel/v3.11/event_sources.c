void request_event_sources_irqs(struct device_node *np,\r\nirq_handler_t handler,\r\nconst char *name)\r\n{\r\nint i, index, count = 0;\r\nstruct of_irq oirq;\r\nconst u32 *opicprop;\r\nunsigned int opicplen;\r\nunsigned int virqs[16];\r\nopicprop = of_get_property(np, "open-pic-interrupt", &opicplen);\r\nif (opicprop) {\r\nopicplen /= sizeof(u32);\r\nfor (i = 0; i < opicplen; i++) {\r\nif (count > 15)\r\nbreak;\r\nvirqs[count] = irq_create_mapping(NULL, *(opicprop++));\r\nif (virqs[count] == NO_IRQ) {\r\npr_err("event-sources: Unable to allocate "\r\n"interrupt number for %s\n",\r\nnp->full_name);\r\nWARN_ON(1);\r\n}\r\nelse\r\ncount++;\r\n}\r\n}\r\nelse {\r\nfor (index = 0; of_irq_map_one(np, index, &oirq) == 0;\r\nindex++) {\r\nif (count > 15)\r\nbreak;\r\nvirqs[count] = irq_create_of_mapping(oirq.controller,\r\noirq.specifier,\r\noirq.size);\r\nif (virqs[count] == NO_IRQ) {\r\npr_err("event-sources: Unable to allocate "\r\n"interrupt number for %s\n",\r\nnp->full_name);\r\nWARN_ON(1);\r\n}\r\nelse\r\ncount++;\r\n}\r\n}\r\nfor (i = 0; i < count; i++) {\r\nif (request_irq(virqs[i], handler, 0, name, NULL)) {\r\npr_err("event-sources: Unable to request interrupt "\r\n"%d for %s\n", virqs[i], np->full_name);\r\nWARN_ON(1);\r\nreturn;\r\n}\r\n}\r\n}
