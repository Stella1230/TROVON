int pfifo_request(unsigned int pfifo_mask)\r\n{\r\nint err = 0;\r\nunsigned int val;\r\nmutex_lock(&pfifo_lock);\r\nif (pfifo_mask & pfifo_used) {\r\nerr = -EBUSY;\r\ngoto out;\r\n}\r\npfifo_used |= pfifo_mask;\r\nval = readl(NETX_PFIFO_RESET);\r\nwritel(val | pfifo_mask, NETX_PFIFO_RESET);\r\nwritel(val, NETX_PFIFO_RESET);\r\nout:\r\nmutex_unlock(&pfifo_lock);\r\nreturn err;\r\n}\r\nvoid pfifo_free(unsigned int pfifo_mask)\r\n{\r\nmutex_lock(&pfifo_lock);\r\npfifo_used &= ~pfifo_mask;\r\nmutex_unlock(&pfifo_lock);\r\n}
