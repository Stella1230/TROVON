int\r\nsgl_frem (sgl_floating_point * srcptr1, sgl_floating_point * srcptr2,\r\nsgl_floating_point * dstptr, unsigned int *status)\r\n{\r\nregister unsigned int opnd1, opnd2, result;\r\nregister int opnd1_exponent, opnd2_exponent, dest_exponent, stepcount;\r\nregister boolean roundup = FALSE;\r\nopnd1 = *srcptr1;\r\nopnd2 = *srcptr2;\r\nif ((opnd1_exponent = Sgl_exponent(opnd1)) == SGL_INFINITY_EXPONENT) {\r\nif (Sgl_iszero_mantissa(opnd1)) {\r\nif (Sgl_isnotnan(opnd2)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_makequietnan(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nelse {\r\nif (Sgl_isone_signaling(opnd1)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_set_quiet(opnd1);\r\n}\r\nelse if (Sgl_is_signalingnan(opnd2)) {\r\nif (Is_invalidtrap_enabled())\r\nreturn(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_set_quiet(opnd2);\r\n*dstptr = opnd2;\r\nreturn(NOEXCEPTION);\r\n}\r\n*dstptr = opnd1;\r\nreturn(NOEXCEPTION);\r\n}\r\n}\r\nif ((opnd2_exponent = Sgl_exponent(opnd2)) == SGL_INFINITY_EXPONENT) {\r\nif (Sgl_iszero_mantissa(opnd2)) {\r\n*dstptr = opnd1;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Sgl_isone_signaling(opnd2)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_set_quiet(opnd2);\r\n}\r\n*dstptr = opnd2;\r\nreturn(NOEXCEPTION);\r\n}\r\nif (Sgl_iszero_exponentmantissa(opnd2)) {\r\nif (Is_invalidtrap_enabled()) return(INVALIDEXCEPTION);\r\nSet_invalidflag();\r\nSgl_makequietnan(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\nresult = opnd1;\r\nif (opnd1_exponent == 0) {\r\nif (Sgl_iszero_mantissa(opnd1)) {\r\n*dstptr = opnd1;\r\nreturn(NOEXCEPTION);\r\n}\r\nopnd1_exponent = 1;\r\nSgl_normalize(opnd1,opnd1_exponent);\r\n}\r\nelse {\r\nSgl_clear_signexponent_set_hidden(opnd1);\r\n}\r\nif (opnd2_exponent == 0) {\r\nopnd2_exponent = 1;\r\nSgl_normalize(opnd2,opnd2_exponent);\r\n}\r\nelse {\r\nSgl_clear_signexponent_set_hidden(opnd2);\r\n}\r\ndest_exponent = opnd2_exponent - 1;\r\nstepcount = opnd1_exponent - opnd2_exponent;\r\nif (stepcount < 0) {\r\nif (stepcount == -1 && Sgl_isgreaterthan(opnd1,opnd2)) {\r\nSgl_all(result) = ~Sgl_all(result);\r\nSgl_leftshiftby1(opnd2);\r\nSgl_subtract(opnd2,opnd1,opnd2);\r\nwhile (Sgl_iszero_hidden(opnd2)) {\r\nSgl_leftshiftby1(opnd2);\r\ndest_exponent--;\r\n}\r\nSgl_set_exponentmantissa(result,opnd2);\r\ngoto testforunderflow;\r\n}\r\nSgl_set_exponentmantissa(result,opnd1);\r\ndest_exponent = opnd1_exponent;\r\ngoto testforunderflow;\r\n}\r\nwhile (stepcount-- > 0 && Sgl_all(opnd1)) {\r\nif (Sgl_isnotlessthan(opnd1,opnd2))\r\nSgl_subtract(opnd1,opnd2,opnd1);\r\nSgl_leftshiftby1(opnd1);\r\n}\r\nif (Sgl_isnotlessthan(opnd1,opnd2)) {\r\nSgl_subtract(opnd1,opnd2,opnd1);\r\nroundup = TRUE;\r\n}\r\nif (stepcount > 0 || Sgl_iszero(opnd1)) {\r\nSgl_setzero_exponentmantissa(result);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}\r\nSgl_leftshiftby1(opnd1);\r\nif (Sgl_isgreaterthan(opnd1,opnd2)) {\r\nSgl_invert_sign(result);\r\nSgl_subtract((opnd2<<1),opnd1,opnd1);\r\n}\r\nelse if (Sgl_isequal(opnd1,opnd2) && roundup) {\r\nSgl_invert_sign(result);\r\n}\r\nwhile (Sgl_iszero_hidden(opnd1)) {\r\ndest_exponent--;\r\nSgl_leftshiftby1(opnd1);\r\n}\r\nSgl_set_exponentmantissa(result,opnd1);\r\ntestforunderflow:\r\nif (dest_exponent <= 0) {\r\nif (Is_underflowtrap_enabled()) {\r\nSgl_setwrapped_exponent(result,dest_exponent,unfl);\r\n*dstptr = result;\r\nreturn(UNDERFLOWEXCEPTION);\r\n}\r\nif (dest_exponent >= (1 - SGL_P)) {\r\nSgl_rightshift_exponentmantissa(result,1-dest_exponent);\r\n}\r\nelse {\r\nSgl_setzero_exponentmantissa(result);\r\n}\r\n}\r\nelse Sgl_set_exponent(result,dest_exponent);\r\n*dstptr = result;\r\nreturn(NOEXCEPTION);\r\n}
