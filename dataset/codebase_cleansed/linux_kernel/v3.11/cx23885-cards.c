void cx23885_card_list(struct cx23885_dev *dev)\r\n{\r\nint i;\r\nif (0 == dev->pci->subsystem_vendor &&\r\n0 == dev->pci->subsystem_device) {\r\nprintk(KERN_INFO\r\n"%s: Board has no valid PCIe Subsystem ID and can't\n"\r\n"%s: be autodetected. Pass card=<n> insmod option\n"\r\n"%s: to workaround that. Redirect complaints to the\n"\r\n"%s: vendor of the TV card. Best regards,\n"\r\n"%s: -- tux\n",\r\ndev->name, dev->name, dev->name, dev->name, dev->name);\r\n} else {\r\nprintk(KERN_INFO\r\n"%s: Your board isn't known (yet) to the driver.\n"\r\n"%s: Try to pick one of the existing card configs via\n"\r\n"%s: card=<n> insmod option. Updating to the latest\n"\r\n"%s: version might help as well.\n",\r\ndev->name, dev->name, dev->name, dev->name);\r\n}\r\nprintk(KERN_INFO "%s: Here is a list of valid choices for the card=<n> insmod option:\n",\r\ndev->name);\r\nfor (i = 0; i < cx23885_bcount; i++)\r\nprintk(KERN_INFO "%s: card=%d -> %s\n",\r\ndev->name, i, cx23885_boards[i].name);\r\n}\r\nstatic void hauppauge_eeprom(struct cx23885_dev *dev, u8 *eeprom_data)\r\n{\r\nstruct tveeprom tv;\r\ntveeprom_hauppauge_analog(&dev->i2c_bus[0].i2c_client, &tv,\r\neeprom_data);\r\nswitch (tv.model) {\r\ncase 22001:\r\ncase 22009:\r\ncase 22011:\r\ncase 22019:\r\ncase 22021:\r\ncase 22029:\r\ncase 22101:\r\ncase 22109:\r\ncase 22111:\r\ncase 22119:\r\ncase 22121:\r\ncase 22129:\r\ncase 71009:\r\ncase 71359:\r\ncase 71439:\r\ncase 71449:\r\ncase 71939:\r\ncase 71949:\r\ncase 71959:\r\ncase 71979:\r\ncase 71999:\r\ncase 76601:\r\ncase 77001:\r\ncase 77011:\r\ncase 77041:\r\ncase 77051:\r\ncase 78011:\r\ncase 78501:\r\ncase 78521:\r\ncase 78531:\r\ncase 78631:\r\ncase 79001:\r\ncase 79101:\r\ncase 79501:\r\ncase 79561:\r\ncase 79571:\r\ncase 79671:\r\ncase 80019:\r\ncase 81509:\r\ncase 81519:\r\nbreak;\r\ncase 85021:\r\nbreak;\r\ncase 85721:\r\nbreak;\r\ndefault:\r\nprintk(KERN_WARNING "%s: warning: "\r\n"unknown hauppauge model #%d\n",\r\ndev->name, tv.model);\r\nbreak;\r\n}\r\nprintk(KERN_INFO "%s: hauppauge eeprom: model=%d\n",\r\ndev->name, tv.model);\r\n}\r\nint cx23885_tuner_callback(void *priv, int component, int command, int arg)\r\n{\r\nstruct cx23885_tsport *port = priv;\r\nstruct cx23885_dev *dev = port->dev;\r\nu32 bitmask = 0;\r\nif ((command == XC2028_RESET_CLK) || (command == XC2028_I2C_FLUSH))\r\nreturn 0;\r\nif (command != 0) {\r\nprintk(KERN_ERR "%s(): Unknown command 0x%x.\n",\r\n__func__, command);\r\nreturn -EINVAL;\r\n}\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1400:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500Q:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E650F:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E800:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXTV1200:\r\nbitmask = 0x04;\r\nbreak;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_7_DUAL_EXP:\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP:\r\nif (port->nr == 1)\r\nbitmask = 0x01;\r\nelse if (port->nr == 2)\r\nbitmask = 0x04;\r\nbreak;\r\ncase CX23885_BOARD_GOTVIEW_X5_3D_HYBRID:\r\nbitmask = 0x02;\r\nbreak;\r\ncase CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF:\r\naltera_ci_tuner_reset(dev, port->nr);\r\nbreak;\r\ncase CX23885_BOARD_AVERMEDIA_HC81R:\r\nbitmask = 1 << 2;\r\nbreak;\r\n}\r\nif (bitmask) {\r\ncx_clear(GP0_IO, bitmask);\r\nmdelay(200);\r\ncx_set(GP0_IO, bitmask);\r\n}\r\nreturn 0;\r\n}\r\nvoid cx23885_gpio_setup(struct cx23885_dev *dev)\r\n{\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\ncx_set(GP0_IO, 0x00010001);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncx_set(GP0_IO, 0x00050000);\r\ncx_clear(GP0_IO, 0x00000005);\r\nmsleep(5);\r\ncx_set(GP0_IO, 0x00050005);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500Q:\r\ncx_set(GP0_IO, 0x00050005);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800:\r\nmc417_gpio_enable(dev, GPIO_15 | GPIO_14, 1);\r\nmc417_gpio_clear(dev, GPIO_15 | GPIO_14);\r\nmdelay(100);\r\nmc417_gpio_set(dev, GPIO_15 | GPIO_14);\r\nmdelay(100);\r\ncx23885_gpio_enable(dev, GPIO_2, 1);\r\ncx23885_gpio_set(dev, GPIO_2);\r\nmdelay(20);\r\ncx23885_gpio_clear(dev, GPIO_2);\r\nmdelay(20);\r\ncx23885_gpio_set(dev, GPIO_2);\r\nmdelay(20);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1200:\r\ncx_set(GP0_IO, 0x00050000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x00000005);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x00050005);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1700:\r\ncx_set(GP0_IO, 0x00050000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x00000005);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x00050005);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1400:\r\ncx_set(GP0_IO, 0x00050000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x00000005);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x00050005);\r\nbreak;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_7_DUAL_EXP:\r\ncx_set(GP0_IO, 0x000f0000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x0000000f);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x000f000f);\r\nbreak;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP:\r\ncx_set(GP0_IO, 0x000f0000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x0000000f);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x000f000f);\r\nbreak;\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E650F:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E800:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXTV1200:\r\ncx_set(GP0_IO, 0x00040000);\r\nmdelay(20);\r\ncx_clear(GP0_IO, 0x00000004);\r\nmdelay(20);\r\ncx_set(GP0_IO, 0x00040004);\r\nbreak;\r\ncase CX23885_BOARD_TBS_6920:\r\ncase CX23885_BOARD_PROF_8000:\r\ncx_write(MC417_CTL, 0x00000036);\r\ncx_write(MC417_OEN, 0x00001000);\r\ncx_set(MC417_RWD, 0x00000002);\r\nmdelay(200);\r\ncx_clear(MC417_RWD, 0x00000800);\r\nmdelay(200);\r\ncx_set(MC417_RWD, 0x00000800);\r\nmdelay(200);\r\nbreak;\r\ncase CX23885_BOARD_NETUP_DUAL_DVBS2_CI:\r\ncx_set(GP0_IO, 0x00040000);\r\ncx_clear(GP0_IO, 0x00030004);\r\nmdelay(100);\r\ncx_set(GP0_IO, 0x00040004);\r\ncx_write(MC417_CTL, 0x00000037);\r\ncx_write(MC417_OEN, 0x00001000);\r\ncx_write(MC417_RWD, 0x0000c300);\r\ncx_write(GPIO_ISM, 0x00000000);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1275:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255_22111:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1210:\r\ncx23885_gpio_enable(dev, GPIO_9 | GPIO_6 | GPIO_5, 1);\r\ncx23885_gpio_set(dev, GPIO_9 | GPIO_6 | GPIO_5);\r\ncx23885_gpio_clear(dev, GPIO_9);\r\nmdelay(20);\r\ncx23885_gpio_set(dev, GPIO_9);\r\nbreak;\r\ncase CX23885_BOARD_MYGICA_X8506:\r\ncase CX23885_BOARD_MAGICPRO_PROHDTVE2:\r\ncase CX23885_BOARD_MYGICA_X8507:\r\ncx23885_gpio_enable(dev, GPIO_0 | GPIO_1 | GPIO_2, 1);\r\ncx23885_gpio_clear(dev, GPIO_1 | GPIO_2);\r\nmdelay(100);\r\ncx23885_gpio_set(dev, GPIO_0 | GPIO_1 | GPIO_2);\r\nmdelay(100);\r\nbreak;\r\ncase CX23885_BOARD_MYGICA_X8558PRO:\r\ncx23885_gpio_enable(dev, GPIO_0 | GPIO_1, 1);\r\ncx23885_gpio_clear(dev, GPIO_0 | GPIO_1);\r\nmdelay(100);\r\ncx23885_gpio_set(dev, GPIO_0 | GPIO_1);\r\nmdelay(100);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\nmc417_gpio_enable(dev, GPIO_14 | GPIO_13, 1);\r\nmc417_gpio_clear(dev, GPIO_14 | GPIO_13);\r\nmdelay(100);\r\nmc417_gpio_set(dev, GPIO_14);\r\nmdelay(100);\r\nbreak;\r\ncase CX23885_BOARD_GOTVIEW_X5_3D_HYBRID:\r\ncx_set(GP0_IO, 0x00010001);\r\nbreak;\r\ncase CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF:\r\ncx_set(GP0_IO, 0x00060000);\r\ncx_clear(GP0_IO, 0x00010006);\r\nmdelay(100);\r\ncx_set(GP0_IO, 0x00000004);\r\ncx_write(MC417_CTL, 0x00000037);\r\ncx_write(MC417_OEN, 0x00005000);\r\ncx_write(MC417_RWD, 0x00000d00);\r\ncx_write(GPIO_ISM, 0x00000000);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR4400:\r\ncx23885_gpio_enable(dev, GPIO_8, 1);\r\ncx23885_gpio_clear(dev, GPIO_8);\r\nmdelay(100);\r\ncx23885_gpio_set(dev, GPIO_8);\r\nmdelay(100);\r\nbreak;\r\ncase CX23885_BOARD_AVERMEDIA_HC81R:\r\ncx_clear(MC417_CTL, 1);\r\ncx_set(GP0_IO, 0x00070000);\r\nmdelay(10);\r\ncx_set(GP0_IO, 0x00010001);\r\nmdelay(10);\r\ncx_clear(GP0_IO, 0x00010001);\r\nmdelay(10);\r\ncx_set(GP0_IO, 0x00010001);\r\nmdelay(10);\r\ncx_clear(GP0_IO, 0x00030003);\r\nmdelay(10);\r\ncx_set(GP0_IO, 0x00020002);\r\nmdelay(10);\r\ncx_set(GP0_IO, 0x00010001);\r\nmdelay(10);\r\ncx_clear(GP0_IO, 0x00020002);\r\ncx_set(GP0_IO, 0x00040004);\r\ncx_clear(GP0_IO, 0x00040004);\r\ncx_set(GP0_IO, 0x00040004);\r\nmdelay(60);\r\nbreak;\r\n}\r\n}\r\nint cx23885_ir_init(struct cx23885_dev *dev)\r\n{\r\nstatic struct v4l2_subdev_io_pin_config ir_rxtx_pin_cfg[] = {\r\n{\r\n.flags = V4L2_SUBDEV_IO_PIN_INPUT,\r\n.pin = CX23885_PIN_IR_RX_GPIO19,\r\n.function = CX23885_PAD_IR_RX,\r\n.value = 0,\r\n.strength = CX25840_PIN_DRIVE_MEDIUM,\r\n}, {\r\n.flags = V4L2_SUBDEV_IO_PIN_OUTPUT,\r\n.pin = CX23885_PIN_IR_TX_GPIO20,\r\n.function = CX23885_PAD_IR_TX,\r\n.value = 0,\r\n.strength = CX25840_PIN_DRIVE_MEDIUM,\r\n}\r\n};\r\nconst size_t ir_rxtx_pin_cfg_count = ARRAY_SIZE(ir_rxtx_pin_cfg);\r\nstatic struct v4l2_subdev_io_pin_config ir_rx_pin_cfg[] = {\r\n{\r\n.flags = V4L2_SUBDEV_IO_PIN_INPUT,\r\n.pin = CX23885_PIN_IR_RX_GPIO19,\r\n.function = CX23885_PAD_IR_RX,\r\n.value = 0,\r\n.strength = CX25840_PIN_DRIVE_MEDIUM,\r\n}\r\n};\r\nconst size_t ir_rx_pin_cfg_count = ARRAY_SIZE(ir_rx_pin_cfg);\r\nstruct v4l2_subdev_ir_parameters params;\r\nint ret = 0;\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500Q:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1200:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1400:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1275:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255_22111:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1210:\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\nret = cx23888_ir_probe(dev);\r\nif (ret)\r\nbreak;\r\ndev->sd_ir = cx23885_find_hw(dev, CX23885_HW_888_IR);\r\nv4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,\r\nir_rx_pin_cfg_count, ir_rx_pin_cfg);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\nret = cx23888_ir_probe(dev);\r\nif (ret)\r\nbreak;\r\ndev->sd_ir = cx23885_find_hw(dev, CX23885_HW_888_IR);\r\nv4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,\r\nir_rxtx_pin_cfg_count, ir_rxtx_pin_cfg);\r\nv4l2_subdev_call(dev->sd_ir, ir, tx_g_parameters, &params);\r\nparams.enable = false;\r\nparams.shutdown = false;\r\nparams.invert_level = true;\r\nv4l2_subdev_call(dev->sd_ir, ir, tx_s_parameters, &params);\r\nparams.shutdown = true;\r\nv4l2_subdev_call(dev->sd_ir, ir, tx_s_parameters, &params);\r\nbreak;\r\ncase CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL:\r\ncase CX23885_BOARD_TEVII_S470:\r\ncase CX23885_BOARD_MYGICA_X8507:\r\nif (!enable_885_ir)\r\nbreak;\r\ndev->sd_ir = cx23885_find_hw(dev, CX23885_HW_AV_CORE);\r\nif (dev->sd_ir == NULL) {\r\nret = -ENODEV;\r\nbreak;\r\n}\r\nv4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,\r\nir_rx_pin_cfg_count, ir_rx_pin_cfg);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\nif (!enable_885_ir)\r\nbreak;\r\ndev->sd_ir = cx23885_find_hw(dev, CX23885_HW_AV_CORE);\r\nif (dev->sd_ir == NULL) {\r\nret = -ENODEV;\r\nbreak;\r\n}\r\nv4l2_subdev_call(dev->sd_cx25840, core, s_io_pin_config,\r\nir_rxtx_pin_cfg_count, ir_rxtx_pin_cfg);\r\nbreak;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP:\r\nrequest_module("ir-kbd-i2c");\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nvoid cx23885_ir_fini(struct cx23885_dev *dev)\r\n{\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\ncx23885_irq_remove(dev, PCI_MSK_IR);\r\ncx23888_ir_remove(dev);\r\ndev->sd_ir = NULL;\r\nbreak;\r\ncase CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL:\r\ncase CX23885_BOARD_TEVII_S470:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\ncase CX23885_BOARD_MYGICA_X8507:\r\ncx23885_irq_remove(dev, PCI_MSK_AV_CORE);\r\ndev->sd_ir = NULL;\r\nbreak;\r\n}\r\n}\r\nstatic int netup_jtag_io(void *device, int tms, int tdi, int read_tdo)\r\n{\r\nint data;\r\nint tdo = 0;\r\nstruct cx23885_dev *dev = (struct cx23885_dev *)device;\r\ndata = ((cx_read(GP0_IO)) & (~0x00000002));\r\ndata |= (tms ? 0x00020002 : 0x00020000);\r\ncx_write(GP0_IO, data);\r\ndata = ((cx_read(MC417_RWD)) & (~0x0000a000));\r\ndata |= (tdi ? 0x00008000 : 0);\r\ncx_write(MC417_RWD, data);\r\nif (read_tdo)\r\ntdo = (data & 0x00004000) ? 1 : 0;\r\ncx_write(MC417_RWD, data | 0x00002000);\r\nudelay(1);\r\ncx_write(MC417_RWD, data);\r\nreturn tdo;\r\n}\r\nvoid cx23885_ir_pci_int_enable(struct cx23885_dev *dev)\r\n{\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\nif (dev->sd_ir)\r\ncx23885_irq_add_enable(dev, PCI_MSK_IR);\r\nbreak;\r\ncase CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL:\r\ncase CX23885_BOARD_TEVII_S470:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\ncase CX23885_BOARD_MYGICA_X8507:\r\nif (dev->sd_ir)\r\ncx23885_irq_add_enable(dev, PCI_MSK_AV_CORE);\r\nbreak;\r\n}\r\n}\r\nvoid cx23885_card_setup(struct cx23885_dev *dev)\r\n{\r\nstruct cx23885_tsport *ts1 = &dev->ts1;\r\nstruct cx23885_tsport *ts2 = &dev->ts2;\r\nstatic u8 eeprom[256];\r\nif (dev->i2c_bus[0].i2c_rc == 0) {\r\ndev->i2c_bus[0].i2c_client.addr = 0xa0 >> 1;\r\ntveeprom_read(&dev->i2c_bus[0].i2c_client,\r\neeprom, sizeof(eeprom));\r\n}\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\nif (dev->i2c_bus[0].i2c_rc == 0) {\r\nif (eeprom[0x80] != 0x84)\r\nhauppauge_eeprom(dev, eeprom+0xc0);\r\nelse\r\nhauppauge_eeprom(dev, eeprom+0x80);\r\n}\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500Q:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1400:\r\nif (dev->i2c_bus[0].i2c_rc == 0)\r\nhauppauge_eeprom(dev, eeprom+0x80);\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800lp:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1200:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1700:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1275:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255_22111:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1210:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR4400:\r\nif (dev->i2c_bus[0].i2c_rc == 0)\r\nhauppauge_eeprom(dev, eeprom+0xc0);\r\nbreak;\r\n}\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_AVERMEDIA_HC81R:\r\nts1->gen_ctrl_val = 0x4;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nts2->gen_ctrl_val = 0x10e;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_7_DUAL_EXP:\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP:\r\nts2->gen_ctrl_val = 0xc;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\ncase CX23885_BOARD_DVICO_FUSIONHDTV_5_EXP:\r\nts1->gen_ctrl_val = 0xc;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800:\r\nts1->gen_ctrl_val = 0x10e;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nts1->vld_misc_val = 0x2000;\r\nts1->hw_sop_ctrl_val = (0x47 << 16 | 188 << 4 | 0xc);\r\ncx_write(0x130184, 0xc);\r\nts2->gen_ctrl_val = 0xc;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_TBS_6920:\r\nts1->gen_ctrl_val = 0x4;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_TEVII_S470:\r\ncase CX23885_BOARD_TEVII_S471:\r\ncase CX23885_BOARD_DVBWORLD_2005:\r\ncase CX23885_BOARD_PROF_8000:\r\nts1->gen_ctrl_val = 0x5;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_NETUP_DUAL_DVBS2_CI:\r\ncase CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF:\r\ncase CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL:\r\nts1->gen_ctrl_val = 0xc;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nts2->gen_ctrl_val = 0xc;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_MYGICA_X8506:\r\ncase CX23885_BOARD_MAGICPRO_PROHDTVE2:\r\nts1->gen_ctrl_val = 0x5;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_MYGICA_X8558PRO:\r\nts1->gen_ctrl_val = 0x5;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nts2->gen_ctrl_val = 0xc;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR4400:\r\nts1->gen_ctrl_val = 0xc;\r\nts1->ts_clk_en_val = 0x1;\r\nts1->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500Q:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800lp:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1200:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1700:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1400:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E650F:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1275:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255_22111:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1210:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E800:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\ncase CX23885_BOARD_GOTVIEW_X5_3D_HYBRID:\r\ndefault:\r\nts2->gen_ctrl_val = 0xc;\r\nts2->ts_clk_en_val = 0x1;\r\nts2->src_sel_val = CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO;\r\n}\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_TEVII_S470:\r\nif (!enable_885_ir)\r\nbreak;\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1250:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1800lp:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1700:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E650F:\r\ncase CX23885_BOARD_NETUP_DUAL_DVBS2_CI:\r\ncase CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF:\r\ncase CX23885_BOARD_COMPRO_VIDEOMATE_E800:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1255_22111:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1270:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1850:\r\ncase CX23885_BOARD_MYGICA_X8506:\r\ncase CX23885_BOARD_MAGICPRO_PROHDTVE2:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1290:\r\ncase CX23885_BOARD_LEADTEK_WINFAST_PXTV1200:\r\ncase CX23885_BOARD_GOTVIEW_X5_3D_HYBRID:\r\ncase CX23885_BOARD_HAUPPAUGE_HVR1500:\r\ncase CX23885_BOARD_MPX885:\r\ncase CX23885_BOARD_MYGICA_X8507:\r\ncase CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL:\r\ncase CX23885_BOARD_AVERMEDIA_HC81R:\r\ndev->sd_cx25840 = v4l2_i2c_new_subdev(&dev->v4l2_dev,\r\n&dev->i2c_bus[2].i2c_adap,\r\n"cx25840", 0x88 >> 1, NULL);\r\nif (dev->sd_cx25840) {\r\ndev->sd_cx25840->grp_id = CX23885_HW_AV_CORE;\r\nv4l2_subdev_call(dev->sd_cx25840, core, load_fw);\r\n}\r\nbreak;\r\n}\r\nswitch (dev->board) {\r\ncase CX23885_BOARD_NETUP_DUAL_DVBS2_CI:\r\nnetup_initialize(dev);\r\nbreak;\r\ncase CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF: {\r\nint ret;\r\nconst struct firmware *fw;\r\nconst char *filename = "dvb-netup-altera-01.fw";\r\nchar *action = "configure";\r\nstatic struct netup_card_info cinfo;\r\nstruct altera_config netup_config = {\r\n.dev = dev,\r\n.action = action,\r\n.jtag_io = netup_jtag_io,\r\n};\r\nnetup_initialize(dev);\r\nnetup_get_card_info(&dev->i2c_bus[0].i2c_adap, &cinfo);\r\nif (netup_card_rev)\r\ncinfo.rev = netup_card_rev;\r\nswitch (cinfo.rev) {\r\ncase 0x4:\r\nfilename = "dvb-netup-altera-04.fw";\r\nbreak;\r\ndefault:\r\nfilename = "dvb-netup-altera-01.fw";\r\nbreak;\r\n}\r\nprintk(KERN_INFO "NetUP card rev=0x%x fw_filename=%s\n",\r\ncinfo.rev, filename);\r\nret = request_firmware(&fw, filename, &dev->pci->dev);\r\nif (ret != 0)\r\nprintk(KERN_ERR "did not find the firmware file. (%s) "\r\n"Please see linux/Documentation/dvb/ for more details "\r\n"on firmware-problems.", filename);\r\nelse\r\naltera_init(&netup_config, fw);\r\nrelease_firmware(fw);\r\nbreak;\r\n}\r\n}\r\n}
