static int sh_mipi_set_dot_clock(struct platform_device *pdev,\r\nvoid __iomem *base,\r\nint enable)\r\n{\r\nstruct clk *pck, *phy;\r\nint ret;\r\npck = clk_get(&pdev->dev, "dsip_clk");\r\nif (IS_ERR(pck)) {\r\nret = PTR_ERR(pck);\r\ngoto sh_mipi_set_dot_clock_pck_err;\r\n}\r\nphy = clk_get(&pdev->dev, "dsiphy_clk");\r\nif (IS_ERR(phy)) {\r\nret = PTR_ERR(phy);\r\ngoto sh_mipi_set_dot_clock_phy_err;\r\n}\r\nif (enable) {\r\nclk_set_rate(pck, clk_round_rate(pck, 24000000));\r\nclk_set_rate(phy, clk_round_rate(pck, 510000000));\r\nclk_enable(pck);\r\nclk_enable(phy);\r\n} else {\r\nclk_disable(pck);\r\nclk_disable(phy);\r\n}\r\nret = 0;\r\nclk_put(phy);\r\nsh_mipi_set_dot_clock_phy_err:\r\nclk_put(pck);\r\nsh_mipi_set_dot_clock_pck_err:\r\nreturn ret;\r\n}\r\nstatic int lcd_backlight_set_brightness(int brightness)\r\n{\r\nstruct i2c_adapter *adap;\r\nstruct i2c_msg msg;\r\nunsigned int i;\r\nint ret;\r\nif (brightness == 0) {\r\ngpio_set_value(235, 0);\r\nmdelay(24);\r\ngpio_set_value(235, 1);\r\nreturn 0;\r\n}\r\nadap = i2c_get_adapter(1);\r\nif (adap == NULL)\r\nreturn -ENODEV;\r\nfor (i = 0; i < ARRAY_SIZE(lcd_backlight_seq); i++) {\r\nmsg.addr = 0x6d;\r\nmsg.buf = &lcd_backlight_seq[i][0];\r\nmsg.len = 2;\r\nmsg.flags = 0;\r\nret = i2c_transfer(adap, &msg, 1);\r\nif (ret < 0)\r\nbreak;\r\n}\r\ni2c_put_adapter(adap);\r\nreturn ret < 0 ? ret : 0;\r\n}\r\nstatic void ag5evm_sdhi1_set_pwr(struct platform_device *pdev, int state)\r\n{\r\nstatic int power_gpio = -EINVAL;\r\nif (power_gpio < 0) {\r\nint ret = gpio_request_one(114, GPIOF_OUT_INIT_LOW,\r\n"sdhi1_power");\r\nif (!ret)\r\npower_gpio = 114;\r\n}\r\ngpio_set_value(114, state);\r\n}\r\nstatic void __init ag5evm_init(void)\r\n{\r\nregulator_register_always_on(0, "fixed-1.8V", fixed1v8_power_consumers,\r\nARRAY_SIZE(fixed1v8_power_consumers), 1800000);\r\nregulator_register_always_on(1, "fixed-2.8V", fixed2v8_power_consumers,\r\nARRAY_SIZE(fixed2v8_power_consumers), 3300000);\r\nregulator_register_fixed(3, dummy_supplies, ARRAY_SIZE(dummy_supplies));\r\npinctrl_register_mappings(ag5evm_pinctrl_map,\r\nARRAY_SIZE(ag5evm_pinctrl_map));\r\nsh73a0_pinmux_init();\r\ngpio_request_one(208, GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_request_one(144, GPIOF_IN, NULL);\r\ngpio_request_one(145, GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_request_one(217, GPIOF_OUT_INIT_LOW, NULL);\r\nmdelay(1);\r\ngpio_set_value(217, 1);\r\nmdelay(100);\r\ngpio_request_one(235, GPIOF_OUT_INIT_LOW, NULL);\r\nlcd_backlight_set_brightness(0);\r\n#ifdef CONFIG_CACHE_L2X0\r\nl2x0_init(IOMEM(0xf0100000), 0x00460000, 0xc2000fff);\r\n#endif\r\nsh73a0_add_standard_devices();\r\nplatform_add_devices(ag5evm_devices, ARRAY_SIZE(ag5evm_devices));\r\n}
