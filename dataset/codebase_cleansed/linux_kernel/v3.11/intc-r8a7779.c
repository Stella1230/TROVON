void __init r8a7779_init_irq_extpin(int irlm)\r\n{\r\nvoid __iomem *icr0 = ioremap_nocache(0xfe780000, PAGE_SIZE);\r\nunsigned long tmp;\r\nif (icr0) {\r\ntmp = ioread32(icr0);\r\nif (irlm)\r\ntmp |= 1 << 23;\r\nelse\r\ntmp &= ~(1 << 23);\r\ntmp |= (1 << 21);\r\niowrite32(tmp, icr0);\r\niounmap(icr0);\r\nif (irlm)\r\nplatform_device_register(&irqpin0_device);\r\n} else\r\npr_warn("r8a7779: unable to setup external irq pin mode\n");\r\n}\r\nstatic int r8a7779_set_wake(struct irq_data *data, unsigned int on)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __init r8a7779_init_irq_common(void)\r\n{\r\ngic_arch_extn.irq_set_wake = r8a7779_set_wake;\r\n__raw_writel(0xffffffff, INT2NTSR0);\r\n__raw_writel(0x3fffffff, INT2NTSR1);\r\n__raw_writel(0xfffffff0, INT2SMSKCR0);\r\n__raw_writel(0xfff7ffff, INT2SMSKCR1);\r\n__raw_writel(0xfffbffdf, INT2SMSKCR2);\r\n__raw_writel(0xbffffffc, INT2SMSKCR3);\r\n__raw_writel(0x003fee3f, INT2SMSKCR4);\r\n}\r\nvoid __init r8a7779_init_irq(void)\r\n{\r\nvoid __iomem *gic_dist_base = IOMEM(0xf0001000);\r\nvoid __iomem *gic_cpu_base = IOMEM(0xf0000100);\r\ngic_init(0, 29, gic_dist_base, gic_cpu_base);\r\nr8a7779_init_irq_common();\r\n}\r\nvoid __init r8a7779_init_irq_dt(void)\r\n{\r\nirqchip_init();\r\nr8a7779_init_irq_common();\r\n}
