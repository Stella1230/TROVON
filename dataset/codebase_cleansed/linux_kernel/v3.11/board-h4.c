static void __init board_mkp_init(void)\r\n{\r\nomap_mux_init_gpio(88, OMAP_PULL_ENA | OMAP_PULL_UP);\r\nomap_mux_init_gpio(89, OMAP_PULL_ENA | OMAP_PULL_UP);\r\nomap_mux_init_gpio(124, OMAP_PULL_ENA | OMAP_PULL_UP);\r\nomap_mux_init_signal("mcbsp2_dr.gpio_11", OMAP_PULL_ENA | OMAP_PULL_UP);\r\nif (omap_has_menelaus()) {\r\nomap_mux_init_signal("sdrc_a14.gpio0",\r\nOMAP_PULL_ENA | OMAP_PULL_UP);\r\nomap_mux_init_signal("vlynq_rx0.gpio_15", 0);\r\nomap_mux_init_signal("gpio_98", 0);\r\nboard_keypad_row_gpios[5] = 0;\r\nboard_keypad_col_gpios[2] = 15;\r\nboard_keypad_col_gpios[6] = 18;\r\n} else {\r\nomap_mux_init_signal("gpio_96", OMAP_PULL_ENA | OMAP_PULL_UP);\r\nomap_mux_init_signal("gpio_100", 0);\r\nomap_mux_init_signal("gpio_98", 0);\r\n}\r\nomap_mux_init_signal("gpio_90", 0);\r\nomap_mux_init_signal("gpio_91", 0);\r\nomap_mux_init_signal("gpio_36", 0);\r\nomap_mux_init_signal("mcbsp2_clkx.gpio_12", 0);\r\nomap_mux_init_signal("gpio_97", 0);\r\nplatform_device_register(&board_keyboard);\r\n}\r\nstatic inline void board_mkp_init(void)\r\n{\r\n}\r\nstatic u32 get_sysboot_value(void)\r\n{\r\nreturn (omap_ctrl_readl(OMAP24XX_CONTROL_STATUS) &\r\n(OMAP2_SYSBOOT_5_MASK | OMAP2_SYSBOOT_4_MASK |\r\nOMAP2_SYSBOOT_3_MASK | OMAP2_SYSBOOT_2_MASK |\r\nOMAP2_SYSBOOT_1_MASK | OMAP2_SYSBOOT_0_MASK));\r\n}\r\nstatic u32 is_gpmc_muxed(void)\r\n{\r\nu32 mux;\r\nmux = get_sysboot_value();\r\nif ((mux & 0xF) == 0xd)\r\nreturn 1;\r\nif (mux & 0x2)\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nstatic void __init board_smc91x_init(void)\r\n{\r\nif (is_gpmc_muxed())\r\nboard_smc91x_data.flags |= GPMC_MUX_ADD_DATA;\r\nomap_mux_init_gpio(board_smc91x_data.gpio_irq, OMAP_PIN_INPUT);\r\ngpmc_smc91x_init(&board_smc91x_data);\r\n}\r\nstatic inline void board_smc91x_init(void)\r\n{\r\n}\r\nstatic void __init h4_init_flash(void)\r\n{\r\nunsigned long base;\r\nif (gpmc_cs_request(H4_FLASH_CS, SZ_64M, &base) < 0) {\r\nprintk("Can't request GPMC CS for flash\n");\r\nreturn;\r\n}\r\nh4_flash_resource.start = base;\r\nh4_flash_resource.end = base + SZ_64M - 1;\r\n}\r\nstatic void __init omap_h4_init(void)\r\n{\r\nomap2420_mux_init(board_mux, OMAP_PACKAGE_ZAF);\r\nboard_mkp_init();\r\nh4_i2c_board_info[0].irq = gpio_to_irq(125);\r\ni2c_register_board_info(1, h4_i2c_board_info,\r\nARRAY_SIZE(h4_i2c_board_info));\r\nplatform_add_devices(h4_devices, ARRAY_SIZE(h4_devices));\r\nomap_serial_init();\r\nomap_sdrc_init(NULL, NULL);\r\nh4_init_flash();\r\nboard_smc91x_init();\r\nomap_display_init(&h4_dss_data);\r\n}
