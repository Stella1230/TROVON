static int max7301_spi_write(struct device *dev, unsigned int reg,\r\nunsigned int val)\r\n{\r\nstruct spi_device *spi = to_spi_device(dev);\r\nu16 word = ((reg & 0x7F) << 8) | (val & 0xFF);\r\nreturn spi_write(spi, (const u8 *)&word, sizeof(word));\r\n}\r\nstatic int max7301_spi_read(struct device *dev, unsigned int reg)\r\n{\r\nint ret;\r\nu16 word;\r\nstruct spi_device *spi = to_spi_device(dev);\r\nword = 0x8000 | (reg << 8);\r\nret = spi_write(spi, (const u8 *)&word, sizeof(word));\r\nif (ret)\r\nreturn ret;\r\nret = spi_read(spi, (u8 *)&word, sizeof(word));\r\nif (ret)\r\nreturn ret;\r\nreturn word & 0xff;\r\n}\r\nstatic int max7301_probe(struct spi_device *spi)\r\n{\r\nstruct max7301 *ts;\r\nint ret;\r\nif (spi->dev.platform_data)\r\nspi->bits_per_word = 16;\r\nret = spi_setup(spi);\r\nif (ret < 0)\r\nreturn ret;\r\nts = devm_kzalloc(&spi->dev, sizeof(struct max7301), GFP_KERNEL);\r\nif (!ts)\r\nreturn -ENOMEM;\r\nts->read = max7301_spi_read;\r\nts->write = max7301_spi_write;\r\nts->dev = &spi->dev;\r\nret = __max730x_probe(ts);\r\nreturn ret;\r\n}\r\nstatic int max7301_remove(struct spi_device *spi)\r\n{\r\nreturn __max730x_remove(&spi->dev);\r\n}\r\nstatic int __init max7301_init(void)\r\n{\r\nreturn spi_register_driver(&max7301_driver);\r\n}\r\nstatic void __exit max7301_exit(void)\r\n{\r\nspi_unregister_driver(&max7301_driver);\r\n}
