static int __init epapr_paravirt_init(void)\r\n{\r\nstruct device_node *hyper_node;\r\nconst u32 *insts;\r\nint len, i;\r\nhyper_node = of_find_node_by_path("/hypervisor");\r\nif (!hyper_node)\r\nreturn -ENODEV;\r\ninsts = of_get_property(hyper_node, "hcall-instructions", &len);\r\nif (!insts)\r\nreturn -ENODEV;\r\nif (len % 4 || len > (4 * 4))\r\nreturn -ENODEV;\r\nfor (i = 0; i < (len / 4); i++) {\r\npatch_instruction(epapr_hypercall_start + i, insts[i]);\r\n#if !defined(CONFIG_64BIT) || defined(CONFIG_PPC_BOOK3E_64)\r\npatch_instruction(epapr_ev_idle_start + i, insts[i]);\r\n#endif\r\n}\r\n#if !defined(CONFIG_64BIT) || defined(CONFIG_PPC_BOOK3E_64)\r\nif (of_get_property(hyper_node, "has-idle", NULL))\r\nppc_md.power_save = epapr_ev_idle;\r\n#endif\r\nepapr_paravirt_enabled = true;\r\nreturn 0;\r\n}
