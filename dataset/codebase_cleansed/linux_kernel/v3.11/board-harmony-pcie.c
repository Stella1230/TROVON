int __init harmony_pcie_init(void)\r\n{\r\nstruct device_node *np;\r\nint en_vdd_1v05;\r\nstruct regulator *regulator = NULL;\r\nint err;\r\nnp = of_find_node_by_path("/regulators/regulator@3");\r\nif (!np) {\r\npr_err("%s: of_find_node_by_path failed\n", __func__);\r\nreturn -ENODEV;\r\n}\r\nen_vdd_1v05 = of_get_named_gpio(np, "gpio", 0);\r\nif (en_vdd_1v05 < 0) {\r\npr_err("%s: of_get_named_gpio failed: %d\n", __func__,\r\nen_vdd_1v05);\r\nreturn en_vdd_1v05;\r\n}\r\nerr = gpio_request(en_vdd_1v05, "EN_VDD_1V05");\r\nif (err) {\r\npr_err("%s: gpio_request failed: %d\n", __func__, err);\r\nreturn err;\r\n}\r\ngpio_direction_output(en_vdd_1v05, 1);\r\nregulator = regulator_get(NULL, "vdd_ldo0,vddio_pex_clk");\r\nif (IS_ERR(regulator)) {\r\nerr = PTR_ERR(regulator);\r\npr_err("%s: regulator_get failed: %d\n", __func__, err);\r\ngoto err_reg;\r\n}\r\nerr = regulator_enable(regulator);\r\nif (err) {\r\npr_err("%s: regulator_enable failed: %d\n", __func__, err);\r\ngoto err_en;\r\n}\r\nerr = tegra_pcie_init(true, true);\r\nif (err) {\r\npr_err("%s: tegra_pcie_init failed: %d\n", __func__, err);\r\ngoto err_pcie;\r\n}\r\nreturn 0;\r\nerr_pcie:\r\nregulator_disable(regulator);\r\nerr_en:\r\nregulator_put(regulator);\r\nerr_reg:\r\ngpio_free(en_vdd_1v05);\r\nreturn err;\r\n}
