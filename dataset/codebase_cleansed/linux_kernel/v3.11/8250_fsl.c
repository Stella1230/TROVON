int fsl8250_handle_irq(struct uart_port *port)\r\n{\r\nunsigned char lsr, orig_lsr;\r\nunsigned long flags;\r\nunsigned int iir;\r\nstruct uart_8250_port *up =\r\ncontainer_of(port, struct uart_8250_port, port);\r\nspin_lock_irqsave(&up->port.lock, flags);\r\niir = port->serial_in(port, UART_IIR);\r\nif (iir & UART_IIR_NO_INT) {\r\nspin_unlock_irqrestore(&up->port.lock, flags);\r\nreturn 0;\r\n}\r\nif (unlikely(up->lsr_saved_flags & UART_LSR_BI)) {\r\nup->lsr_saved_flags &= ~UART_LSR_BI;\r\nport->serial_in(port, UART_RX);\r\nspin_unlock_irqrestore(&up->port.lock, flags);\r\nreturn 1;\r\n}\r\nlsr = orig_lsr = up->port.serial_in(&up->port, UART_LSR);\r\nif (lsr & (UART_LSR_DR | UART_LSR_BI))\r\nlsr = serial8250_rx_chars(up, lsr);\r\nserial8250_modem_status(up);\r\nif (lsr & UART_LSR_THRE)\r\nserial8250_tx_chars(up);\r\nup->lsr_saved_flags = orig_lsr;\r\nspin_unlock_irqrestore(&up->port.lock, flags);\r\nreturn 1;\r\n}
