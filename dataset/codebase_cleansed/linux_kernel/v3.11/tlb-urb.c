void tlb_wire_entry(struct vm_area_struct *vma, unsigned long addr, pte_t pte)\r\n{\r\nunsigned long status, flags;\r\nint urb;\r\nlocal_irq_save(flags);\r\nstatus = __raw_readl(MMUCR);\r\nurb = (status & MMUCR_URB) >> MMUCR_URB_SHIFT;\r\nstatus &= ~MMUCR_URC;\r\nBUG_ON(!--urb);\r\nurb = urb % MMUCR_URB_NENTRIES;\r\nstatus |= (urb << MMUCR_URC_SHIFT);\r\n__raw_writel(status, MMUCR);\r\nctrl_barrier();\r\n__update_tlb(vma, addr, pte);\r\nstatus = __raw_readl(MMUCR);\r\nstatus &= ~MMUCR_URB;\r\nstatus |= (urb << MMUCR_URB_SHIFT);\r\n__raw_writel(status, MMUCR);\r\nctrl_barrier();\r\nlocal_irq_restore(flags);\r\n}\r\nvoid tlb_unwire_entry(void)\r\n{\r\nunsigned long status, flags;\r\nint urb;\r\nlocal_irq_save(flags);\r\nstatus = __raw_readl(MMUCR);\r\nurb = (status & MMUCR_URB) >> MMUCR_URB_SHIFT;\r\nstatus &= ~MMUCR_URB;\r\nBUG_ON(urb++ == MMUCR_URB_NENTRIES);\r\nurb = urb % MMUCR_URB_NENTRIES;\r\nstatus |= (urb << MMUCR_URB_SHIFT);\r\n__raw_writel(status, MMUCR);\r\nctrl_barrier();\r\nlocal_irq_restore(flags);\r\n}
