int drm_get_usb_dev(struct usb_interface *interface,\r\nconst struct usb_device_id *id,\r\nstruct drm_driver *driver)\r\n{\r\nstruct drm_device *dev;\r\nstruct usb_device *usbdev;\r\nint ret;\r\nDRM_DEBUG("\n");\r\ndev = kzalloc(sizeof(*dev), GFP_KERNEL);\r\nif (!dev)\r\nreturn -ENOMEM;\r\nusbdev = interface_to_usbdev(interface);\r\ndev->usbdev = usbdev;\r\ndev->dev = &interface->dev;\r\nmutex_lock(&drm_global_mutex);\r\nret = drm_fill_in_dev(dev, NULL, driver);\r\nif (ret) {\r\nprintk(KERN_ERR "DRM: Fill_in_dev failed.\n");\r\ngoto err_g1;\r\n}\r\nusb_set_intfdata(interface, dev);\r\nret = drm_get_minor(dev, &dev->control, DRM_MINOR_CONTROL);\r\nif (ret)\r\ngoto err_g1;\r\nret = drm_get_minor(dev, &dev->primary, DRM_MINOR_LEGACY);\r\nif (ret)\r\ngoto err_g2;\r\nif (dev->driver->load) {\r\nret = dev->driver->load(dev, 0);\r\nif (ret)\r\ngoto err_g3;\r\n}\r\nret = drm_mode_group_init_legacy_group(dev,\r\n&dev->primary->mode_group);\r\nif (ret)\r\ngoto err_g3;\r\nlist_add_tail(&dev->driver_item, &driver->device_list);\r\nmutex_unlock(&drm_global_mutex);\r\nDRM_INFO("Initialized %s %d.%d.%d %s on minor %d\n",\r\ndriver->name, driver->major, driver->minor, driver->patchlevel,\r\ndriver->date, dev->primary->index);\r\nreturn 0;\r\nerr_g3:\r\ndrm_put_minor(&dev->primary);\r\nerr_g2:\r\ndrm_put_minor(&dev->control);\r\nerr_g1:\r\nkfree(dev);\r\nmutex_unlock(&drm_global_mutex);\r\nreturn ret;\r\n}\r\nstatic int drm_usb_get_irq(struct drm_device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic const char *drm_usb_get_name(struct drm_device *dev)\r\n{\r\nreturn "USB";\r\n}\r\nstatic int drm_usb_set_busid(struct drm_device *dev,\r\nstruct drm_master *master)\r\n{\r\nreturn 0;\r\n}\r\nint drm_usb_init(struct drm_driver *driver, struct usb_driver *udriver)\r\n{\r\nint res;\r\nDRM_DEBUG("\n");\r\nINIT_LIST_HEAD(&driver->device_list);\r\ndriver->kdriver.usb = udriver;\r\ndriver->bus = &drm_usb_bus;\r\nres = usb_register(udriver);\r\nreturn res;\r\n}\r\nvoid drm_usb_exit(struct drm_driver *driver,\r\nstruct usb_driver *udriver)\r\n{\r\nusb_deregister(udriver);\r\n}
