int lp8788_read_byte(struct lp8788 *lp, u8 reg, u8 *data)\r\n{\r\nint ret;\r\nunsigned int val;\r\nret = regmap_read(lp->regmap, reg, &val);\r\nif (ret < 0) {\r\ndev_err(lp->dev, "failed to read 0x%.2x\n", reg);\r\nreturn ret;\r\n}\r\n*data = (u8)val;\r\nreturn 0;\r\n}\r\nint lp8788_read_multi_bytes(struct lp8788 *lp, u8 reg, u8 *data, size_t count)\r\n{\r\nreturn regmap_bulk_read(lp->regmap, reg, data, count);\r\n}\r\nint lp8788_write_byte(struct lp8788 *lp, u8 reg, u8 data)\r\n{\r\nreturn regmap_write(lp->regmap, reg, data);\r\n}\r\nint lp8788_update_bits(struct lp8788 *lp, u8 reg, u8 mask, u8 data)\r\n{\r\nreturn regmap_update_bits(lp->regmap, reg, mask, data);\r\n}\r\nstatic int lp8788_platform_init(struct lp8788 *lp)\r\n{\r\nstruct lp8788_platform_data *pdata = lp->pdata;\r\nreturn (pdata && pdata->init_func) ? pdata->init_func(lp) : 0;\r\n}\r\nstatic int lp8788_probe(struct i2c_client *cl, const struct i2c_device_id *id)\r\n{\r\nstruct lp8788 *lp;\r\nstruct lp8788_platform_data *pdata = cl->dev.platform_data;\r\nint ret;\r\nlp = devm_kzalloc(&cl->dev, sizeof(struct lp8788), GFP_KERNEL);\r\nif (!lp)\r\nreturn -ENOMEM;\r\nlp->regmap = devm_regmap_init_i2c(cl, &lp8788_regmap_config);\r\nif (IS_ERR(lp->regmap)) {\r\nret = PTR_ERR(lp->regmap);\r\ndev_err(&cl->dev, "regmap init i2c err: %d\n", ret);\r\nreturn ret;\r\n}\r\nlp->pdata = pdata;\r\nlp->dev = &cl->dev;\r\ni2c_set_clientdata(cl, lp);\r\nret = lp8788_platform_init(lp);\r\nif (ret)\r\nreturn ret;\r\nret = lp8788_irq_init(lp, cl->irq);\r\nif (ret)\r\nreturn ret;\r\nreturn mfd_add_devices(lp->dev, -1, lp8788_devs,\r\nARRAY_SIZE(lp8788_devs), NULL, 0, NULL);\r\n}\r\nstatic int lp8788_remove(struct i2c_client *cl)\r\n{\r\nstruct lp8788 *lp = i2c_get_clientdata(cl);\r\nmfd_remove_devices(lp->dev);\r\nlp8788_irq_exit(lp);\r\nreturn 0;\r\n}\r\nstatic int __init lp8788_init(void)\r\n{\r\nreturn i2c_add_driver(&lp8788_driver);\r\n}\r\nstatic void __exit lp8788_exit(void)\r\n{\r\ni2c_del_driver(&lp8788_driver);\r\n}
