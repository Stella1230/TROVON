int btrfs_insert_orphan_item(struct btrfs_trans_handle *trans,\r\nstruct btrfs_root *root, u64 offset)\r\n{\r\nstruct btrfs_path *path;\r\nstruct btrfs_key key;\r\nint ret = 0;\r\nkey.objectid = BTRFS_ORPHAN_OBJECTID;\r\nbtrfs_set_key_type(&key, BTRFS_ORPHAN_ITEM_KEY);\r\nkey.offset = offset;\r\npath = btrfs_alloc_path();\r\nif (!path)\r\nreturn -ENOMEM;\r\nret = btrfs_insert_empty_item(trans, root, path, &key, 0);\r\nbtrfs_free_path(path);\r\nreturn ret;\r\n}\r\nint btrfs_del_orphan_item(struct btrfs_trans_handle *trans,\r\nstruct btrfs_root *root, u64 offset)\r\n{\r\nstruct btrfs_path *path;\r\nstruct btrfs_key key;\r\nint ret = 0;\r\nkey.objectid = BTRFS_ORPHAN_OBJECTID;\r\nbtrfs_set_key_type(&key, BTRFS_ORPHAN_ITEM_KEY);\r\nkey.offset = offset;\r\npath = btrfs_alloc_path();\r\nif (!path)\r\nreturn -ENOMEM;\r\nret = btrfs_search_slot(trans, root, &key, path, -1, 1);\r\nif (ret < 0)\r\ngoto out;\r\nif (ret) {\r\nret = -ENOENT;\r\ngoto out;\r\n}\r\nret = btrfs_del_item(trans, root, path);\r\nout:\r\nbtrfs_free_path(path);\r\nreturn ret;\r\n}\r\nint btrfs_find_orphan_item(struct btrfs_root *root, u64 offset)\r\n{\r\nstruct btrfs_path *path;\r\nstruct btrfs_key key;\r\nint ret;\r\nkey.objectid = BTRFS_ORPHAN_OBJECTID;\r\nkey.type = BTRFS_ORPHAN_ITEM_KEY;\r\nkey.offset = offset;\r\npath = btrfs_alloc_path();\r\nif (!path)\r\nreturn -ENOMEM;\r\nret = btrfs_search_slot(NULL, root, &key, path, 0, 0);\r\nbtrfs_free_path(path);\r\nreturn ret;\r\n}
