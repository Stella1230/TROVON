static int __cfg80211_stop_ap(struct cfg80211_registered_device *rdev,\r\nstruct net_device *dev)\r\n{\r\nstruct wireless_dev *wdev = dev->ieee80211_ptr;\r\nint err;\r\nASSERT_WDEV_LOCK(wdev);\r\nif (!rdev->ops->stop_ap)\r\nreturn -EOPNOTSUPP;\r\nif (dev->ieee80211_ptr->iftype != NL80211_IFTYPE_AP &&\r\ndev->ieee80211_ptr->iftype != NL80211_IFTYPE_P2P_GO)\r\nreturn -EOPNOTSUPP;\r\nif (!wdev->beacon_interval)\r\nreturn -ENOENT;\r\nerr = rdev_stop_ap(rdev, dev);\r\nif (!err) {\r\nwdev->beacon_interval = 0;\r\nwdev->channel = NULL;\r\nwdev->ssid_len = 0;\r\n}\r\nreturn err;\r\n}\r\nint cfg80211_stop_ap(struct cfg80211_registered_device *rdev,\r\nstruct net_device *dev)\r\n{\r\nstruct wireless_dev *wdev = dev->ieee80211_ptr;\r\nint err;\r\nwdev_lock(wdev);\r\nerr = __cfg80211_stop_ap(rdev, dev);\r\nwdev_unlock(wdev);\r\nreturn err;\r\n}
