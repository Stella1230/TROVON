static void _write_clktrctrl(u8 c, s16 module, u32 mask)\r\n{\r\nu32 v;\r\nv = omap2_cm_read_mod_reg(module, OMAP2_CM_CLKSTCTRL);\r\nv &= ~mask;\r\nv |= c << __ffs(mask);\r\nomap2_cm_write_mod_reg(v, module, OMAP2_CM_CLKSTCTRL);\r\n}\r\nbool omap3xxx_cm_is_clkdm_in_hwsup(s16 module, u32 mask)\r\n{\r\nu32 v;\r\nv = omap2_cm_read_mod_reg(module, OMAP2_CM_CLKSTCTRL);\r\nv &= mask;\r\nv >>= __ffs(mask);\r\nreturn (v == OMAP34XX_CLKSTCTRL_ENABLE_AUTO) ? 1 : 0;\r\n}\r\nvoid omap3xxx_cm_clkdm_enable_hwsup(s16 module, u32 mask)\r\n{\r\n_write_clktrctrl(OMAP34XX_CLKSTCTRL_ENABLE_AUTO, module, mask);\r\n}\r\nvoid omap3xxx_cm_clkdm_disable_hwsup(s16 module, u32 mask)\r\n{\r\n_write_clktrctrl(OMAP34XX_CLKSTCTRL_DISABLE_AUTO, module, mask);\r\n}\r\nvoid omap3xxx_cm_clkdm_force_sleep(s16 module, u32 mask)\r\n{\r\n_write_clktrctrl(OMAP34XX_CLKSTCTRL_FORCE_SLEEP, module, mask);\r\n}\r\nvoid omap3xxx_cm_clkdm_force_wakeup(s16 module, u32 mask)\r\n{\r\n_write_clktrctrl(OMAP34XX_CLKSTCTRL_FORCE_WAKEUP, module, mask);\r\n}\r\nint omap3xxx_cm_wait_module_ready(s16 prcm_mod, u8 idlest_id, u8 idlest_shift)\r\n{\r\nint ena = 0, i = 0;\r\nu8 cm_idlest_reg;\r\nu32 mask;\r\nif (!idlest_id || (idlest_id > ARRAY_SIZE(omap3xxx_cm_idlest_offs)))\r\nreturn -EINVAL;\r\ncm_idlest_reg = omap3xxx_cm_idlest_offs[idlest_id - 1];\r\nmask = 1 << idlest_shift;\r\nena = 0;\r\nomap_test_timeout(((omap2_cm_read_mod_reg(prcm_mod, cm_idlest_reg) &\r\nmask) == ena), MAX_MODULE_READY_TIME, i);\r\nreturn (i < MAX_MODULE_READY_TIME) ? 0 : -EBUSY;\r\n}\r\nint omap3xxx_cm_split_idlest_reg(void __iomem *idlest_reg, s16 *prcm_inst,\r\nu8 *idlest_reg_id)\r\n{\r\nunsigned long offs;\r\nu8 idlest_offs;\r\nint i;\r\nif (idlest_reg < (cm_base + OMAP3430_IVA2_MOD) ||\r\nidlest_reg > (cm_base + 0x1ffff))\r\nreturn -EINVAL;\r\nidlest_offs = (unsigned long)idlest_reg & 0xff;\r\nfor (i = 0; i < ARRAY_SIZE(omap3xxx_cm_idlest_offs); i++) {\r\nif (idlest_offs == omap3xxx_cm_idlest_offs[i]) {\r\n*idlest_reg_id = i + 1;\r\nbreak;\r\n}\r\n}\r\nif (i == ARRAY_SIZE(omap3xxx_cm_idlest_offs))\r\nreturn -EINVAL;\r\noffs = idlest_reg - cm_base;\r\noffs &= 0xff00;\r\n*prcm_inst = offs;\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_add_sleepdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nomap2_cm_set_mod_reg_bits((1 << clkdm2->dep_bit),\r\nclkdm1->pwrdm.ptr->prcm_offs,\r\nOMAP3430_CM_SLEEPDEP);\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_del_sleepdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nomap2_cm_clear_mod_reg_bits((1 << clkdm2->dep_bit),\r\nclkdm1->pwrdm.ptr->prcm_offs,\r\nOMAP3430_CM_SLEEPDEP);\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_read_sleepdep(struct clockdomain *clkdm1,\r\nstruct clockdomain *clkdm2)\r\n{\r\nreturn omap2_cm_read_mod_bits_shift(clkdm1->pwrdm.ptr->prcm_offs,\r\nOMAP3430_CM_SLEEPDEP,\r\n(1 << clkdm2->dep_bit));\r\n}\r\nstatic int omap3xxx_clkdm_clear_all_sleepdeps(struct clockdomain *clkdm)\r\n{\r\nstruct clkdm_dep *cd;\r\nu32 mask = 0;\r\nfor (cd = clkdm->sleepdep_srcs; cd && cd->clkdm_name; cd++) {\r\nif (!cd->clkdm)\r\ncontinue;\r\nmask |= 1 << cd->clkdm->dep_bit;\r\ncd->sleepdep_usecount = 0;\r\n}\r\nomap2_cm_clear_mod_reg_bits(mask, clkdm->pwrdm.ptr->prcm_offs,\r\nOMAP3430_CM_SLEEPDEP);\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_sleep(struct clockdomain *clkdm)\r\n{\r\nomap3xxx_cm_clkdm_force_sleep(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_wakeup(struct clockdomain *clkdm)\r\n{\r\nomap3xxx_cm_clkdm_force_wakeup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nreturn 0;\r\n}\r\nstatic void omap3xxx_clkdm_allow_idle(struct clockdomain *clkdm)\r\n{\r\nif (clkdm->usecount > 0)\r\nclkdm_add_autodeps(clkdm);\r\nomap3xxx_cm_clkdm_enable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\n}\r\nstatic void omap3xxx_clkdm_deny_idle(struct clockdomain *clkdm)\r\n{\r\nomap3xxx_cm_clkdm_disable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nif (clkdm->usecount > 0)\r\nclkdm_del_autodeps(clkdm);\r\n}\r\nstatic int omap3xxx_clkdm_clk_enable(struct clockdomain *clkdm)\r\n{\r\nbool hwsup = false;\r\nif (!clkdm->clktrctrl_mask)\r\nreturn 0;\r\nif ((clkdm->flags & CLKDM_MISSING_IDLE_REPORTING) &&\r\n(clkdm->flags & CLKDM_CAN_FORCE_WAKEUP)) {\r\nomap3xxx_clkdm_wakeup(clkdm);\r\nreturn 0;\r\n}\r\nhwsup = omap3xxx_cm_is_clkdm_in_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nif (hwsup) {\r\nomap3xxx_cm_clkdm_disable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nclkdm_add_autodeps(clkdm);\r\nomap3xxx_cm_clkdm_enable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\n} else {\r\nif (clkdm->flags & CLKDM_CAN_FORCE_WAKEUP)\r\nomap3xxx_clkdm_wakeup(clkdm);\r\n}\r\nreturn 0;\r\n}\r\nstatic int omap3xxx_clkdm_clk_disable(struct clockdomain *clkdm)\r\n{\r\nbool hwsup = false;\r\nif (!clkdm->clktrctrl_mask)\r\nreturn 0;\r\nif (clkdm->flags & CLKDM_MISSING_IDLE_REPORTING &&\r\n!(clkdm->flags & CLKDM_CAN_FORCE_SLEEP)) {\r\nomap3xxx_cm_clkdm_enable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nreturn 0;\r\n}\r\nhwsup = omap3xxx_cm_is_clkdm_in_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nif (hwsup) {\r\nomap3xxx_cm_clkdm_disable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\nclkdm_del_autodeps(clkdm);\r\nomap3xxx_cm_clkdm_enable_hwsup(clkdm->pwrdm.ptr->prcm_offs,\r\nclkdm->clktrctrl_mask);\r\n} else {\r\nif (clkdm->flags & CLKDM_CAN_FORCE_SLEEP)\r\nomap3xxx_clkdm_sleep(clkdm);\r\n}\r\nreturn 0;\r\n}\r\nvoid omap3_cm_save_context(void)\r\n{\r\ncm_context.iva2_cm_clksel1 =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, CM_CLKSEL1);\r\ncm_context.iva2_cm_clksel2 =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, CM_CLKSEL2);\r\ncm_context.cm_sysconfig = __raw_readl(OMAP3430_CM_SYSCONFIG);\r\ncm_context.sgx_cm_clksel =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_SGX_MOD, CM_CLKSEL);\r\ncm_context.dss_cm_clksel =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, CM_CLKSEL);\r\ncm_context.cam_cm_clksel =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, CM_CLKSEL);\r\ncm_context.per_cm_clksel =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, CM_CLKSEL);\r\ncm_context.emu_cm_clksel =\r\nomap2_cm_read_mod_reg(OMAP3430_EMU_MOD, CM_CLKSEL1);\r\ncm_context.emu_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_EMU_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.pll_cm_autoidle =\r\nomap2_cm_read_mod_reg(PLL_MOD, CM_AUTOIDLE);\r\ncm_context.pll_cm_autoidle2 =\r\nomap2_cm_read_mod_reg(PLL_MOD, CM_AUTOIDLE2);\r\ncm_context.pll_cm_clksel4 =\r\nomap2_cm_read_mod_reg(PLL_MOD, OMAP3430ES2_CM_CLKSEL4);\r\ncm_context.pll_cm_clksel5 =\r\nomap2_cm_read_mod_reg(PLL_MOD, OMAP3430ES2_CM_CLKSEL5);\r\ncm_context.pll_cm_clken2 =\r\nomap2_cm_read_mod_reg(PLL_MOD, OMAP3430ES2_CM_CLKEN2);\r\ncm_context.cm_polctrl = __raw_readl(OMAP3430_CM_POLCTRL);\r\ncm_context.iva2_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, CM_FCLKEN);\r\ncm_context.iva2_cm_clken_pll =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, OMAP3430_CM_CLKEN_PLL);\r\ncm_context.core_cm_fclken1 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_FCLKEN1);\r\ncm_context.core_cm_fclken3 =\r\nomap2_cm_read_mod_reg(CORE_MOD, OMAP3430ES2_CM_FCLKEN3);\r\ncm_context.sgx_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_SGX_MOD, CM_FCLKEN);\r\ncm_context.wkup_cm_fclken =\r\nomap2_cm_read_mod_reg(WKUP_MOD, CM_FCLKEN);\r\ncm_context.dss_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, CM_FCLKEN);\r\ncm_context.cam_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, CM_FCLKEN);\r\ncm_context.per_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, CM_FCLKEN);\r\ncm_context.usbhost_cm_fclken =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_USBHOST_MOD, CM_FCLKEN);\r\ncm_context.core_cm_iclken1 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_ICLKEN1);\r\ncm_context.core_cm_iclken2 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_ICLKEN2);\r\ncm_context.core_cm_iclken3 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_ICLKEN3);\r\ncm_context.sgx_cm_iclken =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_SGX_MOD, CM_ICLKEN);\r\ncm_context.wkup_cm_iclken =\r\nomap2_cm_read_mod_reg(WKUP_MOD, CM_ICLKEN);\r\ncm_context.dss_cm_iclken =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, CM_ICLKEN);\r\ncm_context.cam_cm_iclken =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, CM_ICLKEN);\r\ncm_context.per_cm_iclken =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, CM_ICLKEN);\r\ncm_context.usbhost_cm_iclken =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_USBHOST_MOD, CM_ICLKEN);\r\ncm_context.iva2_cm_autoidle2 =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, CM_AUTOIDLE2);\r\ncm_context.mpu_cm_autoidle2 =\r\nomap2_cm_read_mod_reg(MPU_MOD, CM_AUTOIDLE2);\r\ncm_context.iva2_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_IVA2_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.mpu_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(MPU_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.core_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(CORE_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.sgx_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_SGX_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.dss_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.cam_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.per_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.neon_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_NEON_MOD, OMAP2_CM_CLKSTCTRL);\r\ncm_context.usbhost_cm_clkstctrl =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_USBHOST_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\ncm_context.core_cm_autoidle1 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_AUTOIDLE1);\r\ncm_context.core_cm_autoidle2 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_AUTOIDLE2);\r\ncm_context.core_cm_autoidle3 =\r\nomap2_cm_read_mod_reg(CORE_MOD, CM_AUTOIDLE3);\r\ncm_context.wkup_cm_autoidle =\r\nomap2_cm_read_mod_reg(WKUP_MOD, CM_AUTOIDLE);\r\ncm_context.dss_cm_autoidle =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, CM_AUTOIDLE);\r\ncm_context.cam_cm_autoidle =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, CM_AUTOIDLE);\r\ncm_context.per_cm_autoidle =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, CM_AUTOIDLE);\r\ncm_context.usbhost_cm_autoidle =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_USBHOST_MOD, CM_AUTOIDLE);\r\ncm_context.sgx_cm_sleepdep =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_SGX_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\ncm_context.dss_cm_sleepdep =\r\nomap2_cm_read_mod_reg(OMAP3430_DSS_MOD, OMAP3430_CM_SLEEPDEP);\r\ncm_context.cam_cm_sleepdep =\r\nomap2_cm_read_mod_reg(OMAP3430_CAM_MOD, OMAP3430_CM_SLEEPDEP);\r\ncm_context.per_cm_sleepdep =\r\nomap2_cm_read_mod_reg(OMAP3430_PER_MOD, OMAP3430_CM_SLEEPDEP);\r\ncm_context.usbhost_cm_sleepdep =\r\nomap2_cm_read_mod_reg(OMAP3430ES2_USBHOST_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\ncm_context.cm_clkout_ctrl =\r\nomap2_cm_read_mod_reg(OMAP3430_CCR_MOD,\r\nOMAP3_CM_CLKOUT_CTRL_OFFSET);\r\n}\r\nvoid omap3_cm_restore_context(void)\r\n{\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_clksel1, OMAP3430_IVA2_MOD,\r\nCM_CLKSEL1);\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_clksel2, OMAP3430_IVA2_MOD,\r\nCM_CLKSEL2);\r\n__raw_writel(cm_context.cm_sysconfig, OMAP3430_CM_SYSCONFIG);\r\nomap2_cm_write_mod_reg(cm_context.sgx_cm_clksel, OMAP3430ES2_SGX_MOD,\r\nCM_CLKSEL);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_clksel, OMAP3430_DSS_MOD,\r\nCM_CLKSEL);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_clksel, OMAP3430_CAM_MOD,\r\nCM_CLKSEL);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_clksel, OMAP3430_PER_MOD,\r\nCM_CLKSEL);\r\nomap2_cm_write_mod_reg(cm_context.emu_cm_clksel, OMAP3430_EMU_MOD,\r\nCM_CLKSEL1);\r\nomap2_cm_write_mod_reg(cm_context.emu_cm_clkstctrl, OMAP3430_EMU_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.pll_cm_autoidle, PLL_MOD,\r\nCM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.pll_cm_autoidle2, PLL_MOD,\r\nCM_AUTOIDLE2);\r\nomap2_cm_write_mod_reg(cm_context.pll_cm_clksel4, PLL_MOD,\r\nOMAP3430ES2_CM_CLKSEL4);\r\nomap2_cm_write_mod_reg(cm_context.pll_cm_clksel5, PLL_MOD,\r\nOMAP3430ES2_CM_CLKSEL5);\r\nomap2_cm_write_mod_reg(cm_context.pll_cm_clken2, PLL_MOD,\r\nOMAP3430ES2_CM_CLKEN2);\r\n__raw_writel(cm_context.cm_polctrl, OMAP3430_CM_POLCTRL);\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_fclken, OMAP3430_IVA2_MOD,\r\nCM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_clken_pll, OMAP3430_IVA2_MOD,\r\nOMAP3430_CM_CLKEN_PLL);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_fclken1, CORE_MOD,\r\nCM_FCLKEN1);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_fclken3, CORE_MOD,\r\nOMAP3430ES2_CM_FCLKEN3);\r\nomap2_cm_write_mod_reg(cm_context.sgx_cm_fclken, OMAP3430ES2_SGX_MOD,\r\nCM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.wkup_cm_fclken, WKUP_MOD, CM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_fclken, OMAP3430_DSS_MOD,\r\nCM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_fclken, OMAP3430_CAM_MOD,\r\nCM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_fclken, OMAP3430_PER_MOD,\r\nCM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.usbhost_cm_fclken,\r\nOMAP3430ES2_USBHOST_MOD, CM_FCLKEN);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_iclken1, CORE_MOD,\r\nCM_ICLKEN1);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_iclken2, CORE_MOD,\r\nCM_ICLKEN2);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_iclken3, CORE_MOD,\r\nCM_ICLKEN3);\r\nomap2_cm_write_mod_reg(cm_context.sgx_cm_iclken, OMAP3430ES2_SGX_MOD,\r\nCM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.wkup_cm_iclken, WKUP_MOD, CM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_iclken, OMAP3430_DSS_MOD,\r\nCM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_iclken, OMAP3430_CAM_MOD,\r\nCM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_iclken, OMAP3430_PER_MOD,\r\nCM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.usbhost_cm_iclken,\r\nOMAP3430ES2_USBHOST_MOD, CM_ICLKEN);\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_autoidle2, OMAP3430_IVA2_MOD,\r\nCM_AUTOIDLE2);\r\nomap2_cm_write_mod_reg(cm_context.mpu_cm_autoidle2, MPU_MOD,\r\nCM_AUTOIDLE2);\r\nomap2_cm_write_mod_reg(cm_context.iva2_cm_clkstctrl, OMAP3430_IVA2_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.mpu_cm_clkstctrl, MPU_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_clkstctrl, CORE_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.sgx_cm_clkstctrl, OMAP3430ES2_SGX_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_clkstctrl, OMAP3430_DSS_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_clkstctrl, OMAP3430_CAM_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_clkstctrl, OMAP3430_PER_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.neon_cm_clkstctrl, OMAP3430_NEON_MOD,\r\nOMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.usbhost_cm_clkstctrl,\r\nOMAP3430ES2_USBHOST_MOD, OMAP2_CM_CLKSTCTRL);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_autoidle1, CORE_MOD,\r\nCM_AUTOIDLE1);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_autoidle2, CORE_MOD,\r\nCM_AUTOIDLE2);\r\nomap2_cm_write_mod_reg(cm_context.core_cm_autoidle3, CORE_MOD,\r\nCM_AUTOIDLE3);\r\nomap2_cm_write_mod_reg(cm_context.wkup_cm_autoidle, WKUP_MOD,\r\nCM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_autoidle, OMAP3430_DSS_MOD,\r\nCM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_autoidle, OMAP3430_CAM_MOD,\r\nCM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_autoidle, OMAP3430_PER_MOD,\r\nCM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.usbhost_cm_autoidle,\r\nOMAP3430ES2_USBHOST_MOD, CM_AUTOIDLE);\r\nomap2_cm_write_mod_reg(cm_context.sgx_cm_sleepdep, OMAP3430ES2_SGX_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\nomap2_cm_write_mod_reg(cm_context.dss_cm_sleepdep, OMAP3430_DSS_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\nomap2_cm_write_mod_reg(cm_context.cam_cm_sleepdep, OMAP3430_CAM_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\nomap2_cm_write_mod_reg(cm_context.per_cm_sleepdep, OMAP3430_PER_MOD,\r\nOMAP3430_CM_SLEEPDEP);\r\nomap2_cm_write_mod_reg(cm_context.usbhost_cm_sleepdep,\r\nOMAP3430ES2_USBHOST_MOD, OMAP3430_CM_SLEEPDEP);\r\nomap2_cm_write_mod_reg(cm_context.cm_clkout_ctrl, OMAP3430_CCR_MOD,\r\nOMAP3_CM_CLKOUT_CTRL_OFFSET);\r\n}\r\nint __init omap3xxx_cm_init(void)\r\n{\r\nif (!cpu_is_omap34xx())\r\nreturn 0;\r\nreturn cm_register(&omap3xxx_cm_ll_data);\r\n}\r\nstatic void __exit omap3xxx_cm_exit(void)\r\n{\r\nif (!cpu_is_omap34xx())\r\nreturn;\r\nWARN(cm_unregister(&omap3xxx_cm_ll_data),\r\n"%s: cm_ll_data function pointer mismatch\n", __func__);\r\n}
