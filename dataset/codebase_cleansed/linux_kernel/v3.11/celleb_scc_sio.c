static int __init txx9_serial_init(void)\r\n{\r\nextern int early_serial_txx9_setup(struct uart_port *port);\r\nstruct device_node *node;\r\nint i;\r\nstruct uart_port req;\r\nstruct of_irq irq;\r\nstruct resource res;\r\nfor_each_compatible_node(node, "serial", "toshiba,sio-scc") {\r\nfor (i = 0; i < ARRAY_SIZE(txx9_scc_tab); i++) {\r\nif (!(txx9_serial_bitmap & (1<<i)))\r\ncontinue;\r\nif (of_irq_map_one(node, i, &irq))\r\ncontinue;\r\nif (of_address_to_resource(node,\r\ntxx9_scc_tab[i].index, &res))\r\ncontinue;\r\nmemset(&req, 0, sizeof(req));\r\nreq.line = i;\r\nreq.iotype = UPIO_MEM;\r\nreq.mapbase = res.start + txx9_scc_tab[i].offset;\r\n#ifdef CONFIG_SERIAL_TXX9_CONSOLE\r\nreq.membase = ioremap(req.mapbase, 0x24);\r\n#endif\r\nreq.irq = irq_create_of_mapping(irq.controller,\r\nirq.specifier, irq.size);\r\nreq.flags |= UPF_IOREMAP | UPF_BUGGY_UART\r\n;\r\nreq.uartclk = 83300000;\r\nearly_serial_txx9_setup(&req);\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init txx9_serial_config(char *ptr)\r\n{\r\nint i;\r\nfor (;;) {\r\nswitch (get_option(&ptr, &i)) {\r\ndefault:\r\nreturn 0;\r\ncase 2:\r\ntxx9_serial_bitmap |= 1 << i;\r\nbreak;\r\ncase 1:\r\ntxx9_serial_bitmap |= 1 << i;\r\nreturn 0;\r\n}\r\n}\r\n}
