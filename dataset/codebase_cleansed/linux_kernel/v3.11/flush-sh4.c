static void sh4__flush_wback_region(void *start, int size)\r\n{\r\nreg_size_t aligned_start, v, cnt, end;\r\naligned_start = register_align(start);\r\nv = aligned_start & ~(L1_CACHE_BYTES-1);\r\nend = (aligned_start + size + L1_CACHE_BYTES-1)\r\n& ~(L1_CACHE_BYTES-1);\r\ncnt = (end - v) / L1_CACHE_BYTES;\r\nwhile (cnt >= 8) {\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\ncnt -= 8;\r\n}\r\nwhile (cnt) {\r\n__ocbwb(v); v += L1_CACHE_BYTES;\r\ncnt--;\r\n}\r\n}\r\nstatic void sh4__flush_purge_region(void *start, int size)\r\n{\r\nreg_size_t aligned_start, v, cnt, end;\r\naligned_start = register_align(start);\r\nv = aligned_start & ~(L1_CACHE_BYTES-1);\r\nend = (aligned_start + size + L1_CACHE_BYTES-1)\r\n& ~(L1_CACHE_BYTES-1);\r\ncnt = (end - v) / L1_CACHE_BYTES;\r\nwhile (cnt >= 8) {\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\ncnt -= 8;\r\n}\r\nwhile (cnt) {\r\n__ocbp(v); v += L1_CACHE_BYTES;\r\ncnt--;\r\n}\r\n}\r\nstatic void sh4__flush_invalidate_region(void *start, int size)\r\n{\r\nreg_size_t aligned_start, v, cnt, end;\r\naligned_start = register_align(start);\r\nv = aligned_start & ~(L1_CACHE_BYTES-1);\r\nend = (aligned_start + size + L1_CACHE_BYTES-1)\r\n& ~(L1_CACHE_BYTES-1);\r\ncnt = (end - v) / L1_CACHE_BYTES;\r\nwhile (cnt >= 8) {\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\ncnt -= 8;\r\n}\r\nwhile (cnt) {\r\n__ocbi(v); v += L1_CACHE_BYTES;\r\ncnt--;\r\n}\r\n}\r\nvoid __init sh4__flush_region_init(void)\r\n{\r\n__flush_wback_region = sh4__flush_wback_region;\r\n__flush_invalidate_region = sh4__flush_invalidate_region;\r\n__flush_purge_region = sh4__flush_purge_region;\r\n}
