static unsigned long clk_sync_source_recalc_rate(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\r\nreturn sync->rate;\r\n}\r\nstatic long clk_sync_source_round_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long *prate)\r\n{\r\nstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\r\nif (rate > sync->max_rate)\r\nreturn -EINVAL;\r\nelse\r\nreturn rate;\r\n}\r\nstatic int clk_sync_source_set_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate)\r\n{\r\nstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\r\nsync->rate = rate;\r\nreturn 0;\r\n}\r\nstruct clk *tegra_clk_register_sync_source(const char *name,\r\nunsigned long rate, unsigned long max_rate)\r\n{\r\nstruct tegra_clk_sync_source *sync;\r\nstruct clk_init_data init;\r\nstruct clk *clk;\r\nsync = kzalloc(sizeof(*sync), GFP_KERNEL);\r\nif (!sync) {\r\npr_err("%s: could not allocate sync source clk\n", __func__);\r\nreturn ERR_PTR(-ENOMEM);\r\n}\r\nsync->rate = rate;\r\nsync->max_rate = max_rate;\r\ninit.ops = &tegra_clk_sync_source_ops;\r\ninit.name = name;\r\ninit.flags = CLK_IS_ROOT;\r\ninit.parent_names = NULL;\r\ninit.num_parents = 0;\r\nsync->hw.init = &init;\r\nclk = clk_register(NULL, &sync->hw);\r\nif (IS_ERR(clk))\r\nkfree(sync);\r\nreturn clk;\r\n}
