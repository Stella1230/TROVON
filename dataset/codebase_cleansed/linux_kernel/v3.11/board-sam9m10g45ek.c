static void __init ek_init_early(void)\r\n{\r\nat91_initialize(12000000);\r\n}\r\nstatic void __init ek_add_device_nand(void)\r\n{\r\nek_nand_data.bus_width_16 = board_have_nand_16bit();\r\nif (ek_nand_data.bus_width_16)\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_16;\r\nelse\r\nek_nand_smc_config.mode |= AT91_SMC_DBW_8;\r\nsam9_smc_configure(0, 3, &ek_nand_smc_config);\r\nat91_add_device_nand(&ek_nand_data);\r\n}\r\nstatic unsigned long isi_camera_query_bus_param(struct soc_camera_link *link)\r\n{\r\nreturn SOCAM_DATAWIDTH_8;\r\n}\r\nstatic int i2c_camera_power(struct device *dev, int on)\r\n{\r\npr_debug("%s: %s the camera\n", __func__, on ? "ENABLE" : "DISABLE");\r\nat91_set_gpio_output(AT91_PIN_PD13, !on);\r\nif (!on)\r\ngoto out;\r\nat91_set_gpio_output(AT91_PIN_PD12, 0);\r\nmsleep(20);\r\nat91_set_gpio_output(AT91_PIN_PD12, 1);\r\nmsleep(100);\r\nout:\r\nreturn 0;\r\n}\r\nstatic void __init ek_add_device_buttons(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(ek_buttons); i++) {\r\nat91_set_GPIO_periph(ek_buttons[i].gpio, 1);\r\nat91_set_deglitch(ek_buttons[i].gpio, 1);\r\n}\r\nplatform_device_register(&ek_button_device);\r\n}\r\nstatic void __init ek_add_device_buttons(void) {}\r\nstatic void __init ek_board_init(void)\r\n{\r\nat91_register_uart(0, 0, 0);\r\nat91_register_uart(AT91SAM9G45_ID_US1, 2, ATMEL_UART_CTS | ATMEL_UART_RTS);\r\nat91_add_device_serial();\r\nat91_add_device_usbh_ohci(&ek_usbh_hs_data);\r\nat91_add_device_usbh_ehci(&ek_usbh_hs_data);\r\nat91_add_device_usba(&ek_usba_udc_data);\r\nat91_add_device_spi(ek_spi_devices, ARRAY_SIZE(ek_spi_devices));\r\nat91_add_device_mci(0, &mci0_data);\r\nat91_add_device_mci(1, &mci1_data);\r\nat91_add_device_eth(&ek_macb_data);\r\nek_add_device_nand();\r\nat91_add_device_i2c(0, NULL, 0);\r\nat91_add_device_isi(&isi_data, true);\r\nat91_add_device_lcdc(&ek_lcdc_data);\r\nat91_add_device_tsadcc(&ek_tsadcc_data);\r\nat91_add_device_adc(&ek_adc_data);\r\nek_add_device_buttons();\r\nat91_add_device_ac97(&ek_ac97_data);\r\nat91_gpio_leds(ek_leds, ARRAY_SIZE(ek_leds));\r\nat91_pwm_leds(ek_pwm_led, ARRAY_SIZE(ek_pwm_led));\r\nplatform_add_devices(devices, ARRAY_SIZE(devices));\r\n}
