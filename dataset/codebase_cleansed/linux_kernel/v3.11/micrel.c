static int ksz_config_flags(struct phy_device *phydev)\r\n{\r\nint regval;\r\nif (phydev->dev_flags & MICREL_PHY_50MHZ_CLK) {\r\nregval = phy_read(phydev, MII_KSZPHY_CTRL);\r\nregval |= KSZ8051_RMII_50MHZ_CLK;\r\nreturn phy_write(phydev, MII_KSZPHY_CTRL, regval);\r\n}\r\nreturn 0;\r\n}\r\nstatic int kszphy_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint rc;\r\nrc = phy_read(phydev, MII_KSZPHY_INTCS);\r\nreturn (rc < 0) ? rc : 0;\r\n}\r\nstatic int kszphy_set_interrupt(struct phy_device *phydev)\r\n{\r\nint temp;\r\ntemp = (PHY_INTERRUPT_ENABLED == phydev->interrupts) ?\r\nKSZPHY_INTCS_ALL : 0;\r\nreturn phy_write(phydev, MII_KSZPHY_INTCS, temp);\r\n}\r\nstatic int kszphy_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KSZPHY_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int ksz9021_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KSZ9021_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int ks8737_config_intr(struct phy_device *phydev)\r\n{\r\nint temp, rc;\r\ntemp = phy_read(phydev, MII_KSZPHY_CTRL);\r\ntemp &= ~KS8737_CTRL_INT_ACTIVE_HIGH;\r\nphy_write(phydev, MII_KSZPHY_CTRL, temp);\r\nrc = kszphy_set_interrupt(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int kszphy_config_init(struct phy_device *phydev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int ksz8021_config_init(struct phy_device *phydev)\r\n{\r\nint rc;\r\nconst u16 val = KSZPHY_OMSO_B_CAST_OFF | KSZPHY_OMSO_RMII_OVERRIDE;\r\nphy_write(phydev, MII_KSZPHY_OMSO, val);\r\nrc = ksz_config_flags(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nstatic int ks8051_config_init(struct phy_device *phydev)\r\n{\r\nint rc;\r\nrc = ksz_config_flags(phydev);\r\nreturn rc < 0 ? rc : 0;\r\n}\r\nint ksz8873mll_read_status(struct phy_device *phydev)\r\n{\r\nint regval;\r\nregval = phy_read(phydev, KSZ8873MLL_GLOBAL_CONTROL_4);\r\nregval = phy_read(phydev, KSZ8873MLL_GLOBAL_CONTROL_4);\r\nif (regval & KSZ8873MLL_GLOBAL_CONTROL_4_DUPLEX)\r\nphydev->duplex = DUPLEX_HALF;\r\nelse\r\nphydev->duplex = DUPLEX_FULL;\r\nif (regval & KSZ8873MLL_GLOBAL_CONTROL_4_SPEED)\r\nphydev->speed = SPEED_10;\r\nelse\r\nphydev->speed = SPEED_100;\r\nphydev->link = 1;\r\nphydev->pause = phydev->asym_pause = 0;\r\nreturn 0;\r\n}\r\nstatic int ksz8873mll_config_aneg(struct phy_device *phydev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int __init ksphy_init(void)\r\n{\r\nreturn phy_drivers_register(ksphy_driver,\r\nARRAY_SIZE(ksphy_driver));\r\n}\r\nstatic void __exit ksphy_exit(void)\r\n{\r\nphy_drivers_unregister(ksphy_driver,\r\nARRAY_SIZE(ksphy_driver));\r\n}
