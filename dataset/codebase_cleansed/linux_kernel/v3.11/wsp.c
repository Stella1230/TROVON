static int __init wsp_probe_buses(void)\r\n{\r\nstatic __initdata struct of_device_id bus_ids[] = {\r\n{ .compatible = WSP_SOC_COMPATIBLE, },\r\n{ .compatible = PBIC_COMPATIBLE, },\r\n{ .compatible = COPRO_COMPATIBLE, },\r\n{},\r\n};\r\nof_platform_bus_probe(NULL, bus_ids, NULL);\r\nreturn 0;\r\n}\r\nvoid __init wsp_setup_arch(void)\r\n{\r\nloops_per_jiffy = 50000000;\r\nscom_init_wsp();\r\n#ifdef CONFIG_SMP\r\na2_setup_smp();\r\n#endif\r\n#ifdef CONFIG_PCI\r\nwsp_setup_pci();\r\n#endif\r\n}\r\nvoid __init wsp_setup_irq(void)\r\n{\r\nwsp_init_irq();\r\nopb_pic_init();\r\n}\r\nint __init wsp_probe_devices(void)\r\n{\r\nstruct device_node *np;\r\nnp = of_find_compatible_node(NULL, NULL, "dallas,ds1500");\r\nif (np != NULL) {\r\nstruct resource res;\r\nif (of_address_to_resource(np, 0, &res) == 0)\r\nplatform_device_register_simple("ds1511", 0, &res, 1);\r\n}\r\nwsp_probe_buses();\r\nreturn 0;\r\n}\r\nvoid wsp_halt(void)\r\n{\r\nu64 val;\r\nscom_map_t m;\r\nstruct device_node *dn;\r\nstruct device_node *mine;\r\nstruct device_node *me;\r\nme = of_get_cpu_node(smp_processor_id(), NULL);\r\nmine = scom_find_parent(me);\r\nfor_each_node_with_property(dn, "scom-controller") {\r\nif (dn == mine)\r\ncontinue;\r\nm = scom_map(dn, 0, 1);\r\nval = scom_read(m, 0);\r\nval |= 1;\r\nscom_write(m, 0, val);\r\nscom_unmap(m);\r\n}\r\nm = scom_map(mine, 0, 1);\r\nval = scom_read(m, 0);\r\nval |= 1;\r\nscom_write(m, 0, val);\r\nscom_unmap(m);\r\n}
