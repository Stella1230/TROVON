static void __init vexpress_sp810_init(void __iomem *base)\r\n{\r\nint i;\r\nif (WARN_ON(!base))\r\nreturn;\r\nfor (i = 0; i < ARRAY_SIZE(vexpress_sp810_timerclken); i++) {\r\nchar name[12];\r\nconst char *parents[] = {\r\n"v2m:refclk32khz",\r\n"v2m:refclk1mhz"\r\n};\r\nsnprintf(name, ARRAY_SIZE(name), "timerclken%d", i);\r\nvexpress_sp810_timerclken[i] = clk_register_mux(NULL, name,\r\nparents, 2, 0, base + SCCTRL,\r\nSCCTRL_TIMERENnSEL_SHIFT(i), 1,\r\n0, &vexpress_sp810_lock);\r\nif (WARN_ON(IS_ERR(vexpress_sp810_timerclken[i])))\r\nbreak;\r\n}\r\n}\r\nvoid __init vexpress_clk_init(void __iomem *sp810_base)\r\n{\r\nstruct clk *clk;\r\nint i;\r\nclk = clk_register_fixed_rate(NULL, "dummy_apb_pclk", NULL,\r\nCLK_IS_ROOT, 0);\r\nWARN_ON(clk_register_clkdev(clk, "apb_pclk", NULL));\r\nclk = clk_register_fixed_rate(NULL, "v2m:clk_24mhz", NULL,\r\nCLK_IS_ROOT, 24000000);\r\nfor (i = 0; i < ARRAY_SIZE(vexpress_clk_24mhz_periphs); i++)\r\nWARN_ON(clk_register_clkdev(clk, NULL,\r\nvexpress_clk_24mhz_periphs[i]));\r\nclk = clk_register_fixed_rate(NULL, "v2m:refclk32khz", NULL,\r\nCLK_IS_ROOT, 32768);\r\nWARN_ON(clk_register_clkdev(clk, NULL, "v2m:wdt"));\r\nclk = clk_register_fixed_rate(NULL, "v2m:refclk1mhz", NULL,\r\nCLK_IS_ROOT, 1000000);\r\nvexpress_sp810_init(sp810_base);\r\nfor (i = 0; i < ARRAY_SIZE(vexpress_sp810_timerclken); i++)\r\nWARN_ON(clk_set_parent(vexpress_sp810_timerclken[i], clk));\r\nWARN_ON(clk_register_clkdev(vexpress_sp810_timerclken[0],\r\n"v2m-timer0", "sp804"));\r\nWARN_ON(clk_register_clkdev(vexpress_sp810_timerclken[1],\r\n"v2m-timer1", "sp804"));\r\n}
