int main(int argc, char **argv)\r\n{\r\nint fd;\r\nint i, res, desc_size = 0;\r\nchar buf[256];\r\nstruct hidraw_report_descriptor rpt_desc;\r\nstruct hidraw_devinfo info;\r\nfd = open("/dev/hidraw0", O_RDWR|O_NONBLOCK);\r\nif (fd < 0) {\r\nperror("Unable to open device");\r\nreturn 1;\r\n}\r\nmemset(&rpt_desc, 0x0, sizeof(rpt_desc));\r\nmemset(&info, 0x0, sizeof(info));\r\nmemset(buf, 0x0, sizeof(buf));\r\nres = ioctl(fd, HIDIOCGRDESCSIZE, &desc_size);\r\nif (res < 0)\r\nperror("HIDIOCGRDESCSIZE");\r\nelse\r\nprintf("Report Descriptor Size: %d\n", desc_size);\r\nrpt_desc.size = desc_size;\r\nres = ioctl(fd, HIDIOCGRDESC, &rpt_desc);\r\nif (res < 0) {\r\nperror("HIDIOCGRDESC");\r\n} else {\r\nprintf("Report Descriptor:\n");\r\nfor (i = 0; i < rpt_desc.size; i++)\r\nprintf("%hhx ", rpt_desc.value[i]);\r\nputs("\n");\r\n}\r\nres = ioctl(fd, HIDIOCGRAWNAME(256), buf);\r\nif (res < 0)\r\nperror("HIDIOCGRAWNAME");\r\nelse\r\nprintf("Raw Name: %s\n", buf);\r\nres = ioctl(fd, HIDIOCGRAWPHYS(256), buf);\r\nif (res < 0)\r\nperror("HIDIOCGRAWPHYS");\r\nelse\r\nprintf("Raw Phys: %s\n", buf);\r\nres = ioctl(fd, HIDIOCGRAWINFO, &info);\r\nif (res < 0) {\r\nperror("HIDIOCGRAWINFO");\r\n} else {\r\nprintf("Raw Info:\n");\r\nprintf("\tbustype: %d (%s)\n",\r\ninfo.bustype, bus_str(info.bustype));\r\nprintf("\tvendor: 0x%04hx\n", info.vendor);\r\nprintf("\tproduct: 0x%04hx\n", info.product);\r\n}\r\nbuf[0] = 0x9;\r\nbuf[1] = 0xff;\r\nbuf[2] = 0xff;\r\nbuf[3] = 0xff;\r\nres = ioctl(fd, HIDIOCSFEATURE(4), buf);\r\nif (res < 0)\r\nperror("HIDIOCSFEATURE");\r\nelse\r\nprintf("ioctl HIDIOCGFEATURE returned: %d\n", res);\r\nbuf[0] = 0x9;\r\nres = ioctl(fd, HIDIOCGFEATURE(256), buf);\r\nif (res < 0) {\r\nperror("HIDIOCGFEATURE");\r\n} else {\r\nprintf("ioctl HIDIOCGFEATURE returned: %d\n", res);\r\nprintf("Report data (not containing the report number):\n\t");\r\nfor (i = 0; i < res; i++)\r\nprintf("%hhx ", buf[i]);\r\nputs("\n");\r\n}\r\nbuf[0] = 0x1;\r\nbuf[1] = 0x77;\r\nres = write(fd, buf, 2);\r\nif (res < 0) {\r\nprintf("Error: %d\n", errno);\r\nperror("write");\r\n} else {\r\nprintf("write() wrote %d bytes\n", res);\r\n}\r\nres = read(fd, buf, 16);\r\nif (res < 0) {\r\nperror("read");\r\n} else {\r\nprintf("read() read %d bytes:\n\t", res);\r\nfor (i = 0; i < res; i++)\r\nprintf("%hhx ", buf[i]);\r\nputs("\n");\r\n}\r\nclose(fd);\r\nreturn 0;\r\n}\r\nconst char *\r\nbus_str(int bus)\r\n{\r\nswitch (bus) {\r\ncase BUS_USB:\r\nreturn "USB";\r\nbreak;\r\ncase BUS_HIL:\r\nreturn "HIL";\r\nbreak;\r\ncase BUS_BLUETOOTH:\r\nreturn "Bluetooth";\r\nbreak;\r\ncase BUS_VIRTUAL:\r\nreturn "Virtual";\r\nbreak;\r\ndefault:\r\nreturn "Other";\r\nbreak;\r\n}\r\n}
