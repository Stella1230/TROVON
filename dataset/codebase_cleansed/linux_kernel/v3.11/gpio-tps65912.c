static int tps65912_gpio_get(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65912 *tps65912 = container_of(gc, struct tps65912, gpio);\r\nint val;\r\nval = tps65912_reg_read(tps65912, TPS65912_GPIO1 + offset);\r\nif (val & GPIO_STS_MASK)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic void tps65912_gpio_set(struct gpio_chip *gc, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65912 *tps65912 = container_of(gc, struct tps65912, gpio);\r\nif (value)\r\ntps65912_set_bits(tps65912, TPS65912_GPIO1 + offset,\r\nGPIO_SET_MASK);\r\nelse\r\ntps65912_clear_bits(tps65912, TPS65912_GPIO1 + offset,\r\nGPIO_SET_MASK);\r\n}\r\nstatic int tps65912_gpio_output(struct gpio_chip *gc, unsigned offset,\r\nint value)\r\n{\r\nstruct tps65912 *tps65912 = container_of(gc, struct tps65912, gpio);\r\ntps65912_gpio_set(gc, offset, value);\r\nreturn tps65912_set_bits(tps65912, TPS65912_GPIO1 + offset,\r\nGPIO_CFG_MASK);\r\n}\r\nstatic int tps65912_gpio_input(struct gpio_chip *gc, unsigned offset)\r\n{\r\nstruct tps65912 *tps65912 = container_of(gc, struct tps65912, gpio);\r\nreturn tps65912_clear_bits(tps65912, TPS65912_GPIO1 + offset,\r\nGPIO_CFG_MASK);\r\n}\r\nstatic int tps65912_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct tps65912 *tps65912 = dev_get_drvdata(pdev->dev.parent);\r\nstruct tps65912_board *pdata = tps65912->dev->platform_data;\r\nstruct tps65912_gpio_data *tps65912_gpio;\r\nint ret;\r\ntps65912_gpio = devm_kzalloc(&pdev->dev, sizeof(*tps65912_gpio),\r\nGFP_KERNEL);\r\nif (tps65912_gpio == NULL)\r\nreturn -ENOMEM;\r\ntps65912_gpio->tps65912 = tps65912;\r\ntps65912_gpio->gpio_chip = template_chip;\r\ntps65912_gpio->gpio_chip.dev = &pdev->dev;\r\nif (pdata && pdata->gpio_base)\r\ntps65912_gpio->gpio_chip.base = pdata->gpio_base;\r\nret = gpiochip_add(&tps65912_gpio->gpio_chip);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Failed to register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nplatform_set_drvdata(pdev, tps65912_gpio);\r\nreturn ret;\r\n}\r\nstatic int tps65912_gpio_remove(struct platform_device *pdev)\r\n{\r\nstruct tps65912_gpio_data *tps65912_gpio = platform_get_drvdata(pdev);\r\nreturn gpiochip_remove(&tps65912_gpio->gpio_chip);\r\n}\r\nstatic int __init tps65912_gpio_init(void)\r\n{\r\nreturn platform_driver_register(&tps65912_gpio_driver);\r\n}\r\nstatic void __exit tps65912_gpio_exit(void)\r\n{\r\nplatform_driver_unregister(&tps65912_gpio_driver);\r\n}
