static int __init br_init(void)\r\n{\r\nint err;\r\nerr = stp_proto_register(&br_stp_proto);\r\nif (err < 0) {\r\npr_err("bridge: can't register sap for STP\n");\r\nreturn err;\r\n}\r\nerr = br_fdb_init();\r\nif (err)\r\ngoto err_out;\r\nerr = register_pernet_subsys(&br_net_ops);\r\nif (err)\r\ngoto err_out1;\r\nerr = br_netfilter_init();\r\nif (err)\r\ngoto err_out2;\r\nerr = register_netdevice_notifier(&br_device_notifier);\r\nif (err)\r\ngoto err_out3;\r\nerr = br_netlink_init();\r\nif (err)\r\ngoto err_out4;\r\nbrioctl_set(br_ioctl_deviceless_stub);\r\n#if IS_ENABLED(CONFIG_ATM_LANE)\r\nbr_fdb_test_addr_hook = br_fdb_test_addr;\r\n#endif\r\nreturn 0;\r\nerr_out4:\r\nunregister_netdevice_notifier(&br_device_notifier);\r\nerr_out3:\r\nbr_netfilter_fini();\r\nerr_out2:\r\nunregister_pernet_subsys(&br_net_ops);\r\nerr_out1:\r\nbr_fdb_fini();\r\nerr_out:\r\nstp_proto_unregister(&br_stp_proto);\r\nreturn err;\r\n}\r\nstatic void __exit br_deinit(void)\r\n{\r\nstp_proto_unregister(&br_stp_proto);\r\nbr_netlink_fini();\r\nunregister_netdevice_notifier(&br_device_notifier);\r\nbrioctl_set(NULL);\r\nunregister_pernet_subsys(&br_net_ops);\r\nrcu_barrier();\r\nbr_netfilter_fini();\r\n#if IS_ENABLED(CONFIG_ATM_LANE)\r\nbr_fdb_test_addr_hook = NULL;\r\n#endif\r\nbr_fdb_fini();\r\n}
