int create_hw_obj(struct pci_dev *pci, enum CHIPTYP chip_type,\r\nenum CTCARDS model, struct hw **rhw)\r\n{\r\nint err;\r\nswitch (chip_type) {\r\ncase ATC20K1:\r\nerr = create_20k1_hw_obj(rhw);\r\nbreak;\r\ncase ATC20K2:\r\nerr = create_20k2_hw_obj(rhw);\r\nbreak;\r\ndefault:\r\nerr = -ENODEV;\r\nbreak;\r\n}\r\nif (err)\r\nreturn err;\r\n(*rhw)->pci = pci;\r\n(*rhw)->chip_type = chip_type;\r\n(*rhw)->model = model;\r\nreturn 0;\r\n}\r\nint destroy_hw_obj(struct hw *hw)\r\n{\r\nint err;\r\nswitch (hw->pci->device) {\r\ncase 0x0005:\r\nerr = destroy_20k1_hw_obj(hw);\r\nbreak;\r\ncase 0x000B:\r\nerr = destroy_20k2_hw_obj(hw);\r\nbreak;\r\ndefault:\r\nerr = -ENODEV;\r\nbreak;\r\n}\r\nreturn err;\r\n}\r\nunsigned int get_field(unsigned int data, unsigned int field)\r\n{\r\nint i;\r\nBUG_ON(!field);\r\nfor (i = 0; !(field & (1 << i)); )\r\ni++;\r\nreturn (data & field) >> i;\r\n}\r\nvoid set_field(unsigned int *data, unsigned int field, unsigned int value)\r\n{\r\nint i;\r\nBUG_ON(!field);\r\nfor (i = 0; !(field & (1 << i)); )\r\ni++;\r\n*data = (*data & (~field)) | ((value << i) & field);\r\n}
