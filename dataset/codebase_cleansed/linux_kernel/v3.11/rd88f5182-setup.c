void __init rd88f5182_pci_preinit(void)\r\n{\r\nint pin;\r\npin = RD88F5182_PCI_SLOT0_IRQ_A_PIN;\r\nif (gpio_request(pin, "PCI IntA") == 0) {\r\nif (gpio_direction_input(pin) == 0) {\r\nirq_set_irq_type(gpio_to_irq(pin), IRQ_TYPE_LEVEL_LOW);\r\n} else {\r\nprintk(KERN_ERR "rd88f5182_pci_preinit failed to "\r\n"set_irq_type pin %d\n", pin);\r\ngpio_free(pin);\r\n}\r\n} else {\r\nprintk(KERN_ERR "rd88f5182_pci_preinit failed to request gpio %d\n", pin);\r\n}\r\npin = RD88F5182_PCI_SLOT0_IRQ_B_PIN;\r\nif (gpio_request(pin, "PCI IntB") == 0) {\r\nif (gpio_direction_input(pin) == 0) {\r\nirq_set_irq_type(gpio_to_irq(pin), IRQ_TYPE_LEVEL_LOW);\r\n} else {\r\nprintk(KERN_ERR "rd88f5182_pci_preinit failed to "\r\n"set_irq_type pin %d\n", pin);\r\ngpio_free(pin);\r\n}\r\n} else {\r\nprintk(KERN_ERR "rd88f5182_pci_preinit failed to gpio_request %d\n", pin);\r\n}\r\n}\r\nstatic int __init rd88f5182_pci_map_irq(const struct pci_dev *dev, u8 slot,\r\nu8 pin)\r\n{\r\nint irq;\r\nirq = orion5x_pci_map_irq(dev, slot, pin);\r\nif (irq != -1)\r\nreturn irq;\r\nswitch (slot - RD88F5182_PCI_SLOT0_OFFS) {\r\ncase 0:\r\nif (pin == 1)\r\nreturn gpio_to_irq(RD88F5182_PCI_SLOT0_IRQ_A_PIN);\r\nelse\r\nreturn gpio_to_irq(RD88F5182_PCI_SLOT0_IRQ_B_PIN);\r\ndefault:\r\nreturn -1;\r\n}\r\n}\r\nstatic int __init rd88f5182_pci_init(void)\r\n{\r\nif (machine_is_rd88f5182())\r\npci_common_init(&rd88f5182_pci);\r\nreturn 0;\r\n}\r\nstatic void __init rd88f5182_init(void)\r\n{\r\norion5x_init();\r\norion5x_mpp_conf(rd88f5182_mpp_modes);\r\norion5x_ehci0_init();\r\norion5x_ehci1_init();\r\norion5x_eth_init(&rd88f5182_eth_data);\r\norion5x_i2c_init();\r\norion5x_sata_init(&rd88f5182_sata_data);\r\norion5x_uart0_init();\r\norion5x_xor_init();\r\nmvebu_mbus_add_window("devbus-boot", RD88F5182_NOR_BOOT_BASE,\r\nRD88F5182_NOR_BOOT_SIZE);\r\nmvebu_mbus_add_window("devbus-cs1", RD88F5182_NOR_BASE,\r\nRD88F5182_NOR_SIZE);\r\nplatform_device_register(&rd88f5182_nor_flash);\r\nplatform_device_register(&rd88f5182_gpio_leds);\r\ni2c_register_board_info(0, &rd88f5182_i2c_rtc, 1);\r\n}
