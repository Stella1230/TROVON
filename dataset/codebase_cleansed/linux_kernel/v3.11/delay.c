void __delay(unsigned long loops)\r\n{\r\n__asm__ __volatile__(\r\n".balign 8\n\t"\r\n"tst %0, %0\n\t"\r\n"1:\t"\r\n"bf/s 1b\n\t"\r\n" dt %0"\r\n: "=r" (loops)\r\n: "0" (loops)\r\n: "t");\r\n}\r\ninline void __const_udelay(unsigned long xloops)\r\n{\r\nxloops *= 4;\r\n__asm__("dmulu.l %0, %2\n\t"\r\n"sts mach, %0"\r\n: "=r" (xloops)\r\n: "0" (xloops),\r\n"r" (cpu_data[raw_smp_processor_id()].loops_per_jiffy * (HZ/4))\r\n: "macl", "mach");\r\n__delay(++xloops);\r\n}\r\nvoid __udelay(unsigned long usecs)\r\n{\r\n__const_udelay(usecs * 0x000010c6);\r\n}\r\nvoid __ndelay(unsigned long nsecs)\r\n{\r\n__const_udelay(nsecs * 0x00000005);\r\n}
