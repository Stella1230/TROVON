void vsock_addr_init(struct sockaddr_vm *addr, u32 cid, u32 port)\r\n{\r\nmemset(addr, 0, sizeof(*addr));\r\naddr->svm_family = AF_VSOCK;\r\naddr->svm_cid = cid;\r\naddr->svm_port = port;\r\n}\r\nint vsock_addr_validate(const struct sockaddr_vm *addr)\r\n{\r\nif (!addr)\r\nreturn -EFAULT;\r\nif (addr->svm_family != AF_VSOCK)\r\nreturn -EAFNOSUPPORT;\r\nif (addr->svm_zero[0] != 0)\r\nreturn -EINVAL;\r\nreturn 0;\r\n}\r\nbool vsock_addr_bound(const struct sockaddr_vm *addr)\r\n{\r\nreturn addr->svm_port != VMADDR_PORT_ANY;\r\n}\r\nvoid vsock_addr_unbind(struct sockaddr_vm *addr)\r\n{\r\nvsock_addr_init(addr, VMADDR_CID_ANY, VMADDR_PORT_ANY);\r\n}\r\nbool vsock_addr_equals_addr(const struct sockaddr_vm *addr,\r\nconst struct sockaddr_vm *other)\r\n{\r\nreturn addr->svm_cid == other->svm_cid &&\r\naddr->svm_port == other->svm_port;\r\n}\r\nint vsock_addr_cast(const struct sockaddr *addr,\r\nsize_t len, struct sockaddr_vm **out_addr)\r\n{\r\nif (len < sizeof(**out_addr))\r\nreturn -EFAULT;\r\n*out_addr = (struct sockaddr_vm *)addr;\r\nreturn vsock_addr_validate(*out_addr);\r\n}
