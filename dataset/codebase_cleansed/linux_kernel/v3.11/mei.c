static int microread_mei_probe(struct mei_cl_device *device,\r\nconst struct mei_cl_device_id *id)\r\n{\r\nstruct nfc_mei_phy *phy;\r\nint r;\r\npr_info("Probing NFC microread\n");\r\nphy = nfc_mei_phy_alloc(device);\r\nif (!phy) {\r\npr_err("Cannot allocate memory for microread mei phy.\n");\r\nreturn -ENOMEM;\r\n}\r\nr = microread_probe(phy, &mei_phy_ops, LLC_NOP_NAME,\r\nMEI_NFC_HEADER_SIZE, 0, MEI_NFC_MAX_HCI_PAYLOAD,\r\n&phy->hdev);\r\nif (r < 0) {\r\nnfc_mei_phy_free(phy);\r\nreturn r;\r\n}\r\nreturn 0;\r\n}\r\nstatic int microread_mei_remove(struct mei_cl_device *device)\r\n{\r\nstruct nfc_mei_phy *phy = mei_cl_get_drvdata(device);\r\npr_info("Removing microread\n");\r\nmicroread_remove(phy->hdev);\r\nnfc_mei_phy_free(phy);\r\nreturn 0;\r\n}\r\nstatic int microread_mei_init(void)\r\n{\r\nint r;\r\npr_debug(DRIVER_DESC ": %s\n", __func__);\r\nr = mei_cl_driver_register(&microread_driver);\r\nif (r) {\r\npr_err(MICROREAD_DRIVER_NAME ": driver registration failed\n");\r\nreturn r;\r\n}\r\nreturn 0;\r\n}\r\nstatic void microread_mei_exit(void)\r\n{\r\nmei_cl_driver_unregister(&microread_driver);\r\n}
