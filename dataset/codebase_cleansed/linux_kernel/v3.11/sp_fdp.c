ieee754sp ieee754sp_fdp(ieee754dp x)\r\n{\r\nCOMPXDP;\r\nieee754sp nan;\r\nEXPLODEXDP;\r\nCLEARCX;\r\nFLUSHXDP;\r\nswitch (xc) {\r\ncase IEEE754_CLASS_SNAN:\r\nSETCX(IEEE754_INVALID_OPERATION);\r\nreturn ieee754sp_nanxcpt(ieee754sp_indef(), "fdp");\r\ncase IEEE754_CLASS_QNAN:\r\nnan = buildsp(xs, SP_EMAX + 1 + SP_EBIAS, (u32)\r\n(xm >> (DP_MBITS - SP_MBITS)));\r\nif (!ieee754sp_isnan(nan))\r\nnan = ieee754sp_indef();\r\nreturn ieee754sp_nanxcpt(nan, "fdp", x);\r\ncase IEEE754_CLASS_INF:\r\nreturn ieee754sp_inf(xs);\r\ncase IEEE754_CLASS_ZERO:\r\nreturn ieee754sp_zero(xs);\r\ncase IEEE754_CLASS_DNORM:\r\nSETCX(IEEE754_UNDERFLOW);\r\nSETCX(IEEE754_INEXACT);\r\nif ((ieee754_csr.rm == IEEE754_RU && !xs) ||\r\n(ieee754_csr.rm == IEEE754_RD && xs))\r\nreturn ieee754sp_xcpt(ieee754sp_mind(xs), "fdp", x);\r\nreturn ieee754sp_xcpt(ieee754sp_zero(xs), "fdp", x);\r\ncase IEEE754_CLASS_NORM:\r\nbreak;\r\n}\r\n{\r\nu32 rm;\r\nrm = (xm >> (DP_MBITS - (SP_MBITS + 3))) |\r\n((xm << (64 - (DP_MBITS - (SP_MBITS + 3)))) != 0);\r\nSPNORMRET1(xs, xe, rm, "fdp", x);\r\n}\r\n}
