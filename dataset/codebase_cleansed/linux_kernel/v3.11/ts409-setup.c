static int __init qnap_ts409_pci_map_irq(const struct pci_dev *dev, u8 slot,\r\nu8 pin)\r\n{\r\nint irq;\r\nirq = orion5x_pci_map_irq(dev, slot, pin);\r\nif (irq != -1)\r\nreturn irq;\r\nreturn -1;\r\n}\r\nstatic int __init qnap_ts409_pci_init(void)\r\n{\r\nif (machine_is_ts409())\r\npci_common_init(&qnap_ts409_pci);\r\nreturn 0;\r\n}\r\nstatic void __init qnap_ts409_init(void)\r\n{\r\norion5x_init();\r\norion5x_mpp_conf(ts409_mpp_modes);\r\nmvebu_mbus_add_window("devbus-boot", QNAP_TS409_NOR_BOOT_BASE,\r\nQNAP_TS409_NOR_BOOT_SIZE);\r\nplatform_device_register(&qnap_ts409_nor_flash);\r\norion5x_ehci0_init();\r\nqnap_tsx09_find_mac_addr(QNAP_TS409_NOR_BOOT_BASE +\r\nqnap_ts409_partitions[5].offset,\r\nqnap_ts409_partitions[5].size);\r\norion5x_eth_init(&qnap_tsx09_eth_data);\r\norion5x_i2c_init();\r\norion5x_uart0_init();\r\norion5x_uart1_init();\r\nplatform_device_register(&qnap_ts409_button_device);\r\nif (gpio_request(TS409_RTC_GPIO, "rtc") == 0) {\r\nif (gpio_direction_input(TS409_RTC_GPIO) == 0)\r\nqnap_ts409_i2c_rtc.irq = gpio_to_irq(TS409_RTC_GPIO);\r\nelse\r\ngpio_free(TS409_RTC_GPIO);\r\n}\r\nif (qnap_ts409_i2c_rtc.irq == 0)\r\npr_warning("qnap_ts409_init: failed to get RTC IRQ\n");\r\ni2c_register_board_info(0, &qnap_ts409_i2c_rtc, 1);\r\nplatform_device_register(&ts409_leds);\r\npm_power_off = qnap_tsx09_power_off;\r\n}
