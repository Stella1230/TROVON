int transport_class_register(struct transport_class *tclass)\r\n{\r\nreturn class_register(&tclass->class);\r\n}\r\nvoid transport_class_unregister(struct transport_class *tclass)\r\n{\r\nclass_unregister(&tclass->class);\r\n}\r\nstatic int anon_transport_dummy_function(struct transport_container *tc,\r\nstruct device *dev,\r\nstruct device *cdev)\r\n{\r\nreturn 0;\r\n}\r\nint anon_transport_class_register(struct anon_transport_class *atc)\r\n{\r\nint error;\r\natc->container.class = &atc->tclass.class;\r\nattribute_container_set_no_classdevs(&atc->container);\r\nerror = attribute_container_register(&atc->container);\r\nif (error)\r\nreturn error;\r\natc->tclass.setup = anon_transport_dummy_function;\r\natc->tclass.remove = anon_transport_dummy_function;\r\nreturn 0;\r\n}\r\nvoid anon_transport_class_unregister(struct anon_transport_class *atc)\r\n{\r\nif (unlikely(attribute_container_unregister(&atc->container)))\r\nBUG();\r\n}\r\nstatic int transport_setup_classdev(struct attribute_container *cont,\r\nstruct device *dev,\r\nstruct device *classdev)\r\n{\r\nstruct transport_class *tclass = class_to_transport_class(cont->class);\r\nstruct transport_container *tcont = attribute_container_to_transport_container(cont);\r\nif (tclass->setup)\r\ntclass->setup(tcont, dev, classdev);\r\nreturn 0;\r\n}\r\nvoid transport_setup_device(struct device *dev)\r\n{\r\nattribute_container_add_device(dev, transport_setup_classdev);\r\n}\r\nstatic int transport_add_class_device(struct attribute_container *cont,\r\nstruct device *dev,\r\nstruct device *classdev)\r\n{\r\nint error = attribute_container_add_class_device(classdev);\r\nstruct transport_container *tcont =\r\nattribute_container_to_transport_container(cont);\r\nif (!error && tcont->statistics)\r\nerror = sysfs_create_group(&classdev->kobj, tcont->statistics);\r\nreturn error;\r\n}\r\nvoid transport_add_device(struct device *dev)\r\n{\r\nattribute_container_device_trigger(dev, transport_add_class_device);\r\n}\r\nstatic int transport_configure(struct attribute_container *cont,\r\nstruct device *dev,\r\nstruct device *cdev)\r\n{\r\nstruct transport_class *tclass = class_to_transport_class(cont->class);\r\nstruct transport_container *tcont = attribute_container_to_transport_container(cont);\r\nif (tclass->configure)\r\ntclass->configure(tcont, dev, cdev);\r\nreturn 0;\r\n}\r\nvoid transport_configure_device(struct device *dev)\r\n{\r\nattribute_container_device_trigger(dev, transport_configure);\r\n}\r\nstatic int transport_remove_classdev(struct attribute_container *cont,\r\nstruct device *dev,\r\nstruct device *classdev)\r\n{\r\nstruct transport_container *tcont =\r\nattribute_container_to_transport_container(cont);\r\nstruct transport_class *tclass = class_to_transport_class(cont->class);\r\nif (tclass->remove)\r\ntclass->remove(tcont, dev, classdev);\r\nif (tclass->remove != anon_transport_dummy_function) {\r\nif (tcont->statistics)\r\nsysfs_remove_group(&classdev->kobj, tcont->statistics);\r\nattribute_container_class_device_del(classdev);\r\n}\r\nreturn 0;\r\n}\r\nvoid transport_remove_device(struct device *dev)\r\n{\r\nattribute_container_device_trigger(dev, transport_remove_classdev);\r\n}\r\nstatic void transport_destroy_classdev(struct attribute_container *cont,\r\nstruct device *dev,\r\nstruct device *classdev)\r\n{\r\nstruct transport_class *tclass = class_to_transport_class(cont->class);\r\nif (tclass->remove != anon_transport_dummy_function)\r\nput_device(classdev);\r\n}\r\nvoid transport_destroy_device(struct device *dev)\r\n{\r\nattribute_container_remove_device(dev, transport_destroy_classdev);\r\n}
