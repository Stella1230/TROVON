static int mc13xxx_i2c_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct mc13xxx *mc13xxx;\r\nstruct mc13xxx_platform_data *pdata = dev_get_platdata(&client->dev);\r\nint ret;\r\nmc13xxx = devm_kzalloc(&client->dev, sizeof(*mc13xxx), GFP_KERNEL);\r\nif (!mc13xxx)\r\nreturn -ENOMEM;\r\ndev_set_drvdata(&client->dev, mc13xxx);\r\nmc13xxx->dev = &client->dev;\r\nmutex_init(&mc13xxx->lock);\r\nmc13xxx->regmap = devm_regmap_init_i2c(client,\r\n&mc13xxx_regmap_i2c_config);\r\nif (IS_ERR(mc13xxx->regmap)) {\r\nret = PTR_ERR(mc13xxx->regmap);\r\ndev_err(mc13xxx->dev, "Failed to initialize register map: %d\n",\r\nret);\r\ndev_set_drvdata(&client->dev, NULL);\r\nreturn ret;\r\n}\r\nif (client->dev.of_node) {\r\nconst struct of_device_id *of_id =\r\nof_match_device(mc13xxx_dt_ids, &client->dev);\r\nmc13xxx->variant = of_id->data;\r\n} else {\r\nmc13xxx->variant = (void *)id->driver_data;\r\n}\r\nret = mc13xxx_common_init(mc13xxx, pdata, client->irq);\r\nreturn ret;\r\n}\r\nstatic int mc13xxx_i2c_remove(struct i2c_client *client)\r\n{\r\nstruct mc13xxx *mc13xxx = dev_get_drvdata(&client->dev);\r\nmc13xxx_common_cleanup(mc13xxx);\r\nreturn 0;\r\n}\r\nstatic int __init mc13xxx_i2c_init(void)\r\n{\r\nreturn i2c_add_driver(&mc13xxx_i2c_driver);\r\n}\r\nstatic void __exit mc13xxx_i2c_exit(void)\r\n{\r\ni2c_del_driver(&mc13xxx_i2c_driver);\r\n}
