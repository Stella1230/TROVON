static void fpu_begin(void)\r\n{\r\nkernel_fpu_begin();\r\n}\r\nstatic void fpu_end(void)\r\n{\r\nkernel_fpu_end();\r\n}\r\nstatic irqreturn_t v_ADDI_Interrupt(int irq, void *d)\r\n{\r\nv_APCI1710_Interrupt(irq, d);\r\nreturn IRQ_RETVAL(1);\r\n}\r\nstatic int apci1710_auto_attach(struct comedi_device *dev,\r\nunsigned long context_unused)\r\n{\r\nstruct pci_dev *pcidev = comedi_to_pci_dev(dev);\r\nstruct addi_private *devpriv;\r\nstruct comedi_subdevice *s;\r\nint ret;\r\ndevpriv = kzalloc(sizeof(*devpriv), GFP_KERNEL);\r\nif (!devpriv)\r\nreturn -ENOMEM;\r\ndev->private = devpriv;\r\nret = comedi_pci_enable(dev);\r\nif (ret)\r\nreturn ret;\r\ndevpriv->s_BoardInfos.ui_Address = pci_resource_start(pcidev, 2);\r\nif (pcidev->irq > 0) {\r\nret = request_irq(pcidev->irq, v_ADDI_Interrupt, IRQF_SHARED,\r\ndev->board_name, dev);\r\nif (ret == 0)\r\ndev->irq = pcidev->irq;\r\n}\r\ni_ADDI_AttachPCI1710(dev);\r\ni_APCI1710_Reset(dev);\r\nreturn 0;\r\n}\r\nstatic void apci1710_detach(struct comedi_device *dev)\r\n{\r\nif (dev->iobase)\r\ni_APCI1710_Reset(dev);\r\nif (dev->irq)\r\nfree_irq(dev->irq, dev);\r\ncomedi_pci_disable(dev);\r\n}\r\nstatic int apci1710_pci_probe(struct pci_dev *dev,\r\nconst struct pci_device_id *id)\r\n{\r\nreturn comedi_pci_auto_config(dev, &apci1710_driver, id->driver_data);\r\n}
