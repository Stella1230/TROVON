static void imx_anatop_enable_weak2p5(bool enable)\r\n{\r\nu32 reg, val;\r\nregmap_read(anatop, ANADIG_ANA_MISC0, &val);\r\nreg = ANADIG_REG_2P5;\r\nreg += (enable && (val & BM_ANADIG_ANA_MISC0_STOP_MODE_CONFIG) == 0) ?\r\nREG_SET : REG_CLR;\r\nregmap_write(anatop, reg, BM_ANADIG_REG_2P5_ENABLE_WEAK_LINREG);\r\n}\r\nstatic void imx_anatop_enable_fet_odrive(bool enable)\r\n{\r\nregmap_write(anatop, ANADIG_REG_CORE + (enable ? REG_SET : REG_CLR),\r\nBM_ANADIG_REG_CORE_FET_ODRIVE);\r\n}\r\nvoid imx_anatop_pre_suspend(void)\r\n{\r\nimx_anatop_enable_weak2p5(true);\r\nimx_anatop_enable_fet_odrive(true);\r\n}\r\nvoid imx_anatop_post_resume(void)\r\n{\r\nimx_anatop_enable_fet_odrive(false);\r\nimx_anatop_enable_weak2p5(false);\r\n}\r\nvoid imx_anatop_usb_chrg_detect_disable(void)\r\n{\r\nregmap_write(anatop, ANADIG_USB1_CHRG_DETECT,\r\nBM_ANADIG_USB_CHRG_DETECT_EN_B\r\n| BM_ANADIG_USB_CHRG_DETECT_CHK_CHRG_B);\r\nregmap_write(anatop, ANADIG_USB2_CHRG_DETECT,\r\nBM_ANADIG_USB_CHRG_DETECT_EN_B |\r\nBM_ANADIG_USB_CHRG_DETECT_CHK_CHRG_B);\r\n}\r\nu32 imx_anatop_get_digprog(void)\r\n{\r\nstruct device_node *np;\r\nvoid __iomem *anatop_base;\r\nstatic u32 digprog;\r\nif (digprog)\r\nreturn digprog;\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,imx6q-anatop");\r\nanatop_base = of_iomap(np, 0);\r\nWARN_ON(!anatop_base);\r\ndigprog = readl_relaxed(anatop_base + ANADIG_DIGPROG);\r\nreturn digprog;\r\n}\r\nvoid __init imx_anatop_init(void)\r\n{\r\nanatop = syscon_regmap_lookup_by_compatible("fsl,imx6q-anatop");\r\nif (IS_ERR(anatop)) {\r\npr_err("%s: failed to find imx6q-anatop regmap!\n", __func__);\r\nreturn;\r\n}\r\n}
