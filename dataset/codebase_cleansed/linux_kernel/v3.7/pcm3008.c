static void pcm3008_gpio_free(struct pcm3008_setup_data *setup)\r\n{\r\ngpio_free(setup->dem0_pin);\r\ngpio_free(setup->dem1_pin);\r\ngpio_free(setup->pdad_pin);\r\ngpio_free(setup->pdda_pin);\r\n}\r\nstatic int pcm3008_soc_probe(struct snd_soc_codec *codec)\r\n{\r\nstruct pcm3008_setup_data *setup = codec->dev->platform_data;\r\nint ret = 0;\r\nprintk(KERN_INFO "PCM3008 SoC Audio Codec %s\n", PCM3008_VERSION);\r\nret = gpio_request(setup->dem0_pin, "codec_dem0");\r\nif (ret == 0)\r\nret = gpio_direction_output(setup->dem0_pin, 1);\r\nif (ret != 0)\r\ngoto gpio_err;\r\nret = gpio_request(setup->dem1_pin, "codec_dem1");\r\nif (ret == 0)\r\nret = gpio_direction_output(setup->dem1_pin, 0);\r\nif (ret != 0)\r\ngoto gpio_err;\r\nret = gpio_request(setup->pdad_pin, "codec_pdad");\r\nif (ret == 0)\r\nret = gpio_direction_output(setup->pdad_pin, 1);\r\nif (ret != 0)\r\ngoto gpio_err;\r\nret = gpio_request(setup->pdda_pin, "codec_pdda");\r\nif (ret == 0)\r\nret = gpio_direction_output(setup->pdda_pin, 1);\r\nif (ret != 0)\r\ngoto gpio_err;\r\nreturn ret;\r\ngpio_err:\r\npcm3008_gpio_free(setup);\r\nreturn ret;\r\n}\r\nstatic int pcm3008_soc_remove(struct snd_soc_codec *codec)\r\n{\r\nstruct pcm3008_setup_data *setup = codec->dev->platform_data;\r\npcm3008_gpio_free(setup);\r\nreturn 0;\r\n}\r\nstatic int pcm3008_soc_suspend(struct snd_soc_codec *codec)\r\n{\r\nstruct pcm3008_setup_data *setup = codec->dev->platform_data;\r\ngpio_set_value(setup->pdad_pin, 0);\r\ngpio_set_value(setup->pdda_pin, 0);\r\nreturn 0;\r\n}\r\nstatic int pcm3008_soc_resume(struct snd_soc_codec *codec)\r\n{\r\nstruct pcm3008_setup_data *setup = codec->dev->platform_data;\r\ngpio_set_value(setup->pdad_pin, 1);\r\ngpio_set_value(setup->pdda_pin, 1);\r\nreturn 0;\r\n}\r\nstatic int __devinit pcm3008_codec_probe(struct platform_device *pdev)\r\n{\r\nreturn snd_soc_register_codec(&pdev->dev,\r\n&soc_codec_dev_pcm3008, &pcm3008_dai, 1);\r\n}\r\nstatic int __devexit pcm3008_codec_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_codec(&pdev->dev);\r\nreturn 0;\r\n}
