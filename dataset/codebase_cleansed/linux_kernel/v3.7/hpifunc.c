u32 hpi_indexes_to_handle(const char c_object, const u16 adapter_index,\r\nconst u16 object_index)\r\n{\r\nunion handle_word handle;\r\nhandle.h.adapter_index = adapter_index;\r\nhandle.h.spare = 0;\r\nhandle.h.read_only = 0;\r\nhandle.h.obj_type = c_object;\r\nhandle.h.obj_index = object_index;\r\nreturn handle.w;\r\n}\r\nstatic u16 hpi_handle_indexes(const u32 h, u16 *p1, u16 *p2)\r\n{\r\nunion handle_word uhandle;\r\nif (!h)\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nuhandle.w = h;\r\n*p1 = (u16)uhandle.h.adapter_index;\r\nif (p2)\r\n*p2 = (u16)uhandle.h.obj_index;\r\nreturn 0;\r\n}\r\nvoid hpi_handle_to_indexes(const u32 handle, u16 *pw_adapter_index,\r\nu16 *pw_object_index)\r\n{\r\nhpi_handle_indexes(handle, pw_adapter_index, pw_object_index);\r\n}\r\nchar hpi_handle_object(const u32 handle)\r\n{\r\nunion handle_word uhandle;\r\nuhandle.w = handle;\r\nreturn (char)uhandle.h.obj_type;\r\n}\r\nvoid hpi_format_to_msg(struct hpi_msg_format *pMF,\r\nconst struct hpi_format *pF)\r\n{\r\npMF->sample_rate = pF->sample_rate;\r\npMF->bit_rate = pF->bit_rate;\r\npMF->attributes = pF->attributes;\r\npMF->channels = pF->channels;\r\npMF->format = pF->format;\r\n}\r\nstatic void hpi_msg_to_format(struct hpi_format *pF,\r\nstruct hpi_msg_format *pMF)\r\n{\r\npF->sample_rate = pMF->sample_rate;\r\npF->bit_rate = pMF->bit_rate;\r\npF->attributes = pMF->attributes;\r\npF->channels = pMF->channels;\r\npF->format = pMF->format;\r\npF->mode_legacy = 0;\r\npF->unused = 0;\r\n}\r\nvoid hpi_stream_response_to_legacy(struct hpi_stream_res *pSR)\r\n{\r\npSR->u.legacy_stream_info.auxiliary_data_available =\r\npSR->u.stream_info.auxiliary_data_available;\r\npSR->u.legacy_stream_info.state = pSR->u.stream_info.state;\r\n}\r\nstatic inline void hpi_send_recvV1(struct hpi_message_header *m,\r\nstruct hpi_response_header *r)\r\n{\r\nhpi_send_recv((struct hpi_message *)m, (struct hpi_response *)r);\r\n}\r\nu16 hpi_subsys_get_version_ex(u32 *pversion_ex)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_SUBSYSTEM,\r\nHPI_SUBSYS_GET_VERSION);\r\nhpi_send_recv(&hm, &hr);\r\n*pversion_ex = hr.u.s.data;\r\nreturn hr.error;\r\n}\r\nu16 hpi_subsys_get_num_adapters(int *pn_num_adapters)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_SUBSYSTEM,\r\nHPI_SUBSYS_GET_NUM_ADAPTERS);\r\nhpi_send_recv(&hm, &hr);\r\n*pn_num_adapters = (int)hr.u.s.num_adapters;\r\nreturn hr.error;\r\n}\r\nu16 hpi_subsys_get_adapter(int iterator, u32 *padapter_index,\r\nu16 *pw_adapter_type)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_SUBSYSTEM,\r\nHPI_SUBSYS_GET_ADAPTER);\r\nhm.obj_index = (u16)iterator;\r\nhpi_send_recv(&hm, &hr);\r\n*padapter_index = (int)hr.u.s.adapter_index;\r\n*pw_adapter_type = hr.u.s.adapter_type;\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_open(u16 adapter_index)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_OPEN);\r\nhm.adapter_index = adapter_index;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_close(u16 adapter_index)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_CLOSE);\r\nhm.adapter_index = adapter_index;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_set_mode(u16 adapter_index, u32 adapter_mode)\r\n{\r\nreturn hpi_adapter_set_mode_ex(adapter_index, adapter_mode,\r\nHPI_ADAPTER_MODE_SET);\r\n}\r\nu16 hpi_adapter_set_mode_ex(u16 adapter_index, u32 adapter_mode,\r\nu16 query_or_set)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_SET_MODE);\r\nhm.adapter_index = adapter_index;\r\nhm.u.ax.mode.adapter_mode = adapter_mode;\r\nhm.u.ax.mode.query_or_set = query_or_set;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_get_mode(u16 adapter_index, u32 *padapter_mode)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_GET_MODE);\r\nhm.adapter_index = adapter_index;\r\nhpi_send_recv(&hm, &hr);\r\nif (padapter_mode)\r\n*padapter_mode = hr.u.ax.mode.adapter_mode;\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_get_info(u16 adapter_index, u16 *pw_num_outstreams,\r\nu16 *pw_num_instreams, u16 *pw_version, u32 *pserial_number,\r\nu16 *pw_adapter_type)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_GET_INFO);\r\nhm.adapter_index = adapter_index;\r\nhpi_send_recv(&hm, &hr);\r\n*pw_adapter_type = hr.u.ax.info.adapter_type;\r\n*pw_num_outstreams = hr.u.ax.info.num_outstreams;\r\n*pw_num_instreams = hr.u.ax.info.num_instreams;\r\n*pw_version = hr.u.ax.info.version;\r\n*pserial_number = hr.u.ax.info.serial_number;\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_get_module_by_index(u16 adapter_index, u16 module_index,\r\nu16 *pw_num_outputs, u16 *pw_num_inputs, u16 *pw_version,\r\nu32 *pserial_number, u16 *pw_module_type, u32 *ph_module)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_MODULE_INFO);\r\nhm.adapter_index = adapter_index;\r\nhm.u.ax.module_info.index = module_index;\r\nhpi_send_recv(&hm, &hr);\r\n*pw_module_type = hr.u.ax.info.adapter_type;\r\n*pw_num_outputs = hr.u.ax.info.num_outstreams;\r\n*pw_num_inputs = hr.u.ax.info.num_instreams;\r\n*pw_version = hr.u.ax.info.version;\r\n*pserial_number = hr.u.ax.info.serial_number;\r\n*ph_module = 0;\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_set_property(u16 adapter_index, u16 property, u16 parameter1,\r\nu16 parameter2)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_SET_PROPERTY);\r\nhm.adapter_index = adapter_index;\r\nhm.u.ax.property_set.property = property;\r\nhm.u.ax.property_set.parameter1 = parameter1;\r\nhm.u.ax.property_set.parameter2 = parameter2;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_get_property(u16 adapter_index, u16 property,\r\nu16 *pw_parameter1, u16 *pw_parameter2)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ADAPTER,\r\nHPI_ADAPTER_GET_PROPERTY);\r\nhm.adapter_index = adapter_index;\r\nhm.u.ax.property_set.property = property;\r\nhpi_send_recv(&hm, &hr);\r\nif (!hr.error) {\r\nif (pw_parameter1)\r\n*pw_parameter1 = hr.u.ax.property_get.parameter1;\r\nif (pw_parameter2)\r\n*pw_parameter2 = hr.u.ax.property_get.parameter2;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_adapter_enumerate_property(u16 adapter_index, u16 index,\r\nu16 what_to_enumerate, u16 property_index, u32 *psetting)\r\n{\r\nreturn 0;\r\n}\r\nu16 hpi_format_create(struct hpi_format *p_format, u16 channels, u16 format,\r\nu32 sample_rate, u32 bit_rate, u32 attributes)\r\n{\r\nu16 err = 0;\r\nstruct hpi_msg_format fmt;\r\nswitch (channels) {\r\ncase 1:\r\ncase 2:\r\ncase 4:\r\ncase 6:\r\ncase 8:\r\ncase 16:\r\nbreak;\r\ndefault:\r\nerr = HPI_ERROR_INVALID_CHANNELS;\r\nreturn err;\r\n}\r\nfmt.channels = channels;\r\nswitch (format) {\r\ncase HPI_FORMAT_PCM16_SIGNED:\r\ncase HPI_FORMAT_PCM24_SIGNED:\r\ncase HPI_FORMAT_PCM32_SIGNED:\r\ncase HPI_FORMAT_PCM32_FLOAT:\r\ncase HPI_FORMAT_PCM16_BIGENDIAN:\r\ncase HPI_FORMAT_PCM8_UNSIGNED:\r\ncase HPI_FORMAT_MPEG_L1:\r\ncase HPI_FORMAT_MPEG_L2:\r\ncase HPI_FORMAT_MPEG_L3:\r\ncase HPI_FORMAT_DOLBY_AC2:\r\ncase HPI_FORMAT_AA_TAGIT1_HITS:\r\ncase HPI_FORMAT_AA_TAGIT1_INSERTS:\r\ncase HPI_FORMAT_RAW_BITSTREAM:\r\ncase HPI_FORMAT_AA_TAGIT1_HITS_EX1:\r\ncase HPI_FORMAT_OEM1:\r\ncase HPI_FORMAT_OEM2:\r\nbreak;\r\ndefault:\r\nerr = HPI_ERROR_INVALID_FORMAT;\r\nreturn err;\r\n}\r\nfmt.format = format;\r\nif (sample_rate < 8000L) {\r\nerr = HPI_ERROR_INCOMPATIBLE_SAMPLERATE;\r\nsample_rate = 8000L;\r\n}\r\nif (sample_rate > 200000L) {\r\nerr = HPI_ERROR_INCOMPATIBLE_SAMPLERATE;\r\nsample_rate = 200000L;\r\n}\r\nfmt.sample_rate = sample_rate;\r\nswitch (format) {\r\ncase HPI_FORMAT_MPEG_L1:\r\ncase HPI_FORMAT_MPEG_L2:\r\ncase HPI_FORMAT_MPEG_L3:\r\nfmt.bit_rate = bit_rate;\r\nbreak;\r\ncase HPI_FORMAT_PCM16_SIGNED:\r\ncase HPI_FORMAT_PCM16_BIGENDIAN:\r\nfmt.bit_rate = channels * sample_rate * 2;\r\nbreak;\r\ncase HPI_FORMAT_PCM32_SIGNED:\r\ncase HPI_FORMAT_PCM32_FLOAT:\r\nfmt.bit_rate = channels * sample_rate * 4;\r\nbreak;\r\ncase HPI_FORMAT_PCM8_UNSIGNED:\r\nfmt.bit_rate = channels * sample_rate;\r\nbreak;\r\ndefault:\r\nfmt.bit_rate = 0;\r\n}\r\nswitch (format) {\r\ncase HPI_FORMAT_MPEG_L2:\r\nif ((channels == 1)\r\n&& (attributes != HPI_MPEG_MODE_DEFAULT)) {\r\nattributes = HPI_MPEG_MODE_DEFAULT;\r\nerr = HPI_ERROR_INVALID_FORMAT;\r\n} else if (attributes > HPI_MPEG_MODE_DUALCHANNEL) {\r\nattributes = HPI_MPEG_MODE_DEFAULT;\r\nerr = HPI_ERROR_INVALID_FORMAT;\r\n}\r\nfmt.attributes = attributes;\r\nbreak;\r\ndefault:\r\nfmt.attributes = attributes;\r\n}\r\nhpi_msg_to_format(p_format, &fmt);\r\nreturn err;\r\n}\r\nu16 hpi_stream_estimate_buffer_size(struct hpi_format *p_format,\r\nu32 host_polling_rate_in_milli_seconds, u32 *recommended_buffer_size)\r\n{\r\nu32 bytes_per_second;\r\nu32 size;\r\nu16 channels;\r\nstruct hpi_format *pF = p_format;\r\nchannels = pF->channels;\r\nswitch (pF->format) {\r\ncase HPI_FORMAT_PCM16_BIGENDIAN:\r\ncase HPI_FORMAT_PCM16_SIGNED:\r\nbytes_per_second = pF->sample_rate * 2L * channels;\r\nbreak;\r\ncase HPI_FORMAT_PCM24_SIGNED:\r\nbytes_per_second = pF->sample_rate * 3L * channels;\r\nbreak;\r\ncase HPI_FORMAT_PCM32_SIGNED:\r\ncase HPI_FORMAT_PCM32_FLOAT:\r\nbytes_per_second = pF->sample_rate * 4L * channels;\r\nbreak;\r\ncase HPI_FORMAT_PCM8_UNSIGNED:\r\nbytes_per_second = pF->sample_rate * 1L * channels;\r\nbreak;\r\ncase HPI_FORMAT_MPEG_L1:\r\ncase HPI_FORMAT_MPEG_L2:\r\ncase HPI_FORMAT_MPEG_L3:\r\nbytes_per_second = pF->bit_rate / 8L;\r\nbreak;\r\ncase HPI_FORMAT_DOLBY_AC2:\r\nbytes_per_second = 256000L / 8L;\r\nbreak;\r\ndefault:\r\nreturn HPI_ERROR_INVALID_FORMAT;\r\n}\r\nsize = (bytes_per_second * host_polling_rate_in_milli_seconds * 2) /\r\n1000L;\r\n*recommended_buffer_size =\r\nroundup_pow_of_two(((size + 4095L) & ~4095L));\r\nreturn 0;\r\n}\r\nu16 hpi_outstream_open(u16 adapter_index, u16 outstream_index,\r\nu32 *ph_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_OPEN);\r\nhm.adapter_index = adapter_index;\r\nhm.obj_index = outstream_index;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0)\r\n*ph_outstream =\r\nhpi_indexes_to_handle(HPI_OBJ_OSTREAM, adapter_index,\r\noutstream_index);\r\nelse\r\n*ph_outstream = 0;\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_close(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_HOSTBUFFER_FREE);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_GROUP_RESET);\r\nhpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index);\r\nhpi_send_recv(&hm, &hr);\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_CLOSE);\r\nhpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_get_info_ex(u32 h_outstream, u16 *pw_state,\r\nu32 *pbuffer_size, u32 *pdata_to_play, u32 *psamples_played,\r\nu32 *pauxiliary_data_to_play)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_GET_INFO);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_state)\r\n*pw_state = hr.u.d.u.stream_info.state;\r\nif (pbuffer_size)\r\n*pbuffer_size = hr.u.d.u.stream_info.buffer_size;\r\nif (pdata_to_play)\r\n*pdata_to_play = hr.u.d.u.stream_info.data_available;\r\nif (psamples_played)\r\n*psamples_played = hr.u.d.u.stream_info.samples_transferred;\r\nif (pauxiliary_data_to_play)\r\n*pauxiliary_data_to_play =\r\nhr.u.d.u.stream_info.auxiliary_data_available;\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_write_buf(u32 h_outstream, const u8 *pb_data,\r\nu32 bytes_to_write, const struct hpi_format *p_format)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_WRITE);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.pb_data = (u8 *)pb_data;\r\nhm.u.d.u.data.data_size = bytes_to_write;\r\nhpi_format_to_msg(&hm.u.d.u.data.format, p_format);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_start(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_START);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_wait_start(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_WAIT_START);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_stop(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_STOP);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_sinegen(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_SINEGEN);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_reset(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_RESET);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_query_format(u32 h_outstream, struct hpi_format *p_format)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_QUERY_FORMAT);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_format_to_msg(&hm.u.d.u.data.format, p_format);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_set_format(u32 h_outstream, struct hpi_format *p_format)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_SET_FORMAT);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_format_to_msg(&hm.u.d.u.data.format, p_format);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_set_velocity(u32 h_outstream, short velocity)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_SET_VELOCITY);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.velocity = velocity;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_set_punch_in_out(u32 h_outstream, u32 punch_in_sample,\r\nu32 punch_out_sample)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_SET_PUNCHINOUT);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.pio.punch_in_sample = punch_in_sample;\r\nhm.u.d.u.pio.punch_out_sample = punch_out_sample;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_ancillary_reset(u32 h_outstream, u16 mode)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_ANC_RESET);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.format.channels = mode;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_ancillary_get_info(u32 h_outstream, u32 *pframes_available)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_ANC_GET_INFO);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0) {\r\nif (pframes_available)\r\n*pframes_available =\r\nhr.u.d.u.stream_info.data_available /\r\nsizeof(struct hpi_anc_frame);\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_ancillary_read(u32 h_outstream,\r\nstruct hpi_anc_frame *p_anc_frame_buffer,\r\nu32 anc_frame_buffer_size_in_bytes,\r\nu32 number_of_ancillary_frames_to_read)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_ANC_READ);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.pb_data = (u8 *)p_anc_frame_buffer;\r\nhm.u.d.u.data.data_size =\r\nnumber_of_ancillary_frames_to_read *\r\nsizeof(struct hpi_anc_frame);\r\nif (hm.u.d.u.data.data_size <= anc_frame_buffer_size_in_bytes)\r\nhpi_send_recv(&hm, &hr);\r\nelse\r\nhr.error = HPI_ERROR_INVALID_DATASIZE;\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_set_time_scale(u32 h_outstream, u32 time_scale)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_SET_TIMESCALE);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.time_scale = time_scale;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_host_buffer_allocate(u32 h_outstream, u32 size_in_bytes)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_HOSTBUFFER_ALLOC);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.data_size = size_in_bytes;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_host_buffer_get_info(u32 h_outstream, u8 **pp_buffer,\r\nstruct hpi_hostbuffer_status **pp_status)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_HOSTBUFFER_GET_INFO);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0) {\r\nif (pp_buffer)\r\n*pp_buffer = hr.u.d.u.hostbuffer_info.p_buffer;\r\nif (pp_status)\r\n*pp_status = hr.u.d.u.hostbuffer_info.p_status;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_host_buffer_free(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_HOSTBUFFER_FREE);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_group_add(u32 h_outstream, u32 h_stream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nu16 adapter;\r\nchar c_obj_type;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_GROUP_ADD);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nif (hpi_handle_indexes(h_stream, &adapter,\r\n&hm.u.d.u.stream.stream_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nc_obj_type = hpi_handle_object(h_stream);\r\nswitch (c_obj_type) {\r\ncase HPI_OBJ_OSTREAM:\r\ncase HPI_OBJ_ISTREAM:\r\nhm.u.d.u.stream.object_type = c_obj_type;\r\nbreak;\r\ndefault:\r\nreturn HPI_ERROR_INVALID_OBJ;\r\n}\r\nif (adapter != hm.adapter_index)\r\nreturn HPI_ERROR_NO_INTERADAPTER_GROUPS;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_group_get_map(u32 h_outstream, u32 *poutstream_map,\r\nu32 *pinstream_map)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_GROUP_GETMAP);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (poutstream_map)\r\n*poutstream_map = hr.u.d.u.group_info.outstream_group_map;\r\nif (pinstream_map)\r\n*pinstream_map = hr.u.d.u.group_info.instream_group_map;\r\nreturn hr.error;\r\n}\r\nu16 hpi_outstream_group_reset(u32 h_outstream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_OSTREAM,\r\nHPI_OSTREAM_GROUP_RESET);\r\nif (hpi_handle_indexes(h_outstream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_open(u16 adapter_index, u16 instream_index, u32 *ph_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_OPEN);\r\nhm.adapter_index = adapter_index;\r\nhm.obj_index = instream_index;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0)\r\n*ph_instream =\r\nhpi_indexes_to_handle(HPI_OBJ_ISTREAM, adapter_index,\r\ninstream_index);\r\nelse\r\n*ph_instream = 0;\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_close(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_HOSTBUFFER_FREE);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_GROUP_RESET);\r\nhpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index);\r\nhpi_send_recv(&hm, &hr);\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_CLOSE);\r\nhpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_query_format(u32 h_instream,\r\nconst struct hpi_format *p_format)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_QUERY_FORMAT);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_format_to_msg(&hm.u.d.u.data.format, p_format);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_set_format(u32 h_instream, const struct hpi_format *p_format)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_SET_FORMAT);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_format_to_msg(&hm.u.d.u.data.format, p_format);\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_read_buf(u32 h_instream, u8 *pb_data, u32 bytes_to_read)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_READ);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.data_size = bytes_to_read;\r\nhm.u.d.u.data.pb_data = pb_data;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_start(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_START);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_wait_start(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_WAIT_START);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_stop(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_STOP);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_reset(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_RESET);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_get_info_ex(u32 h_instream, u16 *pw_state, u32 *pbuffer_size,\r\nu32 *pdata_recorded, u32 *psamples_recorded,\r\nu32 *pauxiliary_data_recorded)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_GET_INFO);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_state)\r\n*pw_state = hr.u.d.u.stream_info.state;\r\nif (pbuffer_size)\r\n*pbuffer_size = hr.u.d.u.stream_info.buffer_size;\r\nif (pdata_recorded)\r\n*pdata_recorded = hr.u.d.u.stream_info.data_available;\r\nif (psamples_recorded)\r\n*psamples_recorded = hr.u.d.u.stream_info.samples_transferred;\r\nif (pauxiliary_data_recorded)\r\n*pauxiliary_data_recorded =\r\nhr.u.d.u.stream_info.auxiliary_data_available;\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_ancillary_reset(u32 h_instream, u16 bytes_per_frame,\r\nu16 mode, u16 alignment, u16 idle_bit)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_ANC_RESET);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.format.attributes = bytes_per_frame;\r\nhm.u.d.u.data.format.format = (mode << 8) | (alignment & 0xff);\r\nhm.u.d.u.data.format.channels = idle_bit;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_ancillary_get_info(u32 h_instream, u32 *pframe_space)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_ANC_GET_INFO);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (pframe_space)\r\n*pframe_space =\r\n(hr.u.d.u.stream_info.buffer_size -\r\nhr.u.d.u.stream_info.data_available) /\r\nsizeof(struct hpi_anc_frame);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_ancillary_write(u32 h_instream,\r\nconst struct hpi_anc_frame *p_anc_frame_buffer,\r\nu32 anc_frame_buffer_size_in_bytes,\r\nu32 number_of_ancillary_frames_to_write)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_ANC_WRITE);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.pb_data = (u8 *)p_anc_frame_buffer;\r\nhm.u.d.u.data.data_size =\r\nnumber_of_ancillary_frames_to_write *\r\nsizeof(struct hpi_anc_frame);\r\nif (hm.u.d.u.data.data_size <= anc_frame_buffer_size_in_bytes)\r\nhpi_send_recv(&hm, &hr);\r\nelse\r\nhr.error = HPI_ERROR_INVALID_DATASIZE;\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_host_buffer_allocate(u32 h_instream, u32 size_in_bytes)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_HOSTBUFFER_ALLOC);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.d.u.data.data_size = size_in_bytes;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_host_buffer_get_info(u32 h_instream, u8 **pp_buffer,\r\nstruct hpi_hostbuffer_status **pp_status)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_HOSTBUFFER_GET_INFO);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0) {\r\nif (pp_buffer)\r\n*pp_buffer = hr.u.d.u.hostbuffer_info.p_buffer;\r\nif (pp_status)\r\n*pp_status = hr.u.d.u.hostbuffer_info.p_status;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_host_buffer_free(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_HOSTBUFFER_FREE);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_group_add(u32 h_instream, u32 h_stream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nu16 adapter;\r\nchar c_obj_type;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_GROUP_ADD);\r\nhr.error = 0;\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nif (hpi_handle_indexes(h_stream, &adapter,\r\n&hm.u.d.u.stream.stream_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nc_obj_type = hpi_handle_object(h_stream);\r\nswitch (c_obj_type) {\r\ncase HPI_OBJ_OSTREAM:\r\ncase HPI_OBJ_ISTREAM:\r\nhm.u.d.u.stream.object_type = c_obj_type;\r\nbreak;\r\ndefault:\r\nreturn HPI_ERROR_INVALID_OBJ;\r\n}\r\nif (adapter != hm.adapter_index)\r\nreturn HPI_ERROR_NO_INTERADAPTER_GROUPS;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_group_get_map(u32 h_instream, u32 *poutstream_map,\r\nu32 *pinstream_map)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_HOSTBUFFER_FREE);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nif (poutstream_map)\r\n*poutstream_map = hr.u.d.u.group_info.outstream_group_map;\r\nif (pinstream_map)\r\n*pinstream_map = hr.u.d.u.group_info.instream_group_map;\r\nreturn hr.error;\r\n}\r\nu16 hpi_instream_group_reset(u32 h_instream)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_ISTREAM,\r\nHPI_ISTREAM_GROUP_RESET);\r\nif (hpi_handle_indexes(h_instream, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_mixer_open(u16 adapter_index, u32 *ph_mixer)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_MIXER, HPI_MIXER_OPEN);\r\nhm.adapter_index = adapter_index;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0)\r\n*ph_mixer =\r\nhpi_indexes_to_handle(HPI_OBJ_MIXER, adapter_index,\r\n0);\r\nelse\r\n*ph_mixer = 0;\r\nreturn hr.error;\r\n}\r\nu16 hpi_mixer_close(u32 h_mixer)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_MIXER, HPI_MIXER_CLOSE);\r\nif (hpi_handle_indexes(h_mixer, &hm.adapter_index, NULL))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_mixer_get_control(u32 h_mixer, u16 src_node_type,\r\nu16 src_node_type_index, u16 dst_node_type, u16 dst_node_type_index,\r\nu16 control_type, u32 *ph_control)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_MIXER,\r\nHPI_MIXER_GET_CONTROL);\r\nif (hpi_handle_indexes(h_mixer, &hm.adapter_index, NULL))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.m.node_type1 = src_node_type;\r\nhm.u.m.node_index1 = src_node_type_index;\r\nhm.u.m.node_type2 = dst_node_type;\r\nhm.u.m.node_index2 = dst_node_type_index;\r\nhm.u.m.control_type = control_type;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error == 0)\r\n*ph_control =\r\nhpi_indexes_to_handle(HPI_OBJ_CONTROL,\r\nhm.adapter_index, hr.u.m.control_index);\r\nelse\r\n*ph_control = 0;\r\nreturn hr.error;\r\n}\r\nu16 hpi_mixer_get_control_by_index(u32 h_mixer, u16 control_index,\r\nu16 *pw_src_node_type, u16 *pw_src_node_index, u16 *pw_dst_node_type,\r\nu16 *pw_dst_node_index, u16 *pw_control_type, u32 *ph_control)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_MIXER,\r\nHPI_MIXER_GET_CONTROL_BY_INDEX);\r\nif (hpi_handle_indexes(h_mixer, &hm.adapter_index, NULL))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.m.control_index = control_index;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_src_node_type) {\r\n*pw_src_node_type =\r\nhr.u.m.src_node_type + HPI_SOURCENODE_NONE;\r\n*pw_src_node_index = hr.u.m.src_node_index;\r\n*pw_dst_node_type = hr.u.m.dst_node_type + HPI_DESTNODE_NONE;\r\n*pw_dst_node_index = hr.u.m.dst_node_index;\r\n}\r\nif (pw_control_type)\r\n*pw_control_type = hr.u.m.control_index;\r\nif (ph_control) {\r\nif (hr.error == 0)\r\n*ph_control =\r\nhpi_indexes_to_handle(HPI_OBJ_CONTROL,\r\nhm.adapter_index, control_index);\r\nelse\r\n*ph_control = 0;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_mixer_store(u32 h_mixer, enum HPI_MIXER_STORE_COMMAND command,\r\nu16 index)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_MIXER, HPI_MIXER_STORE);\r\nif (hpi_handle_indexes(h_mixer, &hm.adapter_index, NULL))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.mx.store.command = command;\r\nhm.u.mx.store.index = index;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nstatic\r\nu16 hpi_control_param_set(const u32 h_control, const u16 attrib,\r\nconst u32 param1, const u32 param2)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attrib;\r\nhm.u.c.param1 = param1;\r\nhm.u.c.param2 = param2;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nstatic u16 hpi_control_log_set2(u32 h_control, u16 attrib, short sv0,\r\nshort sv1)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attrib;\r\nhm.u.c.an_log_value[0] = sv0;\r\nhm.u.c.an_log_value[1] = sv1;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nstatic\r\nu16 hpi_control_param_get(const u32 h_control, const u16 attrib, u32 param1,\r\nu32 param2, u32 *pparam1, u32 *pparam2)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attrib;\r\nhm.u.c.param1 = param1;\r\nhm.u.c.param2 = param2;\r\nhpi_send_recv(&hm, &hr);\r\n*pparam1 = hr.u.c.param1;\r\nif (pparam2)\r\n*pparam2 = hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nstatic u16 hpi_control_log_get2(u32 h_control, u16 attrib, short *sv0,\r\nshort *sv1)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attrib;\r\nhpi_send_recv(&hm, &hr);\r\n*sv0 = hr.u.c.an_log_value[0];\r\nif (sv1)\r\n*sv1 = hr.u.c.an_log_value[1];\r\nreturn hr.error;\r\n}\r\nstatic\r\nu16 hpi_control_query(const u32 h_control, const u16 attrib, const u32 index,\r\nconst u32 param, u32 *psetting)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_INFO);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attrib;\r\nhm.u.c.param1 = index;\r\nhm.u.c.param2 = param;\r\nhpi_send_recv(&hm, &hr);\r\n*psetting = hr.u.c.param1;\r\nreturn hr.error;\r\n}\r\nstatic u16 hpi_control_get_string(const u32 h_control, const u16 attribute,\r\nchar *psz_string, const u32 string_length)\r\n{\r\nunsigned int sub_string_index = 0, j = 0;\r\nchar c = 0;\r\nunsigned int n = 0;\r\nu16 err = 0;\r\nif ((string_length < 1) || (string_length > 256))\r\nreturn HPI_ERROR_INVALID_CONTROL_VALUE;\r\nfor (sub_string_index = 0; sub_string_index < string_length;\r\nsub_string_index += 8) {\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index,\r\n&hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = attribute;\r\nhm.u.c.param1 = sub_string_index;\r\nhm.u.c.param2 = 0;\r\nhpi_send_recv(&hm, &hr);\r\nif (sub_string_index == 0\r\n&& (hr.u.cu.chars8.remaining_chars + 8) >\r\nstring_length)\r\nreturn HPI_ERROR_INVALID_CONTROL_VALUE;\r\nif (hr.error) {\r\nerr = hr.error;\r\nbreak;\r\n}\r\nfor (j = 0; j < 8; j++) {\r\nc = hr.u.cu.chars8.sz_data[j];\r\npsz_string[sub_string_index + j] = c;\r\nn++;\r\nif (n >= string_length) {\r\npsz_string[string_length - 1] = 0;\r\nerr = HPI_ERROR_INVALID_CONTROL_VALUE;\r\nbreak;\r\n}\r\nif (c == 0)\r\nbreak;\r\n}\r\nif ((hr.u.cu.chars8.remaining_chars == 0)\r\n&& ((sub_string_index + j) < string_length)\r\n&& (c != 0)) {\r\nc = 0;\r\npsz_string[sub_string_index + j] = c;\r\n}\r\nif (c == 0)\r\nbreak;\r\n}\r\nreturn err;\r\n}\r\nu16 hpi_aesebu_receiver_query_format(const u32 h_aes_rx, const u32 index,\r\nu16 *pw_format)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_aes_rx, HPI_AESEBURX_FORMAT, index, 0, &qr);\r\n*pw_format = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_aesebu_receiver_set_format(u32 h_control, u16 format)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_AESEBURX_FORMAT, format,\r\n0);\r\n}\r\nu16 hpi_aesebu_receiver_get_format(u32 h_control, u16 *pw_format)\r\n{\r\nu16 err;\r\nu32 param;\r\nerr = hpi_control_param1_get(h_control, HPI_AESEBURX_FORMAT, &param);\r\nif (!err && pw_format)\r\n*pw_format = (u16)param;\r\nreturn err;\r\n}\r\nu16 hpi_aesebu_receiver_get_sample_rate(u32 h_control, u32 *psample_rate)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_AESEBURX_SAMPLERATE,\r\npsample_rate);\r\n}\r\nu16 hpi_aesebu_receiver_get_user_data(u32 h_control, u16 index, u16 *pw_data)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_AESEBURX_USERDATA;\r\nhm.u.c.param1 = index;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_data)\r\n*pw_data = (u16)hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nu16 hpi_aesebu_receiver_get_channel_status(u32 h_control, u16 index,\r\nu16 *pw_data)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_AESEBURX_CHANNELSTATUS;\r\nhm.u.c.param1 = index;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_data)\r\n*pw_data = (u16)hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nu16 hpi_aesebu_receiver_get_error_status(u32 h_control, u16 *pw_error_data)\r\n{\r\nu32 error_data = 0;\r\nu16 err = 0;\r\nerr = hpi_control_param1_get(h_control, HPI_AESEBURX_ERRORSTATUS,\r\n&error_data);\r\nif (pw_error_data)\r\n*pw_error_data = (u16)error_data;\r\nreturn err;\r\n}\r\nu16 hpi_aesebu_transmitter_set_sample_rate(u32 h_control, u32 sample_rate)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_AESEBUTX_SAMPLERATE,\r\nsample_rate, 0);\r\n}\r\nu16 hpi_aesebu_transmitter_set_user_data(u32 h_control, u16 index, u16 data)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_AESEBUTX_USERDATA, index,\r\ndata);\r\n}\r\nu16 hpi_aesebu_transmitter_set_channel_status(u32 h_control, u16 index,\r\nu16 data)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_AESEBUTX_CHANNELSTATUS,\r\nindex, data);\r\n}\r\nu16 hpi_aesebu_transmitter_get_channel_status(u32 h_control, u16 index,\r\nu16 *pw_data)\r\n{\r\nreturn HPI_ERROR_INVALID_OPERATION;\r\n}\r\nu16 hpi_aesebu_transmitter_query_format(const u32 h_aes_tx, const u32 index,\r\nu16 *pw_format)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_aes_tx, HPI_AESEBUTX_FORMAT, index, 0, &qr);\r\n*pw_format = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_aesebu_transmitter_set_format(u32 h_control, u16 output_format)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_AESEBUTX_FORMAT,\r\noutput_format, 0);\r\n}\r\nu16 hpi_aesebu_transmitter_get_format(u32 h_control, u16 *pw_output_format)\r\n{\r\nu16 err;\r\nu32 param;\r\nerr = hpi_control_param1_get(h_control, HPI_AESEBUTX_FORMAT, &param);\r\nif (!err && pw_output_format)\r\n*pw_output_format = (u16)param;\r\nreturn err;\r\n}\r\nu16 hpi_bitstream_set_clock_edge(u32 h_control, u16 edge_type)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_BITSTREAM_CLOCK_EDGE,\r\nedge_type, 0);\r\n}\r\nu16 hpi_bitstream_set_data_polarity(u32 h_control, u16 polarity)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_BITSTREAM_DATA_POLARITY,\r\npolarity, 0);\r\n}\r\nu16 hpi_bitstream_get_activity(u32 h_control, u16 *pw_clk_activity,\r\nu16 *pw_data_activity)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_BITSTREAM_ACTIVITY;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_clk_activity)\r\n*pw_clk_activity = (u16)hr.u.c.param1;\r\nif (pw_data_activity)\r\n*pw_data_activity = (u16)hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nu16 hpi_channel_mode_query_mode(const u32 h_mode, const u32 index,\r\nu16 *pw_mode)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_mode, HPI_CHANNEL_MODE_MODE, index, 0, &qr);\r\n*pw_mode = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_channel_mode_set(u32 h_control, u16 mode)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_CHANNEL_MODE_MODE, mode,\r\n0);\r\n}\r\nu16 hpi_channel_mode_get(u32 h_control, u16 *mode)\r\n{\r\nu32 mode32 = 0;\r\nu16 err = hpi_control_param1_get(h_control,\r\nHPI_CHANNEL_MODE_MODE, &mode32);\r\nif (mode)\r\n*mode = (u16)mode32;\r\nreturn err;\r\n}\r\nu16 hpi_cobranet_hmi_write(u32 h_control, u32 hmi_address, u32 byte_count,\r\nu8 *pb_data)\r\n{\r\nstruct hpi_msg_cobranet_hmiwrite hm;\r\nstruct hpi_response_header hr;\r\nhpi_init_message_responseV1(&hm.h, sizeof(hm), &hr, sizeof(hr),\r\nHPI_OBJ_CONTROL, HPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.h.adapter_index,\r\n&hm.h.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nif (byte_count > sizeof(hm.bytes))\r\nreturn HPI_ERROR_MESSAGE_BUFFER_TOO_SMALL;\r\nhm.p.attribute = HPI_COBRANET_SET;\r\nhm.p.byte_count = byte_count;\r\nhm.p.hmi_address = hmi_address;\r\nmemcpy(hm.bytes, pb_data, byte_count);\r\nhm.h.size = (u16)(sizeof(hm.h) + sizeof(hm.p) + byte_count);\r\nhpi_send_recvV1(&hm.h, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_cobranet_hmi_read(u32 h_control, u32 hmi_address, u32 max_byte_count,\r\nu32 *pbyte_count, u8 *pb_data)\r\n{\r\nstruct hpi_msg_cobranet_hmiread hm;\r\nstruct hpi_res_cobranet_hmiread hr;\r\nhpi_init_message_responseV1(&hm.h, sizeof(hm), &hr.h, sizeof(hr),\r\nHPI_OBJ_CONTROL, HPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.h.adapter_index,\r\n&hm.h.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nif (max_byte_count > sizeof(hr.bytes))\r\nreturn HPI_ERROR_RESPONSE_BUFFER_TOO_SMALL;\r\nhm.p.attribute = HPI_COBRANET_GET;\r\nhm.p.byte_count = max_byte_count;\r\nhm.p.hmi_address = hmi_address;\r\nhpi_send_recvV1(&hm.h, &hr.h);\r\nif (!hr.h.error && pb_data) {\r\nif (hr.byte_count > sizeof(hr.bytes))\r\nreturn HPI_ERROR_RESPONSE_BUFFER_TOO_SMALL;\r\n*pbyte_count = hr.byte_count;\r\nif (hr.byte_count < max_byte_count)\r\nmax_byte_count = *pbyte_count;\r\nmemcpy(pb_data, hr.bytes, max_byte_count);\r\n}\r\nreturn hr.h.error;\r\n}\r\nu16 hpi_cobranet_hmi_get_status(u32 h_control, u32 *pstatus,\r\nu32 *preadable_size, u32 *pwriteable_size)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_COBRANET_GET_STATUS;\r\nhpi_send_recv(&hm, &hr);\r\nif (!hr.error) {\r\nif (pstatus)\r\n*pstatus = hr.u.cu.cobranet.status.status;\r\nif (preadable_size)\r\n*preadable_size =\r\nhr.u.cu.cobranet.status.readable_size;\r\nif (pwriteable_size)\r\n*pwriteable_size =\r\nhr.u.cu.cobranet.status.writeable_size;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_cobranet_get_ip_address(u32 h_control, u32 *pdw_ip_address)\r\n{\r\nu32 byte_count;\r\nu32 iP;\r\nu16 err;\r\nerr = hpi_cobranet_hmi_read(h_control,\r\nHPI_COBRANET_HMI_cobra_ip_mon_currentIP, 4, &byte_count,\r\n(u8 *)&iP);\r\n*pdw_ip_address =\r\n((iP & 0xff000000) >> 8) | ((iP & 0x00ff0000) << 8) | ((iP &\r\n0x0000ff00) >> 8) | ((iP & 0x000000ff) << 8);\r\nif (err)\r\n*pdw_ip_address = 0;\r\nreturn err;\r\n}\r\nu16 hpi_cobranet_set_ip_address(u32 h_control, u32 dw_ip_address)\r\n{\r\nu32 iP;\r\nu16 err;\r\niP = ((dw_ip_address & 0xff000000) >> 8) | ((dw_ip_address &\r\n0x00ff0000) << 8) | ((dw_ip_address & 0x0000ff00) >>\r\n8) | ((dw_ip_address & 0x000000ff) << 8);\r\nerr = hpi_cobranet_hmi_write(h_control,\r\nHPI_COBRANET_HMI_cobra_ip_mon_currentIP, 4, (u8 *)&iP);\r\nreturn err;\r\n}\r\nu16 hpi_cobranet_get_static_ip_address(u32 h_control, u32 *pdw_ip_address)\r\n{\r\nu32 byte_count;\r\nu32 iP;\r\nu16 err;\r\nerr = hpi_cobranet_hmi_read(h_control,\r\nHPI_COBRANET_HMI_cobra_ip_mon_staticIP, 4, &byte_count,\r\n(u8 *)&iP);\r\n*pdw_ip_address =\r\n((iP & 0xff000000) >> 8) | ((iP & 0x00ff0000) << 8) | ((iP &\r\n0x0000ff00) >> 8) | ((iP & 0x000000ff) << 8);\r\nif (err)\r\n*pdw_ip_address = 0;\r\nreturn err;\r\n}\r\nu16 hpi_cobranet_set_static_ip_address(u32 h_control, u32 dw_ip_address)\r\n{\r\nu32 iP;\r\nu16 err;\r\niP = ((dw_ip_address & 0xff000000) >> 8) | ((dw_ip_address &\r\n0x00ff0000) << 8) | ((dw_ip_address & 0x0000ff00) >>\r\n8) | ((dw_ip_address & 0x000000ff) << 8);\r\nerr = hpi_cobranet_hmi_write(h_control,\r\nHPI_COBRANET_HMI_cobra_ip_mon_staticIP, 4, (u8 *)&iP);\r\nreturn err;\r\n}\r\nu16 hpi_cobranet_get_macaddress(u32 h_control, u32 *p_mac_msbs,\r\nu32 *p_mac_lsbs)\r\n{\r\nu32 byte_count;\r\nu16 err;\r\nu32 mac;\r\nerr = hpi_cobranet_hmi_read(h_control,\r\nHPI_COBRANET_HMI_cobra_if_phy_address, 4, &byte_count,\r\n(u8 *)&mac);\r\nif (!err) {\r\n*p_mac_msbs =\r\n((mac & 0xff000000) >> 8) | ((mac & 0x00ff0000) << 8)\r\n| ((mac & 0x0000ff00) >> 8) | ((mac & 0x000000ff) <<\r\n8);\r\nerr = hpi_cobranet_hmi_read(h_control,\r\nHPI_COBRANET_HMI_cobra_if_phy_address + 1, 4,\r\n&byte_count, (u8 *)&mac);\r\n}\r\nif (!err) {\r\n*p_mac_lsbs =\r\n((mac & 0xff000000) >> 8) | ((mac & 0x00ff0000) << 8)\r\n| ((mac & 0x0000ff00) >> 8) | ((mac & 0x000000ff) <<\r\n8);\r\n} else {\r\n*p_mac_msbs = 0;\r\n*p_mac_lsbs = 0;\r\n}\r\nreturn err;\r\n}\r\nu16 hpi_compander_set_enable(u32 h_control, u32 enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_GENERIC_ENABLE, enable,\r\n0);\r\n}\r\nu16 hpi_compander_get_enable(u32 h_control, u32 *enable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_GENERIC_ENABLE, enable);\r\n}\r\nu16 hpi_compander_set_makeup_gain(u32 h_control, short makeup_gain0_01dB)\r\n{\r\nreturn hpi_control_log_set2(h_control, HPI_COMPANDER_MAKEUPGAIN,\r\nmakeup_gain0_01dB, 0);\r\n}\r\nu16 hpi_compander_get_makeup_gain(u32 h_control, short *makeup_gain0_01dB)\r\n{\r\nreturn hpi_control_log_get2(h_control, HPI_COMPANDER_MAKEUPGAIN,\r\nmakeup_gain0_01dB, NULL);\r\n}\r\nu16 hpi_compander_set_attack_time_constant(u32 h_control, unsigned int index,\r\nu32 attack)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_COMPANDER_ATTACK, attack,\r\nindex);\r\n}\r\nu16 hpi_compander_get_attack_time_constant(u32 h_control, unsigned int index,\r\nu32 *attack)\r\n{\r\nreturn hpi_control_param_get(h_control, HPI_COMPANDER_ATTACK, 0,\r\nindex, attack, NULL);\r\n}\r\nu16 hpi_compander_set_decay_time_constant(u32 h_control, unsigned int index,\r\nu32 decay)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_COMPANDER_DECAY, decay,\r\nindex);\r\n}\r\nu16 hpi_compander_get_decay_time_constant(u32 h_control, unsigned int index,\r\nu32 *decay)\r\n{\r\nreturn hpi_control_param_get(h_control, HPI_COMPANDER_DECAY, 0, index,\r\ndecay, NULL);\r\n}\r\nu16 hpi_compander_set_threshold(u32 h_control, unsigned int index,\r\nshort threshold0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_COMPANDER_THRESHOLD;\r\nhm.u.c.param2 = index;\r\nhm.u.c.an_log_value[0] = threshold0_01dB;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_compander_get_threshold(u32 h_control, unsigned int index,\r\nshort *threshold0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_COMPANDER_THRESHOLD;\r\nhm.u.c.param2 = index;\r\nhpi_send_recv(&hm, &hr);\r\n*threshold0_01dB = hr.u.c.an_log_value[0];\r\nreturn hr.error;\r\n}\r\nu16 hpi_compander_set_ratio(u32 h_control, u32 index, u32 ratio100)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_COMPANDER_RATIO, ratio100,\r\nindex);\r\n}\r\nu16 hpi_compander_get_ratio(u32 h_control, u32 index, u32 *ratio100)\r\n{\r\nreturn hpi_control_param_get(h_control, HPI_COMPANDER_RATIO, 0, index,\r\nratio100, NULL);\r\n}\r\nu16 hpi_level_query_range(u32 h_control, short *min_gain_01dB,\r\nshort *max_gain_01dB, short *step_gain_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_LEVEL_RANGE;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error) {\r\nhr.u.c.an_log_value[0] = 0;\r\nhr.u.c.an_log_value[1] = 0;\r\nhr.u.c.param1 = 0;\r\n}\r\nif (min_gain_01dB)\r\n*min_gain_01dB = hr.u.c.an_log_value[0];\r\nif (max_gain_01dB)\r\n*max_gain_01dB = hr.u.c.an_log_value[1];\r\nif (step_gain_01dB)\r\n*step_gain_01dB = (short)hr.u.c.param1;\r\nreturn hr.error;\r\n}\r\nu16 hpi_level_set_gain(u32 h_control, short an_gain0_01dB[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nreturn hpi_control_log_set2(h_control, HPI_LEVEL_GAIN,\r\nan_gain0_01dB[0], an_gain0_01dB[1]);\r\n}\r\nu16 hpi_level_get_gain(u32 h_control, short an_gain0_01dB[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nreturn hpi_control_log_get2(h_control, HPI_LEVEL_GAIN,\r\n&an_gain0_01dB[0], &an_gain0_01dB[1]);\r\n}\r\nu16 hpi_meter_query_channels(const u32 h_meter, u32 *p_channels)\r\n{\r\nreturn hpi_control_query(h_meter, HPI_METER_NUM_CHANNELS, 0, 0,\r\np_channels);\r\n}\r\nu16 hpi_meter_get_peak(u32 h_control, short an_peakdB[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nshort i = 0;\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.obj_index = hm.obj_index;\r\nhm.u.c.attribute = HPI_METER_PEAK;\r\nhpi_send_recv(&hm, &hr);\r\nif (!hr.error)\r\nmemcpy(an_peakdB, hr.u.c.an_log_value,\r\nsizeof(short) * HPI_MAX_CHANNELS);\r\nelse\r\nfor (i = 0; i < HPI_MAX_CHANNELS; i++)\r\nan_peakdB[i] = HPI_METER_MINIMUM;\r\nreturn hr.error;\r\n}\r\nu16 hpi_meter_get_rms(u32 h_control, short an_rmsdB[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nshort i = 0;\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_METER_RMS;\r\nhpi_send_recv(&hm, &hr);\r\nif (!hr.error)\r\nmemcpy(an_rmsdB, hr.u.c.an_log_value,\r\nsizeof(short) * HPI_MAX_CHANNELS);\r\nelse\r\nfor (i = 0; i < HPI_MAX_CHANNELS; i++)\r\nan_rmsdB[i] = HPI_METER_MINIMUM;\r\nreturn hr.error;\r\n}\r\nu16 hpi_meter_set_rms_ballistics(u32 h_control, u16 attack, u16 decay)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_METER_RMS_BALLISTICS,\r\nattack, decay);\r\n}\r\nu16 hpi_meter_get_rms_ballistics(u32 h_control, u16 *pn_attack, u16 *pn_decay)\r\n{\r\nu32 attack;\r\nu32 decay;\r\nu16 error;\r\nerror = hpi_control_param2_get(h_control, HPI_METER_RMS_BALLISTICS,\r\n&attack, &decay);\r\nif (pn_attack)\r\n*pn_attack = (unsigned short)attack;\r\nif (pn_decay)\r\n*pn_decay = (unsigned short)decay;\r\nreturn error;\r\n}\r\nu16 hpi_meter_set_peak_ballistics(u32 h_control, u16 attack, u16 decay)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_METER_PEAK_BALLISTICS,\r\nattack, decay);\r\n}\r\nu16 hpi_meter_get_peak_ballistics(u32 h_control, u16 *pn_attack,\r\nu16 *pn_decay)\r\n{\r\nu32 attack;\r\nu32 decay;\r\nu16 error;\r\nerror = hpi_control_param2_get(h_control, HPI_METER_PEAK_BALLISTICS,\r\n&attack, &decay);\r\nif (pn_attack)\r\n*pn_attack = (short)attack;\r\nif (pn_decay)\r\n*pn_decay = (short)decay;\r\nreturn error;\r\n}\r\nu16 hpi_microphone_set_phantom_power(u32 h_control, u16 on_off)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_MICROPHONE_PHANTOM_POWER,\r\n(u32)on_off, 0);\r\n}\r\nu16 hpi_microphone_get_phantom_power(u32 h_control, u16 *pw_on_off)\r\n{\r\nu16 error = 0;\r\nu32 on_off = 0;\r\nerror = hpi_control_param1_get(h_control,\r\nHPI_MICROPHONE_PHANTOM_POWER, &on_off);\r\nif (pw_on_off)\r\n*pw_on_off = (u16)on_off;\r\nreturn error;\r\n}\r\nu16 hpi_multiplexer_set_source(u32 h_control, u16 source_node_type,\r\nu16 source_node_index)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_MULTIPLEXER_SOURCE,\r\nsource_node_type, source_node_index);\r\n}\r\nu16 hpi_multiplexer_get_source(u32 h_control, u16 *source_node_type,\r\nu16 *source_node_index)\r\n{\r\nu32 node, index;\r\nu16 err = hpi_control_param2_get(h_control,\r\nHPI_MULTIPLEXER_SOURCE, &node,\r\n&index);\r\nif (source_node_type)\r\n*source_node_type = (u16)node;\r\nif (source_node_index)\r\n*source_node_index = (u16)index;\r\nreturn err;\r\n}\r\nu16 hpi_multiplexer_query_source(u32 h_control, u16 index,\r\nu16 *source_node_type, u16 *source_node_index)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_MULTIPLEXER_QUERYSOURCE;\r\nhm.u.c.param1 = index;\r\nhpi_send_recv(&hm, &hr);\r\nif (source_node_type)\r\n*source_node_type = (u16)hr.u.c.param1;\r\nif (source_node_index)\r\n*source_node_index = (u16)hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nu16 hpi_parametric_eq_get_info(u32 h_control, u16 *pw_number_of_bands,\r\nu16 *pw_on_off)\r\n{\r\nu32 oB = 0;\r\nu32 oO = 0;\r\nu16 error = 0;\r\nerror = hpi_control_param2_get(h_control, HPI_EQUALIZER_NUM_FILTERS,\r\n&oO, &oB);\r\nif (pw_number_of_bands)\r\n*pw_number_of_bands = (u16)oB;\r\nif (pw_on_off)\r\n*pw_on_off = (u16)oO;\r\nreturn error;\r\n}\r\nu16 hpi_parametric_eq_set_state(u32 h_control, u16 on_off)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_EQUALIZER_NUM_FILTERS,\r\non_off, 0);\r\n}\r\nu16 hpi_parametric_eq_get_band(u32 h_control, u16 index, u16 *pn_type,\r\nu32 *pfrequency_hz, short *pnQ100, short *pn_gain0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_EQUALIZER_FILTER;\r\nhm.u.c.param2 = index;\r\nhpi_send_recv(&hm, &hr);\r\nif (pfrequency_hz)\r\n*pfrequency_hz = hr.u.c.param1;\r\nif (pn_type)\r\n*pn_type = (u16)(hr.u.c.param2 >> 16);\r\nif (pnQ100)\r\n*pnQ100 = hr.u.c.an_log_value[1];\r\nif (pn_gain0_01dB)\r\n*pn_gain0_01dB = hr.u.c.an_log_value[0];\r\nreturn hr.error;\r\n}\r\nu16 hpi_parametric_eq_set_band(u32 h_control, u16 index, u16 type,\r\nu32 frequency_hz, short q100, short gain0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.param1 = frequency_hz;\r\nhm.u.c.param2 = (index & 0xFFFFL) + ((u32)type << 16);\r\nhm.u.c.an_log_value[0] = gain0_01dB;\r\nhm.u.c.an_log_value[1] = q100;\r\nhm.u.c.attribute = HPI_EQUALIZER_FILTER;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_parametric_eq_get_coeffs(u32 h_control, u16 index, short coeffs[5]\r\n)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_EQUALIZER_COEFFICIENTS;\r\nhm.u.c.param2 = index;\r\nhpi_send_recv(&hm, &hr);\r\ncoeffs[0] = (short)hr.u.c.an_log_value[0];\r\ncoeffs[1] = (short)hr.u.c.an_log_value[1];\r\ncoeffs[2] = (short)hr.u.c.param1;\r\ncoeffs[3] = (short)(hr.u.c.param1 >> 16);\r\ncoeffs[4] = (short)hr.u.c.param2;\r\nreturn hr.error;\r\n}\r\nu16 hpi_sample_clock_query_source(const u32 h_clock, const u32 index,\r\nu16 *pw_source)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_clock, HPI_SAMPLECLOCK_SOURCE, index, 0,\r\n&qr);\r\n*pw_source = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_set_source(u32 h_control, u16 source)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SAMPLECLOCK_SOURCE,\r\nsource, 0);\r\n}\r\nu16 hpi_sample_clock_get_source(u32 h_control, u16 *pw_source)\r\n{\r\nu16 err = 0;\r\nu32 source = 0;\r\nerr = hpi_control_param1_get(h_control, HPI_SAMPLECLOCK_SOURCE,\r\n&source);\r\nif (!err)\r\nif (pw_source)\r\n*pw_source = (u16)source;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_query_source_index(const u32 h_clock, const u32 index,\r\nconst u32 source, u16 *pw_source_index)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_clock, HPI_SAMPLECLOCK_SOURCE_INDEX, index,\r\nsource, &qr);\r\n*pw_source_index = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_set_source_index(u32 h_control, u16 source_index)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SAMPLECLOCK_SOURCE_INDEX,\r\nsource_index, 0);\r\n}\r\nu16 hpi_sample_clock_get_source_index(u32 h_control, u16 *pw_source_index)\r\n{\r\nu16 err = 0;\r\nu32 source_index = 0;\r\nerr = hpi_control_param1_get(h_control, HPI_SAMPLECLOCK_SOURCE_INDEX,\r\n&source_index);\r\nif (!err)\r\nif (pw_source_index)\r\n*pw_source_index = (u16)source_index;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_query_local_rate(const u32 h_clock, const u32 index,\r\nu32 *prate)\r\n{\r\nu16 err;\r\nerr = hpi_control_query(h_clock, HPI_SAMPLECLOCK_LOCAL_SAMPLERATE,\r\nindex, 0, prate);\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_set_local_rate(u32 h_control, u32 sample_rate)\r\n{\r\nreturn hpi_control_param_set(h_control,\r\nHPI_SAMPLECLOCK_LOCAL_SAMPLERATE, sample_rate, 0);\r\n}\r\nu16 hpi_sample_clock_get_local_rate(u32 h_control, u32 *psample_rate)\r\n{\r\nu16 err = 0;\r\nu32 sample_rate = 0;\r\nerr = hpi_control_param1_get(h_control,\r\nHPI_SAMPLECLOCK_LOCAL_SAMPLERATE, &sample_rate);\r\nif (!err)\r\nif (psample_rate)\r\n*psample_rate = sample_rate;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_get_sample_rate(u32 h_control, u32 *psample_rate)\r\n{\r\nu16 err = 0;\r\nu32 sample_rate = 0;\r\nerr = hpi_control_param1_get(h_control, HPI_SAMPLECLOCK_SAMPLERATE,\r\n&sample_rate);\r\nif (!err)\r\nif (psample_rate)\r\n*psample_rate = sample_rate;\r\nreturn err;\r\n}\r\nu16 hpi_sample_clock_set_auto(u32 h_control, u32 enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SAMPLECLOCK_AUTO, enable,\r\n0);\r\n}\r\nu16 hpi_sample_clock_get_auto(u32 h_control, u32 *penable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_SAMPLECLOCK_AUTO,\r\npenable);\r\n}\r\nu16 hpi_sample_clock_set_local_rate_lock(u32 h_control, u32 lock)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SAMPLECLOCK_LOCAL_LOCK,\r\nlock, 0);\r\n}\r\nu16 hpi_sample_clock_get_local_rate_lock(u32 h_control, u32 *plock)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_SAMPLECLOCK_LOCAL_LOCK,\r\nplock);\r\n}\r\nu16 hpi_tone_detector_get_frequency(u32 h_control, u32 index, u32 *frequency)\r\n{\r\nreturn hpi_control_param_get(h_control, HPI_TONEDETECTOR_FREQUENCY,\r\nindex, 0, frequency, NULL);\r\n}\r\nu16 hpi_tone_detector_get_state(u32 h_control, u32 *state)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TONEDETECTOR_STATE,\r\nstate);\r\n}\r\nu16 hpi_tone_detector_set_enable(u32 h_control, u32 enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_GENERIC_ENABLE, enable,\r\n0);\r\n}\r\nu16 hpi_tone_detector_get_enable(u32 h_control, u32 *enable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_GENERIC_ENABLE, enable);\r\n}\r\nu16 hpi_tone_detector_set_event_enable(u32 h_control, u32 event_enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_GENERIC_EVENT_ENABLE,\r\n(u32)event_enable, 0);\r\n}\r\nu16 hpi_tone_detector_get_event_enable(u32 h_control, u32 *event_enable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_GENERIC_EVENT_ENABLE,\r\nevent_enable);\r\n}\r\nu16 hpi_tone_detector_set_threshold(u32 h_control, int threshold)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TONEDETECTOR_THRESHOLD,\r\n(u32)threshold, 0);\r\n}\r\nu16 hpi_tone_detector_get_threshold(u32 h_control, int *threshold)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TONEDETECTOR_THRESHOLD,\r\n(u32 *)threshold);\r\n}\r\nu16 hpi_silence_detector_get_state(u32 h_control, u32 *state)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_SILENCEDETECTOR_STATE,\r\nstate);\r\n}\r\nu16 hpi_silence_detector_set_enable(u32 h_control, u32 enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_GENERIC_ENABLE, enable,\r\n0);\r\n}\r\nu16 hpi_silence_detector_get_enable(u32 h_control, u32 *enable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_GENERIC_ENABLE, enable);\r\n}\r\nu16 hpi_silence_detector_set_event_enable(u32 h_control, u32 event_enable)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_GENERIC_EVENT_ENABLE,\r\nevent_enable, 0);\r\n}\r\nu16 hpi_silence_detector_get_event_enable(u32 h_control, u32 *event_enable)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_GENERIC_EVENT_ENABLE,\r\nevent_enable);\r\n}\r\nu16 hpi_silence_detector_set_delay(u32 h_control, u32 delay)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SILENCEDETECTOR_DELAY,\r\ndelay, 0);\r\n}\r\nu16 hpi_silence_detector_get_delay(u32 h_control, u32 *delay)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_SILENCEDETECTOR_DELAY,\r\ndelay);\r\n}\r\nu16 hpi_silence_detector_set_threshold(u32 h_control, int threshold)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_SILENCEDETECTOR_THRESHOLD,\r\nthreshold, 0);\r\n}\r\nu16 hpi_silence_detector_get_threshold(u32 h_control, int *threshold)\r\n{\r\nreturn hpi_control_param1_get(h_control,\r\nHPI_SILENCEDETECTOR_THRESHOLD, (u32 *)threshold);\r\n}\r\nu16 hpi_tuner_query_band(const u32 h_tuner, const u32 index, u16 *pw_band)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_tuner, HPI_TUNER_BAND, index, 0, &qr);\r\n*pw_band = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_tuner_set_band(u32 h_control, u16 band)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_BAND, band, 0);\r\n}\r\nu16 hpi_tuner_get_band(u32 h_control, u16 *pw_band)\r\n{\r\nu32 band = 0;\r\nu16 error = 0;\r\nerror = hpi_control_param1_get(h_control, HPI_TUNER_BAND, &band);\r\nif (pw_band)\r\n*pw_band = (u16)band;\r\nreturn error;\r\n}\r\nu16 hpi_tuner_query_frequency(const u32 h_tuner, const u32 index,\r\nconst u16 band, u32 *pfreq)\r\n{\r\nreturn hpi_control_query(h_tuner, HPI_TUNER_FREQ, index, band, pfreq);\r\n}\r\nu16 hpi_tuner_set_frequency(u32 h_control, u32 freq_ink_hz)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_FREQ, freq_ink_hz,\r\n0);\r\n}\r\nu16 hpi_tuner_get_frequency(u32 h_control, u32 *pw_freq_ink_hz)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TUNER_FREQ,\r\npw_freq_ink_hz);\r\n}\r\nu16 hpi_tuner_query_gain(const u32 h_tuner, const u32 index, u16 *pw_gain)\r\n{\r\nu32 qr;\r\nu16 err;\r\nerr = hpi_control_query(h_tuner, HPI_TUNER_BAND, index, 0, &qr);\r\n*pw_gain = (u16)qr;\r\nreturn err;\r\n}\r\nu16 hpi_tuner_set_gain(u32 h_control, short gain)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_GAIN, gain, 0);\r\n}\r\nu16 hpi_tuner_get_gain(u32 h_control, short *pn_gain)\r\n{\r\nu32 gain = 0;\r\nu16 error = 0;\r\nerror = hpi_control_param1_get(h_control, HPI_TUNER_GAIN, &gain);\r\nif (pn_gain)\r\n*pn_gain = (u16)gain;\r\nreturn error;\r\n}\r\nu16 hpi_tuner_get_rf_level(u32 h_control, short *pw_level)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.cu.attribute = HPI_TUNER_LEVEL_AVG;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_level)\r\n*pw_level = hr.u.cu.tuner.s_level;\r\nreturn hr.error;\r\n}\r\nu16 hpi_tuner_get_raw_rf_level(u32 h_control, short *pw_level)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.cu.attribute = HPI_TUNER_LEVEL_RAW;\r\nhpi_send_recv(&hm, &hr);\r\nif (pw_level)\r\n*pw_level = hr.u.cu.tuner.s_level;\r\nreturn hr.error;\r\n}\r\nu16 hpi_tuner_query_deemphasis(const u32 h_tuner, const u32 index,\r\nconst u16 band, u32 *pdeemphasis)\r\n{\r\nreturn hpi_control_query(h_tuner, HPI_TUNER_DEEMPHASIS, index, band,\r\npdeemphasis);\r\n}\r\nu16 hpi_tuner_set_deemphasis(u32 h_control, u32 deemphasis)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_DEEMPHASIS,\r\ndeemphasis, 0);\r\n}\r\nu16 hpi_tuner_get_deemphasis(u32 h_control, u32 *pdeemphasis)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TUNER_DEEMPHASIS,\r\npdeemphasis);\r\n}\r\nu16 hpi_tuner_query_program(const u32 h_tuner, u32 *pbitmap_program)\r\n{\r\nreturn hpi_control_query(h_tuner, HPI_TUNER_PROGRAM, 0, 0,\r\npbitmap_program);\r\n}\r\nu16 hpi_tuner_set_program(u32 h_control, u32 program)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_PROGRAM, program,\r\n0);\r\n}\r\nu16 hpi_tuner_get_program(u32 h_control, u32 *pprogram)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TUNER_PROGRAM, pprogram);\r\n}\r\nu16 hpi_tuner_get_hd_radio_dsp_version(u32 h_control, char *psz_dsp_version,\r\nconst u32 string_size)\r\n{\r\nreturn hpi_control_get_string(h_control,\r\nHPI_TUNER_HDRADIO_DSP_VERSION, psz_dsp_version, string_size);\r\n}\r\nu16 hpi_tuner_get_hd_radio_sdk_version(u32 h_control, char *psz_sdk_version,\r\nconst u32 string_size)\r\n{\r\nreturn hpi_control_get_string(h_control,\r\nHPI_TUNER_HDRADIO_SDK_VERSION, psz_sdk_version, string_size);\r\n}\r\nu16 hpi_tuner_get_status(u32 h_control, u16 *pw_status_mask, u16 *pw_status)\r\n{\r\nu32 status = 0;\r\nu16 error = 0;\r\nerror = hpi_control_param1_get(h_control, HPI_TUNER_STATUS, &status);\r\nif (pw_status) {\r\nif (!error) {\r\n*pw_status_mask = (u16)(status >> 16);\r\n*pw_status = (u16)(status & 0xFFFF);\r\n} else {\r\n*pw_status_mask = 0;\r\n*pw_status = 0;\r\n}\r\n}\r\nreturn error;\r\n}\r\nu16 hpi_tuner_set_mode(u32 h_control, u32 mode, u32 value)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_MODE, mode, value);\r\n}\r\nu16 hpi_tuner_get_mode(u32 h_control, u32 mode, u32 *pn_value)\r\n{\r\nreturn hpi_control_param_get(h_control, HPI_TUNER_MODE, mode, 0,\r\npn_value, NULL);\r\n}\r\nu16 hpi_tuner_get_hd_radio_signal_quality(u32 h_control, u32 *pquality)\r\n{\r\nreturn hpi_control_param1_get(h_control,\r\nHPI_TUNER_HDRADIO_SIGNAL_QUALITY, pquality);\r\n}\r\nu16 hpi_tuner_get_hd_radio_signal_blend(u32 h_control, u32 *pblend)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_TUNER_HDRADIO_BLEND,\r\npblend);\r\n}\r\nu16 hpi_tuner_set_hd_radio_signal_blend(u32 h_control, const u32 blend)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_TUNER_HDRADIO_BLEND,\r\nblend, 0);\r\n}\r\nu16 hpi_tuner_get_rds(u32 h_control, char *p_data)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_TUNER_RDS;\r\nhpi_send_recv(&hm, &hr);\r\nif (p_data) {\r\n*(u32 *)&p_data[0] = hr.u.cu.tuner.rds.data[0];\r\n*(u32 *)&p_data[4] = hr.u.cu.tuner.rds.data[1];\r\n*(u32 *)&p_data[8] = hr.u.cu.tuner.rds.bLER;\r\n}\r\nreturn hr.error;\r\n}\r\nu16 hpi_pad_get_channel_name(u32 h_control, char *psz_string,\r\nconst u32 data_length)\r\n{\r\nreturn hpi_control_get_string(h_control, HPI_PAD_CHANNEL_NAME,\r\npsz_string, data_length);\r\n}\r\nu16 hpi_pad_get_artist(u32 h_control, char *psz_string, const u32 data_length)\r\n{\r\nreturn hpi_control_get_string(h_control, HPI_PAD_ARTIST, psz_string,\r\ndata_length);\r\n}\r\nu16 hpi_pad_get_title(u32 h_control, char *psz_string, const u32 data_length)\r\n{\r\nreturn hpi_control_get_string(h_control, HPI_PAD_TITLE, psz_string,\r\ndata_length);\r\n}\r\nu16 hpi_pad_get_comment(u32 h_control, char *psz_string,\r\nconst u32 data_length)\r\n{\r\nreturn hpi_control_get_string(h_control, HPI_PAD_COMMENT, psz_string,\r\ndata_length);\r\n}\r\nu16 hpi_pad_get_program_type(u32 h_control, u32 *ppTY)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_PAD_PROGRAM_TYPE, ppTY);\r\n}\r\nu16 hpi_pad_get_rdsPI(u32 h_control, u32 *ppI)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_PAD_PROGRAM_ID, ppI);\r\n}\r\nu16 hpi_volume_query_channels(const u32 h_volume, u32 *p_channels)\r\n{\r\nreturn hpi_control_query(h_volume, HPI_VOLUME_NUM_CHANNELS, 0, 0,\r\np_channels);\r\n}\r\nu16 hpi_volume_set_gain(u32 h_control, short an_log_gain[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nreturn hpi_control_log_set2(h_control, HPI_VOLUME_GAIN,\r\nan_log_gain[0], an_log_gain[1]);\r\n}\r\nu16 hpi_volume_get_gain(u32 h_control, short an_log_gain[HPI_MAX_CHANNELS]\r\n)\r\n{\r\nreturn hpi_control_log_get2(h_control, HPI_VOLUME_GAIN,\r\n&an_log_gain[0], &an_log_gain[1]);\r\n}\r\nu16 hpi_volume_set_mute(u32 h_control, u32 mute)\r\n{\r\nreturn hpi_control_param_set(h_control, HPI_VOLUME_MUTE, mute, 0);\r\n}\r\nu16 hpi_volume_get_mute(u32 h_control, u32 *mute)\r\n{\r\nreturn hpi_control_param1_get(h_control, HPI_VOLUME_MUTE, mute);\r\n}\r\nu16 hpi_volume_query_range(u32 h_control, short *min_gain_01dB,\r\nshort *max_gain_01dB, short *step_gain_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_VOLUME_RANGE;\r\nhpi_send_recv(&hm, &hr);\r\nif (hr.error) {\r\nhr.u.c.an_log_value[0] = 0;\r\nhr.u.c.an_log_value[1] = 0;\r\nhr.u.c.param1 = 0;\r\n}\r\nif (min_gain_01dB)\r\n*min_gain_01dB = hr.u.c.an_log_value[0];\r\nif (max_gain_01dB)\r\n*max_gain_01dB = hr.u.c.an_log_value[1];\r\nif (step_gain_01dB)\r\n*step_gain_01dB = (short)hr.u.c.param1;\r\nreturn hr.error;\r\n}\r\nu16 hpi_volume_auto_fade_profile(u32 h_control,\r\nshort an_stop_gain0_01dB[HPI_MAX_CHANNELS], u32 duration_ms,\r\nu16 profile)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nmemcpy(hm.u.c.an_log_value, an_stop_gain0_01dB,\r\nsizeof(short) * HPI_MAX_CHANNELS);\r\nhm.u.c.attribute = HPI_VOLUME_AUTOFADE;\r\nhm.u.c.param1 = duration_ms;\r\nhm.u.c.param2 = profile;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_volume_auto_fade(u32 h_control,\r\nshort an_stop_gain0_01dB[HPI_MAX_CHANNELS], u32 duration_ms)\r\n{\r\nreturn hpi_volume_auto_fade_profile(h_control, an_stop_gain0_01dB,\r\nduration_ms, HPI_VOLUME_AUTOFADE_LOG);\r\n}\r\nu16 hpi_volume_query_auto_fade_profile(const u32 h_volume, const u32 i,\r\nu16 *profile)\r\n{\r\nu16 e;\r\nu32 u;\r\ne = hpi_control_query(h_volume, HPI_VOLUME_AUTOFADE, i, 0, &u);\r\n*profile = (u16)u;\r\nreturn e;\r\n}\r\nu16 hpi_vox_set_threshold(u32 h_control, short an_gain0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_SET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_VOX_THRESHOLD;\r\nhm.u.c.an_log_value[0] = an_gain0_01dB;\r\nhpi_send_recv(&hm, &hr);\r\nreturn hr.error;\r\n}\r\nu16 hpi_vox_get_threshold(u32 h_control, short *an_gain0_01dB)\r\n{\r\nstruct hpi_message hm;\r\nstruct hpi_response hr;\r\nhpi_init_message_response(&hm, &hr, HPI_OBJ_CONTROL,\r\nHPI_CONTROL_GET_STATE);\r\nif (hpi_handle_indexes(h_control, &hm.adapter_index, &hm.obj_index))\r\nreturn HPI_ERROR_INVALID_HANDLE;\r\nhm.u.c.attribute = HPI_VOX_THRESHOLD;\r\nhpi_send_recv(&hm, &hr);\r\n*an_gain0_01dB = hr.u.c.an_log_value[0];\r\nreturn hr.error;\r\n}
