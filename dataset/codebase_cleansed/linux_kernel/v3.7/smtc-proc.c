static int proc_read_smtc(char *page, char **start, off_t off,\r\nint count, int *eof, void *data)\r\n{\r\nint totalen = 0;\r\nint len;\r\nint i;\r\nextern unsigned long ebase;\r\nlen = sprintf(page, "SMTC Status Word: 0x%08x\n", smtc_status);\r\ntotalen += len;\r\npage += len;\r\nlen = sprintf(page, "Config7: 0x%08x\n", read_c0_config7());\r\ntotalen += len;\r\npage += len;\r\nlen = sprintf(page, "EBASE: 0x%08lx\n", ebase);\r\ntotalen += len;\r\npage += len;\r\nlen = sprintf(page, "Counter Interrupts taken per CPU (TC)\n");\r\ntotalen += len;\r\npage += len;\r\nfor (i=0; i < NR_CPUS; i++) {\r\nlen = sprintf(page, "%d: %ld\n", i, smtc_cpu_stats[i].timerints);\r\ntotalen += len;\r\npage += len;\r\n}\r\nlen = sprintf(page, "Self-IPIs by CPU:\n");\r\ntotalen += len;\r\npage += len;\r\nfor(i = 0; i < NR_CPUS; i++) {\r\nlen = sprintf(page, "%d: %ld\n", i, smtc_cpu_stats[i].selfipis);\r\ntotalen += len;\r\npage += len;\r\n}\r\nlen = sprintf(page, "%d Recoveries of \"stolen\" FPU\n",\r\natomic_read(&smtc_fpu_recoveries));\r\ntotalen += len;\r\npage += len;\r\nreturn totalen;\r\n}\r\nvoid init_smtc_stats(void)\r\n{\r\nint i;\r\nfor (i=0; i<NR_CPUS; i++) {\r\nsmtc_cpu_stats[i].timerints = 0;\r\nsmtc_cpu_stats[i].selfipis = 0;\r\n}\r\natomic_set(&smtc_fpu_recoveries, 0);\r\nsmtc_stats = create_proc_read_entry("smtc", 0444, NULL,\r\nproc_read_smtc, NULL);\r\n}
