static void\r\ns3c2412_irq_mask(struct irq_data *data)\r\n{\r\nunsigned long bitval = 1UL << (data->irq - IRQ_EINT0);\r\nunsigned long mask;\r\nmask = __raw_readl(S3C2410_INTMSK);\r\n__raw_writel(mask | bitval, S3C2410_INTMSK);\r\nmask = __raw_readl(S3C2412_EINTMASK);\r\n__raw_writel(mask | bitval, S3C2412_EINTMASK);\r\n}\r\nstatic inline void\r\ns3c2412_irq_ack(struct irq_data *data)\r\n{\r\nunsigned long bitval = 1UL << (data->irq - IRQ_EINT0);\r\n__raw_writel(bitval, S3C2412_EINTPEND);\r\n__raw_writel(bitval, S3C2410_SRCPND);\r\n__raw_writel(bitval, S3C2410_INTPND);\r\n}\r\nstatic inline void\r\ns3c2412_irq_maskack(struct irq_data *data)\r\n{\r\nunsigned long bitval = 1UL << (data->irq - IRQ_EINT0);\r\nunsigned long mask;\r\nmask = __raw_readl(S3C2410_INTMSK);\r\n__raw_writel(mask|bitval, S3C2410_INTMSK);\r\nmask = __raw_readl(S3C2412_EINTMASK);\r\n__raw_writel(mask | bitval, S3C2412_EINTMASK);\r\n__raw_writel(bitval, S3C2412_EINTPEND);\r\n__raw_writel(bitval, S3C2410_SRCPND);\r\n__raw_writel(bitval, S3C2410_INTPND);\r\n}\r\nstatic void\r\ns3c2412_irq_unmask(struct irq_data *data)\r\n{\r\nunsigned long bitval = 1UL << (data->irq - IRQ_EINT0);\r\nunsigned long mask;\r\nmask = __raw_readl(S3C2412_EINTMASK);\r\n__raw_writel(mask & ~bitval, S3C2412_EINTMASK);\r\nmask = __raw_readl(S3C2410_INTMSK);\r\n__raw_writel(mask & ~bitval, S3C2410_INTMSK);\r\n}\r\nstatic void s3c2412_irq_demux_cfsdi(unsigned int irq, struct irq_desc *desc)\r\n{\r\nunsigned int subsrc, submsk;\r\nsubsrc = __raw_readl(S3C2410_SUBSRCPND);\r\nsubmsk = __raw_readl(S3C2410_INTSUBMSK);\r\nsubsrc &= ~submsk;\r\nif (subsrc & INTBIT(IRQ_S3C2412_SDI))\r\ngeneric_handle_irq(IRQ_S3C2412_SDI);\r\nif (subsrc & INTBIT(IRQ_S3C2412_CF))\r\ngeneric_handle_irq(IRQ_S3C2412_CF);\r\n}\r\nstatic void s3c2412_irq_cfsdi_mask(struct irq_data *data)\r\n{\r\ns3c_irqsub_mask(data->irq, INTMSK_CFSDI, SUBMSK_CFSDI);\r\n}\r\nstatic void s3c2412_irq_cfsdi_unmask(struct irq_data *data)\r\n{\r\ns3c_irqsub_unmask(data->irq, INTMSK_CFSDI);\r\n}\r\nstatic void s3c2412_irq_cfsdi_ack(struct irq_data *data)\r\n{\r\ns3c_irqsub_maskack(data->irq, INTMSK_CFSDI, SUBMSK_CFSDI);\r\n}\r\nstatic int s3c2412_irq_rtc_wake(struct irq_data *data, unsigned int state)\r\n{\r\nunsigned long pwrcfg;\r\npwrcfg = __raw_readl(S3C2412_PWRCFG);\r\nif (state)\r\npwrcfg &= ~S3C2412_PWRCFG_RTC_MASKIRQ;\r\nelse\r\npwrcfg |= S3C2412_PWRCFG_RTC_MASKIRQ;\r\n__raw_writel(pwrcfg, S3C2412_PWRCFG);\r\nreturn s3c_irq_chip.irq_set_wake(data, state);\r\n}\r\nstatic int s3c2412_irq_add(struct device *dev, struct subsys_interface *sif)\r\n{\r\nunsigned int irqno;\r\nfor (irqno = IRQ_EINT0; irqno <= IRQ_EINT3; irqno++) {\r\nirq_set_chip_and_handler(irqno, &s3c2412_irq_eint0t4,\r\nhandle_edge_irq);\r\nset_irq_flags(irqno, IRQF_VALID);\r\n}\r\nirq_set_chained_handler(IRQ_S3C2412_CFSDI, s3c2412_irq_demux_cfsdi);\r\nfor (irqno = IRQ_S3C2412_SDI; irqno <= IRQ_S3C2412_CF; irqno++) {\r\nirq_set_chip_and_handler(irqno, &s3c2412_irq_cfsdi,\r\nhandle_level_irq);\r\nset_irq_flags(irqno, IRQF_VALID);\r\n}\r\ns3c2412_irq_rtc_chip = s3c_irq_chip;\r\ns3c2412_irq_rtc_chip.irq_set_wake = s3c2412_irq_rtc_wake;\r\nirq_set_chip(IRQ_RTC, &s3c2412_irq_rtc_chip);\r\nreturn 0;\r\n}\r\nstatic int s3c2412_irq_init(void)\r\n{\r\nreturn subsys_interface_register(&s3c2412_irq_interface);\r\n}
