unsigned long ltq_danube_fpi_hz(void)\r\n{\r\nunsigned long ddr_clock = DDR_HZ;\r\nif (ltq_cgu_r32(CGU_SYS) & 0x40)\r\nreturn ddr_clock >> 1;\r\nreturn ddr_clock;\r\n}\r\nunsigned long ltq_danube_cpu_hz(void)\r\n{\r\nswitch (ltq_cgu_r32(CGU_SYS) & 0xc) {\r\ncase 0:\r\nreturn CLOCK_333M;\r\ncase 4:\r\nreturn DDR_HZ;\r\ncase 8:\r\nreturn DDR_HZ << 1;\r\ndefault:\r\nreturn DDR_HZ >> 1;\r\n}\r\n}\r\nunsigned long ltq_ar9_sys_hz(void)\r\n{\r\nif (((ltq_cgu_r32(CGU_SYS) >> 3) & 0x3) == 0x2)\r\nreturn CLOCK_393M;\r\nreturn CLOCK_333M;\r\n}\r\nunsigned long ltq_ar9_fpi_hz(void)\r\n{\r\nunsigned long sys = ltq_ar9_sys_hz();\r\nif (ltq_cgu_r32(CGU_SYS) & BIT(0))\r\nreturn sys;\r\nreturn sys >> 1;\r\n}\r\nunsigned long ltq_ar9_cpu_hz(void)\r\n{\r\nif (ltq_cgu_r32(CGU_SYS) & BIT(2))\r\nreturn ltq_ar9_fpi_hz();\r\nelse\r\nreturn ltq_ar9_sys_hz();\r\n}\r\nunsigned long ltq_vr9_cpu_hz(void)\r\n{\r\nunsigned int cpu_sel;\r\nunsigned long clk;\r\ncpu_sel = (ltq_cgu_r32(CGU_SYS_VR9) >> 4) & 0xf;\r\nswitch (cpu_sel) {\r\ncase 0:\r\nclk = CLOCK_600M;\r\nbreak;\r\ncase 1:\r\nclk = CLOCK_500M;\r\nbreak;\r\ncase 2:\r\nclk = CLOCK_393M;\r\nbreak;\r\ncase 3:\r\nclk = CLOCK_333M;\r\nbreak;\r\ncase 5:\r\ncase 6:\r\nclk = CLOCK_196_608M;\r\nbreak;\r\ncase 7:\r\nclk = CLOCK_167M;\r\nbreak;\r\ncase 4:\r\ncase 8:\r\ncase 9:\r\nclk = CLOCK_125M;\r\nbreak;\r\ndefault:\r\nclk = 0;\r\nbreak;\r\n}\r\nreturn clk;\r\n}\r\nunsigned long ltq_vr9_fpi_hz(void)\r\n{\r\nunsigned int ocp_sel, cpu_clk;\r\nunsigned long clk;\r\ncpu_clk = ltq_vr9_cpu_hz();\r\nocp_sel = ltq_cgu_r32(CGU_SYS_VR9) & 0x3;\r\nswitch (ocp_sel) {\r\ncase 0:\r\nclk = cpu_clk;\r\nbreak;\r\ncase 2:\r\nclk = cpu_clk / 2;\r\nbreak;\r\ncase 3:\r\nclk = (cpu_clk * 2) / 5;\r\nbreak;\r\ncase 4:\r\nclk = cpu_clk / 3;\r\nbreak;\r\ndefault:\r\nclk = 0;\r\nbreak;\r\n}\r\nreturn clk;\r\n}
