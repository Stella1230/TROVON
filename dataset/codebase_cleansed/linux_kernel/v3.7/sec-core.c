int sec_reg_read(struct sec_pmic_dev *sec_pmic, u8 reg, void *dest)\r\n{\r\nreturn regmap_read(sec_pmic->regmap, reg, dest);\r\n}\r\nint sec_bulk_read(struct sec_pmic_dev *sec_pmic, u8 reg, int count, u8 *buf)\r\n{\r\nreturn regmap_bulk_read(sec_pmic->regmap, reg, buf, count);\r\n}\r\nint sec_reg_write(struct sec_pmic_dev *sec_pmic, u8 reg, u8 value)\r\n{\r\nreturn regmap_write(sec_pmic->regmap, reg, value);\r\n}\r\nint sec_bulk_write(struct sec_pmic_dev *sec_pmic, u8 reg, int count, u8 *buf)\r\n{\r\nreturn regmap_raw_write(sec_pmic->regmap, reg, buf, count);\r\n}\r\nint sec_reg_update(struct sec_pmic_dev *sec_pmic, u8 reg, u8 val, u8 mask)\r\n{\r\nreturn regmap_update_bits(sec_pmic->regmap, reg, mask, val);\r\n}\r\nstatic int sec_pmic_probe(struct i2c_client *i2c,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct sec_platform_data *pdata = i2c->dev.platform_data;\r\nstruct sec_pmic_dev *sec_pmic;\r\nint ret;\r\nsec_pmic = devm_kzalloc(&i2c->dev, sizeof(struct sec_pmic_dev),\r\nGFP_KERNEL);\r\nif (sec_pmic == NULL)\r\nreturn -ENOMEM;\r\ni2c_set_clientdata(i2c, sec_pmic);\r\nsec_pmic->dev = &i2c->dev;\r\nsec_pmic->i2c = i2c;\r\nsec_pmic->irq = i2c->irq;\r\nsec_pmic->type = id->driver_data;\r\nif (pdata) {\r\nsec_pmic->device_type = pdata->device_type;\r\nsec_pmic->ono = pdata->ono;\r\nsec_pmic->irq_base = pdata->irq_base;\r\nsec_pmic->wakeup = pdata->wakeup;\r\n}\r\nsec_pmic->regmap = devm_regmap_init_i2c(i2c, &sec_regmap_config);\r\nif (IS_ERR(sec_pmic->regmap)) {\r\nret = PTR_ERR(sec_pmic->regmap);\r\ndev_err(&i2c->dev, "Failed to allocate register map: %d\n",\r\nret);\r\nreturn ret;\r\n}\r\nsec_pmic->rtc = i2c_new_dummy(i2c->adapter, RTC_I2C_ADDR);\r\ni2c_set_clientdata(sec_pmic->rtc, sec_pmic);\r\nif (pdata && pdata->cfg_pmic_irq)\r\npdata->cfg_pmic_irq();\r\nsec_irq_init(sec_pmic);\r\npm_runtime_set_active(sec_pmic->dev);\r\nswitch (sec_pmic->device_type) {\r\ncase S5M8751X:\r\nret = mfd_add_devices(sec_pmic->dev, -1, s5m8751_devs,\r\nARRAY_SIZE(s5m8751_devs), NULL, 0, NULL);\r\nbreak;\r\ncase S5M8763X:\r\nret = mfd_add_devices(sec_pmic->dev, -1, s5m8763_devs,\r\nARRAY_SIZE(s5m8763_devs), NULL, 0, NULL);\r\nbreak;\r\ncase S5M8767X:\r\nret = mfd_add_devices(sec_pmic->dev, -1, s5m8767_devs,\r\nARRAY_SIZE(s5m8767_devs), NULL, 0, NULL);\r\nbreak;\r\ncase S2MPS11X:\r\nret = mfd_add_devices(sec_pmic->dev, -1, s2mps11_devs,\r\nARRAY_SIZE(s2mps11_devs), NULL, 0, NULL);\r\nbreak;\r\ndefault:\r\nBUG();\r\n}\r\nif (ret < 0)\r\ngoto err;\r\nreturn ret;\r\nerr:\r\nmfd_remove_devices(sec_pmic->dev);\r\nsec_irq_exit(sec_pmic);\r\ni2c_unregister_device(sec_pmic->rtc);\r\nreturn ret;\r\n}\r\nstatic int sec_pmic_remove(struct i2c_client *i2c)\r\n{\r\nstruct sec_pmic_dev *sec_pmic = i2c_get_clientdata(i2c);\r\nmfd_remove_devices(sec_pmic->dev);\r\nsec_irq_exit(sec_pmic);\r\ni2c_unregister_device(sec_pmic->rtc);\r\nreturn 0;\r\n}\r\nstatic int __init sec_pmic_init(void)\r\n{\r\nreturn i2c_add_driver(&sec_pmic_driver);\r\n}\r\nstatic void __exit sec_pmic_exit(void)\r\n{\r\ni2c_del_driver(&sec_pmic_driver);\r\n}
