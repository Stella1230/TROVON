static void appldata_get_mem_data(void *data)\r\n{\r\nstatic struct sysinfo val;\r\nunsigned long ev[NR_VM_EVENT_ITEMS];\r\nstruct appldata_mem_data *mem_data;\r\nmem_data = data;\r\nmem_data->sync_count_1++;\r\nall_vm_events(ev);\r\nmem_data->pgpgin = ev[PGPGIN] >> 1;\r\nmem_data->pgpgout = ev[PGPGOUT] >> 1;\r\nmem_data->pswpin = ev[PSWPIN];\r\nmem_data->pswpout = ev[PSWPOUT];\r\nmem_data->pgalloc = ev[PGALLOC_NORMAL];\r\nmem_data->pgalloc += ev[PGALLOC_DMA];\r\nmem_data->pgfault = ev[PGFAULT];\r\nmem_data->pgmajfault = ev[PGMAJFAULT];\r\nsi_meminfo(&val);\r\nmem_data->sharedram = val.sharedram;\r\nmem_data->totalram = P2K(val.totalram);\r\nmem_data->freeram = P2K(val.freeram);\r\nmem_data->totalhigh = P2K(val.totalhigh);\r\nmem_data->freehigh = P2K(val.freehigh);\r\nmem_data->bufferram = P2K(val.bufferram);\r\nmem_data->cached = P2K(global_page_state(NR_FILE_PAGES)\r\n- val.bufferram);\r\nsi_swapinfo(&val);\r\nmem_data->totalswap = P2K(val.totalswap);\r\nmem_data->freeswap = P2K(val.freeswap);\r\nmem_data->timestamp = get_clock();\r\nmem_data->sync_count_2++;\r\n}\r\nstatic int __init appldata_mem_init(void)\r\n{\r\nreturn appldata_register_ops(&ops);\r\n}\r\nstatic void __exit appldata_mem_exit(void)\r\n{\r\nappldata_unregister_ops(&ops);\r\n}
