static int get_mx51_srev(void)\r\n{\r\nvoid __iomem *iim_base = MX51_IO_ADDRESS(MX51_IIM_BASE_ADDR);\r\nu32 rev = readl(iim_base + IIM_SREV) & 0xff;\r\nswitch (rev) {\r\ncase 0x0:\r\nreturn IMX_CHIP_REVISION_2_0;\r\ncase 0x10:\r\nreturn IMX_CHIP_REVISION_3_0;\r\ndefault:\r\nreturn IMX_CHIP_REVISION_UNKNOWN;\r\n}\r\n}\r\nint mx51_revision(void)\r\n{\r\nif (!cpu_is_mx51())\r\nreturn -EINVAL;\r\nif (mx5_cpu_rev == -1)\r\nmx5_cpu_rev = get_mx51_srev();\r\nreturn mx5_cpu_rev;\r\n}\r\nint __init mx51_neon_fixup(void)\r\n{\r\nif (mx51_revision() < IMX_CHIP_REVISION_3_0 &&\r\n(elf_hwcap & HWCAP_NEON)) {\r\nelf_hwcap &= ~HWCAP_NEON;\r\npr_info("Turning off NEON support, detected broken NEON implementation\n");\r\n}\r\nreturn 0;\r\n}\r\nstatic int get_mx53_srev(void)\r\n{\r\nvoid __iomem *iim_base = MX51_IO_ADDRESS(MX53_IIM_BASE_ADDR);\r\nu32 rev = readl(iim_base + IIM_SREV) & 0xff;\r\nswitch (rev) {\r\ncase 0x0:\r\nreturn IMX_CHIP_REVISION_1_0;\r\ncase 0x2:\r\nreturn IMX_CHIP_REVISION_2_0;\r\ncase 0x3:\r\nreturn IMX_CHIP_REVISION_2_1;\r\ndefault:\r\nreturn IMX_CHIP_REVISION_UNKNOWN;\r\n}\r\n}\r\nint mx53_revision(void)\r\n{\r\nif (!cpu_is_mx53())\r\nreturn -EINVAL;\r\nif (mx5_cpu_rev == -1)\r\nmx5_cpu_rev = get_mx53_srev();\r\nreturn mx5_cpu_rev;\r\n}\r\nstatic int get_mx50_srev(void)\r\n{\r\nvoid __iomem *anatop = ioremap(MX50_ANATOP_BASE_ADDR, SZ_8K);\r\nu32 rev;\r\nif (!anatop) {\r\nmx5_cpu_rev = -EINVAL;\r\nreturn 0;\r\n}\r\nrev = readl(anatop + MX50_HW_ADADIG_DIGPROG);\r\nrev &= 0xff;\r\niounmap(anatop);\r\nif (rev == 0x0)\r\nreturn IMX_CHIP_REVISION_1_0;\r\nelse if (rev == 0x1)\r\nreturn IMX_CHIP_REVISION_1_1;\r\nreturn 0;\r\n}\r\nint mx50_revision(void)\r\n{\r\nif (!cpu_is_mx50())\r\nreturn -EINVAL;\r\nif (mx5_cpu_rev == -1)\r\nmx5_cpu_rev = get_mx50_srev();\r\nreturn mx5_cpu_rev;\r\n}
