static int __init add_rtc(void)\r\n{\r\nstruct device_node *np;\r\nstruct platform_device *pd;\r\nstruct resource res[2];\r\nunsigned int num_res = 1;\r\nint ret;\r\nmemset(&res, 0, sizeof(res));\r\nnp = of_find_compatible_node(NULL, NULL, "pnpPNP,b00");\r\nif (!np)\r\nreturn -ENODEV;\r\nret = of_address_to_resource(np, 0, &res[0]);\r\nof_node_put(np);\r\nif (ret)\r\nreturn ret;\r\nif (res[0].start != RTC_PORT(0))\r\nreturn -EINVAL;\r\nnp = of_find_compatible_node(NULL, NULL, "chrp,iic");\r\nif (!np)\r\nnp = of_find_compatible_node(NULL, NULL, "pnpPNP,000");\r\nif (np) {\r\nof_node_put(np);\r\nres[1].start = 8;\r\nres[1].end = 8;\r\nres[1].flags = IORESOURCE_IRQ;\r\nnum_res++;\r\n}\r\npd = platform_device_register_simple("rtc_cmos", -1,\r\n&res[0], num_res);\r\nif (IS_ERR(pd))\r\nreturn PTR_ERR(pd);\r\nreturn 0;\r\n}
