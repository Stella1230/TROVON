static int nfsd_inject_set(void *op_ptr, u64 val)\r\n{\r\nstruct nfsd_fault_inject_op *op = op_ptr;\r\nif (val == 0)\r\nprintk(KERN_INFO "NFSD Fault Injection: %s (all)", op->file);\r\nelse\r\nprintk(KERN_INFO "NFSD Fault Injection: %s (n = %llu)", op->file, val);\r\nop->func(val);\r\nreturn 0;\r\n}\r\nstatic int nfsd_inject_get(void *data, u64 *val)\r\n{\r\n*val = 0;\r\nreturn 0;\r\n}\r\nvoid nfsd_fault_inject_cleanup(void)\r\n{\r\ndebugfs_remove_recursive(debug_dir);\r\n}\r\nint nfsd_fault_inject_init(void)\r\n{\r\nunsigned int i;\r\nstruct nfsd_fault_inject_op *op;\r\numode_t mode = S_IFREG | S_IRUSR | S_IWUSR;\r\ndebug_dir = debugfs_create_dir("nfsd", NULL);\r\nif (!debug_dir)\r\ngoto fail;\r\nfor (i = 0; i < NUM_INJECT_OPS; i++) {\r\nop = &inject_ops[i];\r\nif (!debugfs_create_file(op->file, mode, debug_dir, op, &fops_nfsd))\r\ngoto fail;\r\n}\r\nreturn 0;\r\nfail:\r\nnfsd_fault_inject_cleanup();\r\nreturn -ENOMEM;\r\n}
