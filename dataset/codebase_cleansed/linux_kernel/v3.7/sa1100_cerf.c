static int cerf_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\r\n{\r\nint ret;\r\nret = gpio_request_one(CERF_GPIO_CF_RESET, GPIOF_OUT_INIT_LOW, "CF_RESET");\r\nif (ret)\r\nreturn ret;\r\nskt->stat[SOC_STAT_CD].gpio = CERF_GPIO_CF_CD;\r\nskt->stat[SOC_STAT_CD].name = "CF_CD";\r\nskt->stat[SOC_STAT_BVD1].gpio = CERF_GPIO_CF_BVD1;\r\nskt->stat[SOC_STAT_BVD1].name = "CF_BVD1";\r\nskt->stat[SOC_STAT_BVD2].gpio = CERF_GPIO_CF_BVD2;\r\nskt->stat[SOC_STAT_BVD2].name = "CF_BVD2";\r\nskt->stat[SOC_STAT_RDY].gpio = CERF_GPIO_CF_IRQ;\r\nskt->stat[SOC_STAT_RDY].name = "CF_IRQ";\r\nreturn 0;\r\n}\r\nstatic void cerf_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\r\n{\r\ngpio_free(CERF_GPIO_CF_RESET);\r\n}\r\nstatic void\r\ncerf_pcmcia_socket_state(struct soc_pcmcia_socket *skt, struct pcmcia_state *state)\r\n{\r\nstate->vs_3v = 1;\r\nstate->vs_Xv = 0;\r\n}\r\nstatic int\r\ncerf_pcmcia_configure_socket(struct soc_pcmcia_socket *skt,\r\nconst socket_state_t *state)\r\n{\r\nswitch (state->Vcc) {\r\ncase 0:\r\ncase 50:\r\ncase 33:\r\nbreak;\r\ndefault:\r\nprintk(KERN_ERR "%s(): unrecognized Vcc %u\n",\r\n__func__, state->Vcc);\r\nreturn -1;\r\n}\r\ngpio_set_value(CERF_GPIO_CF_RESET, !!(state->flags & SS_RESET));\r\nreturn 0;\r\n}\r\nint __devinit pcmcia_cerf_init(struct device *dev)\r\n{\r\nint ret = -ENODEV;\r\nif (machine_is_cerf())\r\nret = sa11xx_drv_pcmcia_probe(dev, &cerf_pcmcia_ops, CERF_SOCKET, 1);\r\nreturn ret;\r\n}
