static inline void unmask_msp_slp_irq(struct irq_data *d)\r\n{\r\nunsigned int irq = d->irq;\r\nif (irq < MSP_PER_INTBASE)\r\n*SLP_INT_MSK_REG |= (1 << (irq - MSP_SLP_INTBASE));\r\nelse\r\n*PER_INT_MSK_REG |= (1 << (irq - MSP_PER_INTBASE));\r\n}\r\nstatic inline void mask_msp_slp_irq(struct irq_data *d)\r\n{\r\nunsigned int irq = d->irq;\r\nif (irq < MSP_PER_INTBASE)\r\n*SLP_INT_MSK_REG &= ~(1 << (irq - MSP_SLP_INTBASE));\r\nelse\r\n*PER_INT_MSK_REG &= ~(1 << (irq - MSP_PER_INTBASE));\r\n}\r\nstatic inline void ack_msp_slp_irq(struct irq_data *d)\r\n{\r\nunsigned int irq = d->irq;\r\nif (irq < MSP_PER_INTBASE)\r\n*SLP_INT_STS_REG = (1 << (irq - MSP_SLP_INTBASE));\r\nelse\r\n*PER_INT_STS_REG = (1 << (irq - MSP_PER_INTBASE));\r\n}\r\nvoid __init msp_slp_irq_init(void)\r\n{\r\nint i;\r\n*SLP_INT_MSK_REG = 0x00000000;\r\n*PER_INT_MSK_REG = 0x00000000;\r\n*SLP_INT_STS_REG = 0xFFFFFFFF;\r\n*PER_INT_STS_REG = 0xFFFFFFFF;\r\nfor (i = MSP_SLP_INTBASE; i < MSP_PER_INTBASE + 32; i++)\r\nirq_set_chip_and_handler(i, &msp_slp_irq_controller,\r\nhandle_level_irq);\r\n}\r\nvoid msp_slp_irq_dispatch(void)\r\n{\r\nu32 pending;\r\nint intbase;\r\nintbase = MSP_SLP_INTBASE;\r\npending = *SLP_INT_STS_REG & *SLP_INT_MSK_REG;\r\nif (pending == (1 << (MSP_INT_PER - MSP_SLP_INTBASE))) {\r\nintbase = MSP_PER_INTBASE;\r\npending = *PER_INT_STS_REG & *PER_INT_MSK_REG;\r\n}\r\nif (pending == 0x00000000) {\r\nprintk(KERN_ERR "Spurious %s interrupt?\n",\r\n(intbase == MSP_SLP_INTBASE) ? "SLP" : "PER");\r\nreturn;\r\n}\r\ndo_IRQ(ffs(pending) + intbase - 1);\r\n}
