void winview_volume(struct bttv *btv, __u16 volume)\r\n{\r\nint bits_out, loops, vol, data;\r\nvol = 32 - ((volume>>11));\r\nbits_out = (PT2254_DBS_IN_2>>(vol%5));\r\nbits_out |= (PT2254_DBS_IN_10>>(vol/5));\r\nbits_out |= PT2254_L_CHANNEL | PT2254_R_CHANNEL;\r\ndata = gpio_read();\r\ndata &= ~(WINVIEW_PT2254_CLK| WINVIEW_PT2254_DATA|\r\nWINVIEW_PT2254_STROBE);\r\nfor (loops = 17; loops >= 0 ; loops--) {\r\nif (bits_out & (1<<loops))\r\ndata |= WINVIEW_PT2254_DATA;\r\nelse\r\ndata &= ~WINVIEW_PT2254_DATA;\r\ngpio_write(data);\r\nudelay(5);\r\ndata |= WINVIEW_PT2254_CLK;\r\ngpio_write(data);\r\nudelay(5);\r\ndata &= ~WINVIEW_PT2254_CLK;\r\ngpio_write(data);\r\n}\r\ndata |= WINVIEW_PT2254_STROBE;\r\ndata &= ~WINVIEW_PT2254_DATA;\r\ngpio_write(data);\r\nudelay(10);\r\ndata &= ~WINVIEW_PT2254_STROBE;\r\ngpio_write(data);\r\n}\r\nvoid gvbctv3pci_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int con = 0;\r\nif (set) {\r\ngpio_inout(0x300, 0x300);\r\nif (t->audmode & V4L2_TUNER_MODE_LANG1)\r\ncon = 0x000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\ncon = 0x300;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\ncon = 0x200;\r\ngpio_bits(0x300, con);\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid gvbctv5pci_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int val, con;\r\nif (btv->radio_user)\r\nreturn;\r\nval = gpio_read();\r\nif (set) {\r\ncon = 0x000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2) {\r\nif (t->audmode & V4L2_TUNER_MODE_LANG1) {\r\ncon = 0x100;\r\n}\r\nelse {\r\ncon = 0x300;\r\n}\r\n}\r\nif (con != (val & 0x300)) {\r\ngpio_bits(0x300, con);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"gvbctv5pci");\r\n}\r\n} else {\r\nswitch (val & 0x70) {\r\ncase 0x10:\r\nt->rxsubchans = V4L2_TUNER_SUB_LANG1 | V4L2_TUNER_SUB_LANG2;\r\nbreak;\r\ncase 0x30:\r\nt->rxsubchans = V4L2_TUNER_SUB_LANG2;\r\nbreak;\r\ncase 0x50:\r\nt->rxsubchans = V4L2_TUNER_SUB_LANG1;\r\nbreak;\r\ncase 0x60:\r\nt->rxsubchans = V4L2_TUNER_SUB_STEREO;\r\nbreak;\r\ncase 0x70:\r\nt->rxsubchans = V4L2_TUNER_SUB_MONO;\r\nbreak;\r\ndefault:\r\nt->rxsubchans = V4L2_TUNER_SUB_MONO |\r\nV4L2_TUNER_SUB_STEREO |\r\nV4L2_TUNER_SUB_LANG1 |\r\nV4L2_TUNER_SUB_LANG2;\r\n}\r\nt->audmode = V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid avermedia_tvphone_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nint val = 0;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\nval = 0x02;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\nval = 0x01;\r\nif (val) {\r\ngpio_bits(0x03,val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"avermedia");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1;\r\nreturn;\r\n}\r\n}\r\nvoid avermedia_tv_stereo_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nint val = 0;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\nval = 0x01;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\nval = 0x02;\r\nbtaor(val, ~0x03, BT848_GPIO_DATA);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"avermedia");\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\nreturn;\r\n}\r\n}\r\nvoid lt9415_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nint val = 0;\r\nif (gpio_read() & 0x4000) {\r\nt->audmode = V4L2_TUNER_MODE_MONO;\r\nreturn;\r\n}\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\nval = 0x0080;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\nval = 0x0880;\r\nif ((t->audmode & V4L2_TUNER_MODE_LANG1) ||\r\n(t->audmode & V4L2_TUNER_MODE_MONO))\r\nval = 0;\r\ngpio_bits(0x0880, val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"lt9415");\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\nreturn;\r\n}\r\n}\r\nvoid terratv_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int con = 0;\r\nif (set) {\r\ngpio_inout(0x180000,0x180000);\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\ncon = 0x080000;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\ncon = 0x180000;\r\ngpio_bits(0x180000, con);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"terratv");\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid winfast2000_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned long val = 0;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_MONO)\r\nval = 0x420000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG1)\r\nval = 0x420000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\nval = 0x410000;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\nval = 0x020000;\r\nif (val) {\r\ngpio_bits(0x430000, val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"winfast2000");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid pvbt878p9b_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int val = 0;\r\nif (btv->radio_user)\r\nreturn;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_MONO) {\r\nval = 0x01;\r\n}\r\nif ((t->audmode & (V4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2))\r\n|| (t->audmode & V4L2_TUNER_MODE_STEREO)) {\r\nval = 0x02;\r\n}\r\nif (val) {\r\ngpio_bits(0x03,val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"pvbt878p9b");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid fv2000s_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int val = 0xffff;\r\nif (btv->radio_user)\r\nreturn;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_MONO) {\r\nval = 0x0000;\r\n}\r\nif ((t->audmode & (V4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2))\r\n|| (t->audmode & V4L2_TUNER_MODE_STEREO)) {\r\nval = 0x1080;\r\n}\r\nif (val != 0xffff) {\r\ngpio_bits(0x1800, val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"fv2000s");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid windvr_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned long val = 0;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_MONO)\r\nval = 0x040000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG1)\r\nval = 0;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\nval = 0x100000;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\nval = 0;\r\nif (val) {\r\ngpio_bits(0x140000, val);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv,"windvr");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}\r\nvoid adtvk503_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\r\n{\r\nunsigned int con = 0xffffff;\r\nif (set) {\r\nif (t->audmode & V4L2_TUNER_MODE_LANG1)\r\ncon = 0x00000000;\r\nif (t->audmode & V4L2_TUNER_MODE_LANG2)\r\ncon = 0x00180000;\r\nif (t->audmode & V4L2_TUNER_MODE_STEREO)\r\ncon = 0x00000000;\r\nif (t->audmode & V4L2_TUNER_MODE_MONO)\r\ncon = 0x00060000;\r\nif (con != 0xffffff) {\r\ngpio_bits(0x1e0000,con);\r\nif (bttv_gpio)\r\nbttv_gpio_tracking(btv, "adtvk503");\r\n}\r\n} else {\r\nt->audmode = V4L2_TUNER_MODE_MONO | V4L2_TUNER_MODE_STEREO |\r\nV4L2_TUNER_MODE_LANG1 | V4L2_TUNER_MODE_LANG2;\r\n}\r\n}
