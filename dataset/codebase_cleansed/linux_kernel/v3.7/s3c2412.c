static inline void s3c2412_init_gpio2(void)\r\n{\r\ns3c24xx_va_gpio2 = S3C24XX_VA_GPIO + 0x10;\r\n}\r\nvoid __init s3c2412_init_uarts(struct s3c2410_uartcfg *cfg, int no)\r\n{\r\ns3c24xx_init_uartdevs("s3c2412-uart", s3c2410_uart_resources, cfg, no);\r\ns3c_device_sdi.name = "s3c2412-sdi";\r\ns3c_device_lcd.name = "s3c2412-lcd";\r\ns3c_nand_setname("s3c2412-nand");\r\ns3c_device_sdi.resource[1].start = IRQ_S3C2412_SDI;\r\ns3c_device_sdi.resource[1].end = IRQ_S3C2412_SDI;\r\ns3c_device_spi0.name = "s3c2412-spi";\r\ns3c_device_spi0.resource[0].end = S3C24XX_PA_SPI + 0x24;\r\ns3c_device_spi1.name = "s3c2412-spi";\r\ns3c_device_spi1.resource[0].start = S3C24XX_PA_SPI + S3C2412_SPI1;\r\ns3c_device_spi1.resource[0].end = S3C24XX_PA_SPI + S3C2412_SPI1 + 0x24;\r\n}\r\nstatic void s3c2412_idle(void)\r\n{\r\nunsigned long tmp;\r\ntmp = __raw_readl(S3C2412_PWRCFG);\r\ntmp &= ~S3C2412_PWRCFG_STANDBYWFI_MASK;\r\ntmp |= S3C2412_PWRCFG_STANDBYWFI_IDLE;\r\n__raw_writel(tmp, S3C2412_PWRCFG);\r\ncpu_do_idle();\r\n}\r\nvoid s3c2412_restart(char mode, const char *cmd)\r\n{\r\nif (mode == 's')\r\nsoft_restart(0);\r\n__raw_writel(0x00, S3C2412_CLKSRC);\r\n__raw_writel(S3C2412_SWRST_RESET, S3C2412_SWRST);\r\nmdelay(1);\r\n}\r\nvoid __init s3c2412_map_io(void)\r\n{\r\ns3c2412_init_gpio2();\r\narm_pm_idle = s3c2412_idle;\r\niotable_init(s3c2412_iodesc, ARRAY_SIZE(s3c2412_iodesc));\r\n}\r\nvoid __init_or_cpufreq s3c2412_setup_clocks(void)\r\n{\r\nstruct clk *xtal_clk;\r\nunsigned long tmp;\r\nunsigned long xtal;\r\nunsigned long fclk;\r\nunsigned long hclk;\r\nunsigned long pclk;\r\nxtal_clk = clk_get(NULL, "xtal");\r\nxtal = clk_get_rate(xtal_clk);\r\nclk_put(xtal_clk);\r\nfclk = s3c24xx_get_pll(__raw_readl(S3C2410_MPLLCON), xtal * 2);\r\nclk_mpll.rate = fclk;\r\ntmp = __raw_readl(S3C2410_CLKDIVN);\r\nhclk = fclk / ((tmp & S3C2412_CLKDIVN_HDIVN_MASK) + 1);\r\nhclk /= ((tmp & S3C2412_CLKDIVN_ARMDIVN) ? 2 : 1);\r\npclk = hclk / ((tmp & S3C2412_CLKDIVN_PDIVN) ? 2 : 1);\r\nprintk("S3C2412: core %ld.%03ld MHz, memory %ld.%03ld MHz, peripheral %ld.%03ld MHz\n",\r\nprint_mhz(fclk), print_mhz(hclk), print_mhz(pclk));\r\ns3c24xx_setup_clocks(fclk, hclk, pclk);\r\n}\r\nvoid __init s3c2412_init_clocks(int xtal)\r\n{\r\ns3c24xx_register_baseclocks(xtal);\r\ns3c2412_setup_clocks();\r\ns3c2412_baseclk_add();\r\n}\r\nstatic int __init s3c2412_core_init(void)\r\n{\r\nreturn subsys_system_register(&s3c2412_subsys, NULL);\r\n}\r\nint __init s3c2412_init(void)\r\n{\r\nprintk("S3C2412: Initialising architecture\n");\r\n#ifdef CONFIG_PM\r\nregister_syscore_ops(&s3c2412_pm_syscore_ops);\r\n#endif\r\nregister_syscore_ops(&s3c24xx_irq_syscore_ops);\r\nreturn device_register(&s3c2412_dev);\r\n}
