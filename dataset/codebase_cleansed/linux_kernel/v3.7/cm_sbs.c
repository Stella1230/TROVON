struct proc_dir_entry *acpi_lock_ac_dir(void)\r\n{\r\nmutex_lock(&cm_sbs_mutex);\r\nif (!acpi_ac_dir)\r\nacpi_ac_dir = proc_mkdir(ACPI_AC_CLASS, acpi_root_dir);\r\nif (acpi_ac_dir) {\r\nlock_ac_dir_cnt++;\r\n} else {\r\nprintk(KERN_ERR PREFIX\r\n"Cannot create %s\n", ACPI_AC_CLASS);\r\n}\r\nmutex_unlock(&cm_sbs_mutex);\r\nreturn acpi_ac_dir;\r\n}\r\nvoid acpi_unlock_ac_dir(struct proc_dir_entry *acpi_ac_dir_param)\r\n{\r\nmutex_lock(&cm_sbs_mutex);\r\nif (acpi_ac_dir_param)\r\nlock_ac_dir_cnt--;\r\nif (lock_ac_dir_cnt == 0 && acpi_ac_dir_param && acpi_ac_dir) {\r\nremove_proc_entry(ACPI_AC_CLASS, acpi_root_dir);\r\nacpi_ac_dir = NULL;\r\n}\r\nmutex_unlock(&cm_sbs_mutex);\r\n}\r\nstruct proc_dir_entry *acpi_lock_battery_dir(void)\r\n{\r\nmutex_lock(&cm_sbs_mutex);\r\nif (!acpi_battery_dir) {\r\nacpi_battery_dir =\r\nproc_mkdir(ACPI_BATTERY_CLASS, acpi_root_dir);\r\n}\r\nif (acpi_battery_dir) {\r\nlock_battery_dir_cnt++;\r\n} else {\r\nprintk(KERN_ERR PREFIX\r\n"Cannot create %s\n", ACPI_BATTERY_CLASS);\r\n}\r\nmutex_unlock(&cm_sbs_mutex);\r\nreturn acpi_battery_dir;\r\n}\r\nvoid acpi_unlock_battery_dir(struct proc_dir_entry *acpi_battery_dir_param)\r\n{\r\nmutex_lock(&cm_sbs_mutex);\r\nif (acpi_battery_dir_param)\r\nlock_battery_dir_cnt--;\r\nif (lock_battery_dir_cnt == 0 && acpi_battery_dir_param\r\n&& acpi_battery_dir) {\r\nremove_proc_entry(ACPI_BATTERY_CLASS, acpi_root_dir);\r\nacpi_battery_dir = NULL;\r\n}\r\nmutex_unlock(&cm_sbs_mutex);\r\nreturn;\r\n}
