static void send_0_byte(struct aztech *az)\r\n{\r\nudelay(radio_wait_time);\r\noutb_p(2 + az->curvol, az->isa.io);\r\noutb_p(64 + 2 + az->curvol, az->isa.io);\r\n}\r\nstatic void send_1_byte(struct aztech *az)\r\n{\r\nudelay(radio_wait_time);\r\noutb_p(128 + 2 + az->curvol, az->isa.io);\r\noutb_p(128 + 64 + 2 + az->curvol, az->isa.io);\r\n}\r\nstatic struct radio_isa_card *aztech_alloc(void)\r\n{\r\nstruct aztech *az = kzalloc(sizeof(*az), GFP_KERNEL);\r\nreturn az ? &az->isa : NULL;\r\n}\r\nstatic int aztech_s_frequency(struct radio_isa_card *isa, u32 freq)\r\n{\r\nstruct aztech *az = container_of(isa, struct aztech, isa);\r\nint i;\r\nfreq += 171200;\r\nfreq /= 800;\r\nsend_0_byte(az);\r\nfor (i = 0; i < 13; i++)\r\nif (freq & (1 << i))\r\nsend_1_byte(az);\r\nelse\r\nsend_0_byte(az);\r\nsend_0_byte(az);\r\nsend_0_byte(az);\r\nsend_0_byte(az);\r\nif (isa->stereo)\r\nsend_1_byte(az);\r\nelse\r\nsend_0_byte(az);\r\nsend_1_byte(az);\r\nsend_0_byte(az);\r\nsend_0_byte(az);\r\nsend_1_byte(az);\r\nsend_0_byte(az);\r\nsend_1_byte(az);\r\nudelay(radio_wait_time);\r\noutb_p(128 + 64 + az->curvol, az->isa.io);\r\nreturn 0;\r\n}\r\nstatic u32 aztech_g_rxsubchans(struct radio_isa_card *isa)\r\n{\r\nif (inb(isa->io) & 1)\r\nreturn V4L2_TUNER_SUB_MONO;\r\nreturn V4L2_TUNER_SUB_STEREO;\r\n}\r\nstatic int aztech_s_stereo(struct radio_isa_card *isa, bool stereo)\r\n{\r\nreturn aztech_s_frequency(isa, isa->freq);\r\n}\r\nstatic int aztech_s_mute_volume(struct radio_isa_card *isa, bool mute, int vol)\r\n{\r\nstruct aztech *az = container_of(isa, struct aztech, isa);\r\nif (mute)\r\nvol = 0;\r\naz->curvol = (vol & 1) + ((vol & 2) << 1);\r\noutb(az->curvol, isa->io);\r\nreturn 0;\r\n}\r\nstatic int __init aztech_init(void)\r\n{\r\nreturn isa_register_driver(&aztech_driver.driver, AZTECH_MAX);\r\n}\r\nstatic void __exit aztech_exit(void)\r\n{\r\nisa_unregister_driver(&aztech_driver.driver);\r\n}
