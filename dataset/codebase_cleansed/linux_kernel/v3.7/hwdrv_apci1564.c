int i_APCI1564_ConfigDigitalInput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\ndevpriv->tsk_Current = current;\r\nif (data[0] == ADDIDATA_ENABLE) {\r\ndata[2] = data[2] << 4;\r\ndata[3] = data[3] << 4;\r\noutl(data[2],\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_INTERRUPT_MODE1);\r\noutl(data[3],\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_INTERRUPT_MODE2);\r\nif (data[1] == ADDIDATA_OR) {\r\noutl(0x4,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\n}\r\nelse {\r\noutl(0x6,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\n}\r\n}\r\nelse {\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_INTERRUPT_MODE1);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_INTERRUPT_MODE2);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_Read1DigitalInput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_TmpValue = 0;\r\nunsigned int ui_Channel;\r\nui_Channel = CR_CHAN(insn->chanspec);\r\nif (ui_Channel <= 31) {\r\nui_TmpValue =\r\n(unsigned int) inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP);\r\n*data = (ui_TmpValue >> ui_Channel) & 0x1;\r\n}\r\nelse {\r\ncomedi_error(dev, "Not a valid channel number !!! \n");\r\nreturn -EINVAL;\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ReadMoreDigitalInput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_PortValue = data[0];\r\nunsigned int ui_Mask = 0;\r\nunsigned int ui_NoOfChannels;\r\nui_NoOfChannels = CR_CHAN(insn->chanspec);\r\nif (data[1] == 0) {\r\n*data = (unsigned int) inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP);\r\nswitch (ui_NoOfChannels) {\r\ncase 2:\r\nui_Mask = 3;\r\n*data = (*data >> (2 * ui_PortValue)) & ui_Mask;\r\nbreak;\r\ncase 4:\r\nui_Mask = 15;\r\n*data = (*data >> (4 * ui_PortValue)) & ui_Mask;\r\nbreak;\r\ncase 8:\r\nui_Mask = 255;\r\n*data = (*data >> (8 * ui_PortValue)) & ui_Mask;\r\nbreak;\r\ncase 16:\r\nui_Mask = 65535;\r\n*data = (*data >> (16 * ui_PortValue)) & ui_Mask;\r\nbreak;\r\ncase 31:\r\nbreak;\r\ndefault:\r\ncomedi_error(dev, "Not a valid Channel number !!!\n");\r\nreturn -EINVAL;\r\nbreak;\r\n}\r\n}\r\nelse {\r\nif (data[1] == 1) {\r\n*data = ui_InterruptStatus_1564;\r\n}\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ConfigDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ul_Command = 0;\r\nif ((data[0] != 0) && (data[0] != 1)) {\r\ncomedi_error(dev,\r\n"Not a valid Data !!! ,Data should be 1 or 0\n");\r\nreturn -EINVAL;\r\n}\r\nif (data[0]) {\r\ndevpriv->b_OutputMemoryStatus = ADDIDATA_ENABLE;\r\n}\r\nelse {\r\ndevpriv->b_OutputMemoryStatus = ADDIDATA_DISABLE;\r\n}\r\nif (data[1] == ADDIDATA_ENABLE) {\r\nul_Command = ul_Command | 0x1;\r\n}\r\nelse {\r\nul_Command = ul_Command & 0xFFFFFFFE;\r\n}\r\nif (data[2] == ADDIDATA_ENABLE) {\r\nul_Command = ul_Command | 0x2;\r\n}\r\nelse {\r\nul_Command = ul_Command & 0xFFFFFFFD;\r\n}\r\noutl(ul_Command,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_INTERRUPT);\r\nui_InterruptData =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_INTERRUPT);\r\ndevpriv->tsk_Current = current;\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_WriteDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_Temp, ui_Temp1;\r\nunsigned int ui_NoOfChannel;\r\nui_NoOfChannel = CR_CHAN(insn->chanspec);\r\nif (devpriv->b_OutputMemoryStatus) {\r\nui_Temp =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\n}\r\nelse {\r\nui_Temp = 0;\r\n}\r\nif (data[3] == 0) {\r\nif (data[1] == 0) {\r\ndata[0] = (data[0] << ui_NoOfChannel) | ui_Temp;\r\noutl(data[0],\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\n}\r\nelse {\r\nif (data[1] == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\ndata[0] =\r\n(data[0] << (2 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 4:\r\ndata[0] =\r\n(data[0] << (4 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 8:\r\ndata[0] =\r\n(data[0] << (8 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 16:\r\ndata[0] =\r\n(data[0] << (16 *\r\ndata[2])) | ui_Temp;\r\nbreak;\r\ncase 31:\r\ndata[0] = data[0] | ui_Temp;\r\nbreak;\r\ndefault:\r\ncomedi_error(dev, " chan spec wrong");\r\nreturn -EINVAL;\r\n}\r\noutl(data[0],\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported\n");\r\n}\r\n}\r\n}\r\nelse {\r\nif (data[3] == 1) {\r\nif (data[1] == 0) {\r\ndata[0] = ~data[0] & 0x1;\r\nui_Temp1 = 1;\r\nui_Temp1 = ui_Temp1 << ui_NoOfChannel;\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n(data[0] << ui_NoOfChannel) ^\r\n0xffffffff;\r\ndata[0] = data[0] & ui_Temp;\r\noutl(data[0],\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\n}\r\nelse {\r\nif (data[1] == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\ndata[0] = ~data[0] & 0x3;\r\nui_Temp1 = 3;\r\nui_Temp1 =\r\nui_Temp1 << 2 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (2 *\r\ndata\r\n[2])) ^\r\n0xffffffff) & ui_Temp;\r\nbreak;\r\ncase 4:\r\ndata[0] = ~data[0] & 0xf;\r\nui_Temp1 = 15;\r\nui_Temp1 =\r\nui_Temp1 << 4 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (4 *\r\ndata\r\n[2])) ^\r\n0xffffffff) & ui_Temp;\r\nbreak;\r\ncase 8:\r\ndata[0] = ~data[0] & 0xff;\r\nui_Temp1 = 255;\r\nui_Temp1 =\r\nui_Temp1 << 8 * data[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (8 *\r\ndata\r\n[2])) ^\r\n0xffffffff) & ui_Temp;\r\nbreak;\r\ncase 16:\r\ndata[0] = ~data[0] & 0xffff;\r\nui_Temp1 = 65535;\r\nui_Temp1 =\r\nui_Temp1 << 16 *\r\ndata[2];\r\nui_Temp = ui_Temp | ui_Temp1;\r\ndata[0] =\r\n((data[0] << (16 *\r\ndata\r\n[2])) ^\r\n0xffffffff) & ui_Temp;\r\nbreak;\r\ncase 31:\r\nbreak;\r\ndefault:\r\ncomedi_error(dev,\r\n" chan spec wrong");\r\nreturn -EINVAL;\r\n}\r\noutl(data[0],\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported\n");\r\n}\r\n}\r\n}\r\nelse {\r\nprintk("\nSpecified functionality does not exist\n");\r\nreturn -EINVAL;\r\n}\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ReadDigitalOutput(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ui_Temp;\r\nunsigned int ui_NoOfChannel;\r\nui_NoOfChannel = CR_CHAN(insn->chanspec);\r\nui_Temp = data[0];\r\n*data = inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_RW);\r\nif (ui_Temp == 0) {\r\n*data = (*data >> ui_NoOfChannel) & 0x1;\r\n}\r\nelse {\r\nif (ui_Temp == 1) {\r\nswitch (ui_NoOfChannel) {\r\ncase 2:\r\n*data = (*data >> (2 * data[1])) & 3;\r\nbreak;\r\ncase 4:\r\n*data = (*data >> (4 * data[1])) & 15;\r\nbreak;\r\ncase 8:\r\n*data = (*data >> (8 * data[1])) & 255;\r\nbreak;\r\ncase 16:\r\n*data = (*data >> (16 * data[1])) & 65535;\r\nbreak;\r\ncase 31:\r\nbreak;\r\ndefault:\r\ncomedi_error(dev, " chan spec wrong");\r\nreturn -EINVAL;\r\nbreak;\r\n}\r\n}\r\nelse {\r\nprintk("\nSpecified channel not supported \n");\r\n}\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ConfigTimerCounterWatchdog(struct comedi_device *dev,\r\nstruct comedi_subdevice *s, struct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ul_Command1 = 0;\r\ndevpriv->tsk_Current = current;\r\nif (data[0] == ADDIDATA_WATCHDOG) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_WATCHDOG;\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_PROG);\r\noutl(data[3],\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_RELOAD_VALUE);\r\n}\r\nelse if (data[0] == ADDIDATA_TIMER) {\r\nul_Command1 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = ul_Command1 & 0xFFFFF9FEUL;\r\noutl(ul_Command1, devpriv->i_IobaseAmcc + APCI1564_TIMER + APCI1564_TCW_PROG);\r\ndevpriv->b_TimerSelectMode = ADDIDATA_TIMER;\r\nif (data[1] == 1) {\r\noutl(0x02, devpriv->i_IobaseAmcc + APCI1564_TIMER + APCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_IRQ);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_IRQ);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER1 +\r\nAPCI1564_TCW_IRQ);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER2 +\r\nAPCI1564_TCW_IRQ);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER3 +\r\nAPCI1564_TCW_IRQ);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER4 +\r\nAPCI1564_TCW_IRQ);\r\n}\r\nelse {\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_TIMER + APCI1564_TCW_PROG);\r\n}\r\noutl(data[2],\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_TIMEBASE);\r\noutl(data[3],\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_RELOAD_VALUE);\r\nul_Command1 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 =\r\n(ul_Command1 & 0xFFF719E2UL) | 2UL << 13UL | 0x10UL;\r\noutl(ul_Command1, devpriv->i_IobaseAmcc + APCI1564_TIMER + APCI1564_TCW_PROG);\r\n}\r\nelse if (data[0] == ADDIDATA_COUNTER) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_COUNTER;\r\ndevpriv->b_ModeSelectRegister = data[5];\r\nul_Command1 =\r\ninl(devpriv->iobase + ((data[5] - 1) * 0x20) +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = ul_Command1 & 0xFFFFF9FEUL;\r\noutl(ul_Command1, devpriv->iobase + ((data[5] - 1) * 0x20) + APCI1564_TCW_PROG);\r\noutl(data[3],\r\ndevpriv->iobase + ((data[5] - 1) * 0x20) +\r\nAPCI1564_TCW_RELOAD_VALUE);\r\nul_Command1 =\r\n(ul_Command1 & 0xFFFC19E2UL) | 0x80000UL |\r\n(unsigned int) ((unsigned int) data[4] << 16UL);\r\noutl(ul_Command1,\r\ndevpriv->iobase + ((data[5] - 1) * 0x20) +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = (ul_Command1 & 0xFFFFF9FD) | (data[1] << 1);\r\noutl(ul_Command1,\r\ndevpriv->iobase + ((data[5] - 1) * 0x20) +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = (ul_Command1 & 0xFFFBF9FFUL) | (data[6] << 18);\r\noutl(ul_Command1,\r\ndevpriv->iobase + ((data[5] - 1) * 0x20) +\r\nAPCI1564_TCW_PROG);\r\n}\r\nelse {\r\nprintk(" Invalid subdevice.");\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_StartStopWriteTimerCounterWatchdog(struct comedi_device *dev,\r\nstruct comedi_subdevice *s, struct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ul_Command1 = 0;\r\nif (devpriv->b_TimerSelectMode == ADDIDATA_WATCHDOG) {\r\nswitch (data[1]) {\r\ncase 0:\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP_WATCHDOG + APCI1564_TCW_PROG);\r\nbreak;\r\ncase 1:\r\noutl(0x0001,\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_PROG);\r\nbreak;\r\ncase 2:\r\noutl(0x0201,\r\ndevpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_PROG);\r\nbreak;\r\ndefault:\r\nprintk("\nSpecified functionality does not exist\n");\r\nreturn -EINVAL;\r\n}\r\n}\r\nif (devpriv->b_TimerSelectMode == ADDIDATA_TIMER) {\r\nif (data[1] == 1) {\r\nul_Command1 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = (ul_Command1 & 0xFFFFF9FFUL) | 0x1UL;\r\noutl(ul_Command1,\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\n}\r\nelse if (data[1] == 0) {\r\nul_Command1 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\nul_Command1 = ul_Command1 & 0xFFFFF9FEUL;\r\noutl(ul_Command1,\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nif (devpriv->b_TimerSelectMode == ADDIDATA_COUNTER) {\r\nul_Command1 =\r\ninl(devpriv->iobase + ((devpriv->b_ModeSelectRegister -\r\n1) * 0x20) + APCI1564_TCW_PROG);\r\nif (data[1] == 1) {\r\nul_Command1 = (ul_Command1 & 0xFFFFF9FFUL) | 0x1UL;\r\n}\r\nelse if (data[1] == 0) {\r\nul_Command1 = 0;\r\n}\r\nelse if (data[1] == 2) {\r\nul_Command1 = (ul_Command1 & 0xFFFFF9FFUL) | 0x400;\r\n}\r\noutl(ul_Command1,\r\ndevpriv->iobase + ((devpriv->b_ModeSelectRegister -\r\n1) * 0x20) + APCI1564_TCW_PROG);\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ReadTimerCounterWatchdog(struct comedi_device *dev,\r\nstruct comedi_subdevice *s, struct comedi_insn *insn, unsigned int *data)\r\n{\r\nunsigned int ul_Command1 = 0;\r\nif (devpriv->b_TimerSelectMode == ADDIDATA_WATCHDOG) {\r\ndata[0] =\r\ninl(devpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_TRIG_STATUS) & 0x1;\r\ndata[1] =\r\ninl(devpriv->i_IobaseAmcc +\r\nAPCI1564_DIGITAL_OP_WATCHDOG);\r\n}\r\nelse if (devpriv->b_TimerSelectMode == ADDIDATA_TIMER) {\r\ndata[0] =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_TRIG_STATUS) & 0x1;\r\ndata[1] = inl(devpriv->i_IobaseAmcc + APCI1564_TIMER);\r\n}\r\nelse if (devpriv->b_TimerSelectMode == ADDIDATA_COUNTER) {\r\ndata[0] =\r\ninl(devpriv->iobase + ((devpriv->b_ModeSelectRegister -\r\n1) * 0x20) +\r\nAPCI1564_TCW_SYNC_ENABLEDISABLE);\r\nul_Command1 =\r\ninl(devpriv->iobase + ((devpriv->b_ModeSelectRegister -\r\n1) * 0x20) + APCI1564_TCW_TRIG_STATUS);\r\ndata[1] = (unsigned char) ((ul_Command1 >> 1) & 1);\r\ndata[2] = (unsigned char) ((ul_Command1 >> 2) & 1);\r\ndata[3] = (unsigned char) ((ul_Command1 >> 3) & 1);\r\ndata[4] = (unsigned char) ((ul_Command1 >> 0) & 1);\r\n}\r\nelse if ((devpriv->b_TimerSelectMode != ADDIDATA_TIMER)\r\n&& (devpriv->b_TimerSelectMode != ADDIDATA_WATCHDOG)\r\n&& (devpriv->b_TimerSelectMode != ADDIDATA_COUNTER)) {\r\nprintk("\n Invalid Subdevice !!!\n");\r\n}\r\nreturn insn->n;\r\n}\r\nint i_APCI1564_ReadInterruptStatus(struct comedi_device *dev, struct comedi_subdevice *s,\r\nstruct comedi_insn *insn, unsigned int *data)\r\n{\r\n*data = ui_Type;\r\nreturn insn->n;\r\n}\r\nstatic void v_APCI1564_Interrupt(int irq, void *d)\r\n{\r\nstruct comedi_device *dev = d;\r\nunsigned int ui_DO, ui_DI;\r\nunsigned int ui_Timer;\r\nunsigned int ui_C1, ui_C2, ui_C3, ui_C4;\r\nunsigned int ul_Command2 = 0;\r\nui_DI = inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ) & 0x01;\r\nui_DO = inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_IRQ) & 0x01;\r\nui_Timer =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_IRQ) & 0x01;\r\nui_C1 = inl(devpriv->iobase + APCI1564_COUNTER1 +\r\nAPCI1564_TCW_IRQ) & 0x1;\r\nui_C2 = inl(devpriv->iobase + APCI1564_COUNTER2 +\r\nAPCI1564_TCW_IRQ) & 0x1;\r\nui_C3 = inl(devpriv->iobase + APCI1564_COUNTER3 +\r\nAPCI1564_TCW_IRQ) & 0x1;\r\nui_C4 = inl(devpriv->iobase + APCI1564_COUNTER4 +\r\nAPCI1564_TCW_IRQ) & 0x1;\r\nif (ui_DI == 0 && ui_DO == 0 && ui_Timer == 0 && ui_C1 == 0\r\n&& ui_C2 == 0 && ui_C3 == 0 && ui_C4 == 0) {\r\nprintk("\nInterrupt from unknown source\n");\r\n}\r\nif (ui_DI == 1) {\r\nui_DI = inl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_IRQ);\r\nui_InterruptStatus_1564 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP +\r\nAPCI1564_DIGITAL_IP_INTERRUPT_STATUS);\r\nui_InterruptStatus_1564 = ui_InterruptStatus_1564 & 0X000FFFF0;\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ui_DI, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP + APCI1564_DIGITAL_IP_IRQ);\r\nreturn;\r\n}\r\nif (ui_DO == 1) {\r\nui_Type =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_INTERRUPT_STATUS) & 0x3;\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP +\r\nAPCI1564_DIGITAL_OP_INTERRUPT);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\n}\r\nif (ui_Timer == 1) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_TIMER;\r\nif (devpriv->b_TimerSelectMode) {\r\nul_Command2 =\r\ninl(devpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ul_Command2,\r\ndevpriv->i_IobaseAmcc + APCI1564_TIMER +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nif (ui_C1 == 1) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_COUNTER;\r\nif (devpriv->b_TimerSelectMode) {\r\nul_Command2 =\r\ninl(devpriv->iobase + APCI1564_COUNTER1 +\r\nAPCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER1 +\r\nAPCI1564_TCW_PROG);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ul_Command2,\r\ndevpriv->iobase + APCI1564_COUNTER1 +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nif (ui_C2 == 1) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_COUNTER;\r\nif (devpriv->b_TimerSelectMode) {\r\nul_Command2 =\r\ninl(devpriv->iobase + APCI1564_COUNTER2 +\r\nAPCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER2 +\r\nAPCI1564_TCW_PROG);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ul_Command2,\r\ndevpriv->iobase + APCI1564_COUNTER2 +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nif (ui_C3 == 1) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_COUNTER;\r\nif (devpriv->b_TimerSelectMode) {\r\nul_Command2 =\r\ninl(devpriv->iobase + APCI1564_COUNTER3 +\r\nAPCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER3 +\r\nAPCI1564_TCW_PROG);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ul_Command2,\r\ndevpriv->iobase + APCI1564_COUNTER3 +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nif (ui_C4 == 1) {\r\ndevpriv->b_TimerSelectMode = ADDIDATA_COUNTER;\r\nif (devpriv->b_TimerSelectMode) {\r\nul_Command2 =\r\ninl(devpriv->iobase + APCI1564_COUNTER4 +\r\nAPCI1564_TCW_PROG);\r\noutl(0x0,\r\ndevpriv->iobase + APCI1564_COUNTER4 +\r\nAPCI1564_TCW_PROG);\r\nsend_sig(SIGIO, devpriv->tsk_Current, 0);\r\noutl(ul_Command2,\r\ndevpriv->iobase + APCI1564_COUNTER4 +\r\nAPCI1564_TCW_PROG);\r\n}\r\n}\r\nreturn;\r\n}\r\nint i_APCI1564_Reset(struct comedi_device *dev)\r\n{\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP_IRQ);\r\ninl(devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP_INTERRUPT_STATUS);\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP_INTERRUPT_MODE1);\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_IP_INTERRUPT_MODE2);\r\ndevpriv->b_DigitalOutputRegister = 0;\r\nui_Type = 0;\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP);\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP_INTERRUPT);\r\noutl(0x0,\r\ndevpriv->i_IobaseAmcc + APCI1564_DIGITAL_OP_WATCHDOG +\r\nAPCI1564_TCW_RELOAD_VALUE);\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_TIMER);\r\noutl(0x0, devpriv->i_IobaseAmcc + APCI1564_TIMER + APCI1564_TCW_PROG);\r\noutl(0x0, devpriv->iobase + APCI1564_COUNTER1 + APCI1564_TCW_PROG);\r\noutl(0x0, devpriv->iobase + APCI1564_COUNTER2 + APCI1564_TCW_PROG);\r\noutl(0x0, devpriv->iobase + APCI1564_COUNTER3 + APCI1564_TCW_PROG);\r\noutl(0x0, devpriv->iobase + APCI1564_COUNTER4 + APCI1564_TCW_PROG);\r\nreturn 0;\r\n}
