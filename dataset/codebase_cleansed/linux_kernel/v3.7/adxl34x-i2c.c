static int adxl34x_smbus_read(struct device *dev, unsigned char reg)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nreturn i2c_smbus_read_byte_data(client, reg);\r\n}\r\nstatic int adxl34x_smbus_write(struct device *dev,\r\nunsigned char reg, unsigned char val)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nreturn i2c_smbus_write_byte_data(client, reg, val);\r\n}\r\nstatic int adxl34x_smbus_read_block(struct device *dev,\r\nunsigned char reg, int count,\r\nvoid *buf)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nreturn i2c_smbus_read_i2c_block_data(client, reg, count, buf);\r\n}\r\nstatic int adxl34x_i2c_read_block(struct device *dev,\r\nunsigned char reg, int count,\r\nvoid *buf)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nint ret;\r\nret = i2c_master_send(client, &reg, 1);\r\nif (ret < 0)\r\nreturn ret;\r\nret = i2c_master_recv(client, buf, count);\r\nif (ret < 0)\r\nreturn ret;\r\nif (ret != count)\r\nreturn -EIO;\r\nreturn 0;\r\n}\r\nstatic int __devinit adxl34x_i2c_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct adxl34x *ac;\r\nint error;\r\nerror = i2c_check_functionality(client->adapter,\r\nI2C_FUNC_SMBUS_BYTE_DATA);\r\nif (!error) {\r\ndev_err(&client->dev, "SMBUS Byte Data not Supported\n");\r\nreturn -EIO;\r\n}\r\nac = adxl34x_probe(&client->dev, client->irq, false,\r\ni2c_check_functionality(client->adapter,\r\nI2C_FUNC_SMBUS_READ_I2C_BLOCK) ?\r\n&adxl34x_smbus_bops : &adxl34x_i2c_bops);\r\nif (IS_ERR(ac))\r\nreturn PTR_ERR(ac);\r\ni2c_set_clientdata(client, ac);\r\nreturn 0;\r\n}\r\nstatic int __devexit adxl34x_i2c_remove(struct i2c_client *client)\r\n{\r\nstruct adxl34x *ac = i2c_get_clientdata(client);\r\nreturn adxl34x_remove(ac);\r\n}\r\nstatic int adxl34x_i2c_suspend(struct device *dev)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nstruct adxl34x *ac = i2c_get_clientdata(client);\r\nadxl34x_suspend(ac);\r\nreturn 0;\r\n}\r\nstatic int adxl34x_i2c_resume(struct device *dev)\r\n{\r\nstruct i2c_client *client = to_i2c_client(dev);\r\nstruct adxl34x *ac = i2c_get_clientdata(client);\r\nadxl34x_resume(ac);\r\nreturn 0;\r\n}
