static unsigned long icst_recalc_rate(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nstruct clk_icst *icst = to_icst(hw);\r\nstruct icst_vco vco;\r\nvco = icst->getvco();\r\nicst->rate = icst_hz(icst->params, vco);\r\nreturn icst->rate;\r\n}\r\nstatic long icst_round_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long *prate)\r\n{\r\nstruct clk_icst *icst = to_icst(hw);\r\nstruct icst_vco vco;\r\nvco = icst_hz_to_vco(icst->params, rate);\r\nreturn icst_hz(icst->params, vco);\r\n}\r\nstatic int icst_set_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate)\r\n{\r\nstruct clk_icst *icst = to_icst(hw);\r\nstruct icst_vco vco;\r\nvco = icst_hz_to_vco(icst->params, rate);\r\nicst->rate = icst_hz(icst->params, vco);\r\nicst->setvco(vco);\r\nreturn 0;\r\n}\r\nstruct clk * __init icst_clk_register(struct device *dev,\r\nconst struct clk_icst_desc *desc)\r\n{\r\nstruct clk *clk;\r\nstruct clk_icst *icst;\r\nstruct clk_init_data init;\r\nicst = kzalloc(sizeof(struct clk_icst), GFP_KERNEL);\r\nif (!icst) {\r\npr_err("could not allocate ICST clock!\n");\r\nreturn ERR_PTR(-ENOMEM);\r\n}\r\ninit.name = "icst";\r\ninit.ops = &icst_ops;\r\ninit.flags = CLK_IS_ROOT;\r\ninit.parent_names = NULL;\r\ninit.num_parents = 0;\r\nicst->hw.init = &init;\r\nicst->params = desc->params;\r\nicst->getvco = desc->getvco;\r\nicst->setvco = desc->setvco;\r\nclk = clk_register(dev, &icst->hw);\r\nif (IS_ERR(clk))\r\nkfree(icst);\r\nreturn clk;\r\n}
