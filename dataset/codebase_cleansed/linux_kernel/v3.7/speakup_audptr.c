static void synth_flush(struct spk_synth *synth)\r\n{\r\nint timeout = SPK_XMITR_TIMEOUT;\r\nwhile (spk_serial_tx_busy()) {\r\nif (!--timeout)\r\nbreak;\r\nudelay(1);\r\n}\r\noutb(SYNTH_CLEAR, speakup_info.port_tts);\r\nspk_serial_out(PROCSPEECH);\r\n}\r\nstatic void synth_version(struct spk_synth *synth)\r\n{\r\nunsigned char test = 0;\r\nchar synth_id[40] = "";\r\nspk_synth_immediate(synth, "\x05[Q]");\r\nsynth_id[test] = spk_serial_in();\r\nif (synth_id[test] == 'A') {\r\ndo {\r\nsynth_id[++test] = spk_serial_in();\r\n} while (synth_id[test] != '\n' && test < 32);\r\nsynth_id[++test] = 0x00;\r\n}\r\nif (synth_id[0] == 'A')\r\npr_info("%s version: %s", synth->long_name, synth_id);\r\n}\r\nstatic int synth_probe(struct spk_synth *synth)\r\n{\r\nint failed = 0;\r\nfailed = serial_synth_probe(synth);\r\nif (failed == 0)\r\nsynth_version(synth);\r\nsynth->alive = !failed;\r\nreturn 0;\r\n}\r\nstatic int __init audptr_init(void)\r\n{\r\nreturn synth_add(&synth_audptr);\r\n}\r\nstatic void __exit audptr_exit(void)\r\n{\r\nsynth_remove(&synth_audptr);\r\n}
