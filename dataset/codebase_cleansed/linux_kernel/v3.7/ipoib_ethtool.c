static void ipoib_get_drvinfo(struct net_device *netdev,\r\nstruct ethtool_drvinfo *drvinfo)\r\n{\r\nstrncpy(drvinfo->driver, "ipoib", sizeof(drvinfo->driver) - 1);\r\n}\r\nstatic int ipoib_get_coalesce(struct net_device *dev,\r\nstruct ethtool_coalesce *coal)\r\n{\r\nstruct ipoib_dev_priv *priv = netdev_priv(dev);\r\ncoal->rx_coalesce_usecs = priv->ethtool.coalesce_usecs;\r\ncoal->rx_max_coalesced_frames = priv->ethtool.max_coalesced_frames;\r\nreturn 0;\r\n}\r\nstatic int ipoib_set_coalesce(struct net_device *dev,\r\nstruct ethtool_coalesce *coal)\r\n{\r\nstruct ipoib_dev_priv *priv = netdev_priv(dev);\r\nint ret;\r\nif (coal->rx_coalesce_usecs > 0xffff ||\r\ncoal->rx_max_coalesced_frames > 0xffff)\r\nreturn -EINVAL;\r\nret = ib_modify_cq(priv->recv_cq, coal->rx_max_coalesced_frames,\r\ncoal->rx_coalesce_usecs);\r\nif (ret && ret != -ENOSYS) {\r\nipoib_warn(priv, "failed modifying CQ (%d)\n", ret);\r\nreturn ret;\r\n}\r\npriv->ethtool.coalesce_usecs = coal->rx_coalesce_usecs;\r\npriv->ethtool.max_coalesced_frames = coal->rx_max_coalesced_frames;\r\nreturn 0;\r\n}\r\nvoid ipoib_set_ethtool_ops(struct net_device *dev)\r\n{\r\nSET_ETHTOOL_OPS(dev, &ipoib_ethtool_ops);\r\n}
