static int __init sgiwd93_devinit(void)\r\n{\r\nint res;\r\nsgiwd93_0_pd.hregs = &hpc3c0->scsi_chan0;\r\nsgiwd93_0_pd.wdregs = (unsigned char *) hpc3c0->scsi0_ext;\r\nres = platform_device_register(&sgiwd93_0_device);\r\nif (res)\r\nreturn res;\r\nif (!ip22_is_fullhouse())\r\nreturn 0;\r\nsgiwd93_1_pd.hregs = &hpc3c0->scsi_chan1;\r\nsgiwd93_1_pd.wdregs = (unsigned char *) hpc3c0->scsi1_ext;\r\nreturn platform_device_register(&sgiwd93_1_device);\r\n}\r\nstatic int __init sgiseeq_devinit(void)\r\n{\r\nunsigned int pbdma __maybe_unused;\r\nint res, i;\r\neth0_pd.hpc = hpc3c0;\r\neth0_pd.irq = SGI_ENET_IRQ;\r\n#define EADDR_NVOFS 250\r\nfor (i = 0; i < 3; i++) {\r\nunsigned short tmp = ip22_nvram_read(EADDR_NVOFS / 2 + i);\r\neth0_pd.mac[2 * i] = tmp >> 8;\r\neth0_pd.mac[2 * i + 1] = tmp & 0xff;\r\n}\r\nres = platform_device_register(&eth0_device);\r\nif (res)\r\nreturn res;\r\nif (ip22_is_fullhouse() ||\r\nget_dbe(pbdma, (unsigned int *)&hpc3c1->pbdma[1]))\r\nreturn 0;\r\nsgimc->giopar |= SGIMC_GIOPAR_MASTEREXP1 | SGIMC_GIOPAR_EXP164 |\r\nSGIMC_GIOPAR_HPC264;\r\nhpc3c1->pbus_piocfg[0][0] = 0x3ffff;\r\nhpc3c1->pbus_extregs[0][0] = 0x30;\r\neth1_pd.hpc = hpc3c1;\r\neth1_pd.irq = SGI_GIO_0_IRQ;\r\n#define EADDR_NVOFS 250\r\nfor (i = 0; i < 3; i++) {\r\nunsigned short tmp = ip22_eeprom_read(&hpc3c1->eeprom,\r\nEADDR_NVOFS / 2 + i);\r\neth1_pd.mac[2 * i] = tmp >> 8;\r\neth1_pd.mac[2 * i + 1] = tmp & 0xff;\r\n}\r\nreturn platform_device_register(&eth1_device);\r\n}\r\nstatic int __init sgi_hal2_devinit(void)\r\n{\r\nreturn IS_ERR(platform_device_register_simple("sgihal2", 0, NULL, 0));\r\n}\r\nstatic int __init sgi_button_devinit(void)\r\n{\r\nif (ip22_is_fullhouse())\r\nreturn 0;\r\nreturn IS_ERR(platform_device_register_simple("sgibtns", -1, NULL, 0));\r\n}\r\nstatic int __init sgi_ds1286_devinit(void)\r\n{\r\nstruct resource res;\r\nmemset(&res, 0, sizeof(res));\r\nres.start = HPC3_CHIP0_BASE + offsetof(struct hpc3_regs, rtcregs);\r\nres.end = res.start + sizeof(hpc3c0->rtcregs) - 1;\r\nres.flags = IORESOURCE_MEM;\r\nreturn IS_ERR(platform_device_register_simple("rtc-ds1286", -1,\r\n&res, 1));\r\n}
