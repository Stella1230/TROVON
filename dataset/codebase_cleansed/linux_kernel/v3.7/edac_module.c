char *edac_op_state_to_string(int opstate)\r\n{\r\nif (opstate == OP_RUNNING_POLL)\r\nreturn "POLLED";\r\nelse if (opstate == OP_RUNNING_INTERRUPT)\r\nreturn "INTERRUPT";\r\nelse if (opstate == OP_RUNNING_POLL_INTR)\r\nreturn "POLL-INTR";\r\nelse if (opstate == OP_ALLOC)\r\nreturn "ALLOC";\r\nelse if (opstate == OP_OFFLINE)\r\nreturn "OFFLINE";\r\nreturn "UNKNOWN";\r\n}\r\nstatic int edac_workqueue_setup(void)\r\n{\r\nedac_workqueue = create_singlethread_workqueue("edac-poller");\r\nif (edac_workqueue == NULL)\r\nreturn -ENODEV;\r\nelse\r\nreturn 0;\r\n}\r\nstatic void edac_workqueue_teardown(void)\r\n{\r\nif (edac_workqueue) {\r\nflush_workqueue(edac_workqueue);\r\ndestroy_workqueue(edac_workqueue);\r\nedac_workqueue = NULL;\r\n}\r\n}\r\nstatic int __init edac_init(void)\r\n{\r\nint err = 0;\r\nedac_printk(KERN_INFO, EDAC_MC, EDAC_VERSION "\n");\r\nedac_pci_clear_parity_errors();\r\nerr = edac_mc_sysfs_init();\r\nif (err)\r\ngoto error;\r\nedac_debugfs_init();\r\nerr = edac_workqueue_setup();\r\nif (err) {\r\nedac_printk(KERN_ERR, EDAC_MC, "init WorkQueue failure\n");\r\ngoto error;\r\n}\r\nreturn 0;\r\nerror:\r\nreturn err;\r\n}\r\nstatic void __exit edac_exit(void)\r\n{\r\nedac_dbg(0, "\n");\r\nedac_workqueue_teardown();\r\nedac_mc_sysfs_exit();\r\nedac_debugfs_exit();\r\n}
