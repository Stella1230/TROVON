const struct squashfs_decompressor *squashfs_lookup_decompressor(int id)\r\n{\r\nint i;\r\nfor (i = 0; decompressor[i]->id; i++)\r\nif (id == decompressor[i]->id)\r\nbreak;\r\nreturn decompressor[i];\r\n}\r\nvoid *squashfs_decompressor_init(struct super_block *sb, unsigned short flags)\r\n{\r\nstruct squashfs_sb_info *msblk = sb->s_fs_info;\r\nvoid *strm, *buffer = NULL;\r\nint length = 0;\r\nif (SQUASHFS_COMP_OPTS(flags)) {\r\nbuffer = kmalloc(PAGE_CACHE_SIZE, GFP_KERNEL);\r\nif (buffer == NULL)\r\nreturn ERR_PTR(-ENOMEM);\r\nlength = squashfs_read_data(sb, &buffer,\r\nsizeof(struct squashfs_super_block), 0, NULL,\r\nPAGE_CACHE_SIZE, 1);\r\nif (length < 0) {\r\nstrm = ERR_PTR(length);\r\ngoto finished;\r\n}\r\n}\r\nstrm = msblk->decompressor->init(msblk, buffer, length);\r\nfinished:\r\nkfree(buffer);\r\nreturn strm;\r\n}
