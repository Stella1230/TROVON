void __init set_cpuinfo_static(struct cpuinfo *ci, struct device_node *cpu)\r\n{\r\nint i = 0;\r\nci->use_instr =\r\n(fcpu(cpu, "xlnx,use-barrel") ? PVR0_USE_BARREL_MASK : 0) |\r\n(fcpu(cpu, "xlnx,use-msr-instr") ? PVR2_USE_MSR_INSTR : 0) |\r\n(fcpu(cpu, "xlnx,use-pcmp-instr") ? PVR2_USE_PCMP_INSTR : 0) |\r\n(fcpu(cpu, "xlnx,use-div") ? PVR0_USE_DIV_MASK : 0);\r\nif (CONFIG_XILINX_MICROBLAZE0_USE_BARREL)\r\ni |= PVR0_USE_BARREL_MASK;\r\nif (CONFIG_XILINX_MICROBLAZE0_USE_MSR_INSTR)\r\ni |= PVR2_USE_MSR_INSTR;\r\nif (CONFIG_XILINX_MICROBLAZE0_USE_PCMP_INSTR)\r\ni |= PVR2_USE_PCMP_INSTR;\r\nif (CONFIG_XILINX_MICROBLAZE0_USE_DIV)\r\ni |= PVR0_USE_DIV_MASK;\r\nif (ci->use_instr != i)\r\nerr_printk("BARREL, MSR, PCMP or DIV");\r\nci->use_mult = fcpu(cpu, "xlnx,use-hw-mul");\r\nif (ci->use_mult != CONFIG_XILINX_MICROBLAZE0_USE_HW_MUL)\r\nerr_printk("HW_MUL");\r\nci->use_mult =\r\n(ci->use_mult > 1 ?\r\n(PVR2_USE_MUL64_MASK | PVR0_USE_HW_MUL_MASK) :\r\n(ci->use_mult == 1 ? PVR0_USE_HW_MUL_MASK : 0));\r\nci->use_fpu = fcpu(cpu, "xlnx,use-fpu");\r\nif (ci->use_fpu != CONFIG_XILINX_MICROBLAZE0_USE_FPU)\r\nerr_printk("HW_FPU");\r\nci->use_fpu = (ci->use_fpu > 1 ?\r\n(PVR2_USE_FPU2_MASK | PVR0_USE_FPU_MASK) :\r\n(ci->use_fpu == 1 ? PVR0_USE_FPU_MASK : 0));\r\nci->use_exc =\r\n(fcpu(cpu, "xlnx,unaligned-exceptions") ?\r\nPVR2_UNALIGNED_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,ill-opcode-exception") ?\r\nPVR2_ILL_OPCODE_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,iopb-bus-exception") ?\r\nPVR2_IOPB_BUS_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,dopb-bus-exception") ?\r\nPVR2_DOPB_BUS_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,div-zero-exception") ?\r\nPVR2_DIV_ZERO_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,fpu-exception") ? PVR2_FPU_EXC_MASK : 0) |\r\n(fcpu(cpu, "xlnx,fsl-exception") ? PVR2_USE_EXTEND_FSL : 0);\r\nci->use_icache = fcpu(cpu, "xlnx,use-icache");\r\nci->icache_tagbits = fcpu(cpu, "xlnx,addr-tag-bits");\r\nci->icache_write = fcpu(cpu, "xlnx,allow-icache-wr");\r\nci->icache_line_length = fcpu(cpu, "xlnx,icache-line-len") << 2;\r\nif (!ci->icache_line_length) {\r\nif (fcpu(cpu, "xlnx,icache-use-fsl"))\r\nci->icache_line_length = 4 << 2;\r\nelse\r\nci->icache_line_length = 1 << 2;\r\n}\r\nci->icache_size = fcpu(cpu, "i-cache-size");\r\nci->icache_base = fcpu(cpu, "i-cache-baseaddr");\r\nci->icache_high = fcpu(cpu, "i-cache-highaddr");\r\nci->use_dcache = fcpu(cpu, "xlnx,use-dcache");\r\nci->dcache_tagbits = fcpu(cpu, "xlnx,dcache-addr-tag");\r\nci->dcache_write = fcpu(cpu, "xlnx,allow-dcache-wr");\r\nci->dcache_line_length = fcpu(cpu, "xlnx,dcache-line-len") << 2;\r\nif (!ci->dcache_line_length) {\r\nif (fcpu(cpu, "xlnx,dcache-use-fsl"))\r\nci->dcache_line_length = 4 << 2;\r\nelse\r\nci->dcache_line_length = 1 << 2;\r\n}\r\nci->dcache_size = fcpu(cpu, "d-cache-size");\r\nci->dcache_base = fcpu(cpu, "d-cache-baseaddr");\r\nci->dcache_high = fcpu(cpu, "d-cache-highaddr");\r\nci->dcache_wb = fcpu(cpu, "xlnx,dcache-use-writeback");\r\nci->use_dopb = fcpu(cpu, "xlnx,d-opb");\r\nci->use_iopb = fcpu(cpu, "xlnx,i-opb");\r\nci->use_dlmb = fcpu(cpu, "xlnx,d-lmb");\r\nci->use_ilmb = fcpu(cpu, "xlnx,i-lmb");\r\nci->num_fsl = fcpu(cpu, "xlnx,fsl-links");\r\nci->irq_edge = fcpu(cpu, "xlnx,interrupt-is-edge");\r\nci->irq_positive = fcpu(cpu, "xlnx,edge-is-positive");\r\nci->area_optimised = 0;\r\nci->hw_debug = fcpu(cpu, "xlnx,debug-enabled");\r\nci->num_pc_brk = fcpu(cpu, "xlnx,number-of-pc-brk");\r\nci->num_rd_brk = fcpu(cpu, "xlnx,number-of-rd-addr-brk");\r\nci->num_wr_brk = fcpu(cpu, "xlnx,number-of-wr-addr-brk");\r\nci->cpu_clock_freq = fcpu(cpu, "timebase-frequency");\r\nci->pvr_user1 = fcpu(cpu, "xlnx,pvr-user1");\r\nci->pvr_user2 = fcpu(cpu, "xlnx,pvr-user2");\r\nci->mmu = fcpu(cpu, "xlnx,use-mmu");\r\nci->mmu_privins = fcpu(cpu, "xlnx,mmu-privileged-instr");\r\nci->endian = fcpu(cpu, "xlnx,endianness");\r\nci->ver_code = 0;\r\nci->fpga_family_code = 0;\r\nfor (i = 0; cpu_ver_lookup[i].s != NULL; i++) {\r\nif (strcmp(cpu_ver_lookup[i].s, cpu_ver_string) == 0)\r\nci->ver_code = cpu_ver_lookup[i].k;\r\n}\r\nfor (i = 0; family_string_lookup[i].s != NULL; i++) {\r\nif (strcmp(family_string_lookup[i].s, family_string) == 0)\r\nci->fpga_family_code = family_string_lookup[i].k;\r\n}\r\nif (ci->ver_code == 0x20 && ci->fpga_family_code != 0xf0)\r\nci->use_mult = 1;\r\n}
