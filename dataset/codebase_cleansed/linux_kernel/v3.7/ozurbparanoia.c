void oz_remember_urb(struct urb *urb)\r\n{\r\nunsigned long irq_state;\r\nspin_lock_irqsave(&g_urb_mem_lock, irq_state);\r\nif (g_nb_urbs < OZ_MAX_URBS) {\r\ng_urb_memory[g_nb_urbs++] = urb;\r\noz_trace("%lu: urb up = %d %p\n", jiffies, g_nb_urbs, urb);\r\n} else {\r\noz_trace("ERROR urb buffer full\n");\r\n}\r\nspin_unlock_irqrestore(&g_urb_mem_lock, irq_state);\r\n}\r\nint oz_forget_urb(struct urb *urb)\r\n{\r\nunsigned long irq_state;\r\nint i;\r\nint rc = -1;\r\nspin_lock_irqsave(&g_urb_mem_lock, irq_state);\r\nfor (i = 0; i < g_nb_urbs; i++) {\r\nif (g_urb_memory[i] == urb) {\r\nrc = 0;\r\nif (--g_nb_urbs > i)\r\nmemcpy(&g_urb_memory[i], &g_urb_memory[i+1],\r\n(g_nb_urbs - i) * sizeof(struct urb *));\r\noz_trace("%lu: urb down = %d %p\n",\r\njiffies, g_nb_urbs, urb);\r\n}\r\n}\r\nspin_unlock_irqrestore(&g_urb_mem_lock, irq_state);\r\nreturn rc;\r\n}
