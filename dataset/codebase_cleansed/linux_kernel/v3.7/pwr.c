int pwr_sleep_dsp(const u32 sleep_code, const u32 timeout)\r\n{\r\nstruct bridge_drv_interface *intf_fxns;\r\nstruct bridge_dev_context *dw_context;\r\nint status = -EPERM;\r\nstruct dev_object *hdev_obj = NULL;\r\nu32 ioctlcode = 0;\r\nu32 arg = timeout;\r\nfor (hdev_obj = (struct dev_object *)drv_get_first_dev_object();\r\nhdev_obj != NULL;\r\nhdev_obj =\r\n(struct dev_object *)drv_get_next_dev_object((u32) hdev_obj)) {\r\nif (dev_get_bridge_context(hdev_obj,\r\n(struct bridge_dev_context **)\r\n&dw_context)) {\r\ncontinue;\r\n}\r\nif (dev_get_intf_fxns(hdev_obj,\r\n(struct bridge_drv_interface **)\r\n&intf_fxns)) {\r\ncontinue;\r\n}\r\nif (sleep_code == PWR_DEEPSLEEP)\r\nioctlcode = BRDIOCTL_DEEPSLEEP;\r\nelse if (sleep_code == PWR_EMERGENCYDEEPSLEEP)\r\nioctlcode = BRDIOCTL_EMERGENCYSLEEP;\r\nelse\r\nstatus = -EINVAL;\r\nif (status != -EINVAL) {\r\nstatus = (*intf_fxns->dev_cntrl) (dw_context,\r\nioctlcode,\r\n(void *)&arg);\r\n}\r\n}\r\nreturn status;\r\n}\r\nint pwr_wake_dsp(const u32 timeout)\r\n{\r\nstruct bridge_drv_interface *intf_fxns;\r\nstruct bridge_dev_context *dw_context;\r\nint status = -EPERM;\r\nstruct dev_object *hdev_obj = NULL;\r\nu32 arg = timeout;\r\nfor (hdev_obj = (struct dev_object *)drv_get_first_dev_object();\r\nhdev_obj != NULL;\r\nhdev_obj = (struct dev_object *)drv_get_next_dev_object\r\n((u32) hdev_obj)) {\r\nif (!(dev_get_bridge_context(hdev_obj,\r\n(struct bridge_dev_context\r\n**)&dw_context))) {\r\nif (!(dev_get_intf_fxns(hdev_obj,\r\n(struct bridge_drv_interface **)&intf_fxns))) {\r\nstatus =\r\n(*intf_fxns->dev_cntrl) (dw_context,\r\nBRDIOCTL_WAKEUP,\r\n(void *)&arg);\r\n}\r\n}\r\n}\r\nreturn status;\r\n}\r\nint pwr_pm_pre_scale(u16 voltage_domain, u32 level)\r\n{\r\nstruct bridge_drv_interface *intf_fxns;\r\nstruct bridge_dev_context *dw_context;\r\nint status = -EPERM;\r\nstruct dev_object *hdev_obj = NULL;\r\nu32 arg[2];\r\narg[0] = voltage_domain;\r\narg[1] = level;\r\nfor (hdev_obj = (struct dev_object *)drv_get_first_dev_object();\r\nhdev_obj != NULL;\r\nhdev_obj = (struct dev_object *)drv_get_next_dev_object\r\n((u32) hdev_obj)) {\r\nif (!(dev_get_bridge_context(hdev_obj,\r\n(struct bridge_dev_context\r\n**)&dw_context))) {\r\nif (!(dev_get_intf_fxns(hdev_obj,\r\n(struct bridge_drv_interface **)&intf_fxns))) {\r\nstatus =\r\n(*intf_fxns->dev_cntrl) (dw_context,\r\nBRDIOCTL_PRESCALE_NOTIFY,\r\n(void *)&arg);\r\n}\r\n}\r\n}\r\nreturn status;\r\n}\r\nint pwr_pm_post_scale(u16 voltage_domain, u32 level)\r\n{\r\nstruct bridge_drv_interface *intf_fxns;\r\nstruct bridge_dev_context *dw_context;\r\nint status = -EPERM;\r\nstruct dev_object *hdev_obj = NULL;\r\nu32 arg[2];\r\narg[0] = voltage_domain;\r\narg[1] = level;\r\nfor (hdev_obj = (struct dev_object *)drv_get_first_dev_object();\r\nhdev_obj != NULL;\r\nhdev_obj = (struct dev_object *)drv_get_next_dev_object\r\n((u32) hdev_obj)) {\r\nif (!(dev_get_bridge_context(hdev_obj,\r\n(struct bridge_dev_context\r\n**)&dw_context))) {\r\nif (!(dev_get_intf_fxns(hdev_obj,\r\n(struct bridge_drv_interface **)&intf_fxns))) {\r\nstatus =\r\n(*intf_fxns->dev_cntrl) (dw_context,\r\nBRDIOCTL_POSTSCALE_NOTIFY,\r\n(void *)&arg);\r\n}\r\n}\r\n}\r\nreturn status;\r\n}
