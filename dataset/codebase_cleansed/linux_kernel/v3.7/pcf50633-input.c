static void\r\npcf50633_input_irq(int irq, void *data)\r\n{\r\nstruct pcf50633_input *input;\r\nint onkey_released;\r\ninput = data;\r\nonkey_released = pcf50633_reg_read(input->pcf, PCF50633_REG_OOCSTAT)\r\n& PCF50633_OOCSTAT_ONKEY;\r\nif (irq == PCF50633_IRQ_ONKEYF && !onkey_released)\r\ninput_report_key(input->input_dev, KEY_POWER, 1);\r\nelse if (irq == PCF50633_IRQ_ONKEYR && onkey_released)\r\ninput_report_key(input->input_dev, KEY_POWER, 0);\r\ninput_sync(input->input_dev);\r\n}\r\nstatic int __devinit pcf50633_input_probe(struct platform_device *pdev)\r\n{\r\nstruct pcf50633_input *input;\r\nstruct input_dev *input_dev;\r\nint ret;\r\ninput = kzalloc(sizeof(*input), GFP_KERNEL);\r\nif (!input)\r\nreturn -ENOMEM;\r\ninput_dev = input_allocate_device();\r\nif (!input_dev) {\r\nkfree(input);\r\nreturn -ENOMEM;\r\n}\r\nplatform_set_drvdata(pdev, input);\r\ninput->pcf = dev_to_pcf50633(pdev->dev.parent);\r\ninput->input_dev = input_dev;\r\ninput_dev->name = "PCF50633 PMU events";\r\ninput_dev->id.bustype = BUS_I2C;\r\ninput_dev->evbit[0] = BIT(EV_KEY) | BIT(EV_PWR);\r\nset_bit(KEY_POWER, input_dev->keybit);\r\nret = input_register_device(input_dev);\r\nif (ret) {\r\ninput_free_device(input_dev);\r\nkfree(input);\r\nreturn ret;\r\n}\r\npcf50633_register_irq(input->pcf, PCF50633_IRQ_ONKEYR,\r\npcf50633_input_irq, input);\r\npcf50633_register_irq(input->pcf, PCF50633_IRQ_ONKEYF,\r\npcf50633_input_irq, input);\r\nreturn 0;\r\n}\r\nstatic int __devexit pcf50633_input_remove(struct platform_device *pdev)\r\n{\r\nstruct pcf50633_input *input = platform_get_drvdata(pdev);\r\npcf50633_free_irq(input->pcf, PCF50633_IRQ_ONKEYR);\r\npcf50633_free_irq(input->pcf, PCF50633_IRQ_ONKEYF);\r\ninput_unregister_device(input->input_dev);\r\nkfree(input);\r\nreturn 0;\r\n}
