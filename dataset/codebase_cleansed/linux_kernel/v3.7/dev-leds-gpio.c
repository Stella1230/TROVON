void __init ath79_register_leds_gpio(int id,\r\nunsigned num_leds,\r\nstruct gpio_led *leds)\r\n{\r\nstruct platform_device *pdev;\r\nstruct gpio_led_platform_data pdata;\r\nstruct gpio_led *p;\r\nint err;\r\np = kmemdup(leds, num_leds * sizeof(*p), GFP_KERNEL);\r\nif (!p)\r\nreturn;\r\npdev = platform_device_alloc("leds-gpio", id);\r\nif (!pdev)\r\ngoto err_free_leds;\r\nmemset(&pdata, 0, sizeof(pdata));\r\npdata.num_leds = num_leds;\r\npdata.leds = p;\r\nerr = platform_device_add_data(pdev, &pdata, sizeof(pdata));\r\nif (err)\r\ngoto err_put_pdev;\r\nerr = platform_device_add(pdev);\r\nif (err)\r\ngoto err_put_pdev;\r\nreturn;\r\nerr_put_pdev:\r\nplatform_device_put(pdev);\r\nerr_free_leds:\r\nkfree(p);\r\n}
