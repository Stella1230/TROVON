static __devinit int vx855_probe(struct pci_dev *pdev,\r\nconst struct pci_device_id *id)\r\n{\r\nint ret;\r\nu16 gpio_io_offset;\r\nret = pci_enable_device(pdev);\r\nif (ret)\r\nreturn -ENODEV;\r\npci_read_config_word(pdev, VX855_CFG_PMIO_OFFSET, &gpio_io_offset);\r\nif (!gpio_io_offset) {\r\ndev_warn(&pdev->dev,\r\n"BIOS did not assign PMIO base offset?!?\n");\r\nret = -ENODEV;\r\ngoto out;\r\n}\r\ngpio_io_offset &= 0xff80;\r\nvx855_gpio_resources[0].start = gpio_io_offset + VX855_PMIO_R_GPI;\r\nvx855_gpio_resources[0].end = vx855_gpio_resources[0].start + 3;\r\nvx855_gpio_resources[1].start = gpio_io_offset + VX855_PMIO_R_GPO;\r\nvx855_gpio_resources[1].end = vx855_gpio_resources[1].start + 3;\r\nret = mfd_add_devices(&pdev->dev, -1, vx855_cells, ARRAY_SIZE(vx855_cells),\r\nNULL, 0, NULL);\r\nreturn -ENODEV;\r\nout:\r\npci_disable_device(pdev);\r\nreturn ret;\r\n}\r\nstatic void __devexit vx855_remove(struct pci_dev *pdev)\r\n{\r\nmfd_remove_devices(&pdev->dev);\r\npci_disable_device(pdev);\r\n}
