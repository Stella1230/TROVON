static void pseries_kexec_cpu_down(int crash_shutdown, int secondary)\r\n{\r\nif (firmware_has_feature(FW_FEATURE_SPLPAR) && !crash_shutdown) {\r\nint ret;\r\nint cpu = smp_processor_id();\r\nint hwcpu = hard_smp_processor_id();\r\nif (get_lppaca()->dtl_enable_mask) {\r\nret = unregister_dtl(hwcpu);\r\nif (ret) {\r\npr_err("WARNING: DTL deregistration for cpu "\r\n"%d (hw %d) failed with %d\n",\r\ncpu, hwcpu, ret);\r\n}\r\n}\r\nret = unregister_slb_shadow(hwcpu);\r\nif (ret) {\r\npr_err("WARNING: SLB shadow buffer deregistration "\r\n"for cpu %d (hw %d) failed with %d\n",\r\ncpu, hwcpu, ret);\r\n}\r\nret = unregister_vpa(hwcpu);\r\nif (ret) {\r\npr_err("WARNING: VPA deregistration for cpu %d "\r\n"(hw %d) failed with %d\n", cpu, hwcpu, ret);\r\n}\r\n}\r\n}\r\nstatic void pseries_kexec_cpu_down_mpic(int crash_shutdown, int secondary)\r\n{\r\npseries_kexec_cpu_down(crash_shutdown, secondary);\r\nmpic_teardown_this_cpu(secondary);\r\n}\r\nvoid __init setup_kexec_cpu_down_mpic(void)\r\n{\r\nppc_md.kexec_cpu_down = pseries_kexec_cpu_down_mpic;\r\n}\r\nstatic void pseries_kexec_cpu_down_xics(int crash_shutdown, int secondary)\r\n{\r\npseries_kexec_cpu_down(crash_shutdown, secondary);\r\nxics_kexec_teardown_cpu(secondary);\r\n}\r\nvoid __init setup_kexec_cpu_down_xics(void)\r\n{\r\nppc_md.kexec_cpu_down = pseries_kexec_cpu_down_xics;\r\n}
