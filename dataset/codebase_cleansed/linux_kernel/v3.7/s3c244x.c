void __init s3c244x_init_uarts(struct s3c2410_uartcfg *cfg, int no)\r\n{\r\ns3c24xx_init_uartdevs("s3c2440-uart", s3c2410_uart_resources, cfg, no);\r\n}\r\nvoid __init s3c244x_map_io(void)\r\n{\r\niotable_init(s3c244x_iodesc, ARRAY_SIZE(s3c244x_iodesc));\r\ns3c_device_sdi.name = "s3c2440-sdi";\r\ns3c_device_i2c0.name = "s3c2440-i2c";\r\ns3c_nand_setname("s3c2440-nand");\r\ns3c_device_ts.name = "s3c2440-ts";\r\ns3c_device_usbgadget.name = "s3c2440-usbgadget";\r\n}\r\nvoid __init_or_cpufreq s3c244x_setup_clocks(void)\r\n{\r\nstruct clk *xtal_clk;\r\nunsigned long clkdiv;\r\nunsigned long camdiv;\r\nunsigned long xtal;\r\nunsigned long hclk, fclk, pclk;\r\nint hdiv = 1;\r\nxtal_clk = clk_get(NULL, "xtal");\r\nxtal = clk_get_rate(xtal_clk);\r\nclk_put(xtal_clk);\r\nfclk = s3c24xx_get_pll(__raw_readl(S3C2410_MPLLCON), xtal) * 2;\r\nclkdiv = __raw_readl(S3C2410_CLKDIVN);\r\ncamdiv = __raw_readl(S3C2440_CAMDIVN);\r\nswitch (clkdiv & S3C2440_CLKDIVN_HDIVN_MASK) {\r\ncase S3C2440_CLKDIVN_HDIVN_1:\r\nhdiv = 1;\r\nbreak;\r\ncase S3C2440_CLKDIVN_HDIVN_2:\r\nhdiv = 2;\r\nbreak;\r\ncase S3C2440_CLKDIVN_HDIVN_4_8:\r\nhdiv = (camdiv & S3C2440_CAMDIVN_HCLK4_HALF) ? 8 : 4;\r\nbreak;\r\ncase S3C2440_CLKDIVN_HDIVN_3_6:\r\nhdiv = (camdiv & S3C2440_CAMDIVN_HCLK3_HALF) ? 6 : 3;\r\nbreak;\r\n}\r\nhclk = fclk / hdiv;\r\npclk = hclk / ((clkdiv & S3C2440_CLKDIVN_PDIVN) ? 2 : 1);\r\nprintk("S3C244X: core %ld.%03ld MHz, memory %ld.%03ld MHz, peripheral %ld.%03ld MHz\n",\r\nprint_mhz(fclk), print_mhz(hclk), print_mhz(pclk));\r\ns3c24xx_setup_clocks(fclk, hclk, pclk);\r\n}\r\nvoid __init s3c244x_init_clocks(int xtal)\r\n{\r\ns3c24xx_register_baseclocks(xtal);\r\ns3c244x_setup_clocks();\r\ns3c2410_baseclk_add();\r\n}\r\nstatic int __init s3c2440_core_init(void)\r\n{\r\nreturn subsys_system_register(&s3c2440_subsys, NULL);\r\n}\r\nstatic int __init s3c2442_core_init(void)\r\n{\r\nreturn subsys_system_register(&s3c2442_subsys, NULL);\r\n}\r\nstatic int s3c244x_suspend(void)\r\n{\r\ns3c_pm_do_save(s3c244x_sleep, ARRAY_SIZE(s3c244x_sleep));\r\nreturn 0;\r\n}\r\nstatic void s3c244x_resume(void)\r\n{\r\ns3c_pm_do_restore(s3c244x_sleep, ARRAY_SIZE(s3c244x_sleep));\r\n}\r\nvoid s3c244x_restart(char mode, const char *cmd)\r\n{\r\nif (mode == 's')\r\nsoft_restart(0);\r\narch_wdt_reset();\r\nsoft_restart(0);\r\n}
