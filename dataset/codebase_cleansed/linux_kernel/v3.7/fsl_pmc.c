static int pmc_suspend_enter(suspend_state_t state)\r\n{\r\nint ret;\r\nsetbits32(&pmc_regs->pmcsr, PMCSR_SLP);\r\nret = spin_event_timeout((in_be32(&pmc_regs->pmcsr) & PMCSR_SLP) == 0,\r\n10000, 10) ? 0 : -ETIMEDOUT;\r\nif (ret)\r\ndev_err(pmc_dev, "tired waiting for SLP bit to clear\n");\r\nreturn ret;\r\n}\r\nstatic int pmc_suspend_valid(suspend_state_t state)\r\n{\r\nif (state != PM_SUSPEND_STANDBY)\r\nreturn 0;\r\nreturn 1;\r\n}\r\nstatic int pmc_probe(struct platform_device *ofdev)\r\n{\r\npmc_regs = of_iomap(ofdev->dev.of_node, 0);\r\nif (!pmc_regs)\r\nreturn -ENOMEM;\r\npmc_dev = &ofdev->dev;\r\nsuspend_set_ops(&pmc_suspend_ops);\r\nreturn 0;\r\n}\r\nstatic int __init pmc_init(void)\r\n{\r\nreturn platform_driver_register(&pmc_driver);\r\n}
