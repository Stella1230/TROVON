static u32 *\r\ncna_read_firmware(struct pci_dev *pdev, u32 **bfi_image,\r\nu32 *bfi_image_size, char *fw_name)\r\n{\r\nconst struct firmware *fw;\r\nif (request_firmware(&fw, fw_name, &pdev->dev)) {\r\npr_alert("Can't locate firmware %s\n", fw_name);\r\ngoto error;\r\n}\r\n*bfi_image = (u32 *)fw->data;\r\n*bfi_image_size = fw->size/sizeof(u32);\r\nbfi_fw = fw;\r\nreturn *bfi_image;\r\nerror:\r\nreturn NULL;\r\n}\r\nu32 *\r\ncna_get_firmware_buf(struct pci_dev *pdev)\r\n{\r\nif (pdev->device == BFA_PCI_DEVICE_ID_CT2) {\r\nif (bfi_image_ct2_cna_size == 0)\r\ncna_read_firmware(pdev, &bfi_image_ct2_cna,\r\n&bfi_image_ct2_cna_size, CNA_FW_FILE_CT2);\r\nreturn bfi_image_ct2_cna;\r\n} else if (bfa_asic_id_ct(pdev->device)) {\r\nif (bfi_image_ct_cna_size == 0)\r\ncna_read_firmware(pdev, &bfi_image_ct_cna,\r\n&bfi_image_ct_cna_size, CNA_FW_FILE_CT);\r\nreturn bfi_image_ct_cna;\r\n}\r\nreturn NULL;\r\n}\r\nu32 *\r\nbfa_cb_image_get_chunk(enum bfi_asic_gen asic_gen, u32 off)\r\n{\r\nswitch (asic_gen) {\r\ncase BFI_ASIC_GEN_CT:\r\nreturn (bfi_image_ct_cna + off);\r\nbreak;\r\ncase BFI_ASIC_GEN_CT2:\r\nreturn (bfi_image_ct2_cna + off);\r\nbreak;\r\ndefault:\r\nreturn NULL;\r\n}\r\n}\r\nu32\r\nbfa_cb_image_get_size(enum bfi_asic_gen asic_gen)\r\n{\r\nswitch (asic_gen) {\r\ncase BFI_ASIC_GEN_CT:\r\nreturn bfi_image_ct_cna_size;\r\nbreak;\r\ncase BFI_ASIC_GEN_CT2:\r\nreturn bfi_image_ct2_cna_size;\r\nbreak;\r\ndefault:\r\nreturn 0;\r\n}\r\n}
