static int smdk_hw_params(struct snd_pcm_substream *substream,\r\nstruct snd_pcm_hw_params *params)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nstruct snd_soc_dai *cpu_dai = rtd->cpu_dai;\r\nstruct snd_soc_dai *codec_dai = rtd->codec_dai;\r\nunsigned int pll_out;\r\nint ret;\r\nif (params_format(params) == SNDRV_PCM_FORMAT_S24_LE)\r\npll_out = params_rate(params) * 384;\r\nelse if (params_rate(params) == 8000 || params_rate(params) == 11025)\r\npll_out = params_rate(params) * 512;\r\nelse\r\npll_out = params_rate(params) * 256;\r\nret = snd_soc_dai_set_fmt(codec_dai, SND_SOC_DAIFMT_I2S\r\n| SND_SOC_DAIFMT_NB_NF\r\n| SND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_fmt(cpu_dai, SND_SOC_DAIFMT_I2S\r\n| SND_SOC_DAIFMT_NB_NF\r\n| SND_SOC_DAIFMT_CBM_CFM);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_pll(codec_dai, WM8994_FLL1, WM8994_FLL_SRC_MCLK1,\r\nSMDK_WM8994_FREQ, pll_out);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(codec_dai, WM8994_SYSCLK_FLL1,\r\npll_out, SND_SOC_CLOCK_IN);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int smdk_wm8994_init_paiftx(struct snd_soc_pcm_runtime *rtd)\r\n{\r\nstruct snd_soc_codec *codec = rtd->codec;\r\nstruct snd_soc_dapm_context *dapm = &codec->dapm;\r\nsnd_soc_dapm_enable_pin(dapm, "HPOUT1R");\r\nsnd_soc_dapm_enable_pin(dapm, "HPOUT1L");\r\nsnd_soc_dapm_enable_pin(dapm, "IN1LN");\r\nsnd_soc_dapm_enable_pin(dapm, "IN1RN");\r\nsnd_soc_dapm_enable_pin(dapm, "IN2LN");\r\nsnd_soc_dapm_enable_pin(dapm, "IN2RN");\r\nsnd_soc_dapm_nc_pin(dapm, "HPOUT2P");\r\nsnd_soc_dapm_nc_pin(dapm, "HPOUT2N");\r\nsnd_soc_dapm_nc_pin(dapm, "SPKOUTLN");\r\nsnd_soc_dapm_nc_pin(dapm, "SPKOUTLP");\r\nsnd_soc_dapm_nc_pin(dapm, "SPKOUTRP");\r\nsnd_soc_dapm_nc_pin(dapm, "SPKOUTRN");\r\nsnd_soc_dapm_nc_pin(dapm, "LINEOUT1N");\r\nsnd_soc_dapm_nc_pin(dapm, "LINEOUT1P");\r\nsnd_soc_dapm_nc_pin(dapm, "LINEOUT2N");\r\nsnd_soc_dapm_nc_pin(dapm, "LINEOUT2P");\r\nsnd_soc_dapm_nc_pin(dapm, "IN1LP");\r\nsnd_soc_dapm_nc_pin(dapm, "IN2LP:VXRN");\r\nsnd_soc_dapm_nc_pin(dapm, "IN1RP");\r\nsnd_soc_dapm_nc_pin(dapm, "IN2RP:VXRP");\r\nreturn 0;\r\n}\r\nstatic int __devinit smdk_audio_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nstruct snd_soc_card *card = &smdk;\r\ncard->dev = &pdev->dev;\r\nret = snd_soc_register_card(card);\r\nif (ret)\r\ndev_err(&pdev->dev, "snd_soc_register_card() failed:%d\n", ret);\r\nreturn ret;\r\n}\r\nstatic int __devexit smdk_audio_remove(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = platform_get_drvdata(pdev);\r\nsnd_soc_unregister_card(card);\r\nreturn 0;\r\n}
