static int bu21013_gpio_board_init(int reset_pin)\r\n{\r\nint retval = 0;\r\nbu21013_devices++;\r\nif (bu21013_devices == 1) {\r\nretval = gpio_request(reset_pin, "touchp_reset");\r\nif (retval) {\r\nprintk(KERN_ERR "Unable to request gpio reset_pin");\r\nreturn retval;\r\n}\r\nretval = gpio_direction_output(reset_pin, 1);\r\nif (retval < 0) {\r\nprintk(KERN_ERR "%s: gpio direction failed\n",\r\n__func__);\r\nreturn retval;\r\n}\r\n}\r\nreturn retval;\r\n}\r\nstatic int bu21013_gpio_board_exit(int reset_pin)\r\n{\r\nint retval = 0;\r\nif (bu21013_devices == 1) {\r\nretval = gpio_direction_output(reset_pin, 0);\r\nif (retval < 0) {\r\nprintk(KERN_ERR "%s: gpio direction failed\n",\r\n__func__);\r\nreturn retval;\r\n}\r\ngpio_set_value(reset_pin, 0);\r\n}\r\nbu21013_devices--;\r\nreturn retval;\r\n}\r\nstatic int bu21013_read_pin_val(void)\r\n{\r\nreturn gpio_get_value(TOUCH_GPIO_PIN);\r\n}\r\nvoid __init mop500_stuib_init(void)\r\n{\r\nif (machine_is_hrefv60()) {\r\ntsc_plat_device.cs_pin = HREFV60_TOUCH_RST_GPIO;\r\ntsc_plat2_device.cs_pin = HREFV60_TOUCH_RST_GPIO;\r\n} else {\r\ntsc_plat_device.cs_pin = GPIO_BU21013_CS;\r\ntsc_plat2_device.cs_pin = GPIO_BU21013_CS;\r\n}\r\nmop500_uib_i2c_add(0, mop500_i2c0_devices_stuib,\r\nARRAY_SIZE(mop500_i2c0_devices_stuib));\r\nmop500_uib_i2c_add(3, u8500_i2c3_devices_stuib,\r\nARRAY_SIZE(u8500_i2c3_devices_stuib));\r\n}
