static bool __init ms_hyperv_platform(void)\r\n{\r\nu32 eax;\r\nu32 hyp_signature[3];\r\nif (!boot_cpu_has(X86_FEATURE_HYPERVISOR))\r\nreturn false;\r\ncpuid(HYPERV_CPUID_VENDOR_AND_MAX_FUNCTIONS,\r\n&eax, &hyp_signature[0], &hyp_signature[1], &hyp_signature[2]);\r\nreturn eax >= HYPERV_CPUID_MIN &&\r\neax <= HYPERV_CPUID_MAX &&\r\n!memcmp("Microsoft Hv", hyp_signature, 12);\r\n}\r\nstatic cycle_t read_hv_clock(struct clocksource *arg)\r\n{\r\ncycle_t current_tick;\r\nrdmsrl(HV_X64_MSR_TIME_REF_COUNT, current_tick);\r\nreturn current_tick;\r\n}\r\nstatic void __init ms_hyperv_init_platform(void)\r\n{\r\nms_hyperv.features = cpuid_eax(HYPERV_CPUID_FEATURES);\r\nms_hyperv.hints = cpuid_eax(HYPERV_CPUID_ENLIGHTMENT_INFO);\r\nprintk(KERN_INFO "HyperV: features 0x%x, hints 0x%x\n",\r\nms_hyperv.features, ms_hyperv.hints);\r\nclocksource_register_hz(&hyperv_cs, NSEC_PER_SEC/100);\r\n}
