static int ip175c_config_init(struct phy_device *phydev)\r\n{\r\nint err, i;\r\nstatic int full_reset_performed = 0;\r\nif (full_reset_performed == 0) {\r\nerr = mdiobus_write(phydev->bus, 30, 0, 0x175c);\r\nif (err < 0)\r\nreturn err;\r\nerr = mdiobus_read(phydev->bus, 30, 0);\r\nmdelay(2);\r\nerr = mdiobus_write(phydev->bus, 29, 31, 0x175c);\r\nif (err < 0)\r\nreturn err;\r\nerr = mdiobus_write(phydev->bus, 29, 22, 0x420);\r\nif (err < 0)\r\nreturn err;\r\nfor (i = 0; i < 5; i++) {\r\nerr = mdiobus_write(phydev->bus, i,\r\nMII_BMCR, BMCR_RESET);\r\nif (err < 0)\r\nreturn err;\r\n}\r\nfor (i = 0; i < 5; i++)\r\nerr = mdiobus_read(phydev->bus, i, MII_BMCR);\r\nmdelay(2);\r\nfull_reset_performed = 1;\r\n}\r\nif (phydev->addr != 4) {\r\nphydev->state = PHY_RUNNING;\r\nphydev->speed = SPEED_100;\r\nphydev->duplex = DUPLEX_FULL;\r\nphydev->link = 1;\r\nnetif_carrier_on(phydev->attached_dev);\r\n}\r\nreturn 0;\r\n}\r\nstatic int ip1xx_reset(struct phy_device *phydev)\r\n{\r\nint bmcr;\r\nbmcr = phy_read(phydev, MII_BMCR);\r\nif (bmcr < 0)\r\nreturn bmcr;\r\nbmcr |= BMCR_RESET;\r\nbmcr = phy_write(phydev, MII_BMCR, bmcr);\r\nif (bmcr < 0)\r\nreturn bmcr;\r\ndo {\r\nbmcr = phy_read(phydev, MII_BMCR);\r\nif (bmcr < 0)\r\nreturn bmcr;\r\n} while (bmcr & BMCR_RESET);\r\nreturn 0;\r\n}\r\nstatic int ip1001_config_init(struct phy_device *phydev)\r\n{\r\nint c;\r\nc = ip1xx_reset(phydev);\r\nif (c < 0)\r\nreturn c;\r\nc = phy_read(phydev, IP1001_SPEC_CTRL_STATUS_2);\r\nif (c < 0)\r\nreturn c;\r\nc |= IP1001_APS_ON;\r\nc = phy_write(phydev, IP1001_SPEC_CTRL_STATUS_2, c);\r\nif (c < 0)\r\nreturn c;\r\nc = phy_write(phydev, IP101A_G_IRQ_CONF_STATUS, IP101A_G_IRQ_DEFAULT);\r\nif (c < 0)\r\nreturn c;\r\nif (phydev->interface == PHY_INTERFACE_MODE_RGMII) {\r\nc = phy_read(phydev, IP10XX_SPEC_CTRL_STATUS);\r\nif (c < 0)\r\nreturn c;\r\nc |= IP1001_PHASE_SEL_MASK;\r\nc = phy_write(phydev, IP10XX_SPEC_CTRL_STATUS, c);\r\nif (c < 0)\r\nreturn c;\r\n}\r\nreturn 0;\r\n}\r\nstatic int ip101a_g_config_init(struct phy_device *phydev)\r\n{\r\nint c;\r\nc = ip1xx_reset(phydev);\r\nif (c < 0)\r\nreturn c;\r\nc = phy_read(phydev, IP10XX_SPEC_CTRL_STATUS);\r\nc |= IP101A_G_APS_ON;\r\nreturn phy_write(phydev, IP10XX_SPEC_CTRL_STATUS, c);\r\n}\r\nstatic int ip175c_read_status(struct phy_device *phydev)\r\n{\r\nif (phydev->addr == 4)\r\ngenphy_read_status(phydev);\r\nelse\r\nphydev->irq = PHY_IGNORE_INTERRUPT;\r\nreturn 0;\r\n}\r\nstatic int ip175c_config_aneg(struct phy_device *phydev)\r\n{\r\nif (phydev->addr == 4)\r\ngenphy_config_aneg(phydev);\r\nreturn 0;\r\n}\r\nstatic int ip101a_g_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err = phy_read(phydev, IP101A_G_IRQ_CONF_STATUS);\r\nif (err < 0)\r\nreturn err;\r\nreturn 0;\r\n}\r\nstatic int __init icplus_init(void)\r\n{\r\nreturn phy_drivers_register(icplus_driver,\r\nARRAY_SIZE(icplus_driver));\r\n}\r\nstatic void __exit icplus_exit(void)\r\n{\r\nphy_drivers_unregister(icplus_driver,\r\nARRAY_SIZE(icplus_driver));\r\n}
