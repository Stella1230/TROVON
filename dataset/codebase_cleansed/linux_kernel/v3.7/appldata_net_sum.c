static void appldata_get_net_sum_data(void *data)\r\n{\r\nint i;\r\nstruct appldata_net_sum_data *net_data;\r\nstruct net_device *dev;\r\nunsigned long rx_packets, tx_packets, rx_bytes, tx_bytes, rx_errors,\r\ntx_errors, rx_dropped, tx_dropped, collisions;\r\nnet_data = data;\r\nnet_data->sync_count_1++;\r\ni = 0;\r\nrx_packets = 0;\r\ntx_packets = 0;\r\nrx_bytes = 0;\r\ntx_bytes = 0;\r\nrx_errors = 0;\r\ntx_errors = 0;\r\nrx_dropped = 0;\r\ntx_dropped = 0;\r\ncollisions = 0;\r\nrcu_read_lock();\r\nfor_each_netdev_rcu(&init_net, dev) {\r\nconst struct rtnl_link_stats64 *stats;\r\nstruct rtnl_link_stats64 temp;\r\nstats = dev_get_stats(dev, &temp);\r\nrx_packets += stats->rx_packets;\r\ntx_packets += stats->tx_packets;\r\nrx_bytes += stats->rx_bytes;\r\ntx_bytes += stats->tx_bytes;\r\nrx_errors += stats->rx_errors;\r\ntx_errors += stats->tx_errors;\r\nrx_dropped += stats->rx_dropped;\r\ntx_dropped += stats->tx_dropped;\r\ncollisions += stats->collisions;\r\ni++;\r\n}\r\nrcu_read_unlock();\r\nnet_data->nr_interfaces = i;\r\nnet_data->rx_packets = rx_packets;\r\nnet_data->tx_packets = tx_packets;\r\nnet_data->rx_bytes = rx_bytes;\r\nnet_data->tx_bytes = tx_bytes;\r\nnet_data->rx_errors = rx_errors;\r\nnet_data->tx_errors = tx_errors;\r\nnet_data->rx_dropped = rx_dropped;\r\nnet_data->tx_dropped = tx_dropped;\r\nnet_data->collisions = collisions;\r\nnet_data->timestamp = get_clock();\r\nnet_data->sync_count_2++;\r\n}\r\nstatic int __init appldata_net_init(void)\r\n{\r\nreturn appldata_register_ops(&ops);\r\n}\r\nstatic void __exit appldata_net_exit(void)\r\n{\r\nappldata_unregister_ops(&ops);\r\n}
