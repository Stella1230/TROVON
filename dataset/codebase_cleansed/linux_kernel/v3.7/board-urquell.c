static int __init urquell_devices_setup(void)\r\n{\r\ngpio_request(GPIO_FN_USB_OVC0, NULL);\r\ngpio_request(GPIO_FN_USB_PENC0, NULL);\r\n__raw_writew(__raw_readw(UBOARDREG(IRL2MSKR)) & ~0x00000001,\r\nUBOARDREG(IRL2MSKR));\r\nreturn platform_add_devices(urquell_devices,\r\nARRAY_SIZE(urquell_devices));\r\n}\r\nstatic void urquell_power_off(void)\r\n{\r\n__raw_writew(0xa5a5, UBOARDREG(SRSTR));\r\n}\r\nstatic void __init urquell_init_irq(void)\r\n{\r\nplat_irq_setup_pins(IRQ_MODE_IRL3210_MASK);\r\n}\r\nstatic int urquell_mode_pins(void)\r\n{\r\nreturn __raw_readw(UBOARDREG(MDSWMR));\r\n}\r\nstatic int urquell_clk_init(void)\r\n{\r\nstruct clk *clk;\r\nint ret;\r\nif (test_mode_pin(MODE_PIN9))\r\nreturn -EINVAL;\r\nclk = clk_get(NULL, "extal");\r\nif (IS_ERR(clk))\r\nreturn PTR_ERR(clk);\r\nret = clk_set_rate(clk, 33333333);\r\nclk_put(clk);\r\nreturn ret;\r\n}\r\nstatic void __init urquell_setup(char **cmdline_p)\r\n{\r\nprintk(KERN_INFO "Renesas Technology Corp. Urquell support.\n");\r\npm_power_off = urquell_power_off;\r\nregister_smp_ops(&shx3_smp_ops);\r\n}
