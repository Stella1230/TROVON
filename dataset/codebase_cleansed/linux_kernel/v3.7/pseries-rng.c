static int pseries_rng_data_read(struct hwrng *rng, u32 *data)\r\n{\r\nif (plpar_hcall(H_RANDOM, (unsigned long *)data) != H_SUCCESS) {\r\nprintk(KERN_ERR "pseries rng hcall error\n");\r\nreturn 0;\r\n}\r\nreturn 8;\r\n}\r\nstatic unsigned long pseries_rng_get_desired_dma(struct vio_dev *vdev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int __init pseries_rng_probe(struct vio_dev *dev,\r\nconst struct vio_device_id *id)\r\n{\r\nreturn hwrng_register(&pseries_rng);\r\n}\r\nstatic int __exit pseries_rng_remove(struct vio_dev *dev)\r\n{\r\nhwrng_unregister(&pseries_rng);\r\nreturn 0;\r\n}\r\nstatic int __init rng_init(void)\r\n{\r\nprintk(KERN_INFO "Registering IBM pSeries RNG driver\n");\r\nreturn vio_register_driver(&pseries_rng_driver);\r\n}\r\nstatic void __exit rng_exit(void)\r\n{\r\nvio_unregister_driver(&pseries_rng_driver);\r\n}
