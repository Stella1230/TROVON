u32 am33xx_prm_read_reg(s16 inst, u16 idx)\r\n{\r\nreturn __raw_readl(prm_base + inst + idx);\r\n}\r\nvoid am33xx_prm_write_reg(u32 val, s16 inst, u16 idx)\r\n{\r\n__raw_writel(val, prm_base + inst + idx);\r\n}\r\nu32 am33xx_prm_rmw_reg_bits(u32 mask, u32 bits, s16 inst, s16 idx)\r\n{\r\nu32 v;\r\nv = am33xx_prm_read_reg(inst, idx);\r\nv &= ~mask;\r\nv |= bits;\r\nam33xx_prm_write_reg(v, inst, idx);\r\nreturn v;\r\n}\r\nint am33xx_prm_is_hardreset_asserted(u8 shift, s16 inst, u16 rstctrl_offs)\r\n{\r\nu32 v;\r\nv = am33xx_prm_read_reg(inst, rstctrl_offs);\r\nv &= 1 << shift;\r\nv >>= shift;\r\nreturn v;\r\n}\r\nint am33xx_prm_assert_hardreset(u8 shift, s16 inst, u16 rstctrl_offs)\r\n{\r\nu32 mask = 1 << shift;\r\nam33xx_prm_rmw_reg_bits(mask, mask, inst, rstctrl_offs);\r\nreturn 0;\r\n}\r\nint am33xx_prm_deassert_hardreset(u8 shift, s16 inst,\r\nu16 rstctrl_offs, u16 rstst_offs)\r\n{\r\nint c;\r\nu32 mask = 1 << shift;\r\nif (am33xx_prm_is_hardreset_asserted(shift, inst, rstctrl_offs) == 0)\r\nreturn -EEXIST;\r\nam33xx_prm_rmw_reg_bits(0xffffffff, mask, inst, rstst_offs);\r\nam33xx_prm_rmw_reg_bits(mask, 0, inst, rstctrl_offs);\r\nomap_test_timeout(am33xx_prm_is_hardreset_asserted(shift, inst,\r\nrstst_offs),\r\nMAX_MODULE_HARDRESET_WAIT, c);\r\nreturn (c == MAX_MODULE_HARDRESET_WAIT) ? -EBUSY : 0;\r\n}
