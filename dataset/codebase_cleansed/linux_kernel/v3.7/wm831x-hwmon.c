static ssize_t show_name(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "wm831x\n");\r\n}\r\nstatic ssize_t show_voltage(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct wm831x_hwmon *hwmon = dev_get_drvdata(dev);\r\nint channel = to_sensor_dev_attr(attr)->index;\r\nint ret;\r\nret = wm831x_auxadc_read_uv(hwmon->wm831x, channel);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn sprintf(buf, "%d\n", DIV_ROUND_CLOSEST(ret, 1000));\r\n}\r\nstatic ssize_t show_chip_temp(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct wm831x_hwmon *hwmon = dev_get_drvdata(dev);\r\nint channel = to_sensor_dev_attr(attr)->index;\r\nint ret;\r\nret = wm831x_auxadc_read(hwmon->wm831x, channel);\r\nif (ret < 0)\r\nreturn ret;\r\nret = 512180 - (ret * 1000);\r\nret = DIV_ROUND_CLOSEST(ret * 10000, 10983);\r\nreturn sprintf(buf, "%d\n", ret);\r\n}\r\nstatic ssize_t show_label(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nint channel = to_sensor_dev_attr(attr)->index;\r\nreturn sprintf(buf, "%s\n", input_names[channel]);\r\n}\r\nstatic int __devinit wm831x_hwmon_probe(struct platform_device *pdev)\r\n{\r\nstruct wm831x *wm831x = dev_get_drvdata(pdev->dev.parent);\r\nstruct wm831x_hwmon *hwmon;\r\nint ret;\r\nhwmon = devm_kzalloc(&pdev->dev, sizeof(struct wm831x_hwmon),\r\nGFP_KERNEL);\r\nif (!hwmon)\r\nreturn -ENOMEM;\r\nhwmon->wm831x = wm831x;\r\nret = sysfs_create_group(&pdev->dev.kobj, &wm831x_attr_group);\r\nif (ret)\r\nreturn ret;\r\nhwmon->classdev = hwmon_device_register(&pdev->dev);\r\nif (IS_ERR(hwmon->classdev)) {\r\nret = PTR_ERR(hwmon->classdev);\r\ngoto err_sysfs;\r\n}\r\nplatform_set_drvdata(pdev, hwmon);\r\nreturn 0;\r\nerr_sysfs:\r\nsysfs_remove_group(&pdev->dev.kobj, &wm831x_attr_group);\r\nreturn ret;\r\n}\r\nstatic int __devexit wm831x_hwmon_remove(struct platform_device *pdev)\r\n{\r\nstruct wm831x_hwmon *hwmon = platform_get_drvdata(pdev);\r\nhwmon_device_unregister(hwmon->classdev);\r\nsysfs_remove_group(&pdev->dev.kobj, &wm831x_attr_group);\r\nreturn 0;\r\n}
