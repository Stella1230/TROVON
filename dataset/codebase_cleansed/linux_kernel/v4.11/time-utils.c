int parse_nsec_time(const char *str, u64 *ptime)\r\n{\r\nu64 time_sec, time_nsec;\r\nchar *end;\r\ntime_sec = strtoul(str, &end, 10);\r\nif (*end != '.' && *end != '\0')\r\nreturn -1;\r\nif (*end == '.') {\r\nint i;\r\nchar nsec_buf[10];\r\nif (strlen(++end) > 9)\r\nreturn -1;\r\nstrncpy(nsec_buf, end, 9);\r\nnsec_buf[9] = '\0';\r\nfor (i = strlen(nsec_buf); i < 9; i++)\r\nnsec_buf[i] = '0';\r\ntime_nsec = strtoul(nsec_buf, &end, 10);\r\nif (*end != '\0')\r\nreturn -1;\r\n} else\r\ntime_nsec = 0;\r\n*ptime = time_sec * NSEC_PER_SEC + time_nsec;\r\nreturn 0;\r\n}\r\nstatic int parse_timestr_sec_nsec(struct perf_time_interval *ptime,\r\nchar *start_str, char *end_str)\r\n{\r\nif (start_str && (*start_str != '\0') &&\r\n(parse_nsec_time(start_str, &ptime->start) != 0)) {\r\nreturn -1;\r\n}\r\nif (end_str && (*end_str != '\0') &&\r\n(parse_nsec_time(end_str, &ptime->end) != 0)) {\r\nreturn -1;\r\n}\r\nreturn 0;\r\n}\r\nint perf_time__parse_str(struct perf_time_interval *ptime, const char *ostr)\r\n{\r\nchar *start_str, *end_str;\r\nchar *d, *str;\r\nint rc = 0;\r\nif (ostr == NULL || *ostr == '\0')\r\nreturn 0;\r\nstr = strdup(ostr);\r\nif (str == NULL)\r\nreturn -ENOMEM;\r\nptime->start = 0;\r\nptime->end = 0;\r\nstart_str = str;\r\nd = strchr(start_str, ',');\r\nif (d) {\r\n*d = '\0';\r\n++d;\r\n}\r\nend_str = d;\r\nrc = parse_timestr_sec_nsec(ptime, start_str, end_str);\r\nfree(str);\r\nif (rc == 0 && ptime->end && ptime->end < ptime->start)\r\nreturn -EINVAL;\r\npr_debug("start time %" PRIu64 ", ", ptime->start);\r\npr_debug("end time %" PRIu64 "\n", ptime->end);\r\nreturn rc;\r\n}\r\nbool perf_time__skip_sample(struct perf_time_interval *ptime, u64 timestamp)\r\n{\r\nif (timestamp == 0)\r\nreturn false;\r\nif ((ptime->start && timestamp < ptime->start) ||\r\n(ptime->end && timestamp > ptime->end)) {\r\nreturn true;\r\n}\r\nreturn false;\r\n}
