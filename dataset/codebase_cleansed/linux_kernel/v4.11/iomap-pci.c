void __iomem *__pci_ioport_map(struct pci_dev *dev,\r\nunsigned long port, unsigned int nr)\r\n{\r\nstruct pci_controller *ctrl = dev->bus->sysdata;\r\nunsigned long base = ctrl->io_map_base;\r\nif (unlikely(!ctrl->io_map_base)) {\r\nstruct pci_bus *bus = dev->bus;\r\nchar name[8];\r\nwhile (bus->parent)\r\nbus = bus->parent;\r\nctrl->io_map_base = base = mips_io_port_base;\r\nsprintf(name, "%04x:%02x", pci_domain_nr(bus), bus->number);\r\nprintk(KERN_WARNING "io_map_base of root PCI bus %s unset. "\r\n"Trying to continue but you better\nfix this issue or "\r\n"report it to linux-mips@linux-mips.org or your "\r\n"vendor.\n", name);\r\n#ifdef CONFIG_PCI_DOMAINS\r\npanic("To avoid data corruption io_map_base MUST be set with "\r\n"multiple PCI domains.");\r\n#endif\r\n}\r\nreturn (void __iomem *) (ctrl->io_map_base + port);\r\n}\r\nvoid pci_iounmap(struct pci_dev *dev, void __iomem * addr)\r\n{\r\niounmap(addr);\r\n}
