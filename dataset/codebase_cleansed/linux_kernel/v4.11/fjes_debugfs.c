static int fjes_dbg_status_show(struct seq_file *m, void *v)\r\n{\r\nstruct fjes_adapter *adapter = m->private;\r\nstruct fjes_hw *hw = &adapter->hw;\r\nint max_epid = hw->max_epid;\r\nint my_epid = hw->my_epid;\r\nint epidx;\r\nseq_puts(m, "EPID\tSTATUS SAME_ZONE CONNECTED\n");\r\nfor (epidx = 0; epidx < max_epid; epidx++) {\r\nif (epidx == my_epid) {\r\nseq_printf(m, "ep%d\t%-16c %-16c %-16c\n",\r\nepidx, '-', '-', '-');\r\n} else {\r\nseq_printf(m, "ep%d\t%-16s %-16c %-16c\n",\r\nepidx,\r\nep_status_string[fjes_hw_get_partner_ep_status(hw, epidx)],\r\nfjes_hw_epid_is_same_zone(hw, epidx) ? 'Y' : 'N',\r\nfjes_hw_epid_is_shared(hw->hw_info.share, epidx) ? 'Y' : 'N');\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic int fjes_dbg_status_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, fjes_dbg_status_show, inode->i_private);\r\n}\r\nvoid fjes_dbg_adapter_init(struct fjes_adapter *adapter)\r\n{\r\nconst char *name = dev_name(&adapter->plat_dev->dev);\r\nstruct dentry *pfile;\r\nadapter->dbg_adapter = debugfs_create_dir(name, fjes_debug_root);\r\nif (!adapter->dbg_adapter) {\r\ndev_err(&adapter->plat_dev->dev,\r\n"debugfs entry for %s failed\n", name);\r\nreturn;\r\n}\r\npfile = debugfs_create_file("status", 0444, adapter->dbg_adapter,\r\nadapter, &fjes_dbg_status_fops);\r\nif (!pfile)\r\ndev_err(&adapter->plat_dev->dev,\r\n"debugfs status for %s failed\n", name);\r\n}\r\nvoid fjes_dbg_adapter_exit(struct fjes_adapter *adapter)\r\n{\r\ndebugfs_remove_recursive(adapter->dbg_adapter);\r\nadapter->dbg_adapter = NULL;\r\n}\r\nvoid fjes_dbg_init(void)\r\n{\r\nfjes_debug_root = debugfs_create_dir(fjes_driver_name, NULL);\r\nif (!fjes_debug_root)\r\npr_info("init of debugfs failed\n");\r\n}\r\nvoid fjes_dbg_exit(void)\r\n{\r\ndebugfs_remove_recursive(fjes_debug_root);\r\nfjes_debug_root = NULL;\r\n}
