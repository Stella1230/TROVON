static int cavium_rng_probe(struct pci_dev *pdev,\r\nconst struct pci_device_id *id)\r\n{\r\nstruct cavium_rng_pf *rng;\r\nint iov_err;\r\nrng = devm_kzalloc(&pdev->dev, sizeof(*rng), GFP_KERNEL);\r\nif (!rng)\r\nreturn -ENOMEM;\r\nrng->control_status = pcim_iomap(pdev, 0, 0);\r\nif (!rng->control_status) {\r\ndev_err(&pdev->dev,\r\n"Error iomap failed retrieving control_status.\n");\r\nreturn -ENOMEM;\r\n}\r\nwriteq(THUNDERX_RNM_RNG_EN | THUNDERX_RNM_ENT_EN,\r\nrng->control_status);\r\npci_set_drvdata(pdev, rng);\r\niov_err = pci_enable_sriov(pdev, 1);\r\nif (iov_err != 0) {\r\nwriteq(0, rng->control_status);\r\ndev_err(&pdev->dev,\r\n"Error initializing RNG virtual function,(%i).\n",\r\niov_err);\r\nreturn iov_err;\r\n}\r\nreturn 0;\r\n}\r\nvoid cavium_rng_remove(struct pci_dev *pdev)\r\n{\r\nstruct cavium_rng_pf *rng;\r\nrng = pci_get_drvdata(pdev);\r\npci_disable_sriov(pdev);\r\nwriteq(0, rng->control_status);\r\n}
