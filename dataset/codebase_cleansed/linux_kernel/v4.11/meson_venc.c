void meson_venci_cvbs_mode_set(struct meson_drm *priv,\r\nstruct meson_cvbs_enci_mode *mode)\r\n{\r\nif (mode->mode_tag == priv->venc.current_mode)\r\nreturn;\r\nwritel_relaxed(0x12, priv->io_base + _REG(ENCI_CFILT_CTRL));\r\nwritel_relaxed(0x12, priv->io_base + _REG(ENCI_CFILT_CTRL2));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_DVI_SETTING));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));\r\nwritel_relaxed(mode->hso_begin,\r\npriv->io_base + _REG(ENCI_SYNC_HSO_BEGIN));\r\nwritel_relaxed(mode->hso_end,\r\npriv->io_base + _REG(ENCI_SYNC_HSO_END));\r\nwritel_relaxed(mode->vso_even,\r\npriv->io_base + _REG(ENCI_SYNC_VSO_EVNLN));\r\nwritel_relaxed(mode->vso_odd,\r\npriv->io_base + _REG(ENCI_SYNC_VSO_ODDLN));\r\nwritel_relaxed(0x8100 + mode->macv_max_amp,\r\npriv->io_base + _REG(ENCI_MACV_MAX_AMP));\r\nwritel_relaxed(mode->video_prog_mode,\r\npriv->io_base + _REG(VENC_VIDEO_PROG_MODE));\r\nwritel_relaxed(mode->video_mode,\r\npriv->io_base + _REG(ENCI_VIDEO_MODE));\r\nwritel_relaxed(0x26, priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));\r\nwritel(mode->sch_adjust, priv->io_base + _REG(ENCI_VIDEO_SCH));\r\nwritel_relaxed(0x07, priv->io_base + _REG(ENCI_SYNC_MODE));\r\nwritel_relaxed(mode->yc_delay, priv->io_base + _REG(ENCI_YC_DELAY));\r\nwritel_relaxed(mode->pixel_start,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_START));\r\nwritel_relaxed(mode->pixel_end,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_END));\r\nwritel_relaxed(mode->top_field_line_start,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_START));\r\nwritel_relaxed(mode->top_field_line_end,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_END));\r\nwritel_relaxed(mode->bottom_field_line_start,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_START));\r\nwritel_relaxed(mode->bottom_field_line_end,\r\npriv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_END));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_SYNC_ROUTE));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCI_DBG_PX_RST));\r\nwritel_relaxed(0x4e01, priv->io_base + _REG(ENCI_VFIFO2VD_CTL));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_SETTING));\r\nwritel_relaxed(0x0061, priv->io_base + _REG(VENC_UPSAMPLE_CTRL0));\r\nwritel_relaxed(0x4061, priv->io_base + _REG(VENC_UPSAMPLE_CTRL1));\r\nwritel_relaxed(0x5061, priv->io_base + _REG(VENC_UPSAMPLE_CTRL2));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL0));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL1));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL2));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL3));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL4));\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL5));\r\nmeson_vpp_setup_mux(priv, MESON_VIU_VPP_MUX_ENCI);\r\nwritel_relaxed(0x2000, priv->io_base + _REG(VENC_VDAC_FIFO_CTRL));\r\nwritel_relaxed(0x11, priv->io_base + _REG(ENCI_DACSEL_0));\r\nwritel_relaxed(0x11, priv->io_base + _REG(ENCI_DACSEL_1));\r\nwritel_relaxed(1, priv->io_base + _REG(ENCI_VIDEO_EN));\r\nwritel_relaxed(mode->video_saturation,\r\npriv->io_base + _REG(ENCI_VIDEO_SAT));\r\nwritel_relaxed(mode->video_contrast,\r\npriv->io_base + _REG(ENCI_VIDEO_CONT));\r\nwritel_relaxed(mode->video_brightness,\r\npriv->io_base + _REG(ENCI_VIDEO_BRIGHT));\r\nwritel_relaxed(mode->video_hue,\r\npriv->io_base + _REG(ENCI_VIDEO_HUE));\r\nwritel_relaxed(0x1, priv->io_base + _REG(VENC_VDAC_DAC0_FILT_CTRL0));\r\nwritel_relaxed(0xfc48, priv->io_base + _REG(VENC_VDAC_DAC0_FILT_CTRL1));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCI_MACV_N0));\r\nwritel_relaxed(mode->analog_sync_adj,\r\npriv->io_base + _REG(ENCI_SYNC_ADJ));\r\nmeson_vclk_setup(priv, MESON_VCLK_TARGET_CVBS, MESON_VCLK_CVBS);\r\npriv->venc.current_mode = mode->mode_tag;\r\n}\r\nunsigned int meson_venci_get_field(struct meson_drm *priv)\r\n{\r\nreturn readl_relaxed(priv->io_base + _REG(ENCI_INFO_READ)) & BIT(29);\r\n}\r\nvoid meson_venc_enable_vsync(struct meson_drm *priv)\r\n{\r\nwritel_relaxed(2, priv->io_base + _REG(VENC_INTCTRL));\r\n}\r\nvoid meson_venc_disable_vsync(struct meson_drm *priv)\r\n{\r\nwritel_relaxed(0, priv->io_base + _REG(VENC_INTCTRL));\r\n}\r\nvoid meson_venc_init(struct meson_drm *priv)\r\n{\r\nregmap_write(priv->hhi, HHI_VDAC_CNTL0, 0);\r\nregmap_write(priv->hhi, HHI_VDAC_CNTL1, 8);\r\nwritel_relaxed(0xff, priv->io_base + _REG(VENC_VDAC_SETTING));\r\nregmap_write(priv->hhi, HHI_HDMI_PHY_CNTL0, 0);\r\nwritel_bits_relaxed(0x3, 0,\r\npriv->io_base + _REG(VPU_HDMI_SETTING));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_EN));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCP_VIDEO_EN));\r\nwritel_relaxed(0, priv->io_base + _REG(ENCL_VIDEO_EN));\r\nmeson_venc_disable_vsync(priv);\r\npriv->venc.current_mode = MESON_VENC_MODE_NONE;\r\n}
