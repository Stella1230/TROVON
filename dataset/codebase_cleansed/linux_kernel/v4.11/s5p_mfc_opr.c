void s5p_mfc_init_hw_ops(struct s5p_mfc_dev *dev)\r\n{\r\nif (IS_MFCV6_PLUS(dev)) {\r\ns5p_mfc_ops = s5p_mfc_init_hw_ops_v6();\r\ndev->warn_start = S5P_FIMV_ERR_WARNINGS_START_V6;\r\n} else {\r\ns5p_mfc_ops = s5p_mfc_init_hw_ops_v5();\r\ndev->warn_start = S5P_FIMV_ERR_WARNINGS_START;\r\n}\r\ndev->mfc_ops = s5p_mfc_ops;\r\n}\r\nvoid s5p_mfc_init_regs(struct s5p_mfc_dev *dev)\r\n{\r\nif (IS_MFCV6_PLUS(dev))\r\ndev->mfc_regs = s5p_mfc_init_regs_v6_plus(dev);\r\n}\r\nint s5p_mfc_alloc_priv_buf(struct device *dev, dma_addr_t base,\r\nstruct s5p_mfc_priv_buf *b)\r\n{\r\nmfc_debug(3, "Allocating priv: %zu\n", b->size);\r\nb->virt = dma_alloc_coherent(dev, b->size, &b->dma, GFP_KERNEL);\r\nif (!b->virt) {\r\nmfc_err("Allocating private buffer of size %zu failed\n",\r\nb->size);\r\nreturn -ENOMEM;\r\n}\r\nif (b->dma < base) {\r\nmfc_err("Invalid memory configuration - buffer (%pad) is below base memory address(%pad)\n",\r\n&b->dma, &base);\r\ndma_free_coherent(dev, b->size, b->virt, b->dma);\r\nreturn -ENOMEM;\r\n}\r\nmfc_debug(3, "Allocated addr %p %pad\n", b->virt, &b->dma);\r\nreturn 0;\r\n}\r\nvoid s5p_mfc_release_priv_buf(struct device *dev,\r\nstruct s5p_mfc_priv_buf *b)\r\n{\r\nif (b->virt) {\r\ndma_free_coherent(dev, b->size, b->virt, b->dma);\r\nb->virt = NULL;\r\nb->dma = 0;\r\nb->size = 0;\r\n}\r\n}
