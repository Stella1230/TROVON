static void print_wrong_arg_exit(void)\r\n{\r\nprintf(_("invalid or unknown argument\n"));\r\nexit(EXIT_FAILURE);\r\n}\r\nint cmd_set(int argc, char **argv)\r\n{\r\nextern char *optarg;\r\nextern int optind, opterr, optopt;\r\nunsigned int cpu;\r\nunion {\r\nstruct {\r\nint perf_bias:1;\r\n};\r\nint params;\r\n} params;\r\nint perf_bias = 0;\r\nint ret = 0;\r\nsetlocale(LC_ALL, "");\r\ntextdomain(PACKAGE);\r\nparams.params = 0;\r\nwhile ((ret = getopt_long(argc, argv, "b:",\r\nset_opts, NULL)) != -1) {\r\nswitch (ret) {\r\ncase 'b':\r\nif (params.perf_bias)\r\nprint_wrong_arg_exit();\r\nperf_bias = atoi(optarg);\r\nif (perf_bias < 0 || perf_bias > 15) {\r\nprintf(_("--perf-bias param out "\r\n"of range [0-%d]\n"), 15);\r\nprint_wrong_arg_exit();\r\n}\r\nparams.perf_bias = 1;\r\nbreak;\r\ndefault:\r\nprint_wrong_arg_exit();\r\n}\r\n};\r\nif (!params.params)\r\nprint_wrong_arg_exit();\r\nif (bitmask_isallclear(cpus_chosen))\r\nbitmask_setall(cpus_chosen);\r\nfor (cpu = bitmask_first(cpus_chosen);\r\ncpu <= bitmask_last(cpus_chosen); cpu++) {\r\nif (!bitmask_isbitset(cpus_chosen, cpu))\r\ncontinue;\r\nif (sysfs_is_cpu_online(cpu) != 1){\r\nfprintf(stderr, _("Cannot set values on CPU %d:"), cpu);\r\nfprintf(stderr, _(" *is offline\n"));\r\ncontinue;\r\n}\r\nif (params.perf_bias) {\r\nret = msr_intel_set_perf_bias(cpu, perf_bias);\r\nif (ret) {\r\nfprintf(stderr, _("Error setting perf-bias "\r\n"value on CPU %d\n"), cpu);\r\nbreak;\r\n}\r\n}\r\n}\r\nreturn ret;\r\n}
