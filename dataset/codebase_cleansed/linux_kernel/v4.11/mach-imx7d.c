static int ar8031_phy_fixup(struct phy_device *dev)\r\n{\r\nu16 val;\r\nphy_write(dev, 0x1d, 0x1f);\r\nphy_write(dev, 0x1e, 0x8);\r\nphy_write(dev, 0xd, 0x3);\r\nphy_write(dev, 0xe, 0x805d);\r\nphy_write(dev, 0xd, 0x4003);\r\nval = phy_read(dev, 0xe);\r\nval &= ~(0x1 << 8);\r\nphy_write(dev, 0xe, val);\r\nphy_write(dev, 0x1d, 0x5);\r\nval = phy_read(dev, 0x1e);\r\nval |= 0x0100;\r\nphy_write(dev, 0x1e, val);\r\nreturn 0;\r\n}\r\nstatic int bcm54220_phy_fixup(struct phy_device *dev)\r\n{\r\nphy_write(dev, 0x1e, 0x21);\r\nphy_write(dev, 0x1f, 0x7ea8);\r\nphy_write(dev, 0x1e, 0x2f);\r\nphy_write(dev, 0x1f, 0x71b7);\r\nreturn 0;\r\n}\r\nstatic void __init imx7d_enet_phy_init(void)\r\n{\r\nif (IS_BUILTIN(CONFIG_PHYLIB)) {\r\nphy_register_fixup_for_uid(PHY_ID_AR8031, 0xffffffff,\r\nar8031_phy_fixup);\r\nphy_register_fixup_for_uid(PHY_ID_BCM54220, 0xffffffff,\r\nbcm54220_phy_fixup);\r\n}\r\n}\r\nstatic void __init imx7d_enet_clk_sel(void)\r\n{\r\nstruct regmap *gpr;\r\ngpr = syscon_regmap_lookup_by_compatible("fsl,imx7d-iomuxc-gpr");\r\nif (!IS_ERR(gpr)) {\r\nregmap_update_bits(gpr, IOMUXC_GPR1, IMX7D_GPR1_ENET_TX_CLK_SEL_MASK, 0);\r\nregmap_update_bits(gpr, IOMUXC_GPR1, IMX7D_GPR1_ENET_CLK_DIR_MASK, 0);\r\n} else {\r\npr_err("failed to find fsl,imx7d-iomux-gpr regmap\n");\r\n}\r\n}\r\nstatic inline void imx7d_enet_init(void)\r\n{\r\nimx7d_enet_phy_init();\r\nimx7d_enet_clk_sel();\r\n}\r\nstatic void __init imx7d_init_machine(void)\r\n{\r\nstruct device *parent;\r\nparent = imx_soc_device_init();\r\nif (parent == NULL)\r\npr_warn("failed to initialize soc device\n");\r\nimx_anatop_init();\r\nimx7d_enet_init();\r\n}\r\nstatic void __init imx7d_init_irq(void)\r\n{\r\nimx_init_revision_from_anatop();\r\nimx_src_init();\r\nirqchip_init();\r\n}
