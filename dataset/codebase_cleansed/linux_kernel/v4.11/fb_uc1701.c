static int init_display(struct fbtft_par *par)\r\n{\r\npar->fbtftops.reset(par);\r\nwrite_reg(par, LCD_RESET_CMD);\r\nmdelay(10);\r\nwrite_reg(par, LCD_START_LINE);\r\nwrite_reg(par, LCD_BOTTOMVIEW | 1);\r\nwrite_reg(par, LCD_SCAN_DIR | 0x00);\r\nwrite_reg(par, LCD_ALL_PIXEL | 0);\r\nwrite_reg(par, LCD_DISPLAY_INVERT | 0);\r\nwrite_reg(par, LCD_BIAS | 0);\r\nwrite_reg(par, LCD_POWER_CONTROL | 0x07);\r\nwrite_reg(par, LCD_VOLTAGE | 0x07);\r\nwrite_reg(par, LCD_VOLUME_MODE);\r\nwrite_reg(par, 0x09);\r\nwrite_reg(par, LCD_NO_OP);\r\nwrite_reg(par, LCD_ADV_PROG_CTRL);\r\nwrite_reg(par, LCD_ADV_PROG_CTRL2 | LCD_TEMPCOMP_HIGH);\r\nwrite_reg(par, LCD_DISPLAY_ENABLE | 1);\r\nreturn 0;\r\n}\r\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\r\n{\r\nwrite_reg(par, LCD_PAGE_ADDRESS);\r\nwrite_reg(par, 0x00);\r\nwrite_reg(par, LCD_COL_ADDRESS);\r\n}\r\nstatic int write_vmem(struct fbtft_par *par, size_t offset, size_t len)\r\n{\r\nu16 *vmem16 = (u16 *)par->info->screen_buffer;\r\nu8 *buf = par->txbuf.buf;\r\nint x, y, i;\r\nint ret = 0;\r\nfor (y = 0; y < PAGES; y++) {\r\nbuf = par->txbuf.buf;\r\nfor (x = 0; x < WIDTH; x++) {\r\n*buf = 0x00;\r\nfor (i = 0; i < 8; i++)\r\n*buf |= (vmem16[((y * 8 * WIDTH) +\r\n(i * WIDTH)) + x] ?\r\n1 : 0) << i;\r\nbuf++;\r\n}\r\nwrite_reg(par, LCD_PAGE_ADDRESS | (u8)y);\r\nwrite_reg(par, 0x00);\r\nwrite_reg(par, LCD_COL_ADDRESS);\r\ngpio_set_value(par->gpio.dc, 1);\r\nret = par->fbtftops.write(par, par->txbuf.buf, WIDTH);\r\ngpio_set_value(par->gpio.dc, 0);\r\n}\r\nif (ret < 0)\r\ndev_err(par->info->device, "write failed and returned: %d\n",\r\nret);\r\nreturn ret;\r\n}
