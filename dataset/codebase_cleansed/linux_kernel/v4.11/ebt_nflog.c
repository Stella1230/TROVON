static unsigned int\r\nebt_nflog_tg(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nconst struct ebt_nflog_info *info = par->targinfo;\r\nstruct net *net = xt_net(par);\r\nstruct nf_loginfo li;\r\nli.type = NF_LOG_TYPE_ULOG;\r\nli.u.ulog.copy_len = info->len;\r\nli.u.ulog.group = info->group;\r\nli.u.ulog.qthreshold = info->threshold;\r\nnf_log_packet(net, PF_BRIDGE, xt_hooknum(par), skb, xt_in(par),\r\nxt_out(par), &li, "%s", info->prefix);\r\nreturn EBT_CONTINUE;\r\n}\r\nstatic int ebt_nflog_tg_check(const struct xt_tgchk_param *par)\r\n{\r\nstruct ebt_nflog_info *info = par->targinfo;\r\nif (info->flags & ~EBT_NFLOG_MASK)\r\nreturn -EINVAL;\r\ninfo->prefix[EBT_NFLOG_PREFIX_SIZE - 1] = '\0';\r\nreturn 0;\r\n}\r\nstatic int __init ebt_nflog_init(void)\r\n{\r\nreturn xt_register_target(&ebt_nflog_tg_reg);\r\n}\r\nstatic void __exit ebt_nflog_fini(void)\r\n{\r\nxt_unregister_target(&ebt_nflog_tg_reg);\r\n}
