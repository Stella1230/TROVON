static int drbd_nla_check_mandatory(int maxtype, struct nlattr *nla)\r\n{\r\nstruct nlattr *head = nla_data(nla);\r\nint len = nla_len(nla);\r\nint rem;\r\nnla_for_each_attr(nla, head, len, rem) {\r\nif (nla->nla_type & DRBD_GENLA_F_MANDATORY) {\r\nnla->nla_type &= ~DRBD_GENLA_F_MANDATORY;\r\nif (nla_type(nla) > maxtype)\r\nreturn -EOPNOTSUPP;\r\n}\r\n}\r\nreturn 0;\r\n}\r\nint drbd_nla_parse_nested(struct nlattr *tb[], int maxtype, struct nlattr *nla,\r\nconst struct nla_policy *policy)\r\n{\r\nint err;\r\nerr = drbd_nla_check_mandatory(maxtype, nla);\r\nif (!err)\r\nerr = nla_parse_nested(tb, maxtype, nla, policy);\r\nreturn err;\r\n}\r\nstruct nlattr *drbd_nla_find_nested(int maxtype, struct nlattr *nla, int attrtype)\r\n{\r\nint err;\r\nerr = drbd_nla_check_mandatory(maxtype, nla);\r\nif (err)\r\nreturn ERR_PTR(err);\r\nreturn nla_find_nested(nla, attrtype);\r\n}
