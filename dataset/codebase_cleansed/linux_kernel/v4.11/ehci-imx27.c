int mx27_initialize_usb_hw(int port, unsigned int flags)\r\n{\r\nunsigned int v;\r\nv = readl(MX27_IO_ADDRESS(MX27_USB_BASE_ADDR + USBCTRL_OTGBASE_OFFSET));\r\nswitch (port) {\r\ncase 0:\r\nv &= ~(MX27_OTG_SIC_MASK | MX27_OTG_PM_BIT);\r\nv |= (flags & MXC_EHCI_INTERFACE_MASK) << MX27_OTG_SIC_SHIFT;\r\nif (!(flags & MXC_EHCI_POWER_PINS_ENABLED))\r\nv |= MX27_OTG_PM_BIT;\r\nbreak;\r\ncase 1:\r\nv &= ~(MX27_H1_SIC_MASK | MX27_H1_PM_BIT | MX27_H1_DT_BIT);\r\nv |= (flags & MXC_EHCI_INTERFACE_MASK) << MX27_H1_SIC_SHIFT;\r\nif (!(flags & MXC_EHCI_POWER_PINS_ENABLED))\r\nv |= MX27_H1_PM_BIT;\r\nif (!(flags & MXC_EHCI_TTL_ENABLED))\r\nv |= MX27_H1_DT_BIT;\r\nbreak;\r\ncase 2:\r\nv &= ~(MX27_H2_SIC_MASK | MX27_H2_PM_BIT | MX27_H2_DT_BIT);\r\nv |= (flags & MXC_EHCI_INTERFACE_MASK) << MX27_H2_SIC_SHIFT;\r\nif (!(flags & MXC_EHCI_POWER_PINS_ENABLED))\r\nv |= MX27_H2_PM_BIT;\r\nif (!(flags & MXC_EHCI_TTL_ENABLED))\r\nv |= MX27_H2_DT_BIT;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nwritel(v, MX27_IO_ADDRESS(MX27_USB_BASE_ADDR + USBCTRL_OTGBASE_OFFSET));\r\nreturn 0;\r\n}
