int proc_get_drv_version(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "%s\n", DRIVERVERSION);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_write_reg(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\n*eof = 1;\r\nreturn 0;\r\n}\r\nint proc_set_write_reg(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nchar tmp[32];\r\nu32 addr, val, len;\r\nif (count < 3) {\r\nDBG_88E("argument size is less than 3\n");\r\nreturn -EFAULT;\r\n}\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%x %x %x", &addr, &val, &len);\r\nif (num != 3) {\r\nDBG_88E("invalid write_reg parameter!\n");\r\nreturn count;\r\n}\r\nswitch (len) {\r\ncase 1:\r\nusb_write8(padapter, addr, (u8)val);\r\nbreak;\r\ncase 2:\r\nusb_write16(padapter, addr, (u16)val);\r\nbreak;\r\ncase 4:\r\nusb_write32(padapter, addr, val);\r\nbreak;\r\ndefault:\r\nDBG_88E("error write length =%d", len);\r\nbreak;\r\n}\r\n}\r\nreturn count;\r\n}\r\nint proc_get_read_reg(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nif (proc_get_read_addr == 0xeeeeeeee) {\r\n*eof = 1;\r\nreturn len;\r\n}\r\nswitch (proc_get_read_len) {\r\ncase 1:\r\nlen += snprintf(page + len, count - len, "usb_read8(0x%x)=0x%x\n", proc_get_read_addr, usb_read8(padapter, proc_get_read_addr));\r\nbreak;\r\ncase 2:\r\nlen += snprintf(page + len, count - len, "usb_read16(0x%x)=0x%x\n", proc_get_read_addr, usb_read16(padapter, proc_get_read_addr));\r\nbreak;\r\ncase 4:\r\nlen += snprintf(page + len, count - len, "usb_read32(0x%x)=0x%x\n", proc_get_read_addr, usb_read32(padapter, proc_get_read_addr));\r\nbreak;\r\ndefault:\r\nlen += snprintf(page + len, count - len, "error read length=%d\n", proc_get_read_len);\r\nbreak;\r\n}\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_set_read_reg(struct file *file, const char __user *buffer,\r\nunsigned long count, void *data)\r\n{\r\nchar tmp[16];\r\nu32 addr, len;\r\nif (count < 2) {\r\nDBG_88E("argument size is less than 2\n");\r\nreturn -EFAULT;\r\n}\r\nif (buffer && !copy_from_user(tmp, buffer, sizeof(tmp))) {\r\nint num = sscanf(tmp, "%x %x", &addr, &len);\r\nif (num != 2) {\r\nDBG_88E("invalid read_reg parameter!\n");\r\nreturn count;\r\n}\r\nproc_get_read_addr = addr;\r\nproc_get_read_len = len;\r\n}\r\nreturn count;\r\n}\r\nint proc_get_adapter_state(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nint len = 0;\r\nlen += snprintf(page + len, count - len, "bSurpriseRemoved=%d, bDriverStopped=%d\n",\r\npadapter->bSurpriseRemoved, padapter->bDriverStopped);\r\n*eof = 1;\r\nreturn len;\r\n}\r\nint proc_get_best_channel(char *page, char **start,\r\noff_t offset, int count,\r\nint *eof, void *data)\r\n{\r\nstruct net_device *dev = data;\r\nstruct adapter *padapter = (struct adapter *)rtw_netdev_priv(dev);\r\nstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\r\nint len = 0;\r\nu32 i, best_channel_24G = 1, best_channel_5G = 36, index_24G = 0, index_5G = 0;\r\nfor (i = 0; pmlmeext->channel_set[i].ChannelNum != 0; i++) {\r\nif (pmlmeext->channel_set[i].ChannelNum == 1)\r\nindex_24G = i;\r\nif (pmlmeext->channel_set[i].ChannelNum == 36)\r\nindex_5G = i;\r\n}\r\nfor (i = 0; pmlmeext->channel_set[i].ChannelNum != 0; i++) {\r\nif (pmlmeext->channel_set[i].ChannelNum == 6) {\r\nif (pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_24G].rx_count) {\r\nindex_24G = i;\r\nbest_channel_24G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nif (pmlmeext->channel_set[i].ChannelNum >= 36 &&\r\npmlmeext->channel_set[i].ChannelNum < 140) {\r\nif (((pmlmeext->channel_set[i].ChannelNum - 36) % 8 == 0) &&\r\n(pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_5G].rx_count)) {\r\nindex_5G = i;\r\nbest_channel_5G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nif (pmlmeext->channel_set[i].ChannelNum >= 149 &&\r\npmlmeext->channel_set[i].ChannelNum < 165) {\r\nif (((pmlmeext->channel_set[i].ChannelNum - 149) % 8 == 0) &&\r\n(pmlmeext->channel_set[i].rx_count < pmlmeext->channel_set[index_5G].rx_count)) {\r\nindex_5G = i;\r\nbest_channel_5G = pmlmeext->channel_set[i].ChannelNum;\r\n}\r\n}\r\nlen += snprintf(page + len, count - len, "The rx cnt of channel %3d = %d\n",\r\npmlmeext->channel_set[i].ChannelNum, pmlmeext->channel_set[i].rx_count);\r\n}\r\nlen += snprintf(page + len, count - len, "best_channel_5G = %d\n", best_channel_5G);\r\nlen += snprintf(page + len, count - len, "best_channel_24G = %d\n", best_channel_24G);\r\n*eof = 1;\r\nreturn len;\r\n}
