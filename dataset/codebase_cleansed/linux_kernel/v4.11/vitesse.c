static int vsc824x_add_skew(struct phy_device *phydev)\r\n{\r\nint err;\r\nint extcon;\r\nextcon = phy_read(phydev, MII_VSC8244_EXT_CON1);\r\nif (extcon < 0)\r\nreturn extcon;\r\nextcon &= ~(MII_VSC8244_EXTCON1_TX_SKEW_MASK |\r\nMII_VSC8244_EXTCON1_RX_SKEW_MASK);\r\nextcon |= (MII_VSC8244_EXTCON1_TX_SKEW |\r\nMII_VSC8244_EXTCON1_RX_SKEW);\r\nerr = phy_write(phydev, MII_VSC8244_EXT_CON1, extcon);\r\nreturn err;\r\n}\r\nstatic int vsc824x_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_VSC8244_AUX_CONSTAT,\r\nMII_VSC8244_AUXCONSTAT_INIT);\r\nif (err < 0)\r\nreturn err;\r\nif (phydev->interface == PHY_INTERFACE_MODE_RGMII_ID)\r\nerr = vsc824x_add_skew(phydev);\r\nreturn err;\r\n}\r\nstatic int vsc8601_add_skew(struct phy_device *phydev)\r\n{\r\nint ret;\r\nret = phy_read(phydev, MII_VSC8601_EPHY_CTL);\r\nif (ret < 0)\r\nreturn ret;\r\nret |= MII_VSC8601_EPHY_CTL_RGMII_SKEW;\r\nreturn phy_write(phydev, MII_VSC8601_EPHY_CTL, ret);\r\n}\r\nstatic int vsc8601_config_init(struct phy_device *phydev)\r\n{\r\nint ret = 0;\r\nif (phydev->interface == PHY_INTERFACE_MODE_RGMII_ID)\r\nret = vsc8601_add_skew(phydev);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn genphy_config_init(phydev);\r\n}\r\nstatic int vsc824x_ack_interrupt(struct phy_device *phydev)\r\n{\r\nint err = 0;\r\nif (phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_read(phydev, MII_VSC8244_ISTAT);\r\nreturn (err < 0) ? err : 0;\r\n}\r\nstatic int vsc82xx_config_intr(struct phy_device *phydev)\r\n{\r\nint err;\r\nif (phydev->interrupts == PHY_INTERRUPT_ENABLED)\r\nerr = phy_write(phydev, MII_VSC8244_IMASK,\r\n(phydev->drv->phy_id == PHY_ID_VSC8234 ||\r\nphydev->drv->phy_id == PHY_ID_VSC8244 ||\r\nphydev->drv->phy_id == PHY_ID_VSC8514 ||\r\nphydev->drv->phy_id == PHY_ID_VSC8572 ||\r\nphydev->drv->phy_id == PHY_ID_VSC8574 ||\r\nphydev->drv->phy_id == PHY_ID_VSC8601) ?\r\nMII_VSC8244_IMASK_MASK :\r\nMII_VSC8221_IMASK_MASK);\r\nelse {\r\nerr = phy_read(phydev, MII_VSC8244_ISTAT);\r\nif (err < 0)\r\nreturn err;\r\nerr = phy_write(phydev, MII_VSC8244_IMASK, 0);\r\n}\r\nreturn err;\r\n}\r\nstatic int vsc8221_config_init(struct phy_device *phydev)\r\n{\r\nint err;\r\nerr = phy_write(phydev, MII_VSC8244_AUX_CONSTAT,\r\nMII_VSC8221_AUXCONSTAT_INIT);\r\nreturn err;\r\n}\r\nstatic int vsc82x4_config_autocross_enable(struct phy_device *phydev)\r\n{\r\nint ret;\r\nif (phydev->autoneg == AUTONEG_ENABLE || phydev->speed > SPEED_100)\r\nreturn 0;\r\nret = phy_write(phydev, MII_VSC82X4_EXT_PAGE_ACCESS, 0x52b5);\r\nif (ret >= 0)\r\nret = phy_write(phydev, MII_VSC82X4_EXT_PAGE_18E, 0x0012);\r\nif (ret >= 0)\r\nret = phy_write(phydev, MII_VSC82X4_EXT_PAGE_17E, 0x2803);\r\nif (ret >= 0)\r\nret = phy_write(phydev, MII_VSC82X4_EXT_PAGE_16E, 0x87fa);\r\nif (ret >= 0)\r\nret = phy_write(phydev, MII_VSC82X4_EXT_PAGE_ACCESS, 0x0000);\r\nelse\r\nphy_write(phydev, MII_VSC82X4_EXT_PAGE_ACCESS, 0x0000);\r\nreturn ret;\r\n}\r\nstatic int vsc82x4_config_aneg(struct phy_device *phydev)\r\n{\r\nint ret;\r\nif (phydev->autoneg != AUTONEG_ENABLE && phydev->speed <= SPEED_100) {\r\nret = genphy_setup_forced(phydev);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn vsc82x4_config_autocross_enable(phydev);\r\n}\r\nreturn genphy_config_aneg(phydev);\r\n}
