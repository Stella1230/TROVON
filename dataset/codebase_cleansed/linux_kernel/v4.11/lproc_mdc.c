static ssize_t active_show(struct kobject *kobj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nreturn sprintf(buf, "%u\n", !dev->u.cli.cl_import->imp_deactive);\r\n}\r\nstatic ssize_t active_store(struct kobject *kobj, struct attribute *attr,\r\nconst char *buffer, size_t count)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nunsigned long val;\r\nint rc;\r\nrc = kstrtoul(buffer, 10, &val);\r\nif (rc)\r\nreturn rc;\r\nif (val < 0 || val > 1)\r\nreturn -ERANGE;\r\nif (dev->u.cli.cl_import->imp_deactive == val) {\r\nrc = ptlrpc_set_import_active(dev->u.cli.cl_import, val);\r\nif (rc)\r\ncount = rc;\r\n} else {\r\nCDEBUG(D_CONFIG, "activate %lu: ignoring repeat request\n", val);\r\n}\r\nreturn count;\r\n}\r\nstatic ssize_t max_rpcs_in_flight_show(struct kobject *kobj,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nint len;\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\n__u32 max;\r\nmax = obd_get_max_rpcs_in_flight(&dev->u.cli);\r\nlen = sprintf(buf, "%u\n", max);\r\nreturn len;\r\n}\r\nstatic ssize_t max_rpcs_in_flight_store(struct kobject *kobj,\r\nstruct attribute *attr,\r\nconst char *buffer,\r\nsize_t count)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nint rc;\r\nunsigned long val;\r\nrc = kstrtoul(buffer, 10, &val);\r\nif (rc)\r\nreturn rc;\r\nrc = obd_set_max_rpcs_in_flight(&dev->u.cli, val);\r\nif (rc)\r\ncount = rc;\r\nreturn count;\r\n}\r\nstatic ssize_t max_mod_rpcs_in_flight_show(struct kobject *kobj,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nu16 max;\r\nint len;\r\nmax = dev->u.cli.cl_max_mod_rpcs_in_flight;\r\nlen = sprintf(buf, "%hu\n", max);\r\nreturn len;\r\n}\r\nstatic ssize_t max_mod_rpcs_in_flight_store(struct kobject *kobj,\r\nstruct attribute *attr,\r\nconst char *buffer,\r\nsize_t count)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nu16 val;\r\nint rc;\r\nrc = kstrtou16(buffer, 10, &val);\r\nif (rc)\r\nreturn rc;\r\nrc = obd_set_max_mod_rpcs_in_flight(&dev->u.cli, val);\r\nif (rc)\r\ncount = rc;\r\nreturn count;\r\n}\r\nstatic int mdc_rpc_stats_seq_show(struct seq_file *seq, void *v)\r\n{\r\nstruct obd_device *dev = seq->private;\r\nreturn obd_mod_rpc_stats_seq_show(&dev->u.cli, seq);\r\n}\r\nstatic ssize_t mdc_rpc_stats_seq_write(struct file *file,\r\nconst char __user *buf,\r\nsize_t len, loff_t *off)\r\n{\r\nstruct seq_file *seq = file->private_data;\r\nstruct obd_device *dev = seq->private;\r\nstruct client_obd *cli = &dev->u.cli;\r\nlprocfs_oh_clear(&cli->cl_mod_rpcs_hist);\r\nreturn len;\r\n}\r\nstatic ssize_t max_pages_per_rpc_show(struct kobject *kobj,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct obd_device *dev = container_of(kobj, struct obd_device,\r\nobd_kobj);\r\nstruct client_obd *cli = &dev->u.cli;\r\nreturn sprintf(buf, "%d\n", cli->cl_max_pages_per_rpc);\r\n}\r\nvoid lprocfs_mdc_init_vars(struct lprocfs_static_vars *lvars)\r\n{\r\nlvars->sysfs_vars = &mdc_attr_group;\r\nlvars->obd_vars = lprocfs_mdc_obd_vars;\r\n}
