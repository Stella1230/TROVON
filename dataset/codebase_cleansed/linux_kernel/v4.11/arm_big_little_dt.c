static struct device_node *get_cpu_node_with_valid_op(int cpu)\r\n{\r\nstruct device_node *np = of_cpu_device_node_get(cpu);\r\nif (!of_get_property(np, "operating-points", NULL)) {\r\nof_node_put(np);\r\nnp = NULL;\r\n}\r\nreturn np;\r\n}\r\nstatic int dt_get_transition_latency(struct device *cpu_dev)\r\n{\r\nstruct device_node *np;\r\nu32 transition_latency = CPUFREQ_ETERNAL;\r\nnp = of_node_get(cpu_dev->of_node);\r\nif (!np) {\r\npr_info("Failed to find cpu node. Use CPUFREQ_ETERNAL transition latency\n");\r\nreturn CPUFREQ_ETERNAL;\r\n}\r\nof_property_read_u32(np, "clock-latency", &transition_latency);\r\nof_node_put(np);\r\npr_debug("%s: clock-latency: %d\n", __func__, transition_latency);\r\nreturn transition_latency;\r\n}\r\nstatic int generic_bL_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *np;\r\nnp = get_cpu_node_with_valid_op(0);\r\nif (!np)\r\nreturn -ENODEV;\r\nof_node_put(np);\r\nreturn bL_cpufreq_register(&dt_bL_ops);\r\n}\r\nstatic int generic_bL_remove(struct platform_device *pdev)\r\n{\r\nbL_cpufreq_unregister(&dt_bL_ops);\r\nreturn 0;\r\n}
