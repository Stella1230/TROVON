static int do_msm_restart(struct notifier_block *nb, unsigned long action,\r\nvoid *data)\r\n{\r\nwritel(0, msm_ps_hold);\r\nmdelay(10000);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic void do_msm_poweroff(void)\r\n{\r\ndo_msm_restart(&restart_nb, 0, NULL);\r\n}\r\nstatic int msm_restart_probe(struct platform_device *pdev)\r\n{\r\nstruct device *dev = &pdev->dev;\r\nstruct resource *mem;\r\nmem = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nmsm_ps_hold = devm_ioremap_resource(dev, mem);\r\nif (IS_ERR(msm_ps_hold))\r\nreturn PTR_ERR(msm_ps_hold);\r\nregister_restart_handler(&restart_nb);\r\npm_power_off = do_msm_poweroff;\r\nreturn 0;\r\n}\r\nstatic int __init msm_restart_init(void)\r\n{\r\nreturn platform_driver_register(&msm_restart_driver);\r\n}
