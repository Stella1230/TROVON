static struct tegra_bpmp *to_tegra_bpmp(struct reset_controller_dev *rstc)\r\n{\r\nreturn container_of(rstc, struct tegra_bpmp, rstc);\r\n}\r\nstatic int tegra_bpmp_reset_common(struct reset_controller_dev *rstc,\r\nenum mrq_reset_commands command,\r\nunsigned int id)\r\n{\r\nstruct tegra_bpmp *bpmp = to_tegra_bpmp(rstc);\r\nstruct mrq_reset_request request;\r\nstruct tegra_bpmp_message msg;\r\nmemset(&request, 0, sizeof(request));\r\nrequest.cmd = command;\r\nrequest.reset_id = id;\r\nmemset(&msg, 0, sizeof(msg));\r\nmsg.mrq = MRQ_RESET;\r\nmsg.tx.data = &request;\r\nmsg.tx.size = sizeof(request);\r\nreturn tegra_bpmp_transfer(bpmp, &msg);\r\n}\r\nstatic int tegra_bpmp_reset_module(struct reset_controller_dev *rstc,\r\nunsigned long id)\r\n{\r\nreturn tegra_bpmp_reset_common(rstc, CMD_RESET_MODULE, id);\r\n}\r\nstatic int tegra_bpmp_reset_assert(struct reset_controller_dev *rstc,\r\nunsigned long id)\r\n{\r\nreturn tegra_bpmp_reset_common(rstc, CMD_RESET_ASSERT, id);\r\n}\r\nstatic int tegra_bpmp_reset_deassert(struct reset_controller_dev *rstc,\r\nunsigned long id)\r\n{\r\nreturn tegra_bpmp_reset_common(rstc, CMD_RESET_DEASSERT, id);\r\n}\r\nint tegra_bpmp_init_resets(struct tegra_bpmp *bpmp)\r\n{\r\nbpmp->rstc.ops = &tegra_bpmp_reset_ops;\r\nbpmp->rstc.owner = THIS_MODULE;\r\nbpmp->rstc.of_node = bpmp->dev->of_node;\r\nbpmp->rstc.nr_resets = bpmp->soc->num_resets;\r\nreturn devm_reset_controller_register(bpmp->dev, &bpmp->rstc);\r\n}
