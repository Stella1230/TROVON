static int crct10dif_init(struct shash_desc *desc)\r\n{\r\nu16 *crc = shash_desc_ctx(desc);\r\n*crc = 0;\r\nreturn 0;\r\n}\r\nstatic int crct10dif_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int length)\r\n{\r\nu16 *crc = shash_desc_ctx(desc);\r\nunsigned int l;\r\nif (unlikely((u64)data % CRC_T10DIF_PMULL_CHUNK_SIZE)) {\r\nl = min_t(u32, length, CRC_T10DIF_PMULL_CHUNK_SIZE -\r\n((u64)data % CRC_T10DIF_PMULL_CHUNK_SIZE));\r\n*crc = crc_t10dif_generic(*crc, data, l);\r\nlength -= l;\r\ndata += l;\r\n}\r\nif (length > 0) {\r\nkernel_neon_begin_partial(14);\r\n*crc = crc_t10dif_pmull(*crc, data, length);\r\nkernel_neon_end();\r\n}\r\nreturn 0;\r\n}\r\nstatic int crct10dif_final(struct shash_desc *desc, u8 *out)\r\n{\r\nu16 *crc = shash_desc_ctx(desc);\r\n*(u16 *)out = *crc;\r\nreturn 0;\r\n}\r\nstatic int __init crc_t10dif_mod_init(void)\r\n{\r\nreturn crypto_register_shash(&crc_t10dif_alg);\r\n}\r\nstatic void __exit crc_t10dif_mod_exit(void)\r\n{\r\ncrypto_unregister_shash(&crc_t10dif_alg);\r\n}
