int\r\nxfs_bitmap_empty(uint *map, uint size)\r\n{\r\nuint i;\r\nfor (i = 0; i < size; i++) {\r\nif (map[i] != 0)\r\nreturn 0;\r\n}\r\nreturn 1;\r\n}\r\nint\r\nxfs_contig_bits(uint *map, uint size, uint start_bit)\r\n{\r\nuint * p = ((unsigned int *) map) + (start_bit >> BIT_TO_WORD_SHIFT);\r\nuint result = 0;\r\nuint tmp;\r\nsize <<= BIT_TO_WORD_SHIFT;\r\nASSERT(start_bit < size);\r\nsize -= start_bit & ~(NBWORD - 1);\r\nstart_bit &= (NBWORD - 1);\r\nif (start_bit) {\r\ntmp = *p++;\r\ntmp |= (~0U >> (NBWORD-start_bit));\r\nif (tmp != ~0U)\r\ngoto found;\r\nresult += NBWORD;\r\nsize -= NBWORD;\r\n}\r\nwhile (size) {\r\nif ((tmp = *p++) != ~0U)\r\ngoto found;\r\nresult += NBWORD;\r\nsize -= NBWORD;\r\n}\r\nreturn result - start_bit;\r\nfound:\r\nreturn result + ffz(tmp) - start_bit;\r\n}\r\nint xfs_next_bit(uint *map, uint size, uint start_bit)\r\n{\r\nuint * p = ((unsigned int *) map) + (start_bit >> BIT_TO_WORD_SHIFT);\r\nuint result = start_bit & ~(NBWORD - 1);\r\nuint tmp;\r\nsize <<= BIT_TO_WORD_SHIFT;\r\nif (start_bit >= size)\r\nreturn -1;\r\nsize -= result;\r\nstart_bit &= (NBWORD - 1);\r\nif (start_bit) {\r\ntmp = *p++;\r\ntmp &= (~0U << start_bit);\r\nif (tmp != 0U)\r\ngoto found;\r\nresult += NBWORD;\r\nsize -= NBWORD;\r\n}\r\nwhile (size) {\r\nif ((tmp = *p++) != 0U)\r\ngoto found;\r\nresult += NBWORD;\r\nsize -= NBWORD;\r\n}\r\nreturn -1;\r\nfound:\r\nreturn result + ffs(tmp) - 1;\r\n}
