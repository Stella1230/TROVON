static void intel_mid_power_off(void)\r\n{\r\nintel_mid_pwr_power_off();\r\nintel_scu_ipc_simple_command(IPCMSG_COLD_OFF, 1);\r\n}\r\nstatic void intel_mid_reboot(void)\r\n{\r\nintel_scu_ipc_simple_command(IPCMSG_COLD_BOOT, 0);\r\n}\r\nstatic unsigned long __init intel_mid_calibrate_tsc(void)\r\n{\r\nreturn 0;\r\n}\r\nstatic void __init intel_mid_setup_bp_timer(void)\r\n{\r\napbt_time_init();\r\nsetup_boot_APIC_clock();\r\n}\r\nstatic void __init intel_mid_time_init(void)\r\n{\r\nsfi_table_parse(SFI_SIG_MTMR, NULL, NULL, sfi_parse_mtmr);\r\nswitch (intel_mid_timer_options) {\r\ncase INTEL_MID_TIMER_APBT_ONLY:\r\nbreak;\r\ncase INTEL_MID_TIMER_LAPIC_APBT:\r\nx86_init.timers.setup_percpu_clockev = intel_mid_setup_bp_timer;\r\nx86_cpuinit.setup_percpu_clockev = setup_secondary_APIC_clock;\r\nreturn;\r\ndefault:\r\nif (!boot_cpu_has(X86_FEATURE_ARAT))\r\nbreak;\r\nx86_init.timers.setup_percpu_clockev = setup_boot_APIC_clock;\r\nx86_cpuinit.setup_percpu_clockev = setup_secondary_APIC_clock;\r\nreturn;\r\n}\r\nx86_init.timers.setup_percpu_clockev = apbt_time_init;\r\n}\r\nstatic void intel_mid_arch_setup(void)\r\n{\r\nif (boot_cpu_data.x86 != 6) {\r\npr_err("Unknown Intel MID CPU (%d:%d), default to Penwell\n",\r\nboot_cpu_data.x86, boot_cpu_data.x86_model);\r\n__intel_mid_cpu_chip = INTEL_MID_CPU_CHIP_PENWELL;\r\ngoto out;\r\n}\r\nswitch (boot_cpu_data.x86_model) {\r\ncase 0x35:\r\n__intel_mid_cpu_chip = INTEL_MID_CPU_CHIP_CLOVERVIEW;\r\nbreak;\r\ncase 0x3C:\r\ncase 0x4A:\r\n__intel_mid_cpu_chip = INTEL_MID_CPU_CHIP_TANGIER;\r\nbreak;\r\ncase 0x27:\r\ndefault:\r\n__intel_mid_cpu_chip = INTEL_MID_CPU_CHIP_PENWELL;\r\nbreak;\r\n}\r\nif (__intel_mid_cpu_chip < MAX_CPU_OPS(get_intel_mid_ops))\r\nintel_mid_ops = get_intel_mid_ops[__intel_mid_cpu_chip]();\r\nelse {\r\nintel_mid_ops = get_intel_mid_ops[INTEL_MID_CPU_CHIP_PENWELL]();\r\npr_info("ARCH: Unknown SoC, assuming Penwell!\n");\r\n}\r\nout:\r\nif (intel_mid_ops->arch_setup)\r\nintel_mid_ops->arch_setup();\r\nregulator_has_full_constraints();\r\n}\r\nstatic unsigned char intel_mid_get_nmi_reason(void)\r\n{\r\nreturn 0;\r\n}\r\nvoid __init x86_intel_mid_early_setup(void)\r\n{\r\nx86_init.resources.probe_roms = x86_init_noop;\r\nx86_init.resources.reserve_resources = x86_init_noop;\r\nx86_init.timers.timer_init = intel_mid_time_init;\r\nx86_init.timers.setup_percpu_clockev = x86_init_noop;\r\nx86_init.irqs.pre_vector_init = x86_init_noop;\r\nx86_init.oem.arch_setup = intel_mid_arch_setup;\r\nx86_cpuinit.setup_percpu_clockev = apbt_setup_secondary_clock;\r\nx86_platform.calibrate_tsc = intel_mid_calibrate_tsc;\r\nx86_init.timers.wallclock_init = intel_mid_rtc_init;\r\nx86_platform.get_nmi_reason = intel_mid_get_nmi_reason;\r\nx86_init.pci.init = intel_mid_pci_init;\r\nx86_init.pci.fixup_irqs = x86_init_noop;\r\nlegacy_pic = &null_legacy_pic;\r\npm_power_off = intel_mid_power_off;\r\nmachine_ops.emergency_restart = intel_mid_reboot;\r\nx86_init.mpparse.find_smp_config = x86_init_noop;\r\nx86_init.mpparse.get_smp_config = x86_init_uint_noop;\r\nset_bit(MP_BUS_ISA, mp_bus_not_pci);\r\n}\r\nstatic inline int __init setup_x86_intel_mid_timer(char *arg)\r\n{\r\nif (!arg)\r\nreturn -EINVAL;\r\nif (strcmp("apbt_only", arg) == 0)\r\nintel_mid_timer_options = INTEL_MID_TIMER_APBT_ONLY;\r\nelse if (strcmp("lapic_and_apbt", arg) == 0)\r\nintel_mid_timer_options = INTEL_MID_TIMER_LAPIC_APBT;\r\nelse {\r\npr_warn("X86 INTEL_MID timer option %s not recognised use x86_intel_mid_timer=apbt_only or lapic_and_apbt\n",\r\narg);\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}
