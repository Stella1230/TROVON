void meson_vpp_setup_mux(struct meson_drm *priv, unsigned int mux)\r\n{\r\nwritel(mux, priv->io_base + _REG(VPU_VIU_VENC_MUX_CTRL));\r\n}\r\nvoid meson_vpp_setup_interlace_vscaler_osd1(struct meson_drm *priv,\r\nstruct drm_rect *input)\r\n{\r\nwritel_relaxed(BIT(3) |\r\nBIT(2),\r\npriv->io_base + _REG(VPP_OSD_SC_CTRL0));\r\nwritel_relaxed(((drm_rect_width(input) - 1) << 16) |\r\n(drm_rect_height(input) - 1),\r\npriv->io_base + _REG(VPP_OSD_SCI_WH_M1));\r\nwritel_relaxed(((input->x1) << 16) | (input->x2),\r\npriv->io_base + _REG(VPP_OSD_SCO_H_START_END));\r\nwritel_relaxed(((input->y1 >> 1) << 16) | (input->y2 >> 1),\r\npriv->io_base + _REG(VPP_OSD_SCO_V_START_END));\r\nwritel_relaxed(BIT(16), priv->io_base + _REG(VPP_OSD_VSC_INI_PHASE));\r\nwritel_relaxed(BIT(25), priv->io_base + _REG(VPP_OSD_VSC_PHASE_STEP));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_HSC_CTRL0));\r\nwritel_relaxed((4 << 0) |\r\n(4 << 3) |\r\n(1 << 8) |\r\n(6 << 11) |\r\n(2 << 16) |\r\nBIT(23) |\r\nBIT(24),\r\npriv->io_base + _REG(VPP_OSD_VSC_CTRL0));\r\n}\r\nvoid meson_vpp_disable_interlace_vscaler_osd1(struct meson_drm *priv)\r\n{\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_SC_CTRL0));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_VSC_CTRL0));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_HSC_CTRL0));\r\n}\r\nstatic void meson_vpp_write_scaling_filter_coefs(struct meson_drm *priv,\r\nconst unsigned int *coefs,\r\nbool is_horizontal)\r\n{\r\nint i;\r\nwritel_relaxed(is_horizontal ? BIT(8) : 0,\r\npriv->io_base + _REG(VPP_OSD_SCALE_COEF_IDX));\r\nfor (i = 0; i < 33; i++)\r\nwritel_relaxed(coefs[i],\r\npriv->io_base + _REG(VPP_OSD_SCALE_COEF));\r\n}\r\nvoid meson_vpp_init(struct meson_drm *priv)\r\n{\r\nif (meson_vpu_is_compatible(priv, "amlogic,meson-gxl-vpu"))\r\nwritel_relaxed(0x108080, priv->io_base + _REG(VPP_DUMMY_DATA1));\r\nelse if (meson_vpu_is_compatible(priv, "amlogic,meson-gxm-vpu")) {\r\nwritel_bits_relaxed(0xff << 16, 0xff << 16,\r\npriv->io_base + _REG(VIU_MISC_CTRL1));\r\nwritel_relaxed(0x20000, priv->io_base + _REG(VPP_DOLBY_CTRL));\r\nwritel_relaxed(0x1020080,\r\npriv->io_base + _REG(VPP_DUMMY_DATA1));\r\n}\r\nwritel_relaxed(readl_relaxed(priv->io_base + _REG(VPP_OFIFO_SIZE)) |\r\n0x77f, priv->io_base + _REG(VPP_OFIFO_SIZE));\r\nwritel_relaxed(0x08080808, priv->io_base + _REG(VPP_HOLD_LINES));\r\nwritel_bits_relaxed(VPP_PREBLEND_ENABLE, 0,\r\npriv->io_base + _REG(VPP_MISC));\r\nwritel_bits_relaxed(VPP_POSTBLEND_ENABLE, 0,\r\npriv->io_base + _REG(VPP_MISC));\r\nwritel_bits_relaxed(VPP_OSD1_POSTBLEND | VPP_OSD2_POSTBLEND |\r\nVPP_VD1_POSTBLEND | VPP_VD2_POSTBLEND, 0,\r\npriv->io_base + _REG(VPP_MISC));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_SC_CTRL0));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_VSC_CTRL0));\r\nwritel_relaxed(0, priv->io_base + _REG(VPP_OSD_HSC_CTRL0));\r\nmeson_vpp_write_scaling_filter_coefs(priv,\r\nvpp_filter_coefs_4point_bspline, false);\r\nmeson_vpp_write_scaling_filter_coefs(priv,\r\nvpp_filter_coefs_4point_bspline, true);\r\n}
