__init void early_shadow_write(struct console *con, const char *s,\r\nunsigned int n)\r\n{\r\nunsigned int i;\r\nif ((shadow_console_buffer + n) <= (char *)(SHADOW_CONSOLE_END - 2)) {\r\nfor (i = 0; i <= n; i++)\r\nshadow_console_buffer[i] = s[i];\r\nshadow_console_buffer += n;\r\nshadow_console_buffer[0] = 0;\r\nshadow_console_buffer[1] = 0;\r\n} else\r\nshadow_console_buffer = (char *)SHADOW_CONSOLE_END;\r\n}\r\n__init int shadow_console_enabled(void)\r\n{\r\nreturn early_shadow_console.flags & CON_ENABLED;\r\n}\r\n__init void mark_shadow_error(void)\r\n{\r\nint *loc = (int *)SHADOW_CONSOLE_MAGIC_LOC;\r\nloc[0] = SHADOW_CONSOLE_MAGIC;\r\nloc[1] = SHADOW_CONSOLE_START;\r\n}\r\n__init void enable_shadow_console(void)\r\n{\r\nif (!shadow_console_enabled()) {\r\nregister_console(&early_shadow_console);\r\nmark_shadow_error();\r\n}\r\n}\r\nstatic __init int disable_shadow_console(void)\r\n{\r\nint *loc = (int *)SHADOW_CONSOLE_MAGIC_LOC;\r\nloc[0] = 0;\r\nreturn 0;\r\n}\r\n__init void early_shadow_reg(unsigned long reg, unsigned int n)\r\n{\r\nint i;\r\nchar ascii[11] = " 0x";\r\nn = n / 4;\r\nreg = reg << ((8 - n) * 4);\r\nn += 3;\r\nfor (i = 3; i <= n ; i++) {\r\nascii[i] = hex_asc_lo(reg >> 28);\r\nreg <<= 4;\r\n}\r\nearly_shadow_write(NULL, ascii, n);\r\n}
