static int dev_8255_attach(struct comedi_device *dev,\r\nstruct comedi_devconfig *it)\r\n{\r\nstruct comedi_subdevice *s;\r\nunsigned long iobase;\r\nint ret;\r\nint i;\r\nfor (i = 0; i < COMEDI_NDEVCONFOPTS; i++) {\r\niobase = it->options[i];\r\nif (!iobase)\r\nbreak;\r\n}\r\nif (i == 0) {\r\ndev_warn(dev->class_dev, "no devices specified\n");\r\nreturn -EINVAL;\r\n}\r\nret = comedi_alloc_subdevices(dev, i);\r\nif (ret)\r\nreturn ret;\r\nfor (i = 0; i < dev->n_subdevices; i++) {\r\ns = &dev->subdevices[i];\r\niobase = it->options[i];\r\nret = __comedi_request_region(dev, iobase, I8255_SIZE);\r\nif (ret) {\r\ns->type = COMEDI_SUBD_UNUSED;\r\n} else {\r\nret = subdev_8255_init(dev, s, NULL, iobase);\r\nif (ret) {\r\nrelease_region(iobase, I8255_SIZE);\r\ns->type = COMEDI_SUBD_UNUSED;\r\nreturn ret;\r\n}\r\n}\r\n}\r\nreturn 0;\r\n}\r\nstatic void dev_8255_detach(struct comedi_device *dev)\r\n{\r\nstruct comedi_subdevice *s;\r\nint i;\r\nfor (i = 0; i < dev->n_subdevices; i++) {\r\ns = &dev->subdevices[i];\r\nif (s->type != COMEDI_SUBD_UNUSED) {\r\nunsigned long regbase = subdev_8255_regbase(s);\r\nrelease_region(regbase, I8255_SIZE);\r\n}\r\n}\r\n}
