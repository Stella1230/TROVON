static int\r\ng84_cipher_oclass_bind(struct nvkm_object *object, struct nvkm_gpuobj *parent,\r\nint align, struct nvkm_gpuobj **pgpuobj)\r\n{\r\nint ret = nvkm_gpuobj_new(object->engine->subdev.device, 16,\r\nalign, false, parent, pgpuobj);\r\nif (ret == 0) {\r\nnvkm_kmap(*pgpuobj);\r\nnvkm_wo32(*pgpuobj, 0x00, object->oclass);\r\nnvkm_wo32(*pgpuobj, 0x04, 0x00000000);\r\nnvkm_wo32(*pgpuobj, 0x08, 0x00000000);\r\nnvkm_wo32(*pgpuobj, 0x0c, 0x00000000);\r\nnvkm_done(*pgpuobj);\r\n}\r\nreturn ret;\r\n}\r\nstatic int\r\ng84_cipher_cclass_bind(struct nvkm_object *object, struct nvkm_gpuobj *parent,\r\nint align, struct nvkm_gpuobj **pgpuobj)\r\n{\r\nreturn nvkm_gpuobj_new(object->engine->subdev.device, 256,\r\nalign, true, parent, pgpuobj);\r\n}\r\nstatic void\r\ng84_cipher_intr(struct nvkm_engine *cipher)\r\n{\r\nstruct nvkm_subdev *subdev = &cipher->subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nstruct nvkm_fifo *fifo = device->fifo;\r\nstruct nvkm_fifo_chan *chan;\r\nu32 stat = nvkm_rd32(device, 0x102130);\r\nu32 mthd = nvkm_rd32(device, 0x102190);\r\nu32 data = nvkm_rd32(device, 0x102194);\r\nu32 inst = nvkm_rd32(device, 0x102188) & 0x7fffffff;\r\nunsigned long flags;\r\nchar msg[128];\r\nchan = nvkm_fifo_chan_inst(fifo, (u64)inst << 12, &flags);\r\nif (stat) {\r\nnvkm_snprintbf(msg, sizeof(msg), g84_cipher_intr_mask, stat);\r\nnvkm_error(subdev, "%08x [%s] ch %d [%010llx %s] "\r\n"mthd %04x data %08x\n", stat, msg,\r\nchan ? chan->chid : -1, (u64)inst << 12,\r\nchan ? chan->object.client->name : "unknown",\r\nmthd, data);\r\n}\r\nnvkm_fifo_chan_put(fifo, flags, &chan);\r\nnvkm_wr32(device, 0x102130, stat);\r\nnvkm_wr32(device, 0x10200c, 0x10);\r\n}\r\nstatic int\r\ng84_cipher_init(struct nvkm_engine *cipher)\r\n{\r\nstruct nvkm_device *device = cipher->subdev.device;\r\nnvkm_wr32(device, 0x102130, 0xffffffff);\r\nnvkm_wr32(device, 0x102140, 0xffffffbf);\r\nnvkm_wr32(device, 0x10200c, 0x00000010);\r\nreturn 0;\r\n}\r\nint\r\ng84_cipher_new(struct nvkm_device *device, int index,\r\nstruct nvkm_engine **pengine)\r\n{\r\nreturn nvkm_engine_new_(&g84_cipher, device, index, true, pengine);\r\n}
