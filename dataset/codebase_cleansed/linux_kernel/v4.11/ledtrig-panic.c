static void led_trigger_set_panic(struct led_classdev *led_cdev)\r\n{\r\nstruct led_trigger *trig;\r\nlist_for_each_entry(trig, &trigger_list, next_trig) {\r\nif (strcmp("panic", trig->name))\r\ncontinue;\r\nif (led_cdev->trigger)\r\nlist_del(&led_cdev->trig_list);\r\nlist_add_tail(&led_cdev->trig_list, &trig->led_cdevs);\r\nled_cdev->blink_delay_on = 0;\r\nled_cdev->blink_delay_off = 0;\r\nled_cdev->trigger = trig;\r\nif (trig->activate)\r\ntrig->activate(led_cdev);\r\nbreak;\r\n}\r\n}\r\nstatic int led_trigger_panic_notifier(struct notifier_block *nb,\r\nunsigned long code, void *unused)\r\n{\r\nstruct led_classdev *led_cdev;\r\nlist_for_each_entry(led_cdev, &leds_list, node)\r\nif (led_cdev->flags & LED_PANIC_INDICATOR)\r\nled_trigger_set_panic(led_cdev);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic long led_panic_blink(int state)\r\n{\r\nled_trigger_event(trigger, state ? LED_FULL : LED_OFF);\r\nreturn 0;\r\n}\r\nstatic int __init ledtrig_panic_init(void)\r\n{\r\natomic_notifier_chain_register(&panic_notifier_list,\r\n&led_trigger_panic_nb);\r\nled_trigger_register_simple("panic", &trigger);\r\npanic_blink = led_panic_blink;\r\nreturn 0;\r\n}
