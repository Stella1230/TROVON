inline void\r\nvxfs_put_page(struct page *pp)\r\n{\r\nkunmap(pp);\r\nput_page(pp);\r\n}\r\nstruct page *\r\nvxfs_get_page(struct address_space *mapping, u_long n)\r\n{\r\nstruct page * pp;\r\npp = read_mapping_page(mapping, n, NULL);\r\nif (!IS_ERR(pp)) {\r\nkmap(pp);\r\nif (PageError(pp))\r\ngoto fail;\r\n}\r\nreturn (pp);\r\nfail:\r\nvxfs_put_page(pp);\r\nreturn ERR_PTR(-EIO);\r\n}\r\nstruct buffer_head *\r\nvxfs_bread(struct inode *ip, int block)\r\n{\r\nstruct buffer_head *bp;\r\ndaddr_t pblock;\r\npblock = vxfs_bmap1(ip, block);\r\nbp = sb_bread(ip->i_sb, pblock);\r\nreturn (bp);\r\n}\r\nstatic int\r\nvxfs_getblk(struct inode *ip, sector_t iblock,\r\nstruct buffer_head *bp, int create)\r\n{\r\ndaddr_t pblock;\r\npblock = vxfs_bmap1(ip, iblock);\r\nif (pblock != 0) {\r\nmap_bh(bp, ip->i_sb, pblock);\r\nreturn 0;\r\n}\r\nreturn -EIO;\r\n}\r\nstatic int\r\nvxfs_readpage(struct file *file, struct page *page)\r\n{\r\nreturn block_read_full_page(page, vxfs_getblk);\r\n}\r\nstatic sector_t\r\nvxfs_bmap(struct address_space *mapping, sector_t block)\r\n{\r\nreturn generic_block_bmap(mapping, block, vxfs_getblk);\r\n}
