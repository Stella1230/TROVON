static void __init m5249_qspi_init(void)\r\n{\r\n#if IS_ENABLED(CONFIG_SPI_COLDFIRE_QSPI)\r\nwriteb(MCFSIM_ICR_AUTOVEC | MCFSIM_ICR_LEVEL4 | MCFSIM_ICR_PRI0,\r\nMCFSIM_QSPIICR);\r\nmcf_mapirq2imr(MCF_IRQ_QSPI, MCFINTC_QSPI);\r\n#endif\r\n}\r\nstatic void __init m5249_i2c_init(void)\r\n{\r\n#if IS_ENABLED(CONFIG_I2C_IMX)\r\nu32 r;\r\nwriteb(MCFSIM_ICR_AUTOVEC | MCFSIM_ICR_LEVEL5 | MCFSIM_ICR_PRI0,\r\nMCFSIM_I2CICR);\r\nmcf_mapirq2imr(MCF_IRQ_I2C0, MCFINTC_I2C);\r\nr = readl(MCFINTC2_INTPRI_REG(MCF_IRQ_I2C1));\r\nr &= ~MCFINTC2_INTPRI_BITS(0xf, MCF_IRQ_I2C1);\r\nr |= MCFINTC2_INTPRI_BITS(0x5, MCF_IRQ_I2C1);\r\nwritel(r, MCFINTC2_INTPRI_REG(MCF_IRQ_I2C1));\r\n#endif\r\n}\r\nstatic void __init m5249_smc91x_init(void)\r\n{\r\nu32 gpio;\r\ngpio = readl(MCFSIM2_GPIOINTENABLE);\r\nwritel(gpio | 0x40, MCFSIM2_GPIOINTENABLE);\r\ngpio = readl(MCFINTC2_INTPRI5);\r\nwritel(gpio | 0x04000000, MCFINTC2_INTPRI5);\r\n}\r\nvoid __init config_BSP(char *commandp, int size)\r\n{\r\nmach_sched_init = hw_timer_init;\r\n#ifdef CONFIG_M5249C3\r\nm5249_smc91x_init();\r\n#endif\r\nm5249_qspi_init();\r\nm5249_i2c_init();\r\n}\r\nstatic int __init init_BSP(void)\r\n{\r\nplatform_add_devices(m5249_devices, ARRAY_SIZE(m5249_devices));\r\nreturn 0;\r\n}
