void init_scattered_cpuid_features(struct cpuinfo_x86 *c)\r\n{\r\nu32 max_level;\r\nu32 regs[4];\r\nconst struct cpuid_bit *cb;\r\nfor (cb = cpuid_bits; cb->feature; cb++) {\r\nmax_level = cpuid_eax(cb->level & 0xffff0000);\r\nif (max_level < cb->level ||\r\nmax_level > (cb->level | 0xffff))\r\ncontinue;\r\ncpuid_count(cb->level, cb->sub_leaf, &regs[CPUID_EAX],\r\n&regs[CPUID_EBX], &regs[CPUID_ECX],\r\n&regs[CPUID_EDX]);\r\nif (regs[cb->reg] & (1 << cb->bit))\r\nset_cpu_cap(c, cb->feature);\r\n}\r\n}\r\nu32 get_scattered_cpuid_leaf(unsigned int level, unsigned int sub_leaf,\r\nenum cpuid_regs_idx reg)\r\n{\r\nconst struct cpuid_bit *cb;\r\nu32 cpuid_val = 0;\r\nfor (cb = cpuid_bits; cb->feature; cb++) {\r\nif (level > cb->level)\r\ncontinue;\r\nif (level < cb->level)\r\nbreak;\r\nif (reg == cb->reg && sub_leaf == cb->sub_leaf) {\r\nif (cpu_has(&boot_cpu_data, cb->feature))\r\ncpuid_val |= BIT(cb->bit);\r\n}\r\n}\r\nreturn cpuid_val;\r\n}
