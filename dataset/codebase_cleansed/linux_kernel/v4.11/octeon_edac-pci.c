static void octeon_pci_poll(struct edac_pci_ctl_info *pci)\r\n{\r\nunion cvmx_pci_cfg01 cfg01;\r\ncfg01.u32 = octeon_npi_read32(CVMX_NPI_PCI_CFG01);\r\nif (cfg01.s.dpe) {\r\nedac_pci_handle_pe(pci, pci->ctl_name);\r\ncfg01.s.dpe = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\nif (cfg01.s.sse) {\r\nedac_pci_handle_npe(pci, "Signaled System Error");\r\ncfg01.s.sse = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\nif (cfg01.s.rma) {\r\nedac_pci_handle_npe(pci, "Received Master Abort");\r\ncfg01.s.rma = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\nif (cfg01.s.rta) {\r\nedac_pci_handle_npe(pci, "Received Target Abort");\r\ncfg01.s.rta = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\nif (cfg01.s.sta) {\r\nedac_pci_handle_npe(pci, "Signaled Target Abort");\r\ncfg01.s.sta = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\nif (cfg01.s.mdpe) {\r\nedac_pci_handle_npe(pci, "Master Data Parity Error");\r\ncfg01.s.mdpe = 1;\r\nocteon_npi_write32(CVMX_NPI_PCI_CFG01, cfg01.u32);\r\n}\r\n}\r\nstatic int octeon_pci_probe(struct platform_device *pdev)\r\n{\r\nstruct edac_pci_ctl_info *pci;\r\nint res = 0;\r\npci = edac_pci_alloc_ctl_info(0, "octeon_pci_err");\r\nif (!pci)\r\nreturn -ENOMEM;\r\npci->dev = &pdev->dev;\r\nplatform_set_drvdata(pdev, pci);\r\npci->dev_name = dev_name(&pdev->dev);\r\npci->mod_name = "octeon-pci";\r\npci->ctl_name = "octeon_pci_err";\r\npci->edac_check = octeon_pci_poll;\r\nif (edac_pci_add_device(pci, 0) > 0) {\r\npr_err("%s: edac_pci_add_device() failed\n", __func__);\r\ngoto err;\r\n}\r\nreturn 0;\r\nerr:\r\nedac_pci_free_ctl_info(pci);\r\nreturn res;\r\n}\r\nstatic int octeon_pci_remove(struct platform_device *pdev)\r\n{\r\nstruct edac_pci_ctl_info *pci = platform_get_drvdata(pdev);\r\nedac_pci_del_device(&pdev->dev);\r\nedac_pci_free_ctl_info(pci);\r\nreturn 0;\r\n}
