static struct ins_ops *arm64__associate_instruction_ops(struct arch *arch, const char *name)\r\n{\r\nstruct arm64_annotate *arm = arch->priv;\r\nstruct ins_ops *ops;\r\nregmatch_t match[2];\r\nif (!regexec(&arm->jump_insn, name, 2, match, 0))\r\nops = &jump_ops;\r\nelse if (!regexec(&arm->call_insn, name, 2, match, 0))\r\nops = &call_ops;\r\nelse if (!strcmp(name, "ret"))\r\nops = &ret_ops;\r\nelse\r\nreturn NULL;\r\narch__associate_ins_ops(arch, name, ops);\r\nreturn ops;\r\n}\r\nstatic int arm64__annotate_init(struct arch *arch)\r\n{\r\nstruct arm64_annotate *arm;\r\nint err;\r\nif (arch->initialized)\r\nreturn 0;\r\narm = zalloc(sizeof(*arm));\r\nif (!arm)\r\nreturn -1;\r\nerr = regcomp(&arm->call_insn, "^blr?$", REG_EXTENDED);\r\nif (err)\r\ngoto out_free_arm;\r\nerr = regcomp(&arm->jump_insn, "^[ct]?br?\\.?(cc|cs|eq|ge|gt|hi|le|ls|lt|mi|ne|pl)?n?z?$",\r\nREG_EXTENDED);\r\nif (err)\r\ngoto out_free_call;\r\narch->initialized = true;\r\narch->priv = arm;\r\narch->associate_instruction_ops = arm64__associate_instruction_ops;\r\narch->objdump.comment_char = ';';\r\narch->objdump.skip_functions_char = '+';\r\nreturn 0;\r\nout_free_call:\r\nregfree(&arm->call_insn);\r\nout_free_arm:\r\nfree(arm);\r\nreturn -1;\r\n}
