static int sun6i_drc_bind(struct device *dev, struct device *master,\r\nvoid *data)\r\n{\r\nstruct sun6i_drc *drc;\r\nint ret;\r\ndrc = devm_kzalloc(dev, sizeof(*drc), GFP_KERNEL);\r\nif (!drc)\r\nreturn -ENOMEM;\r\ndev_set_drvdata(dev, drc);\r\ndrc->reset = devm_reset_control_get(dev, NULL);\r\nif (IS_ERR(drc->reset)) {\r\ndev_err(dev, "Couldn't get our reset line\n");\r\nreturn PTR_ERR(drc->reset);\r\n}\r\nret = reset_control_deassert(drc->reset);\r\nif (ret) {\r\ndev_err(dev, "Couldn't deassert our reset line\n");\r\nreturn ret;\r\n}\r\ndrc->bus_clk = devm_clk_get(dev, "ahb");\r\nif (IS_ERR(drc->bus_clk)) {\r\ndev_err(dev, "Couldn't get our bus clock\n");\r\nret = PTR_ERR(drc->bus_clk);\r\ngoto err_assert_reset;\r\n}\r\nclk_prepare_enable(drc->bus_clk);\r\ndrc->mod_clk = devm_clk_get(dev, "mod");\r\nif (IS_ERR(drc->mod_clk)) {\r\ndev_err(dev, "Couldn't get our mod clock\n");\r\nret = PTR_ERR(drc->mod_clk);\r\ngoto err_disable_bus_clk;\r\n}\r\nclk_prepare_enable(drc->mod_clk);\r\nreturn 0;\r\nerr_disable_bus_clk:\r\nclk_disable_unprepare(drc->bus_clk);\r\nerr_assert_reset:\r\nreset_control_assert(drc->reset);\r\nreturn ret;\r\n}\r\nstatic void sun6i_drc_unbind(struct device *dev, struct device *master,\r\nvoid *data)\r\n{\r\nstruct sun6i_drc *drc = dev_get_drvdata(dev);\r\nclk_disable_unprepare(drc->mod_clk);\r\nclk_disable_unprepare(drc->bus_clk);\r\nreset_control_assert(drc->reset);\r\n}\r\nstatic int sun6i_drc_probe(struct platform_device *pdev)\r\n{\r\nreturn component_add(&pdev->dev, &sun6i_drc_ops);\r\n}\r\nstatic int sun6i_drc_remove(struct platform_device *pdev)\r\n{\r\ncomponent_del(&pdev->dev, &sun6i_drc_ops);\r\nreturn 0;\r\n}
