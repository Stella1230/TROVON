static void simtec_nor_vpp(struct platform_device *pdev, int vpp)\r\n{\r\nunsigned int val;\r\nval = __raw_readb(BAST_VA_CTRL3);\r\nprintk(KERN_DEBUG "%s(%d)\n", __func__, vpp);\r\nif (vpp)\r\nval |= BAST_CPLD_CTRL3_ROMWEN;\r\nelse\r\nval &= ~BAST_CPLD_CTRL3_ROMWEN;\r\n__raw_writeb(val, BAST_VA_CTRL3);\r\n}\r\nvoid __init nor_simtec_init(void)\r\n{\r\nint ret;\r\nret = platform_device_register(&simtec_device_nor);\r\nif (ret < 0)\r\nprintk(KERN_ERR "failed to register physmap-flash device\n");\r\nelse\r\nsimtec_nor_vpp(NULL, 1);\r\n}
