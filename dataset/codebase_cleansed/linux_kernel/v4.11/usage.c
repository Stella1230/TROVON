static void report(const char *prefix, const char *err, va_list params)\r\n{\r\nchar msg[1024];\r\nvsnprintf(msg, sizeof(msg), err, params);\r\nfprintf(stderr, " %s%s\n", prefix, msg);\r\n}\r\nstatic NORETURN void usage_builtin(const char *err)\r\n{\r\nfprintf(stderr, "\n Usage: %s\n", err);\r\nexit(129);\r\n}\r\nstatic NORETURN void die_builtin(const char *err, va_list params)\r\n{\r\nreport(" Fatal: ", err, params);\r\nexit(128);\r\n}\r\nstatic void error_builtin(const char *err, va_list params)\r\n{\r\nreport(" Error: ", err, params);\r\n}\r\nstatic void warn_builtin(const char *warn, va_list params)\r\n{\r\nreport(" Warning: ", warn, params);\r\n}\r\nvoid set_warning_routine(void (*routine)(const char *err, va_list params))\r\n{\r\nwarn_routine = routine;\r\n}\r\nvoid usage(const char *err)\r\n{\r\nusage_routine(err);\r\n}\r\nvoid die(const char *err, ...)\r\n{\r\nva_list params;\r\nva_start(params, err);\r\ndie_builtin(err, params);\r\nva_end(params);\r\n}\r\nint error(const char *err, ...)\r\n{\r\nva_list params;\r\nva_start(params, err);\r\nerror_routine(err, params);\r\nva_end(params);\r\nreturn -1;\r\n}\r\nvoid warning(const char *warn, ...)\r\n{\r\nva_list params;\r\nva_start(params, warn);\r\nwarn_routine(warn, params);\r\nva_end(params);\r\n}
