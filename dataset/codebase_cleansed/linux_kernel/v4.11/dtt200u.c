static int dtt200u_power_ctrl(struct dvb_usb_device *d, int onoff)\r\n{\r\nstruct dtt200u_state *st = d->priv;\r\nint ret = 0;\r\nmutex_lock(&d->data_mutex);\r\nst->data[0] = SET_INIT;\r\nif (onoff)\r\nret = dvb_usb_generic_write(d, st->data, 2);\r\nmutex_unlock(&d->data_mutex);\r\nreturn ret;\r\n}\r\nstatic int dtt200u_streaming_ctrl(struct dvb_usb_adapter *adap, int onoff)\r\n{\r\nstruct dvb_usb_device *d = adap->dev;\r\nstruct dtt200u_state *st = d->priv;\r\nint ret;\r\nmutex_lock(&d->data_mutex);\r\nst->data[0] = SET_STREAMING;\r\nst->data[1] = onoff;\r\nret = dvb_usb_generic_write(adap->dev, st->data, 2);\r\nif (ret < 0)\r\ngoto ret;\r\nif (onoff)\r\ngoto ret;\r\nst->data[0] = RESET_PID_FILTER;\r\nret = dvb_usb_generic_write(adap->dev, st->data, 1);\r\nret:\r\nmutex_unlock(&d->data_mutex);\r\nreturn ret;\r\n}\r\nstatic int dtt200u_pid_filter(struct dvb_usb_adapter *adap, int index, u16 pid, int onoff)\r\n{\r\nstruct dvb_usb_device *d = adap->dev;\r\nstruct dtt200u_state *st = d->priv;\r\nint ret;\r\npid = onoff ? pid : 0;\r\nmutex_lock(&d->data_mutex);\r\nst->data[0] = SET_PID_FILTER;\r\nst->data[1] = index;\r\nst->data[2] = pid & 0xff;\r\nst->data[3] = (pid >> 8) & 0x1f;\r\nret = dvb_usb_generic_write(adap->dev, st->data, 4);\r\nmutex_unlock(&d->data_mutex);\r\nreturn ret;\r\n}\r\nstatic int dtt200u_rc_query(struct dvb_usb_device *d)\r\n{\r\nstruct dtt200u_state *st = d->priv;\r\nu32 scancode;\r\nint ret;\r\nmutex_lock(&d->data_mutex);\r\nst->data[0] = GET_RC_CODE;\r\nret = dvb_usb_generic_rw(d, st->data, 1, st->data, 5, 0);\r\nif (ret < 0)\r\ngoto ret;\r\nif (st->data[0] == 1) {\r\nenum rc_type proto = RC_TYPE_NEC;\r\nscancode = st->data[1];\r\nif ((u8) ~st->data[1] != st->data[2]) {\r\nscancode = scancode << 8;\r\nscancode |= st->data[2];\r\nproto = RC_TYPE_NECX;\r\n}\r\nscancode = scancode << 8;\r\nscancode |= st->data[3];\r\nif ((u8) ~st->data[3] == st->data[4])\r\nrc_keydown(d->rc_dev, proto, scancode, 0);\r\nelse\r\nrc_keyup(d->rc_dev);\r\n} else if (st->data[0] == 2) {\r\nrc_repeat(d->rc_dev);\r\n} else {\r\nrc_keyup(d->rc_dev);\r\n}\r\nif (st->data[0] != 0)\r\ndeb_info("st->data: %*ph\n", 5, st->data);\r\nret:\r\nmutex_unlock(&d->data_mutex);\r\nreturn ret;\r\n}\r\nstatic int dtt200u_frontend_attach(struct dvb_usb_adapter *adap)\r\n{\r\nadap->fe_adap[0].fe = dtt200u_fe_attach(adap->dev);\r\nreturn 0;\r\n}\r\nstatic int dtt200u_usb_probe(struct usb_interface *intf,\r\nconst struct usb_device_id *id)\r\n{\r\nif (0 == dvb_usb_device_init(intf, &dtt200u_properties,\r\nTHIS_MODULE, NULL, adapter_nr) ||\r\n0 == dvb_usb_device_init(intf, &wt220u_properties,\r\nTHIS_MODULE, NULL, adapter_nr) ||\r\n0 == dvb_usb_device_init(intf, &wt220u_fc_properties,\r\nTHIS_MODULE, NULL, adapter_nr) ||\r\n0 == dvb_usb_device_init(intf, &wt220u_zl0353_properties,\r\nTHIS_MODULE, NULL, adapter_nr) ||\r\n0 == dvb_usb_device_init(intf, &wt220u_miglia_properties,\r\nTHIS_MODULE, NULL, adapter_nr))\r\nreturn 0;\r\nreturn -ENODEV;\r\n}
