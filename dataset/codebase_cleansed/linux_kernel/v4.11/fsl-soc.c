u32 *fsl_get_immr(void)\r\n{\r\nvoid *soc;\r\nunsigned long ret = 0;\r\nsoc = find_node_by_devtype(NULL, "soc");\r\nif (soc) {\r\nint size;\r\nu32 naddr;\r\nsize = getprop(soc, "#address-cells", prop_buf, MAX_PROP_LEN);\r\nif (size == 4)\r\nnaddr = prop_buf[0];\r\nelse\r\nnaddr = 2;\r\nif (naddr != 1 && naddr != 2)\r\ngoto err;\r\nsize = getprop(soc, "ranges", prop_buf, MAX_PROP_LEN);\r\nif (size < 12)\r\ngoto err;\r\nif (prop_buf[0] != 0)\r\ngoto err;\r\nif (naddr == 2 && prop_buf[1] != 0)\r\ngoto err;\r\nif (!dt_xlate_addr(soc, prop_buf + naddr, 8, &ret))\r\nret = 0;\r\n}\r\nerr:\r\nif (!ret)\r\nprintf("fsl_get_immr: Failed to find immr base\r\n");\r\nreturn (u32 *)ret;\r\n}
