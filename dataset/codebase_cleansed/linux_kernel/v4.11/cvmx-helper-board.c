int cvmx_helper_board_get_mii_address(int ipd_port)\r\n{\r\nswitch (cvmx_sysinfo_get()->board_type) {\r\ncase CVMX_BOARD_TYPE_SIM:\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_EBT3000:\r\ncase CVMX_BOARD_TYPE_EBT5800:\r\ncase CVMX_BOARD_TYPE_THUNDER:\r\ncase CVMX_BOARD_TYPE_NICPRO2:\r\nif ((ipd_port >= 16) && (ipd_port < 20))\r\nreturn ipd_port - 16;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_KODAMA:\r\ncase CVMX_BOARD_TYPE_EBH3100:\r\ncase CVMX_BOARD_TYPE_HIKARI:\r\ncase CVMX_BOARD_TYPE_CN3010_EVB_HS5:\r\ncase CVMX_BOARD_TYPE_CN3005_EVB_HS5:\r\ncase CVMX_BOARD_TYPE_CN3020_EVB_HS5:\r\nif (ipd_port == 0)\r\nreturn 4;\r\nelse if (ipd_port == 1)\r\nreturn 9;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_NAC38:\r\nif ((ipd_port >= 0) && (ipd_port < 4))\r\nreturn ipd_port;\r\nelse if ((ipd_port >= 16) && (ipd_port < 20))\r\nreturn ipd_port - 16 + 4;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_EBH3000:\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_EBH5200:\r\ncase CVMX_BOARD_TYPE_EBH5201:\r\ncase CVMX_BOARD_TYPE_EBT5200:\r\nif ((ipd_port >= CVMX_HELPER_BOARD_MGMT_IPD_PORT) &&\r\n(ipd_port < (CVMX_HELPER_BOARD_MGMT_IPD_PORT + 2)))\r\nreturn ipd_port - CVMX_HELPER_BOARD_MGMT_IPD_PORT;\r\nif ((ipd_port >= 0) && (ipd_port < 4))\r\nreturn ipd_port + 2;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_EBH5600:\r\ncase CVMX_BOARD_TYPE_EBH5601:\r\ncase CVMX_BOARD_TYPE_EBH5610:\r\nif (ipd_port == CVMX_HELPER_BOARD_MGMT_IPD_PORT)\r\nreturn 0;\r\nif ((ipd_port >= 0) && (ipd_port < 4))\r\nreturn ipd_port + 1;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_CUST_NB5:\r\nif (ipd_port == 2)\r\nreturn 4;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_NIC_XLE_4G:\r\nif ((ipd_port >= 16) && (ipd_port < 20))\r\nreturn ipd_port - 16 + 1;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_NIC_XLE_10G:\r\ncase CVMX_BOARD_TYPE_NIC10E:\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_NIC4E:\r\nif (ipd_port >= 0 && ipd_port <= 3)\r\nreturn (ipd_port + 0x1f) & 0x1f;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_NIC2E:\r\nif (ipd_port >= 0 && ipd_port <= 1)\r\nreturn ipd_port + 1;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_BBGW_REF:\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_CUST_WSX16:\r\nif (ipd_port >= 0 && ipd_port <= 3)\r\nreturn ipd_port;\r\nelse if (ipd_port >= 16 && ipd_port <= 19)\r\nreturn ipd_port - 16 + 4;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_UBNT_E100:\r\nif (ipd_port >= 0 && ipd_port <= 2)\r\nreturn 7 - ipd_port;\r\nelse\r\nreturn -1;\r\ncase CVMX_BOARD_TYPE_KONTRON_S1901:\r\nif (ipd_port == CVMX_HELPER_BOARD_MGMT_IPD_PORT)\r\nreturn 1;\r\nelse\r\nreturn -1;\r\n}\r\ncvmx_dprintf\r\n("cvmx_helper_board_get_mii_address: Unknown board type %d\n",\r\ncvmx_sysinfo_get()->board_type);\r\nreturn -1;\r\n}\r\ncvmx_helper_link_info_t __cvmx_helper_board_link_get(int ipd_port)\r\n{\r\ncvmx_helper_link_info_t result;\r\nresult.u64 = 0;\r\nswitch (cvmx_sysinfo_get()->board_type) {\r\ncase CVMX_BOARD_TYPE_SIM:\r\nresult.s.link_up = 1;\r\nresult.s.full_duplex = 1;\r\nresult.s.speed = 1000;\r\nreturn result;\r\ncase CVMX_BOARD_TYPE_EBH3100:\r\ncase CVMX_BOARD_TYPE_CN3010_EVB_HS5:\r\ncase CVMX_BOARD_TYPE_CN3005_EVB_HS5:\r\ncase CVMX_BOARD_TYPE_CN3020_EVB_HS5:\r\nif (ipd_port == 1) {\r\nresult.s.link_up = 1;\r\nresult.s.full_duplex = 1;\r\nresult.s.speed = 1000;\r\nreturn result;\r\n}\r\nbreak;\r\ncase CVMX_BOARD_TYPE_CUST_NB5:\r\nif (ipd_port == 1) {\r\nresult.s.link_up = 1;\r\nresult.s.full_duplex = 1;\r\nresult.s.speed = 1000;\r\nreturn result;\r\n}\r\nbreak;\r\ncase CVMX_BOARD_TYPE_BBGW_REF:\r\nif (ipd_port == 2) {\r\nresult.u64 = 0;\r\nreturn result;\r\n} else {\r\nresult.s.link_up = 1;\r\nresult.s.full_duplex = 1;\r\nresult.s.speed = 1000;\r\nreturn result;\r\n}\r\nbreak;\r\n}\r\nif (OCTEON_IS_MODEL(OCTEON_CN3XXX)\r\n|| OCTEON_IS_MODEL(OCTEON_CN58XX)\r\n|| OCTEON_IS_MODEL(OCTEON_CN50XX)) {\r\nunion cvmx_gmxx_rxx_rx_inbnd inband_status;\r\nint interface = cvmx_helper_get_interface_num(ipd_port);\r\nint index = cvmx_helper_get_interface_index_num(ipd_port);\r\ninband_status.u64 =\r\ncvmx_read_csr(CVMX_GMXX_RXX_RX_INBND(index, interface));\r\nresult.s.link_up = inband_status.s.status;\r\nresult.s.full_duplex = inband_status.s.duplex;\r\nswitch (inband_status.s.speed) {\r\ncase 0:\r\nresult.s.speed = 10;\r\nbreak;\r\ncase 1:\r\nresult.s.speed = 100;\r\nbreak;\r\ncase 2:\r\nresult.s.speed = 1000;\r\nbreak;\r\ncase 3:\r\nresult.u64 = 0;\r\nbreak;\r\n}\r\n} else {\r\nresult.u64 = 0;\r\n}\r\nif (!result.s.link_up)\r\nresult.u64 = 0;\r\nreturn result;\r\n}\r\nint __cvmx_helper_board_interface_probe(int interface, int supported_ports)\r\n{\r\nswitch (cvmx_sysinfo_get()->board_type) {\r\ncase CVMX_BOARD_TYPE_CN3005_EVB_HS5:\r\nif (interface == 0)\r\nreturn 2;\r\nbreak;\r\ncase CVMX_BOARD_TYPE_BBGW_REF:\r\nif (interface == 0)\r\nreturn 2;\r\nbreak;\r\ncase CVMX_BOARD_TYPE_NIC_XLE_4G:\r\nif (interface == 0)\r\nreturn 0;\r\nbreak;\r\ncase CVMX_BOARD_TYPE_EBH5600:\r\nif (interface == 1)\r\nreturn 0;\r\nbreak;\r\n}\r\nreturn supported_ports;\r\n}\r\nint __cvmx_helper_board_hardware_enable(int interface)\r\n{\r\nif (cvmx_sysinfo_get()->board_type == CVMX_BOARD_TYPE_CN3005_EVB_HS5) {\r\nif (interface == 0) {\r\ncvmx_write_csr(CVMX_ASXX_TX_CLK_SETX(1, interface), 0);\r\ncvmx_write_csr(CVMX_ASXX_RX_CLK_SETX(1, interface), 0);\r\ncvmx_write_csr(CVMX_ASXX_TX_CLK_SETX(0, interface),\r\n0xc);\r\ncvmx_write_csr(CVMX_ASXX_RX_CLK_SETX(0, interface),\r\n0xc);\r\n}\r\n} else if (cvmx_sysinfo_get()->board_type ==\r\nCVMX_BOARD_TYPE_UBNT_E100) {\r\ncvmx_write_csr(CVMX_ASXX_RX_CLK_SETX(0, interface), 0);\r\ncvmx_write_csr(CVMX_ASXX_TX_CLK_SETX(0, interface), 0x10);\r\ncvmx_write_csr(CVMX_ASXX_RX_CLK_SETX(1, interface), 0);\r\ncvmx_write_csr(CVMX_ASXX_TX_CLK_SETX(1, interface), 0x10);\r\ncvmx_write_csr(CVMX_ASXX_RX_CLK_SETX(2, interface), 0);\r\ncvmx_write_csr(CVMX_ASXX_TX_CLK_SETX(2, interface), 0x10);\r\n}\r\nreturn 0;\r\n}\r\nenum cvmx_helper_board_usb_clock_types __cvmx_helper_board_usb_get_clock_type(void)\r\n{\r\nswitch (cvmx_sysinfo_get()->board_type) {\r\ncase CVMX_BOARD_TYPE_BBGW_REF:\r\ncase CVMX_BOARD_TYPE_LANAI2_A:\r\ncase CVMX_BOARD_TYPE_LANAI2_U:\r\ncase CVMX_BOARD_TYPE_LANAI2_G:\r\ncase CVMX_BOARD_TYPE_NIC10E_66:\r\ncase CVMX_BOARD_TYPE_UBNT_E100:\r\nreturn USB_CLOCK_TYPE_CRYSTAL_12;\r\ncase CVMX_BOARD_TYPE_NIC10E:\r\nreturn USB_CLOCK_TYPE_REF_12;\r\ndefault:\r\nbreak;\r\n}\r\nif (OCTEON_IS_OCTEON2())\r\nreturn USB_CLOCK_TYPE_CRYSTAL_12;\r\nreturn USB_CLOCK_TYPE_REF_48;\r\n}
