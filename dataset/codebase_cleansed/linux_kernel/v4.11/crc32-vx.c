static int crc32_vx_cra_init_zero(struct crypto_tfm *tfm)\r\n{\r\nstruct crc_ctx *mctx = crypto_tfm_ctx(tfm);\r\nmctx->key = 0;\r\nreturn 0;\r\n}\r\nstatic int crc32_vx_cra_init_invert(struct crypto_tfm *tfm)\r\n{\r\nstruct crc_ctx *mctx = crypto_tfm_ctx(tfm);\r\nmctx->key = ~0;\r\nreturn 0;\r\n}\r\nstatic int crc32_vx_init(struct shash_desc *desc)\r\n{\r\nstruct crc_ctx *mctx = crypto_shash_ctx(desc->tfm);\r\nstruct crc_desc_ctx *ctx = shash_desc_ctx(desc);\r\nctx->crc = mctx->key;\r\nreturn 0;\r\n}\r\nstatic int crc32_vx_setkey(struct crypto_shash *tfm, const u8 *newkey,\r\nunsigned int newkeylen)\r\n{\r\nstruct crc_ctx *mctx = crypto_shash_ctx(tfm);\r\nif (newkeylen != sizeof(mctx->key)) {\r\ncrypto_shash_set_flags(tfm, CRYPTO_TFM_RES_BAD_KEY_LEN);\r\nreturn -EINVAL;\r\n}\r\nmctx->key = le32_to_cpu(*(__le32 *)newkey);\r\nreturn 0;\r\n}\r\nstatic int crc32be_vx_setkey(struct crypto_shash *tfm, const u8 *newkey,\r\nunsigned int newkeylen)\r\n{\r\nstruct crc_ctx *mctx = crypto_shash_ctx(tfm);\r\nif (newkeylen != sizeof(mctx->key)) {\r\ncrypto_shash_set_flags(tfm, CRYPTO_TFM_RES_BAD_KEY_LEN);\r\nreturn -EINVAL;\r\n}\r\nmctx->key = be32_to_cpu(*(__be32 *)newkey);\r\nreturn 0;\r\n}\r\nstatic int crc32le_vx_final(struct shash_desc *desc, u8 *out)\r\n{\r\nstruct crc_desc_ctx *ctx = shash_desc_ctx(desc);\r\n*(__le32 *)out = cpu_to_le32p(&ctx->crc);\r\nreturn 0;\r\n}\r\nstatic int crc32be_vx_final(struct shash_desc *desc, u8 *out)\r\n{\r\nstruct crc_desc_ctx *ctx = shash_desc_ctx(desc);\r\n*(__be32 *)out = cpu_to_be32p(&ctx->crc);\r\nreturn 0;\r\n}\r\nstatic int crc32c_vx_final(struct shash_desc *desc, u8 *out)\r\n{\r\nstruct crc_desc_ctx *ctx = shash_desc_ctx(desc);\r\n*(__le32 *)out = ~cpu_to_le32p(&ctx->crc);\r\nreturn 0;\r\n}\r\nstatic int __crc32le_vx_finup(u32 *crc, const u8 *data, unsigned int len,\r\nu8 *out)\r\n{\r\n*(__le32 *)out = cpu_to_le32(crc32_le_vx(*crc, data, len));\r\nreturn 0;\r\n}\r\nstatic int __crc32be_vx_finup(u32 *crc, const u8 *data, unsigned int len,\r\nu8 *out)\r\n{\r\n*(__be32 *)out = cpu_to_be32(crc32_be_vx(*crc, data, len));\r\nreturn 0;\r\n}\r\nstatic int __crc32c_vx_finup(u32 *crc, const u8 *data, unsigned int len,\r\nu8 *out)\r\n{\r\n*(__le32 *)out = ~cpu_to_le32(crc32c_le_vx(*crc, data, len));\r\nreturn 0;\r\n}\r\nstatic int __init crc_vx_mod_init(void)\r\n{\r\nreturn crypto_register_shashes(crc32_vx_algs,\r\nARRAY_SIZE(crc32_vx_algs));\r\n}\r\nstatic void __exit crc_vx_mod_exit(void)\r\n{\r\ncrypto_unregister_shashes(crc32_vx_algs, ARRAY_SIZE(crc32_vx_algs));\r\n}
