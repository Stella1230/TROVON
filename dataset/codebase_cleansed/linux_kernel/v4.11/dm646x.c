int __init dm646x_gpio_register(void)\r\n{\r\nreturn davinci_gpio_register(dm646x_gpio_resources,\r\nARRAY_SIZE(dm646x_gpio_resources),\r\n&dm646x_gpio_platform_data);\r\n}\r\nvoid __init dm646x_init_mcasp0(struct snd_platform_data *pdata)\r\n{\r\ndm646x_mcasp0_device.dev.platform_data = pdata;\r\nplatform_device_register(&dm646x_mcasp0_device);\r\n}\r\nvoid __init dm646x_init_mcasp1(struct snd_platform_data *pdata)\r\n{\r\ndm646x_mcasp1_device.dev.platform_data = pdata;\r\nplatform_device_register(&dm646x_mcasp1_device);\r\nplatform_device_register(&dm646x_dit_device);\r\n}\r\nvoid dm646x_setup_vpif(struct vpif_display_config *display_config,\r\nstruct vpif_capture_config *capture_config)\r\n{\r\nunsigned int value;\r\nvalue = __raw_readl(DAVINCI_SYSMOD_VIRT(SYSMOD_VSCLKDIS));\r\nvalue &= ~VSCLKDIS_MASK;\r\n__raw_writel(value, DAVINCI_SYSMOD_VIRT(SYSMOD_VSCLKDIS));\r\nvalue = __raw_readl(DAVINCI_SYSMOD_VIRT(SYSMOD_VDD3P3VPWDN));\r\nvalue &= ~VDD3P3V_VID_MASK;\r\n__raw_writel(value, DAVINCI_SYSMOD_VIRT(SYSMOD_VDD3P3VPWDN));\r\ndavinci_cfg_reg(DM646X_STSOMUX_DISABLE);\r\ndavinci_cfg_reg(DM646X_STSIMUX_DISABLE);\r\ndavinci_cfg_reg(DM646X_PTSOMUX_DISABLE);\r\ndavinci_cfg_reg(DM646X_PTSIMUX_DISABLE);\r\nvpif_display_dev.dev.platform_data = display_config;\r\nvpif_capture_dev.dev.platform_data = capture_config;\r\nplatform_device_register(&vpif_dev);\r\nplatform_device_register(&vpif_display_dev);\r\nplatform_device_register(&vpif_capture_dev);\r\n}\r\nint __init dm646x_init_edma(struct edma_rsv_info *rsv)\r\n{\r\nstruct platform_device *edma_pdev;\r\ndm646x_edma_pdata.rsv = rsv;\r\nedma_pdev = platform_device_register_full(&dm646x_edma_device);\r\nreturn IS_ERR(edma_pdev) ? PTR_ERR(edma_pdev) : 0;\r\n}\r\nvoid __init dm646x_init(void)\r\n{\r\ndavinci_common_init(&davinci_soc_info_dm646x);\r\ndavinci_map_sysmod();\r\ndavinci_clk_init(davinci_soc_info_dm646x.cpu_clks);\r\n}\r\nstatic int __init dm646x_init_devices(void)\r\n{\r\nint ret = 0;\r\nif (!cpu_is_davinci_dm646x())\r\nreturn 0;\r\nplatform_device_register(&dm646x_mdio_device);\r\nplatform_device_register(&dm646x_emac_device);\r\nret = davinci_init_wdt();\r\nif (ret)\r\npr_warn("%s: watchdog init failed: %d\n", __func__, ret);\r\nreturn ret;\r\n}
