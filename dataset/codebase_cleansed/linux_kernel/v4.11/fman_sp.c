void fman_sp_set_buf_pools_in_asc_order_of_buf_sizes(struct fman_ext_pools\r\n*fm_ext_pools,\r\nu8 *ordered_array,\r\nu16 *sizes_array)\r\n{\r\nu16 buf_size = 0;\r\nint i = 0, j = 0, k = 0;\r\nfor (i = 0; i < fm_ext_pools->num_of_pools_used; i++) {\r\nbuf_size = fm_ext_pools->ext_buf_pool[i].size;\r\nsizes_array[fm_ext_pools->ext_buf_pool[i].id] = buf_size;\r\nfor (j = 0; j <= i; j++) {\r\nif (j == i)\r\nordered_array[i] =\r\nfm_ext_pools->ext_buf_pool[i].id;\r\nelse {\r\nif (buf_size < sizes_array[ordered_array[j]]) {\r\nfor (k = i; k > j; k--)\r\nordered_array[k] =\r\nordered_array[k - 1];\r\nordered_array[k] =\r\nfm_ext_pools->ext_buf_pool[i].id;\r\nbreak;\r\n}\r\n}\r\n}\r\n}\r\n}\r\nint fman_sp_build_buffer_struct(struct fman_sp_int_context_data_copy *\r\nint_context_data_copy,\r\nstruct fman_buffer_prefix_content *\r\nbuffer_prefix_content,\r\nstruct fman_sp_buf_margins *buf_margins,\r\nstruct fman_sp_buffer_offsets *buffer_offsets,\r\nu8 *internal_buf_offset)\r\n{\r\nu32 tmp;\r\nint_context_data_copy->ext_buf_offset = (u16)\r\n((buffer_prefix_content->priv_data_size & (OFFSET_UNITS - 1)) ?\r\n((buffer_prefix_content->priv_data_size + OFFSET_UNITS) &\r\n~(u16)(OFFSET_UNITS - 1)) :\r\nbuffer_prefix_content->priv_data_size);\r\nbuffer_offsets->prs_result_offset = (u32)ILLEGAL_BASE;\r\nbuffer_offsets->time_stamp_offset = (u32)ILLEGAL_BASE;\r\nbuffer_offsets->hash_result_offset = (u32)ILLEGAL_BASE;\r\nint_context_data_copy->size =\r\n(u16)((buffer_prefix_content->pass_prs_result ? 32 : 0) +\r\n((buffer_prefix_content->pass_time_stamp ||\r\nbuffer_prefix_content->pass_hash_result) ? 16 : 0));\r\nint_context_data_copy->int_context_offset =\r\n(u8)(buffer_prefix_content->pass_prs_result ? 32 :\r\n((buffer_prefix_content->pass_time_stamp ||\r\nbuffer_prefix_content->pass_hash_result) ? 64 : 0));\r\nif (buffer_prefix_content->pass_prs_result)\r\nbuffer_offsets->prs_result_offset =\r\nint_context_data_copy->ext_buf_offset;\r\nif (buffer_prefix_content->pass_time_stamp)\r\nbuffer_offsets->time_stamp_offset =\r\nbuffer_prefix_content->pass_prs_result ?\r\n(int_context_data_copy->ext_buf_offset +\r\nsizeof(struct fman_prs_result)) :\r\nint_context_data_copy->ext_buf_offset;\r\nif (buffer_prefix_content->pass_hash_result)\r\nbuffer_offsets->hash_result_offset =\r\nbuffer_prefix_content->pass_prs_result ?\r\n(int_context_data_copy->ext_buf_offset +\r\nsizeof(struct fman_prs_result) + 8) :\r\nint_context_data_copy->ext_buf_offset + 8;\r\nif (int_context_data_copy->size)\r\nbuf_margins->start_margins =\r\n(u16)(int_context_data_copy->ext_buf_offset +\r\nint_context_data_copy->size);\r\nelse\r\nbuf_margins->start_margins =\r\nbuffer_prefix_content->priv_data_size;\r\ntmp = (u32)(buf_margins->start_margins %\r\nbuffer_prefix_content->data_align);\r\nif (tmp)\r\nbuf_margins->start_margins +=\r\n(buffer_prefix_content->data_align - tmp);\r\nbuffer_offsets->data_offset = buf_margins->start_margins;\r\nreturn 0;\r\n}
