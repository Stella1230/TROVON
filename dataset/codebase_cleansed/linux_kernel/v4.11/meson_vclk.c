static void meson_venci_cvbs_clock_config(struct meson_drm *priv)\r\n{\r\nunsigned int val;\r\nif (meson_vpu_is_compatible(priv, "amlogic,meson-gxbb-vpu")) {\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL, 0x5800023d);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL2, 0x00404e00);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL3, 0x0d5c5091);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL4, 0x801da72c);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL5, 0x71486980);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL6, 0x00000e55);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL, 0x4800023d);\r\n} else if (meson_vpu_is_compatible(priv, "amlogic,meson-gxm-vpu") ||\r\nmeson_vpu_is_compatible(priv, "amlogic,meson-gxl-vpu")) {\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL, 0x4000027b);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL2, 0x800cb300);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL3, 0xa6212844);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL4, 0x0c4d000c);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL5, 0x001fa729);\r\nregmap_write(priv->hhi, HHI_HDMI_PLL_CNTL6, 0x01a31500);\r\nregmap_update_bits(priv->hhi, HHI_HDMI_PLL_CNTL,\r\nHDMI_PLL_RESET, HDMI_PLL_RESET);\r\nregmap_update_bits(priv->hhi, HHI_HDMI_PLL_CNTL,\r\nHDMI_PLL_RESET, 0);\r\n}\r\nregmap_read_poll_timeout(priv->hhi, HHI_HDMI_PLL_CNTL, val,\r\n(val & HDMI_PLL_LOCK), 10, 0);\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL, VCLK2_EN, 0);\r\nregmap_update_bits(priv->hhi, HHI_VID_PLL_CLK_DIV, VID_PLL_EN, 0);\r\nregmap_update_bits(priv->hhi, HHI_VID_PLL_CLK_DIV, VID_PLL_PRESET, 0);\r\nregmap_update_bits(priv->hhi, HHI_VID_PLL_CLK_DIV,\r\nVID_PLL_BYPASS, VID_PLL_BYPASS);\r\nregmap_update_bits(priv->hhi, HHI_VID_PLL_CLK_DIV,\r\nVID_PLL_EN, VID_PLL_EN);\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_DIV,\r\nVCLK2_DIV_MASK, (55 - 1));\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL,\r\nVCLK2_SEL_MASK, (4 << VCLK2_SEL_SHIFT));\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL, VCLK2_EN, VCLK2_EN);\r\nregmap_update_bits(priv->hhi, HHI_VID_CLK_DIV,\r\nCTS_ENCI_SEL_MASK, (8 << CTS_ENCI_SEL_SHIFT));\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_DIV,\r\nCTS_VDAC_SEL_MASK, (8 << CTS_VDAC_SEL_SHIFT));\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_DIV,\r\nVCLK2_DIV_EN | VCLK2_DIV_RESET, VCLK2_DIV_EN);\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL,\r\nVCLK2_DIV1_EN, VCLK2_DIV1_EN);\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL,\r\nVCLK2_SOFT_RESET, VCLK2_SOFT_RESET);\r\nregmap_update_bits(priv->hhi, HHI_VIID_CLK_CNTL,\r\nVCLK2_SOFT_RESET, 0);\r\nregmap_update_bits(priv->hhi, HHI_VID_CLK_CNTL2,\r\nCTS_ENCI_EN, CTS_ENCI_EN);\r\nregmap_update_bits(priv->hhi, HHI_VID_CLK_CNTL2,\r\nCTS_VDAC_EN, CTS_VDAC_EN);\r\n}\r\nvoid meson_vclk_setup(struct meson_drm *priv, unsigned int target,\r\nunsigned int freq)\r\n{\r\nif (target == MESON_VCLK_TARGET_CVBS && freq == MESON_VCLK_CVBS)\r\nmeson_venci_cvbs_clock_config(priv);\r\n}
