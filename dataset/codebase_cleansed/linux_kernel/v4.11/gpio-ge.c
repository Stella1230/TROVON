static int __init gef_gpio_probe(struct platform_device *pdev)\r\n{\r\nconst struct of_device_id *of_id =\r\nof_match_device(gef_gpio_ids, &pdev->dev);\r\nstruct gpio_chip *gc;\r\nvoid __iomem *regs;\r\nint ret;\r\ngc = devm_kzalloc(&pdev->dev, sizeof(*gc), GFP_KERNEL);\r\nif (!gc)\r\nreturn -ENOMEM;\r\nregs = of_iomap(pdev->dev.of_node, 0);\r\nif (!regs)\r\nreturn -ENOMEM;\r\nret = bgpio_init(gc, &pdev->dev, 4, regs + GEF_GPIO_IN,\r\nregs + GEF_GPIO_OUT, NULL, NULL,\r\nregs + GEF_GPIO_DIRECT, BGPIOF_BIG_ENDIAN_BYTE_ORDER);\r\nif (ret) {\r\ndev_err(&pdev->dev, "bgpio_init failed\n");\r\ngoto err0;\r\n}\r\ngc->label = devm_kstrdup(&pdev->dev, pdev->dev.of_node->full_name,\r\nGFP_KERNEL);\r\nif (!gc->label) {\r\nret = -ENOMEM;\r\ngoto err0;\r\n}\r\ngc->base = -1;\r\ngc->ngpio = (u16)(uintptr_t)of_id->data;\r\ngc->of_gpio_n_cells = 2;\r\ngc->of_node = pdev->dev.of_node;\r\nret = devm_gpiochip_add_data(&pdev->dev, gc, NULL);\r\nif (ret)\r\ngoto err0;\r\nreturn 0;\r\nerr0:\r\niounmap(regs);\r\npr_err("%s: GPIO chip registration failed\n",\r\npdev->dev.of_node->full_name);\r\nreturn ret;\r\n}
