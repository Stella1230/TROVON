static inline struct clk_regmap_div *to_clk_regmap_div(struct clk_hw *hw)\r\n{\r\nreturn container_of(to_clk_regmap(hw), struct clk_regmap_div, clkr);\r\n}\r\nstatic long div_round_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long *prate)\r\n{\r\nstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\r\nreturn divider_round_rate(hw, rate, prate, NULL, divider->width,\r\nCLK_DIVIDER_ROUND_CLOSEST);\r\n}\r\nstatic int div_set_rate(struct clk_hw *hw, unsigned long rate,\r\nunsigned long parent_rate)\r\n{\r\nstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\r\nstruct clk_regmap *clkr = &divider->clkr;\r\nu32 div;\r\ndiv = divider_get_val(rate, parent_rate, NULL, divider->width,\r\nCLK_DIVIDER_ROUND_CLOSEST);\r\nreturn regmap_update_bits(clkr->regmap, divider->reg,\r\n(BIT(divider->width) - 1) << divider->shift,\r\ndiv << divider->shift);\r\n}\r\nstatic unsigned long div_recalc_rate(struct clk_hw *hw,\r\nunsigned long parent_rate)\r\n{\r\nstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\r\nstruct clk_regmap *clkr = &divider->clkr;\r\nu32 div;\r\nregmap_read(clkr->regmap, divider->reg, &div);\r\ndiv >>= divider->shift;\r\ndiv &= BIT(divider->width) - 1;\r\nreturn divider_recalc_rate(hw, parent_rate, div, NULL,\r\nCLK_DIVIDER_ROUND_CLOSEST);\r\n}
