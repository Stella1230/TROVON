static int meson_efuse_read(void *context, unsigned int offset,\r\nvoid *val, size_t bytes)\r\n{\r\nu8 *buf = val;\r\nint ret;\r\nret = meson_sm_call_read(buf, SM_EFUSE_READ, offset,\r\nbytes, 0, 0, 0);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int meson_efuse_probe(struct platform_device *pdev)\r\n{\r\nstruct nvmem_device *nvmem;\r\nunsigned int size;\r\nif (meson_sm_call(SM_EFUSE_USER_MAX, &size, 0, 0, 0, 0, 0) < 0)\r\nreturn -EINVAL;\r\neconfig.dev = &pdev->dev;\r\neconfig.reg_read = meson_efuse_read;\r\neconfig.size = size;\r\nnvmem = nvmem_register(&econfig);\r\nif (IS_ERR(nvmem))\r\nreturn PTR_ERR(nvmem);\r\nplatform_set_drvdata(pdev, nvmem);\r\nreturn 0;\r\n}\r\nstatic int meson_efuse_remove(struct platform_device *pdev)\r\n{\r\nstruct nvmem_device *nvmem = platform_get_drvdata(pdev);\r\nreturn nvmem_unregister(nvmem);\r\n}
