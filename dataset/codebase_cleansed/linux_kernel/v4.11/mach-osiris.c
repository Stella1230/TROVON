static void osiris_nand_select(struct s3c2410_nand_set *set, int slot)\r\n{\r\nunsigned int tmp;\r\nslot = set->nr_map[slot] & 3;\r\npr_debug("osiris_nand: selecting slot %d (set %p,%p)\n",\r\nslot, set, set->nr_map);\r\ntmp = __raw_readb(OSIRIS_VA_CTRL0);\r\ntmp &= ~OSIRIS_CTRL0_NANDSEL;\r\ntmp |= slot;\r\npr_debug("osiris_nand: ctrl0 now %02x\n", tmp);\r\n__raw_writeb(tmp, OSIRIS_VA_CTRL0);\r\n}\r\nstatic int osiris_pm_suspend(void)\r\n{\r\nunsigned int tmp;\r\npm_osiris_ctrl0 = __raw_readb(OSIRIS_VA_CTRL0);\r\ntmp = pm_osiris_ctrl0 & ~OSIRIS_CTRL0_NANDSEL;\r\nif ((pm_osiris_ctrl0 & OSIRIS_CTRL0_BOOT_INT) == 0)\r\ntmp |= 2;\r\n__raw_writeb(tmp, OSIRIS_VA_CTRL0);\r\ngpio_request_one(S3C2410_GPA(21), GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_free(S3C2410_GPA(21));\r\nreturn 0;\r\n}\r\nstatic void osiris_pm_resume(void)\r\n{\r\nif (pm_osiris_ctrl0 & OSIRIS_CTRL0_FIX8)\r\n__raw_writeb(OSIRIS_CTRL1_FIX8, OSIRIS_VA_CTRL1);\r\n__raw_writeb(pm_osiris_ctrl0, OSIRIS_VA_CTRL0);\r\ns3c_gpio_cfgpin(S3C2410_GPA(21), S3C2410_GPA21_nRSTOUT);\r\n}\r\nstatic void osiris_tps_release(struct device *dev)\r\n{\r\n}\r\nstatic int osiris_tps_setup(struct i2c_client *client, void *context)\r\n{\r\nosiris_tps_device.dev.parent = &client->dev;\r\nreturn platform_device_register(&osiris_tps_device);\r\n}\r\nstatic int osiris_tps_remove(struct i2c_client *client, void *context)\r\n{\r\nplatform_device_unregister(&osiris_tps_device);\r\nreturn 0;\r\n}\r\nstatic void __init osiris_map_io(void)\r\n{\r\nunsigned long flags;\r\ns3c24xx_init_io(osiris_iodesc, ARRAY_SIZE(osiris_iodesc));\r\ns3c24xx_init_uarts(osiris_uartcfgs, ARRAY_SIZE(osiris_uartcfgs));\r\nsamsung_set_timer_source(SAMSUNG_PWM3, SAMSUNG_PWM4);\r\nif ((__raw_readb(OSIRIS_VA_IDREG) & OSIRIS_ID_REVMASK) >= 4) {\r\nprintk(KERN_INFO "OSIRIS-B detected (revision %d)\n",\r\n__raw_readb(OSIRIS_VA_IDREG) & OSIRIS_ID_REVMASK);\r\nosiris_nand_sets[0].partitions = osiris_default_nand_part_large;\r\nosiris_nand_sets[0].nr_partitions = ARRAY_SIZE(osiris_default_nand_part_large);\r\n} else {\r\ngpio_request_one(S3C2410_GPA(0), GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_free(S3C2410_GPA(0));\r\n}\r\nlocal_irq_save(flags);\r\n__raw_writel(__raw_readl(S3C2410_BWSCON) | S3C2410_BWSCON_ST1 | S3C2410_BWSCON_ST2 | S3C2410_BWSCON_ST3 | S3C2410_BWSCON_ST4 | S3C2410_BWSCON_ST5, S3C2410_BWSCON);\r\nlocal_irq_restore(flags);\r\n}\r\nstatic void __init osiris_init_time(void)\r\n{\r\ns3c2440_init_clocks(12000000);\r\nsamsung_timer_init();\r\n}\r\nstatic void __init osiris_init(void)\r\n{\r\nregister_syscore_ops(&osiris_pm_syscore_ops);\r\ns3c_i2c0_set_platdata(NULL);\r\ns3c_nand_set_platdata(&osiris_nand_info);\r\ns3c_cpufreq_setboard(&osiris_cpufreq);\r\ni2c_register_board_info(0, osiris_i2c_devs,\r\nARRAY_SIZE(osiris_i2c_devs));\r\nplatform_add_devices(osiris_devices, ARRAY_SIZE(osiris_devices));\r\n}
