static int\r\nneponset_pcmcia_configure_socket(struct soc_pcmcia_socket *skt, const socket_state_t *state)\r\n{\r\nstruct sa1111_pcmcia_socket *s = to_skt(skt);\r\nunsigned int ncr_mask, ncr_set, pa_dwr_mask, pa_dwr_set;\r\nint ret;\r\nswitch (skt->nr) {\r\ncase 0:\r\npa_dwr_mask = GPIO_A0 | GPIO_A1;\r\nncr_mask = NCR_A0VPP | NCR_A1VPP;\r\nif (state->Vpp == 0)\r\nncr_set = 0;\r\nelse if (state->Vpp == 120)\r\nncr_set = NCR_A1VPP;\r\nelse if (state->Vpp == state->Vcc)\r\nncr_set = NCR_A0VPP;\r\nelse {\r\nprintk(KERN_ERR "%s(): unrecognized VPP %u\n",\r\n__func__, state->Vpp);\r\nreturn -1;\r\n}\r\nbreak;\r\ncase 1:\r\npa_dwr_mask = GPIO_A2 | GPIO_A3;\r\nncr_mask = 0;\r\nncr_set = 0;\r\nif (state->Vpp != state->Vcc && state->Vpp != 0) {\r\nprintk(KERN_ERR "%s(): CF slot cannot support VPP %u\n",\r\n__func__, state->Vpp);\r\nreturn -1;\r\n}\r\nbreak;\r\ndefault:\r\nreturn -1;\r\n}\r\nswitch (state->Vcc) {\r\ndefault:\r\ncase 0: pa_dwr_set = 0; break;\r\ncase 33: pa_dwr_set = GPIO_A1|GPIO_A2; break;\r\ncase 50: pa_dwr_set = GPIO_A0|GPIO_A3; break;\r\n}\r\nret = sa1111_pcmcia_configure_socket(skt, state);\r\nif (ret == 0) {\r\nneponset_ncr_frob(ncr_mask, ncr_set);\r\nsa1111_set_io(s->dev, pa_dwr_mask, pa_dwr_set);\r\n}\r\nreturn ret;\r\n}\r\nint pcmcia_neponset_init(struct sa1111_dev *sadev)\r\n{\r\nsa1111_set_io_dir(sadev, GPIO_A0|GPIO_A1|GPIO_A2|GPIO_A3, 0, 0);\r\nsa1111_set_io(sadev, GPIO_A0|GPIO_A1|GPIO_A2|GPIO_A3, 0);\r\nsa1111_set_sleep_io(sadev, GPIO_A0|GPIO_A1|GPIO_A2|GPIO_A3, 0);\r\nsa11xx_drv_pcmcia_ops(&neponset_pcmcia_ops);\r\nreturn sa1111_pcmcia_add(sadev, &neponset_pcmcia_ops,\r\nsa11xx_drv_pcmcia_add_one);\r\n}
