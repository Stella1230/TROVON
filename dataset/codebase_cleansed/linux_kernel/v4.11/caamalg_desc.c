static inline void aead_append_src_dst(u32 *desc, u32 msg_type)\r\n{\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | KEY_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_BOTH |\r\nKEY_VLF | msg_type | FIFOLD_TYPE_LASTBOTH);\r\n}\r\nstatic inline void append_dec_op1(u32 *desc, u32 type)\r\n{\r\nu32 *jump_cmd, *uncond_jump_cmd;\r\nif ((type & OP_ALG_ALGSEL_MASK) != OP_ALG_ALGSEL_AES) {\r\nappend_operation(desc, type | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT);\r\nreturn;\r\n}\r\njump_cmd = append_jump(desc, JUMP_TEST_ALL | JUMP_COND_SHRD);\r\nappend_operation(desc, type | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT);\r\nuncond_jump_cmd = append_jump(desc, JUMP_TEST_ALL);\r\nset_jump_tgt_here(desc, jump_cmd);\r\nappend_operation(desc, type | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_AAI_DK);\r\nset_jump_tgt_here(desc, uncond_jump_cmd);\r\n}\r\nvoid cnstr_shdsc_aead_null_encap(u32 * const desc, struct alginfo *adata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *read_move_cmd, *write_move_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (adata->key_inline)\r\nappend_key_as_imm(desc, adata->key_virt, adata->keylen_pad,\r\nadata->keylen, CLASS_2 | KEY_DEST_MDHA_SPLIT |\r\nKEY_ENC);\r\nelse\r\nappend_key(desc, adata->key_dma, adata->keylen, CLASS_2 |\r\nKEY_DEST_MDHA_SPLIT | KEY_ENC);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_math_sub(desc, REG3, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nread_move_cmd = append_move(desc, MOVE_SRC_DESCBUF |\r\nMOVE_DEST_MATH3 |\r\n(0x6 << MOVE_LEN_SHIFT));\r\nwrite_move_cmd = append_move(desc, MOVE_SRC_MATH3 |\r\nMOVE_DEST_DESCBUF |\r\nMOVE_WAITCOMP |\r\n(0x8 << MOVE_LEN_SHIFT));\r\nappend_operation(desc, adata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\naead_append_src_dst(desc, FIFOLD_TYPE_MSG | FIFOLD_TYPE_FLUSH1);\r\nset_move_tgt_here(desc, read_move_cmd);\r\nset_move_tgt_here(desc, write_move_cmd);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_SRC_INFIFO_CL | MOVE_DEST_OUTFIFO |\r\nMOVE_AUX_LS);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_2_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"aead null enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_aead_null_decap(u32 * const desc, struct alginfo *adata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *read_move_cmd, *write_move_cmd, *jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (adata->key_inline)\r\nappend_key_as_imm(desc, adata->key_virt, adata->keylen_pad,\r\nadata->keylen, CLASS_2 |\r\nKEY_DEST_MDHA_SPLIT | KEY_ENC);\r\nelse\r\nappend_key(desc, adata->key_dma, adata->keylen, CLASS_2 |\r\nKEY_DEST_MDHA_SPLIT | KEY_ENC);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, adata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_ICV_ON);\r\nappend_math_sub(desc, REG2, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG2, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG2, CAAM_CMD_SZ);\r\nread_move_cmd = append_move(desc, MOVE_SRC_DESCBUF |\r\nMOVE_DEST_MATH2 |\r\n(0x6 << MOVE_LEN_SHIFT));\r\nwrite_move_cmd = append_move(desc, MOVE_SRC_MATH2 |\r\nMOVE_DEST_DESCBUF |\r\nMOVE_WAITCOMP |\r\n(0x8 << MOVE_LEN_SHIFT));\r\naead_append_src_dst(desc, FIFOLD_TYPE_MSG | FIFOLD_TYPE_FLUSH1);\r\njump_cmd = append_jump(desc, JUMP_TEST_ALL);\r\nset_jump_tgt_here(desc, jump_cmd);\r\nset_move_tgt_here(desc, read_move_cmd);\r\nset_move_tgt_here(desc, write_move_cmd);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_SRC_INFIFO_CL | MOVE_DEST_OUTFIFO |\r\nMOVE_AUX_LS);\r\nappend_cmd(desc, CMD_LOAD | ENABLE_AUTO_INFO_FIFO);\r\nappend_seq_fifo_load(desc, icvsize, FIFOLD_CLASS_CLASS2 |\r\nFIFOLD_TYPE_LAST2 | FIFOLD_TYPE_ICV);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"aead null dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nstatic void init_sh_desc_key_aead(u32 * const desc,\r\nstruct alginfo * const cdata,\r\nstruct alginfo * const adata,\r\nconst bool is_rfc3686, u32 *nonce)\r\n{\r\nu32 *key_jump_cmd;\r\nunsigned int enckeylen = cdata->keylen;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (is_rfc3686)\r\nenckeylen -= CTR_RFC3686_NONCE_SIZE;\r\nif (adata->key_inline)\r\nappend_key_as_imm(desc, adata->key_virt, adata->keylen_pad,\r\nadata->keylen, CLASS_2 |\r\nKEY_DEST_MDHA_SPLIT | KEY_ENC);\r\nelse\r\nappend_key(desc, adata->key_dma, adata->keylen, CLASS_2 |\r\nKEY_DEST_MDHA_SPLIT | KEY_ENC);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, enckeylen,\r\nenckeylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, enckeylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nif (is_rfc3686) {\r\nappend_load_as_imm(desc, nonce, CTR_RFC3686_NONCE_SIZE,\r\nLDST_CLASS_IND_CCB |\r\nLDST_SRCDST_BYTE_OUTFIFO | LDST_IMM);\r\nappend_move(desc,\r\nMOVE_SRC_OUTFIFO |\r\nMOVE_DEST_CLASS1CTX |\r\n(16 << MOVE_OFFSET_SHIFT) |\r\n(CTR_RFC3686_NONCE_SIZE << MOVE_LEN_SHIFT));\r\n}\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\n}\r\nvoid cnstr_shdsc_aead_encap(u32 * const desc, struct alginfo *cdata,\r\nstruct alginfo *adata, unsigned int icvsize,\r\nconst bool is_rfc3686, u32 *nonce,\r\nconst u32 ctx1_iv_off)\r\n{\r\ninit_sh_desc_key_aead(desc, cdata, adata, is_rfc3686, nonce);\r\nappend_operation(desc, adata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS2 | FIFOLD_TYPE_MSG |\r\nFIFOLDST_VLF);\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_add(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\naead_append_src_dst(desc, FIFOLD_TYPE_MSG1OUT2);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_2_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR, "aead enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_aead_decap(u32 * const desc, struct alginfo *cdata,\r\nstruct alginfo *adata, unsigned int ivsize,\r\nunsigned int icvsize, const bool geniv,\r\nconst bool is_rfc3686, u32 *nonce,\r\nconst u32 ctx1_iv_off)\r\n{\r\ninit_sh_desc_key_aead(desc, cdata, adata, is_rfc3686, nonce);\r\nappend_operation(desc, adata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_ICV_ON);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nif (geniv)\r\nappend_math_add_imm_u32(desc, VARSEQOUTLEN, REG3, IMM, ivsize);\r\nelse\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS2 | FIFOLD_TYPE_MSG |\r\nKEY_VLF);\r\nif (geniv) {\r\nappend_seq_load(desc, ivsize, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n(ctx1_iv_off << LDST_OFFSET_SHIFT));\r\nappend_move(desc, MOVE_SRC_CLASS1CTX | MOVE_DEST_CLASS2INFIFO |\r\n(ctx1_iv_off << MOVE_OFFSET_SHIFT) | ivsize);\r\n}\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nif (ctx1_iv_off)\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT);\r\nelse\r\nappend_dec_op1(desc, cdata->algtype);\r\nappend_math_add(desc, VARSEQINLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\naead_append_src_dst(desc, FIFOLD_TYPE_MSG);\r\nappend_seq_fifo_load(desc, icvsize, FIFOLD_CLASS_CLASS2 |\r\nFIFOLD_TYPE_LAST2 | FIFOLD_TYPE_ICV);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR, "aead dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_aead_givencap(u32 * const desc, struct alginfo *cdata,\r\nstruct alginfo *adata, unsigned int ivsize,\r\nunsigned int icvsize, const bool is_rfc3686,\r\nu32 *nonce, const u32 ctx1_iv_off)\r\n{\r\nu32 geniv, moveiv;\r\ninit_sh_desc_key_aead(desc, cdata, adata, is_rfc3686, nonce);\r\nif (is_rfc3686)\r\ngoto copy_iv;\r\ngeniv = NFIFOENTRY_STYPE_PAD | NFIFOENTRY_DEST_DECO |\r\nNFIFOENTRY_DTYPE_MSG | NFIFOENTRY_LC1 |\r\nNFIFOENTRY_PTYPE_RND | (ivsize << NFIFOENTRY_DLEN_SHIFT);\r\nappend_load_imm_u32(desc, geniv, LDST_CLASS_IND_CCB |\r\nLDST_SRCDST_WORD_INFO_FIFO | LDST_IMM);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_WAITCOMP |\r\nMOVE_SRC_INFIFO | MOVE_DEST_CLASS1CTX |\r\n(ctx1_iv_off << MOVE_OFFSET_SHIFT) |\r\n(ivsize << MOVE_LEN_SHIFT));\r\nappend_cmd(desc, CMD_LOAD | ENABLE_AUTO_INFO_FIFO);\r\ncopy_iv:\r\nappend_move(desc, MOVE_SRC_CLASS1CTX | MOVE_DEST_OUTFIFO |\r\n(ctx1_iv_off << MOVE_OFFSET_SHIFT) |\r\n(ivsize << MOVE_LEN_SHIFT));\r\nappend_operation(desc, adata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS2 | FIFOLD_TYPE_MSG |\r\nKEY_VLF);\r\nmoveiv = NFIFOENTRY_STYPE_OFIFO | NFIFOENTRY_DEST_CLASS2 |\r\nNFIFOENTRY_DTYPE_MSG | (ivsize << NFIFOENTRY_DLEN_SHIFT);\r\nappend_load_imm_u32(desc, moveiv, LDST_CLASS_IND_CCB |\r\nLDST_SRCDST_WORD_INFO_FIFO | LDST_IMM);\r\nappend_load_imm_u32(desc, ivsize, LDST_CLASS_2_CCB |\r\nLDST_SRCDST_WORD_DATASZ_REG | LDST_IMM);\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_add(desc, VARSEQOUTLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, ivsize,\r\nFIFOLD_CLASS_SKIP);\r\nappend_math_add(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_BOTH | KEY_VLF |\r\nFIFOLD_TYPE_MSG1OUT2 | FIFOLD_TYPE_LASTBOTH);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | KEY_VLF);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_2_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"aead givenc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_gcm_encap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *zero_payload_jump_cmd, *zero_assoc_jump_cmd1,\r\n*zero_assoc_jump_cmd2;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD | JUMP_COND_SELF);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nzero_assoc_jump_cmd2 = append_jump(desc, JUMP_TEST_ALL |\r\nJUMP_COND_MATH_Z);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nzero_assoc_jump_cmd1 = append_jump(desc, JUMP_TEST_ALL |\r\nJUMP_COND_MATH_Z);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQINLEN, REG3, CAAM_CMD_SZ);\r\nzero_payload_jump_cmd = append_jump(desc, JUMP_TEST_ALL |\r\nJUMP_COND_MATH_Z);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_FLUSH1);\r\nset_jump_tgt_here(desc, zero_assoc_jump_cmd1);\r\nappend_math_sub(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_MSG | FIFOLD_TYPE_LAST1);\r\nappend_jump(desc, JUMP_TEST_ALL | 2);\r\nset_jump_tgt_here(desc, zero_payload_jump_cmd);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_LAST1);\r\nset_jump_tgt_here(desc, zero_assoc_jump_cmd2);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR, "gcm enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_gcm_decap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *zero_payload_jump_cmd, *zero_assoc_jump_cmd1;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL |\r\nJUMP_TEST_ALL | JUMP_COND_SHRD |\r\nJUMP_COND_SELF);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_ICV_ON);\r\nappend_math_add(desc, VARSEQINLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nzero_assoc_jump_cmd1 = append_jump(desc, JUMP_TEST_ALL |\r\nJUMP_COND_MATH_Z);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_FLUSH1);\r\nset_jump_tgt_here(desc, zero_assoc_jump_cmd1);\r\nappend_math_sub(desc, VARSEQINLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nzero_payload_jump_cmd = append_jump(desc, JUMP_TEST_ALL |\r\nJUMP_COND_MATH_Z);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_MSG | FIFOLD_TYPE_FLUSH1);\r\nset_jump_tgt_here(desc, zero_payload_jump_cmd);\r\nappend_seq_fifo_load(desc, icvsize, FIFOLD_CLASS_CLASS1 |\r\nFIFOLD_TYPE_ICV | FIFOLD_TYPE_LAST1);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR, "gcm dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_rfc4106_encap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_sub_imm_u32(desc, VARSEQINLEN, REG3, IMM, 8);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_FLUSH1);\r\nappend_seq_fifo_load(desc, 8, FIFOLD_CLASS_SKIP);\r\nappend_math_sub(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLD_TYPE_MSG);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_math_sub(desc, VARSEQOUTLEN, VARSEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_MSG | FIFOLD_TYPE_LAST1);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"rfc4106 enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_rfc4106_decap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_ICV_ON);\r\nappend_math_sub_imm_u32(desc, VARSEQINLEN, REG3, IMM, 8);\r\nappend_math_add(desc, VARSEQOUTLEN, ZERO, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_FLUSH1);\r\nappend_seq_fifo_load(desc, 8, FIFOLD_CLASS_SKIP);\r\nappend_math_sub(desc, VARSEQINLEN, SEQOUTLEN, REG3, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLD_TYPE_MSG);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_SKIP | FIFOLDST_VLF);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 | FIFOLDST_VLF |\r\nFIFOLD_TYPE_MSG | FIFOLD_TYPE_FLUSH1);\r\nappend_seq_fifo_load(desc, icvsize, FIFOLD_CLASS_CLASS1 |\r\nFIFOLD_TYPE_ICV | FIFOLD_TYPE_LAST1);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"rfc4106 dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_rfc4543_encap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *read_move_cmd, *write_move_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nappend_math_sub(desc, REG3, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nread_move_cmd = append_move(desc, MOVE_SRC_DESCBUF | MOVE_DEST_MATH3 |\r\n(0x6 << MOVE_LEN_SHIFT));\r\nwrite_move_cmd = append_move(desc, MOVE_SRC_MATH3 | MOVE_DEST_DESCBUF |\r\n(0x8 << MOVE_LEN_SHIFT));\r\nappend_math_sub(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\naead_append_src_dst(desc, FIFOLD_TYPE_AAD);\r\nset_move_tgt_here(desc, read_move_cmd);\r\nset_move_tgt_here(desc, write_move_cmd);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_SRC_INFIFO_CL | MOVE_DEST_OUTFIFO);\r\nappend_seq_store(desc, icvsize, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"rfc4543 enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_rfc4543_decap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int icvsize)\r\n{\r\nu32 *key_jump_cmd, *read_move_cmd, *write_move_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nif (cdata->key_inline)\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nelse\r\nappend_key(desc, cdata->key_dma, cdata->keylen, CLASS_1 |\r\nKEY_DEST_CLASS_REG);\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT | OP_ALG_ICV_ON);\r\nappend_math_sub(desc, REG3, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nread_move_cmd = append_move(desc, MOVE_SRC_DESCBUF | MOVE_DEST_MATH3 |\r\n(0x6 << MOVE_LEN_SHIFT));\r\nwrite_move_cmd = append_move(desc, MOVE_SRC_MATH3 | MOVE_DEST_DESCBUF |\r\n(0x8 << MOVE_LEN_SHIFT));\r\nappend_math_sub(desc, VARSEQINLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_sub(desc, VARSEQOUTLEN, SEQOUTLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | FIFOLDST_VLF);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_BOTH | FIFOLDST_VLF |\r\nFIFOLD_TYPE_AAD | FIFOLD_TYPE_LAST2FLUSH1);\r\nset_move_tgt_here(desc, read_move_cmd);\r\nset_move_tgt_here(desc, write_move_cmd);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_SRC_INFIFO_CL | MOVE_DEST_OUTFIFO);\r\nappend_cmd(desc, CMD_LOAD | ENABLE_AUTO_INFO_FIFO);\r\nappend_seq_fifo_load(desc, icvsize, FIFOLD_CLASS_CLASS1 |\r\nFIFOLD_TYPE_ICV | FIFOLD_TYPE_LAST1);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"rfc4543 dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nstatic inline void ablkcipher_append_src_dst(u32 *desc)\r\n{\r\nappend_math_add(desc, VARSEQOUTLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_math_add(desc, VARSEQINLEN, SEQINLEN, REG0, CAAM_CMD_SZ);\r\nappend_seq_fifo_load(desc, 0, FIFOLD_CLASS_CLASS1 |\r\nKEY_VLF | FIFOLD_TYPE_MSG | FIFOLD_TYPE_LAST1);\r\nappend_seq_fifo_store(desc, 0, FIFOST_TYPE_MESSAGE_DATA | KEY_VLF);\r\n}\r\nvoid cnstr_shdsc_ablkcipher_encap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int ivsize, const bool is_rfc3686,\r\nconst u32 ctx1_iv_off)\r\n{\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nif (is_rfc3686) {\r\nu8 *nonce = cdata->key_virt + cdata->keylen;\r\nappend_load_as_imm(desc, nonce, CTR_RFC3686_NONCE_SIZE,\r\nLDST_CLASS_IND_CCB |\r\nLDST_SRCDST_BYTE_OUTFIFO | LDST_IMM);\r\nappend_move(desc, MOVE_WAITCOMP | MOVE_SRC_OUTFIFO |\r\nMOVE_DEST_CLASS1CTX | (16 << MOVE_OFFSET_SHIFT) |\r\n(CTR_RFC3686_NONCE_SIZE << MOVE_LEN_SHIFT));\r\n}\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_seq_load(desc, ivsize, LDST_SRCDST_BYTE_CONTEXT |\r\nLDST_CLASS_1_CCB | (ctx1_iv_off << LDST_OFFSET_SHIFT));\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nablkcipher_append_src_dst(desc);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"ablkcipher enc shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_ablkcipher_decap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int ivsize, const bool is_rfc3686,\r\nconst u32 ctx1_iv_off)\r\n{\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nif (is_rfc3686) {\r\nu8 *nonce = cdata->key_virt + cdata->keylen;\r\nappend_load_as_imm(desc, nonce, CTR_RFC3686_NONCE_SIZE,\r\nLDST_CLASS_IND_CCB |\r\nLDST_SRCDST_BYTE_OUTFIFO | LDST_IMM);\r\nappend_move(desc, MOVE_WAITCOMP | MOVE_SRC_OUTFIFO |\r\nMOVE_DEST_CLASS1CTX | (16 << MOVE_OFFSET_SHIFT) |\r\n(CTR_RFC3686_NONCE_SIZE << MOVE_LEN_SHIFT));\r\n}\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_seq_load(desc, ivsize, LDST_SRCDST_BYTE_CONTEXT |\r\nLDST_CLASS_1_CCB | (ctx1_iv_off << LDST_OFFSET_SHIFT));\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nif (ctx1_iv_off)\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_DECRYPT);\r\nelse\r\nappend_dec_op1(desc, cdata->algtype);\r\nablkcipher_append_src_dst(desc);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"ablkcipher dec shdesc@" __stringify(__LINE__)": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_ablkcipher_givencap(u32 * const desc, struct alginfo *cdata,\r\nunsigned int ivsize, const bool is_rfc3686,\r\nconst u32 ctx1_iv_off)\r\n{\r\nu32 *key_jump_cmd, geniv;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nif (is_rfc3686) {\r\nu8 *nonce = cdata->key_virt + cdata->keylen;\r\nappend_load_as_imm(desc, nonce, CTR_RFC3686_NONCE_SIZE,\r\nLDST_CLASS_IND_CCB |\r\nLDST_SRCDST_BYTE_OUTFIFO | LDST_IMM);\r\nappend_move(desc, MOVE_WAITCOMP | MOVE_SRC_OUTFIFO |\r\nMOVE_DEST_CLASS1CTX | (16 << MOVE_OFFSET_SHIFT) |\r\n(CTR_RFC3686_NONCE_SIZE << MOVE_LEN_SHIFT));\r\n}\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\ngeniv = NFIFOENTRY_STYPE_PAD | NFIFOENTRY_DEST_DECO |\r\nNFIFOENTRY_DTYPE_MSG | NFIFOENTRY_LC1 | NFIFOENTRY_PTYPE_RND |\r\n(ivsize << NFIFOENTRY_DLEN_SHIFT);\r\nappend_load_imm_u32(desc, geniv, LDST_CLASS_IND_CCB |\r\nLDST_SRCDST_WORD_INFO_FIFO | LDST_IMM);\r\nappend_cmd(desc, CMD_LOAD | DISABLE_AUTO_INFO_FIFO);\r\nappend_move(desc, MOVE_WAITCOMP | MOVE_SRC_INFIFO |\r\nMOVE_DEST_CLASS1CTX | (ivsize << MOVE_LEN_SHIFT) |\r\n(ctx1_iv_off << MOVE_OFFSET_SHIFT));\r\nappend_cmd(desc, CMD_LOAD | ENABLE_AUTO_INFO_FIFO);\r\nappend_seq_store(desc, ivsize, LDST_SRCDST_BYTE_CONTEXT |\r\nLDST_CLASS_1_CCB | (ctx1_iv_off << LDST_OFFSET_SHIFT));\r\nif (is_rfc3686)\r\nappend_load_imm_be32(desc, 1, LDST_IMM | LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n((ctx1_iv_off + CTR_RFC3686_IV_SIZE) <<\r\nLDST_OFFSET_SHIFT));\r\nif (ctx1_iv_off)\r\nappend_jump(desc, JUMP_JSL | JUMP_TEST_ALL | JUMP_COND_NCP |\r\n(1 << JUMP_OFFSET_SHIFT));\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nablkcipher_append_src_dst(desc);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"ablkcipher givenc shdesc@" __stringify(__LINE__) ": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_xts_ablkcipher_encap(u32 * const desc, struct alginfo *cdata)\r\n{\r\n__be64 sector_size = cpu_to_be64(512);\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nappend_load_as_imm(desc, (void *)&sector_size, 8, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n(0x28 << LDST_OFFSET_SHIFT));\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_seq_load(desc, 8, LDST_SRCDST_BYTE_CONTEXT | LDST_CLASS_1_CCB |\r\n(0x20 << LDST_OFFSET_SHIFT));\r\nappend_seq_fifo_load(desc, 8, FIFOLD_CLASS_SKIP);\r\nappend_operation(desc, cdata->algtype | OP_ALG_AS_INITFINAL |\r\nOP_ALG_ENCRYPT);\r\nablkcipher_append_src_dst(desc);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"xts ablkcipher enc shdesc@" __stringify(__LINE__) ": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}\r\nvoid cnstr_shdsc_xts_ablkcipher_decap(u32 * const desc, struct alginfo *cdata)\r\n{\r\n__be64 sector_size = cpu_to_be64(512);\r\nu32 *key_jump_cmd;\r\ninit_sh_desc(desc, HDR_SHARE_SERIAL | HDR_SAVECTX);\r\nkey_jump_cmd = append_jump(desc, JUMP_JSL | JUMP_TEST_ALL |\r\nJUMP_COND_SHRD);\r\nappend_key_as_imm(desc, cdata->key_virt, cdata->keylen,\r\ncdata->keylen, CLASS_1 | KEY_DEST_CLASS_REG);\r\nappend_load_as_imm(desc, (void *)&sector_size, 8, LDST_CLASS_1_CCB |\r\nLDST_SRCDST_BYTE_CONTEXT |\r\n(0x28 << LDST_OFFSET_SHIFT));\r\nset_jump_tgt_here(desc, key_jump_cmd);\r\nappend_seq_load(desc, 8, LDST_SRCDST_BYTE_CONTEXT | LDST_CLASS_1_CCB |\r\n(0x20 << LDST_OFFSET_SHIFT));\r\nappend_seq_fifo_load(desc, 8, FIFOLD_CLASS_SKIP);\r\nappend_dec_op1(desc, cdata->algtype);\r\nablkcipher_append_src_dst(desc);\r\n#ifdef DEBUG\r\nprint_hex_dump(KERN_ERR,\r\n"xts ablkcipher dec shdesc@" __stringify(__LINE__) ": ",\r\nDUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc), 1);\r\n#endif\r\n}
