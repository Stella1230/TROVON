static void sendbyte(struct l3_pins *adap, unsigned int byte)\r\n{\r\nint i;\r\nfor (i = 0; i < 8; i++) {\r\nadap->setclk(adap, 0);\r\nudelay(adap->data_hold);\r\nadap->setdat(adap, byte & 1);\r\nudelay(adap->data_setup);\r\nadap->setclk(adap, 1);\r\nudelay(adap->clock_high);\r\nbyte >>= 1;\r\n}\r\n}\r\nstatic void sendbytes(struct l3_pins *adap, const u8 *buf,\r\nint len)\r\n{\r\nint i;\r\nfor (i = 0; i < len; i++) {\r\nif (i) {\r\nudelay(adap->mode_hold);\r\nadap->setmode(adap, 0);\r\nudelay(adap->mode);\r\n}\r\nadap->setmode(adap, 1);\r\nudelay(adap->mode_setup);\r\nsendbyte(adap, buf[i]);\r\n}\r\n}\r\nint l3_write(struct l3_pins *adap, u8 addr, u8 *data, int len)\r\n{\r\nadap->setclk(adap, 1);\r\nadap->setdat(adap, 1);\r\nadap->setmode(adap, 1);\r\nudelay(adap->mode);\r\nadap->setmode(adap, 0);\r\nudelay(adap->mode_setup);\r\nsendbyte(adap, addr);\r\nudelay(adap->mode_hold);\r\nsendbytes(adap, data, len);\r\nadap->setclk(adap, 1);\r\nadap->setdat(adap, 1);\r\nadap->setmode(adap, 0);\r\nreturn len;\r\n}\r\nstatic void l3_set_clk(struct l3_pins *adap, int val)\r\n{\r\ngpio_set_value(adap->gpio_clk, val);\r\n}\r\nstatic void l3_set_data(struct l3_pins *adap, int val)\r\n{\r\ngpio_set_value(adap->gpio_data, val);\r\n}\r\nstatic void l3_set_mode(struct l3_pins *adap, int val)\r\n{\r\ngpio_set_value(adap->gpio_mode, val);\r\n}\r\nint l3_set_gpio_ops(struct device *dev, struct l3_pins *adap)\r\n{\r\nint ret;\r\nif (!adap->use_gpios)\r\nreturn -EINVAL;\r\nret = devm_gpio_request_one(dev, adap->gpio_data,\r\nGPIOF_OUT_INIT_LOW, "l3_data");\r\nif (ret < 0)\r\nreturn ret;\r\nadap->setdat = l3_set_data;\r\nret = devm_gpio_request_one(dev, adap->gpio_clk,\r\nGPIOF_OUT_INIT_LOW, "l3_clk");\r\nif (ret < 0)\r\nreturn ret;\r\nadap->setclk = l3_set_clk;\r\nret = devm_gpio_request_one(dev, adap->gpio_mode,\r\nGPIOF_OUT_INIT_LOW, "l3_mode");\r\nif (ret < 0)\r\nreturn ret;\r\nadap->setmode = l3_set_mode;\r\nreturn 0;\r\n}
