static void ide_4drives_init_dev(ide_drive_t *drive)\r\n{\r\nif (drive->hwif->channel)\r\ndrive->select ^= 0x20;\r\n}\r\nstatic int __init ide_4drives_init(void)\r\n{\r\nunsigned long base = 0x1f0, ctl = 0x3f6;\r\nstruct ide_hw hw, *hws[] = { &hw, &hw };\r\nif (probe_4drives == 0)\r\nreturn -ENODEV;\r\nif (!request_region(base, 8, DRV_NAME)) {\r\nprintk(KERN_ERR "%s: I/O resource 0x%lX-0x%lX not free.\n",\r\nDRV_NAME, base, base + 7);\r\nreturn -EBUSY;\r\n}\r\nif (!request_region(ctl, 1, DRV_NAME)) {\r\nprintk(KERN_ERR "%s: I/O resource 0x%lX not free.\n",\r\nDRV_NAME, ctl);\r\nrelease_region(base, 8);\r\nreturn -EBUSY;\r\n}\r\nmemset(&hw, 0, sizeof(hw));\r\nide_std_init_ports(&hw, base, ctl);\r\nhw.irq = 14;\r\nreturn ide_host_add(&ide_4drives_port_info, hws, 2, NULL);\r\n}
