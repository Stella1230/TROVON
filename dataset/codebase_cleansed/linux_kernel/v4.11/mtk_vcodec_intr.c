int mtk_vcodec_wait_for_done_ctx(struct mtk_vcodec_ctx *ctx, int command,\r\nunsigned int timeout_ms)\r\n{\r\nwait_queue_head_t *waitqueue;\r\nlong timeout_jiff, ret;\r\nint status = 0;\r\nwaitqueue = (wait_queue_head_t *)&ctx->queue;\r\ntimeout_jiff = msecs_to_jiffies(timeout_ms);\r\nret = wait_event_interruptible_timeout(*waitqueue,\r\nctx->int_cond,\r\ntimeout_jiff);\r\nif (!ret) {\r\nstatus = -1;\r\nmtk_v4l2_err("[%d] cmd=%d, ctx->type=%d, wait_event_interruptible_timeout time=%ums out %d %d!",\r\nctx->id, ctx->type, command, timeout_ms,\r\nctx->int_cond, ctx->int_type);\r\n} else if (-ERESTARTSYS == ret) {\r\nmtk_v4l2_err("[%d] cmd=%d, ctx->type=%d, wait_event_interruptible_timeout interrupted by a signal %d %d",\r\nctx->id, ctx->type, command, ctx->int_cond,\r\nctx->int_type);\r\nstatus = -1;\r\n}\r\nctx->int_cond = 0;\r\nctx->int_type = 0;\r\nreturn status;\r\n}
