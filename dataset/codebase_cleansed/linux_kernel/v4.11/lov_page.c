static int lov_raid0_page_print(const struct lu_env *env,\r\nconst struct cl_page_slice *slice,\r\nvoid *cookie, lu_printer_t printer)\r\n{\r\nstruct lov_page *lp = cl2lov_page(slice);\r\nreturn (*printer)(env, cookie, LUSTRE_LOV_NAME "-page@%p, raid0\n", lp);\r\n}\r\nint lov_page_init_raid0(const struct lu_env *env, struct cl_object *obj,\r\nstruct cl_page *page, pgoff_t index)\r\n{\r\nstruct lov_object *loo = cl2lov(obj);\r\nstruct lov_layout_raid0 *r0 = lov_r0(loo);\r\nstruct lov_io *lio = lov_env_io(env);\r\nstruct cl_object *subobj;\r\nstruct cl_object *o;\r\nstruct lov_io_sub *sub;\r\nstruct lov_page *lpg = cl_object_page_slice(obj, page);\r\nloff_t offset;\r\nu64 suboff;\r\nint stripe;\r\nint rc;\r\noffset = cl_offset(obj, index);\r\nstripe = lov_stripe_number(loo->lo_lsm, offset);\r\nLASSERT(stripe < r0->lo_nr);\r\nrc = lov_stripe_offset(loo->lo_lsm, offset, stripe, &suboff);\r\nLASSERT(rc == 0);\r\nlpg->lps_stripe = stripe;\r\ncl_page_slice_add(page, &lpg->lps_cl, obj, index, &lov_raid0_page_ops);\r\nsub = lov_sub_get(env, lio, stripe);\r\nif (IS_ERR(sub))\r\nreturn PTR_ERR(sub);\r\nsubobj = lovsub2cl(r0->lo_sub[stripe]);\r\nlist_for_each_entry(o, &subobj->co_lu.lo_header->loh_layers,\r\nco_lu.lo_linkage) {\r\nif (o->co_ops->coo_page_init) {\r\nrc = o->co_ops->coo_page_init(sub->sub_env, o, page,\r\ncl_index(subobj, suboff));\r\nif (rc != 0)\r\nbreak;\r\n}\r\n}\r\nlov_sub_put(sub);\r\nreturn rc;\r\n}\r\nstatic int lov_empty_page_print(const struct lu_env *env,\r\nconst struct cl_page_slice *slice,\r\nvoid *cookie, lu_printer_t printer)\r\n{\r\nstruct lov_page *lp = cl2lov_page(slice);\r\nreturn (*printer)(env, cookie, LUSTRE_LOV_NAME "-page@%p, empty.\n",\r\nlp);\r\n}\r\nint lov_page_init_empty(const struct lu_env *env, struct cl_object *obj,\r\nstruct cl_page *page, pgoff_t index)\r\n{\r\nstruct lov_page *lpg = cl_object_page_slice(obj, page);\r\nvoid *addr;\r\ncl_page_slice_add(page, &lpg->lps_cl, obj, index, &lov_empty_page_ops);\r\naddr = kmap(page->cp_vmpage);\r\nmemset(addr, 0, cl_page_size(obj));\r\nkunmap(page->cp_vmpage);\r\ncl_page_export(env, page, 1);\r\nreturn 0;\r\n}
