bool cpc_ffh_supported(void)\r\n{\r\nreturn true;\r\n}\r\nint cpc_read_ffh(int cpunum, struct cpc_reg *reg, u64 *val)\r\n{\r\nint err;\r\nerr = rdmsrl_safe_on_cpu(cpunum, reg->address, val);\r\nif (!err) {\r\nu64 mask = GENMASK_ULL(reg->bit_offset + reg->bit_width - 1,\r\nreg->bit_offset);\r\n*val &= mask;\r\n*val >>= reg->bit_offset;\r\n}\r\nreturn err;\r\n}\r\nint cpc_write_ffh(int cpunum, struct cpc_reg *reg, u64 val)\r\n{\r\nu64 rd_val;\r\nint err;\r\nerr = rdmsrl_safe_on_cpu(cpunum, reg->address, &rd_val);\r\nif (!err) {\r\nu64 mask = GENMASK_ULL(reg->bit_offset + reg->bit_width - 1,\r\nreg->bit_offset);\r\nval <<= reg->bit_offset;\r\nval &= mask;\r\nrd_val &= ~mask;\r\nrd_val |= val;\r\nerr = wrmsrl_safe_on_cpu(cpunum, reg->address, rd_val);\r\n}\r\nreturn err;\r\n}
