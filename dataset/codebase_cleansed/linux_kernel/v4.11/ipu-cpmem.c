static inline struct ipu_ch_param __iomem *\r\nipu_get_cpmem(struct ipuv3_channel *ch)\r\n{\r\nstruct ipu_cpmem *cpmem = ch->ipu->cpmem_priv;\r\nreturn cpmem->base + ch->num;\r\n}\r\nstatic void ipu_ch_param_write_field(struct ipuv3_channel *ch, u32 wbs, u32 v)\r\n{\r\nstruct ipu_ch_param __iomem *base = ipu_get_cpmem(ch);\r\nu32 bit = (wbs >> 8) % 160;\r\nu32 size = wbs & 0xff;\r\nu32 word = (wbs >> 8) / 160;\r\nu32 i = bit / 32;\r\nu32 ofs = bit % 32;\r\nu32 mask = (1 << size) - 1;\r\nu32 val;\r\npr_debug("%s %d %d %d\n", __func__, word, bit , size);\r\nval = readl(&base->word[word].data[i]);\r\nval &= ~(mask << ofs);\r\nval |= v << ofs;\r\nwritel(val, &base->word[word].data[i]);\r\nif ((bit + size - 1) / 32 > i) {\r\nval = readl(&base->word[word].data[i + 1]);\r\nval &= ~(mask >> (ofs ? (32 - ofs) : 0));\r\nval |= v >> (ofs ? (32 - ofs) : 0);\r\nwritel(val, &base->word[word].data[i + 1]);\r\n}\r\n}\r\nstatic u32 ipu_ch_param_read_field(struct ipuv3_channel *ch, u32 wbs)\r\n{\r\nstruct ipu_ch_param __iomem *base = ipu_get_cpmem(ch);\r\nu32 bit = (wbs >> 8) % 160;\r\nu32 size = wbs & 0xff;\r\nu32 word = (wbs >> 8) / 160;\r\nu32 i = bit / 32;\r\nu32 ofs = bit % 32;\r\nu32 mask = (1 << size) - 1;\r\nu32 val = 0;\r\npr_debug("%s %d %d %d\n", __func__, word, bit , size);\r\nval = (readl(&base->word[word].data[i]) >> ofs) & mask;\r\nif ((bit + size - 1) / 32 > i) {\r\nu32 tmp;\r\ntmp = readl(&base->word[word].data[i + 1]);\r\ntmp &= mask >> (ofs ? (32 - ofs) : 0);\r\nval |= tmp << (ofs ? (32 - ofs) : 0);\r\n}\r\nreturn val;\r\n}\r\nstatic int v4l2_pix_fmt_to_drm_fourcc(u32 pixelformat)\r\n{\r\nswitch (pixelformat) {\r\ncase V4L2_PIX_FMT_RGB565:\r\nreturn DRM_FORMAT_RGB565;\r\ncase V4L2_PIX_FMT_BGR24:\r\nreturn DRM_FORMAT_RGB888;\r\ncase V4L2_PIX_FMT_RGB24:\r\nreturn DRM_FORMAT_BGR888;\r\ncase V4L2_PIX_FMT_BGR32:\r\nreturn DRM_FORMAT_XRGB8888;\r\ncase V4L2_PIX_FMT_RGB32:\r\nreturn DRM_FORMAT_XBGR8888;\r\ncase V4L2_PIX_FMT_UYVY:\r\nreturn DRM_FORMAT_UYVY;\r\ncase V4L2_PIX_FMT_YUYV:\r\nreturn DRM_FORMAT_YUYV;\r\ncase V4L2_PIX_FMT_YUV420:\r\nreturn DRM_FORMAT_YUV420;\r\ncase V4L2_PIX_FMT_YUV422P:\r\nreturn DRM_FORMAT_YUV422;\r\ncase V4L2_PIX_FMT_YVU420:\r\nreturn DRM_FORMAT_YVU420;\r\ncase V4L2_PIX_FMT_NV12:\r\nreturn DRM_FORMAT_NV12;\r\ncase V4L2_PIX_FMT_NV16:\r\nreturn DRM_FORMAT_NV16;\r\n}\r\nreturn -EINVAL;\r\n}\r\nvoid ipu_cpmem_zero(struct ipuv3_channel *ch)\r\n{\r\nstruct ipu_ch_param __iomem *p = ipu_get_cpmem(ch);\r\nvoid __iomem *base = p;\r\nint i;\r\nfor (i = 0; i < sizeof(*p) / sizeof(u32); i++)\r\nwritel(0, base + i * sizeof(u32));\r\n}\r\nvoid ipu_cpmem_set_resolution(struct ipuv3_channel *ch, int xres, int yres)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_FW, xres - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_FH, yres - 1);\r\n}\r\nvoid ipu_cpmem_set_stride(struct ipuv3_channel *ch, int stride)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_SLY, stride - 1);\r\n}\r\nvoid ipu_cpmem_set_high_priority(struct ipuv3_channel *ch)\r\n{\r\nstruct ipu_soc *ipu = ch->ipu;\r\nu32 val;\r\nif (ipu->ipu_type == IPUV3EX)\r\nipu_ch_param_write_field(ch, IPU_FIELD_ID, 1);\r\nval = ipu_idmac_read(ipu, IDMAC_CHA_PRI(ch->num));\r\nval |= 1 << (ch->num % 32);\r\nipu_idmac_write(ipu, val, IDMAC_CHA_PRI(ch->num));\r\n}\r\nvoid ipu_cpmem_set_buffer(struct ipuv3_channel *ch, int bufnum, dma_addr_t buf)\r\n{\r\nif (bufnum)\r\nipu_ch_param_write_field(ch, IPU_FIELD_EBA1, buf >> 3);\r\nelse\r\nipu_ch_param_write_field(ch, IPU_FIELD_EBA0, buf >> 3);\r\n}\r\nvoid ipu_cpmem_set_uv_offset(struct ipuv3_channel *ch, u32 u_off, u32 v_off)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_UBO, u_off / 8);\r\nipu_ch_param_write_field(ch, IPU_FIELD_VBO, v_off / 8);\r\n}\r\nvoid ipu_cpmem_interlaced_scan(struct ipuv3_channel *ch, int stride)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_SO, 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_ILO, stride / 8);\r\nipu_ch_param_write_field(ch, IPU_FIELD_SLY, (stride * 2) - 1);\r\n}\r\nvoid ipu_cpmem_set_axi_id(struct ipuv3_channel *ch, u32 id)\r\n{\r\nid &= 0x3;\r\nipu_ch_param_write_field(ch, IPU_FIELD_ID, id);\r\n}\r\nint ipu_cpmem_get_burstsize(struct ipuv3_channel *ch)\r\n{\r\nreturn ipu_ch_param_read_field(ch, IPU_FIELD_NPB) + 1;\r\n}\r\nvoid ipu_cpmem_set_burstsize(struct ipuv3_channel *ch, int burstsize)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, burstsize - 1);\r\n}\r\nvoid ipu_cpmem_set_block_mode(struct ipuv3_channel *ch)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_BM, 1);\r\n}\r\nvoid ipu_cpmem_set_rotation(struct ipuv3_channel *ch,\r\nenum ipu_rotate_mode rot)\r\n{\r\nu32 temp_rot = bitrev8(rot) >> 5;\r\nipu_ch_param_write_field(ch, IPU_FIELD_ROT_HF_VF, temp_rot);\r\n}\r\nint ipu_cpmem_set_format_rgb(struct ipuv3_channel *ch,\r\nconst struct ipu_rgb *rgb)\r\n{\r\nint bpp = 0, npb = 0, ro, go, bo, to;\r\nro = rgb->bits_per_pixel - rgb->red.length - rgb->red.offset;\r\ngo = rgb->bits_per_pixel - rgb->green.length - rgb->green.offset;\r\nbo = rgb->bits_per_pixel - rgb->blue.length - rgb->blue.offset;\r\nto = rgb->bits_per_pixel - rgb->transp.length - rgb->transp.offset;\r\nipu_ch_param_write_field(ch, IPU_FIELD_WID0, rgb->red.length - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_OFS0, ro);\r\nipu_ch_param_write_field(ch, IPU_FIELD_WID1, rgb->green.length - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_OFS1, go);\r\nipu_ch_param_write_field(ch, IPU_FIELD_WID2, rgb->blue.length - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_OFS2, bo);\r\nif (rgb->transp.length) {\r\nipu_ch_param_write_field(ch, IPU_FIELD_WID3,\r\nrgb->transp.length - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_OFS3, to);\r\n} else {\r\nipu_ch_param_write_field(ch, IPU_FIELD_WID3, 7);\r\nipu_ch_param_write_field(ch, IPU_FIELD_OFS3,\r\nrgb->bits_per_pixel);\r\n}\r\nswitch (rgb->bits_per_pixel) {\r\ncase 32:\r\nbpp = 0;\r\nnpb = 15;\r\nbreak;\r\ncase 24:\r\nbpp = 1;\r\nnpb = 19;\r\nbreak;\r\ncase 16:\r\nbpp = 3;\r\nnpb = 31;\r\nbreak;\r\ncase 8:\r\nbpp = 5;\r\nnpb = 63;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, bpp);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, npb);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 7);\r\nreturn 0;\r\n}\r\nint ipu_cpmem_set_format_passthrough(struct ipuv3_channel *ch, int width)\r\n{\r\nint bpp = 0, npb = 0;\r\nswitch (width) {\r\ncase 32:\r\nbpp = 0;\r\nnpb = 15;\r\nbreak;\r\ncase 24:\r\nbpp = 1;\r\nnpb = 19;\r\nbreak;\r\ncase 16:\r\nbpp = 3;\r\nnpb = 31;\r\nbreak;\r\ncase 8:\r\nbpp = 5;\r\nnpb = 63;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, bpp);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, npb);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 6);\r\nreturn 0;\r\n}\r\nvoid ipu_cpmem_set_yuv_interleaved(struct ipuv3_channel *ch, u32 pixel_format)\r\n{\r\nswitch (pixel_format) {\r\ncase V4L2_PIX_FMT_UYVY:\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, 3);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 0xA);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase V4L2_PIX_FMT_YUYV:\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, 3);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 0x8);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\n}\r\n}\r\nvoid ipu_cpmem_set_yuv_planar_full(struct ipuv3_channel *ch,\r\nunsigned int uv_stride,\r\nunsigned int u_offset, unsigned int v_offset)\r\n{\r\nipu_ch_param_write_field(ch, IPU_FIELD_SLUV, uv_stride - 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_UBO, u_offset / 8);\r\nipu_ch_param_write_field(ch, IPU_FIELD_VBO, v_offset / 8);\r\n}\r\nint ipu_cpmem_set_fmt(struct ipuv3_channel *ch, u32 drm_fourcc)\r\n{\r\nswitch (drm_fourcc) {\r\ncase DRM_FORMAT_YUV420:\r\ncase DRM_FORMAT_YVU420:\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 2);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_YUV422:\r\ncase DRM_FORMAT_YVU422:\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 1);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_YUV444:\r\ncase DRM_FORMAT_YVU444:\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 0);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_NV12:\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 4);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_NV16:\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 3);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_UYVY:\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, 3);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 0xA);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_YUYV:\r\nipu_ch_param_write_field(ch, IPU_FIELD_BPP, 3);\r\nipu_ch_param_write_field(ch, IPU_FIELD_PFS, 0x8);\r\nipu_ch_param_write_field(ch, IPU_FIELD_NPB, 31);\r\nbreak;\r\ncase DRM_FORMAT_ABGR8888:\r\ncase DRM_FORMAT_XBGR8888:\r\nipu_cpmem_set_format_rgb(ch, &def_xbgr_32);\r\nbreak;\r\ncase DRM_FORMAT_ARGB8888:\r\ncase DRM_FORMAT_XRGB8888:\r\nipu_cpmem_set_format_rgb(ch, &def_xrgb_32);\r\nbreak;\r\ncase DRM_FORMAT_RGBA8888:\r\ncase DRM_FORMAT_RGBX8888:\r\nipu_cpmem_set_format_rgb(ch, &def_rgbx_32);\r\nbreak;\r\ncase DRM_FORMAT_BGRA8888:\r\ncase DRM_FORMAT_BGRX8888:\r\nipu_cpmem_set_format_rgb(ch, &def_bgrx_32);\r\nbreak;\r\ncase DRM_FORMAT_BGR888:\r\nipu_cpmem_set_format_rgb(ch, &def_bgr_24);\r\nbreak;\r\ncase DRM_FORMAT_RGB888:\r\nipu_cpmem_set_format_rgb(ch, &def_rgb_24);\r\nbreak;\r\ncase DRM_FORMAT_RGB565:\r\nipu_cpmem_set_format_rgb(ch, &def_rgb_16);\r\nbreak;\r\ncase DRM_FORMAT_BGR565:\r\nipu_cpmem_set_format_rgb(ch, &def_bgr_16);\r\nbreak;\r\ncase DRM_FORMAT_ARGB1555:\r\nipu_cpmem_set_format_rgb(ch, &def_argb_16);\r\nbreak;\r\ncase DRM_FORMAT_ABGR1555:\r\nipu_cpmem_set_format_rgb(ch, &def_abgr_16);\r\nbreak;\r\ncase DRM_FORMAT_RGBA5551:\r\nipu_cpmem_set_format_rgb(ch, &def_rgba_16);\r\nbreak;\r\ncase DRM_FORMAT_BGRA5551:\r\nipu_cpmem_set_format_rgb(ch, &def_bgra_16);\r\nbreak;\r\ncase DRM_FORMAT_ARGB4444:\r\nipu_cpmem_set_format_rgb(ch, &def_argb_16_4444);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nint ipu_cpmem_set_image(struct ipuv3_channel *ch, struct ipu_image *image)\r\n{\r\nstruct v4l2_pix_format *pix = &image->pix;\r\nint offset, u_offset, v_offset;\r\npr_debug("%s: resolution: %dx%d stride: %d\n",\r\n__func__, pix->width, pix->height,\r\npix->bytesperline);\r\nipu_cpmem_set_resolution(ch, image->rect.width, image->rect.height);\r\nipu_cpmem_set_stride(ch, pix->bytesperline);\r\nipu_cpmem_set_fmt(ch, v4l2_pix_fmt_to_drm_fourcc(pix->pixelformat));\r\nswitch (pix->pixelformat) {\r\ncase V4L2_PIX_FMT_YUV420:\r\noffset = Y_OFFSET(pix, image->rect.left, image->rect.top);\r\nu_offset = U_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nv_offset = V_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nipu_cpmem_set_yuv_planar_full(ch, pix->bytesperline / 2,\r\nu_offset, v_offset);\r\nbreak;\r\ncase V4L2_PIX_FMT_YVU420:\r\noffset = Y_OFFSET(pix, image->rect.left, image->rect.top);\r\nu_offset = U_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nv_offset = V_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nipu_cpmem_set_yuv_planar_full(ch, pix->bytesperline / 2,\r\nv_offset, u_offset);\r\nbreak;\r\ncase V4L2_PIX_FMT_YUV422P:\r\noffset = Y_OFFSET(pix, image->rect.left, image->rect.top);\r\nu_offset = U2_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nv_offset = V2_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nipu_cpmem_set_yuv_planar_full(ch, pix->bytesperline / 2,\r\nu_offset, v_offset);\r\nbreak;\r\ncase V4L2_PIX_FMT_NV12:\r\noffset = Y_OFFSET(pix, image->rect.left, image->rect.top);\r\nu_offset = UV_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nv_offset = 0;\r\nipu_cpmem_set_yuv_planar_full(ch, pix->bytesperline,\r\nu_offset, v_offset);\r\nbreak;\r\ncase V4L2_PIX_FMT_NV16:\r\noffset = Y_OFFSET(pix, image->rect.left, image->rect.top);\r\nu_offset = UV2_OFFSET(pix, image->rect.left,\r\nimage->rect.top) - offset;\r\nv_offset = 0;\r\nipu_cpmem_set_yuv_planar_full(ch, pix->bytesperline,\r\nu_offset, v_offset);\r\nbreak;\r\ncase V4L2_PIX_FMT_UYVY:\r\ncase V4L2_PIX_FMT_YUYV:\r\ncase V4L2_PIX_FMT_RGB565:\r\noffset = image->rect.left * 2 +\r\nimage->rect.top * pix->bytesperline;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB32:\r\ncase V4L2_PIX_FMT_BGR32:\r\noffset = image->rect.left * 4 +\r\nimage->rect.top * pix->bytesperline;\r\nbreak;\r\ncase V4L2_PIX_FMT_RGB24:\r\ncase V4L2_PIX_FMT_BGR24:\r\noffset = image->rect.left * 3 +\r\nimage->rect.top * pix->bytesperline;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nipu_cpmem_set_buffer(ch, 0, image->phys0 + offset);\r\nipu_cpmem_set_buffer(ch, 1, image->phys1 + offset);\r\nreturn 0;\r\n}\r\nvoid ipu_cpmem_dump(struct ipuv3_channel *ch)\r\n{\r\nstruct ipu_ch_param __iomem *p = ipu_get_cpmem(ch);\r\nstruct ipu_soc *ipu = ch->ipu;\r\nint chno = ch->num;\r\ndev_dbg(ipu->dev, "ch %d word 0 - %08X %08X %08X %08X %08X\n", chno,\r\nreadl(&p->word[0].data[0]),\r\nreadl(&p->word[0].data[1]),\r\nreadl(&p->word[0].data[2]),\r\nreadl(&p->word[0].data[3]),\r\nreadl(&p->word[0].data[4]));\r\ndev_dbg(ipu->dev, "ch %d word 1 - %08X %08X %08X %08X %08X\n", chno,\r\nreadl(&p->word[1].data[0]),\r\nreadl(&p->word[1].data[1]),\r\nreadl(&p->word[1].data[2]),\r\nreadl(&p->word[1].data[3]),\r\nreadl(&p->word[1].data[4]));\r\ndev_dbg(ipu->dev, "PFS 0x%x, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_PFS));\r\ndev_dbg(ipu->dev, "BPP 0x%x, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_BPP));\r\ndev_dbg(ipu->dev, "NPB 0x%x\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_NPB));\r\ndev_dbg(ipu->dev, "FW %d, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_FW));\r\ndev_dbg(ipu->dev, "FH %d, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_FH));\r\ndev_dbg(ipu->dev, "EBA0 0x%x\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_EBA0) << 3);\r\ndev_dbg(ipu->dev, "EBA1 0x%x\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_EBA1) << 3);\r\ndev_dbg(ipu->dev, "Stride %d\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_SL));\r\ndev_dbg(ipu->dev, "scan_order %d\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_SO));\r\ndev_dbg(ipu->dev, "uv_stride %d\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_SLUV));\r\ndev_dbg(ipu->dev, "u_offset 0x%x\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_UBO) << 3);\r\ndev_dbg(ipu->dev, "v_offset 0x%x\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_VBO) << 3);\r\ndev_dbg(ipu->dev, "Width0 %d+1, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_WID0));\r\ndev_dbg(ipu->dev, "Width1 %d+1, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_WID1));\r\ndev_dbg(ipu->dev, "Width2 %d+1, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_WID2));\r\ndev_dbg(ipu->dev, "Width3 %d+1, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_WID3));\r\ndev_dbg(ipu->dev, "Offset0 %d, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_OFS0));\r\ndev_dbg(ipu->dev, "Offset1 %d, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_OFS1));\r\ndev_dbg(ipu->dev, "Offset2 %d, ",\r\nipu_ch_param_read_field(ch, IPU_FIELD_OFS2));\r\ndev_dbg(ipu->dev, "Offset3 %d\n",\r\nipu_ch_param_read_field(ch, IPU_FIELD_OFS3));\r\n}\r\nint ipu_cpmem_init(struct ipu_soc *ipu, struct device *dev, unsigned long base)\r\n{\r\nstruct ipu_cpmem *cpmem;\r\ncpmem = devm_kzalloc(dev, sizeof(*cpmem), GFP_KERNEL);\r\nif (!cpmem)\r\nreturn -ENOMEM;\r\nipu->cpmem_priv = cpmem;\r\nspin_lock_init(&cpmem->lock);\r\ncpmem->base = devm_ioremap(dev, base, SZ_128K);\r\nif (!cpmem->base)\r\nreturn -ENOMEM;\r\ndev_dbg(dev, "CPMEM base: 0x%08lx remapped to %p\n",\r\nbase, cpmem->base);\r\ncpmem->ipu = ipu;\r\nreturn 0;\r\n}\r\nvoid ipu_cpmem_exit(struct ipu_soc *ipu)\r\n{\r\n}
