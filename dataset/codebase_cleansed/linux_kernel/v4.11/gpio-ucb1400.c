static int ucb1400_gpio_dir_in(struct gpio_chip *gc, unsigned off)\r\n{\r\nstruct ucb1400_gpio *gpio;\r\ngpio = gpiochip_get_data(gc);\r\nucb1400_gpio_set_direction(gpio->ac97, off, 0);\r\nreturn 0;\r\n}\r\nstatic int ucb1400_gpio_dir_out(struct gpio_chip *gc, unsigned off, int val)\r\n{\r\nstruct ucb1400_gpio *gpio;\r\ngpio = gpiochip_get_data(gc);\r\nucb1400_gpio_set_direction(gpio->ac97, off, 1);\r\nucb1400_gpio_set_value(gpio->ac97, off, val);\r\nreturn 0;\r\n}\r\nstatic int ucb1400_gpio_get(struct gpio_chip *gc, unsigned off)\r\n{\r\nstruct ucb1400_gpio *gpio;\r\ngpio = gpiochip_get_data(gc);\r\nreturn !!ucb1400_gpio_get_value(gpio->ac97, off);\r\n}\r\nstatic void ucb1400_gpio_set(struct gpio_chip *gc, unsigned off, int val)\r\n{\r\nstruct ucb1400_gpio *gpio;\r\ngpio = gpiochip_get_data(gc);\r\nucb1400_gpio_set_value(gpio->ac97, off, val);\r\n}\r\nstatic int ucb1400_gpio_probe(struct platform_device *dev)\r\n{\r\nstruct ucb1400_gpio *ucb = dev_get_platdata(&dev->dev);\r\nint err = 0;\r\nif (!(ucb && ucb->gpio_offset)) {\r\nerr = -EINVAL;\r\ngoto err;\r\n}\r\nplatform_set_drvdata(dev, ucb);\r\nucb->gc.label = "ucb1400_gpio";\r\nucb->gc.base = ucb->gpio_offset;\r\nucb->gc.ngpio = 10;\r\nucb->gc.owner = THIS_MODULE;\r\nucb->gc.direction_input = ucb1400_gpio_dir_in;\r\nucb->gc.direction_output = ucb1400_gpio_dir_out;\r\nucb->gc.get = ucb1400_gpio_get;\r\nucb->gc.set = ucb1400_gpio_set;\r\nucb->gc.can_sleep = true;\r\nerr = devm_gpiochip_add_data(&dev->dev, &ucb->gc, ucb);\r\nif (err)\r\ngoto err;\r\nif (ucb->gpio_setup)\r\nerr = ucb->gpio_setup(&dev->dev, ucb->gc.ngpio);\r\nerr:\r\nreturn err;\r\n}\r\nstatic int ucb1400_gpio_remove(struct platform_device *dev)\r\n{\r\nint err = 0;\r\nstruct ucb1400_gpio *ucb = platform_get_drvdata(dev);\r\nif (ucb && ucb->gpio_teardown) {\r\nerr = ucb->gpio_teardown(&dev->dev, ucb->gc.ngpio);\r\nif (err)\r\nreturn err;\r\n}\r\nreturn err;\r\n}
