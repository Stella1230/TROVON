static int em_nbyte_change(struct net *net, void *data, int data_len,\r\nstruct tcf_ematch *em)\r\n{\r\nstruct tcf_em_nbyte *nbyte = data;\r\nif (data_len < sizeof(*nbyte) ||\r\ndata_len < (sizeof(*nbyte) + nbyte->len))\r\nreturn -EINVAL;\r\nem->datalen = sizeof(*nbyte) + nbyte->len;\r\nem->data = (unsigned long)kmemdup(data, em->datalen, GFP_KERNEL);\r\nif (em->data == 0UL)\r\nreturn -ENOBUFS;\r\nreturn 0;\r\n}\r\nstatic int em_nbyte_match(struct sk_buff *skb, struct tcf_ematch *em,\r\nstruct tcf_pkt_info *info)\r\n{\r\nstruct nbyte_data *nbyte = (struct nbyte_data *) em->data;\r\nunsigned char *ptr = tcf_get_base_ptr(skb, nbyte->hdr.layer);\r\nptr += nbyte->hdr.off;\r\nif (!tcf_valid_offset(skb, ptr, nbyte->hdr.len))\r\nreturn 0;\r\nreturn !memcmp(ptr + nbyte->hdr.off, nbyte->pattern, nbyte->hdr.len);\r\n}\r\nstatic int __init init_em_nbyte(void)\r\n{\r\nreturn tcf_em_register(&em_nbyte_ops);\r\n}\r\nstatic void __exit exit_em_nbyte(void)\r\n{\r\ntcf_em_unregister(&em_nbyte_ops);\r\n}
