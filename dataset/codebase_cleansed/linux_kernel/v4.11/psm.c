int psm_get_ui_state(struct pp_eventmgr *eventmgr, enum PP_StateUILabel ui_label, unsigned long *state_id)\r\n{\r\nstruct pp_power_state *state;\r\nint table_entries;\r\nstruct pp_hwmgr *hwmgr = eventmgr->hwmgr;\r\nint i;\r\ntable_entries = hwmgr->num_ps;\r\nstate = hwmgr->ps;\r\nfor (i = 0; i < table_entries; i++) {\r\nif (state->classification.ui_label & ui_label) {\r\n*state_id = state->id;\r\nreturn 0;\r\n}\r\nstate = (struct pp_power_state *)((unsigned long)state + hwmgr->ps_size);\r\n}\r\nreturn -1;\r\n}\r\nint psm_get_state_by_classification(struct pp_eventmgr *eventmgr, enum PP_StateClassificationFlag flag, unsigned long *state_id)\r\n{\r\nstruct pp_power_state *state;\r\nint table_entries;\r\nstruct pp_hwmgr *hwmgr = eventmgr->hwmgr;\r\nint i;\r\ntable_entries = hwmgr->num_ps;\r\nstate = hwmgr->ps;\r\nfor (i = 0; i < table_entries; i++) {\r\nif (state->classification.flags & flag) {\r\n*state_id = state->id;\r\nreturn 0;\r\n}\r\nstate = (struct pp_power_state *)((unsigned long)state + hwmgr->ps_size);\r\n}\r\nreturn -1;\r\n}\r\nint psm_set_states(struct pp_eventmgr *eventmgr, unsigned long *state_id)\r\n{\r\nstruct pp_power_state *state;\r\nint table_entries;\r\nstruct pp_hwmgr *hwmgr = eventmgr->hwmgr;\r\nint i;\r\ntable_entries = hwmgr->num_ps;\r\nstate = hwmgr->ps;\r\nfor (i = 0; i < table_entries; i++) {\r\nif (state->id == *state_id) {\r\nmemcpy(hwmgr->request_ps, state, hwmgr->ps_size);\r\nreturn 0;\r\n}\r\nstate = (struct pp_power_state *)((unsigned long)state + hwmgr->ps_size);\r\n}\r\nreturn -1;\r\n}\r\nint psm_adjust_power_state_dynamic(struct pp_eventmgr *eventmgr, bool skip)\r\n{\r\nstruct pp_power_state *pcurrent;\r\nstruct pp_power_state *requested;\r\nstruct pp_hwmgr *hwmgr;\r\nbool equal;\r\nif (skip)\r\nreturn 0;\r\nhwmgr = eventmgr->hwmgr;\r\npcurrent = hwmgr->current_ps;\r\nrequested = hwmgr->request_ps;\r\nif (requested == NULL)\r\nreturn 0;\r\nphm_apply_state_adjust_rules(hwmgr, requested, pcurrent);\r\nif (pcurrent == NULL || (0 != phm_check_states_equal(hwmgr, &pcurrent->hardware, &requested->hardware, &equal)))\r\nequal = false;\r\nif (!equal || phm_check_smc_update_required_for_display_configuration(hwmgr)) {\r\nphm_set_power_state(hwmgr, &pcurrent->hardware, &requested->hardware);\r\nmemcpy(hwmgr->current_ps, hwmgr->request_ps, hwmgr->ps_size);\r\n}\r\nreturn 0;\r\n}\r\nint psm_adjust_power_state_static(struct pp_eventmgr *eventmgr, bool skip)\r\n{\r\nreturn 0;\r\n}
