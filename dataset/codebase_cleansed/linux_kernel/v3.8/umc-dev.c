static void umc_device_release(struct device *dev)\r\n{\r\nstruct umc_dev *umc = to_umc_dev(dev);\r\nkfree(umc);\r\n}\r\nstruct umc_dev *umc_device_create(struct device *parent, int n)\r\n{\r\nstruct umc_dev *umc;\r\numc = kzalloc(sizeof(struct umc_dev), GFP_KERNEL);\r\nif (umc) {\r\ndev_set_name(&umc->dev, "%s-%d", dev_name(parent), n);\r\numc->dev.parent = parent;\r\numc->dev.bus = &umc_bus_type;\r\numc->dev.release = umc_device_release;\r\numc->dev.dma_mask = parent->dma_mask;\r\n}\r\nreturn umc;\r\n}\r\nint umc_device_register(struct umc_dev *umc)\r\n{\r\nint err;\r\nerr = request_resource(umc->resource.parent, &umc->resource);\r\nif (err < 0) {\r\ndev_err(&umc->dev, "can't allocate resource range %pR: %d\n",\r\n&umc->resource, err);\r\ngoto error_request_resource;\r\n}\r\nerr = device_register(&umc->dev);\r\nif (err < 0)\r\ngoto error_device_register;\r\nreturn 0;\r\nerror_device_register:\r\nrelease_resource(&umc->resource);\r\nerror_request_resource:\r\nreturn err;\r\n}\r\nvoid umc_device_unregister(struct umc_dev *umc)\r\n{\r\nstruct device *dev;\r\nif (!umc)\r\nreturn;\r\ndev = get_device(&umc->dev);\r\ndevice_unregister(&umc->dev);\r\nrelease_resource(&umc->resource);\r\nput_device(dev);\r\n}
