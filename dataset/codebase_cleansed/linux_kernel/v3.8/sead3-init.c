char *prom_getenv(char *envname)\r\n{\r\nint i, index = 0;\r\ni = strlen(envname);\r\nwhile (prom_envp(index)) {\r\nif (strncmp(envname, prom_envp(index), i) == 0)\r\nreturn prom_envp(index+1);\r\nindex += 2;\r\n}\r\nreturn NULL;\r\n}\r\nstatic void __init mips_nmi_setup(void)\r\n{\r\nvoid *base;\r\nbase = cpu_has_veic ?\r\n(void *)(CAC_BASE + 0xa80) :\r\n(void *)(CAC_BASE + 0x380);\r\nmemcpy(base, &except_vec_nmi, 0x80);\r\nflush_icache_range((unsigned long)base, (unsigned long)base + 0x80);\r\n}\r\nstatic void __init mips_ejtag_setup(void)\r\n{\r\nvoid *base;\r\nbase = cpu_has_veic ?\r\n(void *)(CAC_BASE + 0xa00) :\r\n(void *)(CAC_BASE + 0x300);\r\nmemcpy(base, &except_vec_ejtag_debug, 0x80);\r\nflush_icache_range((unsigned long)base, (unsigned long)base + 0x80);\r\n}\r\nvoid __init prom_init(void)\r\n{\r\nprom_argc = fw_arg0;\r\n_prom_argv = (int *) fw_arg1;\r\n_prom_envp = (int *) fw_arg2;\r\nboard_nmi_handler_setup = mips_nmi_setup;\r\nboard_ejtag_handler_setup = mips_ejtag_setup;\r\nprom_init_cmdline();\r\nprom_meminit();\r\n#ifdef CONFIG_EARLY_PRINTK\r\nif ((strstr(prom_getcmdline(), "console=ttyS0")) != NULL)\r\nprom_init_early_console(0);\r\nelse if ((strstr(prom_getcmdline(), "console=ttyS1")) != NULL)\r\nprom_init_early_console(1);\r\n#endif\r\n#ifdef CONFIG_SERIAL_8250_CONSOLE\r\nif ((strstr(prom_getcmdline(), "console=")) == NULL)\r\nstrcat(prom_getcmdline(), " console=ttyS0,38400n8r");\r\n#endif\r\n}
