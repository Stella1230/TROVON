void ignore_sigwinch_sig(void)\r\n{\r\nsignal(SIGWINCH, SIG_IGN);\r\n}\r\nint start_io_thread(unsigned long sp, int *fd_out)\r\n{\r\nint pid, fds[2], err;\r\nerr = os_pipe(fds, 1, 1);\r\nif(err < 0){\r\nprintk("start_io_thread - os_pipe failed, err = %d\n", -err);\r\ngoto out;\r\n}\r\nkernel_fd = fds[0];\r\n*fd_out = fds[1];\r\nerr = os_set_fd_block(*fd_out, 0);\r\nif (err) {\r\nprintk("start_io_thread - failed to set nonblocking I/O.\n");\r\ngoto out_close;\r\n}\r\npid = clone(io_thread, (void *) sp, CLONE_FILES | CLONE_VM, NULL);\r\nif(pid < 0){\r\nerr = -errno;\r\nprintk("start_io_thread - clone failed : errno = %d\n", errno);\r\ngoto out_close;\r\n}\r\nreturn(pid);\r\nout_close:\r\nos_close_file(fds[0]);\r\nos_close_file(fds[1]);\r\nkernel_fd = -1;\r\n*fd_out = -1;\r\nout:\r\nreturn err;\r\n}
