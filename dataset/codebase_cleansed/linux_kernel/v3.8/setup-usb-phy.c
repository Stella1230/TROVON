static int s5pv210_usb_otgphy_init(struct platform_device *pdev)\r\n{\r\nstruct clk *xusbxti;\r\nu32 phyclk;\r\nwritel(readl(S5PV210_USB_PHY_CON) | S5PV210_USB_PHY0_EN,\r\nS5PV210_USB_PHY_CON);\r\nphyclk = readl(S3C_PHYCLK) & ~S3C_PHYCLK_CLKSEL_MASK;\r\nxusbxti = clk_get(&pdev->dev, "xusbxti");\r\nif (xusbxti && !IS_ERR(xusbxti)) {\r\nswitch (clk_get_rate(xusbxti)) {\r\ncase 12 * MHZ:\r\nphyclk |= S3C_PHYCLK_CLKSEL_12M;\r\nbreak;\r\ncase 24 * MHZ:\r\nphyclk |= S3C_PHYCLK_CLKSEL_24M;\r\nbreak;\r\ndefault:\r\ncase 48 * MHZ:\r\nbreak;\r\n}\r\nclk_put(xusbxti);\r\n}\r\nwritel(phyclk | S3C_PHYCLK_CLK_FORCE, S3C_PHYCLK);\r\nwritel((readl(S3C_PHYPWR) & ~S3C_PHYPWR_NORMAL_MASK), S3C_PHYPWR);\r\nmdelay(1);\r\nwritel(S3C_RSTCON_PHY | S3C_RSTCON_HCLK | S3C_RSTCON_PHYCLK,\r\nS3C_RSTCON);\r\nudelay(20);\r\nwritel(0, S3C_RSTCON);\r\nreturn 0;\r\n}\r\nstatic int s5pv210_usb_otgphy_exit(struct platform_device *pdev)\r\n{\r\nwritel((readl(S3C_PHYPWR) | S3C_PHYPWR_ANALOG_POWERDOWN |\r\nS3C_PHYPWR_OTG_DISABLE), S3C_PHYPWR);\r\nwritel(readl(S5PV210_USB_PHY_CON) & ~S5PV210_USB_PHY0_EN,\r\nS5PV210_USB_PHY_CON);\r\nreturn 0;\r\n}\r\nint s5p_usb_phy_init(struct platform_device *pdev, int type)\r\n{\r\nif (type == S5P_USB_PHY_DEVICE)\r\nreturn s5pv210_usb_otgphy_init(pdev);\r\nreturn -EINVAL;\r\n}\r\nint s5p_usb_phy_exit(struct platform_device *pdev, int type)\r\n{\r\nif (type == S5P_USB_PHY_DEVICE)\r\nreturn s5pv210_usb_otgphy_exit(pdev);\r\nreturn -EINVAL;\r\n}
