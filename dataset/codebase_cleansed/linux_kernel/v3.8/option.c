static inline int\r\nstrncasecmpz(const char *str, const char *cmp, size_t len)\r\n{\r\nif (strlen(cmp) != len)\r\nreturn len;\r\nreturn strncasecmp(str, cmp, len);\r\n}\r\nconst char *\r\nnouveau_stropt(const char *optstr, const char *opt, int *arglen)\r\n{\r\nwhile (optstr && *optstr != '\0') {\r\nint len = strcspn(optstr, ",=");\r\nswitch (optstr[len]) {\r\ncase '=':\r\nif (!strncasecmpz(optstr, opt, len)) {\r\noptstr += len + 1;\r\n*arglen = strcspn(optstr, ",=");\r\nreturn *arglen ? optstr : NULL;\r\n}\r\noptstr++;\r\nbreak;\r\ncase ',':\r\noptstr++;\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\noptstr += len;\r\n}\r\nreturn NULL;\r\n}\r\nbool\r\nnouveau_boolopt(const char *optstr, const char *opt, bool value)\r\n{\r\nint arglen;\r\noptstr = nouveau_stropt(optstr, opt, &arglen);\r\nif (optstr) {\r\nif (!strncasecmpz(optstr, "0", arglen) ||\r\n!strncasecmpz(optstr, "no", arglen) ||\r\n!strncasecmpz(optstr, "off", arglen) ||\r\n!strncasecmpz(optstr, "false", arglen))\r\nvalue = false;\r\nelse\r\nif (!strncasecmpz(optstr, "1", arglen) ||\r\n!strncasecmpz(optstr, "yes", arglen) ||\r\n!strncasecmpz(optstr, "on", arglen) ||\r\n!strncasecmpz(optstr, "true", arglen))\r\nvalue = true;\r\n}\r\nreturn value;\r\n}\r\nint\r\nnouveau_dbgopt(const char *optstr, const char *sub)\r\n{\r\nint mode = 1, level = CONFIG_NOUVEAU_DEBUG_DEFAULT;\r\nwhile (optstr) {\r\nint len = strcspn(optstr, ",=");\r\nswitch (optstr[len]) {\r\ncase '=':\r\nif (strncasecmpz(optstr, sub, len))\r\nmode = 0;\r\noptstr++;\r\nbreak;\r\ndefault:\r\nif (mode) {\r\nif (!strncasecmpz(optstr, "fatal", len))\r\nlevel = NV_DBG_FATAL;\r\nelse if (!strncasecmpz(optstr, "error", len))\r\nlevel = NV_DBG_ERROR;\r\nelse if (!strncasecmpz(optstr, "warn", len))\r\nlevel = NV_DBG_WARN;\r\nelse if (!strncasecmpz(optstr, "info", len))\r\nlevel = NV_DBG_INFO;\r\nelse if (!strncasecmpz(optstr, "debug", len))\r\nlevel = NV_DBG_DEBUG;\r\nelse if (!strncasecmpz(optstr, "trace", len))\r\nlevel = NV_DBG_TRACE;\r\nelse if (!strncasecmpz(optstr, "paranoia", len))\r\nlevel = NV_DBG_PARANOIA;\r\nelse if (!strncasecmpz(optstr, "spam", len))\r\nlevel = NV_DBG_SPAM;\r\n}\r\nif (optstr[len] != '\0') {\r\noptstr++;\r\nmode = 1;\r\nbreak;\r\n}\r\nreturn level;\r\n}\r\noptstr += len;\r\n}\r\nreturn level;\r\n}
