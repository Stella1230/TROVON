static void raid6_2data_recov_intx1(int disks, size_t bytes, int faila,\r\nint failb, void **ptrs)\r\n{\r\nu8 *p, *q, *dp, *dq;\r\nu8 px, qx, db;\r\nconst u8 *pbmul;\r\nconst u8 *qmul;\r\np = (u8 *)ptrs[disks-2];\r\nq = (u8 *)ptrs[disks-1];\r\ndp = (u8 *)ptrs[faila];\r\nptrs[faila] = (void *)raid6_empty_zero_page;\r\nptrs[disks-2] = dp;\r\ndq = (u8 *)ptrs[failb];\r\nptrs[failb] = (void *)raid6_empty_zero_page;\r\nptrs[disks-1] = dq;\r\nraid6_call.gen_syndrome(disks, bytes, ptrs);\r\nptrs[faila] = dp;\r\nptrs[failb] = dq;\r\nptrs[disks-2] = p;\r\nptrs[disks-1] = q;\r\npbmul = raid6_gfmul[raid6_gfexi[failb-faila]];\r\nqmul = raid6_gfmul[raid6_gfinv[raid6_gfexp[faila]^raid6_gfexp[failb]]];\r\nwhile ( bytes-- ) {\r\npx = *p ^ *dp;\r\nqx = qmul[*q ^ *dq];\r\n*dq++ = db = pbmul[px] ^ qx;\r\n*dp++ = db ^ px;\r\np++; q++;\r\n}\r\n}\r\nstatic void raid6_datap_recov_intx1(int disks, size_t bytes, int faila,\r\nvoid **ptrs)\r\n{\r\nu8 *p, *q, *dq;\r\nconst u8 *qmul;\r\np = (u8 *)ptrs[disks-2];\r\nq = (u8 *)ptrs[disks-1];\r\ndq = (u8 *)ptrs[faila];\r\nptrs[faila] = (void *)raid6_empty_zero_page;\r\nptrs[disks-1] = dq;\r\nraid6_call.gen_syndrome(disks, bytes, ptrs);\r\nptrs[faila] = dq;\r\nptrs[disks-1] = q;\r\nqmul = raid6_gfmul[raid6_gfinv[raid6_gfexp[faila]]];\r\nwhile ( bytes-- ) {\r\n*p++ ^= *dq = qmul[*q ^ *dq];\r\nq++; dq++;\r\n}\r\n}\r\nvoid raid6_dual_recov(int disks, size_t bytes, int faila, int failb, void **ptrs)\r\n{\r\nif ( faila > failb ) {\r\nint tmp = faila;\r\nfaila = failb;\r\nfailb = tmp;\r\n}\r\nif ( failb == disks-1 ) {\r\nif ( faila == disks-2 ) {\r\nraid6_call.gen_syndrome(disks, bytes, ptrs);\r\n} else {\r\n}\r\n} else {\r\nif ( failb == disks-2 ) {\r\nraid6_datap_recov(disks, bytes, faila, ptrs);\r\n} else {\r\nraid6_2data_recov(disks, bytes, faila, failb, ptrs);\r\n}\r\n}\r\n}
