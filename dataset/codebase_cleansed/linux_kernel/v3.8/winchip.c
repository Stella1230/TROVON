static void winchip_machine_check(struct pt_regs *regs, long error_code)\r\n{\r\nprintk(KERN_EMERG "CPU0: Machine Check Exception.\n");\r\nadd_taint(TAINT_MACHINE_CHECK);\r\n}\r\nvoid winchip_mcheck_init(struct cpuinfo_x86 *c)\r\n{\r\nu32 lo, hi;\r\nmachine_check_vector = winchip_machine_check;\r\nwmb();\r\nrdmsr(MSR_IDT_FCR1, lo, hi);\r\nlo |= (1<<2);\r\nlo &= ~(1<<4);\r\nwrmsr(MSR_IDT_FCR1, lo, hi);\r\nset_in_cr4(X86_CR4_MCE);\r\nprintk(KERN_INFO\r\n"Winchip machine check reporting enabled on CPU#0.\n");\r\n}
