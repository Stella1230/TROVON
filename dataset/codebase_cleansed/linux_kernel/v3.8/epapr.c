static void platform_fixups(void)\r\n{\r\nif ((epapr_magic != EPAPR_EMAGIC)\r\n&& (epapr_magic != EPAPR_SMAGIC))\r\nfatal("r6 contained 0x%08x instead of ePAPR magic number\n",\r\nepapr_magic);\r\nif (ima_size < (unsigned long)_end)\r\nprintf("WARNING: Image loaded outside IMA!"\r\n" (_end=%p, ima_size=0x%lx)\n", _end, ima_size);\r\nif (ima_size < fdt_addr)\r\nprintf("WARNING: Device tree address is outside IMA!"\r\n"(fdt_addr=0x%lx, ima_size=0x%lx)\n", fdt_addr,\r\nima_size);\r\nif (ima_size < fdt_addr + fdt_totalsize((void *)fdt_addr))\r\nprintf("WARNING: Device tree extends outside IMA!"\r\n" (fdt_addr=0x%lx, size=0x%x, ima_size=0x%lx\n",\r\nfdt_addr, fdt_totalsize((void *)fdt_addr), ima_size);\r\n}\r\nvoid platform_init(unsigned long r3, unsigned long r4, unsigned long r5,\r\nunsigned long r6, unsigned long r7)\r\n{\r\nepapr_magic = r6;\r\nima_size = r7;\r\nfdt_addr = r3;\r\nsimple_alloc_init(_end, ima_size - (unsigned long)_end, 32, 64);\r\nfdt_init((void *)fdt_addr);\r\nserial_console_init();\r\nplatform_ops.fixups = platform_fixups;\r\n}
