static int og_pci_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nif (machine_is_im4004() && (slot == 8))\r\nreturn KS8695_IRQ_EXTERN1;\r\nreturn KS8695_IRQ_EXTERN0;\r\n}\r\nstatic void __init og_register_pci(void)\r\n{\r\nks8695_gpio_interrupt(KS8695_GPIO_0, IRQ_TYPE_LEVEL_LOW);\r\nif (machine_is_im4004())\r\nks8695_gpio_interrupt(KS8695_GPIO_1, IRQ_TYPE_LEVEL_LOW);\r\nks8695_init_pci(&og_pci);\r\n}\r\nstatic void __init og_pci_bus_reset(void)\r\n{\r\nunsigned int rstline = 1;\r\nif (machine_is_im4004())\r\nrstline = 2;\r\nelse if (machine_is_im42xx())\r\nrstline = 0;\r\ngpio_request(rstline, "PCI reset");\r\ngpio_direction_output(rstline, 0);\r\ngpio_set_value(rstline, 1);\r\ngpio_set_value(rstline, 0);\r\nmdelay(100);\r\ngpio_set_value(rstline, 1);\r\nmdelay(100);\r\n}\r\nstatic void __init og_init(void)\r\n{\r\nks8695_register_gpios();\r\nif (machine_is_cm4002()) {\r\nks8695_gpio_interrupt(KS8695_GPIO_1, IRQ_TYPE_LEVEL_HIGH);\r\niotable_init(og_io_desc, ARRAY_SIZE(og_io_desc));\r\nplatform_add_devices(og_devices, ARRAY_SIZE(og_devices));\r\n} else {\r\nog_pci_bus_reset();\r\nog_register_pci();\r\n}\r\nks8695_add_device_lan();\r\nks8695_add_device_wan();\r\n}
