static __u8 *ps3remote_fixup(struct hid_device *hdev, __u8 *rdesc,\r\nunsigned int *rsize)\r\n{\r\n*rsize = sizeof(ps3remote_rdesc);\r\nreturn ps3remote_rdesc;\r\n}\r\nstatic int ps3remote_mapping(struct hid_device *hdev, struct hid_input *hi,\r\nstruct hid_field *field, struct hid_usage *usage,\r\nunsigned long **bit, int *max)\r\n{\r\nunsigned int key = usage->hid & HID_USAGE;\r\nif ((usage->hid & HID_USAGE_PAGE) != HID_UP_BUTTON)\r\nreturn -1;\r\nswitch (usage->collection_index) {\r\ncase 1:\r\nif (key >= ARRAY_SIZE(ps3remote_keymap_joypad_buttons))\r\nreturn -1;\r\nkey = ps3remote_keymap_joypad_buttons[key];\r\nif (!key)\r\nreturn -1;\r\nbreak;\r\ncase 2:\r\nif (key >= ARRAY_SIZE(ps3remote_keymap_remote_buttons))\r\nreturn -1;\r\nkey = ps3remote_keymap_remote_buttons[key];\r\nif (!key)\r\nreturn -1;\r\nbreak;\r\ndefault:\r\nreturn -1;\r\n}\r\nhid_map_usage_clear(hi, usage, bit, max, EV_KEY, key);\r\nreturn 1;\r\n}\r\nstatic int __init ps3remote_init(void)\r\n{\r\nreturn hid_register_driver(&ps3remote_driver);\r\n}\r\nstatic void __exit ps3remote_exit(void)\r\n{\r\nhid_unregister_driver(&ps3remote_driver);\r\n}
