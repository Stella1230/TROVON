static void __init init_ioports(void)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(mpc866ads_pins); i++) {\r\nstruct cpm_pin *pin = &mpc866ads_pins[i];\r\ncpm1_set_pin(pin->port, pin->pin, pin->flags);\r\n}\r\ncpm1_clk_setup(CPM_CLK_SMC1, CPM_BRG1, CPM_CLK_RTX);\r\ncpm1_clk_setup(CPM_CLK_SMC2, CPM_BRG2, CPM_CLK_RTX);\r\ncpm1_clk_setup(CPM_CLK_SCC1, CPM_CLK1, CPM_CLK_TX);\r\ncpm1_clk_setup(CPM_CLK_SCC1, CPM_CLK2, CPM_CLK_RX);\r\nclrbits32(&mpc8xx_immr->im_cpm.cp_cptr, 0x00000180);\r\n}\r\nstatic void __init mpc86xads_setup_arch(void)\r\n{\r\nstruct device_node *np;\r\nu32 __iomem *bcsr_io;\r\ncpm_reset();\r\ninit_ioports();\r\nnp = of_find_compatible_node(NULL, NULL, "fsl,mpc866ads-bcsr");\r\nif (!np) {\r\nprintk(KERN_CRIT "Could not find fsl,mpc866ads-bcsr node\n");\r\nreturn;\r\n}\r\nbcsr_io = of_iomap(np, 0);\r\nof_node_put(np);\r\nif (bcsr_io == NULL) {\r\nprintk(KERN_CRIT "Could not remap BCSR\n");\r\nreturn;\r\n}\r\nclrbits32(bcsr_io, BCSR1_RS232EN_1 | BCSR1_RS232EN_2 | BCSR1_ETHEN);\r\niounmap(bcsr_io);\r\n}\r\nstatic int __init mpc86xads_probe(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nreturn of_flat_dt_is_compatible(root, "fsl,mpc866ads");\r\n}\r\nstatic int __init declare_of_platform_devices(void)\r\n{\r\nof_platform_bus_probe(NULL, of_bus_ids, NULL);\r\nreturn 0;\r\n}
