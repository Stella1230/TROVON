static int initialize_gpio(int gpio, char *desc)\r\n{\r\nint ret;\r\nret = gpio_request(gpio, desc);\r\nif (ret < 0) {\r\npr_err_ratelimited("cannot open %s gpio\n", desc);\r\nreturn -ENOSYS;\r\n}\r\ngpio_direction_input(gpio);\r\nreturn gpio;\r\n}\r\nstatic int mmc_get_cd(int index)\r\n{\r\nstatic int gpio;\r\nif (!gpio)\r\ngpio = initialize_gpio(EVM_MMC_CD_GPIO, "mmc card detect");\r\nif (gpio < 0)\r\nreturn gpio;\r\nreturn gpio_get_value(gpio) ? 0 : 1;\r\n}\r\nstatic int mmc_get_ro(int index)\r\n{\r\nstatic int gpio;\r\nif (!gpio)\r\ngpio = initialize_gpio(EVM_MMC_WP_GPIO, "mmc write protect");\r\nif (gpio < 0)\r\nreturn gpio;\r\nreturn gpio_get_value(gpio) ? 1 : 0;\r\n}\r\nstatic void spi_select_device(int cs)\r\n{\r\nstatic int gpio;\r\nif (!gpio) {\r\nint ret;\r\nret = gpio_request(EVM_SPI_CS_GPIO, "spi chipsel");\r\nif (ret < 0) {\r\npr_err("cannot open spi chipsel gpio\n");\r\ngpio = -ENOSYS;\r\nreturn;\r\n} else {\r\ngpio = EVM_SPI_CS_GPIO;\r\ngpio_direction_output(gpio, 0);\r\n}\r\n}\r\nif (gpio < 0)\r\nreturn;\r\nreturn gpio_set_value(gpio, cs ? 1 : 0);\r\n}\r\nstatic __init void tnetv107x_evm_board_init(void)\r\n{\r\ndavinci_cfg_reg_list(sdio1_pins);\r\ndavinci_cfg_reg_list(uart1_pins);\r\ndavinci_cfg_reg_list(ssp_pins);\r\ntnetv107x_devices_init(&evm_device_info);\r\nspi_register_board_info(spi_info, ARRAY_SIZE(spi_info));\r\n}\r\nstatic int __init tnetv107x_evm_console_init(void)\r\n{\r\nreturn add_preferred_console("ttyS", 0, "115200");\r\n}
