static __u8 *waltop_report_fixup(struct hid_device *hdev, __u8 *rdesc,\r\nunsigned int *rsize)\r\n{\r\nswitch (hdev->product) {\r\ncase USB_DEVICE_ID_WALTOP_SLIM_TABLET_5_8_INCH:\r\nif (*rsize == SLIM_TABLET_5_8_INCH_RDESC_ORIG_SIZE) {\r\nrdesc = slim_tablet_5_8_inch_rdesc_fixed;\r\n*rsize = sizeof(slim_tablet_5_8_inch_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_SLIM_TABLET_12_1_INCH:\r\nif (*rsize == SLIM_TABLET_12_1_INCH_RDESC_ORIG_SIZE) {\r\nrdesc = slim_tablet_12_1_inch_rdesc_fixed;\r\n*rsize = sizeof(slim_tablet_12_1_inch_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_Q_PAD:\r\nif (*rsize == Q_PAD_RDESC_ORIG_SIZE) {\r\nrdesc = q_pad_rdesc_fixed;\r\n*rsize = sizeof(q_pad_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_PID_0038:\r\nif (*rsize == PID_0038_RDESC_ORIG_SIZE) {\r\nrdesc = pid_0038_rdesc_fixed;\r\n*rsize = sizeof(pid_0038_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_MEDIA_TABLET_10_6_INCH:\r\nif (*rsize == MEDIA_TABLET_10_6_INCH_RDESC_ORIG_SIZE) {\r\nrdesc = media_tablet_10_6_inch_rdesc_fixed;\r\n*rsize = sizeof(media_tablet_10_6_inch_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_MEDIA_TABLET_14_1_INCH:\r\nif (*rsize == MEDIA_TABLET_14_1_INCH_RDESC_ORIG_SIZE) {\r\nrdesc = media_tablet_14_1_inch_rdesc_fixed;\r\n*rsize = sizeof(media_tablet_14_1_inch_rdesc_fixed);\r\n}\r\nbreak;\r\ncase USB_DEVICE_ID_WALTOP_SIRIUS_BATTERY_FREE_TABLET:\r\nif (*rsize == SIRIUS_BATTERY_FREE_TABLET_RDESC_ORIG_SIZE) {\r\nrdesc = sirius_battery_free_tablet_rdesc_fixed;\r\n*rsize = sizeof(sirius_battery_free_tablet_rdesc_fixed);\r\n}\r\nbreak;\r\n}\r\nreturn rdesc;\r\n}\r\nstatic int waltop_raw_event(struct hid_device *hdev, struct hid_report *report,\r\nu8 *data, int size)\r\n{\r\nif (report->type == HID_INPUT_REPORT && report->id == 16 && size >= 8) {\r\nif ((data[1] & 0xF) > 1) {\r\ndata[6] = 0;\r\ndata[7] = 0;\r\n}\r\n}\r\nif (hdev->product == USB_DEVICE_ID_WALTOP_SIRIUS_BATTERY_FREE_TABLET &&\r\nreport->type == HID_INPUT_REPORT &&\r\nreport->id == 16 &&\r\nsize == 10) {\r\nstatic const s8 tilt_to_radians[] = {\r\n0, 5, 10, 14, 19, 24, 29, 34, 40, 45,\r\n50, 56, 62, 68, 74, 81, 88, 96, 105\r\n};\r\ns8 tilt_x = (s8)data[8];\r\ns8 tilt_y = (s8)data[9];\r\ns8 sign_x = tilt_x >= 0 ? 1 : -1;\r\ns8 sign_y = tilt_y >= 0 ? 1 : -1;\r\ntilt_x *= sign_x;\r\ntilt_y *= sign_y;\r\nsign_y *= -1;\r\nif (tilt_x > ARRAY_SIZE(tilt_to_radians) - 1)\r\ntilt_x = ARRAY_SIZE(tilt_to_radians) - 1;\r\nif (tilt_y > ARRAY_SIZE(tilt_to_radians) - 1)\r\ntilt_y = ARRAY_SIZE(tilt_to_radians) - 1;\r\ndata[8] = tilt_to_radians[tilt_x] * sign_x;\r\ndata[9] = tilt_to_radians[tilt_y] * sign_y;\r\n}\r\nreturn 0;\r\n}\r\nstatic int __init waltop_init(void)\r\n{\r\nreturn hid_register_driver(&waltop_driver);\r\n}\r\nstatic void __exit waltop_exit(void)\r\n{\r\nhid_unregister_driver(&waltop_driver);\r\n}
