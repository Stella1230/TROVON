void\r\nwext_send_assoc_event(unifi_priv_t *priv, unsigned char *bssid,\r\nunsigned char *req_ie, int req_ie_len,\r\nunsigned char *resp_ie, int resp_ie_len,\r\nunsigned char *scan_ie, unsigned int scan_ie_len)\r\n{\r\n#if WIRELESS_EXT > 17\r\nunion iwreq_data wrqu;\r\nif (req_ie_len == 0) req_ie = NULL;\r\nwrqu.data.length = req_ie_len;\r\nwrqu.data.flags = 0;\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], IWEVASSOCREQIE, &wrqu, req_ie);\r\nif (resp_ie_len == 0) resp_ie = NULL;\r\nwrqu.data.length = resp_ie_len;\r\nwrqu.data.flags = 0;\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], IWEVASSOCRESPIE, &wrqu, resp_ie);\r\nif (scan_ie_len > 0) {\r\nwrqu.data.length = scan_ie_len;\r\nwrqu.data.flags = 0;\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], IWEVGENIE, &wrqu, scan_ie);\r\n}\r\nmemcpy(&wrqu.ap_addr.sa_data, bssid, ETH_ALEN);\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], SIOCGIWAP, &wrqu, NULL);\r\n#endif\r\n}\r\nvoid\r\nwext_send_disassoc_event(unifi_priv_t *priv)\r\n{\r\n#if WIRELESS_EXT > 17\r\nunion iwreq_data wrqu;\r\nmemset(wrqu.ap_addr.sa_data, 0, ETH_ALEN);\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], SIOCGIWAP, &wrqu, NULL);\r\n#endif\r\n}\r\nvoid\r\nwext_send_scan_results_event(unifi_priv_t *priv)\r\n{\r\n#if WIRELESS_EXT > 17\r\nunion iwreq_data wrqu;\r\nwrqu.data.length = 0;\r\nwrqu.data.flags = 0;\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], SIOCGIWSCAN, &wrqu, NULL);\r\n#endif\r\n}\r\nstatic inline void\r\n_send_michaelmicfailure_event(struct net_device *dev,\r\nint count, const unsigned char *macaddr,\r\nint key_type, int key_idx,\r\nunsigned char *tsc)\r\n{\r\nunion iwreq_data wrqu;\r\nstruct iw_michaelmicfailure mmf;\r\nmemset(&mmf, 0, sizeof(mmf));\r\nmmf.flags = key_idx & IW_MICFAILURE_KEY_ID;\r\nif (key_type == CSR_GROUP) {\r\nmmf.flags |= IW_MICFAILURE_GROUP;\r\n} else {\r\nmmf.flags |= IW_MICFAILURE_PAIRWISE;\r\n}\r\nmmf.flags |= ((count << 5) & IW_MICFAILURE_COUNT);\r\nmmf.src_addr.sa_family = ARPHRD_ETHER;\r\nmemcpy(mmf.src_addr.sa_data, macaddr, ETH_ALEN);\r\nmemcpy(mmf.tsc, tsc, IW_ENCODE_SEQ_MAX_SIZE);\r\nmemset(&wrqu, 0, sizeof(wrqu));\r\nwrqu.data.length = sizeof(mmf);\r\nwireless_send_event(dev, IWEVMICHAELMICFAILURE, &wrqu, (char *)&mmf);\r\n}\r\nstatic inline void\r\n_send_michaelmicfailure_event(struct net_device *dev,\r\nint count, const unsigned char *macaddr,\r\nint key_type, int key_idx,\r\nunsigned char *tsc)\r\n{\r\nunion iwreq_data wrqu;\r\nchar buf[128];\r\nsprintf(buf,\r\n"MLME-MICHAELMICFAILURE.indication(keyid=%d %scast addr=%pM)",\r\nkey_idx, (key_type == CSR_GROUP) ? "broad" : "uni", macaddr);\r\nmemset(&wrqu, 0, sizeof(wrqu));\r\nwrqu.data.length = strlen(buf);\r\nwireless_send_event(dev, IWEVCUSTOM, &wrqu, buf);\r\n}\r\nstatic inline void\r\n_send_michaelmicfailure_event(struct net_device *dev,\r\nint count, const unsigned char *macaddr,\r\nint key_type, int key_idx,\r\nunsigned char *tsc)\r\n{\r\n}\r\nvoid\r\nwext_send_michaelmicfailure_event(unifi_priv_t *priv,\r\nu16 count,\r\nCsrWifiMacAddress address,\r\nCsrWifiSmeKeyType keyType,\r\nu16 interfaceTag)\r\n{\r\nunsigned char tsc[8] = {0};\r\nif (interfaceTag >= CSR_WIFI_NUM_INTERFACES) {\r\nunifi_error(priv, "wext_send_michaelmicfailure_event bad interfaceTag\n");\r\nreturn;\r\n}\r\n_send_michaelmicfailure_event(priv->netdev[interfaceTag],\r\ncount,\r\naddress.a,\r\nkeyType,\r\n0,\r\ntsc);\r\n}\r\nvoid\r\nwext_send_pmkid_candidate_event(unifi_priv_t *priv, CsrWifiMacAddress bssid, u8 preauth_allowed, u16 interfaceTag)\r\n{\r\n#if WIRELESS_EXT > 17\r\nunion iwreq_data wrqu;\r\nstruct iw_pmkid_cand pmkid_cand;\r\nif (interfaceTag >= CSR_WIFI_NUM_INTERFACES) {\r\nunifi_error(priv, "wext_send_pmkid_candidate_event bad interfaceTag\n");\r\nreturn;\r\n}\r\nmemset(&pmkid_cand, 0, sizeof(pmkid_cand));\r\nif (preauth_allowed) {\r\npmkid_cand.flags |= IW_PMKID_CAND_PREAUTH;\r\n}\r\npmkid_cand.bssid.sa_family = ARPHRD_ETHER;\r\nmemcpy(pmkid_cand.bssid.sa_data, bssid.a, ETH_ALEN);\r\npmkid_cand.index = 1;\r\nmemset(&wrqu, 0, sizeof(wrqu));\r\nwrqu.data.length = sizeof(pmkid_cand);\r\nwireless_send_event(priv->netdev[interfaceTag], IWEVPMKIDCAND, &wrqu, (char *)&pmkid_cand);\r\n#endif\r\n}\r\nvoid\r\nwext_send_started_event(unifi_priv_t *priv)\r\n{\r\n#if WIRELESS_EXT > 17\r\nunion iwreq_data wrqu;\r\nchar data[] = "STARTED";\r\nwrqu.data.length = sizeof(data);\r\nwrqu.data.flags = 0;\r\nwireless_send_event(priv->netdev[CSR_WIFI_INTERFACE_IN_USE], IWEVCUSTOM, &wrqu, data);\r\n#endif\r\n}
