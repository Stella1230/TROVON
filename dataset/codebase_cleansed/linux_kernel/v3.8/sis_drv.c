static int sis_driver_load(struct drm_device *dev, unsigned long chipset)\r\n{\r\ndrm_sis_private_t *dev_priv;\r\npci_set_master(dev->pdev);\r\ndev_priv = kzalloc(sizeof(drm_sis_private_t), GFP_KERNEL);\r\nif (dev_priv == NULL)\r\nreturn -ENOMEM;\r\nidr_init(&dev_priv->object_idr);\r\ndev->dev_private = (void *)dev_priv;\r\ndev_priv->chipset = chipset;\r\nreturn 0;\r\n}\r\nstatic int sis_driver_unload(struct drm_device *dev)\r\n{\r\ndrm_sis_private_t *dev_priv = dev->dev_private;\r\nidr_remove_all(&dev_priv->object_idr);\r\nidr_destroy(&dev_priv->object_idr);\r\nkfree(dev_priv);\r\nreturn 0;\r\n}\r\nstatic int sis_driver_open(struct drm_device *dev, struct drm_file *file)\r\n{\r\nstruct sis_file_private *file_priv;\r\nDRM_DEBUG_DRIVER("\n");\r\nfile_priv = kmalloc(sizeof(*file_priv), GFP_KERNEL);\r\nif (!file_priv)\r\nreturn -ENOMEM;\r\nfile->driver_priv = file_priv;\r\nINIT_LIST_HEAD(&file_priv->obj_list);\r\nreturn 0;\r\n}\r\nvoid sis_driver_postclose(struct drm_device *dev, struct drm_file *file)\r\n{\r\nstruct sis_file_private *file_priv = file->driver_priv;\r\nkfree(file_priv);\r\n}\r\nstatic int __init sis_init(void)\r\n{\r\ndriver.num_ioctls = sis_max_ioctl;\r\nreturn drm_pci_init(&driver, &sis_pci_driver);\r\n}\r\nstatic void __exit sis_exit(void)\r\n{\r\ndrm_pci_exit(&driver, &sis_pci_driver);\r\n}
