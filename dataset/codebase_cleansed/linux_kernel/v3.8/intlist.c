static struct rb_node *intlist__node_new(struct rblist *rblist __maybe_unused,\r\nconst void *entry)\r\n{\r\nint i = (int)((long)entry);\r\nstruct rb_node *rc = NULL;\r\nstruct int_node *node = malloc(sizeof(*node));\r\nif (node != NULL) {\r\nnode->i = i;\r\nrc = &node->rb_node;\r\n}\r\nreturn rc;\r\n}\r\nstatic void int_node__delete(struct int_node *ilist)\r\n{\r\nfree(ilist);\r\n}\r\nstatic void intlist__node_delete(struct rblist *rblist __maybe_unused,\r\nstruct rb_node *rb_node)\r\n{\r\nstruct int_node *node = container_of(rb_node, struct int_node, rb_node);\r\nint_node__delete(node);\r\n}\r\nstatic int intlist__node_cmp(struct rb_node *rb_node, const void *entry)\r\n{\r\nint i = (int)((long)entry);\r\nstruct int_node *node = container_of(rb_node, struct int_node, rb_node);\r\nreturn node->i - i;\r\n}\r\nint intlist__add(struct intlist *ilist, int i)\r\n{\r\nreturn rblist__add_node(&ilist->rblist, (void *)((long)i));\r\n}\r\nvoid intlist__remove(struct intlist *ilist, struct int_node *node)\r\n{\r\nrblist__remove_node(&ilist->rblist, &node->rb_node);\r\n}\r\nstruct int_node *intlist__find(struct intlist *ilist, int i)\r\n{\r\nstruct int_node *node = NULL;\r\nstruct rb_node *rb_node = rblist__find(&ilist->rblist, (void *)((long)i));\r\nif (rb_node)\r\nnode = container_of(rb_node, struct int_node, rb_node);\r\nreturn node;\r\n}\r\nstruct intlist *intlist__new(void)\r\n{\r\nstruct intlist *ilist = malloc(sizeof(*ilist));\r\nif (ilist != NULL) {\r\nrblist__init(&ilist->rblist);\r\nilist->rblist.node_cmp = intlist__node_cmp;\r\nilist->rblist.node_new = intlist__node_new;\r\nilist->rblist.node_delete = intlist__node_delete;\r\n}\r\nreturn ilist;\r\n}\r\nvoid intlist__delete(struct intlist *ilist)\r\n{\r\nif (ilist != NULL)\r\nrblist__delete(&ilist->rblist);\r\n}\r\nstruct int_node *intlist__entry(const struct intlist *ilist, unsigned int idx)\r\n{\r\nstruct int_node *node = NULL;\r\nstruct rb_node *rb_node;\r\nrb_node = rblist__entry(&ilist->rblist, idx);\r\nif (rb_node)\r\nnode = container_of(rb_node, struct int_node, rb_node);\r\nreturn node;\r\n}
