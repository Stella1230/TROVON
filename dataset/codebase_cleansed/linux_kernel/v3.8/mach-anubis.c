static void anubis_nand_select(struct s3c2410_nand_set *set, int slot)\r\n{\r\nunsigned int tmp;\r\nslot = set->nr_map[slot] & 3;\r\npr_debug("anubis_nand: selecting slot %d (set %p,%p)\n",\r\nslot, set, set->nr_map);\r\ntmp = __raw_readb(ANUBIS_VA_CTRL1);\r\ntmp &= ~ANUBIS_CTRL1_NANDSEL;\r\ntmp |= slot;\r\npr_debug("anubis_nand: ctrl1 now %02x\n", tmp);\r\n__raw_writeb(tmp, ANUBIS_VA_CTRL1);\r\n}\r\nstatic void __init anubis_map_io(void)\r\n{\r\ns3c24xx_dclk0.parent = &clk_upll;\r\ns3c24xx_dclk0.rate = 12*1000*1000;\r\ns3c24xx_dclk1.parent = &clk_upll;\r\ns3c24xx_dclk1.rate = 24*1000*1000;\r\ns3c24xx_clkout0.parent = &s3c24xx_dclk0;\r\ns3c24xx_clkout1.parent = &s3c24xx_dclk1;\r\ns3c24xx_uclk.parent = &s3c24xx_clkout1;\r\ns3c24xx_register_clocks(anubis_clocks, ARRAY_SIZE(anubis_clocks));\r\ns3c24xx_init_io(anubis_iodesc, ARRAY_SIZE(anubis_iodesc));\r\ns3c24xx_init_clocks(0);\r\ns3c24xx_init_uarts(anubis_uartcfgs, ARRAY_SIZE(anubis_uartcfgs));\r\nif ((__raw_readb(ANUBIS_VA_IDREG) & ANUBIS_IDREG_REVMASK) >= 4) {\r\nprintk(KERN_INFO "ANUBIS-B detected (revision %d)\n",\r\n__raw_readb(ANUBIS_VA_IDREG) & ANUBIS_IDREG_REVMASK);\r\nanubis_nand_sets[0].partitions = anubis_default_nand_part_large;\r\nanubis_nand_sets[0].nr_partitions = ARRAY_SIZE(anubis_default_nand_part_large);\r\n} else {\r\ngpio_request_one(S3C2410_GPA(0), GPIOF_OUT_INIT_HIGH, NULL);\r\ngpio_free(S3C2410_GPA(0));\r\n}\r\n}\r\nstatic void __init anubis_init(void)\r\n{\r\ns3c_i2c0_set_platdata(NULL);\r\ns3c_nand_set_platdata(&anubis_nand_info);\r\nsimtec_audio_add(NULL, false, &anubis_audio);\r\nplatform_add_devices(anubis_devices, ARRAY_SIZE(anubis_devices));\r\ni2c_register_board_info(0, anubis_i2c_devs,\r\nARRAY_SIZE(anubis_i2c_devs));\r\n}
