static void\r\nnf_tproxy_destructor(struct sk_buff *skb)\r\n{\r\nstruct sock *sk = skb->sk;\r\nskb->sk = NULL;\r\nskb->destructor = NULL;\r\nif (sk)\r\nsock_put(sk);\r\n}\r\nvoid\r\nnf_tproxy_assign_sock(struct sk_buff *skb, struct sock *sk)\r\n{\r\nif (sk->sk_state == TCP_TIME_WAIT) {\r\ninet_twsk_put(inet_twsk(sk));\r\nreturn;\r\n}\r\nskb_orphan(skb);\r\nskb->sk = sk;\r\nskb->destructor = nf_tproxy_destructor;\r\n}\r\nstatic int __init nf_tproxy_init(void)\r\n{\r\npr_info("NF_TPROXY: Transparent proxy support initialized, version 4.1.0\n");\r\npr_info("NF_TPROXY: Copyright (c) 2006-2007 BalaBit IT Ltd.\n");\r\nreturn 0;\r\n}
