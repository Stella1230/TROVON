static inline void ipi_flush_tlb_all(void *ignored)\r\n{\r\nlocal_flush_tlb_all();\r\n}\r\nstatic inline void ipi_flush_tlb_mm(void *arg)\r\n{\r\nstruct mm_struct *mm = (struct mm_struct *)arg;\r\nlocal_flush_tlb_mm(mm);\r\n}\r\nstatic inline void ipi_flush_tlb_page(void *arg)\r\n{\r\nstruct tlb_args *ta = (struct tlb_args *)arg;\r\nlocal_flush_tlb_page(ta->ta_vma, ta->ta_start);\r\n}\r\nstatic inline void ipi_flush_tlb_kernel_page(void *arg)\r\n{\r\nstruct tlb_args *ta = (struct tlb_args *)arg;\r\nlocal_flush_tlb_kernel_page(ta->ta_start);\r\n}\r\nstatic inline void ipi_flush_tlb_range(void *arg)\r\n{\r\nstruct tlb_args *ta = (struct tlb_args *)arg;\r\nlocal_flush_tlb_range(ta->ta_vma, ta->ta_start, ta->ta_end);\r\n}\r\nstatic inline void ipi_flush_tlb_kernel_range(void *arg)\r\n{\r\nstruct tlb_args *ta = (struct tlb_args *)arg;\r\nlocal_flush_tlb_kernel_range(ta->ta_start, ta->ta_end);\r\n}\r\nvoid flush_tlb_all(void)\r\n{\r\nif (tlb_ops_need_broadcast())\r\non_each_cpu(ipi_flush_tlb_all, NULL, 1);\r\nelse\r\nlocal_flush_tlb_all();\r\n}\r\nvoid flush_tlb_mm(struct mm_struct *mm)\r\n{\r\nif (tlb_ops_need_broadcast())\r\non_each_cpu_mask(mm_cpumask(mm), ipi_flush_tlb_mm, mm, 1);\r\nelse\r\nlocal_flush_tlb_mm(mm);\r\n}\r\nvoid flush_tlb_page(struct vm_area_struct *vma, unsigned long uaddr)\r\n{\r\nif (tlb_ops_need_broadcast()) {\r\nstruct tlb_args ta;\r\nta.ta_vma = vma;\r\nta.ta_start = uaddr;\r\non_each_cpu_mask(mm_cpumask(vma->vm_mm), ipi_flush_tlb_page,\r\n&ta, 1);\r\n} else\r\nlocal_flush_tlb_page(vma, uaddr);\r\n}\r\nvoid flush_tlb_kernel_page(unsigned long kaddr)\r\n{\r\nif (tlb_ops_need_broadcast()) {\r\nstruct tlb_args ta;\r\nta.ta_start = kaddr;\r\non_each_cpu(ipi_flush_tlb_kernel_page, &ta, 1);\r\n} else\r\nlocal_flush_tlb_kernel_page(kaddr);\r\n}\r\nvoid flush_tlb_range(struct vm_area_struct *vma,\r\nunsigned long start, unsigned long end)\r\n{\r\nif (tlb_ops_need_broadcast()) {\r\nstruct tlb_args ta;\r\nta.ta_vma = vma;\r\nta.ta_start = start;\r\nta.ta_end = end;\r\non_each_cpu_mask(mm_cpumask(vma->vm_mm), ipi_flush_tlb_range,\r\n&ta, 1);\r\n} else\r\nlocal_flush_tlb_range(vma, start, end);\r\n}\r\nvoid flush_tlb_kernel_range(unsigned long start, unsigned long end)\r\n{\r\nif (tlb_ops_need_broadcast()) {\r\nstruct tlb_args ta;\r\nta.ta_start = start;\r\nta.ta_end = end;\r\non_each_cpu(ipi_flush_tlb_kernel_range, &ta, 1);\r\n} else\r\nlocal_flush_tlb_kernel_range(start, end);\r\n}
