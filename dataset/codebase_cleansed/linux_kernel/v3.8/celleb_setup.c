static void celleb_show_cpuinfo(struct seq_file *m)\r\n{\r\nstruct device_node *root;\r\nconst char *model = "";\r\nroot = of_find_node_by_path("/");\r\nif (root)\r\nmodel = of_get_property(root, "model", NULL);\r\nseq_printf(m, "machine\t\t: %s %s\n", celleb_machine_type, model);\r\nof_node_put(root);\r\n}\r\nstatic int __init celleb_machine_type_hack(char *ptr)\r\n{\r\nstrlcpy(celleb_machine_type, ptr, sizeof(celleb_machine_type));\r\nreturn 0;\r\n}\r\nstatic void celleb_progress(char *s, unsigned short hex)\r\n{\r\nprintk("*** %04x : %s\n", hex, s ? s : "");\r\n}\r\nstatic void __init celleb_setup_arch_common(void)\r\n{\r\nloops_per_jiffy = 50000000;\r\n#ifdef CONFIG_DUMMY_CONSOLE\r\nconswitchp = &dummy_con;\r\n#endif\r\n}\r\nstatic int __init celleb_publish_devices(void)\r\n{\r\nof_platform_bus_probe(NULL, celleb_bus_ids, NULL);\r\nreturn 0;\r\n}\r\nstatic void __init celleb_setup_arch_beat(void)\r\n{\r\n#ifdef CONFIG_SPU_BASE\r\nspu_priv1_ops = &spu_priv1_beat_ops;\r\nspu_management_ops = &spu_management_of_ops;\r\n#endif\r\ncelleb_setup_arch_common();\r\n}\r\nstatic int __init celleb_probe_beat(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nif (!of_flat_dt_is_compatible(root, "Beat"))\r\nreturn 0;\r\npowerpc_firmware_features |= FW_FEATURE_CELLEB_ALWAYS\r\n| FW_FEATURE_BEAT | FW_FEATURE_LPAR;\r\nhpte_init_beat_v3();\r\nreturn 1;\r\n}\r\nstatic void __init celleb_init_IRQ_native(void)\r\n{\r\niic_init_IRQ();\r\nspider_init_IRQ();\r\n}\r\nstatic void __init celleb_setup_arch_native(void)\r\n{\r\n#ifdef CONFIG_SPU_BASE\r\nspu_priv1_ops = &spu_priv1_mmio_ops;\r\nspu_management_ops = &spu_management_of_ops;\r\n#endif\r\ncbe_regs_init();\r\n#ifdef CONFIG_CBE_RAS\r\ncbe_ras_init();\r\n#endif\r\n#ifdef CONFIG_SMP\r\nsmp_init_cell();\r\n#endif\r\ncbe_pervasive_init();\r\ncelleb_setup_arch_common();\r\n}\r\nstatic int __init celleb_probe_native(void)\r\n{\r\nunsigned long root = of_get_flat_dt_root();\r\nif (of_flat_dt_is_compatible(root, "Beat") ||\r\n!of_flat_dt_is_compatible(root, "TOSHIBA,Celleb"))\r\nreturn 0;\r\npowerpc_firmware_features |= FW_FEATURE_CELLEB_ALWAYS;\r\nhpte_init_native();\r\nreturn 1;\r\n}
