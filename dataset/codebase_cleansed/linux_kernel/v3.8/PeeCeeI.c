void outsb(unsigned long __addr, const void *src, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nconst u8 *p = src;\r\nwhile (count--)\r\noutb(*p++, addr);\r\n}\r\nvoid outsw(unsigned long __addr, const void *src, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nwhile (count--) {\r\n__raw_writew(*(u16 *)src, addr);\r\nsrc += sizeof(u16);\r\n}\r\n}\r\nvoid outsl(unsigned long __addr, const void *src, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nu32 l, l2;\r\nif (!count)\r\nreturn;\r\nswitch (((unsigned long)src) & 0x3) {\r\ncase 0x0:\r\nwhile (count--) {\r\n__raw_writel(*(u32 *)src, addr);\r\nsrc += sizeof(u32);\r\n}\r\nbreak;\r\ncase 0x2:\r\nwhile (count--) {\r\nl = (*(u16 *)src) << 16;\r\nl |= *(u16 *)(src + sizeof(u16));\r\n__raw_writel(l, addr);\r\nsrc += sizeof(u32);\r\n}\r\nbreak;\r\ncase 0x1:\r\nl = (*(u8 *)src) << 24;\r\nl |= (*(u16 *)(src + sizeof(u8))) << 8;\r\nsrc += sizeof(u8) + sizeof(u16);\r\nwhile (count--) {\r\nl2 = *(u32 *)src;\r\nl |= (l2 >> 24);\r\n__raw_writel(l, addr);\r\nl = l2 << 8;\r\nsrc += sizeof(u32);\r\n}\r\nbreak;\r\ncase 0x3:\r\nl = (*(u8 *)src) << 24;\r\nsrc += sizeof(u8);\r\nwhile (count--) {\r\nl2 = *(u32 *)src;\r\nl |= (l2 >> 8);\r\n__raw_writel(l, addr);\r\nl = l2 << 24;\r\nsrc += sizeof(u32);\r\n}\r\nbreak;\r\n}\r\n}\r\nvoid insb(unsigned long __addr, void *dst, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nif (count) {\r\nu32 *pi;\r\nu8 *pb = dst;\r\nwhile ((((unsigned long)pb) & 0x3) && count--)\r\n*pb++ = inb(addr);\r\npi = (u32 *)pb;\r\nwhile (count >= 4) {\r\nu32 w;\r\nw = (inb(addr) << 24);\r\nw |= (inb(addr) << 16);\r\nw |= (inb(addr) << 8);\r\nw |= (inb(addr) << 0);\r\n*pi++ = w;\r\ncount -= 4;\r\n}\r\npb = (u8 *)pi;\r\nwhile (count--)\r\n*pb++ = inb(addr);\r\n}\r\n}\r\nvoid insw(unsigned long __addr, void *dst, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nif (count) {\r\nu16 *ps = dst;\r\nu32 *pi;\r\nif (((unsigned long)ps) & 0x2) {\r\n*ps++ = le16_to_cpu(inw(addr));\r\ncount--;\r\n}\r\npi = (u32 *)ps;\r\nwhile (count >= 2) {\r\nu32 w;\r\nw = (le16_to_cpu(inw(addr)) << 16);\r\nw |= (le16_to_cpu(inw(addr)) << 0);\r\n*pi++ = w;\r\ncount -= 2;\r\n}\r\nps = (u16 *)pi;\r\nif (count)\r\n*ps = le16_to_cpu(inw(addr));\r\n}\r\n}\r\nvoid insl(unsigned long __addr, void *dst, unsigned long count)\r\n{\r\nvoid __iomem *addr = (void __iomem *) __addr;\r\nif (count) {\r\nif ((((unsigned long)dst) & 0x3) == 0) {\r\nu32 *pi = dst;\r\nwhile (count--)\r\n*pi++ = le32_to_cpu(inl(addr));\r\n} else {\r\nu32 l = 0, l2, *pi;\r\nu16 *ps;\r\nu8 *pb;\r\nswitch (((unsigned long)dst) & 3) {\r\ncase 0x2:\r\nps = dst;\r\ncount -= 1;\r\nl = le32_to_cpu(inl(addr));\r\n*ps++ = l;\r\npi = (u32 *)ps;\r\nwhile (count--) {\r\nl2 = le32_to_cpu(inl(addr));\r\n*pi++ = (l << 16) | (l2 >> 16);\r\nl = l2;\r\n}\r\nps = (u16 *)pi;\r\n*ps = l;\r\nbreak;\r\ncase 0x1:\r\npb = dst;\r\ncount -= 1;\r\nl = le32_to_cpu(inl(addr));\r\n*pb++ = l >> 24;\r\nps = (u16 *)pb;\r\n*ps++ = ((l >> 8) & 0xffff);\r\npi = (u32 *)ps;\r\nwhile (count--) {\r\nl2 = le32_to_cpu(inl(addr));\r\n*pi++ = (l << 24) | (l2 >> 8);\r\nl = l2;\r\n}\r\npb = (u8 *)pi;\r\n*pb = l;\r\nbreak;\r\ncase 0x3:\r\npb = (u8 *)dst;\r\ncount -= 1;\r\nl = le32_to_cpu(inl(addr));\r\n*pb++ = l >> 24;\r\npi = (u32 *)pb;\r\nwhile (count--) {\r\nl2 = le32_to_cpu(inl(addr));\r\n*pi++ = (l << 8) | (l2 >> 24);\r\nl = l2;\r\n}\r\nps = (u16 *)pi;\r\n*ps++ = ((l >> 8) & 0xffff);\r\npb = (u8 *)ps;\r\n*pb = l;\r\nbreak;\r\n}\r\n}\r\n}\r\n}
