u32 initialize_cx231xx(struct cx231xx *dev)\r\n{\r\nu32 config_info = 0;\r\nstruct pcb_config *p_pcb_info;\r\nu8 usb_speed = 1;\r\nu8 data[4] = { 0, 0, 0, 0 };\r\nu32 ts1_source = 0;\r\nu32 ts2_source = 0;\r\nu32 analog_source = 0;\r\nu8 _current_scenario_idx = 0xff;\r\nts1_source = SOURCE_TS_BDA;\r\nts2_source = SOURCE_TS_BDA;\r\ncx231xx_read_ctrl_reg(dev, VRT_GET_REGISTER, BOARD_CFG_STAT, data, 4);\r\nconfig_info = *((u32 *) data);\r\nusb_speed = (u8) (config_info & 0x1);\r\nif (config_info & BUS_POWER) {\r\nswitch (config_info & BUSPOWER_MASK) {\r\ncase TS1_PORT | BUS_POWER:\r\ncx231xx_Scenario[INDEX_BUSPOWER_DIGITAL_ONLY].speed =\r\nusb_speed;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_BUSPOWER_DIGITAL_ONLY];\r\n_current_scenario_idx = INDEX_BUSPOWER_DIGITAL_ONLY;\r\nbreak;\r\ncase AVDEC_ENABLE | BUS_POWER:\r\ncx231xx_Scenario[INDEX_BUSPOWER_ANALOG_ONLY].speed =\r\nusb_speed;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_BUSPOWER_ANALOG_ONLY];\r\n_current_scenario_idx = INDEX_BUSPOWER_ANALOG_ONLY;\r\nbreak;\r\ncase AVDEC_ENABLE | BUS_POWER | TS1_PORT:\r\ncx231xx_Scenario[INDEX_BUSPOWER_DIF_ONLY].speed =\r\nusb_speed;\r\np_pcb_info = &cx231xx_Scenario[INDEX_BUSPOWER_DIF_ONLY];\r\n_current_scenario_idx = INDEX_BUSPOWER_DIF_ONLY;\r\nbreak;\r\ndefault:\r\ncx231xx_info("bad config in buspower!!!!\n");\r\ncx231xx_info("config_info=%x\n",\r\n(config_info & BUSPOWER_MASK));\r\nreturn 1;\r\n}\r\n} else {\r\nswitch (config_info & SELFPOWER_MASK) {\r\ncase TS1_PORT | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_DIGITAL_ONLY].speed =\r\nusb_speed;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_SELFPOWER_DIGITAL_ONLY];\r\n_current_scenario_idx = INDEX_SELFPOWER_DIGITAL_ONLY;\r\nbreak;\r\ncase TS1_TS2_PORT | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_DUAL_DIGITAL].speed =\r\nusb_speed;\r\ncx231xx_Scenario[INDEX_SELFPOWER_DUAL_DIGITAL].\r\nts2_source = ts2_source;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_SELFPOWER_DUAL_DIGITAL];\r\n_current_scenario_idx = INDEX_SELFPOWER_DUAL_DIGITAL;\r\nbreak;\r\ncase AVDEC_ENABLE | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_ANALOG_ONLY].speed =\r\nusb_speed;\r\ncx231xx_Scenario[INDEX_SELFPOWER_ANALOG_ONLY].\r\nanalog_source = analog_source;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_SELFPOWER_ANALOG_ONLY];\r\n_current_scenario_idx = INDEX_SELFPOWER_ANALOG_ONLY;\r\nbreak;\r\ncase AVDEC_ENABLE | TS1_PORT | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_DUAL].speed =\r\nusb_speed;\r\ncx231xx_Scenario[INDEX_SELFPOWER_DUAL].ts1_source =\r\nts1_source;\r\ncx231xx_Scenario[INDEX_SELFPOWER_DUAL].analog_source =\r\nanalog_source;\r\np_pcb_info = &cx231xx_Scenario[INDEX_SELFPOWER_DUAL];\r\n_current_scenario_idx = INDEX_SELFPOWER_DUAL;\r\nbreak;\r\ncase AVDEC_ENABLE | TS1_TS2_PORT | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_TRIPLE].speed =\r\nusb_speed;\r\ncx231xx_Scenario[INDEX_SELFPOWER_TRIPLE].ts1_source =\r\nts1_source;\r\ncx231xx_Scenario[INDEX_SELFPOWER_TRIPLE].ts2_source =\r\nts2_source;\r\ncx231xx_Scenario[INDEX_SELFPOWER_TRIPLE].analog_source =\r\nanalog_source;\r\np_pcb_info = &cx231xx_Scenario[INDEX_SELFPOWER_TRIPLE];\r\n_current_scenario_idx = INDEX_SELFPOWER_TRIPLE;\r\nbreak;\r\ncase AVDEC_ENABLE | TS1VIP_TS2_PORT | SELF_POWER:\r\ncx231xx_Scenario[INDEX_SELFPOWER_COMPRESSOR].speed =\r\nusb_speed;\r\ncx231xx_Scenario[INDEX_SELFPOWER_COMPRESSOR].\r\nanalog_source = analog_source;\r\np_pcb_info =\r\n&cx231xx_Scenario[INDEX_SELFPOWER_COMPRESSOR];\r\n_current_scenario_idx = INDEX_SELFPOWER_COMPRESSOR;\r\nbreak;\r\ndefault:\r\ncx231xx_info("bad senario!!!!!\n");\r\ncx231xx_info("config_info=%x\n",\r\n(config_info & SELFPOWER_MASK));\r\nreturn 1;\r\n}\r\n}\r\ndev->current_scenario_idx = _current_scenario_idx;\r\nmemcpy(&dev->current_pcb_config, p_pcb_info,\r\nsizeof(struct pcb_config));\r\nif (pcb_debug) {\r\ncx231xx_info("SC(0x00) register = 0x%x\n", config_info);\r\ncx231xx_info("scenario %d\n",\r\n(dev->current_pcb_config.index) + 1);\r\ncx231xx_info("type=%x\n", dev->current_pcb_config.type);\r\ncx231xx_info("mode=%x\n", dev->current_pcb_config.mode);\r\ncx231xx_info("speed=%x\n", dev->current_pcb_config.speed);\r\ncx231xx_info("ts1_source=%x\n",\r\ndev->current_pcb_config.ts1_source);\r\ncx231xx_info("ts2_source=%x\n",\r\ndev->current_pcb_config.ts2_source);\r\ncx231xx_info("analog_source=%x\n",\r\ndev->current_pcb_config.analog_source);\r\n}\r\nreturn 0;\r\n}
