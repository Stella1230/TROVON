int mlx5_core_attach_mcg(struct mlx5_core_dev *dev, union ib_gid *mgid, u32 qpn)\r\n{\r\nu32 out[MLX5_ST_SZ_DW(attach_to_mcg_out)] = {0};\r\nu32 in[MLX5_ST_SZ_DW(attach_to_mcg_in)] = {0};\r\nvoid *gid;\r\nMLX5_SET(attach_to_mcg_in, in, opcode, MLX5_CMD_OP_ATTACH_TO_MCG);\r\nMLX5_SET(attach_to_mcg_in, in, qpn, qpn);\r\ngid = MLX5_ADDR_OF(attach_to_mcg_in, in, multicast_gid);\r\nmemcpy(gid, mgid, sizeof(*mgid));\r\nreturn mlx5_cmd_exec(dev, in, sizeof(in), out, sizeof(out));\r\n}\r\nint mlx5_core_detach_mcg(struct mlx5_core_dev *dev, union ib_gid *mgid, u32 qpn)\r\n{\r\nu32 out[MLX5_ST_SZ_DW(detach_from_mcg_out)] = {0};\r\nu32 in[MLX5_ST_SZ_DW(detach_from_mcg_in)] = {0};\r\nvoid *gid;\r\nMLX5_SET(detach_from_mcg_in, in, opcode, MLX5_CMD_OP_DETACH_FROM_MCG);\r\nMLX5_SET(detach_from_mcg_in, in, qpn, qpn);\r\ngid = MLX5_ADDR_OF(detach_from_mcg_in, in, multicast_gid);\r\nmemcpy(gid, mgid, sizeof(*mgid));\r\nreturn mlx5_cmd_exec(dev, in, sizeof(in), out, sizeof(out));\r\n}
