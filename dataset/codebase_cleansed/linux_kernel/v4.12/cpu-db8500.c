static int __init ux500_l2x0_unlock(void)\r\n{\r\nint i;\r\nstruct device_node *np;\r\nvoid __iomem *l2x0_base;\r\nnp = of_find_compatible_node(NULL, NULL, "arm,pl310-cache");\r\nl2x0_base = of_iomap(np, 0);\r\nof_node_put(np);\r\nif (!l2x0_base)\r\nreturn -ENODEV;\r\nfor (i = 0; i < 8; i++) {\r\nwritel_relaxed(0x0, l2x0_base + L2X0_LOCKDOWN_WAY_D_BASE +\r\ni * L2X0_LOCKDOWN_STRIDE);\r\nwritel_relaxed(0x0, l2x0_base + L2X0_LOCKDOWN_WAY_I_BASE +\r\ni * L2X0_LOCKDOWN_STRIDE);\r\n}\r\niounmap(l2x0_base);\r\nreturn 0;\r\n}\r\nstatic void ux500_l2c310_write_sec(unsigned long val, unsigned reg)\r\n{\r\n}\r\nstatic void __init ux500_init_irq(void)\r\n{\r\nstruct device_node *np;\r\nstruct resource r;\r\nirqchip_init();\r\nnp = of_find_compatible_node(NULL, NULL, "stericsson,db8500-prcmu");\r\nof_address_to_resource(np, 0, &r);\r\nof_node_put(np);\r\nif (!r.start) {\r\npr_err("could not find PRCMU base resource\n");\r\nreturn;\r\n}\r\nprcmu_early_init(r.start, r.end-r.start);\r\nux500_pm_init(r.start, r.end-r.start);\r\nux500_l2x0_unlock();\r\nouter_cache.write_sec = ux500_l2c310_write_sec;\r\n}\r\nstatic void ux500_restart(enum reboot_mode mode, const char *cmd)\r\n{\r\nlocal_irq_disable();\r\nlocal_fiq_disable();\r\nprcmu_system_reset(0);\r\n}\r\nstatic irqreturn_t db8500_pmu_handler(int irq, void *dev, irq_handler_t handler)\r\n{\r\nirqreturn_t ret = handler(irq, dev);\r\nint other = !smp_processor_id();\r\nif (ret == IRQ_NONE && cpu_online(other))\r\nirq_set_affinity(irq, cpumask_of(other));\r\nreturn ret;\r\n}\r\nstatic void __init u8500_init_machine(void)\r\n{\r\nif (of_machine_is_compatible("st-ericsson,u8540"))\r\nof_platform_populate(NULL, u8500_local_bus_nodes,\r\nu8540_auxdata_lookup, NULL);\r\nelse\r\nof_platform_populate(NULL, u8500_local_bus_nodes,\r\nu8500_auxdata_lookup, NULL);\r\n}
