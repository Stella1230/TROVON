int rtc_set_ntp_time(struct timespec64 now)\r\n{\r\nstruct rtc_device *rtc;\r\nstruct rtc_time tm;\r\nint err = -ENODEV;\r\nif (now.tv_nsec < (NSEC_PER_SEC >> 1))\r\nrtc_time64_to_tm(now.tv_sec, &tm);\r\nelse\r\nrtc_time64_to_tm(now.tv_sec + 1, &tm);\r\nrtc = rtc_class_open(CONFIG_RTC_SYSTOHC_DEVICE);\r\nif (rtc) {\r\nif (rtc->ops &&\r\n(rtc->ops->set_time ||\r\nrtc->ops->set_mmss64 ||\r\nrtc->ops->set_mmss))\r\nerr = rtc_set_time(rtc, &tm);\r\nrtc_class_close(rtc);\r\n}\r\nreturn err;\r\n}
