struct _diva_dma_map_entry *diva_alloc_dma_map(void *os_context, int nentries) {\r\ndiva_dma_map_entry_t *pmap = diva_os_malloc(0, sizeof(*pmap) * (nentries + 1));\r\nif (pmap)\r\nmemset(pmap, 0, sizeof(*pmap) * (nentries + 1));\r\nreturn pmap;\r\n}\r\nvoid diva_free_dma_mapping(struct _diva_dma_map_entry *pmap) {\r\nif (pmap) {\r\ndiva_os_free(0, pmap);\r\n}\r\n}\r\nvoid diva_init_dma_map_entry(struct _diva_dma_map_entry *pmap,\r\nint nr, void *virt, dword phys,\r\nvoid *addr_handle) {\r\npmap[nr].phys_bus_addr = phys;\r\npmap[nr].local_ram_addr = virt;\r\npmap[nr].addr_handle = addr_handle;\r\n}\r\nint diva_alloc_dma_map_entry(struct _diva_dma_map_entry *pmap) {\r\nint i;\r\nfor (i = 0; (pmap && pmap[i].local_ram_addr); i++) {\r\nif (!pmap[i].busy) {\r\npmap[i].busy = 1;\r\nreturn (i);\r\n}\r\n}\r\nreturn (-1);\r\n}\r\nvoid diva_free_dma_map_entry(struct _diva_dma_map_entry *pmap, int nr) {\r\npmap[nr].busy = 0;\r\n}\r\nvoid diva_get_dma_map_entry(struct _diva_dma_map_entry *pmap, int nr,\r\nvoid **pvirt, dword *pphys) {\r\n*pphys = pmap[nr].phys_bus_addr;\r\n*pvirt = pmap[nr].local_ram_addr;\r\n}\r\nvoid *diva_get_entry_handle(struct _diva_dma_map_entry *pmap, int nr) {\r\nreturn (pmap[nr].addr_handle);\r\n}
