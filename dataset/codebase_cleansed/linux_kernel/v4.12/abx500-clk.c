static int ab8500_reg_clks(struct device *dev)\r\n{\r\nint ret;\r\nstruct clk *clk;\r\nstruct device_node *np = dev->of_node;\r\nconst char *intclk_parents[] = {"ab8500_sysclk", "ulpclk"};\r\nu16 intclk_reg_sel[] = {0 , AB8500_SYSULPCLKCTRL1};\r\nu8 intclk_reg_mask[] = {0 , AB8500_SYSULPCLKCTRL1_SYSULPCLKINTSEL_MASK};\r\nu8 intclk_reg_bits[] = {\r\n0 ,\r\n(1 << AB8500_SYSULPCLKCTRL1_SYSULPCLKINTSEL_SHIFT)\r\n};\r\nret = ab8500_sysctrl_set(AB8500_SWATCTRL, AB8500_SWATCTRL_SWATENABLE);\r\nif (ret)\r\nreturn ret;\r\nclk = clk_reg_sysctrl_gate(dev , "ab8500_sysclk2", "ab8500_sysclk",\r\nAB8500_SYSULPCLKCTRL1, AB8500_SYSULPCLKCTRL1_SYSCLKBUF2REQ,\r\nAB8500_SYSULPCLKCTRL1_SYSCLKBUF2REQ, 0, 0);\r\nab8500_clks[AB8500_SYSCLK_BUF2] = clk;\r\nclk = clk_reg_sysctrl_gate(dev , "ab8500_sysclk3", "ab8500_sysclk",\r\nAB8500_SYSULPCLKCTRL1, AB8500_SYSULPCLKCTRL1_SYSCLKBUF3REQ,\r\nAB8500_SYSULPCLKCTRL1_SYSCLKBUF3REQ, 0, 0);\r\nab8500_clks[AB8500_SYSCLK_BUF3] = clk;\r\nclk = clk_reg_sysctrl_gate(dev , "ab8500_sysclk4", "ab8500_sysclk",\r\nAB8500_SYSULPCLKCTRL1, AB8500_SYSULPCLKCTRL1_SYSCLKBUF4REQ,\r\nAB8500_SYSULPCLKCTRL1_SYSCLKBUF4REQ, 0, 0);\r\nab8500_clks[AB8500_SYSCLK_BUF4] = clk;\r\nclk = clk_reg_sysctrl_gate_fixed_rate(dev, "ulpclk", NULL,\r\nAB8500_SYSULPCLKCTRL1, AB8500_SYSULPCLKCTRL1_ULPCLKREQ,\r\nAB8500_SYSULPCLKCTRL1_ULPCLKREQ,\r\n38400000, 9000, 0);\r\nab8500_clks[AB8500_SYSCLK_ULP] = clk;\r\nclk = clk_reg_sysctrl_set_parent(dev , "intclk", intclk_parents, 2,\r\nintclk_reg_sel, intclk_reg_mask, intclk_reg_bits, 0);\r\nab8500_clks[AB8500_SYSCLK_INT] = clk;\r\nclk = clk_reg_sysctrl_gate(dev , "audioclk", "intclk",\r\nAB8500_SYSULPCLKCTRL1, AB8500_SYSULPCLKCTRL1_AUDIOCLKENA,\r\nAB8500_SYSULPCLKCTRL1_AUDIOCLKENA, 0, 0);\r\nab8500_clks[AB8500_SYSCLK_AUDIO] = clk;\r\nab8500_clk_data.clks = ab8500_clks;\r\nab8500_clk_data.clk_num = ARRAY_SIZE(ab8500_clks);\r\nof_clk_add_provider(np, of_clk_src_onecell_get, &ab8500_clk_data);\r\ndev_info(dev, "registered clocks for ab850x\n");\r\nreturn 0;\r\n}\r\nstatic int ab8540_reg_clks(struct device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int ab9540_reg_clks(struct device *dev)\r\n{\r\nreturn 0;\r\n}\r\nstatic int abx500_clk_probe(struct platform_device *pdev)\r\n{\r\nstruct ab8500 *parent = dev_get_drvdata(pdev->dev.parent);\r\nint ret;\r\nif (is_ab8500(parent) || is_ab8505(parent)) {\r\nret = ab8500_reg_clks(&pdev->dev);\r\n} else if (is_ab8540(parent)) {\r\nret = ab8540_reg_clks(&pdev->dev);\r\n} else if (is_ab9540(parent)) {\r\nret = ab9540_reg_clks(&pdev->dev);\r\n} else {\r\ndev_err(&pdev->dev, "non supported plf id\n");\r\nreturn -ENODEV;\r\n}\r\nreturn ret;\r\n}\r\nstatic int __init abx500_clk_init(void)\r\n{\r\nreturn platform_driver_register(&abx500_clk_driver);\r\n}
