int main(int argc, char const *argv[])\r\n{\r\nstruct uleds_user_dev uleds_dev;\r\nint fd, ret;\r\nint brightness;\r\nstruct timespec ts;\r\nif (argc != 2) {\r\nfprintf(stderr, "Requires <device-name> argument\n");\r\nreturn 1;\r\n}\r\nstrncpy(uleds_dev.name, argv[1], LED_MAX_NAME_SIZE);\r\nuleds_dev.max_brightness = 100;\r\nfd = open("/dev/uleds", O_RDWR);\r\nif (fd == -1) {\r\nperror("Failed to open /dev/uleds");\r\nreturn 1;\r\n}\r\nret = write(fd, &uleds_dev, sizeof(uleds_dev));\r\nif (ret == -1) {\r\nperror("Failed to write to /dev/uleds");\r\nclose(fd);\r\nreturn 1;\r\n}\r\nwhile (1) {\r\nret = read(fd, &brightness, sizeof(brightness));\r\nif (ret == -1) {\r\nperror("Failed to read from /dev/uleds");\r\nclose(fd);\r\nreturn 1;\r\n}\r\nclock_gettime(CLOCK_MONOTONIC, &ts);\r\nprintf("[%ld.%09ld] %u\n", ts.tv_sec, ts.tv_nsec, brightness);\r\n}\r\nclose(fd);\r\nreturn 0;\r\n}
