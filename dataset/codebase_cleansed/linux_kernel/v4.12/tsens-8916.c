static int calibrate_8916(struct tsens_device *tmdev)\r\n{\r\nint base0 = 0, base1 = 0, i;\r\nu32 p1[5], p2[5];\r\nint mode = 0;\r\nu32 *qfprom_cdata, *qfprom_csel;\r\nqfprom_cdata = (u32 *)qfprom_read(tmdev->dev, "calib");\r\nif (IS_ERR(qfprom_cdata))\r\nreturn PTR_ERR(qfprom_cdata);\r\nqfprom_csel = (u32 *)qfprom_read(tmdev->dev, "calib_sel");\r\nif (IS_ERR(qfprom_csel))\r\nreturn PTR_ERR(qfprom_csel);\r\nmode = (qfprom_csel[0] & CAL_SEL_MASK) >> CAL_SEL_SHIFT;\r\ndev_dbg(tmdev->dev, "calibration mode is %d\n", mode);\r\nswitch (mode) {\r\ncase TWO_PT_CALIB:\r\nbase1 = (qfprom_cdata[1] & BASE1_MASK) >> BASE1_SHIFT;\r\np2[0] = (qfprom_cdata[0] & S0_P2_MASK) >> S0_P2_SHIFT;\r\np2[1] = (qfprom_cdata[0] & S1_P2_MASK) >> S1_P2_SHIFT;\r\np2[2] = (qfprom_cdata[1] & S2_P2_MASK) >> S2_P2_SHIFT;\r\np2[3] = (qfprom_cdata[1] & S3_P2_MASK) >> S3_P2_SHIFT;\r\np2[4] = (qfprom_cdata[1] & S4_P2_MASK) >> S4_P2_SHIFT;\r\nfor (i = 0; i < tmdev->num_sensors; i++)\r\np2[i] = ((base1 + p2[i]) << 3);\r\ncase ONE_PT_CALIB2:\r\nbase0 = (qfprom_cdata[0] & BASE0_MASK);\r\np1[0] = (qfprom_cdata[0] & S0_P1_MASK) >> S0_P1_SHIFT;\r\np1[1] = (qfprom_cdata[0] & S1_P1_MASK) >> S1_P1_SHIFT;\r\np1[2] = (qfprom_cdata[0] & S2_P1_MASK) >> S2_P1_SHIFT;\r\np1[3] = (qfprom_cdata[1] & S3_P1_MASK) >> S3_P1_SHIFT;\r\np1[4] = (qfprom_cdata[1] & S4_P1_MASK) >> S4_P1_SHIFT;\r\nfor (i = 0; i < tmdev->num_sensors; i++)\r\np1[i] = (((base0) + p1[i]) << 3);\r\nbreak;\r\ndefault:\r\nfor (i = 0; i < tmdev->num_sensors; i++) {\r\np1[i] = 500;\r\np2[i] = 780;\r\n}\r\nbreak;\r\n}\r\ncompute_intercept_slope(tmdev, p1, p2, mode);\r\nreturn 0;\r\n}
