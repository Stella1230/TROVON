static ssize_t static_uintvalue_show(struct kobject *kobj,\r\nstruct attribute *attr,\r\nchar *buf)\r\n{\r\nstruct static_lustre_uintvalue_attr *lattr = (void *)attr;\r\nreturn sprintf(buf, "%d\n", *lattr->value);\r\n}\r\nstatic ssize_t static_uintvalue_store(struct kobject *kobj,\r\nstruct attribute *attr,\r\nconst char *buffer, size_t count)\r\n{\r\nstruct static_lustre_uintvalue_attr *lattr = (void *)attr;\r\nint rc;\r\nunsigned int val;\r\nrc = kstrtouint(buffer, 10, &val);\r\nif (rc)\r\nreturn rc;\r\n*lattr->value = val;\r\nreturn count;\r\n}\r\nstatic ssize_t max_dirty_mb_show(struct kobject *kobj, struct attribute *attr,\r\nchar *buf)\r\n{\r\nreturn sprintf(buf, "%lu\n",\r\nobd_max_dirty_pages / (1 << (20 - PAGE_SHIFT)));\r\n}\r\nstatic ssize_t max_dirty_mb_store(struct kobject *kobj, struct attribute *attr,\r\nconst char *buffer, size_t count)\r\n{\r\nint rc;\r\nunsigned long val;\r\nrc = kstrtoul(buffer, 10, &val);\r\nif (rc)\r\nreturn rc;\r\nval *= 1 << (20 - PAGE_SHIFT);\r\nif (val > ((totalram_pages / 10) * 9)) {\r\nreturn -EINVAL;\r\n}\r\nif (val < 4 << (20 - PAGE_SHIFT)) {\r\nreturn -EINVAL;\r\n}\r\nobd_max_dirty_pages = val;\r\nreturn count;\r\n}\r\nint obd_sysctl_init(void)\r\n{\r\nreturn sysfs_create_group(lustre_kobj, &lustre_attr_group);\r\n}
