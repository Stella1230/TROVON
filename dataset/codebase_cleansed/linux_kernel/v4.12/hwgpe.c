u32 acpi_hw_get_gpe_register_bit(struct acpi_gpe_event_info *gpe_event_info)\r\n{\r\nreturn ((u32)1 <<\r\n(gpe_event_info->gpe_number -\r\ngpe_event_info->register_info->base_gpe_number));\r\n}\r\nacpi_status\r\nacpi_hw_low_set_gpe(struct acpi_gpe_event_info *gpe_event_info, u32 action)\r\n{\r\nstruct acpi_gpe_register_info *gpe_register_info;\r\nacpi_status status = AE_OK;\r\nu32 enable_mask;\r\nu32 register_bit;\r\nACPI_FUNCTION_ENTRY();\r\ngpe_register_info = gpe_event_info->register_info;\r\nif (!gpe_register_info) {\r\nreturn (AE_NOT_EXIST);\r\n}\r\nstatus = acpi_hw_read(&enable_mask, &gpe_register_info->enable_address);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nregister_bit = acpi_hw_get_gpe_register_bit(gpe_event_info);\r\nswitch (action) {\r\ncase ACPI_GPE_CONDITIONAL_ENABLE:\r\nif (!(register_bit & gpe_register_info->enable_mask)) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\ncase ACPI_GPE_ENABLE:\r\nACPI_SET_BIT(enable_mask, register_bit);\r\nbreak;\r\ncase ACPI_GPE_DISABLE:\r\nACPI_CLEAR_BIT(enable_mask, register_bit);\r\nbreak;\r\ndefault:\r\nACPI_ERROR((AE_INFO, "Invalid GPE Action, %u", action));\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nif (!(register_bit & gpe_register_info->mask_for_run)) {\r\nstatus =\r\nacpi_hw_write(enable_mask,\r\n&gpe_register_info->enable_address);\r\n}\r\nreturn (status);\r\n}\r\nacpi_status acpi_hw_clear_gpe(struct acpi_gpe_event_info *gpe_event_info)\r\n{\r\nstruct acpi_gpe_register_info *gpe_register_info;\r\nacpi_status status;\r\nu32 register_bit;\r\nACPI_FUNCTION_ENTRY();\r\ngpe_register_info = gpe_event_info->register_info;\r\nif (!gpe_register_info) {\r\nreturn (AE_NOT_EXIST);\r\n}\r\nregister_bit = acpi_hw_get_gpe_register_bit(gpe_event_info);\r\nstatus =\r\nacpi_hw_write(register_bit, &gpe_register_info->status_address);\r\nreturn (status);\r\n}\r\nacpi_status\r\nacpi_hw_get_gpe_status(struct acpi_gpe_event_info *gpe_event_info,\r\nacpi_event_status *event_status)\r\n{\r\nu32 in_byte;\r\nu32 register_bit;\r\nstruct acpi_gpe_register_info *gpe_register_info;\r\nacpi_event_status local_event_status = 0;\r\nacpi_status status;\r\nACPI_FUNCTION_ENTRY();\r\nif (!event_status) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nif (ACPI_GPE_DISPATCH_TYPE(gpe_event_info->flags) !=\r\nACPI_GPE_DISPATCH_NONE) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_HAS_HANDLER;\r\n}\r\ngpe_register_info = gpe_event_info->register_info;\r\nregister_bit = acpi_hw_get_gpe_register_bit(gpe_event_info);\r\nif (register_bit & gpe_register_info->enable_for_run) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_ENABLED;\r\n}\r\nif (register_bit & gpe_register_info->mask_for_run) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_MASKED;\r\n}\r\nif (register_bit & gpe_register_info->enable_for_wake) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_WAKE_ENABLED;\r\n}\r\nstatus = acpi_hw_read(&in_byte, &gpe_register_info->enable_address);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nif (register_bit & in_byte) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_ENABLE_SET;\r\n}\r\nstatus = acpi_hw_read(&in_byte, &gpe_register_info->status_address);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nif (register_bit & in_byte) {\r\nlocal_event_status |= ACPI_EVENT_FLAG_STATUS_SET;\r\n}\r\n(*event_status) = local_event_status;\r\nreturn (AE_OK);\r\n}\r\nstatic acpi_status\r\nacpi_hw_gpe_enable_write(u8 enable_mask,\r\nstruct acpi_gpe_register_info *gpe_register_info)\r\n{\r\nacpi_status status;\r\ngpe_register_info->enable_mask = enable_mask;\r\nstatus = acpi_hw_write(enable_mask, &gpe_register_info->enable_address);\r\nreturn (status);\r\n}\r\nacpi_status\r\nacpi_hw_disable_gpe_block(struct acpi_gpe_xrupt_info *gpe_xrupt_info,\r\nstruct acpi_gpe_block_info *gpe_block, void *context)\r\n{\r\nu32 i;\r\nacpi_status status;\r\nfor (i = 0; i < gpe_block->register_count; i++) {\r\nstatus =\r\nacpi_hw_gpe_enable_write(0x00,\r\n&gpe_block->register_info[i]);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_hw_clear_gpe_block(struct acpi_gpe_xrupt_info *gpe_xrupt_info,\r\nstruct acpi_gpe_block_info *gpe_block, void *context)\r\n{\r\nu32 i;\r\nacpi_status status;\r\nfor (i = 0; i < gpe_block->register_count; i++) {\r\nstatus =\r\nacpi_hw_write(0xFF,\r\n&gpe_block->register_info[i].status_address);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_hw_enable_runtime_gpe_block(struct acpi_gpe_xrupt_info *gpe_xrupt_info,\r\nstruct acpi_gpe_block_info *gpe_block,\r\nvoid *context)\r\n{\r\nu32 i;\r\nacpi_status status;\r\nstruct acpi_gpe_register_info *gpe_register_info;\r\nu8 enable_mask;\r\nfor (i = 0; i < gpe_block->register_count; i++) {\r\ngpe_register_info = &gpe_block->register_info[i];\r\nif (!gpe_register_info->enable_for_run) {\r\ncontinue;\r\n}\r\nenable_mask = gpe_register_info->enable_for_run &\r\n~gpe_register_info->mask_for_run;\r\nstatus =\r\nacpi_hw_gpe_enable_write(enable_mask, gpe_register_info);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nreturn (AE_OK);\r\n}\r\nstatic acpi_status\r\nacpi_hw_enable_wakeup_gpe_block(struct acpi_gpe_xrupt_info *gpe_xrupt_info,\r\nstruct acpi_gpe_block_info *gpe_block,\r\nvoid *context)\r\n{\r\nu32 i;\r\nacpi_status status;\r\nstruct acpi_gpe_register_info *gpe_register_info;\r\nfor (i = 0; i < gpe_block->register_count; i++) {\r\ngpe_register_info = &gpe_block->register_info[i];\r\nstatus =\r\nacpi_hw_gpe_enable_write(gpe_register_info->enable_for_wake,\r\ngpe_register_info);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nreturn (AE_OK);\r\n}\r\nacpi_status acpi_hw_disable_all_gpes(void)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(hw_disable_all_gpes);\r\nstatus = acpi_ev_walk_gpe_list(acpi_hw_disable_gpe_block, NULL);\r\nstatus = acpi_ev_walk_gpe_list(acpi_hw_clear_gpe_block, NULL);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_hw_enable_all_runtime_gpes(void)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(hw_enable_all_runtime_gpes);\r\nstatus = acpi_ev_walk_gpe_list(acpi_hw_enable_runtime_gpe_block, NULL);\r\nreturn_ACPI_STATUS(status);\r\n}\r\nacpi_status acpi_hw_enable_all_wakeup_gpes(void)\r\n{\r\nacpi_status status;\r\nACPI_FUNCTION_TRACE(hw_enable_all_wakeup_gpes);\r\nstatus = acpi_ev_walk_gpe_list(acpi_hw_enable_wakeup_gpe_block, NULL);\r\nreturn_ACPI_STATUS(status);\r\n}
