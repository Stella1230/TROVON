static ssize_t manager_sysfs_add_store(\r\nstruct kobject *kobj, struct kobj_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nstruct gb_audio_manager_module_descriptor desc = { {0} };\r\nint num = sscanf(buf,\r\n"name=%" GB_AUDIO_MANAGER_MODULE_NAME_LEN_SSCANF "s "\r\n"vid=%d pid=%d intf_id=%d i/p devices=0x%X o/p devices=0x%X",\r\ndesc.name, &desc.vid, &desc.pid, &desc.intf_id,\r\n&desc.ip_devices, &desc.op_devices);\r\nif (num != 7)\r\nreturn -EINVAL;\r\nnum = gb_audio_manager_add(&desc);\r\nif (num < 0)\r\nreturn -EINVAL;\r\nreturn count;\r\n}\r\nstatic ssize_t manager_sysfs_remove_store(\r\nstruct kobject *kobj, struct kobj_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nint id;\r\nint num = kstrtoint(buf, 10, &id);\r\nif (num != 1)\r\nreturn -EINVAL;\r\nnum = gb_audio_manager_remove(id);\r\nif (num)\r\nreturn num;\r\nreturn count;\r\n}\r\nstatic ssize_t manager_sysfs_dump_store(\r\nstruct kobject *kobj, struct kobj_attribute *attr,\r\nconst char *buf, size_t count)\r\n{\r\nint id;\r\nint num = kstrtoint(buf, 10, &id);\r\nif (num == 1) {\r\nnum = gb_audio_manager_dump_module(id);\r\nif (num)\r\nreturn num;\r\n} else if (!strncmp("all", buf, 3)) {\r\ngb_audio_manager_dump_all();\r\n} else {\r\nreturn -EINVAL;\r\n}\r\nreturn count;\r\n}\r\nstatic void manager_sysfs_init_attribute(\r\nstruct kobject *kobj, struct kobj_attribute *kattr)\r\n{\r\nint err;\r\nerr = sysfs_create_file(kobj, &kattr->attr);\r\nif (err) {\r\npr_warn("creating the sysfs entry for %s failed: %d\n",\r\nkattr->attr.name, err);\r\n}\r\n}\r\nvoid gb_audio_manager_sysfs_init(struct kobject *kobj)\r\n{\r\nmanager_sysfs_init_attribute(kobj, &manager_add_attribute);\r\nmanager_sysfs_init_attribute(kobj, &manager_remove_attribute);\r\nmanager_sysfs_init_attribute(kobj, &manager_dump_attribute);\r\n}
