static void proc_read_formation(struct snd_info_entry *entry,\r\nstruct snd_info_buffer *buffer)\r\n{\r\nstruct snd_oxfw *oxfw = entry->private_data;\r\nstruct snd_oxfw_stream_formation formation, curr;\r\nu8 *format;\r\nchar flag;\r\nint i, err;\r\nerr = snd_oxfw_stream_get_current_formation(oxfw,\r\nAVC_GENERAL_PLUG_DIR_IN,\r\n&curr);\r\nif (err < 0)\r\nreturn;\r\nsnd_iprintf(buffer, "Input Stream to device:\n");\r\nsnd_iprintf(buffer, "\tRate\tPCM\tMIDI\n");\r\nfor (i = 0; i < SND_OXFW_STREAM_FORMAT_ENTRIES; i++) {\r\nformat = oxfw->rx_stream_formats[i];\r\nif (format == NULL)\r\ncontinue;\r\nerr = snd_oxfw_stream_parse_format(format, &formation);\r\nif (err < 0)\r\ncontinue;\r\nif (memcmp(&formation, &curr, sizeof(curr)) == 0)\r\nflag = '*';\r\nelse\r\nflag = ' ';\r\nsnd_iprintf(buffer, "%c\t%d\t%d\t%d\n", flag,\r\nformation.rate, formation.pcm, formation.midi);\r\n}\r\nif (!oxfw->has_output)\r\nreturn;\r\nerr = snd_oxfw_stream_get_current_formation(oxfw,\r\nAVC_GENERAL_PLUG_DIR_OUT,\r\n&curr);\r\nif (err < 0)\r\nreturn;\r\nsnd_iprintf(buffer, "Output Stream from device:\n");\r\nsnd_iprintf(buffer, "\tRate\tPCM\tMIDI\n");\r\nfor (i = 0; i < SND_OXFW_STREAM_FORMAT_ENTRIES; i++) {\r\nformat = oxfw->tx_stream_formats[i];\r\nif (format == NULL)\r\ncontinue;\r\nerr = snd_oxfw_stream_parse_format(format, &formation);\r\nif (err < 0)\r\ncontinue;\r\nif (memcmp(&formation, &curr, sizeof(curr)) == 0)\r\nflag = '*';\r\nelse\r\nflag = ' ';\r\nsnd_iprintf(buffer, "%c\t%d\t%d\t%d\n", flag,\r\nformation.rate, formation.pcm, formation.midi);\r\n}\r\n}\r\nstatic void add_node(struct snd_oxfw *oxfw, struct snd_info_entry *root,\r\nconst char *name,\r\nvoid (*op)(struct snd_info_entry *e,\r\nstruct snd_info_buffer *b))\r\n{\r\nstruct snd_info_entry *entry;\r\nentry = snd_info_create_card_entry(oxfw->card, name, root);\r\nif (entry == NULL)\r\nreturn;\r\nsnd_info_set_text_ops(entry, oxfw, op);\r\nif (snd_info_register(entry) < 0)\r\nsnd_info_free_entry(entry);\r\n}\r\nvoid snd_oxfw_proc_init(struct snd_oxfw *oxfw)\r\n{\r\nstruct snd_info_entry *root;\r\nroot = snd_info_create_card_entry(oxfw->card, "firewire",\r\noxfw->card->proc_root);\r\nif (root == NULL)\r\nreturn;\r\nroot->mode = S_IFDIR | S_IRUGO | S_IXUGO;\r\nif (snd_info_register(root) < 0) {\r\nsnd_info_free_entry(root);\r\nreturn;\r\n}\r\nadd_node(oxfw, root, "formation", proc_read_formation);\r\n}
