static void sxgbe_core_init(void __iomem *ioaddr)\r\n{\r\nu32 regval;\r\nregval = readl(ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\nregval |= SXGBE_TX_JABBER_DISABLE;\r\nwritel(regval, ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\nregval = readl(ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\nregval |= SXGBE_RX_JUMBPKT_ENABLE | SXGBE_RX_ACS_ENABLE;\r\nwritel(regval, ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\n}\r\nstatic void sxgbe_core_dump_regs(void __iomem *ioaddr)\r\n{\r\n}\r\nstatic int sxgbe_get_lpi_status(void __iomem *ioaddr, const u32 irq_status)\r\n{\r\nint status = 0;\r\nint lpi_status;\r\nlpi_status = readl(ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\nif (lpi_status & LPI_CTRL_STATUS_TLPIEN)\r\nstatus |= TX_ENTRY_LPI_MODE;\r\nif (lpi_status & LPI_CTRL_STATUS_TLPIEX)\r\nstatus |= TX_EXIT_LPI_MODE;\r\nif (lpi_status & LPI_CTRL_STATUS_RLPIEN)\r\nstatus |= RX_ENTRY_LPI_MODE;\r\nif (lpi_status & LPI_CTRL_STATUS_RLPIEX)\r\nstatus |= RX_EXIT_LPI_MODE;\r\nreturn status;\r\n}\r\nstatic int sxgbe_core_host_irq_status(void __iomem *ioaddr,\r\nstruct sxgbe_extra_stats *x)\r\n{\r\nint irq_status, status = 0;\r\nirq_status = readl(ioaddr + SXGBE_CORE_INT_STATUS_REG);\r\nif (unlikely(irq_status & LPI_INT_STATUS))\r\nstatus |= sxgbe_get_lpi_status(ioaddr, irq_status);\r\nreturn status;\r\n}\r\nstatic void sxgbe_core_pmt(void __iomem *ioaddr, unsigned long mode)\r\n{\r\n}\r\nstatic void sxgbe_core_set_umac_addr(void __iomem *ioaddr, unsigned char *addr,\r\nunsigned int reg_n)\r\n{\r\nu32 high_word, low_word;\r\nhigh_word = (addr[5] << 8) | (addr[4]);\r\nlow_word = (addr[3] << 24) | (addr[2] << 16) |\r\n(addr[1] << 8) | (addr[0]);\r\nwritel(high_word, ioaddr + SXGBE_CORE_ADD_HIGHOFFSET(reg_n));\r\nwritel(low_word, ioaddr + SXGBE_CORE_ADD_LOWOFFSET(reg_n));\r\n}\r\nstatic void sxgbe_core_get_umac_addr(void __iomem *ioaddr, unsigned char *addr,\r\nunsigned int reg_n)\r\n{\r\nu32 high_word, low_word;\r\nhigh_word = readl(ioaddr + SXGBE_CORE_ADD_HIGHOFFSET(reg_n));\r\nlow_word = readl(ioaddr + SXGBE_CORE_ADD_LOWOFFSET(reg_n));\r\naddr[5] = (high_word & 0x0000FF00) >> 8;\r\naddr[4] = (high_word & 0x000000FF);\r\naddr[3] = (low_word & 0xFF000000) >> 24;\r\naddr[2] = (low_word & 0x00FF0000) >> 16;\r\naddr[1] = (low_word & 0x0000FF00) >> 8;\r\naddr[0] = (low_word & 0x000000FF);\r\n}\r\nstatic void sxgbe_enable_tx(void __iomem *ioaddr, bool enable)\r\n{\r\nu32 tx_config;\r\ntx_config = readl(ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\ntx_config &= ~SXGBE_TX_ENABLE;\r\nif (enable)\r\ntx_config |= SXGBE_TX_ENABLE;\r\nwritel(tx_config, ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\n}\r\nstatic void sxgbe_enable_rx(void __iomem *ioaddr, bool enable)\r\n{\r\nu32 rx_config;\r\nrx_config = readl(ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\nrx_config &= ~SXGBE_RX_ENABLE;\r\nif (enable)\r\nrx_config |= SXGBE_RX_ENABLE;\r\nwritel(rx_config, ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\n}\r\nstatic int sxgbe_get_controller_version(void __iomem *ioaddr)\r\n{\r\nreturn readl(ioaddr + SXGBE_CORE_VERSION_REG);\r\n}\r\nstatic unsigned int sxgbe_get_hw_feature(void __iomem *ioaddr,\r\nunsigned char feature_index)\r\n{\r\nreturn readl(ioaddr + (SXGBE_CORE_HW_FEA_REG(feature_index)));\r\n}\r\nstatic void sxgbe_core_set_speed(void __iomem *ioaddr, unsigned char speed)\r\n{\r\nu32 tx_cfg = readl(ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\ntx_cfg &= ~0x60000000;\r\ntx_cfg |= (speed << SXGBE_SPEED_LSHIFT);\r\nwritel(tx_cfg, ioaddr + SXGBE_CORE_TX_CONFIG_REG);\r\n}\r\nstatic void sxgbe_core_enable_rxqueue(void __iomem *ioaddr, int queue_num)\r\n{\r\nu32 reg_val;\r\nreg_val = readl(ioaddr + SXGBE_CORE_RX_CTL0_REG);\r\nreg_val &= ~(SXGBE_CORE_RXQ_ENABLE_MASK << queue_num);\r\nreg_val |= SXGBE_CORE_RXQ_ENABLE;\r\nwritel(reg_val, ioaddr + SXGBE_CORE_RX_CTL0_REG);\r\n}\r\nstatic void sxgbe_core_disable_rxqueue(void __iomem *ioaddr, int queue_num)\r\n{\r\nu32 reg_val;\r\nreg_val = readl(ioaddr + SXGBE_CORE_RX_CTL0_REG);\r\nreg_val &= ~(SXGBE_CORE_RXQ_ENABLE_MASK << queue_num);\r\nreg_val |= SXGBE_CORE_RXQ_DISABLE;\r\nwritel(reg_val, ioaddr + SXGBE_CORE_RX_CTL0_REG);\r\n}\r\nstatic void sxgbe_set_eee_mode(void __iomem *ioaddr)\r\n{\r\nu32 ctrl;\r\nctrl = readl(ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\nctrl |= LPI_CTRL_STATUS_LPIEN | LPI_CTRL_STATUS_TXA;\r\nwritel(ctrl, ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\n}\r\nstatic void sxgbe_reset_eee_mode(void __iomem *ioaddr)\r\n{\r\nu32 ctrl;\r\nctrl = readl(ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\nctrl &= ~(LPI_CTRL_STATUS_LPIEN | LPI_CTRL_STATUS_TXA);\r\nwritel(ctrl, ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\n}\r\nstatic void sxgbe_set_eee_pls(void __iomem *ioaddr, const int link)\r\n{\r\nu32 ctrl;\r\nctrl = readl(ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\nif (link)\r\nctrl |= LPI_CTRL_STATUS_PLS;\r\nelse\r\nctrl &= ~LPI_CTRL_STATUS_PLS;\r\nwritel(ctrl, ioaddr + SXGBE_CORE_LPI_CTRL_STATUS);\r\n}\r\nstatic void sxgbe_set_eee_timer(void __iomem *ioaddr,\r\nconst int ls, const int tw)\r\n{\r\nint value = ((tw & 0xffff)) | ((ls & 0x7ff) << 16);\r\nwritel(value, ioaddr + SXGBE_CORE_LPI_TIMER_CTRL);\r\n}\r\nstatic void sxgbe_enable_rx_csum(void __iomem *ioaddr)\r\n{\r\nu32 ctrl;\r\nctrl = readl(ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\nctrl |= SXGBE_RX_CSUMOFFLOAD_ENABLE;\r\nwritel(ctrl, ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\n}\r\nstatic void sxgbe_disable_rx_csum(void __iomem *ioaddr)\r\n{\r\nu32 ctrl;\r\nctrl = readl(ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\nctrl &= ~SXGBE_RX_CSUMOFFLOAD_ENABLE;\r\nwritel(ctrl, ioaddr + SXGBE_CORE_RX_CONFIG_REG);\r\n}\r\nconst struct sxgbe_core_ops *sxgbe_get_core_ops(void)\r\n{\r\nreturn &core_ops;\r\n}
