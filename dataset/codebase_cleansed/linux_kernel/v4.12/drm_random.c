static inline u32 drm_prandom_u32_max_state(u32 ep_ro, struct rnd_state *state)\r\n{\r\nreturn upper_32_bits((u64)prandom_u32_state(state) * ep_ro);\r\n}\r\nvoid drm_random_reorder(unsigned int *order, unsigned int count,\r\nstruct rnd_state *state)\r\n{\r\nunsigned int i, j;\r\nfor (i = 0; i < count; ++i) {\r\nBUILD_BUG_ON(sizeof(unsigned int) > sizeof(u32));\r\nj = drm_prandom_u32_max_state(count, state);\r\nswap(order[i], order[j]);\r\n}\r\n}\r\nunsigned int *drm_random_order(unsigned int count, struct rnd_state *state)\r\n{\r\nunsigned int *order, i;\r\norder = kmalloc_array(count, sizeof(*order), GFP_TEMPORARY);\r\nif (!order)\r\nreturn order;\r\nfor (i = 0; i < count; i++)\r\norder[i] = i;\r\ndrm_random_reorder(order, count, state);\r\nreturn order;\r\n}
