static void\r\nnv50_disp_pioc_fini(struct nv50_disp_chan *chan)\r\n{\r\nstruct nv50_disp *disp = chan->root->disp;\r\nstruct nvkm_subdev *subdev = &disp->base.engine.subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nint ctrl = chan->chid.ctrl;\r\nint user = chan->chid.user;\r\nnvkm_mask(device, 0x610200 + (ctrl * 0x10), 0x00000001, 0x00000000);\r\nif (nvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x610200 + (ctrl * 0x10)) & 0x00030000))\r\nbreak;\r\n) < 0) {\r\nnvkm_error(subdev, "ch %d timeout: %08x\n", user,\r\nnvkm_rd32(device, 0x610200 + (ctrl * 0x10)));\r\n}\r\n}\r\nstatic int\r\nnv50_disp_pioc_init(struct nv50_disp_chan *chan)\r\n{\r\nstruct nv50_disp *disp = chan->root->disp;\r\nstruct nvkm_subdev *subdev = &disp->base.engine.subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nint ctrl = chan->chid.ctrl;\r\nint user = chan->chid.user;\r\nnvkm_wr32(device, 0x610200 + (ctrl * 0x10), 0x00002000);\r\nif (nvkm_msec(device, 2000,\r\nif (!(nvkm_rd32(device, 0x610200 + (ctrl * 0x10)) & 0x00030000))\r\nbreak;\r\n) < 0) {\r\nnvkm_error(subdev, "ch %d timeout0: %08x\n", user,\r\nnvkm_rd32(device, 0x610200 + (ctrl * 0x10)));\r\nreturn -EBUSY;\r\n}\r\nnvkm_wr32(device, 0x610200 + (ctrl * 0x10), 0x00000001);\r\nif (nvkm_msec(device, 2000,\r\nu32 tmp = nvkm_rd32(device, 0x610200 + (ctrl * 0x10));\r\nif ((tmp & 0x00030000) == 0x00010000)\r\nbreak;\r\n) < 0) {\r\nnvkm_error(subdev, "ch %d timeout1: %08x\n", user,\r\nnvkm_rd32(device, 0x610200 + (ctrl * 0x10)));\r\nreturn -EBUSY;\r\n}\r\nreturn 0;\r\n}
