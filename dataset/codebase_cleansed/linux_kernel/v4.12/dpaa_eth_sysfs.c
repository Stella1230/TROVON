static ssize_t dpaa_eth_show_addr(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\r\nstruct mac_device *mac_dev = priv->mac_dev;\r\nif (mac_dev)\r\nreturn sprintf(buf, "%llx",\r\n(unsigned long long)mac_dev->res->start);\r\nelse\r\nreturn sprintf(buf, "none");\r\n}\r\nstatic ssize_t dpaa_eth_show_fqids(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\r\nstruct dpaa_fq *prev = NULL;\r\nchar *prevstr = NULL;\r\nstruct dpaa_fq *tmp;\r\nstruct dpaa_fq *fq;\r\nu32 first_fqid = 0;\r\nu32 last_fqid = 0;\r\nssize_t bytes = 0;\r\nchar *str;\r\nint i = 0;\r\nlist_for_each_entry_safe(fq, tmp, &priv->dpaa_fq_list, list) {\r\nswitch (fq->fq_type) {\r\ncase FQ_TYPE_RX_DEFAULT:\r\nstr = "Rx default";\r\nbreak;\r\ncase FQ_TYPE_RX_ERROR:\r\nstr = "Rx error";\r\nbreak;\r\ncase FQ_TYPE_TX_CONFIRM:\r\nstr = "Tx default confirmation";\r\nbreak;\r\ncase FQ_TYPE_TX_CONF_MQ:\r\nstr = "Tx confirmation (mq)";\r\nbreak;\r\ncase FQ_TYPE_TX_ERROR:\r\nstr = "Tx error";\r\nbreak;\r\ncase FQ_TYPE_TX:\r\nstr = "Tx";\r\nbreak;\r\ndefault:\r\nstr = "Unknown";\r\n}\r\nif (prev && (abs(fq->fqid - prev->fqid) != 1 ||\r\nstr != prevstr)) {\r\nif (last_fqid == first_fqid)\r\nbytes += sprintf(buf + bytes,\r\n"%s: %d\n", prevstr, prev->fqid);\r\nelse\r\nbytes += sprintf(buf + bytes,\r\n"%s: %d - %d\n", prevstr,\r\nfirst_fqid, last_fqid);\r\n}\r\nif (prev && abs(fq->fqid - prev->fqid) == 1 &&\r\nstr == prevstr) {\r\nlast_fqid = fq->fqid;\r\n} else {\r\nfirst_fqid = fq->fqid;\r\nlast_fqid = fq->fqid;\r\n}\r\nprev = fq;\r\nprevstr = str;\r\ni++;\r\n}\r\nif (prev) {\r\nif (last_fqid == first_fqid)\r\nbytes += sprintf(buf + bytes, "%s: %d\n", prevstr,\r\nprev->fqid);\r\nelse\r\nbytes += sprintf(buf + bytes, "%s: %d - %d\n", prevstr,\r\nfirst_fqid, last_fqid);\r\n}\r\nreturn bytes;\r\n}\r\nstatic ssize_t dpaa_eth_show_bpids(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\r\nssize_t bytes = 0;\r\nint i = 0;\r\nfor (i = 0; i < DPAA_BPS_NUM; i++)\r\nbytes += snprintf(buf + bytes, PAGE_SIZE - bytes, "%u\n",\r\npriv->dpaa_bps[i]->bpid);\r\nreturn bytes;\r\n}\r\nvoid dpaa_eth_sysfs_init(struct device *dev)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(dpaa_eth_attrs); i++)\r\nif (device_create_file(dev, &dpaa_eth_attrs[i])) {\r\ndev_err(dev, "Error creating sysfs file\n");\r\nwhile (i > 0)\r\ndevice_remove_file(dev, &dpaa_eth_attrs[--i]);\r\nreturn;\r\n}\r\n}\r\nvoid dpaa_eth_sysfs_remove(struct device *dev)\r\n{\r\nint i;\r\nfor (i = 0; i < ARRAY_SIZE(dpaa_eth_attrs); i++)\r\ndevice_remove_file(dev, &dpaa_eth_attrs[i]);\r\n}
