static bool qdf2400_erratum_44_present(struct acpi_table_header *h)\r\n{\r\nif (memcmp(h->oem_id, "QCOM ", ACPI_OEM_ID_SIZE))\r\nreturn false;\r\nif (!memcmp(h->oem_table_id, "QDF2432 ", ACPI_OEM_TABLE_ID_SIZE))\r\nreturn true;\r\nif (!memcmp(h->oem_table_id, "QDF2400 ", ACPI_OEM_TABLE_ID_SIZE) &&\r\nh->oem_revision == 1)\r\nreturn true;\r\nreturn false;\r\n}\r\nint __init parse_spcr(bool earlycon)\r\n{\r\nstatic char opts[64];\r\nstruct acpi_table_spcr *table;\r\nacpi_status status;\r\nchar *uart;\r\nchar *iotype;\r\nint baud_rate;\r\nint err;\r\nif (acpi_disabled)\r\nreturn -ENODEV;\r\nstatus = acpi_get_table(ACPI_SIG_SPCR, 0,\r\n(struct acpi_table_header **)&table);\r\nif (ACPI_FAILURE(status))\r\nreturn -ENOENT;\r\nif (table->header.revision < 2) {\r\nerr = -ENOENT;\r\npr_err("wrong table version\n");\r\ngoto done;\r\n}\r\niotype = table->serial_port.space_id == ACPI_ADR_SPACE_SYSTEM_MEMORY ?\r\n"mmio" : "io";\r\nswitch (table->interface_type) {\r\ncase ACPI_DBG2_ARM_SBSA_32BIT:\r\niotype = "mmio32";\r\ncase ACPI_DBG2_ARM_PL011:\r\ncase ACPI_DBG2_ARM_SBSA_GENERIC:\r\ncase ACPI_DBG2_BCM2835:\r\nuart = "pl011";\r\nbreak;\r\ncase ACPI_DBG2_16550_COMPATIBLE:\r\ncase ACPI_DBG2_16550_SUBSET:\r\nuart = "uart";\r\nbreak;\r\ndefault:\r\nerr = -ENOENT;\r\ngoto done;\r\n}\r\nswitch (table->baud_rate) {\r\ncase 3:\r\nbaud_rate = 9600;\r\nbreak;\r\ncase 4:\r\nbaud_rate = 19200;\r\nbreak;\r\ncase 6:\r\nbaud_rate = 57600;\r\nbreak;\r\ncase 7:\r\nbaud_rate = 115200;\r\nbreak;\r\ndefault:\r\nerr = -ENOENT;\r\ngoto done;\r\n}\r\nif (qdf2400_erratum_44_present(&table->header))\r\nuart = "qdf2400_e44";\r\nsnprintf(opts, sizeof(opts), "%s,%s,0x%llx,%d", uart, iotype,\r\ntable->serial_port.address, baud_rate);\r\npr_info("console: %s\n", opts);\r\nif (earlycon)\r\nsetup_earlycon(opts);\r\nerr = add_preferred_console(uart, 0, opts + strlen(uart) + 1);\r\ndone:\r\nacpi_put_table((struct acpi_table_header *)table);\r\nreturn err;\r\n}
