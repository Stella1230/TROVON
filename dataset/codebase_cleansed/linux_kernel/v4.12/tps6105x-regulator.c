static int tps6105x_regulator_probe(struct platform_device *pdev)\r\n{\r\nstruct tps6105x *tps6105x = dev_get_platdata(&pdev->dev);\r\nstruct tps6105x_platform_data *pdata = tps6105x->pdata;\r\nstruct regulator_config config = { };\r\nint ret;\r\nif (pdata->mode != TPS6105X_MODE_VOLTAGE) {\r\ndev_info(&pdev->dev,\r\n"chip not in voltage mode mode, exit probe\n");\r\nreturn 0;\r\n}\r\nconfig.dev = &tps6105x->client->dev;\r\nconfig.init_data = pdata->regulator_data;\r\nconfig.driver_data = tps6105x;\r\nconfig.regmap = tps6105x->regmap;\r\ntps6105x->regulator = devm_regulator_register(&pdev->dev,\r\n&tps6105x_regulator_desc,\r\n&config);\r\nif (IS_ERR(tps6105x->regulator)) {\r\nret = PTR_ERR(tps6105x->regulator);\r\ndev_err(&tps6105x->client->dev,\r\n"failed to register regulator\n");\r\nreturn ret;\r\n}\r\nplatform_set_drvdata(pdev, tps6105x);\r\nreturn 0;\r\n}\r\nstatic __init int tps6105x_regulator_init(void)\r\n{\r\nreturn platform_driver_register(&tps6105x_regulator_driver);\r\n}\r\nstatic __exit void tps6105x_regulator_exit(void)\r\n{\r\nplatform_driver_unregister(&tps6105x_regulator_driver);\r\n}
