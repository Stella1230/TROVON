__init void scan_elf_aux( char **envp)\r\n{\r\nlong page_size = 0;\r\nelf_auxv_t * auxv;\r\nwhile ( *envp++ != NULL) ;\r\nfor ( auxv = (elf_auxv_t *)envp; auxv->a_type != AT_NULL; auxv++) {\r\nswitch ( auxv->a_type ) {\r\ncase AT_SYSINFO:\r\n__kernel_vsyscall = auxv->a_un.a_val;\r\nif (__kernel_vsyscall < (unsigned long) envp)\r\n__kernel_vsyscall = 0;\r\nbreak;\r\ncase AT_SYSINFO_EHDR:\r\nvsyscall_ehdr = auxv->a_un.a_val;\r\nif (vsyscall_ehdr < (unsigned long) envp)\r\nvsyscall_ehdr = 0;\r\nbreak;\r\ncase AT_HWCAP:\r\nelf_aux_hwcap = auxv->a_un.a_val;\r\nbreak;\r\ncase AT_PLATFORM:\r\nelf_aux_platform =\r\n(char *) (long) auxv->a_un.a_val;\r\nbreak;\r\ncase AT_PAGESZ:\r\npage_size = auxv->a_un.a_val;\r\nbreak;\r\n}\r\n}\r\nif ( ! __kernel_vsyscall || ! vsyscall_ehdr ||\r\n! elf_aux_hwcap || ! elf_aux_platform ||\r\n! page_size || (vsyscall_ehdr % page_size) ) {\r\n__kernel_vsyscall = 0;\r\nvsyscall_ehdr = 0;\r\nelf_aux_hwcap = 0;\r\nelf_aux_platform = "i586";\r\n}\r\nelse {\r\nvsyscall_end = vsyscall_ehdr + page_size;\r\n}\r\n}
