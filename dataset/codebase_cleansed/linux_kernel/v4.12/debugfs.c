bool kvm_arch_has_vcpu_debugfs(void)\r\n{\r\nreturn true;\r\n}\r\nstatic int vcpu_get_tsc_offset(void *data, u64 *val)\r\n{\r\nstruct kvm_vcpu *vcpu = (struct kvm_vcpu *) data;\r\n*val = vcpu->arch.tsc_offset;\r\nreturn 0;\r\n}\r\nstatic int vcpu_get_tsc_scaling_ratio(void *data, u64 *val)\r\n{\r\nstruct kvm_vcpu *vcpu = (struct kvm_vcpu *) data;\r\n*val = vcpu->arch.tsc_scaling_ratio;\r\nreturn 0;\r\n}\r\nstatic int vcpu_get_tsc_scaling_frac_bits(void *data, u64 *val)\r\n{\r\n*val = kvm_tsc_scaling_ratio_frac_bits;\r\nreturn 0;\r\n}\r\nint kvm_arch_create_vcpu_debugfs(struct kvm_vcpu *vcpu)\r\n{\r\nstruct dentry *ret;\r\nret = debugfs_create_file("tsc-offset", 0444,\r\nvcpu->debugfs_dentry,\r\nvcpu, &vcpu_tsc_offset_fops);\r\nif (!ret)\r\nreturn -ENOMEM;\r\nif (kvm_has_tsc_control) {\r\nret = debugfs_create_file("tsc-scaling-ratio", 0444,\r\nvcpu->debugfs_dentry,\r\nvcpu, &vcpu_tsc_scaling_fops);\r\nif (!ret)\r\nreturn -ENOMEM;\r\nret = debugfs_create_file("tsc-scaling-ratio-frac-bits", 0444,\r\nvcpu->debugfs_dentry,\r\nvcpu, &vcpu_tsc_scaling_frac_fops);\r\nif (!ret)\r\nreturn -ENOMEM;\r\n}\r\nreturn 0;\r\n}
