static inline struct xfs_icreate_item *ICR_ITEM(struct xfs_log_item *lip)\r\n{\r\nreturn container_of(lip, struct xfs_icreate_item, ic_item);\r\n}\r\nSTATIC void\r\nxfs_icreate_item_size(\r\nstruct xfs_log_item *lip,\r\nint *nvecs,\r\nint *nbytes)\r\n{\r\n*nvecs += 1;\r\n*nbytes += sizeof(struct xfs_icreate_log);\r\n}\r\nSTATIC void\r\nxfs_icreate_item_format(\r\nstruct xfs_log_item *lip,\r\nstruct xfs_log_vec *lv)\r\n{\r\nstruct xfs_icreate_item *icp = ICR_ITEM(lip);\r\nstruct xfs_log_iovec *vecp = NULL;\r\nxlog_copy_iovec(lv, &vecp, XLOG_REG_TYPE_ICREATE,\r\n&icp->ic_format,\r\nsizeof(struct xfs_icreate_log));\r\n}\r\nSTATIC void\r\nxfs_icreate_item_pin(\r\nstruct xfs_log_item *lip)\r\n{\r\n}\r\nSTATIC void\r\nxfs_icreate_item_unpin(\r\nstruct xfs_log_item *lip,\r\nint remove)\r\n{\r\n}\r\nSTATIC void\r\nxfs_icreate_item_unlock(\r\nstruct xfs_log_item *lip)\r\n{\r\nstruct xfs_icreate_item *icp = ICR_ITEM(lip);\r\nif (icp->ic_item.li_flags & XFS_LI_ABORTED)\r\nkmem_zone_free(xfs_icreate_zone, icp);\r\nreturn;\r\n}\r\nSTATIC xfs_lsn_t\r\nxfs_icreate_item_committed(\r\nstruct xfs_log_item *lip,\r\nxfs_lsn_t lsn)\r\n{\r\nstruct xfs_icreate_item *icp = ICR_ITEM(lip);\r\nkmem_zone_free(xfs_icreate_zone, icp);\r\nreturn (xfs_lsn_t)-1;\r\n}\r\nSTATIC uint\r\nxfs_icreate_item_push(\r\nstruct xfs_log_item *lip,\r\nstruct list_head *buffer_list)\r\n{\r\nASSERT(0);\r\nreturn XFS_ITEM_SUCCESS;\r\n}\r\nSTATIC void\r\nxfs_icreate_item_committing(\r\nstruct xfs_log_item *lip,\r\nxfs_lsn_t lsn)\r\n{\r\n}\r\nvoid\r\nxfs_icreate_log(\r\nstruct xfs_trans *tp,\r\nxfs_agnumber_t agno,\r\nxfs_agblock_t agbno,\r\nunsigned int count,\r\nunsigned int inode_size,\r\nxfs_agblock_t length,\r\nunsigned int generation)\r\n{\r\nstruct xfs_icreate_item *icp;\r\nicp = kmem_zone_zalloc(xfs_icreate_zone, KM_SLEEP);\r\nxfs_log_item_init(tp->t_mountp, &icp->ic_item, XFS_LI_ICREATE,\r\n&xfs_icreate_item_ops);\r\nicp->ic_format.icl_type = XFS_LI_ICREATE;\r\nicp->ic_format.icl_size = 1;\r\nicp->ic_format.icl_ag = cpu_to_be32(agno);\r\nicp->ic_format.icl_agbno = cpu_to_be32(agbno);\r\nicp->ic_format.icl_count = cpu_to_be32(count);\r\nicp->ic_format.icl_isize = cpu_to_be32(inode_size);\r\nicp->ic_format.icl_length = cpu_to_be32(length);\r\nicp->ic_format.icl_gen = cpu_to_be32(generation);\r\nxfs_trans_add_item(tp, &icp->ic_item);\r\ntp->t_flags |= XFS_TRANS_DIRTY;\r\nicp->ic_item.li_desc->lid_flags |= XFS_LID_DIRTY;\r\n}
