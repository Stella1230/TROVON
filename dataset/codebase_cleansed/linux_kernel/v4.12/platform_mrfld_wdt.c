static int tangier_probe(struct platform_device *pdev)\r\n{\r\nstruct irq_alloc_info info;\r\nstruct intel_mid_wdt_pdata *pdata = pdev->dev.platform_data;\r\nint gsi, irq;\r\nif (!pdata)\r\nreturn -EINVAL;\r\ngsi = pdata->irq;\r\nioapic_set_alloc_attr(&info, cpu_to_node(0), 1, 0);\r\nirq = mp_map_gsi_to_irq(gsi, IOAPIC_MAP_ALLOC, &info);\r\nif (irq < 0) {\r\ndev_warn(&pdev->dev, "cannot find interrupt %d in ioapic\n", gsi);\r\nreturn irq;\r\n}\r\nreturn 0;\r\n}\r\nstatic int wdt_scu_status_change(struct notifier_block *nb,\r\nunsigned long code, void *data)\r\n{\r\nif (code == SCU_DOWN) {\r\nplatform_device_unregister(&wdt_dev);\r\nreturn 0;\r\n}\r\nreturn platform_device_register(&wdt_dev);\r\n}\r\nstatic int __init register_mid_wdt(void)\r\n{\r\nif (intel_mid_identify_cpu() != INTEL_MID_CPU_CHIP_TANGIER)\r\nreturn -ENODEV;\r\nwdt_dev.dev.platform_data = &tangier_pdata;\r\nintel_scu_notifier_add(&wdt_scu_notifier);\r\nreturn 0;\r\n}
