unsigned short sii164GetVendorID(void)\r\n{\r\nunsigned short vendorID;\r\nvendorID = ((unsigned short) i2cReadReg(SII164_I2C_ADDRESS, SII164_VENDOR_ID_HIGH) << 8) |\r\n(unsigned short) i2cReadReg(SII164_I2C_ADDRESS, SII164_VENDOR_ID_LOW);\r\nreturn vendorID;\r\n}\r\nunsigned short sii164GetDeviceID(void)\r\n{\r\nunsigned short deviceID;\r\ndeviceID = ((unsigned short) i2cReadReg(SII164_I2C_ADDRESS, SII164_DEVICE_ID_HIGH) << 8) |\r\n(unsigned short) i2cReadReg(SII164_I2C_ADDRESS, SII164_DEVICE_ID_LOW);\r\nreturn deviceID;\r\n}\r\nlong sii164InitChip(\r\nunsigned char edgeSelect,\r\nunsigned char busSelect,\r\nunsigned char dualEdgeClkSelect,\r\nunsigned char hsyncEnable,\r\nunsigned char vsyncEnable,\r\nunsigned char deskewEnable,\r\nunsigned char deskewSetting,\r\nunsigned char continuousSyncEnable,\r\nunsigned char pllFilterEnable,\r\nunsigned char pllFilterValue\r\n)\r\n{\r\nunsigned char config;\r\n#ifdef USE_HW_I2C\r\nsm750_hw_i2c_init(1);\r\n#else\r\nsm750_sw_i2c_init(DEFAULT_I2C_SCL, DEFAULT_I2C_SDA);\r\n#endif\r\nif ((sii164GetVendorID() == SII164_VENDOR_ID) && (sii164GetDeviceID() == SII164_DEVICE_ID)) {\r\nif (edgeSelect == 0)\r\nconfig = SII164_CONFIGURATION_LATCH_FALLING;\r\nelse\r\nconfig = SII164_CONFIGURATION_LATCH_RISING;\r\nif (busSelect == 0)\r\nconfig |= SII164_CONFIGURATION_BUS_12BITS;\r\nelse\r\nconfig |= SII164_CONFIGURATION_BUS_24BITS;\r\nif (dualEdgeClkSelect == 0)\r\nconfig |= SII164_CONFIGURATION_CLOCK_SINGLE;\r\nelse\r\nconfig |= SII164_CONFIGURATION_CLOCK_DUAL;\r\nif (hsyncEnable == 0)\r\nconfig |= SII164_CONFIGURATION_HSYNC_FORCE_LOW;\r\nelse\r\nconfig |= SII164_CONFIGURATION_HSYNC_AS_IS;\r\nif (vsyncEnable == 0)\r\nconfig |= SII164_CONFIGURATION_VSYNC_FORCE_LOW;\r\nelse\r\nconfig |= SII164_CONFIGURATION_VSYNC_AS_IS;\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION, config);\r\nif (deskewEnable == 0)\r\nconfig = SII164_DESKEW_DISABLE;\r\nelse\r\nconfig = SII164_DESKEW_ENABLE;\r\nswitch (deskewSetting) {\r\ncase 0:\r\nconfig |= SII164_DESKEW_1_STEP;\r\nbreak;\r\ncase 1:\r\nconfig |= SII164_DESKEW_2_STEP;\r\nbreak;\r\ncase 2:\r\nconfig |= SII164_DESKEW_3_STEP;\r\nbreak;\r\ncase 3:\r\nconfig |= SII164_DESKEW_4_STEP;\r\nbreak;\r\ncase 4:\r\nconfig |= SII164_DESKEW_5_STEP;\r\nbreak;\r\ncase 5:\r\nconfig |= SII164_DESKEW_6_STEP;\r\nbreak;\r\ncase 6:\r\nconfig |= SII164_DESKEW_7_STEP;\r\nbreak;\r\ncase 7:\r\nconfig |= SII164_DESKEW_8_STEP;\r\nbreak;\r\n}\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_DESKEW, config);\r\nif (continuousSyncEnable == 0)\r\nconfig = SII164_PLL_FILTER_SYNC_CONTINUOUS_DISABLE;\r\nelse\r\nconfig = SII164_PLL_FILTER_SYNC_CONTINUOUS_ENABLE;\r\nif (pllFilterEnable == 0)\r\nconfig |= SII164_PLL_FILTER_DISABLE;\r\nelse\r\nconfig |= SII164_PLL_FILTER_ENABLE;\r\nconfig |= ((pllFilterValue & 0x07) << 1);\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_PLL, config);\r\nconfig = i2cReadReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION);\r\nconfig |= SII164_CONFIGURATION_POWER_NORMAL;\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION, config);\r\nreturn 0;\r\n}\r\nreturn -1;\r\n}\r\nvoid sii164ResetChip(void)\r\n{\r\nsii164SetPower(0);\r\nsii164SetPower(1);\r\n}\r\nchar *sii164GetChipString(void)\r\n{\r\nreturn gDviCtrlChipName;\r\n}\r\nvoid sii164SetPower(\r\nunsigned char powerUp\r\n)\r\n{\r\nunsigned char config;\r\nconfig = i2cReadReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION);\r\nif (powerUp == 1) {\r\nconfig &= ~SII164_CONFIGURATION_POWER_MASK;\r\nconfig |= SII164_CONFIGURATION_POWER_NORMAL;\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION, config);\r\n} else {\r\nconfig &= ~SII164_CONFIGURATION_POWER_MASK;\r\nconfig |= SII164_CONFIGURATION_POWER_DOWN;\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_CONFIGURATION, config);\r\n}\r\n}\r\nstatic void sii164SelectHotPlugDetectionMode(\r\nsii164_hot_plug_mode_t hotPlugMode\r\n)\r\n{\r\nunsigned char detectReg;\r\ndetectReg = i2cReadReg(SII164_I2C_ADDRESS, SII164_DETECT) & ~SII164_DETECT_MONITOR_SENSE_OUTPUT_FLAG;\r\nswitch (hotPlugMode) {\r\ncase SII164_HOTPLUG_DISABLE:\r\ndetectReg |= SII164_DETECT_MONITOR_SENSE_OUTPUT_HIGH;\r\nbreak;\r\ncase SII164_HOTPLUG_USE_MDI:\r\ndetectReg &= ~SII164_DETECT_INTERRUPT_MASK;\r\ndetectReg |= SII164_DETECT_INTERRUPT_BY_HTPLG_PIN;\r\ndetectReg |= SII164_DETECT_MONITOR_SENSE_OUTPUT_MDI;\r\nbreak;\r\ncase SII164_HOTPLUG_USE_RSEN:\r\ndetectReg |= SII164_DETECT_MONITOR_SENSE_OUTPUT_RSEN;\r\nbreak;\r\ncase SII164_HOTPLUG_USE_HTPLG:\r\ndetectReg |= SII164_DETECT_MONITOR_SENSE_OUTPUT_HTPLG;\r\nbreak;\r\n}\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_DETECT, detectReg);\r\n}\r\nvoid sii164EnableHotPlugDetection(\r\nunsigned char enableHotPlug\r\n)\r\n{\r\nunsigned char detectReg;\r\ndetectReg = i2cReadReg(SII164_I2C_ADDRESS, SII164_DETECT);\r\nif (enableHotPlug != 0)\r\nsii164SelectHotPlugDetectionMode(SII164_HOTPLUG_USE_MDI);\r\nelse\r\nsii164SelectHotPlugDetectionMode(SII164_HOTPLUG_DISABLE);\r\n}\r\nunsigned char sii164IsConnected(void)\r\n{\r\nunsigned char hotPlugValue;\r\nhotPlugValue = i2cReadReg(SII164_I2C_ADDRESS, SII164_DETECT) & SII164_DETECT_HOT_PLUG_STATUS_MASK;\r\nif (hotPlugValue == SII164_DETECT_HOT_PLUG_STATUS_ON)\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nunsigned char sii164CheckInterrupt(void)\r\n{\r\nunsigned char detectReg;\r\ndetectReg = i2cReadReg(SII164_I2C_ADDRESS, SII164_DETECT) & SII164_DETECT_MONITOR_STATE_MASK;\r\nif (detectReg == SII164_DETECT_MONITOR_STATE_CHANGE)\r\nreturn 1;\r\nelse\r\nreturn 0;\r\n}\r\nvoid sii164ClearInterrupt(void)\r\n{\r\nunsigned char detectReg;\r\ndetectReg = i2cReadReg(SII164_I2C_ADDRESS, SII164_DETECT);\r\ni2cWriteReg(SII164_I2C_ADDRESS, SII164_DETECT, detectReg | SII164_DETECT_MONITOR_STATE_CLEAR);\r\n}
