static void early_init_transmeta(struct cpuinfo_x86 *c)\r\n{\r\nu32 xlvl;\r\nxlvl = cpuid_eax(0x80860000);\r\nif ((xlvl & 0xffff0000) == 0x80860000) {\r\nif (xlvl >= 0x80860001)\r\nc->x86_capability[CPUID_8086_0001_EDX] = cpuid_edx(0x80860001);\r\n}\r\n}\r\nstatic void init_transmeta(struct cpuinfo_x86 *c)\r\n{\r\nunsigned int cap_mask, uk, max, dummy;\r\nunsigned int cms_rev1, cms_rev2;\r\nunsigned int cpu_rev, cpu_freq = 0, cpu_flags, new_cpu_rev;\r\nchar cpu_info[65];\r\nearly_init_transmeta(c);\r\ncpu_detect_cache_sizes(c);\r\nmax = cpuid_eax(0x80860000);\r\ncpu_rev = 0;\r\nif (max >= 0x80860001) {\r\ncpuid(0x80860001, &dummy, &cpu_rev, &cpu_freq, &cpu_flags);\r\nif (cpu_rev != 0x02000000) {\r\npr_info("CPU: Processor revision %u.%u.%u.%u, %u MHz\n",\r\n(cpu_rev >> 24) & 0xff,\r\n(cpu_rev >> 16) & 0xff,\r\n(cpu_rev >> 8) & 0xff,\r\ncpu_rev & 0xff,\r\ncpu_freq);\r\n}\r\n}\r\nif (max >= 0x80860002) {\r\ncpuid(0x80860002, &new_cpu_rev, &cms_rev1, &cms_rev2, &dummy);\r\nif (cpu_rev == 0x02000000) {\r\npr_info("CPU: Processor revision %08X, %u MHz\n",\r\nnew_cpu_rev, cpu_freq);\r\n}\r\npr_info("CPU: Code Morphing Software revision %u.%u.%u-%u-%u\n",\r\n(cms_rev1 >> 24) & 0xff,\r\n(cms_rev1 >> 16) & 0xff,\r\n(cms_rev1 >> 8) & 0xff,\r\ncms_rev1 & 0xff,\r\ncms_rev2);\r\n}\r\nif (max >= 0x80860006) {\r\ncpuid(0x80860003,\r\n(void *)&cpu_info[0],\r\n(void *)&cpu_info[4],\r\n(void *)&cpu_info[8],\r\n(void *)&cpu_info[12]);\r\ncpuid(0x80860004,\r\n(void *)&cpu_info[16],\r\n(void *)&cpu_info[20],\r\n(void *)&cpu_info[24],\r\n(void *)&cpu_info[28]);\r\ncpuid(0x80860005,\r\n(void *)&cpu_info[32],\r\n(void *)&cpu_info[36],\r\n(void *)&cpu_info[40],\r\n(void *)&cpu_info[44]);\r\ncpuid(0x80860006,\r\n(void *)&cpu_info[48],\r\n(void *)&cpu_info[52],\r\n(void *)&cpu_info[56],\r\n(void *)&cpu_info[60]);\r\ncpu_info[64] = '\0';\r\npr_info("CPU: %s\n", cpu_info);\r\n}\r\nrdmsr(0x80860004, cap_mask, uk);\r\nwrmsr(0x80860004, ~0, uk);\r\nc->x86_capability[CPUID_1_EDX] = cpuid_edx(0x00000001);\r\nwrmsr(0x80860004, cap_mask, uk);\r\nset_cpu_cap(c, X86_FEATURE_CONSTANT_TSC);\r\n#ifdef CONFIG_SYSCTL\r\nrandomize_va_space = 0;\r\n#endif\r\n}
