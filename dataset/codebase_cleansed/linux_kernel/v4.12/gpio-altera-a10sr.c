static int altr_a10sr_gpio_get(struct gpio_chip *chip, unsigned int offset)\r\n{\r\nstruct altr_a10sr_gpio *gpio = gpiochip_get_data(chip);\r\nint ret, val;\r\nret = regmap_read(gpio->regmap, ALTR_A10SR_PBDSW_REG, &val);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn !!(val & BIT(offset - ALTR_A10SR_LED_VALID_SHIFT));\r\n}\r\nstatic void altr_a10sr_gpio_set(struct gpio_chip *chip, unsigned int offset,\r\nint value)\r\n{\r\nstruct altr_a10sr_gpio *gpio = gpiochip_get_data(chip);\r\nregmap_update_bits(gpio->regmap, ALTR_A10SR_LED_REG,\r\nBIT(ALTR_A10SR_LED_VALID_SHIFT + offset),\r\nvalue ? BIT(ALTR_A10SR_LED_VALID_SHIFT + offset)\r\n: 0);\r\n}\r\nstatic int altr_a10sr_gpio_direction_input(struct gpio_chip *gc,\r\nunsigned int nr)\r\n{\r\nif (nr >= (ALTR_A10SR_IN_VALID_RANGE_LO - ALTR_A10SR_LED_VALID_SHIFT))\r\nreturn 0;\r\nreturn -EINVAL;\r\n}\r\nstatic int altr_a10sr_gpio_direction_output(struct gpio_chip *gc,\r\nunsigned int nr, int value)\r\n{\r\nif (nr <= (ALTR_A10SR_OUT_VALID_RANGE_HI - ALTR_A10SR_LED_VALID_SHIFT))\r\nreturn 0;\r\nreturn -EINVAL;\r\n}\r\nstatic int altr_a10sr_gpio_probe(struct platform_device *pdev)\r\n{\r\nstruct altr_a10sr_gpio *gpio;\r\nint ret;\r\nstruct altr_a10sr *a10sr = dev_get_drvdata(pdev->dev.parent);\r\ngpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\ngpio->regmap = a10sr->regmap;\r\ngpio->gp = altr_a10sr_gc;\r\ngpio->gp.parent = pdev->dev.parent;\r\ngpio->gp.of_node = pdev->dev.of_node;\r\nret = devm_gpiochip_add_data(&pdev->dev, &gpio->gp, gpio);\r\nif (ret < 0) {\r\ndev_err(&pdev->dev, "Could not register gpiochip, %d\n", ret);\r\nreturn ret;\r\n}\r\nplatform_set_drvdata(pdev, gpio);\r\nreturn 0;\r\n}
