static int exynos5250_clk_suspend(void)\r\n{\r\nsamsung_clk_save(reg_base, exynos5250_save,\r\nARRAY_SIZE(exynos5250_clk_regs));\r\nreturn 0;\r\n}\r\nstatic void exynos5250_clk_resume(void)\r\n{\r\nsamsung_clk_restore(reg_base, exynos5250_save,\r\nARRAY_SIZE(exynos5250_clk_regs));\r\n}\r\nstatic void __init exynos5250_clk_sleep_init(void)\r\n{\r\nexynos5250_save = samsung_clk_alloc_reg_dump(exynos5250_clk_regs,\r\nARRAY_SIZE(exynos5250_clk_regs));\r\nif (!exynos5250_save) {\r\npr_warn("%s: failed to allocate sleep save data, no sleep support!\n",\r\n__func__);\r\nreturn;\r\n}\r\nregister_syscore_ops(&exynos5250_clk_syscore_ops);\r\n}\r\nstatic void __init exynos5250_clk_sleep_init(void) {}\r\nstatic void __init exynos5250_clk_init(struct device_node *np)\r\n{\r\nstruct samsung_clk_provider *ctx;\r\nunsigned int tmp;\r\nif (np) {\r\nreg_base = of_iomap(np, 0);\r\nif (!reg_base)\r\npanic("%s: failed to map registers\n", __func__);\r\n} else {\r\npanic("%s: unable to determine soc\n", __func__);\r\n}\r\nctx = samsung_clk_init(np, reg_base, CLK_NR_CLKS);\r\nsamsung_clk_of_register_fixed_ext(ctx, exynos5250_fixed_rate_ext_clks,\r\nARRAY_SIZE(exynos5250_fixed_rate_ext_clks),\r\next_clk_match);\r\nsamsung_clk_register_mux(ctx, exynos5250_pll_pmux_clks,\r\nARRAY_SIZE(exynos5250_pll_pmux_clks));\r\nif (_get_rate("fin_pll") == 24 * MHZ) {\r\nexynos5250_plls[epll].rate_table = epll_24mhz_tbl;\r\nexynos5250_plls[apll].rate_table = apll_24mhz_tbl;\r\n}\r\nif (_get_rate("mout_vpllsrc") == 24 * MHZ)\r\nexynos5250_plls[vpll].rate_table = vpll_24mhz_tbl;\r\nsamsung_clk_register_pll(ctx, exynos5250_plls,\r\nARRAY_SIZE(exynos5250_plls),\r\nreg_base);\r\nsamsung_clk_register_fixed_rate(ctx, exynos5250_fixed_rate_clks,\r\nARRAY_SIZE(exynos5250_fixed_rate_clks));\r\nsamsung_clk_register_fixed_factor(ctx, exynos5250_fixed_factor_clks,\r\nARRAY_SIZE(exynos5250_fixed_factor_clks));\r\nsamsung_clk_register_mux(ctx, exynos5250_mux_clks,\r\nARRAY_SIZE(exynos5250_mux_clks));\r\nsamsung_clk_register_div(ctx, exynos5250_div_clks,\r\nARRAY_SIZE(exynos5250_div_clks));\r\nsamsung_clk_register_gate(ctx, exynos5250_gate_clks,\r\nARRAY_SIZE(exynos5250_gate_clks));\r\nexynos_register_cpu_clock(ctx, CLK_ARM_CLK, "armclk",\r\nmout_cpu_p[0], mout_cpu_p[1], 0x200,\r\nexynos5250_armclk_d, ARRAY_SIZE(exynos5250_armclk_d),\r\nCLK_CPU_HAS_DIV1);\r\ntmp = (PWR_CTRL1_CORE2_DOWN_RATIO | PWR_CTRL1_CORE1_DOWN_RATIO |\r\nPWR_CTRL1_DIV2_DOWN_EN | PWR_CTRL1_DIV1_DOWN_EN |\r\nPWR_CTRL1_USE_CORE1_WFE | PWR_CTRL1_USE_CORE0_WFE |\r\nPWR_CTRL1_USE_CORE1_WFI | PWR_CTRL1_USE_CORE0_WFI);\r\n__raw_writel(tmp, reg_base + PWR_CTRL1);\r\ntmp = (PWR_CTRL2_DIV2_UP_EN | PWR_CTRL2_DIV1_UP_EN |\r\nPWR_CTRL2_DUR_STANDBY2_VAL | PWR_CTRL2_DUR_STANDBY1_VAL |\r\nPWR_CTRL2_CORE2_UP_RATIO | PWR_CTRL2_CORE1_UP_RATIO);\r\n__raw_writel(tmp, reg_base + PWR_CTRL2);\r\nexynos5250_clk_sleep_init();\r\nsamsung_clk_of_add_provider(np, ctx);\r\npr_info("Exynos5250: clock setup completed, armclk=%ld\n",\r\n_get_rate("div_arm2"));\r\n}
