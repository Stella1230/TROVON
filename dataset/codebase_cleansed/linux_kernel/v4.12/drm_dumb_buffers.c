int drm_mode_create_dumb_ioctl(struct drm_device *dev,\r\nvoid *data, struct drm_file *file_priv)\r\n{\r\nstruct drm_mode_create_dumb *args = data;\r\nu32 cpp, stride, size;\r\nif (!dev->driver->dumb_create)\r\nreturn -ENOSYS;\r\nif (!args->width || !args->height || !args->bpp)\r\nreturn -EINVAL;\r\ncpp = DIV_ROUND_UP(args->bpp, 8);\r\nif (!cpp || cpp > 0xffffffffU / args->width)\r\nreturn -EINVAL;\r\nstride = cpp * args->width;\r\nif (args->height > 0xffffffffU / stride)\r\nreturn -EINVAL;\r\nsize = args->height * stride;\r\nif (PAGE_ALIGN(size) == 0)\r\nreturn -EINVAL;\r\nargs->handle = 0;\r\nargs->pitch = 0;\r\nargs->size = 0;\r\nreturn dev->driver->dumb_create(file_priv, dev, args);\r\n}\r\nint drm_mode_mmap_dumb_ioctl(struct drm_device *dev,\r\nvoid *data, struct drm_file *file_priv)\r\n{\r\nstruct drm_mode_map_dumb *args = data;\r\nif (!dev->driver->dumb_map_offset)\r\nreturn -ENOSYS;\r\nreturn dev->driver->dumb_map_offset(file_priv, dev, args->handle, &args->offset);\r\n}\r\nint drm_mode_destroy_dumb_ioctl(struct drm_device *dev,\r\nvoid *data, struct drm_file *file_priv)\r\n{\r\nstruct drm_mode_destroy_dumb *args = data;\r\nif (!dev->driver->dumb_destroy)\r\nreturn -ENOSYS;\r\nreturn dev->driver->dumb_destroy(file_priv, dev, args->handle);\r\n}
