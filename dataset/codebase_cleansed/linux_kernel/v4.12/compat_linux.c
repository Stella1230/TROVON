static int groups16_to_user(u16 __user *grouplist, struct group_info *group_info)\r\n{\r\nstruct user_namespace *user_ns = current_user_ns();\r\nint i;\r\nu16 group;\r\nkgid_t kgid;\r\nfor (i = 0; i < group_info->ngroups; i++) {\r\nkgid = group_info->gid[i];\r\ngroup = (u16)from_kgid_munged(user_ns, kgid);\r\nif (put_user(group, grouplist+i))\r\nreturn -EFAULT;\r\n}\r\nreturn 0;\r\n}\r\nstatic int groups16_from_user(struct group_info *group_info, u16 __user *grouplist)\r\n{\r\nstruct user_namespace *user_ns = current_user_ns();\r\nint i;\r\nu16 group;\r\nkgid_t kgid;\r\nfor (i = 0; i < group_info->ngroups; i++) {\r\nif (get_user(group, grouplist+i))\r\nreturn -EFAULT;\r\nkgid = make_kgid(user_ns, (gid_t)group);\r\nif (!gid_valid(kgid))\r\nreturn -EINVAL;\r\ngroup_info->gid[i] = kgid;\r\n}\r\nreturn 0;\r\n}\r\nstatic int cp_stat64(struct stat64_emu31 __user *ubuf, struct kstat *stat)\r\n{\r\nstruct stat64_emu31 tmp;\r\nmemset(&tmp, 0, sizeof(tmp));\r\ntmp.st_dev = huge_encode_dev(stat->dev);\r\ntmp.st_ino = stat->ino;\r\ntmp.__st_ino = (u32)stat->ino;\r\ntmp.st_mode = stat->mode;\r\ntmp.st_nlink = (unsigned int)stat->nlink;\r\ntmp.st_uid = from_kuid_munged(current_user_ns(), stat->uid);\r\ntmp.st_gid = from_kgid_munged(current_user_ns(), stat->gid);\r\ntmp.st_rdev = huge_encode_dev(stat->rdev);\r\ntmp.st_size = stat->size;\r\ntmp.st_blksize = (u32)stat->blksize;\r\ntmp.st_blocks = (u32)stat->blocks;\r\ntmp.st_atime = (u32)stat->atime.tv_sec;\r\ntmp.st_mtime = (u32)stat->mtime.tv_sec;\r\ntmp.st_ctime = (u32)stat->ctime.tv_sec;\r\nreturn copy_to_user(ubuf,&tmp,sizeof(tmp)) ? -EFAULT : 0;\r\n}
