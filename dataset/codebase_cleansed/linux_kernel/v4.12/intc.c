void mcf_setimr(int index)\r\n{\r\nu16 imr;\r\nimr = __raw_readw(MCFSIM_IMR);\r\n__raw_writew(imr | (0x1 << index), MCFSIM_IMR);\r\n}\r\nvoid mcf_clrimr(int index)\r\n{\r\nu16 imr;\r\nimr = __raw_readw(MCFSIM_IMR);\r\n__raw_writew(imr & ~(0x1 << index), MCFSIM_IMR);\r\n}\r\nvoid mcf_maskimr(unsigned int mask)\r\n{\r\nu16 imr;\r\nimr = __raw_readw(MCFSIM_IMR);\r\nimr |= mask;\r\n__raw_writew(imr, MCFSIM_IMR);\r\n}\r\nvoid mcf_setimr(int index)\r\n{\r\nu32 imr;\r\nimr = __raw_readl(MCFSIM_IMR);\r\n__raw_writel(imr | (0x1 << index), MCFSIM_IMR);\r\n}\r\nvoid mcf_clrimr(int index)\r\n{\r\nu32 imr;\r\nimr = __raw_readl(MCFSIM_IMR);\r\n__raw_writel(imr & ~(0x1 << index), MCFSIM_IMR);\r\n}\r\nvoid mcf_maskimr(unsigned int mask)\r\n{\r\nu32 imr;\r\nimr = __raw_readl(MCFSIM_IMR);\r\nimr |= mask;\r\n__raw_writel(imr, MCFSIM_IMR);\r\n}\r\nvoid mcf_autovector(int irq)\r\n{\r\n#ifdef MCFSIM_AVR\r\nif ((irq >= EIRQ1) && (irq <= EIRQ7)) {\r\nu8 avec;\r\navec = __raw_readb(MCFSIM_AVR);\r\navec |= (0x1 << (irq - EIRQ1 + 1));\r\n__raw_writeb(avec, MCFSIM_AVR);\r\n}\r\n#endif\r\n}\r\nstatic void intc_irq_mask(struct irq_data *d)\r\n{\r\nif (mcf_irq2imr[d->irq])\r\nmcf_setimr(mcf_irq2imr[d->irq]);\r\n}\r\nstatic void intc_irq_unmask(struct irq_data *d)\r\n{\r\nif (mcf_irq2imr[d->irq])\r\nmcf_clrimr(mcf_irq2imr[d->irq]);\r\n}\r\nstatic int intc_irq_set_type(struct irq_data *d, unsigned int type)\r\n{\r\nreturn 0;\r\n}\r\nvoid __init init_IRQ(void)\r\n{\r\nint irq;\r\nmcf_maskimr(0xffffffff);\r\nfor (irq = 0; (irq < NR_IRQS); irq++) {\r\nirq_set_chip(irq, &intc_irq_chip);\r\nirq_set_irq_type(irq, IRQ_TYPE_LEVEL_HIGH);\r\nirq_set_handler(irq, handle_level_irq);\r\n}\r\n}
