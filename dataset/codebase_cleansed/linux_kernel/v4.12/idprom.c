static void __init display_system_type(unsigned char machtype)\r\n{\r\nregister int i;\r\nfor (i = 0; i < NUM_SUN_MACHINES; i++) {\r\nif(Sun_Machines[i].id_machtype == machtype) {\r\nif (machtype != (SM_SUN4M_OBP | 0x00))\r\npr_info("TYPE: %s\n", Sun_Machines[i].name);\r\nelse {\r\n#if 0\r\nchar sysname[128];\r\nprom_getproperty(prom_root_node, "banner-name",\r\nsysname, sizeof(sysname));\r\npr_info("TYPE: %s\n", sysname);\r\n#endif\r\n}\r\nreturn;\r\n}\r\n}\r\nprom_printf("IDPROM: Bogus id_machtype value, 0x%x\n", machtype);\r\nprom_halt();\r\n}\r\nvoid sun3_get_model(unsigned char* model)\r\n{\r\nregister int i;\r\nfor (i = 0; i < NUM_SUN_MACHINES; i++) {\r\nif(Sun_Machines[i].id_machtype == idprom->id_machtype) {\r\nstrcpy(model, Sun_Machines[i].name);\r\nreturn;\r\n}\r\n}\r\n}\r\nstatic unsigned char __init calc_idprom_cksum(struct idprom *idprom)\r\n{\r\nunsigned char cksum, i, *ptr = (unsigned char *)idprom;\r\nfor (i = cksum = 0; i <= 0x0E; i++)\r\ncksum ^= *ptr++;\r\nreturn cksum;\r\n}\r\nvoid __init idprom_init(void)\r\n{\r\nprom_get_idprom((char *) &idprom_buffer, sizeof(idprom_buffer));\r\nidprom = &idprom_buffer;\r\nif (idprom->id_format != 0x01) {\r\nprom_printf("IDPROM: Unknown format type!\n");\r\nprom_halt();\r\n}\r\nif (idprom->id_cksum != calc_idprom_cksum(idprom)) {\r\nprom_printf("IDPROM: Checksum failure (nvram=%x, calc=%x)!\n",\r\nidprom->id_cksum, calc_idprom_cksum(idprom));\r\nprom_halt();\r\n}\r\ndisplay_system_type(idprom->id_machtype);\r\npr_info("Ethernet address: %pM\n", idprom->id_ethaddr);\r\n}
