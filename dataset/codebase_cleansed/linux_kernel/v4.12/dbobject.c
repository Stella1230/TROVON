void\r\nacpi_db_dump_method_info(acpi_status status, struct acpi_walk_state *walk_state)\r\n{\r\nstruct acpi_thread_state *thread;\r\nif ((status & AE_CODE_MASK) == AE_CODE_CONTROL) {\r\nreturn;\r\n}\r\nif (walk_state->deferred_node) {\r\nacpi_os_printf("Executing subtree for Buffer/Package/Region\n");\r\nreturn;\r\n}\r\nthread = walk_state->thread;\r\nif (!thread) {\r\nreturn;\r\n}\r\nacpi_os_printf("\n");\r\nacpi_db_decode_locals(walk_state);\r\nacpi_os_printf("\n");\r\nacpi_db_decode_arguments(walk_state);\r\nacpi_os_printf("\n");\r\n}\r\nvoid acpi_db_decode_internal_object(union acpi_operand_object *obj_desc)\r\n{\r\nu32 i;\r\nif (!obj_desc) {\r\nacpi_os_printf(" Uninitialized");\r\nreturn;\r\n}\r\nif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) != ACPI_DESC_TYPE_OPERAND) {\r\nacpi_os_printf(" %p [%s]", obj_desc,\r\nacpi_ut_get_descriptor_name(obj_desc));\r\nreturn;\r\n}\r\nacpi_os_printf(" %s", acpi_ut_get_object_type_name(obj_desc));\r\nswitch (obj_desc->common.type) {\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf(" %8.8X%8.8X",\r\nACPI_FORMAT_UINT64(obj_desc->integer.value));\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf("(%u) \"%.60s",\r\nobj_desc->string.length,\r\nobj_desc->string.pointer);\r\nif (obj_desc->string.length > 60) {\r\nacpi_os_printf("...");\r\n} else {\r\nacpi_os_printf("\"");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nacpi_os_printf("(%u)", obj_desc->buffer.length);\r\nfor (i = 0; (i < 8) && (i < obj_desc->buffer.length); i++) {\r\nacpi_os_printf(" %2.2X", obj_desc->buffer.pointer[i]);\r\n}\r\nbreak;\r\ndefault:\r\nacpi_os_printf(" %p", obj_desc);\r\nbreak;\r\n}\r\n}\r\nstatic void acpi_db_decode_node(struct acpi_namespace_node *node)\r\n{\r\nacpi_os_printf("<Node> Name %4.4s",\r\nacpi_ut_get_node_name(node));\r\nif (node->flags & ANOBJ_METHOD_ARG) {\r\nacpi_os_printf(" [Method Arg]");\r\n}\r\nif (node->flags & ANOBJ_METHOD_LOCAL) {\r\nacpi_os_printf(" [Method Local]");\r\n}\r\nswitch (node->type) {\r\ncase ACPI_TYPE_DEVICE:\r\nacpi_os_printf(" Device");\r\nbreak;\r\ncase ACPI_TYPE_THERMAL:\r\nacpi_os_printf(" Thermal Zone");\r\nbreak;\r\ndefault:\r\nacpi_db_decode_internal_object(acpi_ns_get_attached_object\r\n(node));\r\nbreak;\r\n}\r\n}\r\nvoid\r\nacpi_db_display_internal_object(union acpi_operand_object *obj_desc,\r\nstruct acpi_walk_state *walk_state)\r\n{\r\nu8 type;\r\nacpi_os_printf("%p ", obj_desc);\r\nif (!obj_desc) {\r\nacpi_os_printf("<Null Object>\n");\r\nreturn;\r\n}\r\nswitch (ACPI_GET_DESCRIPTOR_TYPE(obj_desc)) {\r\ncase ACPI_DESC_TYPE_PARSER:\r\nacpi_os_printf("<Parser> ");\r\nbreak;\r\ncase ACPI_DESC_TYPE_NAMED:\r\nacpi_db_decode_node((struct acpi_namespace_node *)obj_desc);\r\nbreak;\r\ncase ACPI_DESC_TYPE_OPERAND:\r\ntype = obj_desc->common.type;\r\nif (type > ACPI_TYPE_LOCAL_MAX) {\r\nacpi_os_printf(" Type %X [Invalid Type]", (u32)type);\r\nreturn;\r\n}\r\nswitch (obj_desc->common.type) {\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nacpi_os_printf("[%s] ",\r\nacpi_ut_get_reference_name(obj_desc));\r\nswitch (obj_desc->reference.class) {\r\ncase ACPI_REFCLASS_LOCAL:\r\nacpi_os_printf("%X ",\r\nobj_desc->reference.value);\r\nif (walk_state) {\r\nobj_desc = walk_state->local_variables\r\n[obj_desc->reference.value].object;\r\nacpi_os_printf("%p", obj_desc);\r\nacpi_db_decode_internal_object\r\n(obj_desc);\r\n}\r\nbreak;\r\ncase ACPI_REFCLASS_ARG:\r\nacpi_os_printf("%X ",\r\nobj_desc->reference.value);\r\nif (walk_state) {\r\nobj_desc = walk_state->arguments\r\n[obj_desc->reference.value].object;\r\nacpi_os_printf("%p", obj_desc);\r\nacpi_db_decode_internal_object\r\n(obj_desc);\r\n}\r\nbreak;\r\ncase ACPI_REFCLASS_INDEX:\r\nswitch (obj_desc->reference.target_type) {\r\ncase ACPI_TYPE_BUFFER_FIELD:\r\nacpi_os_printf("%p",\r\nobj_desc->reference.\r\nobject);\r\nacpi_db_decode_internal_object\r\n(obj_desc->reference.object);\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nacpi_os_printf("%p",\r\nobj_desc->reference.\r\nwhere);\r\nif (!obj_desc->reference.where) {\r\nacpi_os_printf\r\n(" Uninitialized WHERE pointer");\r\n} else {\r\nacpi_db_decode_internal_object(*\r\n(obj_desc->\r\nreference.\r\nwhere));\r\n}\r\nbreak;\r\ndefault:\r\nacpi_os_printf\r\n("Unknown index target type");\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_REFCLASS_REFOF:\r\nif (!obj_desc->reference.object) {\r\nacpi_os_printf\r\n("Uninitialized reference subobject pointer");\r\nbreak;\r\n}\r\nswitch (ACPI_GET_DESCRIPTOR_TYPE\r\n(obj_desc->reference.object)) {\r\ncase ACPI_DESC_TYPE_NAMED:\r\nacpi_db_decode_node(obj_desc->reference.\r\nobject);\r\nbreak;\r\ncase ACPI_DESC_TYPE_OPERAND:\r\nacpi_db_decode_internal_object\r\n(obj_desc->reference.object);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nbreak;\r\ncase ACPI_REFCLASS_NAME:\r\nacpi_db_decode_node(obj_desc->reference.node);\r\nbreak;\r\ncase ACPI_REFCLASS_DEBUG:\r\ncase ACPI_REFCLASS_TABLE:\r\nacpi_os_printf("\n");\r\nbreak;\r\ndefault:\r\nacpi_os_printf("%2.2X\n",\r\nobj_desc->reference.class);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nacpi_os_printf("<Obj> ");\r\nacpi_db_decode_internal_object(obj_desc);\r\nbreak;\r\n}\r\nbreak;\r\ndefault:\r\nacpi_os_printf("<Not a valid ACPI Object Descriptor> [%s]",\r\nacpi_ut_get_descriptor_name(obj_desc));\r\nbreak;\r\n}\r\nacpi_os_printf("\n");\r\n}\r\nvoid acpi_db_decode_locals(struct acpi_walk_state *walk_state)\r\n{\r\nu32 i;\r\nunion acpi_operand_object *obj_desc;\r\nstruct acpi_namespace_node *node;\r\nu8 display_locals = FALSE;\r\nobj_desc = walk_state->method_desc;\r\nnode = walk_state->method_node;\r\nif (!node) {\r\nacpi_os_printf\r\n("No method node (Executing subtree for buffer or opregion)\n");\r\nreturn;\r\n}\r\nif (node->type != ACPI_TYPE_METHOD) {\r\nacpi_os_printf("Executing subtree for Buffer/Package/Region\n");\r\nreturn;\r\n}\r\nfor (i = 0; i < ACPI_METHOD_NUM_LOCALS; i++) {\r\nobj_desc = walk_state->local_variables[i].object;\r\nif (obj_desc) {\r\ndisplay_locals = TRUE;\r\nbreak;\r\n}\r\n}\r\nif (display_locals) {\r\nacpi_os_printf\r\n("\nInitialized Local Variables for method [%4.4s]:\n",\r\nacpi_ut_get_node_name(node));\r\nfor (i = 0; i < ACPI_METHOD_NUM_LOCALS; i++) {\r\nobj_desc = walk_state->local_variables[i].object;\r\nif (obj_desc) {\r\nacpi_os_printf(" Local%X: ", i);\r\nacpi_db_display_internal_object(obj_desc,\r\nwalk_state);\r\n}\r\n}\r\n} else {\r\nacpi_os_printf\r\n("No Local Variables are initialized for method [%4.4s]\n",\r\nacpi_ut_get_node_name(node));\r\n}\r\n}\r\nvoid acpi_db_decode_arguments(struct acpi_walk_state *walk_state)\r\n{\r\nu32 i;\r\nunion acpi_operand_object *obj_desc;\r\nstruct acpi_namespace_node *node;\r\nu8 display_args = FALSE;\r\nnode = walk_state->method_node;\r\nobj_desc = walk_state->method_desc;\r\nif (!node) {\r\nacpi_os_printf\r\n("No method node (Executing subtree for buffer or opregion)\n");\r\nreturn;\r\n}\r\nif (node->type != ACPI_TYPE_METHOD) {\r\nacpi_os_printf("Executing subtree for Buffer/Package/Region\n");\r\nreturn;\r\n}\r\nfor (i = 0; i < ACPI_METHOD_NUM_ARGS; i++) {\r\nobj_desc = walk_state->arguments[i].object;\r\nif (obj_desc) {\r\ndisplay_args = TRUE;\r\nbreak;\r\n}\r\n}\r\nif (display_args) {\r\nacpi_os_printf("Initialized Arguments for Method [%4.4s]: "\r\n"(%X arguments defined for method invocation)\n",\r\nacpi_ut_get_node_name(node),\r\nobj_desc->method.param_count);\r\nfor (i = 0; i < ACPI_METHOD_NUM_ARGS; i++) {\r\nobj_desc = walk_state->arguments[i].object;\r\nif (obj_desc) {\r\nacpi_os_printf(" Arg%u: ", i);\r\nacpi_db_display_internal_object(obj_desc,\r\nwalk_state);\r\n}\r\n}\r\n} else {\r\nacpi_os_printf\r\n("No Arguments are initialized for method [%4.4s]\n",\r\nacpi_ut_get_node_name(node));\r\n}\r\n}
