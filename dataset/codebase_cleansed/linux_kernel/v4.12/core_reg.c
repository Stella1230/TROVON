void core_reg_write(int unit, int reg, int thread, unsigned int val)\r\n{\r\nunsigned long flags;\r\nif (unit == TXUCT_ID) {\r\nvoid __iomem *cu_reg = __CU_addr(thread, reg);\r\nmetag_out32(val, cu_reg);\r\nreturn;\r\n}\r\n__global_lock2(flags);\r\nwhile (!(metag_in32(TXUXXRXRQ) & TXUXXRXRQ_DREADY_BIT))\r\nudelay(10);\r\nmetag_out32(val, TXUXXRXDT);\r\nval = UNIT_VAL(unit) | REG_VAL(reg) | THREAD_VAL(thread);\r\nmetag_out32(val, TXUXXRXRQ);\r\nwhile (!(metag_in32(TXUXXRXRQ) & TXUXXRXRQ_DREADY_BIT))\r\nudelay(10);\r\n__global_unlock2(flags);\r\n}\r\nunsigned int core_reg_read(int unit, int reg, int thread)\r\n{\r\nunsigned long flags;\r\nunsigned int val;\r\nif (unit == TXUCT_ID) {\r\nvoid __iomem *cu_reg = __CU_addr(thread, reg);\r\nval = metag_in32(cu_reg);\r\nreturn val;\r\n}\r\n__global_lock2(flags);\r\nwhile (!(metag_in32(TXUXXRXRQ) & TXUXXRXRQ_DREADY_BIT))\r\nudelay(10);\r\nval = (UNIT_VAL(unit) | REG_VAL(reg) | THREAD_VAL(thread) |\r\nTXUXXRXRQ_RDnWR_BIT);\r\nmetag_out32(val, TXUXXRXRQ);\r\nwhile (!(metag_in32(TXUXXRXRQ) & TXUXXRXRQ_DREADY_BIT))\r\nudelay(10);\r\nval = metag_in32(TXUXXRXDT);\r\n__global_unlock2(flags);\r\nreturn val;\r\n}
