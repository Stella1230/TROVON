static int __init rcar_rst_init(void)\r\n{\r\nconst struct of_device_id *match;\r\nconst struct rst_config *cfg;\r\nstruct device_node *np;\r\nvoid __iomem *base;\r\nint error = 0;\r\nnp = of_find_matching_node_and_match(NULL, rcar_rst_matches, &match);\r\nif (!np)\r\nreturn -ENODEV;\r\nbase = of_iomap(np, 0);\r\nif (!base) {\r\npr_warn("%s: Cannot map regs\n", np->full_name);\r\nerror = -ENOMEM;\r\ngoto out_put;\r\n}\r\nrcar_rst_base = base;\r\ncfg = match->data;\r\nsaved_mode = ioread32(base + cfg->modemr);\r\npr_debug("%s: MODE = 0x%08x\n", np->full_name, saved_mode);\r\nout_put:\r\nof_node_put(np);\r\nreturn error;\r\n}\r\nint __init rcar_rst_read_mode_pins(u32 *mode)\r\n{\r\nint error;\r\nif (!rcar_rst_base) {\r\nerror = rcar_rst_init();\r\nif (error)\r\nreturn error;\r\n}\r\n*mode = saved_mode;\r\nreturn 0;\r\n}
