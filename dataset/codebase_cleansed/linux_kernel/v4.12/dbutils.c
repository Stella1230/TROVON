acpi_object_type\r\nacpi_db_match_argument(char *user_argument,\r\nstruct acpi_db_argument_info *arguments)\r\n{\r\nu32 i;\r\nif (!user_argument || user_argument[0] == 0) {\r\nreturn (ACPI_TYPE_NOT_FOUND);\r\n}\r\nfor (i = 0; arguments[i].name; i++) {\r\nif (strstr(ACPI_CAST_PTR(char, arguments[i].name),\r\nACPI_CAST_PTR(char,\r\nuser_argument)) == arguments[i].name) {\r\nreturn (i);\r\n}\r\n}\r\nreturn (ACPI_TYPE_NOT_FOUND);\r\n}\r\nvoid acpi_db_set_output_destination(u32 output_flags)\r\n{\r\nacpi_gbl_db_output_flags = (u8)output_flags;\r\nif ((output_flags & ACPI_DB_REDIRECTABLE_OUTPUT) &&\r\nacpi_gbl_db_output_to_file) {\r\nacpi_dbg_level = acpi_gbl_db_debug_level;\r\n} else {\r\nacpi_dbg_level = acpi_gbl_db_console_debug_level;\r\n}\r\n}\r\nvoid acpi_db_dump_external_object(union acpi_object *obj_desc, u32 level)\r\n{\r\nu32 i;\r\nif (!obj_desc) {\r\nacpi_os_printf("[Null Object]\n");\r\nreturn;\r\n}\r\nfor (i = 0; i < level; i++) {\r\nacpi_os_printf(" ");\r\n}\r\nswitch (obj_desc->type) {\r\ncase ACPI_TYPE_ANY:\r\nacpi_os_printf("[Null Object] (Type=0)\n");\r\nbreak;\r\ncase ACPI_TYPE_INTEGER:\r\nacpi_os_printf("[Integer] = %8.8X%8.8X\n",\r\nACPI_FORMAT_UINT64(obj_desc->integer.value));\r\nbreak;\r\ncase ACPI_TYPE_STRING:\r\nacpi_os_printf("[String] Length %.2X = ",\r\nobj_desc->string.length);\r\nacpi_ut_print_string(obj_desc->string.pointer, ACPI_UINT8_MAX);\r\nacpi_os_printf("\n");\r\nbreak;\r\ncase ACPI_TYPE_BUFFER:\r\nacpi_os_printf("[Buffer] Length %.2X = ",\r\nobj_desc->buffer.length);\r\nif (obj_desc->buffer.length) {\r\nif (obj_desc->buffer.length > 16) {\r\nacpi_os_printf("\n");\r\n}\r\nacpi_ut_debug_dump_buffer(ACPI_CAST_PTR\r\n(u8,\r\nobj_desc->buffer.pointer),\r\nobj_desc->buffer.length,\r\nDB_BYTE_DISPLAY, _COMPONENT);\r\n} else {\r\nacpi_os_printf("\n");\r\n}\r\nbreak;\r\ncase ACPI_TYPE_PACKAGE:\r\nacpi_os_printf("[Package] Contains %u Elements:\n",\r\nobj_desc->package.count);\r\nfor (i = 0; i < obj_desc->package.count; i++) {\r\nacpi_db_dump_external_object(&obj_desc->package.\r\nelements[i], level + 1);\r\n}\r\nbreak;\r\ncase ACPI_TYPE_LOCAL_REFERENCE:\r\nacpi_os_printf("[Object Reference] = ");\r\nacpi_db_display_internal_object(obj_desc->reference.handle,\r\nNULL);\r\nbreak;\r\ncase ACPI_TYPE_PROCESSOR:\r\nacpi_os_printf("[Processor]\n");\r\nbreak;\r\ncase ACPI_TYPE_POWER:\r\nacpi_os_printf("[Power Resource]\n");\r\nbreak;\r\ndefault:\r\nacpi_os_printf("[Unknown Type] %X\n", obj_desc->type);\r\nbreak;\r\n}\r\n}\r\nvoid acpi_db_prep_namestring(char *name)\r\n{\r\nif (!name) {\r\nreturn;\r\n}\r\nacpi_ut_strupr(name);\r\nif (*name == '/') {\r\n*name = '\\';\r\n}\r\nif (ACPI_IS_ROOT_PREFIX(*name)) {\r\nname++;\r\n}\r\nwhile (*name) {\r\nif ((*name == '/') || (*name == '\\')) {\r\n*name = '.';\r\n}\r\nname++;\r\n}\r\n}\r\nstruct acpi_namespace_node *acpi_db_local_ns_lookup(char *name)\r\n{\r\nchar *internal_path;\r\nacpi_status status;\r\nstruct acpi_namespace_node *node = NULL;\r\nacpi_db_prep_namestring(name);\r\nstatus = acpi_ns_internalize_name(name, &internal_path);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_os_printf("Invalid namestring: %s\n", name);\r\nreturn (NULL);\r\n}\r\nstatus = acpi_ns_lookup(NULL, internal_path, ACPI_TYPE_ANY,\r\nACPI_IMODE_EXECUTE,\r\nACPI_NS_NO_UPSEARCH | ACPI_NS_DONT_OPEN_SCOPE,\r\nNULL, &node);\r\nif (ACPI_FAILURE(status)) {\r\nacpi_os_printf("Could not locate name: %s, %s\n",\r\nname, acpi_format_exception(status));\r\n}\r\nACPI_FREE(internal_path);\r\nreturn (node);\r\n}\r\nvoid acpi_db_uint32_to_hex_string(u32 value, char *buffer)\r\n{\r\nint i;\r\nif (value == 0) {\r\nstrcpy(buffer, "0");\r\nreturn;\r\n}\r\nbuffer[8] = '\0';\r\nfor (i = 7; i >= 0; i--) {\r\nbuffer[i] = acpi_gbl_upper_hex_digits[value & 0x0F];\r\nvalue = value >> 4;\r\n}\r\n}\r\nacpi_status acpi_db_second_pass_parse(union acpi_parse_object *root)\r\n{\r\nunion acpi_parse_object *op = root;\r\nunion acpi_parse_object *method;\r\nunion acpi_parse_object *search_op;\r\nunion acpi_parse_object *start_op;\r\nacpi_status status = AE_OK;\r\nu32 base_aml_offset;\r\nstruct acpi_walk_state *walk_state;\r\nACPI_FUNCTION_ENTRY();\r\nacpi_os_printf("Pass two parse ....\n");\r\nwhile (op) {\r\nif (op->common.aml_opcode == AML_METHOD_OP) {\r\nmethod = op;\r\nwalk_state =\r\nacpi_ds_create_walk_state(0, NULL, NULL, NULL);\r\nif (!walk_state) {\r\nreturn (AE_NO_MEMORY);\r\n}\r\nwalk_state->parser_state.aml =\r\nwalk_state->parser_state.aml_start =\r\nmethod->named.data;\r\nwalk_state->parser_state.aml_end =\r\nwalk_state->parser_state.pkg_end =\r\nmethod->named.data + method->named.length;\r\nwalk_state->parser_state.start_scope = op;\r\nwalk_state->descending_callback =\r\nacpi_ds_load1_begin_op;\r\nwalk_state->ascending_callback = acpi_ds_load1_end_op;\r\nstatus = acpi_ps_parse_aml(walk_state);\r\nbase_aml_offset =\r\n(method->common.value.arg)->common.aml_offset + 1;\r\nstart_op = (method->common.value.arg)->common.next;\r\nsearch_op = start_op;\r\nwhile (search_op) {\r\nsearch_op->common.aml_offset += base_aml_offset;\r\nsearch_op =\r\nacpi_ps_get_depth_next(start_op, search_op);\r\n}\r\n}\r\nif (op->common.aml_opcode == AML_REGION_OP) {\r\n}\r\nif (ACPI_FAILURE(status)) {\r\nbreak;\r\n}\r\nop = acpi_ps_get_depth_next(root, op);\r\n}\r\nreturn (status);\r\n}\r\nvoid acpi_db_dump_buffer(u32 address)\r\n{\r\nacpi_os_printf("\nLocation %X:\n", address);\r\nacpi_dbg_level |= ACPI_LV_TABLES;\r\nacpi_ut_debug_dump_buffer(ACPI_TO_POINTER(address), 64, DB_BYTE_DISPLAY,\r\nACPI_UINT32_MAX);\r\n}
