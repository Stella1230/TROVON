static void __init\r\nruffian_init_irq(void)\r\n{\r\n*(vulp)PYXIS_INT_HILO = 0x000000c0UL; mb();\r\n*(vulp)PYXIS_INT_CNFG = 0x00002064UL; mb();\r\noutb(0x11,0xA0);\r\noutb(0x08,0xA1);\r\noutb(0x02,0xA1);\r\noutb(0x01,0xA1);\r\noutb(0xFF,0xA1);\r\noutb(0x11,0x20);\r\noutb(0x00,0x21);\r\noutb(0x04,0x21);\r\noutb(0x01,0x21);\r\noutb(0xFF,0x21);\r\noutb(0x20,0xA0);\r\noutb(0x20,0x20);\r\ninit_i8259a_irqs();\r\ninit_pyxis_irqs(0x16f0000);\r\ncommon_init_isa_dma();\r\n}\r\nstatic void __init\r\nruffian_init_rtc(void)\r\n{\r\noutb(0x34, 0x43);\r\noutb(RUFFIAN_LATCH & 0xff, 0x40);\r\noutb(RUFFIAN_LATCH >> 8, 0x40);\r\noutb(0xb6, 0x43);\r\noutb(0x31, 0x42);\r\noutb(0x13, 0x42);\r\nsetup_irq(0, &timer_irqaction);\r\n}\r\nstatic void\r\nruffian_kill_arch (int mode)\r\n{\r\ncia_kill_arch(mode);\r\n#if 0\r\n*(vuip) PYXIS_RESET = 0x0000dead;\r\nmb();\r\n#endif\r\n}\r\nstatic int __init\r\nruffian_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\r\n{\r\nstatic char irq_tab[11][5] __initdata = {\r\n{-1, -1, -1, -1, -1},\r\n{-1, -1, -1, -1, -1},\r\n{44, 44, 44, 44, 44},\r\n{-1, -1, -1, -1, -1},\r\n{43, 43, 42, 41, 40},\r\n{19, 19, 18, 17, 16},\r\n{31, 31, 30, 29, 28},\r\n{27, 27, 26, 25, 24},\r\n{39, 39, 38, 37, 36},\r\n{35, 35, 34, 33, 32},\r\n{20, 20, 20, 20, 20},\r\n};\r\nconst long min_idsel = 13, max_idsel = 23, irqs_per_slot = 5;\r\nreturn COMMON_TABLE_LOOKUP;\r\n}\r\nstatic u8 __init\r\nruffian_swizzle(struct pci_dev *dev, u8 *pinp)\r\n{\r\nint slot, pin = *pinp;\r\nif (dev->bus->number == 0) {\r\nslot = PCI_SLOT(dev->devfn);\r\n}\r\nelse if (PCI_SLOT(dev->bus->self->devfn) == 13) {\r\nslot = PCI_SLOT(dev->devfn) + 10;\r\n}\r\nelse\r\n{\r\ndo {\r\nif (PCI_SLOT(dev->bus->self->devfn) == 13) {\r\nslot = PCI_SLOT(dev->devfn) + 10;\r\nbreak;\r\n}\r\npin = pci_swizzle_interrupt_pin(dev, pin);\r\ndev = dev->bus->self;\r\nslot = PCI_SLOT(dev->devfn);\r\n} while (dev->bus->self);\r\n}\r\n*pinp = pin;\r\nreturn slot;\r\n}\r\nstatic unsigned long __init\r\nruffian_get_bank_size(unsigned long offset)\r\n{\r\nunsigned long bank_addr, bank, ret = 0;\r\nbank_addr = (unsigned long)PYXIS_MCR + offset;\r\nbank = *(vulp)bank_addr;\r\nif (bank & 0x01) {\r\nstatic unsigned long size[] __initdata = {\r\n0x40000000UL,\r\n0x20000000UL,\r\n0x10000000UL,\r\n0x08000000UL,\r\n0x04000000UL,\r\n0x02000000UL,\r\n0x01000000UL,\r\n0x00800000UL,\r\n0x80000000UL,\r\n};\r\nbank = (bank & 0x1e) >> 1;\r\nif (bank < ARRAY_SIZE(size))\r\nret = size[bank];\r\n}\r\nreturn ret;\r\n}
