static int null_compress(struct crypto_tfm *tfm, const u8 *src,\r\nunsigned int slen, u8 *dst, unsigned int *dlen)\r\n{\r\nif (slen > *dlen)\r\nreturn -EINVAL;\r\nmemcpy(dst, src, slen);\r\n*dlen = slen;\r\nreturn 0;\r\n}\r\nstatic int null_init(struct shash_desc *desc)\r\n{\r\nreturn 0;\r\n}\r\nstatic int null_update(struct shash_desc *desc, const u8 *data,\r\nunsigned int len)\r\n{\r\nreturn 0;\r\n}\r\nstatic int null_final(struct shash_desc *desc, u8 *out)\r\n{\r\nreturn 0;\r\n}\r\nstatic int null_digest(struct shash_desc *desc, const u8 *data,\r\nunsigned int len, u8 *out)\r\n{\r\nreturn 0;\r\n}\r\nstatic int null_hash_setkey(struct crypto_shash *tfm, const u8 *key,\r\nunsigned int keylen)\r\n{ return 0; }\r\nstatic int null_setkey(struct crypto_tfm *tfm, const u8 *key,\r\nunsigned int keylen)\r\n{ return 0; }\r\nstatic void null_crypt(struct crypto_tfm *tfm, u8 *dst, const u8 *src)\r\n{\r\nmemcpy(dst, src, NULL_BLOCK_SIZE);\r\n}\r\nstatic int skcipher_null_crypt(struct blkcipher_desc *desc,\r\nstruct scatterlist *dst,\r\nstruct scatterlist *src, unsigned int nbytes)\r\n{\r\nstruct blkcipher_walk walk;\r\nint err;\r\nblkcipher_walk_init(&walk, dst, src, nbytes);\r\nerr = blkcipher_walk_virt(desc, &walk);\r\nwhile (walk.nbytes) {\r\nif (walk.src.virt.addr != walk.dst.virt.addr)\r\nmemcpy(walk.dst.virt.addr, walk.src.virt.addr,\r\nwalk.nbytes);\r\nerr = blkcipher_walk_done(desc, &walk, 0);\r\n}\r\nreturn err;\r\n}\r\nstruct crypto_skcipher *crypto_get_default_null_skcipher(void)\r\n{\r\nstruct crypto_skcipher *tfm;\r\nmutex_lock(&crypto_default_null_skcipher_lock);\r\ntfm = crypto_default_null_skcipher;\r\nif (!tfm) {\r\ntfm = crypto_alloc_skcipher("ecb(cipher_null)",\r\n0, CRYPTO_ALG_ASYNC);\r\nif (IS_ERR(tfm))\r\ngoto unlock;\r\ncrypto_default_null_skcipher = tfm;\r\n}\r\ncrypto_default_null_skcipher_refcnt++;\r\nunlock:\r\nmutex_unlock(&crypto_default_null_skcipher_lock);\r\nreturn tfm;\r\n}\r\nvoid crypto_put_default_null_skcipher(void)\r\n{\r\nmutex_lock(&crypto_default_null_skcipher_lock);\r\nif (!--crypto_default_null_skcipher_refcnt) {\r\ncrypto_free_skcipher(crypto_default_null_skcipher);\r\ncrypto_default_null_skcipher = NULL;\r\n}\r\nmutex_unlock(&crypto_default_null_skcipher_lock);\r\n}\r\nstatic int __init crypto_null_mod_init(void)\r\n{\r\nint ret = 0;\r\nret = crypto_register_algs(null_algs, ARRAY_SIZE(null_algs));\r\nif (ret < 0)\r\ngoto out;\r\nret = crypto_register_shash(&digest_null);\r\nif (ret < 0)\r\ngoto out_unregister_algs;\r\nreturn 0;\r\nout_unregister_algs:\r\ncrypto_unregister_algs(null_algs, ARRAY_SIZE(null_algs));\r\nout:\r\nreturn ret;\r\n}\r\nstatic void __exit crypto_null_mod_fini(void)\r\n{\r\ncrypto_unregister_shash(&digest_null);\r\ncrypto_unregister_algs(null_algs, ARRAY_SIZE(null_algs));\r\n}
