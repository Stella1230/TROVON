static int syscon_reboot_mode_write(struct reboot_mode_driver *reboot,\r\nunsigned int magic)\r\n{\r\nstruct syscon_reboot_mode *syscon_rbm;\r\nint ret;\r\nsyscon_rbm = container_of(reboot, struct syscon_reboot_mode, reboot);\r\nret = regmap_update_bits(syscon_rbm->map, syscon_rbm->offset,\r\nsyscon_rbm->mask, magic);\r\nif (ret < 0)\r\ndev_err(reboot->dev, "update reboot mode bits failed\n");\r\nreturn ret;\r\n}\r\nstatic int syscon_reboot_mode_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nstruct syscon_reboot_mode *syscon_rbm;\r\nsyscon_rbm = devm_kzalloc(&pdev->dev, sizeof(*syscon_rbm), GFP_KERNEL);\r\nif (!syscon_rbm)\r\nreturn -ENOMEM;\r\nsyscon_rbm->reboot.dev = &pdev->dev;\r\nsyscon_rbm->reboot.write = syscon_reboot_mode_write;\r\nsyscon_rbm->mask = 0xffffffff;\r\nsyscon_rbm->map = syscon_node_to_regmap(pdev->dev.parent->of_node);\r\nif (IS_ERR(syscon_rbm->map))\r\nreturn PTR_ERR(syscon_rbm->map);\r\nif (of_property_read_u32(pdev->dev.of_node, "offset",\r\n&syscon_rbm->offset))\r\nreturn -EINVAL;\r\nof_property_read_u32(pdev->dev.of_node, "mask", &syscon_rbm->mask);\r\nret = devm_reboot_mode_register(&pdev->dev, &syscon_rbm->reboot);\r\nif (ret)\r\ndev_err(&pdev->dev, "can't register reboot mode\n");\r\nreturn ret;\r\n}
