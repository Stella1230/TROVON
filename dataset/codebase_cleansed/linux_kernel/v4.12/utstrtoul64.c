acpi_status acpi_ut_strtoul64(char *string, u32 flags, u64 *return_value)\r\n{\r\nacpi_status status = AE_OK;\r\nu32 base;\r\nACPI_FUNCTION_TRACE_STR(ut_strtoul64, string);\r\nif (!string || !return_value) {\r\nreturn_ACPI_STATUS(AE_BAD_PARAMETER);\r\n}\r\n*return_value = 0;\r\nif (*string == 0) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nwhile (isspace((int)*string)) {\r\nstring++;\r\n}\r\nif (*string == 0) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nif ((*string == ACPI_ASCII_ZERO) &&\r\n(tolower((int)*(string + 1)) == 'x')) {\r\nstring += 2;\r\nif (*string == 0) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\nbase = 16;\r\n}\r\nelse if (flags & ACPI_STRTOUL_BASE16) {\r\nbase = 16;\r\n}\r\nelse {\r\nbase = 10;\r\n}\r\nwhile (*string == ACPI_ASCII_ZERO) {\r\nstring++;\r\nif (*string == 0) {\r\nreturn_ACPI_STATUS(AE_OK);\r\n}\r\n}\r\nif (base == 16) {\r\n*return_value = acpi_ut_strtoul_base16(string, flags);\r\n} else {\r\n*return_value = acpi_ut_strtoul_base10(string, flags);\r\n}\r\nreturn_ACPI_STATUS(status);\r\n}\r\nstatic u64 acpi_ut_strtoul_base10(char *string, u32 flags)\r\n{\r\nint ascii_digit;\r\nu64 next_value;\r\nu64 return_value = 0;\r\nwhile (*string) {\r\nascii_digit = *string;\r\nif (!isdigit(ascii_digit)) {\r\ngoto exit;\r\n}\r\nnext_value =\r\n(return_value * 10) + (ascii_digit - ACPI_ASCII_ZERO);\r\nif (((flags & ACPI_STRTOUL_32BIT) && (next_value > ACPI_UINT32_MAX)) || (next_value < return_value)) {\r\ngoto exit;\r\n}\r\nreturn_value = next_value;\r\nstring++;\r\n}\r\nexit:\r\nreturn (return_value);\r\n}\r\nstatic u64 acpi_ut_strtoul_base16(char *string, u32 flags)\r\n{\r\nint ascii_digit;\r\nu32 valid_digits = 1;\r\nu64 return_value = 0;\r\nwhile (*string) {\r\nif ((valid_digits > 16) ||\r\n((valid_digits > 8) && (flags & ACPI_STRTOUL_32BIT))) {\r\ngoto exit;\r\n}\r\nascii_digit = *string;\r\nif (!isxdigit(ascii_digit)) {\r\ngoto exit;\r\n}\r\nreturn_value =\r\n(return_value << 4) |\r\nacpi_ut_ascii_char_to_hex(ascii_digit);\r\nstring++;\r\nvalid_digits++;\r\n}\r\nexit:\r\nreturn (return_value);\r\n}
