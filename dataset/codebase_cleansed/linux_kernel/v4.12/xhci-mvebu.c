static void xhci_mvebu_mbus_config(void __iomem *base,\r\nconst struct mbus_dram_target_info *dram)\r\n{\r\nint win;\r\nfor (win = 0; win < USB3_MAX_WINDOWS; win++) {\r\nwritel(0, base + USB3_WIN_CTRL(win));\r\nwritel(0, base + USB3_WIN_BASE(win));\r\n}\r\nfor (win = 0; win < dram->num_cs; win++) {\r\nconst struct mbus_dram_window *cs = dram->cs + win;\r\nwritel(((cs->size - 1) & 0xffff0000) | (cs->mbus_attr << 8) |\r\n(dram->mbus_dram_target_id << 4) | 1,\r\nbase + USB3_WIN_CTRL(win));\r\nwritel((cs->base & 0xffff0000), base + USB3_WIN_BASE(win));\r\n}\r\n}\r\nint xhci_mvebu_mbus_init_quirk(struct usb_hcd *hcd)\r\n{\r\nstruct device *dev = hcd->self.controller;\r\nstruct platform_device *pdev = to_platform_device(dev);\r\nstruct resource *res;\r\nvoid __iomem *base;\r\nconst struct mbus_dram_target_info *dram;\r\nres = platform_get_resource(pdev, IORESOURCE_MEM, 1);\r\nif (!res)\r\nreturn -ENODEV;\r\nbase = ioremap(res->start, resource_size(res));\r\nif (!base)\r\nreturn -ENODEV;\r\ndram = mv_mbus_dram_info();\r\nxhci_mvebu_mbus_config(base, dram);\r\niounmap(base);\r\nreturn 0;\r\n}
