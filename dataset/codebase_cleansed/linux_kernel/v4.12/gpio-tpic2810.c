static int tpic2810_get_direction(struct gpio_chip *chip,\r\nunsigned offset)\r\n{\r\nreturn 0;\r\n}\r\nstatic int tpic2810_direction_input(struct gpio_chip *chip,\r\nunsigned offset)\r\n{\r\nreturn -EINVAL;\r\n}\r\nstatic int tpic2810_direction_output(struct gpio_chip *chip,\r\nunsigned offset, int value)\r\n{\r\ntpic2810_set(chip, offset, value);\r\nreturn 0;\r\n}\r\nstatic void tpic2810_set_mask_bits(struct gpio_chip *chip, u8 mask, u8 bits)\r\n{\r\nstruct tpic2810 *gpio = gpiochip_get_data(chip);\r\nu8 buffer;\r\nint err;\r\nmutex_lock(&gpio->lock);\r\nbuffer = gpio->buffer & ~mask;\r\nbuffer |= (mask & bits);\r\nerr = i2c_smbus_write_byte_data(gpio->client, TPIC2810_WS_COMMAND,\r\nbuffer);\r\nif (!err)\r\ngpio->buffer = buffer;\r\nmutex_unlock(&gpio->lock);\r\n}\r\nstatic void tpic2810_set(struct gpio_chip *chip, unsigned offset, int value)\r\n{\r\ntpic2810_set_mask_bits(chip, BIT(offset), value ? BIT(offset) : 0);\r\n}\r\nstatic void tpic2810_set_multiple(struct gpio_chip *chip, unsigned long *mask,\r\nunsigned long *bits)\r\n{\r\ntpic2810_set_mask_bits(chip, *mask, *bits);\r\n}\r\nstatic int tpic2810_probe(struct i2c_client *client,\r\nconst struct i2c_device_id *id)\r\n{\r\nstruct tpic2810 *gpio;\r\nint ret;\r\ngpio = devm_kzalloc(&client->dev, sizeof(*gpio), GFP_KERNEL);\r\nif (!gpio)\r\nreturn -ENOMEM;\r\ni2c_set_clientdata(client, gpio);\r\ngpio->chip = template_chip;\r\ngpio->chip.parent = &client->dev;\r\ngpio->client = client;\r\nmutex_init(&gpio->lock);\r\nret = gpiochip_add_data(&gpio->chip, gpio);\r\nif (ret < 0) {\r\ndev_err(&client->dev, "Unable to register gpiochip\n");\r\nreturn ret;\r\n}\r\nreturn 0;\r\n}\r\nstatic int tpic2810_remove(struct i2c_client *client)\r\n{\r\nstruct tpic2810 *gpio = i2c_get_clientdata(client);\r\ngpiochip_remove(&gpio->chip);\r\nreturn 0;\r\n}
