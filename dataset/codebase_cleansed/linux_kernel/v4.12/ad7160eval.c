static int __init ad7160eval_init(void)\r\n{\r\nprintk(KERN_INFO "%s(): registering device resources\n", __func__);\r\ni2c_register_board_info(0, bfin_i2c_board_info,\r\nARRAY_SIZE(bfin_i2c_board_info));\r\nplatform_add_devices(stamp_devices, ARRAY_SIZE(stamp_devices));\r\nspi_register_board_info(bfin_spi_board_info, ARRAY_SIZE(bfin_spi_board_info));\r\nreturn 0;\r\n}\r\nvoid __init native_machine_early_platform_add_devices(void)\r\n{\r\nprintk(KERN_INFO "register early platform devices\n");\r\nearly_platform_add_devices(ad7160eval_early_devices,\r\nARRAY_SIZE(ad7160eval_early_devices));\r\n}\r\nvoid native_machine_restart(char *cmd)\r\n{\r\nif ((bfin_read_SYSCR() & 0x7) == 0x3)\r\nbfin_reset_boot_spi_cs(P_DEFAULT_BOOT_SPI_CS);\r\n}\r\nint bfin_get_ether_addr(char *addr)\r\n{\r\nu32 ret;\r\nu64 otp_mac;\r\nu32 (*otp_read)(u32 page, u32 flags, u64 *page_content) = (void *)0xEF00001A;\r\nret = otp_read(0xDF, 0x00, &otp_mac);\r\nif (!(ret & 0x1)) {\r\nchar *otp_mac_p = (char *)&otp_mac;\r\nfor (ret = 0; ret < 6; ++ret)\r\naddr[ret] = otp_mac_p[5 - ret];\r\n}\r\nreturn 0;\r\n}
