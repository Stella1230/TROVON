sigset_t\r\ncfs_block_allsigs(void)\r\n{\r\nunsigned long flags;\r\nsigset_t old;\r\nspin_lock_irqsave(&current->sighand->siglock, flags);\r\nold = current->blocked;\r\nsigfillset(&current->blocked);\r\nrecalc_sigpending();\r\nspin_unlock_irqrestore(&current->sighand->siglock, flags);\r\nreturn old;\r\n}\r\nsigset_t cfs_block_sigs(unsigned long sigs)\r\n{\r\nunsigned long flags;\r\nsigset_t old;\r\nspin_lock_irqsave(&current->sighand->siglock, flags);\r\nold = current->blocked;\r\nsigaddsetmask(&current->blocked, sigs);\r\nrecalc_sigpending();\r\nspin_unlock_irqrestore(&current->sighand->siglock, flags);\r\nreturn old;\r\n}\r\nsigset_t cfs_block_sigsinv(unsigned long sigs)\r\n{\r\nunsigned long flags;\r\nsigset_t old;\r\nspin_lock_irqsave(&current->sighand->siglock, flags);\r\nold = current->blocked;\r\nsigaddsetmask(&current->blocked, ~sigs);\r\nrecalc_sigpending();\r\nspin_unlock_irqrestore(&current->sighand->siglock, flags);\r\nreturn old;\r\n}\r\nvoid\r\ncfs_restore_sigs(sigset_t old)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&current->sighand->siglock, flags);\r\ncurrent->blocked = old;\r\nrecalc_sigpending();\r\nspin_unlock_irqrestore(&current->sighand->siglock, flags);\r\n}\r\nvoid\r\ncfs_clear_sigpending(void)\r\n{\r\nunsigned long flags;\r\nspin_lock_irqsave(&current->sighand->siglock, flags);\r\nclear_tsk_thread_flag(current, TIF_SIGPENDING);\r\nspin_unlock_irqrestore(&current->sighand->siglock, flags);\r\n}
