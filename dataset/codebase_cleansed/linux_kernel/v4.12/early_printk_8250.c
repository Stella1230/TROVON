void setup_8250_early_printk_port(unsigned long base, unsigned int reg_shift,\r\nunsigned int timeout)\r\n{\r\nserial8250_base = (void __iomem *)base;\r\nserial8250_reg_shift = reg_shift;\r\nserial8250_tx_timeout = timeout;\r\n}\r\nstatic inline u8 serial_in(int offset)\r\n{\r\nreturn readb(serial8250_base + (offset << serial8250_reg_shift));\r\n}\r\nstatic inline void serial_out(int offset, char value)\r\n{\r\nwriteb(value, serial8250_base + (offset << serial8250_reg_shift));\r\n}\r\nvoid prom_putchar(char c)\r\n{\r\nunsigned int timeout;\r\nint status, bits;\r\nif (!serial8250_base)\r\nreturn;\r\ntimeout = serial8250_tx_timeout;\r\nbits = UART_LSR_TEMT | UART_LSR_THRE;\r\ndo {\r\nstatus = serial_in(UART_LSR);\r\nif (--timeout == 0)\r\nbreak;\r\n} while ((status & bits) != bits);\r\nif (timeout)\r\nserial_out(UART_TX, c);\r\n}
