void\r\nqedf_dbg_err(struct qedf_dbg_ctx *qedf, const char *func, u32 line,\r\nconst char *fmt, ...)\r\n{\r\nva_list va;\r\nstruct va_format vaf;\r\nchar nfunc[32];\r\nmemset(nfunc, 0, sizeof(nfunc));\r\nmemcpy(nfunc, func, sizeof(nfunc) - 1);\r\nva_start(va, fmt);\r\nvaf.fmt = fmt;\r\nvaf.va = &va;\r\nif (likely(qedf) && likely(qedf->pdev))\r\npr_err("[%s]:[%s:%d]:%d: %pV", dev_name(&(qedf->pdev->dev)),\r\nnfunc, line, qedf->host_no, &vaf);\r\nelse\r\npr_err("[0000:00:00.0]:[%s:%d]: %pV", nfunc, line, &vaf);\r\nva_end(va);\r\n}\r\nvoid\r\nqedf_dbg_warn(struct qedf_dbg_ctx *qedf, const char *func, u32 line,\r\nconst char *fmt, ...)\r\n{\r\nva_list va;\r\nstruct va_format vaf;\r\nchar nfunc[32];\r\nmemset(nfunc, 0, sizeof(nfunc));\r\nmemcpy(nfunc, func, sizeof(nfunc) - 1);\r\nva_start(va, fmt);\r\nvaf.fmt = fmt;\r\nvaf.va = &va;\r\nif (!(qedf_debug & QEDF_LOG_WARN))\r\ngoto ret;\r\nif (likely(qedf) && likely(qedf->pdev))\r\npr_warn("[%s]:[%s:%d]:%d: %pV", dev_name(&(qedf->pdev->dev)),\r\nnfunc, line, qedf->host_no, &vaf);\r\nelse\r\npr_warn("[0000:00:00.0]:[%s:%d]: %pV", nfunc, line, &vaf);\r\nret:\r\nva_end(va);\r\n}\r\nvoid\r\nqedf_dbg_notice(struct qedf_dbg_ctx *qedf, const char *func, u32 line,\r\nconst char *fmt, ...)\r\n{\r\nva_list va;\r\nstruct va_format vaf;\r\nchar nfunc[32];\r\nmemset(nfunc, 0, sizeof(nfunc));\r\nmemcpy(nfunc, func, sizeof(nfunc) - 1);\r\nva_start(va, fmt);\r\nvaf.fmt = fmt;\r\nvaf.va = &va;\r\nif (!(qedf_debug & QEDF_LOG_NOTICE))\r\ngoto ret;\r\nif (likely(qedf) && likely(qedf->pdev))\r\npr_notice("[%s]:[%s:%d]:%d: %pV",\r\ndev_name(&(qedf->pdev->dev)), nfunc, line,\r\nqedf->host_no, &vaf);\r\nelse\r\npr_notice("[0000:00:00.0]:[%s:%d]: %pV", nfunc, line, &vaf);\r\nret:\r\nva_end(va);\r\n}\r\nvoid\r\nqedf_dbg_info(struct qedf_dbg_ctx *qedf, const char *func, u32 line,\r\nu32 level, const char *fmt, ...)\r\n{\r\nva_list va;\r\nstruct va_format vaf;\r\nchar nfunc[32];\r\nmemset(nfunc, 0, sizeof(nfunc));\r\nmemcpy(nfunc, func, sizeof(nfunc) - 1);\r\nva_start(va, fmt);\r\nvaf.fmt = fmt;\r\nvaf.va = &va;\r\nif (!(qedf_debug & level))\r\ngoto ret;\r\nif (likely(qedf) && likely(qedf->pdev))\r\npr_info("[%s]:[%s:%d]:%d: %pV", dev_name(&(qedf->pdev->dev)),\r\nnfunc, line, qedf->host_no, &vaf);\r\nelse\r\npr_info("[0000:00:00.0]:[%s:%d]: %pV", nfunc, line, &vaf);\r\nret:\r\nva_end(va);\r\n}\r\nint\r\nqedf_alloc_grc_dump_buf(u8 **buf, uint32_t len)\r\n{\r\n*buf = vmalloc(len);\r\nif (!(*buf))\r\nreturn -ENOMEM;\r\nmemset(*buf, 0, len);\r\nreturn 0;\r\n}\r\nvoid\r\nqedf_free_grc_dump_buf(uint8_t **buf)\r\n{\r\nvfree(*buf);\r\n*buf = NULL;\r\n}\r\nint\r\nqedf_get_grc_dump(struct qed_dev *cdev, const struct qed_common_ops *common,\r\nu8 **buf, uint32_t *grcsize)\r\n{\r\nif (!*buf)\r\nreturn -EINVAL;\r\nreturn common->dbg_grc(cdev, *buf, grcsize);\r\n}\r\nvoid\r\nqedf_uevent_emit(struct Scsi_Host *shost, u32 code, char *msg)\r\n{\r\nchar event_string[40];\r\nchar *envp[] = {event_string, NULL};\r\nmemset(event_string, 0, sizeof(event_string));\r\nswitch (code) {\r\ncase QEDF_UEVENT_CODE_GRCDUMP:\r\nif (msg)\r\nstrncpy(event_string, msg, strlen(msg));\r\nelse\r\nsprintf(event_string, "GRCDUMP=%u", shost->host_no);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\nkobject_uevent_env(&shost->shost_gendev.kobj, KOBJ_CHANGE, envp);\r\n}\r\nint\r\nqedf_create_sysfs_attr(struct Scsi_Host *shost, struct sysfs_bin_attrs *iter)\r\n{\r\nint ret = 0;\r\nfor (; iter->name; iter++) {\r\nret = sysfs_create_bin_file(&shost->shost_gendev.kobj,\r\niter->attr);\r\nif (ret)\r\npr_err("Unable to create sysfs %s attr, err(%d).\n",\r\niter->name, ret);\r\n}\r\nreturn ret;\r\n}\r\nvoid\r\nqedf_remove_sysfs_attr(struct Scsi_Host *shost, struct sysfs_bin_attrs *iter)\r\n{\r\nfor (; iter->name; iter++)\r\nsysfs_remove_bin_file(&shost->shost_gendev.kobj, iter->attr);\r\n}
