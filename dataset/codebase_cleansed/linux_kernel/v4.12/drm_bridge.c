int drm_bridge_add(struct drm_bridge *bridge)\r\n{\r\nmutex_lock(&bridge_lock);\r\nlist_add_tail(&bridge->list, &bridge_list);\r\nmutex_unlock(&bridge_lock);\r\nreturn 0;\r\n}\r\nvoid drm_bridge_remove(struct drm_bridge *bridge)\r\n{\r\nmutex_lock(&bridge_lock);\r\nlist_del_init(&bridge->list);\r\nmutex_unlock(&bridge_lock);\r\n}\r\nint drm_bridge_attach(struct drm_encoder *encoder, struct drm_bridge *bridge,\r\nstruct drm_bridge *previous)\r\n{\r\nint ret;\r\nif (!encoder || !bridge)\r\nreturn -EINVAL;\r\nif (previous && (!previous->dev || previous->encoder != encoder))\r\nreturn -EINVAL;\r\nif (bridge->dev)\r\nreturn -EBUSY;\r\nbridge->dev = encoder->dev;\r\nbridge->encoder = encoder;\r\nif (bridge->funcs->attach) {\r\nret = bridge->funcs->attach(bridge);\r\nif (ret < 0) {\r\nbridge->dev = NULL;\r\nbridge->encoder = NULL;\r\nreturn ret;\r\n}\r\n}\r\nif (previous)\r\nprevious->next = bridge;\r\nelse\r\nencoder->bridge = bridge;\r\nreturn 0;\r\n}\r\nvoid drm_bridge_detach(struct drm_bridge *bridge)\r\n{\r\nif (WARN_ON(!bridge))\r\nreturn;\r\nif (WARN_ON(!bridge->dev))\r\nreturn;\r\nif (bridge->funcs->detach)\r\nbridge->funcs->detach(bridge);\r\nbridge->dev = NULL;\r\n}\r\nbool drm_bridge_mode_fixup(struct drm_bridge *bridge,\r\nconst struct drm_display_mode *mode,\r\nstruct drm_display_mode *adjusted_mode)\r\n{\r\nbool ret = true;\r\nif (!bridge)\r\nreturn true;\r\nif (bridge->funcs->mode_fixup)\r\nret = bridge->funcs->mode_fixup(bridge, mode, adjusted_mode);\r\nret = ret && drm_bridge_mode_fixup(bridge->next, mode, adjusted_mode);\r\nreturn ret;\r\n}\r\nvoid drm_bridge_disable(struct drm_bridge *bridge)\r\n{\r\nif (!bridge)\r\nreturn;\r\ndrm_bridge_disable(bridge->next);\r\nif (bridge->funcs->disable)\r\nbridge->funcs->disable(bridge);\r\n}\r\nvoid drm_bridge_post_disable(struct drm_bridge *bridge)\r\n{\r\nif (!bridge)\r\nreturn;\r\nif (bridge->funcs->post_disable)\r\nbridge->funcs->post_disable(bridge);\r\ndrm_bridge_post_disable(bridge->next);\r\n}\r\nvoid drm_bridge_mode_set(struct drm_bridge *bridge,\r\nstruct drm_display_mode *mode,\r\nstruct drm_display_mode *adjusted_mode)\r\n{\r\nif (!bridge)\r\nreturn;\r\nif (bridge->funcs->mode_set)\r\nbridge->funcs->mode_set(bridge, mode, adjusted_mode);\r\ndrm_bridge_mode_set(bridge->next, mode, adjusted_mode);\r\n}\r\nvoid drm_bridge_pre_enable(struct drm_bridge *bridge)\r\n{\r\nif (!bridge)\r\nreturn;\r\ndrm_bridge_pre_enable(bridge->next);\r\nif (bridge->funcs->pre_enable)\r\nbridge->funcs->pre_enable(bridge);\r\n}\r\nvoid drm_bridge_enable(struct drm_bridge *bridge)\r\n{\r\nif (!bridge)\r\nreturn;\r\nif (bridge->funcs->enable)\r\nbridge->funcs->enable(bridge);\r\ndrm_bridge_enable(bridge->next);\r\n}\r\nstruct drm_bridge *of_drm_find_bridge(struct device_node *np)\r\n{\r\nstruct drm_bridge *bridge;\r\nmutex_lock(&bridge_lock);\r\nlist_for_each_entry(bridge, &bridge_list, list) {\r\nif (bridge->of_node == np) {\r\nmutex_unlock(&bridge_lock);\r\nreturn bridge;\r\n}\r\n}\r\nmutex_unlock(&bridge_lock);\r\nreturn NULL;\r\n}
