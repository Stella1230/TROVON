static inline struct qedi_ctx *qedi_dev_to_hba(struct device *dev)\r\n{\r\nstruct Scsi_Host *shost = class_to_shost(dev);\r\nreturn iscsi_host_priv(shost);\r\n}\r\nstatic ssize_t qedi_show_port_state(struct device *dev,\r\nstruct device_attribute *attr,\r\nchar *buf)\r\n{\r\nstruct qedi_ctx *qedi = qedi_dev_to_hba(dev);\r\nif (atomic_read(&qedi->link_state) == QEDI_LINK_UP)\r\nreturn sprintf(buf, "Online\n");\r\nelse\r\nreturn sprintf(buf, "Linkdown\n");\r\n}\r\nstatic ssize_t qedi_show_speed(struct device *dev,\r\nstruct device_attribute *attr, char *buf)\r\n{\r\nstruct qedi_ctx *qedi = qedi_dev_to_hba(dev);\r\nstruct qed_link_output if_link;\r\nqedi_ops->common->get_link(qedi->cdev, &if_link);\r\nreturn sprintf(buf, "%d Gbit\n", if_link.speed / 1000);\r\n}
