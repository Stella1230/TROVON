static int kona_reset_handler(struct notifier_block *this,\r\nunsigned long mode, void *cmd)\r\n{\r\nwritel((RSTMGR_WR_PASSWORD << RSTMGR_WR_PASSWORD_SHIFT) |\r\nRSTMGR_WR_ACCESS_ENABLE,\r\nkona_reset_base + RSTMGR_REG_WR_ACCESS_OFFSET);\r\nwritel(0, kona_reset_base + RSTMGR_REG_CHIP_SOFT_RST_OFFSET);\r\nreturn NOTIFY_DONE;\r\n}\r\nstatic int kona_reset_probe(struct platform_device *pdev)\r\n{\r\nstruct resource *res = platform_get_resource(pdev, IORESOURCE_MEM, 0);\r\nkona_reset_base = devm_ioremap_resource(&pdev->dev, res);\r\nif (IS_ERR(kona_reset_base))\r\nreturn PTR_ERR(kona_reset_base);\r\nreturn register_restart_handler(&kona_reset_nb);\r\n}
