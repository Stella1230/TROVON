int cz_phm_set_asic_block_gating(struct pp_hwmgr *hwmgr, enum PHM_AsicBlock block, enum PHM_ClockGateSetting gating)\r\n{\r\nint ret = 0;\r\nswitch (block) {\r\ncase PHM_AsicBlock_UVD_MVC:\r\ncase PHM_AsicBlock_UVD:\r\ncase PHM_AsicBlock_UVD_HD:\r\ncase PHM_AsicBlock_UVD_SD:\r\nif (gating == PHM_ClockGateSetting_StaticOff)\r\nret = cz_dpm_powerdown_uvd(hwmgr);\r\nelse\r\nret = cz_dpm_powerup_uvd(hwmgr);\r\nbreak;\r\ncase PHM_AsicBlock_GFX:\r\ndefault:\r\nbreak;\r\n}\r\nreturn ret;\r\n}\r\nbool cz_phm_is_safe_for_asic_block(struct pp_hwmgr *hwmgr, const struct pp_hw_power_state *state, enum PHM_AsicBlock block)\r\n{\r\nreturn true;\r\n}\r\nint cz_phm_enable_disable_gfx_power_gating(struct pp_hwmgr *hwmgr, bool enable)\r\n{\r\nreturn 0;\r\n}\r\nint cz_phm_smu_power_up_down_pcie(struct pp_hwmgr *hwmgr, uint32_t target, bool up, uint32_t args)\r\n{\r\nreturn 0;\r\n}\r\nint cz_phm_initialize_display_phy_access(struct pp_hwmgr *hwmgr, bool initialize, bool accesshw)\r\n{\r\nreturn 0;\r\n}\r\nint cz_phm_get_display_phy_access_info(struct pp_hwmgr *hwmgr)\r\n{\r\nreturn 0;\r\n}\r\nint cz_phm_gate_unused_display_phys(struct pp_hwmgr *hwmgr)\r\n{\r\nreturn 0;\r\n}\r\nint cz_phm_ungate_all_display_phys(struct pp_hwmgr *hwmgr)\r\n{\r\nreturn 0;\r\n}\r\nstatic int cz_tf_uvd_power_gating_initialize(struct pp_hwmgr *hwmgr, void *pInput, void *pOutput, void *pStorage, int Result)\r\n{\r\nreturn 0;\r\n}\r\nstatic int cz_tf_vce_power_gating_initialize(struct pp_hwmgr *hwmgr, void *pInput, void *pOutput, void *pStorage, int Result)\r\n{\r\nreturn 0;\r\n}\r\nint cz_enable_disable_uvd_dpm(struct pp_hwmgr *hwmgr, bool enable)\r\n{\r\nstruct cz_hwmgr *cz_hwmgr = (struct cz_hwmgr *)(hwmgr->backend);\r\nuint32_t dpm_features = 0;\r\nif (enable &&\r\nphm_cap_enabled(hwmgr->platform_descriptor.platformCaps,\r\nPHM_PlatformCaps_UVDDPM)) {\r\ncz_hwmgr->dpm_flags |= DPMFlags_UVD_Enabled;\r\ndpm_features |= UVD_DPM_MASK;\r\nsmum_send_msg_to_smc_with_parameter(hwmgr->smumgr,\r\nPPSMC_MSG_EnableAllSmuFeatures, dpm_features);\r\n} else {\r\ndpm_features |= UVD_DPM_MASK;\r\ncz_hwmgr->dpm_flags &= ~DPMFlags_UVD_Enabled;\r\nsmum_send_msg_to_smc_with_parameter(hwmgr->smumgr,\r\nPPSMC_MSG_DisableAllSmuFeatures, dpm_features);\r\n}\r\nreturn 0;\r\n}\r\nint cz_enable_disable_vce_dpm(struct pp_hwmgr *hwmgr, bool enable)\r\n{\r\nstruct cz_hwmgr *cz_hwmgr = (struct cz_hwmgr *)(hwmgr->backend);\r\nuint32_t dpm_features = 0;\r\nif (enable && phm_cap_enabled(\r\nhwmgr->platform_descriptor.platformCaps,\r\nPHM_PlatformCaps_VCEDPM)) {\r\ncz_hwmgr->dpm_flags |= DPMFlags_VCE_Enabled;\r\ndpm_features |= VCE_DPM_MASK;\r\nsmum_send_msg_to_smc_with_parameter(hwmgr->smumgr,\r\nPPSMC_MSG_EnableAllSmuFeatures, dpm_features);\r\n} else {\r\ndpm_features |= VCE_DPM_MASK;\r\ncz_hwmgr->dpm_flags &= ~DPMFlags_VCE_Enabled;\r\nsmum_send_msg_to_smc_with_parameter(hwmgr->smumgr,\r\nPPSMC_MSG_DisableAllSmuFeatures, dpm_features);\r\n}\r\nreturn 0;\r\n}\r\nint cz_dpm_powergate_uvd(struct pp_hwmgr *hwmgr, bool bgate)\r\n{\r\nstruct cz_hwmgr *cz_hwmgr = (struct cz_hwmgr *)(hwmgr->backend);\r\ncz_hwmgr->uvd_power_gated = bgate;\r\nif (bgate) {\r\ncgs_set_powergating_state(hwmgr->device,\r\nAMD_IP_BLOCK_TYPE_UVD,\r\nAMD_PG_STATE_GATE);\r\ncgs_set_clockgating_state(hwmgr->device,\r\nAMD_IP_BLOCK_TYPE_UVD,\r\nAMD_CG_STATE_GATE);\r\ncz_dpm_update_uvd_dpm(hwmgr, true);\r\ncz_dpm_powerdown_uvd(hwmgr);\r\n} else {\r\ncz_dpm_powerup_uvd(hwmgr);\r\ncgs_set_clockgating_state(hwmgr->device,\r\nAMD_IP_BLOCK_TYPE_UVD,\r\nAMD_PG_STATE_UNGATE);\r\ncgs_set_powergating_state(hwmgr->device,\r\nAMD_IP_BLOCK_TYPE_UVD,\r\nAMD_CG_STATE_UNGATE);\r\ncz_dpm_update_uvd_dpm(hwmgr, false);\r\n}\r\nreturn 0;\r\n}\r\nint cz_dpm_powergate_vce(struct pp_hwmgr *hwmgr, bool bgate)\r\n{\r\nstruct cz_hwmgr *cz_hwmgr = (struct cz_hwmgr *)(hwmgr->backend);\r\nif (bgate) {\r\ncgs_set_powergating_state(\r\nhwmgr->device,\r\nAMD_IP_BLOCK_TYPE_VCE,\r\nAMD_PG_STATE_GATE);\r\ncgs_set_clockgating_state(\r\nhwmgr->device,\r\nAMD_IP_BLOCK_TYPE_VCE,\r\nAMD_CG_STATE_GATE);\r\ncz_enable_disable_vce_dpm(hwmgr, false);\r\ncz_dpm_powerdown_vce(hwmgr);\r\ncz_hwmgr->vce_power_gated = true;\r\n} else {\r\ncz_dpm_powerup_vce(hwmgr);\r\ncz_hwmgr->vce_power_gated = false;\r\ncgs_set_clockgating_state(\r\nhwmgr->device,\r\nAMD_IP_BLOCK_TYPE_VCE,\r\nAMD_PG_STATE_UNGATE);\r\ncgs_set_powergating_state(\r\nhwmgr->device,\r\nAMD_IP_BLOCK_TYPE_VCE,\r\nAMD_CG_STATE_UNGATE);\r\ncz_dpm_update_vce_dpm(hwmgr);\r\ncz_enable_disable_vce_dpm(hwmgr, true);\r\nreturn 0;\r\n}\r\nreturn 0;\r\n}
