static int tk_debug_show_sleep_time(struct seq_file *s, void *data)\r\n{\r\nunsigned int bin;\r\nseq_puts(s, " time (secs) count\n");\r\nseq_puts(s, "------------------------------\n");\r\nfor (bin = 0; bin < 32; bin++) {\r\nif (sleep_time_bin[bin] == 0)\r\ncontinue;\r\nseq_printf(s, "%10u - %-10u %4u\n",\r\nbin ? 1 << (bin - 1) : 0, 1 << bin,\r\nsleep_time_bin[bin]);\r\n}\r\nreturn 0;\r\n}\r\nstatic int tk_debug_sleep_time_open(struct inode *inode, struct file *file)\r\n{\r\nreturn single_open(file, tk_debug_show_sleep_time, NULL);\r\n}\r\nstatic int __init tk_debug_sleep_time_init(void)\r\n{\r\nstruct dentry *d;\r\nd = debugfs_create_file("sleep_time", 0444, NULL, NULL,\r\n&tk_debug_sleep_time_fops);\r\nif (!d) {\r\npr_err("Failed to create sleep_time debug file\n");\r\nreturn -ENOMEM;\r\n}\r\nreturn 0;\r\n}\r\nvoid tk_debug_account_sleep_time(struct timespec64 *t)\r\n{\r\nint bin = min(fls(t->tv_sec), NUM_BINS-1);\r\nsleep_time_bin[bin]++;\r\nprintk_deferred(KERN_INFO "Suspended for %lld.%03lu seconds\n",\r\n(s64)t->tv_sec, t->tv_nsec / NSEC_PER_MSEC);\r\n}
