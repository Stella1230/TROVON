static int snow_late_probe(struct snd_soc_card *card)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd;\r\nstruct snd_soc_dai *codec_dai;\r\nstruct snd_soc_dai *cpu_dai;\r\nint ret;\r\nrtd = snd_soc_get_pcm_runtime(card, card->dai_link[0].name);\r\ncodec_dai = rtd->codec_dai;\r\ncpu_dai = rtd->cpu_dai;\r\nret = snd_soc_dai_set_sysclk(codec_dai, 0,\r\nFIN_PLL_RATE, SND_SOC_CLOCK_IN);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_dai_set_sysclk(cpu_dai, SAMSUNG_I2S_RCLKSRC_0,\r\n0, SND_SOC_CLOCK_IN);\r\nif (ret < 0)\r\nreturn ret;\r\nreturn 0;\r\n}\r\nstatic int snow_probe(struct platform_device *pdev)\r\n{\r\nstruct snd_soc_card *card = &snow_snd;\r\nstruct device_node *i2s_node, *codec_node;\r\nint i, ret;\r\ni2s_node = of_parse_phandle(pdev->dev.of_node,\r\n"samsung,i2s-controller", 0);\r\nif (!i2s_node) {\r\ndev_err(&pdev->dev,\r\n"Property 'i2s-controller' missing or invalid\n");\r\nreturn -EINVAL;\r\n}\r\ncodec_node = of_parse_phandle(pdev->dev.of_node,\r\n"samsung,audio-codec", 0);\r\nif (!codec_node) {\r\ndev_err(&pdev->dev,\r\n"Property 'audio-codec' missing or invalid\n");\r\nreturn -EINVAL;\r\n}\r\nfor (i = 0; i < ARRAY_SIZE(snow_dai); i++) {\r\nsnow_dai[i].codec_of_node = codec_node;\r\nsnow_dai[i].cpu_of_node = i2s_node;\r\nsnow_dai[i].platform_of_node = i2s_node;\r\n}\r\ncard->dev = &pdev->dev;\r\nsnd_soc_of_parse_card_name(card, "samsung,model");\r\nret = devm_snd_soc_register_card(&pdev->dev, card);\r\nif (ret) {\r\ndev_err(&pdev->dev, "snd_soc_register_card failed (%d)\n", ret);\r\nreturn ret;\r\n}\r\nreturn ret;\r\n}
