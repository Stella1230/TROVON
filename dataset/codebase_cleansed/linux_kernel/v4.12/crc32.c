u32 __pure crc32_le(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_le_generic(crc, p, len, NULL, CRCPOLY_LE);\r\n}\r\nu32 __pure __crc32c_le(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_le_generic(crc, p, len, NULL, CRC32C_POLY_LE);\r\n}\r\nu32 __pure crc32_le(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_le_generic(crc, p, len,\r\n(const u32 (*)[256])crc32table_le, CRCPOLY_LE);\r\n}\r\nu32 __pure __crc32c_le(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_le_generic(crc, p, len,\r\n(const u32 (*)[256])crc32ctable_le, CRC32C_POLY_LE);\r\n}\r\nstatic u32 __attribute_const__ gf2_multiply(u32 x, u32 y, u32 modulus)\r\n{\r\nu32 product = x & 1 ? y : 0;\r\nint i;\r\nfor (i = 0; i < 31; i++) {\r\nproduct = (product >> 1) ^ (product & 1 ? modulus : 0);\r\nx >>= 1;\r\nproduct ^= x & 1 ? y : 0;\r\n}\r\nreturn product;\r\n}\r\nstatic u32 __attribute_const__ crc32_generic_shift(u32 crc, size_t len,\r\nu32 polynomial)\r\n{\r\nu32 power = polynomial;\r\nint i;\r\nfor (i = 0; i < 8 * (int)(len & 3); i++)\r\ncrc = (crc >> 1) ^ (crc & 1 ? polynomial : 0);\r\nlen >>= 2;\r\nif (!len)\r\nreturn crc;\r\nfor (;;) {\r\nif (len & 1)\r\ncrc = gf2_multiply(crc, power, polynomial);\r\nlen >>= 1;\r\nif (!len)\r\nbreak;\r\npower = gf2_multiply(power, power, polynomial);\r\n}\r\nreturn crc;\r\n}\r\nu32 __attribute_const__ crc32_le_shift(u32 crc, size_t len)\r\n{\r\nreturn crc32_generic_shift(crc, len, CRCPOLY_LE);\r\n}\r\nu32 __attribute_const__ __crc32c_le_shift(u32 crc, size_t len)\r\n{\r\nreturn crc32_generic_shift(crc, len, CRC32C_POLY_LE);\r\n}\r\nu32 __pure crc32_be(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_be_generic(crc, p, len, NULL, CRCPOLY_BE);\r\n}\r\nu32 __pure crc32_be(u32 crc, unsigned char const *p, size_t len)\r\n{\r\nreturn crc32_be_generic(crc, p, len,\r\n(const u32 (*)[256])crc32table_be, CRCPOLY_BE);\r\n}
