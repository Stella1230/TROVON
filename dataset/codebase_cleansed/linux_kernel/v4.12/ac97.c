static int ac97_prepare(struct snd_pcm_substream *substream,\r\nstruct snd_soc_dai *dai)\r\n{\r\nstruct snd_soc_codec *codec = dai->codec;\r\nstruct snd_ac97 *ac97 = snd_soc_codec_get_drvdata(codec);\r\nint reg = (substream->stream == SNDRV_PCM_STREAM_PLAYBACK) ?\r\nAC97_PCM_FRONT_DAC_RATE : AC97_PCM_LR_ADC_RATE;\r\nreturn snd_ac97_set_rate(ac97, reg, substream->runtime->rate);\r\n}\r\nstatic int ac97_soc_probe(struct snd_soc_codec *codec)\r\n{\r\nstruct snd_ac97 *ac97;\r\nstruct snd_ac97_bus *ac97_bus;\r\nstruct snd_ac97_template ac97_template;\r\nint ret;\r\nret = snd_ac97_bus(codec->component.card->snd_card, 0, soc_ac97_ops,\r\nNULL, &ac97_bus);\r\nif (ret < 0)\r\nreturn ret;\r\nmemset(&ac97_template, 0, sizeof(struct snd_ac97_template));\r\nret = snd_ac97_mixer(ac97_bus, &ac97_template, &ac97);\r\nif (ret < 0)\r\nreturn ret;\r\nsnd_soc_codec_set_drvdata(codec, ac97);\r\nreturn 0;\r\n}\r\nstatic int ac97_soc_suspend(struct snd_soc_codec *codec)\r\n{\r\nstruct snd_ac97 *ac97 = snd_soc_codec_get_drvdata(codec);\r\nsnd_ac97_suspend(ac97);\r\nreturn 0;\r\n}\r\nstatic int ac97_soc_resume(struct snd_soc_codec *codec)\r\n{\r\nstruct snd_ac97 *ac97 = snd_soc_codec_get_drvdata(codec);\r\nsnd_ac97_resume(ac97);\r\nreturn 0;\r\n}\r\nstatic int ac97_probe(struct platform_device *pdev)\r\n{\r\nreturn snd_soc_register_codec(&pdev->dev,\r\n&soc_codec_dev_ac97, &ac97_dai, 1);\r\n}\r\nstatic int ac97_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_codec(&pdev->dev);\r\nreturn 0;\r\n}
