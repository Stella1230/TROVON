static void xpu_ack(struct cx18 *cx, u32 sw2)\r\n{\r\nif (sw2 & IRQ_CPU_TO_EPU_ACK)\r\nwake_up(&cx->mb_cpu_waitq);\r\nif (sw2 & IRQ_APU_TO_EPU_ACK)\r\nwake_up(&cx->mb_apu_waitq);\r\n}\r\nstatic void epu_cmd(struct cx18 *cx, u32 sw1)\r\n{\r\nif (sw1 & IRQ_CPU_TO_EPU)\r\ncx18_api_epu_cmd_irq(cx, CPU);\r\nif (sw1 & IRQ_APU_TO_EPU)\r\ncx18_api_epu_cmd_irq(cx, APU);\r\n}\r\nirqreturn_t cx18_irq_handler(int irq, void *dev_id)\r\n{\r\nstruct cx18 *cx = (struct cx18 *)dev_id;\r\nu32 sw1, sw2, hw2;\r\nsw1 = cx18_read_reg(cx, SW1_INT_STATUS) & cx->sw1_irq_mask;\r\nsw2 = cx18_read_reg(cx, SW2_INT_STATUS) & cx->sw2_irq_mask;\r\nhw2 = cx18_read_reg(cx, HW2_INT_CLR_STATUS) & cx->hw2_irq_mask;\r\nif (sw1)\r\ncx18_write_reg_expect(cx, sw1, SW1_INT_STATUS, ~sw1, sw1);\r\nif (sw2)\r\ncx18_write_reg_expect(cx, sw2, SW2_INT_STATUS, ~sw2, sw2);\r\nif (hw2)\r\ncx18_write_reg_expect(cx, hw2, HW2_INT_CLR_STATUS, ~hw2, hw2);\r\nif (sw1 || sw2 || hw2)\r\nCX18_DEBUG_HI_IRQ("received interrupts SW1: %x SW2: %x HW2: %x\n",\r\nsw1, sw2, hw2);\r\nif (sw1)\r\nepu_cmd(cx, sw1);\r\nif (sw2)\r\nxpu_ack(cx, sw2);\r\nreturn (sw1 || sw2 || hw2) ? IRQ_HANDLED : IRQ_NONE;\r\n}
