void arch_klp_init_object_loaded(struct klp_patch *patch,\r\nstruct klp_object *obj)\r\n{\r\nint cnt;\r\nstruct klp_modinfo *info;\r\nElf_Shdr *s, *alt = NULL, *para = NULL;\r\nvoid *aseg, *pseg;\r\nconst char *objname;\r\nchar sec_objname[MODULE_NAME_LEN];\r\nchar secname[KSYM_NAME_LEN];\r\ninfo = patch->mod->klp_info;\r\nobjname = obj->name ? obj->name : "vmlinux";\r\nBUILD_BUG_ON(MODULE_NAME_LEN < 56 || KSYM_NAME_LEN != 128);\r\nfor (s = info->sechdrs; s < info->sechdrs + info->hdr.e_shnum; s++) {\r\ncnt = sscanf(info->secstrings + s->sh_name,\r\n".klp.arch.%55[^.].%127s",\r\nsec_objname, secname);\r\nif (cnt != 2)\r\ncontinue;\r\nif (strcmp(sec_objname, objname))\r\ncontinue;\r\nif (!strcmp(".altinstructions", secname))\r\nalt = s;\r\nif (!strcmp(".parainstructions", secname))\r\npara = s;\r\n}\r\nif (alt) {\r\naseg = (void *) alt->sh_addr;\r\napply_alternatives(aseg, aseg + alt->sh_size);\r\n}\r\nif (para) {\r\npseg = (void *) para->sh_addr;\r\napply_paravirt(pseg, pseg + para->sh_size);\r\n}\r\n}
