static acpi_status\r\nacpi_ut_get_mutex_object(acpi_handle handle,\r\nacpi_string pathname,\r\nunion acpi_operand_object **ret_obj)\r\n{\r\nstruct acpi_namespace_node *mutex_node;\r\nunion acpi_operand_object *mutex_obj;\r\nacpi_status status;\r\nif (!ret_obj || (!handle && !pathname)) {\r\nreturn (AE_BAD_PARAMETER);\r\n}\r\nmutex_node = handle;\r\nif (pathname != NULL) {\r\nstatus =\r\nacpi_get_handle(handle, pathname,\r\nACPI_CAST_PTR(acpi_handle, &mutex_node));\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\n}\r\nif (!mutex_node || (mutex_node->type != ACPI_TYPE_MUTEX)) {\r\nreturn (AE_TYPE);\r\n}\r\nmutex_obj = acpi_ns_get_attached_object(mutex_node);\r\nif (!mutex_obj) {\r\nreturn (AE_NULL_OBJECT);\r\n}\r\n*ret_obj = mutex_obj;\r\nreturn (AE_OK);\r\n}\r\nacpi_status\r\nacpi_acquire_mutex(acpi_handle handle, acpi_string pathname, u16 timeout)\r\n{\r\nacpi_status status;\r\nunion acpi_operand_object *mutex_obj;\r\nstatus = acpi_ut_get_mutex_object(handle, pathname, &mutex_obj);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nstatus = acpi_os_acquire_mutex(mutex_obj->mutex.os_mutex, timeout);\r\nreturn (status);\r\n}\r\nacpi_status acpi_release_mutex(acpi_handle handle, acpi_string pathname)\r\n{\r\nacpi_status status;\r\nunion acpi_operand_object *mutex_obj;\r\nstatus = acpi_ut_get_mutex_object(handle, pathname, &mutex_obj);\r\nif (ACPI_FAILURE(status)) {\r\nreturn (status);\r\n}\r\nacpi_os_release_mutex(mutex_obj->mutex.os_mutex);\r\nreturn (AE_OK);\r\n}
