static int init_display(struct fbtft_par *par)\r\n{\r\nwrite_reg(par, MIPI_DCS_EXIT_SLEEP_MODE);\r\nmdelay(120);\r\nwrite_reg(par, MIPI_DCS_SET_PIXEL_FORMAT, MIPI_DCS_PIXEL_FMT_16BIT);\r\nwrite_reg(par, PORCTRL, 0x08, 0x08, 0x00, 0x22, 0x22);\r\nwrite_reg(par, GCTRL, 0x35);\r\nwrite_reg(par, VDVVRHEN, 0x01, 0xFF);\r\nwrite_reg(par, VRHS, 0x0B);\r\nwrite_reg(par, VDVS, 0x20);\r\nwrite_reg(par, VCOMS, 0x20);\r\nwrite_reg(par, VCMOFSET, 0x20);\r\nwrite_reg(par, PWCTRL1, 0xA4, 0xA1);\r\nwrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\r\nreturn 0;\r\n}\r\nstatic int set_var(struct fbtft_par *par)\r\n{\r\nu8 madctl_par = 0;\r\nif (par->bgr)\r\nmadctl_par |= MADCTL_BGR;\r\nswitch (par->info->var.rotate) {\r\ncase 0:\r\nbreak;\r\ncase 90:\r\nmadctl_par |= (MADCTL_MV | MADCTL_MY);\r\nbreak;\r\ncase 180:\r\nmadctl_par |= (MADCTL_MX | MADCTL_MY);\r\nbreak;\r\ncase 270:\r\nmadctl_par |= (MADCTL_MV | MADCTL_MX);\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nwrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, madctl_par);\r\nreturn 0;\r\n}\r\nstatic int set_gamma(struct fbtft_par *par, u32 *curves)\r\n{\r\nint i;\r\nint j;\r\nint c;\r\nconst u8 gamma_par_mask[] = {\r\n0xFF,\r\n0x3F,\r\n0x3F,\r\n0x1F,\r\n0x1F,\r\n0x3F,\r\n0x7F,\r\n0x77,\r\n0x7F,\r\n0x3F,\r\n0x1F,\r\n0x1F,\r\n0x3F,\r\n0x3F,\r\n};\r\nfor (i = 0; i < par->gamma.num_curves; i++) {\r\nc = i * par->gamma.num_values;\r\nfor (j = 0; j < par->gamma.num_values; j++)\r\ncurves[c + j] &= gamma_par_mask[j];\r\nwrite_reg(\r\npar, PVGAMCTRL + i,\r\ncurves[c + 0], curves[c + 1], curves[c + 2],\r\ncurves[c + 3], curves[c + 4], curves[c + 5],\r\ncurves[c + 6], curves[c + 7], curves[c + 8],\r\ncurves[c + 9], curves[c + 10], curves[c + 11],\r\ncurves[c + 12], curves[c + 13]);\r\n}\r\nreturn 0;\r\n}\r\nstatic int blank(struct fbtft_par *par, bool on)\r\n{\r\nif (on)\r\nwrite_reg(par, MIPI_DCS_SET_DISPLAY_OFF);\r\nelse\r\nwrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\r\nreturn 0;\r\n}
