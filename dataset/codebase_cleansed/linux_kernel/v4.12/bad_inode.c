static int bad_file_open(struct inode *inode, struct file *filp)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_create (struct inode *dir, struct dentry *dentry,\r\numode_t mode, bool excl)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic struct dentry *bad_inode_lookup(struct inode *dir,\r\nstruct dentry *dentry, unsigned int flags)\r\n{\r\nreturn ERR_PTR(-EIO);\r\n}\r\nstatic int bad_inode_link (struct dentry *old_dentry, struct inode *dir,\r\nstruct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_unlink(struct inode *dir, struct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_symlink (struct inode *dir, struct dentry *dentry,\r\nconst char *symname)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_mkdir(struct inode *dir, struct dentry *dentry,\r\numode_t mode)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_rmdir (struct inode *dir, struct dentry *dentry)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_mknod (struct inode *dir, struct dentry *dentry,\r\numode_t mode, dev_t rdev)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_rename2(struct inode *old_dir, struct dentry *old_dentry,\r\nstruct inode *new_dir, struct dentry *new_dentry,\r\nunsigned int flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_readlink(struct dentry *dentry, char __user *buffer,\r\nint buflen)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_permission(struct inode *inode, int mask)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_getattr(const struct path *path, struct kstat *stat,\r\nu32 request_mask, unsigned int query_flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_setattr(struct dentry *direntry, struct iattr *attrs)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic ssize_t bad_inode_listxattr(struct dentry *dentry, char *buffer,\r\nsize_t buffer_size)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic const char *bad_inode_get_link(struct dentry *dentry,\r\nstruct inode *inode,\r\nstruct delayed_call *done)\r\n{\r\nreturn ERR_PTR(-EIO);\r\n}\r\nstatic struct posix_acl *bad_inode_get_acl(struct inode *inode, int type)\r\n{\r\nreturn ERR_PTR(-EIO);\r\n}\r\nstatic int bad_inode_fiemap(struct inode *inode,\r\nstruct fiemap_extent_info *fieinfo, u64 start,\r\nu64 len)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_update_time(struct inode *inode, struct timespec *time,\r\nint flags)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_atomic_open(struct inode *inode, struct dentry *dentry,\r\nstruct file *file, unsigned int open_flag,\r\numode_t create_mode, int *opened)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_tmpfile(struct inode *inode, struct dentry *dentry,\r\numode_t mode)\r\n{\r\nreturn -EIO;\r\n}\r\nstatic int bad_inode_set_acl(struct inode *inode, struct posix_acl *acl,\r\nint type)\r\n{\r\nreturn -EIO;\r\n}\r\nvoid make_bad_inode(struct inode *inode)\r\n{\r\nremove_inode_hash(inode);\r\ninode->i_mode = S_IFREG;\r\ninode->i_atime = inode->i_mtime = inode->i_ctime =\r\ncurrent_time(inode);\r\ninode->i_op = &bad_inode_ops;\r\ninode->i_opflags &= ~IOP_XATTR;\r\ninode->i_fop = &bad_file_ops;\r\n}\r\nbool is_bad_inode(struct inode *inode)\r\n{\r\nreturn (inode->i_op == &bad_inode_ops);\r\n}\r\nvoid iget_failed(struct inode *inode)\r\n{\r\nmake_bad_inode(inode);\r\nunlock_new_inode(inode);\r\niput(inode);\r\n}
