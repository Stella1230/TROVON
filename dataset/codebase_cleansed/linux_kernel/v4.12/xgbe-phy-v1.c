static void xgbe_phy_kr_training_pre(struct xgbe_prv_data *pdata)\r\n{\r\nXSIR0_IOWRITE_BITS(pdata, SIR0_KR_RT_1, RESET, 1);\r\n}\r\nstatic void xgbe_phy_kr_training_post(struct xgbe_prv_data *pdata)\r\n{\r\nXSIR0_IOWRITE_BITS(pdata, SIR0_KR_RT_1, RESET, 0);\r\n}\r\nstatic enum xgbe_mode xgbe_phy_an_outcome(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nenum xgbe_mode mode;\r\nunsigned int ad_reg, lp_reg;\r\npdata->phy.lp_advertising |= ADVERTISED_Autoneg;\r\npdata->phy.lp_advertising |= ADVERTISED_Backplane;\r\nad_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_ADVERTISE);\r\nlp_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_LPA);\r\nif (lp_reg & 0x400)\r\npdata->phy.lp_advertising |= ADVERTISED_Pause;\r\nif (lp_reg & 0x800)\r\npdata->phy.lp_advertising |= ADVERTISED_Asym_Pause;\r\nif (pdata->phy.pause_autoneg) {\r\npdata->phy.tx_pause = 0;\r\npdata->phy.rx_pause = 0;\r\nif (ad_reg & lp_reg & 0x400) {\r\npdata->phy.tx_pause = 1;\r\npdata->phy.rx_pause = 1;\r\n} else if (ad_reg & lp_reg & 0x800) {\r\nif (ad_reg & 0x400)\r\npdata->phy.rx_pause = 1;\r\nelse if (lp_reg & 0x400)\r\npdata->phy.tx_pause = 1;\r\n}\r\n}\r\nad_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_ADVERTISE + 1);\r\nlp_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_LPA + 1);\r\nif (lp_reg & 0x80)\r\npdata->phy.lp_advertising |= ADVERTISED_10000baseKR_Full;\r\nif (lp_reg & 0x20) {\r\nif (phy_data->speed_set == XGBE_SPEEDSET_2500_10000)\r\npdata->phy.lp_advertising |= ADVERTISED_2500baseX_Full;\r\nelse\r\npdata->phy.lp_advertising |= ADVERTISED_1000baseKX_Full;\r\n}\r\nad_reg &= lp_reg;\r\nif (ad_reg & 0x80) {\r\nmode = XGBE_MODE_KR;\r\n} else if (ad_reg & 0x20) {\r\nif (phy_data->speed_set == XGBE_SPEEDSET_2500_10000)\r\nmode = XGBE_MODE_KX_2500;\r\nelse\r\nmode = XGBE_MODE_KX_1000;\r\n} else {\r\nmode = XGBE_MODE_UNKNOWN;\r\n}\r\nad_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_ADVERTISE + 2);\r\nlp_reg = XMDIO_READ(pdata, MDIO_MMD_AN, MDIO_AN_LPA + 2);\r\nif (lp_reg & 0xc000)\r\npdata->phy.lp_advertising |= ADVERTISED_10000baseR_FEC;\r\nreturn mode;\r\n}\r\nstatic unsigned int xgbe_phy_an_advertising(struct xgbe_prv_data *pdata)\r\n{\r\nreturn pdata->phy.advertising;\r\n}\r\nstatic int xgbe_phy_an_config(struct xgbe_prv_data *pdata)\r\n{\r\nreturn 0;\r\n}\r\nstatic enum xgbe_an_mode xgbe_phy_an_mode(struct xgbe_prv_data *pdata)\r\n{\r\nreturn XGBE_AN_MODE_CL73;\r\n}\r\nstatic void xgbe_phy_pcs_power_cycle(struct xgbe_prv_data *pdata)\r\n{\r\nunsigned int reg;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\nreg |= MDIO_CTRL1_LPOWER;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\nusleep_range(75, 100);\r\nreg &= ~MDIO_CTRL1_LPOWER;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\n}\r\nstatic void xgbe_phy_start_ratechange(struct xgbe_prv_data *pdata)\r\n{\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, RATECHANGE, 1);\r\n}\r\nstatic void xgbe_phy_complete_ratechange(struct xgbe_prv_data *pdata)\r\n{\r\nunsigned int wait;\r\nu16 status;\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, RATECHANGE, 0);\r\nwait = XGBE_RATECHANGE_COUNT;\r\nwhile (wait--) {\r\nusleep_range(50, 75);\r\nstatus = XSIR0_IOREAD(pdata, SIR0_STATUS);\r\nif (XSIR_GET_BITS(status, SIR0_STATUS, RX_READY) &&\r\nXSIR_GET_BITS(status, SIR0_STATUS, TX_READY))\r\ngoto rx_reset;\r\n}\r\nnetif_dbg(pdata, link, pdata->netdev, "SerDes rx/tx not ready (%#hx)\n",\r\nstatus);\r\nrx_reset:\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG6, RESETB_RXD, 0);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG6, RESETB_RXD, 1);\r\n}\r\nstatic void xgbe_phy_kr_mode(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nunsigned int reg;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL2);\r\nreg &= ~MDIO_PCS_CTRL2_TYPE;\r\nreg |= MDIO_PCS_CTRL2_10GBR;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL2, reg);\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\nreg &= ~MDIO_CTRL1_SPEEDSEL;\r\nreg |= MDIO_CTRL1_SPEED10G;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\nxgbe_phy_pcs_power_cycle(pdata);\r\nxgbe_phy_start_ratechange(pdata);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, DATARATE, XGBE_SPEED_10000_RATE);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, WORDMODE, XGBE_SPEED_10000_WORD);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, PLLSEL, XGBE_SPEED_10000_PLL);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, CDR_RATE,\r\nphy_data->cdr_rate[XGBE_SPEED_10000]);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, TXAMP,\r\nphy_data->tx_amp[XGBE_SPEED_10000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG20, BLWC_ENA,\r\nphy_data->blwc[XGBE_SPEED_10000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG114, PQ_REG,\r\nphy_data->pq_skew[XGBE_SPEED_10000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG129, RXDFE_CONFIG,\r\nphy_data->dfe_tap_cfg[XGBE_SPEED_10000]);\r\nXRXTX_IOWRITE(pdata, RXTX_REG22,\r\nphy_data->dfe_tap_ena[XGBE_SPEED_10000]);\r\nxgbe_phy_complete_ratechange(pdata);\r\nnetif_dbg(pdata, link, pdata->netdev, "10GbE KR mode set\n");\r\n}\r\nstatic void xgbe_phy_kx_2500_mode(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nunsigned int reg;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL2);\r\nreg &= ~MDIO_PCS_CTRL2_TYPE;\r\nreg |= MDIO_PCS_CTRL2_10GBX;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL2, reg);\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\nreg &= ~MDIO_CTRL1_SPEEDSEL;\r\nreg |= MDIO_CTRL1_SPEED1G;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\nxgbe_phy_pcs_power_cycle(pdata);\r\nxgbe_phy_start_ratechange(pdata);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, DATARATE, XGBE_SPEED_2500_RATE);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, WORDMODE, XGBE_SPEED_2500_WORD);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, PLLSEL, XGBE_SPEED_2500_PLL);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, CDR_RATE,\r\nphy_data->cdr_rate[XGBE_SPEED_2500]);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, TXAMP,\r\nphy_data->tx_amp[XGBE_SPEED_2500]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG20, BLWC_ENA,\r\nphy_data->blwc[XGBE_SPEED_2500]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG114, PQ_REG,\r\nphy_data->pq_skew[XGBE_SPEED_2500]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG129, RXDFE_CONFIG,\r\nphy_data->dfe_tap_cfg[XGBE_SPEED_2500]);\r\nXRXTX_IOWRITE(pdata, RXTX_REG22,\r\nphy_data->dfe_tap_ena[XGBE_SPEED_2500]);\r\nxgbe_phy_complete_ratechange(pdata);\r\nnetif_dbg(pdata, link, pdata->netdev, "2.5GbE KX mode set\n");\r\n}\r\nstatic void xgbe_phy_kx_1000_mode(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nunsigned int reg;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL2);\r\nreg &= ~MDIO_PCS_CTRL2_TYPE;\r\nreg |= MDIO_PCS_CTRL2_10GBX;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL2, reg);\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\nreg &= ~MDIO_CTRL1_SPEEDSEL;\r\nreg |= MDIO_CTRL1_SPEED1G;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\nxgbe_phy_pcs_power_cycle(pdata);\r\nxgbe_phy_start_ratechange(pdata);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, DATARATE, XGBE_SPEED_1000_RATE);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, WORDMODE, XGBE_SPEED_1000_WORD);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, PLLSEL, XGBE_SPEED_1000_PLL);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, CDR_RATE,\r\nphy_data->cdr_rate[XGBE_SPEED_1000]);\r\nXSIR1_IOWRITE_BITS(pdata, SIR1_SPEED, TXAMP,\r\nphy_data->tx_amp[XGBE_SPEED_1000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG20, BLWC_ENA,\r\nphy_data->blwc[XGBE_SPEED_1000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG114, PQ_REG,\r\nphy_data->pq_skew[XGBE_SPEED_1000]);\r\nXRXTX_IOWRITE_BITS(pdata, RXTX_REG129, RXDFE_CONFIG,\r\nphy_data->dfe_tap_cfg[XGBE_SPEED_1000]);\r\nXRXTX_IOWRITE(pdata, RXTX_REG22,\r\nphy_data->dfe_tap_ena[XGBE_SPEED_1000]);\r\nxgbe_phy_complete_ratechange(pdata);\r\nnetif_dbg(pdata, link, pdata->netdev, "1GbE KX mode set\n");\r\n}\r\nstatic enum xgbe_mode xgbe_phy_cur_mode(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nenum xgbe_mode mode;\r\nunsigned int reg;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL2);\r\nreg &= MDIO_PCS_CTRL2_TYPE;\r\nif (reg == MDIO_PCS_CTRL2_10GBR) {\r\nmode = XGBE_MODE_KR;\r\n} else {\r\nif (phy_data->speed_set == XGBE_SPEEDSET_2500_10000)\r\nmode = XGBE_MODE_KX_2500;\r\nelse\r\nmode = XGBE_MODE_KX_1000;\r\n}\r\nreturn mode;\r\n}\r\nstatic enum xgbe_mode xgbe_phy_switch_mode(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nenum xgbe_mode mode;\r\nif (xgbe_phy_cur_mode(pdata) == XGBE_MODE_KR) {\r\nif (phy_data->speed_set == XGBE_SPEEDSET_2500_10000)\r\nmode = XGBE_MODE_KX_2500;\r\nelse\r\nmode = XGBE_MODE_KX_1000;\r\n} else {\r\nmode = XGBE_MODE_KR;\r\n}\r\nreturn mode;\r\n}\r\nstatic enum xgbe_mode xgbe_phy_get_mode(struct xgbe_prv_data *pdata,\r\nint speed)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nswitch (speed) {\r\ncase SPEED_1000:\r\nreturn (phy_data->speed_set == XGBE_SPEEDSET_1000_10000)\r\n? XGBE_MODE_KX_1000 : XGBE_MODE_UNKNOWN;\r\ncase SPEED_2500:\r\nreturn (phy_data->speed_set == XGBE_SPEEDSET_2500_10000)\r\n? XGBE_MODE_KX_2500 : XGBE_MODE_UNKNOWN;\r\ncase SPEED_10000:\r\nreturn XGBE_MODE_KR;\r\ndefault:\r\nreturn XGBE_MODE_UNKNOWN;\r\n}\r\n}\r\nstatic void xgbe_phy_set_mode(struct xgbe_prv_data *pdata, enum xgbe_mode mode)\r\n{\r\nswitch (mode) {\r\ncase XGBE_MODE_KX_1000:\r\nxgbe_phy_kx_1000_mode(pdata);\r\nbreak;\r\ncase XGBE_MODE_KX_2500:\r\nxgbe_phy_kx_2500_mode(pdata);\r\nbreak;\r\ncase XGBE_MODE_KR:\r\nxgbe_phy_kr_mode(pdata);\r\nbreak;\r\ndefault:\r\nbreak;\r\n}\r\n}\r\nstatic bool xgbe_phy_check_mode(struct xgbe_prv_data *pdata,\r\nenum xgbe_mode mode, u32 advert)\r\n{\r\nif (pdata->phy.autoneg == AUTONEG_ENABLE) {\r\nif (pdata->phy.advertising & advert)\r\nreturn true;\r\n} else {\r\nenum xgbe_mode cur_mode;\r\ncur_mode = xgbe_phy_get_mode(pdata, pdata->phy.speed);\r\nif (cur_mode == mode)\r\nreturn true;\r\n}\r\nreturn false;\r\n}\r\nstatic bool xgbe_phy_use_mode(struct xgbe_prv_data *pdata, enum xgbe_mode mode)\r\n{\r\nswitch (mode) {\r\ncase XGBE_MODE_KX_1000:\r\nreturn xgbe_phy_check_mode(pdata, mode,\r\nADVERTISED_1000baseKX_Full);\r\ncase XGBE_MODE_KX_2500:\r\nreturn xgbe_phy_check_mode(pdata, mode,\r\nADVERTISED_2500baseX_Full);\r\ncase XGBE_MODE_KR:\r\nreturn xgbe_phy_check_mode(pdata, mode,\r\nADVERTISED_10000baseKR_Full);\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic bool xgbe_phy_valid_speed(struct xgbe_prv_data *pdata, int speed)\r\n{\r\nstruct xgbe_phy_data *phy_data = pdata->phy_data;\r\nswitch (speed) {\r\ncase SPEED_1000:\r\nif (phy_data->speed_set != XGBE_SPEEDSET_1000_10000)\r\nreturn false;\r\nreturn true;\r\ncase SPEED_2500:\r\nif (phy_data->speed_set != XGBE_SPEEDSET_2500_10000)\r\nreturn false;\r\nreturn true;\r\ncase SPEED_10000:\r\nreturn true;\r\ndefault:\r\nreturn false;\r\n}\r\n}\r\nstatic int xgbe_phy_link_status(struct xgbe_prv_data *pdata, int *an_restart)\r\n{\r\nunsigned int reg;\r\n*an_restart = 0;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_STAT1);\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_STAT1);\r\nreturn (reg & MDIO_STAT1_LSTATUS) ? 1 : 0;\r\n}\r\nstatic void xgbe_phy_stop(struct xgbe_prv_data *pdata)\r\n{\r\n}\r\nstatic int xgbe_phy_start(struct xgbe_prv_data *pdata)\r\n{\r\nreturn 0;\r\n}\r\nstatic int xgbe_phy_reset(struct xgbe_prv_data *pdata)\r\n{\r\nunsigned int reg, count;\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\nreg |= MDIO_CTRL1_RESET;\r\nXMDIO_WRITE(pdata, MDIO_MMD_PCS, MDIO_CTRL1, reg);\r\ncount = 50;\r\ndo {\r\nmsleep(20);\r\nreg = XMDIO_READ(pdata, MDIO_MMD_PCS, MDIO_CTRL1);\r\n} while ((reg & MDIO_CTRL1_RESET) && --count);\r\nif (reg & MDIO_CTRL1_RESET)\r\nreturn -ETIMEDOUT;\r\nreturn 0;\r\n}\r\nstatic void xgbe_phy_exit(struct xgbe_prv_data *pdata)\r\n{\r\n}\r\nstatic int xgbe_phy_init(struct xgbe_prv_data *pdata)\r\n{\r\nstruct xgbe_phy_data *phy_data;\r\nint ret;\r\nphy_data = devm_kzalloc(pdata->dev, sizeof(*phy_data), GFP_KERNEL);\r\nif (!phy_data)\r\nreturn -ENOMEM;\r\nret = device_property_read_u32(pdata->phy_dev, XGBE_SPEEDSET_PROPERTY,\r\n&phy_data->speed_set);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_SPEEDSET_PROPERTY);\r\nreturn ret;\r\n}\r\nswitch (phy_data->speed_set) {\r\ncase XGBE_SPEEDSET_1000_10000:\r\ncase XGBE_SPEEDSET_2500_10000:\r\nbreak;\r\ndefault:\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_SPEEDSET_PROPERTY);\r\nreturn -EINVAL;\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_BLWC_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_BLWC_PROPERTY,\r\nphy_data->blwc,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_BLWC_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->blwc, xgbe_phy_blwc,\r\nsizeof(phy_data->blwc));\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_CDR_RATE_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_CDR_RATE_PROPERTY,\r\nphy_data->cdr_rate,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_CDR_RATE_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->cdr_rate, xgbe_phy_cdr_rate,\r\nsizeof(phy_data->cdr_rate));\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_PQ_SKEW_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_PQ_SKEW_PROPERTY,\r\nphy_data->pq_skew,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_PQ_SKEW_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->pq_skew, xgbe_phy_pq_skew,\r\nsizeof(phy_data->pq_skew));\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_TX_AMP_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_TX_AMP_PROPERTY,\r\nphy_data->tx_amp,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_TX_AMP_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->tx_amp, xgbe_phy_tx_amp,\r\nsizeof(phy_data->tx_amp));\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_DFE_CFG_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_DFE_CFG_PROPERTY,\r\nphy_data->dfe_tap_cfg,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_DFE_CFG_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->dfe_tap_cfg, xgbe_phy_dfe_tap_cfg,\r\nsizeof(phy_data->dfe_tap_cfg));\r\n}\r\nif (device_property_present(pdata->phy_dev, XGBE_DFE_ENA_PROPERTY)) {\r\nret = device_property_read_u32_array(pdata->phy_dev,\r\nXGBE_DFE_ENA_PROPERTY,\r\nphy_data->dfe_tap_ena,\r\nXGBE_SPEEDS);\r\nif (ret) {\r\ndev_err(pdata->dev, "invalid %s property\n",\r\nXGBE_DFE_ENA_PROPERTY);\r\nreturn ret;\r\n}\r\n} else {\r\nmemcpy(phy_data->dfe_tap_ena, xgbe_phy_dfe_tap_ena,\r\nsizeof(phy_data->dfe_tap_ena));\r\n}\r\npdata->phy.supported = SUPPORTED_Autoneg;\r\npdata->phy.supported |= SUPPORTED_Pause | SUPPORTED_Asym_Pause;\r\npdata->phy.supported |= SUPPORTED_Backplane;\r\npdata->phy.supported |= SUPPORTED_10000baseKR_Full;\r\nswitch (phy_data->speed_set) {\r\ncase XGBE_SPEEDSET_1000_10000:\r\npdata->phy.supported |= SUPPORTED_1000baseKX_Full;\r\nbreak;\r\ncase XGBE_SPEEDSET_2500_10000:\r\npdata->phy.supported |= SUPPORTED_2500baseX_Full;\r\nbreak;\r\n}\r\nif (pdata->fec_ability & MDIO_PMA_10GBR_FECABLE_ABLE)\r\npdata->phy.supported |= SUPPORTED_10000baseR_FEC;\r\npdata->phy_data = phy_data;\r\nreturn 0;\r\n}\r\nvoid xgbe_init_function_ptrs_phy_v1(struct xgbe_phy_if *phy_if)\r\n{\r\nstruct xgbe_phy_impl_if *phy_impl = &phy_if->phy_impl;\r\nphy_impl->init = xgbe_phy_init;\r\nphy_impl->exit = xgbe_phy_exit;\r\nphy_impl->reset = xgbe_phy_reset;\r\nphy_impl->start = xgbe_phy_start;\r\nphy_impl->stop = xgbe_phy_stop;\r\nphy_impl->link_status = xgbe_phy_link_status;\r\nphy_impl->valid_speed = xgbe_phy_valid_speed;\r\nphy_impl->use_mode = xgbe_phy_use_mode;\r\nphy_impl->set_mode = xgbe_phy_set_mode;\r\nphy_impl->get_mode = xgbe_phy_get_mode;\r\nphy_impl->switch_mode = xgbe_phy_switch_mode;\r\nphy_impl->cur_mode = xgbe_phy_cur_mode;\r\nphy_impl->an_mode = xgbe_phy_an_mode;\r\nphy_impl->an_config = xgbe_phy_an_config;\r\nphy_impl->an_advertising = xgbe_phy_an_advertising;\r\nphy_impl->an_outcome = xgbe_phy_an_outcome;\r\nphy_impl->kr_training_pre = xgbe_phy_kr_training_pre;\r\nphy_impl->kr_training_post = xgbe_phy_kr_training_post;\r\n}
