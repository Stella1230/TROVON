static void\r\nnv20_devinit_meminit(struct nvkm_devinit *init)\r\n{\r\nstruct nvkm_subdev *subdev = &init->subdev;\r\nstruct nvkm_device *device = subdev->device;\r\nuint32_t mask = (device->chipset >= 0x25 ? 0x300 : 0x900);\r\nuint32_t amount, off;\r\nstruct io_mapping *fb;\r\nfb = fbmem_init(device);\r\nif (!fb) {\r\nnvkm_error(subdev, "failed to map fb\n");\r\nreturn;\r\n}\r\nnvkm_wr32(device, NV10_PFB_REFCTRL, NV10_PFB_REFCTRL_VALID_1);\r\nnvkm_mask(device, NV04_PFB_CFG0, 0, mask);\r\namount = nvkm_rd32(device, 0x10020c);\r\nfor (off = amount; off > 0x2000000; off -= 0x2000000)\r\nfbmem_poke(fb, off - 4, off);\r\namount = nvkm_rd32(device, 0x10020c);\r\nif (amount != fbmem_peek(fb, amount - 4))\r\nnvkm_mask(device, NV04_PFB_CFG0, mask, 0);\r\nfbmem_fini(fb);\r\n}\r\nint\r\nnv20_devinit_new(struct nvkm_device *device, int index,\r\nstruct nvkm_devinit **pinit)\r\n{\r\nreturn nv04_devinit_new_(&nv20_devinit, device, index, pinit);\r\n}
