int fdt_setprop_inplace_namelen_partial(void *fdt, int nodeoffset,\r\nconst char *name, int namelen,\r\nuint32_t idx, const void *val,\r\nint len)\r\n{\r\nvoid *propval;\r\nint proplen;\r\npropval = fdt_getprop_namelen_w(fdt, nodeoffset, name, namelen,\r\n&proplen);\r\nif (!propval)\r\nreturn proplen;\r\nif (proplen < (len + idx))\r\nreturn -FDT_ERR_NOSPACE;\r\nmemcpy((char *)propval + idx, val, len);\r\nreturn 0;\r\n}\r\nint fdt_setprop_inplace(void *fdt, int nodeoffset, const char *name,\r\nconst void *val, int len)\r\n{\r\nconst void *propval;\r\nint proplen;\r\npropval = fdt_getprop(fdt, nodeoffset, name, &proplen);\r\nif (! propval)\r\nreturn proplen;\r\nif (proplen != len)\r\nreturn -FDT_ERR_NOSPACE;\r\nreturn fdt_setprop_inplace_namelen_partial(fdt, nodeoffset, name,\r\nstrlen(name), 0,\r\nval, len);\r\n}\r\nstatic void _fdt_nop_region(void *start, int len)\r\n{\r\nfdt32_t *p;\r\nfor (p = start; (char *)p < ((char *)start + len); p++)\r\n*p = cpu_to_fdt32(FDT_NOP);\r\n}\r\nint fdt_nop_property(void *fdt, int nodeoffset, const char *name)\r\n{\r\nstruct fdt_property *prop;\r\nint len;\r\nprop = fdt_get_property_w(fdt, nodeoffset, name, &len);\r\nif (! prop)\r\nreturn len;\r\n_fdt_nop_region(prop, len + sizeof(*prop));\r\nreturn 0;\r\n}\r\nint _fdt_node_end_offset(void *fdt, int offset)\r\n{\r\nint depth = 0;\r\nwhile ((offset >= 0) && (depth >= 0))\r\noffset = fdt_next_node(fdt, offset, &depth);\r\nreturn offset;\r\n}\r\nint fdt_nop_node(void *fdt, int nodeoffset)\r\n{\r\nint endoffset;\r\nendoffset = _fdt_node_end_offset(fdt, nodeoffset);\r\nif (endoffset < 0)\r\nreturn endoffset;\r\n_fdt_nop_region(fdt_offset_ptr_w(fdt, nodeoffset, 0),\r\nendoffset - nodeoffset);\r\nreturn 0;\r\n}
