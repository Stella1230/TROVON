void __init ralink_clk_init(void)\r\n{\r\nunsigned long cpu_rate, sys_rate;\r\nu32 syscfg0;\r\nu32 clksel;\r\nu32 ddr2;\r\nsyscfg0 = rt_sysc_r32(RT3883_SYSC_REG_SYSCFG0);\r\nclksel = ((syscfg0 >> RT3883_SYSCFG0_CPUCLK_SHIFT) &\r\nRT3883_SYSCFG0_CPUCLK_MASK);\r\nddr2 = syscfg0 & RT3883_SYSCFG0_DRAM_TYPE_DDR2;\r\nswitch (clksel) {\r\ncase RT3883_SYSCFG0_CPUCLK_250:\r\ncpu_rate = 250000000;\r\nsys_rate = (ddr2) ? 125000000 : 83000000;\r\nbreak;\r\ncase RT3883_SYSCFG0_CPUCLK_384:\r\ncpu_rate = 384000000;\r\nsys_rate = (ddr2) ? 128000000 : 96000000;\r\nbreak;\r\ncase RT3883_SYSCFG0_CPUCLK_480:\r\ncpu_rate = 480000000;\r\nsys_rate = (ddr2) ? 160000000 : 120000000;\r\nbreak;\r\ncase RT3883_SYSCFG0_CPUCLK_500:\r\ncpu_rate = 500000000;\r\nsys_rate = (ddr2) ? 166000000 : 125000000;\r\nbreak;\r\n}\r\nralink_clk_add("cpu", cpu_rate);\r\nralink_clk_add("10000100.timer", sys_rate);\r\nralink_clk_add("10000120.watchdog", sys_rate);\r\nralink_clk_add("10000500.uart", 40000000);\r\nralink_clk_add("10000900.i2c", 40000000);\r\nralink_clk_add("10000a00.i2s", 40000000);\r\nralink_clk_add("10000b00.spi", sys_rate);\r\nralink_clk_add("10000b40.spi", sys_rate);\r\nralink_clk_add("10000c00.uartlite", 40000000);\r\nralink_clk_add("10100000.ethernet", sys_rate);\r\nralink_clk_add("10180000.wmac", 40000000);\r\n}\r\nvoid __init ralink_of_remap(void)\r\n{\r\nrt_sysc_membase = plat_of_remap_node("ralink,rt3883-sysc");\r\nrt_memc_membase = plat_of_remap_node("ralink,rt3883-memc");\r\nif (!rt_sysc_membase || !rt_memc_membase)\r\npanic("Failed to remap core resources");\r\n}\r\nvoid prom_soc_init(struct ralink_soc_info *soc_info)\r\n{\r\nvoid __iomem *sysc = (void __iomem *) KSEG1ADDR(RT3883_SYSC_BASE);\r\nconst char *name;\r\nu32 n0;\r\nu32 n1;\r\nu32 id;\r\nn0 = __raw_readl(sysc + RT3883_SYSC_REG_CHIPID0_3);\r\nn1 = __raw_readl(sysc + RT3883_SYSC_REG_CHIPID4_7);\r\nid = __raw_readl(sysc + RT3883_SYSC_REG_REVID);\r\nif (n0 == RT3883_CHIP_NAME0 && n1 == RT3883_CHIP_NAME1) {\r\nsoc_info->compatible = "ralink,rt3883-soc";\r\nname = "RT3883";\r\n} else {\r\npanic("rt3883: unknown SoC, n0:%08x n1:%08x", n0, n1);\r\n}\r\nsnprintf(soc_info->sys_type, RAMIPS_SYS_TYPE_LEN,\r\n"Ralink %s ver:%u eco:%u",\r\nname,\r\n(id >> RT3883_REVID_VER_ID_SHIFT) & RT3883_REVID_VER_ID_MASK,\r\n(id & RT3883_REVID_ECO_ID_MASK));\r\nsoc_info->mem_base = RT3883_SDRAM_BASE;\r\nsoc_info->mem_size_min = RT3883_MEM_SIZE_MIN;\r\nsoc_info->mem_size_max = RT3883_MEM_SIZE_MAX;\r\nrt2880_pinmux_data = rt3883_pinmux_data;\r\nralink_soc = RT3883_SOC;\r\n}
