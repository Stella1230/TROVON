void __init tegra20_init_speedo_data(struct tegra_sku_info *sku_info)\r\n{\r\nu32 reg;\r\nu32 val;\r\nint i;\r\nBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) != SPEEDO_ID_COUNT);\r\nBUILD_BUG_ON(ARRAY_SIZE(soc_process_speedos) != SPEEDO_ID_COUNT);\r\nif (SPEEDO_ID_SELECT_0(sku_info->revision))\r\nsku_info->soc_speedo_id = SPEEDO_ID_0;\r\nelse if (SPEEDO_ID_SELECT_1(sku_info->sku_id))\r\nsku_info->soc_speedo_id = SPEEDO_ID_1;\r\nelse\r\nsku_info->soc_speedo_id = SPEEDO_ID_2;\r\nval = 0;\r\nfor (i = CPU_SPEEDO_MSBIT; i >= CPU_SPEEDO_LSBIT; i--) {\r\nreg = tegra_fuse_read_spare(i) |\r\ntegra_fuse_read_spare(i + CPU_SPEEDO_REDUND_OFFS);\r\nval = (val << 1) | (reg & 0x1);\r\n}\r\nval = val * SPEEDO_MULT;\r\npr_debug("Tegra CPU speedo value %u\n", val);\r\nfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\r\nif (val <= cpu_process_speedos[sku_info->soc_speedo_id][i])\r\nbreak;\r\n}\r\nsku_info->cpu_process_id = i;\r\nval = 0;\r\nfor (i = SOC_SPEEDO_MSBIT; i >= SOC_SPEEDO_LSBIT; i--) {\r\nreg = tegra_fuse_read_spare(i) |\r\ntegra_fuse_read_spare(i + SOC_SPEEDO_REDUND_OFFS);\r\nval = (val << 1) | (reg & 0x1);\r\n}\r\nval = val * SPEEDO_MULT;\r\npr_debug("Core speedo value %u\n", val);\r\nfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\r\nif (val <= soc_process_speedos[sku_info->soc_speedo_id][i])\r\nbreak;\r\n}\r\nsku_info->soc_process_id = i;\r\n}
