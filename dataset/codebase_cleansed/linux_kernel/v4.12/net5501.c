static void __init register_net5501(void)\r\n{\r\nplatform_add_devices(net5501_devs, ARRAY_SIZE(net5501_devs));\r\n}\r\nstatic bool __init net5501_present(void)\r\n{\r\nint i;\r\nunsigned char *rombase, *bios;\r\nbool found = false;\r\nrombase = ioremap(BIOS_REGION_BASE, BIOS_REGION_SIZE - 1);\r\nif (!rombase) {\r\nprintk(KERN_ERR "%s: failed to get rombase\n", KBUILD_MODNAME);\r\nreturn found;\r\n}\r\nbios = rombase + 0x20;\r\nif (memcmp(bios, "comBIOS", 7))\r\ngoto unmap;\r\nfor (i = 0; i < ARRAY_SIZE(boards); i++) {\r\nunsigned char *model = rombase + boards[i].offset;\r\nif (!memcmp(model, boards[i].sig, boards[i].len)) {\r\nprintk(KERN_INFO "%s: system is recognized as \"%s\"\n",\r\nKBUILD_MODNAME, model);\r\nfound = true;\r\nbreak;\r\n}\r\n}\r\nunmap:\r\niounmap(rombase);\r\nreturn found;\r\n}\r\nstatic int __init net5501_init(void)\r\n{\r\nif (!is_geode())\r\nreturn 0;\r\nif (!net5501_present())\r\nreturn 0;\r\nregister_net5501();\r\nreturn 0;\r\n}
