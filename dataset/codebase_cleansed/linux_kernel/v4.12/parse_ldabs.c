static inline int ip_is_fragment(struct __sk_buff *ctx, __u64 nhoff)\r\n{\r\nreturn load_half(ctx, nhoff + offsetof(struct iphdr, frag_off))\r\n& (IP_MF | IP_OFFSET);\r\n}\r\nint handle_ingress(struct __sk_buff *skb)\r\n{\r\n__u64 troff = ETH_HLEN + sizeof(struct iphdr);\r\nif (load_half(skb, offsetof(struct ethhdr, h_proto)) != ETH_P_IP)\r\nreturn 0;\r\nif (load_byte(skb, ETH_HLEN + offsetof(struct iphdr, protocol)) != IPPROTO_UDP ||\r\nload_byte(skb, ETH_HLEN) != 0x45)\r\nreturn 0;\r\nif (ip_is_fragment(skb, ETH_HLEN))\r\nreturn 0;\r\nif (load_half(skb, troff + offsetof(struct udphdr, dest)) == DEFAULT_PKTGEN_UDP_PORT)\r\nreturn TC_ACT_SHOT;\r\nreturn 0;\r\n}
