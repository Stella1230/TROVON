static int midi_unbind(struct usb_composite_dev *dev)\r\n{\r\nusb_put_function(f_midi);\r\nusb_put_function_instance(fi_midi);\r\nreturn 0;\r\n}\r\nstatic int midi_bind_config(struct usb_configuration *c)\r\n{\r\nint status;\r\nf_midi = usb_get_function(fi_midi);\r\nif (IS_ERR(f_midi))\r\nreturn PTR_ERR(f_midi);\r\nstatus = usb_add_function(c, f_midi);\r\nif (status < 0) {\r\nusb_put_function(f_midi);\r\nreturn status;\r\n}\r\nreturn 0;\r\n}\r\nstatic int midi_bind(struct usb_composite_dev *cdev)\r\n{\r\nstruct f_midi_opts *midi_opts;\r\nint status;\r\nfi_midi = usb_get_function_instance("midi");\r\nif (IS_ERR(fi_midi))\r\nreturn PTR_ERR(fi_midi);\r\nmidi_opts = container_of(fi_midi, struct f_midi_opts, func_inst);\r\nmidi_opts->index = index;\r\nmidi_opts->id = id;\r\nmidi_opts->in_ports = in_ports;\r\nmidi_opts->out_ports = out_ports;\r\nmidi_opts->buflen = buflen;\r\nmidi_opts->qlen = qlen;\r\nstatus = usb_string_ids_tab(cdev, strings_dev);\r\nif (status < 0)\r\ngoto put;\r\ndevice_desc.iManufacturer = strings_dev[USB_GADGET_MANUFACTURER_IDX].id;\r\ndevice_desc.iProduct = strings_dev[USB_GADGET_PRODUCT_IDX].id;\r\nmidi_config.iConfiguration = strings_dev[STRING_DESCRIPTION_IDX].id;\r\nstatus = usb_add_config(cdev, &midi_config, midi_bind_config);\r\nif (status < 0)\r\ngoto put;\r\nusb_composite_overwrite_options(cdev, &coverwrite);\r\npr_info("%s\n", longname);\r\nreturn 0;\r\nput:\r\nusb_put_function_instance(fi_midi);\r\nreturn status;\r\n}
