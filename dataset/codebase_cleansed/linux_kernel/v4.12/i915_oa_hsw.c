static const struct i915_oa_reg *\r\nget_render_basic_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_render_basic);\r\nreturn mux_config_render_basic;\r\n}\r\nstatic const struct i915_oa_reg *\r\nget_compute_basic_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_compute_basic);\r\nreturn mux_config_compute_basic;\r\n}\r\nstatic const struct i915_oa_reg *\r\nget_compute_extended_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_compute_extended);\r\nreturn mux_config_compute_extended;\r\n}\r\nstatic const struct i915_oa_reg *\r\nget_memory_reads_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_memory_reads);\r\nreturn mux_config_memory_reads;\r\n}\r\nstatic const struct i915_oa_reg *\r\nget_memory_writes_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_memory_writes);\r\nreturn mux_config_memory_writes;\r\n}\r\nstatic const struct i915_oa_reg *\r\nget_sampler_balance_mux_config(struct drm_i915_private *dev_priv,\r\nint *len)\r\n{\r\n*len = ARRAY_SIZE(mux_config_sampler_balance);\r\nreturn mux_config_sampler_balance;\r\n}\r\nint i915_oa_select_metric_set_hsw(struct drm_i915_private *dev_priv)\r\n{\r\ndev_priv->perf.oa.mux_regs = NULL;\r\ndev_priv->perf.oa.mux_regs_len = 0;\r\ndev_priv->perf.oa.b_counter_regs = NULL;\r\ndev_priv->perf.oa.b_counter_regs_len = 0;\r\nswitch (dev_priv->perf.oa.metrics_set) {\r\ncase METRIC_SET_ID_RENDER_BASIC:\r\ndev_priv->perf.oa.mux_regs =\r\nget_render_basic_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"RENDER_BASIC\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_render_basic;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_render_basic);\r\nreturn 0;\r\ncase METRIC_SET_ID_COMPUTE_BASIC:\r\ndev_priv->perf.oa.mux_regs =\r\nget_compute_basic_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"COMPUTE_BASIC\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_compute_basic;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_compute_basic);\r\nreturn 0;\r\ncase METRIC_SET_ID_COMPUTE_EXTENDED:\r\ndev_priv->perf.oa.mux_regs =\r\nget_compute_extended_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"COMPUTE_EXTENDED\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_compute_extended;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_compute_extended);\r\nreturn 0;\r\ncase METRIC_SET_ID_MEMORY_READS:\r\ndev_priv->perf.oa.mux_regs =\r\nget_memory_reads_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"MEMORY_READS\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_memory_reads;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_memory_reads);\r\nreturn 0;\r\ncase METRIC_SET_ID_MEMORY_WRITES:\r\ndev_priv->perf.oa.mux_regs =\r\nget_memory_writes_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"MEMORY_WRITES\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_memory_writes;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_memory_writes);\r\nreturn 0;\r\ncase METRIC_SET_ID_SAMPLER_BALANCE:\r\ndev_priv->perf.oa.mux_regs =\r\nget_sampler_balance_mux_config(dev_priv,\r\n&dev_priv->perf.oa.mux_regs_len);\r\nif (!dev_priv->perf.oa.mux_regs) {\r\nDRM_DEBUG_DRIVER("No suitable MUX config for \"SAMPLER_BALANCE\" metric set");\r\nreturn -EINVAL;\r\n}\r\ndev_priv->perf.oa.b_counter_regs =\r\nb_counter_config_sampler_balance;\r\ndev_priv->perf.oa.b_counter_regs_len =\r\nARRAY_SIZE(b_counter_config_sampler_balance);\r\nreturn 0;\r\ndefault:\r\nreturn -ENODEV;\r\n}\r\n}\r\nstatic ssize_t\r\nshow_render_basic_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_RENDER_BASIC);\r\n}\r\nstatic ssize_t\r\nshow_compute_basic_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_COMPUTE_BASIC);\r\n}\r\nstatic ssize_t\r\nshow_compute_extended_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_COMPUTE_EXTENDED);\r\n}\r\nstatic ssize_t\r\nshow_memory_reads_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_MEMORY_READS);\r\n}\r\nstatic ssize_t\r\nshow_memory_writes_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_MEMORY_WRITES);\r\n}\r\nstatic ssize_t\r\nshow_sampler_balance_id(struct device *kdev, struct device_attribute *attr, char *buf)\r\n{\r\nreturn sprintf(buf, "%d\n", METRIC_SET_ID_SAMPLER_BALANCE);\r\n}\r\nint\r\ni915_perf_register_sysfs_hsw(struct drm_i915_private *dev_priv)\r\n{\r\nint mux_len;\r\nint ret = 0;\r\nif (get_render_basic_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_render_basic);\r\nif (ret)\r\ngoto error_render_basic;\r\n}\r\nif (get_compute_basic_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_compute_basic);\r\nif (ret)\r\ngoto error_compute_basic;\r\n}\r\nif (get_compute_extended_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_compute_extended);\r\nif (ret)\r\ngoto error_compute_extended;\r\n}\r\nif (get_memory_reads_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_memory_reads);\r\nif (ret)\r\ngoto error_memory_reads;\r\n}\r\nif (get_memory_writes_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_memory_writes);\r\nif (ret)\r\ngoto error_memory_writes;\r\n}\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len)) {\r\nret = sysfs_create_group(dev_priv->perf.metrics_kobj, &group_sampler_balance);\r\nif (ret)\r\ngoto error_sampler_balance;\r\n}\r\nreturn 0;\r\nerror_sampler_balance:\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_memory_writes);\r\nerror_memory_writes:\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_memory_reads);\r\nerror_memory_reads:\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_compute_extended);\r\nerror_compute_extended:\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_compute_basic);\r\nerror_compute_basic:\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_render_basic);\r\nerror_render_basic:\r\nreturn ret;\r\n}\r\nvoid\r\ni915_perf_unregister_sysfs_hsw(struct drm_i915_private *dev_priv)\r\n{\r\nint mux_len;\r\nif (get_render_basic_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_render_basic);\r\nif (get_compute_basic_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_compute_basic);\r\nif (get_compute_extended_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_compute_extended);\r\nif (get_memory_reads_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_memory_reads);\r\nif (get_memory_writes_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_memory_writes);\r\nif (get_sampler_balance_mux_config(dev_priv, &mux_len))\r\nsysfs_remove_group(dev_priv->perf.metrics_kobj, &group_sampler_balance);\r\n}
