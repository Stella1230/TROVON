static int s5pv210_rate_to_clk(unsigned long rate, u32 *reg)\r\n{\r\nswitch (rate) {\r\ncase 12 * MHZ:\r\n*reg = S5PV210_UPHYCLK_PHYFSEL_12MHZ;\r\nbreak;\r\ncase 24 * MHZ:\r\n*reg = S5PV210_UPHYCLK_PHYFSEL_24MHZ;\r\nbreak;\r\ncase 48 * MHZ:\r\n*reg = S5PV210_UPHYCLK_PHYFSEL_48MHZ;\r\nbreak;\r\ndefault:\r\nreturn -EINVAL;\r\n}\r\nreturn 0;\r\n}\r\nstatic void s5pv210_isol(struct samsung_usb2_phy_instance *inst, bool on)\r\n{\r\nstruct samsung_usb2_phy_driver *drv = inst->drv;\r\nu32 mask;\r\nswitch (inst->cfg->id) {\r\ncase S5PV210_DEVICE:\r\nmask = S5PV210_USB_ISOL_DEVICE;\r\nbreak;\r\ncase S5PV210_HOST:\r\nmask = S5PV210_USB_ISOL_HOST;\r\nbreak;\r\ndefault:\r\nreturn;\r\n}\r\nregmap_update_bits(drv->reg_pmu, S5PV210_USB_ISOL_OFFSET,\r\nmask, on ? 0 : mask);\r\n}\r\nstatic void s5pv210_phy_pwr(struct samsung_usb2_phy_instance *inst, bool on)\r\n{\r\nstruct samsung_usb2_phy_driver *drv = inst->drv;\r\nu32 rstbits = 0;\r\nu32 phypwr = 0;\r\nu32 rst;\r\nu32 pwr;\r\nswitch (inst->cfg->id) {\r\ncase S5PV210_DEVICE:\r\nphypwr = S5PV210_UPHYPWR_PHY0;\r\nrstbits = S5PV210_URSTCON_PHY0;\r\nbreak;\r\ncase S5PV210_HOST:\r\nphypwr = S5PV210_UPHYPWR_PHY1;\r\nrstbits = S5PV210_URSTCON_PHY1_ALL |\r\nS5PV210_URSTCON_HOST_LINK_ALL;\r\nbreak;\r\n}\r\nif (on) {\r\nwritel(drv->ref_reg_val, drv->reg_phy + S5PV210_UPHYCLK);\r\npwr = readl(drv->reg_phy + S5PV210_UPHYPWR);\r\npwr &= ~phypwr;\r\nwritel(pwr, drv->reg_phy + S5PV210_UPHYPWR);\r\nrst = readl(drv->reg_phy + S5PV210_UPHYRST);\r\nrst |= rstbits;\r\nwritel(rst, drv->reg_phy + S5PV210_UPHYRST);\r\nudelay(10);\r\nrst &= ~rstbits;\r\nwritel(rst, drv->reg_phy + S5PV210_UPHYRST);\r\n} else {\r\npwr = readl(drv->reg_phy + S5PV210_UPHYPWR);\r\npwr |= phypwr;\r\nwritel(pwr, drv->reg_phy + S5PV210_UPHYPWR);\r\n}\r\n}\r\nstatic int s5pv210_power_on(struct samsung_usb2_phy_instance *inst)\r\n{\r\ns5pv210_isol(inst, 0);\r\ns5pv210_phy_pwr(inst, 1);\r\nreturn 0;\r\n}\r\nstatic int s5pv210_power_off(struct samsung_usb2_phy_instance *inst)\r\n{\r\ns5pv210_phy_pwr(inst, 0);\r\ns5pv210_isol(inst, 1);\r\nreturn 0;\r\n}
