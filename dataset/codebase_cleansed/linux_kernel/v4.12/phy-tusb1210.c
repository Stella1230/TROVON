static int tusb1210_power_on(struct phy *phy)\r\n{\r\nstruct tusb1210 *tusb = phy_get_drvdata(phy);\r\ngpiod_set_value_cansleep(tusb->gpio_reset, 1);\r\ngpiod_set_value_cansleep(tusb->gpio_cs, 1);\r\nif (tusb->vendor_specific2)\r\nulpi_write(tusb->ulpi, TUSB1210_VENDOR_SPECIFIC2,\r\ntusb->vendor_specific2);\r\nreturn 0;\r\n}\r\nstatic int tusb1210_power_off(struct phy *phy)\r\n{\r\nstruct tusb1210 *tusb = phy_get_drvdata(phy);\r\ngpiod_set_value_cansleep(tusb->gpio_reset, 0);\r\ngpiod_set_value_cansleep(tusb->gpio_cs, 0);\r\nreturn 0;\r\n}\r\nstatic int tusb1210_probe(struct ulpi *ulpi)\r\n{\r\nstruct tusb1210 *tusb;\r\nu8 val, reg;\r\ntusb = devm_kzalloc(&ulpi->dev, sizeof(*tusb), GFP_KERNEL);\r\nif (!tusb)\r\nreturn -ENOMEM;\r\ntusb->gpio_reset = devm_gpiod_get_optional(&ulpi->dev, "reset",\r\nGPIOD_OUT_LOW);\r\nif (IS_ERR(tusb->gpio_reset))\r\nreturn PTR_ERR(tusb->gpio_reset);\r\ngpiod_set_value_cansleep(tusb->gpio_reset, 1);\r\ntusb->gpio_cs = devm_gpiod_get_optional(&ulpi->dev, "cs",\r\nGPIOD_OUT_LOW);\r\nif (IS_ERR(tusb->gpio_cs))\r\nreturn PTR_ERR(tusb->gpio_cs);\r\ngpiod_set_value_cansleep(tusb->gpio_cs, 1);\r\ndevice_property_read_u8(&ulpi->dev, "ihstx", &val);\r\nreg = val << TUSB1210_VENDOR_SPECIFIC2_IHSTX_SHIFT;\r\ndevice_property_read_u8(&ulpi->dev, "zhsdrv", &val);\r\nreg |= val << TUSB1210_VENDOR_SPECIFIC2_ZHSDRV_SHIFT;\r\ndevice_property_read_u8(&ulpi->dev, "datapolarity", &val);\r\nreg |= val << TUSB1210_VENDOR_SPECIFIC2_DP_SHIFT;\r\nif (reg) {\r\nulpi_write(ulpi, TUSB1210_VENDOR_SPECIFIC2, reg);\r\ntusb->vendor_specific2 = reg;\r\n}\r\ntusb->phy = ulpi_phy_create(ulpi, &phy_ops);\r\nif (IS_ERR(tusb->phy))\r\nreturn PTR_ERR(tusb->phy);\r\ntusb->ulpi = ulpi;\r\nphy_set_drvdata(tusb->phy, tusb);\r\nulpi_set_drvdata(ulpi, tusb);\r\nreturn 0;\r\n}\r\nstatic void tusb1210_remove(struct ulpi *ulpi)\r\n{\r\nstruct tusb1210 *tusb = ulpi_get_drvdata(ulpi);\r\nulpi_phy_destroy(ulpi, tusb->phy);\r\n}
