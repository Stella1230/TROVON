static inline int use_swiotlb(struct device *dev)\r\n{\r\nreturn dev && dev->dma_mask &&\r\n!sba_dma_ops.dma_supported(dev, *dev->dma_mask);\r\n}\r\nconst struct dma_map_ops *hwsw_dma_get_ops(struct device *dev)\r\n{\r\nif (use_swiotlb(dev))\r\nreturn &swiotlb_dma_ops;\r\nreturn &sba_dma_ops;\r\n}\r\nvoid __init\r\nhwsw_init (void)\r\n{\r\nif (swiotlb_late_init_with_default_size (2 * (1<<20)) != 0) {\r\n#ifdef CONFIG_IA64_GENERIC\r\nprintk(KERN_WARNING "%s: Failed to initialize software I/O TLB,"\r\n" reverting to hpzx1 platform vector\n", __func__);\r\nmachvec_init("hpzx1");\r\n#else\r\npanic("Unable to initialize software I/O TLB services");\r\n#endif\r\n}\r\n}
