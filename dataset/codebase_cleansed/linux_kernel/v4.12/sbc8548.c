static void __init sbc8548_pic_init(void)\r\n{\r\nstruct mpic *mpic = mpic_alloc(NULL, 0, MPIC_BIG_ENDIAN,\r\n0, 256, " OpenPIC ");\r\nBUG_ON(mpic == NULL);\r\nmpic_init(mpic);\r\n}\r\nstatic int __init sbc8548_hw_rev(void)\r\n{\r\nstruct device_node *np;\r\nstruct resource res;\r\nunsigned int *rev;\r\nint board_rev = 0;\r\nnp = of_find_compatible_node(NULL, NULL, "hw-rev");\r\nif (np == NULL) {\r\nprintk("No HW-REV found in DTB.\n");\r\nreturn -ENODEV;\r\n}\r\nof_address_to_resource(np, 0, &res);\r\nof_node_put(np);\r\nrev = ioremap(res.start,sizeof(unsigned int));\r\nboard_rev = (*rev) >> 28;\r\niounmap(rev);\r\nreturn board_rev;\r\n}\r\nstatic void __init sbc8548_setup_arch(void)\r\n{\r\nif (ppc_md.progress)\r\nppc_md.progress("sbc8548_setup_arch()", 0);\r\nfsl_pci_assign_primary();\r\nsbc_rev = sbc8548_hw_rev();\r\n}\r\nstatic void sbc8548_show_cpuinfo(struct seq_file *m)\r\n{\r\nuint pvid, svid, phid1;\r\npvid = mfspr(SPRN_PVR);\r\nsvid = mfspr(SPRN_SVR);\r\nseq_printf(m, "Vendor\t\t: Wind River\n");\r\nseq_printf(m, "Machine\t\t: SBC8548 v%d\n", sbc_rev);\r\nseq_printf(m, "PVR\t\t: 0x%x\n", pvid);\r\nseq_printf(m, "SVR\t\t: 0x%x\n", svid);\r\nphid1 = mfspr(SPRN_HID1);\r\nseq_printf(m, "PLL setting\t: 0x%x\n", ((phid1 >> 24) & 0x3f));\r\n}\r\nstatic int __init sbc8548_probe(void)\r\n{\r\nreturn of_machine_is_compatible("SBC8548");\r\n}
