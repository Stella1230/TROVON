int main(int argc, char const *argv[])\r\n{\r\nint fd, ret;\r\nchar brightness_file_path[LED_MAX_NAME_SIZE + 11];\r\nstruct pollfd pollfd;\r\nstruct timespec ts;\r\nchar buf[11];\r\nif (argc != 2) {\r\nfprintf(stderr, "Requires <device-name> argument\n");\r\nreturn 1;\r\n}\r\nsnprintf(brightness_file_path, LED_MAX_NAME_SIZE,\r\n"/sys/class/leds/%s/brightness_hw_changed", argv[1]);\r\nfd = open(brightness_file_path, O_RDONLY);\r\nif (fd == -1) {\r\nprintf("Failed to open %s file\n", brightness_file_path);\r\nreturn 1;\r\n}\r\nread(fd, buf, sizeof(buf));\r\npollfd.fd = fd;\r\npollfd.events = POLLPRI;\r\nwhile (1) {\r\nret = poll(&pollfd, 1, -1);\r\nif (ret == -1) {\r\nprintf("Failed to poll %s file (%d)\n",\r\nbrightness_file_path, ret);\r\nret = 1;\r\nbreak;\r\n}\r\nclock_gettime(CLOCK_MONOTONIC, &ts);\r\nret = read(fd, buf, sizeof(buf));\r\nif (ret < 0)\r\nbreak;\r\nret = lseek(pollfd.fd, 0, SEEK_SET);\r\nif (ret < 0) {\r\nprintf("lseek failed (%d)\n", ret);\r\nbreak;\r\n}\r\nprintf("[%ld.%09ld] %d\n", ts.tv_sec, ts.tv_nsec, atoi(buf));\r\n}\r\nclose(fd);\r\nreturn ret;\r\n}
