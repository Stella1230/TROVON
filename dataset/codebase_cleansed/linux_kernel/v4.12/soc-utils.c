int snd_soc_calc_frame_size(int sample_size, int channels, int tdm_slots)\r\n{\r\nreturn sample_size * channels * tdm_slots;\r\n}\r\nint snd_soc_params_to_frame_size(struct snd_pcm_hw_params *params)\r\n{\r\nint sample_size;\r\nsample_size = snd_pcm_format_width(params_format(params));\r\nif (sample_size < 0)\r\nreturn sample_size;\r\nreturn snd_soc_calc_frame_size(sample_size, params_channels(params),\r\n1);\r\n}\r\nint snd_soc_calc_bclk(int fs, int sample_size, int channels, int tdm_slots)\r\n{\r\nreturn fs * snd_soc_calc_frame_size(sample_size, channels, tdm_slots);\r\n}\r\nint snd_soc_params_to_bclk(struct snd_pcm_hw_params *params)\r\n{\r\nint ret;\r\nret = snd_soc_params_to_frame_size(params);\r\nif (ret > 0)\r\nreturn ret * params_rate(params);\r\nelse\r\nreturn ret;\r\n}\r\nint snd_soc_component_enable_pin(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_enable_pin(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_enable_pin(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_enable_pin_unlocked(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_enable_pin_unlocked(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_enable_pin_unlocked(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_disable_pin(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_disable_pin(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_disable_pin(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_disable_pin_unlocked(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_disable_pin_unlocked(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_disable_pin_unlocked(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_nc_pin(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_nc_pin(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_nc_pin(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_nc_pin_unlocked(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_nc_pin_unlocked(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_nc_pin_unlocked(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_get_pin_status(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_get_pin_status(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_get_pin_status(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_force_enable_pin(struct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_force_enable_pin(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_force_enable_pin(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nint snd_soc_component_force_enable_pin_unlocked(\r\nstruct snd_soc_component *component,\r\nconst char *pin)\r\n{\r\nstruct snd_soc_dapm_context *dapm =\r\nsnd_soc_component_get_dapm(component);\r\nchar *full_name;\r\nint ret;\r\nif (!component->name_prefix)\r\nreturn snd_soc_dapm_force_enable_pin_unlocked(dapm, pin);\r\nfull_name = kasprintf(GFP_KERNEL, "%s %s", component->name_prefix, pin);\r\nif (!full_name)\r\nreturn -ENOMEM;\r\nret = snd_soc_dapm_force_enable_pin_unlocked(dapm, full_name);\r\nkfree(full_name);\r\nreturn ret;\r\n}\r\nstatic int dummy_dma_open(struct snd_pcm_substream *substream)\r\n{\r\nstruct snd_soc_pcm_runtime *rtd = substream->private_data;\r\nif (!rtd->dai_link->no_pcm)\r\nsnd_soc_set_runtime_hwparams(substream, &dummy_dma_hardware);\r\nreturn 0;\r\n}\r\nint snd_soc_dai_is_dummy(struct snd_soc_dai *dai)\r\n{\r\nif (dai->driver == &dummy_dai)\r\nreturn 1;\r\nreturn 0;\r\n}\r\nstatic int snd_soc_dummy_probe(struct platform_device *pdev)\r\n{\r\nint ret;\r\nret = snd_soc_register_codec(&pdev->dev, &dummy_codec, &dummy_dai, 1);\r\nif (ret < 0)\r\nreturn ret;\r\nret = snd_soc_register_platform(&pdev->dev, &dummy_platform);\r\nif (ret < 0) {\r\nsnd_soc_unregister_codec(&pdev->dev);\r\nreturn ret;\r\n}\r\nreturn ret;\r\n}\r\nstatic int snd_soc_dummy_remove(struct platform_device *pdev)\r\n{\r\nsnd_soc_unregister_platform(&pdev->dev);\r\nsnd_soc_unregister_codec(&pdev->dev);\r\nreturn 0;\r\n}\r\nint __init snd_soc_util_init(void)\r\n{\r\nint ret;\r\nsoc_dummy_dev =\r\nplatform_device_register_simple("snd-soc-dummy", -1, NULL, 0);\r\nif (IS_ERR(soc_dummy_dev))\r\nreturn PTR_ERR(soc_dummy_dev);\r\nret = platform_driver_register(&soc_dummy_driver);\r\nif (ret != 0)\r\nplatform_device_unregister(soc_dummy_dev);\r\nreturn ret;\r\n}\r\nvoid __exit snd_soc_util_exit(void)\r\n{\r\nplatform_device_unregister(soc_dummy_dev);\r\nplatform_driver_unregister(&soc_dummy_driver);\r\n}
