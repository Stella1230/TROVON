void mac802154_dev_set_page_channel(struct net_device *dev, u8 page, u8 chan)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nstruct ieee802154_local *local = sdata->local;\r\nint res;\r\nASSERT_RTNL();\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nres = drv_set_channel(local, page, chan);\r\nif (res) {\r\npr_debug("set_channel failed\n");\r\n} else {\r\nlocal->phy->current_channel = chan;\r\nlocal->phy->current_page = page;\r\n}\r\n}\r\nint mac802154_get_params(struct net_device *dev,\r\nstruct ieee802154_llsec_params *params)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_get_params(&sdata->sec, params);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_set_params(struct net_device *dev,\r\nconst struct ieee802154_llsec_params *params,\r\nint changed)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_set_params(&sdata->sec, params, changed);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_add_key(struct net_device *dev,\r\nconst struct ieee802154_llsec_key_id *id,\r\nconst struct ieee802154_llsec_key *key)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_key_add(&sdata->sec, id, key);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_del_key(struct net_device *dev,\r\nconst struct ieee802154_llsec_key_id *id)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_key_del(&sdata->sec, id);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_add_dev(struct net_device *dev,\r\nconst struct ieee802154_llsec_device *llsec_dev)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_dev_add(&sdata->sec, llsec_dev);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_del_dev(struct net_device *dev, __le64 dev_addr)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_dev_del(&sdata->sec, dev_addr);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_add_devkey(struct net_device *dev,\r\n__le64 device_addr,\r\nconst struct ieee802154_llsec_device_key *key)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_devkey_add(&sdata->sec, device_addr, key);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_del_devkey(struct net_device *dev,\r\n__le64 device_addr,\r\nconst struct ieee802154_llsec_device_key *key)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_devkey_del(&sdata->sec, device_addr, key);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_add_seclevel(struct net_device *dev,\r\nconst struct ieee802154_llsec_seclevel *sl)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_seclevel_add(&sdata->sec, sl);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nint mac802154_del_seclevel(struct net_device *dev,\r\nconst struct ieee802154_llsec_seclevel *sl)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nint res;\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\nres = mac802154_llsec_seclevel_del(&sdata->sec, sl);\r\nmutex_unlock(&sdata->sec_mtx);\r\nreturn res;\r\n}\r\nvoid mac802154_lock_table(struct net_device *dev)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_lock(&sdata->sec_mtx);\r\n}\r\nvoid mac802154_get_table(struct net_device *dev,\r\nstruct ieee802154_llsec_table **t)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\n*t = &sdata->sec.table;\r\n}\r\nvoid mac802154_unlock_table(struct net_device *dev)\r\n{\r\nstruct ieee802154_sub_if_data *sdata = IEEE802154_DEV_TO_SUB_IF(dev);\r\nBUG_ON(dev->type != ARPHRD_IEEE802154);\r\nmutex_unlock(&sdata->sec_mtx);\r\n}
