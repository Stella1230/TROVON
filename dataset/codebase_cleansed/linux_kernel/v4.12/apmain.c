static void ap_display_usage(void)\r\n{\r\nACPI_USAGE_HEADER("acpidump [options]");\r\nACPI_OPTION("-b", "Dump tables to binary files");\r\nACPI_OPTION("-h -?", "This help message");\r\nACPI_OPTION("-o <File>", "Redirect output to file");\r\nACPI_OPTION("-r <Address>", "Dump tables from specified RSDP");\r\nACPI_OPTION("-s", "Print table summaries only");\r\nACPI_OPTION("-v", "Display version information");\r\nACPI_OPTION("-z", "Verbose mode");\r\nACPI_USAGE_TEXT("\nTable Options:\n");\r\nACPI_OPTION("-a <Address>", "Get table via a physical address");\r\nACPI_OPTION("-c <on|off>", "Turning on/off customized table dumping");\r\nACPI_OPTION("-f <BinaryFile>", "Get table via a binary file");\r\nACPI_OPTION("-n <Signature>", "Get table via a name/signature");\r\nACPI_OPTION("-x", "Do not use but dump XSDT");\r\nACPI_OPTION("-x -x", "Do not use or dump XSDT");\r\nACPI_USAGE_TEXT("\n"\r\n"Invocation without parameters dumps all available tables\n"\r\n"Multiple mixed instances of -a, -f, and -n are supported\n\n");\r\n}\r\nstatic int ap_insert_action(char *argument, u32 to_be_done)\r\n{\r\naction_table[current_action].argument = argument;\r\naction_table[current_action].to_be_done = to_be_done;\r\ncurrent_action++;\r\nif (current_action > AP_MAX_ACTIONS) {\r\nfprintf(stderr, "Too many table options (max %u)\n",\r\nAP_MAX_ACTIONS);\r\nreturn (-1);\r\n}\r\nreturn (0);\r\n}\r\nstatic int ap_do_options(int argc, char **argv)\r\n{\r\nint j;\r\nacpi_status status;\r\nwhile ((j =\r\nacpi_getopt(argc, argv, AP_SUPPORTED_OPTIONS)) != ACPI_OPT_END)\r\nswitch (j) {\r\ncase 'b':\r\ngbl_binary_mode = TRUE;\r\ncontinue;\r\ncase 'c':\r\nif (!strcmp(acpi_gbl_optarg, "on")) {\r\ngbl_dump_customized_tables = TRUE;\r\n} else if (!strcmp(acpi_gbl_optarg, "off")) {\r\ngbl_dump_customized_tables = FALSE;\r\n} else {\r\nfprintf(stderr,\r\n"%s: Cannot handle this switch, please use on|off\n",\r\nacpi_gbl_optarg);\r\nreturn (-1);\r\n}\r\ncontinue;\r\ncase 'h':\r\ncase '?':\r\nap_display_usage();\r\nreturn (1);\r\ncase 'o':\r\nif (ap_open_output_file(acpi_gbl_optarg)) {\r\nreturn (-1);\r\n}\r\ncontinue;\r\ncase 'r':\r\nstatus =\r\nacpi_ut_strtoul64(acpi_gbl_optarg,\r\nACPI_STRTOUL_64BIT,\r\n&gbl_rsdp_base);\r\nif (ACPI_FAILURE(status)) {\r\nfprintf(stderr,\r\n"%s: Could not convert to a physical address\n",\r\nacpi_gbl_optarg);\r\nreturn (-1);\r\n}\r\ncontinue;\r\ncase 's':\r\ngbl_summary_mode = TRUE;\r\ncontinue;\r\ncase 'x':\r\nif (!acpi_gbl_do_not_use_xsdt) {\r\nacpi_gbl_do_not_use_xsdt = TRUE;\r\n} else {\r\ngbl_do_not_dump_xsdt = TRUE;\r\n}\r\ncontinue;\r\ncase 'v':\r\nacpi_os_printf(ACPI_COMMON_SIGNON(AP_UTILITY_NAME));\r\nreturn (1);\r\ncase 'z':\r\ngbl_verbose_mode = TRUE;\r\nfprintf(stderr, ACPI_COMMON_SIGNON(AP_UTILITY_NAME));\r\ncontinue;\r\ncase 'a':\r\nif (ap_insert_action\r\n(acpi_gbl_optarg, AP_DUMP_TABLE_BY_ADDRESS)) {\r\nreturn (-1);\r\n}\r\nbreak;\r\ncase 'f':\r\nif (ap_insert_action\r\n(acpi_gbl_optarg, AP_DUMP_TABLE_BY_FILE)) {\r\nreturn (-1);\r\n}\r\nbreak;\r\ncase 'n':\r\nif (ap_insert_action\r\n(acpi_gbl_optarg, AP_DUMP_TABLE_BY_NAME)) {\r\nreturn (-1);\r\n}\r\nbreak;\r\ndefault:\r\nap_display_usage();\r\nreturn (-1);\r\n}\r\nif (current_action == 0) {\r\nif (ap_insert_action(NULL, AP_DUMP_ALL_TABLES)) {\r\nreturn (-1);\r\n}\r\n}\r\nreturn (0);\r\n}
