static unsigned int\r\nredirect_tg6(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nreturn nf_nat_redirect_ipv6(skb, par->targinfo, xt_hooknum(par));\r\n}\r\nstatic int redirect_tg6_checkentry(const struct xt_tgchk_param *par)\r\n{\r\nconst struct nf_nat_range *range = par->targinfo;\r\nif (range->flags & NF_NAT_RANGE_MAP_IPS)\r\nreturn -EINVAL;\r\nreturn nf_ct_netns_get(par->net, par->family);\r\n}\r\nstatic void redirect_tg_destroy(const struct xt_tgdtor_param *par)\r\n{\r\nnf_ct_netns_put(par->net, par->family);\r\n}\r\nstatic int redirect_tg4_check(const struct xt_tgchk_param *par)\r\n{\r\nconst struct nf_nat_ipv4_multi_range_compat *mr = par->targinfo;\r\nif (mr->range[0].flags & NF_NAT_RANGE_MAP_IPS) {\r\npr_debug("bad MAP_IPS.\n");\r\nreturn -EINVAL;\r\n}\r\nif (mr->rangesize != 1) {\r\npr_debug("bad rangesize %u.\n", mr->rangesize);\r\nreturn -EINVAL;\r\n}\r\nreturn nf_ct_netns_get(par->net, par->family);\r\n}\r\nstatic unsigned int\r\nredirect_tg4(struct sk_buff *skb, const struct xt_action_param *par)\r\n{\r\nreturn nf_nat_redirect_ipv4(skb, par->targinfo, xt_hooknum(par));\r\n}\r\nstatic int __init redirect_tg_init(void)\r\n{\r\nreturn xt_register_targets(redirect_tg_reg,\r\nARRAY_SIZE(redirect_tg_reg));\r\n}\r\nstatic void __exit redirect_tg_exit(void)\r\n{\r\nxt_unregister_targets(redirect_tg_reg, ARRAY_SIZE(redirect_tg_reg));\r\n}
