static void tcp_scalable_cong_avoid(struct sock *sk, u32 ack, u32 acked)\r\n{\r\nstruct tcp_sock *tp = tcp_sk(sk);\r\nif (!tcp_is_cwnd_limited(sk))\r\nreturn;\r\nif (tcp_in_slow_start(tp))\r\ntcp_slow_start(tp, acked);\r\nelse\r\ntcp_cong_avoid_ai(tp, min(tp->snd_cwnd, TCP_SCALABLE_AI_CNT),\r\n1);\r\n}\r\nstatic u32 tcp_scalable_ssthresh(struct sock *sk)\r\n{\r\nconst struct tcp_sock *tp = tcp_sk(sk);\r\nstruct scalable *ca = inet_csk_ca(sk);\r\nca->loss_cwnd = tp->snd_cwnd;\r\nreturn max(tp->snd_cwnd - (tp->snd_cwnd>>TCP_SCALABLE_MD_SCALE), 2U);\r\n}\r\nstatic u32 tcp_scalable_cwnd_undo(struct sock *sk)\r\n{\r\nconst struct scalable *ca = inet_csk_ca(sk);\r\nreturn max(tcp_sk(sk)->snd_cwnd, ca->loss_cwnd);\r\n}\r\nstatic int __init tcp_scalable_register(void)\r\n{\r\nreturn tcp_register_congestion_control(&tcp_scalable);\r\n}\r\nstatic void __exit tcp_scalable_unregister(void)\r\n{\r\ntcp_unregister_congestion_control(&tcp_scalable);\r\n}
