static void\r\nnv04_i2c_bus_drive_scl(struct nvkm_i2c_bus *base, int state)\r\n{\r\nstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\r\nstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\r\nu8 val = nvkm_rdvgac(device, 0, bus->drive);\r\nif (state) val |= 0x20;\r\nelse val &= 0xdf;\r\nnvkm_wrvgac(device, 0, bus->drive, val | 0x01);\r\n}\r\nstatic void\r\nnv04_i2c_bus_drive_sda(struct nvkm_i2c_bus *base, int state)\r\n{\r\nstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\r\nstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\r\nu8 val = nvkm_rdvgac(device, 0, bus->drive);\r\nif (state) val |= 0x10;\r\nelse val &= 0xef;\r\nnvkm_wrvgac(device, 0, bus->drive, val | 0x01);\r\n}\r\nstatic int\r\nnv04_i2c_bus_sense_scl(struct nvkm_i2c_bus *base)\r\n{\r\nstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\r\nstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\r\nreturn !!(nvkm_rdvgac(device, 0, bus->sense) & 0x04);\r\n}\r\nstatic int\r\nnv04_i2c_bus_sense_sda(struct nvkm_i2c_bus *base)\r\n{\r\nstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\r\nstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\r\nreturn !!(nvkm_rdvgac(device, 0, bus->sense) & 0x08);\r\n}\r\nint\r\nnv04_i2c_bus_new(struct nvkm_i2c_pad *pad, int id, u8 drive, u8 sense,\r\nstruct nvkm_i2c_bus **pbus)\r\n{\r\nstruct nv04_i2c_bus *bus;\r\nif (!(bus = kzalloc(sizeof(*bus), GFP_KERNEL)))\r\nreturn -ENOMEM;\r\n*pbus = &bus->base;\r\nnvkm_i2c_bus_ctor(&nv04_i2c_bus_func, pad, id, &bus->base);\r\nbus->drive = drive;\r\nbus->sense = sense;\r\nreturn 0;\r\n}
