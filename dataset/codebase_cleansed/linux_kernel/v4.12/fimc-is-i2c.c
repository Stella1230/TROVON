static u32 is_i2c_func(struct i2c_adapter *adap)\r\n{\r\nreturn I2C_FUNC_I2C;\r\n}\r\nstatic int fimc_is_i2c_probe(struct platform_device *pdev)\r\n{\r\nstruct device_node *node = pdev->dev.of_node;\r\nstruct fimc_is_i2c *isp_i2c;\r\nstruct i2c_adapter *i2c_adap;\r\nint ret;\r\nisp_i2c = devm_kzalloc(&pdev->dev, sizeof(*isp_i2c), GFP_KERNEL);\r\nif (!isp_i2c)\r\nreturn -ENOMEM;\r\nisp_i2c->clock = devm_clk_get(&pdev->dev, "i2c_isp");\r\nif (IS_ERR(isp_i2c->clock)) {\r\ndev_err(&pdev->dev, "failed to get the clock\n");\r\nreturn PTR_ERR(isp_i2c->clock);\r\n}\r\ni2c_adap = &isp_i2c->adapter;\r\ni2c_adap->dev.of_node = node;\r\ni2c_adap->dev.parent = &pdev->dev;\r\nstrlcpy(i2c_adap->name, "exynos4x12-isp-i2c", sizeof(i2c_adap->name));\r\ni2c_adap->owner = THIS_MODULE;\r\ni2c_adap->algo = &fimc_is_i2c_algorithm;\r\ni2c_adap->class = I2C_CLASS_SPD;\r\nplatform_set_drvdata(pdev, isp_i2c);\r\npm_runtime_enable(&pdev->dev);\r\nret = i2c_add_adapter(i2c_adap);\r\nif (ret < 0)\r\ngoto err_pm_dis;\r\npm_suspend_ignore_children(&i2c_adap->dev, false);\r\nreturn 0;\r\nerr_pm_dis:\r\npm_runtime_disable(&pdev->dev);\r\nreturn ret;\r\n}\r\nstatic int fimc_is_i2c_remove(struct platform_device *pdev)\r\n{\r\nstruct fimc_is_i2c *isp_i2c = platform_get_drvdata(pdev);\r\npm_runtime_disable(&pdev->dev);\r\ni2c_del_adapter(&isp_i2c->adapter);\r\nreturn 0;\r\n}\r\nstatic int fimc_is_i2c_runtime_suspend(struct device *dev)\r\n{\r\nstruct fimc_is_i2c *isp_i2c = dev_get_drvdata(dev);\r\nclk_disable_unprepare(isp_i2c->clock);\r\nreturn 0;\r\n}\r\nstatic int fimc_is_i2c_runtime_resume(struct device *dev)\r\n{\r\nstruct fimc_is_i2c *isp_i2c = dev_get_drvdata(dev);\r\nreturn clk_prepare_enable(isp_i2c->clock);\r\n}\r\nstatic int fimc_is_i2c_suspend(struct device *dev)\r\n{\r\nif (pm_runtime_suspended(dev))\r\nreturn 0;\r\nreturn fimc_is_i2c_runtime_suspend(dev);\r\n}\r\nstatic int fimc_is_i2c_resume(struct device *dev)\r\n{\r\nif (pm_runtime_suspended(dev))\r\nreturn 0;\r\nreturn fimc_is_i2c_runtime_resume(dev);\r\n}\r\nint fimc_is_register_i2c_driver(void)\r\n{\r\nreturn platform_driver_register(&fimc_is_i2c_driver);\r\n}\r\nvoid fimc_is_unregister_i2c_driver(void)\r\n{\r\nplatform_driver_unregister(&fimc_is_i2c_driver);\r\n}
