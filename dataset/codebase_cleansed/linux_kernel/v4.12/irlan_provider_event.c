void irlan_do_provider_event(struct irlan_cb *self, IRLAN_EVENT event,\r\nstruct sk_buff *skb)\r\n{\r\nIRDA_ASSERT(*state[ self->provider.state] != NULL, return;);\r\n(*state[self->provider.state]) (self, event, skb);\r\n}\r\nstatic int irlan_provider_state_idle(struct irlan_cb *self, IRLAN_EVENT event,\r\nstruct sk_buff *skb)\r\n{\r\nIRDA_ASSERT(self != NULL, return -1;);\r\nswitch(event) {\r\ncase IRLAN_CONNECT_INDICATION:\r\nirlan_provider_connect_response( self, self->provider.tsap_ctrl);\r\nirlan_next_provider_state( self, IRLAN_INFO);\r\nbreak;\r\ndefault:\r\npr_debug("%s(), Unknown event %d\n", __func__ , event);\r\nbreak;\r\n}\r\nif (skb)\r\ndev_kfree_skb(skb);\r\nreturn 0;\r\n}\r\nstatic int irlan_provider_state_info(struct irlan_cb *self, IRLAN_EVENT event,\r\nstruct sk_buff *skb)\r\n{\r\nint ret;\r\nIRDA_ASSERT(self != NULL, return -1;);\r\nswitch(event) {\r\ncase IRLAN_GET_INFO_CMD:\r\nif (self->provider.access_type == ACCESS_PEER) {\r\nself->media = MEDIA_802_3;\r\nif (self->client.state == IRLAN_IDLE) {\r\nirlmp_discovery_request(8);\r\n}\r\n}\r\nirlan_provider_send_reply(self, CMD_GET_PROVIDER_INFO,\r\nRSP_SUCCESS);\r\nbreak;\r\ncase IRLAN_GET_MEDIA_CMD:\r\nirlan_provider_send_reply(self, CMD_GET_MEDIA_CHAR,\r\nRSP_SUCCESS);\r\nbreak;\r\ncase IRLAN_OPEN_DATA_CMD:\r\nret = irlan_parse_open_data_cmd(self, skb);\r\nif (self->provider.access_type == ACCESS_PEER) {\r\nself->provider.send_arb_val = (jiffies & 0xffff);\r\n}\r\nirlan_provider_send_reply(self, CMD_OPEN_DATA_CHANNEL, ret);\r\nif (ret == RSP_SUCCESS) {\r\nirlan_next_provider_state(self, IRLAN_OPEN);\r\nirlan_do_client_event(self, IRLAN_PROVIDER_SIGNAL, NULL);\r\n}\r\nbreak;\r\ncase IRLAN_LMP_DISCONNECT:\r\ncase IRLAN_LAP_DISCONNECT:\r\nirlan_next_provider_state(self, IRLAN_IDLE);\r\nbreak;\r\ndefault:\r\npr_debug("%s(), Unknown event %d\n", __func__ , event);\r\nbreak;\r\n}\r\nif (skb)\r\ndev_kfree_skb(skb);\r\nreturn 0;\r\n}\r\nstatic int irlan_provider_state_open(struct irlan_cb *self, IRLAN_EVENT event,\r\nstruct sk_buff *skb)\r\n{\r\nIRDA_ASSERT(self != NULL, return -1;);\r\nswitch(event) {\r\ncase IRLAN_FILTER_CONFIG_CMD:\r\nirlan_provider_parse_command(self, CMD_FILTER_OPERATION, skb);\r\nirlan_provider_send_reply(self, CMD_FILTER_OPERATION,\r\nRSP_SUCCESS);\r\nbreak;\r\ncase IRLAN_DATA_CONNECT_INDICATION:\r\nirlan_next_provider_state(self, IRLAN_DATA);\r\nirlan_provider_connect_response(self, self->tsap_data);\r\nbreak;\r\ncase IRLAN_LMP_DISCONNECT:\r\ncase IRLAN_LAP_DISCONNECT:\r\nirlan_next_provider_state(self, IRLAN_IDLE);\r\nbreak;\r\ndefault:\r\npr_debug("%s(), Unknown event %d\n", __func__ , event);\r\nbreak;\r\n}\r\nif (skb)\r\ndev_kfree_skb(skb);\r\nreturn 0;\r\n}\r\nstatic int irlan_provider_state_data(struct irlan_cb *self, IRLAN_EVENT event,\r\nstruct sk_buff *skb)\r\n{\r\nIRDA_ASSERT(self != NULL, return -1;);\r\nIRDA_ASSERT(self->magic == IRLAN_MAGIC, return -1;);\r\nswitch(event) {\r\ncase IRLAN_FILTER_CONFIG_CMD:\r\nirlan_provider_parse_command(self, CMD_FILTER_OPERATION, skb);\r\nirlan_provider_send_reply(self, CMD_FILTER_OPERATION,\r\nRSP_SUCCESS);\r\nbreak;\r\ncase IRLAN_LMP_DISCONNECT:\r\ncase IRLAN_LAP_DISCONNECT:\r\nirlan_next_provider_state(self, IRLAN_IDLE);\r\nbreak;\r\ndefault:\r\npr_debug("%s(), Unknown event %d\n", __func__ , event);\r\nbreak;\r\n}\r\nif (skb)\r\ndev_kfree_skb(skb);\r\nreturn 0;\r\n}
